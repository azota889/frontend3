"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[1135],{59702:(yt,ke,v)=>{v.d(ke,{Q:()=>se});var l=v(89163),d=v(33887),c=v(48891),m=v(85969),x=v(41891),C=v(27842),re=v(54460),y=v(47712),oe=v(18718),z=v(2915),O=v(69135),k=v(52811),q=v(15343),D=v(76975);const Ie=(ee,Be)=>({"bg-info text-white":ee,"bg-slate-300":Be}),J=()=>({"text-pending":!0});function V(ee,Be){if(1&ee&&c.eu8(0,5),2&ee){c.XpG();const ge=c.sdS(5);c.Y8G("ngTemplateOutlet",ge)}}function w(ee,Be){if(1&ee&&c.eu8(0,5),2&ee){c.XpG();const ge=c.sdS(3);c.Y8G("ngTemplateOutlet",ge)}}function U(ee,Be){if(1&ee&&(c.j41(0,"div",7),c.nrm(1,"azt-loading-effect",8),c.k0s()),2&ee){const ge=c.XpG(2);c.R7$(),c.Y8G("currentStatusObj",ge.statusObj)}}function de(ee,Be){1&ee&&c.nrm(0,"azt-loading-ui",15)}function _e(ee,Be){if(1&ee){const ge=c.RV6();c.j41(0,"div",9),c.nrm(1,"iframe",10),c.nI1(2,"safe"),c.j41(3,"div",11)(4,"button",12),c.bIt("click",function(){c.eBV(ge);const pe=c.XpG(2);return c.Njj(pe.handleCloseDialog())}),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s(),c.j41(7,"button",13),c.bIt("click",function(){c.eBV(ge);const pe=c.XpG(2);return c.Njj(pe.orderBuyExam())}),c.DNE(8,de,1,0,"azt-loading-ui",14),c.j41(9,"span"),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()()}if(2&ee){let ge;const X=c.XpG(2);c.R7$(),c.Y8G("src",c.bMT(2,5,null!==(ge=X.showIframeInContent)&&void 0!==ge?ge:""),c.f$h),c.R7$(4),c.SpI(" ",c.bMT(6,7,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",X.statusObj.loading),c.R7$(),c.Y8G("ngIf",X.statusObj.loading),c.R7$(2),c.JRh(c.bMT(11,9,"lang_payment_confirm_payment_button"))}}function le(ee,Be){if(1&ee&&c.DNE(0,U,2,1,"div",6)(1,_e,12,11,"ng-template",null,2,c.C5r),2&ee){const ge=c.sdS(2),X=c.XpG();c.Y8G("ngIf",X.statusObj.loading)("ngIfElse",ge)}}function ie(ee,Be){if(1&ee&&c.nrm(0,"azt-loading-effect",8),2&ee){const ge=c.XpG(2);c.Y8G("currentStatusObj",ge.statusObj)}}function ze(ee,Be){if(1&ee){const ge=c.RV6();c.j41(0,"div",40)(1,"div",41),c.bIt("click",function(){const pe=c.eBV(ge).$implicit,lt=c.XpG(3);return c.Njj(lt.chooseCombo(pe))}),c.j41(2,"div",40),c.EFF(3),c.k0s(),c.j41(4,"div",42)(5,"div",43),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s(),c.j41(8,"div",44),c.EFF(9),c.nI1(10,"formatMoney"),c.k0s()()()()}if(2&ee){const ge=Be.$implicit,X=c.XpG(3);c.R7$(),c.Y8G("ngClass",c.l_i(9,Ie,(null==X.currentComboObj?null:X.currentComboObj.id)==ge.id,(null==X.currentComboObj?null:X.currentComboObj.id)!=ge.id)),c.R7$(2),c.JRh(ge.name),c.R7$(3),c.Lme("",ge.items.length," ",c.bMT(7,5,"lang_payment_total_exam_in_combo"),""),c.R7$(3),c.JRh(c.bMT(10,7,ge.price)+" VND")}}function Te(ee,Be){if(1&ee&&(c.qex(0),c.j41(1,"div",47)(2,"div",48),c.nrm(3,"lucide-icon",49),c.k0s(),c.j41(4,"div",50)(5,"div",51,3),c.EFF(7),c.k0s()()(),c.bVm()),2&ee){const ge=Be.$implicit,X=c.sdS(6);c.R7$(3),c.Y8G("ngClass",c.lJ4(5,J)),c.R7$(2),c.FS9("matTooltip",ge.name),c.Y8G("isDisabledTooltip",!1)("matTooltipDisabled",X.isDisabled),c.R7$(2),c.SpI(" ",ge.name," ")}}function Qe(ee,Be){if(1&ee&&(c.j41(0,"div",45),c.DNE(1,Te,8,6,"ng-container",46),c.k0s()),2&ee){const ge=c.XpG(3);c.R7$(),c.Y8G("ngForOf",ge.currentComboObj.items)}}function ve(ee,Be){1&ee&&c.nrm(0,"azt-loading-ui",15)}function nt(ee,Be){if(1&ee){const ge=c.RV6();c.j41(0,"azt-mat-dialog-content",18)(1,"div",19)(2,"div"),c.DNE(3,ze,11,12,"div",20),c.k0s(),c.DNE(4,Qe,2,1,"div",21),c.j41(5,"div",22)(6,"div",23),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.j41(9,"div",24)(10,"div",25)(11,"div",26)(12,"div",27),c.nrm(13,"img",28),c.nI1(14,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(15,"div",26)(16,"div",27),c.nrm(17,"img",29),c.nI1(18,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(19,"div",26)(20,"div",27),c.nrm(21,"img",30),c.nI1(22,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(23,"div",26)(24,"div",27),c.nrm(25,"img",31),c.nI1(26,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(27,"div",26)(28,"div",27),c.nrm(29,"img",32),c.nI1(30,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(31,"div",26)(32,"div",27),c.nrm(33,"img",33),c.nI1(34,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(35,"div",26)(36,"div",27),c.nrm(37,"img",34),c.nI1(38,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(39,"div",26)(40,"div",27),c.nrm(41,"img",35),c.nI1(42,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(43,"div",26)(44,"div",27),c.nrm(45,"img",36),c.nI1(46,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(47,"div",26)(48,"div",27),c.nrm(49,"img",37),c.nI1(50,"convertCdnLinkOfGitHub"),c.k0s()()()()()()(),c.j41(51,"div",38)(52,"div",39)(53,"button",12),c.bIt("click",function(){c.eBV(ge);const pe=c.XpG(2);return c.Njj(pe.handleCloseDialog())}),c.EFF(54),c.nI1(55,"mytranslate"),c.k0s(),c.j41(56,"button",13),c.bIt("click",function(){c.eBV(ge);const pe=c.XpG(2);return c.Njj(pe.orderBuyExam())}),c.DNE(57,ve,1,0,"azt-loading-ui",14),c.j41(58,"span"),c.EFF(59),c.nI1(60,"mytranslate"),c.k0s()()()()}if(2&ee){const ge=c.XpG(2);c.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 90px)"),c.R7$(3),c.Y8G("ngForOf",ge.comboObjs),c.R7$(),c.Y8G("ngIf",ge.currentComboObj),c.R7$(3),c.SpI(" ",c.bMT(8,18,"lang_payment_supported_payment_methods")," "),c.R7$(6),c.Y8G("src",c.bMT(14,20,"images/method-payment/vnpay_full.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(18,22,"images/method-payment/vietcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(22,24,"images/method-payment/techcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(26,26,"images/method-payment/vietinbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(30,28,"images/method-payment/mbbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(34,30,"images/method-payment/agribank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(38,32,"images/method-payment/bidv.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(42,34,"images/method-payment/acb.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(46,36,"images/method-payment/hdbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(50,38,"images/method-payment/vpbank.svg"),c.B4B),c.R7$(5),c.SpI(" ",c.bMT(55,40,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",ge.statusObj.loading),c.R7$(),c.Y8G("ngIf",ge.statusObj.loading),c.R7$(2),c.JRh(c.bMT(60,42,"lang_payment_confirm_payment_button"))}}function at(ee,Be){if(1&ee&&(c.j41(0,"div",16),c.DNE(1,ie,1,1,"azt-loading-effect",17)(2,nt,61,44,"ng-template",null,2,c.C5r),c.k0s()),2&ee){const ge=c.sdS(3),X=c.XpG();c.R7$(),c.Y8G("ngIf",X.statusObj.loading)("ngIfElse",ge)}}let se=(()=>{var ee;class Be extends d._{handleCloseDialog(){this.dialogRef.close(!1)}chooseCombo(X){this.currentComboObj=X}orderBuyExam(){if(!this.currentComboObj)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.initStatusObj();let X="userRole=student&productType=exam&backTo="+encodeURIComponent(this.commonService.getCurrentUrlWithoutLocale());this.waitDestroy(this.productOrderService.apiProductOrderBuyExamByMoneyGet(this.commonService.getCurrentHostName(),this.commonService.getCurrentLang(),this.currentComboObj.id,X).subscribe(pe=>{if(!pe.success)return this.errorStatusObj(pe.message,!0);window.location.href=pe.data?.value??""}))}initData(){this.initStatusObj(),this.waitDestroy(this.comboPackageService.apiComboPackageListComboPackagesByExamHashIdGet(this.data.examObj.hashId??"").subscribe(X=>X.success?X.data?.objs?.length?(this.comboObjs=X.data?.objs??[],this.currentComboObj=this.commonService.getFirstOfArray(this.comboObjs),this.showIframeInContent=this.currentComboObj?.description,this.stopStatusObj(),void(this.showIframeInContent&&this.sAztAzotaTrackingService.sendForceCustomEvent("PAYMENT_VIEW_IFRAME_CONTENT",[]))):this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0):this.errorStatusObj(X.message,!0)))}setViewport(){const X=document.createElement("meta");X.name="viewport",X.setAttribute("id","viewPortIframe");const pe=H=>{X.setAttribute("content",H),document.head.appendChild(X)},lt=window.innerWidth;if(lt<768){const xe=420!==lt?lt/420:1;pe(`width=420, user-scalable=no, initial-scale=${xe}, minimum-scale=${xe}, maximum-scale=${xe}`)}else pe("width=960, user-scalable=no, initial-scale=1.0")}removeViewPort(){document.getElementById("viewPortIframe")?.remove()}ngOnInit(){super.ngOnInit(),this.initData(),this.setViewport()}constructor(X,pe,lt,Ee,H){super(pe,X),this.dialogRef=X,this.data=pe,this.productOrderService=lt,this.comboPackageService=Ee,this.sAztAzotaTrackingService=H,this.comboObjs=[],this.showIframeInContent=void 0}ngOnDestroy(){this.removeViewPort()}}return(ee=Be).\u0275fac=function(X){return new(X||ee)(c.rXU(l.CP,8),c.rXU(l.Vh,8),c.rXU(m.Hg),c.rXU(x.E),c.rXU(C.M))},ee.\u0275cmp=c.VBU({type:ee,selectors:[["payment-dialog"]],features:[c.Vt3],decls:6,vars:2,consts:[["showIframeContent",""],["showListExamContent",""],["doneLoading",""],["c","isDisabled"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet"],["class","box py-4 px-4",4,"ngIf","ngIfElse"],[1,"box","py-4","px-4"],[3,"currentStatusObj"],[1,"bg-white",2,"height","100%"],["width","100%",2,"height","calc(var(--vh, 1vh) * 100 - 70px)",3,"src"],[1,"text-center","mt-4","text-center","absolute","bottom-2","w-full"],[1,"btn","btn-secondary-soft","w-32","mr-4","btn-lg","text-xl",3,"click"],[1,"btn","btn-primary","btn-lg","text-xl",3,"click","disabled"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"box","py-4","px-4",2,"height","100%"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"minHeight"],[2,"margin-right","-5px"],["class","pb-2",4,"ngFor","ngForOf"],["class","box border border-slate-200 dark:border-darkmode-400 pt-2",4,"ngIf"],[1,"mt-4"],[1,"font-medium"],[1,"mt-2"],[1,"grid","grid-cols-10","gap-4"],[1,"col-span-5","md:col-span-2","flex","justify-center"],[1,"p-1","rounded-lg","border","border-slate-200","dark:border-darkmode-400","w-full","h-full"],["alt","Vnpay",2,"height","100%",3,"src"],["alt","vietcombank",3,"src"],["alt","techcombank",3,"src"],["alt","vietinbank",3,"src"],["alt","mbbank",3,"src"],["alt","agribank",3,"src"],["alt","bidv",3,"src"],["alt","acb",3,"src"],["alt","hdbank",3,"src"],["alt","vpbank",3,"src"],[1,"flex","mt-4"],[1,"ml-auto"],[1,"pb-2"],[1,"clickable","box","pl-2","pr-2","pt-2",3,"click","ngClass"],[1,"pb-2","flex","items-center","font-medium"],[1,"mr-auto"],[1,"text-lg"],[1,"box","border","border-slate-200","dark:border-darkmode-400","pt-2"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-3","border-b","border-slate-200","dark:border-darkmode-400"],[1,"flex-none","image-fit","rounded-md","overflow-hidden"],["name","file-check","size","40",3,"ngClass"],[1,"ml-4","mr-auto"],[2,"line-height","1.2",3,"matTooltip","isDisabledTooltip","matTooltipDisabled"]],template:function(X,pe){1&X&&c.DNE(0,V,1,1,"ng-container",4)(1,w,1,1,"ng-container",4)(2,le,3,2,"ng-template",null,0,c.C5r)(4,at,4,2,"ng-template",null,1,c.C5r),2&X&&(c.Y8G("ngIf",!pe.showIframeInContent),c.R7$(),c.Y8G("ngIf",pe.showIframeInContent))},dependencies:[re.YU,re.Sq,re.bT,re.T3,y.oV,oe.K,z.U,O.f,k.R,q.WGl,D.wp,D.JI,D.gt,D.t0],encapsulation:2}),Be})()},57081:(yt,ke,v)=>{v.d(ke,{w:()=>C});var l=v(48891),d=v(62095),c=v(68774),m=v(50589),x=v(99927);let C=(()=>{var re;class y{_saveSortTypeOfSetting(z){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,z)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(z){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==z}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(z,O){var k=[];return O.forEach(q=>{q.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(z,q.results??new Array),k.push(q)}),k}_filterExamResultObjsByFilterSettingObjNotInClassroom(z,O){var k=[];if(z.isMarked||z.isNotMarked||z.isOnTest||z.isNotSubmit||z.isNotTested)for(var q of O){let D=!1,Ie=z.isOnTest||z.isNotSubmit;z.isMarked&&1==q.isMarked&&(!Ie||!(1!=q.status&&(q.isMarked||q.isNotMarked)))&&(D=!0),z.isNotMarked&&1==q.isNotMarked&&(!Ie||!(1!=q.status&&(q.isMarked||q.isNotMarked)))&&(D=!0),z.isOnTest&&(1==q.isOnTest||0==q.status&&(q.isMarked||q.isNotMarked))&&(D=!0),z.isNotTested&&1==q.isNotTested&&(D=!0),z.isNotSubmit&&(1==q.isNotSubmit||-1==q.status&&(q.isMarked||q.isNotMarked))&&(D=!0),D&&k.push(q)}else k=O;return k}_searchExamResultObjsByFullNameInClassroom(z,O){var k=[];return this.commonService.myClone(z).forEach(D=>{var Ie=this._searchExamResultObjsByFullNameNotInClassroom(D.results??[],O);Ie.length>0&&(D.results=Ie,k.push(D))}),k}_searchExamResultObjsByFullNameNotInClassroom(z,O){O=this.commonService.convertVietnameseToEnglish(O).toLowerCase();var k=[];return z.forEach(q=>{-1!=this.commonService.convertVietnameseToEnglish(q.fullName??"").toLowerCase().indexOf(O)&&k.push(q)}),k}_sortExamResultObjsBySettingObjByClassroom(z,O,k){return"isSortByNameAsc"==k?this.sortService.sortFirstNameStudentsInClass(z):"isSortByTimeDesc"==k?this.sortService.sortTimeStudentsInClass(z,1):"isSortByMarkDesc"==k?this.sortService.sortMarkStudentsInClass(z,1,O):this._sortExamResultObjsBySortTypeOfClassroom(z)}_sortExamResultObjsBySettingObjNotInClassroom(z,O,k){return"isSortByNameAsc"==k?this.sortService.sortFirstNameStudents(z):"isSortByTimeDesc"==k?this.sortService.sortTimeDESC(z):"isSortByMarkDesc"==k?this.sortService.sortMarkDESC(z,O):z}_sortExamResultObjsBySortTypeOfClassroom(z){var O=z.map(k=>({...k}));return O.forEach((k,q)=>{k.results=0==k.classObj?.sortType?this.sortService.sortFirstNameStudents(k.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(k.results??[],"pos","id"),O[q]=k}),O}_changeExamResultStatusForAllClassroom(z,O,k){var q=[];return z.forEach((D,Ie)=>{D.results=this._changeExamResultStatusForOneClassroom(D.results??new Array,O),D={indexCounter:Ie,...D,countSubmitted:k?D.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(D.results??new Array),showOnTab:D.showOnTab},q.push(D)}),q}_changeExamResultStatusForOneClassroom(z,O){var k=[...z];return k.forEach((q,D)=>{q.confirmedAt&&""!=q.confirmedAt&&q.resultId&&q.resultId>0?q.isMarked=!0:q.resultId&&q.resultId>0&&(!q.confirmedAt||""==q.confirmedAt)?q.isNotMarked=!0:q.resultId&&0!=q.resultId||!q.startedTest||""==q.startedTest||0!=q.status?q.resultId&&0!=q.resultId||!q.startedTest||""==q.startedTest||-1!=q.status?null==q.startedTest&&(q.isNotTested=!0):q.isNotSubmit=!0:q.isOnTest=!0,k[D]=q}),k.forEach((q,D)=>{q.files&&""!=q.files&&!Array.isArray(q.files)&&(q.filesParse=this.commonService.myParseJson(q.files)),k[D]=q}),k}_countTotalSubmittedOfExamResultObjs(z){var O=0;return z.forEach(k=>{(k.isMarked||k.isNotMarked)&&O++}),O}_counterTotalEssayOfQuestionObjs(z){let O=0;return z.forEach(k=>{this.answerTypeService.isEssayAnswer(k)&&O++}),O}_checkCounterEssayQuestionObjs(z){let O=0;return z.forEach(k=>{k.isEssay&&O++}),O}constructor(z,O,k,q){this.commonService=z,this.sortService=O,this.browserStorageService=k,this.answerTypeService=q,this.sortByStorageKey="exam_list_sort_by"}}return(re=y).\u0275fac=function(z){return new(z||re)(l.KVO(d.R),l.KVO(c.g),l.KVO(m.z),l.KVO(x._))},re.\u0275prov=l.jDH({token:re,factory:re.\u0275fac,providedIn:"root"}),y})()},87515:(yt,ke,v)=>{v.d(ke,{h:()=>k});var l=v(10936),d=v(51698),c=v(48891),m=v(62095),x=v(9280),C=v(51913),re=v(41715),y=v(50589),oe=v(79064),z=v(91640),O=v(57081);let k=(()=>{var q;class D{constructor(J,V,w,U,de,_e,le,ie){this.commonService=J,this.examPageResultService=V,this.permissionService=w,this.globalService=U,this.browserStorageService=de,this.gzipHelper=_e,this.homeworkExamService=le,this.sAztExamResultListSortService=ie}getTestedUserObjs(J,V,w){return this.globalService.startIntervalFunc(J),this.getTestedOfExamResult(J,V,"default",w)}getTestedLastMark(J,V,w){return this.globalService.startIntervalFunc(J),this.getTestedOfExamResult(J,V,"last",void 0,w)}getTestedHighestMark(J,V,w){return this.globalService.startIntervalFunc(J),this.getTestedOfExamResult(J,V,"highest",void 0,w)}getTestedFirstMark(J,V,w){return this.globalService.startIntervalFunc(J),this.getTestedOfExamResult(J,V,"first",void 0,w)}getTestedAllResult(J,V,w){return this.globalService.startIntervalFunc(J),this.getTestedOfExamResult(J,V,"all",void 0,w)}getTestedOfExamResult(J,V,w,U,de){return new d.c(_e=>{let le="tested_list_result_v2_"+V,ie=this.browserStorageService.getSimpleSessionStorage(le)??"",ze=this.gzipHelper.resultContentSupport(ie),Te=ze&&this.commonService.willDeleteParseJson(ze)?this.commonService.willDeleteParseJson(ze):void 0;U&&ie&&Te?(_e.next({status:200,success:1,data:Te,message:"successful"}),_e.complete()):this.examPageResultService.apiExamPageResultGetNewObjV2Post({examId:V,classroomIds:de}).subscribe(ve=>{if(1==ve.success){let at=ve.data?.serverSecond??0,se=ve.data?.examObj,ee=ve.data?.classroomWithAvatarAndStudentObjs??new Array,Be=ve.data?.totalAttended??0,ge=ve.data?.examQuestionObjs??new Array,X=ve.data?.examCreatorObj,pe=ve.data?.offlineExamObj,lt=ve.data?.hasEssayQuestion,Ee=ve.data?.totalQuestion??0,H=ve.data?.offlineMixQuestionObjs,xe=ve.data?.canResetStudentCode,mt=ve.data?.hasCreateStudentCode,rt=ve.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",se)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",se)?this.getAllExamResultObjs(J,[],V,"",Et=>{if(Et.hasOwnProperty("success")&&1==Et.success){let Xe=this.mergeStudentWithAvatar(Et.studentWithResultObjs??[]),pt={},Ze=[];Xe?.forEach(j=>{let Me=j.parentId??"0";pt.hasOwnProperty(Me)?pt[Me].push(...j.examResultObjs??[]):pt[Me]=j.examResultObjs??[],Ze=Ze.concat(pt[Me])});let Ge=se?this.filterExamResultOnTest(Ze,se,at):{},K=[],ce=[];if(this.homeworkExamService.mustInClassroom(se)&&ee.length>0)for(let j=0;j<ee.length;j++){let Me=ee[j].classroomObj;Me.classroomGroup=ee[j].classroomGroup;let Ne=ee[j].studentObjs??[],Oe=[];if(Ne.length>0)for(let We=0;We<Ne.length;We++){let Le=Ne[We].parentId??"0";this.commonService.isExistInArray(ce,Ne[We].parentId)||ce.push(Ne[We].parentId??"0"),pt.hasOwnProperty(Le)&&(Array.isArray(Ne[We].examResultObjs)||(Ne[We].examResultObjs=[]),Ne[We].examResultObjs=this.findExamResultOfStudent(pt[Le],Ne[We].id??"0"));let xt=Ge.hasOwnProperty(Ne[We].parentId??0)?Ge[Ne[We].parentId??0]:0;if("all"==w)if(Ne[We].examResultObjs?.length)Ne[We].examResultObjs?.forEach((Re,fe)=>{let Ue=this.commonService.castJsonToObj(JSON.stringify(Re));Ue&&(Ue.resultId=Ue.testStatus&&Ue.testStatus>0?Ue.id:0);let E=this.createStudentWithResult(Ne[We],Ue,xt,Ee,fe,Ne[We].examResultObjs?.length??0);Oe.push(E)});else{let Re=this.createStudentWithResult(Ne[We],void 0,xt,Ee,-1,0);Oe.push(Re)}else{let Re=this.filterExamResultByType(Ne[We].examResultObjs??[],w),fe=Re.hasOwnProperty(Ne[We].parentId??0)?Re[Ne[We].parentId??0]:void 0,E=this.createStudentWithResult(Ne[We],fe,xt,Ee,(fe&&null!=fe.indexTest&&fe.indexTest>=0?fe.indexTest:"first"==w?0:(Ne[We].examResultObjs?.length??0)-1)??0,Ne[We].examResultObjs?.length??0);Oe.push(E)}}K.push({classObj:Me,results:Oe})}let me=[],G=this.commonService.myClone(Xe)??[];for(let j=0;j<G?.length;j++)if(!this.commonService.isExistInArray(ce,G[j].parentId)){let Me=Ge.hasOwnProperty(G[j].parentId??0)?Ge[G[j].parentId??0]:0;if("all"==w)if(G[j].examResultObjs?.length)G[j].examResultObjs?.forEach((Ne,Oe)=>{let We=this.commonService.castJsonToObj(JSON.stringify(Ne));We&&(We.resultId=We.testStatus&&We.testStatus>0?We.id:0);let Le=this.createStudentWithResult(G[j],We,Me,Ee,Oe,G[j].examResultObjs?.length??0);me.push(Le)});else{let Ne=this.createStudentWithResult(G[j],void 0,Me,Ee,-1,0);me.push(Ne)}else{let Ne=this.filterExamResultByType(G[j].examResultObjs??[],w),Oe=Ne.hasOwnProperty(G[j].parentId??0)?Ne[G[j].parentId??0]:void 0,Le=this.createStudentWithResult(G[j],Oe,Me,Ee,(Oe&&null!=Oe?.indexTest&&Oe.indexTest>=0?Oe.indexTest:"first"==w?0:(G[j].examResultObjs?.length??0)-1)??0,G[j].examResultObjs?.length??0);me.push(Le)}}"all"!=w&&me.sort((j,Me)=>this.compareTwoDate(j.createdAt??"",Me.createdAt??""));let F=0;(K.length||me.length)&&(K.forEach(j=>{j.results?.forEach(Me=>{let Ne=this.getMaxGroupId(Me.groupPoints??[]);F<Ne&&(F=Ne)})}),me.forEach(j=>{let Me=this.getMaxGroupId(j.groupPoints??[]);F<Me&&(F=Me)})),"export_tool"==J&&de?.length&&(K=K.filter(j=>this.commonService.isExistInArray(de,j.classObj?.id)),this.commonService.isExistInArray(de,-1)||(me=[]));let S={studentsInClassResults:K.length>0?K:[],studentsNotInClassResults:me.length>0?me:[],totalAttended:Be,totalQuestion:Ee,totalUsers:0,examCreatorObj:X,offlineMixQuestionObjs:H,examObj:se,hasEssayQuestion:lt,offlineExamObj:pe,canResetStudentCode:xe,hasCreateStudentCode:mt,questionObjs:ge,fileTypeStr:rt,errorConfigClassroomPermission:ve.data?.errorConfigClassroomPermission,errorMessage:ve.data?.errorMessage,maxGroupId:F};if("export_tool"!=J){let j=this.gzipHelper.zipBigContent(JSON.stringify(S));this.browserStorageService.saveSimpleSessionStorage(le,j)}_e.next({status:200,success:1,data:S,message:"successful"}),_e.complete()}else _e.next({status:Et.code,success:0,data:null,message:Et.message??""}),_e.complete()}):(_e.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:Be,totalQuestion:Ee,hasEssayQuestion:lt,totalUsers:0,examCreatorObj:X,offlineMixQuestionObjs:H,examObj:se,offlineExamObj:pe,canResetStudentCode:xe,hasCreateStudentCode:mt,questionObjs:ge,fileTypeStr:ve.data?.fileTypeStr,errorConfigClassroomPermission:ve.data?.errorConfigClassroomPermission,errorMessage:ve.data?.errorMessage,maxGroupId:0},message:"successful"}),_e.complete())}else _e.next({status:ve.code,success:0,data:null,message:ve.message??""}),_e.complete()})})}getAllExamResultObjs(J,V,w,U,de){this.examPageResultService.apiExamPageResultGetObjsV2Get(w,"test_review"==J||"export_tool"==J?"export":"tested_list",U).subscribe(le=>{1==le.success?(le.data?.objs&&V.push(...le.data.objs),le.data?.nextPage?this.globalService.isStopIntervalFunc(J)?de({studentWithResultObjs:V,success:1}):setTimeout(()=>{this.getAllExamResultObjs(J,V,w,le.data?.nextPage??"",de)},300):de({studentWithResultObjs:V,success:1})):de({code:le.code,studentWithResultObjs:[],success:0,message:le.message??""})})}compareTwoDate(J,V){var w=new Date(J).getTime();w=isNaN(w)?0:w;var U=new Date(V).getTime();return w-(U=isNaN(U)?0:U)>0?1:w-U<0?-1:0}filterExamResultOnTest(J,V,w){var U={};return J.forEach(de=>{var _e=this.commonService.myClone(de)??{};if(_e.testStatus)U[_e.userId??0]=_e.testStatus;else if(_e.startedTest&&w)if(V.endTime){var le=Math.floor(new Date(V.endTime).getTime()/1e3);U[_e.userId??0]=w<=le+60*(V.minutes??0)+600?0:-1}else{var ie=_e.startedTest?Math.floor(new Date(_e.startedTest).getTime()/1e3):0;U[_e.userId??0]=w<=ie+86400?0:-1}else U[_e.userId??0]=0}),U}filterExamResultByType(J,V){var w={};if(J.length>1)J.forEach((de,_e)=>{var le=this.commonService.myClone(de);de.testStatus&&(le.resultId=le.id,le.indexTest=_e,"default"==V&&(w[le.userId??0]=le),"last"==V&&(w[le.userId??0]=le),"first"==V&&(w.hasOwnProperty(le.userId??0)||(w[le.userId??0]=le)),"highest"==V)&&(w.hasOwnProperty(le.userId??0)?(w[le.userId??0].mark??-1)<=(le.mark??-1)&&(w[le.userId??0]=le):w[le.userId??0]=le)});else{var U=this.commonService.myClone(J[0]??{});U.resultId=U.testStatus?U.id:0,U.indexTest=0,w[U.userId??0]=U}return w}findExamResultOfStudent(J,V){var w=[];return J.forEach(U=>{(U.studentId==V||null==U.studentId)&&w.push(U)}),w}addResultIdToExamResult(J){var V=[];return J.forEach(w=>{var U=this.commonService.myClone(w)??{};U.resultId=U.id,U.testStatus&&V.push(U)}),V}compareLengthWithExamQuestion(J,V){var w=this.commonService.myClone(J);if(V>0&&J.length<V)for(var U=0;U<V-J.length;U++)w.push("");return w}mergeStudentWithAvatar(J){var V=[];return J.forEach(w=>{var U=V.filter(_e=>_e.parentId==w.parentId);if(U&&0!=U.length)for(var de=0;de<V.length;de++)V[de].parentId==w.parentId&&(V[de].examResultObjs=V[de].examResultObjs?.concat(w.examResultObjs??[]));else V.push(w)}),V}createStudentWithResult(J,V,w,U,de,_e){return{id:J.id,userId:J.parentId,studentId:J.id,identificationNumber:V?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??J.identificationNumber??0,offlineMixQuestionHashId:V?.offlineMark?.rawOfflineMixquestionId??0,studentCode:V?.offlineMark?.studentCode??0,gender:J.gender,fullName:J.fullName,avatar:J.avatar,birthday:J.birthday,resultId:V?.hasOwnProperty("resultId")?V.resultId:0,answers:V?.hasOwnProperty("answers")?V.answers:null,rightAnswer:V?.hasOwnProperty("rightAnswer")?V.rightAnswer:0,totalQuestion:V?.hasOwnProperty("totalQuestion")?V.totalQuestion:0,mark:V?.hasOwnProperty("mark")?V?.mark:null,trueFalseMark:V?.hasOwnProperty("trueFalseMark")?V.trueFalseMark:null,essayMark:V?.hasOwnProperty("essayMark")?V.essayMark:null,files:V?.hasOwnProperty("files")?V.files:null,infors:V?.hasOwnProperty("infors")?V?.infors:null,confirmedAt:V?.hasOwnProperty("confirmedAt")?V?.confirmedAt:null,startedTest:V?.hasOwnProperty("startedTest")?V?.startedTest:null,createdAt:V?.hasOwnProperty("createdAt")?V.createdAt:null,totalExamResultObjs:J.examResultObjs.length,answeredQuestions:V?.hasOwnProperty("answeredQuestions")?V.answeredQuestions:[],groupPoints:this.getGroupPoints(V?.answeredQuestions?V?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:V?.examTrackObj?.exitFullScreen,blurCount:V?.examTrackObj?.blurWindow},status:w,nameImages:J.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion(V?.answerMixObjs??[],U)??[],testedTime:de+1,totalTestTime:_e,subjectMarkValues:V?.subjectMarks,isOffline:V?.isOffline??!1,countEssayQuestion:this.sAztExamResultListSortService._checkCounterEssayQuestionObjs(V?.hasOwnProperty("answeredQuestions")&&V?.answeredQuestions?V.answeredQuestions:[]),checkBoxGroupControl:new l.gE({isShow:new l.MJ(!1,{nonNullable:!0}),selectedCheckbox:new l.MJ(!1,{nonNullable:!0})}),questionTypeMarks:V?.questionTypeMarks??[],schoolName:J.schoolName??"",phone:J.phone??"",email:J.email??"",userName:J?.userName??""}}getGroupPoints(J){let V=[];return J.forEach(w=>{let U=!1;for(let de=0;de<V.length;de++)V[de].id==w.groupId&&(U=!0,V[de].point+=w.correct&&w.scorePerQuestion?w.scorePerQuestion:0);!U&&w.groupId&&V.push({id:w.groupId,point:w.correct&&w.scorePerQuestion?w.scorePerQuestion:0})}),V.sort((w,U)=>(w.id??0)-(U.id??0)),V}getMaxGroupId(J){let V=[];return J.forEach(w=>{w.id&&!this.commonService.isExistInArray(V,w.id)&&V.push(w.id)}),V.length}}return(q=D).\u0275fac=function(J){return new(J||q)(c.KVO(m.R),c.KVO(x.TE),c.KVO(C.p),c.KVO(re.r),c.KVO(y.z),c.KVO(oe.f),c.KVO(z.Z),c.KVO(O.w))},q.\u0275prov=c.jDH({token:q,factory:q.\u0275fac,providedIn:"root"}),D})()},32835:(yt,ke,v)=>{v.d(ke,{i:()=>d});var l=v(48891);let d=(()=>{var c;class m{processData(C){let re=[],y=[];if(C)for(var oe=0;oe<C.length;oe++)if("scroll"!=C[oe][0]){var z={index:C[oe][0],alpha:C[oe][1],key:C[oe][2],questionId:Number(C[oe][3]),second:Number(C[oe][4])};re.push(z)}else{var O={scrollPos:Number(C[oe][1]),second:Number(C[oe][2])};y.push(O)}return[re,y]}}return(c=m).\u0275fac=function(C){return new(C||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),m})()},97099:(yt,ke,v)=>{v.d(ke,{B:()=>Ie});var l=v(54460),d=v(10936),c=v(65162),m=v(53220),x=v(81275),C=v(15343),re=v(59055),y=v(44233),oe=v(5502),z=v(21656),O=v(70050),k=v(76407),q=v(91100),D=v(48891);let Ie=(()=>{var J;class V{}return(J=V).\u0275fac=function(U){return new(U||J)},J.\u0275mod=D.$C({type:J}),J.\u0275inj=D.G2t({imports:[l.MD,z.s,q.Q,O.L,d.YN,d.X1,oe.Id,m.h,c.iI,C.flO.pick(C.Ptg),x.rc,re.e,k.n,y.An]}),V})()},54479:(yt,ke,v)=>{v.d(ke,{t:()=>Ge});var l=v(73014),d=v(27691),c=v(48891),m=v(10936),x=v(59640),C=v(30657),re=v(64198),y=v(83229),oe=v(40949),z=v(35095),O=v(41426),k=v(51113),q=v(54460),D=v(47712),Ie=v(7919),J=v(81587),V=v(84278),w=v(34815),U=v(15343),de=v(58588),_e=v(76975);const le=["mnoteContainer"],ie=["aztMarkNote"],ze=K=>({display:K}),Te=K=>({border:K}),Qe=()=>({"mr-1 cursor-pointer":!0}),ve=K=>({"is-invalid":K});function nt(K,ce){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function at(K,ce){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function se(K,ce){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function ee(K,ce){if(1&K&&(c.j41(0,"div",19),c.DNE(1,nt,3,3,"span",10)(2,at,3,3,"span",10)(3,se,3,3,"span",10),c.k0s()),2&K){const me=c.XpG().index,G=c.XpG();c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+me].errors?null:G.form.controls["cau"+me].errors.min),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+me].errors?null:G.form.controls["cau"+me].errors.max),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+me].errors?null:G.form.controls["cau"+me].errors.pattern)}}function Be(K,ce){if(1&K){const me=c.RV6();c.j41(0,"div",12)(1,"div",13)(2,"lucide-icon",14),c.nI1(3,"mytranslate"),c.bIt("click",function(F){const S=c.eBV(me).index,j=c.XpG();return c.Njj(j.toggleVisibility(F,S))}),c.k0s(),c.j41(4,"span",15),c.EFF(5),c.nI1(6,"mytranslate"),c.j41(7,"span",16),c.nI1(8,"mytranslate"),c.EFF(9),c.nI1(10,"mytranslate"),c.k0s()(),c.nrm(11,"input",17),c.nI1(12,"mytranslate"),c.k0s(),c.DNE(13,ee,4,3,"div",18),c.k0s()}if(2&K){let me;const G=ce.$implicit,F=ce.index,S=c.XpG();c.Y8G("ngStyle",c.eq3(25,Te,F==S.questions.length-1?"none":"")),c.R7$(2),c.FS9("matTooltip",c.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),c.Y8G("ngClass",c.lJ4(27,Qe)),c.R7$(3),c.Lme(" ",c.bMT(6,17,"lang_auto_cau")," ",(null!==(me=G.indexLabel)&&void 0!==me?me:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",G.essMaxPoint," ",c.bMT(10,21,"lang_auto_diem_brackets"),""),c.R7$(2),c.FS9("placeholder",c.bMT(12,23,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",F,""),c.Y8G("readonly",!S.showForTeacher)("decimal",!0)("ngClass",c.eq3(28,ve,S.form.controls["cau"+F]&&S.form.controls["cau"+F].invalid)),c.R7$(2),c.Y8G("ngIf",S.form.controls["cau"+F].errors)}}function ge(K,ce){if(1&K){const me=c.RV6();c.j41(0,"div",20)(1,"button",21),c.bIt("click",function(){c.eBV(me);const F=c.XpG();return c.Njj(F.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&K){const me=c.XpG();c.R7$(),c.Y8G("disabled",me.isLoading||me.form.invalid||me.loadingDataCdn&&me.files.length>0),c.R7$(),c.SpI(" ",me.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}function X(K,ce){if(1&K&&c.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&K){let me;const G=c.XpG().$implicit,F=c.XpG();c.Y8G("follower",F.followerRenderQuest)("examObj",F.examObj)("examConfig",F.examConfig)("questionObj",G)("curQuestionIndex",null!==(me=G.indexLabel)&&void 0!==me?me:0)("userAnswersObj",F.userAnswersObj)("currentTab","essay_tab")}}function pe(K,ce){if(1&K&&c.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&K){let me;const G=c.XpG().$implicit,F=c.XpG();c.Y8G("follower",F.followerRenderQuest)("examObj",F.examObj)("questionObj",G)("curQuestionIndex",null!==(me=G.indexLabel)&&void 0!==me?me:0)("userAnswersObj",F.userAnswersObj)("orgExamObjs",F.orgExamObjs)("currentTab","essay_tab")}}function lt(K,ce){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Ee(K,ce){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function H(K,ce){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function xe(K,ce){if(1&K&&(c.j41(0,"div",19),c.DNE(1,lt,3,3,"span",10)(2,Ee,3,3,"span",10)(3,H,3,3,"span",10),c.k0s()),2&K){const me=c.XpG(2).index,G=c.XpG();c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+me].errors?null:G.form.controls["cau"+me].errors.min),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+me].errors?null:G.form.controls["cau"+me].errors.max),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+me].errors?null:G.form.controls["cau"+me].errors.pattern)}}function mt(K,ce){if(1&K&&(c.j41(0,"div",29)(1,"form",30)(2,"label",31),c.EFF(3),c.nI1(4,"mytranslate"),c.j41(5,"span",16),c.nI1(6,"mytranslate"),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.EFF(9," : "),c.k0s(),c.nrm(10,"input",32),c.nI1(11,"mytranslate"),c.DNE(12,xe,4,3,"div",18),c.k0s()()),2&K){let me;const G=c.XpG(),F=G.$implicit,S=G.index,j=c.XpG();c.R7$(),c.Y8G("formGroup",j.form),c.R7$(),c.FS9("for","cau_"+S),c.R7$(),c.Lme(" ",c.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(me=F.indexLabel)&&void 0!==me?me:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",F.essMaxPoint," ",c.bMT(8,19,"lang_auto_diem_brackets"),""),c.R7$(3),c.FS9("placeholder",c.bMT(11,21,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",S,""),c.Y8G("readonly",!j.showForTeacher)("ngClass",c.eq3(23,ve,j.form.controls["cau"+S]&&j.form.controls["cau"+S].invalid))("id","cau_"+S)("decimal",!0),c.R7$(2),c.Y8G("ngIf",j.form.controls["cau"+S].errors)}}function rt(K,ce){if(1&K&&(c.j41(0,"div",22)(1,"div",23),c.DNE(2,X,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,pe,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,mt,13,25,"div",26),c.k0s()()),2&K){const me=ce.index,G=c.XpG();c.R7$(),c.Mz_("id","q_",me,""),c.R7$(),c.Y8G("ngIf",!G.showForTeacher),c.R7$(),c.Y8G("ngIf",G.showForTeacher),c.R7$(),c.Y8G("ngIf",G.showForTeacher)}}function Et(K,ce){1&K&&(c.j41(0,"div",33)(1,"b"),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s(),c.EFF(4),c.nI1(5,"mytranslate"),c.k0s()),2&K&&(c.R7$(2),c.SpI("",c.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),c.R7$(2),c.SpI(" ",c.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Xe(K,ce){if(1&K){const me=c.RV6();c.j41(0,"azt-mark-note",35,1),c.bIt("doneLoadData",function(F){c.eBV(me);const S=c.XpG(2);return c.Njj(S.doneLoadData(F))}),c.k0s()}if(2&K){const me=c.XpG(2);c.Y8G("dataMarkNote",me.dataMarkNote)("screenType","exam")("modeView",me.showForTeacher?"teacher":"student")}}function pt(K,ce){if(1&K&&(c.qex(0),c.DNE(1,Xe,2,3,"azt-mark-note",34),c.bVm()),2&K){const me=c.XpG();c.R7$(),c.Y8G("ngIf",1===me.curSelectedTab||me.changeSelectedTab)}}function Ze(K,ce){if(1&K){const me=c.RV6();c.j41(0,"div",36)(1,"button",37),c.bIt("click",function(){c.eBV(me);const F=c.XpG();return c.Njj(F.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&K){const me=c.XpG();c.R7$(),c.Y8G("disabled",me.isLoading||me.form.invalid||me.loadingDataCdn&&me.files.length>0),c.R7$(),c.SpI(" ",me.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}let Ge=(()=>{var K;class ce extends x.H{getMaxPoint(G){var F=0;for(let S=0;S<this.questions.length;S++)if(this.questions[S].id==G){F=this.questions[S].scorePerQuestion??0;break}return F}toggleVisibility(G,F){var S=G.target,j=document.getElementById(`q_${F}`);j&&("block"==j?.style.display?(j.style.display="none",S&&(S.textContent="visibility_off")):(j.style.display="block",S&&(S.textContent="visibility")))}remark(G){for(const j in this.form.value)"string"==typeof this.form.value[j]&&this.form.value[j].includes(",")&&(this.form.value[j]=this.form.value[j].replace(",","."));let F=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var S={id:this.resultID,result:G,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(S,F).subscribe(j=>{1==j.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(j.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}initDataMarkNote(){if(this.examResultObj.result)this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId};else{for(let G=0;G<this.files.length;G++)this.files[G].url=this.cdnService.getMyCdn(this.files[G].url??"");this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)}}}saveDataMarkExercise(){var G=this;return(0,l.A)(function*(){let F=!1;for(const S in G.form.value)""!==G.form.value[S]&&(F=!0);if(F){for(const S in G.form.value)""===G.form.value[S]&&(G.form.value[S]=0,G.form.controls[S].setValue(0));if(G.isLoading=!0,G.files&&G.files.length>0){G.objectResult=G.MarkNote?.exportDataMarkNote();let S=!1;if(!G.objectResult.pages?.length&&G.files.find(j=>(0,re.nL)(j.mimes??"")||(0,re.rl)(j.mimes??"")))return void G.remark("");if(G.objectResult.pages?.length){for(let We=0;We<G.objectResult.pages.length;We++)if(G.objectResult.pages[We]&&G.objectResult.pages[We].draws?.length)for(let Le=0;Le<(G.objectResult.pages[We].draws?.length??0);Le++){let xt=G.objectResult.pages[We].draws?.[Le]??{};xt.src&&xt.src.includes("base64")&&(S=!0)}S&&(yield G.uploadDrawBase64ToCdn());const j=G.serializeJson(G.objectResult),Me=G.zipDataService.convertContentGzip(j),Ne=new Blob([Me],{type:"text/plain"}),Oe=new File([Ne],"txt",{type:"text/plain"});G.apiUploadService.uploadToCdnForHomework(Oe).subscribe(We=>{1==We.success?G.remark(G.serializeJson({urlDataMark:We.data?.url??"",version:"0.1"})):G.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai")})}}else G.remark("")}else G.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan")})()}uploadDrawBase64ToCdn(){return new Promise(G=>{let F=[];if(this.objectResult.pages){this.objectResult.pages.forEach(S=>{F.push(!1)});for(let S=0;S<this.objectResult.pages.length;S++)if(this.objectResult.pages[S]&&this.objectResult.pages[S].draws?.length)for(let j=0;j<(this.objectResult.pages[S].draws?.length??0);j++){let Me=this.objectResult.pages[S].draws?.[j]??{};if(Me.src&&Me.src.includes("base64")){F[S]=!0;let Ne=(0,y.q)(Me.src);this.apiUploadService.commonUploadForMarkResult(Ne,`essay_note_${S}_${j}_${this.resultID}.png`,"image/png").subscribe(Oe=>{Oe.type!=d.hv.UploadProgress&&(Me.src=Oe.data?.url,F[S]=!1),F.includes(!0)||G()})}}}})}doneLoadData(G){this.loadingDataCdn=!1}ngOnInit(){this.initDataMarkNote();var G={};let F;this.examResultObj.confirmedAt&&(F=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(j=>{let Me=this.getMaxPoint(j.id);this.totalMaxPoint+=Me,j.essMaxPoint=Me,this.maxPointPerQuestion.push(j.essMaxPoint)});for(let j=0;j<this.questions.length;j++){var S=`cau${j}`;G[S]=new m.MJ(F?F[S]:"",{validators:[m.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),m.k0.min(0),m.k0.max(this.questions[j].essMaxPoint??0)]})}this.form=new m.gE(G),this.form.valueChanges.subscribe(j=>{let Me=JSON.stringify(j);Me!=this.prevData&&(this.prevData=Me,this.form.patchValue(j))}),super.ngOnInit()}constructor(G,F,S,j){super(),this.cdnService=G,this.examResultService=F,this.apiUploadService=S,this.zipDataService=j,this.orgExamObjs=[],this.questions=[],this.files=[],this.resultID=0,this.userAnswersObj={},this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new c.bkB,this.followerRenderQuest=new C.e,this.form=new m.gE({}),this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.jsonData={},this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return(K=ce).\u0275fac=function(G){return new(G||K)(c.rXU(oe.B),c.rXU(z._),c.rXU(O.T),c.rXU(k.j))},K.\u0275cmp=c.VBU({type:K,selectors:[["azt-mark-essay-new"]],viewQuery:function(G,F){if(1&G&&(c.GBs(le,5),c.GBs(ie,5)),2&G){let S;c.mGM(S=c.lsd())&&(F.mnoteContainer=S.first),c.mGM(S=c.lsd())&&(F.MarkNote=S.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",resultID:"resultID",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},features:[c.Vt3],decls:11,vars:10,consts:[["mnoteContainer",""],["aztMarkNote",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"doneLoadData","dataMarkNote","screenType","modeView"],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(G,F){1&G&&(c.j41(0,"div",2)(1,"form",3),c.DNE(2,Be,14,30,"div",4),c.k0s(),c.DNE(3,ge,5,6,"div",5),c.k0s(),c.j41(4,"div",6),c.DNE(5,rt,5,5,"div",7),c.k0s(),c.DNE(6,Et,6,6,"div",8),c.j41(7,"div",9,0),c.DNE(9,pt,2,1,"ng-container",10),c.k0s(),c.DNE(10,Ze,5,6,"div",11)),2&G&&(c.R7$(),c.Y8G("formGroup",F.form),c.R7$(),c.Y8G("ngForOf",F.questions),c.R7$(),c.Y8G("ngIf",F.showForTeacher),c.R7$(2),c.Y8G("ngForOf",F.questions),c.R7$(),c.Y8G("ngIf",F.files&&0==F.files.length),c.R7$(),c.Y8G("ngStyle",c.eq3(8,ze,F.files&&0==F.files.length?"none":"block")),c.R7$(2),c.Y8G("ngIf",F.dataMarkNote&&F.dataMarkNote.answer_obj&&F.files&&F.files.length>0),c.R7$(),c.Y8G("ngIf",F.showForTeacher))},dependencies:[q.YU,q.Sq,q.bT,q.B3,D.oV,Ie.Z,J.t,V.x,w.o,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,U.WGl,de.i,_e.wp],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:#2361ae2e;border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ce})()},94315:(yt,ke,v)=>{v.d(ke,{eX:()=>q});class l{constructor(){this.x=0,this.y=0}toBase64String(){return(new J).writeCvPoint2u(this).toBase64String()}}class d{constructor(){this.x=0,this.y=0}toBase64String(){return(new J).writeCvPoint2f(this).toBase64String()}}class c{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new J).writeCvRect2f(this).toBase64String()}}class m{constructor(){this.center=new d,this.filled=!1}toBase64String(){return(new J).writeAnswerCircle(this).toBase64String()}}class x{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new J).writeTableAnswer(this).toBase64String()}}class C{constructor(){this.top=new d,this.left=new d,this.bottom=new d,this.right=new d}toBase64String(){return(new J).writeResultRect(this).toBase64String()}}class re{constructor(){this.id=0,this.region=new c}toBase64String(){return(new J).writeCropRegion(this).toBase64String()}}class y{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new C,this.studentId=new x,this.examId=new x,this.answerTable=new x,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new J).writeResultOutput(this).toBase64String()}}class oe{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new J).writeAnswerSheetInput(this).toBase64String()}}class z{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new J).writeSmallAnswerCircle(this).toBase64String()}}class O{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new J).writeSmallTableAnswer(this).toBase64String()}}class k{constructor(){this.studentId=new O,this.examId=new O,this.answerTable=new O}toBase64String(){return(new J).writeDrawData(this).toBase64String()}}class q{constructor(w){this.bytes=w,this.cursor=0,this.length=w.byteLength}updateCursor(w){if(this.cursor=this.cursor+w,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let w=this.bytes[this.cursor];return this.updateCursor(1),w}parseInt(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(w).getInt32(0)}parseDouble(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(w).getFloat64(0,!0)}parseString(){let w=new TextDecoder("utf-8"),U=this.cursor,de=this.bytes[this.cursor];for(;0!=de;)this.updateCursor(1),de=this.bytes[this.cursor];let _e=this.bytes.slice(U,this.cursor),le=w.decode(_e);return this.updateCursor(1),le}parseBool(){let w=this.bytes[this.cursor];return this.updateCursor(1),w>0}parseCvPoint2u(){let w=new l;return w.x=this.parseUchar(),w.y=this.parseUchar(),w}parseCvPoint2f(){let w=new d;return w.x=this.parseDouble(),w.y=this.parseDouble(),w}parseCvRect2f(){let w=new c;return w.x=this.parseDouble(),w.y=this.parseDouble(),w.width=this.parseDouble(),w.height=this.parseDouble(),w}parseAnswerCircle(){let w=new m;return w.center=this.parseCvPoint2f(),w.filled=this.parseBool(),w}parseTableAnswer(){let w=new x,U=0;w.rows=this.parseInt(),w.cols=this.parseInt(),w.radius=this.parseInt(),U=this.parseInt();for(let de=0;de<U;de++)w.answers.push(this.parseAnswerCircle());return w}parseResultRect(){let w=new C;return w.top=this.parseCvPoint2f(),w.left=this.parseCvPoint2f(),w.bottom=this.parseCvPoint2f(),w.right=this.parseCvPoint2f(),w}parseCropRegion(){let w=new re;return w.id=this.parseInt(),w.region=this.parseCvRect2f(),w}parseResultOutput(){let w=new y,U=0;w.type=this.parseInt(),w.errorCode=this.parseInt(),w.paperCorner=this.parseResultRect(),w.studentId=this.parseTableAnswer(),w.examId=this.parseTableAnswer(),w.answerTable=this.parseTableAnswer(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w.imageSize=this.parseInt(),U=this.parseInt();for(let de=0;de<U;de++)w.cropRegion.push(this.parseCropRegion());return w}parseAnswerSheetInput(){let w=new oe;return w.templateType=this.parseInt(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w}parseSmallAnswerCircle(){let w=new z;return w.position=this.parseUchar(),w.x=this.parseUchar(),w.y=this.parseUchar(),w.filledCols=this.parseUchar(),w.rows=this.parseUchar(),w}parseSmallTableAnswer(){let w=new O,U=0;w.rows=this.parseUchar(),w.cols=this.parseUchar(),w.radius=this.parseUchar(),U=this.parseInt();for(let de=0;de<U;de++)w.answers.push(this.parseSmallAnswerCircle());return w}parseDrawData(){let w=new k;return w.studentId=this.parseSmallTableAnswer(),w.examId=this.parseSmallTableAnswer(),w.answerTable=this.parseSmallTableAnswer(),w}}const D=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class J{constructor(){this.bytes=[]}writeUchar(w){return this.bytes.push(w),this}writeUint8Array(w){for(let U=0;U<w.length;U++)this.bytes.push(w[U]);return this}writeArrayBuffer(w){let U=new Uint8Array(w);return this.writeUint8Array(U),this}writeInt(w){let U=new ArrayBuffer(4);return new DataView(U).setUint32(0,w,!1),this.writeArrayBuffer(U),this}writeDouble(w){let U=new ArrayBuffer(8);return new DataView(U).setFloat64(0,w,!0),this.writeArrayBuffer(U),this}writeString(w){let de=(new TextEncoder).encode(w);return this.writeUint8Array(de),this.writeUchar(0),this}writeBool(w){return this.writeUchar(w?1:0),this}toBase64String(){return function Ie(V){let U,w="",de=V.length;for(U=2;U<de;U+=3)w+=D[V[U-2]>>2],w+=D[(3&V[U-2])<<4|V[U-1]>>4],w+=D[(15&V[U-1])<<2|V[U]>>6],w+=D[63&V[U]];return U===de+1&&(w+=D[V[U-2]>>2],w+=D[(3&V[U-2])<<4],w+="=="),U===de&&(w+=D[V[U-2]>>2],w+=D[(3&V[U-2])<<4|V[U-1]>>4],w+=D[(15&V[U-1])<<2],w+="="),w}(new Uint8Array(this.bytes))}writeCvPoint2u(w){return this.writeUchar(w.x),this.writeUchar(w.y),this}writeCvPoint2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this}writeCvRect2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this.writeDouble(w.width),this.writeDouble(w.height),this}writeAnswerCircle(w){return this.writeCvPoint2f(w.center),this.writeBool(w.filled),this}writeTableAnswer(w){this.writeInt(w.rows),this.writeInt(w.cols),this.writeInt(w.radius),this.writeInt(w.answers.length);for(let U of w.answers)this.writeAnswerCircle(U);return this}writeResultRect(w){return this.writeCvPoint2f(w.top),this.writeCvPoint2f(w.left),this.writeCvPoint2f(w.bottom),this.writeCvPoint2f(w.right),this}writeCropRegion(w){return this.writeInt(w.id),this.writeCvRect2f(w.region),this}writeResultOutput(w){this.writeInt(w.type),this.writeInt(w.errorCode),this.writeResultRect(w.paperCorner),this.writeTableAnswer(w.studentId),this.writeTableAnswer(w.examId),this.writeTableAnswer(w.answerTable),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this.writeInt(w.imageSize),this.writeInt(w.cropRegion.length);for(let U of w.cropRegion)this.writeCropRegion(U);return this}writeAnswerSheetInput(w){return this.writeInt(w.templateType),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this}writeSmallAnswerCircle(w){return this.writeUchar(w.position),this.writeUchar(w.x),this.writeUchar(w.y),this.writeUchar(w.filledCols),this.writeUchar(w.rows),this}writeSmallTableAnswer(w){this.writeUchar(w.rows),this.writeUchar(w.cols),this.writeUchar(w.radius),this.writeInt(w.answers.length);for(let U of w.answers)this.writeSmallAnswerCircle(U);return this}writeDrawData(w){return this.writeSmallTableAnswer(w.studentId),this.writeSmallTableAnswer(w.examId),this.writeSmallTableAnswer(w.answerTable),this}}},72267:(yt,ke,v)=>{v.d(ke,{E:()=>x});var l=v(48891),d=v(62095),c=v(51113),m=v(99927);let x=(()=>{var C;class re{addIndexLabelToQuestionObjs(oe){for(let z=0;z<(oe?.length??0);z++)oe?.[z]&&(oe[z].indexLabel=z);return oe}getEssayQuestionObjs(oe){let z=[];for(let O=0;O<(oe?.length??0);O++)this.answerTypeService.isEssayAnswer(oe?.[O])&&oe?.[O]&&z.push(oe[O]);return z}getTrueFalseQuestionObjs(oe){let z=[];for(let O=0;O<(oe?.length??0);O++)(this.answerTypeService.isOneChoiceAnswer(oe?.[O])||this.answerTypeService.isTrueFalseAnswer(oe?.[O])||this.answerTypeService.isFillAnswer(oe?.[O]))&&oe?.[O]&&z.push(oe[O]);return z}convertAnswersArr(oe){let z={};return 0!=oe.length&&oe.forEach(O=>{let k=!!O.AnswerContent?.filter(q=>q.Status)?.length;O.AnswerContent&&O.AnswerContent.length&&(z[`id_${O.QuestionId}`]=k?[...O.AnswerContent]:O.AnswerContent[0].Content)}),z}mapStudentObjWithTestedObj(oe,z,O){var k=this.commonService.castObj(oe?.studentObj),q=z?.filter(D=>D.userId==O?.parentId);return k&&q&&q.length>0&&(k={...k,offlineMarkObj:q[0].offlineMarkObj,nameImage:q[0].nameImage??""}),O=k}mapStudentObjWithTestedObjForFrontendStudent(oe,z,O){var k=this.commonService.castObj(oe?.studentObj),q=z?.filter(D=>D.userId==O?.parentId);return k&&q&&q.length>0&&(k={...k,offlineMarkObj:q[0].offlineMarkObj,nameImage:q[0].nameImage??""}),O=k}constructor(oe,z,O){this.commonService=oe,this.zipDataService=z,this.answerTypeService=O}}return(C=re).\u0275fac=function(oe){return new(oe||C)(l.KVO(d.R),l.KVO(c.j),l.KVO(m._))},C.\u0275prov=l.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),re})()},57332:(yt,ke,v)=>{v.d(ke,{V:()=>le});var l=v(89163),d=v(33887),c=v(48891),m=v(2145),x=v(54460),C=v(68323),re=v(90796),y=v(52811),oe=v(15343),z=v(76975);const O=()=>({"mr-2 text-danger flex-none":!0});function k(ie,ze){1&ie&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ie&&(c.R7$(),c.JRh(c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_this_exam_result")))}function q(ie,ze){1&ie&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ie&&(c.R7$(),c.SpI("",c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_multiple_exam_result"),":"))}function D(ie,ze){if(1&ie&&(c.j41(0,"div",8),c.nrm(1,"lucide-icon",9),c.j41(2,"div"),c.DNE(3,k,3,3,"span",10)(4,q,3,3,"span",10),c.k0s()()),2&ie){const Te=c.XpG();c.R7$(),c.Y8G("ngClass",c.lJ4(3,O)),c.R7$(2),c.Y8G("ngIf",1==Te.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",Te.data.examResultIds.length>1)}}function Ie(ie,ze){if(1&ie&&(c.j41(0,"div",21)(1,"span",22),c.EFF(2),c.k0s()()),2&ie){const Te=c.XpG().$implicit;c.R7$(2),c.JRh(Te.fullName)}}function J(ie,ze){if(1&ie&&c.nrm(0,"img",23),2&ie){const Te=c.XpG().$implicit;c.Y8G("nameImages",Te.nameImages)}}function V(ie,ze){if(1&ie&&(c.j41(0,"div",14)(1,"div",15)(2,"div",16),c.nrm(3,"azt-create-avatar",17),c.k0s(),c.j41(4,"div",18),c.DNE(5,Ie,3,1,"div",19)(6,J,1,1,"img",20),c.k0s()()()),2&ie){let Te;const Qe=ze.$implicit,ve=c.XpG(2);c.R7$(3),c.Y8G("linkAvatar",null!==(Te=Qe.avatar)&&void 0!==Te?Te:"")("nameCreateAvatar",Qe.fullName)("size",32),c.R7$(2),c.Y8G("ngIf",!Qe.nameImages||ve.commonService.convertStringToNumber(Qe.id)>0),c.R7$(),c.Y8G("ngIf",Qe.nameImages&&ve.commonService.convertStringToNumber(Qe.studentId)<=0)}}function w(ie,ze){if(1&ie&&(c.j41(0,"div",12),c.DNE(1,V,7,5,"div",13),c.k0s()),2&ie){const Te=c.XpG();c.R7$(),c.Y8G("ngForOf",Te.data.examResults)}}function U(ie,ze){1&ie&&(c.j41(0,"div",8)(1,"div",24)(2,"button",25)(3,"div",26),c.nrm(4,"lucide-icon",27),c.k0s()(),c.j41(5,"div",28),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s()()()),2&ie&&(c.R7$(6),c.JRh(c.bMT(7,1,"lang_testbank_are_you_sure_to_delete_no_exam_result")))}function de(ie,ze){1&ie&&(c.j41(0,"span",31),c.nrm(1,"azt-loading-ui"),c.k0s())}function _e(ie,ze){if(1&ie){const Te=c.RV6();c.j41(0,"button",29),c.bIt("click",function(){c.eBV(Te);const ve=c.XpG();return c.Njj(ve.confirmDelete())}),c.DNE(1,de,2,0,"span",30),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s()}if(2&ie){const Te=c.XpG();c.Y8G("disabled",Te.statusObj.loading),c.R7$(),c.Y8G("ngIf",Te.statusObj.loading),c.R7$(),c.SpI(" ",c.bMT(3,3,"lang_cms_common_confirm_btn")," ")}}let le=(()=>{var ie;class ze extends d._{confirmDelete(){this.initStatusObj(),this.waitDestroy(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjsPost({examHashId:this.examHashId,examResultIds:this.examResultIds}).subscribe(Qe=>{1==Qe.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(Qe.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(Qe,ve,nt){super(nt,ve),this.offlineExamResultService=Qe,this.dialogRef=ve,this.examHashId="",this.examResultIds=[],this.examHashId=nt.examHashId,this.examResultIds=nt.examResultIds}}return(ie=ze).\u0275fac=function(Qe){return new(Qe||ie)(c.rXU(m.Fs),c.rXU(l.CP,8),c.rXU(l.Vh,8))},ie.\u0275cmp=c.VBU({type:ie,selectors:[["coazt-delete-offline-exam-result-dialog"]],features:[c.Vt3],decls:11,vars:7,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],["class","text-md flex",4,"ngIf"],["class","grid grid-cols-12 gap-3","style","overflow-y: auto; max-height: calc(100vh - 150px)",4,"ngIf"],[1,"p-3","flex","justify-end"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor","class","btn w-32 btn-danger",3,"disabled","click",4,"ngIf"],[1,"text-md","flex"],["name","trash-2","size","24",3,"ngClass"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"grid","grid-cols-12","gap-3",2,"overflow-y","auto","max-height","calc(100vh - 150px)"],["class","col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"flex","items-center","p-3","student-exam-result-up","w-full"],[1,"w-8","h-8","image-fit","lg:mr-1"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"ml-2","text-left","mt-0",2,"width","calc(100% - 3.5rem)"],["class","azt-student-name flex items-center","style","flex-wrap: wrap",4,"ngIf"],["appDrawNameImage","","class","mb-1 img-name-fluid",3,"nameImages",4,"ngIf"],[1,"azt-student-name","flex","items-center",2,"flex-wrap","wrap"],[1,"font-medium","mr-2"],["appDrawNameImage","",1,"mb-1","img-name-fluid",3,"nameImages"],[1,"mx-auto","text-center"],[1,"btn","btn-sm","btn-primary-soft","p-1"],[1,"w-6","h-6"],["name","circle-x","size","24"],[1,"mt-4"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"click","disabled"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(Qe,ve){1&Qe&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2),c.DNE(3,D,5,4,"div",3)(4,w,2,1,"div",4)(5,U,8,3,"div",3),c.k0s()(),c.j41(6,"div",5)(7,"button",6),c.bIt("click",function(){return ve.btnCloseDialog()}),c.EFF(8),c.nI1(9,"mytranslate"),c.k0s(),c.DNE(10,_e,4,5,"button",7),c.k0s()()),2&Qe&&(c.R7$(3),c.Y8G("ngIf",ve.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",ve.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",!ve.data.examResultIds.length),c.R7$(3),c.SpI(" ",c.bMT(9,5,"lang_cms_common_close_btn")," "),c.R7$(2),c.Y8G("ngIf",ve.data.examResultIds.length))},dependencies:[x.YU,x.Sq,x.bT,C.p,re.y,y.R,oe.WGl,z.wp],encapsulation:2}),ze})()},92801:(yt,ke,v)=>{v.d(ke,{$:()=>w});var l=v(89163),d=v(33887),c=v(48891),m=v(54460),x=v(47426),C=v(95670),re=v(43404),y=v(4375),oe=v(47712),z=v(76975);function O(U,de){if(1&U&&(c.j41(0,"div")(1,"div",10)(2,"div",11),c.EFF(3),c.k0s(),c.nrm(4,"input",12),c.k0s()()),2&U){const _e=c.XpG().$implicit;c.R7$(3),c.SpI(" ",_e.title," "),c.R7$(),c.FS9("value",_e.contents[0]),c.Y8G("disabled",!0)}}function k(U,de){if(1&U&&(c.j41(0,"div",17)(1,"span",18),c.EFF(2),c.k0s()()),2&U){const _e=de.$implicit;c.R7$(),c.FS9("matTooltip",_e),c.R7$(),c.JRh(_e)}}function q(U,de){if(1&U&&(c.j41(0,"div")(1,"div",13)(2,"span",14),c.EFF(3),c.k0s()(),c.j41(4,"div",15),c.DNE(5,k,3,2,"div",16),c.k0s()()),2&U){const _e=c.XpG().$implicit;c.R7$(3),c.JRh(_e.title),c.R7$(2),c.Y8G("ngForOf",_e.contents)}}function D(U,de){if(1&U&&(c.j41(0,"mat-radio-button",21)(1,"span",18),c.EFF(2),c.k0s()()),2&U){const _e=de.$implicit;c.Y8G("checked",!0)("disabled",!0),c.R7$(),c.FS9("matTooltip",_e),c.R7$(),c.JRh(_e)}}function Ie(U,de){if(1&U&&(c.j41(0,"div")(1,"div",13)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"mat-radio-group",15),c.DNE(5,D,3,4,"mat-radio-button",20),c.k0s()()),2&U){const _e=c.XpG().$implicit;c.R7$(3),c.JRh(_e.title),c.R7$(2),c.Y8G("ngForOf",_e.contents)}}function J(U,de){if(1&U){const _e=c.RV6();c.j41(0,"div")(1,"div",10)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"div",22)(5,"mat-form-field",23)(6,"mat-select",24),c.mxI("valueChange",function(ie){c.eBV(_e);const ze=c.XpG().$implicit;return c.DH7(ze.contents[0],ie)||(ze.contents[0]=ie),c.Njj(ie)}),c.j41(7,"mat-option",25),c.EFF(8),c.k0s()()()()()}if(2&U){const _e=c.XpG().$implicit;c.R7$(3),c.JRh(_e.title),c.R7$(3),c.R50("value",_e.contents[0]),c.Y8G("disabled",!0),c.R7$(),c.FS9("value",_e.contents[0]),c.R7$(),c.JRh(_e.contents[0])}}function V(U,de){if(1&U&&(c.qex(0,8),c.DNE(1,O,5,3,"div",9)(2,q,6,2,"div",9)(3,Ie,6,2,"div",9)(4,J,9,5,"div",9),c.bVm()),2&U){const _e=de.$implicit;c.R7$(),c.Y8G("ngIf",0==_e.type),c.R7$(),c.Y8G("ngIf",1==_e.type),c.R7$(),c.Y8G("ngIf",2==_e.type),c.R7$(),c.Y8G("ngIf",3==_e.type)}}let w=(()=>{var U;class de extends d._{constructor(le,ie){super(ie,le),this.dialogRef=le,this.data=ie}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return(U=de).\u0275fac=function(le){return new(le||U)(c.rXU(l.CP,8),c.rXU(l.Vh))},U.\u0275cmp=c.VBU({type:U,selectors:[["app-result-info-dialog"]],features:[c.Vt3],decls:12,vars:7,consts:[[1,"box","result-info-dialog"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"valueChange","value","disabled"],[2,"color","#1e293c",3,"value"]],template:function(le,ie){1&le&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s()(),c.DNE(7,V,5,4,"ng-container",5),c.k0s()(),c.j41(8,"div",6)(9,"button",7),c.bIt("click",function(){return ie.btnCloseDialog()}),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()),2&le&&(c.R7$(5),c.SpI(" ",c.bMT(6,3,"lang_testbank_test_config_verify_profile_student")," "),c.R7$(2),c.Y8G("ngForOf",ie.data),c.R7$(3),c.SpI(" ",c.bMT(11,5,"lang_auto_dong")," "))},dependencies:[m.Sq,m.bT,x.wT,C.rl,re.VT,re._g,y.VO,oe.oV,z.wp],encapsulation:2}),de})()},43726:(yt,ke,v)=>{v.d(ke,{U:()=>K});var l=v(59640),d=v(53043),c=v(57332),m=v(73014),x=v(89163),C=v(33887),re=v(43234),y=v(48891),oe=v(36484),z=v(74225),O=v(94315),k=v(62095),q=v(51113),D=v(99927),Ie=v(40949);const V=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let w=(()=>{var ce;class me{constructor(F,S,j,Me){this.commonService=F,this.zipDataService=S,this.sAztAnswerTypeService=j,this.cdnService=Me,this.totalPointExam=0}drawAzotaFileToCanvas(F,S,j,Me){return new Promise((Ne,Oe)=>{var We="",Le=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(F.images??""));Le&&Le.url&&Le.url.includes(".azt")?this.httpGetAsync(this.cdnService.getMyCdn(Le.url)).then(xt=>{xt&&xt.length>0?z.decodeScanOfflineFile(xt).then(Re=>{let fe=this._arrayBufferToBase64(Re.getWrappedImage()??new Uint8Array),Ue=Re.getWrappedImageExtension(),E=Re.scanOfflineData?.scanResult;if(fe){let L=new Image;L.src="data:image/"+Ue+";base64,"+fe,L.crossOrigin="anonymous",L.onload=()=>{var W=document.createElement("canvas");W.width=L.width,W.height=L.height;const $=W.getContext("2d");$?.drawImage(L,0,0,W.width,W.height);let we=F.resultsData?.answerObjs??[];if(E?.examCodeRegion?.circles&&E?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.examCodeRegion?.circles,$),E?.studentCodeRegion?.circles&&E?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.studentCodeRegion?.circles,$),E?.answerRegion?.circles&&E?.answerRegion?.circles.length>0&&this.drawCircles(E?.answerRegion?.circles,$,we,1,j?.filter(ue=>this.sAztAnswerTypeService.isOneChoiceAnswer(ue))),E?.answerRegion?.trueFalseCircles&&E?.answerRegion?.trueFalseCircles.length>0&&this.drawCircles(E?.answerRegion?.trueFalseCircles,$,we,5,j?.filter(ue=>this.sAztAnswerTypeService.isTrueFalseAnswer(ue))),E?.answerRegion?.fillBlankCircles&&E?.answerRegion?.fillBlankCircles.length>0&&this.drawCircles(E?.answerRegion?.fillBlankCircles,$,we,4,j?.filter(ue=>this.sAztAnswerTypeService.isFillAnswer(ue))),E?.answerRegion?.essayCircles&&E?.answerRegion?.essayCircles.length>0&&S&&this.drawCommonCircles(E?.answerRegion?.essayCircles,$),E?.answerRegion?.handwrittenAnswers&&E?.answerRegion?.handwrittenAnswers.length>0){let ue=E?.answerRegion?.handwrittenAnswers,Z="18px";if($){$.fillStyle="#00ff00",$.font=Z+" Comic Sans MS",$.textAlign="center";for(let Ce=0;Ce<ue.length;Ce++){let be=ue[Ce];this.fillTextAnswerDrawForFileAzt(be.recognizedText??"",$,we[Ce],((be.bottomRight.x??0)+(be.topLeft.x??0))/2-3,((be.bottomRight.y??0)+(be.topLeft.y??0))/2+5)}}}$&&$.fillText((this.commonService.myTranslateInstant("lang_auto_tong")??"T\u1ed5ng")+" = "+this.totalPointExam.toFixed(2),25,125),We=W.toDataURL("image/jpeg",.9),Ne({imgUrl:We,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}}else Ne({imgUrl:We,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}):Ne({imgUrl:We,studentCode:0,subExamCode:0})}).catch(xt=>{Oe(xt)}):Ne({imgUrl:We,studentCode:0,subExamCode:0})})}drawScanFileToCanvas(F){return new Promise(S=>{var j="",Me=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(F.images??""));let Ne=Me?this.cdnService.getMyCdn(Me.url):"";if(Me&&Ne){let Oe=new Image;Oe.src=Ne,Oe.crossOrigin="anonymous",Oe.onload=()=>{var We=document.createElement("canvas");We.width=Oe.width,We.height=Oe.height;const Le=We.getContext("2d");Le?.drawImage(Oe,0,0,We.width,We.height);var xt=F.resultsData?.answerObjs??[],Re=this.commonService.willDeleteParseJson(F.resultsData?.pos??"");if("2.0"==Re.version)try{let St=Uint8Array.from(atob(Re.resultFilledPos),An=>An.charCodeAt(0)),Ot=new O.eX(St).parseDrawData(),qt=Ot.studentId?.answers??[];for(var fe=0;fe<qt.length;fe++)this.tickStudentIdAndExamId(qt[fe],Le,Ot.answerTable?.radius??0);let Ht=Ot.examId?.answers??[];for(fe=0;fe<Ht.length;fe++)this.tickStudentIdAndExamId(Ht[fe],Le,Ot.answerTable?.radius??0);let Wt=Ot.answerTable?.answers??[];for(fe=0;fe<Wt.length;fe++)this.answerPaintedRightOrWrong(Wt[fe],Le,Ot.answerTable?.radius??0,xt);j=We.toDataURL("image/jpeg",.9),S(j)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),S("")}else if("3.0"==Re.version)try{let St=Re.answersHandwritten??[],Ot=(St[0].answerRegion.height??0)-20+"px";if(Le){Le.fillStyle="#00ff00",Le.font=Ot+" Comic Sans MS",Le.textAlign="center";for(let Ht=0;Ht<St.length;Ht++){let Wt=St[Ht],Cn=this.getTextAnswerDraw(V[-1==Wt.answer?26:Wt.answer],Le,xt[Ht]);Le.fillText(Cn,(Wt.answerRegion.x??0)+(Wt.answerRegion.width??0)/2,(Wt.answerRegion.y??0)+(Wt.answerRegion.height??0)/2+5)}}j=We.toDataURL("image/jpeg",.9),S(j)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),S("")}else{var Ue=Re.configurationPos.split("_"),E=Re.resultFilledPos.split("_"),L=Re.tableAnchorPos.split("_"),W=this.checkWrongOrTrueAnswer(xt),$=0;for(fe=0;fe<Ue.length;fe++)if(1==fe||2==fe){var we=Ue[fe].split("*");$+=parseInt(we[1],10)}var ue=0;for(fe=0;fe<L.length;fe++)if(fe>=2){var Z={},Fe={},Ce=L[fe].split("*"),be=Ce[0].split(":"),$e=Ce[1].split(":"),Ye={},Ke=Ue[fe].split("*");Ye.row=parseInt(Ke[0],10),Ye.col=parseInt(Ke[1],10),Ye.radius=parseInt(Ke[2],10),Z.x=parseInt(be[0],10),Z.y=parseInt(be[1],10),Fe.x=parseInt($e[0],10),Fe.y=parseInt($e[1],10);for(var Je=(Fe.y-Z.y)/(Ye.row+1),R=Z.y,it=0;it<Ye.row;it++)if((R+=Je)>Z.y&&R<Fe.y){var tt=ue<xt.length?this.checkAnswerStudentRight(ue,xt):0;ue++,0!=tt&&Le&&(Le.beginPath(),Le.arc(Z.x+Je*tt,R,Ye.radius,0,2*Math.PI,!1),Le.lineWidth=3,Le.strokeStyle="#f3c12c",Le.stroke())}}var ct=0;for(it=0;it<E.length;it++)if("empty"!=E[it]){var ot=E[it].split(":"),dt={x:parseInt(ot[0],10),y:parseInt(ot[1],10),line:parseInt(ot[2],10)};it<$+W.length&&(it>=$?(Le&&(Le.beginPath(),Le.arc(dt.x,dt.y,dt.line,0,2*Math.PI,!1),Le.lineWidth=3,Le.strokeStyle=W[ct],Le.stroke()),ct++):Le&&(Le.beginPath(),Le.arc(dt.x,dt.y,dt.line,0,2*Math.PI,!1),Le.lineWidth=3,Le.strokeStyle="#00ff00",Le.stroke()))}j=We.toDataURL("image/jpeg",.9),S(j)}}}else S("")})}_arrayBufferToBase64(F){for(var S="",j=new Uint8Array(F),Me=j.byteLength,Ne=0;Ne<Me;Ne++)S+=String.fromCharCode(j[Ne]);return window.btoa(S)}httpGetAsync(F){return new Promise((S,j)=>{try{const Me=new XMLHttpRequest;Me.open("GET",F,!0),Me.responseType="arraybuffer",Me.onload=Ne=>{if(200===Me.status||304===Me.status){const Oe=Me.response;if(Oe){const We=new Uint8Array(Oe);S(We)}else S(new Uint8Array)}else S(new Uint8Array)},Me.onerror=Ne=>{j(new Error("lang_core_cant_loading_url"))},Me.send(null)}catch(Me){j(Me)}})}fillTextAnswerDrawForFileAzt(F,S,j,Me,Ne){let Oe="";j&&(F?j.rightAnswer&&"ESSAY"!=j.content&&j.rightAnswer!=F?(S.fillStyle="#f3c12c",S.fillText("["+j.rightAnswer+"]",Me+15,Ne),S.fillStyle="red",Oe=F+"-",Me-=10):j.rightAnswer&&"ESSAY"!=j.content?(S.fillStyle="#00ff00",Oe+=F):(S.fillStyle="red",Oe+=F):(S.fillStyle="#f3c12c",Oe+=j.rightAnswer)),S.fillText(Oe,Me,Ne)}drawCommonCircles(F,S){F.length>0&&F.forEach(j=>{if(j.filled){let Me=j.center.x,Ne=j.center.y;S&&(S.beginPath(),S.arc(Me,Ne,j.radius+1,0,2*Math.PI,!1),S.lineWidth=2,S.strokeStyle="#00ff00",S.stroke())}})}drawCircles(F,S,j,Me,Ne){let Oe=[],We=[],Le=["A","B","C","D"],xt=0;if(j.length>0){let E=j.filter($=>1==$.answerType||2==$.answerType).length??0,L=j.filter($=>5==$.answerType).length??0,W=j.filter($=>4==$.answerType).length??0;xt=1==Me?E:4==Me?W:L;for(let $=0;$<j.length;$++){let we="";if(this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:j[$].answerType})){let ue=j[$].rightAnswer?.split("|")??[];for(let Z=0;Z<Le.length;Z++)we=$+1-E+""+Le[Z]+"F",ue.includes(Le[Z])&&(we=$+1-E+""+Le[Z]+"T"),this.commonService.isExistInArray(Oe,we)||Oe.push(we)}else this.sAztAnswerTypeService.isFillAnswer({answerType:j[$].answerType})?(we=$+1-E-L+"_"+j[$].rightAnswer,this.commonService.isExistInArray(Oe,we)||Oe.push(we)):this.sAztAnswerTypeService.isOneChoiceAnswer({answerType:j[$].answerType})&&(we=$+1+""+j[$].rightAnswer,this.commonService.isExistInArray(Oe,we)||Oe.push(we));this.sAztAnswerTypeService.isEssayAnswer({answerType:j[$].answerType})&&We.push($+1)}}let Ue=1==Me?1:5==Me?2:4==Me?3:1;if(S){S.fillStyle="#ff0024",S.font="25px Comic Sans MS";let E=0,L=0,W=0,$="P"+Ue+": ",we=!1;(Ne??[]).forEach(ue=>{let Z=j.find(Fe=>ue.id==Fe.questionId);if((this.sAztAnswerTypeService.isOneChoiceAnswer(ue)||this.sAztAnswerTypeService.isFillAnswer(ue))&&(E++,Z?.isRight&&(L+=ue.testedScore??0,W++)),this.sAztAnswerTypeService.isTrueFalseAnswer(ue)){L+=ue.testedScore??0;let Fe=0,Ce="";for(let be=0;be<4;be++)Z?.rightAnswers?.includes(V[be])?Ce+="T":Ce+="F";if(Z?.content)for(let be=0;be<4;be++)Z.content[be]==Ce[be]&&Fe++;we=!0,$+=" "+Fe+"/4;"}}),this.totalPointExam+=L,$+=we?" = "+L.toFixed(2):W+"/"+E+" = "+L.toFixed(2),S.fillText($,25,25+25*Ue)}F.forEach(E=>{let L=0;L=this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:Me})?Number(E.label.substring(0,E.label.length-2)):this.sAztAnswerTypeService.isFillAnswer({answerType:Me})?Number(E.label.substring(0,E.label.indexOf("_"))):Number(E.label.substring(0,E.label.length-1));let W="";if(0==Oe.length)W="#00ff00";else if(this.sAztAnswerTypeService.isFillAnswer({answerType:Me})){let $=E.label.substring(0,E.label.indexOf("_")+1),we=Oe.find(ue=>ue.includes($));if(we){let ue=we?.split("_"),Z=E.label.split("_");if(E.filled&&(W="red"),ue[0]==Z[0])if("-"==Z[2]&&ue[1].includes("-"))0==Number(Z[1])&&(W=E.filled?"#00ff00":"#f3c12c");else if(","==Z[2]&&ue[1].includes(",")){let Fe=ue[1].indexOf(",");Number(Z[1])==Fe&&(W=E.filled?"#00ff00":"#f3c12c")}else"-"!=Z[2]&&","!=Z[2]&&ue[1][Number(Z[1])]==Z[2]&&(W=E.filled?"#00ff00":"#f3c12c")}}else this.commonService.isExistInArray(Oe,E.label)?W=E.filled?"#00ff00":"#f3c12c":E.filled&&(W="red");if(W&&L<=xt&&!this.commonService.isExistInArray(We,L)){let $=E.center.x,we=E.center.y;S&&(S.beginPath(),S.arc($,we,E.radius+1,0,2*Math.PI,!1),S.lineWidth=2,S.strokeStyle=W,S.stroke())}})}checkAnswerStudentRight(F,S){var j=0;return S[F]&&""!=S[F].rightAnswer&&0==S[F].isRight&&(j="A"==S[F].rightAnswer?1:"B"==S[F].rightAnswer?2:"C"==S[F].rightAnswer?3:"D"==S[F].rightAnswer?4:"E"==S[F].rightAnswer?5:"F"==S[F].rightAnswer?6:"G"==S[F].rightAnswer?7:"H"==S[F].rightAnswer?8:0),j}checkWrongOrTrueAnswer(F){for(var S=[],j=0;j<F.length;j++)""!=F[j].content&&(1==F[j].isRight?S.push("#00ff00"):0==F[j].isRight&&S.push("red"));return S}tickStudentIdAndExamId(F,S,j){var Me=256*Math.floor((F.position??0)/16)+F.x,Ne=(F.position??0)%16*256+F.y;(F.filledCols??0)>=128&&S&&(S.beginPath(),S.arc(Me,Ne,j,0,2*Math.PI,!1),S.lineWidth=3,S.strokeStyle="#00ff00",S.stroke())}answerPaintedRightOrWrong(F,S,j,Me){var Ne=256*Math.floor((F.position??0)/16)+F.x,Oe=(F.position??0)%16*256+F.y,We=F.rows??0,xt="#fff0";Me.length>We&&((F.filledCols??0)>=128?xt=1==Me[We].isRight?"#00ff00":"red":(F.filledCols??0)%128+1==this.checkAnswerStudentRight(We,Me)&&(xt="#f3c12c"),S&&(S.beginPath(),S.arc(Ne,Oe,j,0,2*Math.PI,!1),S.lineWidth=3,S.strokeStyle=xt,S.stroke()))}getTextAnswerDraw(F,S,j){let Me="";return j&&(F?j.isRight?(S.fillStyle="#00ff00",Me+=F):(S.fillStyle="red",Me=F+" - ["+j.rightAnswer+"]"):(S.fillStyle="#f3c12c",Me+=j.rightAnswer)),Me}}return(ce=me).\u0275fac=function(F){return new(F||ce)(y.KVO(k.R),y.KVO(q.j),y.KVO(D._),y.KVO(Ie.B))},ce.\u0275prov=y.jDH({token:ce,factory:ce.\u0275fac,providedIn:"root"}),me})();var U=v(54460),de=v(52811),_e=v(15343),le=v(76975);const ie=()=>({"flex-none mr-1":!0});function ze(ce,me){1&ce&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ce&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function Te(ce,me){1&ce&&(y.j41(0,"span",17),y.nrm(1,"azt-loading-ui"),y.k0s())}function Qe(ce,me){if(1&ce){const G=y.RV6();y.j41(0,"img",18),y.bIt("click",function(S){y.eBV(G);const j=y.XpG(2);return y.Njj(j.clickOnImage(S))}),y.k0s()}if(2&ce){const G=y.XpG(2);y.Aen(G.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",G.fileScanUrl,y.B4B)}}function ve(ce,me){if(1&ce&&(y.j41(0,"div",14,1),y.DNE(2,Te,2,0,"span",15)(3,Qe,1,3,"img",16),y.k0s()),2&ce){const G=y.XpG();y.R7$(2),y.Y8G("ngIf",G.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!G.loadingScanUrl)}}function nt(ce,me){1&ce&&(y.j41(0,"span",19),y.nrm(1,"azt-loading-ui"),y.k0s())}let se=(()=>{var ce;class me extends C._{confirmEdit(){this.initStatusObj(),this.processor.uploadToServer().then(F=>{if(!F.success){let S=F.errorMessage;return"azt_lang_core_code_exam"==S&&(S=this.commonService.myTranslateInstant("lang_core_offline_exam_not_found_offline_mix_question_hash_id")??"M\xe3 \u0111\u1ec1 thi kh\xf4ng t\u1ed3n t\u1ea1i"),this.errorStatusObj(S??"lang_core_invalid_data",!0)}this.successStatusObj("lang_auto_luu_thanh_cong",!0),this.dialogRef.close(!0)})}btnCloseDialog(){this.dialogRef.close(!1)}loadScriptHandleImage(){var F=this;this.commonService.loadAnswerSheetJs().then(()=>{var S=this.userService.getUserObj();window.azotaScanAnswerSheet.examResultProcessor(S.rememberToken,"https://"+re.c.base_embed_link,this.data.resultId,S.id).then(function(){var j=(0,m.A)(function*(Me){F.processor=Me,F.initData()});return function(Me){return j.apply(this,arguments)}}())}).catch(S=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}clickOnImage(F){const S=F.target,j=S.getBoundingClientRect();this.processData.clickToImage(S.naturalWidth/j.width*(F.clientX-j.left),S.naturalHeight/j.height*(F.clientY-j.top)),this.processDrawImage()}drawCircleImg(F,S){F&&F.length>0&&(this.circleRadius=F[0].radius,F.forEach(j=>{if(j.filled&&S){let Me=j.center.x,Ne=j.center.y;S.beginPath(),S.arc(Me,Ne,j.radius+1,0,2*Math.PI,!1),S.lineWidth=3,S.strokeStyle="red",S.stroke()}}))}processDrawImage(){let F=this.drawScanExamService._arrayBufferToBase64(this.processData.getWrappedImage()??new Uint8Array),S=this.processData.getWrappedImageExtension(),j=this.processData.getFilledCircles();if(this.imgSize=this.processor.getImageSize(),!F)return this.loadingScanUrl=!1,void(this.fileScanUrl="");let Me=new Image;Me.src="data:image/"+S+";base64,"+F,Me.crossOrigin="anonymous";var Ne=document.createElement("canvas");Ne.width=this.imgSize.width,Ne.height=this.imgSize.height;const Oe=Ne.getContext("2d");Me.onload=()=>{Oe?.drawImage(Me,0,0,Ne.width,Ne.height),this.drawCircleImg(j,Oe),this.fileScanUrl=Ne.toDataURL("image/jpeg",.9),this.loadingScanUrl=!1}}initData(){this.data.resultId&&(this.loadingScanUrl=!0,this.processData=this.processor.getData(),this.processDrawImage())}ngOnInit(){super.ngOnInit(),this.loadScriptHandleImage()}constructor(F,S,j,Me){super(Me,j),this.userService=F,this.drawScanExamService=S,this.dialogRef=j,this.loadingScanUrl=!0,this.fileScanUrl="",this.circleRadius=0,this.imgSize={width:0,height:0}}}return(ce=me).\u0275fac=function(F){return new(F||ce)(y.rXU(oe.R),y.rXU(w),y.rXU(x.CP,8),y.rXU(x.Vh,8))},ce.\u0275cmp=y.VBU({type:ce,selectors:[["app-edit-scan-file-dialog"]],features:[y.Vt3],decls:20,vars:12,consts:[["showImgScan",""],["imageHolding",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md","font-semibold","flex","text-slate-500","items-center"],["name","info","size","16",3,"ngClass"],[2,"vertical-align","midle"],[1,"text-center","mx-auto","mt-1",2,"height","calc(100vh - 200px)","overflow-y","auto"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-32","btn-primary","items-center",3,"click","disabled"],["class","inline-block mr-2",4,"ngIf"],["id","image-holding"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["id","img-container","alt","img",3,"src","style","click",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["id","img-container","alt","img",3,"click","src"],[1,"inline-block","mr-2"]],template:function(F,S){if(1&F){const j=y.RV6();y.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3",5),y.nrm(4,"lucide-icon",6),y.j41(5,"span",7),y.EFF(6,"Click \u1ea3nh \u0111\u1ec3 \u0111\xe1nh d\u1ea5u v\u1ecb tr\xed c\u1ea7n s\u1eeda"),y.k0s()(),y.j41(7,"div",8),y.DNE(8,ze,4,3,"ng-container",9)(9,ve,4,2,"ng-template",null,0,y.C5r),y.k0s()()(),y.j41(11,"div",10)(12,"button",11),y.bIt("click",function(){return y.eBV(j),y.Njj(S.btnCloseDialog())}),y.EFF(13),y.nI1(14,"mytranslate"),y.k0s(),y.j41(15,"button",12),y.bIt("click",function(){return y.eBV(j),y.Njj(S.confirmEdit())}),y.DNE(16,nt,2,0,"span",13),y.j41(17,"span",7),y.EFF(18),y.nI1(19,"mytranslate"),y.k0s()()()()}if(2&F){const j=y.sdS(10);y.R7$(4),y.Y8G("ngClass",y.lJ4(11,ie)),y.R7$(4),y.Y8G("ngIf",!S.loadingScanUrl&&!S.fileScanUrl)("ngIfElse",j),y.R7$(5),y.SpI(" ",y.bMT(14,7,"lang_cms_common_close_btn")," "),y.R7$(2),y.Y8G("disabled",S.statusObj.loading),y.R7$(),y.Y8G("ngIf",S.statusObj.loading),y.R7$(2),y.JRh(y.bMT(19,9,"lang_auto_luu"))}},dependencies:[U.YU,U.bT,de.R,_e.WGl,le.wp],encapsulation:2}),me})();var ee=v(46899),Be=v(47712);const ge=()=>({"text-slate-800":!0}),X=()=>({"text-danger":!0}),pe=ce=>({"text-success":ce});function lt(ce,me){if(1&ce){const G=y.RV6();y.j41(0,"div",20)(1,"a",21),y.nI1(2,"mytranslate"),y.bIt("click",function(){let S;y.eBV(G);const j=y.XpG(2);return y.Njj(j.deleteOfflineExamResultObj(null!==(S=null==j.examObj?null:j.examObj.hashId)&&void 0!==S?S:"",j.examResultIdParam))}),y.nrm(3,"lucide-icon",22),y.k0s()()}2&ce&&(y.R7$(),y.Y8G("matTooltip",y.bMT(2,2,"lang_auto_xoa")),y.R7$(2),y.Y8G("ngClass",y.lJ4(4,X)))}function Ee(ce,me){1&ce&&(y.j41(0,"span",23),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ce&&(y.R7$(),y.SpI("",y.bMT(2,1,"lang_auto_anh_cham"),": "))}function H(ce,me){1&ce&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ce&&(y.R7$(),y.JRh(y.bMT(2,1,"lang_auto_luu_trong_app_mobile")))}function xe(ce,me){1&ce&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ce&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function mt(ce,me){1&ce&&(y.j41(0,"span",29),y.nrm(1,"azt-loading-ui"),y.k0s())}function rt(ce,me){if(1&ce&&y.nrm(0,"img",30),2&ce){const G=y.XpG(4);y.Aen(G.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",G.fileScanUrl,y.B4B)}}function Et(ce,me){if(1&ce){const G=y.RV6();y.j41(0,"a",26),y.bIt("click",function(){y.eBV(G);const S=y.XpG(3);return y.Njj(S.onShowFile(S.fileScanUrl))}),y.DNE(1,mt,2,0,"span",27)(2,rt,1,3,"img",28),y.k0s()}if(2&ce){const G=y.XpG(3);y.R7$(),y.Y8G("ngIf",G.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!G.loadingScanUrl)}}function Xe(ce,me){if(1&ce&&(y.j41(0,"div",24),y.DNE(1,xe,4,3,"ng-container",25)(2,Et,3,2,"ng-template",null,2,y.C5r),y.k0s()),2&ce){const G=y.sdS(3),F=y.XpG(2);y.R7$(),y.Y8G("ngIf",!F.loadingScanUrl&&!F.fileScanUrl)("ngIfElse",G)}}function pt(ce,me){if(1&ce){const G=y.RV6();y.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"h3",7)(4,"span"),y.EFF(5),y.nI1(6,"mytranslate"),y.k0s()(),y.j41(7,"div",8)(8,"a",9),y.nI1(9,"mytranslate"),y.bIt("click",function(){let S;y.eBV(G);const j=y.XpG();return y.Njj(j.openEditScanFile(null!==(S=null==j.examObj?null:j.examObj.hashId)&&void 0!==S?S:"",j.examResultIdParam))}),y.nrm(10,"lucide-icon",10),y.k0s()(),y.DNE(11,lt,4,5,"div",11),y.k0s()(),y.j41(12,"div",12)(13,"div",6)(14,"span",13),y.eu8(15,14),y.k0s(),y.j41(16,"span",15),y.nI1(17,"mytranslate"),y.eu8(18,14),y.k0s()(),y.j41(19,"div",16),y.DNE(20,Ee,3,3,"span",17)(21,H,3,3,"span",18),y.k0s(),y.DNE(22,Xe,4,2,"div",19),y.k0s()()}if(2&ce){const G=y.XpG(),F=y.sdS(2),S=y.sdS(4);y.R7$(5),y.SpI(" ",y.bMT(6,10,"lang_auto_thi_offline")," "),y.R7$(3),y.Y8G("matTooltip",y.bMT(9,12,"lang_auto_sua")),y.R7$(2),y.Y8G("ngClass",y.lJ4(16,ge)),y.R7$(),y.Y8G("ngIf",G.isDeletableExamResultObj),y.R7$(4),y.Y8G("ngTemplateOutlet",F),y.R7$(),y.FS9("matTooltip",y.bMT(17,14,"lang_auto_so_bao_danh")),y.R7$(2),y.Y8G("ngTemplateOutlet",S),y.R7$(2),y.Y8G("ngIf",!G.isMobileWebView),y.R7$(),y.Y8G("ngIf",!G.checkHttpLinkImg),y.R7$(),y.Y8G("ngIf",G.checkHttpLinkImg)}}function Ze(ce,me){if(1&ce&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatOfflineExamHashIdToNumber"),y.k0s()),2&ce){let G;const F=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_auto_ma_de_thi"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,pe,!(null!=F.offlineMarkObj&&F.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),y.R7$(),y.JRh(y.i5U(4,5,null!==(G=null==F.offlineMixQuestionObj?null:F.offlineMixQuestionObj.hashId)&&void 0!==G?G:0,3))}}function Ge(ce,me){if(1&ce&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatStudentCodeToNumber"),y.k0s()),2&ce){let G;const F=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,pe,!(null!=F.offlineMarkObj&&F.offlineMarkObj.isErrorForStudentCode))),y.R7$(),y.JRh(y.i5U(4,5,(null!==(G=null==F.offlineMarkObj?null:F.offlineMarkObj.studentCode)&&void 0!==G?G:0)<0?0:null==F.offlineMarkObj?null:F.offlineMarkObj.studentCode,6))}}let K=(()=>{var ce;class me extends l.H{checkAzotaFile(F){return!(!F||!F.includes(".azt"))}checkHttpUrl(F){return!(!F||!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(F))}openEditScanFile(F,S){S&&this.sAztDialogService.open(se,{data:{examHashId:F,resultId:S,userId:Number(this.userIdParam)},width:"750px",restoreFocus:!1}).afterClosed().subscribe(Me=>{Me&&window.location.reload()})}deleteOfflineExamResultObj(F,S){S&&this.sAztDialogService.open(c.V,{data:{examHashId:F,examResultIds:[S],examResults:[]},restoreFocus:!1}).afterClosed().subscribe(Me=>{Me&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(F){this.sAztDialogService.open(d.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:F,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let F=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),S=this.castJsonToObj(F);this.checkHttpLinkImg=this.checkHttpUrl(S?.url),this.loadingScanUrl=!0,this.checkAzotaFile(S?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam,this.questionObjs,this.essayMark).then(j=>{j.imgUrl?this.fileScanUrl=j.imgUrl:this.checkHttpLinkImg=!0,this.drawScanExamService.totalPointExam=0,this.loadingScanUrl=!1}).catch(j=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(j=>{j?this.fileScanUrl=j:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(j=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(F,S,j){super(),this.sAztDialogService=F,this.zipDataService=S,this.drawScanExamService=j,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return(ce=me).\u0275fac=function(F){return new(F||ce)(y.rXU(ee.i),y.rXU(q.j),y.rXU(w))},ce.\u0275cmp=y.VBU({type:ce,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj",questionObjs:"questionObjs",essayMark:"essayMark"},features:[y.Vt3,y.OA$],decls:5,vars:1,consts:[["viewExamCodeTpl",""],["viewStudentCodeTpl",""],["showImgScan",""],["class","info-exam-offline mt-3 mb-3",4,"ngIf"],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],[1,"mx-1","items-center"],[1,"text-slate-800",3,"click","matTooltip"],["name","file-pen-line","size","18",3,"ngClass"],["class","mx-1 items-center mr-0",4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],[4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],[1,"mx-1","items-center","mr-0"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click","matTooltip"],["name","trash-2","size","18",3,"ngClass"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["alt","img",3,"src"],[3,"ngClass"]],template:function(F,S){1&F&&y.DNE(0,pt,23,17,"div",3)(1,Ze,5,10,"ng-template",null,0,y.C5r)(3,Ge,5,10,"ng-template",null,1,y.C5r),2&F&&y.Y8G("ngIf",S.offlineMarkObj)},dependencies:[U.YU,U.bT,U.T3,Be.oV,de.R,_e.WGl,le.wp,le.Po,le.IX],encapsulation:2}),me})()},1382:(yt,ke,v)=>{v.d(ke,{I:()=>C});var l=v(73014),d=v(48891),c=v(62095),m=v(40949),x=v(99927);let C=(()=>{var re;class y{constructor(z,O,k){this.commonService=z,this.cdnService=O,this.answerTypeService=k}convertUrlToBase64(z){return(0,l.A)(function*(){const k=yield(yield fetch(z+"?t="+(new Date).getTime())).blob();return new Promise(q=>{const D=new FileReader;D.readAsDataURL(k),D.onloadend=()=>{q(D.result)}})})()}convertLinkToBase64(z,O,k){var q=this;return(0,l.A)(function*(){if(!O)return k;for(let Ie=0;Ie<(z?.length??0);Ie++)if(z?.[Ie].link===k)return z?.[Ie].convert;var D=yield q.convertUrlToBase64(k);return z?.push({convert:D,link:k}),D})()}replaceCanvasBackground(z,O){var k=this;return(0,l.A)(function*(){if(z){var q=[];for(let Be=0;Be<z.length;Be++){var D=z[Be];if(D&&0===D.isImage){var Ie=D.questionContentParse?.[0].content;D.questionContentParse&&(D.questionContentParse[0].content="");var J=void 0===Ie?[]:Ie.split("@[]");for(let ge=0;ge<J.length;ge++){var V=J[ge];if(!0===k.commonService.isJson(V)){var w=k.commonService.willDeleteParseJson(V);if(w.hasOwnProperty("link")){var U=document.body.offsetWidth,le=1;w.data.width>(_e=U-30)&&(w.data={x:w.data.x*(le=_e/w.data.width),y:w.data.y*le,width:w.data.width*le,height:w.data.height*le}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},D.questionContentParse&&(D.questionContentParse[0].content+=`<div class="background_question_${Be}_${ge}"><img width="${1024*le}" height="${1024*le}" src="${yield k.convertLinkToBase64(q,O,k.cdnService.getMyCdn(w.link))}"></div>`);var ie=document.createElement("style");document.body.appendChild(ie),ie.textContent+=`.background_question_${Be}_${ge} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${Be}_${ge} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else D.questionContentParse&&(D.questionContentParse[0].content+=V)}else D.questionContentParse&&(D.questionContentParse[0].content+=V)}if(k.answerTypeService.isOneChoiceAnswer(D))for(let ge=0;ge<(D.answerConfigParse?.length??0);ge++){var ze=D.answerConfigParse?.[ge].content;D.answerConfigParse&&(D.answerConfigParse[ge].content="");var Te=void 0===ze?[]:ze.split("@[]");for(let X=0;X<Te.length;X++){var Qe=Te[X];if(!0===k.commonService.isJson(Qe)){var ve=k.commonService.willDeleteParseJson(Qe);ve.hasOwnProperty("link")?(U=document.body.offsetWidth,le=1,ve.data.width>(_e=U-30)&&(ve.data={x:ve.data.x*(le=_e/ve.data.width),y:ve.data.y*le,width:ve.data.width*le,height:ve.data.height*le}),ve.data={x:Math.floor(ve.data.x),y:Math.floor(ve.data.y),width:Math.floor(ve.data.width),height:Math.floor(ve.data.height)},D.answerConfigParse&&(D.answerConfigParse[ge].content+=`<div class="background_question__ans${Be}_${ge}_${X}"><img width="${1024*le}" height="${1024*le}" src="${yield k.convertLinkToBase64(q,O,k.cdnService.getMyCdn(ve.link))}"></div>`),ie=document.createElement("style"),document.body.appendChild(ie),ie.textContent+=`.background_question__ans${Be}_${ge}_${X} {margin: 0 3px; width: ${ve.data.width}px; height: ${ve.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${Be}_${ge}_${X} img { margin-top: -${ve.data.y}px; margin-left: -${ve.data.x}px;}`):D.answerConfigParse&&(D.answerConfigParse[ge].content+=Qe)}else D.answerConfigParse&&(D.answerConfigParse[ge].content+=Qe)}}if(D.answerMediaParse&&D.answerMediaParse.length>0){var nt=D.answerMediaParse;D.answerMediaParse="";var at=void 0===nt?[]:nt.split("@[]");for(let ge=0;ge<at.length;ge++){var se=at[ge];if(!0===k.commonService.isJson(se)){var _e,ee=k.commonService.willDeleteParseJson(se);if(ee.hasOwnProperty("link"))U=document.body.offsetWidth,le=1,ee.data.width>(_e=U-30)&&(ee.data={x:ee.data.x*(le=_e/ee.data.width),y:ee.data.y*le,width:ee.data.width*le,height:ee.data.height*le}),ee.data={x:Math.floor(ee.data.x),y:Math.floor(ee.data.y),width:Math.floor(ee.data.width),height:Math.floor(ee.data.height)},D.answerMediaParse+=`<div class="background_question__ans_result${Be}_${ge}"><img width="${1024*le}" height="${1024*le}" src="${yield k.convertLinkToBase64(q,O,k.cdnService.getMyCdn(ee.link))}"></div>`,ie=document.createElement("style"),document.body.appendChild(ie),ie.textContent+=`.background_question__ans_result${Be}_${ge} {margin: 0 3px; width: ${ee.data.width}px; height: ${ee.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${Be}_${ge} img { margin-top: -${ee.data.y}px; margin-left: -${ee.data.x}px;}`;else D.answerMediaParse+=se}else D.answerMediaParse+=se}}}}}})()}replaceCanvasBackgroundTS(z,O){var k=this;return(0,l.A)(function*(){var q=[];for(let nt=0;nt<z.length;nt++){var D=z[nt];if(0===D.isImage){var Ie=D.questionContentParse[0].content;D.questionContentParse[0].content="";var J=void 0===Ie?[]:Ie.split("@[]");for(let at=0;at<J.length;at++){var V=J[at];if(!0===k.commonService.isJson(V)){var w=k.commonService.willDeleteParseJson(V);if(w.hasOwnProperty("link")){var U=document.body.offsetWidth,le=1;w.data.width>(_e=U-30)&&(w.data={x:w.data.x*(le=_e/w.data.width),y:w.data.y*le,width:w.data.width*le,height:w.data.height*le}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},D.questionContentParse[0].content+=`<div class="background_question_${nt}_${at}"><img width="${1024*le}" height="${1024*le}" src="${yield k.convertLinkToBase64(q,O,k.cdnService.getMyCdn(w.link))}"></div>`;var ie=document.createElement("style");document.body.appendChild(ie),ie.textContent+=`.background_question_${nt}_${at} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${nt}_${at} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else D.questionContentParse[0].content+=V}else D.questionContentParse[0].content+=V}if(k.answerTypeService.isOneChoiceAnswer(D)&&(0==D.isImage||1==D.isImage&&D.name.startsWith("[PDFv2]")?k.replaceBackgroundAnswerConfig(D.answerConfigParse,q,nt,O):k.replaceBackgroundAnswerConfig(D.answerConfigParseVer1.answerConfigV2,q,nt,O)),D.answerMedia&&D.answerMedia.length>0){var ze=D.answerMedia;D.answerMedia="";var Te=void 0===ze?[]:ze.split("@[]");for(let at=0;at<Te.length;at++){var Qe=Te[at];if(!0===k.commonService.isJson(Qe)){var _e,ve=k.commonService.willDeleteParseJson(Qe);if(ve.hasOwnProperty("link"))U=document.body.offsetWidth,le=1,ve.data.width>(_e=U-30)&&(ve.data={x:ve.data.x*(le=_e/ve.data.width),y:ve.data.y*le,width:ve.data.width*le,height:ve.data.height*le}),ve.data={x:Math.floor(ve.data.x),y:Math.floor(ve.data.y),width:Math.floor(ve.data.width),height:Math.floor(ve.data.height)},D.answerMedia+=`<div class="background_question__ans_result${nt}_${at}"><img width="${1024*le}" height="${1024*le}" src="${yield k.convertLinkToBase64(q,O,k.cdnService.getMyCdn(ve.link))}"></div>`,ie=document.createElement("style"),document.body.appendChild(ie),ie.textContent+=`.background_question__ans_result${nt}_${at} {margin: 0 3px; width: ${ve.data.width}px; height: ${ve.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${nt}_${at} img { margin-top: -${ve.data.y}px; margin-left: -${ve.data.x}px;}`;else D.answerMedia+=Qe}else D.answerMedia+=Qe}}}}return!0})()}replaceBackgroundAnswerConfig(z,O,k,q){var D=this;return(0,l.A)(function*(){for(let ze=0;ze<z.length;ze++){var Ie=z[ze].content;z[ze].content="";var J=void 0===Ie?[]:Ie.split("@[]");for(let Te=0;Te<J.length;Te++){var V=J[Te];if(!0===D.commonService.isJson(V)){var w=D.commonService.willDeleteParseJson(V);if(w.hasOwnProperty("link")){var _e=document.body.offsetWidth-30,le=1;w.data.width>_e&&(w.data={x:w.data.x*(le=_e/w.data.width),y:w.data.y*le,width:w.data.width*le,height:w.data.height*le}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},z[ze].content+=`<div class="background_question__ans${k}_${ze}_${Te}"><img width="${1024*le}" height="${1024*le}" src="${yield D.convertLinkToBase64(O,q,D.cdnService.getMyCdn(w.link))}"></div>`;var ie=document.createElement("style");document.body.appendChild(ie),ie.textContent+=`.background_question__ans${k}_${ze}_${Te} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${k}_${ze}_${Te} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else z[ze].content+=V}else z[ze].content+=V}}})()}}return(re=y).\u0275fac=function(z){return new(z||re)(d.KVO(c.R),d.KVO(m.B),d.KVO(x._))},re.\u0275prov=d.jDH({token:re,factory:re.\u0275fac,providedIn:"root"}),y})()},37642:(yt,ke,v)=>{v.d(ke,{E:()=>d});var l=v(48891);let d=(()=>{var c;class m{getDictionaryByGroupFieldTS(C,re){for(var y={},oe=0;oe<C.length;oe++)C[oe].hasOwnProperty(re)&&("number"==typeof C[oe][re]||"string"==typeof C[oe][re])&&(y.hasOwnProperty(C[oe][re])||(y[C[oe][re]]=[]),y[C[oe][re]].push(C[oe]));return y}getDictionaryByFieldTS(C,re){for(var y={},oe=0;oe<C.length;oe++)C[oe].hasOwnProperty(re)&&("number"==typeof C[oe][re]||"string"==typeof C[oe][re])&&(y[C[oe][re]]=C[oe]);return y}getDictionaryBy2FieldsTS(C,re,y){for(var oe={},z=0;z<C.length;z++)C[z].hasOwnProperty(re)&&("number"==typeof C[z][re]||"string"==typeof C[z][re])&&C[z].hasOwnProperty(y)&&("number"==typeof C[z][y]||"string"==typeof C[z][y])&&(oe[C[z][re]+"_"+C[z][y]]=C[z]);return oe}getListValueByFieldNumberTS(C,re){for(var y=[],oe=0;oe<C.length;oe++)C[oe].hasOwnProperty(re)&&"number"==typeof C[oe][re]&&y.push(C[oe][re]);return y}getListValueByField(C,re){for(var y=[],oe=0;oe<C.length;oe++)if(C[oe].hasOwnProperty(re)){var z=y.filter(O=>O[re]==C[oe][re]);(!z||0==z.length)&&y.push(C[oe])}return y}}return(c=m).\u0275fac=function(C){return new(C||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),m})()},99172:(yt,ke,v)=>{v.d(ke,{p:()=>C});var l=v(73014),d=v(48891),c=v(62095),m=v(40949),x=v(53393);let C=(()=>{var re;class y{processEssayResultToBase64(z){var O=this;return(0,l.A)(function*(){for(const k of z.pages??[]){if(k.draw){const q=yield O.exportPdfUtilsService.convertAndRetryToBase64(k.draw);k.draw=q}if(k.backgroundImage){const q=yield O.exportPdfUtilsService.convertAndRetryToBase64(k.backgroundImage);k.backgroundImage=q}}if(z.commentEmoji&&z.commentEmoji.length){let k="https://azota889.github.io/storage_public/mnote/",q=z.commentEmoji.length;for(let D=0;D<q;D++){let Ie=k+z.commentEmoji[D];const J=yield O.exportPdfUtilsService.convertAndRetryToBase64(Ie);z.commentEmoji[D]=J}}return z})()}convertAnswersArr(z,O){0!=z.length&&z.forEach(k=>{k.QuestionId&&k.AnswerContent&&k.AnswerContent[0]&&k.AnswerContent[0].Content&&(O[`id_${k.QuestionId}`]=k.AnswerContent[0].Content)})}findScaleDirection(z,O){return z/O>=.7070707070707071?"w":"h"}constructor(z,O,k){this.commonService=z,this.cdnService=O,this.exportPdfUtilsService=k}}return(re=y).\u0275fac=function(z){return new(z||re)(d.KVO(c.R),d.KVO(m.B),d.KVO(x.j))},re.\u0275prov=d.jDH({token:re,factory:re.\u0275fac,providedIn:"root"}),y})()},53393:(yt,ke,v)=>{v.d(ke,{j:()=>re});var l=v(73014),d=function(y){return y[y.Cdn=0]="Cdn",y[y.CdnTimestamp=1]="CdnTimestamp",y[y.Rawlink=2]="Rawlink",y[y.RawlinkTimestamp=3]="RawlinkTimestamp",y}(d||{}),c=v(48891),m=v(62095),x=v(40949),C=v(99927);let re=(()=>{var y;class oe{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){const O=navigator.userAgent,q=(()=>{let Ie=null;const J=O.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(J[1]))return"IE "+((/\brv[ :]+(\d+)/g.exec(O)||[])[1]||"");if("Chrome"===J[1]){const w=O.match(/\b(OPR|Edge)\/(\d+)/);if(null!==w)return w.slice(1).join(" ").replace("OPR","Opera")}const V=J[2]?[J[1],J[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!==(Ie=O.match(/version\/(\d+)/i))&&V.splice(1,1,Ie[1]),V.join(" ")})().toString();return!(!["chrome"].includes(q.split(" ")[0].toLowerCase())||parseInt(q.split(" ")[1],10)<80)}getExtensionFile(O){if(!O)return"";const k=O.split(".");return k.length<=1?"":k[k.length-1].toLocaleLowerCase().split("_")[0]}findImageSrcInContent(O){let k="";if(O.includes("img")){const q=O.indexOf("img"),D=O.indexOf("src=",q),Ie=O.indexOf('"',Number(D)+5);k=O.substring(Number(D)+5,Number(Ie))}return k}asyncTimeout(O){return(0,l.A)(function*(){return`Waited ${yield new Promise(q=>{setTimeout(()=>q(O),O)})} milliseconds`})()}parseEssayMarkResult(O,k){let q=O.filter(J=>this.answerTypeService.isEssayAnswer(J));if(0!=q.length&&k&&k.essayResult){var D=this.commonService.willDeleteParseJson(k.essayResult);if(D){var Ie=Object.entries(D);for(let J=0;J<q.length;J++)q[J].essayMarkParsed=Ie[J][1]}}}convertToBase64(O,k){var q=this;return(0,l.A)(function*(){let D=O;switch(k){case d.Cdn:D=q.cdnService.getMyCdn(O);break;case d.CdnTimestamp:D=q.cdnService.getMyCdn(O)+"?t="+Date.now();break;case d.RawlinkTimestamp:D=O+"?t="+Date.now()}const J=yield(yield fetch(D)).blob(),V=yield new Promise(w=>{const U=new FileReader;U.readAsDataURL(J),U.onloadend=()=>{w(U.result)}});return V&&"string"==typeof V?V:O})()}convertAndRetryToBase64(O){var k=this;return(0,l.A)(function*(){let q=k.getExtensionFile(O);if(["pdf","jpg","jpeg","png","gif"].includes(q)){let D;const Ie=[d.Cdn,d.CdnTimestamp,d.Rawlink,d.RawlinkTimestamp];try{D=yield k.convertToBase64(O,Ie[0])}catch{try{D=yield k.convertToBase64(O,Ie[1])}catch{try{D=yield k.convertToBase64(O,Ie[2])}catch{try{D=yield k.convertToBase64(O,Ie[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+O),D=O}}}}return D}return O})()}eraseCanvas(O){O&&(O.beginPath(),O.rect(0,0,O.canvas.width,O.canvas.height),O.fillStyle="white",O.fill())}addContentToPdf(O,k){O.addImage(k,"JPEG",0,0,O.internal.pageSize.getWidth(),O.internal.pageSize.getHeight())}drawTextWrap(O,k,q,D,Ie){const J=O.split(" "),V=[];let w=J[0];if(k){k.font=Ie||`${D}px Arial`;for(let U=1;U<J.length;U++){const de=J[U];k.measureText(w+" "+de).width<q?w+=" "+de:(V.push(w),w=de)}V.push(w)}return V}essayText2LinesArr(O,k,q,D,Ie){const J=new RegExp("(<br>|<br/>)+","igm"),w=(this.replaceAllByRegExp(O,J,"<br>")??"").split("<br>"),U=[];for(let de=0;de<w.length;de++)U.push(this.drawTextWrap(w[de],k,q,D,Ie));return U}replaceAllByRegExp(O,k,q){return q?O?O.toString().replace(k,q):void 0:O}removeTagAssistiveMml(){const O=document.getElementsByTagName("mjx-assistive-mml");for(;O.length>0;)O[0].remove()}constructor(O,k,q){this.commonService=O,this.cdnService=k,this.answerTypeService=q}}return(y=oe).\u0275fac=function(O){return new(O||y)(c.KVO(m.R),c.KVO(x.B),c.KVO(C._))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),oe})()},69817:(yt,ke,v)=>{v.d(ke,{s:()=>$p});var l=v(73014),d=v(80055);(0,d.registerVersion)("firebase","10.13.2","app");var O,k,x=v(35696),C=v(64627),re=v(56094),y=v(17791),oe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},z={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function s(Y,M,B){B||(B=0);var Q=Array(16);if("string"==typeof M)for(var ne=0;16>ne;++ne)Q[ne]=M.charCodeAt(B++)|M.charCodeAt(B++)<<8|M.charCodeAt(B++)<<16|M.charCodeAt(B++)<<24;else for(ne=0;16>ne;++ne)Q[ne]=M[B++]|M[B++]<<8|M[B++]<<16|M[B++]<<24;var he=Y.g[3],N=(M=Y.g[0])+(he^(B=Y.g[1])&((ne=Y.g[2])^he))+Q[0]+3614090360&4294967295;N=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=(B=(ne=(he=(M=B+(N<<7&4294967295|N>>>25))+((N=he+(ne^M&(B^ne))+Q[1]+3905402710&4294967295)<<12&4294967295|N>>>20))+((N=ne+(B^he&(M^B))+Q[2]+606105819&4294967295)<<17&4294967295|N>>>15))+((N=B+(M^ne&(he^M))+Q[3]+3250441966&4294967295)<<22&4294967295|N>>>10))+((N=M+(he^B&(ne^he))+Q[4]+4118548399&4294967295)<<7&4294967295|N>>>25))+((N=he+(ne^M&(B^ne))+Q[5]+1200080426&4294967295)<<12&4294967295|N>>>20))+((N=ne+(B^he&(M^B))+Q[6]+2821735955&4294967295)<<17&4294967295|N>>>15))+((N=B+(M^ne&(he^M))+Q[7]+4249261313&4294967295)<<22&4294967295|N>>>10))+((N=M+(he^B&(ne^he))+Q[8]+1770035416&4294967295)<<7&4294967295|N>>>25))+((N=he+(ne^M&(B^ne))+Q[9]+2336552879&4294967295)<<12&4294967295|N>>>20))+((N=ne+(B^he&(M^B))+Q[10]+4294925233&4294967295)<<17&4294967295|N>>>15))+((N=B+(M^ne&(he^M))+Q[11]+2304563134&4294967295)<<22&4294967295|N>>>10))+((N=M+(he^B&(ne^he))+Q[12]+1804603682&4294967295)<<7&4294967295|N>>>25))+((N=he+(ne^M&(B^ne))+Q[13]+4254626195&4294967295)<<12&4294967295|N>>>20))+((N=ne+(B^he&(M^B))+Q[14]+2792965006&4294967295)<<17&4294967295|N>>>15))+((N=B+(M^ne&(he^M))+Q[15]+1236535329&4294967295)<<22&4294967295|N>>>10))+((N=M+(ne^he&(B^ne))+Q[1]+4129170786&4294967295)<<5&4294967295|N>>>27))+((N=he+(B^ne&(M^B))+Q[6]+3225465664&4294967295)<<9&4294967295|N>>>23))+((N=ne+(M^B&(he^M))+Q[11]+643717713&4294967295)<<14&4294967295|N>>>18))+((N=B+(he^M&(ne^he))+Q[0]+3921069994&4294967295)<<20&4294967295|N>>>12))+((N=M+(ne^he&(B^ne))+Q[5]+3593408605&4294967295)<<5&4294967295|N>>>27))+((N=he+(B^ne&(M^B))+Q[10]+38016083&4294967295)<<9&4294967295|N>>>23))+((N=ne+(M^B&(he^M))+Q[15]+3634488961&4294967295)<<14&4294967295|N>>>18))+((N=B+(he^M&(ne^he))+Q[4]+3889429448&4294967295)<<20&4294967295|N>>>12))+((N=M+(ne^he&(B^ne))+Q[9]+568446438&4294967295)<<5&4294967295|N>>>27))+((N=he+(B^ne&(M^B))+Q[14]+3275163606&4294967295)<<9&4294967295|N>>>23))+((N=ne+(M^B&(he^M))+Q[3]+4107603335&4294967295)<<14&4294967295|N>>>18))+((N=B+(he^M&(ne^he))+Q[8]+1163531501&4294967295)<<20&4294967295|N>>>12))+((N=M+(ne^he&(B^ne))+Q[13]+2850285829&4294967295)<<5&4294967295|N>>>27))+((N=he+(B^ne&(M^B))+Q[2]+4243563512&4294967295)<<9&4294967295|N>>>23))+((N=ne+(M^B&(he^M))+Q[7]+1735328473&4294967295)<<14&4294967295|N>>>18))+((N=B+(he^M&(ne^he))+Q[12]+2368359562&4294967295)<<20&4294967295|N>>>12))+((N=M+(B^ne^he)+Q[5]+4294588738&4294967295)<<4&4294967295|N>>>28))+((N=he+(M^B^ne)+Q[8]+2272392833&4294967295)<<11&4294967295|N>>>21))+((N=ne+(he^M^B)+Q[11]+1839030562&4294967295)<<16&4294967295|N>>>16))+((N=B+(ne^he^M)+Q[14]+4259657740&4294967295)<<23&4294967295|N>>>9))+((N=M+(B^ne^he)+Q[1]+2763975236&4294967295)<<4&4294967295|N>>>28))+((N=he+(M^B^ne)+Q[4]+1272893353&4294967295)<<11&4294967295|N>>>21))+((N=ne+(he^M^B)+Q[7]+4139469664&4294967295)<<16&4294967295|N>>>16))+((N=B+(ne^he^M)+Q[10]+3200236656&4294967295)<<23&4294967295|N>>>9))+((N=M+(B^ne^he)+Q[13]+681279174&4294967295)<<4&4294967295|N>>>28))+((N=he+(M^B^ne)+Q[0]+3936430074&4294967295)<<11&4294967295|N>>>21))+((N=ne+(he^M^B)+Q[3]+3572445317&4294967295)<<16&4294967295|N>>>16))+((N=B+(ne^he^M)+Q[6]+76029189&4294967295)<<23&4294967295|N>>>9))+((N=M+(B^ne^he)+Q[9]+3654602809&4294967295)<<4&4294967295|N>>>28))+((N=he+(M^B^ne)+Q[12]+3873151461&4294967295)<<11&4294967295|N>>>21))+((N=ne+(he^M^B)+Q[15]+530742520&4294967295)<<16&4294967295|N>>>16))+((N=B+(ne^he^M)+Q[2]+3299628645&4294967295)<<23&4294967295|N>>>9))+((N=M+(ne^(B|~he))+Q[0]+4096336452&4294967295)<<6&4294967295|N>>>26))+((N=he+(B^(M|~ne))+Q[7]+1126891415&4294967295)<<10&4294967295|N>>>22))+((N=ne+(M^(he|~B))+Q[14]+2878612391&4294967295)<<15&4294967295|N>>>17))+((N=B+(he^(ne|~M))+Q[5]+4237533241&4294967295)<<21&4294967295|N>>>11))+((N=M+(ne^(B|~he))+Q[12]+1700485571&4294967295)<<6&4294967295|N>>>26))+((N=he+(B^(M|~ne))+Q[3]+2399980690&4294967295)<<10&4294967295|N>>>22))+((N=ne+(M^(he|~B))+Q[10]+4293915773&4294967295)<<15&4294967295|N>>>17))+((N=B+(he^(ne|~M))+Q[1]+2240044497&4294967295)<<21&4294967295|N>>>11))+((N=M+(ne^(B|~he))+Q[8]+1873313359&4294967295)<<6&4294967295|N>>>26))+((N=he+(B^(M|~ne))+Q[15]+4264355552&4294967295)<<10&4294967295|N>>>22))+((N=ne+(M^(he|~B))+Q[6]+2734768916&4294967295)<<15&4294967295|N>>>17))+((N=B+(he^(ne|~M))+Q[13]+1309151649&4294967295)<<21&4294967295|N>>>11))+((he=(M=B+((N=M+(ne^(B|~he))+Q[4]+4149444226&4294967295)<<6&4294967295|N>>>26))+((N=he+(B^(M|~ne))+Q[11]+3174756917&4294967295)<<10&4294967295|N>>>22))^((ne=he+((N=ne+(M^(he|~B))+Q[2]+718787259&4294967295)<<15&4294967295|N>>>17))|~M))+Q[9]+3951481745&4294967295,Y.g[0]=Y.g[0]+M&4294967295,Y.g[1]=Y.g[1]+(ne+(N<<21&4294967295|N>>>11))&4294967295,Y.g[2]=Y.g[2]+ne&4294967295,Y.g[3]=Y.g[3]+he&4294967295}function o(Y,M){this.h=M;for(var B=[],Q=!0,ne=Y.length-1;0<=ne;ne--){var he=0|Y[ne];Q&&he==M||(B[ne]=he,Q=!1)}this.g=B}(function e(Y,M){function B(){}B.prototype=M.prototype,Y.D=M.prototype,Y.prototype=new B,Y.prototype.constructor=Y,Y.C=function(Q,ne,he){for(var N=Array(arguments.length-2),Fn=2;Fn<arguments.length;Fn++)N[Fn-2]=arguments[Fn];return M.prototype[ne].apply(Q,N)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(Y,M){void 0===M&&(M=Y.length);for(var B=M-this.blockSize,Q=this.B,ne=this.h,he=0;he<M;){if(0==ne)for(;he<=B;)s(this,Y,he),he+=this.blockSize;if("string"==typeof Y){for(;he<M;)if(Q[ne++]=Y.charCodeAt(he++),ne==this.blockSize){s(this,Q),ne=0;break}}else for(;he<M;)if(Q[ne++]=Y[he++],ne==this.blockSize){s(this,Q),ne=0;break}}this.h=ne,this.o+=M},n.prototype.v=function(){var Y=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Y[0]=128;for(var M=1;M<Y.length-8;++M)Y[M]=0;var B=8*this.o;for(M=Y.length-8;M<Y.length;++M)Y[M]=255&B,B/=256;for(this.u(Y),Y=Array(16),M=B=0;4>M;++M)for(var Q=0;32>Q;Q+=8)Y[B++]=this.g[M]>>>Q&255;return Y};var u={};function h(Y){return-128<=Y&&128>Y?function i(Y,M){var B=u;return Object.prototype.hasOwnProperty.call(B,Y)?B[Y]:B[Y]=M(Y)}(Y,function(M){return new o([0|M],0>M?-1:0)}):new o([0|Y],0>Y?-1:0)}function f(Y){if(isNaN(Y)||!isFinite(Y))return T;if(0>Y)return De(f(-Y));for(var M=[],B=1,Q=0;Y>=B;Q++)M[Q]=Y/B|0,B*=4294967296;return new o(M,0)}var T=h(0),P=h(1),te=h(16777216);function Se(Y){if(0!=Y.h)return!1;for(var M=0;M<Y.g.length;M++)if(0!=Y.g[M])return!1;return!0}function je(Y){return-1==Y.h}function De(Y){for(var M=Y.g.length,B=[],Q=0;Q<M;Q++)B[Q]=~Y.g[Q];return new o(B,~Y.h).add(P)}function He(Y,M){return Y.add(De(M))}function st(Y,M){for(;(65535&Y[M])!=Y[M];)Y[M+1]+=Y[M]>>>16,Y[M]&=65535,M++}function et(Y,M){this.g=Y,this.h=M}function ht(Y,M){if(Se(M))throw Error("division by zero");if(Se(Y))return new et(T,T);if(je(Y))return M=ht(De(Y),M),new et(De(M.g),De(M.h));if(je(M))return M=ht(Y,De(M)),new et(De(M.g),M.h);if(30<Y.g.length){if(je(Y)||je(M))throw Error("slowDivide_ only works with positive integers.");for(var B=P,Q=M;0>=Q.l(Y);)B=Tt(B),Q=Tt(Q);var ne=ft(B,1),he=ft(Q,1);for(Q=ft(Q,2),B=ft(B,2);!Se(Q);){var N=he.add(Q);0>=N.l(Y)&&(ne=ne.add(B),he=N),Q=ft(Q,1),B=ft(B,1)}return M=He(Y,ne.j(M)),new et(ne,M)}for(ne=T;0<=Y.l(M);){for(B=Math.max(1,Math.floor(Y.m()/M.m())),Q=48>=(Q=Math.ceil(Math.log(B)/Math.LN2))?1:Math.pow(2,Q-48),N=(he=f(B)).j(M);je(N)||0<N.l(Y);)N=(he=f(B-=Q)).j(M);Se(he)&&(he=P),ne=ne.add(he),Y=He(Y,N)}return new et(ne,Y)}function Tt(Y){for(var M=Y.g.length+1,B=[],Q=0;Q<M;Q++)B[Q]=Y.i(Q)<<1|Y.i(Q-1)>>>31;return new o(B,Y.h)}function ft(Y,M){var B=M>>5;M%=32;for(var Q=Y.g.length-B,ne=[],he=0;he<Q;he++)ne[he]=0<M?Y.i(he+B)>>>M|Y.i(he+B+1)<<32-M:Y.i(he+B);return new o(ne,Y.h)}(r=o.prototype).m=function(){if(je(this))return-De(this).m();for(var Y=0,M=1,B=0;B<this.g.length;B++){var Q=this.i(B);Y+=(0<=Q?Q:4294967296+Q)*M,M*=4294967296}return Y},r.toString=function(Y){if(2>(Y=Y||10)||36<Y)throw Error("radix out of range: "+Y);if(Se(this))return"0";if(je(this))return"-"+De(this).toString(Y);for(var M=f(Math.pow(Y,6)),B=this,Q="";;){var ne=ht(B,M).g,he=((0<(B=He(B,ne.j(M))).g.length?B.g[0]:B.h)>>>0).toString(Y);if(Se(B=ne))return he+Q;for(;6>he.length;)he="0"+he;Q=he+Q}},r.i=function(Y){return 0>Y?0:Y<this.g.length?this.g[Y]:this.h},r.l=function(Y){return je(Y=He(this,Y))?-1:Se(Y)?0:1},r.abs=function(){return je(this)?De(this):this},r.add=function(Y){for(var M=Math.max(this.g.length,Y.g.length),B=[],Q=0,ne=0;ne<=M;ne++){var he=Q+(65535&this.i(ne))+(65535&Y.i(ne)),N=(he>>>16)+(this.i(ne)>>>16)+(Y.i(ne)>>>16);Q=N>>>16,B[ne]=(N&=65535)<<16|(he&=65535)}return new o(B,-2147483648&B[B.length-1]?-1:0)},r.j=function(Y){if(Se(this)||Se(Y))return T;if(je(this))return je(Y)?De(this).j(De(Y)):De(De(this).j(Y));if(je(Y))return De(this.j(De(Y)));if(0>this.l(te)&&0>Y.l(te))return f(this.m()*Y.m());for(var M=this.g.length+Y.g.length,B=[],Q=0;Q<2*M;Q++)B[Q]=0;for(Q=0;Q<this.g.length;Q++)for(var ne=0;ne<Y.g.length;ne++){var he=this.i(Q)>>>16,N=65535&this.i(Q),Fn=Y.i(ne)>>>16,$s=65535&Y.i(ne);B[2*Q+2*ne]+=N*$s,st(B,2*Q+2*ne),B[2*Q+2*ne+1]+=he*$s,st(B,2*Q+2*ne+1),B[2*Q+2*ne+1]+=N*Fn,st(B,2*Q+2*ne+1),B[2*Q+2*ne+2]+=he*Fn,st(B,2*Q+2*ne+2)}for(Q=0;Q<M;Q++)B[Q]=B[2*Q+1]<<16|B[2*Q];for(Q=M;Q<2*M;Q++)B[Q]=0;return new o(B,0)},r.A=function(Y){return ht(this,Y).h},r.and=function(Y){for(var M=Math.max(this.g.length,Y.g.length),B=[],Q=0;Q<M;Q++)B[Q]=this.i(Q)&Y.i(Q);return new o(B,this.h&Y.h)},r.or=function(Y){for(var M=Math.max(this.g.length,Y.g.length),B=[],Q=0;Q<M;Q++)B[Q]=this.i(Q)|Y.i(Q);return new o(B,this.h|Y.h)},r.xor=function(Y){for(var M=Math.max(this.g.length,Y.g.length),B=[],Q=0;Q<M;Q++)B[Q]=this.i(Q)^Y.i(Q);return new o(B,this.h^Y.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,k=z.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=f,o.fromString=function g(Y,M){if(0==Y.length)throw Error("number format error: empty string");if(2>(M=M||10)||36<M)throw Error("radix out of range: "+M);if("-"==Y.charAt(0))return De(g(Y.substring(1),M));if(0<=Y.indexOf("-"))throw Error('number format error: interior "-" character');for(var B=f(Math.pow(M,8)),Q=T,ne=0;ne<Y.length;ne+=8){var he=Math.min(8,Y.length-ne),N=parseInt(Y.substring(ne,ne+he),M);8>he?(he=f(Math.pow(M,he)),Q=Q.j(he).add(f(N))):Q=(Q=Q.j(B)).add(f(N))}return Q},O=z.Integer=o}).apply(typeof oe<"u"?oe:typeof self<"u"?self:typeof window<"u"?window:{});var Ie,J,V,w,U,de,_e,le,ie,q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},D={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(a,_,p){return a==Array.prototype||a==Object.prototype||(a[_]=p.value),a},n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof q&&q];for(var _=0;_<a.length;++_){var p=a[_];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}(this);!function s(a,_){if(_)e:{var p=n;a=a.split(".");for(var I=0;I<a.length-1;I++){var ae=a[I];if(!(ae in p))break e;p=p[ae]}(_=_(I=p[a=a[a.length-1]]))!=I&&null!=_&&e(p,a,{configurable:!0,writable:!0,value:_})}}("Array.prototype.values",function(a){return a||function(){return function i(a,_){a instanceof String&&(a+="");var p=0,I=!1,ae={next:function(){if(!I&&p<a.length){var ye=p++;return{value:_(ye,a[ye]),done:!1}}return I=!0,{done:!0,value:void 0}}};return ae[Symbol.iterator]=function(){return ae},ae}(this,function(_,p){return p})}});var o=o||{},u=this||self;function h(a){var _=typeof a;return"array"==(_="object"!=_?_:a?Array.isArray(a)?"array":_:"null")||"object"==_&&"number"==typeof a.length}function f(a){var _=typeof a;return"object"==_&&null!=a||"function"==_}function g(a,_,p){return a.call.apply(a.bind,arguments)}function T(a,_,p){if(!a)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var ae=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ae,I),a.apply(_,ae)}}return function(){return a.apply(_,arguments)}}function P(a,_,p){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:T).apply(null,arguments)}function te(a,_){var p=Array.prototype.slice.call(arguments,1);return function(){var I=p.slice();return I.push.apply(I,arguments),a.apply(this,I)}}function Se(a,_){function p(){}p.prototype=_.prototype,a.aa=_.prototype,a.prototype=new p,a.prototype.constructor=a,a.Qb=function(I,ae,ye){for(var qe=Array(arguments.length-2),Rt=2;Rt<arguments.length;Rt++)qe[Rt-2]=arguments[Rt];return _.prototype[ae].apply(I,qe)}}function je(a){const _=a.length;if(0<_){const p=Array(_);for(let I=0;I<_;I++)p[I]=a[I];return p}return[]}function De(a,_){for(let p=1;p<arguments.length;p++){const I=arguments[p];if(h(I)){const ae=a.length||0,ye=I.length||0;a.length=ae+ye;for(let qe=0;qe<ye;qe++)a[ae+qe]=I[qe]}else a.push(I)}}function st(a){return/^[\s\xa0]*$/.test(a)}function et(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function ht(a){return ht[" "](a),a}ht[" "]=function(){};var Tt=!(-1==et().indexOf("Gecko")||-1!=et().toLowerCase().indexOf("webkit")&&-1==et().indexOf("Edge")||-1!=et().indexOf("Trident")||-1!=et().indexOf("MSIE")||-1!=et().indexOf("Edge"));function ft(a,_,p){for(const I in a)_.call(p,a[I],I,a)}function M(a){const _={};for(const p in a)_[p]=a[p];return _}const B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Q(a,_){let p,I;for(let ae=1;ae<arguments.length;ae++){for(p in I=arguments[ae],I)a[p]=I[p];for(let ye=0;ye<B.length;ye++)p=B[ye],Object.prototype.hasOwnProperty.call(I,p)&&(a[p]=I[p])}}function ne(a){var _=1;a=a.split(":");const p=[];for(;0<_&&a.length;)p.push(a.shift()),_--;return a.length&&p.push(a.join(":")),p}function he(a){u.setTimeout(()=>{throw a},0)}function N(){var a=ec;let _=null;return a.g&&(_=a.g,a.g=a.g.next,a.g||(a.h=null),_.next=null),_}var $s=new class He{constructor(_,p){this.i=_,this.j=p,this.h=0,this.g=null}get(){let _;return 0<this.h?(this.h--,_=this.g,this.g=_.next,_.next=null):_=this.i(),_}}(()=>new qp,a=>a.reset());class qp{constructor(){this.next=this.g=this.h=null}set(_,p){this.h=_,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let qs,Ws=!1,ec=new class Fn{constructor(){this.h=this.g=null}add(_,p){const I=$s.get();I.set(_,p),this.h?this.h.next=I:this.g=I,this.h=I}},Nd=()=>{const a=u.Promise.resolve(void 0);qs=()=>{a.then(Wp)}};var Wp=()=>{for(var a;a=N();){try{a.h.call(a.g)}catch(p){he(p)}var _=$s;_.j(a),100>_.h&&(_.h++,a.next=_.g,_.g=a)}Ws=!1};function Hn(){this.s=this.s,this.C=this.C}function rn(a,_){this.type=a,this.g=this.target=_,this.defaultPrevented=!1}Hn.prototype.s=!1,Hn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Hn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},rn.prototype.h=function(){this.defaultPrevented=!0};var Kp=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,_=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const p=()=>{};u.addEventListener("test",p,_),u.removeEventListener("test",p,_)}catch{}return a}();function Ks(a,_){if(rn.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var p=this.type=a.type,I=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=_,_=a.relatedTarget){if(Tt){e:{try{ht(_.nodeName);var ae=!0;break e}catch{}ae=!1}ae||(_=null)}}else"mouseover"==p?_=a.fromElement:"mouseout"==p&&(_=a.toElement);this.relatedTarget=_,I?(this.clientX=void 0!==I.clientX?I.clientX:I.pageX,this.clientY=void 0!==I.clientY?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Yp[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Ks.aa.h.call(this)}}Se(Ks,rn);var Yp={2:"touch",3:"pen",4:"mouse"};Ks.prototype.h=function(){Ks.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ys="closure_listenable_"+(1e6*Math.random()|0),Qp=0;function Xp(a,_,p,I,ae){this.listener=a,this.proxy=null,this.src=_,this.type=p,this.capture=!!I,this.ha=ae,this.key=++Qp,this.da=this.fa=!1}function uo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ho(a){this.src=a,this.g={},this.h=0}function tc(a,_){var p=_.type;if(p in a.g){var ye,I=a.g[p],ae=Array.prototype.indexOf.call(I,_,void 0);(ye=0<=ae)&&Array.prototype.splice.call(I,ae,1),ye&&(uo(_),0==a.g[p].length&&(delete a.g[p],a.h--))}}function nc(a,_,p,I){for(var ae=0;ae<a.length;++ae){var ye=a[ae];if(!ye.da&&ye.listener==_&&ye.capture==!!p&&ye.ha==I)return ae}return-1}ho.prototype.add=function(a,_,p,I,ae){var ye=a.toString();(a=this.g[ye])||(a=this.g[ye]=[],this.h++);var qe=nc(a,_,I,ae);return-1<qe?(_=a[qe],p||(_.fa=!1)):((_=new Xp(_,this.src,ye,!!I,ae)).fa=p,a.push(_)),_};var rc="closure_lm_"+(1e6*Math.random()|0),sc={};function zd(a,_,p,I,ae){if(I&&I.once)return Bd(a,_,p,I,ae);if(Array.isArray(_)){for(var ye=0;ye<_.length;ye++)zd(a,_[ye],p,I,ae);return null}return p=lc(p),a&&a[Ys]?a.K(_,p,f(I)?!!I.capture:!!I,ae):jd(a,_,p,!1,I,ae)}function jd(a,_,p,I,ae,ye){if(!_)throw Error("Invalid event type");var qe=f(ae)?!!ae.capture:!!ae,Rt=oc(a);if(Rt||(a[rc]=Rt=new ho(a)),(p=Rt.add(_,p,I,qe,ye)).proxy)return p;if(I=function Jp(){const _=Hp;return function a(p){return _.call(a.src,a.listener,p)}}(),p.proxy=I,I.src=a,I.listener=p,a.addEventListener)Kp||(ae=qe),void 0===ae&&(ae=!1),a.addEventListener(_.toString(),I,ae);else if(a.attachEvent)a.attachEvent(Gd(_.toString()),I);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(I)}return p}function Bd(a,_,p,I,ae){if(Array.isArray(_)){for(var ye=0;ye<_.length;ye++)Bd(a,_[ye],p,I,ae);return null}return p=lc(p),a&&a[Ys]?a.L(_,p,f(I)?!!I.capture:!!I,ae):jd(a,_,p,!0,I,ae)}function Ld(a,_,p,I,ae){if(Array.isArray(_))for(var ye=0;ye<_.length;ye++)Ld(a,_[ye],p,I,ae);else I=f(I)?!!I.capture:!!I,p=lc(p),a&&a[Ys]?(a=a.i,(_=String(_).toString())in a.g&&-1<(p=nc(ye=a.g[_],p,I,ae))&&(uo(ye[p]),Array.prototype.splice.call(ye,p,1),0==ye.length&&(delete a.g[_],a.h--))):a&&(a=oc(a))&&(_=a.g[_.toString()],a=-1,_&&(a=nc(_,p,I,ae)),(p=-1<a?_[a]:null)&&ic(p))}function ic(a){if("number"!=typeof a&&a&&!a.da){var _=a.src;if(_&&_[Ys])tc(_.i,a);else{var p=a.type,I=a.proxy;_.removeEventListener?_.removeEventListener(p,I,a.capture):_.detachEvent?_.detachEvent(Gd(p),I):_.addListener&&_.removeListener&&_.removeListener(I),(p=oc(_))?(tc(p,a),0==p.h&&(p.src=null,_[rc]=null)):uo(a)}}}function Gd(a){return a in sc?sc[a]:sc[a]="on"+a}function Hp(a,_){if(a.da)a=!0;else{_=new Ks(_,this);var p=a.listener,I=a.ha||a.src;a.fa&&ic(a),a=p.call(I,_)}return a}function oc(a){return(a=a[rc])instanceof ho?a:null}var ac="__closure_events_fn_"+(1e9*Math.random()>>>0);function lc(a){return"function"==typeof a?a:(a[ac]||(a[ac]=function(_){return a.handleEvent(_)}),a[ac])}function sn(){Hn.call(this),this.i=new ho(this),this.M=this,this.F=null}function ln(a,_){var p,I=a.F;if(I)for(p=[];I;I=I.F)p.push(I);if(a=a.M,I=_.type||_,"string"==typeof _)_=new rn(_,a);else if(_ instanceof rn)_.target=_.target||a;else{var ae=_;Q(_=new rn(I,a),ae)}if(ae=!0,p)for(var ye=p.length-1;0<=ye;ye--){var qe=_.g=p[ye];ae=_o(qe,I,!0,_)&&ae}if(ae=_o(qe=_.g=a,I,!0,_)&&ae,ae=_o(qe,I,!1,_)&&ae,p)for(ye=0;ye<p.length;ye++)ae=_o(qe=_.g=p[ye],I,!1,_)&&ae}function _o(a,_,p,I){if(!(_=a.i.g[String(_)]))return!0;_=_.concat();for(var ae=!0,ye=0;ye<_.length;++ye){var qe=_[ye];if(qe&&!qe.da&&qe.capture==p){var Rt=qe.listener,Jt=qe.ha||qe.src;qe.fa&&tc(a.i,qe),ae=!1!==Rt.call(Jt,I)&&ae}}return ae&&!I.defaultPrevented}function Ud(a,_,p){if("function"==typeof a)p&&(a=P(a,p));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=P(a.handleEvent,a)}return 2147483647<Number(_)?-1:u.setTimeout(a,_||0)}function $d(a){a.g=Ud(()=>{a.g=null,a.i&&(a.i=!1,$d(a))},a.l);const _=a.h;a.h=null,a.m.apply(null,_)}Se(sn,Hn),sn.prototype[Ys]=!0,sn.prototype.removeEventListener=function(a,_,p,I){Ld(this,a,_,p,I)},sn.prototype.N=function(){if(sn.aa.N.call(this),this.i){var _,a=this.i;for(_ in a.g){for(var p=a.g[_],I=0;I<p.length;I++)uo(p[I]);delete a.g[_],a.h--}}this.F=null},sn.prototype.K=function(a,_,p,I){return this.i.add(String(a),_,!1,p,I)},sn.prototype.L=function(a,_,p,I){return this.i.add(String(a),_,!0,p,I)};class Zp extends Hn{constructor(_,p){super(),this.m=_,this.l=p,this.h=null,this.i=!1,this.g=null}j(_){this.h=arguments,this.g?this.i=!0:$d(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qs(a){Hn.call(this),this.h=a,this.g={}}Se(Qs,Hn);var qd=[];function Wd(a){ft(a.g,function(_,p){this.g.hasOwnProperty(p)&&ic(_)},a),a.g={}}Qs.prototype.N=function(){Qs.aa.N.call(this),Wd(this)},Qs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cc=u.JSON.stringify,eg=u.JSON.parse,tg=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function uc(){}function Yd(){}uc.prototype.h=null;var Xs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function hc(){rn.call(this,"d")}function dc(){rn.call(this,"c")}Se(hc,rn),Se(dc,rn);var wr={},Qd=null;function mo(){return Qd=Qd||new sn}function Xd(a){rn.call(this,wr.La,a)}function Js(a){const _=mo();ln(_,new Xd(_))}function Jd(a,_){rn.call(this,wr.STAT_EVENT,a),this.stat=_}function cn(a){const _=mo();ln(_,new Jd(_,a))}function Hd(a,_){rn.call(this,wr.Ma,a),this.size=_}function Hs(a,_){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},_)}function Zs(){this.g=!0}function is(a,_,p,I){a.info(function(){return"XMLHTTP TEXT ("+_+"): "+function ig(a,_){if(!a.g)return _;if(!_)return null;try{var p=JSON.parse(_);if(p)for(a=0;a<p.length;a++)if(Array.isArray(p[a])){var I=p[a];if(!(2>I.length)){var ae=I[1];if(Array.isArray(ae)&&!(1>ae.length)){var ye=ae[0];if("noop"!=ye&&"stop"!=ye&&"close"!=ye)for(var qe=1;qe<ae.length;qe++)ae[qe]=""}}}return cc(p)}catch{return _}}(a,p)+(I?" "+I:"")})}wr.La="serverreachability",Se(Xd,rn),wr.STAT_EVENT="statevent",Se(Jd,rn),wr.Ma="timingevent",Se(Hd,rn),Zs.prototype.xa=function(){this.g=!1},Zs.prototype.info=function(){};var _c,fo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Zd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function po(){}function Zn(a,_,p,I){this.j=a,this.i=_,this.l=p,this.R=I||1,this.U=new Qs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new e_}function e_(){this.i=null,this.g="",this.h=!1}Se(po,uc),po.prototype.g=function(){return new XMLHttpRequest},po.prototype.i=function(){return{}},_c=new po;var t_={},mc={};function fc(a,_,p){a.L=1,a.v=wo(Vn(_)),a.m=p,a.P=!0,n_(a,null)}function n_(a,_){a.F=Date.now(),go(a),a.A=Vn(a.v);var p=a.A,I=a.R;Array.isArray(I)||(I=[String(I)]),p_(p.i,"t",I),a.C=0,p=a.j.J,a.h=new e_,a.g=D_(a.j,p?_:null,!a.m),0<a.O&&(a.M=new Zp(P(a.Y,a,a.g),a.O)),_=a.U,p=a.g,I=a.ca;var ae="readystatechange";Array.isArray(ae)||(ae&&(qd[0]=ae.toString()),ae=qd);for(var ye=0;ye<ae.length;ye++){var qe=zd(p,ae[ye],I||_.handleEvent,!1,_.h||_);if(!qe)break;_.g[qe.key]=qe}_=a.H?M(a.H):{},a.m?(a.u||(a.u="POST"),_["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,_)):(a.u="GET",a.g.ea(a.A,a.u,null,_)),Js(),function ng(a,_,p,I,ae,ye){a.info(function(){if(a.g)if(ye)for(var qe="",Rt=ye.split("&"),Jt=0;Jt<Rt.length;Jt++){var bt=Rt[Jt].split("=");if(1<bt.length){var on=bt[0];bt=bt[1];var an=on.split("_");qe=2<=an.length&&"type"==an[1]?qe+(on+"=")+bt+"&":qe+(on+"=redacted&")}}else qe=null;else qe=ye;return"XMLHTTP REQ ("+I+") [attempt "+ae+"]: "+_+"\n"+p+"\n"+qe})}(a.i,a.u,a.A,a.l,a.R,a.m)}function r_(a){return!!a.g&&"GET"==a.u&&2!=a.L&&a.j.Ca}function og(a,_){var p=a.C,I=_.indexOf("\n",p);return-1==I?mc:(p=Number(_.substring(p,I)),isNaN(p)?t_:(I+=1)+p>_.length?mc:(_=_.slice(I,I+p),a.C=I+p,_))}function go(a){a.S=Date.now()+a.I,s_(a,a.I)}function s_(a,_){if(null!=a.B)throw Error("WatchDog timer not null");a.B=Hs(P(a.ba,a),_)}function pc(a){a.B&&(u.clearTimeout(a.B),a.B=null)}function ei(a){0==a.j.G||a.J||O_(a.j,a)}function xr(a){pc(a);var _=a.M;_&&"function"==typeof _.ma&&_.ma(),a.M=null,Wd(a.U),a.g&&(_=a.g,a.g=null,_.abort(),_.ma())}function gc(a,_){try{var p=a.j;if(0!=p.G&&(p.g==a||yc(p.h,a)))if(!a.K&&yc(p.h,a)&&3==p.G){try{var I=p.Da.g.parse(_)}catch{I=null}if(Array.isArray(I)&&3==I.length){var ae=I;if(0==ae[0]){e:if(!p.u){if(p.g){if(!(p.g.F+3e3<a.F))break e;Eo(p),bo(p)}Tc(p),cn(18)}}else p.za=ae[1],0<p.za-p.T&&37500>ae[2]&&p.F&&0==p.v&&!p.C&&(p.C=Hs(P(p.Za,p),6e3));if(1>=a_(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else br(p,11)}else if((a.K||p.g==a)&&Eo(p),!st(_))for(ae=p.Da.g.parse(_),_=0;_<ae.length;_++){let bt=ae[_];if(p.T=bt[0],bt=bt[1],2==p.G)if("c"==bt[0]){p.K=bt[1],p.ia=bt[2];const on=bt[3];null!=on&&(p.la=on,p.j.info("VER="+p.la));const an=bt[4];null!=an&&(p.Aa=an,p.j.info("SVER="+p.Aa));const ls=bt[5];null!=ls&&"number"==typeof ls&&0<ls&&(p.L=I=1.5*ls,p.j.info("backChannelRequestTimeoutMs_="+I)),I=p;const gn=a.g;if(gn){const Co=gn.g?gn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Co){var ye=I.h;ye.g||-1==Co.indexOf("spdy")&&-1==Co.indexOf("quic")&&-1==Co.indexOf("h2")||(ye.j=ye.l,ye.g=new Set,ye.h&&(vc(ye,ye.h),ye.h=null))}if(I.D){const Ic=gn.g?gn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ic&&(I.ya=Ic,Mt(I.I,I.D,Ic))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-a.F,p.j.info("Handshake RTT: "+p.R+"ms"));var qe=a;if((I=p).qa=M_(I,I.J?I.ia:null,I.W),qe.K){l_(I.h,qe);var Rt=qe,Jt=I.L;Jt&&(Rt.I=Jt),Rt.B&&(pc(Rt),go(Rt)),I.g=qe}else S_(I);0<p.i.length&&Io(p)}else"stop"!=bt[0]&&"close"!=bt[0]||br(p,7);else 3==p.G&&("stop"==bt[0]||"close"==bt[0]?"stop"==bt[0]?br(p,7):xc(p):"noop"!=bt[0]&&p.l&&p.l.ta(bt),p.v=0)}Js()}catch{}}Zn.prototype.ca=function(a){a=a.target;const _=this.M;_&&3==Nn(a)?_.j():this.Y(a)},Zn.prototype.Y=function(a){try{if(a==this.g)e:{const an=Nn(this.g);var _=this.g.Ba();if(this.g.Z(),!(3>an)&&(3!=an||this.g&&(this.h.h||this.g.oa()||b_(this.g)))){this.J||4!=an||7==_||Js(),pc(this);var p=this.g.Z();this.X=p;t:if(r_(this)){var I=b_(this.g);a="";var ae=I.length,ye=4==Nn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){xr(this),ei(this);var qe="";break t}this.h.i=new u.TextDecoder}for(_=0;_<ae;_++)this.h.h=!0,a+=this.h.i.decode(I[_],{stream:!(ye&&_==ae-1)});I.length=0,this.h.g+=a,this.C=0,qe=this.h.g}else qe=this.g.oa();if(this.o=200==p,function rg(a,_,p,I,ae,ye,qe){a.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+ae+"]: "+_+"\n"+p+"\n"+ye+" "+qe})}(this.i,this.u,this.A,this.l,this.R,an,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Rt,Jt=this.g;if((Rt=Jt.g?Jt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!st(Rt)){var bt=Rt;break t}}bt=null}if(!(p=bt)){this.o=!1,this.s=3,cn(12),xr(this),ei(this);break e}is(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gc(this,p)}if(this.P){let gn;for(p=!0;!this.J&&this.C<qe.length;){if(gn=og(this,qe),gn==mc){4==an&&(this.s=4,cn(14),p=!1),is(this.i,this.l,null,"[Incomplete Response]");break}if(gn==t_){this.s=4,cn(15),is(this.i,this.l,qe,"[Invalid Chunk]"),p=!1;break}is(this.i,this.l,gn,null),gc(this,gn)}if(r_(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=an||0!=qe.length||this.h.h||(this.s=1,cn(16),p=!1),this.o=this.o&&p,p){if(0<qe.length&&!this.W){this.W=!0;var on=this.j;on.g==this&&on.ba&&!on.M&&(on.j.info("Great, no buffering proxy detected. Bytes received: "+qe.length),bc(on),on.M=!0,cn(11))}}else is(this.i,this.l,qe,"[Invalid Chunked Response]"),xr(this),ei(this)}else is(this.i,this.l,qe,null),gc(this,qe);4==an&&xr(this),this.o&&!this.J&&(4==an?O_(this.j,this):(this.o=!1,go(this)))}else(function bg(a){const _={};a=(a.g&&2<=Nn(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let I=0;I<a.length;I++){if(st(a[I]))continue;var p=ne(a[I]);const ae=p[0];if("string"!=typeof(p=p[1]))continue;p=p.trim();const ye=_[ae]||[];_[ae]=ye,ye.push(p)}!function Y(a,_){for(const p in a)_.call(void 0,a[p],p,a)}(_,function(I){return I.join(", ")})})(this.g),400==p&&0<qe.indexOf("Unknown SID")?(this.s=3,cn(12)):(this.s=0,cn(13)),xr(this),ei(this)}}}catch{}},Zn.prototype.cancel=function(){this.J=!0,xr(this)},Zn.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(function sg(a,_){a.info(function(){return"TIMEOUT: "+_})}(this.i,this.A),2!=this.L&&(Js(),cn(17)),xr(this),this.s=2,ei(this)):s_(this,this.S-a)};var ag=class{constructor(a,_){this.g=a,this.map=_}};function i_(a){this.l=a||10,a=u.PerformanceNavigationTiming?0<(a=u.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function o_(a){return!!a.h||!!a.g&&a.g.size>=a.j}function a_(a){return a.h?1:a.g?a.g.size:0}function yc(a,_){return a.h?a.h==_:!!a.g&&a.g.has(_)}function vc(a,_){a.g?a.g.add(_):a.h=_}function l_(a,_){a.h&&a.h==_?a.h=null:a.g&&a.g.has(_)&&a.g.delete(_)}function c_(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let _=a.i;for(const p of a.g.values())_=_.concat(p.D);return _}return je(a.i)}function u_(a,_){if(a.forEach&&"function"==typeof a.forEach)a.forEach(_,void 0);else if(h(a)||"string"==typeof a)Array.prototype.forEach.call(a,_,void 0);else for(var p=function cg(a){if(a.na&&"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(h(a)||"string"==typeof a){var _=[];a=a.length;for(var p=0;p<a;p++)_.push(p);return _}_=[],p=0;for(const I in a)_[p++]=I;return _}}}(a),I=function lg(a){if(a.V&&"function"==typeof a.V)return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(h(a)){for(var _=[],p=a.length,I=0;I<p;I++)_.push(a[I]);return _}for(I in _=[],p=0,a)_[p++]=a[I];return _}(a),ae=I.length,ye=0;ye<ae;ye++)_.call(void 0,I[ye],p&&p[ye],a)}i_.prototype.cancel=function(){if(this.i=c_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var h_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Tr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Tr){this.h=a.h,yo(this,a.j),this.o=a.o,this.g=a.g,vo(this,a.s),this.l=a.l;var _=a.i,p=new ri;p.i=_.i,_.g&&(p.g=new Map(_.g),p.h=_.h),d_(this,p),this.m=a.m}else a&&(_=String(a).match(h_))?(this.h=!1,yo(this,_[1]||"",!0),this.o=ti(_[2]||""),this.g=ti(_[3]||"",!0),vo(this,_[4]),this.l=ti(_[5]||"",!0),d_(this,_[6]||"",!0),this.m=ti(_[7]||"")):(this.h=!1,this.i=new ri(null,this.h))}function Vn(a){return new Tr(a)}function yo(a,_,p){a.j=p?ti(_,!0):_,a.j&&(a.j=a.j.replace(/:$/,""))}function vo(a,_){if(_){if(_=Number(_),isNaN(_)||0>_)throw Error("Bad port number "+_);a.s=_}else a.s=null}function d_(a,_,p){_ instanceof ri?(a.i=_,function pg(a,_){_&&!a.j&&(er(a),a.i=null,a.g.forEach(function(p,I){var ae=I.toLowerCase();I!=ae&&(m_(this,I),p_(this,ae,p))},a)),a.j=_}(a.i,a.h)):(p||(_=ni(_,mg)),a.i=new ri(_,a.h))}function Mt(a,_,p){a.i.set(_,p)}function wo(a){return Mt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ti(a,_){return a?_?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ni(a,_,p){return"string"==typeof a?(a=encodeURI(a).replace(_,hg),p&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function hg(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Tr.prototype.toString=function(){var a=[],_=this.j;_&&a.push(ni(_,__,!0),":");var p=this.g;return(p||"file"==_)&&(a.push("//"),(_=this.o)&&a.push(ni(_,__,!0),"@"),a.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(p=this.s)&&a.push(":",String(p))),(p=this.l)&&(this.g&&"/"!=p.charAt(0)&&a.push("/"),a.push(ni(p,"/"==p.charAt(0)?_g:dg,!0))),(p=this.i.toString())&&a.push("?",p),(p=this.m)&&a.push("#",ni(p,fg)),a.join("")};var __=/[#\/\?@]/g,dg=/[#\?:]/g,_g=/[#\?]/g,mg=/[#\?@]/g,fg=/#/g;function ri(a,_){this.h=this.g=null,this.i=a||null,this.j=!!_}function er(a){a.g||(a.g=new Map,a.h=0,a.i&&function ug(a,_){if(a){a=a.split("&");for(var p=0;p<a.length;p++){var I=a[p].indexOf("="),ae=null;if(0<=I){var ye=a[p].substring(0,I);ae=a[p].substring(I+1)}else ye=a[p];_(ye,ae?decodeURIComponent(ae.replace(/\+/g," ")):"")}}}(a.i,function(_,p){a.add(decodeURIComponent(_.replace(/\+/g," ")),p)}))}function m_(a,_){er(a),_=os(a,_),a.g.has(_)&&(a.i=null,a.h-=a.g.get(_).length,a.g.delete(_))}function f_(a,_){return er(a),_=os(a,_),a.g.has(_)}function p_(a,_,p){m_(a,_),0<p.length&&(a.i=null,a.g.set(os(a,_),je(p)),a.h+=p.length)}function os(a,_){return _=String(_),a.j&&(_=_.toLowerCase()),_}function tr(a,_,p,I,ae){try{ae&&(ae.onload=null,ae.onerror=null,ae.onabort=null,ae.ontimeout=null),I(p)}catch{}}function vg(){this.g=new tg}function wg(a,_,p){const I=p||"";try{u_(a,function(ae,ye){let qe=ae;f(ae)&&(qe=cc(ae)),_.push(I+ye+"="+encodeURIComponent(qe))})}catch(ae){throw _.push(I+"type="+encodeURIComponent("_badmap")),ae}}function si(a){this.l=a.Ub||null,this.j=a.eb||!1}function xo(a,_){sn.call(this),this.D=a,this.o=_,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function g_(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function ii(a){a.readyState=4,a.l=null,a.j=null,a.v=null,oi(a)}function oi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function y_(a){let _="";return ft(a,function(p,I){_+=I,_+=":",_+=p,_+="\r\n"}),_}function wc(a,_,p){e:{for(I in p){var I=!1;break e}I=!0}I||(p=y_(p),"string"==typeof a?null!=p&&encodeURIComponent(String(p)):Mt(a,_,p))}function jt(a){sn.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ri.prototype).add=function(a,_){er(this),this.i=null,a=os(this,a);var p=this.g.get(a);return p||this.g.set(a,p=[]),p.push(_),this.h+=1,this},r.forEach=function(a,_){er(this),this.g.forEach(function(p,I){p.forEach(function(ae){a.call(_,ae,I,this)},this)},this)},r.na=function(){er(this);const a=Array.from(this.g.values()),_=Array.from(this.g.keys()),p=[];for(let I=0;I<_.length;I++){const ae=a[I];for(let ye=0;ye<ae.length;ye++)p.push(_[I])}return p},r.V=function(a){er(this);let _=[];if("string"==typeof a)f_(this,a)&&(_=_.concat(this.g.get(os(this,a))));else{a=Array.from(this.g.values());for(let p=0;p<a.length;p++)_=_.concat(a[p])}return _},r.set=function(a,_){return er(this),this.i=null,f_(this,a=os(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[_]),this.h+=1,this},r.get=function(a,_){return a&&0<(a=this.V(a)).length?String(a[0]):_},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],_=Array.from(this.g.keys());for(var p=0;p<_.length;p++){var I=_[p];const ye=encodeURIComponent(String(I)),qe=this.V(I);for(I=0;I<qe.length;I++){var ae=ye;""!==qe[I]&&(ae+="="+encodeURIComponent(String(qe[I]))),a.push(ae)}}return this.i=a.join("&")},Se(si,uc),si.prototype.g=function(){return new xo(this.l,this.j)},si.prototype.i=function(a){return function(){return a}}({}),Se(xo,sn),(r=xo.prototype).open=function(a,_){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=_,this.readyState=1,oi(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const _={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(_.body=a),(this.D||u).fetch(new Request(this.A,_)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ii(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,oi(this)),this.g&&(this.readyState=3,oi(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;g_(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var _=a.value?a.value:new Uint8Array(0);(_=this.v.decode(_,{stream:!a.done}))&&(this.response=this.responseText+=_)}a.done?ii(this):oi(this),3==this.readyState&&g_(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,ii(this))},r.Qa=function(a){this.g&&(this.response=a,ii(this))},r.ga=function(){this.g&&ii(this)},r.setRequestHeader=function(a,_){this.u.append(a,_)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],_=this.h.entries();for(var p=_.next();!p.done;)a.push((p=p.value)[0]+": "+p[1]),p=_.next();return a.join("\r\n")},Object.defineProperty(xo.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),Se(jt,sn);var xg=/^https?$/i,Tg=["POST","PUT"];function v_(a,_){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=_,a.m=5,w_(a),To(a)}function w_(a){a.A||(a.A=!0,ln(a,"complete"),ln(a,"error"))}function x_(a){if(a.h&&typeof o<"u"&&(!a.v[1]||4!=Nn(a)||2!=a.Z()))if(a.u&&4==Nn(a))Ud(a.Ea,0,a);else if(ln(a,"readystatechange"),4==Nn(a)){a.h=!1;try{const qe=a.Z();e:switch(qe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var _=!0;break e;default:_=!1}var p;if(!(p=_)){var I;if(I=0===qe){var ae=String(a.D).match(h_)[1]||null;!ae&&u.self&&u.self.location&&(ae=u.self.location.protocol.slice(0,-1)),I=!xg.test(ae?ae.toLowerCase():"")}p=I}if(p)ln(a,"complete"),ln(a,"success");else{a.m=6;try{var ye=2<Nn(a)?a.g.statusText:""}catch{ye=""}a.l=ye+" ["+a.Z()+"]",w_(a)}}finally{To(a)}}}function To(a,_){if(a.g){T_(a);const p=a.g,I=a.v[0]?()=>{}:null;a.g=null,a.v=null,_||ln(a,"ready");try{p.onreadystatechange=I}catch{}}}function T_(a){a.I&&(u.clearTimeout(a.I),a.I=null)}function Nn(a){return a.g?a.g.readyState:0}function b_(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function ai(a,_,p){return p&&p.internalChannelParams&&p.internalChannelParams[a]||_}function I_(a){this.Aa=0,this.i=[],this.j=new Zs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ai("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ai("baseRetryDelayMs",5e3,a),this.cb=ai("retryDelaySeedMs",1e4,a),this.Wa=ai("forwardChannelMaxRetries",2,a),this.wa=ai("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new i_(a&&a.concurrentRequestLimit),this.Da=new vg,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function xc(a){if(E_(a),3==a.G){var _=a.U++,p=Vn(a.I);if(Mt(p,"SID",a.K),Mt(p,"RID",_),Mt(p,"TYPE","terminate"),li(a,p),(_=new Zn(a,a.j,_)).L=2,_.v=wo(Vn(p)),p=!1,u.navigator&&u.navigator.sendBeacon)try{p=u.navigator.sendBeacon(_.v.toString(),"")}catch{}!p&&u.Image&&((new Image).src=_.v,p=!0),p||(_.g=D_(_.j,null),_.g.ea(_.v)),_.F=Date.now(),go(_)}k_(a)}function bo(a){a.g&&(bc(a),a.g.cancel(),a.g=null)}function E_(a){bo(a),a.u&&(u.clearTimeout(a.u),a.u=null),Eo(a),a.h.cancel(),a.s&&("number"==typeof a.s&&u.clearTimeout(a.s),a.s=null)}function Io(a){if(!o_(a.h)&&!a.s){a.s=!0;var _=a.Ga;qs||Nd(),Ws||(qs(),Ws=!0),ec.add(_,a),a.B=0}}function A_(a,_){var p;p=_?_.l:a.U++;const I=Vn(a.I);Mt(I,"SID",a.K),Mt(I,"RID",p),Mt(I,"AID",a.T),li(a,I),a.m&&a.o&&wc(I,a.m,a.o),p=new Zn(a,a.j,p,a.B+1),null===a.m&&(p.H=a.o),_&&(a.i=_.D.concat(a.i)),_=C_(a,p,1e3),p.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),vc(a.h,p),fc(p,I,_)}function li(a,_){a.H&&ft(a.H,function(p,I){Mt(_,I,p)}),a.l&&u_({},function(p,I){Mt(_,I,p)})}function C_(a,_,p){p=Math.min(a.i.length,p);var I=a.l?P(a.l.Na,a.l,a):null;e:{var ae=a.i;let ye=-1;for(;;){const qe=["count="+p];-1==ye?0<p?(ye=ae[0].g,qe.push("ofs="+ye)):ye=0:qe.push("ofs="+ye);let Rt=!0;for(let Jt=0;Jt<p;Jt++){let bt=ae[Jt].g;const on=ae[Jt].map;if(bt-=ye,0>bt)ye=Math.max(0,ae[Jt].g-100),Rt=!1;else try{wg(on,qe,"req"+bt+"_")}catch{I&&I(on)}}if(Rt){I=qe.join("&");break e}}}return a=a.i.splice(0,p),_.D=a,I}function S_(a){if(!a.g&&!a.u){a.Y=1;var _=a.Fa;qs||Nd(),Ws||(qs(),Ws=!0),ec.add(_,a),a.v=0}}function Tc(a){return!(a.g||a.u||3<=a.v||(a.Y++,a.u=Hs(P(a.Fa,a),P_(a,a.v)),a.v++,0))}function bc(a){null!=a.A&&(u.clearTimeout(a.A),a.A=null)}function R_(a){a.g=new Zn(a,a.j,"rpc",a.Y),null===a.m&&(a.g.H=a.o),a.g.O=0;var _=Vn(a.qa);Mt(_,"RID","rpc"),Mt(_,"SID",a.K),Mt(_,"AID",a.T),Mt(_,"CI",a.F?"0":"1"),!a.F&&a.ja&&Mt(_,"TO",a.ja),Mt(_,"TYPE","xmlhttp"),li(a,_),a.m&&a.o&&wc(_,a.m,a.o),a.L&&(a.g.I=a.L);var p=a.g;a=a.ia,p.L=1,p.v=wo(Vn(_)),p.m=null,p.P=!0,n_(p,a)}function Eo(a){null!=a.C&&(u.clearTimeout(a.C),a.C=null)}function O_(a,_){var p=null;if(a.g==_){Eo(a),bc(a),a.g=null;var I=2}else{if(!yc(a.h,_))return;p=_.D,l_(a.h,_),I=1}if(0!=a.G)if(_.o)if(1==I){p=_.m?_.m.length:0,_=Date.now()-_.F;var ae=a.B;ln(I=mo(),new Hd(I,p)),Io(a)}else S_(a);else if(3==(ae=_.s)||0==ae&&0<_.X||!(1==I&&function Ig(a,_){return!(a_(a.h)>=a.h.j-(a.s?1:0)||(a.s?(a.i=_.D.concat(a.i),0):1==a.G||2==a.G||a.B>=(a.Va?0:a.Wa)||(a.s=Hs(P(a.Ga,a,_),P_(a,a.B)),a.B++,0)))}(a,_)||2==I&&Tc(a)))switch(p&&0<p.length&&(_=a.h,_.i=_.i.concat(p)),ae){case 1:br(a,5);break;case 4:br(a,10);break;case 3:br(a,6);break;default:br(a,2)}}function P_(a,_){let p=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(p*=2),p*_}function br(a,_){if(a.j.info("Error code "+_),2==_){var p=P(a.fb,a),I=a.Xa;const ae=!I;I=new Tr(I||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||yo(I,"https"),wo(I),ae?function gg(a,_){const p=new Zs;if(u.Image){const I=new Image;I.onload=te(tr,p,"TestLoadImage: loaded",!0,_,I),I.onerror=te(tr,p,"TestLoadImage: error",!1,_,I),I.onabort=te(tr,p,"TestLoadImage: abort",!1,_,I),I.ontimeout=te(tr,p,"TestLoadImage: timeout",!1,_,I),u.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=a}else _(!1)}(I.toString(),p):function yg(a,_){new Zs;const I=new AbortController,ae=setTimeout(()=>{I.abort(),tr(0,0,!1,_)},1e4);fetch(a,{signal:I.signal}).then(ye=>{clearTimeout(ae),tr(0,0,!!ye.ok,_)}).catch(()=>{clearTimeout(ae),tr(0,0,!1,_)})}(I.toString(),p)}else cn(2);a.G=0,a.l&&a.l.sa(_),k_(a),E_(a)}function k_(a){if(a.G=0,a.ka=[],a.l){const _=c_(a.h);(0!=_.length||0!=a.i.length)&&(De(a.ka,_),De(a.ka,a.i),a.h.i.length=0,je(a.i),a.i.length=0),a.l.ra()}}function M_(a,_,p){var I=p instanceof Tr?Vn(p):new Tr(p);if(""!=I.g)_&&(I.g=_+"."+I.g),vo(I,I.s);else{var ae=u.location;I=ae.protocol,_=_?_+"."+ae.hostname:ae.hostname,ae=+ae.port;var ye=new Tr(null);I&&yo(ye,I),_&&(ye.g=_),ae&&vo(ye,ae),p&&(ye.l=p),I=ye}return _=a.ya,(p=a.D)&&_&&Mt(I,p,_),Mt(I,"VER",a.la),li(a,I),I}function D_(a,_,p){if(_&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(_=new jt(a.Ca&&!a.pa?new si({eb:p}):a.pa)).Ha(a.J),_}function F_(){}function Ao(){}function _n(a,_){sn.call(this),this.g=new I_(_),this.l=a,this.h=_&&_.messageUrlParams||null,a=_&&_.messageHeaders||null,_&&_.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=_&&_.initMessageHeaders||null,_&&_.messageContentType&&(a?a["X-WebChannel-Content-Type"]=_.messageContentType:a={"X-WebChannel-Content-Type":_.messageContentType}),_&&_.va&&(a?a["X-WebChannel-Client-Profile"]=_.va:a={"X-WebChannel-Client-Profile":_.va}),this.g.S=a,(a=_&&_.Sb)&&!st(a)&&(this.g.m=a),this.v=_&&_.supportsCrossDomainXhr||!1,this.u=_&&_.sendRawJson||!1,(_=_&&_.httpSessionIdParam)&&!st(_)&&(this.g.D=_,null!==(a=this.h)&&_ in a&&_ in(a=this.h)&&delete a[_]),this.j=new as(this)}function V_(a){hc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var _=a.__sm__;if(_){e:{for(const p in _){a=p;break e}a=void 0}(this.i=a)&&(a=this.i,_=null!==_&&a in _?_[a]:void 0),this.data=_}else this.data=a}function N_(){dc.call(this),this.status=1}function as(a){this.g=a}(r=jt.prototype).Ha=function(a){this.J=a},r.ea=function(a,_,p,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);_=_?_.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():_c.g(),this.v=function Kd(a){return a.h||(a.h=a.i())}(this.o?this.o:_c),this.g.onreadystatechange=P(this.Ea,this);try{this.B=!0,this.g.open(_,String(a),!0),this.B=!1}catch(ye){return void v_(this,ye)}if(a=p||"",p=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var ae in I)p.set(ae,I[ae]);else{if("function"!=typeof I.keys||"function"!=typeof I.get)throw Error("Unknown input type for opt_headers: "+String(I));for(const ye of I.keys())p.set(ye,I.get(ye))}I=Array.from(p.keys()).find(ye=>"content-type"==ye.toLowerCase()),ae=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Tg,_,void 0))||I||ae||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ye,qe]of p)this.g.setRequestHeader(ye,qe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{T_(this),this.u=!0,this.g.send(a),this.u=!1}catch(ye){v_(this,ye)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ln(this,"complete"),ln(this,"abort"),To(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),To(this,!0)),jt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?x_(this):this.bb())},r.bb=function(){x_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Nn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var _=this.g.responseText;return a&&0==_.indexOf(a)&&(_=_.substring(a.length)),eg(_)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=I_.prototype).la=8,r.G=1,r.connect=function(a,_,p,I){cn(0),this.W=a,this.H=_||{},p&&void 0!==I&&(this.H.OSID=p,this.H.OAID=I),this.F=this.X,this.I=M_(this,null,this.W),Io(this)},r.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const ae=new Zn(this,this.j,a);let ye=this.o;if(this.S&&(ye?(ye=M(ye),Q(ye,this.S)):ye=this.S),null!==this.m||this.O||(ae.H=ye,ye=null),this.P)e:{for(var _=0,p=0;p<this.i.length;p++){var I=this.i[p];if(void 0===(I="__data__"in I.map&&"string"==typeof(I=I.map.__data__)?I.length:void 0))break;if(4096<(_+=I)){_=p;break e}if(4096===_||p===this.i.length-1){_=p+1;break e}}_=1e3}else _=1e3;_=C_(this,ae,_),Mt(p=Vn(this.I),"RID",a),Mt(p,"CVER",22),this.D&&Mt(p,"X-HTTP-Session-Id",this.D),li(this,p),ye&&(this.O?_="headers="+encodeURIComponent(String(y_(ye)))+"&"+_:this.m&&wc(p,this.m,ye)),vc(this.h,ae),this.Ua&&Mt(p,"TYPE","init"),this.P?(Mt(p,"$req",_),Mt(p,"SID","null"),ae.T=!0,fc(ae,p,null)):fc(ae,p,_),this.G=2}}else 3==this.G&&(a?A_(this,a):0==this.i.length||o_(this.h)||A_(this))},r.Fa=function(){if(this.u=null,R_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Hs(P(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,cn(10),bo(this),R_(this))},r.Za=function(){null!=this.C&&(this.C=null,bo(this),Tc(this),cn(19))},r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=F_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Ao.prototype.g=function(a,_){return new _n(a,_)},Se(_n,sn),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){xc(this.g)},_n.prototype.o=function(a){var _=this.g;if("string"==typeof a){var p={};p.__data__=a,a=p}else this.u&&((p={}).__data__=cc(a),a=p);_.i.push(new ag(_.Ya++,a)),3==_.G&&Io(_)},_n.prototype.N=function(){this.g.l=null,delete this.j,xc(this.g),delete this.g,_n.aa.N.call(this)},Se(V_,hc),Se(N_,dc),Se(as,F_),as.prototype.ua=function(){ln(this.g,"a")},as.prototype.ta=function(a){ln(this.g,new V_(a))},as.prototype.sa=function(a){ln(this.g,new N_)},as.prototype.ra=function(){ln(this.g,"b")},Ao.prototype.createWebChannel=Ao.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,ie=D.createWebChannelTransport=function(){return new Ao},le=D.getStatEventTarget=function(){return mo()},_e=D.Event=wr,de=D.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},fo.NO_ERROR=0,fo.TIMEOUT=8,fo.HTTP_ERROR=6,U=D.ErrorCode=fo,Zd.COMPLETE="complete",w=D.EventType=Zd,Yd.EventType=Xs,Xs.OPEN="a",Xs.CLOSE="b",Xs.ERROR="c",Xs.MESSAGE="d",sn.prototype.listen=sn.prototype.K,V=D.WebChannel=Yd,J=D.FetchXmlHttpFactory=si,jt.prototype.listenOnce=jt.prototype.L,jt.prototype.getLastError=jt.prototype.Ka,jt.prototype.getLastErrorCode=jt.prototype.Ba,jt.prototype.getStatus=jt.prototype.Z,jt.prototype.getResponseJson=jt.prototype.Oa,jt.prototype.getResponseText=jt.prototype.oa,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Ha,Ie=D.XhrIo=jt}).apply(typeof q<"u"?q:typeof self<"u"?self:typeof window<"u"?window:{});const ze="@firebase/firestore";class Te{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Te.UNAUTHENTICATED=new Te(null),Te.GOOGLE_CREDENTIALS=new Te("google-credentials-uid"),Te.FIRST_PARTY=new Te("first-party-uid"),Te.MOCK_USER=new Te("mock-user");let Qe="10.13.2";const ve=new re.Vy("@firebase/firestore");function nt(){return ve.logLevel}function se(r,...e){if(ve.logLevel<=re.$b.DEBUG){const t=e.map(ge);ve.debug(`Firestore (${Qe}): ${r}`,...t)}}function ee(r,...e){if(ve.logLevel<=re.$b.ERROR){const t=e.map(ge);ve.error(`Firestore (${Qe}): ${r}`,...t)}}function Be(r,...e){if(ve.logLevel<=re.$b.WARN){const t=e.map(ge);ve.warn(`Firestore (${Qe}): ${r}`,...t)}}function ge(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function X(r="Unexpected state"){const e=`FIRESTORE (${Qe}) INTERNAL ASSERTION FAILED: `+r;throw ee(e),new Error(e)}function pe(r,e){r||X()}function Ee(r,e){return r}const H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xe extends y.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class mt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Et{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Te.UNAUTHENTICATED))}shutdown(){}}class Xe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class pt{constructor(e){this.t=e,this.currentUser=Te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let s=this.i;const i=f=>this.i!==s?(s=this.i,t(f)):Promise.resolve();let o=new mt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new mt,e.enqueueRetryable(()=>i(this.currentUser))};const u=()=>{const f=o;e.enqueueRetryable((0,l.A)(function*(){yield f.promise,yield i(n.currentUser)}))},h=f=>{se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(f=>h(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(se("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new mt)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(pe("string"==typeof n.accessToken),new rt(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return pe(null===e||"string"==typeof e),new Te(e)}}class Ze{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Te.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ge{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Ze(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Te.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class K{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ce{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=i=>{null!=i.error&&se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,se("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const s=i=>{se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(pe("string"==typeof t.token),this.R=t.token,new K(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function G(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class F{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=G(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[i]%62))}return n}}function S(r,e){return r<e?-1:r>e?1:0}function j(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}class Ne{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new xe(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xe(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new xe(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new xe(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ne.fromMillis(Date.now())}static fromDate(e){return Ne.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ne(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?S(this.nanoseconds,e.nanoseconds):S(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Oe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Oe(e)}static min(){return new Oe(new Ne(0,0))}static max(){return new Oe(new Ne(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class We{constructor(e,t,n){void 0===t?t=0:t>e.length&&X(),void 0===n?n=e.length-t:n>e.length-t&&X(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===We.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof We?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Le extends We{construct(e,t,n){return new Le(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new xe(H.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new Le(t)}static emptyPath(){return new Le([])}}const xt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Re extends We{construct(e,t,n){return new Re(e,t,n)}static isValidIdentifier(e){return xt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Re.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Re(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new xe(H.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;s<e.length;){const u=e[s];if("\\"===u){if(s+1===e.length)throw new xe(H.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new xe(H.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=h,s+=2}else"`"===u?(o=!o,s++):"."!==u||o?(n+=u,s++):(i(),s++)}if(i(),o)throw new xe(H.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Re(t)}static emptyPath(){return new Re([])}}class fe{constructor(e){this.path=e}static fromPath(e){return new fe(Le.fromString(e))}static fromName(e){return new fe(Le.fromString(e).popFirst(5))}static empty(){return new fe(Le.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Le.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Le.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new fe(new Le(e.slice()))}}class Ce{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ce(Oe.min(),fe.empty(),-1)}static max(){return new Ce(Oe.max(),fe.empty(),-1)}}function be(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=fe.comparator(r.documentKey,e.documentKey),0!==t?t:S(r.largestBatchId,e.largestBatchId))}const $e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ye{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Ke(r){return Je.apply(this,arguments)}function Je(){return(Je=(0,l.A)(function*(r){if(r.code!==H.FAILED_PRECONDITION||r.message!==$e)throw r;se("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):R.reject(t)}static resolve(e){return new R((t,n)=>{t(e)})}static reject(e){return new R((t,n)=>{n(e)})}static waitFor(e){return new R((t,n)=>{let s=0,i=0,o=!1;e.forEach(u=>{++s,u.next(()=>{++i,o&&i===s&&t()},h=>n(h))}),o=!0,i===s&&t()})}static or(e){let t=R.resolve(!1);for(const n of e)t=t.next(s=>s?R.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,i)=>{n.push(t.call(this,s,i))}),this.waitFor(n)}static mapArray(e,t){return new R((n,s)=>{const i=e.length,o=new Array(i);let u=0;for(let h=0;h<i;h++){const f=h;t(e[f]).next(g=>{o[f]=g,++u,u===i&&n(o)},g=>s(g))}})}static doWhile(e,t){return new R((n,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):n()};i()})}}function St(r){return"IndexedDbTransactionError"===r.name}let ut=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function dn(r){return null==r}function pn(r){return 0===r&&1/r==-1/0}function Zt(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function xn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Ac(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Pt{constructor(e,t){this.comparator=e,this.root=t||Yt.EMPTY}insert(e,t){return new Pt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Yt.BLACK,null,null))}remove(e){return new Pt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new di(this.root,e,this.comparator,!1)}getReverseIterator(){return new di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new di(this.root,e,this.comparator,!0)}}class di{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Yt{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Yt.RED,this.left=s??Yt.EMPTY,this.right=i??Yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Yt(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Yt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw X();const e=this.left.check();if(e!==this.right.check())throw X();return e+(this.isRed()?0:1)}}Yt.EMPTY=null,Yt.RED=!0,Yt.BLACK=!1,Yt.EMPTY=new class{constructor(){this.size=0}get key(){throw X()}get value(){throw X()}get color(){throw X()}get left(){throw X()}get right(){throw X()}copy(e,t,n,s,i){return this}insert(e,t,n){return new Yt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class At{constructor(e){this.comparator=e,this.data=new Pt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Cc(this.data.getIterator())}getIteratorFrom(e){return new Cc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class Cc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class un{constructor(e){this.fields=e,e.sort(Re.comparator)}static empty(){return new un([])}unionWith(e){let t=new At(Re.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new un(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return j(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Sc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class zt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Sc("Invalid base64 string: "+i):i}}(e);return new zt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new zt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return S(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}zt.EMPTY_BYTE_STRING=new zt("");const z_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sn(r){if(pe(!!r),"string"==typeof r){let e=0;const t=z_.exec(r);if(pe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Dt(r.seconds),nanos:Dt(r.nanos)}}function Dt(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Rn(r){return"string"==typeof r?zt.fromBase64String(r):zt.fromUint8Array(r)}function _i(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function mi(r){const e=r.mapValue.fields.__previous_value__;return _i(e)?mi(e):e}function cs(r){const e=Sn(r.mapValue.fields.__local_write_time__.timestampValue);return new Ne(e.seconds,e.nanos)}class j_{constructor(e,t,n,s,i,o,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f}}class rr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new rr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof rr&&e.projectId===this.projectId&&e.database===this.database}}const Bn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ln(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?_i(r)?4:Mc(r)?9007199254740991:yi(r)?10:11:X()}function Tn(r,e){if(r===e)return!0;const t=Ln(r);if(t!==Ln(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return cs(r).isEqual(cs(e));case 3:return function(s,i){if("string"==typeof s.timestampValue&&"string"==typeof i.timestampValue&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Sn(s.timestampValue),u=Sn(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return i=e,Rn(r.bytesValue).isEqual(Rn(i.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,i){return Dt(s.geoPointValue.latitude)===Dt(i.geoPointValue.latitude)&&Dt(s.geoPointValue.longitude)===Dt(i.geoPointValue.longitude)}(r,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Dt(s.integerValue)===Dt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Dt(s.doubleValue),u=Dt(i.doubleValue);return o===u?pn(o)===pn(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return j(r.arrayValue.values||[],e.arrayValue.values||[],Tn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},u=i.mapValue.fields||{};if(Zt(o)!==Zt(u))return!1;for(const h in o)if(o.hasOwnProperty(h)&&(void 0===u[h]||!Tn(o[h],u[h])))return!1;return!0}(r,e);default:return X()}var i}function us(r,e){return void 0!==(r.values||[]).find(t=>Tn(t,e))}function Gn(r,e){if(r===e)return 0;const t=Ln(r),n=Ln(e);if(t!==n)return S(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return S(r.booleanValue,e.booleanValue);case 2:return function(i,o){const u=Dt(i.integerValue||i.doubleValue),h=Dt(o.integerValue||o.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(r,e);case 3:return Rc(r.timestampValue,e.timestampValue);case 4:return Rc(cs(r),cs(e));case 5:return S(r.stringValue,e.stringValue);case 6:return function(i,o){const u=Rn(i),h=Rn(o);return u.compareTo(h)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const u=i.split("/"),h=o.split("/");for(let f=0;f<u.length&&f<h.length;f++){const g=S(u[f],h[f]);if(0!==g)return g}return S(u.length,h.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const u=S(Dt(i.latitude),Dt(o.latitude));return 0!==u?u:S(Dt(i.longitude),Dt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Oc(r.arrayValue,e.arrayValue);case 10:return function(i,o){var u,h,f,g;const te=null===(u=(i.fields||{}).value)||void 0===u?void 0:u.arrayValue,Se=null===(h=(o.fields||{}).value)||void 0===h?void 0:h.arrayValue,je=S((null===(f=te?.values)||void 0===f?void 0:f.length)||0,(null===(g=Se?.values)||void 0===g?void 0:g.length)||0);return 0!==je?je:Oc(te,Se)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===Bn.mapValue&&o===Bn.mapValue)return 0;if(i===Bn.mapValue)return 1;if(o===Bn.mapValue)return-1;const u=i.fields||{},h=Object.keys(u),f=o.fields||{},g=Object.keys(f);h.sort(),g.sort();for(let T=0;T<h.length&&T<g.length;++T){const P=S(h[T],g[T]);if(0!==P)return P;const te=Gn(u[h[T]],f[g[T]]);if(0!==te)return te}return S(h.length,g.length)}(r.mapValue,e.mapValue);default:throw X()}}function Rc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return S(r,e);const t=Sn(r),n=Sn(e),s=S(t.seconds,n.seconds);return 0!==s?s:S(t.nanos,n.nanos)}function Oc(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=Gn(t[s],n[s]);if(i)return i}return S(t.length,n.length)}function Er(r){return Go(r)}function Go(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Sn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Rn(r.bytesValue).toBase64():"referenceValue"in r?fe.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=Go(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${Go(t.fields[o])}`;return s+"}"}(r.mapValue):X()}function sr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Uo(r){return!!r&&"integerValue"in r}function hs(r){return!!r&&"arrayValue"in r}function Pc(r){return!!r&&"nullValue"in r}function kc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function gi(r){return!!r&&"mapValue"in r}function yi(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ds(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return xn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ds(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ds(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Mc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class Qt{constructor(e){this.value=e}static empty(){return new Qt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!gi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ds(t)}setAll(e){let t=Re.emptyPath(),n={},s=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,n,s),n={},s=[],t=u.popLast()}o?n[u.lastSegment()]=ds(o):s.push(u.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());gi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];gi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){xn(t,(s,i)=>e[s]=i);for(const s of n)delete e[s]}clone(){return new Qt(ds(this.value))}}function Nc(r){const e=[];return xn(r.fields,(t,n)=>{const s=new Re([t]);if(gi(n)){const i=Nc(n.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new un(e)}class kt{constructor(e,t,n,s,i,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=u}static newInvalidDocument(e){return new kt(e,0,Oe.min(),Oe.min(),Oe.min(),Qt.empty(),0)}static newFoundDocument(e,t,n,s){return new kt(e,1,t,Oe.min(),n,s,0)}static newNoDocument(e,t){return new kt(e,2,t,Oe.min(),Oe.min(),Qt.empty(),0)}static newUnknownDocument(e,t){return new kt(e,3,t,Oe.min(),Oe.min(),Qt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Oe.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Oe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof kt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new kt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Un{constructor(e,t){this.position=e,this.inclusive=t}}function zc(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],o=r.position[s];if(n=i.field.isKeyField()?fe.comparator(fe.fromName(o.referenceValue),t.key):Gn(o,t.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function jc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Tn(r.position[t],e.position[t]))return!1;return!0}class _s{constructor(e,t="asc"){this.field=e,this.dir=t}}function G_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Bc{}class vt extends Bc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new U_(e,t,n):"array-contains"===t?new W_(e,n):"in"===t?new Wc(e,n):"not-in"===t?new K_(e,n):"array-contains-any"===t?new Y_(e,n):new vt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new $_(e,n):new q_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Gn(t,this.value)):null!==t&&Ln(this.value)===Ln(t)&&this.matchesComparison(Gn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return X()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class It extends Bc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new It(e,t)}matches(e){return Ar(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ar(r){return"and"===r.op}function qo(r){return function Lc(r){for(const e of r.filters)if(e instanceof It)return!1;return!0}(r)&&Ar(r)}function Wo(r){if(r instanceof vt)return r.field.canonicalString()+r.op.toString()+Er(r.value);if(qo(r))return r.filters.map(e=>Wo(e)).join(",");{const e=r.filters.map(t=>Wo(t)).join(",");return`${r.op}(${e})`}}function Gc(r,e){return r instanceof vt?(n=r,(s=e)instanceof vt&&n.op===s.op&&n.field.isEqual(s.field)&&Tn(n.value,s.value)):r instanceof It?function(n,s){return s instanceof It&&n.op===s.op&&n.filters.length===s.filters.length&&n.filters.reduce((i,o,u)=>i&&Gc(o,s.filters[u]),!0)}(r,e):void X();var n,s}function $c(r){return r instanceof vt?`${(t=r).field.canonicalString()} ${t.op} ${Er(t.value)}`:r instanceof It?function(t){return t.op.toString()+" {"+t.getFilters().map($c).join(" ,")+"}"}(r):"Filter";var t}class U_ extends vt{constructor(e,t,n){super(e,t,n),this.key=fe.fromName(n.referenceValue)}matches(e){const t=fe.comparator(e.key,this.key);return this.matchesComparison(t)}}class $_ extends vt{constructor(e,t){super(e,"in",t),this.keys=qc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class q_ extends vt{constructor(e,t){super(e,"not-in",t),this.keys=qc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function qc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>fe.fromName(n.referenceValue))}class W_ extends vt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hs(t)&&us(t.arrayValue,this.value)}}class Wc extends vt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&us(this.value.arrayValue,t)}}class K_ extends vt{constructor(e,t){super(e,"not-in",t)}matches(e){if(us(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!us(this.value.arrayValue,t)}}class Y_ extends vt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>us(this.value.arrayValue,n))}}class Q_{constructor(e,t=null,n=[],s=[],i=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=u,this.ue=null}}function Ko(r,e=null,t=[],n=[],s=null,i=null,o=null){return new Q_(r,e,t,n,s,i,o)}function ir(r){const e=Ee(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Wo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(i=n).field.canonicalString()+i.dir;var i}).join(","),dn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Er(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Er(n)).join(",")),e.ue=t}return e.ue}function ms(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!G_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Gc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!jc(r.startAt,e.startAt)&&jc(r.endAt,e.endAt)}function vi(r){return fe.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class On{constructor(e,t=null,n=[],s=[],i=null,o="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=h,this.ce=null,this.le=null,this.he=null}}function Cr(r){return new On(r)}function Xc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Yo(r){return null!==r.collectionGroup}function Sr(r){const e=Ee(r);if(null===e.ce){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new At(Re.comparator);return o.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new _s(i,n))}),t.has(Re.keyField().canonicalString())||e.ce.push(new _s(Re.keyField(),n))}return e.ce}function en(r){const e=Ee(r);return e.le||(e.le=function Hc(r,e){if("F"===r.limitType)return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>new _s(s.field,"desc"===s.dir?"asc":"desc"));const t=r.endAt?new Un(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Un(r.startAt.position,r.startAt.inclusive):null;return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Sr(r))),e.le}function Qo(r,e){const t=r.filters.concat([e]);return new On(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function xi(r,e,t){return new On(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function fs(r,e){return ms(en(r),en(e))&&r.limitType===e.limitType}function Zc(r){return`${ir(en(r))}|lt:${r.limitType}`}function Rr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>$c(s)).join(", ")}]`),dn(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>{return`${(o=s).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Er(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Er(s)).join(",")),`Target(${n})`}(en(r))}; limitType=${r.limitType})`}function ps(r,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return null!==n.collectionGroup?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):fe.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,s){for(const i of Sr(n))if(!i.field.isKeyField()&&null===s.data.field(i.field))return!1;return!0}(r,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,e)&&(s=e,!((n=r).startAt&&!function(o,u,h){const f=zc(o,u,h);return o.inclusive?f<=0:f<0}(n.startAt,Sr(n),s)||n.endAt&&!function(o,u,h){const f=zc(o,u,h);return o.inclusive?f>=0:f>0}(n.endAt,Sr(n),s)));var n,s}function tu(r){return(e,t)=>{let n=!1;for(const s of Sr(r)){const i=X_(s,e,t);if(0!==i)return i;n=n||s.field.isKeyField()}return 0}}function X_(r,e,t){const n=r.field.isKeyField()?fe.comparator(e.key,t.key):function(i,o,u){const h=o.data.field(i),f=u.data.field(i);return null!==h&&null!==f?Gn(h,f):X()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return X()}}class Pn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,i]of n)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){xn(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return Ac(this.inner)}size(){return this.innerSize}}const J_=new Pt(fe.comparator);function hn(){return J_}const nu=new Pt(fe.comparator);function gs(...r){let e=nu;for(const t of r)e=e.insert(t.key,t);return e}function ru(r){let e=nu;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function bn(){return ys()}function su(){return ys()}function ys(){return new Pn(r=>r.toString(),(r,e)=>r.isEqual(e))}const H_=new Pt(fe.comparator),Z_=new At(fe.comparator);function _t(...r){let e=Z_;for(const t of r)e=e.add(t);return e}const em=new At(S);function Jo(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pn(e)?"-0":e}}function iu(r){return{integerValue:""+r}}function ou(r,e){return function zn(r){return"number"==typeof r&&Number.isInteger(r)&&!pn(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?iu(e):Jo(r,e)}class Ti{constructor(){this._=void 0}}function tm(r,e,t){return r instanceof Or?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&_i(i)&&(i=mi(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):r instanceof or?lu(r,e):r instanceof ar?cu(r,e):function(s,i){const o=au(s,i),u=uu(o)+uu(s.Pe);return Uo(o)&&Uo(s.Pe)?iu(u):Jo(s.serializer,u)}(r,e)}function nm(r,e,t){return r instanceof or?lu(r,e):r instanceof ar?cu(r,e):t}function au(r,e){return r instanceof Pr?Uo(n=e)||(i=n)&&"doubleValue"in i?e:{integerValue:0}:null;var n,i}class Or extends Ti{}class or extends Ti{constructor(e){super(),this.elements=e}}function lu(r,e){const t=hu(e);for(const n of r.elements)t.some(s=>Tn(s,n))||t.push(n);return{arrayValue:{values:t}}}class ar extends Ti{constructor(e){super(),this.elements=e}}function cu(r,e){let t=hu(e);for(const n of r.elements)t=t.filter(s=>!Tn(s,n));return{arrayValue:{values:t}}}class Pr extends Ti{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function uu(r){return Dt(r.integerValue||r.doubleValue)}function hu(r){return hs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class sm{constructor(e,t){this.version=e,this.transformResults=t}}class Ft{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ft}static exists(e){return new Ft(void 0,e)}static updateTime(e){return new Ft(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bi(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ii{}function du(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Mr(r.key,Ft.none()):new kr(r.key,r.data,Ft.none());{const t=r.data,n=Qt.empty();let s=new At(Re.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?n.delete(i):n.set(i,o),s=s.add(i)}return new kn(r.key,n,new un(s.toArray()),Ft.none())}}function im(r,e,t){r instanceof kr?function(s,i,o){const u=s.value.clone(),h=fu(s.fieldTransforms,i,o.transformResults);u.setAll(h),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof kn?function(s,i,o){if(!bi(s.precondition,i))return void i.convertToUnknownDocument(o.version);const u=fu(s.fieldTransforms,i,o.transformResults),h=i.data;h.setAll(mu(s)),h.setAll(u),i.convertToFoundDocument(o.version,h).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function ws(r,e,t,n){return r instanceof kr?function(i,o,u,h){if(!bi(i.precondition,o))return u;const f=i.value.clone(),g=pu(i.fieldTransforms,h,o);return f.setAll(g),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null}(r,e,t,n):r instanceof kn?function(i,o,u,h){if(!bi(i.precondition,o))return u;const f=pu(i.fieldTransforms,h,o),g=o.data;return g.setAll(mu(i)),g.setAll(f),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(T=>T.field))}(r,e,t,n):(u=t,bi(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function om(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=au(n.transform,s||null);null!=i&&(null===t&&(t=Qt.empty()),t.set(n.field,i))}return t||null}function _u(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===s||n&&s&&j(n,s,(i,o)=>function rm(r,e){return r.field.isEqual(e.field)&&(s=e.transform,(n=r.transform)instanceof or&&s instanceof or||n instanceof ar&&s instanceof ar?j(n.elements,s.elements,Tn):n instanceof Pr&&s instanceof Pr?Tn(n.Pe,s.Pe):n instanceof Or&&s instanceof Or);var n,s}(i,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,s}class kr extends Ii{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class kn extends Ii{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function mu(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function fu(r,e,t){const n=new Map;pe(r.length===t.length);for(let s=0;s<t.length;s++){const i=r[s],o=i.transform,u=e.data.field(i.field);n.set(i.field,nm(o,u,t[s]))}return n}function pu(r,e,t){const n=new Map;for(const s of r){const i=s.transform,o=t.data.field(s.field);n.set(s.field,tm(i,o,e))}return n}class Mr extends Ii{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ho extends Ii{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zo{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&im(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=su();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let u=this.applyToLocalView(o,i.mutatedFields);u=t.has(s.key)?null:u;const h=du(o,u);null!==h&&n.set(s.key,h),o.isValidDocument()||o.convertToNoDocument(Oe.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_t())}isEqual(e){return this.batchId===e.batchId&&j(this.mutations,e.mutations,(t,n)=>_u(t,n))&&j(this.baseMutations,e.baseMutations,(t,n)=>_u(t,n))}}class ea{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){pe(e.mutations.length===n.length);let s=function(){return H_}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new ea(e,t,n,s)}}class ta{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class am{constructor(e,t){this.count=e,this.unchangedNames=t}}var Gt,wt;function vu(r){if(void 0===r)return ee("GRPC error has no .code"),H.UNKNOWN;switch(r){case Gt.OK:return H.OK;case Gt.CANCELLED:return H.CANCELLED;case Gt.UNKNOWN:return H.UNKNOWN;case Gt.DEADLINE_EXCEEDED:return H.DEADLINE_EXCEEDED;case Gt.RESOURCE_EXHAUSTED:return H.RESOURCE_EXHAUSTED;case Gt.INTERNAL:return H.INTERNAL;case Gt.UNAVAILABLE:return H.UNAVAILABLE;case Gt.UNAUTHENTICATED:return H.UNAUTHENTICATED;case Gt.INVALID_ARGUMENT:return H.INVALID_ARGUMENT;case Gt.NOT_FOUND:return H.NOT_FOUND;case Gt.ALREADY_EXISTS:return H.ALREADY_EXISTS;case Gt.PERMISSION_DENIED:return H.PERMISSION_DENIED;case Gt.FAILED_PRECONDITION:return H.FAILED_PRECONDITION;case Gt.ABORTED:return H.ABORTED;case Gt.OUT_OF_RANGE:return H.OUT_OF_RANGE;case Gt.UNIMPLEMENTED:return H.UNIMPLEMENTED;case Gt.DATA_LOSS:return H.DATA_LOSS;default:return X()}}(wt=Gt||(Gt={}))[wt.OK=0]="OK",wt[wt.CANCELLED=1]="CANCELLED",wt[wt.UNKNOWN=2]="UNKNOWN",wt[wt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wt[wt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wt[wt.NOT_FOUND=5]="NOT_FOUND",wt[wt.ALREADY_EXISTS=6]="ALREADY_EXISTS",wt[wt.PERMISSION_DENIED=7]="PERMISSION_DENIED",wt[wt.UNAUTHENTICATED=16]="UNAUTHENTICATED",wt[wt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wt[wt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wt[wt.ABORTED=10]="ABORTED",wt[wt.OUT_OF_RANGE=11]="OUT_OF_RANGE",wt[wt.UNIMPLEMENTED=12]="UNIMPLEMENTED",wt[wt.INTERNAL=13]="INTERNAL",wt[wt.UNAVAILABLE=14]="UNAVAILABLE",wt[wt.DATA_LOSS=15]="DATA_LOSS";const lm=new O([4294967295,4294967295],0);function xu(r){const e=function wu(){return new TextEncoder}().encode(r),t=new k;return t.update(e),new Uint8Array(t.digest())}function Tu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new O([t,n],0),new O([s,i],0)]}class na{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new xs(`Invalid padding: ${t}`);if(n<0)throw new xs(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new xs(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new xs(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=O.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(O.fromNumber(n)));return 1===s.compare(lm)&&(s=new O([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=xu(e),[n,s]=Tu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new na(i,s,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(0===this.Ie)return;const t=xu(e),[n,s]=Tu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class xs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ts{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,bs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ts(Oe.min(),s,new Pt(S),hn(),_t())}}class bs{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new bs(n,t,_t(),_t(),_t())}}class Ai{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class bu{constructor(e,t){this.targetId=e,this.me=t}}class Iu{constructor(e,t,n=zt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Eu{constructor(){this.fe=0,this.ge=Cu(),this.pe=zt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=_t(),t=_t(),n=_t();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:X()}}),new bs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Cu()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,pe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class cm{constructor(e){this.Le=e,this.Be=new Map,this.ke=hn(),this.qe=Au(),this.Qe=new Pt(S)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:X()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const i=s.target;if(vi(i))if(0===n){const o=new fe(i.path);this.Ue(t,o,kt.newNoDocument(o,Oe.min()))}else pe(1===n);else{const o=this.Ye(t);if(o!==n){const u=this.Ze(e),h=u?this.Xe(u,e,o):1;0!==h&&(this.je(t),this.Qe=this.Qe.insert(t,2===h?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let o,u;try{o=Rn(n).toUint8Array()}catch(h){if(h instanceof Sc)return Be("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new na(o,s,i)}catch(h){return Be(h instanceof xs?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(i=>{const o=this.Le.tt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const u=this.Je(o);if(u){if(i.current&&vi(u.target)){const h=new fe(u.target.path);null!==this.ke.get(h)||this.it(o,h)||this.Ue(o,h,kt.newNoDocument(h,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=_t();this.qe.forEach((i,o)=>{let u=!0;o.forEachWhile(h=>{const f=this.Je(h);return!f||"TargetPurposeLimboResolution"===f.purpose||(u=!1,!1)}),u&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Ts(e,t,this.Qe,this.ke,n);return this.ke=hn(),this.qe=Au(),this.Qe=new Pt(S),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Eu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new At(S),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||se("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Eu),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Au(){return new Pt(fe.comparator)}function Cu(){return new Pt(fe.comparator)}const um={asc:"ASCENDING",desc:"DESCENDING"},hm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dm={and:"AND",or:"OR"};class _m{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ra(r,e){return r.useProto3Json||dn(e)?e:{value:e}}function Dr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Su(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function mm(r,e){return Dr(r,e.toTimestamp())}function Bt(r){return pe(!!r),Oe.fromTimestamp(function(t){const n=Sn(t);return new Ne(n.seconds,n.nanos)}(r))}function sa(r,e){return ia(r,e).canonicalString()}function ia(r,e){const t=(s=r,new Le(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===e?t:t.child(e)}function Ru(r){const e=Le.fromString(r);return pe(Bu(e)),e}function Is(r,e){return sa(r.databaseId,e.path)}function In(r,e){const t=Ru(e);if(t.get(1)!==r.databaseId.projectId)throw new xe(H.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new xe(H.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new fe(ku(t))}function Ou(r,e){return sa(r.databaseId,e)}function oa(r){return new Le(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function ku(r){return pe(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function Mu(r,e,t){return{name:Is(r,e),fields:t.value.mapValue.fields}}function Fu(r,e){return{documents:[Ou(r,e.path)]}}function Ci(r,e){const t={structuredQuery:{}},n=e.path;let s;null!==e.collectionGroup?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Ou(r,s);const i=function(f){if(0!==f.length)return ju(It.create(f,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(f){if(0!==f.length)return f.map(g=>{return{field:$n((P=g).field),direction:vm(P.dir)};var P})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=ra(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(f=e.startAt).inclusive,values:f.position}),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{_t:t,parent:s};var f}function Nu(r){let e=function Pu(r){const e=Ru(r);return 4===e.length?Le.emptyPath():ku(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){pe(1===n);const g=t.from[0];g.allDescendants?s=g.collectionId:e=e.child(g.collectionId)}let i=[];t.where&&(i=function(T){const P=zu(T);return P instanceof It&&qo(P)?P.getFilters():[P]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(P=>{return new _s(Fr((Se=P).field),function(De){switch(De){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Se.direction));var Se}));let u=null;t.limit&&(u=function(T){let P;return P="object"==typeof T?T.value:T,dn(P)?null:P}(t.limit));let h=null;var T;t.startAt&&(h=new Un((T=t.startAt).values||[],!!T.before));let f=null;return t.endAt&&(f=function(T){return new Un(T.values||[],!T.before)}(t.endAt)),function Qc(r,e,t,n,s,i,o,u){return new On(r,e,t,n,s,i,o,u)}(e,s,o,i,u,"F",h,f)}function zu(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Fr(t.unaryFilter.field);return vt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Fr(t.unaryFilter.field);return vt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Fr(t.unaryFilter.field);return vt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Fr(t.unaryFilter.field);return vt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return X()}}(r):void 0!==r.fieldFilter?vt.create(Fr((t=r).fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return X()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return It.create(t.compositeFilter.filters.map(n=>zu(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return X()}}(t.compositeFilter.op))}(r):X();var t}function vm(r){return um[r]}function wm(r){return hm[r]}function xm(r){return dm[r]}function $n(r){return{fieldPath:r.canonicalString()}}function Fr(r){return Re.fromServerFormat(r.fieldPath)}function ju(r){return r instanceof vt?function(t){if("=="===t.op){if(kc(t.value))return{unaryFilter:{field:$n(t.field),op:"IS_NAN"}};if(Pc(t.value))return{unaryFilter:{field:$n(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(kc(t.value))return{unaryFilter:{field:$n(t.field),op:"IS_NOT_NAN"}};if(Pc(t.value))return{unaryFilter:{field:$n(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$n(t.field),op:wm(t.op),value:t.value}}}(r):r instanceof It?function(t){const n=t.getFilters().map(s=>ju(s));return 1===n.length?n[0]:{compositeFilter:{op:xm(t.op),filters:n}}}(r):X()}function Tm(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Bu(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class Mn{constructor(e,t,n,s,i=Oe.min(),o=Oe.min(),u=zt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new Mn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Mn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Mn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Mn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Lu{constructor(e){this.ct=e}}function la(r){const e=Nu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?xi(e,e.limit,"L"):e}class hr{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Dt(e.integerValue));else if("doubleValue"in e){const n=Dt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),pn(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Sn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Rn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Mc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):yi(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):X()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;const i=e.fields||{};this.dt(t,53);const o="value",u=(null===(s=null===(n=i[o].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.dt(t,15),t.At(Dt(u)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),fe.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}hr.vt=new hr;class Pm{constructor(){this.un=new ma}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(Ce.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(Ce.min())}updateCollectionGroup(e,t,n){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class ma{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new At(Le.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new At(Le.comparator)).toArray()}}new Uint8Array(0);class tn{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new tn(e,tn.DEFAULT_COLLECTION_PERCENTILE,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}tn.DEFAULT_COLLECTION_PERCENTILE=10,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tn.DEFAULT=new tn(41943040,tn.DEFAULT_COLLECTION_PERCENTILE,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tn.DISABLED=new tn(-1,0,0);class _r{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new _r(0)}static kn(){return new _r(-1)}}class uh{constructor(){this.changes=new Pn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,kt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?R.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class jm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class fh{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==n&&ws(n.mutation,s,un.empty(),Ne.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,_t()).next(()=>n))}getLocalViewOfDocuments(e,t,n=_t()){const s=bn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(i=>{let o=gs();return i.forEach((u,h)=>{o=o.insert(u,h.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=bn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,_t()))}populateOverlays(e,t,n){const s=[];return n.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,s){let i=hn();const o=ys(),u=ys();return t.forEach((h,f)=>{const g=n.get(f.key);s.has(f.key)&&(void 0===g||g.mutation instanceof kn)?i=i.insert(f.key,f):void 0!==g?(o.set(f.key,g.mutation.getFieldMask()),ws(g.mutation,f,g.mutation.getFieldMask(),Ne.now())):o.set(f.key,un.empty())}),this.recalculateAndSaveOverlays(e,i).next(h=>(h.forEach((f,g)=>o.set(f,g)),t.forEach((f,g)=>{var T;return u.set(f,new jm(g,null!==(T=o.get(f))&&void 0!==T?T:null))}),u))}recalculateAndSaveOverlays(e,t){const n=ys();let s=new Pt((o,u)=>o-u),i=_t();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(h=>{const f=t.get(h);if(null===f)return;let g=n.get(h)||un.empty();g=u.applyToLocalView(f,g),n.set(h,g);const T=(s.get(u.batchId)||_t()).add(h);s=s.insert(u.batchId,T)})}).next(()=>{const o=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,g=h.value,T=su();g.forEach(P=>{if(!i.has(P)){const te=du(t.get(P),n.get(P));null!==te&&T.set(P,te),i=i.add(P)}}),o.push(this.documentOverlayCache.saveOverlays(e,f,T))}return R.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return fe.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Yo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var o}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):R.resolve(bn());let u=-1,h=i;return o.next(f=>R.forEach(f,(g,T)=>(u<T.largestBatchId&&(u=T.largestBatchId),i.get(g)?R.resolve():this.remoteDocumentCache.getEntry(e,g).next(P=>{h=h.insert(g,P)}))).next(()=>this.populateOverlays(e,f,i)).next(()=>this.computeViews(e,h,f,_t())).next(g=>({batchId:u,changes:ru(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new fe(t)).next(n=>{let s=gs();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let o=gs();return this.indexManager.getCollectionParents(e,i).next(u=>R.forEach(u,h=>{const f=(T=t,P=h.child(i),new On(P,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt));var T,P;return this.getDocumentsMatchingCollectionQuery(e,f,n,s).next(g=>{g.forEach((T,P)=>{o=o.insert(T,P)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(o=>{i.forEach((h,f)=>{const g=f.getKey();null===o.get(g)&&(o=o.insert(g,kt.newInvalidDocument(g)))});let u=gs();return o.forEach((h,f)=>{const g=i.get(h);void 0!==g&&ws(g.mutation,f,un.empty(),Ne.now()),ps(t,f)&&(u=u.insert(h,f))}),u})}}class Bm{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(s=t).id,version:s.version,createTime:Bt(s.createTime)}),R.resolve();var s}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(s=t).name,query:la(s.bundledQuery),readTime:Bt(s.readTime)}),R.resolve();var s}}class Lm{constructor(){this.overlays=new Pt(fe.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const n=bn();return R.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,i)=>{this.ht(e,t,i)}),R.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Ir.get(n);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),R.resolve()}getOverlaysForCollection(e,t,n){const s=bn(),i=t.length+1,o=new fe(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===i&&h.largestBatchId>n&&s.set(h.getKey(),h)}return R.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new Pt((f,g)=>f-g);const o=this.overlays.getIterator();for(;o.hasNext();){const f=o.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>n){let g=i.get(f.largestBatchId);null===g&&(g=bn(),i=i.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const u=bn(),h=i.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,g)=>u.set(f,g)),!(u.size()>=s)););return R.resolve(u)}ht(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const o=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new ta(t,n));let i=this.Ir.get(t);void 0===i&&(i=_t(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class Gm{constructor(){this.sessionToken=zt.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}class fa{constructor(){this.Tr=new At($t.Er),this.dr=new At($t.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new $t(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new $t(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new fe(new Le([])),n=new $t(t,e),s=new $t(t,e+1),i=[];return this.dr.forEachInRange([n,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new fe(new Le([])),n=new $t(t,e),s=new $t(t,e+1);let i=_t();return this.dr.forEachInRange([n,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new $t(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class $t{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return fe.comparator(e.key,t.key)||S(e.wr,t.wr)}static Ar(e,t){return S(e.wr,t.wr)||fe.comparator(e.key,t.key)}}class Um{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new At($t.Er)}checkEmpty(e){return R.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.Sr;this.Sr++;const o=new Zo(i,t,n,s);this.mutationQueue.push(o);for(const u of s)this.br=this.br.add(new $t(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return R.resolve(o)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.vr(t+1),i=s<0?0:s;return R.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new $t(t,0),s=new $t(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,s],o=>{const u=this.Dr(o.wr);i.push(u)}),R.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new At(S);return t.forEach(s=>{const i=new $t(s,0),o=new $t(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],u=>{n=n.add(u.wr)})}),R.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;fe.isDocumentKey(i)||(i=i.child(""));const o=new $t(new fe(i),0);let u=new At(S);return this.br.forEachWhile(h=>{const f=h.key.path;return!!n.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.wr)),!0)},o),R.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const s=this.Dr(n);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){pe(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return R.forEach(t.mutations,s=>{const i=new $t(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new $t(t,0),s=this.br.firstAfterOrEqual(n);return R.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class $m{constructor(e){this.Mr=e,this.docs=new Pt(fe.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return R.resolve(n?n.document.mutableCopy():kt.newInvalidDocument(t))}getEntries(e,t){let n=hn();return t.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():kt.newInvalidDocument(s))}),R.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=hn();const o=t.path,u=new fe(o.child("")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:g}}=h.getNext();if(!o.isPrefixOf(f.path))break;f.path.length>o.length+1||be(new Ce((r=g).readTime,r.key,-1),n)<=0||(s.has(g.key)||ps(t,g))&&(i=i.insert(g.key,g.mutableCopy()))}var r;return R.resolve(i)}getAllFromCollectionGroup(e,t,n,s){X()}Or(e,t){return R.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new qm(this)}getSize(e){return R.resolve(this.size)}}class qm extends uh{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Wm{constructor(e){this.persistence=e,this.Nr=new Pn(t=>ir(t),ms),this.lastRemoteSnapshotVersion=Oe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new fa,this.targetCount=0,this.kr=_r.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new _r(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Nr.forEach((o,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),R.waitFor(i).next(()=>s)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return R.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),R.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),R.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return R.resolve(n)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}}class pa{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ut(0),this.Kr=!1,this.Kr=!0,this.$r=new Gm,this.referenceDelegate=e(this),this.Ur=new Wm(this),this.indexManager=new Pm,this.remoteDocumentCache=new $m(n=>this.referenceDelegate.Wr(n)),this.serializer=new Lu(t),this.Gr=new Bm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Lm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Um(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){se("MemoryPersistence","Starting transaction:",e);const s=new Km(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return R.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Km extends Ye{constructor(e){super(),this.currentSequenceNumber=e}}class Fi{constructor(e){this.persistence=e,this.Jr=new fa,this.Yr=null}static Zr(e){return new Fi(e)}get Xr(){if(this.Yr)return this.Yr;throw X()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),R.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,n=>{const s=fe.fromPath(n);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Oe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class wa{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=_t(),s=_t();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new wa(e,t.fromCache,n,s)}}class Qm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class gh{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,y.nr)()?8:function ct(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,y.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Qm;return this.Xi(e,t,o).next(u=>{if(i.result=u,this.zi)return this.es(e,t,o,u.size)})}).next(()=>i.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(nt()<=re.$b.DEBUG&&se("QueryEngine","SDK will not create cache indexes for query:",Rr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(nt()<=re.$b.DEBUG&&se("QueryEngine","Query:",Rr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(nt()<=re.$b.DEBUG&&se("QueryEngine","The SDK decides to create cache indexes for query:",Rr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,en(t))):R.resolve())}Yi(e,t){if(Xc(t))return R.resolve(null);let n=en(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=xi(t,null,"F"),n=en(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=_t(...i);return this.Ji.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(h=>{const f=this.ts(t,u);return this.ns(t,f,o,h.readTime)?this.Yi(e,xi(t,null,"F")):this.rs(e,f,t,h)}))})))}Zi(e,t,n,s){return Xc(t)||s.isEqual(Oe.min())?R.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,s)?R.resolve(null):(nt()<=re.$b.DEBUG&&se("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Rr(t)),this.rs(e,o,t,function Z(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=Oe.fromTimestamp(1e9===n?new Ne(t+1,0):new Ne(t,n));return new Ce(s,fe.empty(),e)}(s,-1)).next(u=>u))})}ts(e,t){let n=new At(tu(e));return t.forEach((s,i)=>{ps(e,i)&&(n=n.add(i))}),n}ns(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,n){return nt()<=re.$b.DEBUG&&se("QueryEngine","Using full collection scan to execute query:",Rr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ce.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class Xm{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Pt(S),this._s=new Pn(i=>ir(i),ms),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function vh(r,e){return xa.apply(this,arguments)}function xa(){return(xa=(0,l.A)(function*(r,e){const t=Ee(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],u=[];let h=_t();for(const f of s){o.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}for(const f of i){u.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}return t.localDocuments.getDocuments(n,h).next(f=>({hs:f,removedBatchIds:o,addedBatchIds:u}))})})})).apply(this,arguments)}function wh(r){const e=Ee(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Zm(r,e){const t=Ee(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Lr(r,e,t){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,l.A)(function*(r,e,t){const n=Ee(r),s=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!St(o))throw o;se("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(s.target)})).apply(this,arguments)}function zi(r,e,t){const n=Ee(r);let s=Oe.min(),i=_t();return n.persistence.runTransaction("Execute query","readwrite",o=>function(h,f,g){const T=Ee(h),P=T._s.get(g);return void 0!==P?R.resolve(T.os.get(P)):T.Ur.getTargetData(f,g)}(n,o,en(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,u.targetId).next(h=>{i=h})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?s:Oe.min(),t?i:_t())).next(u=>(function Ih(r,e,t){let n=r.us.get(e)||Oe.min();t.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}(n,function eu(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),u),{documents:u,Ts:i})))}class Ca{constructor(){this.activeTargetIds=function Xo(){return em}()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ch{constructor(){this.so=new Ca,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Ca,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class nf{_o(e){}shutdown(){}}class Sh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){se("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){se("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Li=null;function Ra(){return null===Li?Li=268435456+Math.round(2147483648*Math.random()):Li++,"0x"+Li.toString(16)}const rf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sf{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const nn="WebChannelConnection";class of extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co="(default)"===this.databaseId.database?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,n,s,i,o){const u=Ra(),h=this.xo(t,n.toUriEncodedString());se("RestConnection",`Sending RPC '${t}' ${u}:`,h,s);const f={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(f,i,o),this.No(t,h,f,s).then(g=>(se("RestConnection",`Received RPC '${t}' ${u}: `,g),g),g=>{throw Be("RestConnection",`RPC '${t}' ${u} failed with error: `,g,"url: ",h,"request:",s),g})}Lo(t,n,s,i,o,u){return this.Mo(t,n,s,i,o)}Oo(t,n,s){t["X-Goog-Api-Client"]="gl-js/ fire/"+Qe,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,n){return`${this.Do}/v1/${n}:${rf[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){const i=Ra();return new Promise((o,u)=>{const h=new Ie;h.setWithCredentials(!0),h.listenOnce(w.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case U.NO_ERROR:const g=h.getResponseJson();se(nn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(g)),o(g);break;case U.TIMEOUT:se(nn,`RPC '${e}' ${i} timed out`),u(new xe(H.DEADLINE_EXCEEDED,"Request time out"));break;case U.HTTP_ERROR:const T=h.getStatus();if(se(nn,`RPC '${e}' ${i} failed with status:`,T,"response text:",h.getResponseText()),T>0){let P=h.getResponseJson();Array.isArray(P)&&(P=P[0]);const te=P?.error;if(te&&te.status&&te.message){const Se=function(De){const He=De.toLowerCase().replace(/_/g,"-");return Object.values(H).indexOf(He)>=0?He:H.UNKNOWN}(te.status);u(new xe(Se,te.message))}else u(new xe(H.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new xe(H.UNAVAILABLE,"Connection failed."));break;default:X()}}finally{se(nn,`RPC '${e}' ${i} completed.`)}});const f=JSON.stringify(s);se(nn,`RPC '${e}' ${i} sending request:`,s),h.send(t,"POST",f,n,15)})}Bo(e,t,n){const s=Ra(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ie(),u=le(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.xmlHttpFactory=new J({})),this.Oo(h.initMessageHeaders,t,n),h.encodeInitMessageHeaders=!0;const g=i.join("");se(nn,`Creating RPC '${e}' stream ${s}: ${g}`,h);const T=o.createWebChannel(g,h);let P=!1,te=!1;const Se=new sf({Io:De=>{te?se(nn,`Not sending because RPC '${e}' stream ${s} is closed:`,De):(P||(se(nn,`Opening RPC '${e}' stream ${s} transport.`),T.open(),P=!0),se(nn,`RPC '${e}' stream ${s} sending:`,De),T.send(De))},To:()=>T.close()}),je=(De,He,st)=>{De.listen(He,et=>{try{st(et)}catch(ht){setTimeout(()=>{throw ht},0)}})};return je(T,V.EventType.OPEN,()=>{te||(se(nn,`RPC '${e}' stream ${s} transport opened.`),Se.yo())}),je(T,V.EventType.CLOSE,()=>{te||(te=!0,se(nn,`RPC '${e}' stream ${s} transport closed`),Se.So())}),je(T,V.EventType.ERROR,De=>{te||(te=!0,Be(nn,`RPC '${e}' stream ${s} transport errored:`,De),Se.So(new xe(H.UNAVAILABLE,"The operation could not be completed")))}),je(T,V.EventType.MESSAGE,De=>{var He;if(!te){const st=De.data[0];pe(!!st);const ht=st.error||(null===(He=st[0])||void 0===He?void 0:He.error);if(ht){se(nn,`RPC '${e}' stream ${s} received error:`,ht);const Tt=ht.status;let ft=function(B){const Q=Gt[B];if(void 0!==Q)return vu(Q)}(Tt),Y=ht.message;void 0===ft&&(ft=H.INTERNAL,Y="Unknown error status: "+Tt+" with message "+ht.message),te=!0,Se.So(new xe(ft,Y)),T.close()}else se(nn,`RPC '${e}' stream ${s} received:`,st),Se.bo(st)}}),je(u,_e.STAT_EVENT,De=>{De.stat===de.PROXY?se(nn,`RPC '${e}' stream ${s} detected buffering proxy`):De.stat===de.NOPROXY&&se(nn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{Se.wo()},0),Se}}function Gi(){return typeof document<"u"?document:null}function Ms(r){return new _m(r,!0)}class Oa{constructor(e,t,n=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&se("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Oh{constructor(e,t,n,s,i,o,u,h){this.ui=e,this.Ho=n,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Oa(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,l.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,l.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,l.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===H.RESOURCE_EXHAUSTED?(ee(t.toString()),ee("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===H.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{const s=new xe(H.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>1==++this.e_?this.E_(s):this.onNext(s))})}i_(){var e=this;this.state=5,this.t_.Go((0,l.A)(function*(){e.state=0,e.start()}))}I_(e){return se("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(se("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class af extends Oh{constructor(e,t,n,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function pm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:X(),s=e.targetChange.targetIds||[],i=function(f,g){return f.useProto3Json?(pe(void 0===g||"string"==typeof g),zt.fromBase64String(g||"")):(pe(void 0===g||g instanceof Buffer||g instanceof Uint8Array),zt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(f){const g=void 0===f.code?H.UNKNOWN:vu(f.code);return new xe(g,f.message||"")}(o);t=new Iu(n,s,i,u||null)}else if("documentChange"in e){const n=e.documentChange,s=In(r,n.document.name),i=Bt(n.document.updateTime),o=n.document.createTime?Bt(n.document.createTime):Oe.min(),u=new Qt({mapValue:{fields:n.document.fields}}),h=kt.newFoundDocument(s,i,o,u);t=new Ai(n.targetIds||[],n.removedTargetIds||[],h.key,h)}else if("documentDelete"in e){const n=e.documentDelete,s=In(r,n.document),i=n.readTime?Bt(n.readTime):Oe.min(),o=kt.newNoDocument(s,i);t=new Ai([],n.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const n=e.documentRemove,s=In(r,n.document);t=new Ai([],n.removedTargetIds||[],s,null)}else{if(!("filter"in e))return X();{const n=e.filter,{count:s=0,unchangedNames:i}=n,o=new am(s,i);t=new bu(n.targetId,o)}}var f;return t}(this.serializer,e),n=function(i){if(!("targetChange"in i))return Oe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Oe.min():o.readTime?Bt(o.readTime):Oe.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=oa(this.serializer),t.addTarget=function(i,o){let u;const h=o.target;if(u=vi(h)?{documents:Fu(i,h)}:{query:Ci(i,h)._t},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=Su(i,o.resumeToken);const f=ra(i,o.expectedCount);null!==f&&(u.expectedCount=f)}else if(o.snapshotVersion.compareTo(Oe.min())>0){u.readTime=Dr(i,o.snapshotVersion.toTimestamp());const f=ra(i,o.expectedCount);null!==f&&(u.expectedCount=f)}return u}(this.serializer,e);const n=function ym(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return X()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=oa(this.serializer),t.removeTarget=e,this.a_(t)}}class lf extends Oh{constructor(e,t,n,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return pe(!!e.streamToken),this.lastStreamToken=e.streamToken,pe(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){pe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function gm(r,e){return r&&r.length>0?(pe(void 0!==e),r.map(t=>function(s,i){let o=Bt(s.updateTime?s.updateTime:i);return o.isEqual(Oe.min())&&(o=Bt(i)),new sm(o,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Bt(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=oa(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Es(r,e){let t;if(e instanceof kr)t={update:Mu(r,e.key,e.value)};else if(e instanceof Mr)t={delete:Is(r,e.key)};else if(e instanceof kn)t={update:Mu(r,e.key,e.data),updateMask:Tm(e.fieldMask)};else{if(!(e instanceof Ho))return X();t={verify:Is(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const u=o.transform;if(u instanceof Or)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof or)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof ar)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Pr)return{fieldPath:o.field.canonicalString(),increment:u.Pe};throw X()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:mm(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:X()),t;var i}(this.serializer,n))};this.a_(t)}}class cf extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new xe(H.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,ia(t,n),s,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new xe(H.UNKNOWN,i.toString())})}Lo(e,t,n,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Lo(e,ia(t,n),s,o,u,i)).catch(o=>{throw"FirebaseError"===o.name?(o.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new xe(H.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class uf{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ee(t),this.D_=!1):se("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class hf{constructor(e,t,n,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(u=>{n.enqueueAndForget((0,l.A)(function*(){var h;Yn(o)&&(se("RemoteStore","Restarting streams for network reachability change."),yield(h=(0,l.A)(function*(g){const T=Ee(g);T.L_.add(4),yield Gr(T),T.q_.set("Unknown"),T.L_.delete(4),yield Ds(T)}),function f(g){return h.apply(this,arguments)})(o))}))}),this.q_=new uf(n,s)}}function Ds(r){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,l.A)(function*(r){if(Yn(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Gr(r){return ka.apply(this,arguments)}function ka(){return(ka=(0,l.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function Ui(r,e){const t=Ee(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Fa(t)?Da(t):qr(t).r_()&&Ma(t,e))}function Ur(r,e){const t=Ee(r),n=qr(t);t.N_.delete(e),n.r_()&&Ph(t,e),0===t.N_.size&&(n.r_()?n.o_():Yn(t)&&t.q_.set("Unknown"))}function Ma(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Oe.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qr(r).A_(e)}function Ph(r,e){r.Q_.xe(e),qr(r).R_(e)}function Da(r){r.Q_=new cm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),qr(r).start(),r.q_.v_()}function Fa(r){return Yn(r)&&!qr(r).n_()&&r.N_.size>0}function Yn(r){return 0===Ee(r).L_.size}function kh(r){r.Q_=void 0}function df(r){return Va.apply(this,arguments)}function Va(){return(Va=(0,l.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function _f(r){return Na.apply(this,arguments)}function Na(){return(Na=(0,l.A)(function*(r){r.N_.forEach((e,t)=>{Ma(r,e)})})).apply(this,arguments)}function mf(r,e){return za.apply(this,arguments)}function za(){return(za=(0,l.A)(function*(r,e){kh(r),Fa(r)?(r.q_.M_(e),Da(r)):r.q_.set("Unknown")})).apply(this,arguments)}function ff(r,e,t){return ja.apply(this,arguments)}function ja(){return ja=(0,l.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof Iu&&2===e.state&&e.cause)try{yield(n=(0,l.A)(function*(i,o){const u=o.cause;for(const h of o.targetIds)i.N_.has(h)&&(yield i.remoteSyncer.rejectListen(h,u),i.N_.delete(h),i.Q_.removeTarget(h))}),function s(i,o){return n.apply(this,arguments)})(r,e)}catch(n){se("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield $i(r,n)}else if(e instanceof Ai?r.Q_.Ke(e):e instanceof bu?r.Q_.He(e):r.Q_.We(e),!t.isEqual(Oe.min()))try{const n=yield wh(r.localStore);t.compareTo(n)>=0&&(yield function(i,o){const u=i.Q_.rt(o);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const g=i.N_.get(f);g&&i.N_.set(f,g.withResumeToken(h.resumeToken,o))}}),u.targetMismatches.forEach((h,f)=>{const g=i.N_.get(h);if(!g)return;i.N_.set(h,g.withResumeToken(zt.EMPTY_BYTE_STRING,g.snapshotVersion)),Ph(i,h);const T=new Mn(g.target,h,f,g.sequenceNumber);Ma(i,T)}),i.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){se("RemoteStore","Failed to raise snapshot:",n),yield $i(r,n)}var n}),ja.apply(this,arguments)}function $i(r,e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,l.A)(function*(r,e,t){if(!St(e))throw e;r.L_.add(1),yield Gr(r),r.q_.set("Offline"),t||(t=()=>wh(r.localStore)),r.asyncQueue.enqueueRetryable((0,l.A)(function*(){se("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Ds(r)}))})).apply(this,arguments)}function Mh(r,e){return e().catch(t=>$i(r,t,e))}function $r(r){return La.apply(this,arguments)}function La(){return(La=(0,l.A)(function*(r){const e=Ee(r),t=Qn(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;pf(e);)try{const s=yield Zm(e.localStore,n);if(null===s){0===e.O_.length&&t.o_();break}n=s.batchId,gf(e,s)}catch(s){yield $i(e,s)}Dh(e)&&Fh(e)})).apply(this,arguments)}function pf(r){return Yn(r)&&r.O_.length<10}function gf(r,e){r.O_.push(e);const t=Qn(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Dh(r){return Yn(r)&&!Qn(r).n_()&&r.O_.length>0}function Fh(r){Qn(r).start()}function yf(r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,l.A)(function*(r){Qn(r).p_()})).apply(this,arguments)}function vf(r){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,l.A)(function*(r){const e=Qn(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function wf(r,e,t){return $a.apply(this,arguments)}function $a(){return($a=(0,l.A)(function*(r,e,t){const n=r.O_.shift(),s=ea.from(n,e,t);yield Mh(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield $r(r)})).apply(this,arguments)}function xf(r,e){return qa.apply(this,arguments)}function qa(){return qa=(0,l.A)(function*(r,e){var t;e&&Qn(r).V_&&(yield(t=(0,l.A)(function*(s,i){if(function yu(r){switch(r){default:return X();case H.CANCELLED:case H.UNKNOWN:case H.DEADLINE_EXCEEDED:case H.RESOURCE_EXHAUSTED:case H.INTERNAL:case H.UNAVAILABLE:case H.UNAUTHENTICATED:return!1;case H.INVALID_ARGUMENT:case H.NOT_FOUND:case H.ALREADY_EXISTS:case H.PERMISSION_DENIED:case H.FAILED_PRECONDITION:case H.ABORTED:case H.OUT_OF_RANGE:case H.UNIMPLEMENTED:case H.DATA_LOSS:return!0}}(u=i.code)&&u!==H.ABORTED){const o=s.O_.shift();Qn(s).s_(),yield Mh(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield $r(s)}var u}),function n(s,i){return t.apply(this,arguments)})(r,e)),Dh(r)&&Fh(r)}),qa.apply(this,arguments)}function Vh(r,e){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,l.A)(function*(r,e){const t=Ee(r);t.asyncQueue.verifyOperationInProgress(),se("RemoteStore","RemoteStore received new credentials");const n=Yn(t);t.L_.add(3),yield Gr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Ds(t)})).apply(this,arguments)}function Ka(r,e){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,l.A)(function*(r,e){const t=Ee(r);e?(t.L_.delete(2),yield Ds(t)):e||(t.L_.add(2),yield Gr(t),t.q_.set("Unknown"))})).apply(this,arguments)}function qr(r){return r.K_||(r.K_=function(t,n,s){const i=Ee(t);return i.w_(),new af(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:df.bind(null,r),Ro:_f.bind(null,r),mo:mf.bind(null,r),d_:ff.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.K_.s_(),Fa(r)?Da(r):r.q_.set("Unknown")):(yield r.K_.stop(),kh(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Qn(r){return r.U_||(r.U_=function(t,n,s){const i=Ee(t);return i.w_(),new lf(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:yf.bind(null,r),mo:xf.bind(null,r),f_:vf.bind(null,r),g_:wf.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.U_.s_(),yield $r(r)):(yield r.U_.stop(),r.O_.length>0&&(se("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Qa{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new mt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const o=Date.now()+n,u=new Qa(e,t,o,s,i);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xe(H.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Wr(r,e){if(ee("AsyncQueue",`${e}: ${r}`),St(r))return new xe(H.UNAVAILABLE,`${e}: ${r}`);throw r}class Kr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||fe.comparator(t.key,n.key):(t,n)=>fe.comparator(t.key,n.key),this.keyedMap=gs(),this.sortedSet=new Pt(this.comparator)}static emptySet(e){return new Kr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Kr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Kr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Nh{constructor(){this.W_=new Pt(fe.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):X():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Yr{constructor(e,t,n,s,i,o,u,h,f){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,n,s,i){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new Yr(e,t,Kr.emptySet(t),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class Tf{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class bf{constructor(){this.queries=zh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const s=Ee(t),i=s.queries;s.queries=zh(),i.forEach((o,u)=>{for(const h of u.j_)h.onError(n)})}(this,new xe(H.ABORTED,"Firestore shutting down"))}}function zh(){return new Pn(r=>Zc(r),fs)}function Xa(r,e){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,l.A)(function*(r,e){const t=Ee(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(n=2):(i=new Tf,n=e.J_()?0:1);try{switch(n){case 0:i.z_=yield t.onListen(s,!0);break;case 1:i.z_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){const u=Wr(o,`Initialization of query '${Rr(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&el(t)})).apply(this,arguments)}function Ha(r,e){return Za.apply(this,arguments)}function Za(){return(Za=(0,l.A)(function*(r,e){const t=Ee(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),0===i.j_.length?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function If(r,e){const t=Ee(r);let n=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const u of o.j_)u.X_(s)&&(n=!0);o.z_=s}}n&&el(t)}function Ef(r,e,t){const n=Ee(r),s=n.queries.get(e);if(s)for(const i of s.j_)i.onError(t);n.queries.delete(e)}function el(r){r.Y_.forEach(e=>{e.next()})}var tl,jh;(jh=tl||(tl={})).ea="default",jh.Cache="cache";class nl{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)3!==s.type&&n.push(s);e=new Yr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=Yr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==tl.Cache}}class Gh{constructor(e){this.key=e}}class Uh{constructor(e){this.key=e}}class $h{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=_t(),this.mutatedKeys=_t(),this.Aa=tu(e),this.Ra=new Kr(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Nh,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,u=!1;const h="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,f="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((g,T)=>{const P=s.get(g),te=ps(this.query,T)?T:null,Se=!!P&&this.mutatedKeys.has(P.key),je=!!te&&(te.hasLocalMutations||this.mutatedKeys.has(te.key)&&te.hasCommittedMutations);let De=!1;P&&te?P.data.isEqual(te.data)?Se!==je&&(n.track({type:3,doc:te}),De=!0):this.ga(P,te)||(n.track({type:2,doc:te}),De=!0,(h&&this.Aa(te,h)>0||f&&this.Aa(te,f)<0)&&(u=!0)):!P&&te?(n.track({type:0,doc:te}),De=!0):P&&!te&&(n.track({type:1,doc:P}),De=!0,(h||f)&&(u=!0)),De&&(te?(o=o.add(te),i=je?i.add(g):i.delete(g)):(o=o.delete(g),i=i.delete(g)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const g="F"===this.query.limitType?o.last():o.first();o=o.delete(g.key),i=i.delete(g.key),n.track({type:1,doc:g})}return{Ra:o,fa:n,ns:u,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((g,T)=>function(te,Se){const je=De=>{switch(De){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return X()}};return je(te)-je(Se)}(g.type,T.type)||this.Aa(g.doc,T.doc)),this.pa(n),s=null!=s&&s;const u=t&&!s?this.ya():[],h=0===this.da.size&&this.current&&!s?1:0,f=h!==this.Ea;return this.Ea=h,0!==o.length||f?{snapshot:new Yr(this.query,e.Ra,i,o,e.mutatedKeys,0===h,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Nh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=_t(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Uh(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Gh(n))}),t}ba(e){this.Ta=e.Ts,this.da=_t();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Yr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Sf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Rf{constructor(e){this.key=e,this.va=!1}}class Of{constructor(e,t,n,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Pn(u=>Zc(u),fs),this.Ma=new Map,this.xa=new Set,this.Oa=new Pt(fe.comparator),this.Na=new Map,this.La=new fa,this.Ba={},this.ka=new Map,this.qa=_r.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function Pf(r,e){return rl.apply(this,arguments)}function rl(){return(rl=(0,l.A)(function*(r,e,t=!0){const n=qi(r);let s;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=yield qh(n,e,t,!0),s})).apply(this,arguments)}function kf(r,e){return sl.apply(this,arguments)}function sl(){return(sl=(0,l.A)(function*(r,e){const t=qi(r);yield qh(t,e,!0,!1)})).apply(this,arguments)}function qh(r,e,t,n){return il.apply(this,arguments)}function il(){return(il=(0,l.A)(function*(r,e,t,n){const s=yield function Br(r,e){const t=Ee(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(i=>i?(s=i,R.resolve(s)):t.Ur.allocateTargetId(n).next(o=>(s=new Mn(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.os.get(n.targetId);return(null===s||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}(r.localStore,en(e)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let u;return n&&(u=yield function ol(r,e,t,n,s){return al.apply(this,arguments)}(r,e,i,"current"===o,s.resumeToken)),r.isPrimaryClient&&t&&Ui(r.remoteStore,s),u})).apply(this,arguments)}function al(){return al=(0,l.A)(function*(r,e,t,n,s){r.Ka=(T,P,te)=>{return(Se=(0,l.A)(function*(De,He,st,et){let ht=He.view.ma(st);ht.ns&&(ht=yield zi(De.localStore,He.query,!1).then(({documents:M})=>He.view.ma(M,ht)));const Tt=et&&et.targetChanges.get(He.targetId),ft=et&&null!=et.targetMismatches.get(He.targetId),Y=He.view.applyChanges(ht,De.isPrimaryClient,Tt,ft);return yl(De,He.targetId,Y.wa),Y.snapshot}),function je(De,He,st,et){return Se.apply(this,arguments)})(r,T,P,te);var Se};const i=yield zi(r.localStore,e,!0),o=new $h(e,i.Ts),u=o.ma(i.documents),h=bs.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,s),f=o.applyChanges(u,r.isPrimaryClient,h);yl(r,t,f.wa);const g=new Sf(e,t,o);return r.Fa.set(e,g),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),f.snapshot}),al.apply(this,arguments)}function Mf(r,e,t){return ll.apply(this,arguments)}function ll(){return(ll=(0,l.A)(function*(r,e,t){const n=Ee(r),s=n.Fa.get(e),i=n.Ma.get(s.targetId);if(i.length>1)return n.Ma.set(s.targetId,i.filter(o=>!fs(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Lr(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Ur(n.remoteStore,s.targetId),Qr(n,s.targetId)}).catch(Ke))):(Qr(n,s.targetId),yield Lr(n.localStore,s.targetId,!0))})).apply(this,arguments)}function Df(r,e){return cl.apply(this,arguments)}function cl(){return(cl=(0,l.A)(function*(r,e){const t=Ee(r),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&1===s.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Ur(t.remoteStore,n.targetId))})).apply(this,arguments)}function ul(){return(ul=(0,l.A)(function*(r,e,t){const n=function Rl(r){const e=Ee(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Nf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zf.bind(null,e),e}(r);try{const s=yield function(o,u){const h=Ee(o),f=Ne.now(),g=u.reduce((te,Se)=>te.add(Se.key),_t());let T,P;return h.persistence.runTransaction("Locally write mutations","readwrite",te=>{let Se=hn(),je=_t();return h.cs.getEntries(te,g).next(De=>{Se=De,Se.forEach((He,st)=>{st.isValidDocument()||(je=je.add(He))})}).next(()=>h.localDocuments.getOverlayedDocuments(te,Se)).next(De=>{T=De;const He=[];for(const st of u){const et=om(st,T.get(st.key).overlayedDocument);null!=et&&He.push(new kn(st.key,et,Nc(et.value.mapValue),Ft.exists(!0)))}return h.mutationQueue.addMutationBatch(te,f,He,u)}).next(De=>{P=De;const He=De.applyToLocalDocumentSet(T,je);return h.documentOverlayCache.saveOverlays(te,De.batchId,He)})}).then(()=>({batchId:P.batchId,changes:ru(T)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,u,h){let f=o.Ba[o.currentUser.toKey()];f||(f=new Pt(S)),f=f.insert(u,h),o.Ba[o.currentUser.toKey()]=f}(n,s.batchId,t),yield Dn(n,s.changes),yield $r(n.remoteStore)}catch(s){const i=Wr(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function Wh(r,e){return hl.apply(this,arguments)}function hl(){return(hl=(0,l.A)(function*(r,e){const t=Ee(r);try{const n=yield function Hm(r,e){const t=Ee(r),n=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const u=[];e.targetChanges.forEach((g,T)=>{const P=s.get(T);if(!P)return;u.push(t.Ur.removeMatchingKeys(i,g.removedDocuments,T).next(()=>t.Ur.addMatchingKeys(i,g.addedDocuments,T)));let te=P.withSequenceNumber(i.currentSequenceNumber);var je,De,He;null!==e.targetMismatches.get(T)?te=te.withResumeToken(zt.EMPTY_BYTE_STRING,Oe.min()).withLastLimboFreeSnapshotVersion(Oe.min()):g.resumeToken.approximateByteSize()>0&&(te=te.withResumeToken(g.resumeToken,n)),s=s.insert(T,te),De=te,He=g,(0===(je=P).resumeToken.approximateByteSize()||De.snapshotVersion.toMicroseconds()-je.snapshotVersion.toMicroseconds()>=3e8||He.addedDocuments.size+He.modifiedDocuments.size+He.removedDocuments.size>0)&&u.push(t.Ur.updateTargetData(i,te))});let h=hn(),f=_t();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(i,g))}),u.push(function xh(r,e,t){let n=_t(),s=_t();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=hn();return t.forEach((u,h)=>{const f=i.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(Oe.min())?(e.removeEntry(u,h.readTime),o=o.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||0===h.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(h),o=o.insert(u,h)):se("LocalStore","Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)}),{Ps:o,Is:s}})}(i,o,e.documentUpdates).next(g=>{h=g.Ps,f=g.Is})),!n.isEqual(Oe.min())){const g=t.Ur.getLastRemoteSnapshotVersion(i).next(T=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(g)}return R.waitFor(u).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,h,f)).next(()=>h)}).then(i=>(t.os=s,i))}(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(pe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?pe(o.va):s.removedDocuments.size>0&&(pe(o.va),o.va=!1))}),yield Dn(t,n,e)}catch(n){yield Ke(n)}})).apply(this,arguments)}function Kh(r,e,t){const n=Ee(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const s=[];n.Fa.forEach((i,o)=>{const u=o.view.Z_(e);u.snapshot&&s.push(u.snapshot)}),function(o,u){const h=Ee(o);h.onlineState=u;let f=!1;h.queries.forEach((g,T)=>{for(const P of T.j_)P.Z_(u)&&(f=!0)}),f&&el(h)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Vf(r,e,t){return dl.apply(this,arguments)}function dl(){return(dl=(0,l.A)(function*(r,e,t){const n=Ee(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Na.get(e),i=s&&s.key;if(i){let o=new Pt(fe.comparator);o=o.insert(i,kt.newNoDocument(i,Oe.min()));const u=_t().add(i),h=new Ts(Oe.min(),new Map,new Pt(S),o,u);yield Wh(n,h),n.Oa=n.Oa.remove(i),n.Na.delete(e),vl(n)}else yield Lr(n.localStore,e,!1).then(()=>Qr(n,e,t)).catch(Ke)})).apply(this,arguments)}function Nf(r,e){return _l.apply(this,arguments)}function _l(){return(_l=(0,l.A)(function*(r,e){const t=Ee(r),n=e.batch.batchId;try{const s=yield function Jm(r,e){const t=Ee(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,h,f,g){const T=f.batch,P=T.keys();let te=R.resolve();return P.forEach(Se=>{te=te.next(()=>g.getEntry(h,Se)).next(je=>{const De=f.docVersions.get(Se);pe(null!==De),je.version.compareTo(De)<0&&(T.applyToRemoteDocument(je,f),je.isValidDocument()&&(je.setReadTime(f.commitVersion),g.addEntry(je)))})}),te.next(()=>u.mutationQueue.removeMutationBatch(h,T))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let h=_t();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}(t.localStore,e);gl(t,n,null),pl(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Dn(t,s)}catch(s){yield Ke(s)}})).apply(this,arguments)}function zf(r,e,t){return ml.apply(this,arguments)}function ml(){return(ml=(0,l.A)(function*(r,e,t){const n=Ee(r);try{const s=yield function(o,u){const h=Ee(o);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return h.mutationQueue.lookupMutationBatch(f,u).next(T=>(pe(null!==T),g=T.keys(),h.mutationQueue.removeMutationBatch(f,T))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,g,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>h.localDocuments.getDocuments(f,g))})}(n.localStore,e);gl(n,e,t),pl(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Dn(n,s)}catch(s){yield Ke(s)}})).apply(this,arguments)}function pl(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function gl(r,e,t){const n=Ee(r);let s=n.Ba[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function Qr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Yh(r,n)})}function Yh(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Ur(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),vl(r))}function yl(r,e,t){for(const n of t)n instanceof Gh?(r.La.addReference(n.key,e),Bf(r,n)):n instanceof Uh?(se("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Yh(r,n.key)):X()}function Bf(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(se("SyncEngine","New document in limbo: "+t),r.xa.add(n),vl(r))}function vl(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new fe(Le.fromString(e)),n=r.qa.next();r.Na.set(n,new Rf(t)),r.Oa=r.Oa.insert(t,n),Ui(r.remoteStore,new Mn(en(Cr(t.path)),n,"TargetPurposeLimboResolution",ut.oe))}}function Dn(r,e,t){return wl.apply(this,arguments)}function wl(){return wl=(0,l.A)(function*(r,e,t){const n=Ee(r),s=[],i=[],o=[];var u;n.Fa.isEmpty()||(n.Fa.forEach((u,h)=>{o.push(n.Ka(h,e,t).then(f=>{var g;if((f||t)&&n.isPrimaryClient){const T=f?!f.fromCache:null===(g=t?.targetChanges.get(h.targetId))||void 0===g?void 0:g.current;n.sharedClientState.updateQueryState(h.targetId,T?"current":"not-current")}if(f){s.push(f);const T=wa.Wi(h.targetId,f);i.push(T)}}))}),yield Promise.all(o),n.Ca.d_(s),yield(u=(0,l.A)(function*(f,g){const T=Ee(f);try{yield T.persistence.runTransaction("notifyLocalViewChanges","readwrite",P=>R.forEach(g,te=>R.forEach(te.$i,Se=>T.persistence.referenceDelegate.addReference(P,te.targetId,Se)).next(()=>R.forEach(te.Ui,Se=>T.persistence.referenceDelegate.removeReference(P,te.targetId,Se)))))}catch(P){if(!St(P))throw P;se("LocalStore","Failed to update sequence numbers: "+P)}for(const P of g){const te=P.targetId;if(!P.fromCache){const Se=T.os.get(te),De=Se.withLastLimboFreeSnapshotVersion(Se.snapshotVersion);T.os=T.os.insert(te,De)}}}),function h(f,g){return u.apply(this,arguments)})(n.localStore,i))}),wl.apply(this,arguments)}function Lf(r,e){return xl.apply(this,arguments)}function xl(){return(xl=(0,l.A)(function*(r,e){const t=Ee(r);if(!t.currentUser.isEqual(e)){se("SyncEngine","User change. New user:",e.toKey());const n=yield vh(t.localStore,e);t.currentUser=e,(i=t).ka.forEach(u=>{u.forEach(h=>{h.reject(new xe(H.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Dn(t,n.hs)}var i})).apply(this,arguments)}function Gf(r,e){const t=Ee(r),n=t.Na.get(e);if(n&&n.va)return _t().add(n.key);{let s=_t();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const u=t.Fa.get(o);s=s.unionWith(u.view.Va)}return s}}function qi(r){const e=Ee(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Wh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Vf.bind(null,e),e.Ca.d_=If.bind(null,e.eventManager),e.Ca.$a=Ef.bind(null,e.eventManager),e}class Xr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,l.A)(function*(){t.serializer=Ms(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function yh(r,e,t,n){return new Xm(r,e,t,n)}(this.persistence,new gh,e.initialUser,this.serializer)}createPersistence(e){return new pa(Fi.Zr,this.serializer)}createSharedClientState(e){return new Ch}terminate(){var e=this;return(0,l.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Jr{initialize(e,t){var n=this;return(0,l.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=s=>Kh(n.syncEngine,s,1),n.remoteStore.remoteSyncer.handleCredentialChange=Lf.bind(null,n.syncEngine),yield Ka(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new bf}createDatastore(e){const t=Ms(e.databaseInfo.databaseId),n=new of(e.databaseInfo);return new cf(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,s=this.datastore,i=e.asyncQueue,o=t=>Kh(this.syncEngine,t,0),u=Sh.D()?new Sh:new nf,new hf(n,s,i,o,u);var n,s,i,o,u}createSyncEngine(e,t){return function(s,i,o,u,h,f,g){const T=new Of(s,i,o,u,h,f);return g&&(T.Qa=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,l.A)(function*(){var t,n,s;yield(s=(0,l.A)(function*(o){const u=Ee(o);se("RemoteStore","RemoteStore shutting down."),u.L_.add(5),yield Gr(u),u.k_.shutdown(),u.q_.set("Unknown")}),function i(o){return s.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}class Wi{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):ee("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class tp{constructor(e,t,n,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Te.UNAUTHENTICATED,this.clientId=F.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var o=(0,l.A)(function*(u){se("FirestoreClient","Received user=",u.uid),yield i.authCredentialListener(u),i.user=u});return function(u){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(n,o=>(se("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new xe(H.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new mt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,l.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const s=Wr(n,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Ki(r,e){return Pl.apply(this,arguments)}function Pl(){return Pl=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),se("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var s=(0,l.A)(function*(i){n.isEqual(i)||(yield vh(e.localStore,i),n=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Pl.apply(this,arguments)}function kl(r,e){return Ml.apply(this,arguments)}function Ml(){return(Ml=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function Dl(r){return Fl.apply(this,arguments)}(r);se("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Vh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Vh(e.remoteStore,s)),r._onlineComponents=e})).apply(this,arguments)}function Fl(){return(Fl=(0,l.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){se("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ki(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Zh(r){return"FirebaseError"===r.name?r.code===H.FAILED_PRECONDITION||r.code===H.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}(t))throw t;Be("Error using user provided cache. Falling back to memory cache: "+t),yield Ki(r,new Xr)}}else se("FirestoreClient","Using default OfflineComponentProvider"),yield Ki(r,new Xr);return r._offlineComponents})).apply(this,arguments)}function Yi(r){return Vl.apply(this,arguments)}function Vl(){return(Vl=(0,l.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(se("FirestoreClient","Using user provided OnlineComponentProvider"),yield kl(r,r._uninitializedComponentsProvider._online)):(se("FirestoreClient","Using default OnlineComponentProvider"),yield kl(r,new Jr))),r._onlineComponents})).apply(this,arguments)}function Zr(r){return zl.apply(this,arguments)}function zl(){return(zl=(0,l.A)(function*(r){const e=yield Yi(r),t=e.eventManager;return t.onListen=Pf.bind(null,e.syncEngine),t.onUnlisten=Mf.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=kf.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Df.bind(null,e.syncEngine),t})).apply(this,arguments)}function id(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const od=new Map;function jl(r,e,t){if(!t)throw new xe(H.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function ad(r){if(!fe.isDocumentKey(r))throw new xe(H.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ld(r){if(fe.isDocumentKey(r))throw new xe(H.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Qi(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":X()}function gt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new xe(H.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Qi(r);throw new xe(H.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class ud{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new xe(H.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new xe(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function _p(r,e,t,n){if(!0===e&&!0===n)throw new xe(H.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=id(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new xe(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new xe(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new xe(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Fs{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ud({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new xe(H.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new xe(H.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ud(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Et;switch(n.type){case"firstParty":return new Ge(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new xe(H.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=od.get(t);n&&(se("ComponentProvider","Removing Datastore"),od.delete(t),n.terminate())}(this),Promise.resolve()}}class Xt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Xt(this.firestore,e,this._query)}}class Lt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new En(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Lt(this.firestore,e,this._key)}}class En extends Xt{constructor(e,t,n){super(e,t,Cr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Lt(this.firestore,null,new fe(e))}withConverter(e){return new En(this.firestore,e,this._path)}}function Vs(r,e,...t){if(r=(0,y.Ku)(r),jl("collection","path",e),r instanceof Fs){const n=Le.fromString(e,...t);return ld(n),new En(r,null,n)}{if(!(r instanceof Lt||r instanceof En))throw new xe(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Le.fromString(e,...t));return ld(n),new En(r.firestore,null,n)}}function es(r,e,...t){if(r=(0,y.Ku)(r),1===arguments.length&&(e=F.newId()),jl("doc","path",e),r instanceof Fs){const n=Le.fromString(e,...t);return ad(n),new Lt(r,null,new fe(n))}{if(!(r instanceof Lt||r instanceof En))throw new xe(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Le.fromString(e,...t));return ad(n),new Lt(r.firestore,r instanceof En?r.converter:null,new fe(n))}}class fp{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Oa(this,"async_queue_retry"),this.Eu=()=>{const t=Gi();t&&se("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=Gi();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=Gi();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new mt;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,l.A)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!St(t))throw t;se("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,ee("INTERNAL UNHANDLED ERROR: ",function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),u}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const s=Qa.createAndSchedule(this,e,t,n,i=>this.Vu(i));return this.lu.push(s),s}du(){this.hu&&X()}verifyOperationInProgress(){}mu(){var e=this;return(0,l.A)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function Bl(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const s=t;for(const i of["next","error","complete"])if(i in s&&"function"==typeof s[i])return!0;return!1}(r)}class Ct extends Fs{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new fp,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||dd(this),this._firestoreClient.terminate()}}function Ll(r,e){const t="object"==typeof r?r:(0,d.getApp)(),n="string"==typeof r?r:e||"(default)",s=(0,d._getProvider)(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=(0,y.yU)("firestore");i&&function mp(r,e,t,n={}){var s;const i=(r=gt(r,Fs))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&Be("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let u,h;if("string"==typeof n.mockUserToken)u=n.mockUserToken,h=Te.MOCK_USER;else{u=(0,y.Fy)(n.mockUserToken,null===(s=r._app)||void 0===s?void 0:s.options.projectId);const f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new xe(H.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Te(f)}r._authCredentials=new Xe(new rt(u,h))}}(s,...i)}return s}function Nt(r){return r._firestoreClient||dd(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function dd(r){var e,t,n;const s=r._freezeSettings(),i=(h=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new j_(r._databaseId,h,r._persistenceKey,(g=s).host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,id(g.experimentalLongPollingOptions),g.useFetchStreams));var h,g;r._firestoreClient=new tp(r._authCredentials,r._appCheckCredentials,r._queue,i),null!==(t=s.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=s.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class fr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fr(zt.fromBase64String(e))}catch(t){throw new xe(H.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new fr(zt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new xe(H.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ts{constructor(e){this._methodName=e}}class Gl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new xe(H.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new xe(H.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return S(this._lat,e._lat)||S(this._long,e._long)}}class Xi{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,e._values)}}const vp=/^__.*__$/;class wp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new kn(e,this.data,this.fieldMask,t,this.fieldTransforms):new kr(e,this.data,t,this.fieldTransforms)}}function pd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw X()}}class Ji{constructor(e,t,n,s,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.yu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new Ji(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.vu(e),s}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.yu(),s}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return eo(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if(pd(this.wu)&&vp.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class xp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ms(e)}Nu(e,t,n,s=!1){return new Ji({wu:e,methodName:t,Ou:n,path:Re.emptyPath(),Du:!1,xu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gr(r){const e=r._freezeSettings(),t=Ms(r._databaseId);return new xp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Hi(r,e,t,n,s,i={}){const o=r.Nu(i.merge||i.mergeFields?2:0,e,t,s);Ql("Data must be an object, but it was:",o,n);const u=vd(n,o);let h,f;if(i.merge)h=new un(o.fieldMask),f=o.fieldTransforms;else if(i.mergeFields){const g=[];for(const T of i.mergeFields){const P=js(e,T,t);if(!o.contains(P))throw new xe(H.INVALID_ARGUMENT,`Field '${P}' is specified in your field mask but missing from your input data.`);xd(g,P)||g.push(P)}h=new un(g),f=o.fieldTransforms.filter(T=>h.covers(T.field))}else h=null,f=o.fieldTransforms;return new wp(new Qt(u),h,f)}function yr(r,e){if(wd(r=(0,y.Ku)(r)))return Ql("Unsupported field value:",e,r),vd(r,e);if(r instanceof ts)return function(n,s){if(!pd(s.wu))throw s.Mu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Mu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,s){const i=[];let o=0;for(const u of n){let h=yr(u,s.Fu(o));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,s){if(null===(n=(0,y.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return ou(s.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const i=Ne.fromDate(n);return{timestampValue:Dr(s.serializer,i)}}if(n instanceof Ne){const i=new Ne(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Dr(s.serializer,i)}}if(n instanceof Gl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof fr)return{bytesValue:Su(s.serializer,n._byteString)};if(n instanceof Lt){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:sa(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Xi)return u=s,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(h=>{if("number"!=typeof h)throw u.Mu("VectorValues must only contain numeric values.");return Jo(u.serializer,h)})}}}}};var u;throw s.Mu(`Unsupported field value: ${Qi(n)}`)}(r,e)}function vd(r,e){const t={};return Ac(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xn(r,(n,s)=>{const i=yr(s,e.bu(n));null!=i&&(t[n]=i)}),{mapValue:{fields:t}}}function wd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Ne||r instanceof Gl||r instanceof fr||r instanceof Lt||r instanceof ts||r instanceof Xi)}function Ql(r,e,t){if(!wd(t)||"object"!=typeof(s=t)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){const n=Qi(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var s}function js(r,e,t){if((e=(0,y.Ku)(e))instanceof pr)return e._internalPath;if("string"==typeof e)return Zi(r,e);throw eo("Field path arguments must be of type string or ",r,!1,void 0,t)}const Tp=new RegExp("[~\\*/\\[\\]]");function Zi(r,e,t){if(e.search(Tp)>=0)throw eo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new pr(...e.split("."))._internalPath}catch{throw eo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function eo(r,e,t,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${n}`),o&&(h+=` in document ${s}`),h+=")"),new xe(H.INVALID_ARGUMENT,u+r+h)}function xd(r,e){return r.some(t=>t.isEqual(e))}class Bs{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Lt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new bp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(to("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class bp extends Bs{data(){return super.data()}}function to(r,e){return"string"==typeof e?Zi(r,e):e instanceof pr?e._internalPath:e._delegate._internalPath}function Td(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new xe(H.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xl{}class Ls extends Xl{}function bd(r,e,...t){let n=[];e instanceof Xl&&n.push(e),n=n.concat(t),function(i){const o=i.filter(h=>h instanceof ns).length,u=i.filter(h=>h instanceof Gs).length;if(o>1||o>0&&u>0)throw new xe(H.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class Gs extends Ls{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Gs(e,t,n)}_apply(e){const t=this._parse(e);return Sd(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t))}_parse(e){const t=gr(e.firestore);return function(i,o,u,h,f,g,T){let P;if(f.isKeyField()){if("array-contains"===g||"array-contains-any"===g)throw new xe(H.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if("in"===g||"not-in"===g){Cd(T,g);const te=[];for(const Se of T)te.push(Ad(h,i,Se));P={arrayValue:{values:te}}}else P=Ad(h,i,T)}else"in"!==g&&"not-in"!==g&&"array-contains-any"!==g||Cd(T,g),P=function yd(r,e,t,n=!1){return yr(t,r.Nu(n?4:3,e))}(u,"where",T,"in"===g||"not-in"===g);return vt.create(f,g,P)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function Id(r,e,t){const n=e,s=to("where",r);return Gs._create(s,n,t)}class ns extends Xl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ns(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:It.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(s,i){let o=s;const u=i.getFlattenedFilters();for(const h of u)Sd(o,h),o=Qo(o,h)}(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ad(r,e,t){if("string"==typeof(t=(0,y.Ku)(t))){if(""===t)throw new xe(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yo(e)&&-1!==t.indexOf("/"))throw new xe(H.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Le.fromString(t));if(!fe.isDocumentKey(n))throw new xe(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return sr(r,new fe(n))}if(t instanceof Lt)return sr(r,t._key);throw new xe(H.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Qi(t)}.`)}function Cd(r,e){if(!Array.isArray(r)||0===r.length)throw new xe(H.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Sd(r,e){const t=function(s,i){for(const o of s)for(const u of o.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new xe(H.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Od{convertValue(e,t="none"){switch(Ln(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Dt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Rn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw X()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return xn(e,(s,i)=>{n[s]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,s;const i=null===(s=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map(o=>Dt(o.doubleValue));return new Xi(i)}convertGeoPoint(e){return new Gl(Dt(e.latitude),Dt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=mi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cs(e));default:return null}}convertTimestamp(e){const t=Sn(e);return new Ne(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Le.fromString(e);pe(Bu(n));const s=new rr(n.get(1),n.get(3)),i=new fe(n.popFirst(5));return s.isEqual(t)||ee(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class vr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rs extends Bs{constructor(e,t,n,s,i,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new oo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(to("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class oo extends rs{data(e={}){return super.data(e)}}class ss{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new vr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new oo(this._firestore,this._userDataWriter,n.key,n,new vr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new xe(H.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(u=>({type:"added",doc:new oo(s._firestore,s._userDataWriter,u.doc.key,u.doc,new vr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:o++}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const h=new oo(s._firestore,s._userDataWriter,u.doc.key,u.doc,new vr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,g=-1;return 0!==u.type&&(f=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),g=o.indexOf(u.doc.key)),{type:Ap(u.type),doc:h,oldIndex:f,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ap(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return X()}}class Xn extends Od{constructor(e){super(),this.firestore=e}convertBytes(e){return new fr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Lt(this.firestore,null,t)}}function Pd(r){r=gt(r,Xt);const e=gt(r.firestore,Ct),t=Nt(e),n=new Xn(e);return Td(r._query),function sd(r,e,t={}){const n=new mt;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,f){const g=new Wi({next:P=>{o.enqueueAndForget(()=>Ha(i,T)),P.fromCache&&"server"===h.source?f.reject(new xe(H.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(P)},error:P=>f.reject(P)}),T=new nl(u,g,{includeMetadataChanges:!0,_a:!0});return Xa(i,T)}(yield Zr(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(s=>new ss(e,n,r,s))}function kd(r,e,t){r=gt(r,Lt);const n=gt(r.firestore,Ct),s=function io(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return Us(n,[Hi(gr(n),"setDoc",r._key,s,null!==r.converter,t).toMutation(r._key,Ft.none())])}function ao(r,...e){var t,n,s;r=(0,y.Ku)(r);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Bl(e[o])||(i=e[o],o++);const u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Bl(e[o])){const T=e[o];e[o]=null===(t=T.next)||void 0===t?void 0:t.bind(T),e[o+1]=null===(n=T.error)||void 0===n?void 0:n.bind(T),e[o+2]=null===(s=T.complete)||void 0===s?void 0:s.bind(T)}let h,f,g;if(r instanceof Lt)f=gt(r.firestore,Ct),g=Cr(r._key.path),h={next:T=>{e[o]&&e[o](Hl(f,r,T))},error:e[o+1],complete:e[o+2]};else{const T=gt(r,Xt);f=gt(T.firestore,Ct),g=T._query;const P=new Xn(f);h={next:te=>{e[o]&&e[o](new ss(f,P,T,te))},error:e[o+1],complete:e[o+2]},Td(r._query)}return function(P,te,Se,je){const De=new Wi(je),He=new nl(te,De,Se);return P.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Xa(yield Zr(P),He)})),()=>{De.za(),P.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Ha(yield Zr(P),He)}))}}(Nt(f),g,u,h)}function Us(r,e){return function(n,s){const i=new mt;return n.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function Ff(r,e,t){return ul.apply(this,arguments)}(yield function Nl(r){return Yi(r).then(e=>e.syncEngine)}(n),s,i)})),i.promise}(Nt(r),e)}function Hl(r,e,t){const n=t.docs.get(e._key),s=new Xn(r);return new rs(r,s,e._key,n,new vr(t.hasPendingWrites,t.fromCache),e.converter)}!function(e,t=!0){Qe=d.SDK_VERSION,(0,d._registerComponent)(new C.uA("firestore",(n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),u=new Ct(new pt(n.getProvider("auth-internal")),new ce(n.getProvider("app-check-internal")),function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new xe(H.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rr(f.options.projectId,g)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,d.registerVersion)(ze,"4.7.2",e),(0,d.registerVersion)(ze,"4.7.2","esm2017")}();var Ut=v(51698),Vd=v(43234),co=v(48891),Lp=v(30531),Gp=v(36484),Up=v(62095);let $p=(()=>{var r;class e{examSessions_read(n){var s=this;return new Ut.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=yield s._getDocument(u.data,"exam_sessions/"+n,s.getUserId());i.next({success:1,data:h,message:"successful"}),i.complete()}catch(g){console.log(g),i.next({success:0,data:"",message:""+g}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_write(n,s){var i=this;return new Ut.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_sessions/"+n,i.getUserId(),s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(T){console.log(T),o.next({success:0,data:"",message:""+T}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_writeUserMap(n,s){var i=this;return new Ut.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success&&h.data)try{var f=yield i._saveDocumentMerge(h.data,"exam_sessions/"+n,"user_map",s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(T){console.log(T),o.next({success:0,data:"",message:""+T}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_delete(n){var s=this;return new Ut.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{yield s._removeDocument(u.data,"exam_sessions/"+n,s.getUserId()),i.next({success:1,data:"",message:"successful"}),i.complete()}catch(f){console.log(f),i.next({success:0,data:"",message:""+f}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribeUserMap(n){var s=this;return new Ut.c(i=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,"user_map",T=>{i.next({success:1,data:T,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(T){console.log(T),i.next({success:0,data:void 0,message:""+T}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribe(n){var s=this;return new Ut.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,s.getUserId(),T=>{i.next({success:1,data:T,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(T){console.log(T),i.next({success:0,data:void 0,message:""+T}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_unsubscribe(n){this.removeAllunsubscribe("exam_sessions_"+n)}examSessions_subscribeWithQuery(n,s){var i=this;return new Ut.c(s&&3==s.length?o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=i.myOnSnapshotCollectionWithQuery(h.data,"exam_sessions/"+n,s,P=>{o.next({success:1,data:P,message:"successful"}),o.complete()});i.addUnsubscribe("exam_sessions_"+n,f)}catch(P){console.log(P),o.next({success:0,data:void 0,message:""+P}),o.complete()}else o.next({success:0,data:void 0,message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())}:o=>{o.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),o.complete(),o.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(n){var s=this;return new Ut.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshotCollection(u.data,"exam_live_teachers/"+n,f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_teachers_"+n,h)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_teachers_"+n)}examLiveTeachers_teacher_saveChange(n,s){var i=this;return new Ut.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_live_teachers/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(n,s){var i=this;return new Ut.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._getDocuments(h.data,"exam_lives/"+n,s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(n){var s=this;return new Ut.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_live_students/"+n,s.getUserId(),f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_students_"+n,h)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_teacher_subscribe(n,s){var i=this;return new Ut.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=i.myOnSnapshot(h.data,"exam_live_students/"+n,s,g=>{o.next({success:1,data:g})});i.addUnsubscribe("exam_live_students_"+n,f)}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_student_saveChange(n,s){var i=this;return new Ut.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_live_students/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(n,s,i){var o=this;return new Ut.c(u=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var h=(0,l.A)(function*(f){if(f&&1==f.success)try{var g=yield o._saveDocumentMerge(f.data,"exam_live_students/"+n,s,i);u.next({success:1,data:g})}catch(T){console.log(T),u.next({success:0,message:"EXCEPTION",ex:T.toString()})}else u.next(f)});return function(f){return h.apply(this,arguments)}}())})}getFirestoreDb(n){return new Ut.c(s=>{var i=this.createFirestoreKey("firestore_db"),o=this.getLocalFirestoreDb(i);null!=o&&0==n?(s.next({success:1,data:o,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(h=>{h&&1==h.success?(0,x.p)(this.getAuthApp(),h?.data?.token??"").then(()=>{var g=Ll(this.app);this.setLocalFirestoreDb(i,g),s.next({success:1,data:g,message:"successful"}),s.complete()}).catch(g=>{"auth/invalid-custom-token"===g.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:h.message??""}),s.complete())})})}getFirestoreDbForStudentExam(n,s){return new Ut.c(i=>{var o=this.createFirestoreKey("firestore_db_student_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,x.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var T=Ll(this.app);this.setLocalFirestoreDb(o,T),i.next({success:1,data:T,message:"successful"}),i.complete()}).catch(T=>{"auth/invalid-custom-token"===T.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}getFirestoreDbForTeacherExam(n,s){return new Ut.c(i=>{var o=this.createFirestoreKey("firestore_db_teacher_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,x.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var T=Ll(this.app);this.setLocalFirestoreDb(o,T),i.next({success:1,data:T,message:"successful"}),i.complete()}).catch(T=>{"auth/invalid-custom-token"===T.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}signInUserByToken(n){return new Ut.c(s=>{(0,x.p)(this.getAuthApp(),n).then(()=>{s.next({success:1,data:"",message:"successful"}),s.complete()}).catch(i=>{"auth/invalid-custom-token"===i.code?(s.next({success:0,data:"",message:"EXPIRED"}),s.complete()):(s.next({success:0,data:"",message:"AUTH_ERROR"}),s.complete())})})}setLocalFirestoreDb(n,s){this.firestoreDbs[n]=s}getLocalFirestoreDb(n){if(this.firestoreDbs.hasOwnProperty(n))return this.firestoreDbs[n]}removeLocalFirestoreDb(n){this.firestoreDbs.hasOwnProperty(n)&&delete this.firestoreDbs[n]}createFirestoreKey(n){return this.userService.getUserObj().id+"_"+n}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(n,s){n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)||(this.listSubscribers[n]=[]),this.listSubscribers[n].push(s)}removeAllunsubscribe(n){if(n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)){for(var s=0;s<this.listSubscribers[n].length;s++)this.listSubscribers[n][s]();delete this.listSubscribers[n]}}_saveDocument(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield kd(es(n,s,i),u.commonSerivce.myClone(o)),i})()}_saveDocumentMerge(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield kd(es(n,s,i),u.commonSerivce.myClone(o),{merge:!0}),i})()}_getCollection(n,s){var i=this;return(0,l.A)(function*(){s=i.getBaseFirestore()+"/"+s;const o=Vs(n,s);return(yield Pd(o)).docs.map(f=>f.data())})()}_getDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s;const u=es(n,s,i),h=yield function Cp(r){r=gt(r,Lt);const e=gt(r.firestore,Ct);return function rd(r,e,t={}){const n=new mt;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,f){const g=new Wi({next:P=>{o.enqueueAndForget(()=>Ha(i,T));const te=P.docs.has(u);!te&&P.fromCache?f.reject(new xe(H.UNAVAILABLE,"Failed to get document because the client is offline.")):te&&P.fromCache&&h&&"server"===h.source?f.reject(new xe(H.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(P)},error:P=>f.reject(P)}),T=new nl(Cr(u.path),g,{includeMetadataChanges:!0,_a:!0});return Xa(i,T)}(yield Zr(r),r.asyncQueue,e,t,n)})),n.promise}(Nt(e),r._key).then(t=>Hl(e,r,t))}(u);return h.exists()?h.data():null})()}_getDocuments(n,s,i){var o=this;return(0,l.A)(function*(){var u={};s=o.getBaseFirestore()+"/"+s;const h=bd(Vs(n,s),Id(function yp(){return new pr("__name__")}(),"in",i));return(yield Pd(h)).forEach(g=>{u[g.id]=g.data()}),u})()}_removeDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s,yield function Sp(r){return Us(gt(r.firestore,Ct),[new Mr(r._key,Ft.none())])}(es(n,s,i))})()}myOnSnapshot(n,s,i,o){return ao(es(n,s=this.getBaseFirestore()+"/"+s,i),h=>{o(h.data())})}myOnSnapshotCollection(n,s,i){return ao(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var f=[];h.forEach(g=>{f.push(g.data())}),i(f)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(n,s,i){return ao(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var f=[];h.docChanges().forEach(g=>{f.push(g.doc.data())}),i(f)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(n,s,i,o){return ao(bd(Vs(n,s=this.getBaseFirestore()+"/"+s),Id(i[0],i[1],i[2])),function(){var f=(0,l.A)(function*(g){var T=[];g.docChanges().forEach(P=>{T.push(P.doc.data())}),o(T)});return function(g){return f.apply(this,arguments)}}())}getBaseFirestore(){return Vd.c.firestoreBase}getInitApp(){return this.app}getAuthApp(){return(0,x.xI)(this.app)}constructor(n,s,i){this.firestoreServiceApi=n,this.userService=s,this.commonSerivce=i,this.firestoreDbs={},this.listSubscribers={},this.app=(0,d.initializeApp)(Vd.c.firestoreConfig_app1,"firestoreapp")}}return(r=e).\u0275fac=function(n){return new(n||r)(co.KVO(Lp.B),co.KVO(Gp.R),co.KVO(Up.R))},r.\u0275prov=co.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},69666:(yt,ke,v)=>{function l(){return typeof aztExam<"u"?aztExam:void 0}v.d(ke,{J:()=>re});var d=v(43234),c=v(48891),m=v(36484),x=v(42802),C=v(69817);let re=(()=>{var y;class oe{monitorAtTeacherDashboard(O){try{let D=l();if(typeof D>"u"||!D||!D.showMonitorTeacher)return;D.ver=this.monitorService.getMNoteVer();var k=this.userService.getUserObj();D.showMonitorTeacher({user:{token:k.rememberToken,userid:k.id,username:k.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live",urlExamResultGetLastExamResultOfStudentId:"ExamLivestream/GetLastExamResultOfStudentId"},roomid:O.roomId,examid:O.examId,userlist:O.userList,examconfig:O.examConfig,firebaseApp:this.fireStoreService,filetypeStr:O.fileTypeStr})}catch(D){console.log(D)}}monitorAtStudentDashboard(O,k){try{let D=l();if(typeof D>"u"||!D)return;D.ver=this.monitorService.getMNoteVer();var q=this.userService.getUserObj();D.loadMonitor(()=>{if(!D.MonitorStudent)return;var Ie={user:{token:q.rememberToken,userid:q.id,username:q.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:O,element:"monitorScreen",examconfig:k,firebaseApp:this.fireStoreService,isStarted:!1};D.MonitorStudent.getInstance().prepairSession(Ie);let V=window.setInterval(()=>{let w=document.getElementById("monitorScreen");if(w){let U=w.getElementsByTagName("div")[0];U&&(U.setAttribute("class","mx-auto"),clearInterval(V))}},50)})}catch(D){console.log(D)}}monitorAtTestPage(O,k,q){let D=l();if(typeof D>"u"||!D)return q(!1);var Ie=this.userService.getUserObj(),J=k;D.ver=this.monitorService.getMNoteVer(),D.loadMonitor(()=>{if(!D.MonitorStudent)return q(!1);var V={user:{token:Ie.rememberToken,userid:Ie.id,username:Ie.fullName,studentid:J?J.id:0,studentname:J?J.fullName:null},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:O.roomId,element:"monitorScreenTakeTest",examconfig:O.examConfig,examid:O.examId,firebaseApp:this.fireStoreService,resultid:O.resultId,isStarted:!0,clickFromIframeFunc:()=>{},clickFromIframeFuncCaller:this};D.MonitorStudent.getInstance().startSession(V),q(!0)})}destroyMonitorAtStudentDashboard(){try{let k=l();if(typeof k>"u"||!k||!k.MonitorStudent)return;k.MonitorStudent.getInstance().stopSession()}catch(k){console.log(k)}}constructor(O,k,q){this.userService=O,this.monitorService=k,this.fireStoreService=q}}return(y=oe).\u0275fac=function(O){return new(O||y)(c.KVO(m.R),c.KVO(x.Q),c.KVO(C.s))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),oe})()},42802:(yt,ke,v)=>{v.d(ke,{Q:()=>c});var l=v(48891),d=v(55465);let c=(()=>{var m;class x{constructor(re){this.envService=re}getTmpVersionMonitor(){var re=this.envService.getEnvValue("classliveUrl"),y="1.0";if(re){var oe=re.split("=");oe.length>1&&(y=oe[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+y}getMNoteVer(){var re=this.envService.getEnvValue("classliveUrl"),y="1.0";if(re){var oe=re.split("=");oe.length>1&&(y=oe[1])}return y}checkValidForSetUpMonitor(){return!0}}return(m=x).\u0275fac=function(re){return new(re||m)(l.KVO(d.t))},m.\u0275prov=l.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),x})()},51935:(yt,ke,v)=>{v.d(ke,{h:()=>xt});var l=v(91478),d=v(89163),c=v(33887),m=v(48891),x=v(54460),C=v(2915),re=v(15343),y=v(76975);const oe=()=>({"mr-2":!0});function z(Re,fe){if(1&Re&&(m.j41(0,"li"),m.EFF(1),m.k0s()),2&Re){const Ue=fe.$implicit;m.R7$(),m.SpI("* ",Ue.message,"")}}function O(Re,fe){1&Re&&(m.j41(0,"span",8),m.EFF(1),m.nI1(2,"mytranslate"),m.j41(3,"span",9),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.EFF(6),m.nI1(7,"mytranslate"),m.nI1(8,"mytranslate"),m.k0s()),2&Re&&(m.R7$(),m.SpI(" ",m.bMT(2,4,"lang_auto_click")," "),m.R7$(3),m.SpI('"',m.bMT(5,6,"lang_auto_tai_ve"),'"'),m.R7$(2),m.Lme(" ",m.bMT(7,8,"lang_auto_de_tai_ve")," ",m.bMT(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function k(Re,fe){if(1&Re){const Ue=m.RV6();m.j41(0,"button",17),m.bIt("click",function(){m.eBV(Ue);const L=m.XpG();return m.Njj(L.onPressTrue())}),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()}2&Re&&(m.R7$(),m.SpI(" ",m.bMT(2,1,"lang_auto_tai_ve")," "))}let q=(()=>{var Re;class fe extends c._{onPressTrue(){this.dialogRef.close(!0)}constructor(E,L){super(E,L),this.data=E,this.dialogRef=L,this.result=E.result}}return(Re=fe).\u0275fac=function(E){return new(E||Re)(m.rXU(d.Vh),m.rXU(d.CP,8))},Re.\u0275cmp=m.VBU({type:Re,selectors:[["app-push-error-student-export-docx"]],features:[m.Vt3],decls:30,vars:25,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16",3,"ngClass"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(E,L){1&E&&(m.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.j41(6,"div",4)(7,"a",5),m.nrm(8,"lucide-icon",6),m.k0s()()(),m.j41(9,"div",7)(10,"span",8),m.EFF(11),m.nI1(12,"mytranslate"),m.j41(13,"span",9),m.EFF(14),m.k0s(),m.EFF(15),m.nI1(16,"mytranslate"),m.nI1(17,"lowercase"),m.k0s(),m.j41(18,"span",8),m.EFF(19),m.nI1(20,"mytranslate"),m.k0s(),m.j41(21,"azt-mat-dialog-content",10)(22,"ul",11),m.DNE(23,z,2,1,"li",12),m.k0s()(),m.DNE(24,O,9,12,"span",13),m.k0s(),m.j41(25,"div",14)(26,"a",15),m.EFF(27),m.nI1(28,"mytranslate"),m.k0s(),m.DNE(29,k,3,3,"button",16),m.k0s()()()),2&E&&(m.R7$(4),m.JRh(m.bMT(5,12,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),m.R7$(4),m.Y8G("ngClass",m.lJ4(24,oe)),m.R7$(3),m.SpI(" ",m.bMT(12,14,"lang_auto_he_thong_tao_thanh_cong_cho")," "),m.R7$(3),m.Lme("",L.result.datas.length,"/",L.result.errs.length+L.result.datas.length,""),m.R7$(),m.SpI(" ",m.bMT(17,18,m.bMT(16,16,"lang_auto_hoc_sinh"))," "),m.R7$(4),m.SpI(" ",m.bMT(20,20,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),m.R7$(2),m.Y8G("defaultHeight",60),m.R7$(2),m.Y8G("ngForOf",L.result.errs),m.R7$(),m.Y8G("ngIf",L.result.datas.length>0),m.R7$(3),m.SpI(" ",m.bMT(28,22,"lang_cms_common_close_btn")," "),m.R7$(2),m.Y8G("ngIf",L.result.datas.length>0))},dependencies:[x.YU,x.Sq,x.bT,d.tx,C.U,re.WGl,x.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),fe})();var D=v(10936),Ie=v(65080),J=v(68774),V=v(47712),w=v(5502),U=v(81587),de=v(90796),_e=v(69135),le=v(14987);const ie=(Re,fe)=>({"box-classrooms":Re,"box-max-classrooms":fe});function ze(Re,fe){if(1&Re&&(m.j41(0,"span",31),m.EFF(1),m.k0s()),2&Re){let Ue;const E=m.XpG();m.R7$(),m.JRh(null!==(Ue=null==E.studentsInClassResults[0].classObj?null:E.studentsInClassResults[0].classObj.name)&&void 0!==Ue?Ue:"")}}function Te(Re,fe){if(1&Re&&(m.j41(0,"div",36)(1,"div",18),m.nrm(2,"input",37),m.j41(3,"label",38,0),m.EFF(5),m.k0s()()()),2&Re){let Ue;const E=fe.$implicit,L=m.sdS(4),W=m.XpG(2);m.Y8G("hidden",1===W.studentsInClassResults.length),m.R7$(2),m.Mz_("id","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),m.Y8G("value",null==E.classObj?null:E.classObj.id),m.R7$(),m.Mz_("for","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),m.Y8G("matTooltip",null!==(Ue=null==E.classObj?null:E.classObj.name)&&void 0!==Ue?Ue:"")("isDisabledTooltip",!1)("matTooltipDisabled",L.isDisabled),m.R7$(2),m.JRh(null==E.classObj?null:E.classObj.name)}}function Qe(Re,fe){if(1&Re&&(m.j41(0,"div",32)(1,"ng-scrollbar",33)(2,"div",34),m.DNE(3,Te,6,10,"div",35),m.k0s()()()),2&Re){const Ue=m.XpG();m.Y8G("ngClass",m.l_i(3,ie,Ue.form.controls.listStudents.controls.length>21||Ue.studentsInClassResults.length>18,Ue.form.controls.listStudents.controls.length<=21&&Ue.studentsInClassResults.length>18)),m.R7$(),m.Y8G("visibility","hover"),m.R7$(2),m.Y8G("ngForOf",Ue.studentsInClassResults)}}function ve(Re,fe){if(1&Re&&(m.j41(0,"label",38,0),m.EFF(2),m.k0s()),2&Re){const Ue=m.sdS(1),E=m.XpG().$implicit;m.Mz_("for","select-classroom-export__",E.controls.id.value,""),m.Y8G("matTooltip",E.controls.label.value)("isDisabledTooltip",!1)("matTooltipDisabled",Ue.isDisabled),m.R7$(2),m.SpI(" ",E.controls.label.value," ")}}function nt(Re,fe){if(1&Re&&(m.j41(0,"label",44),m.nrm(1,"img",45),m.k0s()),2&Re){const Ue=m.XpG().$implicit;m.Mz_("for","select-classroom-export__",Ue.controls.id.value,""),m.R7$(),m.Y8G("nameImages",Ue.controls.nameImages.value)}}function at(Re,fe){if(1&Re){const Ue=m.RV6();m.j41(0,"div",39)(1,"div",40)(2,"input",41),m.bIt("change",function(){m.eBV(Ue);const L=m.XpG();return m.Njj(L.onChangeStudentOption())}),m.k0s(),m.DNE(3,ve,3,6,"label",42)(4,nt,2,3,"label",43),m.k0s()()}if(2&Re){const Ue=fe.$implicit;m.R7$(),m.Y8G("formGroup",Ue),m.R7$(),m.Mz_("id","select-classroom-export__",Ue.controls.id.value,""),m.R7$(),m.Y8G("ngIf",Ue.controls.label.value||!Ue.controls.isImage.value),m.R7$(),m.Y8G("ngIf",!Ue.controls.label.value&&Ue.controls.isImage.value&&Ue.controls.nameImages.value)}}function se(Re,fe){1&Re&&(m.j41(0,"span",27),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()),2&Re&&(m.R7$(),m.SpI("* ",m.bMT(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function ee(Re,fe){if(1&Re){const Ue=m.RV6();m.j41(0,"div",49),m.bIt("click",function(){m.eBV(Ue);const L=m.XpG(2);return m.Njj(L.showAskInfo=!0)}),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()}2&Re&&(m.R7$(),m.SpI("+ ",m.bMT(2,1,"lang_testbank_test_config_add_information"),""))}function Be(Re,fe){if(1&Re&&(m.j41(0,"div"),m.nrm(1,"add-info-print",50),m.k0s()),2&Re){const Ue=m.XpG(2);m.R7$(),m.Y8G("form",Ue.form)}}function ge(Re,fe){1&Re&&(m.j41(0,"span",53),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()),2&Re&&(m.R7$(),m.SpI("(",m.bMT(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function X(Re,fe){if(1&Re){const Ue=m.RV6();m.j41(0,"div",51),m.bIt("click",function(){m.eBV(Ue);const L=m.XpG(2);return m.Njj(L.showAskInfo=!1)}),m.EFF(1),m.nI1(2,"mytranslate"),m.nI1(3,"mytranslate"),m.nI1(4,"lowercase"),m.DNE(5,ge,3,3,"span",52),m.k0s()}if(2&Re){const Ue=m.XpG(2);m.R7$(),m.Lme(" ",m.bMT(2,3,"lang_auto_huy")," ",m.bMT(4,7,m.bMT(3,5,"lang_testbank_test_config_add_information"))," "),m.R7$(4),m.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo)}}function pe(Re,fe){if(1&Re&&(m.j41(0,"div")(1,"span",46),m.EFF(2),m.nI1(3,"mytranslate"),m.k0s(),m.DNE(4,ee,3,3,"div",47)(5,Be,2,1,"div",26)(6,X,6,9,"div",48),m.k0s()),2&Re){const Ue=m.XpG();m.R7$(2),m.Lme("* ",m.bMT(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",Ue.countStudentSelect,""),m.R7$(2),m.Y8G("ngIf",Ue.isAskInfo&&!Ue.showAskInfo),m.R7$(),m.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo),m.R7$(),m.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo)}}function lt(Re,fe){1&Re&&(m.j41(0,"div")(1,"div",15)(2,"span",27),m.EFF(3),m.nI1(4,"mytranslate"),m.k0s()()()),2&Re&&(m.R7$(3),m.SpI("* ",m.bMT(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let Ee=(()=>{var Re;class fe extends c._{confirmAction(){const E=this.form.value,L=this.studentsInClassResults.find(W=>W.classObj?.id===E.classId);if(L){const W=E.listStudents?.filter($=>$.choose).map($=>$.id);L.results=L.results?.filter($=>W?.includes($.reId)),L.schoolName=this.showAskInfo?E.schoolName:void 0,L.subjectName=this.showAskInfo?E.subjectName:void 0,this.dialogRef.close(L)}else this.dialogRef.close()}setChangeSelectAll(){const E=this.form.controls.selectAll;if(E){E.setValue(!E.value);const L=this.form.controls.listStudents;L&&L.controls.forEach(W=>{W.controls.choose.setValue(E.value)}),this.countStudentSelect=E.value?L.controls.length:0}}onChangeStudentOption(){const E=this.form.controls.listStudents;let L=!0,W=0;E&&E.controls.forEach(we=>{!1===we.controls.choose.value?L=!1:W++});const $=this.form.controls.selectAll;$&&$.setValue(L),this.countStudentSelect=W}setupArrayStudent(E){this.currNameClass=E.classObj?.name??"";const L=this.form.controls.listStudents;if(L){L.clear();let W=E.results??[];if(void 0!==E.classObj?.sortType){let $=E.classObj?.sortType;W=0==$?this.sortService.sortFirstNameStudents(this.commonService.myClone(W)):99==$?this.sortService.sortTimeDESC(this.commonService.myClone(W)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone(W),"pos","id")}W.forEach($=>{($.confirmedAt||!this.data.examHasEssay&&1==$.status)&&L.push(new D.gE({isImage:new D.MJ(!!$.nameImages,{nonNullable:!0}),nameImages:new D.MJ($.nameImages,{nonNullable:!0}),label:new D.MJ($.fullName,{nonNullable:!0}),id:new D.MJ($.reId,{nonNullable:!0}),choose:new D.MJ(!1,{nonNullable:!0})}))})}}classroomChange(E){this.setupArrayStudent(E)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let E=this.studentsInClassResults[0];this.form.controls.classId.setValue(E.classObj?.id),this.setupArrayStudent(E),this.form.controls.classId.valueChanges.subscribe(W=>{const $=this.form.controls.selectAll;$&&$.setValue(!1),this.countStudentSelect=0;const we=this.studentsInClassResults.find(ue=>ue.classObj?.id===W);we&&this.setupArrayStudent(we)})}}constructor(E,L,W){super(L,W),this.sortService=E,this.data=L,this.dialogRef=W,this.studentsInClassResults=[],this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=L.isAskInfo,this.studentsInClassResults=L.studentsInClassResults.map($=>({...$,results:$.results?.map(we=>({...we,reId:Ie.P.generateIdRequired(10)}))})),this.form=new D.gE({classId:new D.MJ(0,{nonNullable:!0,validators:[D.k0.required]}),selectAll:new D.MJ(!1,{nonNullable:!0}),listStudents:new D.Yp([]),schoolName:new D.MJ("",{nonNullable:!0}),subjectName:new D.MJ("",{nonNullable:!0})})}}return(Re=fe).\u0275fac=function(E){return new(E||Re)(m.rXU(J.g),m.rXU(d.Vh),m.rXU(d.CP,8))},Re.\u0275cmp=m.VBU({type:Re,selectors:[["app-select-student-to-export-docx"]],features:[m.Vt3],decls:48,vars:35,consts:[["c","isDisabled"],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"change","checked"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"change","id"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(E,L){1&E&&(m.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.j41(6,"div",5)(7,"a",6),m.nrm(8,"lucide-icon",7),m.k0s()()(),m.j41(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11),m.EFF(13),m.nI1(14,"mytranslate"),m.DNE(15,ze,2,1,"span",12),m.k0s()(),m.DNE(16,Qe,4,6,"div",13),m.j41(17,"div",14)(18,"div",15)(19,"div",16),m.EFF(20),m.nI1(21,"mytranslate"),m.k0s()(),m.j41(22,"div",17)(23,"div",18)(24,"input",19),m.bIt("change",function(){return L.setChangeSelectAll()}),m.k0s(),m.j41(25,"label",20),m.EFF(26),m.nI1(27,"mytranslate"),m.k0s()()(),m.j41(28,"div",21)(29,"ng-scrollbar",22)(30,"div",23),m.DNE(31,at,5,5,"div",24),m.k0s()()(),m.j41(32,"div",15),m.DNE(33,se,3,3,"span",25)(34,pe,7,7,"div",26),m.k0s()(),m.j41(35,"div",14)(36,"div",15)(37,"span",27),m.EFF(38),m.nI1(39,"mytranslate"),m.k0s()()()(),m.DNE(40,lt,5,3,"div",26),m.k0s(),m.j41(41,"div",28)(42,"a",29),m.EFF(43),m.nI1(44,"mytranslate"),m.k0s(),m.j41(45,"button",30),m.bIt("click",function(){return L.confirmAction()}),m.EFF(46),m.nI1(47,"mytranslate"),m.k0s()()()()),2&E&&(m.R7$(4),m.JRh(m.bMT(5,21,"lang_testbank_what_to_export_select_students_export")),m.R7$(6),m.Y8G("formGroup",L.form)("hidden",0===L.studentsInClassResults.length),m.R7$(),m.Y8G("hidden",1===L.studentsInClassResults.length&&null==L.studentsInClassResults[0].classObj),m.R7$(2),m.SpI(" ",m.bMT(14,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),m.R7$(2),m.Y8G("ngIf",1===L.studentsInClassResults.length),m.R7$(),m.Y8G("ngIf",L.studentsInClassResults.length>1),m.R7$(),m.Y8G("hidden",0===L.form.controls.listStudents.controls.length),m.R7$(3),m.SpI("",m.bMT(21,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),m.R7$(4),m.Y8G("checked",L.form.controls.selectAll.value),m.R7$(2),m.JRh(m.bMT(27,27,"lang_auto_chon_tat_ca")),m.R7$(3),m.Y8G("visibility","hover"),m.R7$(2),m.Y8G("ngForOf",L.form.controls.listStudents.controls),m.R7$(2),m.Y8G("ngIf",0===L.countStudentSelect),m.R7$(),m.Y8G("ngIf",L.countStudentSelect>0),m.R7$(),m.Y8G("hidden",L.form.controls.listStudents.controls.length>0),m.R7$(3),m.SpI("* ",m.bMT(39,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),m.R7$(2),m.Y8G("ngIf",0===L.studentsInClassResults.length),m.R7$(3),m.SpI(" ",m.bMT(44,31,"lang_cms_common_close_btn")," "),m.R7$(2),m.Y8G("disabled",0===L.countStudentSelect),m.R7$(),m.SpI(" ",m.bMT(47,33,"lang_cms_common_confirm_btn")," "))},dependencies:[x.YU,x.Sq,x.bT,d.tx,V.oV,w.Yh,D.qT,D.me,D.Zm,D.Fm,D.BC,D.cb,D.j4,D.JD,D.v8,U.t,de.y,_e.f,le.i,re.WGl,x.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),fe})();var H=v(5382),xe=v(64198),mt=v(25539),rt=v(81234),Et=v(92229),Xe=v(50622),pt=v(91640),Ze=v(41325),Ge=v(40949),K=v(51113),ce=v(53393),me=v(99927),G=v(99172),F=v(32639),S=v(62095),j=v(46134),Me=v(9280),Ne=v(87515),Oe=v(10296),We=v(46899),Le=v(32610);let xt=(()=>{var Re;class fe{processHomeworks(E,L){return new Promise((W,$)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(L).subscribe(we=>{if(1==we.success){this.logger.remove();var ue=[];we.data?.studentObjs.forEach(Z=>{ue.push({id:Z.id,fullName:Z.fullName,confirmedAt:Z.confirmedAt,homeworkAnswerId:Z.answer?.id,studentId:void 0,resultId:void 0,userId:void 0,nameImages:void 0,reId:"",status:void 0})}),this.sAztDialogService.open(Ee,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:we.data?.classroomObj,results:ue,schoolName:void 0,subjectName:void 0}],examHasEssay:!1,isAskInfo:!1}}).afterClosed().subscribe(Z=>{if(Z){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===Z.results?.length?"":Z.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Fe=new Et.Y(!0);this.logger.pushChild(Fe),this.loadLibAction(Fe).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===Z.results?.length?"":Z.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Ce=new Et.Y(!0);this.logger.pushChild(Ce);const be=new H.n(1,{function:($e,Ye,Ke)=>{Ce.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===Ye?"":"th\u1ee9 "+($e+1)} ${Ke?": "+Ke:""}`)}});Z.results?.forEach($e=>{const Ye=new Et.Y;Ce.pushChild(Ye),be.addTask(this,this.makeFileHomework,[L,$e,Ye],$e.fullName??"")}),be.start().then($e=>{Ce.remove(),0===$e.errs.length?this.finishHomework(Z.classObj?.name??"",we.data?.homeworkObj?.name??"",$e,W,$):(this.logger.remove(),this.sAztDialogService.open(q,{data:{result:$e},restoreFocus:!1}).afterClosed().subscribe(Ye=>{Ye&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(Z.classObj?.name??"",we.data?.homeworkObj?.name??"",$e,W,$))}))})}).catch(Ce=>{this.logger.remove(),$(Ce)})}})}else this.logger.remove(),$(new Error(this.commonService.myTranslateInstant(we.message)))})})}processClasses(E,L){return new Promise((W,$)=>{let we;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),L){case"highest":we=this.testedListApiService.getTestedHighestMark("export_tool",E);break;case"first":we=this.testedListApiService.getTestedFirstMark("export_tool",E);break;default:we=this.testedListApiService.getTestedLastMark("export_tool",E)}we.subscribe(ue=>{if(1==ue.success){this.logger.remove();let Z=!!ue.data?.questionObjs?.filter(Ce=>this.answerTypeService.isEssayAnswer(Ce)).length,Fe=[];if(ue.data?.studentsInClassResults?.forEach(Ce=>{let be=[];Ce.results?.forEach($e=>{be.push({id:$e.id?Number($e.id):void 0,fullName:$e.fullName??"",confirmedAt:$e.confirmedAt,studentId:$e.studentId?Number($e.studentCode):void 0,resultId:$e.resultId,userId:$e.userId?.toString(),nameImages:$e.nameImages,reId:"",status:$e.status})}),Fe.push({classObj:Ce.classObj,results:be,schoolName:void 0,subjectName:void 0})}),ue.data?.studentsNotInClassResults&&ue.data?.studentsNotInClassResults?.length>0){let Ce=[];ue.data.studentsNotInClassResults.forEach(be=>{Ce.push({id:be.id?Number(be.id):void 0,fullName:be.fullName??"",confirmedAt:be.confirmedAt,studentId:be.studentId?Number(be.studentCode):void 0,resultId:be.resultId,userId:be.userId?.toString(),nameImages:be.nameImages,reId:"",status:be.status})}),Fe.push({classObj:{id:0,name:this.commonService.myTranslateInstant("lang_auto_tu_do")??""},results:Ce,schoolName:void 0,subjectName:void 0})}this.sAztDialogService.open(Ee,{data:{studentsInClassResults:Fe,examHasEssay:Z,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(Ce=>{Ce?(this.expandInfoParse=this.commonService.castJsonToObj(ue.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===Ce.results?.length?"":Ce.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(E,Ce,Ce.classObj?.name??"",ue.data?.examObj,Ce.classObj?.id).then(()=>{this.logger.remove(),W()}).catch($e=>{this.logger.remove(),$($e)})):(this.logger.remove(),W())})}else this.logger.remove(),$(new Error(this.commonService.myTranslateInstant(ue.message)??""))})})}processUser(E,L,W,$,we,ue=!0,Z,Fe,Ce,be,$e){return new Promise((Ye,Ke)=>{this.reset(),we=we||this.logger,we?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Je=new Et.Y(!0);we?.pushChild(Je),this.loadLibAction(Je).then(()=>{we?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(E,W??"",$??"",L,$e).subscribe(R=>{if(1==R.success){this.expandInfoParse=this.commonService.castJsonToObj(R.data?.examObj?.expandInfo??"{}")??{},we?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let it=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const tt=R.data?.studentObj;we?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${tt?.fullName??""}`);let ct="";ct=R.data?.classroomObj?R.data?.classroomObj.name??it:it;const ot=R.data?.examTracks,dt=R.data?.examObj,St=R.data?.examResultObj,Ot=this.commonService.castJsonToClassObjs(mt.I,JSON.stringify(R.data?.questionObjs))??[];let qt=0,Ht=0;for(let ut=0;ut<Ot.length;ut++)Ot[ut].correctAnswer=this.commonService.isExistInArray(R.data?.correctQuestionIds,Ot[ut].id),Ot[ut].indexLabel=ut+(dt?.startQuestionIndex??1),dt?.resetQuestionIndex&&Ot[ut].groupInfo&&Ot[ut].groupInfo?.groupId&&(Ot[ut].groupInfo&&qt!=Ot[ut].groupInfo?.groupId&&(qt=Ot[ut].groupInfo?.groupId??0,Ht=0),Ot[ut].labelIndex=Ht+(dt?.startQuestionIndex??1),Ht++);const Wt={};let An=this.commonService.castJsonToObj(R.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(An??[],Wt);const Cn=new Et.Y;we?.pushChild(Cn),this.processConvertDataUser(Cn,Ot,tt,St).then(ut=>{if(ut){var dn=0;this.convertDataMarkNote(ut?.resultTeacherDraw).then(pn=>{this.loadTeacherDrawResult(pn,we??new Et.Y,tt?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",ut).then(zn=>{ut=zn,Cn.remove();const Vt=new Et.Y(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+`...${dn}%`);we?.pushChild(Vt);let yn=[];yn.push({content:this.getLineInfoData(ct,dt,ot,St,tt,Ot,ut,Z,Fe).join("<br/>")+"<br/><br/><br/>",answers:[]}),yn=yn.concat(this.startGenUserLineFile(St,Ot,ut,Ce,be));var jn=0;this.sAztDocxService.exportToDocxBinary((0,rt.Wn)(yn),{isHeadless:!0},(Kt,vn,mn)=>{new Promise(wn=>{setTimeout(()=>{0==Kt&&(dn=jn),jn=Kt/vn*50+dn;const fn=this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+"..."+Math.floor(jn)+"%";Vt?.pushMsg(fn)}),wn(!0)})}).then(Kt=>{const vn=new Blob([Kt],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let mn=this.commonService.createFileNameExportFile([tt?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",St?.id?St.id.toString():""])+"_test_result";if(ue)if(ut.mediaAnswerWraps.concat(ut.mediaWraps).length>0){const wn=new l;wn.file(mn+".docx",vn),ut.mediaAnswerWraps.concat(ut.mediaWraps).forEach(fn=>{const nr=new Blob([fn]);wn.file("attachments/"+this.replaceParamFileName(fn.name),nr)}),wn.generateAsync({type:"blob"}).then(fn=>{let nr=this.commonService.createFileNameExportFile([ct,mn])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(fn,nr),we?.remove(),Ye()},fn=>{we?.remove(),Ye(fn)})}else this.shareFileFlutterService.shareFileWithBlob(vn,mn+".docx"),we?.remove(),Ye();else we?.remove(),Ye({name:mn,blob:vn,medias:ut.mediaAnswerWraps.concat(ut.mediaWraps)})})})})}}).catch(ut=>{we?.remove(),Ke(ut)})}else we?.remove(),Ke(new Error(this.commonService.myTranslateInstant(R.message)))})}).catch(R=>{we?.remove(),Ke(R)})})}finishClassroom(E,L,W,$,we){if(W.length>1){const ue=new l;W.forEach(Z=>{Z.medias.length>0?(ue.file(Z.name+"/"+Z.name+".docx",Z.blob),Z.medias.forEach(Fe=>{const Ce=new Blob([Fe]);ue.file(Z.name+"/attachments/"+this.replaceParamFileName(Fe.name),Ce)})):ue.file(Z.name+".docx",Z.blob)}),ue.generateAsync({type:"blob"}).then(Z=>{let Fe=this.commonService.createFileNameExportFile([E,L])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(Z,Fe),$()},Z=>{$(Z)})}else if(W[0].medias.length>0){const ue=new l;ue.file(W[0].name+"/"+W[0].name+".docx",W[0].blob),W[0].medias.forEach(Z=>{const Fe=new Blob([Z]);ue.file(W[0].name+"/attachments/"+this.replaceParamFileName(Z.name),Fe)}),ue.generateAsync({type:"blob"}).then(Z=>{let Fe=this.commonService.createFileNameExportFile([E,L])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(Z,Fe),$()},Z=>{$(Z)})}else this.shareFileFlutterService.shareFileWithBlob(W[0].blob,W[0].name+".docx"),$()}finishHomework(E,L,W,$,we){if(1===W.datas.length)if(W.datas[0].medias.length>0){const ue=new l;ue.file(W.datas[0].name+"/"+W.datas[0].name+".docx",W.datas[0].blob),W.datas[0].medias.forEach(Z=>{const Fe=new Blob([Z]);ue.file(W.datas[0].name+"/attachments/"+this.replaceParamFileName(Z.name),Fe)}),ue.generateAsync({type:"blob"}).then(Z=>{let Fe=this.commonService.createFileNameExportFile([E,W.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(Z,Fe),$()},Z=>{this.logger.remove(),$(Z)})}else this.shareFileFlutterService.shareFileWithBlob(W.datas[0].blob,W.datas[0].name+".docx"),this.logger.remove(),$();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const ue=new l;W.datas.forEach(Z=>{Z.medias.length>0?(ue.file("results/"+Z.name+"/"+Z.name+".docx",Z.blob),Z.medias.forEach(Fe=>{const Ce=new Blob([Fe]);ue.file("results/"+Z.name+"/attachments/"+this.replaceParamFileName(Fe.name),Ce)})):ue.file("results/"+Z.name+".docx",Z.blob)}),ue.generateAsync({type:"blob"}).then(Z=>{let Fe=this.commonService.createFileNameExportFile([E,L])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(Z,Fe),this.logger.remove(),$()},Z=>{this.logger.remove(),we(Z)})}}makeFileHomework(E,L,W){return new Promise(($,we)=>{W.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(E,L.homeworkAnswerId??0).subscribe(ue=>{if(W.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(ue.data?.answerObj),ue.data?.answerObj){W.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let Fe=this.commonService.castJsonToObj(ue.data.answerObj.result??"")??{};this.convertDataMarkNote(Fe).then(Ce=>{this.loadTeacherDrawResult(Ce,W,L.fullName??"").then(be=>{W.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let $e=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${ue.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${ue.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${ue.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${ue.data?.answerObj?.id} <br/>`].forEach(Ke=>{$e.push({content:Ke,answers:[]})});let Ye=this.commonService.castJsonToObj(ue.data?.answerObj?.resultNote??"");if(Ye){const Ke=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],Je=document.createElement("p");Je.innerText=this.commonService.myTranslateInstant("lang_point")??"",Je.setAttribute("docx-style",rt.$s.get("TB_RESULT_TXT"));const R=document.createElement("p");let it=ue.data?.answerObj?.point;Ke.forEach(ot=>{ot.mark===it&&(it=this.commonService.myTranslateInstant(ot.lang))}),R.innerText=it?.toString()??"",R.setAttribute("docx-style",rt.$s.get("TB_RESULT_POINT"));const tt=document.createElement("p");tt.setAttribute("docx-style",rt.$s.get("TB_RESULT_TXT")),tt.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const ct=document.createElement("span");ct.setAttribute("docx-style",rt.$s.get("TB_RESULT_COMMENT")),0===Ye?.IsHideMark&&(ct.innerText=this.getTextContentInTagHTML(Ye.Note),be.resultTeacherDraw?.commentEmoji&&(ct.appendChild(document.createElement("br")),be.resultTeacherDraw.commentEmoji.forEach(ot=>{if(be.canvasList[ot]){const dt=new Image;dt.src=be.canvasList[ot].toDataURL(),dt.style.width=be.canvasList[ot].width/5+"px",dt.style.height=be.canvasList[ot].height/5+"px",ct.appendChild(dt)}}))),$e.push({content:rt.$s.makeHeaderTable([Je,R],[tt,ct]),answers:[]})}$e=$e.concat(this.getLineImageAnswer(be)),this.sAztDocxService.exportToDocxBinary((0,rt.Wn)($e),{isHeadless:!0},(Ke,Je,R)=>{}).then(Ke=>{W.remove();const Je=new Blob([Ke],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let R=`${this.commonService.convertVietnameseToEnglish(L.fullName??"")}_${ue.data?.answerObj?.id??0}`;$({name:R,blob:Je,medias:be.mediaAnswerWraps.concat(be.mediaWraps)})})}).catch(be=>{W.remove(),we(be)})})}else W.remove(),we(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(E,L,W,$,we){return new Promise((ue,Z)=>{const Fe=new H.n(1,{function:($e,Ye)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===Ye?"":` (${$e+1}/${Ye})`}`),this.logger.percent=$e/Ye}},1e3),Ce=[];let be=this.homeworkExamService.isOfflineExam($);L.results?.forEach($e=>{Fe.addTask(this,()=>new Promise((Ye,Ke)=>{const Je=new Et.Y(!0,"");this.logger.pushChild(Je),this.processUser(E,Number($e.resultId),$e.userId,$e.studentId?.toString(),Je,!1,L.schoolName,L.subjectName,be,void 0,we).then(R=>{R?(Je.remove(),Ce.push(R),Ye()):(Je.remove(),Ke(new Error))}).catch(R=>{Je.remove(),Ke(R)})}))}),Fe.start().then($e=>{$e.errs.length>0?(this.logger.remove(),$e.datas=Ce,this.sAztDialogService.open(q,{data:{result:$e},restoreFocus:!1}).afterClosed().subscribe(Ye=>{Ye&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom(W,$?.name??"",Ce,ue,Z))})):this.finishClassroom(W,$?.name??"",Ce,ue,Z)})})}processConvertDataUser(E,L,W,$){return new Promise((we,ue)=>{let Z={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Fe=(this.commonService.myParseJson($?.files??"[]")??[]).filter(R=>(0,xe.rl)(R.mimes??"")||(0,xe.nL)(R.mimes??""));E.start();const Je=new H.n(1,{function:(R,it,tt)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${R+1}/${it}: ${tt}`)}});Je.addTask(this,()=>new Promise((R,it)=>{const tt=new Et.Y(!0);E.pushChild(tt),this.questionRenderService.parseRenderQuestions(L,ct=>{tt.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(ct)}%`)},void 0,50,!0).then(()=>{tt.remove(),R()}).catch(ct=>{const ot=dt=>{Object.prototype.hasOwnProperty.call(dt,"type")&&"LOAD_IMAGE"===dt.type?it(new Error(`${dt.message} ${this.commonService.trimMidLimitLength(dt.data[0],30)}`)):it(ct)};tt.remove(),Array.isArray(ct)?ot(ct[0]):ot(ct)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),$&&$.result&&Je.addTask(this,()=>new Promise((R,it)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj($?.result??"")??{},E,W?.fullName??"").then(tt=>{Z=tt,R()}).catch(tt=>{it(tt)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),Je.addTask(this,()=>new Promise((R,it)=>{W?this.loadNameImage(W).then(tt=>{W=tt,R()}).catch(tt=>{it(tt)}):it(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),Z.isExportMedia&&Je.addTask(this,()=>new Promise((R,it)=>{const tt=new Et.Y(!0);E.pushChild(tt);const ct=new H.n(3,{function:(ot,dt)=>{tt.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${ot}/${dt})`)}},100);L.forEach(ot=>{ot.attachments&&ot.attachments.length>0&&ot.attachments.forEach(dt=>{ct.addTask(this,this.loadAztFile,[dt,Z,"att"])})}),ct.start().then(ot=>{0===ot.errs.length?(tt.remove(),R()):(tt.remove(),it(ot.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),Fe.length&&Je.addTask(this,()=>new Promise((R,it)=>{const tt=new Et.Y(!0);E.pushChild(tt);const ct=new H.n(3,{function:(ot,dt)=>{tt.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${ot}/${dt})`)}},100);Fe.forEach(ot=>{ct.addTask(this,this.loadAztFile,[ot,Z,"ans"])}),ct.start().then(ot=>{0===ot.errs.length?(tt.remove(),R()):(tt.remove(),it(ot.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem_tu_luan")),Je.start().then(R=>{E.remove(),0===R.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(L,$),we(Z)):ue(R.errs[0])})})}hasMultiple(E){let L=!1;for(let W=0;W<E.length;W++)if(this.answerTypeService.isOneChoiceAnswer(E[W])){L=!0;break}return L}hasEssay(E){let L=!1;for(let W=0;W<E.length;W++)if(this.answerTypeService.isEssayAnswer(E[W])){L=!0;break}return L}getLineInfoData(E,L,W,$,we,ue,Z,Fe,Ce){const be=[];be.push(rt.$s.makeHeaderTable([rt.$s.createLineCenterBold(Fe||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toUpperCase()} }`)],[rt.$s.createLineCenterBold(L?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),rt.$s.createLineCenterBold(Ce||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),rt.$s.createLineCenterBold(L?.minutes&&L?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+L?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const $e=ue.filter(Ye=>this.answerTypeService.isEssayAnswer(Ye)).length;return we&&we.nameImages&&parseInt(we?.id??"0")<=0?be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${we?.nameImages.url}" />`):be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${we?.fullName}`),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${E}`),L?.subjectMarks&&$?.subjectMarkValues&&$.subjectMarkValues.forEach((Ye,Ke)=>{be.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${Ke+1} </b>: ${Ye}/10`)}),this.hasMultiple(ue)&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${$?.trueFalseMark} (${$?.rightAnswer}/${($?.totalQuestion??0)-$e} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(ue)&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${$?.essayMark+" ("+$e+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(ue)&&Z.resultTeacherDraw&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj($?.files??"")?.length??"0"}`),W&&0!=L?.autoMonitor&&(be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${W.exitFullScreen}`),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${W.blurWindow}`)),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${$?.id}`),be}startGenUserLineFile(E,L,W,$,we){let ue=[];const Z=this.commonService.castJsonToObj(E?.answers??"");return Z&&L.forEach(Fe=>{Fe.groupInfo&&Fe.groupInfo.isFirstInGroup&&ue.push({content:`<br/><b>${Fe.groupInfo.groupContent}</b><br/>`,answers:[]}),Fe.attachments&&W.isExportMedia&&Fe.attachments.forEach(be=>{ue.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(be.name)}]`,answers:[]})}),ue=ue.concat(this.genLineQuestion(Fe,$));const Ce=this.mapQuestResultObj(Fe,Z??[]);switch(Fe.answerType){case 1:ue=ue.concat(this.genLineAnswerType1(Fe,Ce));break;case 3:ue=ue.concat(this.genLineAnswerType3(Fe,Ce));break;case 4:ue=ue.concat(this.genLineAnswerType4(Fe,Ce));break;case 5:ue=ue.concat(this.genLineAnswerTrueFalseType5(Fe,Ce))}we&&Fe.help&&ue.push({content:`<br/><b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b> ${Fe.help}<br/><br/>`,answers:[]})}),this.hasEssay(L)&&(ue=ue.concat(this.getLineImageAnswer(W))),ue}genLineQuestion(E,L){const W=[];let $=this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"),we=this.answerTypeService.isFillAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_fill_blank"):this.answerTypeService.isEssayAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_essay"):this.commonService.myTranslateInstant("azt_lang_sugg_type_multiple_choice"),ue={content:"<b>"+$+" "+(E.labelIndex??E.indexLabel??1)+". "+(L?`(${we})`:"")+"</b> "+(E.content?.includes("<img")?"<br/>":"")+E.content,answers:L&&(this.answerTypeService.isFillAnswer(E)||this.answerTypeService.isEssayAnswer(E))?[]:this.convertAnswerQuestion(E.answers??[],!!this.answerTypeService.isTrueFalseAnswer(E))};return W.push(ue),W}mapQuestResultObj(E,L){return L.find($=>$.QuestionId===E.id)||{QuestionId:E.id??0,AnswerContent:[]}}convertAnswerQuestion(E,L){let W=[];return E.forEach($=>{let we=$.alpha?$.alpha:$.key,ue="<b>     "+(L?we.toLocaleLowerCase()+")":we)+".</b> "+$.content;W.push(ue)}),W}genLineAnswerType1(E,L){const W=document.createElement("table"),$=E.correctAnswer?rt.JP:rt.ep;W.setAttribute("docx-style",rt.$s.get("TABLE"));const we=[],ue=document.createElement("tr");W.appendChild(ue);const Z=document.createElement("td");Z.setAttribute("docx-style",rt.$s.get("CORRECT",[{key:rt.Xe,value:$}]));const Fe=document.createElement("span"),Ce=E.answers?E.answers.filter(Ye=>E.answerResult?.includes(Ye.key)).map(Ye=>Ye.alpha??Ye.key).join(" & "):E.answerResult?.join(" & ");Fe.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+Ce,Fe.setAttribute("color",$),Z.appendChild(Fe),ue.appendChild(Z);const be=document.createElement("span"),$e=document.createElement("span");return be.innerText="\u2713",be.setAttribute("color",rt.JP),$e.innerText="\u2717",$e.setAttribute("color",rt.ep),E.answers?.forEach((Ye,Ke)=>{const Je=document.createElement("td"),R=document.createElement("span"),it=[{key:rt.Xe,value:$}];it.push({key:rt.n1,value:Ke+1===E.answers?.length?$:"FFFFFF"}),Je.setAttribute("docx-style",rt.$s.get("KEY_RESULT",it)),R.innerText=Ye.alpha??Ye.key,L.AnswerContent.filter(ct=>ct.Content===Ye.key).length>0&&Je.appendChild(E.correctAnswer?be:$e),Je.appendChild(R),ue.appendChild(Je)}),we.push({content:`<br>${W.outerHTML}<br><br><br>`,answers:[]}),we}genLineAnswerTrueFalseType5(E,L){const W=[],$=E.correctAnswer?rt.JP:rt.ep,we=this.commonService.myTranslateInstant("lang_auto_dung"),ue=this.commonService.myTranslateInstant("lang_auto_sai"),Z=this.sAztAnswerTrueFalseService.checkLabelKeys([],E?.answers,E?.answerResult),Fe=(it,tt)=>{const ct=document.createElement("span");return ct.innerText=it,ct.setAttribute("color",tt),ct},$e=document.createElement("table");$e.setAttribute("docx-style",rt.$s.get("TABLE"));const Ye=document.createElement("tr"),Ke=Fe(this.commonService.myTranslateInstant("lang_auto_dap_an")??"",$),Je=document.createElement("td"),R=[{key:rt.Xe,value:$}];return R.push({key:rt.n1,value:$}),Je.setAttribute("docx-style",rt.$s.get("KEY_RESULT",R)),E.answers?.forEach(it=>{const tt=this.sAztAnswerTrueFalseService.checkIsTrueType5(it,Z,L.AnswerContent),ct=this.commonService.myTranslateInstant(this.sAztAnswerTrueFalseService.getAnswerChoiceTrueFalseQuestion(it,L.AnswerContent))??"";Je.appendChild(((it,tt,ct)=>{const ot=document.createElement("div"),dt=document.createElement("span"),St=tt?rt.JP:rt.ep;return dt.innerText=(it.alpha??it.key).toLowerCase()+"-",ot.appendChild(Fe(tt?"\u2713":"\u2717",St)),ot.appendChild(dt),ot.appendChild(Fe(ct??"",St)),ot})(it,tt,ct)),Je.appendChild(document.createElement("br"))}),Ye.appendChild(((it,tt)=>{const ct=document.createElement("td");return ct.appendChild(it),E.answers.length&&E.answers.forEach(ot=>{const dt=document.createElement("span");dt.setAttribute("color",this.sAztAnswerTrueFalseService.checkIsTrueType5(ot,Z,L.AnswerContent)?rt.JP:rt.ep),dt.innerText=` ${(ot.alpha?ot.alpha:ot.key?ot.key:ot).toString().toLowerCase()}-${Z.includes((ot.alpha?ot.alpha:ot.key?ot.key:"")+"T")?we:ue} `,ct.appendChild(dt)}),ct.setAttribute("docx-style",tt),ct})(Ke,rt.$s.get("CORRECT",[{key:rt.Xe,value:$}]))),Ye.appendChild(Je),$e.appendChild(Ye),W.push({content:`<br>${$e.outerHTML}<br><br><br><br><br><br>`,answers:[]}),W}genLineAnswerType3(E,L){const W=[];return W.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/><br/>`,answers:[]}),0===L.AnswerContent.length?W.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):L.AnswerContent.forEach($=>{W.push({content:`<span>${$.Content}</span>`,answers:[]})}),W.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${E.essayMarkParsed} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${E.scorePerQuestion})</b>`,answers:[]}),W}genLineAnswerType4(E,L){const W=document.createElement("table"),$=E.correctAnswer?rt.JP:rt.ep;W.setAttribute("docx-style",rt.$s.get("TABLE"));const we=[],ue=document.createElement("tr");ue.setAttribute("docx-style",rt.$s.get("TR")),W.appendChild(ue);const Z=document.createElement("td");Z.setAttribute("docx-style",rt.$s.get("CORRECT",[{key:rt.Xe,value:$}]));const Fe=document.createElement("span");Fe.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+E.answerResult?.join(";")+"]",Fe.setAttribute("color",$),Z.appendChild(Fe),ue.appendChild(Z),0===L.AnswerContent.length&&L.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const Ce=document.createElement("td"),be=document.createElement("span");return Ce.setAttribute("docx-style",rt.$s.get("FILL_RESULT",[{key:rt.Xe,value:$}])),be.innerText=L.AnswerContent.map(Ye=>Ye.Content).join(";"),Ce.appendChild(be),ue.appendChild(Ce),we.push({content:`<br>${W.outerHTML}<br><br><br>`,answers:[]}),we}loadNameImage(E){return new Promise((L,W)=>{E&&E.nameImages&&parseInt(E?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(E.nameImages).then($=>{$&&E.nameImages&&(E.nameImages.url=$),L(E)}).catch($=>{W($)}):L(E)})}loadCssFrameAction(){return new Promise(E=>{const L=document.createElement("div"),W=$=>{const we=document.createElement("span");return we.style.fontFamily=$,we.innerText="Aa",we};L.appendChild(W("font_chu_dep")),L.appendChild(W("font_chu_dep_z")),L.appendChild(W("font_chu_in")),L.appendChild(W("font_chu_in_nghieng")),L.appendChild(W("font_chu_in_dam")),L.style.opacity="0",document.body.appendChild(L),setTimeout(()=>{L.remove(),E()},2e3)})}loadLibAction(E){return new Promise((L,W)=>{this.commonService.loadAzotaDocxJs().then(()=>{const $=new H.n(1,{function:(we,ue,Z)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${we+1}/${ue}: ${Z}`)}});$.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),$.start().then(we=>{E.remove(),we.errs.length>0?W(we.errs[0]):L()})}).catch($=>{W($)})})}reset(){}checkUrlIsImage(E){return null!=E.match(/\.(jpeg|jpg|png|gif)(\?.*)?$/)}loadAztFile(E,L,W){return new Promise(($,we)=>{fetch(this.cdnService.getMyCdn(E.url??"")).then(ue=>{ue.ok?ue.blob().then(Z=>{const Ce=new File([Z],E.name??"",{type:E.mimes});"ans"===W?L.isExportAnsMedia&&L.mediaAnswerWraps.push(Ce):L.isExportMedia&&L.mediaWraps.push(Ce),$()}):we(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))}).catch(()=>{we(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))})})}wrapLoadMedia(E,L){return this.checkUrlIsImage(E)?(0,xe.qO)(E,L):new Promise((W,$)=>{W(void 0)})}replaceImageToBase64(E,L,W,$,we,ue){return new Promise((Z,Fe)=>{Object.prototype.hasOwnProperty.call(E,L)&&"string"==typeof E[L]?this.wrapLoadMedia(E[L],we).then(Ce=>{if(Ce){const be=document.createElement("canvas");be.width=Ce.width,be.height=Ce.height,be.getContext("2d")?.drawImage(Ce,0,0),E[L]=W.canvasList.push(be)-1,Z()}else{ue=ue?ue+1:1;let be=E[L].split(".");be=be.length>0?be[be.length-1]:"mp3";const $e=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",ue.toString(),$])+"."+be;this.loadAztFile({name:this.commonService.replaceAll($e,"_"," ")??"",url:E[L],path:"",extension:"",mimes:"",size:"0"},W,"ans").then(()=>{Z()}).catch(Ye=>{Fe(new Error(this.commonService.myTranslateInstant(Ye.message)+($.length>0?" : "+$:"")))})}}).catch(Ce=>{Fe(new Error(this.commonService.myTranslateInstant(Ce.message)+($.length>0?" : "+$:"")))}):Fe(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+($.length>0?" : "+$:"")))})}loadTeacherDrawResult(E,L,W,$){return new Promise((we,ue)=>{const Z=$??{canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Fe=new H.n(3,{function:(Ce,be)=>{L.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${Ce}/${be})`)}});if(Z.resultTeacherDraw=E,Z.resultTeacherDraw){Z.resultTeacherDraw.pages?.forEach((be,$e)=>{Fe.addTask(this,this.replaceImageToBase64,[be,"backgroundImage",Z,W,this.cdnService,$e]),be.draw&&Fe.addTask(this,this.replaceImageToBase64,[be,"draw",Z,W,this.cdnService,$e])});const Ce=this.commonService.castJsonToObj(Z.resultTeacherDraw.staticTextConfig??"");if(Z.resultTeacherConfig=Ce,Z.resultTeacherConfig&&Z.resultTeacherConfig.urlImgCorrect&&Z.resultTeacherConfig.urlImgWrong&&(Z.resultTeacherConfig.urlImgCorrect=(Z.resultTeacherConfig.type?"":"assets/images/classlive/")+Z.resultTeacherConfig.urlImgCorrect,Z.resultTeacherConfig.urlImgWrong=(Z.resultTeacherConfig.type?"":"assets/images/classlive/")+Z.resultTeacherConfig.urlImgWrong,Fe.addTask(this,this.replaceImageToBase64,[Z.resultTeacherConfig,"urlImgCorrect",Z,W]),Fe.addTask(this,this.replaceImageToBase64,[Z.resultTeacherConfig,"urlImgWrong",Z,W])),Z.resultTeacherDraw.commentEmoji&&Z.resultTeacherDraw.commentEmoji.length>0)for(let be=0;be<Z.resultTeacherDraw.commentEmoji.length;be++)Z.resultTeacherDraw.commentEmoji[be]="https://azota889.github.io/storage_public/mnote/"+Z.resultTeacherDraw.commentEmoji[be],Fe.addTask(this,this.replaceImageToBase64,[Z.resultTeacherDraw.commentEmoji,be,Z,W])}Fe.start().then(Ce=>{0===Ce.errs.length?we(Z):ue(Ce.errs[0])})})}capitalized(E){return E?E.charAt(0).toUpperCase()+E.slice(1):""}wrapText(E,L,W,$,we,ue){const Z=document.createElement("span");Z.innerHTML=this.commonService.removeXssInHtml(L),(L=Z.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(Ce=>{for(var be=Ce.split(" "),$e="",Ye=0;Ye<be.length;Ye++){var Ke=$e+be[Ye]+" ";E.measureText(Ke).width>we&&Ye>0?(E.fillText($e,W,$),$e=be[Ye]+" ",$+=ue):$e=Ke}E.fillText($e,W,$)})}getLineImageAnswer(E){const L=[];return E.mediaAnswerWraps&&E.isExportAnsMedia&&E.mediaAnswerWraps.forEach(W=>{L.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(W.name)}}</span>`,answers:[]})}),E.resultTeacherDraw&&E.resultTeacherDraw.pages?.forEach(W=>{let $=E.canvasList[Number(W.backgroundImage)];if($){const we=document.createElement("canvas");we.width=W.width??1,we.height=W.height??1;const ue=we.getContext("2d");if(ue){ue.fillStyle="#FFFFFF",ue.fillRect(0,0,we.width,we.height);let Ce=document.createElement("canvas"),be=Ce.getContext("2d");0!==W.rotation&&be?(90===Math.abs(W.rotation??0)?(Ce.width=$.height,Ce.height=$.width):(Ce.width=$.width,Ce.height=$.height),be.translate(Ce.width/2,Ce.height/2),be.rotate(((W.rotation??0)>0?1:-1)*(W.rotation??0)*Math.PI/180),be.drawImage($,-$.width/2,-$.height/2),be.restore()):Ce=$;const $e=we.height/Ce.height*Ce.width;if(ue.drawImage(Ce,0,0,Ce.width,Ce.height,(we.width-$e)/2,0,$e,we.height/Ce.height*Ce.height),W.draw){const Je=E.canvasList[Number(W.draw)];Je&&ue.drawImage(Je,0,0)}if(W.staticText&&W.staticText.length>0&&W.staticText.forEach(Je=>{if(ue.font=`${E.resultTeacherConfig?.fontSize}px ${E.resultTeacherConfig?.fontText}`,ue.fillStyle=E.resultTeacherConfig?.fontColor??"#000000",E.resultTeacherConfig?.useCorrectText&&"correct"==Je.value&&this.wrapText(ue,E.resultTeacherConfig?.textCorrect??"",Je.x,Je.y,we.width-Je.x,25),E.resultTeacherConfig?.useCorrectText&&"wrong"==Je.value&&this.wrapText(ue,E.resultTeacherConfig?.textWrong??"",Je.x,Je.y,we.width-Je.x,25),!E.resultTeacherConfig?.useCorrectText&&"correct"==Je.value){const R=E.canvasList[Number(E.resultTeacherConfig?.urlImgCorrect)];R&&ue.drawImage(R,0,0,R.width,R.height,Je.x,Je.y,30,30)}if(!E.resultTeacherConfig?.useWrongText&&"wrong"==Je.value){const R=E.canvasList[Number(E.resultTeacherConfig?.urlImgWrong)];R&&ue.drawImage(R,0,0,R.width,R.height,Je.x,Je.y,30,30)}}),W.objText&&W.objText.length>0){let Je=300;W.objText.forEach(R=>{ue.font=`${parseFloat(R.textStyle.size)}px ${R.textStyle.font}`,ue.fillStyle=R.textStyle.color,ue.textAlign=R.textStyle.align??"center",ue.lineWidth=R.textStyle.width??Je,this.wrapText(ue,R.value,R.x,R.y,we.width-R.x,25)})}}const Z=693,Fe=Z/we.width;L.push({content:`<img src="${we.toDataURL()}" style="width:${Z}px;height:${we.height*Fe}px" /><br/>`,answers:[]})}}),0===L.length?L.push({content:`<br/><br/>${rt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):L.unshift({content:`<br/>${rt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),L}convertDataMarkNote(E){return new Promise((L,W)=>{E&&E.urlDataMark?this.cdnService.loadTextCdn(this.cdnService.getMyCdn(E.urlDataMark)).subscribe($=>{const we=this.zipDataService.decodeContentGzip($),ue=this.commonService.castJsonToObj(we);E.pages=[];let Z={};ue?.pages.forEach((be,$e)=>{let Ye={width:be.width,height:be.height,draw:be.draws?.[0]?.src??void 0,backgroundImage:be.backgroundSrc,rotation:be.backgroundRotate,objText:[],staticText:[]};be.childData?.length&&be.childData.forEach((Ke,Je)=>{if("UIQuickMark"==Ke.className&&(Ye.staticText?.push({x:Ke.x+5,y:Ke.y+(Ke.height+5+Ke.fontSize)/2,value:"type_right"===Ke.type?"correct":"wrong"}),0===Je&&(Z={txtCommentFont:Ke.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:Ke.width,correctHeight:Ke.height,wrongWidth:Ke.width,wrongHeight:Ke.height,fontText:Ke.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:Ke.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!Z.urlImgWrong&&"type_wrong"==Ke.type&&(Z.urlImgWrong=Ke.imageSrc),!Z.urlImgCorrect&&"type_right"==Ke.type&&(Z.urlImgCorrect=Ke.imageSrc),!Z.textWrong&&"type_wrong"==Ke.type&&(Z.textWrong=Ke.textContent),!Z.textCorrect&&"type_right"==Ke.type&&(Z.textCorrect=Ke.textContent),Z.useCorrectText=!Z.urlImgCorrect,Z.useWrongText=!Z.urlImgWrong,"UIText"===Ke.className){let R=this.getStyleContent(Ke.textContent);Ye.objText?.push({x:Ke.x+15,y:Ke.y+15,value:Ke.textContent,textStyle:{size:Ke.fontSize?Ke.fontSize:R?.fontSize,align:R?.textAlign??"left",color:R?.color,fill:!0,font:R?.fontFamily}})}}),E.pages?.push(Ye)}),E.staticTextConfig=this.commonService.serializeJson(Z),L(E)}):L(E??{})})}getStyleContent(E){let L=document.createElement("div");L.innerHTML=this.commonService.removeXssInHtml(E);let W=L.querySelector("p"),$=L.querySelector("span");return $?{fontSize:$.style.fontSize,color:$.style.color,fontFamily:$.style.fontFamily,textAlign:W?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(E){return(new DOMParser).parseFromString(E,"text/html").body.textContent??E}replaceParamFileName(E){return E.replace(/\?.*$/,"")}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}constructor(E,L,W,$,we,ue,Z,Fe,Ce,be,$e,Ye,Ke,Je,R,it){this.sAztAnswerTrueFalseService=E,this.homeworkExamService=L,this.checkDrawImgNameService=W,this.cdnService=$,this.zipDataService=we,this.exportPdfUtilsService=ue,this.answerTypeService=Z,this.exportPdfConvertDataService=Fe,this.questionRenderService=Ce,this.commonService=be,this.answerService=$e,this.examResultService=Ye,this.testedListApiService=Ke,this.shareFileFlutterService=Je,this.sAztDialogService=R,this.sAztDocxService=it,this.logger=new Et.Y,this.expandInfoParse={}}}return(Re=fe).\u0275fac=function(E){return new(E||Re)(m.KVO(Xe.j),m.KVO(pt.Z),m.KVO(Ze.E),m.KVO(Ge.B),m.KVO(K.j),m.KVO(ce.j),m.KVO(me._),m.KVO(G.p),m.KVO(F.g),m.KVO(S.R),m.KVO(j._t),m.KVO(Me._j),m.KVO(Ne.h),m.KVO(Oe.R),m.KVO(We.i),m.KVO(Le.I))},Re.\u0275prov=m.jDH({token:Re,factory:Re.\u0275fac,providedIn:"root"}),fe})()},92229:(yt,ke,v)=>{v.d(ke,{Y:()=>l});class l{pushChild(c){this.child.push(c)}pushMsg(c){this.msg=c}start(c){this.run=!0,c&&(this.msg=c)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const c=[];return this.msg&&""!==this.msg&&c.push(this.msg),`<p>${c.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let c=[];return this.child.filter(m=>m.run).forEach(m=>{c=c.concat(m.lines)}),c}constructor(c=!1,m="",x){this.run=c,this.msg=m,this.percent=x,this.child=[]}}},44101:(yt,ke,v)=>{v.d(ke,{i:()=>hi});var l=v(48891),d=v(407),c=v(59702),m=v(59640),x=v(50622),C=v(99927),re=v(86622),y=v(46899);let oe=(()=>{var A;class Ve extends m.H{showExplain(){this.isTeacherRole||!this.examConfig||"SHOW_EXPLAIN"!==this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction||this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought?this.isShowExplainChange.emit(!this.isShowExplain):this.showDialogBuyExam(this.examObj)}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage(!0)}showDialogBuyExam(Ae){this.sAztDialogService.open(c.Q,{data:{examObj:Ae},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0})}isKey(Ae){return!(!this.questionObj?.answers||!this.questionObj.answerResult)&&(Ae.key?Ae.key==this.questionObj.answerResult[0]:Ae==this.questionObj.answerResult[0])}haveChoose(Ae){return!!this.userAnswersObj["id_"+this.questionObj?.id]&&(Ae.key?Ae.key.toString()==this.userAnswersObj["id_"+this.questionObj?.id]:Ae.toString()==this.userAnswersObj["id_"+this.questionObj?.id])}findKey(){this.questionObj?.answerResult&&this.labelArr.every(Ae=>!this.questionObj||!this.questionObj.answerResult||this.questionObj.answerResult[0]!=Ae.key||(this.key=(this.isShowOriginAnswer?Ae.key:Ae.alpha??Ae.key)??"",!1))}checkShowExplainButton(){this.isShowExplainButton=!!(this.questionObj.help||"lang_core_show_explain_required_payment"==this.questionObj.help&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigObj?.priceForAction)}checkLabelArr(){this.labelArr=this.sAztAnswerTrueFalseService.checkLabelArrOriginOrMix(this.questionAnswers,this.isShowOriginAnswer),this.findKey()}ngOnChanges(Ae){Ae.isShowOriginAnswer&&this.questionObj&&this.checkLabelArr()}ngOnInit(){if(super.ngOnInit(),this.isFillAnswer=this.questionObj?.correctAnswer??!1,this.answerTypeService.isTrueFalseAnswer(this.questionObj)?(this.keys=this.sAztAnswerTrueFalseService.checkLabelKeys(this.keys,this.questionObj?.answers,this.questionObj?.answerResult),this.isFillAnswer=!0):this.key=this.questionObj?.answerResult.length?this.questionObj.answerResult[0]:"",this.questionAnswers=(0,d.cloneDeep)(this.questionObj.answers??[]),this.checkLabelArr(),this.answerTypeService.isOneChoiceAnswer(this.questionObj))for(let Ae=0;Ae<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[Ae])&&this.haveChoose(this.labelArr[Ae]),!0!==this.isFillAnswer);Ae++);this.answerTypeService.isFillAnswer(this.questionObj)&&this.questionObj?.answerResult&&this.questionObj.answerResult.length>0&&(this.keys=this.questionObj.answerResult,this.isFillAnswer=this.questionObj?.correctAnswer??!1),this.checkShowExplainButton()}constructor(Ae,Pe,Zt,xn){super(),this.sAztAnswerTrueFalseService=Ae,this.answerTypeService=Pe,this.answerBoxService=Zt,this.sAztDialogService=xn,this.isShowExplain=!1,this.isOfflineMark=!1,this.isTeacherRole=!0,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.isShowExplainChange=new l.bkB,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1,this.isShowExplainButton=!1,this.questionAnswers=[]}}return(A=Ve).\u0275fac=function(Ae){return new(Ae||A)(l.rXU(x.j),l.rXU(C._),l.rXU(re.C),l.rXU(y.i))},A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-base"]],inputs:{examObj:"examObj",questionObj:"questionObj",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isTeacherRole:"isTeacherRole",isShowOriginAnswer:"isShowOriginAnswer",examConfig:"examConfig",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab",backToLink:"backToLink"},outputs:{isShowExplainChange:"isShowExplainChange"},features:[l.Vt3,l.OA$],decls:0,vars:0,template:function(Ae,Pe){},encapsulation:2}),Ve})();var z=v(54460),O=v(15343),k=v(76975);const q=A=>({width:A,visibility:"visible"}),D=()=>({"ml-1":!0}),Ie=A=>({color:A}),J=A=>({"border-color":A}),V=()=>({"text-danger wrongIcon mr-1":!0}),w=()=>({"rightIcon text-success mr-1":!0}),U=()=>({"text-danger mr-1":!0}),de=()=>({"text-success mr-1":!0});function _e(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"span",6),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",7),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("ngStyle",l.eq3(6,q,b.questionObj.help?"125px":"0px")),l.R7$(),l.SpI(" ",l.bMT(2,4,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",b.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(8,D))}}function le(A,Ve){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,V))}function ie(A,Ve){if(1&A&&l.DNE(0,le,1,2,"lucide-icon",16),2&A){const b=l.XpG().$implicit,Ae=l.XpG(2);l.Y8G("ngIf",Ae.haveChoose(b))}}function ze(A,Ve){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,w))}function Te(A,Ve){if(1&A&&(l.j41(0,"div",12),l.DNE(1,ie,1,1,"ng-template",13)(2,ze,1,2,"lucide-icon",14),l.j41(3,"span",15),l.EFF(4),l.k0s()()),2&A){const b=Ve.$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(Ae.isKey(b)&&Ae.haveChoose(b))),l.R7$(),l.Y8G("ngIf",Ae.isKey(b)&&Ae.haveChoose(b)),l.R7$(2),l.JRh(b.alpha?b.alpha:b.key?b.key:b)}}function Qe(A,Ve){if(1&A&&(l.j41(0,"div",8)(1,"span",9),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",10),l.DNE(5,Te,5,3,"div",11),l.k0s()()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngStyle",l.eq3(7,Ie,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(3,5,"lang_auto_dap_an_dung"),": ",b.key,""),l.R7$(2),l.Y8G("ngStyle",l.eq3(9,J,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",b.labelArr)}}function ve(A,Ve){if(1&A&&(l.qex(0),l.j41(1,"span",25),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"mytranslate"),l.k0s(),l.bVm()),2&A){const b=Ve.$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngStyle",l.eq3(9,Ie,l.brH(2,3,b,Ae.keys,Ae.userAnswersObj["id_"+Ae.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b," - ",l.bMT(4,7,Ae.keys.includes((b.alpha?b.alpha:b.key?b.key:"")+"T")?"lang_auto_dung":"lang_auto_sai"),"\xa0 ")}}function nt(A,Ve){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,U))}function at(A,Ve){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,de))}function se(A,Ve){if(1&A&&(l.j41(0,"div",26),l.DNE(1,nt,1,2,"lucide-icon",16),l.nI1(2,"isTrueAnswerType5"),l.DNE(3,at,1,2,"lucide-icon",14),l.nI1(4,"isTrueAnswerType5"),l.j41(5,"span",15),l.EFF(6),l.nI1(7,"getAnswerChoiceTrueFalseQuestion"),l.nI1(8,"mytranslate"),l.k0s()()),2&A){const b=Ve.$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",!l.brH(2,4,b,Ae.keys,Ae.userAnswersObj["id_"+(null==Ae.questionObj?null:Ae.questionObj.id)])),l.R7$(2),l.Y8G("ngIf",l.brH(4,8,b,Ae.keys,Ae.userAnswersObj["id_"+(null==Ae.questionObj?null:Ae.questionObj.id)])),l.R7$(3),l.Lme("",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b," - ",l.bMT(8,15,l.i5U(7,12,b,Ae.userAnswersObj["id_"+Ae.questionObj.id])),"")}}function ee(A,Ve){if(1&A&&(l.j41(0,"div",19)(1,"span",20),l.EFF(2),l.nI1(3,"mytranslate"),l.DNE(4,ve,5,11,"ng-container",21),l.k0s(),l.j41(5,"div",22)(6,"div",23),l.DNE(7,se,9,17,"div",24),l.k0s()()()),2&A){const b=l.XpG();l.R7$(2),l.SpI(" ",l.bMT(3,4,"lang_auto_dap_an_dung"),": "),l.R7$(2),l.Y8G("ngForOf",b.labelArr),l.R7$(),l.Y8G("ngStyle",l.eq3(6,J,b.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.Y8G("ngForOf",b.labelArr)}}function Be(A,Ve){if(1&A&&(l.j41(0,"span",9),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const b=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,Ie,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",b.keys.join("],["),"]")}}function ge(A,Ve){if(1&A&&(l.j41(0,"div",8),l.DNE(1,Be,3,7,"span",27),l.j41(2,"div",28)(3,"div",29),l.EFF(4),l.nI1(5,"trimEndFillAnswer"),l.nI1(6,"mytranslate"),l.k0s()()()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",b.keys),l.R7$(),l.Y8G("ngStyle",l.eq3(8,J,b.isFillAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==b.userAnswersObj["id_"+b.questionObj.id]?l.i5U(5,3,b.userAnswersObj["id_"+b.questionObj.id],b.isOfflineMark):l.bMT(6,6,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function X(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"div")(1,"span",32),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG(2);return l.Njj(Pe.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.JRh(l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function pe(A,Ve){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function lt(A,Ve){if(1&A&&(l.qex(0),l.nrm(1,"div",33),l.bVm()),2&A){const b=l.XpG(3);l.R7$(),l.Y8G("innerText",b.userAnswersObj["id_"+b.questionObj.id])}}function Ee(A,Ve){if(1&A&&(l.qex(0),l.DNE(1,pe,3,3,"div",31)(2,lt,2,1,"ng-container",31),l.bVm()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",!b.userAnswersObj["id_"+b.questionObj.id]),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+b.questionObj.id])}}function H(A,Ve){if(1&A&&(l.j41(0,"div",30),l.DNE(1,X,4,3,"div",31)(2,Ee,3,2,"ng-container",31),l.k0s()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==b.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=b.currentTab)}}let xe=(()=>{var A;class Ve extends oe{ngOnInit(){super.ngOnInit()}}return(A=Ve).\u0275fac=(()=>{let b;return function(Pe){return(b||(b=l.xGo(A)))(Pe||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-teacher"]],features:[l.Vt3],decls:11,vars:13,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none"],[1,"flex"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k","class","explainTxt text-pending cursor-pointer mt-2",3,"ngStyle","click",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box-type1 mt-2","style","flex-wrap: wrap",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k",1,"explainTxt","text-pending","cursor-pointer","mt-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"answer-box-type1","mt-2"],[1,"keyText","my-1",3,"ngStyle"],["id","type_1",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"answer-box-type1","mt-2",2,"flex-wrap","wrap"],[1,"keyText","my-1"],[4,"ngFor","ngForOf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],[1,"label-item",2,"display","block !important","width","auto !important"],["class","flex w-full mt-1","style","align-items: center",4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"flex","w-full","mt-1",2,"align-items","center"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Ae,Pe){1&Ae&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,_e,4,9,"span",2),l.k0s(),l.DNE(3,Qe,6,11,"div",3),l.nI1(4,"isOneChoiceAnswer"),l.DNE(5,ee,8,8,"div",4),l.nI1(6,"isTrueFalseAnswer"),l.DNE(7,ge,7,10,"div",3),l.nI1(8,"isFillAnswer"),l.DNE(9,H,3,2,"div",5),l.nI1(10,"isEssayAnswer"),l.k0s()),2&Ae&&(l.R7$(2),l.Y8G("ngIf",Pe.questionObj.help),l.R7$(),l.Y8G("ngIf",l.bMT(4,5,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(6,7,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(8,9,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(10,11,Pe.questionObj)))},dependencies:[z.YU,z.Sq,z.bT,z.B3,O.WGl,k.wp,k.V6,k.Zm,k.N3,k.FC,k.jr,k.C0,k.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Ve})();var mt=v(65162);const rt=A=>({"p-2":A}),Et=A=>({"justify-content":A}),Xe=A=>({"mt-3":A}),pt=(A,Ve,b)=>({width:A,"margin-right":Ve,"margin-left":b}),Ze=()=>({"ml-1":!0}),Ge=A=>[A],K=A=>({backto:A}),ce=()=>({"text-transform":"uppercase"}),me=(A,Ve)=>({"flex justify-between w-full items-center":A,"answer-box-type1":Ve}),G=A=>({"border-color":A}),F=A=>({color:A}),S=()=>({"text-danger mr-1":!0}),j=()=>({"mr-1":!0}),Me=()=>({"text-success mr-1":!0}),Ne=A=>({"w-full":A}),Oe=()=>({color:"#00ac33",width:"53px"}),We=A=>({color:A,width:"53px"}),Le=()=>({color:"red"});function xt(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("ngStyle",l.sMw(7,pt,b.isShowExplainButton?"125px":"0px",b.isShowExplainButton?"-40px":"0px",b.isMobileDevice?"":"8px")),l.BMQ("style",b.isShowExplainButton&&!b.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",b.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(11,Ze))}}function Re(A,Ve){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const b=l.XpG();l.Y8G("routerLink",l.eq3(8,Ge,l.bMT(1,4,"/on-luyen/"+b.questionObj.practiceHashId)))("queryParams",l.eq3(10,K,b.backToLink))("ngStyle",l.lJ4(12,ce)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function fe(A,Ve){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const b=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,F,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung"),": ",b.key,"")}}function Ue(A,Ve){1&A&&l.nrm(0,"span",17)}function E(A,Ve){1&A&&l.nrm(0,"lucide-icon",23),2&A&&l.Y8G("ngClass",l.lJ4(1,S))}function L(A,Ve){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,j))}function W(A,Ve){if(1&A&&l.DNE(0,E,1,2,"lucide-icon",22)(1,L,1,2,"lucide-icon",20),2&A){const b=l.XpG().$implicit,Ae=l.XpG(2);l.Y8G("ngIf",Ae.haveChoose(b)&&2!=Ae.examObj.whenShowAnswer&&!Ae.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",Ae.haveChoose(b)&&2!=Ae.examObj.whenShowAnswer&&Ae.notShowAnswerYet)}}function $(A,Ve){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,j))}function we(A,Ve){if(1&A&&l.DNE(0,$,1,2,"lucide-icon",20),2&A){const b=l.XpG().$implicit,Ae=l.XpG(2);l.Y8G("ngIf",Ae.haveChoose(b)&&2==Ae.examObj.whenShowAnswer)}}function ue(A,Ve){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,Me))}function Z(A,Ve){if(1&A&&(l.j41(0,"div",18),l.DNE(1,W,2,2,"ng-template",19)(2,we,1,1,"ng-template",19)(3,ue,1,2,"lucide-icon",20),l.j41(4,"span",21),l.EFF(5),l.k0s()()),2&A){const b=Ve.$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(Ae.isKey(b)&&Ae.haveChoose(b))),l.R7$(),l.Y8G("ngIf",!(Ae.isKey(b)&&Ae.haveChoose(b))),l.R7$(),l.Y8G("ngIf",Ae.isKey(b)&&Ae.haveChoose(b)&&2!=Ae.examObj.whenShowAnswer),l.R7$(2),l.JRh(b.alpha?b.alpha:b.key?b.key:b)}}function Fe(A,Ve){if(1&A&&(l.j41(0,"div",11),l.DNE(1,fe,3,7,"span",12)(2,Ue,1,0,"span",13),l.j41(3,"div",14),l.DNE(4,Z,6,4,"div",15),l.k0s()()),2&A){const b=l.XpG();l.Y8G("ngClass",l.l_i(5,me,b.isMobileDevice,!b.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",b.keys&&2==b.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(8,G,b.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",b.labelArr)}}function Ce(A,Ve){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.bVm()),2&A){const b=Ve.$implicit,Ae=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.lJ4(5,Oe)),l.R7$(),l.Lme(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b,") ",l.bMT(3,3,Ae.keys.includes((b.alpha?b.alpha:b.key?b.key:"")+"T")?"lang_auto_dung":"lang_auto_sai")," ")}}function be(A,Ve){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,Ce,4,6,"ng-container",31),l.k0s()()),2&A){const b=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_auto_dap_an_dung"),":"),l.R7$(3),l.Y8G("ngForOf",b.labelArr)}}function $e(A,Ve){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"getAnswerChoiceTrueFalseQuestion"),l.nI1(5,"mytranslate"),l.k0s(),l.bVm()),2&A){const b=Ve.$implicit,Ae=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.eq3(12,We,l.brH(2,3,b,Ae.keys,Ae.userAnswersObj["id_"+Ae.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b,") ",l.bMT(5,10,l.i5U(4,7,b,Ae.userAnswersObj["id_"+Ae.questionObj.id]))," ")}}function Ye(A,Ve){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,$e,6,14,"ng-container",31),l.k0s()()),2&A){const b=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_dap_an_thi_sinh_chon"),":"),l.R7$(3),l.Y8G("ngForOf",b.labelArr)}}function Ke(A,Ve){if(1&A&&(l.j41(0,"span",32),l.EFF(1),l.k0s()),2&A){const b=l.XpG().$implicit;l.Y8G("ngStyle",l.lJ4(2,Le)),l.R7$(),l.SpI(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b,") \xa0 ")}}function Je(A,Ve){if(1&A&&(l.qex(0),l.DNE(1,Ke,2,3,"span",34),l.nI1(2,"isTrueAnswerType5"),l.bVm()),2&A){const b=Ve.$implicit,Ae=l.XpG(3);l.R7$(),l.Y8G("ngIf",!l.brH(2,1,b,Ae.keys,Ae.userAnswersObj["id_"+Ae.questionObj.id]))}}function R(A,Ve){if(1&A&&(l.j41(0,"div",33)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.DNE(4,Je,3,5,"ng-container",31),l.k0s()),2&A){const b=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_cau_lam_sai"),":"),l.R7$(2),l.Y8G("ngForOf",b.labelArr)}}function it(A,Ve){if(1&A&&(l.j41(0,"div",25),l.DNE(1,be,6,4,"div",26)(2,Ye,6,4,"div",26)(3,R,5,4,"div",27),l.k0s()),2&A){const b=l.XpG();l.Y8G("ngClass",l.eq3(4,Ne,b.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function tt(A,Ve){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const b=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,F,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",b.keys.join("],["),"]")}}function ct(A,Ve){1&A&&l.nrm(0,"span",17)}function ot(A,Ve){if(1&A&&(l.j41(0,"div",35),l.DNE(1,tt,3,7,"span",12)(2,ct,1,0,"span",13),l.j41(3,"div",36)(4,"div",37),l.EFF(5),l.nI1(6,"trimEndFillAnswer"),l.nI1(7,"mytranslate"),l.k0s()()()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",b.keys&&2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",b.keys&&2==b.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(9,G,b.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==b.userAnswersObj["id_"+b.questionObj.id]?l.i5U(6,4,b.userAnswersObj["id_"+b.questionObj.id],b.isOfflineMark):l.bMT(7,7,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function dt(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"div")(1,"span",40),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG(2);return l.Njj(Pe.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function St(A,Ve){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Ot(A,Ve){if(1&A&&(l.qex(0),l.nrm(1,"div",41),l.bVm()),2&A){const b=l.XpG(3);l.R7$(),l.Y8G("innerText",b.userAnswersObj["id_"+b.questionObj.id])}}function qt(A,Ve){if(1&A&&(l.qex(0),l.DNE(1,St,3,3,"div",39)(2,Ot,2,1,"ng-container",39),l.bVm()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===b.userAnswersObj["id_"+b.questionObj.id]),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+b.questionObj.id])}}function Ht(A,Ve){if(1&A&&(l.j41(0,"div",38),l.DNE(1,dt,4,3,"div",39)(2,qt,3,2,"ng-container",39),l.k0s()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==b.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=b.currentTab)}}let Wt=(()=>{var A;class Ve extends oe{}return(A=Ve).\u0275fac=(()=>{let b;return function(Pe){return(b||(b=l.xGo(A)))(Pe||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-full-answer-for-student"]],features:[l.Vt3],decls:12,vars:23,consts:[[1,"question-standalone-answer-box-for-student","box","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngClass","ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center",3,"ngClass"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","mt-2 font-bold",3,"ngClass",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"mt-2","font-bold",3,"ngClass"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"keyText","my-1",3,"ngStyle"],[1,"keyText","my-1","ml-2"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[3,"ngClass"],["class","keyText my-1 font-medium flex",4,"ngIf"],["class","keyText my-1 font-medium text-red flex",4,"ngIf"],[1,"keyText","my-1","font-medium","flex"],[2,"width","100px"],[1,"flex","justify-between"],[4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"keyText","my-1","font-medium","text-red","flex"],["class","lalala ml-1",3,"ngStyle",4,"ngIf"],[1,"answer-box-type1","mt-2"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Ae,Pe){1&Ae&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,xt,4,12,"span",2)(3,Re,4,13,"a",3),l.k0s(),l.DNE(4,Fe,5,10,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,it,4,6,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,ot,8,11,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,Ht,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&Ae&&(l.Y8G("ngClass",l.eq3(17,rt,!Pe.isMobileDevice))("ngStyle",l.eq3(19,Et,2==Pe.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(),l.Y8G("ngClass",l.eq3(21,Xe,Pe.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=Pe.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Pe.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,9,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,11,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,13,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,15,Pe.questionObj)))},dependencies:[z.YU,z.Sq,z.bT,z.B3,mt.Wk,O.WGl,k.F2,k.wp,k.V6,k.Zm,k.N3,k.FC,k.jr,k.C0,k.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Ve})();const An=A=>({"justify-content":A}),Cn=(A,Ve)=>({width:A,"margin-right":Ve,"margin-left":"8px"}),ut=()=>({"ml-1":!0}),dn=A=>[A],pn=A=>({backto:A}),zn=()=>({"text-transform":"uppercase"});function Vt(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("ngStyle",l.l_i(7,Cn,b.isShowExplainButton?"125px":"0px",b.isShowExplainButton?"-40px":"0px")),l.BMQ("style",b.isShowExplainButton&&!b.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",b.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(10,ut))}}function yn(A,Ve){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const b=l.XpG();l.Y8G("routerLink",l.eq3(8,dn,l.bMT(1,4,"/on-luyen/"+b.questionObj.practiceHashId)))("queryParams",l.eq3(10,pn,b.backToLink))("ngStyle",l.lJ4(12,zn)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function jn(A,Ve){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function Kt(A,Ve){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function vn(A,Ve){if(1&A&&(l.j41(0,"span",13),l.DNE(1,jn,3,3,"span",14)(2,Kt,3,3,"span",15),l.k0s()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+(null==b.questionObj?null:b.questionObj.id)]===b.key),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+(null==b.questionObj?null:b.questionObj.id)]!==b.key)}}function mn(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"div",11),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.showExplain())}),l.DNE(1,vn,3,2,"span",12),l.k0s()}if(2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function wn(A,Ve){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.nI1(3,"mytranslate"),l.k0s()),2&A){const b=l.XpG(3);l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")+" "+b.countCorrectAnswerTrueFalse()+" "+l.bMT(3,3,"lang_azt_answer")," ")}}function fn(A,Ve){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_do_not_choose_any_correct_answer")," "))}function nr(A,Ve){if(1&A&&(l.j41(0,"span",13),l.DNE(1,wn,4,5,"span",14)(2,fn,3,3,"span",15),l.k0s()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",b.countCorrectAnswerTrueFalse()),l.R7$(),l.Y8G("ngIf",!b.countCorrectAnswerTrueFalse())}}function So(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"div",18),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.showExplain())}),l.DNE(1,nr,3,2,"span",12),l.k0s()}if(2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function Ro(A,Ve){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function Oo(A,Ve){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function Po(A,Ve){if(1&A&&(l.j41(0,"span",13),l.DNE(1,Ro,3,3,"span",14)(2,Oo,3,3,"span",15),l.k0s()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",b.isFillAnswer),l.R7$(),l.Y8G("ngIf",!b.isFillAnswer)}}function ko(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"div",19),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.showExplain())}),l.DNE(1,Po,3,2,"span",12),l.k0s()}if(2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function Mo(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"div")(1,"span",22),l.bIt("click",function(){l.eBV(b);const Pe=l.XpG(2);return l.Njj(Pe.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Do(A,Ve){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Fo(A,Ve){if(1&A&&(l.qex(0),l.nrm(1,"div",23),l.bVm()),2&A){const b=l.XpG(3);l.R7$(),l.Y8G("innerText",b.userAnswersObj["id_"+b.questionObj.id])}}function Vo(A,Ve){if(1&A&&(l.qex(0),l.DNE(1,Do,3,3,"div",21)(2,Fo,2,1,"ng-container",21),l.bVm()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===b.userAnswersObj["id_"+b.questionObj.id]),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+b.questionObj.id])}}function No(A,Ve){if(1&A&&(l.j41(0,"div",20),l.DNE(1,Mo,4,3,"div",21)(2,Vo,3,2,"ng-container",21),l.k0s()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==b.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=b.currentTab)}}let zo=(()=>{var A;class Ve extends oe{countCorrectAnswerTrueFalse(){return this.labelArr.filter(Ae=>this.sAztAnswerTrueFalseService.checkIsTrueType5(Ae,this.keys,this.userAnswersObj["id_"+this.questionObj?.id])).length}}return(A=Ve).\u0275fac=(()=>{let b;return function(Pe){return(b||(b=l.xGo(A)))(Pe||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-only-true-or-false-answer-for-student"]],features:[l.Vt3],decls:12,vars:17,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","answer-box-type1 cursor-pointer mt-2",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer","style","flex-wrap: wrap",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer",3,"click",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"answer-box-type1","cursor-pointer","mt-2",3,"click"],["class","font-medium text-base my-1 px-1",4,"ngIf"],[1,"font-medium","text-base","my-1","px-1"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-success"],[1,"text-danger"],[1,"answer-box-type1","mt-2","cursor-pointer",2,"flex-wrap","wrap",3,"click"],[1,"answer-box-type1","mt-2","cursor-pointer",3,"click"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Ae,Pe){1&Ae&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,Vt,4,11,"span",2)(3,yn,4,13,"a",3),l.k0s(),l.DNE(4,mn,2,1,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,So,2,1,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,ko,2,1,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,No,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&Ae&&(l.Y8G("ngStyle",l.eq3(15,An,2==Pe.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(2),l.Y8G("ngIf",2!=Pe.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Pe.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,7,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,9,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,11,Pe.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,13,Pe.questionObj)))},dependencies:[z.YU,z.bT,z.B3,mt.Wk,O.WGl,k.F2,k.wp,k.V6,k.Zm,k.N3,k.FC],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Ve})();function jo(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-full-answer-for-student",2),l.mxI("isShowExplainChange",function(Pe){l.eBV(b);const Zt=l.XpG();return l.DH7(Zt.isShowExplain,Pe)||(Zt.isShowExplain=Pe),l.Njj(Pe)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.isShowExplainChange.emit(Pe.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet)("isTeacherRole",b.isTeacherRole)("isShowOriginAnswer",b.isShowOriginAnswer),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}function Bo(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-only-true-or-false-answer-for-student",3),l.mxI("isShowExplainChange",function(Pe){l.eBV(b);const Zt=l.XpG();return l.DH7(Zt.isShowExplain,Pe)||(Zt.isShowExplain=Pe),l.Njj(Pe)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.isShowExplainChange.emit(Pe.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("isTeacherRole",b.isTeacherRole)("isShowOriginAnswer",b.isShowOriginAnswer)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}let ci=(()=>{var A;class Ve extends oe{constructor(){super(...arguments),this.checkShowFullAnswer=!1}ngOnInit(){this.checkShowFullAnswer=!(this.examConfig&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction&&!this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought)}}return(A=Ve).\u0275fac=(()=>{let b;return function(Pe){return(b||(b=l.xGo(A)))(Pe||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-student"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Ae,Pe){1&Ae&&l.DNE(0,jo,1,11,"azt-answer-box-with-user-full-answer-for-student",0)(1,Bo,1,11,"azt-answer-box-with-user-only-true-or-false-answer-for-student",1),2&Ae&&(l.Y8G("ngIf",Pe.checkShowFullAnswer),l.R7$(),l.Y8G("ngIf",!Pe.checkShowFullAnswer))},dependencies:[z.bT,Wt,zo],encapsulation:2}),Ve})();function Lo(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-student",2),l.mxI("isShowExplainChange",function(Pe){l.eBV(b);const Zt=l.XpG();return l.DH7(Zt.isShowExplain,Pe)||(Zt.isShowExplain=Pe),l.Njj(Pe)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.isShowExplainChange.emit(Pe.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet)("isTeacherRole",b.isTeacherRole)("isShowOriginAnswer",b.isShowOriginAnswer),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}function ui(A,Ve){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-teacher",3),l.mxI("isShowExplainChange",function(Pe){l.eBV(b);const Zt=l.XpG();return l.DH7(Zt.isShowExplain,Pe)||(Zt.isShowExplain=Pe),l.Njj(Pe)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Pe=l.XpG();return l.Njj(Pe.isShowExplainChange.emit(Pe.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet)("isShowOriginAnswer",b.isShowOriginAnswer)("isTeacherRole",b.isTeacherRole),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}let hi=(()=>{var A;class Ve extends oe{ngOnInit(){}}return(A=Ve).\u0275fac=(()=>{let b;return function(Pe){return(b||(b=l.xGo(A)))(Pe||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-view-base"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Ae,Pe){1&Ae&&l.DNE(0,Lo,1,11,"azt-answer-box-with-user-answer-for-student",0)(1,ui,1,11,"azt-answer-box-with-user-answer-for-teacher",1),2&Ae&&(l.Y8G("ngIf",!Pe.isTeacherRole),l.R7$(),l.Y8G("ngIf",Pe.isTeacherRole))},dependencies:[z.bT,xe,ci],encapsulation:2}),Ve})()},84278:(yt,ke,v)=>{v.d(ke,{x:()=>_e});var l=v(64486),d=v(66793),c=v(30657),m=v(48891),x=v(54460),C=v(42789),re=v(60780),y=v(58447),oe=v(15423),z=v(52325),O=v(54313),k=v(34660),q=v(97760),D=v(44101);const Ie=le=>({"skeleton-box-loading":le}),J=(le,ie,ze)=>({"pb-2":le,"p-0":ie,"p-3":ze}),V=()=>[];function w(le,ie){if(1&le&&m.nrm(0,"div",3),2&le){const ze=m.XpG();m.Y8G("ngClass",m.eq3(1,Ie,ze.renderConfigObj.isFirstRender))}}function U(le,ie){if(1&le&&m.nrm(0,"azt-test-audio-ui",15),2&le){const ze=m.XpG(2);m.Y8G("questionObj",ze.questionObj)("isShowList",!0)}}function de(le,ie){if(1&le){const ze=m.RV6();m.j41(0,"div",4)(1,"div",5),m.nrm(2,"azt-question-group-content-box",6),m.j41(3,"div",7),m.DNE(4,U,1,2,"azt-test-audio-ui",8),m.j41(5,"div",9),m.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),m.k0s(),m.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),m.k0s()(),m.j41(10,"azt-answer-box-view-base",13),m.mxI("isShowExplainChange",function(Qe){m.eBV(ze);const ve=m.XpG();return m.DH7(ve.isShowExplain,Qe)||(ve.isShowExplain=Qe),m.Njj(Qe)}),m.bIt("isShowExplainChange",function(Qe){m.eBV(ze);const ve=m.XpG();return m.Njj(ve.isShowExplain=Qe)}),m.k0s(),m.nrm(11,"azt-question-explain-box",14),m.k0s()}if(2&le){let ze;const Te=m.XpG();m.R7$(),m.xc7("font-size","1em")("line-height","1.7"),m.Y8G("id","question_render_container_"+Te.questionObj.id)("ngClass",m.sMw(42,J,Te.questionObj.attachments.length>0,Te.isMobileDevice,!Te.isMobileDevice)),m.R7$(),m.Y8G("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj),m.R7$(2),m.Y8G("ngIf",Te.questionObj.attachments.length>0),m.R7$(2),m.Y8G("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj)("curQuestionIndex",Te.curQuestionIndex),m.R7$(),m.Y8G("showForTeacher",!1)("curExamResultId",null!==(ze=Te.curExamResultId)&&void 0!==ze?ze:0)("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj)("curQuestionIndex",Te.curQuestionIndex)("orgExamObjs",m.lJ4(46,V)),m.R7$(),m.Y8G("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj),m.R7$(),m.Y8G("examObj",Te.examObj)("isShowOriginAnswer",Te.isShowOriginAnswer)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj),m.R7$(),m.Y8G("examObj",Te.examObj)("examConfig",Te.examConfig)("isTeacherRole",!1)("isShowOriginAnswer",Te.isShowOriginAnswer)("questionObj",Te.questionObj)("userAnswersObj",Te.userAnswersObj)("notShowAnswerYet",Te.notShowAnswerYet),m.R50("isShowExplain",Te.isShowExplain),m.Y8G("backToLink",Te.backToLink)("isOfflineMark",Te.isOfflineMark)("currentTab",Te.currentTab),m.R7$(),m.Y8G("isShowExplain",Te.isShowExplain)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj)}}let _e=(()=>{var le;class ie extends l.I{ngOnInit(){super.ngOnInit();let Te=new d.C(!1,!1,!1);super.initData(Te,this.follower,this.questionObj),this.backToLink=`/test/answer-test/${this.examObj?.tenantId??0}/${this.examObj?.categoryId??0}/${this.examObj?.hashId}/${this.curExamResultId}`}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.isShowExplain=!1,this.isShowOriginAnswer=!1,this.isOfflineMark=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.checkShowFullAnswer=!1}}return(le=ie).\u0275fac=function(Te){return new(Te||le)},le.\u0275cmp=m.VBU({type:le,selectors:[["azt-question-standalone-for-student-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId",examConfig:"examConfig",isShowExplain:"isShowExplain",isShowOriginAnswer:"isShowOriginAnswer",isOfflineMark:"isOfflineMark",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[m.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","curExamResultId","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","isShowOriginAnswer","questionObj","renderConfigObj"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Te,Qe){if(1&Te&&(m.j41(0,"div",1),m.DNE(1,w,1,3,"div",2)(2,de,12,47,"ng-template",null,0,m.C5r),m.k0s()),2&Te){const ve=m.sdS(3);m.Y8G("id","question_render_element_"+Qe.questionObj.id),m.R7$(),m.Y8G("ngIf",!Qe.renderConfigObj.isRenderElement)("ngIfElse",ve)}},dependencies:[x.YU,x.bT,C.N,re.c,y.y,oe.N,z.Q,O.$,k.S,q.U,D.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ie})()},34815:(yt,ke,v)=>{v.d(ke,{o:()=>de});var l=v(64486),d=v(66793),c=v(30657),m=v(48891),x=v(54460),C=v(42789),re=v(60780),y=v(58447),oe=v(15423),z=v(52325),O=v(54313),k=v(34660),q=v(97760),D=v(44101);const Ie=_e=>({"skeleton-box-loading":_e}),J=(_e,le)=>({"pb-2":_e,"mob-web-width":le});function V(_e,le){if(1&_e&&m.nrm(0,"div",3),2&_e){const ie=m.XpG();m.Y8G("ngClass",m.eq3(1,Ie,ie.renderConfigObj.isFirstRender))}}function w(_e,le){if(1&_e&&m.nrm(0,"azt-test-audio-ui",15),2&_e){const ie=m.XpG(2);m.Y8G("questionObj",ie.questionObj)("isShowList",!0)}}function U(_e,le){if(1&_e){const ie=m.RV6();m.j41(0,"div",4)(1,"div",5),m.nrm(2,"azt-question-group-content-box",6),m.j41(3,"div",7),m.DNE(4,w,1,2,"azt-test-audio-ui",8),m.j41(5,"div",9),m.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),m.k0s(),m.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),m.k0s()(),m.j41(10,"azt-answer-box-view-base",13),m.mxI("isShowExplainChange",function(Te){m.eBV(ie);const Qe=m.XpG();return m.DH7(Qe.isShowExplain,Te)||(Qe.isShowExplain=Te),m.Njj(Te)}),m.bIt("isShowExplainChange",function(Te){m.eBV(ie);const Qe=m.XpG();return m.Njj(Qe.isShowExplain=Te)}),m.k0s(),m.nrm(11,"azt-question-explain-box",14),m.k0s()}if(2&_e){const ie=m.XpG();m.R7$(),m.xc7("font-size","1em")("line-height","1.7"),m.Y8G("id","question_render_container_"+ie.questionObj.id)("ngClass",m.l_i(39,J,ie.questionObj.attachments.length>0,ie.isMobileWebView)),m.R7$(),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj),m.R7$(2),m.Y8G("ngIf",ie.questionObj.attachments.length>0),m.R7$(2),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj)("curQuestionIndex",ie.curQuestionIndex),m.R7$(),m.Y8G("showForTeacher",!0)("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj)("curQuestionIndex",ie.curQuestionIndex)("orgExamObjs",ie.orgExamObjs),m.R7$(),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj),m.R7$(),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("isShowOriginAnswer",ie.isShowOriginAnswer)("renderConfigObj",ie.renderConfigObj),m.R7$(),m.Y8G("examObj",ie.examObj)("isTeacherRole",!0)("isShowOriginAnswer",ie.isShowOriginAnswer)("questionObj",ie.questionObj)("userAnswersObj",ie.userAnswersObj)("notShowAnswerYet",ie.notShowAnswerYet)("isOfflineMark",ie.isOfflineMark),m.R50("isShowExplain",ie.isShowExplain),m.Y8G("currentTab",ie.currentTab),m.R7$(),m.Y8G("isShowExplain",ie.isShowExplain)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj)}}let de=(()=>{var _e;class le extends l.I{ngOnInit(){super.ngOnInit();let ze=new d.C(!1,!1,!1);super.initData(ze,this.follower,this.questionObj)}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.orgExamObjs=[],this.isShowExplain=!1,this.isOfflineMark=!1,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab"}}return(_e=le).\u0275fac=function(ze){return new(ze||_e)},_e.\u0275cmp=m.VBU({type:_e,selectors:[["azt-question-standalone-for-teacher-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",orgExamObjs:"orgExamObjs",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isShowOriginAnswer:"isShowOriginAnswer",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[m.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"question-standalone-container","box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","questionObj","isShowOriginAnswer","renderConfigObj"],[3,"isShowExplainChange","examObj","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isOfflineMark","isShowExplain","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(ze,Te){if(1&ze&&(m.j41(0,"div",1),m.DNE(1,V,1,3,"div",2)(2,U,12,42,"ng-template",null,0,m.C5r),m.k0s()),2&ze){const Qe=m.sdS(3);m.Y8G("id","question_render_element_"+Te.questionObj.id),m.R7$(),m.Y8G("ngIf",!Te.renderConfigObj.isRenderElement)("ngIfElse",Qe)}},dependencies:[x.YU,x.bT,C.N,re.c,y.y,oe.N,z.Q,O.$,k.S,q.U,D.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),le})()},97760:(yt,ke,v)=>{v.d(ke,{U:()=>Qe});var l=v(59640),d=v(95887),c=v(89163),m=v(33887),x=v(25539),C=v(48891),re=v(9280),y=v(54460),oe=v(52654),z=v(2915),O=v(52811),k=v(76975);function q(ve,nt){1&ve&&(C.j41(0,"div",10)(1,"span",11),C.nrm(2,"azt-loading-ui"),C.k0s(),C.j41(3,"span",12),C.EFF(4),C.nI1(5,"mytranslate"),C.k0s()()),2&ve&&(C.R7$(4),C.JRh(C.bMT(5,1,"lang_auto_dang_chuan_bi_tai_lieu_doing")))}function D(ve,nt){1&ve&&(C.j41(0,"div",13),C.EFF(1),C.nI1(2,"mytranslate"),C.k0s()),2&ve&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"lang_azt_cau_hoi_chua_co_lan_sua_nao")," "))}function Ie(ve,nt){if(1&ve&&C.nrm(0,"azt-question-standalone-for-preview",17),2&ve){const at=C.XpG().$implicit,se=C.XpG();C.Y8G("examObj",se.data.examObj)("questionObj",at.questionLog)("follower",se.data.follower)("curQuestionIndex",se.data.curQuestionIndex)}}function J(ve,nt){if(1&ve&&(C.qex(0),C.j41(1,"div",14),C.EFF(2),C.nI1(3,"mytranslate"),C.nI1(4,"formatFullDateTimeWithoutSecondByUserUnitPipe"),C.k0s(),C.j41(5,"div",15),C.DNE(6,Ie,1,4,"azt-question-standalone-for-preview",16),C.k0s(),C.bVm()),2&ve){const at=nt.$implicit;C.R7$(2),C.SpI(" ",C.bMT(3,2,"lang_azota_ui_the_time_of_question_editing")+": "+C.bMT(4,4,at.createdAt)," "),C.R7$(4),C.Y8G("ngIf",at.questionLog)}}let V=(()=>{var ve;class nt extends m._{closeDialog(){this.dialogRef.close()}getLogQuestion(se){this.initStatusObj(),this.waitDestroy(this.questionService.apiQuestionsIdLogsGet(se,this.data.isTeacher?void 0:this.data.curExamResultId).subscribe(ee=>{ee.success?((ee.data?.objs??[]).forEach(ge=>{let X={createdAt:ge.createdAt,questionLog:this.commonService.castJsonToClassObj(x.I,JSON.stringify(ge.questionLog))};X.questionLog&&(X.questionLog.isLogEditQuestion=!0),this.questionLogCustomList.push(X)}),this.successStatusObj()):this.errorStatusObj(ee.message??"",!0)}))}ngOnInit(){this.getLogQuestion(this.data.questionObj.id)}constructor(se,ee,Be){super(Be,ee),this.questionService=se,this.dialogRef=ee,this.data=Be,this.questionLogCustomList=[]}}return(ve=nt).\u0275fac=function(se){return new(se||ve)(C.rXU(re.wP),C.rXU(c.CP,8),C.rXU(c.Vh,8))},ve.\u0275cmp=C.VBU({type:ve,selectors:[["show-question-edit-history-dialog"]],features:[C.Vt3],decls:15,vars:13,consts:[[1,"box"],[1,"font-medium","p-3","bg-slate-100","dark:bg-darkmode-400"],[3,"defaultHeight"],["class","flex justify-center items-center h-40",4,"ngIf"],["id","boxContentQuestion",1,"p-2"],["class","flex p-5 justify-center items-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","pt-3"],[1,"ml-auto"],[1,"btn","btn-secondary",3,"click"],[1,"flex","justify-center","items-center","h-40"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"flex","p-5","justify-center","items-center"],[1,"p-2","pb-0","text-xs","font-medium",2,"margin-bottom","-10px"],[1,"p-2"],[3,"examObj","questionObj","follower","curQuestionIndex",4,"ngIf"],[3,"examObj","questionObj","follower","curQuestionIndex"]],template:function(se,ee){1&se&&(C.j41(0,"div",0)(1,"div",1),C.EFF(2),C.nI1(3,"mytranslate"),C.nI1(4,"mytranslate"),C.k0s(),C.j41(5,"azt-mat-dialog-content",2),C.DNE(6,q,6,3,"div",3),C.j41(7,"div",4),C.DNE(8,D,3,3,"div",5)(9,J,7,6,"ng-container",6),C.k0s()(),C.j41(10,"div",7)(11,"div",8)(12,"button",9),C.bIt("click",function(){return ee.closeDialog()}),C.EFF(13),C.nI1(14,"mytranslate"),C.k0s()()()()),2&se&&(C.R7$(2),C.Lme(" ",C.bMT(3,7,"lang_azota_ui_the_history_of_question_editing")," (",ee.questionLogCustomList.length+" "+C.bMT(4,9,"lang_testbank_powerpoint_times"),") "),C.R7$(3),C.Y8G("defaultHeight",60),C.R7$(),C.Y8G("ngIf",ee.statusObj.loading),C.R7$(2),C.Y8G("ngIf",!ee.questionLogCustomList.length&&!ee.statusObj.loading),C.R7$(),C.Y8G("ngForOf",ee.questionLogCustomList),C.R7$(4),C.SpI(" ",C.bMT(14,11,"lang_auto_dong")," "))},dependencies:[y.Sq,y.bT,oe.a,z.U,O.R,k.wp,k.bH],encapsulation:2}),nt})();var w=v(30657),U=v(46899),de=v(65162),_e=v(9691),le=v(47712),ie=v(15343);function ze(ve,nt){if(1&ve){const at=C.RV6();C.j41(0,"div",3)(1,"button",4),C.nI1(2,"mytranslate"),C.bIt("click",function(){C.eBV(at);const ee=C.XpG();return C.Njj(ee.goToEditQuestion())}),C.nrm(3,"lucide-icon",5),C.k0s()()}2&ve&&(C.R7$(),C.FS9("matTooltip",C.bMT(2,1,"lang_core_chinh_sua_de_thi")))}function Te(ve,nt){if(1&ve){const at=C.RV6();C.j41(0,"div")(1,"button",4),C.nI1(2,"mytranslate"),C.bIt("click",function(){C.eBV(at);const ee=C.XpG();return C.Njj(ee.showEditHistoryDialog())}),C.nrm(3,"lucide-icon",6),C.k0s()()}2&ve&&(C.R7$(),C.FS9("matTooltip",C.bMT(2,1,"lang_azota_ui_the_history_of_question_editing")))}let Qe=(()=>{var ve;class nt extends l.H{checkEditQuestion(){const se=this.questionObj?.createdAt,ee=this.questionObj?.updatedAt;let Be=this.timeService.calculationTimeOnlyMinutes(se,ee);this.isEditQuestion=Number(Be)>0}isOrgQuestion(){return null!=this.orgExamObjs.find(se=>se.questionId==this.questionObj.id)}goToEditQuestion(){var se=this.commonService.getMyParam(this.activeRoute,"cat_id")??"0",ee=this.activeRoute.snapshot.paramMap.get("result_id")??"0",Be=this.activeRoute.snapshot.paramMap.get("user_id")??"",ge=this.activeRoute.snapshot.paramMap.get("student_id")??"",X=this.activeRoute.snapshot.paramMap.get("exam_id")??"",pe=se,lt=X;let Ee=this.orgExamObjs.find(mt=>mt.questionId==this.questionObj.id);Ee&&(pe=Ee.orgCategoryId?.toString()??"0",lt=Ee.orgExamId?.toString()??"0");var H=this.commonService.getMyQueryParam("backto")??"";let xe=`/admin/testbank/test-review/${X}/${Be}/${ge}/${ee}`+(H?"?backto="+encodeURIComponent(H):"");window.location.href=this.commonService.getLocalRouter("/admin/testbank/update-exam/"+pe)+"/"+lt+"?backto="+encodeURIComponent(xe)+"&questionId="+this.questionObj.id}showEditHistoryDialog(){let se={follower:new w.e,examObj:this.examObj,questionObj:this.questionObj,renderConfigObj:this.renderConfigObj,curQuestionIndex:this.curQuestionIndex,curExamResultId:this.curExamResultId,isTeacher:this.showForTeacher};this.sAztDialogService.open(V,{width:"750px",data:se})}showFeedbackQuestionDialog(){this.sAztDialogService.open(d.g,{width:"750px",data:{questionObj:this.questionObj,role:this.showForTeacher?"TEACHER":"STUDENT",applyType:"MATRIX_QUESTION"},restoreFocus:!1,autoFocus:!1})}ngOnChanges(){this.checkEditQuestion()}constructor(se,ee,Be){super(),this.sAztDialogService=se,this.activeRoute=ee,this.timeService=Be,this.showForTeacher=!1,this.curExamResultId=0,this.isEditQuestion=!1}}return(ve=nt).\u0275fac=function(se){return new(se||ve)(C.rXU(U.i),C.rXU(de.nX),C.rXU(_e.F))},ve.\u0275cmp=C.VBU({type:ve,selectors:[["azt-question-action-box"]],inputs:{examObj:"examObj",questionObj:"questionObj",renderConfigObj:"renderConfigObj",orgExamObjs:"orgExamObjs",showForTeacher:"showForTeacher",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId"},features:[C.Vt3,C.OA$],decls:4,vars:4,consts:[[1,"flex"],["class","mr-1",4,"ngIf"],[4,"ngIf"],[1,"mr-1"],[1,"btn","btn-outline-primary","btn-sm","p-1",3,"click","matTooltip"],["name","file-pen-line","size","18"],["name","history","size","18"]],template:function(se,ee){1&se&&(C.j41(0,"div",0),C.DNE(1,ze,4,3,"div",1),C.nI1(2,"isOfflineExam"),C.DNE(3,Te,4,3,"div",2),C.k0s()),2&se&&(C.R7$(),C.Y8G("ngIf",ee.isOrgQuestion()&&!C.bMT(2,2,ee.examObj)),C.R7$(2),C.Y8G("ngIf",ee.isEditQuestion&&!ee.questionObj.isLogEditQuestion))},dependencies:[y.bT,le.oV,ie.WGl,k.wp,k.st],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),nt})()},86622:(yt,ke,v)=>{v.d(ke,{C:()=>c});var l=v(71217),d=v(48891);let c=(()=>{var m;class x{constructor(){this.switchEssayTabSource=new l.t(!1),this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(re){this.switchEssayTabSource.next(re)}}return(m=x).\u0275fac=function(re){return new(re||m)},m.\u0275prov=d.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),x})()},95887:(yt,ke,v)=>{v.d(ke,{g:()=>se});var l=v(10936),d=v(89163),c=v(33887),m=v(15766),x=v(48891),C=v(96699),re=v(54460),y=v(43404),oe=v(15343),z=v(81587),O=v(52811),k=v(9570),q=v(76975);const D=(ee,Be)=>({"btn-primary":ee,"btn-secondary":Be}),Ie=()=>({"mr-2":!0});function J(ee,Be){if(1&ee&&(x.j41(0,"div",22)(1,"b",23),x.EFF(2),x.k0s(),x.j41(3,"div",24),x.nrm(4,"azt-dynamic-hook",17),x.k0s()()),2&ee){let ge;const X=Be.$implicit;x.R7$(2),x.SpI("",null!==(ge=X.alpha)&&void 0!==ge?ge:X.key,"."),x.R7$(2),x.Y8G("content",X.content)}}function V(ee,Be){if(1&ee&&(x.j41(0,"div",20),x.DNE(1,J,5,2,"div",21),x.k0s()),2&ee){const ge=x.XpG(2);x.R7$(),x.Y8G("ngForOf",ge.data.questionObj.answers)}}function w(ee,Be){if(1&ee&&(x.j41(0,"h2",25),x.EFF(1),x.nI1(2,"mytranslate"),x.k0s()),2&ee){const ge=x.XpG(2);x.R7$(),x.Lme(" ",x.bMT(2,2,"lang_auto_dap_an"),": ",ge.data.questionObj.answerResult.join(", ")," ")}}function U(ee,Be){if(1&ee&&(x.j41(0,"div",8)(1,"h2",10),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",16),x.nrm(5,"azt-dynamic-hook",17),x.k0s(),x.DNE(6,V,2,1,"div",18)(7,w,3,4,"h2",19),x.k0s()),2&ee){const ge=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,4,"lang_auto_noi_dung_cau_hoi")," "),x.R7$(3),x.Y8G("content",ge.data.questionObj.content),x.R7$(),x.Y8G("ngIf",1==ge.data.questionObj.answerType&&ge.data.questionObj.answers&&ge.data.questionObj.answers.length>0),x.R7$(),x.Y8G("ngIf",ge.data.questionObj.answerResult&&ge.data.questionObj.isRoleTeacher)}}function de(ee,Be){if(1&ee&&(x.j41(0,"div",8)(1,"h2",26),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",27),x.nrm(5,"azt-dynamic-hook",17),x.k0s()()),2&ee){const ge=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,2,"lang_auto_loi_giai")," "),x.R7$(3),x.Y8G("content",ge.data.questionObj.help)}}function _e(ee,Be){1&ee&&(x.qex(0),x.j41(1,"div",28)(2,"span",29),x.nrm(3,"azt-loading-ui"),x.k0s()(),x.bVm())}function le(ee,Be){if(1&ee&&(x.j41(0,"div",44),x.nrm(1,"input",45),x.j41(2,"label",46),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()()),2&ee){const ge=Be.$implicit,X=Be.index;x.R7$(),x.FS9("id","choice_"+X),x.FS9("formControlName","choice_"+X),x.R7$(),x.FS9("for","choice_"+X),x.R7$(),x.SpI(" ",x.bMT(4,4,ge)," ")}}function ie(ee,Be){if(1&ee&&(x.qex(0),x.j41(1,"div",42),x.DNE(2,le,5,6,"div",43),x.k0s(),x.bVm()),2&ee){const ge=x.XpG().$implicit;x.R7$(),x.FS9("formGroupName","survey_"+ge.id),x.R7$(),x.Y8G("ngForOf",ge.choices)}}function ze(ee,Be){if(1&ee&&(x.qex(0),x.j41(1,"mat-radio-button",49),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.bVm()),2&ee){const ge=Be.$implicit,X=x.XpG(2).$implicit,pe=x.XpG(3);x.R7$(),x.FS9("value",ge),x.Y8G("checked",pe.form.controls["survey_"+X.id].value==ge),x.R7$(),x.JRh(x.bMT(3,3,ge))}}function Te(ee,Be){if(1&ee&&(x.j41(0,"mat-radio-group",47),x.DNE(1,ze,4,5,"ng-container",48),x.k0s()),2&ee){const ge=x.XpG().$implicit;x.FS9("formControlName","survey_"+ge.id),x.R7$(),x.Y8G("ngForOf",ge.choices)}}function Qe(ee,Be){if(1&ee&&(x.j41(0,"div",39)(1,"div",40)(2,"h2",41),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()(),x.j41(5,"div"),x.DNE(6,ie,3,2,"ng-container",11)(7,Te,2,2,"ng-template",null,1,x.C5r),x.k0s()()),2&ee){const ge=Be.$implicit,X=Be.index,pe=x.sdS(8);x.R7$(3),x.Lme(" ",X+1+". ","",x.bMT(4,4,ge.content)," "),x.R7$(3),x.Y8G("ngIf",ge.multiChoice&&ge.choices&&ge.choices.length>1)("ngIfElse",pe)}}function ve(ee,Be){if(1&ee&&(x.j41(0,"div"),x.DNE(1,Qe,9,6,"div",38),x.k0s()),2&ee){const ge=x.XpG(2);x.R7$(),x.Y8G("ngForOf",ge.surveyObjs)}}function nt(ee,Be){if(1&ee){const ge=x.RV6();x.DNE(0,ve,2,1,"div",30),x.j41(1,"div",31)(2,"button",32),x.bIt("click",function(){x.eBV(ge);const pe=x.XpG();return x.Njj(pe.changeFeedBackEmotion(2))}),x.nrm(3,"lucide-icon",33),x.j41(4,"span"),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s()(),x.j41(7,"button",34),x.bIt("click",function(){x.eBV(ge);const pe=x.XpG();return x.Njj(pe.changeFeedBackEmotion(1))}),x.nrm(8,"lucide-icon",35),x.j41(9,"span"),x.EFF(10),x.nI1(11,"mytranslate"),x.k0s()()(),x.j41(12,"div",36)(13,"textarea",37),x.nI1(14,"mytranslate"),x.bIt("keyup",function(){x.eBV(ge);const pe=x.XpG();return x.Njj(pe.autoResizeFeedBackArea())}),x.k0s()()}if(2&ee){const ge=x.XpG();x.Y8G("ngIf",ge.surveyObjs.length),x.R7$(2),x.Y8G("disabled",ge.disableLike)("ngClass",x.l_i(16,D,2==ge.feedBackEmotion,2!=ge.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(19,Ie)),x.R7$(2),x.JRh(x.bMT(6,10,"lang_test_market_introduce_rating_like")),x.R7$(2),x.Y8G("disabled",ge.disableLike)("ngClass",x.l_i(20,D,1==ge.feedBackEmotion,1!=ge.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(23,Ie)),x.R7$(2),x.JRh(x.bMT(11,12,"lang_test_market_introduce_rating_dislike")),x.R7$(3),x.FS9("placeholder",x.bMT(14,14,"lang_global_question_ask_to_feedback_placeholder"))}}function at(ee,Be){1&ee&&(x.j41(0,"span",50),x.nrm(1,"azt-loading-ui"),x.k0s())}let se=(()=>{var ee;class Be extends c._{getAnswerSurvey(){let X=[],pe=this.commonService.getFormObj(this.form);for(let lt in pe)if(lt.includes("survey_")){let Ee={surveyId:Number(lt.substring(lt.indexOf("_")+1)),answers:[]};if(pe[lt]instanceof Object){let H=this.surveyObjs.find(xe=>xe.id==Ee.surveyId);if(H)for(let xe in pe[lt])if(pe[lt][xe]){let mt=Number(xe.substring(xe.indexOf("_")+1));if(Array.isArray(H.choices)&&H.choices[mt]){let rt=H.choices[mt];Ee.answers?.push(rt)}}}else Ee.answers=[pe[lt]];X.push(Ee)}return X}getFeedbackSurveys(){this.loadingFeedBackSurvey=!0,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksSurveysGet(this.applyType,this.role).subscribe(X=>{if(1==X.success){this.surveyObjs=X.data?.objs??[];let pe={feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,m.M.noWhiteSpace]})};this.surveyObjs.length>0&&this.surveyObjs.forEach(lt=>{if(lt.multiChoice&&lt.choices&&lt.choices.length>1){let Ee={};pe[`survey_${lt.id}`]=new l.gE({}),lt.choices.forEach((H,xe)=>{Ee[`choice_${xe}`]=new l.MJ(!1,{nonNullable:!0})}),pe[`survey_${lt.id}`]=this.fb.group(Ee)}else pe[`survey_${lt.id}`]=new l.MJ("",{nonNullable:!0,validators:[l.k0.required]})}),this.form=this.fb.group(pe),this.loadingFeedBackSurvey=!1}else this.errorStatusObj(X.message??"",!0),this.loadingFeedBackSurvey=!1}))}getInfoFeedback(){this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksGet(this.questionId,this.applyType,this.role).subscribe(X=>{if(1==X.success){let pe=X.data?.objs??[];pe.length&&pe[0].status&&(this.feedBackEmotion=pe[0].status,this.disableLike=!0)}else this.errorStatusObj(X.message??"",!0),this.disableLike=!1}))}changeFeedBackEmotion(X){this.disableLike||(this.feedBackEmotion=X,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost({objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??void 0,content:"",surveyAnswers:[]}).subscribe(lt=>{1==lt.success?this.getInfoFeedback():this.errorStatusObj(lt.message??"",!0)})))}autoResizeFeedBackArea(){const X=document.getElementById("text-area-feedback");X&&setTimeout(()=>{X.style.cssText="height:auto;",X.style.cssText="height:"+(X.scrollHeight+30)+"px"},0)}sendFeedBack(){if(this.form.invalid)this.showErrorSnack("lang_auto_vui_long_dien_day_du_thong_tin");else{this.initStatusObj(),this.sendingFeedBack=!0;let X={objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??0,content:this.form.controls.feedBackContent.value??void 0,surveyAnswers:this.getAnswerSurvey()};this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost(X).subscribe(pe=>{1==pe.success?(this.sendingFeedBack=!1,this.dialogRef.close(!0),this.successStatusObj("TEACHER"==this.role?"lang_test_market_success_feedback":"lang_test_market_success_feedback_student",!0)):(this.errorStatusObj(pe.message??"",!0),this.sendingFeedBack=!1)}))}}btnCloseDialog(){this.dialogRef.close(!1)}ngOnInit(){this.questionId=this.data.questionObj.id,this.role=this.data.role,this.applyType=this.data.applyType,this.form=this.fb.group({feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,m.M.noWhiteSpace]})}),this.getInfoFeedback(),this.getFeedbackSurveys(),super.ngOnInit()}constructor(X,pe,lt,Ee){super(Ee,lt),this.fb=X,this.testMarketFeedbackService=pe,this.dialogRef=lt,this.data=Ee,this.role="",this.applyType="",this.form=new l.gE({}),this.feedBackEmotion=void 0,this.totalLike=0,this.totalDislike=0,this.sendingFeedBack=!1,this.loadingFeedBackSurvey=!1,this.disableLike=!1,this.surveyObjs=[]}}return(ee=Be).\u0275fac=function(X){return new(X||ee)(x.rXU(l.ok),x.rXU(C.l_),x.rXU(d.CP,8),x.rXU(d.Vh,8))},ee.\u0275cmp=x.VBU({type:ee,selectors:[["exam-matrix-feedback-dialog"]],features:[x.Vt3],decls:25,vars:19,consts:[["doneLoading",""],["SingleChoice",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-3","border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"intro-y","overflow-auto",2,"max-height","calc(100vh - 150px)"],[1,"text-md","mr-auto","font-bold"],["class","border-t border-slate-200/60 dark:border-darkmode-400 py-2 mt-2",4,"ngIf"],[1,"border-t","border-slate-200/60","dark:border-darkmode-400","py-2","mt-2"],[3,"formGroup"],[1,"font-medium","text-md","text-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"p-3","text-right"],["azt-track-service","exam-matrix-feedback-dialog-qXEblgFcT",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","exam-matrix-feedback-dialog-NGlD5D-IvA",1,"btn","btn-primary","mw-24",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"tex2jax_process","box-content",2,"width","auto"],[3,"content"],["class","grid grid-cols-12 gap-2 answers",4,"ngIf"],["class","font-medium text-md text-left text-success my-2",4,"ngIf"],[1,"grid","grid-cols-12","gap-2","answers"],["class","answer col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"answer","col-span-12","md:col-span-6"],[1,"answer-label"],[1,"answer-content"],[1,"font-medium","text-md","text-left","text-success","my-2"],[1,"font-medium","text-md","text-center"],[1,"help-content","box","px-3","mt-1",2,"display","inherit","border-top-right-radius","0","border-top-left-radius","0","box-shadow","none","overflow","auto","padding-bottom","20px"],[1,"flex","items-center","h-full","w-full"],[1,"w-8","h-8","mx-auto"],[4,"ngIf"],[1,"flex","items-center",2,"flex-wrap","wrap"],["azt-track-service","exam-matrix-feedback-dialog-PoMeFnagK",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-up","size","24",3,"ngClass"],["azt-track-service","exam-matrix-feedback-dialog-iJokCn34oQ",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-down","size","20",3,"ngClass"],[1,"items-center","mt-1"],["id","text-area-feedback","type","text","cols","10","rows","3","formControlName","feedBackContent",1,"form-control","mt-1",3,"keyup","placeholder"],["class","flex flex-wrap mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","mb-2"],[2,"min-width","300px"],[1,"text-md","mb-2"],[1,"block","px-2","ml-2","sm:flex",3,"formGroupName"],["class","mr-5",4,"ngFor","ngForOf"],[1,"mr-5"],["type","checkbox",1,"form-check-input",3,"id","formControlName"],[2,"vertical-align","middle","cursor","pointer","margin-left","3px",3,"for"],["color","primary",1,"px-2",2,"flex-direction","column",3,"formControlName"],[4,"ngFor","ngForOf"],[1,"mr-5",3,"checked","value"],[1,"w-4","h-4","mr-2"]],template:function(X,pe){if(1&X){const lt=x.RV6();x.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s(),x.DNE(7,U,8,6,"div",7)(8,de,6,4,"div",7),x.j41(9,"div",8)(10,"form",9)(11,"h2",10),x.EFF(12),x.nI1(13,"mytranslate"),x.k0s(),x.DNE(14,_e,4,0,"ng-container",11)(15,nt,15,24,"ng-template",null,0,x.C5r),x.k0s()()()()(),x.j41(17,"div",12)(18,"button",13),x.bIt("click",function(){return x.eBV(lt),x.Njj(pe.btnCloseDialog())}),x.EFF(19),x.nI1(20,"mytranslate"),x.k0s(),x.j41(21,"button",14),x.bIt("click",function(){return x.eBV(lt),x.Njj(pe.sendFeedBack())}),x.DNE(22,at,2,0,"span",15),x.EFF(23),x.nI1(24,"mytranslate"),x.k0s()()()}if(2&X){const lt=x.sdS(16);x.R7$(5),x.SpI(" ",x.bMT(6,11,pe.data.questionObj.isRoleTeacher?"lang_global_question_ask_to_feedback":"lang_global_question_ask_to_report")," "),x.R7$(2),x.Y8G("ngIf",pe.data.questionObj.content),x.R7$(),x.Y8G("ngIf",pe.data.questionObj.help&&pe.data.questionObj.isRoleTeacher),x.R7$(2),x.Y8G("formGroup",pe.form),x.R7$(2),x.SpI(" ",x.bMT(13,13,"lang_auto_nhan_xet")," "),x.R7$(2),x.Y8G("ngIf",pe.loadingFeedBackSurvey)("ngIfElse",lt),x.R7$(5),x.SpI(" ",x.bMT(20,15,"lang_auto_dong")," "),x.R7$(2),x.Y8G("disabled",pe.sendingFeedBack||pe.form.invalid),x.R7$(),x.Y8G("ngIf",pe.sendingFeedBack),x.R7$(),x.SpI(" ",x.bMT(24,17,"lang_button_send")," ")}},dependencies:[re.YU,re.Sq,re.bT,y.VT,y._g,l.qT,l.me,l.Zm,l.BC,l.cb,l.j4,l.JD,l.$R,oe.WGl,z.t,O.R,k.x,q.wp],styles:[".answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}"]}),Be})()},14987:(yt,ke,v)=>{v.d(ke,{i:()=>y});var l=v(59640),d=v(48891),c=v(54460),m=v(10936),x=v(81587),C=v(76975);function re(oe,z){if(1&oe&&(d.j41(0,"div",1)(1,"form",2),d.nrm(2,"input",3),d.nI1(3,"mytranslate"),d.nrm(4,"input",4),d.nI1(5,"mytranslate"),d.k0s()()),2&oe){const O=d.XpG();d.R7$(),d.Y8G("formGroup",O.form),d.R7$(),d.FS9("placeholder",d.bMT(3,3,"lang_auto_ten_truong")),d.R7$(2),d.FS9("placeholder",d.bMT(5,5,"lang_auto_mon_hoc_form"))}}let y=(()=>{var oe;class z extends l.H{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject})}ngOnInit(){this.initData()}}return(oe=z).\u0275fac=function(k){return new(k||oe)},oe.\u0275cmp=d.VBU({type:oe,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},features:[d.Vt3],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"]],template:function(k,q){1&k&&d.DNE(0,re,6,7,"div",0),2&k&&d.Y8G("ngIf",q.form)},dependencies:[c.bT,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,x.t,C.wp],encapsulation:2}),z})()},30551:(yt,ke,v)=>{v.d(ke,{P:()=>U});var l=v(59640),d=v(48891),c=v(37642),m=v(36484),x=v(99927),C=v(54460),re=v(60303),y=v(76975);const oe=de=>({"font-bold":de});function z(de,_e){if(1&de&&(d.j41(0,"td",11),d.EFF(1),d.k0s()),2&de){const le=d.XpG().$implicit,ie=d.XpG().$implicit,ze=d.XpG(2);d.BMQ("rowspan",ie.length),d.R7$(),d.JRh(ze.toNumber(le.index)+1)}}function O(de,_e){if(1&de&&(d.qex(0),d.j41(1,"tr"),d.DNE(2,z,2,2,"td",10),d.j41(3,"td",11),d.EFF(4),d.nI1(5,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(6,"td",12),d.EFF(7),d.k0s()(),d.bVm()),2&de){const le=_e.$implicit,ie=_e.index,ze=d.XpG(3);d.R7$(2),d.Y8G("ngIf",0==ie),d.R7$(2),d.JRh(d.bMT(5,4,1e3*le.second)),d.R7$(2),d.Y8G("ngClass",d.eq3(6,oe,le.isFontBold)),d.R7$(),d.JRh(ze.isShowOriginAnswer?le.key:le.alpha?le.alpha:le.key)}}function k(de,_e){if(1&de&&(d.qex(0),d.DNE(1,O,8,8,"ng-container",9),d.bVm()),2&de){const le=_e.$implicit;d.R7$(),d.Y8G("ngForOf",le)}}function q(de,_e){if(1&de&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,k,2,1,"ng-container",9),d.k0s()),2&de){const le=d.XpG();d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_cau_hoi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"lang_auto_dap_an")),d.R7$(2),d.Y8G("ngForOf",le.groupObjs)}}function D(de,_e){1&de&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&de&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}function Ie(de,_e){if(1&de&&(d.qex(0),d.j41(1,"tr")(2,"td",11),d.EFF(3),d.k0s(),d.j41(4,"td",11),d.EFF(5),d.nI1(6,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(7,"td",11),d.EFF(8),d.k0s()(),d.bVm()),2&de){let le;const ie=_e.$implicit;d.R7$(3),d.JRh(ie.userAgent),d.R7$(2),d.JRh(d.bMT(6,3,null!==(le=ie.startedAt)&&void 0!==le?le:"")),d.R7$(3),d.JRh(ie.ip)}}function J(de,_e){if(1&de&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,Ie,9,5,"ng-container",9),d.k0s()),2&de){const le=d.XpG(2);d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_thong_tin_thiet_bi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"IP")),d.R7$(2),d.Y8G("ngForOf",le.ipTrackingDataObjs)}}function V(de,_e){1&de&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&de&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu")))}function w(de,_e){if(1&de&&(d.j41(0,"mat-tab",1),d.nI1(1,"mytranslate"),d.j41(2,"div",2),d.DNE(3,J,12,10,"table",3)(4,V,3,3,"ng-template",null,0,d.C5r),d.k0s()()),2&de){const le=d.sdS(5),ie=d.XpG();d.FS9("label",d.bMT(1,3,"lang_auto_thong_tin_thiet_bi_IP")),d.R7$(3),d.Y8G("ngIf",ie.ipTrackingDataObjs.length>0)("ngIfElse",le)}}let U=(()=>{var de;class _e extends l.H{findReTapQuesions(){var ie=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var ze in ie)if(ie.hasOwnProperty(ze)){var Te=ie[ze].map((Qe,ve)=>{let nt=!1,at=this.questionObjs.find(se=>se.id==Qe.questionId);if(this.answerTypeService.isTrueFalseAnswer(at)){for(let se=ie[ze].length-1;se>=0;se--)if(ie[ze][se].key.includes(Qe.key.split("")[0])){nt=Qe.key==ie[ze][se].key;break}}else nt=ve==ie[ze].length-1;return{...Qe,isFontBold:nt}});this.groupObjs.push(Te)}}toNumber(ie){return parseInt(ie,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(ie,ze,Te){super(),this.dictionaryService=ie,this.userService=ze,this.answerTypeService=Te,this.startQuestionIndex=1,this.isShowOriginAnswer=!1,this.ipTrackingDataObjs=[],this.isTeacherRole=this.userService.isTeacherRole(),this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return(de=_e).\u0275fac=function(ie){return new(ie||de)(d.rXU(c.E),d.rXU(m.R),d.rXU(x._))},de.\u0275cmp=d.VBU({type:de,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",isShowOriginAnswer:"isShowOriginAnswer",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs",ipTrackingDataObjs:"ipTrackingDataObjs",questionObjs:"questionObjs"},features:[d.Vt3],decls:8,vars:6,consts:[["noData",""],[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],[3,"label",4,"ngIf"],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(ie,ze){if(1&ie&&(d.j41(0,"mat-tab-group")(1,"mat-tab",1),d.nI1(2,"mytranslate"),d.j41(3,"div",2),d.DNE(4,q,12,10,"table",3)(5,D,3,3,"ng-template",null,0,d.C5r),d.k0s()(),d.DNE(7,w,6,5,"mat-tab",4),d.k0s()),2&ie){const Te=d.sdS(6);d.R7$(),d.FS9("label",d.bMT(2,4,"lang_auto_chi_tiet_chon_dap_an")),d.R7$(3),d.Y8G("ngIf",ze.groupObjs.length>0)("ngIfElse",Te),d.R7$(3),d.Y8G("ngIf",ze.isTeacherRole)}},dependencies:[C.YU,C.Sq,C.bT,re.mq,re.T8,y.wp,y.Ky],encapsulation:2}),_e})()},78745:(yt,ke,v)=>{v.d(ke,{d:()=>D});var l=v(59640),d=v(48891),c=v(54460),m=v(17818),x=v(47712),C=v(15343),re=v(64160),y=v(15437),oe=v(76975);const z=()=>({"mr-2":!0});function O(Ie,J){if(1&Ie){const V=d.RV6();d.qex(0),d.j41(1,"div",6)(2,"p",7),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"p",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"div",8),d.nrm(9,"input",9),d.j41(10,"button",10),d.bIt("click",function(){d.eBV(V);const U=d.XpG();return d.Njj(U.showCopySuccess())}),d.nrm(11,"lucide-icon",11),d.EFF(12),d.nI1(13,"mytranslate"),d.k0s()()(),d.bVm()}if(2&Ie){const V=d.XpG();d.R7$(3),d.JRh(d.bMT(4,6,"lang_auto_hoac")),d.R7$(3),d.JRh(d.bMT(7,8,"lang_classroom_QR_join_link_copy")),d.R7$(3),d.Y8G("value",V.linkUrl),d.R7$(),d.Y8G("cdkCopyToClipboard",V.copyLinkToClipboard(V.linkUrl)),d.R7$(),d.Y8G("ngClass",d.lJ4(12,z)),d.R7$(),d.SpI(" ",d.bMT(13,10,"lang_auto_sao_chep")," ")}}let k=(()=>{var Ie;class J extends l.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1,this.qrCodeDownloadLink=""}showCopySuccess(){this.showSuccessSnack("lang_auto_sao_chep_thanh_cong")}copyLinkToClipboard(w){return w}onChangeURL(w){this.qrCodeDownloadLink=w}downloadQrCode(){try{let w=""!=this.fileName?this.commonService.createFileNameExportFile([this.fileName])+".jpg":this.commonService.createFileNameExportFile(["azota-qr-code-"])+".jpg";this.commonService.downloadFileByUrl(this.qrCodeDownloadLink.changingThisBreaksApplicationSecurity,w)}catch{console.log("Download QrCode error")}}}return(Ie=J).\u0275fac=(()=>{let V;return function(U){return(V||(V=d.xGo(Ie)))(U||Ie)}})(),Ie.\u0275cmp=d.VBU({type:Ie,selectors:[["azt-show-link"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:8,vars:11,consts:[["azt-track-service","download-qr-code-9t-9Wiu2xv",1,"box","p-3","text-center",3,"click"],[2,"background","#fff","padding","5px"],["colorDark","#2361ad","imageSrc","'images/Azota-For-QrCode-01.png' | convertCdnLinkOfGitHub",3,"qrCodeURL","allowEmptyString","qrdata","elementType","width","errorCorrectionLevel"],["azt-track-service","download-qr-code-RqVBz6g1z7",1,"btn","btn-outline-primary","btn-transparent","btn-sm","mx-auto","mt-2",3,"click"],["name","download","size","16",3,"ngClass"],[4,"ngIf"],[1,"text-center"],[1,"h5","mt-2","font-medium"],[1,"azt-copy","relative","mt-2"],["type","text","readonly","",1,"form-control","py-3","px-4","border-transparent","bg-slate-100","pr-10",2,"padding-right","120px",3,"value"],["azt-track-service","download-qr-code-yW-aFu0tO",1,"btn","btn-outline-primary","absolute","my-auto","inset-y-0","right-0",2,"border-top-left-radius","0","border-bottom-left-radius","0",3,"click","cdkCopyToClipboard"],["name","copy","size","16",3,"ngClass"]],template:function(w,U){1&w&&(d.j41(0,"div",0),d.bIt("click",function(_e){return _e.stopPropagation()}),d.j41(1,"div",1)(2,"qrcode",2),d.bIt("qrCodeURL",function(_e){return U.onChangeURL(_e)}),d.k0s()(),d.j41(3,"a",3),d.bIt("click",function(){return U.downloadQrCode()}),d.nrm(4,"lucide-icon",4),d.EFF(5),d.nI1(6,"mytranslate"),d.k0s(),d.DNE(7,O,14,13,"ng-container",5),d.k0s()),2&w&&(d.R7$(2),d.Y8G("allowEmptyString",!0)("qrdata",U.linkUrl)("elementType","url")("width",128)("errorCorrectionLevel","M"),d.R7$(2),d.Y8G("ngClass",d.lJ4(10,z)),d.R7$(),d.SpI(" ",d.bMT(6,8,"lang_auto_tai_ve_may")," "),d.R7$(2),d.Y8G("ngIf",U.showLink))},dependencies:[c.YU,c.bT,re.dF,C.WGl,y.c,oe.wp],encapsulation:2}),J})();const q=Ie=>({"w-80":Ie});let D=(()=>{var Ie;class J extends l.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1}}return(Ie=J).\u0275fac=(()=>{let V;return function(U){return(V||(V=d.xGo(Ie)))(U||Ie)}})(),Ie.\u0275cmp=d.VBU({type:Ie,selectors:[["azt-download-qr-code"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:7,vars:10,consts:[["showQrCode","matMenu"],["azt-track-service","download-qr-code-hiQXy_iTc",1,"btn","btn-outline-primary","btn-transparent","p-1",3,"matMenuTriggerFor","matTooltip"],["name","qr-code","size","24"],["xPosition","before"],[3,"ngClass"],[3,"linkUrl","fileName","showLink"]],template:function(w,U){if(1&w&&(d.j41(0,"button",1),d.nI1(1,"mytranslate"),d.nrm(2,"lucide-icon",2),d.k0s(),d.j41(3,"mat-menu",3,0)(5,"div",4),d.nrm(6,"azt-show-link",5),d.k0s()()),2&w){const de=d.sdS(4);d.FS9("matTooltip",d.bMT(1,6,"lang_auto_quet_hoac_tai_ma_qr_code")),d.Y8G("matMenuTriggerFor",de),d.R7$(5),d.Y8G("ngClass",d.eq3(8,q,U.showLink)),d.R7$(),d.Y8G("linkUrl",U.linkUrl)("fileName",U.fileName)("showLink",U.showLink)}},dependencies:[c.YU,m.kk,m.Cp,x.oV,C.WGl,k,oe.wp],encapsulation:2}),J})()},72802:(yt,ke,v)=>{v.d(ke,{f:()=>Et});var l=v(27691),d=v(48891),c=v(10936),m=v(67421),x=v(59640),C=v(30657),re=v(83229),y=v(51913),oe=v(40949),z=v(55465),O=v(35095),k=v(41426),q=v(54460),D=v(47712),Ie=v(15343),J=v(7919),V=v(81587),w=v(84278),U=v(34815),de=v(76975);const _e=["mnoteContainer"],le=Xe=>({display:Xe}),ie=Xe=>({border:Xe}),ze=()=>({"mr-1":!0}),Te=Xe=>({"is-invalid":Xe});function Qe(Xe,pt){1&Xe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Xe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function ve(Xe,pt){1&Xe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Xe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function nt(Xe,pt){1&Xe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Xe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function at(Xe,pt){if(1&Xe&&(d.j41(0,"div",18),d.DNE(1,Qe,3,3,"span",19)(2,ve,3,3,"span",19)(3,nt,3,3,"span",19),d.k0s()),2&Xe){const Ze=d.XpG().index,Ge=d.XpG();d.R7$(),d.Y8G("ngIf",null==Ge.form.controls["cau"+Ze].errors?null:Ge.form.controls["cau"+Ze].errors.min),d.R7$(),d.Y8G("ngIf",null==Ge.form.controls["cau"+Ze].errors?null:Ge.form.controls["cau"+Ze].errors.max),d.R7$(),d.Y8G("ngIf",null==Ge.form.controls["cau"+Ze].errors?null:Ge.form.controls["cau"+Ze].errors.pattern)}}function se(Xe,pt){if(1&Xe){const Ze=d.RV6();d.j41(0,"div",11)(1,"div",12)(2,"lucide-icon",13),d.nI1(3,"mytranslate"),d.bIt("click",function(K){const ce=d.eBV(Ze).index,me=d.XpG();return d.Njj(me.toggleVisibility(K,ce))}),d.k0s(),d.j41(4,"span",14),d.EFF(5),d.nI1(6,"mytranslate"),d.j41(7,"span",15),d.nI1(8,"mytranslate"),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.nrm(11,"input",16),d.nI1(12,"mytranslate"),d.k0s(),d.DNE(13,at,4,3,"div",17),d.k0s()}if(2&Xe){let Ze;const Ge=pt.$implicit,K=pt.index,ce=d.XpG();d.Y8G("ngStyle",d.eq3(25,ie,K==ce.questions.length-1?"none":"")),d.R7$(2),d.FS9("matTooltip",d.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),d.Y8G("ngClass",d.lJ4(27,ze)),d.R7$(3),d.Lme(" ",d.bMT(6,17,"lang_auto_cau")," ",(null!==(Ze=Ge.indexLabel)&&void 0!==Ze?Ze:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",Ge.essMaxPoint," ",d.bMT(10,21,"lang_auto_diem_brackets"),""),d.R7$(2),d.FS9("placeholder",d.bMT(12,23,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",K,""),d.Y8G("readonly",!ce.showForTeacher)("decimal",!0)("ngClass",d.eq3(28,Te,ce.form.controls["cau"+K]&&ce.form.controls["cau"+K].invalid)),d.R7$(2),d.Y8G("ngIf",ce.form.controls["cau"+K].errors)}}function ee(Xe,pt){if(1&Xe){const Ze=d.RV6();d.j41(0,"div",20)(1,"button",21),d.bIt("click",function(){d.eBV(Ze);const K=d.XpG();return d.Njj(K.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Xe){const Ze=d.XpG();d.R7$(),d.Y8G("disabled",Ze.isLoading||Ze.form.invalid),d.R7$(),d.SpI(" ",Ze.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}function Be(Xe,pt){if(1&Xe&&d.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Xe){let Ze;const Ge=d.XpG().$implicit,K=d.XpG();d.Y8G("follower",K.followerRenderQuest)("examObj",K.examObj)("examConfig",K.examConfig)("questionObj",Ge)("curQuestionIndex",null!==(Ze=Ge.indexLabel)&&void 0!==Ze?Ze:0)("userAnswersObj",K.userAnswersObj)("currentTab","essay_tab")}}function ge(Xe,pt){if(1&Xe&&d.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Xe){let Ze;const Ge=d.XpG().$implicit,K=d.XpG();d.Y8G("follower",K.followerRenderQuest)("examObj",K.examObj)("questionObj",Ge)("curQuestionIndex",null!==(Ze=Ge.indexLabel)&&void 0!==Ze?Ze:0)("userAnswersObj",K.userAnswersObj)("orgExamObjs",K.orgExamObjs)("currentTab","essay_tab")}}function X(Xe,pt){1&Xe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Xe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function pe(Xe,pt){1&Xe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Xe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function lt(Xe,pt){1&Xe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Xe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Ee(Xe,pt){if(1&Xe&&(d.j41(0,"div",18),d.DNE(1,X,3,3,"span",19)(2,pe,3,3,"span",19)(3,lt,3,3,"span",19),d.k0s()),2&Xe){const Ze=d.XpG(2).index,Ge=d.XpG();d.R7$(),d.Y8G("ngIf",null==Ge.form.controls["cau"+Ze].errors?null:Ge.form.controls["cau"+Ze].errors.min),d.R7$(),d.Y8G("ngIf",null==Ge.form.controls["cau"+Ze].errors?null:Ge.form.controls["cau"+Ze].errors.max),d.R7$(),d.Y8G("ngIf",null==Ge.form.controls["cau"+Ze].errors?null:Ge.form.controls["cau"+Ze].errors.pattern)}}function H(Xe,pt){if(1&Xe&&(d.j41(0,"div",29)(1,"form",30)(2,"label",31),d.EFF(3),d.nI1(4,"mytranslate"),d.j41(5,"span",15),d.nI1(6,"mytranslate"),d.EFF(7),d.nI1(8,"mytranslate"),d.k0s(),d.EFF(9," : "),d.k0s(),d.nrm(10,"input",32),d.nI1(11,"mytranslate"),d.DNE(12,Ee,4,3,"div",17),d.k0s()()),2&Xe){let Ze;const Ge=d.XpG(),K=Ge.$implicit,ce=Ge.index,me=d.XpG();d.R7$(),d.Y8G("formGroup",me.form),d.R7$(),d.FS9("for","cau_"+ce),d.R7$(),d.Lme(" ",d.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(Ze=K.indexLabel)&&void 0!==Ze?Ze:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",K.essMaxPoint," ",d.bMT(8,19,"lang_auto_diem_brackets"),""),d.R7$(3),d.FS9("placeholder",d.bMT(11,21,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",ce,""),d.Y8G("readonly",!me.showForTeacher)("ngClass",d.eq3(23,Te,me.form.controls["cau"+ce]&&me.form.controls["cau"+ce].invalid))("id","cau_"+ce)("decimal",!0),d.R7$(2),d.Y8G("ngIf",me.form.controls["cau"+ce].errors)}}function xe(Xe,pt){if(1&Xe&&(d.j41(0,"div",22)(1,"div",23),d.DNE(2,Be,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,ge,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,H,13,25,"div",26),d.k0s()()),2&Xe){const Ze=pt.index,Ge=d.XpG();d.R7$(),d.Mz_("id","q_",Ze,""),d.R7$(),d.Y8G("ngIf",!Ge.showForTeacher),d.R7$(),d.Y8G("ngIf",Ge.showForTeacher),d.R7$(),d.Y8G("ngIf",Ge.showForTeacher)}}function mt(Xe,pt){1&Xe&&(d.j41(0,"div",33)(1,"b"),d.EFF(2),d.nI1(3,"mytranslate"),d.k0s(),d.EFF(4),d.nI1(5,"mytranslate"),d.k0s()),2&Xe&&(d.R7$(2),d.SpI("",d.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),d.R7$(2),d.SpI(" ",d.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function rt(Xe,pt){if(1&Xe){const Ze=d.RV6();d.j41(0,"div",34)(1,"button",35),d.bIt("click",function(){d.eBV(Ze);const K=d.XpG();return d.Njj(K.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Xe){const Ze=d.XpG();d.R7$(),d.Y8G("disabled",Ze.isLoading||Ze.form.invalid),d.R7$(),d.SpI(" ",Ze.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}let Et=(()=>{var Xe;class pt extends x.H{parseValue(Ge){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[Ge]}getMaxPoint(Ge){var K=0;for(let ce=0;ce<this.questions.length;ce++)if(this.questions[ce].id==Ge){K=this.questions[ce].scorePerQuestion??0;break}return K}toggleVisibility(Ge,K){var ce=Ge.target,me=document.getElementById(`q_${K}`);me&&("block"==me?.style.display?(me.style.display="none",ce&&(ce.textContent="visibility_off")):(me.style.display="block",ce&&(ce.textContent="visibility")))}isValidPoint(){let Ge=0;var K=this.form.value;for(var ce in K){var me=Number(ce.substring(3));K[ce]>this.maxPointPerQuestion[me]&&Ge++}return!(Ge>0)}validateForm(Ge,K,ce,me){let G="";this.form.get("cau"+me)?.valueChanges.pipe((0,m.J)()).subscribe(([F,S])=>{if(G="string"==typeof S&&S.includes(",")?S.replace(",","."):S,isNaN(+G))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+me].setValue(K);else{let j=parseFloat(G);j>ce&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),j<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(Ge,K){var ce=(0,re.q)(Ge);this.apiUploadService.commonUploadForMarkResult(ce,`essay_note_${K}_${this.resultID}.png`,"image/png").subscribe(me=>{me.type!=l.hv.UploadProgress&&(1==me.success?(this.mnoteJsonData.pages[K].draw=me.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(Ge){this.pagesCount=0;for(let K=0;K<Ge.length;K++)Ge[K].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let K=0;K<Ge.length;K++)Ge[K].draw&&this.uploadBase64ToCDN(Ge[K].draw,K)}sendDataToIframe(){const Ge=document.getElementById("mNote"),K=Ge?Ge.contentWindow:null;if(null!==K)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var ce=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=ce){for(let G=0;G<ce.pages.length;G++)ce.pages[G].backgroundImage&&(ce.pages[G].backgroundImage=this.cdnService.getMyCdn(ce.pages[G].backgroundImage)),ce.pages[G].draw&&(ce.pages[G].draw=this.cdnService.getMyCdn(ce.pages[G].draw));ce=JSON.stringify(ce),this.examResultObj.result=ce}}var me=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(me?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let G=0;G<this.jsonData.pages.length;G++)this.jsonData.pages[G].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[G].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[G].backgroundImage)),this.jsonData.pages[G].hasOwnProperty("draw")&&(this.jsonData.pages[G].draw=this.cdnService.getMyCdn(this.jsonData.pages[G].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),K.postMessage(this.jsonData,"*")}else{let G=[];this.files.forEach(S=>{var j=this.cdnService.getMyCdn(S.url);j&&G.push({backgroundImage:j})}),K.postMessage({cmd:"initMNote",pages:G,mode:this.showForTeacher?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:G}}}checkMapBGImageWithFileLength(Ge){var K=this.commonService.willDeleteParseJson(Ge);let ce=!1;if(0==this.files.length)ce=!0;else if(this.files.length>0&&K&&K.pages&&this.files.length==K.pages.length){let me=0;this.files.forEach((G,F)=>{K.pages[F]&&K.pages[F].backgroundImage&&K.pages[F].backgroundImage.indexOf(G.path)>-1&&me++}),me==this.files.length&&(ce=!0)}return ce}addBGImageByFileUrl(Ge){var K=this.commonService.willDeleteParseJson(Ge);return this.files.forEach((ce,me)=>{let G=!1;if(K&&K.pages){for(var F=0;F<K.pages.length;F++)if(K.pages[F]&&K.pages[F].backgroundImage&&K.pages[F].backgroundImage.indexOf(ce.path)>-1){G=!0;break}!1===G&&(K.pages[me]&&K.pages[me].id==me?K.pages[me].backgroundImage=this.cdnService.getMyCdn(ce.url??""):K.pages.splice(me,0,{backgroundImage:this.cdnService.getMyCdn(ce.url??"")}))}}),JSON.stringify(K)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let Ge=!1;for(const K in this.form.value)""!==this.form.value[K]&&(Ge=!0);if(!Ge)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const K in this.form.value)""===this.form.value[K]&&(this.form.value[K]=0,this.form.controls[K].setValue(0));if(this.files&&this.files.length>0){const K=document.getElementById("mNote"),ce=K?K.contentWindow:null;null!==ce&&ce.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(Ge){if(this.checkMapBGImageWithFileLength(Ge)){for(const G in this.form.value)"string"==typeof this.form.value[G]&&this.form.value[G].includes(",")&&(this.form.value[G]=this.form.value[G].replace(",","."));let me=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var ce={id:this.resultID,result:Ge,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(ce,me).subscribe(G=>{1==G.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(G.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";var Ge={};let K;this.examResultObj.confirmedAt&&(K=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(me=>{let G=this.getMaxPoint(me.id);this.totalMaxPoint+=G,me.essMaxPoint=G,this.maxPointPerQuestion.push(me.essMaxPoint)});for(let me=0;me<this.questions.length;me++){var ce=`cau${me}`;Ge[ce]=new c.MJ(K?K[ce]:"",{validators:[c.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),c.k0.min(0),c.k0.max(this.questions[me].essMaxPoint??0)]})}this.form=new c.gE(Ge),this.form.valueChanges.subscribe(me=>{let G=JSON.stringify(me);G!=this.prevData&&(this.prevData=G,this.form.patchValue(me))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(Ge,K,ce,me,G){super(),this.permissionService=Ge,this.cdnService=K,this.envService=ce,this.examResultService=me,this.apiUploadService=G,this.orgExamObjs=[],this.questions=[],this.files=[],this.userAnswersObj={},this.resultID=0,this.whiteListMNoteIframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new d.bkB,this.followerRenderQuest=new C.e,this.form=new c.gE({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=F=>{"MNoteJson"==F.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=F.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==F.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(Xe=pt).\u0275fac=function(Ge){return new(Ge||Xe)(d.rXU(y.p),d.rXU(oe.B),d.rXU(z.t),d.rXU(O._),d.rXU(k.T))},Xe.\u0275cmp=d.VBU({type:Xe,selectors:[["azt-mark-essay"]],viewQuery:function(Ge,K){if(1&Ge&&d.GBs(_e,5),2&Ge){let ce;d.mGM(ce=d.lsd())&&(K.mnoteContainer=ce.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",examResultObj:"examResultObj",userAnswersObj:"userAnswersObj",resultID:"resultID",whiteListMNoteIframeSrc:"whiteListMNoteIframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode"},outputs:{saveResultEvent:"saveResultEvent"},features:[d.Vt3],decls:12,vars:12,consts:[["mnoteContainer",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(Ge,K){1&Ge&&(d.j41(0,"div",1)(1,"form",2),d.DNE(2,se,14,30,"div",3),d.k0s(),d.DNE(3,ee,5,6,"div",4),d.k0s(),d.j41(4,"div",5),d.DNE(5,xe,5,5,"div",6),d.k0s(),d.DNE(6,mt,6,6,"div",7),d.j41(7,"div",8,0),d.nrm(9,"iframe",9),d.nI1(10,"safe"),d.k0s(),d.DNE(11,rt,5,6,"div",10)),2&Ge&&(d.R7$(),d.Y8G("formGroup",K.form),d.R7$(),d.Y8G("ngForOf",K.questions),d.R7$(),d.Y8G("ngIf",K.showForTeacher),d.R7$(2),d.Y8G("ngForOf",K.questions),d.R7$(),d.Y8G("ngIf",K.files&&0==K.files.length),d.R7$(),d.Y8G("ngStyle",d.eq3(10,le,K.files&&0==K.files.length?"none":"block")),d.R7$(2),d.Y8G("src",d.bMT(10,8,K.whiteListMNoteIframeSrc),d.f$h),d.R7$(2),d.Y8G("ngIf",K.showForTeacher))},dependencies:[q.YU,q.Sq,q.bT,q.B3,D.oV,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,Ie.WGl,J.Z,V.t,w.x,U.o,de.wp,de.JI],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),pt})()},74225:function(yt,ke,v){var l=this&&this.__awaiter||function(x,C,re,y){return new(re||(re=Promise))(function(z,O){function k(Ie){try{D(y.next(Ie))}catch(J){O(J)}}function q(Ie){try{D(y.throw(Ie))}catch(J){O(J)}}function D(Ie){Ie.done?z(Ie.value):function oe(z){return z instanceof re?z:new re(function(O){O(z)})}(Ie.value).then(k,q)}D((y=y.apply(x,C||[])).next())})};Object.defineProperty(ke,"__esModule",{value:!0}),ke.decodeScanOfflineFile=ke.decode=void 0;const d=v(6178);ke.decode=function c(x){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decode(x)})},ke.decodeScanOfflineFile=function m(x){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decodeScanOfflineFile(x)})}},25028:(yt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.AzotaFile=ke.FileType=void 0;const l=v(56784),d=v(70073);class c{}ke.FileType=c,c.scanOffline="scanOffline";class m{constructor(){}static fromZipFolder(C){let re=new m;return re.folder=C,re.readAztMain(),re}readAztMain(){let C=this.folder.getUtf8Text("main.json");if(null==C)throw new l.InvalidAztFileException("Couldn't found main.json file");this.aztMain=d.AztMain.fromJsonString(C)}}ke.AzotaFile=m},6178:function(yt,ke,v){var l=this&&this.__awaiter||function(C,re,y,oe){return new(y||(y=Promise))(function(O,k){function q(J){try{Ie(oe.next(J))}catch(V){k(V)}}function D(J){try{Ie(oe.throw(J))}catch(V){k(V)}}function Ie(J){J.done?O(J.value):function z(O){return O instanceof y?O:new y(function(k){k(O)})}(J.value).then(q,D)}Ie((oe=oe.apply(C,re||[])).next())})};Object.defineProperty(ke,"__esModule",{value:!0}),ke.AzotaFileDecode=void 0;const d=v(59985),c=v(25589),m=v(25028);class x{static decode(re){return l(this,void 0,void 0,function*(){return d.ZipFolder.fromZip(re).then(y=>{let oe=m.AzotaFile.fromZipFolder(y);return oe.aztMain.fileType==m.FileType.scanOffline?c.ScanOfflineFile.fromZipFolder(oe.folder):oe})})}static decodeScanOfflineFile(re){return x.decode(re).then(y=>y)}}ke.AzotaFileDecode=x},70073:(yt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.AztMain=void 0;const l=v(37182);class d{static fromJsonString(m){return d.fromJson(JSON.parse(m))}static fromJson(m){return(0,l.plainToInstance)(d,m)}}ke.AztMain=d},56784:(yt,ke)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.InvalidAztFileException=void 0;class v extends Error{constructor(d){super(d)}}ke.InvalidAztFileException=v},81163:(yt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.Point2d=ke.DrawingRectangle=ke.DrawingCircle=ke.AnswerRegionResult=ke.StudentCodeRegionResult=ke.ExamCodeRegionResult=ke.ScanOfflineResult=ke.ScanOfflineData=void 0;const l=v(37182);class d{static fromJsonString(O){return d.fromJson(JSON.parse(O))}static fromJson(O){return(0,l.plainToInstance)(d,O)}}ke.ScanOfflineData=d,ke.ScanOfflineResult=class c{},ke.ExamCodeRegionResult=class m{},ke.StudentCodeRegionResult=class x{},ke.AnswerRegionResult=class C{},ke.DrawingCircle=class re{},ke.DrawingRectangle=class y{},ke.Point2d=class oe{}},25589:(yt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.ScanOfflineFile=void 0;const l=v(25028),d=v(56784),c=v(81163);class m extends l.AzotaFile{constructor(){super()}static fromZipFolder(C){let re=new m;if(re.folder=C,re.readAztMain(),re.aztMain.fileType!=l.FileType.scanOffline)throw new d.InvalidAztFileException(`fileType must be ${l.FileType.scanOffline}`);let oe=C.getUtf8Text(re.aztMain.detailPath);if(null==oe)throw new d.InvalidAztFileException(`Couldn't found ${oe} file`);return re.scanOfflineData=c.ScanOfflineData.fromJsonString(oe),re}getWrappedImage(){var C,re;return null==(null===(re=null===(C=this.scanOfflineData)||void 0===C?void 0:C.scanResult)||void 0===re?void 0:re.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getWrappedImageExtension(){var C,re;let y=null===(re=null===(C=this.scanOfflineData)||void 0===C?void 0:C.scanResult)||void 0===re?void 0:re.wrappedScanFilePath;return null==y?null:y.substring(y.lastIndexOf("."))}}ke.ScanOfflineFile=m},59985:function(yt,ke,v){var l=this&&this.__awaiter||function(m,x,C,re){return new(C||(C=Promise))(function(oe,z){function O(D){try{q(re.next(D))}catch(Ie){z(Ie)}}function k(D){try{q(re.throw(D))}catch(Ie){z(Ie)}}function q(D){D.done?oe(D.value):function y(oe){return oe instanceof C?oe:new C(function(z){z(oe)})}(D.value).then(O,k)}q((re=re.apply(m,x||[])).next())})};Object.defineProperty(ke,"__esModule",{value:!0}),ke.ZipFolder=void 0;const d=v(91478);class c{constructor(x){this.files=new Map,x.forEach((C,re)=>{this.files.set(re,C)})}static fromZip(x){return l(this,void 0,void 0,function*(){let re=yield(new d).loadAsync(x).then(y=>{const oe=[];return y.forEach(function(z){let O=y.file(z);O&&oe.push(O.async("uint8array").then(k=>({path:z,data:k})))}),oe});return Promise.all(re).then(y=>{let oe=new Map;return y.forEach(z=>{oe.set(z.path,z.data)}),new c(oe)})})}setBinary(x,C){this.files.set(x,C)}setUtf8Text(x,C){let re=(new TextEncoder).encode(C);this.files.set(x,re)}getBinary(x){var C;return null!==(C=this.files.get(x))&&void 0!==C?C:null}getUtf8Text(x){let C=this.files.get(x);return null===C?null:(new TextDecoder).decode(C)}toDocx(){return l(this,void 0,void 0,function*(){const x=new d;for(let[C,re]of Array.from(this.files))x.file(C,re,{binary:!0});return x.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return l(this,void 0,void 0,function*(){const x=new d;for(let[C,re]of Array.from(this.files))x.file(C,re,{binary:!0});return x.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}ke.ZipFolder=c}}]);