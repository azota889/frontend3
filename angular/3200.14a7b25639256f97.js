"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[3200],{19127:(I,C,o)=>{o.d(C,{K:()=>D});var s=o(65879),A=o(37734),_=o(61713);let T=(()=>{class c extends A.Q{constructor(){super(...arguments),this.limitSize=200,this.selectFile=u=>{const p=u.target,f=p.files;if(f){if(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(f).find(z=>(0,_.EO)(z.size)>=this.limitSize))return this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB"));const t=[];Array.from(f).forEach(z=>{t.push(z)}),this.emitUploadToEditorComplete(t)}p.value=""}}}return c.\u0275fac=function(){let m;return function(p){return(m||(m=s.n5z(c)))(p||c)}}(),c.\u0275cmp=s.Xpm({type:c,selectors:[["ng-component"]],inputs:{fileType:"fileType",limitSize:"limitSize"},features:[s.qOj],decls:0,vars:0,template:function(u,p){},encapsulation:2}),c})();var v=o(56223),x=o(7827);const b=["*"];let D=(()=>{class c extends T{constructor(){super(...arguments),this.emitFiles=new s.vpe}emitUploadToEditorComplete(u){u.length>0&&this.emitFiles.emit(u[0])}onDrop(u){try{this.emitFiles.emit(u[0])}catch(p){alert(p)}}}return c.\u0275fac=function(){let m;return function(p){return(m||(m=s.n5z(c)))(p||c)}}(),c.\u0275cmp=s.Xpm({type:c,selectors:[["azt-upload-single-document-to-editor"]],outputs:{emitFiles:"emitFiles"},features:[s.qOj],ngContentSelectors:b,decls:5,vars:2,consts:[[1,"upload-document","h-full",3,"appDropZone","click"],[3,"hidden"],["type","file",1,"form-control","file-input",3,"accept","change"],["fileSelect",""]],template:function(u,p){if(1&u){const f=s.EpF();s.F$t(),s.TgZ(0,"div",0),s.NdJ("appDropZone",function(t){return p.onDrop(t)})("click",function(){s.CHM(f);const t=s.MAs(3);return s.KtG(t.click())}),s.TgZ(1,"form",1)(2,"input",2,3),s.NdJ("change",function(t){return p.selectFile(t)}),s.qZA()(),s.Hsn(4),s.qZA()}2&u&&(s.xp6(1),s.Q6J("hidden",!0),s.xp6(1),s.s9C("accept",p.fileType))},dependencies:[v._Y,v.JL,v.F,x.i],encapsulation:2}),c})()},83200:(I,C,o)=>{o.r(C),o.d(C,{AzotaDigitalizeModule:()=>rt});var s=o(96814),A=o(56223),_=o(12044),T=o(42753),v=o(37722),x=o(60381),b=o(95545),D=o(56731),c=o(84155),m=o(78217),u=o(24090),p=o(20553),f=o(82481),d=o(37734),t=o(65879),z=o(43389),E=o(98129),Z=o(49671),y=o(63120),B=o(77757),U=o(2459),F=o(9769),J=o(26306),M=o(22096),P=o(69732),S=o(79360);const Q=(e,l)=>(e.push(l),e);let N=(()=>{class e{processObservables(i,n){return(0,U.D)(n).pipe((0,F.z)(a=>a.pipe((0,J.K)(r=>(console.error("Error in observable:",r),(0,M.of)(null)))),i),function k(){return(0,S.e)((e,l)=>{(function w(e,l){return(0,S.e)((0,P.U)(e,l,arguments.length>=2,!1,!0))})(Q,[])(e).subscribe(l)})}())}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var L=o(84672),R=o(19127),j=o(36727);function Y(e,l){if(1&e&&t._UZ(0,"azt-loading-effect",2),2&e){const i=t.oxw();t.Q6J("currentStatusObj",i.statusObj)}}const K=function(e){return[e]};function H(e,l){if(1&e){const i=t.EpF();t.TgZ(0,"azt-upload-single-document-to-editor",3),t.NdJ("emitFiles",function(a){t.CHM(i);const r=t.oxw();return t.KtG(r.handleUploadComplete(a))}),t.TgZ(1,"a",4),t.O4$(),t.TgZ(2,"svg",5),t._UZ(3,"line",6)(4,"line",7),t.qZA(),t.kcU(),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"mytranslate"),t.qZA()()()}if(2&e){const i=t.oxw();t.Q6J("fileType",t.VKq(4,K,i.allUploadFileTypes.PDF)),t.xp6(6),t.Oqu(t.lcZ(7,2,"lang_digitalize_book_upload_pdf_file"))}}let G=(()=>{class e extends d.Q{handleUploadComplete(i){this.initStatusObj(),this.convertAllPdfToImages(i).then(n=>{let a=[];n.forEach(r=>{let h=this.apiUploadService.commonUploadFile(this.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE,r,"");a.push(h)}),this.sAztConcurrencyApiService.processObservables(this.uploadThread,a).subscribe(r=>{if(r.find(O=>!O?.success))return this.errorStatusObj("lang_digitalize_book_upload_file_error",!0);let g=r.map(O=>O?.data).filter(this.commonService.notEmpty);this.uploadData.emit(g)})})}convertAllPdfToImages(i){var n=this;return new Promise(function(){var a=(0,Z.Z)(function*(r,h){let g=[];try{let ct=yield n.withTimeout(n.myPdfService.getImageWithPdf(i),1e4);g.push(...ct)}catch{return n.showErrorSnack("lang_azt_pdf_invalid_format"),void r([])}r(g)});return function(r,h){return a.apply(this,arguments)}}())}withTimeout(i,n){return new Promise((a,r)=>{const h=setTimeout(()=>{r(new Error("Operation timed out"))},n);i.then(g=>{clearTimeout(h),a(g)}).catch(g=>{clearTimeout(h),r(g)})})}ngOnInit(){super.ngOnInit()}constructor(i,n,a){super(),this.myPdfService=i,this.sAztConcurrencyApiService=n,this.apiUploadService=a,this.uploadData=new t.vpe,this.allUploadToCdnMenuTypes=y.j6,this.allUploadFileTypes=y.AZ,this.uploadThread=10}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(B.z),t.Y36(N),t.Y36(L.W))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-digitalize-pdf-to-images"]],outputs:{uploadData:"uploadData"},features:[t.qOj],decls:3,vars:2,consts:[[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[3,"fileType","emitFiles"],[1,"btn","btn-sm","btn-primary-soft","w-full"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"]],template:function(i,n){if(1&i&&(t.YNc(0,Y,1,1,"azt-loading-effect",0),t.YNc(1,H,8,6,"ng-template",null,1,t.W1O)),2&i){const a=t.MAs(2);t.Q6J("ngIf",n.statusObj.loading)("ngIfElse",a)}},dependencies:[s.O5,z.l,R.K,j.JV],encapsulation:2}),e})(),X=(()=>{class e extends d.Q{ngOnInit(){super.ngOnInit()}constructor(){super(),this.nextEvent=new t.vpe,this.previousEvent=new t.vpe}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-digitalize-list-images"]],inputs:{objs:"objs",currentObj:"currentObj"},outputs:{nextEvent:"nextEvent",previousEvent:"previousEvent"},features:[t.qOj],decls:10,vars:9,consts:[[1,"text-center"],[1,"clickable","link-color",3,"click"],[1,"box","pt-2"],[1,"w-full",3,"src"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"span",1),t.NdJ("click",function(){return n.previousEvent.emit()}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t._uU(4," | "),t.TgZ(5,"span",1),t.NdJ("click",function(){return n.nextEvent.emit()}),t._uU(6),t.ALo(7,"mytranslate"),t.qZA()(),t.TgZ(8,"div",2),t._UZ(9,"img",3),t.qZA()),2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,5,"lang_digitalize_book_previous")),t.xp6(4),t.lnq("",t.lcZ(7,7,"lang_digitalize_book_next")," | (",n.currentObj.position," / ",n.objs.length,")"),t.xp6(3),t.Q6J("src",n.currentObj.image.url,t.LSH))},dependencies:[j.JV],encapsulation:2}),e})();var V=o(9e4);function W(e,l){if(1&e&&t._UZ(0,"azt-loading-effect",2),2&e){const i=t.oxw();t.Q6J("currentStatusObj",i.statusObj)}}function $(e,l){if(1&e&&(t._UZ(0,"div",3),t.ALo(1,"safeSuperAdminHtmlContent")),2&e){const i=t.oxw();t.Q6J("innerHTML",t.lcZ(1,1,i.obj.htmlResult),t.oJD)}}let q=(()=>{class e extends d.Q{constructor(){super(...arguments),this.changeObj=new t.vpe,this.ocrService=(0,t.f3M)(V.Kx)}digitalizeData(){this.obj.image.url&&(this.initStatusObj(),this.waitDestroy(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:this.obj.image.url}).subscribe({next:i=>{this.obj.htmlResult=i.data,this.obj.isProcessed=!0,this.changeObj.emit(this.obj),this.stopStatusObj()},error:i=>this.errorStatusObj(i.error.message,!0)})))}ngOnChanges(){this.obj.isProcessed||this.digitalizeData()}}return e.\u0275fac=function(){let l;return function(n){return(l||(l=t.n5z(e)))(n||e)}}(),e.\u0275cmp=t.Xpm({type:e,selectors:[["app-digitalize-preview-result"]],inputs:{obj:"obj"},outputs:{changeObj:"changeObj"},features:[t.qOj,t.TTD],decls:3,vars:2,consts:[[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[3,"innerHTML"]],template:function(i,n){if(1&i&&(t.YNc(0,W,1,1,"azt-loading-effect",0),t.YNc(1,$,2,3,"ng-template",null,1,t.W1O)),2&i){const a=t.MAs(2);t.Q6J("ngIf",n.statusObj.loading)("ngIfElse",a)}},dependencies:[s.O5,z.l,j.i9],encapsulation:2}),e})();function tt(e,l){if(1&e&&t._UZ(0,"azt-loading-effect",4),2&e){const i=t.oxw();t.Q6J("currentStatusObj",i.statusObj)}}function et(e,l){if(1&e){const i=t.EpF();t.TgZ(0,"app-digitalize-pdf-to-images",13),t.NdJ("uploadData",function(a){t.CHM(i);const r=t.oxw(2);return t.KtG(r.uploadData(a))}),t.qZA()}}function it(e,l){if(1&e){const i=t.EpF();t.TgZ(0,"app-digitalize-list-images",14),t.NdJ("nextEvent",function(){t.CHM(i);const a=t.oxw(2);return t.KtG(a.nextImage())})("previousEvent",function(){t.CHM(i);const a=t.oxw(2);return t.KtG(a.previousImage())}),t.qZA()}if(2&e){const i=t.oxw(2);t.Q6J("objs",i.objs)("currentObj",i.curObj)}}function nt(e,l){if(1&e){const i=t.EpF();t.TgZ(0,"app-digitalize-preview-result",15),t.NdJ("changeObj",function(a){t.CHM(i);const r=t.oxw(2);return t.KtG(r.changeObj(a))}),t.qZA()}if(2&e){const i=t.oxw(2);t.Q6J("obj",i.curObj)}}function ot(e,l){1&e&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_digitalize_book_please_upload_file")))}function at(e,l){if(1&e&&(t.TgZ(0,"div",5)(1,"div",6)(2,"div",7),t.YNc(3,et,1,0,"app-digitalize-pdf-to-images",8),t.YNc(4,it,1,2,"app-digitalize-list-images",9),t.qZA()(),t.TgZ(5,"div",10)(6,"div",7),t.YNc(7,nt,1,1,"app-digitalize-preview-result",11),t.YNc(8,ot,3,3,"p",12),t.qZA()()()),2&e){const i=t.oxw();t.xp6(3),t.Q6J("ngIf",i.objs.length<=0),t.xp6(1),t.Q6J("ngIf",i.objs.length>0&&i.curObj),t.xp6(3),t.Q6J("ngIf",i.curObj),t.xp6(1),t.Q6J("ngIf",!i.curObj)}}const lt=[{path:"",children:[{path:"digitalize-book",component:(()=>{class e extends d.Q{nextImage(){let i=this.objs.findIndex(a=>a.image.url==this.curObj?.image.url),n=this.commonService.getItemAtIndexOfArray(this.objs,i+1);null!=n&&(this.curObj=n)}previousImage(){let i=this.objs.findIndex(a=>a.image.url==this.curObj?.image.url),n=this.commonService.getItemAtIndexOfArray(this.objs,i-1);null!=n&&(this.curObj=n)}changeObj(i){let n=this.objs.find(a=>a.position==i.position);n&&(n={...i})}uploadData(i){this.objs=i.map((n,a)=>({image:n,htmlResult:"",isProcessed:!1,position:a+1})),this.curObj=this.commonService.getFirstOfArray(this.objs)}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_book",description:"lang_cms_admin_common_digitalize_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(){super(),this.headerBackTo="",this.objs=[]}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-digitalize-book"]],features:[t.qOj],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-3"],[1,"box","p-3"],[3,"uploadData",4,"ngIf"],[3,"objs","currentObj","nextEvent","previousEvent",4,"ngIf"],[1,"col-span-9"],[3,"obj","changeObj",4,"ngIf"],[4,"ngIf"],[3,"uploadData"],[3,"objs","currentObj","nextEvent","previousEvent"],[3,"obj","changeObj"]],template:function(i,n){if(1&i&&(t.TgZ(0,"teacher-layout",0)(1,"div",1),t.YNc(2,tt,1,1,"azt-loading-effect",2),t.YNc(3,at,9,4,"ng-template",null,3,t.W1O),t.qZA()()),2&i){const a=t.MAs(4);t.Q6J("headerBackToLink",n.headerBackTo),t.xp6(2),t.Q6J("ngIf",n.statusObj.loading)("ngIfElse",a)}},dependencies:[s.O5,z.l,E._,G,X,q,j.JV],encapsulation:2}),e})()}]}];let st=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[_.Bz.forChild(lt),_.Bz,f.fQ]}),e})(),rt=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[{provide:T.f8,useValue:p.N.azt_tiny_mce_script_src}],imports:[_.Bz,s.ez,A.u5,T.Z_,D.j,A.UX,st,u.W,c.Z,b.kb,m.d,v.qyJ.pick(v.ciZ),x.l1]}),e})()}}]);