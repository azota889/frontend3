(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6295],{86066:(T,O,r)=>{"use strict";r.r(O),r.d(O,{HomeworkModule:()=>mt});var w=r(54460),l=r(10936),x=r(89163),v=r(65162),n=r(69223),m=r(15343),k=r(13763),f=r(5502),j=r(46584),u=r(70050),_=r(7050),D=r(76407),y=r(91100),M=r(43234),B=r(1133),A=r(50866),E=r(81519),H=r(34514),P=r(47426),R=r(76627),de=r(99503),he=r(79347),ue=r(38009),J=r(9691),F=r(59640),pe=r(80037),ge=r(15766),fe=r(53043),$=r(39712),e=r(26860),X=r(70254),L=r(46899),N=r(46134),z=r(51113),ke=r(36484),be=r(3780),_e=r(88089),ve=r(9280),Y=r(39471),we=r(97839),W=r(74960),K=r(18718),Q=r(81587),ye=r(27985),je=r(63349),Se=r(96451),C=r(73437);const xe=["startTime"],Me=["endTime"];function De(o,S){if(1&o&&e.nrm(0,"azt-loading-effect",3),2&o){const t=e.XpG();e.Y8G("currentStatusObj",t.statusObj)}}function Ie(o,S){1&o&&(e.j41(0,"div",73),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&o&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"lang_auto_vui_long_nhap_ten_bai_tap")," "))}function Oe(o,S){1&o&&(e.j41(0,"div",74),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&o&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"lang_testbank_test_config_end_time_bigger_time_star"),". "))}function Ee(o,S){if(1&o){const t=e.RV6();e.j41(0,"div",75)(1,"button",76),e.bIt("click",function(){const s=e.eBV(t).index,h=e.XpG(2);return e.Njj(!!h.formHomework.files&&h.formHomework.files.splice(s,1))}),e.nrm(2,"lucide-icon",77),e.k0s(),e.j41(3,"a",78),e.bIt("click",function(){const s=e.eBV(t).$implicit,h=e.XpG(2);return e.Njj(h.onShowFile(s,-1))}),e.j41(4,"span",79),e.EFF(5),e.k0s()()()}if(2&o){const t=S.$implicit;e.R7$(4),e.Y8G("title",t.name),e.R7$(1),e.JRh(t.name)}}const Z=function(){return{"mr-2":!0}},Ce=function(o){return[o]},Te=function(){return{standalone:!0}};function Re(o,S){if(1&o){const t=e.RV6();e.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"h3",8),e.EFF(5),e.nI1(6,"mytranslate"),e.k0s(),e.j41(7,"div",9)(8,"div",10)(9,"div",11)(10,"label",12),e.EFF(11),e.nI1(12,"mytranslate"),e.k0s()(),e.j41(13,"div",11)(14,"div",13),e.nrm(15,"input",14),e.nI1(16,"mytranslate"),e.k0s(),e.DNE(17,Ie,3,3,"div",15),e.k0s()(),e.j41(18,"div",16)(19,"div",17)(20,"label",18),e.EFF(21),e.nI1(22,"mytranslate"),e.k0s()(),e.j41(23,"div",17)(24,"div",19)(25,"div",20)(26,"mat-form-field",21)(27,"input",22),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openDateTimePicker(1))}),e.nI1(28,"mytranslate"),e.k0s(),e.j41(29,"button",23),e.bIt("click",function(i){return e.eBV(t),e.XpG().openDateTimePicker(1),e.Njj(i.stopPropagation())}),e.nrm(30,"lucide-icon",24),e.k0s(),e.j41(31,"ngx-mat-datetime-picker",25,26)(33,"ngx-mat-datepicker-actions")(34,"button",27),e.EFF(35),e.nI1(36,"mytranslate"),e.k0s(),e.j41(37,"button",28),e.EFF(38,"OK"),e.k0s()()()()(),e.j41(39,"div",20)(40,"mat-form-field",21)(41,"input",29),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openDateTimePicker(0))}),e.nI1(42,"mytranslate"),e.k0s(),e.j41(43,"button",30),e.bIt("click",function(i){return e.eBV(t),e.XpG().openDateTimePicker(0),e.Njj(i.stopPropagation())}),e.nrm(44,"lucide-icon",24),e.k0s(),e.j41(45,"ngx-mat-datetime-picker",25,31)(47,"ngx-mat-datepicker-actions")(48,"button",27),e.EFF(49),e.nI1(50,"mytranslate"),e.k0s(),e.j41(51,"button",28),e.EFF(52,"OK"),e.k0s()()()()(),e.j41(53,"div",32)(54,"button",33),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.clearTime())}),e.nrm(55,"lucide-icon",34),e.EFF(56),e.nI1(57,"mytranslate"),e.k0s()()(),e.j41(58,"div",35)(59,"div",36),e.EFF(60),e.nI1(61,"mytranslate"),e.k0s(),e.DNE(62,Oe,3,3,"div",37),e.k0s()()(),e.j41(63,"div",38)(64,"div",11)(65,"h3",39),e.EFF(66),e.nI1(67,"mytranslate"),e.k0s()(),e.j41(68,"div",40)(69,"azt-upload-multiple-box",41),e.bIt("uploadComplete",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.handleUploadComplete(i))}),e.j41(70,"a",42),e.nrm(71,"lucide-icon",43),e.j41(72,"span"),e.EFF(73),e.nI1(74,"mytranslate"),e.k0s()()(),e.j41(75,"div",44),e.EFF(76),e.nI1(77,"mytranslate"),e.k0s(),e.DNE(78,Ee,6,2,"div",45),e.j41(79,"editor",46),e.bIt("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.formHomework.content=i)}),e.k0s()()(),e.j41(80,"div",47)(81,"div",48)(82,"label",49),e.EFF(83),e.nI1(84,"mytranslate"),e.k0s()(),e.j41(85,"div",50)(86,"div",51)(87,"div",52),e.nrm(88,"input",53),e.j41(89,"label",54),e.EFF(90),e.nI1(91,"mytranslate"),e.k0s()(),e.j41(92,"div",55),e.nrm(93,"input",56),e.j41(94,"label",57),e.EFF(95),e.nI1(96,"mytranslate"),e.k0s()()()()(),e.j41(97,"div",58)(98,"div",48)(99,"label",49),e.EFF(100),e.nI1(101,"mytranslate"),e.k0s()(),e.j41(102,"div",50)(103,"div",51)(104,"div",52),e.nrm(105,"input",59),e.j41(106,"label",60),e.EFF(107),e.nI1(108,"mytranslate"),e.k0s()(),e.j41(109,"div",55),e.nrm(110,"input",61),e.j41(111,"label",62),e.EFF(112),e.nI1(113,"mytranslate"),e.k0s()()()()(),e.j41(114,"div",63)(115,"div",64)(116,"div",65),e.EFF(117),e.nI1(118,"mytranslate"),e.k0s()(),e.j41(119,"div",66)(120,"div",67),e.nrm(121,"azt-list-classroom-checkbox",68),e.k0s()()()(),e.j41(122,"div",69)(123,"div",70)(124,"button",71),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.saveHomework(0))}),e.EFF(125),e.nI1(126,"mytranslate"),e.k0s(),e.j41(127,"button",72),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.saveHomework(1))}),e.EFF(128),e.nI1(129,"mytranslate"),e.k0s()()()()()()()}if(2&o){const t=e.sdS(32),a=e.sdS(46),i=e.XpG();e.R7$(1),e.Y8G("formGroup",i.form),e.R7$(4),e.SpI(" ",e.bMT(6,46,"lang_auto_tao_bai_tap_moi")," "),e.R7$(6),e.SpI(" ",e.bMT(12,48,"lang_auto_ten")," "),e.R7$(4),e.FS9("placeholder",e.bMT(16,50,"lang_auto_nhap_ten")+" ..."),e.R7$(2),e.Y8G("ngIf",i.form.controls.homeworkName.errors),e.R7$(4),e.SpI(" ",e.bMT(22,52,"lang_testbank_test_config_time_assigne_homework")," "),e.R7$(6),e.FS9("placeholder",e.bMT(28,54,"lang_auto_tu")),e.Y8G("max",i.maxDate)("ngxMatDatetimePicker",t),e.R7$(4),e.Y8G("touchUi",!0),e.R7$(4),e.JRh(e.bMT(36,56,"lang_auto_dong")),e.R7$(6),e.FS9("placeholder",e.bMT(42,58,"lang_auto_den")),e.Y8G("max",i.maxDate)("ngxMatDatetimePicker",a),e.R7$(4),e.Y8G("touchUi",!0),e.R7$(4),e.JRh(e.bMT(50,60,"lang_auto_dong")),e.R7$(6),e.Y8G("ngClass",e.lJ4(90,Z)),e.R7$(1),e.SpI(" ",e.bMT(57,62,"lang_auto_dat_lai")," "),e.R7$(4),e.SpI("",e.bMT(61,64,"lang_auto_bo_trong_neu_khong_muon_gioi_han_thoi_gian"),"."),e.R7$(2),e.Y8G("ngIf",i.calculatorTimeValidate(i.form.controls.homeworkDeadline.value,i.form.controls.homeworkStartDate.value)<=0),e.R7$(4),e.SpI(" ",e.bMT(67,66,"lang_auto_noi_dung")," "),e.R7$(3),e.Y8G("uploadToCdnMenu",i.allUploadToCdnMenuTypes.HOMEWORK)("fileType",e.eq3(91,Ce,i.allUploadFileTypes.SYNTHETIC))("notSupportedFile",i.notSupportedFile.WMV),e.R7$(2),e.Y8G("ngClass",e.lJ4(93,Z)),e.R7$(2),e.JRh(e.bMT(74,68,"lang_homework_add_home_work_add_file_homework")),e.R7$(3),e.JRh(e.bMT(77,70,"lang_cms_add_homework_input_file")),e.R7$(2),e.Y8G("ngForOf",i.formHomework.files),e.R7$(1),e.FS9("apiKey",i.tinyEditorKey),e.Y8G("ngModel",i.formHomework.content)("ngModelOptions",e.lJ4(94,Te))("init",i.initDataEditor),e.R7$(4),e.SpI(" ",e.bMT(84,72,"lang_auto_cho_xem_ket_qua")," "),e.R7$(7),e.SpI(" ",e.bMT(91,74,"lang_auto_khong")," "),e.R7$(5),e.SpI(" ",e.bMT(96,76,"lang_auto_co")," "),e.R7$(5),e.SpI(" ",e.bMT(101,78,"lang_auto_dang_nhap_de_nop_bai")," "),e.R7$(7),e.SpI(" ",e.bMT(108,80,"lang_auto_khong")," "),e.R7$(5),e.SpI(" ",e.bMT(113,82,"lang_auto_co")," "),e.R7$(5),e.SpI(" ",e.bMT(118,84,"lang_auto_giao_cho_lop")," "),e.R7$(4),e.Y8G("form",i.form)("classroomGroupData",i.classroomWithGroup)("permissionName",i.permissionTypes.homework),e.R7$(3),e.Y8G("disabled",i.form.invalid||i.checkDeadLineValid(i.form.controls.homeworkStartDate.value,i.form.controls.homeworkDeadline.value)<=0),e.R7$(1),e.SpI(" ",e.bMT(126,86,"lang_auto_luu_nhap")," "),e.R7$(2),e.Y8G("disabled",i.form.invalid||i.checkDeadLineValid(i.form.controls.homeworkStartDate.value,i.form.controls.homeworkDeadline.value)<=0),e.R7$(1),e.SpI(" ",e.bMT(129,88,"lang_auto_xuat_ban")," ")}}let Ne=(()=>{class o extends F.H{clearTime(){this.form.controls.homeworkDeadline.setValue(""),this.form.controls.homeworkStartDate.setValue("")}checkDeadLineValid(t,a){return""!=t&&""!=a?this.timeService.getDiffFromTwoDateWithZeroSecond(a,t):1}calculatorTimeValidate(t,a){return""!=t&&""!=a?this.timeService.calculationHomeworkTimeWithZeroSecond(t,a):1}handleUploadComplete(t){this.formHomework.files?.push(...t)}onShowFile(t,a){let i={...t,index:a};this.sAztDialogService.open(fe.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:i},restoreFocus:!1})}openDateTimePicker(t){1==t?this.startTime&&this.startTime.open():this.endTime&&this.endTime.open()}saveHomework(t){this.initStatusObj(),this.homeWorkContent=this.formHomework.content??"",this.uploadImageOfHomeworkService.replaceImageInContent(this.homeWorkContent).subscribe(a=>{null==a.errorMessage?(this.homeWorkContent=a.content,this.callApiToSaveHomework(t)):(this.showErrorSnack(a.errorMessage),this.stopStatusObj())})}callApiToSaveHomework(t){let a=this.form.getRawValue(),i=a.homeworkStartDate?this.timeService.formatDateTimeToPostToServer(a.homeworkStartDate):void 0,s=a.homeworkDeadline?this.timeService.formatDateTimeToPostToServer(a.homeworkDeadline):void 0,h="1"!=a.mustVerified?0:1,d="1"!=a.whenShowAnswer?0:1;this.homeWorkContent=this.zipDataService.convertContentGzip(this.homeWorkContent);let g=this.userService.getUserObj(),c=JSON.stringify({type:"homework",id:0,user:g.id});const p=this.sAztClassroomCheckboxService.getClassroomIdsCheckedInGroup(this.form.controls.classroomFormArray);let b={name:a.homeworkName,content:this.homeWorkContent,startDate:i,deadline:s,files:JSON.stringify(this.formHomework.files),mustVerified:h,whenShowAnswer:d,isPublished:t,categoryId:this.cateId?Number(this.cateId):void 0,classroomIds:p};this.waitDestroy(this.homeworkService.apiHomeworkSaveObjPost(c,b).subscribe(I=>{if(1==I.success){if(t){this.successStatusObj("lang_auto_xuat_ban_thanh_cong",!0);let me=[];if(I.data?.objs)for(let V=0;V<I.data.objs.length;V++)me.push(I.data?.objs[V].hashId);this.listIds=JSON.stringify(me),this.commonService.myNavigationWithQueryString("/admin/testbank/publish-document/1/"+(this.cateId??0)+"/"+this.listIds,"?backto="+encodeURIComponent(`/admin/homework/add-new-homework/${this.cateId??0}?backto=`+this.backToLink))}else this.commonService.myNavigation(this.backToLink?this.backToLink:"/admin/testbank/document-management/1/0/1"),this.successStatusObj("lang_auto_luu_thanh_cong_chua_xuat_ban",!0);this.successStatusObj()}else this.errorStatusObj(I.message??"",!0)}))}getHomework(){this.waitDestroy(this.documentConfigService.apiDocumentConfigGetHomeworkConfigDataV2Post("add_new",[]).subscribe(t=>{1==t.success?(this.classroomWithGroup=t.data?.classroomGroupObjs??[],this.successStatusObj()):this.errorStatusObj(t.message??"",!0)}))}ngOnChanges(){this.initDataEditor=this.sAztTinyMceService.initConfigForTeacher()}ngOnInit(){this.initStatusObj(),this.initDataEditor=this.sAztTinyMceService.initConfigForTeacher(),this.waitDestroy((0,R.z)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([])=>{this.backToLink=this.commonService.getMyQueryParam("backto")??"",this.cateId=this.commonService.getMyParam(this.activeRoute,"cat_id")??"",this.getHomework()})),this.commonService.translateMetaData({title:"lang_cms_homework_add_exercise_title",description:"lang_cms_homework_add_exercise_description",image:"lang_cms_test_image"})}constructor(t,a,i,s,h,d,g,c,p,b,I){super(),this.sAztTinyMceService=t,this.sAztDialogService=a,this.activeRoute=i,this.homeworkService=s,this.classroomService=h,this.zipDataService=d,this.timeService=g,this.userService=c,this.sAztClassroomCheckboxService=p,this.uploadImageOfHomeworkService=b,this.documentConfigService=I,this.permissionTypes=ue.t,this.tinyEditorKey=M.c.tinyEditorKey,this.formHomework={files:[],content:""},this.prevData="",this.cateId="",this.listIds="",this.backToLink="",this.homeWorkContent="",this.initDataEditor={},this.maxDate=M.c.maxDateTimePicker,this.allUploadToCdnMenuTypes=$.b8,this.allUploadFileTypes=$.PO,this.notSupportedFile=$.Ym,this.classroomWithGroup=[],this.form=new l.gE({homeworkName:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,l.k0.maxLength(180),ge.M.noWhiteSpace]}),homeworkStartDate:new l.MJ("",{nonNullable:!0}),homeworkDeadline:new l.MJ("",{nonNullable:!0}),mustVerified:new l.MJ("0",{nonNullable:!0}),whenShowAnswer:new l.MJ("0",{nonNullable:!0}),classroomFormArray:new l.Yp([]),whoAllow:new l.MJ(2,{nonNullable:!0})},{validators:[pe.j.classroomInGroupCheckBoxValidator]})}static#e=this.\u0275fac=function(a){return new(a||o)(e.rXU(X.f),e.rXU(L.i),e.rXU(v.nX),e.rXU(N.MY),e.rXU(N.zS),e.rXU(z.j),e.rXU(J.F),e.rXU(ke.R),e.rXU(be.Q),e.rXU(_e.J),e.rXU(ve.x_))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-add-home-work"]],viewQuery:function(a,i){if(1&a&&(e.GBs(xe,5),e.GBs(Me,5)),2&a){let s;e.mGM(s=e.lsd())&&(i.startTime=s.first),e.mGM(s=e.lsd())&&(i.endTime=s.first)}},features:[e.Jv_([{provide:E.$O,useClass:de.fb,deps:[P.Ju,H.ij]},{provide:E.vq,useFactory:he.Yw,deps:[J.F]}]),e.Vt3,e.OA$],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document","mx-auto",2,"max-width","1000px"],[1,"setting-basic"],[1,"text-md","uppercase","font-medium"],[1,"box","mt-2","p-5"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","homework-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","homework-name","formControlName","homeworkName","type","text",1,"form-control",3,"placeholder"],["class","text-xs text-danger mt-2",4,"ngIf"],["id","azt-config-time-assignment",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12"],["for","regular-form-1",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-5"],["appearance","outline"],["azt-track-service","add-home-work-2lcHTxnwVmR","matInput","","formControlName","homeworkStartDate","readonly","",3,"placeholder","max","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work-6MNUM1lV8t1","matSuffix","",2,"font-size","18px",3,"click"],["name","calendar-clock","size","16"],[3,"touchUi"],["startTime",""],["mat-raised-button","","color","secondary","ngxMatDatepickerCancel",""],["mat-raised-button","","color","primary","ngxMatDatepickerApply",""],["azt-track-service","add-home-work-ShSJ8gIBpK8","matInput","","formControlName","homeworkDeadline","readonly","",3,"placeholder","max","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work--BjU84v-g28","matSuffix","",2,"font-size","18px",3,"click"],["endTime",""],[1,"col-span-6","md:col-span-2"],["azt-track-service","add-home-work-NEdqGTKJIVb",1,"btn","btn-outline-secondary","w-full",3,"click"],["name","timer-reset","size","18",3,"ngClass"],[1,"text-xs","mt-2"],[1,"text-slate-500","mt-1"],["class","text-danger mt-1",4,"ngIf"],[1,"grid","grid-cols-12","mt-4"],[1,"text-md","font-medium"],[1,"col-span-12","lg:col-span-12","mt-3"],[2,"display","inline-block",3,"uploadToCdnMenu","fileType","notSupportedFile","uploadComplete"],["azt-track-service","add-home-work-4ML9tUkucGY",1,"btn","btn-sm","btn-primary-soft","mr-2"],["name","plus","size","16",3,"ngClass"],[1,"text-slate-600","text-xs","mt-2","mb-2"],["class","flex items-center mt-3 mb-3",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","apiKey","init","ngModelChange"],["id","azt-config-when-result",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["id","whenShowAnswer-off","type","radio","formControlName","whenShowAnswer","value","1",1,"form-check-input"],["for","whenShowAnswer-off",1,"form-check-label"],[1,"form-check","mr-8","mt-2","sm:mt-0"],["id","whenShowAnswer-tested","type","radio","formControlName","whenShowAnswer","value","0",1,"form-check-input"],["for","whenShowAnswer-tested",1,"form-check-label","flex","items-center"],["id","azt-config-login-require",1,"grid","grid-cols-12","mt-4"],["id","mustVerified-off","type","radio","formControlName","mustVerified","value","0",1,"form-check-input"],["for","mustVerified-off",1,"form-check-label"],["id","mustVerified-tested","type","radio","formControlName","mustVerified","value","1",1,"form-check-input"],["for","mustVerified-tested",1,"form-check-label","flex","items-center"],["id","azt-config-who-allow",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5","pr-5"],[1,"mb-0","font-medium","flex","items-center"],[1,"col-span-12","mt-4"],[1,"azt-list-classroom"],[3,"form","classroomGroupData","permissionName"],[1,"my-5"],[1,"text-right"],["azt-track-service","add-home-work-ZxDqD0KF4NR",1,"btn","btn-pending","w-24","mr-2",3,"disabled","click"],["azt-track-service","add-home-work-JgG_cpuccgD",1,"btn","w-24","btn-primary",3,"disabled","click"],[1,"text-xs","text-danger","mt-2"],[1,"text-danger","mt-1"],[1,"flex","items-center","mt-3","mb-3"],["azt-track-service","add-home-work-HeEXhrbob3P",1,"text-slate-600","mr-2",3,"click"],["name","x","size","16"],["azt-track-service","add-home-work-QFtSJlUphLG",3,"click"],[1,"text-slate-600",3,"title"]],template:function(a,i){if(1&a&&(e.j41(0,"teacher-layout",0),e.DNE(1,De,1,1,"azt-loading-effect",1),e.DNE(2,Re,130,95,"ng-template",null,2,e.C5r),e.k0s()),2&a){const s=e.sdS(3);e.Y8G("headerBackToLink",i.backToLink),e.R7$(1),e.Y8G("ngIf",1==i.statusObj.loading)("ngIfElse",s)}},dependencies:[w.YU,w.Sq,w.bT,Y.$z,we.fg,W.rl,W.yw,E.m7,E.yF,E.HF,E.gx,E.Uq,n.xn,l.qT,l.me,l.Fm,l.BC,l.cb,l.vS,l.j4,l.JD,K.K,Q.t,ye.D,je.V,Se.Q,m.WGl,C.wp],encapsulation:2})}return o})();var Pe=r(73014),G=r(27691),q=r(64198),U=r(83229),ee=r(33887),te=r(52811);let ie=(()=>{class o extends ee._{getData(){this.initStatusObj(),this.data.status?this.successStatusObj():this.stopStatusObj()}cleanResult(){var t=this.getFormValue(),a={homeworkHashId:this.data.itemHomework.hashId??"",id:this.data.ans_id,resendNote:t.reason};this.initStatusObj(),this.waitDestroy(this.answerService.apiAnswerResendAnswerPost(a).subscribe(i=>{1==i.success?(this.showSuccessSnack(this.commonService.myTranslateInstant("lang_send_request_must_resubmit_homework_with_reason")+": "+t.reason),this.result=!0,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.successStatusObj()):(this.showErrorSnack("lang_cms_send_request_error"),this.result=!1,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.errorStatusObj(i.message??""))}))}getFormValue(){return this.form.getRawValue()}ngOnInit(){this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"",this.getData(),super.ngOnInit()}constructor(t,a,i,s){super(s,t),this.dialogRef=t,this.answerService=a,this.activeRoute=i,this.data=s,this.result=!1,this.homeworkHashId="",this.form=new l.gE({reason:new l.MJ("",{nonNullable:!0,validators:[l.k0.required]})})}onNoClick(){this.dialogRef.close()}onSubmit(t){this.dialogRef.close(t)}static#e=this.\u0275fac=function(a){return new(a||o)(e.rXU(x.CP,8),e.rXU(N._t),e.rXU(v.nX),e.rXU(x.Vh,8))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["clean-result-dialog"]],features:[e.Vt3],decls:43,vars:31,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto","text-center"],[3,"hidden"],[1,"d-flex","justify-content-center"],[1,"sr-only","ml-2"],[1,"intro",3,"hidden"],["enctype","multipart/form-data",1,"form-horizontal","text-center",3,"formGroup"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger","text-center"],[1,"h5","mb-1"],[1,"text-danger"],[1,"h5","text-danger","mt-1","mb-1"],["type","text","id","reason","formControlName","reason",1,"form-control","mt-2"],[1,"text-right","mt-3"],["azt-track-service","clean-result-dialog-_f7PVI4E-S_",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","clean-result-dialog-xDCHUvnl-fJ",1,"btn","w-24","btn-primary",3,"click"]],template:function(a,i){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.EFF(5),e.nI1(6,"mytranslate"),e.k0s()(),e.nrm(7,"br"),e.j41(8,"div",5)(9,"div",6),e.nrm(10,"azt-loading-ui"),e.j41(11,"span",7),e.EFF(12,"..."),e.k0s()()(),e.j41(13,"div",8)(14,"form",9)(15,"div",10)(16,"p",11),e.EFF(17),e.nI1(18,"mytranslate"),e.k0s(),e.j41(19,"p",12),e.EFF(20),e.nI1(21,"mytranslate"),e.j41(22,"span",13),e.EFF(23),e.k0s(),e.EFF(24),e.nI1(25,"mytranslate"),e.j41(26,"span",13),e.EFF(27),e.nI1(28,"formatOnlyDateByUserUnitPipe"),e.k0s(),e.EFF(29),e.nI1(30,"mytranslate"),e.k0s(),e.nrm(31,"hr"),e.j41(32,"p",14),e.EFF(33),e.nI1(34,"mytranslate"),e.k0s(),e.nrm(35,"input",15),e.k0s()()(),e.j41(36,"div",16)(37,"button",17),e.bIt("click",function(){return i.onNoClick()}),e.EFF(38),e.nI1(39,"mytranslate"),e.k0s(),e.j41(40,"button",18),e.bIt("click",function(){return i.cleanResult()}),e.EFF(41),e.nI1(42,"mytranslate"),e.k0s()()()()()),2&a&&(e.R7$(5),e.JRh(e.bMT(6,13,"lang_homework_mark_exercise_utils_request_resubmit")),e.R7$(3),e.Y8G("hidden",!i.statusObj.loading),e.R7$(5),e.Y8G("hidden",i.statusObj.loading),e.R7$(1),e.Y8G("formGroup",i.form),e.R7$(3),e.SpI("(*) ",e.bMT(18,15,"lang_homework_mark_exercise_utils_note"),":"),e.R7$(3),e.SpI(" ",e.bMT(21,17,"lang_homework_mark_exercise_utils_request")," "),e.R7$(3),e.SpI(" ",i.data.name," "),e.R7$(1),e.SpI(" ",e.bMT(25,19,"lang_homework_mark_exercise_utils_in_homework"),"\xa0"),e.R7$(3),e.JRh(e.bMT(28,21,i.data.deadline?i.data.deadline:i.data.itemHomework.createdAt)),e.R7$(2),e.SpI("\xa0",e.bMT(30,23,"lang_homework_mark_exercise_utils_will_be_deleted"),"! "),e.R7$(4),e.JRh(e.bMT(34,25,"lang_homework_mark_exercise_utils_coment_request_resubmit")),e.R7$(5),e.SpI(" ",e.bMT(39,27,"lang_button_cancel")," "),e.R7$(3),e.SpI(" ",e.bMT(42,29,"lang_button_confirm")," "))},dependencies:[l.qT,l.me,l.BC,l.cb,l.j4,l.JD,Q.t,te.R,C.wp,C.vv],encapsulation:2})}return o})();var Fe=r(66729);const Ae=function(){return{"mr-1 text-success":!0}};let ae=(()=>{class o extends ee._{ngOnInit(){this.success=this.data.status}constructor(t,a,i){super(i,t),this.dialogRef=t,this.answerService=a,this.data=i,this.success=!1}checkNextAns(){this.dialogRef.close(),this.answerService.apiAnswerGetNextObjByHomeworkGet(this.data.homeworkHashId).subscribe(t=>{if(1==t.success)return this.commonService.myNavigationWithQueryString("/admin/homework/switch-mark-exercise/"+t.data?.obj?.id+"/"+this.data.homeworkHashId+"/0","?backto="+encodeURIComponent(this.data.backToLink)),void(window.location.href=this.commonService.getLocalRouter("/admin/homework/switch-mark-exercise/"+t.data?.obj?.id+"/"+this.data.homeworkHashId+"/0?backto="+encodeURIComponent(this.data.backToLink)));window.location.href=this.commonService.getLocalRouter("/admin/testbank/homework-results-list/"+this.data.classID+"/"+this.data.homeWorkID+"/"+this.data.homeworkHashId)})}onNoClick(){this.dialogRef.close()}static#e=this.\u0275fac=function(a){return new(a||o)(e.rXU(x.CP,8),e.rXU(N._t),e.rXU(x.Vh,8))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["notice-dialog"]],features:[e.Vt3],decls:21,vars:12,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto"],["name","circle-check","size","24",3,"ngClass"],[2,"color","red","font-size","120%","font-weight","500"],[3,"mark"],[1,"text-right","mt-3"],["azt-track-service","notice-dialog-YnLBVlTjw",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","notice-dialog-D6RUmpOZKX",1,"btn","w-24","btn-primary",3,"click"]],template:function(a,i){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.nrm(5,"lucide-icon",5),e.EFF(6),e.nI1(7,"mytranslate"),e.k0s()(),e.nrm(8,"br"),e.j41(9,"div",3),e.EFF(10),e.nI1(11,"mytranslate"),e.j41(12,"span",6),e.nrm(13,"azt-check-mark",7),e.k0s()(),e.nrm(14,"br"),e.j41(15,"div",8)(16,"button",9),e.bIt("click",function(){return i.onNoClick()}),e.EFF(17,"Ok"),e.k0s(),e.j41(18,"button",10),e.bIt("click",function(){return i.checkNextAns()}),e.EFF(19),e.nI1(20,"mytranslate"),e.k0s()()()()()),2&a&&(e.R7$(5),e.Y8G("ngClass",e.lJ4(11,Ae)),e.R7$(1),e.SpI(" ",e.bMT(7,5,"lang_homework_mark_exercise_utils_mark_success"),""),e.R7$(4),e.SpI(" ",e.bMT(11,7,"lang_homework_mark_exercise_utils_assignment_marking")," "),e.R7$(3),e.Y8G("mark",i.data.score),e.R7$(6),e.JRh(e.bMT(20,9,"lang_homework_mark_exercise_utils_mark_continue")))},dependencies:[w.YU,Fe.D,m.WGl,C.wp],styles:["#ok[_ngcontent-%COMP%]:hover{background-color:#e7e7e7}#next[_ngcontent-%COMP%]:hover{background-color:#1e579d!important}"]})}return o})();var se=r(51913),ne=r(40949),oe=r(41426),re=r(68323),He=r(7919),ze=r(94743),Be=r(87653);const $e=["aztMarkNote"];function Le(o,S){if(1&o){const t=e.RV6();e.qex(0),e.j41(1,"azt-mark-note",38,39),e.bIt("handleBackLink",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.goBack())})("doneLoadData",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.doneLoadData(i))})("markData",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.getMarkData(i))})("getIdHistory",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.getDataHistory(i))}),e.k0s(),e.bVm()}if(2&o){const t=e.XpG();e.R7$(1),e.Y8G("dataMarkNote",t.dataMarkNote)("showBackLink",!0)("markedByObj",t.markedByObj)("historyAnswerObjs",t.historyAnswerObjs)}}function Ge(o,S){if(1&o){const t=e.RV6();e.j41(0,"div",40)(1,"button",41),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.goBack())}),e.nrm(2,"lucide-icon",42),e.j41(3,"span",43),e.EFF(4),e.nI1(5,"mytranslate"),e.k0s()(),e.j41(6,"div",44),e.nrm(7,"azt-svg-icon",45),e.j41(8,"p",46),e.EFF(9),e.nI1(10,"mytranslate"),e.k0s()()()}2&o&&(e.R7$(4),e.JRh(e.bMT(5,3,"lang_auto_quay_lai")),e.R7$(3),e.Y8G("size",102),e.R7$(2),e.JRh(e.bMT(10,5,"lang_auto_chua_nop_bai")+"..."))}function Ue(o,S){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"mytranslate"),e.nI1(3,"mytranslate"),e.k0s()),2&o){const t=e.XpG();e.R7$(1),e.LHq(" ",e.bMT(2,4,"lang_testbank_tested_list_number_success")+" "," ",t.markData.totalRight+", "," ",e.bMT(3,6,"lang_testbank_tested_list_error")+" "," ",t.markData.totalWrong," ")}}function Ve(o,S){1&o&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&o&&(e.R7$(1),e.JRh(e.bMT(2,1,"lang_core_chua_co_so_cau_dung_cau_sai")))}function Je(o,S){if(1&o){const t=e.RV6();e.j41(0,"div",47)(1,"button",48),e.bIt("click",function(){const s=e.eBV(t).$implicit,h=e.XpG();return e.Njj(h.setPoint(s))}),e.EFF(2),e.k0s()()}if(2&o){const t=S.$implicit;e.R7$(2),e.SpI(" ",t.name," ")}}function Xe(o,S){1&o&&e.nrm(0,"azt-loading-ui",49)}const Ye=function(o){return{height:o}};let We=(()=>{class o extends F.H{onResize(t){this.changeSizeMarkGeneral()}doneLoadData(t){this.loadingDataCdn=!1}uploadDrawBase64ToCDN(t,a,i){let s=(0,U.q)(t),h=Date.now();this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${a}_${this.answerId}_${h}.png`,"image/png").subscribe(d=>{d.type!=G.hv.UploadProgress&&(1==d.success?(this.mnoteJsonData.pages?.[a]&&(this.mnoteJsonData.pages[a].draw=d.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,i,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(t,a){this.pagesCount=0;for(let i=0;i<t.length;i++)t[i].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,a,this.mnoteJsonData);else for(let i=0;i<t.length;i++)t[i].draw&&this.uploadDrawBase64ToCDN(t[i].draw,i,a)}sendDataToMarkNote(){let t=this.castObj(this.result.answerObj);if(t){let d=this.commonService.willDeleteParseJson(t.result??"");if(null!=d){let c=d.pages?.length??0;for(let p=0;p<c;p++)d?.pages?.[p].backgroundImage&&(d.pages[p].backgroundImage=this.cdnService.getMyCdn(d.pages[p].backgroundImage??"")),d.pages?.[p].draw&&(d.pages[p].draw=this.cdnService.getMyCdn(d.pages[p].draw));d=JSON.stringify(d),t.result=JSON.stringify(d)}let g=this.commonService.willDeleteParseJson(t.files??"");if(null!=g){for(let c=0;c<g.length;c++)g[c].url&&(g[c].url=this.cdnService.getMyCdn(g[c].url)),g[c].thumb&&(g[c].thumb=this.cdnService.getMyCdn(g[c].thumb));g=JSON.stringify(g),t.files=g}}let a=this.result.studentObj,i=this.result.classroomObj,s=this.result.homeworkObj,h=this.commonService.myParseJson(t?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let d=0;d<(this.jsonData.pages?.length??0);d++)this.jsonData.pages?.[d].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[d].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[d].backgroundImage??"")),this.jsonData.pages?.[d].hasOwnProperty("draw")&&(this.jsonData.pages[d].draw=this.cdnService.getMyCdn(this.jsonData.pages[d].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=t,this.jsonData.student_obj=a,this.jsonData.classroom_obj=i,this.jsonData.homework_obj=s,h&&h.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=h.hideMark),this.dataMarkNote=this.jsonData;else{let d=[];this.files.forEach(c=>{d.push({backgroundImage:c.url})});let g={cmd:"initMNote",mode:"edit",pages:d,answer_obj:t,student_obj:a,classroom_obj:i,homework_obj:s};h&&h.hasOwnProperty("hideMark")&&(g.hideMark=h.hideMark),this.dataMarkNote=g}}getHistoryObjs(t){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,t).subscribe(a=>{1==a.success?this.historyAnswerObjs=a.data?.objs??new Array:this.errorMessage=a.message??"",this.stopStatusObj()})}getDataHistory(t){this.historyId=t,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(t,10)).subscribe(a=>{if(1==a.success){if(this.zipDataService.convertSubmittedAnswersObj(a.data?.answerObj),a.data){this.result=a.data,this.markedByObj=a.data.markedByObj,this.score=a.data?.answerObj?.point??0,this.pointExercise.value=a.data?.answerObj?.point??"",Number(this.pointExercise.value)<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="");let i=this.castJsonToObj(a.data.answerObj?.resultNote??"");if(this.commentExercise=i?.Note??"",this.showPoint=!i?.IsHideMark,this.files=this.commonService.myParseJson(a.data.answerObj?.files??"")??[],null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,this.sendDataToMarkNote(),this.successStatusObj()}}else this.errorMessage=a.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var t=this.commonService.myParseJson(this.result.answerObj?.result??"");t&&(this.jsonData=t,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(t){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,t).subscribe(a=>{1==a.success&&a.data?(this.studentObj=a.data.studentObj,this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(t){this.initStatusObj(),this.errorMessage="",this.answerId=t,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,t).subscribe(a=>{if(1==a.success)if(this.zipDataService.convertSubmittedAnswersObj(a.data?.answerObj),a.data?.hasOwnProperty("studentObj")&&null!=a.data?.studentObj){this.result=a.data,this.markedByObj=a.data.markedByObj,this.score=a.data?.answerObj?.point??0,this.pointExercise.value=a.data?.answerObj?.point??0,this.checkInputActive=!0,this.pointExercise.value<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="",this.checkInputActive=!1);let i=this.castJsonToObj(a.data.answerObj?.resultNote??"");if(this.commentExercise=i?.Note??"",this.showPoint=!i?.IsHideMark,this.homeworkID=a.data.homeworkObj?.id??0,this.classID=a.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(a.data.answerObj?.files??"")??[],this.studentObj=a.data.studentObj,this.classroomObj=a.data.classroomObj??{},null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??""),((0,q.rl)(this.files[s].mimes??"")||(0,q.nL)(this.files[s].mimes??""))&&(this.hasAttachmentFile=!0);this.homeworkObj=a.data.homeworkObj??{},this.studentName=a.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToMarkNote()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=a.message??"",this.stopStatusObj()})}openDialog(t,a){this.sAztDialogService.open(ae,{width:"280px",autoFocus:!1,data:{score:a,status:t,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline??void 0,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(t,a,i,s,h){let d={status:t,deadline:a,itemHomework:i,ans_id:s,name:h,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(ie,{width:"380px",panelClass:"cleanResultDialogBox",data:d,restoreFocus:!1}).afterClosed().subscribe(c=>{if(c&&c.result&&c.isRedirect){let p="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+d.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+d.classID+"/"+d.itemHomework.id+"/"+this.homeworkHashId,p)}})}remark(t,a,i){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let h={id:t,comment:i.comment,hideMark:i.hideMark?1:0,point:a?parseFloat(a.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(i)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,h).subscribe(d=>{1==d.success?(this.openDialog(!0,d.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId)}checkModeUiEditor(){let a=(document.getElementById("mark-general-box")?.offsetHeight??0)-80-40-140-40-30;this.initDataEditor=this.sAztTinyMceService.initConfigTeacherHomework(a)}setPoint(t){this.pointExercise=this.commonService.myClone(t),this.checkInputActive=!0}setPointInput(t){if(t.target){this.checkInputActive=!0;let a=t.target.value;this.pointExercise.value=a,this.pointExercise.name=a}}getListPointDefault(){this.listPointAzt=[{value:1e3,name:"\u0110"},{value:1001,name:"C\u0110"},{value:2e3,name:"HT"},{value:2001,name:"CHT"},{value:3e3,name:"HTT"}]}getMarkData(t){t.checkChangeMark&&(this.markData=t,this.checkInputActive||(this.pointExercise.value=isNaN(this.markData.pointRaw??0)?"":this.markData.pointRaw,this.pointExercise.name=this.pointExercise.value?.toString()))}ngOnInit(){this.isMobileDevice||(document.body.style.overflowY="hidden"),this.getListPointDefault();const t=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),a=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),i=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let s=this.commonService.getMyQueryParam("backto");this.backToLink=s?s.includes("shareType")?decodeURIComponent(s):s:"",t?(this.getData(t),this.getHistoryObjs(t)):this.getStudentObj(a),i&&this.getDataHistory(i),this.checkModeUiEditor(),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}getSizeMarkEditor(t){this.sizeMarkEditor=t}changeSizeMarkGeneral(){let t=document.getElementById("mark-general"),a=document.getElementById("mark-general-box");a&&t&&(a.style.width=t.offsetWidth.toString()+"px")}uploadDrawBase64ToCdn(){return new Promise(t=>{let a=[];if(this.objectResult.pages){this.objectResult.pages.forEach(i=>{a.push(!1)});for(let i=0;i<this.objectResult.pages.length;i++)if(this.objectResult.pages[i]&&this.objectResult.pages[i].draws?.length)for(let s=0;s<(this.objectResult.pages[i].draws?.length??0);s++){let h=this.objectResult.pages[i].draws?.[s]??{};if(h.src&&h.src.includes("base64")){a[i]=!0;let d=(0,U.q)(h.src);this.apiUploadService.commonUploadForMarkResult(d,`essay_note_${i}_${s}_${this.answerId}.png`,"image/png").subscribe(g=>{g.type!=G.hv.UploadProgress&&(h.src=g.data?.url,a[i]=!1),a.includes(!0)||t()})}}}})}saveDataMarkExercise(){var t=this;return(0,Pe.A)(function*(){if(t.loadingSaveData=!0,""==t.historyId)if(1==t.permissionService.hasMarkPointPermission("homework",t.homeworkObj)){if(!t.MarkNote)return;t.objectResult=t.MarkNote?.exportDataMarkNote();let a=!1;if(!t.objectResult.pages?.length&&!t.hasAttachmentFile)return t.loadingSaveData=!1,void t.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_vui_long_thu_lai");if(t.hasAttachmentFile&&!t.objectResult.pages?.length){let i={point:t.pointExercise.value?.toString(),urlDataMark:"",version:"0.1",comment:t.commentExercise,hideMark:!t.showPoint};t.remark(t.answerId,i.point??"0",i)}if(t.objectResult.pages?.length){for(let g=0;g<t.objectResult.pages.length;g++)if(t.objectResult.pages[g]&&t.objectResult.pages[g].draws?.length)for(let c=0;c<(t.objectResult.pages[g].draws?.length??0);c++){let p=t.objectResult.pages[g].draws?.[c]??{};p.src&&p.src.includes("base64")&&(a=!0)}a&&(yield t.uploadDrawBase64ToCdn());const i=t.serializeJson(t.objectResult),s=t.zipDataService.convertContentGzip(i),h=new Blob([s],{type:"text/plain"}),d=new File([h],"txt",{type:"text/plain"});t.apiUploadService.uploadToCdnForHomework(d).subscribe(g=>{if(1==g.success){let c=g.data?.url??"",p={point:t.pointExercise.value?.toString(),urlDataMark:c,version:"0.1",comment:t.commentExercise,hideMark:!t.showPoint};t.remark(t.answerId,p.point??"0",p)}else t.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");t.loadingSaveData=!1})}}else t.showErrorSnack("lang_cms_no_permission_on_homework"),t.stopStatusObj();else t.stopStatusObj(),t.showErrorSnack("lang_cms_cannot_remark_student_history_result")})()}ngAfterViewInit(){this.changeSizeMarkGeneral()}constructor(t,a,i,s,h,d,g,c,p){super(),this.sAztTinyMceService=t,this.activeRoute=a,this.answerService=i,this.permissionService=s,this.sAztDialogService=h,this.cdnService=d,this.zipDataService=g,this.apiUploadService=c,this.vcRef=p,this.tinyEditorKey=M.c.tinyEditorKey,this.answerId=0,this.homeworkID="",this.historyId="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.initDataEditor={},this.color="#000",this.dataMarkNote={},this.loadingSaveData=!1,this.loadingDataCdn=!0,this.listPointAzt=[],this.pointExercise={value:0,name:""},this.markData={},this.commentExercise="",this.showPoint=!0,this.sizeMarkEditor={width:200,height:800},this.checkInputActive=!1,this.objectResult={},this.hasAttachmentFile=!1,this.handleIframe=b=>{"MNoteJson"==b.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=b.data.data,this.uploadAll(this.mnoteJsonData.pages??[],b.data.data.point)),"MNoteReSubmit"==b.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==b.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId&&this.sendDataToMarkNote()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){document.body.style.overflowY="auto",window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}static#e=this.\u0275fac=function(a){return new(a||o)(e.rXU(X.f),e.rXU(v.nX),e.rXU(N._t),e.rXU(se.p),e.rXU(L.i),e.rXU(ne.B),e.rXU(z.j),e.rXU(oe.T),e.rXU(e.c1b))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-mark-exercise-new"]],viewQuery:function(a,i){if(1&a&&e.GBs($e,5),2&a){let s;e.mGM(s=e.lsd())&&(i.MarkNote=s.first)}},hostBindings:function(a,i){1&a&&e.bIt("resize",function(h){return i.onResize(h)},!1,e.tSv)},features:[e.Vt3],decls:53,vars:41,consts:[[1,"content",2,"padding","0 12px"],[1,"grid","grid-cols-12","gap-3","mt-3"],[1,"col-span-12","md:col-span-8","mark-editor",3,"ngStyle"],[4,"ngIf"],["class","w-full",4,"ngIf"],["id","mark-general",1,"col-span-12","md:col-span-4","mark-general"],["id","mark-general-box",1,"box"],[1,"p-2"],[1,"box-head"],[1,"font-medium"],[1,"flex","items-center","mt-2"],[1,"info-student","flex","items-center"],[3,"nameCreateAvatar","size"],[1,"info","ml-2"],[1,"text-md"],[1,"text-xs"],[1,"score","ml-auto","flex","items-center"],["appOnlyNumber","","type","text","id","azt-score",1,"form-control","text-danger","font-medium",3,"decimal","max","value","placeholder","input"],[1,"bg-slate-200","dark:bg-darkmode-400","p-2","text-center","rounded","mt-3"],[4,"ngIf","ngIfElse"],["notMark",""],[1,"choose-score","mt-3"],[1,"score-list-one","grid","grid-cols-10","gap-3"],["class","score-item col-span-2",4,"ngFor","ngForOf"],[1,"comment","mt-3"],[1,"font-medium","text-md"],[1,"comment-editor","mt-2"],[3,"apiKey","ngModel","init","ngModelChange"],[1,"flex","items-center","mt-3"],[1,"form-check","form-switch"],["id","show-score","type","checkbox",1,"form-check-input","mr-2",3,"ngModel","ngModelChange"],["for","show-score",1,"form-check-label","ml-0"],[1,"ml-auto"],["azt-track-service","mark-exercise-new-yWLPF_cK9E",1,"btn","btn-pending",3,"disabled","click"],[1,"grid","grid-cols-2","gap-3","mt-3"],["azt-track-service","mark-exercise-new-xgpK5bMM5y",1,"btn","btn-secondary",3,"click"],["azt-track-service","mark-exercise-new-lNij5J4UCD",1,"btn","btn-primary",3,"disabled","click"],["class","mr-1",4,"ngIf"],[3,"dataMarkNote","showBackLink","markedByObj","historyAnswerObjs","handleBackLink","doneLoadData","markData","getIdHistory"],["aztMarkNote",""],[1,"w-full"],["azt-track-service","mark-exercise-new-KdZ2FWuCn",1,"btn","btn-transparent",3,"click"],["name","chevron-left","size","20"],[1,"azt-hidden","sm:block"],[1,"text-center","mx-auto"],["type","book",3,"size"],[1,"font-medium","mt-5"],[1,"score-item","col-span-2"],["azt-track-service","mark-exercise-new-YBVZ7xc_A",1,"border","border-slate-200","dark:border-darkmode-400","btn-score","btn",3,"click"],[1,"mr-1"]],template:function(a,i){if(1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.DNE(3,Le,3,4,"ng-container",3),e.DNE(4,Ge,11,7,"div",4),e.k0s(),e.j41(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"h3",9),e.EFF(10),e.k0s(),e.j41(11,"div",10)(12,"div",11),e.nrm(13,"azt-create-avatar",12),e.j41(14,"div",13)(15,"p",14),e.EFF(16),e.k0s(),e.j41(17,"p",15),e.EFF(18),e.k0s()()(),e.j41(19,"div",16)(20,"input",17),e.bIt("input",function(h){return i.setPointInput(h)}),e.nI1(21,"mytranslate"),e.k0s()()()(),e.j41(22,"div",18),e.DNE(23,Ue,4,8,"span",19),e.DNE(24,Ve,3,3,"ng-template",null,20,e.C5r),e.k0s(),e.j41(26,"div",21)(27,"div",22),e.DNE(28,Je,3,1,"div",23),e.k0s()(),e.j41(29,"div",24)(30,"p",25),e.EFF(31),e.nI1(32,"mytranslate"),e.k0s(),e.j41(33,"div",26)(34,"editor",27),e.bIt("ngModelChange",function(h){return i.commentExercise=h}),e.k0s()()(),e.j41(35,"div",28)(36,"div",29)(37,"input",30),e.bIt("ngModelChange",function(h){return i.showPoint=h}),e.k0s(),e.j41(38,"label",31),e.EFF(39),e.nI1(40,"mytranslate"),e.k0s()(),e.j41(41,"div",32)(42,"button",33),e.bIt("click",function(){return i.handleOpenReSubmit()}),e.EFF(43),e.nI1(44,"mytranslate"),e.k0s()()(),e.j41(45,"div",34)(46,"button",35),e.bIt("click",function(){return i.goBack()}),e.EFF(47),e.nI1(48,"mytranslate"),e.k0s(),e.j41(49,"button",36),e.bIt("click",function(){return i.saveDataMarkExercise()}),e.DNE(50,Xe,1,0,"azt-loading-ui",37),e.EFF(51),e.nI1(52,"mytranslate"),e.k0s()()()()()()()),2&a){const s=e.sdS(25);e.R7$(2),e.Y8G("ngStyle",e.eq3(39,Ye,i.sizeMarkEditor.height+"px")),e.R7$(1),e.Y8G("ngIf",i.dataMarkNote.answer_obj),e.R7$(1),e.Y8G("ngIf",!i.dataMarkNote||!i.dataMarkNote.answer_obj),e.R7$(6),e.SpI(" ",null==i.homeworkObj?null:i.homeworkObj.name," "),e.R7$(3),e.Y8G("nameCreateAvatar",null==i.studentObj?null:i.studentObj.fullName)("size",35),e.R7$(3),e.SpI(" ",null==i.studentObj?null:i.studentObj.fullName," "),e.R7$(2),e.SpI(" ",null==i.classroomObj?null:i.classroomObj.name," "),e.R7$(2),e.FS9("placeholder",e.bMT(21,27,"lang_auto_nhap_diem")),e.Y8G("decimal",!0)("max",999)("value",i.pointExercise.name),e.R7$(3),e.Y8G("ngIf",i.markData.totalRight||i.markData.totalWrong)("ngIfElse",s),e.R7$(5),e.Y8G("ngForOf",i.listPointAzt),e.R7$(3),e.SpI(" ",e.bMT(32,29,"lang_auto_nhan_xet")," "),e.R7$(3),e.FS9("apiKey",i.tinyEditorKey),e.Y8G("ngModel",i.commentExercise)("init",i.initDataEditor),e.R7$(3),e.Y8G("ngModel",i.showPoint),e.R7$(2),e.SpI(" ",e.bMT(40,31,"lang_auto_hien_thi_diem")," "),e.R7$(3),e.Y8G("disabled",""!==i.historyId),e.R7$(1),e.SpI(" ",e.bMT(44,33,"lang_auto_yeu_cau_nop_lai")," "),e.R7$(4),e.SpI(" ",e.bMT(48,35,"lang_auto_quay_lai")," "),e.R7$(2),e.Y8G("disabled",i.loadingSaveData||""!==i.historyId||""==i.pointExercise.name||i.loadingDataCdn),e.R7$(1),e.Y8G("ngIf",i.loadingSaveData),e.R7$(1),e.SpI(" ",e.bMT(52,37,"lang_auto_luu_du_lieu")," ")}},dependencies:[w.Sq,w.bT,w.B3,n.xn,l.Zm,l.BC,l.vS,re.p,He.Z,te.R,ze.m,Be.i,m.WGl,C.wp],styles:[".btn-score[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.btn-score[_ngcontent-%COMP%]:hover{background:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}.choose-score[_ngcontent-%COMP%]{max-width:80%;margin-left:auto;margin-right:auto}.toolbar-list[_ngcontent-%COMP%]{width:100%;padding:5px;position:absolute;top:0;left:0;display:flex;align-items:center;border-bottom-left-radius:0;border-bottom-right-radius:0}.btn-icon[_ngcontent-%COMP%]{padding:10px;min-width:auto;line-height:initial}.toolbar-item[_ngcontent-%COMP%]{margin:0 3px}.toolbar-item[_ngcontent-%COMP%]:first-child{margin-left:0}.btn-icon-child[_ngcontent-%COMP%]{padding:5px}.azt-toolbar-active[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}  .dark .azt-toolbar-active{--tw-bg-opacity: 1;background-color:rgb(var(--color-darkmode-200)/var(--tw-bg-opacity))}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}@media screen and (max-width: 768px){.choose-score[_ngcontent-%COMP%]{max-width:80%}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}.content[_ngcontent-%COMP%]{margin-bottom:100px}}#mark-general-box[_ngcontent-%COMP%]{height:calc(100vh - 24px);overflow:auto}@media screen and (max-width: 768px){#mark-general-box[_ngcontent-%COMP%]{position:relative;min-height:100vh;height:auto;overflow:hidden}}"]})}return o})();var ce=r(55465),le=r(17818),Ke=r(47712);function Qe(o,S){if(1&o&&(e.j41(0,"button",16),e.nI1(1,"mytranslate"),e.nrm(2,"lucide-icon",17),e.k0s()),2&o){e.XpG();const t=e.sdS(8);e.FS9("matTooltip",e.bMT(1,2,"lang_homework_mark_exercise_history_submit")),e.Y8G("matMenuTriggerFor",t)}}function Ze(o,S){if(1&o){const t=e.RV6();e.j41(0,"li")(1,"button",18),e.bIt("click",function(){const s=e.eBV(t).$implicit,h=e.XpG();return e.Njj(h.getDataHistory(s.id?s.id.toString():""))}),e.j41(2,"span"),e.EFF(3),e.nI1(4,"mytranslate"),e.nI1(5,"formatFullDateTimeWithoutSecondByUserUnitPipe"),e.k0s()()()}if(2&o){const t=S.$implicit,a=S.index;e.R7$(3),e.E5c("",e.bMT(4,3,"lang_homework_mark_exercise_times")," ",a+1," - ",e.bMT(5,5,t.createdAt),"")}}function qe(o,S){if(1&o&&(e.j41(0,"span"),e.nrm(1,"azt-create-avatar",20),e.nI1(2,"mytranslate"),e.k0s()),2&o){const t=e.XpG(2);e.R7$(1),e.Y8G("customTooltip",e.bMT(2,4,"lang_homework_mark_exercise_teacher_mark")+": "+(null==t.markedByObj?null:t.markedByObj.fullName))("nameCreateAvatar",null==t.markedByObj?null:t.markedByObj.fullName)("size",25)("linkAvatar",null==t.markedByObj?null:t.markedByObj.avatar)}}function et(o,S){if(1&o&&(e.j41(0,"h4",19),e.DNE(1,qe,3,6,"span",14),e.EFF(2),e.k0s()),2&o){const t=e.XpG();e.R7$(1),e.Y8G("ngIf",t.isMarked),e.R7$(1),e.Lme(" ",null==t.studentObj?null:t.studentObj.fullName,", ",t.classroomObj.name," ")}}function tt(o,S){if(1&o&&(e.nrm(0,"azt-loading-effect",21),e.nI1(1,"mytranslate")),2&o){const t=e.XpG();e.Y8G("currentStatusObj",t.statusObj)("customText",e.bMT(1,2,"lang_homework_mark_exercise_loading_data_mark"))}}function it(o,S){if(1&o&&(e.j41(0,"div")(1,"div",22)(2,"div",23)(3,"div",24),e.EFF(4),e.nI1(5,"mytranslate"),e.k0s()()()()),2&o){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,1,t.errorMessage))}}function at(o,S){if(1&o&&(e.j41(0,"div",25),e.nrm(1,"iframe",26),e.nI1(2,"safe"),e.k0s()),2&o){const t=e.XpG();e.R7$(1),e.Y8G("src",e.bMT(2,1,t.whiteListMNoteIframeSrc),e.f$h)}}let st=(()=>{class o extends F.H{onPopState(t){this.goBack()}uploadDrawBase64ToCDN(t,a,i){let s=(0,U.q)(t);this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${a}_${this.answerId}.png`,"image/png").subscribe(h=>{h.type!=G.hv.UploadProgress&&(1==h.success?(this.mnoteJsonData.pages?.[a]&&(this.mnoteJsonData.pages[a].draw=h.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,i,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(t,a){this.pagesCount=0;for(let i=0;i<t.length;i++)t[i].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,a,this.mnoteJsonData);else for(let i=0;i<t.length;i++)t[i].draw&&this.uploadDrawBase64ToCDN(t[i].draw,i,a)}reloadPage(){location.reload()}sendDataToIframe(){const t=document.getElementById("mNote"),a=t?t.contentWindow:null;if(null!==a){let i=this.castObj(this.result.answerObj);if(null!=i){let c=this.commonService.willDeleteParseJson(i.result??"");if(null!=c){let b=c.pages?.length??0;for(let I=0;I<b;I++)c?.pages?.[I].backgroundImage&&(c.pages[I].backgroundImage=this.cdnService.getMyCdn(c.pages[I].backgroundImage??"")),c.pages?.[I].draw&&(c.pages[I].draw=this.cdnService.getMyCdn(c.pages[I].draw));c=JSON.stringify(c),i.result=c}let p=this.commonService.willDeleteParseJson(i.files??"");if(null!=p){for(let b=0;b<p.length;b++)p[b].url&&(p[b].url=this.cdnService.getMyCdn(p[b].url)),p[b].thumb&&(p[b].thumb=this.cdnService.getMyCdn(p[b].thumb));p=JSON.stringify(p),i.files=p}}let s=this.result.studentObj,h=this.result.classroomObj,d=this.result.homeworkObj,g=this.commonService.myParseJson(i?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let c=0;c<(this.jsonData.pages?.length??0);c++)this.jsonData.pages?.[c].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[c].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[c].backgroundImage??"")),this.jsonData.pages?.[c].hasOwnProperty("draw")&&(this.jsonData.pages[c].draw=this.cdnService.getMyCdn(this.jsonData.pages[c].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=i,this.jsonData.student_obj=s,this.jsonData.classroom_obj=h,this.jsonData.homework_obj=d,g&&g.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=g.hideMark),a.postMessage(this.jsonData,"*");else{let c=[];this.files.forEach(b=>{c.push({backgroundImage:b.url})});let p={cmd:"initMNote",mode:"edit",pages:c,answer_obj:i,student_obj:s,classroom_obj:h,homework_obj:d};g&&g.hasOwnProperty("hideMark")&&(p.hideMark=g.hideMark),a.postMessage(p,"*")}}}sendDataToIframeHistory(){const t=document.getElementById("mNote");t&&1==this.countLoad&&(t.src+="");const a=t?t.contentWindow:null;if(null!==a){let i=this.castObj(this.result.answerObj);if(null!=i){let c=this.commonService.willDeleteParseJson(i?.result??"");if(null!=c){for(let b=0;b<c.pages.length;b++)c.pages[b].backgroundImage&&(c.pages[b].backgroundImage=this.cdnService.getMyCdn(c.pages[b].backgroundImage)),c.pages[b].draw&&(c.pages[b].draw=this.cdnService.getMyCdn(c.pages[b].draw));c=JSON.stringify(c),i.result=c}let p=this.commonService.willDeleteParseJson(i.files??"");if(null!=p){for(let b=0;b<p.length;b++)p[b].url&&(p[b].url=this.cdnService.getMyCdn(p[b].url)),p[b].thumb&&(p[b].thumb=this.cdnService.getMyCdn(p[b].thumb));p=JSON.stringify(p),i.files=p}}let s=this.studentObj,h=this.classroomObj,d=this.homeworkObj,g=this.commonService.willDeleteParseJson(i?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let c=0;c<(this.jsonData.pages?.length??0);c++)this.jsonData.pages?.[c].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[c].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[c].backgroundImage??"")),this.jsonData.pages?.[c].hasOwnProperty("draw")&&(this.jsonData.pages[c].draw=this.cdnService.getMyCdn(this.jsonData.pages[c].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="view",this.jsonData.answer_obj=i,this.jsonData.student_obj=s,this.jsonData.classroom_obj=h,this.jsonData.homework_obj=d,g&&g.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=g.hideMark),a.postMessage(this.jsonData,"*");else{let c=[];this.files.forEach(b=>{c.push({backgroundImage:b.url})});let p={cmd:"initMNote",mode:"view",pages:c,answer_obj:i,student_obj:s,classroom_obj:h,homework_obj:d};g&&g.hasOwnProperty("hideMark")&&(p.hideMark=g.hideMark),a.postMessage(p,"*")}}}getHistoryObjs(t){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,t).subscribe(a=>{1==a.success?this.historyAnswerObjs=a.data?.objs??new Array:this.errorMessage=a.message??"",this.stopStatusObj()})}getDataHistory(t){this.historyId=t,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(t,10)).subscribe(a=>{if(1==a.success){if(a.data){if(this.zipDataService.convertSubmittedAnswersHistoryObj(a.data?.answerObj),this.result=a.data,this.markedByObj=a.data?.markedByObj,this.score=a.data?.answerObj?.point??0,this.files=this.commonService.myParseJson(a.data?.answerObj?.files??"")??[],null!=this.files)for(let i=0;i<this.files.length;i++)this.files[i].url=this.cdnService.getMyCdn(this.files?.[i].url??""),this.files[i].thumb=this.cdnService.getMyCdn(this.files?.[i].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,1==this.countLoad&&(this.hasSendDataToIframe=!1),0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframeHistory())}this.successStatusObj(),this.countLoad++}else this.errorMessage=a.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var t=this.commonService.myParseJson(this.result.answerObj?.result??"");t&&(this.jsonData=t,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(t){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,t).subscribe(a=>{1==a.success&&a.data?(this.studentObj=a.data.studentObj,this.errorMessage="lang_auto_chua_nop_bai",this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(t){this.initStatusObj(),this.errorMessage="",this.answerId=t,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,t).subscribe(a=>{if(1==a.success)if(this.zipDataService.convertSubmittedAnswersObj(a.data?.answerObj),a.data?.hasOwnProperty("studentObj")&&null!=a.data?.studentObj){if(this.result=a.data,this.markedByObj=a.data.markedByObj,this.score=a.data?.answerObj?.point??0,this.homeworkID=a.data.homeworkObj?.id??0,this.classID=a.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(a.data.answerObj?.files??"")??[],this.studentObj=a.data.studentObj,this.classroomObj=a.data.classroomObj??{},null!=this.files)for(let i=0;i<this.files.length;i++)this.files[i].url=this.cdnService.getMyCdn(this.files?.[i].url??""),this.files[i].thumb=this.cdnService.getMyCdn(this.files?.[i].thumb??"");this.homeworkObj=a.data.homeworkObj??{},this.studentName=a.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframe()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=a.message??"",this.stopStatusObj()})}openDialog(t,a){this.sAztDialogService.open(ae,{width:"280px",autoFocus:!1,data:{score:a,status:t,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){null!=this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(t,a,i,s,h){let d={status:t,deadline:a,itemHomework:i,ans_id:s,name:h,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(ie,{width:"380px",panelClass:"cleanResultDialogBox",data:d,restoreFocus:!1}).afterClosed().subscribe(c=>{if(c&&c.result&&c.isRedirect){let p="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+d.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+d.classID+"/"+d.itemHomework.id+"/"+this.homeworkHashId,p)}})}remark(t,a,i){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let h={id:t,comment:i.comment,hideMark:i.hideMark?1:0,point:a?parseFloat(a.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(i)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,h).subscribe(d=>{1==d.success?(this.openDialog(!0,d.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId);let t=document.body,a=document.getElementById("azota-app-html");a?.classList.remove("overflow-hidden"),a?.classList.remove("height-100"),t.classList.remove("overflow-hidden"),t.classList.remove("height-100")}ngOnInit(){let t=document.body,a=document.getElementById("azota-app-html");a?.classList.add("overflow-hidden"),a?.classList.add("height-100"),t.classList.add("overflow-hidden"),t.classList.add("height-100"),this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";const i=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),s=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),h=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let d=this.commonService.getMyQueryParam("backto");this.backToLink=d?d.includes("shareType")?decodeURIComponent(d):d:"",i?(this.getData(i),this.getHistoryObjs(i)):this.getStudentObj(s),h&&this.getDataHistory(h),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(t,a,i,s,h,d,g,c){super(),this.activeRoute=t,this.answerService=a,this.permissionService=i,this.sAztDialogService=s,this.cdnService=h,this.zipDataService=d,this.envService=g,this.apiUploadService=c,this.answerId=0,this.homeworkID="",this.historyId="",this.whiteListMNoteIframeSrc="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.handleIframe=p=>{"MNoteJson"==p.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=p.data.data,this.uploadAll(this.mnoteJsonData.pages??[],p.data.data.point)),"MNoteReSubmit"==p.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==p.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId?this.sendDataToIframe():this.sendDataToIframeHistory()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}static#e=this.\u0275fac=function(a){return new(a||o)(e.rXU(v.nX),e.rXU(N._t),e.rXU(se.p),e.rXU(L.i),e.rXU(ne.B),e.rXU(z.j),e.rXU(ce.t),e.rXU(oe.T))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-mark-exericse"]],hostBindings:function(a,i){1&a&&e.bIt("popstate",function(h){return i.onPopState(h)},!1,e.tSv)},features:[e.Vt3],decls:22,vars:13,consts:[["id","markContainer",1,"maxW1000"],["id","titleRow"],[1,"block-left"],[1,"btn","btn-sm","btn-outline-secondary","border-none","border-0",3,"matTooltip","click"],["name","chevron-left","size","24"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],[1,"dropdown-menu","w-56","show","relative"],[1,"dropdown-content"],["azt-track-service","mark-exercise-7krhNQm3da",1,"dropdown-item","w-full",3,"click"],[4,"ngFor","ngForOf"],["class","studentInfo","style","padding-right: 10px; color: #fff",4,"ngIf"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"hidden"],[4,"ngIf"],["class","card-box listPhotos",4,"ngIf"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor"],["name","history","size","24"],["azt-track-service","mark-exercise-5mJpoIUV_A",1,"dropdown-item","w-full",3,"click"],[1,"studentInfo",2,"padding-right","10px","color","#fff"],[2,"cursor","pointer",3,"customTooltip","nameCreateAvatar","size","linkAvatar"],[3,"currentStatusObj","customText"],[1,"row","justify-content-center","py-5"],[1,"col-12","text-center"],[1,"alert","alert-danger"],[1,"card-box","listPhotos"],["id","mNote","frameborder","0",2,"width","100%","height","100%",3,"src"]],template:function(a,i){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.bIt("click",function(){return i.goBack()}),e.nI1(4,"mytranslate"),e.nrm(5,"lucide-icon",4),e.k0s(),e.DNE(6,Qe,3,4,"button",5),e.j41(7,"mat-menu",null,6)(9,"div",7)(10,"ul",8)(11,"li")(12,"button",9),e.bIt("click",function(){return i.reloadPage()}),e.j41(13,"span"),e.EFF(14),e.nI1(15,"mytranslate"),e.k0s()()(),e.DNE(16,Ze,6,7,"li",10),e.k0s()()()(),e.DNE(17,et,3,3,"h4",11),e.k0s(),e.DNE(18,tt,2,4,"azt-loading-effect",12),e.j41(19,"div",13),e.DNE(20,it,6,3,"div",14),e.DNE(21,at,3,3,"div",15),e.k0s()()),2&a&&(e.R7$(3),e.FS9("matTooltip",e.bMT(4,9,"lang_button_back")),e.R7$(3),e.Y8G("ngIf",null!=i.historyAnswerObjs&&i.historyAnswerObjs.length>0),e.R7$(8),e.JRh(e.bMT(15,11,"lang_homework_mark_exercise_last")),e.R7$(2),e.Y8G("ngForOf",i.historyAnswerObjs),e.R7$(1),e.Y8G("ngIf",i.classroomObj),e.R7$(1),e.Y8G("ngIf",i.statusObj.loading),e.R7$(1),e.Y8G("hidden",i.statusObj.loading),e.R7$(1),e.Y8G("ngIf",""!=i.errorMessage),e.R7$(1),e.Y8G("ngIf",""==i.errorMessage))},dependencies:[w.Sq,w.bT,Y.iY,le.kk,le.Cp,Ke.oV,K.K,re.p,m.WGl,C.wp,C.JI,C.bH],styles:["#markContainer[_ngcontent-%COMP%]{position:relative}  .studentInfo img{display:inline-flex!important}#titleRow[_ngcontent-%COMP%]{background-color:#00a7d0;height:40px;position:relative;align-items:center;display:flex;justify-content:space-between;color:#fff}#titleRow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}#titleRow[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:0;font-weight:500;font-size:16px;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;display:-webkit-box}#titleRow[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]{margin-right:5px}.block-left[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{border:none}.listPhotos[_ngcontent-%COMP%]{width:100%;position:fixed;top:40px;bottom:0}.file[_ngcontent-%COMP%]{border-width:0px;background:inherit;background-color:#f2f2f2;box-sizing:border-box;border-width:1px;border-style:solid;border-color:#e5e5e5;border-left:0px;border-right:0px;border-radius:0;box-shadow:none}.file[_ngcontent-%COMP%]:first-child{margin-top:52px}.file[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.back[_ngcontent-%COMP%]{padding:15px 10px}.back-to[_ngcontent-%COMP%]{color:#fff;display:flex}.back-to[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:10px}.block[_ngcontent-%COMP%]{padding-top:2px}.mat-expansion-indicator[_ngcontent-%COMP%]:after{color:#fff!important}.add-click[_ngcontent-%COMP%]{display:flex}.add-icon[_ngcontent-%COMP%]{margin-top:5px}.file-custom[_ngcontent-%COMP%]{margin-top:6px}.description__share[_ngcontent-%COMP%]{margin-top:10px}.description__share[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff;color:#666;margin-right:15px;padding:5px 10px 0}.row-check[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:10px 0}.col-check[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:5px}.exercise[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:25px 0 15px;border-bottom:1px solid #eee}.btn-custom[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff;border-radius:5px;padding:10px 25px}.files-custom[_ngcontent-%COMP%]{margin:0}.btn-share[_ngcontent-%COMP%]{border:1px solid #eee}.score-exercise[_ngcontent-%COMP%]{background-color:#ea3d19;border-radius:50%;padding:3px 5px 3px 7px;color:#fff;font-weight:600;margin:0 10px}#listNumber[_ngcontent-%COMP%]{display:contents}#markNumber[_ngcontent-%COMP%]{position:absolute;top:40px;right:50%;z-index:9;margin-right:-60px;color:#fff;text-transform:uppercase;width:120px}@media (min-width: 1000px){.mark-edit[_ngcontent-%COMP%]{width:250px}.file[_ngcontent-%COMP%]:first-child{margin-top:0}.listPhotos[_ngcontent-%COMP%]{width:1000px}}"]})}return o})();var nt=r(25693);const ct=[{path:"",component:(()=>{class o extends F.H{ngOnInit(){super.ngOnInit()}constructor(t){super(),this.commonService=t}static#e=this.\u0275fac=function(a){return new(a||o)(e.rXU(nt.R))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["homework-master-page"]],features:[e.Vt3],decls:2,vars:0,consts:[["id","homework-layout"]],template:function(a,i){1&a&&(e.j41(0,"div",0),e.nrm(1,"router-outlet"),e.k0s())},dependencies:[v.n3],encapsulation:2})}return o})(),canActivate:[A.t],children:[{path:"add-new-homework/:cat_id",component:Ne},{path:"mark-exercise/:id/:hash_id/:studentId",component:st},{path:"switch-mark-exercise/:id/:hash_id/:studentId",component:(()=>{class o extends F.H{getData(t){this.initStatusObj(),this.answerService.apiAnswerGetObjGet(this.homeworkHashId,t).subscribe(a=>{if(1==a.success)if(this.zipDataService.convertSubmittedAnswersObj(a.data?.answerObj),null!=a.data?.studentObj){const i=a.data,s=this.envService.getVersionMarkNote(this.classliveUrl);i.answerObj?.result?(i.answerObj?.result??"").includes("urlDataMark")?this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/${i.answerObj?.id??0}/${this.homeworkHashId}/${a.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise/${i.answerObj?.id??0}/${this.homeworkHashId}/${a.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(s>1e6?`/admin/homework/mark-exercise-new/${i.answerObj?.id??0}/${this.homeworkHashId}/${a.data?.studentObj.id??0}`:`/admin/homework/mark-exercise/${i.answerObj?.id??0}/${this.homeworkHashId}/${a.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`),this.successStatusObj()}else this.stopStatusObj();else this.stopStatusObj()})}ngOnInit(){this.classliveUrl=this.envService.getEnvValue("classliveUrl")??"",this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";const t=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),a=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0);let i=this.commonService.getMyQueryParam("backto");this.backToLink=i?i.includes("shareType")?decodeURIComponent(i):i:"",t?this.getData(t):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/0/${this.homeworkHashId}/${a}`,`?backto=${encodeURIComponent(this.backToLink)}`),super.ngOnInit()}constructor(t,a,i,s){super(),this.activeRoute=t,this.answerService=a,this.zipDataService=i,this.envService=s,this.homeworkHashId="",this.backToLink="",this.classliveUrl=""}static#e=this.\u0275fac=function(a){return new(a||o)(e.rXU(v.nX),e.rXU(N._t),e.rXU(z.j),e.rXU(ce.t))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-mark-exercise-new"]],features:[e.Vt3],decls:0,vars:0,template:function(a,i){},encapsulation:2})}return o})()},{path:"mark-exercise-new/:id/:hash_id/:studentId",component:We}]}];let lt=(()=>{class o{static#e=this.\u0275fac=function(a){return new(a||o)};static#t=this.\u0275mod=e.$C({type:o});static#i=this.\u0275inj=e.G2t({imports:[v.iI.forChild(ct),v.iI,B.XE]})}return o})(),mt=(()=>{class o{static#e=this.\u0275fac=function(a){return new(a||o)};static#t=this.\u0275mod=e.$C({type:o});static#i=this.\u0275inj=e.G2t({providers:[{provide:n.vn,useValue:M.c.azt_tiny_mce_script_src}],imports:[f.Id,v.iI,w.MD,j.s,n.sv,lt,l.YN,l.X1,x.hM,u.L,k.Lk,y.Q,_.b,D.n,m.flO.pick(m.Ptg)]})}return o})()},7919:(T,O,r)=>{"use strict";r.d(O,{Z:()=>l});var w=r(26860);let l=(()=>{class x{constructor(n){this.el=n,this.hasDecimalPoint=!1,this.hasNegativeSign=!1,this.navigationKeys=["Backspace","Delete","Tab","Escape","Enter","Home","End","ArrowLeft","ArrowRight","Clear","Copy","Paste"],this.decimal=!1,this.decimalSeparator=".",this.decimalSeparator1=".",this.decimalSeparator2=",",this.allowNegatives=!1,this.allowPaste=!0,this.negativeSign="-",this.min=-1/0,this.max=1/0,this.regex=null,this.inputElement=n.nativeElement}ngOnChanges(n){if(n.pattern&&(this.regex=this.pattern?RegExp(this.pattern):null),n.min){const m=Number(this.min);this.min=isNaN(m)?-1/0:m}if(n.max){const m=Number(this.max);this.max=isNaN(m)?1/0:m}}onBeforeInput(n){if(isNaN(Number(n.data))){if(n.data===this.decimalSeparator1||n.data===this.decimalSeparator2||n.data===this.negativeSign&&this.allowNegatives)return;n.preventDefault(),n.stopPropagation()}}onKeyDown(n){if(this.navigationKeys.indexOf(n.key)>-1||("a"===n.key||"KeyA"===n.code)&&!0===n.ctrlKey||("c"===n.key||"KeyC"===n.code)&&!0===n.ctrlKey||("v"===n.key||"KeyV"===n.code)&&!0===n.ctrlKey||("x"===n.key||"KeyX"===n.code)&&!0===n.ctrlKey||("a"===n.key||"KeyA"===n.code)&&!0===n.metaKey||("c"===n.key||"KeyC"===n.code)&&!0===n.metaKey||("v"===n.key||"KeyV"===n.code)&&!0===n.metaKey||("x"===n.key||"KeyX"===n.code)&&!0===n.metaKey)return;let m="";var k=n.key;if(n.key===this.decimalSeparator2&&(k=this.decimalSeparator1),this.decimal&&k===this.decimalSeparator1)return m=this.forecastValue(k),m.split(this.decimalSeparator1).length>2||(this.hasDecimalPoint=m.indexOf(this.decimalSeparator1)>-1,this.setNewValue(k)),void n.preventDefault();if(k===this.negativeSign&&this.allowNegatives)return m=this.forecastValue(k),m.charAt(0)!==this.negativeSign||m.split(this.negativeSign).length>2?void n.preventDefault():void(this.hasNegativeSign=m.split(this.negativeSign).length>-1);if(" "===k||isNaN(Number(k)))return void n.preventDefault();if(m=m||this.forecastValue(k),this.regex&&!this.regex.test(m))return void n.preventDefault();const f=Number(m);(f>this.max||f<this.min)&&n.preventDefault()}onPaste(n){if(!0===this.allowPaste){let m="";window.clipboardData?m=window.clipboardData.getData("text"):n.clipboardData&&n.clipboardData.getData&&(m=n.clipboardData.getData("text/plain")),this.pasteData(m),n.preventDefault()}else n.preventDefault(),n.stopPropagation()}onDrop(n){const m=n.dataTransfer?.getData("text")??"";this.inputElement.focus(),this.pasteData(m),n.preventDefault()}pasteData(n){n=this.replaceDecimalSeparator(n);const m=this.sanitizeInput(n);if(!m.includes(this.negativeSign)||!this.hasNegativeSign||this.getSelection().includes(this.negativeSign)){if(!document.execCommand("insertText",!1,m))if(this.inputElement.setRangeText){const{selectionStart:f,selectionEnd:j}=this.inputElement;this.inputElement.setRangeText(m,f??0,j??0,"end"),typeof window.InstallTrigger<"u"&&this.inputElement.dispatchEvent(new Event("input",{cancelable:!0}))}else this.insertAtCursor(this.inputElement,m);this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}}setNewValue(n){n=this.replaceDecimalSeparator(n),this.insertAtCursor(this.inputElement,n),this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}insertAtCursor(n,m){const k=n.selectionStart??0,f=n.selectionEnd??0;n.value=n.value.substring(0,k)+m+n.value.substring(f,n.value.length);const j=k+m.length;n.focus(),n.setSelectionRange(j,j),this.triggerEvent(n,"input")}triggerEvent(n,m){if("createEvent"in document){const k=document.createEvent("HTMLEvents");k.initEvent(m,!1,!0),n.dispatchEvent(k)}}sanitizeInput(n){let k,m="";k=this.decimal&&this.isValidDecimal(n)?new RegExp(`${this.getNegativeSignRegExp()}[^0-9${this.decimalSeparator1}]`,"g"):new RegExp(`${this.getNegativeSignRegExp()}[^0-9]`,"g"),m=n.replace(k,"");const f=this.inputElement.maxLength;if(f>0){const j=f-this.inputElement.value.length+(m.includes(`${this.negativeSign}`)?1:0);m=j>0?m.substring(0,j):""}return m}getNegativeSignRegExp(){return!this.allowNegatives||this.hasNegativeSign&&!this.getSelection().includes(this.negativeSign)?"":`(?!^${this.negativeSign})`}isValidDecimal(n){if(this.hasDecimalPoint){const m=this.getSelection();return m&&m.indexOf(this.decimalSeparator1)>-1?n.split(this.decimalSeparator1).length<=2:n.indexOf(this.decimalSeparator1)<0}return n.split(this.decimalSeparator1).length<=2}getSelection(){return this.inputElement.value.substring(this.inputElement.selectionStart??0,this.inputElement.selectionEnd??0)}forecastValue(n){const k=this.inputElement.selectionEnd??0,f=this.inputElement.value;return f.substring(0,this.inputElement.selectionStart??0)+n+f.substring(k)}replaceDecimalSeparator(n){return n.replace(",",this.decimalSeparator).replace(".",this.decimalSeparator)}static#e=this.\u0275fac=function(m){return new(m||x)(w.rXU(w.aKT))};static#t=this.\u0275dir=w.FsC({type:x,selectors:[["","appOnlyNumber",""]],hostBindings:function(m,k){1&m&&w.bIt("beforeinput",function(j){return k.onBeforeInput(j)})("keydown",function(j){return k.onKeyDown(j)})("paste",function(j){return k.onPaste(j)})("drop",function(j){return k.onDrop(j)})},inputs:{decimal:"decimal",decimalSeparator:"decimalSeparator",decimalSeparator1:"decimalSeparator1",decimalSeparator2:"decimalSeparator2",allowNegatives:"allowNegatives",allowPaste:"allowPaste",negativeSign:"negativeSign",min:"min",max:"max",pattern:"pattern"},features:[w.OA$]})}return x})()},40111:(T,O,r)=>{"use strict";r.d(O,{k:()=>n});var w=r(64198),l=r(73202),x=r(26860),v=r(25693);let n=(()=>{class m{getMineTypeByFileType(f){let u="";switch(this.commonService.getEnumTypeWithDefault(l.d,f,l.d.unknown)){case l.d.doc:case l.d.docx:u="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case l.d.ppt:case l.d.pptx:u="application/vnd.openxmlformats-officedocument.presentationml.presentation";break;case l.d.xlsx:u="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";break;case l.d.pdf:u="application/pdf";break;case l.d.video:case l.d.mp4:u="video/mp4";break;case l.d.mov:u="video/mov";break;case l.d.webm:u="video/webm";break;case l.d.quicktime:u="video/quicktime";break;case l.d.audio:u="audio/mpeg";break;case l.d.mp3:u="audio/mp3";break;case l.d.wav:u="audio/wav";break;case l.d.jpeg:case l.d.image:u="image/jpeg";break;case l.d.google_docs:u="google_docs"}return u}getMineTypeByExtension(f){switch(new RegExp(/(?:\.([^.]+))?$/).exec(f)?.[1]){case"pdf":return"application/pdf";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xsl":case"csv":return"application/vnd.ms-excel";case"jpg":return"image/jpg";case"jpge":return"image/jpge";default:return"application/json-patch+json"}}getTypeFileByMime(f){return f.mimes&&(0,w.I7)(f.mimes)||f.name?.toLowerCase().endsWith(".azt")?l.d.docx:f.mimes&&(0,w.nL)(f.mimes)?l.d.xlsx:f.mimes&&(0,w.JK)(f.mimes)?l.d.audio:f.mimes&&(0,w.cZ)(f.mimes)?l.d.video:f.mimes&&(0,w.wu)(f.mimes)?l.d.image:f.mimes&&(0,w.Ev)(f.mimes)?l.d.pdf:f.mimes&&(0,w.rl)(f.mimes)?l.d.powerpoint:void 0}constructor(f){this.commonService=f}static#e=this.\u0275fac=function(j){return new(j||m)(x.KVO(v.R))};static#t=this.\u0275prov=x.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()},10296:(T,O,r)=>{"use strict";r.d(O,{R:()=>k});var w=r(43277),x=r(18148),v=r(26860),n=r(18350),m=r(25693);let k=(()=>{class f{constructor(u,_){this.mobileWebviewService=u,this.commonService=_}shareFileWithBlob(u,_){if(this.commonService.isMobileWebview(void 0)){x.L.openLoadingEffect(this.commonService.myTranslateInstant("lang_auto_dang_lay_du_lieu_tu_he_thong")??"");let D=new FileReader;D.readAsDataURL(u),D.onloadend=()=>{let y=D.result;"string"==typeof y&&(this.mobileWebviewService.sendShareFileBase64(_,String(y)),x.L.closeLoadingEffect(100))}}else w.saveAs(u,_)}shareFileWithBase64(u,_){this.commonService.isMobileWebview(void 0)?this.mobileWebviewService.sendShareFileBase64(_,u):w.saveAs(u,_)}static#e=this.\u0275fac=function(_){return new(_||f)(v.KVO(n.f),v.KVO(m.R))};static#t=this.\u0275prov=v.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},18148:(T,O,r)=>{"use strict";r.d(O,{L:()=>w});let w=(()=>{class l{static#e=this.idComponent="azt-status-loading-effect";static#t=this.idStatusContent="azt-status-loading-effect-content";static openLoadingEffect(v){l.getDomElement().style.display="flex",setTimeout(()=>{l.changeMsgLoadingEffect(v)},50)}static closeLoadingEffect(v){return new Promise(n=>{setTimeout(()=>{const m=l.getDomElement();m&&(m.style.display="none"),n(!0)},v)})}static changeMsgLoadingEffect(v){l.getDomContent().innerText=v}static getDomContent(){return document.getElementById(l.idStatusContent)??document.createElement("span")}static getDomElement(){return document.getElementById(l.idComponent)??this.createDomElement()}static createDomElement(){const v=document.createElement("div");return v.id=l.idComponent,v.setAttribute("style","position: fixed;display: flex;width: 100vw;height: 100%;background: #000000c7;color: #ffffff;font-size: 20px;font-weight: lighter;justify-content: center;align-items: center;cursor: progress;z-index: 9999;top: 0;left: 0;"),v.style.display="none",v.innerHTML=`\n        <div class="text-center" style="height: 85%; overflow-x: auto;">\n            <div class="flex justify-center mt-5">\n                <svg width="20" viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">\n                    <g fill="none" fill-rule="evenodd">\n                        <g transform="translate(2 1)" stroke="currentColor" stroke-width="1.5">\n                            <circle cx="42.601" cy="11.462" r="5" fill-opacity="1" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="1;0;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="49.063" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;1;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="42.601" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;1;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="49.125" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;1;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;1;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="4.938" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;1;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="11.462" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;1;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="5" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;0;1" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                        </g>\n                    </g>\n                </svg>\n            </div>\n            <div style="margin-top: 10px;position: relative;">\n                <span id="${l.idStatusContent}"></span>\n            </div>\n        </div>`,document.body.appendChild(v),v}}return l})()},43277:function(T,O){var r,l;void 0!==(l="function"==typeof(r=function(){"use strict";function v(u,_,D){var y=new XMLHttpRequest;y.open("GET",u),y.responseType="blob",y.onload=function(){j(y.response,_,D)},y.onerror=function(){console.error("could not download file")},y.send()}function n(u){var _=new XMLHttpRequest;_.open("HEAD",u,!1);try{_.send()}catch{}return 200<=_.status&&299>=_.status}function m(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var _=document.createEvent("MouseEvents");_.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(_)}}var k="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,f=k.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),j=k.saveAs||("object"!=typeof window||window!==k?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(u,_,D){var y=k.URL||k.webkitURL,M=document.createElement("a");M.download=_=_||u.name||"download",M.rel="noopener","string"==typeof u?(M.href=u,M.origin===location.origin?m(M):n(M.href)?v(u,_,D):m(M,M.target="_blank")):(M.href=y.createObjectURL(u),setTimeout(function(){y.revokeObjectURL(M.href)},4e4),setTimeout(function(){m(M)},0))}:"msSaveOrOpenBlob"in navigator?function(u,_,D){if(_=_||u.name||"download","string"!=typeof u)navigator.msSaveOrOpenBlob(function x(u,_){return typeof _>"u"?_={autoBom:!1}:"object"!=typeof _&&(console.warn("Deprecated: Expected third argument to be a object"),_={autoBom:!_}),_.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\ufeff",u],{type:u.type}):u}(u,D),_);else if(n(u))v(u,_,D);else{var y=document.createElement("a");y.href=u,y.target="_blank",setTimeout(function(){m(y)})}}:function(u,_,D,y){if((y=y||open("","_blank"))&&(y.document.title=y.document.body.innerText="downloading..."),"string"==typeof u)return v(u,_,D);var M="application/octet-stream"===u.type,B=/constructor/i.test(k.HTMLElement)||k.safari,A=/CriOS\/[\d]+/.test(navigator.userAgent);if((A||M&&B||f)&&typeof FileReader<"u"){var E=new FileReader;E.onloadend=function(){var R=E.result;R=A?R:R.replace(/^data:[^;]*;/,"data:attachment/file;"),y?y.location.href=R:location=R,y=null},E.readAsDataURL(u)}else{var H=k.URL||k.webkitURL,P=H.createObjectURL(u);y?y.location=P:location.href=P,y=null,setTimeout(function(){H.revokeObjectURL(P)},4e4)}});k.saveAs=j.saveAs=j,T.exports=j})?r.apply(O,[]):r)&&(T.exports=l)}}]);