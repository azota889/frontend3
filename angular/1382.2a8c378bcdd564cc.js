"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[1382],{1382:(K,B,k)=>{k.d(B,{I:()=>I});var S=k(73014),D=k(26860),L=k(62095),J=k(40949),W=k(99927);let I=(()=>{var C;class T{constructor(e,f,i){this.commonService=e,this.cdnService=f,this.answerTypeService=i}convertUrlToBase64(e){return(0,S.A)(function*(){const i=yield(yield fetch(e+"?t="+(new Date).getTime())).blob();return new Promise(l=>{const a=new FileReader;a.readAsDataURL(i),a.onloadend=()=>{l(a.result)}})})()}convertLinkToBase64(e,f,i){var l=this;return(0,S.A)(function*(){if(!f)return i;for(let w=0;w<(e?.length??0);w++)if(e?.[w].link===i)return e?.[w].convert;var a=yield l.convertUrlToBase64(i);return e?.push({convert:a,link:i}),a})()}replaceCanvasBackground(e,f){var i=this;return(0,S.A)(function*(){if(e){var l=[];for(let x=0;x<e.length;x++){var a=e[x];if(a&&0===a.isImage){var w=a.questionContentParse?.[0].content;a.questionContentParse&&(a.questionContentParse[0].content="");var P=void 0===w?[]:w.split("@[]");for(let h=0;h<P.length;h++){var p=P[h];if(!0===i.commonService.isJson(p)){var d=i.commonService.willDeleteParseJson(p);if(d.hasOwnProperty("link")){var c=document.body.offsetWidth,r=1;d.data.width>(n=c-30)&&(d.data={x:d.data.x*(r=n/d.data.width),y:d.data.y*r,width:d.data.width*r,height:d.data.height*r}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},a.questionContentParse&&(a.questionContentParse[0].content+=`<div class="background_question_${x}_${h}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,f,i.cdnService.getMyCdn(d.link))}"></div>`);var _=document.createElement("style");document.body.appendChild(_),_.textContent+=`.background_question_${x}_${h} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${x}_${h} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else a.questionContentParse&&(a.questionContentParse[0].content+=p)}else a.questionContentParse&&(a.questionContentParse[0].content+=p)}if(i.answerTypeService.isOneChoiceAnswer(a))for(let h=0;h<(a.answerConfigParse?.length??0);h++){var g=a.answerConfigParse?.[h].content;a.answerConfigParse&&(a.answerConfigParse[h].content="");var $=void 0===g?[]:g.split("@[]");for(let u=0;u<$.length;u++){var M=$[u];if(!0===i.commonService.isJson(M)){var t=i.commonService.willDeleteParseJson(M);t.hasOwnProperty("link")?(c=document.body.offsetWidth,r=1,t.data.width>(n=c-30)&&(t.data={x:t.data.x*(r=n/t.data.width),y:t.data.y*r,width:t.data.width*r,height:t.data.height*r}),t.data={x:Math.floor(t.data.x),y:Math.floor(t.data.y),width:Math.floor(t.data.width),height:Math.floor(t.data.height)},a.answerConfigParse&&(a.answerConfigParse[h].content+=`<div class="background_question__ans${x}_${h}_${u}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,f,i.cdnService.getMyCdn(t.link))}"></div>`),_=document.createElement("style"),document.body.appendChild(_),_.textContent+=`.background_question__ans${x}_${h}_${u} {margin: 0 3px; width: ${t.data.width}px; height: ${t.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${x}_${h}_${u} img { margin-top: -${t.data.y}px; margin-left: -${t.data.x}px;}`):a.answerConfigParse&&(a.answerConfigParse[h].content+=M)}else a.answerConfigParse&&(a.answerConfigParse[h].content+=M)}}if(a.answerMediaParse&&a.answerMediaParse.length>0){var y=a.answerMediaParse;a.answerMediaParse="";var v=void 0===y?[]:y.split("@[]");for(let h=0;h<v.length;h++){var E=v[h];if(!0===i.commonService.isJson(E)){var n,o=i.commonService.willDeleteParseJson(E);if(o.hasOwnProperty("link"))c=document.body.offsetWidth,r=1,o.data.width>(n=c-30)&&(o.data={x:o.data.x*(r=n/o.data.width),y:o.data.y*r,width:o.data.width*r,height:o.data.height*r}),o.data={x:Math.floor(o.data.x),y:Math.floor(o.data.y),width:Math.floor(o.data.width),height:Math.floor(o.data.height)},a.answerMediaParse+=`<div class="background_question__ans_result${x}_${h}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,f,i.cdnService.getMyCdn(o.link))}"></div>`,_=document.createElement("style"),document.body.appendChild(_),_.textContent+=`.background_question__ans_result${x}_${h} {margin: 0 3px; width: ${o.data.width}px; height: ${o.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${x}_${h} img { margin-top: -${o.data.y}px; margin-left: -${o.data.x}px;}`;else a.answerMediaParse+=E}else a.answerMediaParse+=E}}}}}})()}replaceCanvasBackgroundTS(e,f){var i=this;return(0,S.A)(function*(){var l=[];for(let y=0;y<e.length;y++){var a=e[y];if(0===a.isImage){var w=a.questionContentParse[0].content;a.questionContentParse[0].content="";var P=void 0===w?[]:w.split("@[]");for(let v=0;v<P.length;v++){var p=P[v];if(!0===i.commonService.isJson(p)){var d=i.commonService.willDeleteParseJson(p);if(d.hasOwnProperty("link")){var c=document.body.offsetWidth,r=1;d.data.width>(n=c-30)&&(d.data={x:d.data.x*(r=n/d.data.width),y:d.data.y*r,width:d.data.width*r,height:d.data.height*r}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},a.questionContentParse[0].content+=`<div class="background_question_${y}_${v}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,f,i.cdnService.getMyCdn(d.link))}"></div>`;var _=document.createElement("style");document.body.appendChild(_),_.textContent+=`.background_question_${y}_${v} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${y}_${v} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else a.questionContentParse[0].content+=p}else a.questionContentParse[0].content+=p}if(i.answerTypeService.isOneChoiceAnswer(a)&&(0==a.isImage||1==a.isImage&&a.name.startsWith("[PDFv2]")?i.replaceBackgroundAnswerConfig(a.answerConfigParse,l,y,f):i.replaceBackgroundAnswerConfig(a.answerConfigParseVer1.answerConfigV2,l,y,f)),a.answerMedia&&a.answerMedia.length>0){var g=a.answerMedia;a.answerMedia="";var $=void 0===g?[]:g.split("@[]");for(let v=0;v<$.length;v++){var M=$[v];if(!0===i.commonService.isJson(M)){var n,t=i.commonService.willDeleteParseJson(M);if(t.hasOwnProperty("link"))c=document.body.offsetWidth,r=1,t.data.width>(n=c-30)&&(t.data={x:t.data.x*(r=n/t.data.width),y:t.data.y*r,width:t.data.width*r,height:t.data.height*r}),t.data={x:Math.floor(t.data.x),y:Math.floor(t.data.y),width:Math.floor(t.data.width),height:Math.floor(t.data.height)},a.answerMedia+=`<div class="background_question__ans_result${y}_${v}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,f,i.cdnService.getMyCdn(t.link))}"></div>`,_=document.createElement("style"),document.body.appendChild(_),_.textContent+=`.background_question__ans_result${y}_${v} {margin: 0 3px; width: ${t.data.width}px; height: ${t.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${y}_${v} img { margin-top: -${t.data.y}px; margin-left: -${t.data.x}px;}`;else a.answerMedia+=M}else a.answerMedia+=M}}}}return!0})()}replaceBackgroundAnswerConfig(e,f,i,l){var a=this;return(0,S.A)(function*(){for(let g=0;g<e.length;g++){var w=e[g].content;e[g].content="";var P=void 0===w?[]:w.split("@[]");for(let $=0;$<P.length;$++){var p=P[$];if(!0===a.commonService.isJson(p)){var d=a.commonService.willDeleteParseJson(p);if(d.hasOwnProperty("link")){var n=document.body.offsetWidth-30,r=1;d.data.width>n&&(d.data={x:d.data.x*(r=n/d.data.width),y:d.data.y*r,width:d.data.width*r,height:d.data.height*r}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},e[g].content+=`<div class="background_question__ans${i}_${g}_${$}"><img width="${1024*r}" height="${1024*r}" src="${yield a.convertLinkToBase64(f,l,a.cdnService.getMyCdn(d.link))}"></div>`;var _=document.createElement("style");document.body.appendChild(_),_.textContent+=`.background_question__ans${i}_${g}_${$} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${i}_${g}_${$} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else e[g].content+=p}else e[g].content+=p}}})()}}return(C=T).\u0275fac=function(e){return new(e||C)(D.KVO(L.R),D.KVO(J.B),D.KVO(W._))},C.\u0275prov=D.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),T})()}}]);