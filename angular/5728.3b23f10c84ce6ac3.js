"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[5728],{41019:(Y,P,r)=>{r.d(P,{Z:()=>e});class e{constructor(a,Z,g,v,c,b=1,w=!1,y=!1,E,N){this.id=a,this.pr=Z,this.type=g,this.shareType=v,this.item=c,this.level=b,this.expandable=w,this.isLoading=y,this.prNode=E,this.isLeaf=N}}},59694:(Y,P,r)=>{r.d(P,{O:()=>Z});var e=r(65879),s=r(88489),a=r(46558);let Z=(()=>{class g{constructor(c,b){this.browserStorageService=c,this.commonService=b,this.data={}}setMode(c){this.browserStorageService.saveSimpleStorage("__editor:mode_open",c)}getMode(){var c=this.browserStorageService.getSimpleStorage("__editor:mode_open")||"editor";return this.browserStorageService.removeSimpleStorage("__editor:mode_open"),c}setFileProcess(c){this.file=c}getFirstFile(){let c=this.file;return this.file=void 0,c}setOutputData(c){this.data=c}getOutputData(){return this.data}redirectToConfig(c){this.data.homework&&c.showHomework(),(this.data.exam||this.data.examOffline)&&c.showExam()}setMatrixData(c,b){b?this.matrix=c:this.browserStorageService.saveSimpleStorage("__editor:matrix-data",JSON.stringify(c))}getMatrixData(){var c=this.browserStorageService.getSimpleStorage("__editor:matrix-data");return this.browserStorageService.removeSimpleStorage("__editor:matrix-data"),c?this.commonService.castJsonToObj(c):this.matrix}}return g.\u0275fac=function(c){return new(c||g)(e.LFG(s.n),e.LFG(a.z))},g.\u0275prov=e.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},7827:(Y,P,r)=>{r.d(P,{i:()=>s});var e=r(65879);let s=(()=>{class a{constructor(){this.fileDrop=new e.vpe,this.preventBodyDrop=!0,this.active=!1}onDrop(g){g.preventDefault(),this.active=!1;const{dataTransfer:v}=g;if(v?.items){const c=[];for(let b=0;b<v.items.length;b++)"file"===v.items[b].kind&&v.items[b].getAsFile()&&c.push(v.items[b].getAsFile());v.items.clear(),Array.isArray(c)&&this.fileDrop.emit(this.removeNullFile(c))}else{const c=v?.files;v?.clearData(),c&&this.fileDrop.emit(Array.from(c))}}removeNullFile(g){for(var v=[],c=0;c<g.length;c++)g[c]&&v.push(g[c]);return v}onDragOver(g){g.stopPropagation(),g.preventDefault(),this.active=!0}onDragLeave(g){this.active=!1}onBodyDragOver(g){this.preventBodyDrop&&(g.preventDefault(),g.stopPropagation())}onBodyDrop(g){this.preventBodyDrop&&g.preventDefault()}}return a.\u0275fac=function(g){return new(g||a)},a.\u0275dir=e.lG2({type:a,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(g,v){1&g&&e.NdJ("drop",function(b){return v.onDrop(b)})("dragover",function(b){return v.onDragOver(b)})("dragleave",function(b){return v.onDragLeave(b)})("dragover",function(b){return v.onBodyDragOver(b)},!1,e.pYS)("drop",function(b){return v.onBodyDrop(b)},!1,e.pYS),2&g&&e.ekj("drop-zone-active",v.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"}}),a})()},54901:(Y,P,r)=>{r.d(P,{v:()=>Oe});var e=r(65879),s=r(56223),a=r(66623),Z=r(47496),g=r(91765),v=r(54),c=r(21266),b=r(50014),w=r(69862),y=r(70731),E=r(61713),N=r(46558),k=r(82228);let I=(()=>{class l{constructor(t,o){this.commonService=t,this.apiUploadService=o,this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new y.Q(50,{function:(n,i)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(n,i)}}),this.taskUploadImage=new y.Q(10,{function:(n,i)=>{this.callbackUploadImage&&this.callbackUploadImage(n,i)}})}convertQuestions(t,o,n){return new Promise(i=>{this.reset(),t.forEach(m=>{const _=this.commonService.willDeleteParseJson(m.answerConfig||"[]");m.questionContent?.includes("<img ")&&this.replaceImageCdnInContent(m,"questionContent"),m.questionText?.includes("<img ")&&this.replaceImageCdnInContent(m,"questionText"),m.answerMedia?.includes("<img ")&&this.replaceImageCdnInContent(m,"answerMedia"),m.mediaMeta?.includes("<img ")&&this.replaceImageCdnInContent(m,"mediaMeta"),_.forEach(T=>{T.content.includes("<img ")&&this.replaceImageCdnInContent(T,"content")}),this.actionRunAfterConvert.push(()=>{m.answerConfig=JSON.stringify(_)})}),this.imageMaps.forEach(m=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[m])}),this.taskConvertBase64ToCanvas.start().then(m=>{if(m.errs.length>0)n(m.errs,void 0);else{let T=0;const p=[],ee=()=>{const L=document.createElement("canvas");L.width=this.sizeDefaultCanvas,L.height=this.sizeDefaultCanvas;const K=L.getContext("2d");K&&(K.fillStyle="white",K.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),p.push({cdn:"",cX:0,cY:0,canvas:L,imgs:[]})};ee(),m.datas.forEach((L,K)=>{var O=p[p.length-1];O.cX+L.canvas.width+4>this.sizeDefaultCanvas?(O.cX=4,O.cY+=T+4,T=0):O.cX+=4,O.cY+L.canvas.height>this.sizeDefaultCanvas&&(ee(),O=p[p.length-1]);var B=O.canvas.getContext("2d");O.imgs.push({x:O.cX,y:O.cY,width:L.canvas.width,height:L.canvas.height,index:K}),B?.drawImage(L.canvas,0,0,L.canvas.width,L.canvas.height,O.cX,O.cY,L.canvas.width,L.canvas.height),O.cX+=L.canvas.width,T=T<L.canvas.height?L.canvas.height:T}),p[0].imgs.length>0&&p.forEach(L=>{this.taskUploadImage.addTask(this,this.startUploadFile,[L])}),this.taskUploadImage.start().then(L=>{if(L.errs.length>0)n(m.errs,void 0);else{let K=!0;L.datas.forEach(O=>{O.imgs.forEach(B=>{const Q=m.datas[B.index];if(Q){const q={link:O.cdn,data:{x:B.x,y:B.y,width:B.width,height:B.height}};Q.objs.forEach(U=>{if(U[Q.path])if(this.commonService.isJson(U[Q.path])){const te=this.commonService.willDeleteParseJson(U[Q.path]);Object.prototype.hasOwnProperty.call(te,"renderedStr")?(te.renderedStr=te.renderedStr.replace(Q.base,`@[]${JSON.stringify(q)}@[]`),U[Q.path]=JSON.stringify(te)):U[Q.path]=U[Q.path].replace(Q.base,`@[]${JSON.stringify(q)}@[]`)}else U[Q.path]=U[Q.path].replace(Q.base,`@[]${JSON.stringify(q)}@[]`);else K=!1})}})}),K?(this.actionRunAfterConvert.forEach(O=>{O()}),t.forEach((O,B)=>{let Q=this.commonService.willDeleteParseJson(O.mediaMeta||"{}"),q=o[B];const U={id:0,name:O.name,extension:"text",content:O.questionContent,groupContent:Q.renderedStr,metaData:{isFixAns:Number(O.isFixAns),forcedFixAns:!1,groupType:O.groupType?Number(O.groupType):void 0}};q&&(U.vMetaEditor=q.meta),O.questionContent=JSON.stringify([U])}),i()):n(m.errs,void 0,!0)}})}})})}reset(){this.imageMaps=[],this.actionRunAfterConvert=[]}replaceImageCdnInContent(t,o){var n=t[o];if(this.commonService.isJson(t[o])){const _=this.commonService.willDeleteParseJson(t[o]);Object.prototype.hasOwnProperty.call(_,"renderedStr")&&(n=_.renderedStr)}let i=n.matchAll(this.pattern_image);for(;;){let _=i.next();if(_.done)break;let T=_.value[0];var m=this.imageMaps.findIndex(p=>p.base===T&&p.path===o);-1===m?this.imageMaps.push({base:T,cdn:"",data:null,objs:[t],path:o,canvas:document.createElement("canvas")}):this.imageMaps[m].objs.push(t)}}startConvertCanvas(t){return new Promise((o,n)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{let _=1;if(i.width>this.sizeDefaultCanvas&&(_=this.sizeDefaultCanvas/i.width),i.height>this.sizeDefaultCanvas){let p=this.sizeDefaultCanvas/i.height;p<_&&(_=p)}t.canvas.width=i.width*_,t.canvas.height=i.height*_,t.canvas.getContext("2d")?.drawImage(i,0,0,i.width,i.height,0,0,t.canvas.width,t.canvas.height),o(t)},i.onerror=()=>{t.canvas.width=1,t.canvas.height=1;const _=t.canvas.getContext("2d");_&&(_.fillStyle="white",_.fillRect(0,0,1,1)),o(t)};let m=this.pattern_base64.exec(t.base);null!=m?i.src=m[0]:n(new Error("l\u1ed7i regex"))})}startUploadFile(t){return new Promise((o,n)=>{const i=this.dataURLtoFile(t.canvas.toDataURL("image/png",1));(0,E.hv)(i).then(m=>{this.apiUploadService.uploadToCdnProgressForExamQuestionContent(m).subscribe(_=>{_.type!=w.dt.UploadProgress&&(1==_.success&&_.data?o({...t,cdn:_.data.url||""}):n(new Error(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",_.message??"none"))))})})})}dataURLtoFile(t){let o=this.getFileName(t);for(var n=t.split(","),i=n[0].match(/:(.*?);/),m=atob(n[1]),_=m.length,T=new Uint8Array(_);_--;)T[_]=m.charCodeAt(_);return new File([T],o,{type:i&&i.length>0?i[1]:"png"})}getFileName(t){var o=t.split("").reverse().join(""),n=o.indexOf(";"),i=o.indexOf("/",n);return o.substring(n,i).split("").reverse().join("")}}return l.\u0275fac=function(t){return new(t||l)(e.LFG(N.z),e.LFG(k.W))},l.\u0275prov=e.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})();var f=r(59694),S=r(11460),D=r(40687),C=r(88489),d=r(87325),x=r(96814),u=r(43389),h=r(67679),j=r(71646),W=r(26425),z=r(18727),F=r(78337),H=r(41894),J=r(98445),$=r(84003),X=r(32296),G=r(37722),V=r(76024),M=r(36727);function R(l,A){1&l&&(e.TgZ(0,"div",38)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_auto_vui_long_nhap_ho_va_ten")))}function ne(l,A){1&l&&(e.TgZ(0,"div",38)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_auto_vui_long_nhap_so_dien_thoai")))}function ie(l,A){1&l&&(e.TgZ(0,"div",38)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_student_utils_reques_phone_ten_number")))}function ae(l,A){1&l&&(e.TgZ(0,"div",38)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_document_please_enter_the_author_workplace")))}function re(l,A){if(1&l&&(e.TgZ(0,"div",14)(1,"div",30)(2,"div",31),e._UZ(3,"input",32),e.ALo(4,"mytranslate"),e.YNc(5,R,4,3,"div",33),e.qZA(),e.TgZ(6,"div",34),e._UZ(7,"input",35),e.ALo(8,"mytranslate"),e.YNc(9,ne,4,3,"div",33),e.YNc(10,ie,4,3,"div",33),e.qZA(),e.TgZ(11,"div",36),e._UZ(12,"input",37),e.ALo(13,"mytranslate"),e.YNc(14,ae,4,3,"div",33),e.qZA()()()),2&l){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,7,"lang_auto_nhap_ho_va_ten")),e.xp6(2),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&!t.form.controls.creatorFullName.value),e.xp6(2),e.s9C("placeholder",e.lcZ(8,9,"lang_auto_nhap_so_dien_thoai")),e.xp6(2),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&!t.form.controls.creatorPhone.value),e.xp6(1),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&t.form.controls.creatorPhone.value&&10!==t.form.controls.creatorPhone.value.length),e.xp6(2),e.s9C("placeholder",e.lcZ(13,11,"lang_document_workplace")),e.xp6(2),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&!t.form.controls.creatorWorkingAddress.value)}}function le(l,A){if(1&l){const t=e.EpF();e.TgZ(0,"mat-tree-node",43),e._UZ(1,"button",44),e.TgZ(2,"div",45)(3,"input",46),e.NdJ("change",function(){const i=e.CHM(t).$implicit,m=e.oxw(2);return e.KtG(m.checklistSelection.toggle(i))}),e.qZA(),e.TgZ(4,"label",47)(5,"span"),e._uU(6),e.qZA()()()()}if(2&l){const t=A.$implicit,o=e.oxw(2);e.xp6(3),e.s9C("id","knowledge-"+t.id),e.Q6J("checked",o.checklistSelection.isSelected(t)),e.xp6(1),e.s9C("for","knowledge-"+t.id),e.xp6(2),e.Oqu(t.item)}}function ce(l,A){if(1&l){const t=e.EpF();e.TgZ(0,"mat-tree-node",48)(1,"button",49)(2,"span",50),e._UZ(3,"lucide-icon",51),e.qZA()(),e.TgZ(4,"div",45)(5,"input",52),e.NdJ("change",function(){const i=e.CHM(t).$implicit,m=e.oxw(2);return e.KtG(m.todoItemSelectionToggle(i))}),e.qZA(),e.TgZ(6,"label",47)(7,"span"),e._uU(8),e.qZA()()()()}if(2&l){const t=A.$implicit,o=e.oxw(2);e.xp6(1),e.uIk("aria-label","toggle "+t.filename),e.xp6(2),e.s9C("name",o.treeControl.isExpanded(t)?"chevron-down":"chevron-right"),e.xp6(2),e.s9C("id","knowledge-"+t.id),e.Q6J("checked",o.descendantsAllSelected(t))("indeterminate",o.descendantsPartiallySelected(t)),e.xp6(1),e.s9C("for","knowledge-"+t.id),e.xp6(2),e.Oqu(t.item)}}function ue(l,A){if(1&l&&(e.TgZ(0,"div",14)(1,"div",3)(2,"div",31)(3,"span",17),e._uU(4),e.ALo(5,"mytranslate"),e.qZA()(),e.TgZ(6,"div",39)(7,"mat-tree",40),e.YNc(8,le,7,4,"mat-tree-node",41),e.YNc(9,ce,9,7,"mat-tree-node",42),e.qZA()()()()),2&l){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,4,"lang_document_the_knowledge_units_present_in_the_exam")," "),e.xp6(3),e.Q6J("dataSource",t.dataSource)("treeControl",t.treeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",t.hasChild)}}function me(l,A){1&l&&(e.TgZ(0,"span",58),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&l&&(e.xp6(1),e.hij("(",e.lcZ(2,1,"lang_document_current"),")"))}const he=function(l){return{"font-medium":l}};function de(l,A){if(1&l&&(e.TgZ(0,"div",53)(1,"div",54),e._UZ(2,"input",55),e.TgZ(3,"label",56)(4,"span"),e._uU(5),e.ALo(6,"mytranslate"),e.qZA(),e.YNc(7,me,3,3,"span",57),e.qZA()()()),2&l){const t=A.index,o=e.oxw();e.xp6(2),e.s9C("id","week-"+o.listWeek[t]),e.Q6J("formControlName",t),e.xp6(1),e.s9C("for","week-"+o.listWeek[t]),e.Q6J("ngClass",e.VKq(8,he,o.currentSchoolWeeks===o.listWeek[t])),e.xp6(2),e.Oqu(e.lcZ(6,6,"lang_document_week")+" "+o.listWeek[t]),e.xp6(2),e.Q6J("ngIf",o.currentSchoolWeeks===o.listWeek[t])}}function pe(l,A){1&l&&(e.TgZ(0,"div",59)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_document_please_select_the_time_of_use")))}class ge{}class fe{}let _e=(()=>{class l extends Z.Q{constructor(t){super(),this.timeService=t,this.listKnowledge=[],this.listWeek=[],this.emitChooseKnowledge=new e.vpe,this.formArrayListKnowledge=new s.Oe([]),this.formArrayListWeed=new s.Oe([]),this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.selectedParent=null,this.newItemName="",this.checklistSelection=new F.Ov(!0),this.listKnowledgeId=[],this.currentSchoolWeeks=0,this.checkChooseWeeks=!0,this.isCheckAllWeeks=!1,this.isCheckSemesterOne=!1,this.isCheckSemesterTwo=!1,this.getLevel=o=>o.level??0,this.isExpandable=o=>o.expandable??!1,this.getChildren=o=>o.children??[],this.hasChild=(o,n)=>n.expandable??!1,this.hasNoContent=(o,n)=>""===n.item,this.transformer=(o,n)=>{const i=this.nestedNodeMap.get(o),m=i&&i.item===o.item?i:new fe;return m.item=o.item,m.level=n,m.id=o.id,m.expandable=!!o.children,this.flatNodeMap.set(m,o),this.nestedNodeMap.set(o,m),m},this.treeFlattener=new J.JZ(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new H.C2(this.getLevel,this.isExpandable),this.dataSource=new J.kc(this.treeControl,this.treeFlattener)}ngOnInit(){super.ngOnInit(),this.initWeedCheckbox(this.listWeek),this.currentSchoolWeeks=this.timeService.getSchoolWeeks(),this.checklistSelection.changed.subscribe(t=>{let o=this.checklistSelection.selected.map(n=>n.id??0);this.listKnowledgeId=o.sort((n,i)=>n-i)??[],this.emitChooseKnowledge.emit(this.listKnowledgeId)}),this.form.controls.weeks.valueChanges.subscribe(t=>{this.checkChooseWeeks=!0,this.calculateIsCheckAll(),t.forEach(o=>{o&&(this.checkChooseWeeks=!1)})})}ngOnChanges(){this.initForm(),this.initKnowledgeCheckbox(this.listKnowledge),this.dataSource.data=this.buildFileTree(this.listKnowledge,0)}buildFileTree(t,o){const n=[];return t.forEach(i=>{const m=new ge;m.item=i.name,m.id=i.id,i.children&&(m.children=this.buildFileTree(i.children,o+1)),n.push(m)}),n}descendantsAllSelected(t){return this.treeControl.getDescendants(t).every(n=>this.checklistSelection.isSelected(n))}descendantsPartiallySelected(t){return this.treeControl.getDescendants(t).some(i=>this.checklistSelection.isSelected(i))&&!this.descendantsAllSelected(t)}todoItemSelectionToggle(t){this.checklistSelection.toggle(t);const o=this.treeControl.getDescendants(t);this.checklistSelection.isSelected(t)?this.checklistSelection.select(...o):this.checklistSelection.deselect(...o)}initKnowledgeCheckbox(t){this.formArrayListKnowledge.clear();for(let o=0;o<t.length;o++){const i=new s.NI(!1,{nonNullable:!0});this.formArrayListKnowledge.push(i)}}initWeedCheckbox(t){this.formArrayListWeed.clear();for(let o=0;o<t.length;o++){const i=new s.NI(!1,{nonNullable:!0});this.formArrayListWeed.push(i)}}initForm(){this.formArrayListWeed=this.form.controls.weeks,this.formArrayListKnowledge=this.form.controls.knowledgeIds}toggleAllCheckBox(t){let o=t.target.checked;if(this.isCheckSemesterOne=o,this.isCheckSemesterTwo=o,this.formArrayListWeed)for(var n=0;n<this.formArrayListWeed.controls.length;n++)this.formArrayListWeed.controls[n].setValue(o);this.calculateIsCheckAll()}toggleSemesterOneCheckBox(t){let o=t.target.checked;if(this.formArrayListWeed)for(var n=0;n<this.formArrayListWeed.controls.length;n++)n<18&&this.formArrayListWeed.controls[n].setValue(o);this.calculateIsCheckAll()}toggleSemesterTwoCheckBox(t){let o=t.target.checked;if(this.formArrayListWeed)for(var n=0;n<this.formArrayListWeed.controls.length;n++)n>=18&&this.formArrayListWeed.controls[n].setValue(o);this.calculateIsCheckAll()}calculateIsCheckAll(){let t=!0;for(var o=0;o<this.formArrayListWeed.controls.length;o++)this.formArrayListWeed.controls[o].value||(t=!1);this.isCheckAllWeeks=t}}return l.\u0275fac=function(t){return new(t||l)(e.Y36($.D))},l.\u0275cmp=e.Xpm({type:l,selectors:[["azt-config-document-market"]],inputs:{form:"form",listKnowledge:"listKnowledge",listWeek:"listWeek"},outputs:{emitChooseKnowledge:"emitChooseKnowledge"},features:[e.qOj,e.TTD],decls:48,vars:32,consts:[[1,"mt-5"],[3,"formGroup"],[1,"box","p-3"],[1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-5"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["type","radio","id","creator-by-me","formControlName","creatorId","value","1",1,"form-check-input"],["for","creator-by-me",1,"form-check-label"],["type","radio","id","creator-by-user-other","formControlName","creatorId","value","0",1,"form-check-input"],["for","creator-by-user-other",1,"form-check-label"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["formArrayName","weeks",1,"list-week","grid","grid-cols-12"],[1,"col-span-12","flex","items-center"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"list-week","col-span-12","mt-1"],[1,"flex","flex-row","sm:flex-col","sm:items-center"],[1,"azt-form-check","mr-5","mt-3","sm:mt-0"],["type","checkbox","id","selectAllWeeks",1,"form-check-input",3,"checked","value","change"],["for","selectAllWeeks",1,"form-check-label"],["type","checkbox","id","selectSemesterOne",1,"form-check-input",3,"checked","value","change"],["for","selectSemesterOne",1,"form-check-label"],["type","checkbox","id","selectSemesterTwo",1,"form-check-input",3,"checked","value","change"],["for","selectSemesterTwo",1,"form-check-label"],[1,"grid","grid-cols-12","gap-3","mt-3"],["class","col-span-6 md:col-span-3 lg:col-span-2",4,"ngFor","ngForOf"],["class","col-span-12 mt-2 text-danger text-xs",4,"ngIf"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12"],["type","text","name","creatorFullName","formControlName","creatorFullName",1,"form-control",3,"placeholder"],["class","text-danger text-xs mt-2",4,"ngIf"],[1,"col-span-12","md:col-span-4"],["type","text","appOnlyNumber","","name","creatorPhone","formControlName","creatorPhone",1,"form-control",3,"placeholder"],[1,"col-span-12","md:col-span-8"],["type","text","name","creatorWorkingAddress","formControlName","creatorWorkingAddress",1,"form-control",3,"placeholder"],[1,"text-danger","text-xs","mt-2"],[1,"list-knowledge","col-span-12"],[3,"dataSource","treeControl"],["matTreeNodeToggle","","matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle","","matTreeNodePadding",""],["mat-icon-button","","disabled",""],[1,"azt-form-checked"],["type","checkbox",1,"form-check-input",3,"checked","id","change"],[1,"form-check-label",2,"vertical-align","middle",3,"for"],["matTreeNodePadding",""],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror","w-5","h-5","inline-block",2,"vertical-align","bottom"],[3,"name"],["type","checkbox",1,"form-check-input",3,"checked","indeterminate","id","change"],[1,"col-span-6","md:col-span-3","lg:col-span-2"],[1,"azt-form-check"],["type","checkbox","value","41556",1,"form-check-input",3,"formControlName","id"],[1,"form-check-label",2,"vertical-align","middle",3,"ngClass","for"],["class","inline-block ml-1",4,"ngIf"],[1,"inline-block","ml-1"],[1,"col-span-12","mt-2","text-danger","text-xs"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e._uU(6),e.ALo(7,"mytranslate"),e.qZA()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8),e._UZ(11,"input",9),e.TgZ(12,"label",10),e._uU(13),e.ALo(14,"mytranslate"),e.qZA()(),e.TgZ(15,"div",8),e._UZ(16,"input",11),e.TgZ(17,"label",12),e._uU(18),e.ALo(19,"mytranslate"),e.qZA()()()()(),e.YNc(20,re,15,13,"div",13),e.YNc(21,ue,10,6,"div",13),e.TgZ(22,"div",14)(23,"div",15)(24,"div",16)(25,"span",17),e._uU(26),e.ALo(27,"mytranslate"),e.qZA()(),e.TgZ(28,"div",18)(29,"div",19)(30,"div",20)(31,"input",21),e.NdJ("change",function(i){return o.toggleAllCheckBox(i)}),e.qZA(),e.TgZ(32,"label",22),e._uU(33),e.ALo(34,"mytranslate"),e.qZA()(),e.TgZ(35,"div",20)(36,"input",23),e.NdJ("change",function(i){return o.toggleSemesterOneCheckBox(i)}),e.qZA(),e.TgZ(37,"label",24),e._uU(38),e.ALo(39,"mytranslate"),e.qZA()(),e.TgZ(40,"div",20)(41,"input",25),e.NdJ("change",function(i){return o.toggleSemesterTwoCheckBox(i)}),e.qZA(),e.TgZ(42,"label",26),e._uU(43),e.ALo(44,"mytranslate"),e.qZA()()(),e.TgZ(45,"div",27),e.YNc(46,de,8,10,"div",28),e.qZA()(),e.YNc(47,pe,4,3,"div",29),e.qZA()()()()()),2&t&&(e.xp6(1),e.Q6J("formGroup",o.form),e.xp6(5),e.hij(" ",e.lcZ(7,18,"lang_document_author")," "),e.xp6(7),e.hij(" ",e.lcZ(14,20,"lang_document_me")," "),e.xp6(5),e.hij(" ",e.lcZ(19,22,"lang_document_others")," "),e.xp6(2),e.Q6J("ngIf","0"==o.form.controls.creatorId.value),e.xp6(1),e.Q6J("ngIf",o.formArrayListKnowledge.controls.length),e.xp6(5),e.hij(" ",e.lcZ(27,24,"lang_document_time_of_use")," "),e.xp6(5),e.Q6J("checked",o.isCheckAllWeeks)("value",o.isCheckAllWeeks),e.xp6(2),e.hij(" ",e.lcZ(34,26,o.isCheckAllWeeks?"lang_student_classroom_list_utils_create_class_new_course_disable":"lang_student_classroom_list_utils_create_class_new_course_choose_all")," "),e.xp6(3),e.Q6J("checked",o.isCheckSemesterOne)("value",o.isCheckSemesterOne),e.xp6(2),e.hij(" ",e.lcZ(39,28,"lang_config_semester")+" 1"," "),e.xp6(3),e.Q6J("checked",o.isCheckSemesterTwo)("value",o.isCheckSemesterTwo),e.xp6(2),e.hij(" ",e.lcZ(44,30,"lang_config_semester")+" 2"," "),e.xp6(3),e.Q6J("ngForOf",o.formArrayListWeed.controls),e.xp6(1),e.Q6J("ngIf",o.checkChooseWeeks))},dependencies:[x.mk,x.sg,x.O5,X.RK,J.fQ,J.ah,J.eu,J.gi,J.uo,s._Y,s.Fj,s.Wl,s._,s.JJ,s.JL,s.sg,s.u,s.CE,G.Nh5,V.Y,h.M,M.JV],encapsulation:2}),l})();function ve(l,A){1&l&&e._UZ(0,"azt-loading-effect")}function be(l,A){1&l&&(e.TgZ(0,"div",28),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&l&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"lang_auto_vui_long_nhap_ten_de_thi")," "))}function Se(l,A){if(1&l){const t=e.EpF();e.ynx(0),e.TgZ(1,"config-level-subject",29),e.NdJ("sendLogPredictSubject",function(n){e.CHM(t);const i=e.oxw(2);return e.KtG(i.getLogPredictSubject(n))}),e.qZA(),e.BQk()}if(2&l){const t=e.oxw(2);e.xp6(1),e.Q6J("form",t.form)("questionContents",t.questionContent)("schoolLevelObjs",t.schoolLevelObjs)}}function Ce(l,A){if(1&l&&e._UZ(0,"config-level-subject",30),2&l){const t=e.oxw(2);e.Q6J("form",t.form)("schoolLevelObjs",t.schoolLevelObjs)}}function xe(l,A){1&l&&(e.TgZ(0,"span",31),e._UZ(1,"azt-loading-ui"),e.qZA())}function je(l,A){if(1&l){const t=e.EpF();e.TgZ(0,"div",3)(1,"form",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"div",8)(6,"div",9)(7,"label",10),e._uU(8),e.ALo(9,"mytranslate"),e.qZA()(),e.TgZ(10,"div",9)(11,"div",11),e._UZ(12,"input",12),e.ALo(13,"mytranslate"),e.qZA(),e.YNc(14,be,3,3,"div",13),e.qZA()(),e.TgZ(15,"div",14),e.YNc(16,Se,2,3,"ng-container",0),e.YNc(17,Ce,1,2,"ng-template",null,15,e.W1O),e.qZA(),e.TgZ(19,"div",16),e._UZ(20,"config-purpose-exam",17),e.qZA(),e.TgZ(21,"div",18)(22,"div",9)(23,"label",19),e._uU(24),e.ALo(25,"mytranslate"),e.qZA()(),e.TgZ(26,"div",9)(27,"div",11),e._UZ(28,"textarea",20),e.ALo(29,"mytranslate"),e.qZA()()()(),e.TgZ(30,"div",21)(31,"azt-config-document-market",22),e.NdJ("emitChooseKnowledge",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.chooseKnowledge(n))}),e.qZA()(),e.TgZ(32,"div",23)(33,"div",24)(34,"button",25),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancelSaveDocumentObj())}),e._uU(35),e.ALo(36,"mytranslate"),e.qZA(),e.TgZ(37,"button",26),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.handleSaveDocument())}),e.YNc(38,xe,2,0,"span",27),e._uU(39),e.ALo(40,"mytranslate"),e.qZA()()()()()()()}if(2&l){const t=e.MAs(18),o=e.oxw();e.xp6(1),e.Q6J("formGroup",o.form),e.xp6(7),e.hij(" ",e.lcZ(9,17,"lang_auto_ten")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(13,19,"lang_auto_nhap_ten")+" ..."),e.xp6(2),e.Q6J("ngIf",o.form.controls.name.errors),e.xp6(2),e.Q6J("ngIf",o.isCreateQuestionToEditor)("ngIfElse",t),e.xp6(4),e.Q6J("purposeList",o.listPurposeObjs)("form",o.form),e.xp6(4),e.hij(" ",e.lcZ(25,21,"lang_auto_mo_ta")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(29,23,"lang_core_nhap_mo_ta")+" ..."),e.xp6(3),e.Q6J("form",o.form)("listWeek",o.listWeek)("listKnowledge",o.listKnowledge),e.xp6(4),e.hij(" ",e.lcZ(36,25,"lang_auto_huy")," "),e.xp6(2),e.Q6J("disabled",o.logConfig.status),e.xp6(1),e.Q6J("ngIf",o.logConfig.status),e.xp6(1),e.hij(" ",e.lcZ(40,27,"lang_auto_luu")," ")}}function Ae(l,A){if(1&l&&(e.TgZ(0,"div",32)(1,"div",33)(2,"div",34)(3,"span",35),e._UZ(4,"azt-loading-ui"),e.qZA(),e.TgZ(5,"div",36),e._uU(6),e.qZA()()()()),2&l){const t=e.oxw();e.xp6(6),e.Oqu(t.logConfig.msg)}}let Oe=(()=>{class l extends Z.Q{getLogPredictSubject(t){this.predictLogRequestObj=t}chooseKnowledge(t){this.knowledgeList=t}cancelSaveDocumentObj(){this.onBack.emit(!0)}handleSaveDocument(){const t=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);if(this.checkErrorValidateSave(t,this.knowledgeList))this.showErrorSnack("lang_cms_utils_folder_name_validate_space");else{if(this.type===a.R.exam&&this.isCreateQuestionToEditor&&this.dataSave.exam&&this.dataSave.exam.questionObj.listQuestions){this.logConfig.status=!0,this.logConfig.msg=this.commonService.myTranslateInstant("lang_auto_dang_luu_du_lieu_de_thi")??"",this.countProcess=0;const o=this.dataSave.exam.questionObj.listQuestions;let n=this.commonService.myTranslateInstant("lang_auto_xay_ra_loi_trong_qua_trinh_xu_ly_hinh_anh_cua_de_thi")??"";this.questionShareSaveService.convertQuestions(o,this.dataSave.exam.rootQuests,(i,m=n,_)=>{this.logConfig.status=!1,this.logConfig.msg="",this.showErrorSnack(m),_&&this.stopStatusObj()}).then(()=>{this.startMainProcessSaveEditor()})}this.type===a.R.exam&&!this.isCreateQuestionToEditor&&this.examObj?.id&&this.saveDocumentMarketQuestionObjs(),this.type!==a.R.exam&&this.attachments.length&&this.saveDocumentMarketQuestionObjs(),console.log(this.attachments,this.type)}}initQuestionShare(){this.questionShareSaveService.callbackBase64ToCanvas=(t,o)=>{let n=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.msg=`${n} ${Math.floor(t/o*100*.7)}%`},this.questionShareSaveService.callbackUploadImage=(t,o)=>{let n=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.msg=`${n} ${Math.floor(t/o*100*.3)+70}%`}}processSaveQuestionsFromEditor(t,o,n){if(this.dataSave.exam?.questionObj&&this.dataSave.exam?.questionObj.listQuestions){var i=this.dataSave.exam?.questionObj.listQuestions.length;let m=t+100>i?i:t+100,_=this.dataSave.exam?.questionObj.listQuestions.slice(t,m)??[],T=[];for(const p of _)T.push({categoryId:p.categoryId,groupId:p.groupId,name:p.name??"none",metadata:p.metadata,isImage:p.isImage,questionContent:p.questionContent,answerMedia:p.answerMedia,questionText:p.questionText,answerType:p.answerType,answerConfig:p.answerConfig,coordinates:p.coordinates,answerResult:p.answerResult,totalQuestion:p.totalQuestion,tags:p.tags??[],mediaId:p.mediaId,mediaMeta:p.mediaMeta,attachments:p.attachments,version:p.version,isFixAns:p.isFixAns,groupType:p.groupType,__path:p.__path});T.length>0?this.sAztSaveProcessService.saveQuestionObjsFromEditor(this.dataSave,T,o).then(p=>{p&&p.listQuestionId.length>0?(n.listQuestionId=n.listQuestionId.concat(p.listQuestionId),this.processSaveQuestionsFromEditor(m,p.indexSaved,n)):(this.countProcess=0,this.logConfig.status=!1,this.logConfig.msg="",this.showErrorSnack("lang_auto_khong_luu_duoc_noi_dung_cau_hoi_trong_de_vui_long_kiem_tra_lai"))}):this.saveDocumentMarketQuestionObjs(n)}}startMainProcessSaveEditor(){this.dataSave.exam&&this.dataSave.exam.questionObj&&this.processSaveQuestionsFromEditor(0,0,{indexSaved:0,listQuestionId:[]})}GetSubjectAndLevel(){this.initStatusObj(),this.waitDestroy(this.commonListService.apiCommonListSubjectAndLevelsGet(this.commonService.getBusinessDomainUrl()).subscribe(t=>{1==t.success?(this.examSchoolLogObj=t.data?.examSchoolLogObj,this.schoolLevelObjs=t.data?.schoolLevelSubjectObjs??[],this.getListPurposeExam()):this.errorStatusObj(t.message??"")}))}getListPurposeExam(){this.initStatusObj(),this.waitDestroy(this.commonListService.apiCommonListExamPurposesGet().subscribe(t=>{t.success?(this.listPurposeObjs=t.data?.objs??[],this.successStatusObj()):this.errorStatusObj(t.message??"",!0)}))}getKnowledgeData(){const t=this.form.controls.schoolLevel.value,o=this.form.controls.schoolSubject.value;t&&o&&this.waitDestroy(this.knowledgeService.apiKnowledgeGet(t,o).subscribe(n=>{n.list&&(this.listKnowledge=n.list)}))}checkErrorValidateSave(t,o){return!(!this.form.invalid&&("0"!=this.form.controls.creatorId.value||this.form.controls.creatorFullName.value&&this.form.controls.creatorFullName.value&&this.form.controls.creatorPhone.value&&this.form.controls.creatorWorkingAddress.value)&&("0"!=this.form.controls.creatorId.value||10===this.form.controls.creatorPhone.value.length)&&t.length)}fillConfig(){const t=Number(this.commonService.getMyParam(this.activeRoute,"levelId")),o=Number(this.commonService.getMyParam(this.activeRoute,"subjectId"));if(this.examObj?.id)this.waitDestroy(this.documentConfigService.apiDocumentConfigGetExamConfigDataGet(this.examObj.hashId??"").subscribe(n=>{if(n.success){const i=n.data?.examObj;this.form.controls.name.setValue(i?.name??""),this.form.controls.description.setValue(i?.description??""),this.form.controls.schoolLevel.setValue(i?.schoolLevelId??t),this.form.controls.schoolSubject.setValue(i?.schoolSubjectId??o),this.form.controls.purposeExam.setValue(n.data?.purposeId??0),this.form.controls.purposeNote.setValue(n.data?.purposeNote??"")}else this.errorStatusObj(n.message??"",!0)}));else if(this.isCreateQuestionToEditor){const n=Number(this.browserStorageService.getSimpleStorage("levelId")??0),i=Number(this.browserStorageService.getSimpleStorage("subjectId")??0);this.form.controls.schoolLevel.setValue(n),this.form.controls.schoolSubject.setValue(i)}else this.form.controls.schoolLevel.setValue(t),this.form.controls.schoolSubject.setValue(o),this.form.controls.name.setValue(this.name)}getWeeksChecked(t,o){let n=[];for(let i=0;i<o.length;i++)o[i]&&t[i]&&n.push(t[i]);return n}createListWeek(){for(let o=0;o<35;o++)this.listWeek.push(o+1)}saveDocumentMarketQuestionObjs(t){const o=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);this.logConfig.status=!0;let n={name:this.form.controls.name.value,type:this.type,schoolLevelId:this.form.controls.schoolLevel.value,schoolSubjectId:this.form.controls.schoolSubject.value,purposeId:this.form.controls.purposeExam.value,purposeNote:this.form.controls.purposeNote.value,description:this.form.controls.description.value,creatorId:Number(this.form.controls.creatorId.value),creatorFullName:this.form.controls.creatorFullName.value,creatorPhone:this.form.controls.creatorPhone.value,creatorWorkingAddress:this.form.controls.creatorWorkingAddress.value,knowledgeIds:this.knowledgeList,weeks:o};switch(this.type){case a.R.exam:if(t&&this.isCreateQuestionToEditor){let i=[];i=t.listQuestionId.map(m=>m??0)??[],n.questionIds=i}this.examObj?.id&&!this.isCreateQuestionToEditor&&(n.examId=this.examObj?.id,n.questionIds=[]);break;case a.R.lecture:case a.R.ref:case a.R.teaching_plan:case a.R.slide:n.attachments=this.attachments}this.waitDestroy(this.documentService.apiDocumentsPost(n).subscribe(i=>{i.id?(this.successStatusObj("lang_document_successful_sharing",!0),this.myNavigation("/document-market/list-documents/your-documents/1")):this.errorStatusObj(""),this.logConfig.status=!0,this.logConfig.msg=""}))}ngOnInit(){if(super.ngOnInit(),this.GetSubjectAndLevel(),this.createListWeek(),this.getKnowledgeData(),this.fillConfig(),this.form.controls.schoolSubject.valueChanges.subscribe(t=>{this.getKnowledgeData()}),this.form.controls.schoolLevel.valueChanges.subscribe(t=>{this.getKnowledgeData()}),this.type===a.R.exam&&this.isCreateQuestionToEditor){this.dataSave=this.editorOutputDataService.getOutputData();const t=25;this.questionContent=[],this.dataSave.exam?.questionObj.listQuestions?.forEach((n,i)=>{i<t&&this.questionContent.push(this.partQuestionSearchTextService.partQuestionSearchTextByQuestionForm(n))}),this.form.controls.name.setValue(this.dataSave.exam?.examObj.name??this.dataSave.homework?.name??"")}}constructor(t,o,n,i,m,_,T,p,ee,L,K){super(),this.documentConfigService=t,this.activeRoute=o,this.examService=n,this.documentService=i,this.knowledgeService=m,this.questionShareSaveService=_,this.editorOutputDataService=T,this.partQuestionSearchTextService=p,this.sAztSaveProcessService=ee,this.browserStorageService=L,this.commonListService=K,this.type=a.R.exam,this.isCreateQuestionToEditor=!1,this.attachments=[],this.name="",this.onBack=new e.vpe,this.schoolLevelObjs=[],this.listPurposeObjs=[],this.listKnowledge=[],this.logConfig={},this.dataSave={},this.saveParts=[],this.questionContent=[],this.countProcess=0,this.knowledgeList=[],this.listWeek=[],this.form=new s.cw({name:new s.NI("",{nonNullable:!0,validators:[s.kI.required,g._.noWhiteSpace]}),description:new s.NI("",{nonNullable:!0}),schoolLevel:new s.NI(0,{nonNullable:!0,validators:[s.kI.required,s.kI.min(1)]}),schoolSubject:new s.NI(0,{nonNullable:!0,validators:[s.kI.required,s.kI.min(1)]}),purposeExam:new s.NI(0,{nonNullable:!0,validators:[s.kI.required,s.kI.min(1)]}),purposeNote:new s.NI("",{nonNullable:!0}),knowledgeIds:new s.Oe([]),weeks:new s.Oe([]),creatorId:new s.NI("1",{nonNullable:!0}),creatorFullName:new s.NI("",{nonNullable:!0}),creatorPhone:new s.NI("",{nonNullable:!0}),creatorWorkingAddress:new s.NI("",{nonNullable:!0})}),this.type===a.R.exam&&this.isCreateQuestionToEditor&&this.initQuestionShare()}}return l.\u0275fac=function(t){return new(t||l)(e.Y36(v.Cq),e.Y36(c.gz),e.Y36(v.Oe),e.Y36(b.Zg),e.Y36(b.zH),e.Y36(I),e.Y36(f.O),e.Y36(S.r),e.Y36(D.a),e.Y36(C.n),e.Y36(d.o7))},l.\u0275cmp=e.Xpm({type:l,selectors:[["azt-config-share-document"]],inputs:{type:"type",isCreateQuestionToEditor:"isCreateQuestionToEditor",attachments:"attachments",name:"name",examObj:"examObj"},outputs:{onBack:"onBack"},features:[e.qOj],decls:4,vars:3,consts:[[4,"ngIf","ngIfElse"],["doneLoading",""],["style","width: 100vw; height: 100vh; position: fixed; z-index: 9999; top: 0; left: 0; display: flex; justify-content: center; align-items: center; background-color: rgba(0, 0, 0, 0.4)",4,"ngIf"],[1,"intro-y","mt-8","p-3"],[3,"formGroup"],[1,"mx-auto",2,"max-width","1100px"],[1,"setting-block"],[1,"box","mt-2","p-3"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","general-name","formControlName","name","type","text",1,"form-control",3,"placeholder"],["class","mt-2 text-danger text-xs fade",4,"ngIf"],[1,"mt-4"],["normal",""],[1,"mt-2"],[3,"purposeList","form"],["id","azt-config-desc",1,"grid","grid-cols-12","mt-4"],["for","general-desc",1,"form-label","mb-0","font-medium","flex","items-center"],["id","general-desc","formControlName","description",1,"form-control","w-full",2,"height","150px",3,"placeholder"],[1,"config-document-market"],[3,"form","listWeek","listKnowledge","emitChooseKnowledge"],[1,"mt-5"],[1,"text-right"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-24","btn-primary",3,"disabled","click"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"mt-2","text-danger","text-xs","fade"],[3,"form","questionContents","schoolLevelObjs","sendLogPredictSubject"],[3,"form","schoolLevelObjs"],[1,"w-4","h-4","mr-2"],[2,"width","100vw","height","100vh","position","fixed","z-index","9999","top","0","left","0","display","flex","justify-content","center","align-items","center","background-color","rgba(0, 0, 0, 0.4)"],[2,"text-align","center","color","#000000"],[2,"margin-bottom","10px"],[1,"w-4","h-4","inline-block"],[2,"font-size","20px","margin-top","10px","background-color","#f0f8ffa3","padding","10px","border-radius","5px"]],template:function(t,o){if(1&t&&(e.YNc(0,ve,1,0,"azt-loading-effect",0),e.YNc(1,je,41,29,"ng-template",null,1,e.W1O),e.YNc(3,Ae,7,1,"div",2)),2&t){const n=e.MAs(2);e.Q6J("ngIf",o.statusObj.loading)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",o.logConfig.status&&o.isCreateQuestionToEditor)}},dependencies:[x.O5,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,u.l,h.M,j.n,W.Z,z.u,_e,M.JV],encapsulation:2}),l})()},40687:(Y,P,r)=>{r.d(P,{a:()=>v});var e=r(65879),s=r(46558),a=r(70731),Z=r(24276),g=r(32169);let v=(()=>{class c{convertBase64OfMathJaxToCdnUrlInQuestions(w,y){return new Promise((E,N)=>{const k=null==y?new a.Q(10):new a.Q(10,{function:y},0);w.forEach(I=>{k.addTask(this.dataAztMathRawHelper,this.dataAztMathRawHelper.convertBase64OfMathJaxToCdnUrl,[I])}),k.start().then(I=>{0===I.errs.length?E(I.datas):N(I.errs[0])})})}saveQuestionObjsFromEditor(w,y,E){return new Promise(N=>{this.convertBase64OfMathJaxToCdnUrlInQuestions(y,void 0).then(k=>{let I=[];for(let f=0;f<k.length;f++){let S=k[f];S.expandInfo=this.commonService.serializeJson(w.exam?.examObj.expandInfoObj),I.push(S)}this.questionService.apiQuestionsPost({listQuestions:I}).subscribe(f=>{N(f.list?{indexSaved:f.list.length+E,listQuestionId:f.list}:{indexSaved:E,listQuestionId:[]})})}).catch(()=>{N({indexSaved:E,listQuestionId:[]})})})}constructor(w,y){this.questionService=w,this.dataAztMathRawHelper=y,this.commonService=(0,e.f3M)(s.z)}}return c.\u0275fac=function(w){return new(w||c)(e.LFG(Z.aE),e.LFG(g.n))},c.\u0275prov=e.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},26425:(Y,P,r)=>{r.d(P,{Z:()=>C});var e=r(65879),s=r(47496),a=function(d){return d[d.DEFAULT=0]="DEFAULT",d[d.ACCEPT=1]="ACCEPT",d[d.NOT_DO_ANYTHING=2]="NOT_DO_ANYTHING",d}(a||{});class Z{acceptPredictSubjectId(x,u){if(!this.predictLogRequestObj)return;let h=this.schoolLevelObjs.find(M=>M.schoolLevel?.id==x),j=h?.schoolLevel?.value??0,W=h?.schoolSubjectObjs.find(M=>M.id==u),z=this.allPredictSubjectObjs.find(M=>!0),F=this.schoolLevelObjs.find(M=>M.schoolSubjectObjs.map(R=>R.id).includes(z?.id??0)),H=z?.from??0,J=z?.to??0;if(!F||!z||!H||!J||W&&this.allPredictSubjectIds.includes(W.id))return;let $=0,X=0;if(h?.schoolLevel?.id&&j>=H&&j<=J){let M=h?.schoolSubjectObjs.find(R=>this.allPredictSubjectIds.includes(R.id));if(M)return $=h.schoolLevel.id,X=M.id,this.predictLogRequestObj.acceptPredictStatus=a.ACCEPT,{schoolLevelId:$,schoolSubjectId:X}}let G=this.allPredictSubjectObjs.find(M=>!0),V=this.schoolLevelObjs.find(M=>M.schoolSubjectObjs.map(R=>R.id).includes(G?.id??0));return G&&V&&V.schoolLevel?.id?(this.predictLogRequestObj.acceptPredictStatus=a.ACCEPT,{schoolLevelId:V.schoolLevel.id,schoolSubjectId:G.id}):void 0}changePredictStatusWhenSubjectIdChanged(x){this.predictLogRequestObj&&(this.predictLogRequestObj.acceptPredictStatus=this.allPredictSubjectIds.includes(x)?a.NOT_DO_ANYTHING:a.DEFAULT)}predictSchoolSubjectByQuestionContent(x,u,h,j){h.length&&u.length&&(this.schoolLevelObjs=u,this.aiService.apiAiPredictSubjectPost({questionContents:h}).subscribe(z=>{if(z.success&&this.predictLogRequestObj){let F=z.data?.schoolSubjectId;if(!F||(this.setAllPredictSubjectIds(F),!this.allPredictSubjectObjs.length))return;this.predictLogRequestObj={predictSchoolSubjectId:F,acceptPredictStatus:a.DEFAULT,predictByTotalQuestion:h.length},this.changePredictStatusWhenSubjectIdChanged(x),j(!0)}else j(!1)}))}setAllPredictSubjectIds(x){let u=this.commonService.concatMultipleArray(this.schoolLevelObjs.map(j=>j.schoolSubjectObjs)),h=u.find(j=>j.id==x)?.key??"";this.allPredictSubjectObjs=u.filter(j=>j.key&&j.key==h),this.allPredictSubjectIds=this.allPredictSubjectObjs.map(j=>j.id),this.predictSubjectKey=this.allPredictSubjectObjs.find(j=>!0)?.key??""}constructor(x,u){this.commonService=x,this.aiService=u,this.predictLogRequestObj=void 0,this.allPredictSubjectIds=[],this.predictSubjectKey="",this.allPredictSubjectObjs=[],this.schoolLevelObjs=[]}}var g=r(64728),v=r(96814),c=r(23680),b=r(64170),w=r(98525),y=r(56223),E=r(67679),N=r(36727);let k=(()=>{class d{transform(u,h){if(!u)return"";const j=u.find(z=>z.id==h);return j?j.key??"":""}}return d.\u0275fac=function(u){return new(u||d)},d.\u0275pipe=e.Yjl({name:"aztFindSchoolSubjectById",type:d,pure:!0}),d})();function I(d,x){if(1&d&&(e.TgZ(0,"mat-option",15),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&d){const u=x.$implicit;e.Q6J("value",null==u.schoolLevel?null:u.schoolLevel.id),e.xp6(1),e.hij(" ",e.lcZ(2,2,null==u.schoolLevel?null:u.schoolLevel.key)," ")}}function f(d,x){if(1&d&&(e.TgZ(0,"mat-option",15),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&d){const u=x.$implicit;e.Q6J("value",u.id),e.xp6(1),e.hij(" ",e.lcZ(2,2,u.key)," ")}}function S(d,x){1&d&&(e.TgZ(0,"div",16),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&d&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"lang_auto_vui_long_chon_khoi_hoc_va_mon_hoc")," "))}function D(d,x){if(1&d){const u=e.EpF();e.TgZ(0,"div",17)(1,"div",18)(2,"span"),e._uU(3),e.ALo(4,"mytranslate"),e.ALo(5,"mytranslate"),e.ALo(6,"mytranslate"),e.ALo(7,"mytranslate"),e.ALo(8,"mytranslate"),e.ALo(9,"aztFindSchoolSubjectById"),e.qZA(),e.TgZ(10,"a",19),e.NdJ("click",function(){e.CHM(u);const j=e.oxw();return e.KtG(j.acceptPredictSubjectEvent())}),e._uU(11),e.ALo(12,"mytranslate"),e.qZA()()()}if(2&d){const u=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,2,"lang_testbank_please_double_check_the_subject_for_accuracy")+". "+e.lcZ(5,4,"lang_testbank_the_system_recognizes_your_subject_as_a_subject")+" "+e.lcZ(6,6,u.sAztPredictLevelAndSubjectService.predictSubjectKey)+", "+e.lcZ(7,8,"lang_testbank_you_are_choosing_subject")+" "+e.lcZ(8,10,e.xi3(9,12,u.schoolSubjectObjs,u.form.controls.schoolSubject.value))+". "," "),e.xp6(8),e.hij(" ",e.lcZ(12,15,"lang_testbank_click_here_to_change_it_to_the_correct_one")+"."," ")}}let C=(()=>{class d extends s.Q{changeSchoolLevelIdEvent(u){let h=this.schoolLevelObjs.find(W=>W.schoolLevel?.id==u);if(!h)return this.form?.controls.schoolSubject.setValue(0);this.schoolSubjectObjs=h?.schoolSubjectObjs??[];let j=this.form.getRawValue();return this.schoolSubjectObjs.map(W=>W.id).includes(j.schoolSubject)?void 0:this.form?.controls.schoolSubject.setValue(0)}acceptPredictSubjectEvent(){let u=this.form.getRawValue(),h=this.sAztPredictLevelAndSubjectService.acceptPredictSubjectId(u.schoolLevel,u.schoolSubject);h&&(this.form?.controls.schoolLevel.setValue(h.schoolLevelId),this.form?.controls.schoolSubject.setValue(h.schoolSubjectId),this.sendLogPredictSubject.emit(this.sAztPredictLevelAndSubjectService.predictLogRequestObj))}updateLevelAndSubjectToForm(u,h){let j=this.schoolLevelObjs.find(F=>F.schoolLevel?.id==u),W=j?.schoolSubjectObjs.find(F=>F.id==h);j||(u=0),W||(h=0);let z=this.form.getRawValue();z.schoolLevel!=u&&this.form.controls.schoolLevel.setValue(u),z.schoolSubject!=h&&this.form.controls.schoolSubject.setValue(h),this.schoolSubjectObjs=j?.schoolSubjectObjs??[]}initData(){let u=this.form.getRawValue();return u.schoolLevel&&u.schoolSubject?this.updateLevelAndSubjectToForm(u.schoolLevel,u.schoolSubject):this.examSchoolLogObj?this.updateLevelAndSubjectToForm(this.examSchoolLogObj.lastSchoolLevelId??0,this.examSchoolLogObj.lastSchoolSubjectId??0):void this.updateLevelAndSubjectToForm(u.schoolLevel,u.schoolSubject)}ngOnChanges(){this.initData()}ngOnInit(){const u=Number(this.commonService.getMyQueryParam("levelId")),h=Number(this.commonService.getMyQueryParam("subjectId"));u&&h&&(this.form.controls.schoolLevel.setValue(u),this.form.controls.schoolSubject.setValue(h)),this.form?.controls.schoolSubject?.valueChanges.subscribe(()=>{this.sAztPredictLevelAndSubjectService.changePredictStatusWhenSubjectIdChanged(this.form.controls.schoolSubject.value),this.sAztPredictLevelAndSubjectService.predictLogRequestObj&&this.sendLogPredictSubject.emit(this.sAztPredictLevelAndSubjectService.predictLogRequestObj)})}constructor(u){super(),this.aiService=u,this.schoolLevelObjs=[],this.questionContents=[],this.sendLogPredictSubject=new e.vpe,this.schoolSubjectObjs=[],this.sAztPredictLevelAndSubjectService=new Z(this.commonService,this.aiService)}}return d.\u0275fac=function(u){return new(u||d)(e.Y36(g.p))},d.\u0275cmp=e.Xpm({type:d,selectors:[["config-level-subject"]],inputs:{form:"form",examSchoolLogObj:"examSchoolLogObj",schoolLevelObjs:"schoolLevelObjs",questionContents:"questionContents"},outputs:{sendLogPredictSubject:"sendLogPredictSubject"},features:[e.qOj,e.TTD],decls:28,vars:19,consts:[[1,"config-level-subject"],[3,"formGroup"],["id","azt-config-level-subject",1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-6"],[1,"font-medium"],["for","schoolLevel",1,"form-label","flex","items-center"],["appearance","outline"],["formControlName","schoolLevel","name","schoolLevel",3,"selectionChange"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["for","schoolSubject",1,"form-label","flex","items-center"],["id","schoolSubject","formControlName","schoolSubject","name","schoolSubject"],[1,"col-span-12",2,"margin-top","-20px"],["class","text-xs mt-2 text-danger",4,"ngIf"],["class","col-span-12","style","margin-top: -32px",4,"ngIf"],[3,"value"],[1,"text-xs","mt-2","text-danger"],[1,"col-span-12",2,"margin-top","-32px"],[1,"text-xs","text-pending","font-medium"],[1,"btn-text-primary","font-medium",3,"click"]],template:function(u,h){1&u&&(e.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e._uU(6),e.ALo(7,"mytranslate"),e.qZA()(),e.TgZ(8,"mat-form-field",6)(9,"mat-select",7),e.NdJ("selectionChange",function(){return h.changeSchoolLevelIdEvent(h.form.controls.schoolLevel.value)}),e.TgZ(10,"mat-option",8),e._uU(11),e.ALo(12,"mytranslate"),e.qZA(),e.YNc(13,I,3,4,"mat-option",9),e.qZA()()(),e.TgZ(14,"div",3)(15,"div",4)(16,"label",10),e._uU(17),e.ALo(18,"mytranslate"),e.qZA()(),e.TgZ(19,"mat-form-field",6)(20,"mat-select",11)(21,"mat-option",8),e._uU(22),e.ALo(23,"mytranslate"),e.qZA(),e.YNc(24,f,3,4,"mat-option",9),e.qZA()()(),e.TgZ(25,"div",12),e.YNc(26,S,3,3,"div",13),e.qZA(),e.YNc(27,D,13,17,"div",14),e.qZA()()()),2&u&&(e.xp6(1),e.Q6J("formGroup",h.form),e.xp6(5),e.hij(" ",e.lcZ(7,11,"lang_auto_khoi_hoc")," "),e.xp6(4),e.Q6J("value",0),e.xp6(1),e.hij("",e.lcZ(12,13,"lang_auto_---chon_khoi"),"---"),e.xp6(2),e.Q6J("ngForOf",h.schoolLevelObjs),e.xp6(4),e.hij(" ",e.lcZ(18,15,"lang_auto_mon_hoc")," "),e.xp6(4),e.Q6J("value",0),e.xp6(1),e.hij("",e.lcZ(23,17,"lang_auto_---chon_mon"),"---"),e.xp6(2),e.Q6J("ngForOf",h.schoolSubjectObjs),e.xp6(2),e.Q6J("ngIf",(null==h.form||null==h.form.controls||null==h.form.controls.schoolLevel?null:h.form.controls.schoolLevel.invalid)||(null==h.form||null==h.form.controls||null==h.form.controls.schoolSubject?null:h.form.controls.schoolSubject.invalid)),e.xp6(1),e.Q6J("ngIf",h.sAztPredictLevelAndSubjectService.predictLogRequestObj&&!h.sAztPredictLevelAndSubjectService.allPredictSubjectIds.includes(h.form.controls.schoolSubject.value)&&h.form.controls.schoolSubject.value))},dependencies:[v.sg,v.O5,c.ey,b.KE,w.gD,y._Y,y.JJ,y.JL,y.sg,y.u,E.M,N.JV,k],encapsulation:2}),d})()},18727:(Y,P,r)=>{r.d(P,{u:()=>f});var e=r(47496),s=r(65879),a=r(96814),Z=r(23680),g=r(64170),v=r(98525),c=r(56223),b=r(67679),w=r(36727);function y(S,D){if(1&S&&(s.TgZ(0,"mat-option",14),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&S){const C=D.$implicit;s.Q6J("value",C.id),s.xp6(1),s.hij(" ",s.lcZ(2,2,C.code)," ")}}function E(S,D){if(1&S&&(s.TgZ(0,"mat-optgroup",12),s.ALo(1,"mytranslate"),s.YNc(2,y,3,4,"mat-option",13),s.qZA()),2&S){const C=D.$implicit;s.s9C("label",s.lcZ(1,2,C.groupName)),s.xp6(2),s.Q6J("ngForOf",C.purposeListInGroup)}}function N(S,D){1&S&&(s.TgZ(0,"div",15),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&S&&(s.xp6(1),s.hij(" ",s.lcZ(2,1,"lang_testbank_please_choose_purpose_exam")," "))}function k(S,D){1&S&&(s.TgZ(0,"div",15),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&S&&(s.xp6(1),s.hij(" ",s.lcZ(2,1,"lang_testbank_please_enter_purpose_create_exam")," "))}function I(S,D){if(1&S&&(s.TgZ(0,"div",3)(1,"div",4)(2,"label",16),s._uU(3),s.ALo(4,"mytranslate"),s.qZA()(),s.TgZ(5,"div",17),s._UZ(6,"input",18),s.ALo(7,"mytranslate"),s.qZA(),s.YNc(8,k,3,3,"div",10),s.qZA()),2&S){const C=s.oxw();s.xp6(3),s.hij(" ",s.lcZ(4,3,"lang_testbank_enter_create_exam_target")," "),s.xp6(3),s.s9C("placeholder",s.lcZ(7,5,"lang_testbank_enter_create_exam_target")+" ..."),s.xp6(2),s.Q6J("ngIf",(4==(null==C.form.controls.purposeExam?null:C.form.controls.purposeExam.value)||8==(null==C.form.controls.purposeExam?null:C.form.controls.purposeExam.value)||12==(null==C.form.controls.purposeExam?null:C.form.controls.purposeExam.value))&&""===(null==C.form.controls.purposeNote||null==C.form.controls.purposeNote.value?null:C.form.controls.purposeNote.value.trim()))}}let f=(()=>{class S extends e.Q{convertPurposeList(){this.targetExamGroupObjs=[],this.purposeList.forEach(C=>{const{semester:d}=C;let x=this.targetExamGroupObjs.find(u=>u.semester===d);x||(x={semester:d,groupName:this.getGroupNamePurpose(C.semester??1),purposeListInGroup:[]},this.targetExamGroupObjs.push(x)),x.purposeListInGroup?.push(C)})}getGroupNamePurpose(C){switch(C){case 1:default:return"lang_testbank_semester_one";case 2:return"lang_testbank_semester_two";case 3:return"lang_testbank_another_purpose"}}ngOnInit(){this.convertPurposeList()}constructor(){super(),this.purposeList=[],this.targetExamGroupObjs=[]}}return S.\u0275fac=function(C){return new(C||S)},S.\u0275cmp=s.Xpm({type:S,selectors:[["config-purpose-exam"]],inputs:{form:"form",purposeList:"purposeList"},features:[s.qOj],decls:16,vars:11,consts:[[1,"config-purpose-exan"],[3,"formGroup"],["id","azt-config-purpose-exam",1,"grid","grid-cols-12","gap-5"],[1,"col-span-12"],[1,"font-medium"],[1,"form-label","flex","items-center"],["appearance","outline"],["formControlName","purposeExam","name","purposeExam"],["disabled","",3,"value"],[3,"label",4,"ngFor","ngForOf"],["class","mt-2 text-danger text-xs",4,"ngIf"],["class","col-span-12",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mt-2","text-danger","text-xs"],["for","enter_target_create_exam",1,"form-label","flex","items-center"],[1,"setting-input"],["id","enter_target_create_exam","formControlName","purposeNote","type","text",1,"form-control",3,"placeholder"]],template:function(C,d){1&C&&(s.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),s._uU(6),s.ALo(7,"mytranslate"),s.qZA()(),s.TgZ(8,"mat-form-field",6)(9,"mat-select",7)(10,"mat-option",8),s._uU(11),s.ALo(12,"mytranslate"),s.qZA(),s.YNc(13,E,3,4,"mat-optgroup",9),s.qZA()(),s.YNc(14,N,3,3,"div",10),s.qZA(),s.YNc(15,I,9,7,"div",11),s.qZA()()()),2&C&&(s.xp6(1),s.Q6J("formGroup",d.form),s.xp6(5),s.hij(" ",s.lcZ(7,7,"lang_testbank_target_exam")," "),s.xp6(4),s.Q6J("value",0),s.xp6(1),s.hij("---",s.lcZ(12,9,"lang_testbank_choose_purpose"),"---"),s.xp6(2),s.Q6J("ngForOf",d.targetExamGroupObjs),s.xp6(1),s.Q6J("ngIf",0==d.form.controls.purposeExam.value),s.xp6(1),s.Q6J("ngIf",4==(null==d.form.controls.purposeExam?null:d.form.controls.purposeExam.value)||8==(null==d.form.controls.purposeExam?null:d.form.controls.purposeExam.value)||12==(null==d.form.controls.purposeExam?null:d.form.controls.purposeExam.value)))},dependencies:[a.sg,a.O5,Z.ey,Z.Nv,g.KE,v.gD,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,b.M,w.JV],encapsulation:2}),S})()},89310:(Y,P,r)=>{r.d(P,{P:()=>N});var e=r(37398),s=r(47496),a=r(65879),Z=r(97151),g=r(46558),v=r(69862),c=r(96814),b=r(36727);function w(k,I){if(1&k){const f=a.EpF();a.ynx(0),a.TgZ(1,"a",2),a.NdJ("click",function(){a.CHM(f);const D=a.oxw();return a.KtG(D.shareFileToFlutter())}),a.TgZ(2,"span"),a._uU(3),a.ALo(4,"mytranslate"),a.qZA(),a.Hsn(5),a.qZA(),a.BQk()}if(2&k){const f=a.oxw();a.xp6(1),a.Akn(f.style),a.Tol(f.classStyle),a.s9C("target",f.target),a.xp6(2),a.Oqu(a.lcZ(4,7,f.fileDescription))}}function y(k,I){if(1&k&&(a.TgZ(0,"a",3)(1,"span"),a._uU(2),a.ALo(3,"mytranslate"),a.qZA(),a.Hsn(4,1),a.qZA()),2&k){const f=a.oxw();a.Akn(f.style),a.Tol(f.classStyle),a.s9C("href",f.dataUrl,a.LSH),a.s9C("target",f.target),a.s9C("download",f.fileName),a.xp6(2),a.Oqu(a.lcZ(3,9,f.fileDescription))}}const E=["*","*"];let N=(()=>{class k extends s.Q{downloadFile(){return this.http.get(this.dataUrl,{responseType:"blob"}).pipe((0,e.U)(f=>f))}shareFileToFlutter(){this.downloadFile().subscribe(f=>{this.shareFileFlutterService.shareFileWithBlob(f,this.fileName)})}ngOnInit(){super.ngOnInit()}constructor(f,S,D){super(),this.shareFileFlutterService=f,this.commonService=S,this.http=D,this.dataUrl="",this.target="",this.fileName="",this.fileDescription="",this.classStyle="",this.style=""}}return k.\u0275fac=function(f){return new(f||k)(a.Y36(Z.g),a.Y36(g.z),a.Y36(v.eN))},k.\u0275cmp=a.Xpm({type:k,selectors:[["azt-download-link-item"]],inputs:{dataUrl:"dataUrl",target:"target",fileName:"fileName",fileDescription:"fileDescription",classStyle:"classStyle",style:"style"},features:[a.qOj],ngContentSelectors:E,decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["NormalWeb",""],[3,"target","click"],[3,"href","target","download"]],template:function(f,S){if(1&f&&(a.F$t(E),a.YNc(0,w,6,9,"ng-container",0),a.YNc(1,y,5,11,"ng-template",null,1,a.W1O)),2&f){const D=a.MAs(2);a.Q6J("ngIf",S.isMobileWebView)("ngIfElse",D)}},dependencies:[c.O5,b.JV],encapsulation:2}),k})()}}]);