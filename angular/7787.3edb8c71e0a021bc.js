"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7787],{5955:(A,R,d)=>{d.d(R,{C:()=>S});var P=d(26860);let S=(()=>{var n;class a{constructor(l){this.el=l,this.answerSizeManager=0,this.process()}ngOnChanges(l){l.answerSizeManager&&l.answerSizeManager.currentValue!==l.answerSizeManager.previousValue&&l.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(l=>{const E=this.el.nativeElement,p=E.children,f=[];for(let u=0;u<p.length;u++)f.push(this.getSizeWidthElement(p[u]));let m=1;[2,4].forEach(u=>{this.isLayout(l.width,f,u)&&(m=u)}),E.classList.remove("row");for(let u=0;u<p.length;u++){const c=p[u];c.classList.remove("col-sm-12"),c.classList.remove("col-md-6")}E.classList.add("layout"),E.classList.add("layout-"+m)})}isLayout(l,E,p){const f=Math.floor(l/p);for(const m of E)if(m+a.PADDING_ITEM>f)return!1;return!0}onElementLoaded(){return new Promise((l,E)=>{let p=!1;for(let f=0;f<=10;f++)setTimeout(()=>{if(!p){const m=this.actionGetSizeBox();m.width>0&&m.height&&(p=!0,l(m))}10===f&&!p&&E(new Error)},100*f)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(l){let E=0;for(let p=0;p<l.children.length;p++)E+=l.children[p].getBoundingClientRect().width;return E}}return(n=a).PADDING_ITEM=40,n.\u0275fac=function(l){return new(l||n)(P.rXU(P.aKT))},n.\u0275dir=P.FsC({type:n,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[P.OA$]}),a})()},25539:(A,R,d)=>{d.d(R,{I:()=>P});class P{constructor(){this.answerLabelsMockup={}}}},5382:(A,R,d)=>{d.d(R,{n:()=>P});class P{constructor(n,a,v,l){this.tasks=new Array,this.queues=new Array,this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=n,this.result_common_temp={datas:[],errs:[]},this.action_log_item=a,this.delay_time=v||1e3,this.end_with_error=l??!1}addTask(n,a,v,l){if(this.is_running)return;var E=v||[];const p=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(m=>{this.wrap_counter++,a.call(n,...E).then(u=>{this.wrap_counter_done++,this.callLog(l),m({status:!0,value:u,index:p})}).catch(u=>{this.wrap_counter_done++,this.callLog(l),m({status:!1,error:u,index:p})})}),name:l})}callLog(n){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],n)}start(){return new Promise(n=>{0===this.queues.length&&n({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let a=0;a<this.limit_one_process;a++){const v=this.queues.shift();if(!v)break;this.tasks.push(v)}this.count_task_root_done=0,this.is_running=!0,this.runner(n)})}checker(n,a){this.count_task_root_done++,n.status&&n.value?this.result_common_temp.datas.push({index:n.index,value:n.value}):n.error&&this.result_common_temp.errs.push({index:n.index,value:n.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,a(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,a(this.makeResultObj())),this.nextItem(a)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(n,a){return n.index-a.index}).map(n=>n.value),errs:this.result_common_temp.errs.sort(function(n,a){return n.index-a.index}).map(n=>n.value)}}nextItem(n){const a=this.queues.shift();a&&a.task.call(this).then(v=>{this.checker(v,n)})}runner(n){this.tasks.length>0?this.tasks.forEach(a=>{a.task.call(this).then(v=>{this.checker(v,n)})}):(this.is_running=!1,n(this.makeResultObj()))}}},76671:(A,R,d)=>{d.d(R,{c:()=>f});var P=d(73014),S=d(27691),n=d(5382),a=d(26860),v=d(25693),l=d(40949),E=d(41426);const p=d(4060);let f=(()=>{var m;class u{constructor(e,t,r){this.commonService=e,this.sAztCdnService=t,this.apiUploadService=r,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}convertBase64OfMathJaxToCdnUrl(e){return new Promise(t=>{var r=this.getValueContentQuestion(e.questionContent??""),s=this.getValueContentQuestion(e.answerConfig??""),_=e.answerMedia??"",o=this.removeBase64MathJaxInQuestionContent(e.questionText??"");if(0===r.length||0===s.length)return void t(e);let g=this.encodeContent(r[0].content),w=[];s.forEach((h,C)=>{w.push({i:C,d:this.encodeContent(h.content)})});let i=this.encodeContent(_);var M=0;let O=[];for(let h=0;h<g.raws.length;h++)g.raws[h].i=M,M++,O.push(g.raws[h]);for(let h=0;h<i.raws.length;h++)i.raws[h].i=M,M++,O.push(i.raws[h]);w.forEach(h=>{for(let C=0;C<h.d.raws.length;C++)h.d.raws[C].i=M,M++,O.push(h.d.raws[C])}),O.length>0?this.uploadRawContent(O.map(h=>h.l)).then(h=>{g.raws.forEach(C=>{let T=this.stringFirst+btoa(JSON.stringify({l:h,i:C.i}));r[0].content=this.commonService.replaceAll(r[0].content,C.l,T)??""}),i.raws.forEach(C=>{let T=this.stringFirst+btoa(JSON.stringify({l:h,i:C.i}));_=this.commonService.replaceAll(_,C.l,T)??""}),w.forEach(C=>{C.d.raws.forEach(T=>{let k=this.stringFirst+btoa(JSON.stringify({l:h,i:T.i}));s[C.i].content=this.commonService.replaceAll(s[C.i].content,T.l,k)??""})}),e.questionContent=JSON.stringify(r),e.answerConfig=JSON.stringify(s),e.answerMedia=_,e.questionText=o,t(e)}).catch(()=>{t(e)}):t(e)})}decodeMathJaxCodeToCdnUrl(e){return new Promise(t=>{const r=new n.n(10);if(r.addTask(this,()=>new Promise(s=>{this.decodeContent(e.content??"").then(_=>{e.content=_,s(!0)}).catch(()=>{s(!1)})})),r.addTask(this,()=>new Promise(s=>{this.decodeContent(e.help??"").then(_=>{e.help=_,s(!0)}).catch(()=>{s(!1)})})),e.answers)for(let s=0;s<e.answers.length;s++)r.addTask(this,()=>new Promise(_=>{e.answers&&this.decodeContent(e.answers[s].content??"").then(o=>{e.answers&&(e.answers[s].content=o),_(!0)}).catch(()=>{_(!1)})}));r.start().then(()=>{t()})})}getValueContentQuestion(e){return this.commonService.castJsonToObj(e)??[]}getAllMatchWithContent(e){let r,t=[];for(;null!==(r=u.searchPattern.exec(e));)t.includes(r[0])||t.push(r[0]);return t}getRawContent(e,t){return e=this.sAztCdnService.getMyCdn(e),new Promise((r,s)=>{const _=this.dataRaws.findIndex(o=>o.l===e);-1===_?fetch(e).then(o=>o.blob()).then(o=>o.arrayBuffer()).then(o=>{const g=p.inflate(o),w=this.commonService.castJsonToObj((new TextDecoder).decode(g));this.dataRaws.push({l:e,d:w??[]}),w&&w[t]?r(w[t]):s(new Error("Not found index"))}).catch(()=>{s(new Error("Exception at feed link"))}):this.dataRaws[_].d&&this.dataRaws[_].d[t]?r(this.dataRaws[_].d[t]):s(new Error("Not found index"))})}uploadRawContent(e){return new Promise((t,r)=>{const s=JSON.stringify(e),_=(new TextEncoder).encode(s),o=p.deflate(_),g=new Blob([o],{type:"application/octet-stream"}),w=new File([g],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(w).subscribe(i=>{i.type!=S.hv.UploadProgress&&(1==i.success&&i.data?t(i.data.url??""):r(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+i.message)))})})}removeBase64MathJaxInQuestionContent(e){return this.encodeContent(e).raws.forEach(r=>{e=this.commonService.replaceAll(e,r.l,"")??""}),e}encodeContent(e){let t=this.getAllMatchWithContent(e),r=[];for(let s=0;s<t.length;s++){let o=t[s].replace(u.searchPattern,"$1");o.startsWith(this.stringFirst)||r.push({l:o,i:r.length})}return{content:e,raws:r}}decodeContent(e){var t=this;return(0,P.A)(function*(){let r=t.getAllMatchWithContent(e);for(let s=0;s<r.length;s++){const _=r[s];let o=_.replace(u.searchPattern,"$1");for(let g=0;g<t.stringFirstOld.length;g++)if(o.startsWith(t.stringFirstOld[g])){e=t.commonService.replaceAll(e,_,"")??"";continue}if(o.startsWith(t.stringFirst)){let g=t.commonService.castJsonToObj(atob(o.replace(t.stringFirst,"")));if(g){let w=yield t.getRawContent(g.l,g.i);e=t.commonService.replaceAll(e,o,w)??""}}}return e})()}}return(m=u).searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,m.\u0275fac=function(e){return new(e||m)(a.KVO(v.R),a.KVO(l.B),a.KVO(E.T))},m.\u0275prov=a.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),u})()},32639:(A,R,d)=>{d.d(R,{g:()=>p});var P=d(65106),S=d(5382),n=d(4744),a=d(26860),v=d(40949),l=d(25693),E=d(76671);let p=(()=>{var f;class m{pushImage(c,e,t){if(t){let r=new RegExp("<div id='"+c+"'[^>]+></div>","g");t.content&&(t.content=t.content.replace(r,e??"")),t.answers&&t.answers.forEach(s=>{s.content=s.content?.replace(r,e??"")}),t.help&&(t.help=t.help.replace(r,e??"")),t.groupInfo&&t.groupInfo.groupContent&&(t.groupInfo.groupContent=t.groupInfo.groupContent.replace(r,e??""))}}parseRenderQuestions(c,e,t,r,s,_){return new Promise((o,g)=>{const i=new S.n(25,{function:(M,O)=>{e&&e(M/O*100)}},r??1e3);c.forEach(M=>{i.addTask(this,this.parseRenderQuestion,[M,t,s,_])}),i.start().then(M=>{if(M.errs.length>0){const O=[];M.errs.forEach(h=>{let C=O.find(T=>T.type===h.type);C||O.push(h),C?.data.concat(h.data)}),g(O)}else o(c)})})}parseRenderQuestion(c,e,t,r){return new Promise((s,_)=>{var o=new n.h(this.cdnService,this.commonService,e||new P.y,i=>{_(i)});o.callbackPushImage=(i,M)=>{this.pushImage(i,M,c)},o.caller=this;const w=new S.n(r?1:20,void 0,0);c.content&&w.addTask(this,()=>new Promise(i=>{c.content=o.render(this.commonService.removeBracket(c.content??""),()=>{i()})})),c.answers&&c.answers.forEach(i=>{w.addTask(this,()=>new Promise(M=>{i.content=o.render(i.content||"",()=>{M()})}))}),c.help&&w.addTask(this,()=>new Promise(i=>{c.help=o.render(c.help,()=>{i()})})),c.groupInfo&&c.groupInfo.groupContent&&w.addTask(this,()=>new Promise(i=>{c.groupInfo&&c.groupInfo.groupContent?c.groupInfo.groupContent=o.render(this.commonService.removeBracket(c.groupInfo.groupContent),()=>{i()}):i()})),t&&w.addTask(this,()=>new Promise(i=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(c).then(()=>{i()})})),w.start().then(i=>{i.errs.length||s()})})}constructor(c,e,t){this.cdnService=c,this.commonService=e,this.dataAztMathRawHelper=t}}return(f=m).\u0275fac=function(c){return new(c||f)(a.KVO(v.B),a.KVO(l.R),a.KVO(E.c))},f.\u0275prov=a.jDH({token:f,factory:f.\u0275fac,providedIn:"root"}),m})()}}]);