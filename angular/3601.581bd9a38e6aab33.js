"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[3601],{14608:(p,o,c)=>{c.d(o,{I:()=>h});var _=c(65080),i=c(63055),r=c(4744),n=c(15954);class h extends n._{constructor(s,a,d,t,l){super(),this.cdnService=s,this.commonService=a,this.configRenderService=d,this.callBack=t,this.callbackFall=l}render(s,a,d,t){if(s.indexOf("@[]")<0)return t&&t(),s;let m,l=/@\[\]\{[^@]+\}@\[\]/g,u=s,g=new Map;for(;null!==(m=l.exec(s));){let v=m[0],I=v.split("@[]")[1],f=this.commonService.willDeleteParseJson(I),E=f.link,C=_.P.generateIdRequired(10);u=u.replace(v,`<div id='${C}' class='img-docx skeleton-box-loading' style='width: ${f.data.width*this.ratioImage}px;height: ${f.data.height*this.ratioImage}px'></div>`),g.has(E)?g.get(E)?.push({id:C,data:f.data}):g.set(E,[{id:C,data:f.data}])}return this.startLoadImage(g).then(()=>{t&&t()}).catch(v=>{this.callbackFall&&this.callbackFall(v)}),u}startLoadImage(s){return new Promise((a,d)=>{var t=0;s.size>0?s.forEach((l,u)=>{this.loadImage(u,this.cdnService).then(g=>{if(this.processImageQuestion(g,l,d),this.loadingManager.delete(g.id),this.callBack)for(let m of l)this.callBack(m.id,m.renderStr);++t===s.size&&a()}).catch(()=>{const g=u.split("/");var m=this.commonService.myTranslateInstant("lang_testbank_render_cant_download_the_image")??"";d(new r.J("LOAD_IMAGE",[g[g.length-1]],m))})}):a()})}processImageQuestion(s,a,d){a.forEach(t=>{try{const l=document.createElement("canvas");t.data.width=-1===t.data.width?s.width:t.data.width,t.data.height=-1===t.data.height?s.height:t.data.height,l.width=t.data.width,l.height=t.data.height,l.getContext("2d")?.drawImage(s,t.data.x,t.data.y,t.data.width,t.data.height,0,0,l.width,l.height);let g=this.isCropImage?i.Iz.cropCanvas(l):l;g=this.isCanvasEmpty(g)?l:g,t.renderStr=t.data.heightPt&&t.data.widthPt?`<img id='${t.id}' class='img-docx' alt='error...' src='${g.toDataURL()}' style='width: ${t.data.widthPt}pt;height: ${t.data.heightPt}pt'>`:`<img id='${t.id}' class='img-docx' alt='error...' src='${g.toDataURL()}' style='width: ${g.width*this.ratioImage}px;height: auto'>`}catch{const u=s.src;return void d(new r.J("CROP_IMAGE",[u[u.length-1]],"Kh\xf4ng c\u1eaft \u0111\u01b0\u1ee3c n\u1ed9i dung trong h\xecnh \u1ea3nh"))}})}isCanvasEmpty(s){const a=document.createElement("canvas");return a.width=s.width,a.height=s.height,s.toDataURL()===a.toDataURL()}}},15954:(p,o,c)=>{c.d(o,{_:()=>n});var _=c(65080),i=c(63055),r=c(64198);class n{constructor(){this.isCropImage=!0,this.loadingManager=new Map,this.ratioImage=.65}setCallback(e){}setApiCache(e){}setLoadingManager(e){this.loadingManager=e}loadImage(e,s){return new Promise((a,d)=>{let t=_.P.generateIdRequired(10);this.loadingManager.set(t,e),(0,r.qO)(e,s).then(l=>{a(l),this.loadingManager.delete(t)}).catch(()=>{this.loadingManager.delete(t),d(new Error)})})}loadImageToBase64(e,s){return new Promise((a,d)=>{const t=new Image;t.crossOrigin="anonymous",t.setAttribute("count","1");let l=_.P.generateIdRequired(10);this.loadingManager.set(l,e),t.onload=()=>{const u=document.createElement("canvas");u.width=t.width,u.height=t.height,u.getContext("2d")?.drawImage(t,0,0,t.width,t.height,0,0,u.width,u.height);const m=this.isCropImage?i.Iz.cropCanvas(u):u;let v=`<img id='${l}' class='img-docx' alt='error...' src='${m.toDataURL()}' style='width: ${m.width*this.ratioImage}px;height: auto'>`;a(v),this.loadingManager.delete(l)},t.onerror=()=>{this.loadingManager.delete(l);const u=t.getAttribute("count");u&&1==Number(u)?(t.src=s.getMyCdn(e),t.setAttribute("count","2")):u&&Number(u)<5?(t.setAttribute("count",u+1),t.src=s.getMyCdn(e)+"?t="+(new Date).getTime()):d(new Error)},t.src=s.getMyCdn(e)})}}},4744:(p,o,c)=>{c.d(o,{J:()=>i,h:()=>r});var _=c(14608);class i{constructor(h,e,s,a){this.type=h,this.data=e,this.message=s,this.questionNumber=a}}class r{initService(){const h=new _.I(this.cdnService,this.commonService,this.configRenderService,(e,s)=>{this.callbackPushImage&&this.caller&&this.callbackPushImage.call(this.caller,e,s)},e=>{this.callbackFall&&this.caller&&this.callbackFall.call(this.caller,e)});h.isCropImage=this.configRenderService.getIsCropImage(),this.services.push(h)}render(h,e){return this.services.forEach(s=>{h=s.render(h??"",[],void 0,e)}),h??""}constructor(h,e,s,a){this.cdnService=h,this.commonService=e,this.configRenderService=s,this.callbackFall=a,this.services=[],this.initService()}}},65080:(p,o)=>{o.P=void 0,o.P=class _{static generateIdRequired(r){let n="";for(let s=0;s<r;s++)n+="abcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(36*Math.random()));return Math.floor(Date.now()/1e3)+n}}},69490:(p,o,c)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PartsParser=void 0;const _=c(42336),i=c(76071),r=c(26965),n=c(80186),h=c(2238),e=c(90953);class s{constructor(d){this.__idCssElement="qv_style_element",this.baseConfigEventListener=[],this.imgMaps=[],this.services=new Array;const t=this.__pushServices([new i.FirstPartService(this.baseConfigEventListener),new _.ImagePartService(this.baseConfigEventListener),new h.DocxImagePartService(this.baseConfigEventListener),new n.LibrariesPartService(this.baseConfigEventListener,d),new r.FindAnsPartService(this.baseConfigEventListener),new e.LatexPartService(this.baseConfigEventListener)]);this.__pushCss(t)}__pushCss(d){if(!document.getElementById(this.__idCssElement)&&document.head){const l=document.createElement("style");l.id=this.__idCssElement,l.innerHTML=d.replace(/  /g," ").replace(/\n/g," ").replace(/\t/g," "),document.head.appendChild(l)}}__pushServices(d){let t="";return d.forEach(l=>{l.outCss().forEach(g=>{t+=`.${g.className} { ${g.content} } \n`}),this.services.push(l)}),t}start(d){const t=document.createElement("div");return d.forEach(l=>{const u=document.createElement("p");u.classList.add("qv_line"),this.services.forEach(g=>{g.pushImages(this.imgMaps),l=g.parse(l)}),u.innerHTML=l.text||"",t.appendChild(u)}),0===t.innerText.indexOf(s.IgnoreChar)?t.innerText.replace(s.IgnoreChar,""):t.outerHTML}register(d){this.imgMaps=d}configEventListener(d){d.forEach(t=>{-1===this.baseConfigEventListener.findIndex(l=>l.eventName===t.eventName)&&this.baseConfigEventListener.push(t)})}doneRenderQuestions(){this.services.forEach(d=>{d.onEndAll()})}}o.PartsParser=s,s.IgnoreChar="{!ignore}"},90685:(p,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BaseCaller=void 0,o.BaseCaller=class c{getQuestion(i,r,n,h,e,s){return new Promise(a=>{a([])})}}},79352:(p,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BeautyImageCrop=void 0;class c{static getRGB(i,r,n,h){return{red:h[4*(n.width*r+i)],green:h[4*(n.width*r+i)+1],blue:h[4*(n.width*r+i)+2],opacity:h[4*(n.width*r+i)+3]}}static isEmpty(i){return 255==i.red&&255==i.green&&255==i.blue||0===i.opacity}static scanX(i,r,n){for(var h=i?1:-1,e=i?0:r.width-1;i?e<r.width:e>-1;e+=h)for(var s=0;s<r.height;s++)if(!c.isEmpty(c.getRGB(e,s,r,n.data)))return e;return 0}static scanY(i,r,n){for(var h=i?1:-1,e=i?0:r.height-1;i?e<r.height:e>-1;e+=h)for(var s=0;s<r.width;s++)if(!c.isEmpty(c.getRGB(s,e,r,n.data)))return e;return 0}static cropImage(i,r,n){const e=i.canvas,s=document.createElement("canvas"),a=s.getContext("2d");var d=c.scanY(!0,e,r)-5,t=c.scanY(!1,e,r)+5,l=c.scanX(!0,e,r)-5,u=c.scanX(!1,e,r)+5;n&&(n.top||(t=0),n.bottom||(t=e.height),n.left||n.right?(n.left||(t=0),n.right||(t=e.width)):u=e.width+l);var g=u-l,m=t-d;return s.width=g,s.height=m,a?.drawImage(e,l,d,g,m,0,0,g,m),s}static removeBg(i){const r=document.createElement("canvas"),n=r.getContext("2d");if(n){r.width=i.width,r.height=i.height,n.drawImage(i,0,0);for(var h=n.getImageData(0,0,r.width,r.height),e=h.data,s=0;s<e.length;s+=4)e[s]>=185&&e[s+1]>=185&&e[s+2]>=185&&(e[s+3]=0);n.putImageData(h,0,0)}return r}static cropCanvas(i,r){const n=i.getContext("2d");if(n){var h=n.getImageData(0,0,i.width,i.height);return c.cropImage(n,h,r)}return i}}o.BeautyImageCrop=c},63055:(p,o,c)=>{o.Iz=void 0;c(90685);const r=c(79352);Object.defineProperty(o,"Iz",{enumerable:!0,get:function(){return r.BeautyImageCrop}});c(69490)},2238:(p,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DocxImagePartService=void 0;class c{constructor(i){this.pattern_check=/@\[\]{"link":"[^"]+","data":{[^}]+}}@\[\]/i,this.images=[],this.indexImageLink=[],this.style=document.createElement("style"),this.baseConfigEventListener=i,document.head.appendChild(this.style)}parse(i){let h,r=0,n=i.text||"";for(;null!==(h=this.pattern_check.exec(n));){try{var e=JSON.parse(h[0].split("@[]")[1]);e.data={x:Math.floor(e.data.x),y:Math.floor(e.data.y),width:Math.floor(e.data.width),height:Math.floor(e.data.height)},this.indexImageLink.push(e.link),n=n.replace(this.pattern_check,`<div class="background_question_${this.indexImageLink.length-1}"><img width="1024" height="1024" src="${e.link}"></div>`),this.style.textContent+=`.background_question_${this.indexImageLink.length-1} {margin: 0 3px; width: ${e.data.width}px; height: ${e.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${this.indexImageLink.length-1} img { margin-top: -${e.data.y}px; margin-left: -${e.data.x}px;}`}catch{n=n.replace(this.pattern_check,"")}r++>1e4&&(n="")}return Object.assign(Object.assign({},i),{text:n})}outCss(){return[]}pushImages(i){this.images=i}onEndAll(){}}o.DocxImagePartService=c,c.NAME_SERVICE="image_part:"},26965:(p,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FindAnsPartService=void 0,o.FindAnsPartService=class c{constructor(i){this.pattern_check=/\[[ABCDEFGHI]:[^\]]+\]/i,this.images=[],this.baseConfigEventListener=i}parse(i){let h,r=0,n=i.text||"";for(;null!==(h=this.pattern_check.exec(n));){const e=h[0].replace("[","").replace("]",""),s=e.substring(0,1),a=document.createElement("span");a.classList.add("qv_string_eng_ans"),a.innerHTML=s;const d=e.substring(2),t=document.createElement("span");t.classList.add("qv_string_eng"),t.innerHTML=d,t.appendChild(a),n=n.replace(this.pattern_check,t.outerHTML),r++>1e4&&(n="")}return Object.assign(Object.assign({},i),{text:n})}outCss(){return[{className:"qv_string_eng",content:"\n                    cursor: pointer;\n                    padding: 0 5px;\n                    font-weight: bold;\n                    text-decoration: underline;\n                    position: relative;\n                    height: 40px;\n                    display: inline-block;\n                "},{className:"qv_string_eng_ans",content:"\n                    position: absolute;\n                    top: 20px;\n                    left: 45%;\n                "}]}pushImages(i){this.images=i}onEndAll(){}}},76071:(p,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FirstPartService=void 0,o.FirstPartService=class c{constructor(i){this.images=[],this.baseConfigEventListener=i}parse(i){return Object.assign({},i)}outCss(){return[{className:"qv_line",content:"\n                    margin: 0 !important;\n                "},{className:"qv_qts_image",content:"\n                    width: 100%;\n                "},{className:"qv_ats_image",content:"\n                    width: 60%;\n                "}]}pushImages(i){this.images=i}onEndAll(){}}},42336:(p,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ImagePartService=void 0;class c{constructor(i){this.pattern_check=/\[!img:[afhci]+[\dABCDEFGHI]+\]/i,this.images=[],this.baseConfigEventListener=i}parse(i){let h,r=0,n=i.text||"";for(;null!==(h=this.pattern_check.exec(n));){const e=h[0].replace("[!img:","").replace("]",""),s=this.images.find(a=>a.id===e);if(s){const a=document.createElement("img");a.crossOrigin="anonymous",a.classList.add(0===e.indexOf("af")?"qv_full_a_img":0===e.indexOf("f")?"qv_full_img":"qv_img"),a.src=s.link,n=n.replace(this.pattern_check,a.outerHTML)}else{const a=document.createElement("span");a.innerHTML="(Th\xeam h\xecnh \u1ea3nh)",a.classList.add("qv_none_image"),n=n.replace(this.pattern_check,a.outerHTML)}r++>1e4&&(n="")}return Object.assign(Object.assign({},i),{text:n})}outCss(){return[{className:"qv_full_a_img",content:"\n                    cursor: pointer;\n                    width: 60%\n                "},{className:"qv_full_img",content:"\n                    cursor: pointer;\n                    width: 100%\n                "},{className:"qv_img",content:"\n                    cursor: pointer;\n                    height: 25px;\n                "},{className:"qv_none_image",content:"\n                    display: inline-block;\n                    color: #2262ae;\n                    cursor: pointer;\n                "}]}pushImages(i){this.images=i}onEndAll(){}}o.ImagePartService=c,c.NAME_SERVICE="image_part:"},90953:(p,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LatexPartService=void 0;class c{constructor(i){this.images=[],this.baseConfigEventListener=i}parse(i){let r=i.text||"";return Object.assign(Object.assign({},i),{text:r})}outCss(){return[]}pushImages(i){this.images=i}onEndAll(){}}o.LatexPartService=c,c.NAME_SERVICE="latex:"},80186:(p,o,c)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LibrariesHelper=o.LibrariesPartService=void 0;const _=c(69490);class i{constructor(e,s){this.pattern_check=/^(\[@[CTG]\d+:[^\]]+\]\.)+((\[@Q\d+:[^\]]+\])|(\[[^@:]+\]))$/i,this.pattern_content=/\[(.*?)\]/i,this.images=[],this.baseConfigEventListener=[],this.baseConfigEventListener=e,this.cacheProcess=new n(s,this.baseConfigEventListener)}parse(e){let s=0,a=e.text||"";if(this.pattern_check.test(a)){let d=[];for(;null!==this.pattern_content.exec(a);){const u=this.pattern_content.exec(a);if(!u)break;d.push(u[1]),a=a.substring(0,u.index)+a.substring(u.index+u[0].length)}const t=r.convertStringToTypeObject(d),l={numberQuestion:1,path:t[0],useCache:!0};"Random"===t[0].type?("G"===t[1].type?(l.groupId=t[1].id,l.examId=t[2].id):(l.catId="C"===t[1].type?t[1].id:void 0,l.examId="T"===t[1].type?t[1].id:void 0,l.questionId="Q"===t[1].type?t[1].id:void 0),l.numberQuestion=t[0].id):l.questionId=t[0].id,a=_.PartsParser.IgnoreChar+this.cacheProcess.pushCaller(l),s++>1e4&&(a="")}return Object.assign(Object.assign({},e),{text:a})}outCss(){return[]}pushImages(e){this.images=e}onEndAll(){this.cacheProcess.startCaller()}}o.LibrariesPartService=i,i.NAME_SERVICE="libraries_part:";class r{static convertStringToTypeObject(e){const s=[];return e.forEach(a=>{let d=a.substring(1,2),t=Number(r.pattern_number.exec(a)),l="";if(r.char_types.includes(d)){let u=a.indexOf(":");-1!==u&&(l=a.substring(u))}else d="Random";s.push({name:l,id:t,type:d,content:a})}),s.reverse()}}o.LibrariesHelper=r,r.pattern_number=/\d+/i,r.char_types="CTGQH";class n{constructor(e,s){this.eventDoneKey=i.NAME_SERVICE+"done",this.cacheObjs=[],this.baseCaller=e,this.baseConfigEventListener=s}pushEventValue(){const e=this.baseConfigEventListener.filter(a=>0===a.eventName.indexOf(this.eventDoneKey));let s=[];e.forEach(a=>{const d=this.cacheObjs.filter(l=>"done"===l.step);a.func.call(a.caller,d)&&s.push(a.eventName)}),s.forEach(a=>{const d=this.baseConfigEventListener.findIndex(t=>t.eventName===a);-1!==d&&this.baseConfigEventListener.splice(d,1)})}pushCaller(e){const s=e.catId+"_"+e.examId+"_"+e.groupId+"_"+e.questionId+"_"+e.numberQuestion;var a=this.cacheObjs.find(d=>d.key===s);return a||this.cacheObjs.push(a={key:s,value:[],step:"init",pars:e,count:0}),a.count++,s+"_"+a?.count}startCaller(){this.cacheObjs.forEach(e=>{e.count=0,"init"===e.step?(e.step="call",this.baseCaller.getQuestion(e.pars.numberQuestion,e.pars.useCache,e.pars.catId,e.pars.examId,e.pars.questionId,e.pars.groupId).then(s=>{e.step="done",e.value=s,this.pushEventValue()})):"done"===e.step&&this.pushEventValue()})}}}}]);