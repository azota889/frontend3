"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[4596],{71069:(U,m,s)=>{s.d(m,{Z:()=>M});var v=s(69862),f=s(65592),S=s(61713),_=s(65879),k=s(46558),E=s(82228),C=s(77757);let M=(()=>{class c{replaceImageInContent(a){return new f.y(e=>{if(a.includes("<img ")){var t=this.findAllSubString(a,"<img"),r=[],n=[];t.forEach(o=>{var i=a.indexOf("src=",o),l=a.indexOf('"',Number(i)+5),d=a.substring(Number(i)+5,Number(l)+1);d.includes(";base64")?r.push({oldUrl:d}):d.includes("blob:")&&n.push({oldUrl:d})}),r.length>0?this.reUploadBase64File(r,(o,i)=>{null==i?n&&n.length>0?this.reUploadBlobFile(n,(l,d)=>{null!=d?(a=this.replaceHomeworkContent(a,o),a=this.replaceHomeworkContent(a,l),e.next({errorMessage:void 0,content:a}),e.complete()):(e.next({errorMessage:d,content:a}),e.complete())}):(a=this.replaceHomeworkContent(a,o),e.next({errorMessage:void 0,content:a}),e.complete()):(e.next({errorMessage:i,content:a}),e.complete())}):n.length>0?this.reUploadBlobFile(n,(o,i)=>{null==i?(a=this.replaceHomeworkContent(a,o),e.next({errorMessage:void 0,content:a}),e.complete()):(e.next({errorMessage:i,content:a}),e.complete())}):(a=this.replaceHomeworkContent(a,[]),e.next({errorMessage:void 0,content:a}),e.complete())}else e.next({errorMessage:void 0,content:a}),e.complete()})}replaceHomeworkContent(a,e){return e.length>0&&e.forEach(t=>{a=a.replace(t.oldUrl??"  ",t.newUrl+'" class="w-100 img-fluid"')}),a}findAllSubString(a,e){for(var t=0,r=0,n=[];a.indexOf(e,t)>-1;)r=a.indexOf(e,t),n.push(r),t=r+e.length;return n}getTypeFile(a){var e=a.indexOf(";");return a.substring(5,e)}getFileName(a){var e=a.split("").reverse().join(""),t=e.indexOf(";"),r=e.indexOf("/",t);return e.substring(t,r).split("").reverse().join("")}convertBlobToBase64(a){return new Promise(e=>{var t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",function(){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=t.width,r.height=t.height,n?.drawImage(t,0,0);var o=r.toDataURL("image/png");e(o)},!1),t.src=a})}reUploadBase64File(a,e){if(a&&a.length>0){let o,n=a.length;for(var t=[],r=0;r<a.length;r++){const i=a[r],l=i.oldUrl?.substring(0,i.oldUrl.length-1);this.startUploadBlobFile(i,l??"",[],(d,g)=>{null==g?t=t.concat(d):o=g,n-=1,0==n&&e(t,o)})}}else e([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(a,e){if(a&&a.length>0){let o,n=a.length;for(var t=[],r=0;r<a.length;r++){const i=a[r],l=i?.oldUrl?.substring(0,i.oldUrl.length-1);this.convertBlobToBase64(l??"").then(d=>{this.startUploadBlobFile(i,d,[],(g,u)=>{null==u?t=t.concat(g):o=u,n-=1,0==n&&e(t,o)})})}}else e([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(a,e,t,r){if(e&&""!=e){var n=this.getTypeFile(e),o=this.myPdfService.b64toFile(e,this.getFileName(n),n);(0,S.hv)(o).then(i=>{this.apiUploadService.uploadToCdnForHomework(i).subscribe(l=>{if(l.type!=v.dt.UploadProgress)if(1==l.success){var d={...a,newUrl:l.data?.url??""};t.push(d),r(t,void 0)}else r(t,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",l.message??"none"))})})}else r(t,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(a,e,t){this.commonService=a,this.apiUploadService=e,this.myPdfService=t}}return c.\u0275fac=function(a){return new(a||c)(_.LFG(k.z),_.LFG(E.W),_.LFG(C.z))},c.\u0275prov=_.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},61325:(U,m,s)=>{s.d(m,{$:()=>M});var v=s(69862),f=s(65592),S=s(61713),_=s(65879),k=s(46558),E=s(82228),C=s(77757);let M=(()=>{class c{replaceImageInContent(a,e){return new f.y(t=>{if(e.includes("<img ")){var r=this.findAllSubString(e,"<img"),n=[],o=[];r.forEach(i=>{var l=e.indexOf("src=",i),d=e.indexOf('"',Number(l)+5),g=e.substring(Number(l)+5,Number(d)+1);g.includes(";base64")?n.push({oldUrl:g}):g.includes("blob:")&&o.push({oldUrl:g})}),n.length>0?this.reUploadBase64File(a,n,(i,l)=>{null==l?o&&o.length>0?this.reUploadBlobFile(a,o,(d,g)=>{null!=g?(e=this.replaceHomeworkContent(e,i),e=this.replaceHomeworkContent(e,d),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:g,content:e}),t.complete())}):(e=this.replaceHomeworkContent(e,i),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:l,content:e}),t.complete())}):o.length>0?this.reUploadBlobFile(a,o,(i,l)=>{null==l?(e=this.replaceHomeworkContent(e,i),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:l,content:e}),t.complete())}):(e=this.replaceHomeworkContent(e,[]),t.next({errorMessage:void 0,content:e}),t.complete())}else t.next({errorMessage:void 0,content:e}),t.complete()})}replaceHomeworkContent(a,e){return e.length>0&&e.forEach(t=>{a=a.replace(t.oldUrl??"  ",t.newUrl+'" class="w-100 img-fluid"')}),a}findAllSubString(a,e){for(var t=0,r=0,n=[];a.indexOf(e,t)>-1;)r=a.indexOf(e,t),n.push(r),t=r+e.length;return n}getTypeFile(a){var e=a.indexOf(";");return a.substring(5,e)}getFileName(a){var e=a.split("").reverse().join(""),t=e.indexOf(";"),r=e.indexOf("/",t);return e.substring(t,r).split("").reverse().join("")}convertBlobToBase64(a){return new Promise(e=>{var t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",function(){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=t.width,r.height=t.height,n?.drawImage(t,0,0);var o=r.toDataURL("image/png");e(o)},!1),t.src=a})}reUploadBase64File(a,e,t){if(e&&e.length>0){let i,o=e.length;for(var r=[],n=0;n<e.length;n++){const l=e[n],d=l.oldUrl?.substring(0,l.oldUrl.length-1);this.startUploadBlobFile(a,l,d??"",[],(g,u)=>{null==u?r=r.concat(g):i=u,o-=1,0==o&&t(r,i)})}}else t([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(a,e,t){if(e&&e.length>0){let i,o=e.length;for(var r=[],n=0;n<e.length;n++){const l=e[n],d=l?.oldUrl?.substring(0,l.oldUrl.length-1);this.convertBlobToBase64(d??"").then(g=>{this.startUploadBlobFile(a,l,g,[],(u,h)=>{null==h?r=r.concat(u):i=h,o-=1,0==o&&t(r,i)})})}}else t([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(a,e,t,r,n){if(t&&""!=t){var o=this.getTypeFile(t),i=this.myPdfService.b64toFile(t,this.getFileName(o),o);(0,S.hv)(i).then(l=>{this.apiUploadService.commonUploadFile(a,l,"").subscribe(d=>{if(d.type!=v.dt.UploadProgress)if(1==d.success){var g={...e,newUrl:d.data?.url??""};r.push(g),n(r,void 0)}else n(r,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",d.message??"none"))})})}else n(r,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(a,e,t){this.commonService=a,this.apiUploadService=e,this.myPdfService=t}}return c.\u0275fac=function(a){return new(a||c)(_.LFG(k.z),_.LFG(E.W),_.LFG(C.z))},c.\u0275prov=_.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},28368:(U,m,s)=>{s.d(m,{y:()=>M});var v=s(20553),f=s(65879),S=s(88489);let _=(()=>{class c{getMode(){return""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light"}constructor(a){this.browserStorageService=a}}return c.\u0275fac=function(a){return new(a||c)(f.LFG(S.n))},c.\u0275prov=f.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})();var k=s(46558),E=s(61325),C=s(32965);let M=(()=>{class c{constructor(a,e,t,r){this.darkModeService=a,this.commonService=e,this.sAztUploadImageOfExamService=t,this.cdnService=r}get initConfigUrlScript(){return{language_url:v.N.azt_tiny_mce_vi_langs_src}}initConfigForAdmin(){var t={};return t={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["code","fullscreen","link"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | link | code | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForAdminWithUploadImageBox(a){var r={};return r={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen link",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | link | code | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,file_picker_callback:(n,o,i)=>{this.file_picker_callback(a,n,o,i)},...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(r.skin="oxide-dark",r.content_css="dark"),r}initConfigForTeacher(){var t={};return t={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["fullscreen"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigTeacherHomework(a){var r={};return r={min_height:a,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(r.skin="oxide-dark",r.content_css="dark"),r}initConfigStudentHomework(){var t={};return t={height:450,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",readonly:1,plugins:["emoticons advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | emoticons",emoticons_database:"emojis",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForTeacherWithUploadImageBox(a){var r={};return r={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,file_picker_callback:(n,o,i)=>{this.file_picker_callback(a,n,o,i)},...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(r.skin="oxide-dark",r.content_css="dark"),r}file_picker_callback(a,e,t,r){let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept","image/*"),n.onchange=()=>{let o=n.files?.[0],i=new FileReader;i.onload=()=>{let d=`<img src="${"data:image/png;base64, "+i.result.split(",")[1]}">`;this.sAztUploadImageOfExamService.replaceImageInContent(a,d).subscribe(g=>{if(g.errorMessage)this.commonService.snackError(g.errorMessage);else{let u=document.createElement("div");u.innerHTML=this.commonService.removeXssInHtml(g.content);let h=u.firstChild;h&&h.src&&e(h.src)}})},i.readAsDataURL(o)},n.click()}}return c.\u0275fac=function(a){return new(a||c)(f.LFG(_),f.LFG(k.z),f.LFG(E.$),f.LFG(C.E))},c.\u0275prov=f.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);