"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6260],{76094:(K,G,s)=>{s.d(G,{x:()=>y});var y=function(r){return r[r.templateOriginalA4=20]="templateOriginalA4",r[r.templateA5Full50=22]="templateA5Full50",r[r.templateA4Essay=21]="templateA4Essay",r[r.templateA6Full20=23]="templateA6Full20",r[r.templateTrueFalseA4=15]="templateTrueFalseA4",r[r.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",r[r.templateTrueFalseA5=17]="templateTrueFalseA5",r[r.templateTrueFalseA6=18]="templateTrueFalseA6",r[r.templateA4WithFax=19]="templateA4WithFax",r[r.templateA4WithFaxV2=190]="templateA4WithFaxV2",r[r.templateTrueFalseA4WithColor=150]="templateTrueFalseA4WithColor",r[r.templateA4WithColorNew=200]="templateA4WithColorNew",r}(y||{})},17997:(K,G,s)=>{s.d(G,{H:()=>C});var y=s(76094),r=s(65879),U=s(46558),N=s(97151),R=s(61419),A=s(41385),B=s(38228);let C=(()=>{class d{constructor(i,a,p,o,F){this.commonService=i,this.shareFileFlutterService=a,this.encryptService=p,this.formatAnswerSheetService=o,this.exportExcelService=F,this.allAnswerSheet=y.x}exportFileNameOfStudentCode(i,a,p){return 100==i&&(a=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(a?"_"+a:"")+"_"+this.encryptService.createMd5(p).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(i,a,p,o,F,T){return a==this.allAnswerSheet.templateA5Full50?i.createA5AnswerSheetFullA4_50(T??50):a==this.allAnswerSheet.templateA4Essay?i.createA4AnswerSheet_35hh(T??50):a==this.allAnswerSheet.templateA6Full20?i.createA6AnswerSheetFullA4_20(T??20):a==this.allAnswerSheet.templateTrueFalseA4||a==this.allAnswerSheet.templateTrueFalseA4WithColor||a==this.allAnswerSheet.templateTrueFalseEssayA4||a==this.allAnswerSheet.templateTrueFalseA5||a==this.allAnswerSheet.templateTrueFalseA6||a==this.allAnswerSheet.templateA4WithFax||a==this.allAnswerSheet.templateA4WithFaxV2?i.createTrueFalseAnswerSheet():i.createAzotaAnswerSheet_A4(T??120)}exportFileNameOfAnswerSheet(i,a,p){var o="";return 100==i&&(a=""),(0==i||100==i)&&(o=this.commonService.createFileNameExportFile(["PhieuTL_"+p+(a?"_"+a:"")])),o}exportFileNameOfAnswerExcelOffline(i,a,p){var o="";return 100==i&&(a=""),(0==i||100==i)&&(o=this.commonService.createFileNameExportFile(["DapAn_"+(a?"_"+a:"")])),o}exportFileNameOfRawExam(i,a,p){var o="";return 100==i&&(a=""),(0==i||100==i)&&(o=this.commonService.createFileNameExportFile([(a?"_"+a:"")+"_"+this.encryptService.createMd5(p).substring(0,6)])),o}exportFileNameOfExamOffline(i,a,p,o){var F="";return 100==i&&(a=""),(0==i||100==i)&&(F=this.commonService.createFileNameExportFile([(o?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(o,3)+"_":"")+p+(a?"_"+a:"")])),F}printStudentCode(i,a){var p=[];let o=this.commonService.myClone(a);for(let F=0;F<o.length;F++)p.push({code:o[F].code??0,fullName:o[F]?.fullName??"",birthday:o[F]?.birthday??"",className:o[F].classroomName??""});this._exportExcelForCodeNumber(i,p)}_exportExcelForCodeNumber(i,a){let p=this.exportFileNameOfStudentCode(0,i?.name??"",i?.hashId??"");const o=this.exportExcelService.exportExcelForCodeNumber(a);this.shareFileFlutterService.shareFileWithBlob(o,p)}}return d.\u0275fac=function(i){return new(i||d)(r.LFG(U.z),r.LFG(N.g),r.LFG(R.j),r.LFG(A.j),r.LFG(B.L))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},56260:(K,G,s)=>{s.d(G,{F:()=>$});var y=s(49671),r=s(85965),N=s(8720),R=s(70731),A=s(89156),B=s(89745),C=s(79617),d=s(65879),W=s(36668),i=s(32965),a=s(46558),p=s(78953),o=s(19662),F=s(17997),T=s(41385),w=s(97151),z=s(27161),Q=s(71518);let $=(()=>{class P{constructor(n,e,f,l,c,E,t,u,v,I){this.docxService=n,this.cdnService=e,this.commonService=f,this.userService=l,this.questionRenderService=c,this.printAnswersheetService=E,this.formatAnswerSheetService=t,this.shareFileFlutterService=u,this.sAztAnswerTypeService=v,this.documentConfigService=I,this.configRenderService=new N.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new r,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((n,e)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?typeof azotaDocx<"u"&&azotaDocx?n(!0):e(new Error("lang_core_lib_not_load")):(this.countRetryLoadJS++,this.countRetryLoadJS>3?e(new Error("lang_core_lib_not_load")):n(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(n,e){let f=[],l=[];return n.answerResult&&this.isAnsDetail&&n.answerResult.forEach(c=>{let E=c;const t=n.answers?.find(u=>u.key===c);t&&(E=t.alpha??E),l.push(E)}),n.answers.forEach(c=>{let E="<b>     "+(l.includes(c.alpha??c.key)?"*":"")+(e?(c.alpha?c.alpha:c.key).toLowerCase()+")":(c.alpha?c.alpha:c.key)+".")+"</b> "+(0,C.uG)(c.content);f.push(E)}),f}getDataForExportDocxApi(n,e,f){let l=[],c=0;if(f){let t=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");l.push({content:`<b> ${t} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(f,3)+".</b>",answers:[]})}let E=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return e.forEach(t=>{1!==n.hideGroupQuestion&&t.groupInfo?.isFirstInGroup&&t.groupInfo.groupContent&&l.push({content:`<b>${t.groupInfo.groupContent}<b>`,answers:[]}),this.isEnableDebug&&l.push({content:` <br/><br/><br/>*** <b>Question ID: ${t.id}</b> ***`,answers:[]});let u={content:`<b>${E} `+((t.labelIndex??c)+(n.startQuestionIndex??1))+".</b> "+(0,C.uG)(t.content),answers:this.convertAnswerQuestion(t??[],this.sAztAnswerTypeService.isTrueFalseAnswer(t))};if(c++,l.push(u),this.isAnsDetail&&((t.help||this.sAztAnswerTypeService.isFillAnswer(t))&&l.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b><br/> ${t.help}`,answers:[]}),t.answerResult&&this.isAnsDetail)){let v=[];t.answerResult.forEach(I=>{let m=I;const g=t.answers?.find(M=>M.key===I);g&&(m=g.alpha??m),v.push(m)}),this.sAztAnswerTypeService.isFillAnswer(t)&&l.push({content:`${this.commonService.myTranslateInstant("lang_auto_dap_an")}: ${v.join(" | ")}`,answers:[]})}this.isEnableDebug&&l.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),l}itemConverterCaller(n,e,f,l,c){var E=this;return new Promise((t,u)=>{var v=0;this.questionRenderService.parseRenderQuestions(n.listQuestion,I=>{if(!this.saveLoadingMsg.includes(")")){v=I/2;var m=(this.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(v)+"%";this.changeMsg?this.changeMsg(m):A.G.changeMsgLoadingEffect(m)}},this.configRenderService,void 0,!0,c).then(I=>{let m=[];const g=[];if(e.examName&&g.push(C.Ip.createLineCenterBold(e.examName)),e.subject&&g.push(C.Ip.createLineCenterBold(e.subject)),e.examMinutes&&g.push(C.Ip.createLineCenterItalicized(e.examMinutes)),g.push(C.Ip.createLineCenterItalicized("-------------------------")),m.push({content:C.Ip.makeHeaderTable([C.Ip.createLineCenterBold(e.schoolName?e.schoolName:"")],g,!1),answers:[]}),m.push({content:C.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),m.push({content:C.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),m=m.concat(this.getDataForExportDocxApi(l,I,n.offlineExamMixQuestionObj?n.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx){var M=0;let L=n.offlineExamMixQuestionObj?.hashId?n.offlineExamMixQuestionObj.hashId.toString().padStart(3,"0"):void 0,b=L?this.commonService.myTranslateInstant("lang_auto_ma_de")+" "+L:"";this.docxService.exportToDocxBinary(m,{isHeadless:!0,footerLeft:b},function(){var D=(0,y.Z)(function*(x,_,h){new Promise(S=>{setTimeout(()=>{0==x&&(M=v),v=x/_*25+M;var O=(E.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(v)+"%";A.G.changeMsgLoadingEffect(O)}),S(!0)})});return function(x,_,h){return D.apply(this,arguments)}}()).then(D=>{t({userObj:f,data:D,input:m,additionParams:e,offlineExamMixQuestionObj:n.offlineExamMixQuestionObj})})}else u(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(I=>{u(new Error(I[0].message))})})}masterConverterCaller(n,e,f,l,c,E){return new Promise((t,u)=>{const v=this.userService.getUserObj();let I=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),m=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),g=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),M=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),L=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),b=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),D=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const x=new R.Q(1,{function:(_,h)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${h<=1?"":`(${_}/${h}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):A.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});n.forEach(_=>{x.addTask(this,this.itemConverterCaller,[_,{schoolName:l?.nameSchool??`{${I}}`,subject:l?.nameSubject??`{${m}}`,examName:e.name??`{${g}}`,examMinutes:e.minutes&&e.minutes>0?`${M}: `+e.minutes+` ${b} (${L})`:` ${M}: ${D}`,templateType:c??0,numberOfQuestion:_.listQuestion.length,examId:_.offlineExamMixQuestionObj?.hashId??0},v,e,E])}),x.start().then(_=>{if(_.errs.length>0)u(_.errs[0]);else if(1===_.datas.length){const h=_.datas[0],S=new Blob([h.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let O=this.createNameExam(e,f,h.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(S,O),t()}else _.datas.forEach(h=>{let S=this.createNameExam(e,f,h.offlineExamMixQuestionObj);S=this.replaceAllString(S,"/","_"),this.zipper.file("DOCS/"+S,h.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(h=>{let S=this.commonService.createFileNameExportFile([e.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(h,S),t()},h=>{u(h)})},200)})})}replaceAllString(n,e,f){for(;n.includes(e);)n=n.replace(e,f);return n}createNameExam(n,e,f){return e?this.printAnswersheetService.exportFileNameOfExamOffline(0,n.name??"",e?.hashId??"",f?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,n.name??"",n.hashId??"")+".docx"}downloadExam(n,e,f,l,c,E,t,u,v,I,m){return new Promise((g,M)=>{this.isAnsDetail=n,this.isEnableDebug=!!I,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=v,this.loadScriptAction().then(L=>{L?this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(e.hashId??"").subscribe(b=>{if(1==b.success){let D=0,x=0;c.forEach((_,h)=>{_.labelIndex=h,b.data?.resetQuestionIndex&&_.groupInfo&&_.groupInfo.groupId&&(D!=_.groupInfo.groupId&&(D=_.groupInfo.groupId,x=0),_.labelIndex=x,x++)})}this.masterConverterCaller([{listQuestion:c,offlineExamMixQuestionObj:l}],e,f,E,t,m).then(()=>{this.zipper=new r,u?u(10):A.G.closeLoadingEffect(10),g()}).catch(D=>{A.G.closeLoadingEffect(10),M(D)})}):(u?u(10):A.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load")))}).catch(()=>{u?u(10):A.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(n,e,f,l,c,E,t,u,v,I){return new Promise((m,g)=>{this.isAnsDetail=n,this.isEnableDebug=!!v,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=u,this.loadScriptAction().then(M=>{if(M){let L=!0;const b=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(e.hashId??"").subscribe(D=>{l.forEach(x=>{let _=this.commonService.castJsonToClassObjs(B.v,JSON.stringify(x.mixQuestions??[]))??[];if(_.length>0){if(1==D.success){let h=0,S=0;_.forEach((O,k)=>{O.labelIndex=k,D.data?.resetQuestionIndex&&O.groupInfo&&O.groupInfo.groupId&&(h!=O.groupInfo.groupId&&(h=O.groupInfo.groupId,S=0),O.labelIndex=S,S++)})}b.push({listQuestion:_,offlineExamMixQuestionObj:x})}else L=!1}),L?this.masterConverterCaller(b,e,f,c,E,I).then(()=>{this.zipper=new r,t?t(10):A.G.closeLoadingEffect(10),m()}).catch(x=>{t?t(10):A.G.closeLoadingEffect(10),g(x)}):(t?t(10):A.G.closeLoadingEffect(10),g(new Error("lang_testbank_exam_is_invalid_condition")))})}else t?t(10):A.G.closeLoadingEffect(10),g(new Error("lang_core_lib_not_load"))}).catch(()=>{t?t(10):A.G.closeLoadingEffect(10),g(new Error("lang_core_lib_not_load"))})})}}return P.\u0275fac=function(n){return new(n||P)(d.LFG(W.n),d.LFG(i.E),d.LFG(a.z),d.LFG(p.U),d.LFG(o.h),d.LFG(F.H),d.LFG(T.j),d.LFG(w.g),d.LFG(z.i),d.LFG(Q.Cq))},P.\u0275prov=d.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()}}]);