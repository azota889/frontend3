"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6260],{76094:(U,G,n)=>{n.d(G,{x:()=>C});var C=function(s){return s[s.templateOriginalA4=20]="templateOriginalA4",s[s.templateA5Full50=22]="templateA5Full50",s[s.templateA4Essay=21]="templateA4Essay",s[s.templateA6Full20=23]="templateA6Full20",s[s.templateTrueFalseA4=15]="templateTrueFalseA4",s[s.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",s[s.templateTrueFalseA5=17]="templateTrueFalseA5",s[s.templateTrueFalseA6=18]="templateTrueFalseA6",s[s.templateA4WithFax=19]="templateA4WithFax",s[s.templateA4WithFaxV2=190]="templateA4WithFaxV2",s[s.templateTrueFalseA4WithColor=150]="templateTrueFalseA4WithColor",s[s.templateA4WithColorNew=200]="templateA4WithColorNew",s}(C||{})},17997:(U,G,n)=>{n.d(G,{H:()=>I});var C=n(76094),s=n(65879),R=n(46558),B=n(97151),g=n(61419),W=n(41385),x=n(38228);let I=(()=>{class O{constructor(a,r,d,o,E){this.commonService=a,this.shareFileFlutterService=r,this.encryptService=d,this.formatAnswerSheetService=o,this.exportExcelService=E,this.allAnswerSheet=C.x}exportFileNameOfStudentCode(a,r,d){return 100==a&&(r=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(r?"_"+r:"")+"_"+this.encryptService.createMd5(d).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(a,r,d,o,E,b){return r==this.allAnswerSheet.templateA5Full50?a.createA5AnswerSheetFullA4_50(b??50):r==this.allAnswerSheet.templateA4Essay?a.createA4AnswerSheet_35hh(b??50):r==this.allAnswerSheet.templateA6Full20?a.createA6AnswerSheetFullA4_20(b??20):r==this.allAnswerSheet.templateTrueFalseA4||r==this.allAnswerSheet.templateTrueFalseA4WithColor||r==this.allAnswerSheet.templateTrueFalseEssayA4||r==this.allAnswerSheet.templateTrueFalseA5||r==this.allAnswerSheet.templateTrueFalseA6||r==this.allAnswerSheet.templateA4WithFax||r==this.allAnswerSheet.templateA4WithFaxV2?a.createTrueFalseAnswerSheet():a.createAzotaAnswerSheet_A4(b??120)}exportFileNameOfAnswerSheet(a,r,d){var o="";return 100==a&&(r=""),(0==a||100==a)&&(o=this.commonService.createFileNameExportFile(["PhieuTL_"+d+(r?"_"+r:"")])),o}exportFileNameOfAnswerExcelOffline(a,r,d){var o="";return 100==a&&(r=""),(0==a||100==a)&&(o=this.commonService.createFileNameExportFile(["DapAn_"+(r?"_"+r:"")])),o}exportFileNameOfRawExam(a,r,d){var o="";return 100==a&&(r=""),(0==a||100==a)&&(o=this.commonService.createFileNameExportFile([(r?"_"+r:"")+"_"+this.encryptService.createMd5(d).substring(0,6)])),o}exportFileNameOfExamOffline(a,r,d,o){var E="";return 100==a&&(r=""),(0==a||100==a)&&(E=this.commonService.createFileNameExportFile([(o?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(o,3)+"_":"")+d+(r?"_"+r:"")])),E}printStudentCode(a,r){var d=[];let o=this.commonService.myClone(r);for(let E=0;E<o.length;E++)d.push({code:o[E].code??0,fullName:o[E]?.fullName??"",birthday:o[E]?.birthday??"",className:o[E].classroomName??""});this._exportExcelForCodeNumber(a,d)}_exportExcelForCodeNumber(a,r){let d=this.exportFileNameOfStudentCode(0,a?.name??"",a?.hashId??"");const o=this.exportExcelService.exportExcelForCodeNumber(r);this.shareFileFlutterService.shareFileWithBlob(o,d)}}return O.\u0275fac=function(a){return new(a||O)(s.LFG(R.z),s.LFG(B.g),s.LFG(g.j),s.LFG(W.j),s.LFG(x.L))},O.\u0275prov=s.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()},56260:(U,G,n)=>{n.d(G,{F:()=>Q});var C=n(85965),R=n(8720),B=n(70731),g=n(89156),W=n(89745),x=n(79617),I=n(65879),O=n(36668),w=n(32965),a=n(46558),r=n(78953),d=n(19662),o=n(17997),E=n(41385),b=n(97151),K=n(27161),z=n(71518);let Q=(()=>{class y{constructor(i,e,f,l,c,p,t,_,u,v){this.docxService=i,this.cdnService=e,this.commonService=f,this.userService=l,this.questionRenderService=c,this.printAnswersheetService=p,this.formatAnswerSheetService=t,this.shareFileFlutterService=_,this.sAztAnswerTypeService=u,this.documentConfigService=v,this.configRenderService=new R.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new C,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((i,e)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?typeof azotaDocx<"u"&&azotaDocx?i(!0):e(new Error("lang_core_lib_not_load")):(this.countRetryLoadJS++,this.countRetryLoadJS>3?e(new Error("lang_core_lib_not_load")):i(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(i,e){let f=[],l=[];return i.answerResult&&this.isAnsDetail&&i.answerResult.forEach(c=>{let p=c;const t=i.answers?.find(_=>_.key===c);t&&(p=t.alpha??p),l.push(p)}),i.answers.forEach(c=>{let p="<b>     "+(l.includes(c.alpha??c.key)?"*":"")+(e?(c.alpha?c.alpha:c.key).toLowerCase()+")":(c.alpha?c.alpha:c.key)+".")+"</b> "+(0,x.uG)(c.content);f.push(p)}),f}getDataForExportDocxApi(i,e,f){let l=[],c=0;if(f){let t=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");l.push({content:`<b> ${t} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(f,3)+".</b>",answers:[]})}let p=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return e.forEach(t=>{1!==i.hideGroupQuestion&&t.groupInfo?.isFirstInGroup&&t.groupInfo.groupContent&&l.push({content:`<b>${t.groupInfo.groupContent}<b>`,answers:[]}),this.isEnableDebug&&l.push({content:` <br/><br/><br/>*** <b>Question ID: ${t.id}</b> ***`,answers:[]});let _={content:`<b>${p} `+((t.labelIndex??c)+(i.startQuestionIndex??1))+".</b> "+(0,x.uG)(t.content),answers:this.convertAnswerQuestion(t??[],this.sAztAnswerTypeService.isTrueFalseAnswer(t))};if(c++,l.push(_),this.isAnsDetail&&((t.help||this.sAztAnswerTypeService.isFillAnswer(t))&&l.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b><br/> ${t.help}`,answers:[]}),t.answerResult&&this.isAnsDetail)){let u=[];t.answerResult.forEach(v=>{let A=v;const F=t.answers?.find(M=>M.key===v);F&&(A=F.alpha??A),u.push(A)}),this.sAztAnswerTypeService.isFillAnswer(t)&&l.push({content:`${this.commonService.myTranslateInstant("lang_auto_dap_an")}: ${u.join(" | ")}`,answers:[]})}this.isEnableDebug&&l.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),l}itemConverterCaller(i,e,f,l,c){return new Promise((p,t)=>{this.questionRenderService.parseRenderQuestions(i.listQuestion,_=>{this.saveLoadingMsg.includes(")")||(this.changeMsg?this.changeMsg(this.saveLoadingMsg+Math.floor(_)+"%"):g.G.changeMsgLoadingEffect(this.saveLoadingMsg+Math.floor(_)+"%"))},this.configRenderService,void 0,!0,c).then(_=>{let u=[];const v=[];e.examName&&v.push(x.Ip.createLineCenterBold(e.examName)),e.subject&&v.push(x.Ip.createLineCenterBold(e.subject)),e.examMinutes&&v.push(x.Ip.createLineCenterItalicized(e.examMinutes)),v.push(x.Ip.createLineCenterItalicized("-------------------------")),u.push({content:x.Ip.makeHeaderTable([x.Ip.createLineCenterBold(e.schoolName?e.schoolName:"")],v,!1),answers:[]}),u.push({content:x.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),u.push({content:x.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),u=u.concat(this.getDataForExportDocxApi(l,_,i.offlineExamMixQuestionObj?i.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx?this.docxService.exportToDocxBinary(u,{isHeadless:!0},(A,F,M)=>{}).then(A=>{p({userObj:f,data:A,input:u,additionParams:e,offlineExamMixQuestionObj:i.offlineExamMixQuestionObj})}):t(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(_=>{t(new Error(_[0].message))})})}masterConverterCaller(i,e,f,l,c,p){return new Promise((t,_)=>{const u=this.userService.getUserObj();let v=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),A=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),F=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),M=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),N=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),T=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),L=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const D=new B.Q(1,{function:(h,m)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${m<=1?"":`(${h}/${m}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):g.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});i.forEach(h=>{D.addTask(this,this.itemConverterCaller,[h,{schoolName:l?.nameSchool??`{${v}}`,subject:l?.nameSubject??`{${A}}`,examName:e.name??`{${F}}`,examMinutes:e.minutes&&e.minutes>0?`${M}: `+e.minutes+` ${T} (${N})`:` ${M}: ${L}`,templateType:c??0,numberOfQuestion:h.listQuestion.length,examId:h.offlineExamMixQuestionObj?.hashId??0},u,e,p])}),D.start().then(h=>{if(h.errs.length>0)_(h.errs[0]);else if(1===h.datas.length){const m=h.datas[0],S=new Blob([m.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let P=this.createNameExam(e,f,m.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(S,P),t()}else h.datas.forEach(m=>{let S=this.createNameExam(e,f,m.offlineExamMixQuestionObj);S=this.replaceAllString(S,"/","_"),this.zipper.file("DOCS/"+S,m.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(m=>{let S=this.commonService.createFileNameExportFile([e.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(m,S),t()},m=>{_(m)})},200)})})}replaceAllString(i,e,f){for(;i.includes(e);)i=i.replace(e,f);return i}createNameExam(i,e,f){return e?this.printAnswersheetService.exportFileNameOfExamOffline(0,i.name??"",e?.hashId??"",f?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,i.name??"",i.hashId??"")+".docx"}downloadExam(i,e,f,l,c,p,t,_,u,v,A){return new Promise((F,M)=>{this.isAnsDetail=i,this.isEnableDebug=!!v,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=u,this.loadScriptAction().then(N=>{N?this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(e.hashId??"").subscribe(T=>{if(1==T.success){let L=0,D=0;c.forEach((h,m)=>{h.labelIndex=m,T.data?.resetQuestionIndex&&h.groupInfo&&h.groupInfo.groupId&&(L!=h.groupInfo.groupId&&(L=h.groupInfo.groupId,D=0),h.labelIndex=D,D++)})}this.masterConverterCaller([{listQuestion:c,offlineExamMixQuestionObj:l}],e,f,p,t,A).then(()=>{this.zipper=new C,_?_(10):g.G.closeLoadingEffect(10),F()}).catch(L=>{g.G.closeLoadingEffect(10),M(L)})}):(_?_(10):g.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load")))}).catch(()=>{_?_(10):g.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(i,e,f,l,c,p,t,_,u,v){return new Promise((A,F)=>{this.isAnsDetail=i,this.isEnableDebug=!!u,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=_,this.loadScriptAction().then(M=>{if(M){let N=!0;const T=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(e.hashId??"").subscribe(L=>{l.forEach(D=>{let h=this.commonService.castJsonToClassObjs(W.v,JSON.stringify(D.mixQuestions??[]))??[];if(h.length>0){if(1==L.success){let m=0,S=0;h.forEach((P,k)=>{P.labelIndex=k,L.data?.resetQuestionIndex&&P.groupInfo&&P.groupInfo.groupId&&(m!=P.groupInfo.groupId&&(m=P.groupInfo.groupId,S=0),P.labelIndex=S,S++)})}T.push({listQuestion:h,offlineExamMixQuestionObj:D})}else N=!1}),N?this.masterConverterCaller(T,e,f,c,p,v).then(()=>{this.zipper=new C,t?t(10):g.G.closeLoadingEffect(10),A()}).catch(D=>{t?t(10):g.G.closeLoadingEffect(10),F(D)}):(t?t(10):g.G.closeLoadingEffect(10),F(new Error("lang_testbank_exam_is_invalid_condition")))})}else t?t(10):g.G.closeLoadingEffect(10),F(new Error("lang_core_lib_not_load"))}).catch(()=>{t?t(10):g.G.closeLoadingEffect(10),F(new Error("lang_core_lib_not_load"))})})}}return y.\u0275fac=function(i){return new(i||y)(I.LFG(O.n),I.LFG(w.E),I.LFG(a.z),I.LFG(r.U),I.LFG(d.h),I.LFG(o.H),I.LFG(E.j),I.LFG(b.g),I.LFG(K.i),I.LFG(z.Cq))},y.\u0275prov=I.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()}}]);