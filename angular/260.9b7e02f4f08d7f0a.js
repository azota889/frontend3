"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[260],{17997:(G,P,o)=>{o.d(P,{H:()=>E});var p=o(65879),B=o(46558),w=o(97151),N=o(61419),d=o(41385),y=o(38228);let E=(()=>{class f{constructor(i,n,_,a,m){this.commonService=i,this.shareFileFlutterService=n,this.encryptService=_,this.formatAnswerSheetService=a,this.exportExcelService=m}exportFileNameOfStudentCode(i,n,_){return 100==i&&(n=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(n?"_"+n:"")+"_"+this.encryptService.createMd5(_).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(i,n,_,a,m,A){return 12==n?i.createA5AnswerSheetFullA4_50(A??50):13==n?i.createA4AnswerSheet_35hh(A??50):14==n?i.createA6AnswerSheetFullA4_20(A??20):i.createAzotaAnswerSheet_A4(A??120)}exportFileNameOfAnswerSheet(i,n,_){var a="";return 100==i&&(n=""),(0==i||100==i)&&(a=this.commonService.createFileNameExportFile(["PhieuTL_"+_+(n?"_"+n:"")])),a}exportFileNameOfAnswerExcelOffline(i,n,_){var a="";return 100==i&&(n=""),(0==i||100==i)&&(a=this.commonService.createFileNameExportFile(["DapAn_"+(n?"_"+n:"")])),a}exportFileNameOfRawExam(i,n,_){var a="";return 100==i&&(n=""),(0==i||100==i)&&(a=this.commonService.createFileNameExportFile([(n?"_"+n:"")+"_"+this.encryptService.createMd5(_).substring(0,6)])),a}exportFileNameOfExamOffline(i,n,_,a){var m="";return 100==i&&(n=""),(0==i||100==i)&&(m=this.commonService.createFileNameExportFile([(a?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(a,3)+"_":"")+_+(n?"_"+n:"")])),m}printStudentCode(i,n){var _=[];let a=this.commonService.myClone(n);for(let m=0;m<a.length;m++)_.push({code:a[m].code??0,fullName:a[m]?.fullName??"",birthday:a[m]?.birthday??"",className:a[m].classroomName??""});this._exportExcelForCodeNumber(i,_)}_exportExcelForCodeNumber(i,n){let _=this.exportFileNameOfStudentCode(0,i?.name??"",i?.hashId??"");const a=this.exportExcelService.exportExcelForCodeNumber(n);this.shareFileFlutterService.shareFileWithBlob(a,_)}static#e=this.\u0275fac=function(n){return new(n||f)(p.LFG(B.z),p.LFG(w.g),p.LFG(N.j),p.LFG(d.j),p.LFG(y.L))};static#t=this.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},56260:(G,P,o)=>{o.d(P,{F:()=>z});var p=o(85965),w=o(8720),N=o(70731),d=o(89156),y=o(89745),E=o(79617),f=o(65879),R=o(32965),i=o(46558),n=o(2816),_=o(19662),a=o(17997),m=o(41385),A=o(97151);let z=(()=>{class F{constructor(s,e,l,r,v,g,t){this.cdnService=s,this.commonService=e,this.userService=l,this.questionRenderService=r,this.printAnswersheetService=v,this.formatAnswerSheetService=g,this.shareFileFlutterService=t,this.configRenderService=new w.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new p,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((s,e)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?typeof azotaDocx<"u"&&azotaDocx?s(!0):e(new Error("lang_core_lib_not_load")):(this.countRetryLoadJS++,this.countRetryLoadJS>3?e(new Error("lang_core_lib_not_load")):s(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(s){let e=[];return s.forEach(l=>{let r="<b>     "+(l.alpha?l.alpha:l.key)+".</b> "+(0,E.uG)(l.content);e.push(r)}),e}getDataForExportDocxApi(s,e,l){let r=[],v=1;if(l){let t=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");r.push({content:`<b> ${t} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(l,3)+".</b>",answers:[]})}let g=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return e.forEach(t=>{1!==s.hideGroupQuestion&&t.groupInfo?.isFirstInGroup&&t.groupInfo.groupContent&&r.push({content:t.groupInfo.groupContent,answers:[]}),this.isEnableDebug&&r.push({content:` <br/><br/><br/>*** <b>Question ID: ${t.id}</b> ***`,answers:[]});let c={content:`<b>${g} `+(v+(s.startQuestionIndex??1)-1)+".</b> "+(t.content?.includes("<img")?"<br>":"")+(0,E.uG)(t.content),answers:this.convertAnswerQuestion(t.answers??[])};if(v++,r.push(c),this.isAnsDetail){if(t.answerResult){let h=[];t.answerResult.forEach(S=>{let D=S;const M=t.answers?.find(x=>x.key===S);M&&(D=M.alpha??D),h.push(D)}),r.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_dap_an_dung")}</b>: ${h.join(" | ")}`,answers:[]})}t.help&&r.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_giai_thich_chi_tiet_upper")}</b>: ${t.help}`,answers:[]})}this.isEnableDebug&&r.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),r}itemConverterCaller(s,e,l,r,v){return new Promise((g,t)=>{this.questionRenderService.parseRenderQuestions(s.listQuestion,c=>{this.saveLoadingMsg.includes(")")||(this.changeMsg?this.changeMsg(this.saveLoadingMsg+Math.floor(c)+"%"):d.G.changeMsgLoadingEffect(this.saveLoadingMsg+Math.floor(c)+"%"))},this.configRenderService,void 0,!0,v).then(c=>{let h=[];h.push({content:E.Ip.makeHeaderTable([E.Ip.createLineCenterBold(e.schoolName?e.schoolName:"")],[E.Ip.createLineCenterBold(e.examName??""),E.Ip.createLineCenterBold(e.subject??""),E.Ip.createLineCenterItalicized(e.examMinutes??""),E.Ip.createLineCenterItalicized("-------------------------")],!1),answers:[]}),h.push({content:E.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),h.push({content:E.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),h=h.concat(this.getDataForExportDocxApi(r,c,s.offlineExamMixQuestionObj?s.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx?azotaDocx.exportToDocxBinary({questions:h,additionalParams:{isHeadless:!0}}).then(S=>{g({userObj:l,data:S,input:h,additionParams:e,offlineExamMixQuestionObj:s.offlineExamMixQuestionObj})}):t(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(c=>{t(new Error(c[0].message))})})}masterConverterCaller(s,e,l,r,v,g){return new Promise((t,c)=>{const h=this.userService.getUserObj();let S=this.commonService.myTranslateInstant("lang_testbank_utils_footer_infomation_school")?.toLowerCase(),D=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),M=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),x=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),O=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),C=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),b=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const T=new N.Q(1,{function:(I,u)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${u<=1?"":`(${I}/${u}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):d.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});s.forEach(I=>{T.addTask(this,this.itemConverterCaller,[I,{schoolName:r?.nameSchool??`{${S}}`,subject:r?.nameSubject??`{${D}}`,examName:e.name??`{${M}}`,examMinutes:e.minutes&&e.minutes>0?`${x}: `+e.minutes+` ${C} (${O})`:` ${x}: ${b}`,templateType:v??0,numberOfQuestion:I.listQuestion.length,examId:I.offlineExamMixQuestionObj?.hashId??0},h,e,g])}),T.start().then(I=>{if(I.errs.length>0)c(I.errs[0]);else if(1===I.datas.length){const u=I.datas[0],L=new Blob([u.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let U=this.createNameExam(e,l,u.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(L,U),t()}else I.datas.forEach(u=>{let L=this.createNameExam(e,l,u.offlineExamMixQuestionObj);L=this.replaceAllString(L,"/","_"),this.zipper.file("DOCS/"+L,u.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(u=>{let L=this.commonService.createFileNameExportFile([e.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(u,L),t()},u=>{c(u)})},200)})})}replaceAllString(s,e,l){for(;s.includes(e);)s=s.replace(e,l);return s}createNameExam(s,e,l){return e?this.printAnswersheetService.exportFileNameOfExamOffline(0,s.name??"",e?.hashId??"",l?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,s.name??"",s.hashId??"")+".docx"}downloadExam(s,e,l,r,v,g,t,c,h,S,D){return new Promise((M,x)=>{this.isAnsDetail=s,this.isEnableDebug=!!S,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=h,this.loadScriptAction().then(O=>{O?this.masterConverterCaller([{listQuestion:v,offlineExamMixQuestionObj:r}],e,l,g,t,D).then(()=>{this.zipper=new p,c?c(10):d.G.closeLoadingEffect(10),M()}).catch(C=>{d.G.closeLoadingEffect(10),x(C)}):(c?c(10):d.G.closeLoadingEffect(10),x(new Error("lang_core_lib_not_load")))}).catch(()=>{c?c(10):d.G.closeLoadingEffect(10),x(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(s,e,l,r,v,g,t,c,h,S){return new Promise((D,M)=>{this.isAnsDetail=s,this.isEnableDebug=!!h,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=c,this.loadScriptAction().then(x=>{if(x){let O=!0;const C=[];r.forEach(b=>{let T=this.commonService.castJsonToClassObjs(y.v,JSON.stringify(b.mixQuestions??[]))??[];T.length>0?C.push({listQuestion:T,offlineExamMixQuestionObj:b}):O=!1}),O?this.masterConverterCaller(C,e,l,v,g,S).then(()=>{this.zipper=new p,t?t(10):d.G.closeLoadingEffect(10),D()}).catch(b=>{t?t(10):d.G.closeLoadingEffect(10),M(b)}):(t?t(10):d.G.closeLoadingEffect(10),M(new Error("lang_testbank_exam_is_invalid_condition")))}else t?t(10):d.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load"))}).catch(()=>{t?t(10):d.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load"))})})}static#e=this.\u0275fac=function(e){return new(e||F)(f.LFG(R.E),f.LFG(i.z),f.LFG(n.U),f.LFG(_.h),f.LFG(a.H),f.LFG(m.j),f.LFG(A.g))};static#t=this.\u0275prov=f.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"})}return F})()}}]);