"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[4596],{71069:(x,h,c)=>{c.d(h,{Z:()=>_});var u=c(69862),v=c(65592),S=c(61713),p=c(65879),k=c(46558),E=c(82228),M=c(77757);let _=(()=>{class f{replaceImageInContent(a){return new v.y(e=>{if(a.includes("<img ")){var t=this.findAllSubString(a,"<img"),r=[],n=[];t.forEach(o=>{var i=a.indexOf("src=",o),l=a.indexOf('"',Number(i)+5),d=a.substring(Number(i)+5,Number(l)+1);d.includes(";base64")?r.push({oldUrl:d}):d.includes("blob:")&&n.push({oldUrl:d})}),r.length>0?this.reUploadBase64File(r,(o,i)=>{null==i?n&&n.length>0?this.reUploadBlobFile(n,(l,d)=>{null!=d?(a=this.replaceHomeworkContent(a,o),a=this.replaceHomeworkContent(a,l),e.next({errorMessage:void 0,content:a}),e.complete()):(e.next({errorMessage:d,content:a}),e.complete())}):(a=this.replaceHomeworkContent(a,o),e.next({errorMessage:void 0,content:a}),e.complete()):(e.next({errorMessage:i,content:a}),e.complete())}):n.length>0?this.reUploadBlobFile(n,(o,i)=>{null==i?(a=this.replaceHomeworkContent(a,o),e.next({errorMessage:void 0,content:a}),e.complete()):(e.next({errorMessage:i,content:a}),e.complete())}):(a=this.replaceHomeworkContent(a,[]),e.next({errorMessage:void 0,content:a}),e.complete())}else e.next({errorMessage:void 0,content:a}),e.complete()})}replaceHomeworkContent(a,e){return e.length>0&&e.forEach(t=>{a=a.replace(t.oldUrl??"  ",t.newUrl+'" class="w-100 img-fluid"')}),a}findAllSubString(a,e){for(var t=0,r=0,n=[];a.indexOf(e,t)>-1;)r=a.indexOf(e,t),n.push(r),t=r+e.length;return n}getTypeFile(a){var e=a.indexOf(";");return a.substring(5,e)}getFileName(a){var e=a.split("").reverse().join(""),t=e.indexOf(";"),r=e.indexOf("/",t);return e.substring(t,r).split("").reverse().join("")}convertBlobToBase64(a){return new Promise(e=>{var t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",function(){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=t.width,r.height=t.height,n?.drawImage(t,0,0);var o=r.toDataURL("image/png");e(o)},!1),t.src=a})}reUploadBase64File(a,e){if(a&&a.length>0){let o,n=a.length;for(var t=[],r=0;r<a.length;r++){const i=a[r],l=i.oldUrl?.substring(0,i.oldUrl.length-1);this.startUploadBlobFile(i,l??"",[],(d,g)=>{null==g?t=t.concat(d):o=g,n-=1,0==n&&e(t,o)})}}else e([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(a,e){if(a&&a.length>0){let o,n=a.length;for(var t=[],r=0;r<a.length;r++){const i=a[r],l=i?.oldUrl?.substring(0,i.oldUrl.length-1);this.convertBlobToBase64(l??"").then(d=>{this.startUploadBlobFile(i,d,[],(g,m)=>{null==m?t=t.concat(g):o=m,n-=1,0==n&&e(t,o)})})}}else e([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(a,e,t,r){if(e&&""!=e){var n=this.getTypeFile(e),o=this.myPdfService.b64toFile(e,this.getFileName(n),n);(0,S.hv)(o).then(i=>{this.apiUploadService.uploadToCdnForHomework(i).subscribe(l=>{if(l.type!=u.dt.UploadProgress)if(1==l.success){var d={...a,newUrl:l.data?.url??""};t.push(d),r(t,void 0)}else r(t,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",l.message??"none"))})})}else r(t,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(a,e,t){this.commonService=a,this.apiUploadService=e,this.myPdfService=t}}return f.\u0275fac=function(a){return new(a||f)(p.LFG(k.z),p.LFG(E.W),p.LFG(M.z))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},61325:(x,h,c)=>{c.d(h,{$:()=>_});var u=c(69862),v=c(65592),S=c(61713),p=c(65879),k=c(46558),E=c(82228),M=c(77757);let _=(()=>{class f{replaceImageInContent(a,e){return new v.y(t=>{if(e.includes("<img ")){var r=this.findAllSubString(e,"<img"),n=[],o=[];r.forEach(i=>{var l=e.indexOf("src=",i),d=e.indexOf('"',Number(l)+5),g=e.substring(Number(l)+5,Number(d)+1);g.includes(";base64")?n.push({oldUrl:g}):g.includes("blob:")&&o.push({oldUrl:g})}),n.length>0?this.reUploadBase64File(a,n,(i,l)=>{null==l?o&&o.length>0?this.reUploadBlobFile(a,o,(d,g)=>{null!=g?(e=this.replaceHomeworkContent(e,i),e=this.replaceHomeworkContent(e,d),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:g,content:e}),t.complete())}):(e=this.replaceHomeworkContent(e,i),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:l,content:e}),t.complete())}):o.length>0?this.reUploadBlobFile(a,o,(i,l)=>{null==l?(e=this.replaceHomeworkContent(e,i),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:l,content:e}),t.complete())}):(e=this.replaceHomeworkContent(e,[]),t.next({errorMessage:void 0,content:e}),t.complete())}else t.next({errorMessage:void 0,content:e}),t.complete()})}replaceHomeworkContent(a,e){return e.length>0&&e.forEach(t=>{a=a.replace(t.oldUrl??"  ",t.newUrl+'" class="w-100 img-fluid"')}),a}findAllSubString(a,e){for(var t=0,r=0,n=[];a.indexOf(e,t)>-1;)r=a.indexOf(e,t),n.push(r),t=r+e.length;return n}getTypeFile(a){var e=a.indexOf(";");return a.substring(5,e)}getFileName(a){var e=a.split("").reverse().join(""),t=e.indexOf(";"),r=e.indexOf("/",t);return e.substring(t,r).split("").reverse().join("")}convertBlobToBase64(a){return new Promise(e=>{var t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",function(){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=t.width,r.height=t.height,n?.drawImage(t,0,0);var o=r.toDataURL("image/png");e(o)},!1),t.src=a})}reUploadBase64File(a,e,t){if(e&&e.length>0){let i,o=e.length;for(var r=[],n=0;n<e.length;n++){const l=e[n],d=l.oldUrl?.substring(0,l.oldUrl.length-1);this.startUploadBlobFile(a,l,d??"",[],(g,m)=>{null==m?r=r.concat(g):i=m,o-=1,0==o&&t(r,i)})}}else t([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(a,e,t){if(e&&e.length>0){let i,o=e.length;for(var r=[],n=0;n<e.length;n++){const l=e[n],d=l?.oldUrl?.substring(0,l.oldUrl.length-1);this.convertBlobToBase64(d??"").then(g=>{this.startUploadBlobFile(a,l,g,[],(m,O)=>{null==O?r=r.concat(m):i=O,o-=1,0==o&&t(r,i)})})}}else t([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(a,e,t,r,n){if(t&&""!=t){var o=this.getTypeFile(t),i=this.myPdfService.b64toFile(t,this.getFileName(o),o);(0,S.hv)(i).then(l=>{this.apiUploadService.commonUploadFile(a,l,"").subscribe(d=>{if(d.type!=u.dt.UploadProgress)if(1==d.success){var g={...e,newUrl:d.data?.url??""};r.push(g),n(r,void 0)}else n(r,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",d.message??"none"))})})}else n(r,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(a,e,t){this.commonService=a,this.apiUploadService=e,this.myPdfService=t}}return f.\u0275fac=function(a){return new(a||f)(p.LFG(k.z),p.LFG(E.W),p.LFG(M.z))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},28368:(x,h,c)=>{c.d(h,{y:()=>M});var u=c(65879),v=c(88489);let S=(()=>{class _{getMode(){return""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light"}constructor(s){this.browserStorageService=s}}return _.\u0275fac=function(s){return new(s||_)(u.LFG(v.n))},_.\u0275prov=u.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})();var p=c(46558),k=c(61325),E=c(32965);let M=(()=>{class _{constructor(s,a,e,t){this.darkModeService=s,this.commonService=a,this.sAztUploadImageOfExamService=e,this.cdnService=t}initConfigForAdmin(){var e={};return e={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["code","fullscreen","link"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | link | code | fullscreen"},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}initConfigForAdminWithUploadImageBox(s){var t={};return t={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen link",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | link | code | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,file_picker_callback:(r,n,o)=>{this.file_picker_callback(s,r,n,o)}},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForTeacher(){var e={};return e={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["fullscreen"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | fullscreen"},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}initConfigTeacherHomework(s){var t={};return t={min_height:s,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigStudentHomework(){var e={};return e={height:450,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",readonly:1,plugins:["emoticons advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | emoticons",emoticons_database:"emojis",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}initConfigForTeacherWithUploadImageBox(s){var t={};return t={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,file_picker_callback:(r,n,o)=>{this.file_picker_callback(s,r,n,o)}},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}file_picker_callback(s,a,e,t){let r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("accept","image/*"),r.onchange=()=>{let n=r.files?.[0],o=new FileReader;o.onload=()=>{let l=`<img src="${"data:image/png;base64, "+o.result.split(",")[1]}">`;this.sAztUploadImageOfExamService.replaceImageInContent(s,l).subscribe(d=>{if(d.errorMessage)this.commonService.snackError(d.errorMessage);else{let g=document.createElement("div");g.innerHTML=this.commonService.removeXssInHtml(d.content);let m=g.firstChild;m&&m.src&&a(m.src)}})},o.readAsDataURL(n)},r.click()}}return _.\u0275fac=function(s){return new(s||_)(u.LFG(S),u.LFG(p.z),u.LFG(k.$),u.LFG(E.E))},_.\u0275prov=u.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()}}]);