"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7787],{5955:(k,P,u)=>{u.d(P,{C:()=>T});var M=u(26860);let T=(()=>{class n{static#t=this.PADDING_ITEM=40;constructor(a){this.el=a,this.answerSizeManager=0,this.process()}ngOnChanges(a){a.answerSizeManager&&a.answerSizeManager.currentValue!==a.answerSizeManager.previousValue&&a.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(a=>{const p=this.el.nativeElement,m=p.children,g=[];for(let v=0;v<m.length;v++)g.push(this.getSizeWidthElement(m[v]));let h=1;[2,4].forEach(v=>{this.isLayout(a.width,g,v)&&(h=v)}),p.classList.remove("row");for(let v=0;v<m.length;v++){const t=m[v];t.classList.remove("col-sm-12"),t.classList.remove("col-md-6")}p.classList.add("layout"),p.classList.add("layout-"+h)})}isLayout(a,p,m){const g=Math.floor(a/m);for(const h of p)if(h+n.PADDING_ITEM>g)return!1;return!0}onElementLoaded(){return new Promise((a,p)=>{let m=!1;for(let g=0;g<=10;g++)setTimeout(()=>{if(!m){const h=this.actionGetSizeBox();h.width>0&&h.height&&(m=!0,a(h))}10===g&&!m&&p(new Error)},100*g)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(a){let p=0;for(let m=0;m<a.children.length;m++)p+=a.children[m].getBoundingClientRect().width;return p}static#e=this.\u0275fac=function(p){return new(p||n)(M.rXU(M.aKT))};static#s=this.\u0275dir=M.FsC({type:n,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[M.OA$]})}return n})()},25539:(k,P,u)=>{u.d(P,{I:()=>M});class M{constructor(){this.answerLabelsMockup={}}}},5382:(k,P,u)=>{u.d(P,{n:()=>M});class M{constructor(n,o,a,p){this.tasks=new Array,this.queues=new Array,this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=n,this.result_common_temp={datas:[],errs:[]},this.action_log_item=o,this.delay_time=a||1e3,this.end_with_error=p??!1}addTask(n,o,a,p){if(this.is_running)return;var m=a||[];const g=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(v=>{this.wrap_counter++,o.call(n,...m).then(t=>{this.wrap_counter_done++,this.callLog(p),v({status:!0,value:t,index:g})}).catch(t=>{this.wrap_counter_done++,this.callLog(p),v({status:!1,error:t,index:g})})}),name:p})}callLog(n){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],n)}start(){return new Promise(n=>{0===this.queues.length&&n({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let o=0;o<this.limit_one_process;o++){const a=this.queues.shift();if(!a)break;this.tasks.push(a)}this.count_task_root_done=0,this.is_running=!0,this.runner(n)})}checker(n,o){this.count_task_root_done++,n.status&&n.value?this.result_common_temp.datas.push({index:n.index,value:n.value}):n.error&&this.result_common_temp.errs.push({index:n.index,value:n.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,o(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,o(this.makeResultObj())),this.nextItem(o)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(n,o){return n.index-o.index}).map(n=>n.value),errs:this.result_common_temp.errs.sort(function(n,o){return n.index-o.index}).map(n=>n.value)}}nextItem(n){const o=this.queues.shift();o&&o.task.call(this).then(a=>{this.checker(a,n)})}runner(n){this.tasks.length>0?this.tasks.forEach(o=>{o.task.call(this).then(a=>{this.checker(a,n)})}):(this.is_running=!1,n(this.makeResultObj()))}}},76671:(k,P,u)=>{u.d(P,{c:()=>g});var M=u(73014),T=u(27691),n=u(5382),o=u(26860),a=u(91930),p=u(41426);const m=u(4060);let g=(()=>{class h{constructor(t,e){this.commonService=t,this.apiUploadService=e,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}static#t=this.searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g;convertBase64OfMathJaxToCdnUrl(t){return new Promise(e=>{var s=this.getValueContentQuestion(t.questionContent??""),r=this.getValueContentQuestion(t.answerConfig??""),i=t.answerMedia??"",_=this.removeBase64MathJaxInQuestionContent(t.questionText??"");if(0===s.length||0===r.length)return void e(t);let d=this.encodeContent(s[0].content),C=[];r.forEach((l,f)=>{C.push({i:f,d:this.encodeContent(l.content)})});let w=this.encodeContent(i);var c=0;let E=[];for(let l=0;l<d.raws.length;l++)d.raws[l].i=c,c++,E.push(d.raws[l]);for(let l=0;l<w.raws.length;l++)w.raws[l].i=c,c++,E.push(w.raws[l]);C.forEach(l=>{for(let f=0;f<l.d.raws.length;f++)l.d.raws[f].i=c,c++,E.push(l.d.raws[f])}),E.length>0?this.uploadRawContent(E.map(l=>l.l)).then(l=>{d.raws.forEach(f=>{let O=this.stringFirst+btoa(JSON.stringify({l,i:f.i}));s[0].content=this.commonService.replaceAll(s[0].content,f.l,O)??""}),w.raws.forEach(f=>{let O=this.stringFirst+btoa(JSON.stringify({l,i:f.i}));i=this.commonService.replaceAll(i,f.l,O)??""}),C.forEach(f=>{f.d.raws.forEach(O=>{let R=this.stringFirst+btoa(JSON.stringify({l,i:O.i}));r[f.i].content=this.commonService.replaceAll(r[f.i].content,O.l,R)??""})}),t.questionContent=JSON.stringify(s),t.answerConfig=JSON.stringify(r),t.answerMedia=i,t.questionText=_,e(t)}).catch(()=>{e(t)}):e(t)})}decodeMathJaxCodeToCdnUrl(t){return new Promise(e=>{const s=new n.n(10);if(s.addTask(this,()=>new Promise(r=>{this.decodeContent(t.content??"").then(i=>{t.content=i,r(!0)}).catch(()=>{r(!1)})})),s.addTask(this,()=>new Promise(r=>{this.decodeContent(t.help??"").then(i=>{t.help=i,r(!0)}).catch(()=>{r(!1)})})),t.answers)for(let r=0;r<t.answers.length;r++)s.addTask(this,()=>new Promise(i=>{t.answers&&this.decodeContent(t.answers[r].content??"").then(_=>{t.answers&&(t.answers[r].content=_),i(!0)}).catch(()=>{i(!1)})}));s.start().then(()=>{e()})})}getValueContentQuestion(t){return this.commonService.castJsonToObj(t)??[]}getAllMatchWithContent(t){let s,e=[];for(;null!==(s=h.searchPattern.exec(t));)e.includes(s[0])||e.push(s[0]);return e}getRawContent(t,e){return new Promise((s,r)=>{const i=this.dataRaws.findIndex(_=>_.l===t);-1===i?fetch(t).then(_=>_.blob()).then(_=>_.arrayBuffer()).then(_=>{const d=m.inflate(_),C=this.commonService.castJsonToObj((new TextDecoder).decode(d));this.dataRaws.push({l:t,d:C??[]}),C&&C[e]?s(C[e]):r(new Error("Not found index"))}).catch(()=>{r(new Error("Exception at feed link"))}):this.dataRaws[i].d&&this.dataRaws[i].d[e]?s(this.dataRaws[i].d[e]):r(new Error("Not found index"))})}uploadRawContent(t){return new Promise((e,s)=>{const r=JSON.stringify(t),i=(new TextEncoder).encode(r),_=m.deflate(i),d=new Blob([_],{type:"application/octet-stream"}),C=new File([d],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(C).subscribe(w=>{w.type!=T.hv.UploadProgress&&(1==w.success&&w.data?e(w.data.url??""):s(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+w.message)))})})}removeBase64MathJaxInQuestionContent(t){return this.encodeContent(t).raws.forEach(s=>{t=this.commonService.replaceAll(t,s.l,"")??""}),t}encodeContent(t){let e=this.getAllMatchWithContent(t),s=[];for(let r=0;r<e.length;r++){let _=e[r].replace(h.searchPattern,"$1");_.startsWith(this.stringFirst)||s.push({l:_,i:s.length})}return{content:t,raws:s}}decodeContent(t){var e=this;return(0,M.A)(function*(){let s=e.getAllMatchWithContent(t);for(let r=0;r<s.length;r++){const i=s[r];let _=i.replace(h.searchPattern,"$1");for(let d=0;d<e.stringFirstOld.length;d++)if(_.startsWith(e.stringFirstOld[d])){t=e.commonService.replaceAll(t,i,"")??"";continue}if(_.startsWith(e.stringFirst)){let d=e.commonService.castJsonToObj(atob(_.replace(e.stringFirst,"")));if(d){let C=yield e.getRawContent(d.l,d.i);t=e.commonService.replaceAll(t,_,C)??""}}}return t})()}static#e=this.\u0275fac=function(e){return new(e||h)(o.KVO(a.R),o.KVO(p.T))};static#s=this.\u0275prov=o.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},32639:(k,P,u)=>{u.d(P,{g:()=>g});var M=u(65106),T=u(5382),n=u(4744),o=u(26860),a=u(40949),p=u(91930),m=u(76671);let g=(()=>{class h{pushImage(t,e,s){if(s){let r=new RegExp("<div id='"+t+"'[^>]+></div>","g");s.content&&(s.content=s.content.replace(r,e??"")),s.answers&&s.answers.forEach(i=>{i.content=i.content?.replace(r,e??"")}),s.help&&(s.help=s.help.replace(r,e??"")),s.groupInfo&&s.groupInfo.groupContent&&(s.groupInfo.groupContent=s.groupInfo.groupContent.replace(r,e??""))}}parseRenderQuestions(t,e,s,r,i,_){return new Promise((d,C)=>{const c=new T.n(25,{function:(E,l)=>{e&&e(E/l*100)}},r??1e3);t.forEach(E=>{c.addTask(this,this.parseRenderQuestion,[E,s,i,_])}),c.start().then(E=>{if(E.errs.length>0){const l=[];E.errs.forEach(f=>{let O=l.find(R=>R.type===f.type);O||l.push(f),O?.data.concat(f.data)}),C(l)}else d(t)})})}parseRenderQuestion(t,e,s,r){return new Promise((i,_)=>{var d=new n.h(this.cdnService,this.commonService,e||new M.y,c=>{_(c)});d.callbackPushImage=(c,E)=>{this.pushImage(c,E,t)},d.caller=this;const w=new T.n(r?1:20,void 0,0);t.content&&w.addTask(this,()=>new Promise(c=>{t.content=d.render(this.commonService.removeBracket(t.content??""),()=>{c()})})),t.answers&&t.answers.forEach(c=>{w.addTask(this,()=>new Promise(E=>{c.content=d.render(c.content||"",()=>{E()})}))}),t.help&&w.addTask(this,()=>new Promise(c=>{t.help=d.render(t.help,()=>{c()})})),t.groupInfo&&t.groupInfo.groupContent&&w.addTask(this,()=>new Promise(c=>{t.groupInfo&&t.groupInfo.groupContent?t.groupInfo.groupContent=d.render(this.commonService.removeBracket(t.groupInfo.groupContent),()=>{c()}):c()})),s&&w.addTask(this,()=>new Promise(c=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(t).then(()=>{c()})})),w.start().then(c=>{c.errs.length>0||i()})})}constructor(t,e,s){this.cdnService=t,this.commonService=e,this.dataAztMathRawHelper=s}static#t=this.\u0275fac=function(e){return new(e||h)(o.KVO(a.B),o.KVO(p.R),o.KVO(m.c))};static#e=this.\u0275prov=o.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()}}]);