"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[137],{20137:(I,D,k)=>{k.d(D,{n:()=>W});var u=k(15861),E=k(65879),L=k(46558),B=k(32965),J=k(27161);let W=(()=>{class S{constructor(h,n,i){this.commonService=h,this.cdnService=n,this.answerTypeService=i}convertUrlToBase64(h){return(0,u.Z)(function*(){const i=yield(yield fetch(h+"?t="+(new Date).getTime())).blob();return new Promise(l=>{const a=new FileReader;a.readAsDataURL(i),a.onloadend=()=>{l(a.result)}})})()}convertLinkToBase64(h,n,i){var l=this;return(0,u.Z)(function*(){if(!n)return i;for(let w=0;w<(h?.length??0);w++)if(h?.[w].link===i)return h?.[w].convert;var a=yield l.convertUrlToBase64(i);return h?.push({convert:a,link:i}),a})()}replaceCanvasBackground(h,n){var i=this;return(0,u.Z)(function*(){if(h){var l=[];for(let x=0;x<h.length;x++){var a=h[x];if(a&&0===a.isImage){var w=a.questionContentParse?.[0].content;a.questionContentParse&&(a.questionContentParse[0].content="");var P=void 0===w?[]:w.split("@[]");for(let e=0;e<P.length;e++){var p=P[e];if(!0===i.commonService.isJson(p)){var d=i.commonService.willDeleteParseJson(p);if(d.hasOwnProperty("link")){var m=document.body.offsetWidth,r=1;d.data.width>(g=m-30)&&(d.data={x:d.data.x*(r=g/d.data.width),y:d.data.y*r,width:d.data.width*r,height:d.data.height*r}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},a.questionContentParse&&(a.questionContentParse[0].content+=`<div class="background_question_${x}_${e}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,n,i.cdnService.getMyCdn(d.link))}"></div>`);var _=document.createElement("style");document.body.appendChild(_),_.textContent+=`.background_question_${x}_${e} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${x}_${e} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else a.questionContentParse&&(a.questionContentParse[0].content+=p)}else a.questionContentParse&&(a.questionContentParse[0].content+=p)}if(i.answerTypeService.isOneChoiceAnswer(a))for(let e=0;e<(a.answerConfigParse?.length??0);e++){var v=a.answerConfigParse?.[e].content;a.answerConfigParse&&(a.answerConfigParse[e].content="");var $=void 0===v?[]:v.split("@[]");for(let C=0;C<$.length;C++){var M=$[C];if(!0===i.commonService.isJson(M)){var t=i.commonService.willDeleteParseJson(M);t.hasOwnProperty("link")?(m=document.body.offsetWidth,r=1,t.data.width>(g=m-30)&&(t.data={x:t.data.x*(r=g/t.data.width),y:t.data.y*r,width:t.data.width*r,height:t.data.height*r}),t.data={x:Math.floor(t.data.x),y:Math.floor(t.data.y),width:Math.floor(t.data.width),height:Math.floor(t.data.height)},a.answerConfigParse&&(a.answerConfigParse[e].content+=`<div class="background_question__ans${x}_${e}_${C}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,n,i.cdnService.getMyCdn(t.link))}"></div>`),_=document.createElement("style"),document.body.appendChild(_),_.textContent+=`.background_question__ans${x}_${e}_${C} {margin: 0 3px; width: ${t.data.width}px; height: ${t.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${x}_${e}_${C} img { margin-top: -${t.data.y}px; margin-left: -${t.data.x}px;}`):a.answerConfigParse&&(a.answerConfigParse[e].content+=M)}else a.answerConfigParse&&(a.answerConfigParse[e].content+=M)}}if(a.answerMediaParse&&a.answerMediaParse.length>0){var y=a.answerMediaParse;a.answerMediaParse="";var f=void 0===y?[]:y.split("@[]");for(let e=0;e<f.length;e++){var T=f[e];if(!0===i.commonService.isJson(T)){var g,o=i.commonService.willDeleteParseJson(T);if(o.hasOwnProperty("link"))m=document.body.offsetWidth,r=1,o.data.width>(g=m-30)&&(o.data={x:o.data.x*(r=g/o.data.width),y:o.data.y*r,width:o.data.width*r,height:o.data.height*r}),o.data={x:Math.floor(o.data.x),y:Math.floor(o.data.y),width:Math.floor(o.data.width),height:Math.floor(o.data.height)},a.answerMediaParse+=`<div class="background_question__ans_result${x}_${e}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,n,i.cdnService.getMyCdn(o.link))}"></div>`,_=document.createElement("style"),document.body.appendChild(_),_.textContent+=`.background_question__ans_result${x}_${e} {margin: 0 3px; width: ${o.data.width}px; height: ${o.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${x}_${e} img { margin-top: -${o.data.y}px; margin-left: -${o.data.x}px;}`;else a.answerMediaParse+=T}else a.answerMediaParse+=T}}}}}})()}replaceCanvasBackgroundTS(h,n){var i=this;return(0,u.Z)(function*(){var l=[];for(let y=0;y<h.length;y++){var a=h[y];if(0===a.isImage){var w=a.questionContentParse[0].content;a.questionContentParse[0].content="";var P=void 0===w?[]:w.split("@[]");for(let f=0;f<P.length;f++){var p=P[f];if(!0===i.commonService.isJson(p)){var d=i.commonService.willDeleteParseJson(p);if(d.hasOwnProperty("link")){var m=document.body.offsetWidth,r=1;d.data.width>(g=m-30)&&(d.data={x:d.data.x*(r=g/d.data.width),y:d.data.y*r,width:d.data.width*r,height:d.data.height*r}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},a.questionContentParse[0].content+=`<div class="background_question_${y}_${f}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,n,i.cdnService.getMyCdn(d.link))}"></div>`;var _=document.createElement("style");document.body.appendChild(_),_.textContent+=`.background_question_${y}_${f} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${y}_${f} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else a.questionContentParse[0].content+=p}else a.questionContentParse[0].content+=p}if(i.answerTypeService.isOneChoiceAnswer(a)&&(0==a.isImage||1==a.isImage&&a.name.startsWith("[PDFv2]")?i.replaceBackgroundAnswerConfig(a.answerConfigParse,l,y,n):i.replaceBackgroundAnswerConfig(a.answerConfigParseVer1.answerConfigV2,l,y,n)),a.answerMedia&&a.answerMedia.length>0){var v=a.answerMedia;a.answerMedia="";var $=void 0===v?[]:v.split("@[]");for(let f=0;f<$.length;f++){var M=$[f];if(!0===i.commonService.isJson(M)){var g,t=i.commonService.willDeleteParseJson(M);if(t.hasOwnProperty("link"))m=document.body.offsetWidth,r=1,t.data.width>(g=m-30)&&(t.data={x:t.data.x*(r=g/t.data.width),y:t.data.y*r,width:t.data.width*r,height:t.data.height*r}),t.data={x:Math.floor(t.data.x),y:Math.floor(t.data.y),width:Math.floor(t.data.width),height:Math.floor(t.data.height)},a.answerMedia+=`<div class="background_question__ans_result${y}_${f}"><img width="${1024*r}" height="${1024*r}" src="${yield i.convertLinkToBase64(l,n,i.cdnService.getMyCdn(t.link))}"></div>`,_=document.createElement("style"),document.body.appendChild(_),_.textContent+=`.background_question__ans_result${y}_${f} {margin: 0 3px; width: ${t.data.width}px; height: ${t.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${y}_${f} img { margin-top: -${t.data.y}px; margin-left: -${t.data.x}px;}`;else a.answerMedia+=M}else a.answerMedia+=M}}}}return!0})()}replaceBackgroundAnswerConfig(h,n,i,l){var a=this;return(0,u.Z)(function*(){for(let v=0;v<h.length;v++){var w=h[v].content;h[v].content="";var P=void 0===w?[]:w.split("@[]");for(let $=0;$<P.length;$++){var p=P[$];if(!0===a.commonService.isJson(p)){var d=a.commonService.willDeleteParseJson(p);if(d.hasOwnProperty("link")){var g=document.body.offsetWidth-30,r=1;d.data.width>g&&(d.data={x:d.data.x*(r=g/d.data.width),y:d.data.y*r,width:d.data.width*r,height:d.data.height*r}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},h[v].content+=`<div class="background_question__ans${i}_${v}_${$}"><img width="${1024*r}" height="${1024*r}" src="${yield a.convertLinkToBase64(n,l,a.cdnService.getMyCdn(d.link))}"></div>`;var _=document.createElement("style");document.body.appendChild(_),_.textContent+=`.background_question__ans${i}_${v}_${$} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${i}_${v}_${$} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else h[v].content+=p}else h[v].content+=p}}})()}static#a=this.\u0275fac=function(n){return new(n||S)(E.LFG(L.z),E.LFG(B.E),E.LFG(J.i))};static#d=this.\u0275prov=E.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"})}return S})()}}]);