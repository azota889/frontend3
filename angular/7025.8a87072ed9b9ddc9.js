"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7025],{6408:(J,N,n)=>{n.d(N,{h:()=>L});var e=n(10936),t=n(99974),i=n(26860),M=n(96699);let L=(()=>{var S;class m{constructor(r){this.testMarketQuestionService=r,this.schoolLevelSubjectObjs=[],this.formSchoolInfo=new e.gE({schoolLevel:new e.MJ(0,{nonNullable:!0}),schoolSubject:new e.MJ(0,{nonNullable:!0})})}initialData(){return new Promise(r=>{this.testMarketQuestionService.apiTestMarketQuestionsSubjectLevelsGet().subscribe(u=>{1==u.success?(this.schoolLevelSubjectObjs=u.data?.schoolLevelSubjectObjs??[],this.formSchoolInfo.controls.schoolLevel.setValue(12),this.formSchoolInfo.controls.schoolSubject.setValue(40),this.apiLeechData(void 0).then(b=>{r(b.map(d=>new t.Q(d.id,d.pr,d.type,void 0,d.name,d.examHashId,d.examCategoryId,0,!d.isLeaf,!1,void 0,d.isLeaf)))}).catch(()=>{r([])})):r([])})})}apiLeechData(r){return new Promise(u=>{const b=[];this.testMarketQuestionService.apiTestMarketQuestionsKnowledgeGet(Number(this.formSchoolInfo.controls.schoolLevel.value),Number(this.formSchoolInfo.controls.schoolSubject.value),r).subscribe(d=>{1===d.success&&d.data&&(d.data.objs||[]).forEach(g=>{b.push({pr:r??0,id:g.id??0,name:g.name?g.name:"",examHashId:"",examCategoryId:"",type:"knowledge",isLeaf:g.isLeaf??!1})}),u(b)})})}}return(S=m).\u0275fac=function(r){return new(r||S)(i.KVO(M.e2))},S.\u0275prov=i.jDH({token:S,factory:S.\u0275fac,providedIn:"root"}),m})()},51783:(J,N,n)=>{n.d(N,{G:()=>m,e:()=>S});var e=n(17509),t=n(71217),i=n(47947),M=n(99974),L=n(26860),G=n(9280);let S=(()=>{var _;class r{constructor(b){this.documentService=b,this.leechApiCacheMaps=new Map,this.lastNodeSelected=[],this.lastNodesSelected=[]}initialData(b=0,d=void 0){return new Promise(y=>{this.apiLeechData(b,d).then(g=>{y(g.map(v=>new M.Q(v.id,v.pr,v.type,v.shareType,v.name,v.examHashId,v.examCategoryId,0,"cate"===v.type,v.isLeaf)))})})}apiLeechData(b,d,y=!1){return new Promise(g=>{let v=this.getCacheKey(b,d);if(y&&this.leechApiCacheMaps.has(v)&&this.leechApiCacheMaps.get(v))return void g(this.leechApiCacheMaps.get(v)??[]);const O=[];let x={categoryId:b,documentType:void 0,shareType:d,fileType:"exam_online",classroomId:void 0,name:void 0,suggestExamPurpose:void 0,lite:1,getGlobal:0,page:1,itemPerPage:-1};this.documentService.apiDocumentsGet(x.categoryId,x.documentType,x.shareType,x.fileType,x.classroomId,x.name,x.suggestExamPurpose,x.lite,x.getGlobal,x.page,x.itemPerPage).subscribe(B=>{1===B.success&&B.data&&((B.data.categoryObjs||[]).forEach(w=>{O.push({pr:b,id:w.id??0,name:w.name??"",examHashId:"",examCategoryId:"",type:"cate",shareType:w.shareType,isLeaf:!1})}),(B.data.documentObjs||[]).forEach(w=>{w.exam&&O.push({pr:b,id:w.exam.id??0,name:w.exam.name??"",examHashId:w.exam.hashId??"",examCategoryId:w.exam.categoryId?.toString()??"",type:"test",shareType:void 0,isLeaf:!0})}),this.leechApiCacheMaps.set(v,O)),g(O)})})}getCacheKey(b,d){return b+"_"+(d??"")}}return(_=r).\u0275fac=function(b){return new(b||_)(L.KVO(G.DK))},_.\u0275prov=L.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),r})();class m{get data(){return this.dataChange.value}set data(r){this._treeControl.dataNodes=r,this.dataChange.next(r)}findLastTreeNodeSelected(r,u=[]){let d=this.data.find(y=>y.id==r.id&&y.shareType==r.shareType);return d?(u.push({id:d.id,shareType:d.shareType}),d.prNode?this.findLastTreeNodeSelected(d.prNode,u):u.reverse()):u.reverse()}toggleLastNode(r,u=0,b,d){let y=r[u]?r[u]:void 0;if(!y)return d(b);let g=this.data.find(v=>v.id==y?.id&&v.shareType==y?.shareType);if(!g)return d(void 0);this.toggleNode(g,!0,!0,()=>{this.toggleLastNode(r,u+1,g,d)})}connect(r){return this._treeControl.expansionModel.changed.subscribe(u=>{(u.added||u.removed)&&this.handleTreeControl(u)}),(0,e.h)(r.viewChange,this.dataChange).pipe((0,i.T)(()=>this.data))}disconnect(r){}handleTreeControl(r){r.added&&r.added.forEach(u=>this.toggleNode(u,!0,!1,()=>{})),r.removed&&r.removed.slice().reverse().forEach(u=>this.toggleNode(u,!1,!1,()=>{}))}toggleNode(r,u,b=!1,d){if("cate"!=r.type)return d();const y=this.data.indexOf(r);if(u)r.isLoading=!0,this._database.apiLeechData(r.id,r.shareType,b).then(g=>{const v=g.map(O=>new M.Q(O.id,O.pr,O.type,O.shareType,O.name,O.examHashId,O.examCategoryId,r.level+1,"cate"===O.type,!1,r));this.data.splice(y+1,0,...v),this.dataChange.next(this.data),r.isLoading=!1,d()});else{let g=0;for(let v=y+1;v<this.data.length&&this.data[v].level>r.level;v++,g++);this.data.splice(y+1,g),this.dataChange.next(this.data),d()}}constructor(r,u){this._treeControl=r,this._database=u,this.dataChange=new t.t([])}}},99974:(J,N,n)=>{n.d(N,{Q:()=>e});class e{constructor(i,M,L,G,S,m,_,r=1,u=!1,b=!1,d,y,g,v){this.id=i,this.pr=M,this.type=L,this.shareType=G,this.item=S,this.examHashId=m,this.examCategoryId=_,this.level=r,this.expandable=u,this.isLoading=b,this.prNode=d,this.isLeaf=y,this.childrenNode=g,this.questions=v}}},60531:(J,N,n)=>{n.d(N,{O:()=>M});var e=n(26860),t=n(50589),i=n(2812);let M=(()=>{var L;class G{setMode(m){this.browserStorageService.saveSimpleStorage("__editor:mode_open",m)}getMode(){var m=this.browserStorageService.getSimpleStorage("__editor:mode_open")||"editor";return this.browserStorageService.removeSimpleStorage("__editor:mode_open"),m}setFileProcess(m){this.file=m}getFirstFile(){let m=this.file;return this.file=void 0,m}setOutputData(m){this.data=m}getOutputData(){return this.data}redirectToConfig(m){this.data.homework&&m.showHomework(),(this.data.exam||this.data.examOffline)&&m.showExam()}setMatrixData(m,_){_?this.matrix=m:this.browserStorageService.saveSimpleStorage("__editor:matrix-data",JSON.stringify(m))}getMatrixData(){var m=this.browserStorageService.getSimpleStorage("__editor:matrix-data");return this.browserStorageService.removeSimpleStorage("__editor:matrix-data"),m?this.commonService.castJsonToObj(m):this.matrix}constructor(m,_){this.browserStorageService=m,this.commonService=_,this.data={}}}return(L=G).\u0275fac=function(m){return new(m||L)(e.KVO(t.z),e.KVO(i.R))},L.\u0275prov=e.jDH({token:L,factory:L.\u0275fac,providedIn:"root"}),G})()},85747:(J,N,n)=>{n.d(N,{J:()=>e});class e{get status(){return this.currentStatus}get msg(){return this.currentMessage}setStatus(i){this.currentStatus=!0,this.currentMessage=i}stopStatus(){this.currentStatus=!1,this.currentMessage=void 0}}},5477:(J,N,n)=>{n.d(N,{o:()=>i});var e=n(26860),t=n(2812);let i=(()=>{var M;class L{constructor(S){this.commonService=S}partQuestionSearchText(S){let m=S.content??"",_=S.answers?.findIndex(r=>S.answerResult?.includes(r.key??""));if(void 0!==_&&-1!=_){let r=S.answers?.map(u=>u.content??"")??[];m+="\n"+this.commonService.getCorrectAnsTxt(r,_)}return this.commonService.parseQuestionContent(m)}partQuestionSearchTextByQuestionForm(S){let m=S.questionContent??"";const _=this.commonService.myParseJson(S.answerConfig??""),r=this.commonService.myParseJson(S?.answerResult??"[]")??[""];let u=_?.findIndex(b=>r.includes(b.key??""));if(void 0!==u&&-1!=u){let b=_?.map(d=>d.content??"")??[];m+="\n"+this.commonService.getCorrectAnsTxt(b,u)}return this.commonService.parseQuestionContent(m)}}return(M=L).\u0275fac=function(S){return new(S||M)(e.KVO(t.R))},M.\u0275prov=e.jDH({token:M,factory:M.\u0275fac,providedIn:"root"}),L})()},54220:(J,N,n)=>{n.d(N,{f:()=>ye});var e=n(26860),t=n(10936),i=n(25234),M=n(85747),L=n(59640),G=n(15766),S=n(9280),m=n(65162),_=n(61937),r=n(27691),u=n(5382),b=n(64198),d=n(2812),y=n(41426);let g=(()=>{var c;class T{constructor(o,s){this.commonService=o,this.apiUploadService=s,this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new u.n(50,{function:(a,l)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(a,l)}}),this.taskUploadImage=new u.n(10,{function:(a,l)=>{this.callbackUploadImage&&this.callbackUploadImage(a,l)}})}convertQuestions(o,s,a){return new Promise(l=>{this.reset(),o.forEach(p=>{const E=this.commonService.willDeleteParseJson(p.answerConfig||"[]");p.questionContent?.includes("<img ")&&this.replaceImageCdnInContent(p,"questionContent"),p.questionText?.includes("<img ")&&this.replaceImageCdnInContent(p,"questionText"),p.answerMedia?.includes("<img ")&&this.replaceImageCdnInContent(p,"answerMedia"),p.mediaMeta?.includes("<img ")&&this.replaceImageCdnInContent(p,"mediaMeta"),E.forEach(z=>{z.content.includes("<img ")&&this.replaceImageCdnInContent(z,"content")}),this.actionRunAfterConvert.push(()=>{p.answerConfig=JSON.stringify(E)})}),this.imageMaps.forEach(p=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[p])}),this.taskConvertBase64ToCanvas.start().then(p=>{if(p.errs.length>0)a(p.errs,void 0);else{let z=0;const I=[],ie=()=>{const F=document.createElement("canvas");F.width=this.sizeDefaultCanvas,F.height=this.sizeDefaultCanvas;const X=F.getContext("2d");X&&(X.fillStyle="white",X.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),I.push({cdn:"",cX:0,cY:0,canvas:F,imgs:[]})};ie(),p.datas.forEach((F,X)=>{var A=I[I.length-1];A.cX+F.canvas.width+4>this.sizeDefaultCanvas?(A.cX=4,A.cY+=z+4,z=0):A.cX+=4,A.cY+F.canvas.height>this.sizeDefaultCanvas&&(ie(),A=I[I.length-1]);var H=A.canvas.getContext("2d");A.imgs.push({x:A.cX,y:A.cY,width:F.canvas.width,height:F.canvas.height,index:X}),H?.drawImage(F.canvas,0,0,F.canvas.width,F.canvas.height,A.cX,A.cY,F.canvas.width,F.canvas.height),A.cX+=F.canvas.width,z=z<F.canvas.height?F.canvas.height:z}),I[0].imgs.length>0&&I.forEach(F=>{this.taskUploadImage.addTask(this,this.startUploadFile,[F])}),this.taskUploadImage.start().then(F=>{if(F.errs.length>0)a(p.errs,void 0);else{let X=!0;F.datas.forEach(A=>{A.imgs.forEach(H=>{const K=p.datas[H.index];if(K){const ee={link:A.cdn,data:{x:H.x,y:H.y,width:H.width,height:H.height}};K.objs.forEach(Y=>{if(Y[K.path])if(this.commonService.isJson(Y[K.path])){const re=this.commonService.willDeleteParseJson(Y[K.path]);Object.prototype.hasOwnProperty.call(re,"renderedStr")?(re.renderedStr=re.renderedStr.replace(K.base,`@[]${JSON.stringify(ee)}@[]`),Y[K.path]=JSON.stringify(re)):Y[K.path]=Y[K.path].replace(K.base,`@[]${JSON.stringify(ee)}@[]`)}else Y[K.path]=Y[K.path].replace(K.base,`@[]${JSON.stringify(ee)}@[]`);else X=!1})}})}),X?(this.actionRunAfterConvert.forEach(A=>{A()}),o.forEach((A,H)=>{let K=this.commonService.willDeleteParseJson(A.mediaMeta||"{}"),ee=s[H];const Y={id:0,name:A.name,extension:"text",content:A.questionContent,groupContent:K.renderedStr,metaData:{isFixAns:Number(A.isFixAns),forcedFixAns:!1,groupType:A.groupType?Number(A.groupType):void 0}};ee&&(Y.vMetaEditor=ee.meta),A.questionContent=JSON.stringify([Y])}),l()):a(p.errs,void 0,!0)}})}})})}reset(){this.imageMaps=[],this.actionRunAfterConvert=[]}replaceImageCdnInContent(o,s){var a=o[s];if(this.commonService.isJson(o[s])){const E=this.commonService.willDeleteParseJson(o[s]);Object.prototype.hasOwnProperty.call(E,"renderedStr")&&(a=E.renderedStr)}let l=a.matchAll(this.pattern_image);for(;;){let E=l.next();if(E.done)break;let z=E.value[0];var p=this.imageMaps.findIndex(I=>I.base===z&&I.path===s);-1===p?this.imageMaps.push({base:z,cdn:"",data:null,objs:[o],path:s,canvas:document.createElement("canvas")}):this.imageMaps[p].objs.push(o)}}startConvertCanvas(o){return new Promise((s,a)=>{const l=new Image;l.crossOrigin="anonymous",l.onload=()=>{let E=1;if(l.width>this.sizeDefaultCanvas&&(E=this.sizeDefaultCanvas/l.width),l.height>this.sizeDefaultCanvas){let I=this.sizeDefaultCanvas/l.height;I<E&&(E=I)}o.canvas.width=l.width*E,o.canvas.height=l.height*E,o.canvas.getContext("2d")?.drawImage(l,0,0,l.width,l.height,0,0,o.canvas.width,o.canvas.height),s(o)},l.onerror=()=>{o.canvas.width=1,o.canvas.height=1;const E=o.canvas.getContext("2d");E&&(E.fillStyle="white",E.fillRect(0,0,1,1)),s(o)};let p=this.pattern_base64.exec(o.base);null!=p?l.src=p[0]:a(new Error("l\u1ed7i regex"))})}startUploadFile(o){return new Promise((s,a)=>{const l=this.dataURLtoFile(o.canvas.toDataURL("image/png",1));(0,b.w4)(l).then(p=>{this.apiUploadService.uploadToCdnProgressForExamQuestionContent(p).subscribe(E=>{E.type!=r.hv.UploadProgress&&(1==E.success&&E.data?s({...o,cdn:E.data.url||""}):a(new Error(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",E.message??"none"))))})})})}dataURLtoFile(o){let s=this.getFileName(o);for(var a=o.split(","),l=a[0].match(/:(.*?);/),p=atob(a[1]),E=p.length,z=new Uint8Array(E);E--;)z[E]=p.charCodeAt(E);return new File([z],s,{type:l&&l.length>0?l[1]:"png"})}getFileName(o){var s=o.split("").reverse().join(""),a=s.indexOf(";"),l=s.indexOf("/",a);return s.substring(a,l).split("").reverse().join("")}}return(c=T).\u0275fac=function(o){return new(o||c)(e.KVO(d.R),e.KVO(y.T))},c.\u0275prov=e.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),T})();var v=n(60531),O=n(5477),x=n(77260),B=n(50589),R=n(84828),$=n(54460),w=n(18718),V=n(81587),j=n(52811),D=n(37469),k=n(6989),C=n(1349),f=n(50282),P=n(30683),W=n(9691),Q=n(39471),Z=n(15343),ne=n(7919),te=n(76975);function ae(c,T){1&c&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&c&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_auto_vui_long_nhap_ho_va_ten")))}function oe(c,T){1&c&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&c&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_auto_vui_long_nhap_so_dien_thoai")))}function se(c,T){1&c&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&c&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_student_utils_reques_phone_ten_number")))}function U(c,T){1&c&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&c&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_document_please_enter_the_author_workplace")))}function q(c,T){if(1&c&&(e.j41(0,"div",14)(1,"div",30)(2,"div",31),e.nrm(3,"input",32),e.nI1(4,"mytranslate"),e.DNE(5,ae,4,3,"div",33),e.k0s(),e.j41(6,"div",34),e.nrm(7,"input",35),e.nI1(8,"mytranslate"),e.DNE(9,oe,4,3,"div",33),e.DNE(10,se,4,3,"div",33),e.k0s(),e.j41(11,"div",36),e.nrm(12,"input",37),e.nI1(13,"mytranslate"),e.DNE(14,U,4,3,"div",33),e.k0s()()()),2&c){const h=e.XpG();e.R7$(3),e.FS9("placeholder",e.bMT(4,7,"lang_auto_nhap_ho_va_ten")),e.R7$(2),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&!h.form.controls.creatorFullName.value),e.R7$(2),e.FS9("placeholder",e.bMT(8,9,"lang_auto_nhap_so_dien_thoai")),e.R7$(2),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&!h.form.controls.creatorPhone.value),e.R7$(1),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&h.form.controls.creatorPhone.value&&10!==h.form.controls.creatorPhone.value.length),e.R7$(2),e.FS9("placeholder",e.bMT(13,11,"lang_document_workplace")),e.R7$(2),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&!h.form.controls.creatorWorkingAddress.value)}}function me(c,T){if(1&c){const h=e.RV6();e.j41(0,"mat-tree-node",43),e.nrm(1,"button",44),e.j41(2,"div",45)(3,"input",46),e.bIt("change",function(){const a=e.eBV(h).$implicit,l=e.XpG(2);return e.Njj(l.checklistSelection.toggle(a))}),e.k0s(),e.j41(4,"label",47)(5,"span"),e.EFF(6),e.k0s()()()()}if(2&c){const h=T.$implicit,o=e.XpG(2);e.R7$(3),e.FS9("id","knowledge-"+h.id),e.Y8G("checked",o.checklistSelection.isSelected(h)),e.R7$(1),e.FS9("for","knowledge-"+h.id),e.R7$(2),e.JRh(h.item)}}function de(c,T){if(1&c){const h=e.RV6();e.j41(0,"mat-tree-node",48)(1,"button",49)(2,"span",50),e.nrm(3,"lucide-icon",51),e.k0s()(),e.j41(4,"div",45)(5,"input",52),e.bIt("change",function(){const a=e.eBV(h).$implicit,l=e.XpG(2);return e.Njj(l.todoItemSelectionToggle(a))}),e.k0s(),e.j41(6,"label",47)(7,"span"),e.EFF(8),e.k0s()()()()}if(2&c){const h=T.$implicit,o=e.XpG(2);e.R7$(1),e.BMQ("aria-label","toggle "+h.filename),e.R7$(2),e.FS9("name",o.treeControl.isExpanded(h)?"chevron-down":"chevron-right"),e.R7$(2),e.FS9("id","knowledge-"+h.id),e.Y8G("checked",o.descendantsAllSelected(h))("indeterminate",o.descendantsPartiallySelected(h)),e.R7$(1),e.FS9("for","knowledge-"+h.id),e.R7$(2),e.JRh(h.item)}}function he(c,T){if(1&c&&(e.j41(0,"div",14)(1,"div",3)(2,"div",31)(3,"span",17),e.EFF(4),e.nI1(5,"mytranslate"),e.k0s()(),e.j41(6,"div",39)(7,"mat-tree",40),e.DNE(8,me,7,4,"mat-tree-node",41),e.DNE(9,de,9,7,"mat-tree-node",42),e.k0s()()()()),2&c){const h=e.XpG();e.R7$(4),e.SpI(" ",e.bMT(5,4,"lang_document_the_knowledge_units_present_in_the_exam")," "),e.R7$(3),e.Y8G("dataSource",h.dataSource)("treeControl",h.treeControl),e.R7$(2),e.Y8G("matTreeNodeDefWhen",h.hasChild)}}function ue(c,T){1&c&&(e.j41(0,"span",58),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&c&&(e.R7$(1),e.SpI("(",e.bMT(2,1,"lang_document_current"),")"))}const fe=function(c){return{"font-medium":c}};function pe(c,T){if(1&c&&(e.j41(0,"div",53)(1,"div",54),e.nrm(2,"input",55),e.j41(3,"label",56)(4,"span"),e.EFF(5),e.nI1(6,"mytranslate"),e.k0s(),e.DNE(7,ue,3,3,"span",57),e.k0s()()()),2&c){const h=T.index,o=e.XpG();e.R7$(2),e.FS9("id","week-"+o.listWeek[h]),e.Y8G("formControlName",h),e.R7$(1),e.FS9("for","week-"+o.listWeek[h]),e.Y8G("ngClass",e.eq3(8,fe,o.currentSchoolWeeks===o.listWeek[h])),e.R7$(2),e.JRh(e.bMT(6,6,"lang_document_week")+" "+o.listWeek[h]),e.R7$(2),e.Y8G("ngIf",o.currentSchoolWeeks===o.listWeek[h])}}function ge(c,T){1&c&&(e.j41(0,"div",59)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&c&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_document_please_select_the_time_of_use")))}class _e{}class ve{}let be=(()=>{var c;class T extends L.H{buildFileTree(o,s){const a=[];return o.forEach(l=>{const p=new _e;p.item=l.name,p.id=l.id,l.children&&(p.children=this.buildFileTree(l.children,s+1)),a.push(p)}),a}descendantsAllSelected(o){return this.treeControl.getDescendants(o).every(a=>this.checklistSelection.isSelected(a))}descendantsPartiallySelected(o){return this.treeControl.getDescendants(o).some(l=>this.checklistSelection.isSelected(l))&&!this.descendantsAllSelected(o)}todoItemSelectionToggle(o){this.checklistSelection.toggle(o);const s=this.treeControl.getDescendants(o);this.checklistSelection.isSelected(o)?this.checklistSelection.select(...s):this.checklistSelection.deselect(...s)}toggleAllCheckBox(){this.isCheckSemesterOne.setValue(this.isCheckAllWeeks.value),this.isCheckSemesterTwo.setValue(this.isCheckAllWeeks.value);const o=this.isCheckAllWeeks.value;this.formArrayListWeek.controls.map(s=>s.setValue(o))}toggleSemesterOneCheckBox(){const o=this.isCheckSemesterOne.value;this.formArrayListWeek.controls.map((s,a)=>(a<18&&s.setValue(o),s)),this.calculateIsCheckAll()}toggleSemesterTwoCheckBox(){const o=this.isCheckSemesterTwo.value;this.formArrayListWeek.controls.map((s,a)=>(a>=18&&s.setValue(o),s)),this.calculateIsCheckAll()}initForm(){this.formArrayListWeek=this.form.controls.weeks,this.formArrayListKnowledge=this.form.controls.knowledgeIds}initKnowledgeCheckbox(o){this.formArrayListKnowledge.clear();for(let s=0;s<o.length;s++){const l=new t.MJ(!1,{nonNullable:!0});this.formArrayListKnowledge.push(l)}}initWeedCheckbox(o){this.formArrayListWeek.clear();for(let s=0;s<o.length;s++){const l=new t.MJ(!1,{nonNullable:!0});this.formArrayListWeek.push(l)}}calculateIsCheckAll(){const o=this.formArrayListWeek.controls.every(s=>s.value);this.isCheckAllWeeks.setValue(o)}ngOnChanges(){this.initForm(),this.initKnowledgeCheckbox(this.listKnowledge),this.dataSource.data=this.buildFileTree(this.listKnowledge,0)}ngOnInit(){super.ngOnInit(),this.initWeedCheckbox(this.listWeek),this.currentSchoolWeeks=this.timeService.getSchoolWeeks(),this.checklistSelection.changed.subscribe(o=>{let s=this.checklistSelection.selected.map(a=>a.id??0);this.listKnowledgeId=s.sort((a,l)=>a-l)??[],this.emitChooseKnowledge.emit(this.listKnowledgeId)}),this.form.controls.weeks.valueChanges.subscribe(o=>{this.calculateIsCheckAll(),this.checkChooseWeeks=o.some(s=>s)})}constructor(o){super(),this.timeService=o,this.listKnowledge=[],this.listWeek=[],this.emitChooseKnowledge=new e.bkB,this.formArrayListKnowledge=new t.Yp([]),this.formArrayListWeek=new t.Yp([]),this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.selectedParent=null,this.newItemName="",this.checklistSelection=new C.CB(!0),this.listKnowledgeId=[],this.currentSchoolWeeks=0,this.checkChooseWeeks=!1,this.isCheckAllWeeks=new t.MJ(!1,{nonNullable:!0}),this.isCheckSemesterOne=new t.MJ(!1,{nonNullable:!0}),this.isCheckSemesterTwo=new t.MJ(!1,{nonNullable:!0}),this.getLevel=s=>s.level??0,this.isExpandable=s=>s.expandable??!1,this.getChildren=s=>s.children??[],this.hasChild=(s,a)=>a.expandable??!1,this.hasNoContent=(s,a)=>""===a.item,this.transformer=(s,a)=>{const l=this.nestedNodeMap.get(s),p=l&&l.item===s.item?l:new ve;return p.item=s.item,p.level=a,p.id=s.id,p.expandable=!!s.children,this.flatNodeMap.set(p,s),this.nestedNodeMap.set(s,p),p},this.treeFlattener=new P.yj(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new f.XW(this.getLevel,this.isExpandable),this.dataSource=new P.zw(this.treeControl,this.treeFlattener)}}return(c=T).\u0275fac=function(o){return new(o||c)(e.rXU(W.F))},c.\u0275cmp=e.VBU({type:c,selectors:[["azt-config-document-market"]],inputs:{form:"form",listKnowledge:"listKnowledge",listWeek:"listWeek"},outputs:{emitChooseKnowledge:"emitChooseKnowledge"},features:[e.Vt3,e.OA$],decls:48,vars:29,consts:[[1,"mt-5"],[3,"formGroup"],[1,"box","p-3"],[1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-5"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["type","radio","id","creator-by-me","formControlName","creatorId","value","1",1,"form-check-input"],["for","creator-by-me",1,"form-check-label"],["type","radio","id","creator-by-user-other","formControlName","creatorId","value","0",1,"form-check-input"],["for","creator-by-user-other",1,"form-check-label"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["formArrayName","weeks",1,"list-week","grid","grid-cols-12"],[1,"col-span-12","flex","items-center"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"list-week","col-span-12","mt-1"],[1,"flex","flex-row","sm:flex-col","sm:items-center"],[1,"azt-form-check","mr-5","mt-3","sm:mt-0"],["type","checkbox","id","selectSemesterOne",1,"form-check-input",3,"formControl","change"],["for","selectSemesterOne",1,"form-check-label"],["type","checkbox","id","selectSemesterTwo",1,"form-check-input",3,"formControl","change"],["for","selectSemesterTwo",1,"form-check-label"],["type","checkbox","id","selectAllWeeks",1,"form-check-input",3,"formControl","change"],["for","selectAllWeeks",1,"form-check-label"],[1,"grid","grid-cols-12","gap-3","mt-3"],["class","col-span-6 md:col-span-3 lg:col-span-2",4,"ngFor","ngForOf"],["class","col-span-12 mt-2 text-danger text-xs",4,"ngIf"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12"],["type","text","name","creatorFullName","formControlName","creatorFullName",1,"form-control",3,"placeholder"],["class","text-danger text-xs mt-2",4,"ngIf"],[1,"col-span-12","md:col-span-4"],["type","text","appOnlyNumber","","name","creatorPhone","formControlName","creatorPhone",1,"form-control",3,"placeholder"],[1,"col-span-12","md:col-span-8"],["type","text","name","creatorWorkingAddress","formControlName","creatorWorkingAddress",1,"form-control",3,"placeholder"],[1,"text-danger","text-xs","mt-2"],[1,"list-knowledge","col-span-12"],[3,"dataSource","treeControl"],["matTreeNodeToggle","","matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle","","matTreeNodePadding",""],["mat-icon-button","","disabled",""],[1,"azt-form-checked"],["type","checkbox",1,"form-check-input",3,"checked","id","change"],[1,"form-check-label",2,"vertical-align","middle",3,"for"],["matTreeNodePadding",""],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror","w-5","h-5","inline-block",2,"vertical-align","bottom"],["size","20",3,"name"],["type","checkbox",1,"form-check-input",3,"checked","indeterminate","id","change"],[1,"col-span-6","md:col-span-3","lg:col-span-2"],[1,"azt-form-check"],["type","checkbox","value","41556",1,"form-check-input",3,"formControlName","id"],[1,"form-check-label",2,"vertical-align","middle",3,"ngClass","for"],["class","inline-block ml-1",4,"ngIf"],[1,"inline-block","ml-1"],[1,"col-span-12","mt-2","text-danger","text-xs"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e.EFF(6),e.nI1(7,"mytranslate"),e.k0s()(),e.j41(8,"div",6)(9,"div",7)(10,"div",8),e.nrm(11,"input",9),e.j41(12,"label",10),e.EFF(13),e.nI1(14,"mytranslate"),e.k0s()(),e.j41(15,"div",8),e.nrm(16,"input",11),e.j41(17,"label",12),e.EFF(18),e.nI1(19,"mytranslate"),e.k0s()()()()(),e.DNE(20,q,15,13,"div",13),e.DNE(21,he,10,6,"div",13),e.j41(22,"div",14)(23,"div",15)(24,"div",16)(25,"span",17),e.EFF(26),e.nI1(27,"mytranslate"),e.k0s()(),e.j41(28,"div",18)(29,"div",19)(30,"div",20)(31,"input",21),e.bIt("change",function(){return s.toggleSemesterOneCheckBox()}),e.k0s(),e.j41(32,"label",22),e.EFF(33),e.nI1(34,"mytranslate"),e.k0s()(),e.j41(35,"div",20)(36,"input",23),e.bIt("change",function(){return s.toggleSemesterTwoCheckBox()}),e.k0s(),e.j41(37,"label",24),e.EFF(38),e.nI1(39,"mytranslate"),e.k0s()(),e.j41(40,"div",20)(41,"input",25),e.bIt("change",function(){return s.toggleAllCheckBox()}),e.k0s(),e.j41(42,"label",26),e.EFF(43),e.nI1(44,"mytranslate"),e.k0s()()(),e.j41(45,"div",27),e.DNE(46,pe,8,10,"div",28),e.k0s()(),e.DNE(47,ge,4,3,"div",29),e.k0s()()()()()),2&o&&(e.R7$(1),e.Y8G("formGroup",s.form),e.R7$(5),e.SpI(" ",e.bMT(7,15,"lang_document_author")," "),e.R7$(7),e.SpI(" ",e.bMT(14,17,"lang_document_me")," "),e.R7$(5),e.SpI(" ",e.bMT(19,19,"lang_document_others")," "),e.R7$(2),e.Y8G("ngIf","0"==s.form.controls.creatorId.value),e.R7$(1),e.Y8G("ngIf",s.formArrayListKnowledge.controls.length),e.R7$(5),e.SpI(" ",e.bMT(27,21,"lang_document_time_of_use")," "),e.R7$(5),e.Y8G("formControl",s.isCheckSemesterOne),e.R7$(2),e.SpI(" ",e.bMT(34,23,"lang_config_semester")+" 1"," "),e.R7$(3),e.Y8G("formControl",s.isCheckSemesterTwo),e.R7$(2),e.SpI(" ",e.bMT(39,25,"lang_config_semester")+" 2"," "),e.R7$(3),e.Y8G("formControl",s.isCheckAllWeeks),e.R7$(2),e.SpI(" ",e.bMT(44,27,s.isCheckAllWeeks.value?"lang_student_classroom_list_utils_create_class_new_course_disable":"lang_student_classroom_list_utils_create_class_new_course_choose_all")," "),e.R7$(3),e.Y8G("ngForOf",s.formArrayListWeek.controls),e.R7$(1),e.Y8G("ngIf",!s.checkChooseWeeks))},dependencies:[$.YU,$.Sq,$.bT,Q.iY,P.yI,P.yF,P.pO,P.lQ,P.d6,t.qT,t.me,t.Zm,t.Fm,t.BC,t.cb,t.l_,t.j4,t.JD,t.v8,Z.WGl,ne.Z,V.t,te.wp],encapsulation:2}),T})();function Se(c,T){if(1&c&&e.nrm(0,"azt-loading-effect",3),2&c){const h=e.XpG();e.Y8G("currentStatusObj",h.statusObj)}}function Ce(c,T){1&c&&(e.j41(0,"div",30),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&c&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"lang_auto_vui_long_nhap_ten_de_thi")," "))}function je(c,T){if(1&c){const h=e.RV6();e.qex(0),e.j41(1,"config-level-subject",31),e.bIt("sendLogPredictSubject",function(s){e.eBV(h);const a=e.XpG(2);return e.Njj(a.getLogPredictSubject(s))}),e.k0s(),e.bVm()}if(2&c){const h=e.XpG(2);e.R7$(1),e.Y8G("form",h.form)("questionContents",h.questionContent)("schoolLevelObjs",h.schoolLevelObjs)}}function Ie(c,T){if(1&c&&e.nrm(0,"config-level-subject",32),2&c){const h=e.XpG(2);e.Y8G("form",h.form)("schoolLevelObjs",h.schoolLevelObjs)}}function xe(c,T){1&c&&(e.j41(0,"span",33),e.nrm(1,"azt-loading-ui"),e.k0s())}function ke(c,T){if(1&c){const h=e.RV6();e.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"div",9)(6,"div",10)(7,"label",11),e.EFF(8),e.nI1(9,"mytranslate"),e.k0s()(),e.j41(10,"div",10)(11,"div",12),e.nrm(12,"input",13),e.nI1(13,"mytranslate"),e.k0s(),e.DNE(14,Ce,3,3,"div",14),e.k0s()(),e.j41(15,"div",15),e.DNE(16,je,2,3,"ng-container",16),e.DNE(17,Ie,1,2,"ng-template",null,17,e.C5r),e.k0s(),e.j41(19,"div",18),e.nrm(20,"config-purpose-exam",19),e.k0s(),e.j41(21,"div",20)(22,"div",10)(23,"label",21),e.EFF(24),e.nI1(25,"mytranslate"),e.k0s()(),e.j41(26,"div",10)(27,"div",12),e.nrm(28,"textarea",22),e.nI1(29,"mytranslate"),e.k0s()()()(),e.j41(30,"div",23)(31,"azt-config-document-market",24),e.bIt("emitChooseKnowledge",function(s){e.eBV(h);const a=e.XpG();return e.Njj(a.chooseKnowledge(s))}),e.k0s()(),e.j41(32,"div",25)(33,"div",26)(34,"button",27),e.bIt("click",function(){e.eBV(h);const s=e.XpG();return e.Njj(s.cancelSaveDocumentObj())}),e.EFF(35),e.nI1(36,"mytranslate"),e.k0s(),e.j41(37,"button",28),e.bIt("click",function(){e.eBV(h);const s=e.XpG();return e.Njj(s.handleSaveDocument())}),e.DNE(38,xe,2,0,"span",29),e.EFF(39),e.nI1(40,"mytranslate"),e.k0s()()()()()()()}if(2&c){const h=e.sdS(18),o=e.XpG();e.R7$(1),e.Y8G("formGroup",o.form),e.R7$(7),e.SpI(" ",e.bMT(9,17,"lang_auto_ten")," "),e.R7$(4),e.FS9("placeholder",e.bMT(13,19,"lang_auto_nhap_ten")+" ..."),e.R7$(2),e.Y8G("ngIf",o.form.controls.name.errors),e.R7$(2),e.Y8G("ngIf",o.isCreateQuestionToEditor)("ngIfElse",h),e.R7$(4),e.Y8G("purposeList",o.listPurposeObjs)("form",o.form),e.R7$(4),e.SpI(" ",e.bMT(25,21,"lang_auto_mo_ta")," "),e.R7$(4),e.FS9("placeholder",e.bMT(29,23,"lang_core_nhap_mo_ta")+" ..."),e.R7$(3),e.Y8G("form",o.form)("listWeek",o.listWeek)("listKnowledge",o.listKnowledge),e.R7$(4),e.SpI(" ",e.bMT(36,25,"lang_auto_huy")," "),e.R7$(2),e.Y8G("disabled",o.logConfig.status),e.R7$(1),e.Y8G("ngIf",o.logConfig.status),e.R7$(1),e.SpI(" ",e.bMT(40,27,"lang_auto_luu")," ")}}function Ee(c,T){if(1&c&&(e.j41(0,"div",34)(1,"div",35)(2,"div",36)(3,"span",37),e.nrm(4,"azt-loading-ui"),e.k0s(),e.j41(5,"div",38),e.EFF(6),e.k0s()()()()),2&c){const h=e.XpG();e.R7$(6),e.JRh(h.logConfig.msg)}}let ye=(()=>{var c;class T extends L.H{getLogPredictSubject(o){this.predictLogRequestObj=o}chooseKnowledge(o){this.knowledgeList=o}cancelSaveDocumentObj(){this.onBack.emit(!0)}handleSaveDocument(){const o=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);if(this.checkErrorValidateSave(o,this.knowledgeList))this.showErrorSnack("lang_cms_utils_folder_name_validate_space");else{if(this.type===i.x.exam&&this.isCreateQuestionToEditor&&this.dataSave.exam&&this.dataSave.exam.questionObj.listQuestions){this.logConfig.setStatus(this.commonService.myTranslateInstant("lang_auto_dang_luu_du_lieu_de_thi")),this.countProcess=0;const s=this.dataSave.exam.questionObj.listQuestions;let a=this.commonService.myTranslateInstant("lang_auto_xay_ra_loi_trong_qua_trinh_xu_ly_hinh_anh_cua_de_thi")??"";this.questionShareSaveService.convertQuestions(s,this.dataSave.exam.rootQuests,(l,p=a,E)=>{this.logConfig.stopStatus(),this.showErrorSnack(p),E&&this.stopStatusObj()}).then(()=>{this.startMainProcessSaveEditor()})}this.type===i.x.exam&&!this.isCreateQuestionToEditor&&this.examObj?.id&&this.saveDocumentMarketQuestionObjs(),this.type!==i.x.exam&&this.attachments.length&&this.saveDocumentMarketQuestionObjs(),console.log(this.attachments,this.type)}}initQuestionShare(){this.questionShareSaveService.callbackBase64ToCanvas=(o,s)=>{let a=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.setStatus(`${a} ${Math.floor(o/s*100*.7)}%`)},this.questionShareSaveService.callbackUploadImage=(o,s)=>{let a=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.setStatus(`${a} ${Math.floor(o/s*100*.3)+70}%`)}}processSaveQuestionsFromEditor(o,s,a){if(this.dataSave.exam?.questionObj&&this.dataSave.exam?.questionObj.listQuestions){var l=this.dataSave.exam?.questionObj.listQuestions.length;let p=o+100>l?l:o+100,E=this.dataSave.exam?.questionObj.listQuestions.slice(o,p)??[],z=[];for(const I of E)z.push({categoryId:I.categoryId,groupId:I.groupId,name:I.name??"none",metadata:I.metadata,isImage:I.isImage,questionContent:I.questionContent,answerMedia:I.answerMedia,questionText:I.questionText,answerType:I.answerType,answerConfig:I.answerConfig,coordinates:I.coordinates,answerResult:I.answerResult,totalQuestion:I.totalQuestion,tags:I.tags??[],mediaId:I.mediaId,mediaMeta:I.mediaMeta,attachments:I.attachments,version:I.version,isFixAns:I.isFixAns,groupType:I.groupType,__path:I.__path});z.length>0?this.sAztSaveProcessService.saveQuestionObjsFromEditor(this.dataSave,z,s).then(I=>{I&&I.listQuestionId.length>0?(a.listQuestionId=a.listQuestionId.concat(I.listQuestionId),this.processSaveQuestionsFromEditor(p,I.indexSaved,a)):(this.countProcess=0,this.logConfig.stopStatus(),this.showErrorSnack("lang_auto_khong_luu_duoc_noi_dung_cau_hoi_trong_de_vui_long_kiem_tra_lai"))}):this.saveDocumentMarketQuestionObjs(a)}}startMainProcessSaveEditor(){this.dataSave.exam&&this.dataSave.exam.questionObj&&this.processSaveQuestionsFromEditor(0,0,{indexSaved:0,listQuestionId:[]})}getSubjectAndLevel(){this.initStatusObj(),this.waitDestroy(this.commonListService.apiCommonListSubjectAndLevelsGet(this.commonService.getBusinessDomainUrl()).subscribe(o=>{1==o.success?(this.examSchoolLogObj=o.data?.examSchoolLogObj,this.schoolLevelObjs=o.data?.schoolLevelSubjectObjs??[],this.getListPurposeExam()):this.errorStatusObj(o.message??"")}))}getListPurposeExam(){this.initStatusObj(),this.waitDestroy(this.commonListService.apiCommonListExamPurposesGet().subscribe(o=>{o.success?(this.listPurposeObjs=o.data?.objs??[],this.successStatusObj()):this.errorStatusObj(o.message??"",!0)}))}getKnowledgeData(){const o=this.form.controls.schoolLevel.value,s=this.form.controls.schoolSubject.value;o&&s&&this.waitDestroy(this.knowledgeService.apiKnowledgeGet(o,s).subscribe(a=>{a.list&&(this.listKnowledge=a.list)}))}checkErrorValidateSave(o,s){return!(!this.form.invalid&&("0"!=this.form.controls.creatorId.value||this.form.controls.creatorFullName.value&&this.form.controls.creatorFullName.value&&this.form.controls.creatorPhone.value&&this.form.controls.creatorWorkingAddress.value)&&("0"!=this.form.controls.creatorId.value||10===this.form.controls.creatorPhone.value.length)&&o.length)}fillConfig(){const o=Number(this.commonService.getMyParam(this.activeRoute,"levelId")),s=Number(this.commonService.getMyParam(this.activeRoute,"subjectId"));if(this.examObj?.id)this.waitDestroy(this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(this.examObj.hashId??"").subscribe(a=>{if(a.success){const l=a.data?.examObj;this.form.controls.name.setValue(l?.name??""),this.form.controls.description.setValue(l?.description??""),this.form.controls.schoolLevel.setValue(l?.schoolLevelId??o),this.form.controls.schoolSubject.setValue(l?.schoolSubjectId??s),this.form.controls.purposeExam.setValue(a.data?.purposeId??0),this.form.controls.purposeNote.setValue(a.data?.purposeNote??"")}else this.errorStatusObj(a.message??"",!0)}));else if(this.isCreateQuestionToEditor){const a=Number(this.browserStorageService.getSimpleStorage("levelId")??0),l=Number(this.browserStorageService.getSimpleStorage("subjectId")??0);this.form.controls.schoolLevel.setValue(a),this.form.controls.schoolSubject.setValue(l)}else this.form.controls.schoolLevel.setValue(o),this.form.controls.schoolSubject.setValue(s),this.form.controls.name.setValue(this.name)}getWeeksChecked(o,s){let a=[];for(let l=0;l<s.length;l++)s[l]&&o[l]&&a.push(o[l]);return a}createListWeek(){for(let s=0;s<35;s++)this.listWeek.push(s+1)}saveDocumentMarketQuestionObjs(o){const s=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);this.logConfig.setStatus("");let a={name:this.form.controls.name.value,type:this.type,schoolLevelId:this.form.controls.schoolLevel.value,schoolSubjectId:this.form.controls.schoolSubject.value,purposeId:this.form.controls.purposeExam.value,purposeNote:this.form.controls.purposeNote.value,description:this.form.controls.description.value,creatorId:Number(this.form.controls.creatorId.value),creatorFullName:this.form.controls.creatorFullName.value,creatorPhone:this.form.controls.creatorPhone.value,creatorWorkingAddress:this.form.controls.creatorWorkingAddress.value,knowledgeIds:this.knowledgeList,weeks:s};switch(this.type){case i.x.exam:if(o&&this.isCreateQuestionToEditor){let l=[];l=o.listQuestionId.map(p=>p??0)??[],a.questionIds=l}this.examObj?.id&&!this.isCreateQuestionToEditor&&(a.examId=this.examObj?.id,a.questionIds=[]);break;case i.x.lecture:case i.x.ref:case i.x.teaching_plan:case i.x.slide:a.attachments=this.attachments}this.waitDestroy(this.documentService.apiDocumentsPost(a).subscribe(l=>{if(l.id){this.successStatusObj("lang_document_successful_sharing",!0);const p="/document-market/list-documents/your-documents/1";this.logConfig.stopStatus(),this.myNavigation(p)}else this.errorStatusObj(""),this.logConfig.stopStatus()}))}ngOnInit(){if(super.ngOnInit(),this.getSubjectAndLevel(),this.createListWeek(),this.getKnowledgeData(),this.fillConfig(),this.form.controls.schoolSubject.valueChanges.subscribe(o=>{this.getKnowledgeData()}),this.form.controls.schoolLevel.valueChanges.subscribe(o=>{this.getKnowledgeData()}),this.type===i.x.exam&&this.isCreateQuestionToEditor){this.dataSave=this.editorOutputDataService.getOutputData();const o=25;this.questionContent=[],this.dataSave.exam?.questionObj.listQuestions?.forEach((a,l)=>{l<o&&this.questionContent.push(this.partQuestionSearchTextService.partQuestionSearchTextByQuestionForm(a))}),this.form.controls.name.setValue(this.dataSave.exam?.examObj.name??this.dataSave.homework?.name??"")}}constructor(o,s,a,l,p,E,z,I,ie,F,X){super(),this.documentConfigService=o,this.activeRoute=s,this.examService=a,this.documentService=l,this.knowledgeService=p,this.questionShareSaveService=E,this.editorOutputDataService=z,this.partQuestionSearchTextService=I,this.sAztSaveProcessService=ie,this.browserStorageService=F,this.commonListService=X,this.type=i.x.exam,this.isCreateQuestionToEditor=!1,this.attachments=[],this.name="",this.onBack=new e.bkB,this.schoolLevelObjs=[],this.listPurposeObjs=[],this.listKnowledge=[],this.logConfig=new M.J,this.dataSave={},this.saveParts=[],this.questionContent=[],this.countProcess=0,this.knowledgeList=[],this.listWeek=[],this.form=new t.gE({name:new t.MJ("",{nonNullable:!0,validators:[t.k0.required,G.M.noWhiteSpace]}),description:new t.MJ("",{nonNullable:!0}),schoolLevel:new t.MJ(0,{nonNullable:!0,validators:[t.k0.required,t.k0.min(1)]}),schoolSubject:new t.MJ(0,{nonNullable:!0,validators:[t.k0.required,t.k0.min(1)]}),purposeExam:new t.MJ(0,{nonNullable:!0,validators:[t.k0.required,t.k0.min(1)]}),purposeNote:new t.MJ("",{nonNullable:!0}),knowledgeIds:new t.Yp([]),weeks:new t.Yp([]),creatorId:new t.MJ("1",{nonNullable:!0}),creatorFullName:new t.MJ("",{nonNullable:!0}),creatorPhone:new t.MJ("",{nonNullable:!0}),creatorWorkingAddress:new t.MJ("",{nonNullable:!0})}),this.type===i.x.exam&&this.isCreateQuestionToEditor&&this.initQuestionShare()}}return(c=T).\u0275fac=function(o){return new(o||c)(e.rXU(S.x_),e.rXU(m.nX),e.rXU(S.RW),e.rXU(_.DK),e.rXU(_.Iu),e.rXU(g),e.rXU(v.O),e.rXU(O.o),e.rXU(x.G),e.rXU(B.z),e.rXU(R.Nz))},c.\u0275cmp=e.VBU({type:c,selectors:[["azt-config-share-document"]],inputs:{type:"type",isCreateQuestionToEditor:"isCreateQuestionToEditor",attachments:"attachments",name:"name",examObj:"examObj"},outputs:{onBack:"onBack"},features:[e.Vt3],decls:4,vars:3,consts:[[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],["style","width: 100vw; height: 100vh; position: fixed; z-index: 9999; top: 0; left: 0; display: flex; justify-content: center; align-items: center; background-color: rgba(0, 0, 0, 0.4)",4,"ngIf"],[3,"currentStatusObj"],[1,"intro-y","mt-8","p-3"],[3,"formGroup"],[1,"mx-auto",2,"max-width","1100px"],[1,"setting-block"],[1,"box","mt-2","p-3"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","general-name","formControlName","name","type","text",1,"form-control",3,"placeholder"],["class","mt-2 text-danger text-xs fade",4,"ngIf"],[1,"mt-4"],[4,"ngIf","ngIfElse"],["normal",""],[1,"mt-2"],[3,"purposeList","form"],["id","azt-config-desc",1,"grid","grid-cols-12","mt-4"],["for","general-desc",1,"form-label","mb-0","font-medium","flex","items-center"],["id","general-desc","formControlName","description",1,"form-control","w-full",2,"height","150px",3,"placeholder"],[1,"config-document-market"],[3,"form","listWeek","listKnowledge","emitChooseKnowledge"],[1,"mt-5"],[1,"flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-24","btn-primary",3,"disabled","click"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"mt-2","text-danger","text-xs","fade"],[3,"form","questionContents","schoolLevelObjs","sendLogPredictSubject"],[3,"form","schoolLevelObjs"],[1,"w-4","h-4","mr-2"],[2,"width","100vw","height","100vh","position","fixed","z-index","9999","top","0","left","0","display","flex","justify-content","center","align-items","center","background-color","rgba(0, 0, 0, 0.4)"],[2,"text-align","center","color","#000000"],[2,"margin-bottom","10px"],[1,"w-4","h-4","inline-block"],[2,"font-size","20px","margin-top","10px","background-color","#f0f8ffa3","padding","10px","border-radius","5px"]],template:function(o,s){if(1&o&&(e.DNE(0,Se,1,1,"azt-loading-effect",0),e.DNE(1,ke,41,29,"ng-template",null,1,e.C5r),e.DNE(3,Ee,7,1,"div",2)),2&o){const a=e.sdS(2);e.Y8G("ngIf",s.statusObj.loading)("ngIfElse",a),e.R7$(3),e.Y8G("ngIf",s.logConfig.status&&s.isCreateQuestionToEditor)}},dependencies:[$.bT,t.qT,t.me,t.BC,t.cb,t.j4,t.JD,w.K,V.t,j.R,D.A,k.b,be,te.wp],encapsulation:2}),T})()},77260:(J,N,n)=>{n.d(N,{G:()=>G});var e=n(26860),t=n(2812),i=n(5382),M=n(97633),L=n(76671);let G=(()=>{var S;class m{convertBase64OfMathJaxToCdnUrlInQuestions(r,u){return new Promise((b,d)=>{const y=null==u?new i.n(10):new i.n(10,{function:u},0);r.forEach(g=>{y.addTask(this.dataAztMathRawHelper,this.dataAztMathRawHelper.convertBase64OfMathJaxToCdnUrl,[g])}),y.start().then(g=>{0===g.errs.length?b(g.datas):d(g.errs[0])})})}saveQuestionObjsFromEditor(r,u,b){return new Promise(d=>{this.convertBase64OfMathJaxToCdnUrlInQuestions(u,void 0).then(y=>{let g=[];for(let v=0;v<y.length;v++){let O=y[v];O.expandInfo=this.commonService.serializeJson(r.exam?.examObj.expandInfoObj),g.push(O)}this.questionService.apiQuestionsPost({listQuestions:g}).subscribe(v=>{d(v.list?{indexSaved:v.list.length+b,listQuestionId:v.list}:{indexSaved:b,listQuestionId:[]})})}).catch(()=>{d({indexSaved:b,listQuestionId:[]})})})}constructor(r,u){this.questionService=r,this.dataAztMathRawHelper=u,this.commonService=(0,e.WQX)(t.R)}}return(S=m).\u0275fac=function(r){return new(r||S)(e.KVO(M.wP),e.KVO(L.c))},S.\u0275prov=e.jDH({token:S,factory:S.\u0275fac,providedIn:"root"}),m})()},37469:(J,N,n)=>{n.d(N,{A:()=>V});var e=n(26860),t=n(59640),i=function(j){return j[j.DEFAULT=0]="DEFAULT",j[j.ACCEPT=1]="ACCEPT",j[j.NOT_DO_ANYTHING=2]="NOT_DO_ANYTHING",j}(i||{});class M{acceptPredictSubjectId(D,k){if(!this.predictLogRequestObj)return;let C=this.schoolLevelObjs.find(U=>U.schoolLevel?.id==D),f=C?.schoolLevel?.value??0,P=C?.schoolSubjectObjs.find(U=>U.id==k),W=this.allPredictSubjectObjs.find(U=>!0),Q=this.schoolLevelObjs.find(U=>U.schoolSubjectObjs.map(q=>q.id).includes(W?.id??0)),Z=W?.from??0,ne=W?.to??0;if(!Q||!W||!Z||!ne||P&&this.allPredictSubjectIds.includes(P.id))return;let te=0,ae=0;if(C?.schoolLevel?.id&&f>=Z&&f<=ne){let U=C?.schoolSubjectObjs.find(q=>this.allPredictSubjectIds.includes(q.id));if(U)return te=C.schoolLevel.id,ae=U.id,this.predictLogRequestObj.acceptPredictStatus=i.ACCEPT,{schoolLevelId:te,schoolSubjectId:ae}}let oe=this.allPredictSubjectObjs.find(U=>!0),se=this.schoolLevelObjs.find(U=>U.schoolSubjectObjs.map(q=>q.id).includes(oe?.id??0));return oe&&se&&se.schoolLevel?.id?(this.predictLogRequestObj.acceptPredictStatus=i.ACCEPT,{schoolLevelId:se.schoolLevel.id,schoolSubjectId:oe.id}):void 0}changePredictStatusWhenSubjectIdChanged(D){this.predictLogRequestObj&&(this.predictLogRequestObj.acceptPredictStatus=this.allPredictSubjectIds.includes(D)?i.NOT_DO_ANYTHING:i.DEFAULT)}predictSchoolSubjectByQuestionContent(D,k,C,f){C.length&&k.length&&(this.schoolLevelObjs=k,this.aiService.apiAiPredictSubjectPost({questionContents:C}).subscribe(W=>{if(W.success&&this.predictLogRequestObj){let Q=W.data?.schoolSubjectId;if(!Q||(this.setAllPredictSubjectIds(Q),!this.allPredictSubjectObjs.length))return;this.predictLogRequestObj={predictSchoolSubjectId:Q,acceptPredictStatus:i.DEFAULT,predictByTotalQuestion:C.length},this.changePredictStatusWhenSubjectIdChanged(D),f(!0)}else f(!1)}))}setAllPredictSubjectIds(D){let k=this.commonService.concatMultipleArray(this.schoolLevelObjs.map(f=>f.schoolSubjectObjs)),C=k.find(f=>f.id==D)?.key??"";this.allPredictSubjectObjs=k.filter(f=>f.key&&f.key==C),this.allPredictSubjectIds=this.allPredictSubjectObjs.map(f=>f.id),this.predictSubjectKey=this.allPredictSubjectObjs.find(f=>!0)?.key??""}constructor(D,k){this.commonService=D,this.aiService=k,this.predictLogRequestObj=void 0,this.allPredictSubjectIds=[],this.predictSubjectKey="",this.allPredictSubjectObjs=[],this.schoolLevelObjs=[]}}var L=n(19280),G=n(54460),S=n(47426),m=n(74960),_=n(4375),r=n(10936),u=n(44233),b=n(81587),d=n(43166),y=n(76975);let g=(()=>{var j;class D{transform(C,f){if(!C)return"";const P=C.find(Q=>Q.id==f);return P?P.key??"":""}}return(j=D).\u0275fac=function(C){return new(C||j)},j.\u0275pipe=e.EJ8({name:"aztFindSchoolSubjectById",type:j,pure:!0}),D})();function v(j,D){if(1&j&&(e.j41(0,"mat-option",19),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&j){const k=D.$implicit;e.Y8G("value",k.id),e.R7$(1),e.SpI(" ",e.bMT(2,2,k.key)," ")}}function O(j,D){if(1&j&&(e.j41(0,"mat-option",19),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&j){const k=D.$implicit;e.Y8G("value",k.id),e.R7$(1),e.SpI(" ",e.bMT(2,2,k.key)," ")}}function x(j,D){if(1&j&&(e.j41(0,"mat-option",19),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&j){const k=e.XpG().$implicit;e.Y8G("value",k.id),e.R7$(1),e.SpI(" ",e.bMT(2,2,k.title)," ")}}function B(j,D){if(1&j&&(e.qex(0),e.DNE(1,x,3,4,"mat-option",25),e.bVm()),2&j){const k=D.$implicit;e.R7$(1),e.Y8G("ngIf",k.isActive)}}function R(j,D){if(1&j&&(e.j41(0,"div",20)(1,"div",4)(2,"label",21),e.EFF(3),e.nI1(4,"mytranslate"),e.k0s()(),e.j41(5,"mat-form-field",6)(6,"mat-select",22,23)(8,"mat-option"),e.nrm(9,"ngx-mat-select-search",9),e.nI1(10,"mytranslate"),e.nI1(11,"mytranslate"),e.k0s(),e.j41(12,"mat-option",19),e.EFF(13),e.nI1(14,"mytranslate"),e.k0s(),e.DNE(15,B,2,1,"ng-container",24),e.k0s()()()),2&j){const k=e.sdS(7),C=e.XpG();e.R7$(3),e.SpI(" ",e.bMT(4,7,"lang_create_tree_category_follow_book")," "),e.R7$(6),e.FS9("placeholderLabel",e.bMT(10,9,"lang_bot_common_search_by_name")),e.FS9("noEntriesFoundLabel",e.bMT(11,11,"lang_bot_common_search_not_found")),e.Y8G("formControl",k.searchControl),e.R7$(3),e.Y8G("value",0),e.R7$(1),e.SpI("- ",e.bMT(14,13,"lang_create_tree_category_default_book")," -"),e.R7$(2),e.Y8G("ngForOf",k.filter(C.listBook,"title"))}}function $(j,D){1&j&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&j&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"lang_auto_vui_long_chon_khoi_hoc_va_mon_hoc")," "))}function w(j,D){if(1&j){const k=e.RV6();e.j41(0,"div",27)(1,"div",28)(2,"span"),e.EFF(3),e.nI1(4,"mytranslate"),e.nI1(5,"mytranslate"),e.nI1(6,"mytranslate"),e.nI1(7,"mytranslate"),e.nI1(8,"mytranslate"),e.nI1(9,"aztFindSchoolSubjectById"),e.k0s(),e.j41(10,"a",29),e.bIt("click",function(){e.eBV(k);const f=e.XpG();return e.Njj(f.acceptPredictSubjectEvent())}),e.EFF(11),e.nI1(12,"mytranslate"),e.k0s()()()}if(2&j){const k=e.XpG();e.R7$(3),e.SpI(" ",e.bMT(4,2,"lang_testbank_please_double_check_the_subject_for_accuracy")+". "+e.bMT(5,4,"lang_testbank_the_system_recognizes_your_subject_as_a_subject")+" "+e.bMT(6,6,k.sAztPredictLevelAndSubjectService.predictSubjectKey)+", "+e.bMT(7,8,"lang_testbank_you_are_choosing_subject")+" "+e.bMT(8,10,e.i5U(9,12,k.schoolSubjectObjs,k.form.controls.schoolSubject.value))+". "," "),e.R7$(8),e.SpI(" ",e.bMT(12,15,"lang_testbank_click_here_to_change_it_to_the_correct_one")+"."," ")}}let V=(()=>{var j;class D extends t.H{changeSchoolLevelIdEvent(C){let f=this.schoolLevelObjs.find(W=>W.schoolLevel?.id==C);if(!f)return this.form?.controls.schoolSubject.setValue(0);this.schoolSubjectObjs=f?.schoolSubjectObjs??[];let P=this.form.getRawValue();return this.schoolSubjectObjs.map(W=>W.id).includes(P.schoolSubject)?void 0:this.form?.controls.schoolSubject.setValue(0)}acceptPredictSubjectEvent(){let C=this.form.getRawValue(),f=this.sAztPredictLevelAndSubjectService.acceptPredictSubjectId(C.schoolLevel,C.schoolSubject);f&&(this.form?.controls.schoolLevel.setValue(f.schoolLevelId),this.form?.controls.schoolSubject.setValue(f.schoolSubjectId),this.sendLogPredictSubject.emit(this.sAztPredictLevelAndSubjectService.predictLogRequestObj))}updateLevelAndSubjectToForm(C,f){let P=this.schoolLevelObjs.find(Z=>Z.schoolLevel?.id==C),W=P?.schoolSubjectObjs.find(Z=>Z.id==f);P||(C=0),W||(f=0);let Q=this.form.getRawValue();Q.schoolLevel!=C&&this.form.controls.schoolLevel.setValue(C),Q.schoolSubject!=f&&this.form.controls.schoolSubject.setValue(f),this.schoolSubjectObjs=P?.schoolSubjectObjs??[]}initData(){let C=this.form.getRawValue();if(C.schoolLevel&&C.schoolSubject)return this.updateLevelAndSubjectToForm(C.schoolLevel,C.schoolSubject)}ngOnChanges(C){if(this.initData(),C.examSchoolLogObj&&this.examSchoolLogObj)return this.updateLevelAndSubjectToForm(this.examSchoolLogObj.lastSchoolLevelId??0,this.examSchoolLogObj.lastSchoolSubjectId??0)}ngOnInit(){const C=Number(this.commonService.getMyQueryParam("levelId")),f=Number(this.commonService.getMyQueryParam("subjectId"));C&&f&&(this.form.controls.schoolLevel.setValue(C),this.form.controls.schoolSubject.setValue(f)),this.form?.controls.schoolSubject?.valueChanges.subscribe(()=>{this.sAztPredictLevelAndSubjectService.changePredictStatusWhenSubjectIdChanged(this.form.controls.schoolSubject.value),this.sAztPredictLevelAndSubjectService.predictLogRequestObj&&this.sendLogPredictSubject.emit(this.sAztPredictLevelAndSubjectService.predictLogRequestObj)})}constructor(C){super(),this.aiService=C,this.schoolLevelObjs=[],this.listBook=[],this.questionContents=[],this.sendLogPredictSubject=new e.bkB,this.schoolSubjectObjs=[],this.sAztPredictLevelAndSubjectService=new M(this.commonService,this.aiService)}}return(j=D).\u0275fac=function(C){return new(C||j)(e.rXU(L.E))},j.\u0275cmp=e.VBU({type:j,selectors:[["config-level-subject"]],inputs:{form:"form",examSchoolLogObj:"examSchoolLogObj",schoolLevelObjs:"schoolLevelObjs",listBook:"listBook",questionContents:"questionContents"},outputs:{sendLogPredictSubject:"sendLogPredictSubject"},features:[e.Vt3,e.OA$],decls:39,vars:34,consts:[[1,"config-level-subject"],[3,"formGroup"],["id","azt-config-level-subject",1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-6"],[1,"font-medium"],["for","schoolLevel",1,"form-label","flex","items-center"],["appearance","outline"],["searchInList","","formControlName","schoolLevel","name","schoolLevel",3,"selectionChange"],["searchInListSchoolLevel","searchInList"],[3,"formControl","placeholderLabel","noEntriesFoundLabel"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["for","schoolSubject",1,"form-label","flex","items-center"],["searchInList","","id","schoolSubject","formControlName","schoolSubject","name","schoolSubject"],["searchInListSchoolSubject","searchInList"],["class","col-span-12",4,"ngIf"],[1,"col-span-12",2,"margin-top","-20px"],["class","text-xs mt-2 text-danger",4,"ngIf"],["class","col-span-12","style","margin-top: -32px",4,"ngIf"],[3,"value"],[1,"col-span-12"],["for","bookSelected",1,"form-label","flex","items-center"],["searchInList","","formControlName","bookSelected","name","bookSelected"],["searchInListBook","searchInList"],[4,"ngFor","ngForOf"],[3,"value",4,"ngIf"],[1,"text-xs","mt-2","text-danger"],[1,"col-span-12",2,"margin-top","-32px"],[1,"text-xs","text-pending","font-medium"],[1,"btn-text-primary","font-medium",3,"click"]],template:function(C,f){if(1&C&&(e.j41(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e.EFF(6),e.nI1(7,"mytranslate"),e.k0s()(),e.j41(8,"mat-form-field",6)(9,"mat-select",7,8),e.bIt("selectionChange",function(){return f.changeSchoolLevelIdEvent(f.form.controls.schoolLevel.value)}),e.j41(11,"mat-option"),e.nrm(12,"ngx-mat-select-search",9),e.nI1(13,"mytranslate"),e.nI1(14,"mytranslate"),e.k0s(),e.j41(15,"mat-option",10),e.EFF(16),e.nI1(17,"mytranslate"),e.k0s(),e.DNE(18,v,3,4,"mat-option",11),e.k0s()()(),e.j41(19,"div",3)(20,"div",4)(21,"label",12),e.EFF(22),e.nI1(23,"mytranslate"),e.k0s()(),e.j41(24,"mat-form-field",6)(25,"mat-select",13,14)(27,"mat-option"),e.nrm(28,"ngx-mat-select-search",9),e.nI1(29,"mytranslate"),e.nI1(30,"mytranslate"),e.k0s(),e.j41(31,"mat-option",10),e.EFF(32),e.nI1(33,"mytranslate"),e.k0s(),e.DNE(34,O,3,4,"mat-option",11),e.k0s()()(),e.DNE(35,R,16,15,"div",15),e.j41(36,"div",16),e.DNE(37,$,3,3,"div",17),e.k0s(),e.DNE(38,w,13,17,"div",18),e.k0s()()()),2&C){const P=e.sdS(10),W=e.sdS(26);e.R7$(1),e.Y8G("formGroup",f.form),e.R7$(5),e.SpI(" ",e.bMT(7,18,"lang_auto_khoi_hoc")," "),e.R7$(6),e.FS9("placeholderLabel",e.bMT(13,20,"lang_bot_common_search_by_name")),e.FS9("noEntriesFoundLabel",e.bMT(14,22,"lang_bot_common_search_not_found")),e.Y8G("formControl",P.searchControl),e.R7$(3),e.Y8G("value",0),e.R7$(1),e.SpI("",e.bMT(17,24,"lang_auto_---chon_khoi"),"---"),e.R7$(2),e.Y8G("ngForOf",P.filter(P.mergeSchoolLevel(f.schoolLevelObjs),"key")),e.R7$(4),e.SpI(" ",e.bMT(23,26,"lang_auto_mon_hoc")," "),e.R7$(6),e.FS9("placeholderLabel",e.bMT(29,28,"lang_bot_common_search_by_name")),e.FS9("noEntriesFoundLabel",e.bMT(30,30,"lang_bot_common_search_not_found")),e.Y8G("formControl",W.searchControl),e.R7$(3),e.Y8G("value",0),e.R7$(1),e.SpI("",e.bMT(33,32,"lang_auto_---chon_mon"),"---"),e.R7$(2),e.Y8G("ngForOf",W.filter(f.schoolSubjectObjs,"key")),e.R7$(1),e.Y8G("ngIf",f.listBook.length),e.R7$(2),e.Y8G("ngIf",(null==f.form||null==f.form.controls||null==f.form.controls.schoolLevel?null:f.form.controls.schoolLevel.invalid)||(null==f.form||null==f.form.controls||null==f.form.controls.schoolSubject?null:f.form.controls.schoolSubject.invalid)),e.R7$(1),e.Y8G("ngIf",f.sAztPredictLevelAndSubjectService.predictLogRequestObj&&!f.sAztPredictLevelAndSubjectService.allPredictSubjectIds.includes(f.form.controls.schoolSubject.value)&&f.form.controls.schoolSubject.value)}},dependencies:[G.Sq,G.bT,S.wT,m.rl,_.VO,r.qT,r.BC,r.cb,r.l_,r.j4,r.JD,u.U9,b.t,d.x,y.wp,g],encapsulation:2}),D})()},6989:(J,N,n)=>{n.d(N,{b:()=>O});var e=n(59640),t=n(26860),i=n(54460),M=n(47426),L=n(74960),G=n(4375),S=n(10936),m=n(44233),_=n(81587),r=n(43166),u=n(76975);function b(x,B){if(1&x&&(t.j41(0,"mat-option",16),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&x){const R=B.$implicit;t.Y8G("value",R.id),t.R7$(1),t.SpI(" ",t.bMT(2,2,R.code)," ")}}function d(x,B){if(1&x&&(t.j41(0,"mat-optgroup",14),t.nI1(1,"mytranslate"),t.DNE(2,b,3,4,"mat-option",15),t.k0s()),2&x){const R=B.$implicit;t.XpG();const $=t.sdS(10);t.FS9("label",t.bMT(1,2,R.groupName)),t.R7$(2),t.Y8G("ngForOf",$.filter(R.purposeListInGroup,"code"))}}function y(x,B){1&x&&(t.j41(0,"div",17),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&x&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_testbank_please_choose_purpose_exam")," "))}function g(x,B){1&x&&(t.j41(0,"div",17),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&x&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_testbank_please_enter_purpose_create_exam")," "))}function v(x,B){if(1&x&&(t.j41(0,"div",3)(1,"div",4)(2,"label",18),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",19),t.nrm(6,"input",20),t.nI1(7,"mytranslate"),t.k0s(),t.DNE(8,g,3,3,"div",12),t.k0s()),2&x){const R=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,3,"lang_testbank_enter_create_exam_target")," "),t.R7$(3),t.FS9("placeholder",t.bMT(7,5,"lang_testbank_enter_create_exam_target")+" ..."),t.R7$(2),t.Y8G("ngIf",(4==(null==R.form.controls.purposeExam?null:R.form.controls.purposeExam.value)||8==(null==R.form.controls.purposeExam?null:R.form.controls.purposeExam.value)||12==(null==R.form.controls.purposeExam?null:R.form.controls.purposeExam.value))&&""===(null==R.form.controls.purposeNote||null==R.form.controls.purposeNote.value?null:R.form.controls.purposeNote.value.trim()))}}let O=(()=>{var x;class B extends e.H{convertPurposeList(){this.targetExamGroupObjs=[],this.purposeList.forEach($=>{const{semester:w}=$;let V=this.targetExamGroupObjs.find(j=>j.semester===w);V||(V={semester:w,groupName:this.getGroupNamePurpose($.semester??1),purposeListInGroup:[]},this.targetExamGroupObjs.push(V)),V.purposeListInGroup?.push($)})}getGroupNamePurpose($){switch($){case 1:default:return"lang_testbank_semester_one";case 2:return"lang_testbank_semester_two";case 3:return"lang_testbank_another_purpose"}}ngOnInit(){this.convertPurposeList()}constructor(){super(),this.purposeList=[],this.targetExamGroupObjs=[]}}return(x=B).\u0275fac=function($){return new($||x)},x.\u0275cmp=t.VBU({type:x,selectors:[["config-purpose-exam"]],inputs:{form:"form",purposeList:"purposeList"},features:[t.Vt3],decls:21,vars:18,consts:[[1,"config-purpose-exan"],[3,"formGroup"],["id","azt-config-purpose-exam",1,"grid","grid-cols-12","gap-5"],[1,"col-span-12"],[1,"font-medium"],[1,"form-label","flex","items-center"],["appearance","outline"],["searchInList","","formControlName","purposeExam","name","purposeExam"],["searchInListPurpose","searchInList"],[3,"formControl","placeholderLabel","noEntriesFoundLabel"],["disabled","",3,"value"],[3,"label",4,"ngFor","ngForOf"],["class","mt-2 text-danger text-xs",4,"ngIf"],["class","col-span-12",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mt-2","text-danger","text-xs"],["for","enter_target_create_exam",1,"form-label","flex","items-center"],[1,"setting-input"],["id","enter_target_create_exam","formControlName","purposeNote","type","text",1,"form-control",3,"placeholder"]],template:function($,w){if(1&$&&(t.j41(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.j41(8,"mat-form-field",6)(9,"mat-select",7,8)(11,"mat-option"),t.nrm(12,"ngx-mat-select-search",9),t.nI1(13,"mytranslate"),t.nI1(14,"mytranslate"),t.k0s(),t.j41(15,"mat-option",10),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.DNE(18,d,3,4,"mat-optgroup",11),t.k0s()(),t.DNE(19,y,3,3,"div",12),t.k0s(),t.DNE(20,v,9,7,"div",13),t.k0s()()()),2&$){const V=t.sdS(10);t.R7$(1),t.Y8G("formGroup",w.form),t.R7$(5),t.SpI(" ",t.bMT(7,10,"lang_testbank_target_exam")," "),t.R7$(6),t.FS9("placeholderLabel",t.bMT(13,12,"lang_bot_common_search_by_name")),t.FS9("noEntriesFoundLabel",t.bMT(14,14,"lang_bot_common_search_not_found")),t.Y8G("formControl",V.searchControl),t.R7$(3),t.Y8G("value",0),t.R7$(1),t.SpI("---",t.bMT(17,16,"lang_testbank_choose_purpose"),"---"),t.R7$(2),t.Y8G("ngForOf",w.targetExamGroupObjs),t.R7$(1),t.Y8G("ngIf",0==w.form.controls.purposeExam.value),t.R7$(1),t.Y8G("ngIf",4==(null==w.form.controls.purposeExam?null:w.form.controls.purposeExam.value)||8==(null==w.form.controls.purposeExam?null:w.form.controls.purposeExam.value)||12==(null==w.form.controls.purposeExam?null:w.form.controls.purposeExam.value))}},dependencies:[i.Sq,i.bT,M.wT,M.D7,L.rl,G.VO,S.qT,S.me,S.BC,S.cb,S.l_,S.j4,S.JD,m.U9,_.t,r.x,u.wp],encapsulation:2}),B})()},74175:(J,N,n)=>{n.d(N,{W:()=>b});var e=n(47947),t=n(59640),i=n(26860),M=n(10296),L=n(2812),G=n(27691),S=n(54460),m=n(76975);function _(d,y){if(1&d){const g=i.RV6();i.qex(0),i.j41(1,"a",2),i.bIt("click",function(){i.eBV(g);const O=i.XpG();return i.Njj(O.shareFileToFlutter())}),i.j41(2,"span"),i.EFF(3),i.nI1(4,"mytranslate"),i.k0s(),i.SdG(5),i.k0s(),i.bVm()}if(2&d){const g=i.XpG();i.R7$(1),i.Aen(g.style),i.HbH(g.classStyle),i.FS9("target",g.target),i.R7$(2),i.JRh(i.bMT(4,7,g.fileDescription))}}function r(d,y){if(1&d&&(i.j41(0,"a",3)(1,"span"),i.EFF(2),i.nI1(3,"mytranslate"),i.k0s(),i.SdG(4,1),i.k0s()),2&d){const g=i.XpG();i.Aen(g.style),i.HbH(g.classStyle),i.FS9("href",g.dataUrl,i.B4B),i.FS9("target",g.target),i.FS9("download",g.fileName),i.R7$(2),i.JRh(i.bMT(3,9,g.fileDescription))}}const u=["*","*"];let b=(()=>{var d;class y extends t.H{downloadFile(){return this.http.get(this.dataUrl,{responseType:"blob"}).pipe((0,e.T)(v=>v))}shareFileToFlutter(){this.downloadFile().subscribe(v=>{this.shareFileFlutterService.shareFileWithBlob(v,this.fileName)})}ngOnInit(){super.ngOnInit()}constructor(v,O,x){super(),this.shareFileFlutterService=v,this.commonService=O,this.http=x,this.dataUrl="",this.target="",this.fileName="",this.fileDescription="",this.classStyle="",this.style=""}}return(d=y).\u0275fac=function(v){return new(v||d)(i.rXU(M.R),i.rXU(L.R),i.rXU(G.Qq))},d.\u0275cmp=i.VBU({type:d,selectors:[["azt-download-link-item"]],inputs:{dataUrl:"dataUrl",target:"target",fileName:"fileName",fileDescription:"fileDescription",classStyle:"classStyle",style:"style"},features:[i.Vt3],ngContentSelectors:u,decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["NormalWeb",""],[3,"target","click"],[3,"href","target","download"]],template:function(v,O){if(1&v&&(i.NAR(u),i.DNE(0,_,6,9,"ng-container",0),i.DNE(1,r,5,11,"ng-template",null,1,i.C5r)),2&v){const x=i.sdS(2);i.Y8G("ngIf",O.isMobileWebView)("ngIfElse",x)}},dependencies:[S.bT,m.wp],encapsulation:2}),y})()}}]);