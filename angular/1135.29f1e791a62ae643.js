"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[1135],{59702:(gt,ke,v)=>{v.d(ke,{Q:()=>Be});var l=v(89163),d=v(33887),c=v(48891),m=v(85969),x=v(41891),C=v(27842),Y=v(54460),y=v(47712),ae=v(18718),V=v(2915),P=v(69135),R=v(52811),U=v(15343),D=v(76975);const Ae=(oe,Le)=>({"bg-info text-white":oe,"bg-slate-300":Le}),H=()=>({"text-pending":!0});function N(oe,Le){if(1&oe&&c.eu8(0,5),2&oe){c.XpG();const L=c.sdS(5);c.Y8G("ngTemplateOutlet",L)}}function w(oe,Le){if(1&oe&&c.eu8(0,5),2&oe){c.XpG();const L=c.sdS(3);c.Y8G("ngTemplateOutlet",L)}}function q(oe,Le){if(1&oe&&(c.j41(0,"div",7),c.nrm(1,"azt-loading-effect",8),c.k0s()),2&oe){const L=c.XpG(2);c.R7$(),c.Y8G("currentStatusObj",L.statusObj)}}function me(oe,Le){1&oe&&c.nrm(0,"azt-loading-ui",15)}function pe(oe,Le){if(1&oe){const L=c.RV6();c.j41(0,"div",9),c.nrm(1,"iframe",10),c.nI1(2,"safe"),c.j41(3,"div",11)(4,"button",12),c.bIt("click",function(){c.eBV(L);const Ge=c.XpG(2);return c.Njj(Ge.handleCloseDialog())}),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s(),c.j41(7,"button",13),c.bIt("click",function(){c.eBV(L);const Ge=c.XpG(2);return c.Njj(Ge.orderBuyExam())}),c.DNE(8,me,1,0,"azt-loading-ui",14),c.j41(9,"span"),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()()}if(2&oe){let L;const te=c.XpG(2);c.R7$(),c.Y8G("src",c.bMT(2,5,null!==(L=te.showIframeInContent)&&void 0!==L?L:""),c.f$h),c.R7$(4),c.SpI(" ",c.bMT(6,7,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",te.statusObj.loading),c.R7$(),c.Y8G("ngIf",te.statusObj.loading),c.R7$(2),c.JRh(c.bMT(11,9,"lang_payment_confirm_payment_button"))}}function ce(oe,Le){if(1&oe&&c.DNE(0,q,2,1,"div",6)(1,pe,12,11,"ng-template",null,2,c.C5r),2&oe){const L=c.sdS(2),te=c.XpG();c.Y8G("ngIf",te.statusObj.loading)("ngIfElse",L)}}function ie(oe,Le){if(1&oe&&c.nrm(0,"azt-loading-effect",8),2&oe){const L=c.XpG(2);c.Y8G("currentStatusObj",L.statusObj)}}function Oe(oe,Le){if(1&oe){const L=c.RV6();c.j41(0,"div",40)(1,"div",41),c.bIt("click",function(){const Ge=c.eBV(L).$implicit,be=c.XpG(3);return c.Njj(be.chooseCombo(Ge))}),c.j41(2,"div",40),c.EFF(3),c.k0s(),c.j41(4,"div",42)(5,"div",43),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s(),c.j41(8,"div",44),c.EFF(9),c.nI1(10,"formatMoney"),c.k0s()()()()}if(2&oe){const L=Le.$implicit,te=c.XpG(3);c.R7$(),c.Y8G("ngClass",c.l_i(9,Ae,(null==te.currentComboObj?null:te.currentComboObj.id)==L.id,(null==te.currentComboObj?null:te.currentComboObj.id)!=L.id)),c.R7$(2),c.JRh(L.name),c.R7$(3),c.Lme("",L.items.length," ",c.bMT(7,5,"lang_payment_total_exam_in_combo"),""),c.R7$(3),c.JRh(c.bMT(10,7,L.price)+" VND")}}function Ce(oe,Le){if(1&oe&&(c.qex(0),c.j41(1,"div",47)(2,"div",48),c.nrm(3,"lucide-icon",49),c.k0s(),c.j41(4,"div",50)(5,"div",51,3),c.EFF(7),c.k0s()()(),c.bVm()),2&oe){const L=Le.$implicit,te=c.sdS(6);c.R7$(3),c.Y8G("ngClass",c.lJ4(5,H)),c.R7$(2),c.FS9("matTooltip",L.name),c.Y8G("isDisabledTooltip",!1)("matTooltipDisabled",te.isDisabled),c.R7$(2),c.SpI(" ",L.name," ")}}function Ke(oe,Le){if(1&oe&&(c.j41(0,"div",45),c.DNE(1,Ce,8,6,"ng-container",46),c.k0s()),2&oe){const L=c.XpG(3);c.R7$(),c.Y8G("ngForOf",L.currentComboObj.items)}}function Te(oe,Le){1&oe&&c.nrm(0,"azt-loading-ui",15)}function at(oe,Le){if(1&oe){const L=c.RV6();c.j41(0,"azt-mat-dialog-content",18)(1,"div",19)(2,"div"),c.DNE(3,Oe,11,12,"div",20),c.k0s(),c.DNE(4,Ke,2,1,"div",21),c.j41(5,"div",22)(6,"div",23),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.j41(9,"div",24)(10,"div",25)(11,"div",26)(12,"div",27),c.nrm(13,"img",28),c.nI1(14,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(15,"div",26)(16,"div",27),c.nrm(17,"img",29),c.nI1(18,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(19,"div",26)(20,"div",27),c.nrm(21,"img",30),c.nI1(22,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(23,"div",26)(24,"div",27),c.nrm(25,"img",31),c.nI1(26,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(27,"div",26)(28,"div",27),c.nrm(29,"img",32),c.nI1(30,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(31,"div",26)(32,"div",27),c.nrm(33,"img",33),c.nI1(34,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(35,"div",26)(36,"div",27),c.nrm(37,"img",34),c.nI1(38,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(39,"div",26)(40,"div",27),c.nrm(41,"img",35),c.nI1(42,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(43,"div",26)(44,"div",27),c.nrm(45,"img",36),c.nI1(46,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(47,"div",26)(48,"div",27),c.nrm(49,"img",37),c.nI1(50,"convertCdnLinkOfGitHub"),c.k0s()()()()()()(),c.j41(51,"div",38)(52,"div",39)(53,"button",12),c.bIt("click",function(){c.eBV(L);const Ge=c.XpG(2);return c.Njj(Ge.handleCloseDialog())}),c.EFF(54),c.nI1(55,"mytranslate"),c.k0s(),c.j41(56,"button",13),c.bIt("click",function(){c.eBV(L);const Ge=c.XpG(2);return c.Njj(Ge.orderBuyExam())}),c.DNE(57,Te,1,0,"azt-loading-ui",14),c.j41(58,"span"),c.EFF(59),c.nI1(60,"mytranslate"),c.k0s()()()()}if(2&oe){const L=c.XpG(2);c.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 90px)"),c.R7$(3),c.Y8G("ngForOf",L.comboObjs),c.R7$(),c.Y8G("ngIf",L.currentComboObj),c.R7$(3),c.SpI(" ",c.bMT(8,18,"lang_payment_supported_payment_methods")," "),c.R7$(6),c.Y8G("src",c.bMT(14,20,"images/method-payment/vnpay_full.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(18,22,"images/method-payment/vietcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(22,24,"images/method-payment/techcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(26,26,"images/method-payment/vietinbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(30,28,"images/method-payment/mbbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(34,30,"images/method-payment/agribank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(38,32,"images/method-payment/bidv.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(42,34,"images/method-payment/acb.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(46,36,"images/method-payment/hdbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(50,38,"images/method-payment/vpbank.svg"),c.B4B),c.R7$(5),c.SpI(" ",c.bMT(55,40,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",L.statusObj.loading),c.R7$(),c.Y8G("ngIf",L.statusObj.loading),c.R7$(2),c.JRh(c.bMT(60,42,"lang_payment_confirm_payment_button"))}}function de(oe,Le){if(1&oe&&(c.j41(0,"div",16),c.DNE(1,ie,1,1,"azt-loading-effect",17)(2,at,61,44,"ng-template",null,2,c.C5r),c.k0s()),2&oe){const L=c.sdS(3),te=c.XpG();c.R7$(),c.Y8G("ngIf",te.statusObj.loading)("ngIfElse",L)}}let Be=(()=>{var oe;class Le extends d._{handleCloseDialog(){this.dialogRef.close(!1)}chooseCombo(te){this.currentComboObj=te}orderBuyExam(){if(!this.currentComboObj)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.initStatusObj();let te="userRole=student&productType=exam&backTo="+encodeURIComponent(this.commonService.getCurrentUrlWithoutLocale());this.waitDestroy(this.productOrderService.apiProductOrderBuyExamByMoneyGet(this.commonService.getCurrentHostName(),this.commonService.getCurrentLang(),this.currentComboObj.id,te).subscribe(Ge=>{if(!Ge.success)return this.errorStatusObj(Ge.message,!0);window.location.href=Ge.data?.value??""}))}initData(){this.initStatusObj(),this.waitDestroy(this.comboPackageService.apiComboPackageListComboPackagesByExamHashIdGet(this.data.examObj.hashId??"").subscribe(te=>te.success?te.data?.objs?.length?(this.comboObjs=te.data?.objs??[],this.currentComboObj=this.commonService.getFirstOfArray(this.comboObjs),this.showIframeInContent=this.currentComboObj?.description,this.stopStatusObj(),void(this.showIframeInContent&&this.sAztAzotaTrackingService.sendForceCustomEvent("PAYMENT_VIEW_IFRAME_CONTENT",[]))):this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0):this.errorStatusObj(te.message,!0)))}setViewport(){const te=document.createElement("meta");te.name="viewport",te.setAttribute("id","viewPortIframe");const Ge=ye=>{te.setAttribute("content",ye),document.head.appendChild(te)},be=window.innerWidth;if(be<768){const ct=420!==be?be/420:1;Ge(`width=420, user-scalable=no, initial-scale=${ct}, minimum-scale=${ct}, maximum-scale=${ct}`)}else Ge("width=960, user-scalable=no, initial-scale=1.0")}removeViewPort(){document.getElementById("viewPortIframe")?.remove()}ngOnInit(){super.ngOnInit(),this.initData(),this.setViewport()}constructor(te,Ge,be,Q,ye){super(Ge,te),this.dialogRef=te,this.data=Ge,this.productOrderService=be,this.comboPackageService=Q,this.sAztAzotaTrackingService=ye,this.comboObjs=[],this.showIframeInContent=void 0}ngOnDestroy(){this.removeViewPort()}}return(oe=Le).\u0275fac=function(te){return new(te||oe)(c.rXU(l.CP,8),c.rXU(l.Vh,8),c.rXU(m.Hg),c.rXU(x.E),c.rXU(C.M))},oe.\u0275cmp=c.VBU({type:oe,selectors:[["payment-dialog"]],features:[c.Vt3],decls:6,vars:2,consts:[["showIframeContent",""],["showListExamContent",""],["doneLoading",""],["c","isDisabled"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet"],["class","box py-4 px-4",4,"ngIf","ngIfElse"],[1,"box","py-4","px-4"],[3,"currentStatusObj"],[1,"bg-white",2,"height","100%"],["width","100%",2,"height","calc(var(--vh, 1vh) * 100 - 70px)",3,"src"],[1,"text-center","mt-4","text-center","absolute","bottom-2","w-full"],[1,"btn","btn-secondary-soft","w-32","mr-4","btn-lg","text-xl",3,"click"],[1,"btn","btn-primary","btn-lg","text-xl",3,"click","disabled"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"box","py-4","px-4",2,"height","100%"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"minHeight"],[2,"margin-right","-5px"],["class","pb-2",4,"ngFor","ngForOf"],["class","box border border-slate-200 dark:border-darkmode-400 pt-2",4,"ngIf"],[1,"mt-4"],[1,"font-medium"],[1,"mt-2"],[1,"grid","grid-cols-10","gap-4"],[1,"col-span-5","md:col-span-2","flex","justify-center"],[1,"p-1","rounded-lg","border","border-slate-200","dark:border-darkmode-400","w-full","h-full"],["alt","Vnpay",2,"height","100%",3,"src"],["alt","vietcombank",3,"src"],["alt","techcombank",3,"src"],["alt","vietinbank",3,"src"],["alt","mbbank",3,"src"],["alt","agribank",3,"src"],["alt","bidv",3,"src"],["alt","acb",3,"src"],["alt","hdbank",3,"src"],["alt","vpbank",3,"src"],[1,"flex","mt-4"],[1,"ml-auto"],[1,"pb-2"],[1,"clickable","box","pl-2","pr-2","pt-2",3,"click","ngClass"],[1,"pb-2","flex","items-center","font-medium"],[1,"mr-auto"],[1,"text-lg"],[1,"box","border","border-slate-200","dark:border-darkmode-400","pt-2"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-3","border-b","border-slate-200","dark:border-darkmode-400"],[1,"flex-none","image-fit","rounded-md","overflow-hidden"],["name","file-check","size","40",3,"ngClass"],[1,"ml-4","mr-auto"],[2,"line-height","1.2",3,"matTooltip","isDisabledTooltip","matTooltipDisabled"]],template:function(te,Ge){1&te&&c.DNE(0,N,1,1,"ng-container",4)(1,w,1,1,"ng-container",4)(2,ce,3,2,"ng-template",null,0,c.C5r)(4,de,4,2,"ng-template",null,1,c.C5r),2&te&&(c.Y8G("ngIf",!Ge.showIframeInContent),c.R7$(),c.Y8G("ngIf",Ge.showIframeInContent))},dependencies:[Y.YU,Y.Sq,Y.bT,Y.T3,y.oV,ae.K,V.U,P.f,R.R,U.WGl,D.wp,D.JI,D.gt,D.t0],encapsulation:2}),Le})()},57081:(gt,ke,v)=>{v.d(ke,{w:()=>C});var l=v(48891),d=v(62095),c=v(68774),m=v(50589),x=v(99927);let C=(()=>{var Y;class y{_saveSortTypeOfSetting(V){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,V)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(V){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==V}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(V,P){var R=[];return P.forEach(U=>{U.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(V,U.results??new Array),R.push(U)}),R}_filterExamResultObjsByFilterSettingObjNotInClassroom(V,P){var R=[];if(V.isMarked||V.isNotMarked||V.isOnTest||V.isNotSubmit||V.isNotTested)for(var U of P){let D=!1,Ae=V.isOnTest||V.isNotSubmit;V.isMarked&&1==U.isMarked&&(!Ae||!(1!=U.status&&(U.isMarked||U.isNotMarked)))&&(D=!0),V.isNotMarked&&1==U.isNotMarked&&(!Ae||!(1!=U.status&&(U.isMarked||U.isNotMarked)))&&(D=!0),V.isOnTest&&(1==U.isOnTest||0==U.status&&(U.isMarked||U.isNotMarked))&&(D=!0),V.isNotTested&&1==U.isNotTested&&(D=!0),V.isNotSubmit&&(1==U.isNotSubmit||-1==U.status&&(U.isMarked||U.isNotMarked))&&(D=!0),D&&R.push(U)}else R=P;return R}_searchExamResultObjsByFullNameInClassroom(V,P){var R=[];return this.commonService.myClone(V).forEach(D=>{var Ae=this._searchExamResultObjsByFullNameNotInClassroom(D.results??[],P);Ae.length>0&&(D.results=Ae,R.push(D))}),R}_searchExamResultObjsByFullNameNotInClassroom(V,P){P=this.commonService.convertVietnameseToEnglish(P).toLowerCase();var R=[];return V.forEach(U=>{-1!=this.commonService.convertVietnameseToEnglish(U.fullName??"").toLowerCase().indexOf(P)&&R.push(U)}),R}_sortExamResultObjsBySettingObjByClassroom(V,P,R){return"isSortByNameAsc"==R?this.sortService.sortFirstNameStudentsInClass(V):"isSortByTimeDesc"==R?this.sortService.sortTimeStudentsInClass(V,1):"isSortByMarkDesc"==R?this.sortService.sortMarkStudentsInClass(V,1,P):this._sortExamResultObjsBySortTypeOfClassroom(V)}_sortExamResultObjsBySettingObjNotInClassroom(V,P,R){return"isSortByNameAsc"==R?this.sortService.sortFirstNameStudents(V):"isSortByTimeDesc"==R?this.sortService.sortTimeDESC(V):"isSortByMarkDesc"==R?this.sortService.sortMarkDESC(V,P):V}_sortExamResultObjsBySortTypeOfClassroom(V){var P=V.map(R=>({...R}));return P.forEach((R,U)=>{R.results=0==R.classObj?.sortType?this.sortService.sortFirstNameStudents(R.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(R.results??[],"pos","id"),P[U]=R}),P}_changeExamResultStatusForAllClassroom(V,P,R){var U=[];return V.forEach((D,Ae)=>{D.results=this._changeExamResultStatusForOneClassroom(D.results??new Array,P),D={indexCounter:Ae,...D,countSubmitted:R?D.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(D.results??new Array),showOnTab:D.showOnTab},U.push(D)}),U}_changeExamResultStatusForOneClassroom(V,P){var R=[...V];return R.forEach((U,D)=>{U.confirmedAt&&""!=U.confirmedAt&&U.resultId&&U.resultId>0?U.isMarked=!0:U.resultId&&U.resultId>0&&(!U.confirmedAt||""==U.confirmedAt)?U.isNotMarked=!0:U.resultId&&0!=U.resultId||!U.startedTest||""==U.startedTest||0!=U.status?U.resultId&&0!=U.resultId||!U.startedTest||""==U.startedTest||-1!=U.status?null==U.startedTest&&(U.isNotTested=!0):U.isNotSubmit=!0:U.isOnTest=!0,R[D]=U}),R.forEach((U,D)=>{U.files&&""!=U.files&&!Array.isArray(U.files)&&(U.filesParse=this.commonService.myParseJson(U.files)),R[D]=U}),R}_countTotalSubmittedOfExamResultObjs(V){var P=0;return V.forEach(R=>{(R.isMarked||R.isNotMarked)&&P++}),P}_counterTotalEssayOfQuestionObjs(V){let P=0;return V.forEach(R=>{this.answerTypeService.isEssayAnswer(R)&&P++}),P}_checkCounterEssayQuestionObjs(V){let P=0;return V.forEach(R=>{R.isEssay&&P++}),P}constructor(V,P,R,U){this.commonService=V,this.sortService=P,this.browserStorageService=R,this.answerTypeService=U,this.sortByStorageKey="exam_list_sort_by"}}return(Y=y).\u0275fac=function(V){return new(V||Y)(l.KVO(d.R),l.KVO(c.g),l.KVO(m.z),l.KVO(x._))},Y.\u0275prov=l.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),y})()},87515:(gt,ke,v)=>{v.d(ke,{h:()=>R});var l=v(10936),d=v(51698),c=v(48891),m=v(62095),x=v(9280),C=v(51913),Y=v(41715),y=v(50589),ae=v(79064),V=v(91640),P=v(57081);let R=(()=>{var U;class D{constructor(H,N,w,q,me,pe,ce,ie){this.commonService=H,this.examPageResultService=N,this.permissionService=w,this.globalService=q,this.browserStorageService=me,this.gzipHelper=pe,this.homeworkExamService=ce,this.sAztExamResultListSortService=ie}getTestedUserObjs(H,N,w){return this.globalService.startIntervalFunc(H),this.getTestedOfExamResult(H,N,"default",w)}getTestedLastMark(H,N,w){return this.globalService.startIntervalFunc(H),this.getTestedOfExamResult(H,N,"last",void 0,w)}getTestedHighestMark(H,N,w){return this.globalService.startIntervalFunc(H),this.getTestedOfExamResult(H,N,"highest",void 0,w)}getTestedFirstMark(H,N,w){return this.globalService.startIntervalFunc(H),this.getTestedOfExamResult(H,N,"first",void 0,w)}getTestedAllResult(H,N,w){return this.globalService.startIntervalFunc(H),this.getTestedOfExamResult(H,N,"all",void 0,w)}getTestedOfExamResult(H,N,w,q,me){return new d.c(pe=>{let ce="tested_list_result_v2_"+N,ie=this.browserStorageService.getSimpleSessionStorage(ce)??"",Oe=this.gzipHelper.resultContentSupport(ie),Ce=Oe&&this.commonService.willDeleteParseJson(Oe)?this.commonService.willDeleteParseJson(Oe):void 0;q&&ie&&Ce?(pe.next({status:200,success:1,data:Ce,message:"successful"}),pe.complete()):this.examPageResultService.apiExamPageResultGetNewObjV2Post({examId:N,classroomIds:me}).subscribe(Te=>{if(1==Te.success){let de=Te.data?.serverSecond??0,Be=Te.data?.examObj,oe=Te.data?.classroomWithAvatarAndStudentObjs??new Array,Le=Te.data?.totalAttended??0,L=Te.data?.examQuestionObjs??new Array,te=Te.data?.examCreatorObj,Ge=Te.data?.offlineExamObj,be=Te.data?.hasEssayQuestion,Q=Te.data?.totalQuestion??0,ye=Te.data?.offlineMixQuestionObjs,ct=Te.data?.canResetStudentCode,Dt=Te.data?.hasCreateStudentCode,nt=Te.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",Be)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",Be)?this.getAllExamResultObjs(H,[],N,"",Et=>{if(Et.hasOwnProperty("success")&&1==Et.success){let Qe=this.mergeStudentWithAvatar(Et.studentWithResultObjs??[]),ft={},He=[];Qe?.forEach(B=>{let Ie=B.parentId??"0";ft.hasOwnProperty(Ie)?ft[Ie].push(...B.examResultObjs??[]):ft[Ie]=B.examResultObjs??[],He=He.concat(ft[Ie])});let ze=Be?this.filterExamResultOnTest(He,Be,de):{},J=[],ue=[];if(this.homeworkExamService.mustInClassroom(Be)&&oe.length>0)for(let B=0;B<oe.length;B++){let Ie=oe[B].classroomObj;Ie.classroomGroup=oe[B].classroomGroup;let xe=oe[B].studentObjs??[],Ze=[];if(xe.length>0)for(let Me=0;Me<xe.length;Me++){let rt=xe[Me].parentId??"0";this.commonService.isExistInArray(ue,xe[Me].parentId)||ue.push(xe[Me].parentId??"0"),ft.hasOwnProperty(rt)&&(Array.isArray(xe[Me].examResultObjs)||(xe[Me].examResultObjs=[]),xe[Me].examResultObjs=this.findExamResultOfStudent(ft[rt],xe[Me].id??"0"));let st=ze.hasOwnProperty(xe[Me].parentId??0)?ze[xe[Me].parentId??0]:0;if("all"==w)if(xe[Me].examResultObjs?.length)xe[Me].examResultObjs?.forEach((se,Ye)=>{let $e=this.commonService.castJsonToObj(JSON.stringify(se));$e&&($e.resultId=$e.testStatus&&$e.testStatus>0?$e.id:0);let E=this.createStudentWithResult(xe[Me],$e,st,Q,Ye,xe[Me].examResultObjs?.length??0);Ze.push(E)});else{let se=this.createStudentWithResult(xe[Me],void 0,st,Q,-1,0);Ze.push(se)}else{let se=this.filterExamResultByType(xe[Me].examResultObjs??[],w),Ye=se.hasOwnProperty(xe[Me].parentId??0)?se[xe[Me].parentId??0]:void 0,E=this.createStudentWithResult(xe[Me],Ye,st,Q,(Ye&&null!=Ye.indexTest&&Ye.indexTest>=0?Ye.indexTest:"first"==w?0:(xe[Me].examResultObjs?.length??0)-1)??0,xe[Me].examResultObjs?.length??0);Ze.push(E)}}J.push({classObj:Ie,results:Ze})}let fe=[],G=this.commonService.myClone(Qe)??[];for(let B=0;B<G?.length;B++)if(!this.commonService.isExistInArray(ue,G[B].parentId)){let Ie=ze.hasOwnProperty(G[B].parentId??0)?ze[G[B].parentId??0]:0;if("all"==w)if(G[B].examResultObjs?.length)G[B].examResultObjs?.forEach((xe,Ze)=>{let Me=this.commonService.castJsonToObj(JSON.stringify(xe));Me&&(Me.resultId=Me.testStatus&&Me.testStatus>0?Me.id:0);let rt=this.createStudentWithResult(G[B],Me,Ie,Q,Ze,G[B].examResultObjs?.length??0);fe.push(rt)});else{let xe=this.createStudentWithResult(G[B],void 0,Ie,Q,-1,0);fe.push(xe)}else{let xe=this.filterExamResultByType(G[B].examResultObjs??[],w),Ze=xe.hasOwnProperty(G[B].parentId??0)?xe[G[B].parentId??0]:void 0,rt=this.createStudentWithResult(G[B],Ze,Ie,Q,(Ze&&null!=Ze?.indexTest&&Ze.indexTest>=0?Ze.indexTest:"first"==w?0:(G[B].examResultObjs?.length??0)-1)??0,G[B].examResultObjs?.length??0);fe.push(rt)}}"all"!=w&&fe.sort((B,Ie)=>this.compareTwoDate(B.createdAt??"",Ie.createdAt??""));let S=0;(J.length||fe.length)&&(J.forEach(B=>{B.results?.forEach(Ie=>{let xe=this.getMaxGroupId(Ie.groupPoints??[]);S<xe&&(S=xe)})}),fe.forEach(B=>{let Ie=this.getMaxGroupId(B.groupPoints??[]);S<Ie&&(S=Ie)})),"export_tool"==H&&me?.length&&(J=J.filter(B=>this.commonService.isExistInArray(me,B.classObj?.id)),this.commonService.isExistInArray(me,-1)||(fe=[]));let F={studentsInClassResults:J.length>0?J:[],studentsNotInClassResults:fe.length>0?fe:[],totalAttended:Le,totalQuestion:Q,totalUsers:0,examCreatorObj:te,offlineMixQuestionObjs:ye,examObj:Be,hasEssayQuestion:be,offlineExamObj:Ge,canResetStudentCode:ct,hasCreateStudentCode:Dt,questionObjs:L,fileTypeStr:nt,errorConfigClassroomPermission:Te.data?.errorConfigClassroomPermission,errorMessage:Te.data?.errorMessage,maxGroupId:S};if("export_tool"!=H){let B=this.gzipHelper.zipBigContent(JSON.stringify(F));this.browserStorageService.saveSimpleSessionStorage(ce,B)}pe.next({status:200,success:1,data:F,message:"successful"}),pe.complete()}else pe.next({status:Et.code,success:0,data:null,message:Et.message??""}),pe.complete()}):(pe.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:Le,totalQuestion:Q,hasEssayQuestion:be,totalUsers:0,examCreatorObj:te,offlineMixQuestionObjs:ye,examObj:Be,offlineExamObj:Ge,canResetStudentCode:ct,hasCreateStudentCode:Dt,questionObjs:L,fileTypeStr:Te.data?.fileTypeStr,errorConfigClassroomPermission:Te.data?.errorConfigClassroomPermission,errorMessage:Te.data?.errorMessage,maxGroupId:0},message:"successful"}),pe.complete())}else pe.next({status:Te.code,success:0,data:null,message:Te.message??""}),pe.complete()})})}getAllExamResultObjs(H,N,w,q,me){this.examPageResultService.apiExamPageResultGetObjsV2Get(w,"test_review"==H||"export_tool"==H?"export":"tested_list",q).subscribe(ce=>{1==ce.success?(ce.data?.objs&&N.push(...ce.data.objs),ce.data?.nextPage?this.globalService.isStopIntervalFunc(H)?me({studentWithResultObjs:N,success:1}):setTimeout(()=>{this.getAllExamResultObjs(H,N,w,ce.data?.nextPage??"",me)},300):me({studentWithResultObjs:N,success:1})):me({code:ce.code,studentWithResultObjs:[],success:0,message:ce.message??""})})}compareTwoDate(H,N){var w=new Date(H).getTime();w=isNaN(w)?0:w;var q=new Date(N).getTime();return w-(q=isNaN(q)?0:q)>0?1:w-q<0?-1:0}filterExamResultOnTest(H,N,w){var q={};return H.forEach(me=>{var pe=this.commonService.myClone(me)??{};if(pe.testStatus)q[pe.userId??0]=pe.testStatus;else if(pe.startedTest&&w)if(N.endTime){var ce=Math.floor(new Date(N.endTime).getTime()/1e3);q[pe.userId??0]=w<=ce+60*(N.minutes??0)+600?0:-1}else{var ie=pe.startedTest?Math.floor(new Date(pe.startedTest).getTime()/1e3):0;q[pe.userId??0]=w<=ie+86400?0:-1}else q[pe.userId??0]=0}),q}filterExamResultByType(H,N){var w={};if(H.length>1)H.forEach((me,pe)=>{var ce=this.commonService.myClone(me);me.testStatus&&(ce.resultId=ce.id,ce.indexTest=pe,"default"==N&&(w[ce.userId??0]=ce),"last"==N&&(w[ce.userId??0]=ce),"first"==N&&(w.hasOwnProperty(ce.userId??0)||(w[ce.userId??0]=ce)),"highest"==N)&&(w.hasOwnProperty(ce.userId??0)?(w[ce.userId??0].mark??-1)<=(ce.mark??-1)&&(w[ce.userId??0]=ce):w[ce.userId??0]=ce)});else{var q=this.commonService.myClone(H[0]??{});q.resultId=q.testStatus?q.id:0,q.indexTest=0,w[q.userId??0]=q}return w}findExamResultOfStudent(H,N){var w=[];return H.forEach(q=>{(q.studentId==N||null==q.studentId)&&w.push(q)}),w}addResultIdToExamResult(H){var N=[];return H.forEach(w=>{var q=this.commonService.myClone(w)??{};q.resultId=q.id,q.testStatus&&N.push(q)}),N}compareLengthWithExamQuestion(H,N){var w=this.commonService.myClone(H);if(N>0&&H.length<N)for(var q=0;q<N-H.length;q++)w.push("");return w}mergeStudentWithAvatar(H){var N=[];return H.forEach(w=>{var q=N.filter(pe=>pe.parentId==w.parentId);if(q&&0!=q.length)for(var me=0;me<N.length;me++)N[me].parentId==w.parentId&&(N[me].examResultObjs=N[me].examResultObjs?.concat(w.examResultObjs??[]));else N.push(w)}),N}createStudentWithResult(H,N,w,q,me,pe){return{id:H.id,userId:H.parentId,studentId:H.id,identificationNumber:N?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??H.identificationNumber??0,offlineMixQuestionHashId:N?.offlineMark?.rawOfflineMixquestionId??0,studentCode:N?.offlineMark?.studentCode??0,gender:H.gender,fullName:H.fullName,avatar:H.avatar,birthday:H.birthday,resultId:N?.hasOwnProperty("resultId")?N.resultId:0,answers:N?.hasOwnProperty("answers")?N.answers:null,rightAnswer:N?.hasOwnProperty("rightAnswer")?N.rightAnswer:0,totalQuestion:N?.hasOwnProperty("totalQuestion")?N.totalQuestion:0,mark:N?.hasOwnProperty("mark")?N?.mark:null,trueFalseMark:N?.hasOwnProperty("trueFalseMark")?N.trueFalseMark:null,essayMark:N?.hasOwnProperty("essayMark")?N.essayMark:null,files:N?.hasOwnProperty("files")?N.files:null,infors:N?.hasOwnProperty("infors")?N?.infors:null,confirmedAt:N?.hasOwnProperty("confirmedAt")?N?.confirmedAt:null,startedTest:N?.hasOwnProperty("startedTest")?N?.startedTest:null,createdAt:N?.hasOwnProperty("createdAt")?N.createdAt:null,totalExamResultObjs:H.examResultObjs.length,answeredQuestions:N?.hasOwnProperty("answeredQuestions")?N.answeredQuestions:[],groupPoints:this.getGroupPoints(N?.answeredQuestions?N?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:N?.examTrackObj?.exitFullScreen,blurCount:N?.examTrackObj?.blurWindow},status:w,nameImages:H.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion(N?.answerMixObjs??[],q)??[],testedTime:me+1,totalTestTime:pe,subjectMarkValues:N?.subjectMarks,isOffline:N?.isOffline??!1,countEssayQuestion:this.sAztExamResultListSortService._checkCounterEssayQuestionObjs(N?.hasOwnProperty("answeredQuestions")&&N?.answeredQuestions?N.answeredQuestions:[]),checkBoxGroupControl:new l.gE({isShow:new l.MJ(!1,{nonNullable:!0}),selectedCheckbox:new l.MJ(!1,{nonNullable:!0})}),questionTypeMarks:N?.questionTypeMarks??[],schoolName:H.schoolName??"",phone:H.phone??"",email:H.email??"",userName:H?.userName??""}}getGroupPoints(H){let N=[];return H.forEach(w=>{let q=!1;for(let me=0;me<N.length;me++)N[me].id==w.groupId&&(q=!0,N[me].point+=w.correct&&w.scorePerQuestion?w.scorePerQuestion:0);!q&&w.groupId&&N.push({id:w.groupId,point:w.correct&&w.scorePerQuestion?w.scorePerQuestion:0})}),N.sort((w,q)=>(w.id??0)-(q.id??0)),N}getMaxGroupId(H){let N=[];return H.forEach(w=>{w.id&&!this.commonService.isExistInArray(N,w.id)&&N.push(w.id)}),N.length}}return(U=D).\u0275fac=function(H){return new(H||U)(c.KVO(m.R),c.KVO(x.TE),c.KVO(C.p),c.KVO(Y.r),c.KVO(y.z),c.KVO(ae.f),c.KVO(V.Z),c.KVO(P.w))},U.\u0275prov=c.jDH({token:U,factory:U.\u0275fac,providedIn:"root"}),D})()},32835:(gt,ke,v)=>{v.d(ke,{i:()=>d});var l=v(48891);let d=(()=>{var c;class m{processData(C){let Y=[],y=[];if(C)for(var ae=0;ae<C.length;ae++)if("scroll"!=C[ae][0]){var V={index:C[ae][0],alpha:C[ae][1],key:C[ae][2],questionId:Number(C[ae][3]),second:Number(C[ae][4])};Y.push(V)}else{var P={scrollPos:Number(C[ae][1]),second:Number(C[ae][2])};y.push(P)}return[Y,y]}}return(c=m).\u0275fac=function(C){return new(C||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),m})()},97099:(gt,ke,v)=>{v.d(ke,{B:()=>Ae});var l=v(54460),d=v(10936),c=v(65162),m=v(53220),x=v(81275),C=v(15343),Y=v(59055),y=v(44233),ae=v(5502),V=v(21656),P=v(70050),R=v(76407),U=v(91100),D=v(48891);let Ae=(()=>{var H;class N{}return(H=N).\u0275fac=function(q){return new(q||H)},H.\u0275mod=D.$C({type:H}),H.\u0275inj=D.G2t({imports:[l.MD,V.s,U.Q,P.L,d.YN,d.X1,ae.Id,m.h,c.iI,C.flO.pick(C.Ptg),x.rc,Y.e,R.n,y.An]}),N})()},54479:(gt,ke,v)=>{v.d(ke,{t:()=>ze});var l=v(73014),d=v(27691),c=v(48891),m=v(10936),x=v(59640),C=v(30657),Y=v(64198),y=v(83229),ae=v(40949),V=v(35095),P=v(41426),R=v(51113),U=v(54460),D=v(47712),Ae=v(7919),H=v(81587),N=v(84278),w=v(34815),q=v(15343),me=v(58588),pe=v(76975);const ce=["mnoteContainer"],ie=["aztMarkNote"],Oe=J=>({display:J}),Ce=J=>({border:J}),Ke=()=>({"mr-1 cursor-pointer":!0}),Te=J=>({"is-invalid":J});function at(J,ue){1&J&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&J&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function de(J,ue){1&J&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&J&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Be(J,ue){1&J&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&J&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function oe(J,ue){if(1&J&&(c.j41(0,"div",19),c.DNE(1,at,3,3,"span",10)(2,de,3,3,"span",10)(3,Be,3,3,"span",10),c.k0s()),2&J){const fe=c.XpG().index,G=c.XpG();c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+fe].errors?null:G.form.controls["cau"+fe].errors.min),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+fe].errors?null:G.form.controls["cau"+fe].errors.max),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+fe].errors?null:G.form.controls["cau"+fe].errors.pattern)}}function Le(J,ue){if(1&J){const fe=c.RV6();c.j41(0,"div",12)(1,"div",13)(2,"lucide-icon",14),c.nI1(3,"mytranslate"),c.bIt("click",function(S){const F=c.eBV(fe).index,B=c.XpG();return c.Njj(B.toggleVisibility(S,F))}),c.k0s(),c.j41(4,"span",15),c.EFF(5),c.nI1(6,"mytranslate"),c.j41(7,"span",16),c.nI1(8,"mytranslate"),c.EFF(9),c.nI1(10,"mytranslate"),c.k0s()(),c.nrm(11,"input",17),c.nI1(12,"mytranslate"),c.k0s(),c.DNE(13,oe,4,3,"div",18),c.k0s()}if(2&J){let fe;const G=ue.$implicit,S=ue.index,F=c.XpG();c.Y8G("ngStyle",c.eq3(25,Ce,S==F.questions.length-1?"none":"")),c.R7$(2),c.FS9("matTooltip",c.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),c.Y8G("ngClass",c.lJ4(27,Ke)),c.R7$(3),c.Lme(" ",c.bMT(6,17,"lang_auto_cau")," ",(null!==(fe=G.indexLabel)&&void 0!==fe?fe:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",G.essMaxPoint," ",c.bMT(10,21,"lang_auto_diem_brackets"),""),c.R7$(2),c.FS9("placeholder",c.bMT(12,23,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",S,""),c.Y8G("readonly",!F.showForTeacher)("decimal",!0)("ngClass",c.eq3(28,Te,F.form.controls["cau"+S]&&F.form.controls["cau"+S].invalid)),c.R7$(2),c.Y8G("ngIf",F.form.controls["cau"+S].errors)}}function L(J,ue){if(1&J){const fe=c.RV6();c.j41(0,"div",20)(1,"button",21),c.bIt("click",function(){c.eBV(fe);const S=c.XpG();return c.Njj(S.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&J){const fe=c.XpG();c.R7$(),c.Y8G("disabled",fe.isLoading||fe.form.invalid||fe.loadingDataCdn&&fe.files.length>0),c.R7$(),c.SpI(" ",fe.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}function te(J,ue){if(1&J&&c.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&J){let fe;const G=c.XpG().$implicit,S=c.XpG();c.Y8G("follower",S.followerRenderQuest)("examObj",S.examObj)("examConfig",S.examConfig)("questionObj",G)("curQuestionIndex",null!==(fe=G.indexLabel)&&void 0!==fe?fe:0)("userAnswersObj",S.userAnswersObj)("currentTab","essay_tab")}}function Ge(J,ue){if(1&J&&c.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&J){let fe;const G=c.XpG().$implicit,S=c.XpG();c.Y8G("follower",S.followerRenderQuest)("examObj",S.examObj)("questionObj",G)("curQuestionIndex",null!==(fe=G.indexLabel)&&void 0!==fe?fe:0)("userAnswersObj",S.userAnswersObj)("orgExamObjs",S.orgExamObjs)("currentTab","essay_tab")}}function be(J,ue){1&J&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&J&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Q(J,ue){1&J&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&J&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function ye(J,ue){1&J&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&J&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function ct(J,ue){if(1&J&&(c.j41(0,"div",19),c.DNE(1,be,3,3,"span",10)(2,Q,3,3,"span",10)(3,ye,3,3,"span",10),c.k0s()),2&J){const fe=c.XpG(2).index,G=c.XpG();c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+fe].errors?null:G.form.controls["cau"+fe].errors.min),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+fe].errors?null:G.form.controls["cau"+fe].errors.max),c.R7$(),c.Y8G("ngIf",null==G.form.controls["cau"+fe].errors?null:G.form.controls["cau"+fe].errors.pattern)}}function Dt(J,ue){if(1&J&&(c.j41(0,"div",29)(1,"form",30)(2,"label",31),c.EFF(3),c.nI1(4,"mytranslate"),c.j41(5,"span",16),c.nI1(6,"mytranslate"),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.EFF(9," : "),c.k0s(),c.nrm(10,"input",32),c.nI1(11,"mytranslate"),c.DNE(12,ct,4,3,"div",18),c.k0s()()),2&J){let fe;const G=c.XpG(),S=G.$implicit,F=G.index,B=c.XpG();c.R7$(),c.Y8G("formGroup",B.form),c.R7$(),c.FS9("for","cau_"+F),c.R7$(),c.Lme(" ",c.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(fe=S.indexLabel)&&void 0!==fe?fe:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",S.essMaxPoint," ",c.bMT(8,19,"lang_auto_diem_brackets"),""),c.R7$(3),c.FS9("placeholder",c.bMT(11,21,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",F,""),c.Y8G("readonly",!B.showForTeacher)("ngClass",c.eq3(23,Te,B.form.controls["cau"+F]&&B.form.controls["cau"+F].invalid))("id","cau_"+F)("decimal",!0),c.R7$(2),c.Y8G("ngIf",B.form.controls["cau"+F].errors)}}function nt(J,ue){if(1&J&&(c.j41(0,"div",22)(1,"div",23),c.DNE(2,te,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,Ge,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,Dt,13,25,"div",26),c.k0s()()),2&J){const fe=ue.index,G=c.XpG();c.R7$(),c.Mz_("id","q_",fe,""),c.R7$(),c.Y8G("ngIf",!G.showForTeacher),c.R7$(),c.Y8G("ngIf",G.showForTeacher),c.R7$(),c.Y8G("ngIf",G.showForTeacher)}}function Et(J,ue){1&J&&(c.j41(0,"div",33)(1,"b"),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s(),c.EFF(4),c.nI1(5,"mytranslate"),c.k0s()),2&J&&(c.R7$(2),c.SpI("",c.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),c.R7$(2),c.SpI(" ",c.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Qe(J,ue){if(1&J){const fe=c.RV6();c.j41(0,"azt-mark-note",35,1),c.bIt("doneLoadData",function(S){c.eBV(fe);const F=c.XpG(2);return c.Njj(F.doneLoadData(S))}),c.k0s()}if(2&J){const fe=c.XpG(2);c.Y8G("dataMarkNote",fe.dataMarkNote)("screenType","exam")("modeView",fe.showForTeacher?"teacher":"student")}}function ft(J,ue){if(1&J&&(c.qex(0),c.DNE(1,Qe,2,3,"azt-mark-note",34),c.bVm()),2&J){const fe=c.XpG();c.R7$(),c.Y8G("ngIf",1===fe.curSelectedTab||fe.changeSelectedTab)}}function He(J,ue){if(1&J){const fe=c.RV6();c.j41(0,"div",36)(1,"button",37),c.bIt("click",function(){c.eBV(fe);const S=c.XpG();return c.Njj(S.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&J){const fe=c.XpG();c.R7$(),c.Y8G("disabled",fe.isLoading||fe.form.invalid||fe.loadingDataCdn&&fe.files.length>0),c.R7$(),c.SpI(" ",fe.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}let ze=(()=>{var J;class ue extends x.H{getMaxPoint(G){var S=0;for(let F=0;F<this.questions.length;F++)if(this.questions[F].id==G){S=this.questions[F].scorePerQuestion??0;break}return S}toggleVisibility(G,S){var F=G.target,B=document.getElementById(`q_${S}`);B&&("block"==B?.style.display?(B.style.display="none",F&&(F.textContent="visibility_off")):(B.style.display="block",F&&(F.textContent="visibility")))}remark(G){for(const B in this.form.value)"string"==typeof this.form.value[B]&&this.form.value[B].includes(",")&&(this.form.value[B]=this.form.value[B].replace(",","."));let S=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var F={id:this.resultID,result:G,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(F,S).subscribe(B=>{1==B.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(B.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}initDataMarkNote(){if(this.examResultObj.result)this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId};else{for(let G=0;G<this.files.length;G++)this.files[G].url=this.cdnService.getMyCdn(this.files[G].url??"");this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)}}}saveDataMarkExercise(){var G=this;return(0,l.A)(function*(){let S=!1;for(const F in G.form.value)""!==G.form.value[F]&&(S=!0);if(S){for(const F in G.form.value)""===G.form.value[F]&&(G.form.value[F]=0,G.form.controls[F].setValue(0));if(G.isLoading=!0,G.files&&G.files.length>0){G.objectResult=G.MarkNote?.exportDataMarkNote();let F=!1;if(!G.objectResult.pages?.length&&G.files.find(B=>(0,Y.nL)(B.mimes??"")||(0,Y.rl)(B.mimes??"")))return void G.remark("");if(G.objectResult.pages?.length){for(let Me=0;Me<G.objectResult.pages.length;Me++)if(G.objectResult.pages[Me]&&G.objectResult.pages[Me].draws?.length)for(let rt=0;rt<(G.objectResult.pages[Me].draws?.length??0);rt++){let st=G.objectResult.pages[Me].draws?.[rt]??{};st.src&&st.src.includes("base64")&&(F=!0)}F&&(yield G.uploadDrawBase64ToCdn());const B=G.serializeJson(G.objectResult),Ie=G.zipDataService.convertContentGzip(B),xe=new Blob([Ie],{type:"text/plain"}),Ze=new File([xe],"txt",{type:"text/plain"});G.apiUploadService.uploadToCdnForHomework(Ze).subscribe(Me=>{1==Me.success?G.remark(G.serializeJson({urlDataMark:Me.data?.url??"",version:"0.1"})):G.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai")})}}else G.remark("")}else G.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan")})()}uploadDrawBase64ToCdn(){return new Promise(G=>{let S=[];if(this.objectResult.pages){this.objectResult.pages.forEach(F=>{S.push(!1)});for(let F=0;F<this.objectResult.pages.length;F++)if(this.objectResult.pages[F]&&this.objectResult.pages[F].draws?.length)for(let B=0;B<(this.objectResult.pages[F].draws?.length??0);B++){let Ie=this.objectResult.pages[F].draws?.[B]??{};if(Ie.src&&Ie.src.includes("base64")){S[F]=!0;let xe=(0,y.q)(Ie.src);this.apiUploadService.commonUploadForMarkResult(xe,`essay_note_${F}_${B}_${this.resultID}.png`,"image/png").subscribe(Ze=>{Ze.type!=d.hv.UploadProgress&&(Ie.src=Ze.data?.url,S[F]=!1),S.includes(!0)||G()})}}}})}doneLoadData(G){this.loadingDataCdn=!1}ngOnInit(){this.initDataMarkNote();var G={};let S;this.examResultObj.confirmedAt&&(S=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(B=>{let Ie=this.getMaxPoint(B.id);this.totalMaxPoint+=Ie,B.essMaxPoint=Ie,this.maxPointPerQuestion.push(B.essMaxPoint)});for(let B=0;B<this.questions.length;B++){var F=`cau${B}`;G[F]=new m.MJ(S?S[F]:"",{validators:[m.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),m.k0.min(0),m.k0.max(this.questions[B].essMaxPoint??0)]})}this.form=new m.gE(G),this.form.valueChanges.subscribe(B=>{let Ie=JSON.stringify(B);Ie!=this.prevData&&(this.prevData=Ie,this.form.patchValue(B))}),super.ngOnInit()}constructor(G,S,F,B){super(),this.cdnService=G,this.examResultService=S,this.apiUploadService=F,this.zipDataService=B,this.orgExamObjs=[],this.questions=[],this.files=[],this.resultID=0,this.userAnswersObj={},this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new c.bkB,this.followerRenderQuest=new C.e,this.form=new m.gE({}),this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.jsonData={},this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return(J=ue).\u0275fac=function(G){return new(G||J)(c.rXU(ae.B),c.rXU(V._),c.rXU(P.T),c.rXU(R.j))},J.\u0275cmp=c.VBU({type:J,selectors:[["azt-mark-essay-new"]],viewQuery:function(G,S){if(1&G&&(c.GBs(ce,5),c.GBs(ie,5)),2&G){let F;c.mGM(F=c.lsd())&&(S.mnoteContainer=F.first),c.mGM(F=c.lsd())&&(S.MarkNote=F.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",resultID:"resultID",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},features:[c.Vt3],decls:11,vars:10,consts:[["mnoteContainer",""],["aztMarkNote",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"doneLoadData","dataMarkNote","screenType","modeView"],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(G,S){1&G&&(c.j41(0,"div",2)(1,"form",3),c.DNE(2,Le,14,30,"div",4),c.k0s(),c.DNE(3,L,5,6,"div",5),c.k0s(),c.j41(4,"div",6),c.DNE(5,nt,5,5,"div",7),c.k0s(),c.DNE(6,Et,6,6,"div",8),c.j41(7,"div",9,0),c.DNE(9,ft,2,1,"ng-container",10),c.k0s(),c.DNE(10,He,5,6,"div",11)),2&G&&(c.R7$(),c.Y8G("formGroup",S.form),c.R7$(),c.Y8G("ngForOf",S.questions),c.R7$(),c.Y8G("ngIf",S.showForTeacher),c.R7$(2),c.Y8G("ngForOf",S.questions),c.R7$(),c.Y8G("ngIf",S.files&&0==S.files.length),c.R7$(),c.Y8G("ngStyle",c.eq3(8,Oe,S.files&&0==S.files.length?"none":"block")),c.R7$(2),c.Y8G("ngIf",S.dataMarkNote&&S.dataMarkNote.answer_obj&&S.files&&S.files.length>0),c.R7$(),c.Y8G("ngIf",S.showForTeacher))},dependencies:[U.YU,U.Sq,U.bT,U.B3,D.oV,Ae.Z,H.t,N.x,w.o,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,q.WGl,me.i,pe.wp],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:#2361ae2e;border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ue})()},94315:(gt,ke,v)=>{v.d(ke,{eX:()=>U});class l{constructor(){this.x=0,this.y=0}toBase64String(){return(new H).writeCvPoint2u(this).toBase64String()}}class d{constructor(){this.x=0,this.y=0}toBase64String(){return(new H).writeCvPoint2f(this).toBase64String()}}class c{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new H).writeCvRect2f(this).toBase64String()}}class m{constructor(){this.center=new d,this.filled=!1}toBase64String(){return(new H).writeAnswerCircle(this).toBase64String()}}class x{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new H).writeTableAnswer(this).toBase64String()}}class C{constructor(){this.top=new d,this.left=new d,this.bottom=new d,this.right=new d}toBase64String(){return(new H).writeResultRect(this).toBase64String()}}class Y{constructor(){this.id=0,this.region=new c}toBase64String(){return(new H).writeCropRegion(this).toBase64String()}}class y{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new C,this.studentId=new x,this.examId=new x,this.answerTable=new x,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new H).writeResultOutput(this).toBase64String()}}class ae{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new H).writeAnswerSheetInput(this).toBase64String()}}class V{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new H).writeSmallAnswerCircle(this).toBase64String()}}class P{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new H).writeSmallTableAnswer(this).toBase64String()}}class R{constructor(){this.studentId=new P,this.examId=new P,this.answerTable=new P}toBase64String(){return(new H).writeDrawData(this).toBase64String()}}class U{constructor(w){this.bytes=w,this.cursor=0,this.length=w.byteLength}updateCursor(w){if(this.cursor=this.cursor+w,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let w=this.bytes[this.cursor];return this.updateCursor(1),w}parseInt(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(w).getInt32(0)}parseDouble(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(w).getFloat64(0,!0)}parseString(){let w=new TextDecoder("utf-8"),q=this.cursor,me=this.bytes[this.cursor];for(;0!=me;)this.updateCursor(1),me=this.bytes[this.cursor];let pe=this.bytes.slice(q,this.cursor),ce=w.decode(pe);return this.updateCursor(1),ce}parseBool(){let w=this.bytes[this.cursor];return this.updateCursor(1),w>0}parseCvPoint2u(){let w=new l;return w.x=this.parseUchar(),w.y=this.parseUchar(),w}parseCvPoint2f(){let w=new d;return w.x=this.parseDouble(),w.y=this.parseDouble(),w}parseCvRect2f(){let w=new c;return w.x=this.parseDouble(),w.y=this.parseDouble(),w.width=this.parseDouble(),w.height=this.parseDouble(),w}parseAnswerCircle(){let w=new m;return w.center=this.parseCvPoint2f(),w.filled=this.parseBool(),w}parseTableAnswer(){let w=new x,q=0;w.rows=this.parseInt(),w.cols=this.parseInt(),w.radius=this.parseInt(),q=this.parseInt();for(let me=0;me<q;me++)w.answers.push(this.parseAnswerCircle());return w}parseResultRect(){let w=new C;return w.top=this.parseCvPoint2f(),w.left=this.parseCvPoint2f(),w.bottom=this.parseCvPoint2f(),w.right=this.parseCvPoint2f(),w}parseCropRegion(){let w=new Y;return w.id=this.parseInt(),w.region=this.parseCvRect2f(),w}parseResultOutput(){let w=new y,q=0;w.type=this.parseInt(),w.errorCode=this.parseInt(),w.paperCorner=this.parseResultRect(),w.studentId=this.parseTableAnswer(),w.examId=this.parseTableAnswer(),w.answerTable=this.parseTableAnswer(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w.imageSize=this.parseInt(),q=this.parseInt();for(let me=0;me<q;me++)w.cropRegion.push(this.parseCropRegion());return w}parseAnswerSheetInput(){let w=new ae;return w.templateType=this.parseInt(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w}parseSmallAnswerCircle(){let w=new V;return w.position=this.parseUchar(),w.x=this.parseUchar(),w.y=this.parseUchar(),w.filledCols=this.parseUchar(),w.rows=this.parseUchar(),w}parseSmallTableAnswer(){let w=new P,q=0;w.rows=this.parseUchar(),w.cols=this.parseUchar(),w.radius=this.parseUchar(),q=this.parseInt();for(let me=0;me<q;me++)w.answers.push(this.parseSmallAnswerCircle());return w}parseDrawData(){let w=new R;return w.studentId=this.parseSmallTableAnswer(),w.examId=this.parseSmallTableAnswer(),w.answerTable=this.parseSmallTableAnswer(),w}}const D=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class H{constructor(){this.bytes=[]}writeUchar(w){return this.bytes.push(w),this}writeUint8Array(w){for(let q=0;q<w.length;q++)this.bytes.push(w[q]);return this}writeArrayBuffer(w){let q=new Uint8Array(w);return this.writeUint8Array(q),this}writeInt(w){let q=new ArrayBuffer(4);return new DataView(q).setUint32(0,w,!1),this.writeArrayBuffer(q),this}writeDouble(w){let q=new ArrayBuffer(8);return new DataView(q).setFloat64(0,w,!0),this.writeArrayBuffer(q),this}writeString(w){let me=(new TextEncoder).encode(w);return this.writeUint8Array(me),this.writeUchar(0),this}writeBool(w){return this.writeUchar(w?1:0),this}toBase64String(){return function Ae(N){let q,w="",me=N.length;for(q=2;q<me;q+=3)w+=D[N[q-2]>>2],w+=D[(3&N[q-2])<<4|N[q-1]>>4],w+=D[(15&N[q-1])<<2|N[q]>>6],w+=D[63&N[q]];return q===me+1&&(w+=D[N[q-2]>>2],w+=D[(3&N[q-2])<<4],w+="=="),q===me&&(w+=D[N[q-2]>>2],w+=D[(3&N[q-2])<<4|N[q-1]>>4],w+=D[(15&N[q-1])<<2],w+="="),w}(new Uint8Array(this.bytes))}writeCvPoint2u(w){return this.writeUchar(w.x),this.writeUchar(w.y),this}writeCvPoint2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this}writeCvRect2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this.writeDouble(w.width),this.writeDouble(w.height),this}writeAnswerCircle(w){return this.writeCvPoint2f(w.center),this.writeBool(w.filled),this}writeTableAnswer(w){this.writeInt(w.rows),this.writeInt(w.cols),this.writeInt(w.radius),this.writeInt(w.answers.length);for(let q of w.answers)this.writeAnswerCircle(q);return this}writeResultRect(w){return this.writeCvPoint2f(w.top),this.writeCvPoint2f(w.left),this.writeCvPoint2f(w.bottom),this.writeCvPoint2f(w.right),this}writeCropRegion(w){return this.writeInt(w.id),this.writeCvRect2f(w.region),this}writeResultOutput(w){this.writeInt(w.type),this.writeInt(w.errorCode),this.writeResultRect(w.paperCorner),this.writeTableAnswer(w.studentId),this.writeTableAnswer(w.examId),this.writeTableAnswer(w.answerTable),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this.writeInt(w.imageSize),this.writeInt(w.cropRegion.length);for(let q of w.cropRegion)this.writeCropRegion(q);return this}writeAnswerSheetInput(w){return this.writeInt(w.templateType),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this}writeSmallAnswerCircle(w){return this.writeUchar(w.position),this.writeUchar(w.x),this.writeUchar(w.y),this.writeUchar(w.filledCols),this.writeUchar(w.rows),this}writeSmallTableAnswer(w){this.writeUchar(w.rows),this.writeUchar(w.cols),this.writeUchar(w.radius),this.writeInt(w.answers.length);for(let q of w.answers)this.writeSmallAnswerCircle(q);return this}writeDrawData(w){return this.writeSmallTableAnswer(w.studentId),this.writeSmallTableAnswer(w.examId),this.writeSmallTableAnswer(w.answerTable),this}}},72267:(gt,ke,v)=>{v.d(ke,{E:()=>x});var l=v(48891),d=v(62095),c=v(51113),m=v(99927);let x=(()=>{var C;class Y{addIndexLabelToQuestionObjs(ae){for(let V=0;V<(ae?.length??0);V++)ae?.[V]&&(ae[V].indexLabel=V);return ae}getEssayQuestionObjs(ae){let V=[];for(let P=0;P<(ae?.length??0);P++)this.answerTypeService.isEssayAnswer(ae?.[P])&&ae?.[P]&&V.push(ae[P]);return V}getTrueFalseQuestionObjs(ae){let V=[];for(let P=0;P<(ae?.length??0);P++)(this.answerTypeService.isOneChoiceAnswer(ae?.[P])||this.answerTypeService.isTrueFalseAnswer(ae?.[P])||this.answerTypeService.isFillAnswer(ae?.[P]))&&ae?.[P]&&V.push(ae[P]);return V}convertAnswersArr(ae){let V={};return 0!=ae.length&&ae.forEach(P=>{let R=!!P.AnswerContent?.filter(U=>U.Status)?.length;P.AnswerContent&&P.AnswerContent.length&&(V[`id_${P.QuestionId}`]=R?[...P.AnswerContent]:P.AnswerContent[0].Content)}),V}mapStudentObjWithTestedObj(ae,V,P){var R=this.commonService.castObj(ae?.studentObj),U=V?.filter(D=>D.userId==P?.parentId);return R&&U&&U.length>0&&(R={...R,offlineMarkObj:U[0].offlineMarkObj,nameImage:U[0].nameImage??""}),P=R}mapStudentObjWithTestedObjForFrontendStudent(ae,V,P){var R=this.commonService.castObj(ae?.studentObj),U=V?.filter(D=>D.userId==P?.parentId);return R&&U&&U.length>0&&(R={...R,offlineMarkObj:U[0].offlineMarkObj,nameImage:U[0].nameImage??""}),P=R}constructor(ae,V,P){this.commonService=ae,this.zipDataService=V,this.answerTypeService=P}}return(C=Y).\u0275fac=function(ae){return new(ae||C)(l.KVO(d.R),l.KVO(c.j),l.KVO(m._))},C.\u0275prov=l.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),Y})()},57332:(gt,ke,v)=>{v.d(ke,{V:()=>ce});var l=v(89163),d=v(33887),c=v(48891),m=v(2145),x=v(54460),C=v(68323),Y=v(90796),y=v(52811),ae=v(15343),V=v(76975);const P=()=>({"mr-2 text-danger flex-none":!0});function R(ie,Oe){1&ie&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ie&&(c.R7$(),c.JRh(c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_this_exam_result")))}function U(ie,Oe){1&ie&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ie&&(c.R7$(),c.SpI("",c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_multiple_exam_result"),":"))}function D(ie,Oe){if(1&ie&&(c.j41(0,"div",8),c.nrm(1,"lucide-icon",9),c.j41(2,"div"),c.DNE(3,R,3,3,"span",10)(4,U,3,3,"span",10),c.k0s()()),2&ie){const Ce=c.XpG();c.R7$(),c.Y8G("ngClass",c.lJ4(3,P)),c.R7$(2),c.Y8G("ngIf",1==Ce.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",Ce.data.examResultIds.length>1)}}function Ae(ie,Oe){if(1&ie&&(c.j41(0,"div",21)(1,"span",22),c.EFF(2),c.k0s()()),2&ie){const Ce=c.XpG().$implicit;c.R7$(2),c.JRh(Ce.fullName)}}function H(ie,Oe){if(1&ie&&c.nrm(0,"img",23),2&ie){const Ce=c.XpG().$implicit;c.Y8G("nameImages",Ce.nameImages)}}function N(ie,Oe){if(1&ie&&(c.j41(0,"div",14)(1,"div",15)(2,"div",16),c.nrm(3,"azt-create-avatar",17),c.k0s(),c.j41(4,"div",18),c.DNE(5,Ae,3,1,"div",19)(6,H,1,1,"img",20),c.k0s()()()),2&ie){let Ce;const Ke=Oe.$implicit,Te=c.XpG(2);c.R7$(3),c.Y8G("linkAvatar",null!==(Ce=Ke.avatar)&&void 0!==Ce?Ce:"")("nameCreateAvatar",Ke.fullName)("size",32),c.R7$(2),c.Y8G("ngIf",!Ke.nameImages||Te.commonService.convertStringToNumber(Ke.id)>0),c.R7$(),c.Y8G("ngIf",Ke.nameImages&&Te.commonService.convertStringToNumber(Ke.studentId)<=0)}}function w(ie,Oe){if(1&ie&&(c.j41(0,"div",12),c.DNE(1,N,7,5,"div",13),c.k0s()),2&ie){const Ce=c.XpG();c.R7$(),c.Y8G("ngForOf",Ce.data.examResults)}}function q(ie,Oe){1&ie&&(c.j41(0,"div",8)(1,"div",24)(2,"button",25)(3,"div",26),c.nrm(4,"lucide-icon",27),c.k0s()(),c.j41(5,"div",28),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s()()()),2&ie&&(c.R7$(6),c.JRh(c.bMT(7,1,"lang_testbank_are_you_sure_to_delete_no_exam_result")))}function me(ie,Oe){1&ie&&(c.j41(0,"span",31),c.nrm(1,"azt-loading-ui"),c.k0s())}function pe(ie,Oe){if(1&ie){const Ce=c.RV6();c.j41(0,"button",29),c.bIt("click",function(){c.eBV(Ce);const Te=c.XpG();return c.Njj(Te.confirmDelete())}),c.DNE(1,me,2,0,"span",30),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s()}if(2&ie){const Ce=c.XpG();c.Y8G("disabled",Ce.statusObj.loading),c.R7$(),c.Y8G("ngIf",Ce.statusObj.loading),c.R7$(),c.SpI(" ",c.bMT(3,3,"lang_cms_common_confirm_btn")," ")}}let ce=(()=>{var ie;class Oe extends d._{confirmDelete(){this.initStatusObj(),this.waitDestroy(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjsPost({examHashId:this.examHashId,examResultIds:this.examResultIds}).subscribe(Ke=>{1==Ke.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(Ke.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(Ke,Te,at){super(at,Te),this.offlineExamResultService=Ke,this.dialogRef=Te,this.examHashId="",this.examResultIds=[],this.examHashId=at.examHashId,this.examResultIds=at.examResultIds}}return(ie=Oe).\u0275fac=function(Ke){return new(Ke||ie)(c.rXU(m.Fs),c.rXU(l.CP,8),c.rXU(l.Vh,8))},ie.\u0275cmp=c.VBU({type:ie,selectors:[["coazt-delete-offline-exam-result-dialog"]],features:[c.Vt3],decls:11,vars:7,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],["class","text-md flex",4,"ngIf"],["class","grid grid-cols-12 gap-3","style","overflow-y: auto; max-height: calc(100vh - 150px)",4,"ngIf"],[1,"p-3","flex","justify-end"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor","class","btn w-32 btn-danger",3,"disabled","click",4,"ngIf"],[1,"text-md","flex"],["name","trash-2","size","24",3,"ngClass"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"grid","grid-cols-12","gap-3",2,"overflow-y","auto","max-height","calc(100vh - 150px)"],["class","col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"flex","items-center","p-3","student-exam-result-up","w-full"],[1,"w-8","h-8","image-fit","lg:mr-1"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"ml-2","text-left","mt-0",2,"width","calc(100% - 3.5rem)"],["class","azt-student-name flex items-center","style","flex-wrap: wrap",4,"ngIf"],["appDrawNameImage","","class","mb-1 img-name-fluid",3,"nameImages",4,"ngIf"],[1,"azt-student-name","flex","items-center",2,"flex-wrap","wrap"],[1,"font-medium","mr-2"],["appDrawNameImage","",1,"mb-1","img-name-fluid",3,"nameImages"],[1,"mx-auto","text-center"],[1,"btn","btn-sm","btn-primary-soft","p-1"],[1,"w-6","h-6"],["name","circle-x","size","24"],[1,"mt-4"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"click","disabled"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(Ke,Te){1&Ke&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2),c.DNE(3,D,5,4,"div",3)(4,w,2,1,"div",4)(5,q,8,3,"div",3),c.k0s()(),c.j41(6,"div",5)(7,"button",6),c.bIt("click",function(){return Te.btnCloseDialog()}),c.EFF(8),c.nI1(9,"mytranslate"),c.k0s(),c.DNE(10,pe,4,5,"button",7),c.k0s()()),2&Ke&&(c.R7$(3),c.Y8G("ngIf",Te.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",Te.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",!Te.data.examResultIds.length),c.R7$(3),c.SpI(" ",c.bMT(9,5,"lang_cms_common_close_btn")," "),c.R7$(2),c.Y8G("ngIf",Te.data.examResultIds.length))},dependencies:[x.YU,x.Sq,x.bT,C.p,Y.y,y.R,ae.WGl,V.wp],encapsulation:2}),Oe})()},92801:(gt,ke,v)=>{v.d(ke,{$:()=>w});var l=v(89163),d=v(33887),c=v(48891),m=v(54460),x=v(47426),C=v(95670),Y=v(43404),y=v(4375),ae=v(47712),V=v(76975);function P(q,me){if(1&q&&(c.j41(0,"div")(1,"div",10)(2,"div",11),c.EFF(3),c.k0s(),c.nrm(4,"input",12),c.k0s()()),2&q){const pe=c.XpG().$implicit;c.R7$(3),c.SpI(" ",pe.title," "),c.R7$(),c.FS9("value",pe.contents[0]),c.Y8G("disabled",!0)}}function R(q,me){if(1&q&&(c.j41(0,"div",17)(1,"span",18),c.EFF(2),c.k0s()()),2&q){const pe=me.$implicit;c.R7$(),c.FS9("matTooltip",pe),c.R7$(),c.JRh(pe)}}function U(q,me){if(1&q&&(c.j41(0,"div")(1,"div",13)(2,"span",14),c.EFF(3),c.k0s()(),c.j41(4,"div",15),c.DNE(5,R,3,2,"div",16),c.k0s()()),2&q){const pe=c.XpG().$implicit;c.R7$(3),c.JRh(pe.title),c.R7$(2),c.Y8G("ngForOf",pe.contents)}}function D(q,me){if(1&q&&(c.j41(0,"mat-radio-button",21)(1,"span",18),c.EFF(2),c.k0s()()),2&q){const pe=me.$implicit;c.Y8G("checked",!0)("disabled",!0),c.R7$(),c.FS9("matTooltip",pe),c.R7$(),c.JRh(pe)}}function Ae(q,me){if(1&q&&(c.j41(0,"div")(1,"div",13)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"mat-radio-group",15),c.DNE(5,D,3,4,"mat-radio-button",20),c.k0s()()),2&q){const pe=c.XpG().$implicit;c.R7$(3),c.JRh(pe.title),c.R7$(2),c.Y8G("ngForOf",pe.contents)}}function H(q,me){if(1&q){const pe=c.RV6();c.j41(0,"div")(1,"div",10)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"div",22)(5,"mat-form-field",23)(6,"mat-select",24),c.mxI("valueChange",function(ie){c.eBV(pe);const Oe=c.XpG().$implicit;return c.DH7(Oe.contents[0],ie)||(Oe.contents[0]=ie),c.Njj(ie)}),c.j41(7,"mat-option",25),c.EFF(8),c.k0s()()()()()}if(2&q){const pe=c.XpG().$implicit;c.R7$(3),c.JRh(pe.title),c.R7$(3),c.R50("value",pe.contents[0]),c.Y8G("disabled",!0),c.R7$(),c.FS9("value",pe.contents[0]),c.R7$(),c.JRh(pe.contents[0])}}function N(q,me){if(1&q&&(c.qex(0,8),c.DNE(1,P,5,3,"div",9)(2,U,6,2,"div",9)(3,Ae,6,2,"div",9)(4,H,9,5,"div",9),c.bVm()),2&q){const pe=me.$implicit;c.R7$(),c.Y8G("ngIf",0==pe.type),c.R7$(),c.Y8G("ngIf",1==pe.type),c.R7$(),c.Y8G("ngIf",2==pe.type),c.R7$(),c.Y8G("ngIf",3==pe.type)}}let w=(()=>{var q;class me extends d._{constructor(ce,ie){super(ie,ce),this.dialogRef=ce,this.data=ie}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return(q=me).\u0275fac=function(ce){return new(ce||q)(c.rXU(l.CP,8),c.rXU(l.Vh))},q.\u0275cmp=c.VBU({type:q,selectors:[["app-result-info-dialog"]],features:[c.Vt3],decls:12,vars:7,consts:[[1,"box","result-info-dialog"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"valueChange","value","disabled"],[2,"color","#1e293c",3,"value"]],template:function(ce,ie){1&ce&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s()(),c.DNE(7,N,5,4,"ng-container",5),c.k0s()(),c.j41(8,"div",6)(9,"button",7),c.bIt("click",function(){return ie.btnCloseDialog()}),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()),2&ce&&(c.R7$(5),c.SpI(" ",c.bMT(6,3,"lang_testbank_test_config_verify_profile_student")," "),c.R7$(2),c.Y8G("ngForOf",ie.data),c.R7$(3),c.SpI(" ",c.bMT(11,5,"lang_auto_dong")," "))},dependencies:[m.Sq,m.bT,x.wT,C.rl,Y.VT,Y._g,y.VO,ae.oV,V.wp],encapsulation:2}),me})()},43726:(gt,ke,v)=>{v.d(ke,{U:()=>J});var l=v(59640),d=v(53043),c=v(57332),m=v(73014),x=v(89163),C=v(33887),Y=v(43234),y=v(48891),ae=v(36484),V=v(74225),P=v(94315),R=v(62095),U=v(51113),D=v(99927),Ae=v(40949);const N=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let w=(()=>{var ue;class fe{constructor(S,F,B,Ie){this.commonService=S,this.zipDataService=F,this.sAztAnswerTypeService=B,this.cdnService=Ie,this.totalPointExam=0}drawAzotaFileToCanvas(S,F,B,Ie){return new Promise((xe,Ze)=>{var Me="",rt=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(S.images??""));rt&&rt.url&&rt.url.includes(".azt")?this.httpGetAsync(this.cdnService.getMyCdn(rt.url)).then(st=>{st&&st.length>0?V.decodeScanOfflineFile(st).then(se=>{let Ye=this._arrayBufferToBase64(se.getWrappedImage()??new Uint8Array),$e=se.getWrappedImageExtension(),E=se.scanOfflineData?.scanResult;if(Ye){let W=new Image;W.src="data:image/"+$e+";base64,"+Ye,W.crossOrigin="anonymous",W.onload=()=>{var $=document.createElement("canvas");$.width=W.width,$.height=W.height;const K=$.getContext("2d");K?.drawImage(W,0,0,$.width,$.height);let ge=S.resultsData?.answerObjs??[];if(E?.examCodeRegion?.circles&&E?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.examCodeRegion?.circles,K),E?.studentCodeRegion?.circles&&E?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.studentCodeRegion?.circles,K),E?.answerRegion?.circles&&E?.answerRegion?.circles.length>0&&this.drawCircles(E?.answerRegion?.circles,K,ge,1,B?.filter(he=>this.sAztAnswerTypeService.isOneChoiceAnswer(he))),E?.answerRegion?.trueFalseCircles&&E?.answerRegion?.trueFalseCircles.length>0&&this.drawCircles(E?.answerRegion?.trueFalseCircles,K,ge,5,B?.filter(he=>this.sAztAnswerTypeService.isTrueFalseAnswer(he))),E?.answerRegion?.fillBlankCircles&&E?.answerRegion?.fillBlankCircles.length>0&&this.drawCircles(E?.answerRegion?.fillBlankCircles,K,ge,4,B?.filter(he=>this.sAztAnswerTypeService.isFillAnswer(he))),E?.answerRegion?.essayCircles&&E?.answerRegion?.essayCircles.length>0&&F&&this.drawCommonCircles(E?.answerRegion?.essayCircles,K),E?.answerRegion?.handwrittenAnswers&&E?.answerRegion?.handwrittenAnswers.length>0){let he=E?.answerRegion?.handwrittenAnswers,ee="18px";if(K){K.fillStyle="#00ff00",K.font=ee+" Comic Sans MS",K.textAlign="center";for(let Pe=0;Pe<he.length;Pe++){let Ee=he[Pe];this.fillTextAnswerDrawForFileAzt(Ee.recognizedText??"",K,ge[Pe],((Ee.bottomRight.x??0)+(Ee.topLeft.x??0))/2-3,((Ee.bottomRight.y??0)+(Ee.topLeft.y??0))/2+5)}}}K&&K.fillText((this.commonService.myTranslateInstant("lang_auto_tong")??"T\u1ed5ng")+" = "+this.totalPointExam.toFixed(2),25,125),Me=$.toDataURL("image/jpeg",.9),xe({imgUrl:Me,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}}else xe({imgUrl:Me,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}):xe({imgUrl:Me,studentCode:0,subExamCode:0})}).catch(st=>{Ze(st)}):xe({imgUrl:Me,studentCode:0,subExamCode:0})})}drawScanFileToCanvas(S){return new Promise(F=>{var B="",Ie=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(S.images??""));let xe=Ie?this.cdnService.getMyCdn(Ie.url):"";if(Ie&&xe){let Ze=new Image;Ze.src=xe,Ze.crossOrigin="anonymous",Ze.onload=()=>{var Me=document.createElement("canvas");Me.width=Ze.width,Me.height=Ze.height;const rt=Me.getContext("2d");rt?.drawImage(Ze,0,0,Me.width,Me.height);var st=S.resultsData?.answerObjs??[],se=this.commonService.willDeleteParseJson(S.resultsData?.pos??"");if("2.0"==se.version)try{let Ut=Uint8Array.from(atob(se.resultFilledPos),In=>In.charCodeAt(0)),xt=new P.eX(Ut).parseDrawData(),mn=xt.studentId?.answers??[];for(var Ye=0;Ye<mn.length;Ye++)this.tickStudentIdAndExamId(mn[Ye],rt,xt.answerTable?.radius??0);let Kt=xt.examId?.answers??[];for(Ye=0;Ye<Kt.length;Ye++)this.tickStudentIdAndExamId(Kt[Ye],rt,xt.answerTable?.radius??0);let an=xt.answerTable?.answers??[];for(Ye=0;Ye<an.length;Ye++)this.answerPaintedRightOrWrong(an[Ye],rt,xt.answerTable?.radius??0,st);B=Me.toDataURL("image/jpeg",.9),F(B)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),F("")}else if("3.0"==se.version)try{let Ut=se.answersHandwritten??[],xt=(Ut[0].answerRegion.height??0)-20+"px";if(rt){rt.fillStyle="#00ff00",rt.font=xt+" Comic Sans MS",rt.textAlign="center";for(let Kt=0;Kt<Ut.length;Kt++){let an=Ut[Kt],Bt=this.getTextAnswerDraw(N[-1==an.answer?26:an.answer],rt,st[Kt]);rt.fillText(Bt,(an.answerRegion.x??0)+(an.answerRegion.width??0)/2,(an.answerRegion.y??0)+(an.answerRegion.height??0)/2+5)}}B=Me.toDataURL("image/jpeg",.9),F(B)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),F("")}else{var $e=se.configurationPos.split("_"),E=se.resultFilledPos.split("_"),W=se.tableAnchorPos.split("_"),$=this.checkWrongOrTrueAnswer(st),K=0;for(Ye=0;Ye<$e.length;Ye++)if(1==Ye||2==Ye){var ge=$e[Ye].split("*");K+=parseInt(ge[1],10)}var he=0;for(Ye=0;Ye<W.length;Ye++)if(Ye>=2){var ee={},Re={},Pe=W[Ye].split("*"),Ee=Pe[0].split(":"),Ue=Pe[1].split(":"),We={},Xe=$e[Ye].split("*");We.row=parseInt(Xe[0],10),We.col=parseInt(Xe[1],10),We.radius=parseInt(Xe[2],10),ee.x=parseInt(Ee[0],10),ee.y=parseInt(Ee[1],10),Re.x=parseInt(Ue[0],10),Re.y=parseInt(Ue[1],10);for(var M=(Re.y-ee.y)/(We.row+1),je=ee.y,tt=0;tt<We.row;tt++)if((je+=M)>ee.y&&je<Re.y){var lt=he<st.length?this.checkAnswerStudentRight(he,st):0;he++,0!=lt&&rt&&(rt.beginPath(),rt.arc(ee.x+M*lt,je,We.radius,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle="#f3c12c",rt.stroke())}}var ut=0;for(tt=0;tt<E.length;tt++)if("empty"!=E[tt]){var it=E[tt].split(":"),ht={x:parseInt(it[0],10),y:parseInt(it[1],10),line:parseInt(it[2],10)};tt<K+$.length&&(tt>=K?(rt&&(rt.beginPath(),rt.arc(ht.x,ht.y,ht.line,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle=$[ut],rt.stroke()),ut++):rt&&(rt.beginPath(),rt.arc(ht.x,ht.y,ht.line,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle="#00ff00",rt.stroke()))}B=Me.toDataURL("image/jpeg",.9),F(B)}}}else F("")})}_arrayBufferToBase64(S){for(var F="",B=new Uint8Array(S),Ie=B.byteLength,xe=0;xe<Ie;xe++)F+=String.fromCharCode(B[xe]);return window.btoa(F)}httpGetAsync(S){return new Promise((F,B)=>{try{const Ie=new XMLHttpRequest;Ie.open("GET",S,!0),Ie.responseType="arraybuffer",Ie.onload=xe=>{if(200===Ie.status||304===Ie.status){const Ze=Ie.response;if(Ze){const Me=new Uint8Array(Ze);F(Me)}else F(new Uint8Array)}else F(new Uint8Array)},Ie.onerror=xe=>{B(new Error("lang_core_cant_loading_url"))},Ie.send(null)}catch(Ie){B(Ie)}})}fillTextAnswerDrawForFileAzt(S,F,B,Ie,xe){let Ze="";B&&(S?B.rightAnswer&&"ESSAY"!=B.content&&B.rightAnswer!=S?(F.fillStyle="#f3c12c",F.fillText("["+B.rightAnswer+"]",Ie+15,xe),F.fillStyle="red",Ze=S+"-",Ie-=10):B.rightAnswer&&"ESSAY"!=B.content?(F.fillStyle="#00ff00",Ze+=S):(F.fillStyle="red",Ze+=S):(F.fillStyle="#f3c12c",Ze+=B.rightAnswer)),F.fillText(Ze,Ie,xe)}drawCommonCircles(S,F){S.length>0&&S.forEach(B=>{if(B.filled){let Ie=B.center.x,xe=B.center.y;F&&(F.beginPath(),F.arc(Ie,xe,B.radius+1,0,2*Math.PI,!1),F.lineWidth=2,F.strokeStyle="#00ff00",F.stroke())}})}drawCircles(S,F,B,Ie,xe){let Ze=[],Me=[],rt=["A","B","C","D"],st=0;if(B.length>0){let E=B.filter(K=>1==K.answerType||2==K.answerType).length??0,W=B.filter(K=>5==K.answerType).length??0,$=B.filter(K=>4==K.answerType).length??0;st=1==Ie?E:4==Ie?$:W;for(let K=0;K<B.length;K++){let ge="";if(this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:B[K].answerType})){let he=B[K].rightAnswer?.split("|")??[];for(let ee=0;ee<rt.length;ee++)ge=K+1-E+""+rt[ee]+"F",he.includes(rt[ee])&&(ge=K+1-E+""+rt[ee]+"T"),this.commonService.isExistInArray(Ze,ge)||Ze.push(ge)}else this.sAztAnswerTypeService.isFillAnswer({answerType:B[K].answerType})?(ge=K+1-E-W+"_"+B[K].rightAnswer,this.commonService.isExistInArray(Ze,ge)||Ze.push(ge)):this.sAztAnswerTypeService.isOneChoiceAnswer({answerType:B[K].answerType})&&(ge=K+1+""+B[K].rightAnswer,this.commonService.isExistInArray(Ze,ge)||Ze.push(ge));this.sAztAnswerTypeService.isEssayAnswer({answerType:B[K].answerType})&&Me.push(K+1)}}let $e=1==Ie?1:5==Ie?2:4==Ie?3:1;if(F){F.fillStyle="#ff0024",F.font="25px Comic Sans MS";let E=0,W=0,$=0,K="P"+$e+": ",ge=!1;(xe??[]).forEach(he=>{let ee=B.find(Re=>he.id==Re.questionId);if((this.sAztAnswerTypeService.isOneChoiceAnswer(he)||this.sAztAnswerTypeService.isFillAnswer(he))&&(E++,ee?.isRight&&(W+=he.testedScore??0,$++)),this.sAztAnswerTypeService.isTrueFalseAnswer(he)){W+=he.testedScore??0;let Re=0,Pe="";for(let Ee=0;Ee<4;Ee++)ee?.rightAnswers?.includes(N[Ee])?Pe+="T":Pe+="F";if(ee?.content)for(let Ee=0;Ee<4;Ee++)ee.content[Ee]==Pe[Ee]&&Re++;ge=!0,K+=" "+Re+"/4;"}}),this.totalPointExam+=W,K+=ge?" = "+W.toFixed(2):$+"/"+E+" = "+W.toFixed(2),F.fillText(K,25,25+25*$e)}S.forEach(E=>{let W=0;W=this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:Ie})?Number(E.label.substring(0,E.label.length-2)):this.sAztAnswerTypeService.isFillAnswer({answerType:Ie})?Number(E.label.substring(0,E.label.indexOf("_"))):Number(E.label.substring(0,E.label.length-1));let $="";if(0==Ze.length)$="#00ff00";else if(this.sAztAnswerTypeService.isFillAnswer({answerType:Ie})){let K=E.label.substring(0,E.label.indexOf("_")+1),ge=Ze.find(he=>he.includes(K));if(ge){let he=ge?.split("_"),ee=E.label.split("_");if(E.filled&&($="red"),he[0]==ee[0])if("-"==ee[2]&&he[1].includes("-"))0==Number(ee[1])&&($=E.filled?"#00ff00":"#f3c12c");else if(","==ee[2]&&he[1].includes(",")){let Re=he[1].indexOf(",");Number(ee[1])==Re&&($=E.filled?"#00ff00":"#f3c12c")}else"-"!=ee[2]&&","!=ee[2]&&he[1][Number(ee[1])]==ee[2]&&($=E.filled?"#00ff00":"#f3c12c")}}else this.commonService.isExistInArray(Ze,E.label)?$=E.filled?"#00ff00":"#f3c12c":E.filled&&($="red");if($&&W<=st&&!this.commonService.isExistInArray(Me,W)){let K=E.center.x,ge=E.center.y;F&&(F.beginPath(),F.arc(K,ge,E.radius+1,0,2*Math.PI,!1),F.lineWidth=2,F.strokeStyle=$,F.stroke())}})}checkAnswerStudentRight(S,F){var B=0;return F[S]&&""!=F[S].rightAnswer&&0==F[S].isRight&&(B="A"==F[S].rightAnswer?1:"B"==F[S].rightAnswer?2:"C"==F[S].rightAnswer?3:"D"==F[S].rightAnswer?4:"E"==F[S].rightAnswer?5:"F"==F[S].rightAnswer?6:"G"==F[S].rightAnswer?7:"H"==F[S].rightAnswer?8:0),B}checkWrongOrTrueAnswer(S){for(var F=[],B=0;B<S.length;B++)""!=S[B].content&&(1==S[B].isRight?F.push("#00ff00"):0==S[B].isRight&&F.push("red"));return F}tickStudentIdAndExamId(S,F,B){var Ie=256*Math.floor((S.position??0)/16)+S.x,xe=(S.position??0)%16*256+S.y;(S.filledCols??0)>=128&&F&&(F.beginPath(),F.arc(Ie,xe,B,0,2*Math.PI,!1),F.lineWidth=3,F.strokeStyle="#00ff00",F.stroke())}answerPaintedRightOrWrong(S,F,B,Ie){var xe=256*Math.floor((S.position??0)/16)+S.x,Ze=(S.position??0)%16*256+S.y,Me=S.rows??0,st="#fff0";Ie.length>Me&&((S.filledCols??0)>=128?st=1==Ie[Me].isRight?"#00ff00":"red":(S.filledCols??0)%128+1==this.checkAnswerStudentRight(Me,Ie)&&(st="#f3c12c"),F&&(F.beginPath(),F.arc(xe,Ze,B,0,2*Math.PI,!1),F.lineWidth=3,F.strokeStyle=st,F.stroke()))}getTextAnswerDraw(S,F,B){let Ie="";return B&&(S?B.isRight?(F.fillStyle="#00ff00",Ie+=S):(F.fillStyle="red",Ie=S+" - ["+B.rightAnswer+"]"):(F.fillStyle="#f3c12c",Ie+=B.rightAnswer)),Ie}}return(ue=fe).\u0275fac=function(S){return new(S||ue)(y.KVO(R.R),y.KVO(U.j),y.KVO(D._),y.KVO(Ae.B))},ue.\u0275prov=y.jDH({token:ue,factory:ue.\u0275fac,providedIn:"root"}),fe})();var q=v(54460),me=v(52811),pe=v(15343),ce=v(76975);const ie=()=>({"flex-none mr-1":!0});function Oe(ue,fe){1&ue&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ue&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function Ce(ue,fe){1&ue&&(y.j41(0,"span",17),y.nrm(1,"azt-loading-ui"),y.k0s())}function Ke(ue,fe){if(1&ue){const G=y.RV6();y.j41(0,"img",18),y.bIt("click",function(F){y.eBV(G);const B=y.XpG(2);return y.Njj(B.clickOnImage(F))}),y.k0s()}if(2&ue){const G=y.XpG(2);y.Aen(G.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",G.fileScanUrl,y.B4B)}}function Te(ue,fe){if(1&ue&&(y.j41(0,"div",14,1),y.DNE(2,Ce,2,0,"span",15)(3,Ke,1,3,"img",16),y.k0s()),2&ue){const G=y.XpG();y.R7$(2),y.Y8G("ngIf",G.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!G.loadingScanUrl)}}function at(ue,fe){1&ue&&(y.j41(0,"span",19),y.nrm(1,"azt-loading-ui"),y.k0s())}let Be=(()=>{var ue;class fe extends C._{confirmEdit(){this.initStatusObj(),this.processor.uploadToServer().then(S=>{if(!S.success){let F=S.errorMessage;return"azt_lang_core_code_exam"==F&&(F=this.commonService.myTranslateInstant("lang_core_offline_exam_not_found_offline_mix_question_hash_id")??"M\xe3 \u0111\u1ec1 thi kh\xf4ng t\u1ed3n t\u1ea1i"),this.errorStatusObj(F??"lang_core_invalid_data",!0)}this.successStatusObj("lang_auto_luu_thanh_cong",!0),this.dialogRef.close(!0)})}btnCloseDialog(){this.dialogRef.close(!1)}loadScriptHandleImage(){var S=this;this.commonService.loadAnswerSheetJs().then(()=>{var F=this.userService.getUserObj();window.azotaScanAnswerSheet.examResultProcessor(F.rememberToken,"https://"+Y.c.base_embed_link,this.data.resultId,F.id).then(function(){var B=(0,m.A)(function*(Ie){S.processor=Ie,S.initData()});return function(Ie){return B.apply(this,arguments)}}())}).catch(F=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}clickOnImage(S){const F=S.target,B=F.getBoundingClientRect();this.processData.clickToImage(F.naturalWidth/B.width*(S.clientX-B.left),F.naturalHeight/B.height*(S.clientY-B.top)),this.processDrawImage()}drawCircleImg(S,F){S&&S.length>0&&(this.circleRadius=S[0].radius,S.forEach(B=>{if(B.filled&&F){let Ie=B.center.x,xe=B.center.y;F.beginPath(),F.arc(Ie,xe,B.radius+1,0,2*Math.PI,!1),F.lineWidth=3,F.strokeStyle="red",F.stroke()}}))}processDrawImage(){let S=this.drawScanExamService._arrayBufferToBase64(this.processData.getWrappedImage()??new Uint8Array),F=this.processData.getWrappedImageExtension(),B=this.processData.getFilledCircles();if(this.imgSize=this.processor.getImageSize(),!S)return this.loadingScanUrl=!1,void(this.fileScanUrl="");let Ie=new Image;Ie.src="data:image/"+F+";base64,"+S,Ie.crossOrigin="anonymous";var xe=document.createElement("canvas");xe.width=this.imgSize.width,xe.height=this.imgSize.height;const Ze=xe.getContext("2d");Ie.onload=()=>{Ze?.drawImage(Ie,0,0,xe.width,xe.height),this.drawCircleImg(B,Ze),this.fileScanUrl=xe.toDataURL("image/jpeg",.9),this.loadingScanUrl=!1}}initData(){this.data.resultId&&(this.loadingScanUrl=!0,this.processData=this.processor.getData(),this.processDrawImage())}ngOnInit(){super.ngOnInit(),this.loadScriptHandleImage()}constructor(S,F,B,Ie){super(Ie,B),this.userService=S,this.drawScanExamService=F,this.dialogRef=B,this.loadingScanUrl=!0,this.fileScanUrl="",this.circleRadius=0,this.imgSize={width:0,height:0}}}return(ue=fe).\u0275fac=function(S){return new(S||ue)(y.rXU(ae.R),y.rXU(w),y.rXU(x.CP,8),y.rXU(x.Vh,8))},ue.\u0275cmp=y.VBU({type:ue,selectors:[["app-edit-scan-file-dialog"]],features:[y.Vt3],decls:20,vars:12,consts:[["showImgScan",""],["imageHolding",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md","font-semibold","flex","text-slate-500","items-center"],["name","info","size","16",3,"ngClass"],[2,"vertical-align","midle"],[1,"text-center","mx-auto","mt-1",2,"height","calc(100vh - 200px)","overflow-y","auto"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-32","btn-primary","items-center",3,"click","disabled"],["class","inline-block mr-2",4,"ngIf"],["id","image-holding"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["id","img-container","alt","img",3,"src","style","click",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["id","img-container","alt","img",3,"click","src"],[1,"inline-block","mr-2"]],template:function(S,F){if(1&S){const B=y.RV6();y.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3",5),y.nrm(4,"lucide-icon",6),y.j41(5,"span",7),y.EFF(6,"Click \u1ea3nh \u0111\u1ec3 \u0111\xe1nh d\u1ea5u v\u1ecb tr\xed c\u1ea7n s\u1eeda"),y.k0s()(),y.j41(7,"div",8),y.DNE(8,Oe,4,3,"ng-container",9)(9,Te,4,2,"ng-template",null,0,y.C5r),y.k0s()()(),y.j41(11,"div",10)(12,"button",11),y.bIt("click",function(){return y.eBV(B),y.Njj(F.btnCloseDialog())}),y.EFF(13),y.nI1(14,"mytranslate"),y.k0s(),y.j41(15,"button",12),y.bIt("click",function(){return y.eBV(B),y.Njj(F.confirmEdit())}),y.DNE(16,at,2,0,"span",13),y.j41(17,"span",7),y.EFF(18),y.nI1(19,"mytranslate"),y.k0s()()()()}if(2&S){const B=y.sdS(10);y.R7$(4),y.Y8G("ngClass",y.lJ4(11,ie)),y.R7$(4),y.Y8G("ngIf",!F.loadingScanUrl&&!F.fileScanUrl)("ngIfElse",B),y.R7$(5),y.SpI(" ",y.bMT(14,7,"lang_cms_common_close_btn")," "),y.R7$(2),y.Y8G("disabled",F.statusObj.loading),y.R7$(),y.Y8G("ngIf",F.statusObj.loading),y.R7$(2),y.JRh(y.bMT(19,9,"lang_auto_luu"))}},dependencies:[q.YU,q.bT,me.R,pe.WGl,ce.wp],encapsulation:2}),fe})();var oe=v(46899),Le=v(47712);const L=()=>({"text-slate-800":!0}),te=()=>({"text-danger":!0}),Ge=ue=>({"text-success":ue});function be(ue,fe){if(1&ue){const G=y.RV6();y.j41(0,"div",20)(1,"a",21),y.nI1(2,"mytranslate"),y.bIt("click",function(){let F;y.eBV(G);const B=y.XpG(2);return y.Njj(B.deleteOfflineExamResultObj(null!==(F=null==B.examObj?null:B.examObj.hashId)&&void 0!==F?F:"",B.examResultIdParam))}),y.nrm(3,"lucide-icon",22),y.k0s()()}2&ue&&(y.R7$(),y.Y8G("matTooltip",y.bMT(2,2,"lang_auto_xoa")),y.R7$(2),y.Y8G("ngClass",y.lJ4(4,te)))}function Q(ue,fe){1&ue&&(y.j41(0,"span",23),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ue&&(y.R7$(),y.SpI("",y.bMT(2,1,"lang_auto_anh_cham"),": "))}function ye(ue,fe){1&ue&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ue&&(y.R7$(),y.JRh(y.bMT(2,1,"lang_auto_luu_trong_app_mobile")))}function ct(ue,fe){1&ue&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ue&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function Dt(ue,fe){1&ue&&(y.j41(0,"span",29),y.nrm(1,"azt-loading-ui"),y.k0s())}function nt(ue,fe){if(1&ue&&y.nrm(0,"img",30),2&ue){const G=y.XpG(4);y.Aen(G.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",G.fileScanUrl,y.B4B)}}function Et(ue,fe){if(1&ue){const G=y.RV6();y.j41(0,"a",26),y.bIt("click",function(){y.eBV(G);const F=y.XpG(3);return y.Njj(F.onShowFile(F.fileScanUrl))}),y.DNE(1,Dt,2,0,"span",27)(2,nt,1,3,"img",28),y.k0s()}if(2&ue){const G=y.XpG(3);y.R7$(),y.Y8G("ngIf",G.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!G.loadingScanUrl)}}function Qe(ue,fe){if(1&ue&&(y.j41(0,"div",24),y.DNE(1,ct,4,3,"ng-container",25)(2,Et,3,2,"ng-template",null,2,y.C5r),y.k0s()),2&ue){const G=y.sdS(3),S=y.XpG(2);y.R7$(),y.Y8G("ngIf",!S.loadingScanUrl&&!S.fileScanUrl)("ngIfElse",G)}}function ft(ue,fe){if(1&ue){const G=y.RV6();y.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"h3",7)(4,"span"),y.EFF(5),y.nI1(6,"mytranslate"),y.k0s()(),y.j41(7,"div",8)(8,"a",9),y.nI1(9,"mytranslate"),y.bIt("click",function(){let F;y.eBV(G);const B=y.XpG();return y.Njj(B.openEditScanFile(null!==(F=null==B.examObj?null:B.examObj.hashId)&&void 0!==F?F:"",B.examResultIdParam))}),y.nrm(10,"lucide-icon",10),y.k0s()(),y.DNE(11,be,4,5,"div",11),y.k0s()(),y.j41(12,"div",12)(13,"div",6)(14,"span",13),y.eu8(15,14),y.k0s(),y.j41(16,"span",15),y.nI1(17,"mytranslate"),y.eu8(18,14),y.k0s()(),y.j41(19,"div",16),y.DNE(20,Q,3,3,"span",17)(21,ye,3,3,"span",18),y.k0s(),y.DNE(22,Qe,4,2,"div",19),y.k0s()()}if(2&ue){const G=y.XpG(),S=y.sdS(2),F=y.sdS(4);y.R7$(5),y.SpI(" ",y.bMT(6,10,"lang_auto_thi_offline")," "),y.R7$(3),y.Y8G("matTooltip",y.bMT(9,12,"lang_auto_sua")),y.R7$(2),y.Y8G("ngClass",y.lJ4(16,L)),y.R7$(),y.Y8G("ngIf",G.isDeletableExamResultObj),y.R7$(4),y.Y8G("ngTemplateOutlet",S),y.R7$(),y.FS9("matTooltip",y.bMT(17,14,"lang_auto_so_bao_danh")),y.R7$(2),y.Y8G("ngTemplateOutlet",F),y.R7$(2),y.Y8G("ngIf",!G.isMobileWebView),y.R7$(),y.Y8G("ngIf",!G.checkHttpLinkImg),y.R7$(),y.Y8G("ngIf",G.checkHttpLinkImg)}}function He(ue,fe){if(1&ue&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatOfflineExamHashIdToNumber"),y.k0s()),2&ue){let G;const S=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_auto_ma_de_thi"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,Ge,!(null!=S.offlineMarkObj&&S.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),y.R7$(),y.JRh(y.i5U(4,5,null!==(G=null==S.offlineMixQuestionObj?null:S.offlineMixQuestionObj.hashId)&&void 0!==G?G:0,3))}}function ze(ue,fe){if(1&ue&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatStudentCodeToNumber"),y.k0s()),2&ue){let G;const S=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,Ge,!(null!=S.offlineMarkObj&&S.offlineMarkObj.isErrorForStudentCode))),y.R7$(),y.JRh(y.i5U(4,5,(null!==(G=null==S.offlineMarkObj?null:S.offlineMarkObj.studentCode)&&void 0!==G?G:0)<0?0:null==S.offlineMarkObj?null:S.offlineMarkObj.studentCode,6))}}let J=(()=>{var ue;class fe extends l.H{checkAzotaFile(S){return!(!S||!S.includes(".azt"))}checkHttpUrl(S){return!(!S||!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(S))}openEditScanFile(S,F){F&&this.sAztDialogService.open(Be,{data:{examHashId:S,resultId:F,userId:Number(this.userIdParam)},width:"750px",restoreFocus:!1}).afterClosed().subscribe(Ie=>{Ie&&window.location.reload()})}deleteOfflineExamResultObj(S,F){F&&this.sAztDialogService.open(c.V,{data:{examHashId:S,examResultIds:[F],examResults:[]},restoreFocus:!1}).afterClosed().subscribe(Ie=>{Ie&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(S){this.sAztDialogService.open(d.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:S,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let S=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),F=this.castJsonToObj(S);this.checkHttpLinkImg=this.checkHttpUrl(F?.url),this.loadingScanUrl=!0,this.checkAzotaFile(F?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam,this.questionObjs,this.essayMark).then(B=>{B.imgUrl?this.fileScanUrl=B.imgUrl:this.checkHttpLinkImg=!0,this.drawScanExamService.totalPointExam=0,this.loadingScanUrl=!1}).catch(B=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(B=>{B?this.fileScanUrl=B:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(B=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(S,F,B){super(),this.sAztDialogService=S,this.zipDataService=F,this.drawScanExamService=B,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return(ue=fe).\u0275fac=function(S){return new(S||ue)(y.rXU(oe.i),y.rXU(U.j),y.rXU(w))},ue.\u0275cmp=y.VBU({type:ue,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj",questionObjs:"questionObjs",essayMark:"essayMark"},features:[y.Vt3,y.OA$],decls:5,vars:1,consts:[["viewExamCodeTpl",""],["viewStudentCodeTpl",""],["showImgScan",""],["class","info-exam-offline mt-3 mb-3",4,"ngIf"],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],[1,"mx-1","items-center"],[1,"text-slate-800",3,"click","matTooltip"],["name","file-pen-line","size","18",3,"ngClass"],["class","mx-1 items-center mr-0",4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],[4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],[1,"mx-1","items-center","mr-0"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click","matTooltip"],["name","trash-2","size","18",3,"ngClass"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["alt","img",3,"src"],[3,"ngClass"]],template:function(S,F){1&S&&y.DNE(0,ft,23,17,"div",3)(1,He,5,10,"ng-template",null,0,y.C5r)(3,ze,5,10,"ng-template",null,1,y.C5r),2&S&&y.Y8G("ngIf",F.offlineMarkObj)},dependencies:[q.YU,q.bT,q.T3,Le.oV,me.R,pe.WGl,ce.wp,ce.Po,ce.IX],encapsulation:2}),fe})()},1382:(gt,ke,v)=>{v.d(ke,{I:()=>C});var l=v(73014),d=v(48891),c=v(62095),m=v(40949),x=v(99927);let C=(()=>{var Y;class y{constructor(V,P,R){this.commonService=V,this.cdnService=P,this.answerTypeService=R}convertUrlToBase64(V){return(0,l.A)(function*(){const R=yield(yield fetch(V+"?t="+(new Date).getTime())).blob();return new Promise(U=>{const D=new FileReader;D.readAsDataURL(R),D.onloadend=()=>{U(D.result)}})})()}convertLinkToBase64(V,P,R){var U=this;return(0,l.A)(function*(){if(!P)return R;for(let Ae=0;Ae<(V?.length??0);Ae++)if(V?.[Ae].link===R)return V?.[Ae].convert;var D=yield U.convertUrlToBase64(R);return V?.push({convert:D,link:R}),D})()}replaceCanvasBackground(V,P){var R=this;return(0,l.A)(function*(){if(V){var U=[];for(let Le=0;Le<V.length;Le++){var D=V[Le];if(D&&0===D.isImage){var Ae=D.questionContentParse?.[0].content;D.questionContentParse&&(D.questionContentParse[0].content="");var H=void 0===Ae?[]:Ae.split("@[]");for(let L=0;L<H.length;L++){var N=H[L];if(!0===R.commonService.isJson(N)){var w=R.commonService.willDeleteParseJson(N);if(w.hasOwnProperty("link")){var q=document.body.offsetWidth,ce=1;w.data.width>(pe=q-30)&&(w.data={x:w.data.x*(ce=pe/w.data.width),y:w.data.y*ce,width:w.data.width*ce,height:w.data.height*ce}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},D.questionContentParse&&(D.questionContentParse[0].content+=`<div class="background_question_${Le}_${L}"><img width="${1024*ce}" height="${1024*ce}" src="${yield R.convertLinkToBase64(U,P,R.cdnService.getMyCdn(w.link))}"></div>`);var ie=document.createElement("style");document.body.appendChild(ie),ie.textContent+=`.background_question_${Le}_${L} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${Le}_${L} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else D.questionContentParse&&(D.questionContentParse[0].content+=N)}else D.questionContentParse&&(D.questionContentParse[0].content+=N)}if(R.answerTypeService.isOneChoiceAnswer(D))for(let L=0;L<(D.answerConfigParse?.length??0);L++){var Oe=D.answerConfigParse?.[L].content;D.answerConfigParse&&(D.answerConfigParse[L].content="");var Ce=void 0===Oe?[]:Oe.split("@[]");for(let te=0;te<Ce.length;te++){var Ke=Ce[te];if(!0===R.commonService.isJson(Ke)){var Te=R.commonService.willDeleteParseJson(Ke);Te.hasOwnProperty("link")?(q=document.body.offsetWidth,ce=1,Te.data.width>(pe=q-30)&&(Te.data={x:Te.data.x*(ce=pe/Te.data.width),y:Te.data.y*ce,width:Te.data.width*ce,height:Te.data.height*ce}),Te.data={x:Math.floor(Te.data.x),y:Math.floor(Te.data.y),width:Math.floor(Te.data.width),height:Math.floor(Te.data.height)},D.answerConfigParse&&(D.answerConfigParse[L].content+=`<div class="background_question__ans${Le}_${L}_${te}"><img width="${1024*ce}" height="${1024*ce}" src="${yield R.convertLinkToBase64(U,P,R.cdnService.getMyCdn(Te.link))}"></div>`),ie=document.createElement("style"),document.body.appendChild(ie),ie.textContent+=`.background_question__ans${Le}_${L}_${te} {margin: 0 3px; width: ${Te.data.width}px; height: ${Te.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${Le}_${L}_${te} img { margin-top: -${Te.data.y}px; margin-left: -${Te.data.x}px;}`):D.answerConfigParse&&(D.answerConfigParse[L].content+=Ke)}else D.answerConfigParse&&(D.answerConfigParse[L].content+=Ke)}}if(D.answerMediaParse&&D.answerMediaParse.length>0){var at=D.answerMediaParse;D.answerMediaParse="";var de=void 0===at?[]:at.split("@[]");for(let L=0;L<de.length;L++){var Be=de[L];if(!0===R.commonService.isJson(Be)){var pe,oe=R.commonService.willDeleteParseJson(Be);if(oe.hasOwnProperty("link"))q=document.body.offsetWidth,ce=1,oe.data.width>(pe=q-30)&&(oe.data={x:oe.data.x*(ce=pe/oe.data.width),y:oe.data.y*ce,width:oe.data.width*ce,height:oe.data.height*ce}),oe.data={x:Math.floor(oe.data.x),y:Math.floor(oe.data.y),width:Math.floor(oe.data.width),height:Math.floor(oe.data.height)},D.answerMediaParse+=`<div class="background_question__ans_result${Le}_${L}"><img width="${1024*ce}" height="${1024*ce}" src="${yield R.convertLinkToBase64(U,P,R.cdnService.getMyCdn(oe.link))}"></div>`,ie=document.createElement("style"),document.body.appendChild(ie),ie.textContent+=`.background_question__ans_result${Le}_${L} {margin: 0 3px; width: ${oe.data.width}px; height: ${oe.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${Le}_${L} img { margin-top: -${oe.data.y}px; margin-left: -${oe.data.x}px;}`;else D.answerMediaParse+=Be}else D.answerMediaParse+=Be}}}}}})()}replaceCanvasBackgroundTS(V,P){var R=this;return(0,l.A)(function*(){var U=[];for(let at=0;at<V.length;at++){var D=V[at];if(0===D.isImage){var Ae=D.questionContentParse[0].content;D.questionContentParse[0].content="";var H=void 0===Ae?[]:Ae.split("@[]");for(let de=0;de<H.length;de++){var N=H[de];if(!0===R.commonService.isJson(N)){var w=R.commonService.willDeleteParseJson(N);if(w.hasOwnProperty("link")){var q=document.body.offsetWidth,ce=1;w.data.width>(pe=q-30)&&(w.data={x:w.data.x*(ce=pe/w.data.width),y:w.data.y*ce,width:w.data.width*ce,height:w.data.height*ce}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},D.questionContentParse[0].content+=`<div class="background_question_${at}_${de}"><img width="${1024*ce}" height="${1024*ce}" src="${yield R.convertLinkToBase64(U,P,R.cdnService.getMyCdn(w.link))}"></div>`;var ie=document.createElement("style");document.body.appendChild(ie),ie.textContent+=`.background_question_${at}_${de} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${at}_${de} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else D.questionContentParse[0].content+=N}else D.questionContentParse[0].content+=N}if(R.answerTypeService.isOneChoiceAnswer(D)&&(0==D.isImage||1==D.isImage&&D.name.startsWith("[PDFv2]")?R.replaceBackgroundAnswerConfig(D.answerConfigParse,U,at,P):R.replaceBackgroundAnswerConfig(D.answerConfigParseVer1.answerConfigV2,U,at,P)),D.answerMedia&&D.answerMedia.length>0){var Oe=D.answerMedia;D.answerMedia="";var Ce=void 0===Oe?[]:Oe.split("@[]");for(let de=0;de<Ce.length;de++){var Ke=Ce[de];if(!0===R.commonService.isJson(Ke)){var pe,Te=R.commonService.willDeleteParseJson(Ke);if(Te.hasOwnProperty("link"))q=document.body.offsetWidth,ce=1,Te.data.width>(pe=q-30)&&(Te.data={x:Te.data.x*(ce=pe/Te.data.width),y:Te.data.y*ce,width:Te.data.width*ce,height:Te.data.height*ce}),Te.data={x:Math.floor(Te.data.x),y:Math.floor(Te.data.y),width:Math.floor(Te.data.width),height:Math.floor(Te.data.height)},D.answerMedia+=`<div class="background_question__ans_result${at}_${de}"><img width="${1024*ce}" height="${1024*ce}" src="${yield R.convertLinkToBase64(U,P,R.cdnService.getMyCdn(Te.link))}"></div>`,ie=document.createElement("style"),document.body.appendChild(ie),ie.textContent+=`.background_question__ans_result${at}_${de} {margin: 0 3px; width: ${Te.data.width}px; height: ${Te.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${at}_${de} img { margin-top: -${Te.data.y}px; margin-left: -${Te.data.x}px;}`;else D.answerMedia+=Ke}else D.answerMedia+=Ke}}}}return!0})()}replaceBackgroundAnswerConfig(V,P,R,U){var D=this;return(0,l.A)(function*(){for(let Oe=0;Oe<V.length;Oe++){var Ae=V[Oe].content;V[Oe].content="";var H=void 0===Ae?[]:Ae.split("@[]");for(let Ce=0;Ce<H.length;Ce++){var N=H[Ce];if(!0===D.commonService.isJson(N)){var w=D.commonService.willDeleteParseJson(N);if(w.hasOwnProperty("link")){var pe=document.body.offsetWidth-30,ce=1;w.data.width>pe&&(w.data={x:w.data.x*(ce=pe/w.data.width),y:w.data.y*ce,width:w.data.width*ce,height:w.data.height*ce}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},V[Oe].content+=`<div class="background_question__ans${R}_${Oe}_${Ce}"><img width="${1024*ce}" height="${1024*ce}" src="${yield D.convertLinkToBase64(P,U,D.cdnService.getMyCdn(w.link))}"></div>`;var ie=document.createElement("style");document.body.appendChild(ie),ie.textContent+=`.background_question__ans${R}_${Oe}_${Ce} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${R}_${Oe}_${Ce} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else V[Oe].content+=N}else V[Oe].content+=N}}})()}}return(Y=y).\u0275fac=function(V){return new(V||Y)(d.KVO(c.R),d.KVO(m.B),d.KVO(x._))},Y.\u0275prov=d.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),y})()},37642:(gt,ke,v)=>{v.d(ke,{E:()=>d});var l=v(48891);let d=(()=>{var c;class m{getDictionaryByGroupFieldTS(C,Y){for(var y={},ae=0;ae<C.length;ae++)C[ae].hasOwnProperty(Y)&&("number"==typeof C[ae][Y]||"string"==typeof C[ae][Y])&&(y.hasOwnProperty(C[ae][Y])||(y[C[ae][Y]]=[]),y[C[ae][Y]].push(C[ae]));return y}getDictionaryByFieldTS(C,Y){for(var y={},ae=0;ae<C.length;ae++)C[ae].hasOwnProperty(Y)&&("number"==typeof C[ae][Y]||"string"==typeof C[ae][Y])&&(y[C[ae][Y]]=C[ae]);return y}getDictionaryBy2FieldsTS(C,Y,y){for(var ae={},V=0;V<C.length;V++)C[V].hasOwnProperty(Y)&&("number"==typeof C[V][Y]||"string"==typeof C[V][Y])&&C[V].hasOwnProperty(y)&&("number"==typeof C[V][y]||"string"==typeof C[V][y])&&(ae[C[V][Y]+"_"+C[V][y]]=C[V]);return ae}getListValueByFieldNumberTS(C,Y){for(var y=[],ae=0;ae<C.length;ae++)C[ae].hasOwnProperty(Y)&&"number"==typeof C[ae][Y]&&y.push(C[ae][Y]);return y}getListValueByField(C,Y){for(var y=[],ae=0;ae<C.length;ae++)if(C[ae].hasOwnProperty(Y)){var V=y.filter(P=>P[Y]==C[ae][Y]);(!V||0==V.length)&&y.push(C[ae])}return y}}return(c=m).\u0275fac=function(C){return new(C||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),m})()},99172:(gt,ke,v)=>{v.d(ke,{p:()=>C});var l=v(73014),d=v(48891),c=v(62095),m=v(40949),x=v(53393);let C=(()=>{var Y;class y{processEssayResultToBase64(V){var P=this;return(0,l.A)(function*(){for(const R of V.pages??[]){if(R.draw){const U=yield P.exportPdfUtilsService.convertAndRetryToBase64(R.draw);R.draw=U}if(R.backgroundImage){const U=yield P.exportPdfUtilsService.convertAndRetryToBase64(R.backgroundImage);R.backgroundImage=U}}if(V.commentEmoji&&V.commentEmoji.length){let R="https://azota889.github.io/storage_public/mnote/",U=V.commentEmoji.length;for(let D=0;D<U;D++){let Ae=R+V.commentEmoji[D];const H=yield P.exportPdfUtilsService.convertAndRetryToBase64(Ae);V.commentEmoji[D]=H}}return V})()}convertAnswersArr(V,P){0!=V.length&&V.forEach(R=>{R.QuestionId&&R.AnswerContent&&R.AnswerContent[0]&&R.AnswerContent[0].Content&&(P[`id_${R.QuestionId}`]=R.AnswerContent[0].Content)})}findScaleDirection(V,P){return V/P>=.7070707070707071?"w":"h"}constructor(V,P,R){this.commonService=V,this.cdnService=P,this.exportPdfUtilsService=R}}return(Y=y).\u0275fac=function(V){return new(V||Y)(d.KVO(c.R),d.KVO(m.B),d.KVO(x.j))},Y.\u0275prov=d.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),y})()},53393:(gt,ke,v)=>{v.d(ke,{j:()=>Y});var l=v(73014),d=function(y){return y[y.Cdn=0]="Cdn",y[y.CdnTimestamp=1]="CdnTimestamp",y[y.Rawlink=2]="Rawlink",y[y.RawlinkTimestamp=3]="RawlinkTimestamp",y}(d||{}),c=v(48891),m=v(62095),x=v(40949),C=v(99927);let Y=(()=>{var y;class ae{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){const P=navigator.userAgent,U=(()=>{let Ae=null;const H=P.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(H[1]))return"IE "+((/\brv[ :]+(\d+)/g.exec(P)||[])[1]||"");if("Chrome"===H[1]){const w=P.match(/\b(OPR|Edge)\/(\d+)/);if(null!==w)return w.slice(1).join(" ").replace("OPR","Opera")}const N=H[2]?[H[1],H[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!==(Ae=P.match(/version\/(\d+)/i))&&N.splice(1,1,Ae[1]),N.join(" ")})().toString();return!(!["chrome"].includes(U.split(" ")[0].toLowerCase())||parseInt(U.split(" ")[1],10)<80)}getExtensionFile(P){if(!P)return"";const R=P.split(".");return R.length<=1?"":R[R.length-1].toLocaleLowerCase().split("_")[0]}findImageSrcInContent(P){let R="";if(P.includes("img")){const U=P.indexOf("img"),D=P.indexOf("src=",U),Ae=P.indexOf('"',Number(D)+5);R=P.substring(Number(D)+5,Number(Ae))}return R}asyncTimeout(P){return(0,l.A)(function*(){return`Waited ${yield new Promise(U=>{setTimeout(()=>U(P),P)})} milliseconds`})()}parseEssayMarkResult(P,R){let U=P.filter(H=>this.answerTypeService.isEssayAnswer(H));if(0!=U.length&&R&&R.essayResult){var D=this.commonService.willDeleteParseJson(R.essayResult);if(D){var Ae=Object.entries(D);for(let H=0;H<U.length;H++)U[H].essayMarkParsed=Ae[H][1]}}}convertToBase64(P,R){var U=this;return(0,l.A)(function*(){let D=P;switch(R){case d.Cdn:D=U.cdnService.getMyCdn(P);break;case d.CdnTimestamp:D=U.cdnService.getMyCdn(P)+"?t="+Date.now();break;case d.RawlinkTimestamp:D=P+"?t="+Date.now()}const H=yield(yield fetch(D)).blob(),N=yield new Promise(w=>{const q=new FileReader;q.readAsDataURL(H),q.onloadend=()=>{w(q.result)}});return N&&"string"==typeof N?N:P})()}convertAndRetryToBase64(P){var R=this;return(0,l.A)(function*(){let U=R.getExtensionFile(P);if(["pdf","jpg","jpeg","png","gif"].includes(U)){let D;const Ae=[d.Cdn,d.CdnTimestamp,d.Rawlink,d.RawlinkTimestamp];try{D=yield R.convertToBase64(P,Ae[0])}catch{try{D=yield R.convertToBase64(P,Ae[1])}catch{try{D=yield R.convertToBase64(P,Ae[2])}catch{try{D=yield R.convertToBase64(P,Ae[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+P),D=P}}}}return D}return P})()}eraseCanvas(P){P&&(P.beginPath(),P.rect(0,0,P.canvas.width,P.canvas.height),P.fillStyle="white",P.fill())}addContentToPdf(P,R){P.addImage(R,"JPEG",0,0,P.internal.pageSize.getWidth(),P.internal.pageSize.getHeight())}drawTextWrap(P,R,U,D,Ae){const H=P.split(" "),N=[];let w=H[0];if(R){R.font=Ae||`${D}px Arial`;for(let q=1;q<H.length;q++){const me=H[q];R.measureText(w+" "+me).width<U?w+=" "+me:(N.push(w),w=me)}N.push(w)}return N}essayText2LinesArr(P,R,U,D,Ae){const H=new RegExp("(<br>|<br/>)+","igm"),w=(this.replaceAllByRegExp(P,H,"<br>")??"").split("<br>"),q=[];for(let me=0;me<w.length;me++)q.push(this.drawTextWrap(w[me],R,U,D,Ae));return q}replaceAllByRegExp(P,R,U){return U?P?P.toString().replace(R,U):void 0:P}removeTagAssistiveMml(){const P=document.getElementsByTagName("mjx-assistive-mml");for(;P.length>0;)P[0].remove()}constructor(P,R,U){this.commonService=P,this.cdnService=R,this.answerTypeService=U}}return(y=ae).\u0275fac=function(P){return new(P||y)(c.KVO(m.R),c.KVO(x.B),c.KVO(C._))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),ae})()},38566:(gt,ke,v)=>{v.d(ke,{s:()=>Up});var V,P,l=v(73014),d=v(92757),c=v(18936),m=v(85980),x=v(64627),C=v(56094),Y=v(17791),y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ae={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function s(X,k,j){j||(j=0);var Z=Array(16);if("string"==typeof k)for(var re=0;16>re;++re)Z[re]=k.charCodeAt(j++)|k.charCodeAt(j++)<<8|k.charCodeAt(j++)<<16|k.charCodeAt(j++)<<24;else for(re=0;16>re;++re)Z[re]=k[j++]|k[j++]<<8|k[j++]<<16|k[j++]<<24;var _e=X.g[3],z=(k=X.g[0])+(_e^(j=X.g[1])&((re=X.g[2])^_e))+Z[0]+3614090360&4294967295;z=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=(j=(re=(_e=(k=j+(z<<7&4294967295|z>>>25))+((z=_e+(re^k&(j^re))+Z[1]+3905402710&4294967295)<<12&4294967295|z>>>20))+((z=re+(j^_e&(k^j))+Z[2]+606105819&4294967295)<<17&4294967295|z>>>15))+((z=j+(k^re&(_e^k))+Z[3]+3250441966&4294967295)<<22&4294967295|z>>>10))+((z=k+(_e^j&(re^_e))+Z[4]+4118548399&4294967295)<<7&4294967295|z>>>25))+((z=_e+(re^k&(j^re))+Z[5]+1200080426&4294967295)<<12&4294967295|z>>>20))+((z=re+(j^_e&(k^j))+Z[6]+2821735955&4294967295)<<17&4294967295|z>>>15))+((z=j+(k^re&(_e^k))+Z[7]+4249261313&4294967295)<<22&4294967295|z>>>10))+((z=k+(_e^j&(re^_e))+Z[8]+1770035416&4294967295)<<7&4294967295|z>>>25))+((z=_e+(re^k&(j^re))+Z[9]+2336552879&4294967295)<<12&4294967295|z>>>20))+((z=re+(j^_e&(k^j))+Z[10]+4294925233&4294967295)<<17&4294967295|z>>>15))+((z=j+(k^re&(_e^k))+Z[11]+2304563134&4294967295)<<22&4294967295|z>>>10))+((z=k+(_e^j&(re^_e))+Z[12]+1804603682&4294967295)<<7&4294967295|z>>>25))+((z=_e+(re^k&(j^re))+Z[13]+4254626195&4294967295)<<12&4294967295|z>>>20))+((z=re+(j^_e&(k^j))+Z[14]+2792965006&4294967295)<<17&4294967295|z>>>15))+((z=j+(k^re&(_e^k))+Z[15]+1236535329&4294967295)<<22&4294967295|z>>>10))+((z=k+(re^_e&(j^re))+Z[1]+4129170786&4294967295)<<5&4294967295|z>>>27))+((z=_e+(j^re&(k^j))+Z[6]+3225465664&4294967295)<<9&4294967295|z>>>23))+((z=re+(k^j&(_e^k))+Z[11]+643717713&4294967295)<<14&4294967295|z>>>18))+((z=j+(_e^k&(re^_e))+Z[0]+3921069994&4294967295)<<20&4294967295|z>>>12))+((z=k+(re^_e&(j^re))+Z[5]+3593408605&4294967295)<<5&4294967295|z>>>27))+((z=_e+(j^re&(k^j))+Z[10]+38016083&4294967295)<<9&4294967295|z>>>23))+((z=re+(k^j&(_e^k))+Z[15]+3634488961&4294967295)<<14&4294967295|z>>>18))+((z=j+(_e^k&(re^_e))+Z[4]+3889429448&4294967295)<<20&4294967295|z>>>12))+((z=k+(re^_e&(j^re))+Z[9]+568446438&4294967295)<<5&4294967295|z>>>27))+((z=_e+(j^re&(k^j))+Z[14]+3275163606&4294967295)<<9&4294967295|z>>>23))+((z=re+(k^j&(_e^k))+Z[3]+4107603335&4294967295)<<14&4294967295|z>>>18))+((z=j+(_e^k&(re^_e))+Z[8]+1163531501&4294967295)<<20&4294967295|z>>>12))+((z=k+(re^_e&(j^re))+Z[13]+2850285829&4294967295)<<5&4294967295|z>>>27))+((z=_e+(j^re&(k^j))+Z[2]+4243563512&4294967295)<<9&4294967295|z>>>23))+((z=re+(k^j&(_e^k))+Z[7]+1735328473&4294967295)<<14&4294967295|z>>>18))+((z=j+(_e^k&(re^_e))+Z[12]+2368359562&4294967295)<<20&4294967295|z>>>12))+((z=k+(j^re^_e)+Z[5]+4294588738&4294967295)<<4&4294967295|z>>>28))+((z=_e+(k^j^re)+Z[8]+2272392833&4294967295)<<11&4294967295|z>>>21))+((z=re+(_e^k^j)+Z[11]+1839030562&4294967295)<<16&4294967295|z>>>16))+((z=j+(re^_e^k)+Z[14]+4259657740&4294967295)<<23&4294967295|z>>>9))+((z=k+(j^re^_e)+Z[1]+2763975236&4294967295)<<4&4294967295|z>>>28))+((z=_e+(k^j^re)+Z[4]+1272893353&4294967295)<<11&4294967295|z>>>21))+((z=re+(_e^k^j)+Z[7]+4139469664&4294967295)<<16&4294967295|z>>>16))+((z=j+(re^_e^k)+Z[10]+3200236656&4294967295)<<23&4294967295|z>>>9))+((z=k+(j^re^_e)+Z[13]+681279174&4294967295)<<4&4294967295|z>>>28))+((z=_e+(k^j^re)+Z[0]+3936430074&4294967295)<<11&4294967295|z>>>21))+((z=re+(_e^k^j)+Z[3]+3572445317&4294967295)<<16&4294967295|z>>>16))+((z=j+(re^_e^k)+Z[6]+76029189&4294967295)<<23&4294967295|z>>>9))+((z=k+(j^re^_e)+Z[9]+3654602809&4294967295)<<4&4294967295|z>>>28))+((z=_e+(k^j^re)+Z[12]+3873151461&4294967295)<<11&4294967295|z>>>21))+((z=re+(_e^k^j)+Z[15]+530742520&4294967295)<<16&4294967295|z>>>16))+((z=j+(re^_e^k)+Z[2]+3299628645&4294967295)<<23&4294967295|z>>>9))+((z=k+(re^(j|~_e))+Z[0]+4096336452&4294967295)<<6&4294967295|z>>>26))+((z=_e+(j^(k|~re))+Z[7]+1126891415&4294967295)<<10&4294967295|z>>>22))+((z=re+(k^(_e|~j))+Z[14]+2878612391&4294967295)<<15&4294967295|z>>>17))+((z=j+(_e^(re|~k))+Z[5]+4237533241&4294967295)<<21&4294967295|z>>>11))+((z=k+(re^(j|~_e))+Z[12]+1700485571&4294967295)<<6&4294967295|z>>>26))+((z=_e+(j^(k|~re))+Z[3]+2399980690&4294967295)<<10&4294967295|z>>>22))+((z=re+(k^(_e|~j))+Z[10]+4293915773&4294967295)<<15&4294967295|z>>>17))+((z=j+(_e^(re|~k))+Z[1]+2240044497&4294967295)<<21&4294967295|z>>>11))+((z=k+(re^(j|~_e))+Z[8]+1873313359&4294967295)<<6&4294967295|z>>>26))+((z=_e+(j^(k|~re))+Z[15]+4264355552&4294967295)<<10&4294967295|z>>>22))+((z=re+(k^(_e|~j))+Z[6]+2734768916&4294967295)<<15&4294967295|z>>>17))+((z=j+(_e^(re|~k))+Z[13]+1309151649&4294967295)<<21&4294967295|z>>>11))+((_e=(k=j+((z=k+(re^(j|~_e))+Z[4]+4149444226&4294967295)<<6&4294967295|z>>>26))+((z=_e+(j^(k|~re))+Z[11]+3174756917&4294967295)<<10&4294967295|z>>>22))^((re=_e+((z=re+(k^(_e|~j))+Z[2]+718787259&4294967295)<<15&4294967295|z>>>17))|~k))+Z[9]+3951481745&4294967295,X.g[0]=X.g[0]+k&4294967295,X.g[1]=X.g[1]+(re+(z<<21&4294967295|z>>>11))&4294967295,X.g[2]=X.g[2]+re&4294967295,X.g[3]=X.g[3]+_e&4294967295}function o(X,k){this.h=k;for(var j=[],Z=!0,re=X.length-1;0<=re;re--){var _e=0|X[re];Z&&_e==k||(j[re]=_e,Z=!1)}this.g=j}(function e(X,k){function j(){}j.prototype=k.prototype,X.D=k.prototype,X.prototype=new j,X.prototype.constructor=X,X.C=function(Z,re,_e){for(var z=Array(arguments.length-2),Dn=2;Dn<arguments.length;Dn++)z[Dn-2]=arguments[Dn];return k.prototype[re].apply(Z,z)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(X,k){void 0===k&&(k=X.length);for(var j=k-this.blockSize,Z=this.B,re=this.h,_e=0;_e<k;){if(0==re)for(;_e<=j;)s(this,X,_e),_e+=this.blockSize;if("string"==typeof X){for(;_e<k;)if(Z[re++]=X.charCodeAt(_e++),re==this.blockSize){s(this,Z),re=0;break}}else for(;_e<k;)if(Z[re++]=X[_e++],re==this.blockSize){s(this,Z),re=0;break}}this.h=re,this.o+=k},n.prototype.v=function(){var X=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);X[0]=128;for(var k=1;k<X.length-8;++k)X[k]=0;var j=8*this.o;for(k=X.length-8;k<X.length;++k)X[k]=255&j,j/=256;for(this.u(X),X=Array(16),k=j=0;4>k;++k)for(var Z=0;32>Z;Z+=8)X[j++]=this.g[k]>>>Z&255;return X};var u={};function h(X){return-128<=X&&128>X?function i(X,k){var j=u;return Object.prototype.hasOwnProperty.call(j,X)?j[X]:j[X]=k(X)}(X,function(k){return new o([0|k],0>k?-1:0)}):new o([0|X],0>X?-1:0)}function f(X){if(isNaN(X)||!isFinite(X))return T;if(0>X)return De(f(-X));for(var k=[],j=1,Z=0;X>=j;Z++)k[Z]=X/j|0,j*=4294967296;return new o(k,0)}var T=h(0),O=h(1),ne=h(16777216);function Se(X){if(0!=X.h)return!1;for(var k=0;k<X.g.length;k++)if(0!=X.g[k])return!1;return!0}function Ve(X){return-1==X.h}function De(X){for(var k=X.g.length,j=[],Z=0;Z<k;Z++)j[Z]=~X.g[Z];return new o(j,~X.h).add(O)}function Je(X,k){return X.add(De(k))}function ot(X,k){for(;(65535&X[k])!=X[k];)X[k+1]+=X[k]>>>16,X[k]&=65535,k++}function et(X,k){this.g=X,this.h=k}function dt(X,k){if(Se(k))throw Error("division by zero");if(Se(X))return new et(T,T);if(Ve(X))return k=dt(De(X),k),new et(De(k.g),De(k.h));if(Ve(k))return k=dt(X,De(k)),new et(De(k.g),k.h);if(30<X.g.length){if(Ve(X)||Ve(k))throw Error("slowDivide_ only works with positive integers.");for(var j=O,Z=k;0>=Z.l(X);)j=Tt(j),Z=Tt(Z);var re=mt(j,1),_e=mt(Z,1);for(Z=mt(Z,2),j=mt(j,2);!Se(Z);){var z=_e.add(Z);0>=z.l(X)&&(re=re.add(j),_e=z),Z=mt(Z,1),j=mt(j,1)}return k=Je(X,re.j(k)),new et(re,k)}for(re=T;0<=X.l(k);){for(j=Math.max(1,Math.floor(X.m()/k.m())),Z=48>=(Z=Math.ceil(Math.log(j)/Math.LN2))?1:Math.pow(2,Z-48),z=(_e=f(j)).j(k);Ve(z)||0<z.l(X);)z=(_e=f(j-=Z)).j(k);Se(_e)&&(_e=O),re=re.add(_e),X=Je(X,z)}return new et(re,X)}function Tt(X){for(var k=X.g.length+1,j=[],Z=0;Z<k;Z++)j[Z]=X.i(Z)<<1|X.i(Z-1)>>>31;return new o(j,X.h)}function mt(X,k){var j=k>>5;k%=32;for(var Z=X.g.length-j,re=[],_e=0;_e<Z;_e++)re[_e]=0<k?X.i(_e+j)>>>k|X.i(_e+j+1)<<32-k:X.i(_e+j);return new o(re,X.h)}(r=o.prototype).m=function(){if(Ve(this))return-De(this).m();for(var X=0,k=1,j=0;j<this.g.length;j++){var Z=this.i(j);X+=(0<=Z?Z:4294967296+Z)*k,k*=4294967296}return X},r.toString=function(X){if(2>(X=X||10)||36<X)throw Error("radix out of range: "+X);if(Se(this))return"0";if(Ve(this))return"-"+De(this).toString(X);for(var k=f(Math.pow(X,6)),j=this,Z="";;){var re=dt(j,k).g,_e=((0<(j=Je(j,re.j(k))).g.length?j.g[0]:j.h)>>>0).toString(X);if(Se(j=re))return _e+Z;for(;6>_e.length;)_e="0"+_e;Z=_e+Z}},r.i=function(X){return 0>X?0:X<this.g.length?this.g[X]:this.h},r.l=function(X){return Ve(X=Je(this,X))?-1:Se(X)?0:1},r.abs=function(){return Ve(this)?De(this):this},r.add=function(X){for(var k=Math.max(this.g.length,X.g.length),j=[],Z=0,re=0;re<=k;re++){var _e=Z+(65535&this.i(re))+(65535&X.i(re)),z=(_e>>>16)+(this.i(re)>>>16)+(X.i(re)>>>16);Z=z>>>16,j[re]=(z&=65535)<<16|(_e&=65535)}return new o(j,-2147483648&j[j.length-1]?-1:0)},r.j=function(X){if(Se(this)||Se(X))return T;if(Ve(this))return Ve(X)?De(this).j(De(X)):De(De(this).j(X));if(Ve(X))return De(this.j(De(X)));if(0>this.l(ne)&&0>X.l(ne))return f(this.m()*X.m());for(var k=this.g.length+X.g.length,j=[],Z=0;Z<2*k;Z++)j[Z]=0;for(Z=0;Z<this.g.length;Z++)for(var re=0;re<X.g.length;re++){var _e=this.i(Z)>>>16,z=65535&this.i(Z),Dn=X.i(re)>>>16,$s=65535&X.i(re);j[2*Z+2*re]+=z*$s,ot(j,2*Z+2*re),j[2*Z+2*re+1]+=_e*$s,ot(j,2*Z+2*re+1),j[2*Z+2*re+1]+=z*Dn,ot(j,2*Z+2*re+1),j[2*Z+2*re+2]+=_e*Dn,ot(j,2*Z+2*re+2)}for(Z=0;Z<k;Z++)j[Z]=j[2*Z+1]<<16|j[2*Z];for(Z=k;Z<2*k;Z++)j[Z]=0;return new o(j,0)},r.A=function(X){return dt(this,X).h},r.and=function(X){for(var k=Math.max(this.g.length,X.g.length),j=[],Z=0;Z<k;Z++)j[Z]=this.i(Z)&X.i(Z);return new o(j,this.h&X.h)},r.or=function(X){for(var k=Math.max(this.g.length,X.g.length),j=[],Z=0;Z<k;Z++)j[Z]=this.i(Z)|X.i(Z);return new o(j,this.h|X.h)},r.xor=function(X){for(var k=Math.max(this.g.length,X.g.length),j=[],Z=0;Z<k;Z++)j[Z]=this.i(Z)^X.i(Z);return new o(j,this.h^X.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,P=ae.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=f,o.fromString=function g(X,k){if(0==X.length)throw Error("number format error: empty string");if(2>(k=k||10)||36<k)throw Error("radix out of range: "+k);if("-"==X.charAt(0))return De(g(X.substring(1),k));if(0<=X.indexOf("-"))throw Error('number format error: interior "-" character');for(var j=f(Math.pow(k,8)),Z=T,re=0;re<X.length;re+=8){var _e=Math.min(8,X.length-re),z=parseInt(X.substring(re,re+_e),k);8>_e?(_e=f(Math.pow(k,_e)),Z=Z.j(_e).add(f(z))):Z=(Z=Z.j(j)).add(f(z))}return Z},V=ae.Integer=o}).apply(typeof y<"u"?y:typeof self<"u"?self:typeof window<"u"?window:{});var D,Ae,H,N,w,q,me,pe,ce,R=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},U={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(a,_,p){return a==Array.prototype||a==Object.prototype||(a[_]=p.value),a},n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof R&&R];for(var _=0;_<a.length;++_){var p=a[_];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}(this);!function s(a,_){if(_)e:{var p=n;a=a.split(".");for(var I=0;I<a.length-1;I++){var le=a[I];if(!(le in p))break e;p=p[le]}(_=_(I=p[a=a[a.length-1]]))!=I&&null!=_&&e(p,a,{configurable:!0,writable:!0,value:_})}}("Array.prototype.values",function(a){return a||function(){return function i(a,_){a instanceof String&&(a+="");var p=0,I=!1,le={next:function(){if(!I&&p<a.length){var ve=p++;return{value:_(ve,a[ve]),done:!1}}return I=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}(this,function(_,p){return p})}});var o=o||{},u=this||self;function h(a){var _=typeof a;return"array"==(_="object"!=_?_:a?Array.isArray(a)?"array":_:"null")||"object"==_&&"number"==typeof a.length}function f(a){var _=typeof a;return"object"==_&&null!=a||"function"==_}function g(a,_,p){return a.call.apply(a.bind,arguments)}function T(a,_,p){if(!a)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var le=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(le,I),a.apply(_,le)}}return function(){return a.apply(_,arguments)}}function O(a,_,p){return(O=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:T).apply(null,arguments)}function ne(a,_){var p=Array.prototype.slice.call(arguments,1);return function(){var I=p.slice();return I.push.apply(I,arguments),a.apply(this,I)}}function Se(a,_){function p(){}p.prototype=_.prototype,a.aa=_.prototype,a.prototype=new p,a.prototype.constructor=a,a.Qb=function(I,le,ve){for(var qe=Array(arguments.length-2),St=2;St<arguments.length;St++)qe[St-2]=arguments[St];return _.prototype[le].apply(I,qe)}}function Ve(a){const _=a.length;if(0<_){const p=Array(_);for(let I=0;I<_;I++)p[I]=a[I];return p}return[]}function De(a,_){for(let p=1;p<arguments.length;p++){const I=arguments[p];if(h(I)){const le=a.length||0,ve=I.length||0;a.length=le+ve;for(let qe=0;qe<ve;qe++)a[le+qe]=I[qe]}else a.push(I)}}function ot(a){return/^[\s\xa0]*$/.test(a)}function et(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function dt(a){return dt[" "](a),a}dt[" "]=function(){};var Tt=!(-1==et().indexOf("Gecko")||-1!=et().toLowerCase().indexOf("webkit")&&-1==et().indexOf("Edge")||-1!=et().indexOf("Trident")||-1!=et().indexOf("MSIE")||-1!=et().indexOf("Edge"));function mt(a,_,p){for(const I in a)_.call(p,a[I],I,a)}function k(a){const _={};for(const p in a)_[p]=a[p];return _}const j="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(a,_){let p,I;for(let le=1;le<arguments.length;le++){for(p in I=arguments[le],I)a[p]=I[p];for(let ve=0;ve<j.length;ve++)p=j[ve],Object.prototype.hasOwnProperty.call(I,p)&&(a[p]=I[p])}}function re(a){var _=1;a=a.split(":");const p=[];for(;0<_&&a.length;)p.push(a.shift()),_--;return a.length&&p.push(a.join(":")),p}function _e(a){u.setTimeout(()=>{throw a},0)}function z(){var a=ec;let _=null;return a.g&&(_=a.g,a.g=a.g.next,a.g||(a.h=null),_.next=null),_}var $s=new class Je{constructor(_,p){this.i=_,this.j=p,this.h=0,this.g=null}get(){let _;return 0<this.h?(this.h--,_=this.g,this.g=_.next,_.next=null):_=this.i(),_}}(()=>new $p,a=>a.reset());class $p{constructor(){this.next=this.g=this.h=null}set(_,p){this.h=_,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let qs,Ws=!1,ec=new class Dn{constructor(){this.h=this.g=null}add(_,p){const I=$s.get();I.set(_,p),this.h?this.h.next=I:this.g=I,this.h=I}},Vd=()=>{const a=u.Promise.resolve(void 0);qs=()=>{a.then(qp)}};var qp=()=>{for(var a;a=z();){try{a.h.call(a.g)}catch(p){_e(p)}var _=$s;_.j(a),100>_.h&&(_.h++,a.next=_.g,_.g=a)}Ws=!1};function Jn(){this.s=this.s,this.C=this.C}function nn(a,_){this.type=a,this.g=this.target=_,this.defaultPrevented=!1}Jn.prototype.s=!1,Jn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Jn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},nn.prototype.h=function(){this.defaultPrevented=!0};var Wp=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,_=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const p=()=>{};u.addEventListener("test",p,_),u.removeEventListener("test",p,_)}catch{}return a}();function Ks(a,_){if(nn.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var p=this.type=a.type,I=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=_,_=a.relatedTarget){if(Tt){e:{try{dt(_.nodeName);var le=!0;break e}catch{}le=!1}le||(_=null)}}else"mouseover"==p?_=a.fromElement:"mouseout"==p&&(_=a.toElement);this.relatedTarget=_,I?(this.clientX=void 0!==I.clientX?I.clientX:I.pageX,this.clientY=void 0!==I.clientY?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Kp[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Ks.aa.h.call(this)}}Se(Ks,nn);var Kp={2:"touch",3:"pen",4:"mouse"};Ks.prototype.h=function(){Ks.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ys="closure_listenable_"+(1e6*Math.random()|0),Yp=0;function Qp(a,_,p,I,le){this.listener=a,this.proxy=null,this.src=_,this.type=p,this.capture=!!I,this.ha=le,this.key=++Yp,this.da=this.fa=!1}function ho(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function _o(a){this.src=a,this.g={},this.h=0}function tc(a,_){var p=_.type;if(p in a.g){var ve,I=a.g[p],le=Array.prototype.indexOf.call(I,_,void 0);(ve=0<=le)&&Array.prototype.splice.call(I,le,1),ve&&(ho(_),0==a.g[p].length&&(delete a.g[p],a.h--))}}function nc(a,_,p,I){for(var le=0;le<a.length;++le){var ve=a[le];if(!ve.da&&ve.listener==_&&ve.capture==!!p&&ve.ha==I)return le}return-1}_o.prototype.add=function(a,_,p,I,le){var ve=a.toString();(a=this.g[ve])||(a=this.g[ve]=[],this.h++);var qe=nc(a,_,I,le);return-1<qe?(_=a[qe],p||(_.fa=!1)):((_=new Qp(_,this.src,ve,!!I,le)).fa=p,a.push(_)),_};var rc="closure_lm_"+(1e6*Math.random()|0),sc={};function Nd(a,_,p,I,le){if(I&&I.once)return jd(a,_,p,I,le);if(Array.isArray(_)){for(var ve=0;ve<_.length;ve++)Nd(a,_[ve],p,I,le);return null}return p=lc(p),a&&a[Ys]?a.K(_,p,f(I)?!!I.capture:!!I,le):zd(a,_,p,!1,I,le)}function zd(a,_,p,I,le,ve){if(!_)throw Error("Invalid event type");var qe=f(le)?!!le.capture:!!le,St=oc(a);if(St||(a[rc]=St=new _o(a)),(p=St.add(_,p,I,qe,ve)).proxy)return p;if(I=function Xp(){const _=Jp;return function a(p){return _.call(a.src,a.listener,p)}}(),p.proxy=I,I.src=a,I.listener=p,a.addEventListener)Wp||(le=qe),void 0===le&&(le=!1),a.addEventListener(_.toString(),I,le);else if(a.attachEvent)a.attachEvent(Ld(_.toString()),I);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(I)}return p}function jd(a,_,p,I,le){if(Array.isArray(_)){for(var ve=0;ve<_.length;ve++)jd(a,_[ve],p,I,le);return null}return p=lc(p),a&&a[Ys]?a.L(_,p,f(I)?!!I.capture:!!I,le):zd(a,_,p,!0,I,le)}function Bd(a,_,p,I,le){if(Array.isArray(_))for(var ve=0;ve<_.length;ve++)Bd(a,_[ve],p,I,le);else I=f(I)?!!I.capture:!!I,p=lc(p),a&&a[Ys]?(a=a.i,(_=String(_).toString())in a.g&&-1<(p=nc(ve=a.g[_],p,I,le))&&(ho(ve[p]),Array.prototype.splice.call(ve,p,1),0==ve.length&&(delete a.g[_],a.h--))):a&&(a=oc(a))&&(_=a.g[_.toString()],a=-1,_&&(a=nc(_,p,I,le)),(p=-1<a?_[a]:null)&&ic(p))}function ic(a){if("number"!=typeof a&&a&&!a.da){var _=a.src;if(_&&_[Ys])tc(_.i,a);else{var p=a.type,I=a.proxy;_.removeEventListener?_.removeEventListener(p,I,a.capture):_.detachEvent?_.detachEvent(Ld(p),I):_.addListener&&_.removeListener&&_.removeListener(I),(p=oc(_))?(tc(p,a),0==p.h&&(p.src=null,_[rc]=null)):ho(a)}}}function Ld(a){return a in sc?sc[a]:sc[a]="on"+a}function Jp(a,_){if(a.da)a=!0;else{_=new Ks(_,this);var p=a.listener,I=a.ha||a.src;a.fa&&ic(a),a=p.call(I,_)}return a}function oc(a){return(a=a[rc])instanceof _o?a:null}var ac="__closure_events_fn_"+(1e9*Math.random()>>>0);function lc(a){return"function"==typeof a?a:(a[ac]||(a[ac]=function(_){return a.handleEvent(_)}),a[ac])}function rn(){Jn.call(this),this.i=new _o(this),this.M=this,this.F=null}function ln(a,_){var p,I=a.F;if(I)for(p=[];I;I=I.F)p.push(I);if(a=a.M,I=_.type||_,"string"==typeof _)_=new nn(_,a);else if(_ instanceof nn)_.target=_.target||a;else{var le=_;Z(_=new nn(I,a),le)}if(le=!0,p)for(var ve=p.length-1;0<=ve;ve--){var qe=_.g=p[ve];le=mo(qe,I,!0,_)&&le}if(le=mo(qe=_.g=a,I,!0,_)&&le,le=mo(qe,I,!1,_)&&le,p)for(ve=0;ve<p.length;ve++)le=mo(qe=_.g=p[ve],I,!1,_)&&le}function mo(a,_,p,I){if(!(_=a.i.g[String(_)]))return!0;_=_.concat();for(var le=!0,ve=0;ve<_.length;++ve){var qe=_[ve];if(qe&&!qe.da&&qe.capture==p){var St=qe.listener,Jt=qe.ha||qe.src;qe.fa&&tc(a.i,qe),le=!1!==St.call(Jt,I)&&le}}return le&&!I.defaultPrevented}function Gd(a,_,p){if("function"==typeof a)p&&(a=O(a,p));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=O(a.handleEvent,a)}return 2147483647<Number(_)?-1:u.setTimeout(a,_||0)}function Ud(a){a.g=Gd(()=>{a.g=null,a.i&&(a.i=!1,Ud(a))},a.l);const _=a.h;a.h=null,a.m.apply(null,_)}Se(rn,Jn),rn.prototype[Ys]=!0,rn.prototype.removeEventListener=function(a,_,p,I){Bd(this,a,_,p,I)},rn.prototype.N=function(){if(rn.aa.N.call(this),this.i){var _,a=this.i;for(_ in a.g){for(var p=a.g[_],I=0;I<p.length;I++)ho(p[I]);delete a.g[_],a.h--}}this.F=null},rn.prototype.K=function(a,_,p,I){return this.i.add(String(a),_,!1,p,I)},rn.prototype.L=function(a,_,p,I){return this.i.add(String(a),_,!0,p,I)};class Hp extends Jn{constructor(_,p){super(),this.m=_,this.l=p,this.h=null,this.i=!1,this.g=null}j(_){this.h=arguments,this.g?this.i=!0:Ud(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qs(a){Jn.call(this),this.h=a,this.g={}}Se(Qs,Jn);var $d=[];function qd(a){mt(a.g,function(_,p){this.g.hasOwnProperty(p)&&ic(_)},a),a.g={}}Qs.prototype.N=function(){Qs.aa.N.call(this),qd(this)},Qs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cc=u.JSON.stringify,Zp=u.JSON.parse,eg=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function uc(){}function Kd(){}uc.prototype.h=null;var Xs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function hc(){nn.call(this,"d")}function dc(){nn.call(this,"c")}Se(hc,nn),Se(dc,nn);var vr={},Yd=null;function fo(){return Yd=Yd||new rn}function Qd(a){nn.call(this,vr.La,a)}function Js(a){const _=fo();ln(_,new Qd(_))}function Xd(a,_){nn.call(this,vr.STAT_EVENT,a),this.stat=_}function cn(a){const _=fo();ln(_,new Xd(_,a))}function Jd(a,_){nn.call(this,vr.Ma,a),this.size=_}function Hs(a,_){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},_)}function Zs(){this.g=!0}function ss(a,_,p,I){a.info(function(){return"XMLHTTP TEXT ("+_+"): "+function sg(a,_){if(!a.g)return _;if(!_)return null;try{var p=JSON.parse(_);if(p)for(a=0;a<p.length;a++)if(Array.isArray(p[a])){var I=p[a];if(!(2>I.length)){var le=I[1];if(Array.isArray(le)&&!(1>le.length)){var ve=le[0];if("noop"!=ve&&"stop"!=ve&&"close"!=ve)for(var qe=1;qe<le.length;qe++)le[qe]=""}}}return cc(p)}catch{return _}}(a,p)+(I?" "+I:"")})}vr.La="serverreachability",Se(Qd,nn),vr.STAT_EVENT="statevent",Se(Xd,nn),vr.Ma="timingevent",Se(Jd,nn),Zs.prototype.xa=function(){this.g=!1},Zs.prototype.info=function(){};var _c,po={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Hd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function go(){}function Hn(a,_,p,I){this.j=a,this.i=_,this.l=p,this.R=I||1,this.U=new Qs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zd}function Zd(){this.i=null,this.g="",this.h=!1}Se(go,uc),go.prototype.g=function(){return new XMLHttpRequest},go.prototype.i=function(){return{}},_c=new go;var e_={},mc={};function fc(a,_,p){a.L=1,a.v=xo(Fn(_)),a.m=p,a.P=!0,t_(a,null)}function t_(a,_){a.F=Date.now(),yo(a),a.A=Fn(a.v);var p=a.A,I=a.R;Array.isArray(I)||(I=[String(I)]),f_(p.i,"t",I),a.C=0,p=a.j.J,a.h=new Zd,a.g=M_(a.j,p?_:null,!a.m),0<a.O&&(a.M=new Hp(O(a.Y,a,a.g),a.O)),_=a.U,p=a.g,I=a.ca;var le="readystatechange";Array.isArray(le)||(le&&($d[0]=le.toString()),le=$d);for(var ve=0;ve<le.length;ve++){var qe=Nd(p,le[ve],I||_.handleEvent,!1,_.h||_);if(!qe)break;_.g[qe.key]=qe}_=a.H?k(a.H):{},a.m?(a.u||(a.u="POST"),_["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,_)):(a.u="GET",a.g.ea(a.A,a.u,null,_)),Js(),function tg(a,_,p,I,le,ve){a.info(function(){if(a.g)if(ve)for(var qe="",St=ve.split("&"),Jt=0;Jt<St.length;Jt++){var bt=St[Jt].split("=");if(1<bt.length){var sn=bt[0];bt=bt[1];var on=sn.split("_");qe=2<=on.length&&"type"==on[1]?qe+(sn+"=")+bt+"&":qe+(sn+"=redacted&")}}else qe=null;else qe=ve;return"XMLHTTP REQ ("+I+") [attempt "+le+"]: "+_+"\n"+p+"\n"+qe})}(a.i,a.u,a.A,a.l,a.R,a.m)}function n_(a){return!!a.g&&"GET"==a.u&&2!=a.L&&a.j.Ca}function ig(a,_){var p=a.C,I=_.indexOf("\n",p);return-1==I?mc:(p=Number(_.substring(p,I)),isNaN(p)?e_:(I+=1)+p>_.length?mc:(_=_.slice(I,I+p),a.C=I+p,_))}function yo(a){a.S=Date.now()+a.I,r_(a,a.I)}function r_(a,_){if(null!=a.B)throw Error("WatchDog timer not null");a.B=Hs(O(a.ba,a),_)}function pc(a){a.B&&(u.clearTimeout(a.B),a.B=null)}function ei(a){0==a.j.G||a.J||R_(a.j,a)}function wr(a){pc(a);var _=a.M;_&&"function"==typeof _.ma&&_.ma(),a.M=null,qd(a.U),a.g&&(_=a.g,a.g=null,_.abort(),_.ma())}function gc(a,_){try{var p=a.j;if(0!=p.G&&(p.g==a||yc(p.h,a)))if(!a.K&&yc(p.h,a)&&3==p.G){try{var I=p.Da.g.parse(_)}catch{I=null}if(Array.isArray(I)&&3==I.length){var le=I;if(0==le[0]){e:if(!p.u){if(p.g){if(!(p.g.F+3e3<a.F))break e;Ao(p),Io(p)}Tc(p),cn(18)}}else p.za=le[1],0<p.za-p.T&&37500>le[2]&&p.F&&0==p.v&&!p.C&&(p.C=Hs(O(p.Za,p),6e3));if(1>=o_(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Tr(p,11)}else if((a.K||p.g==a)&&Ao(p),!ot(_))for(le=p.Da.g.parse(_),_=0;_<le.length;_++){let bt=le[_];if(p.T=bt[0],bt=bt[1],2==p.G)if("c"==bt[0]){p.K=bt[1],p.ia=bt[2];const sn=bt[3];null!=sn&&(p.la=sn,p.j.info("VER="+p.la));const on=bt[4];null!=on&&(p.Aa=on,p.j.info("SVER="+p.Aa));const as=bt[5];null!=as&&"number"==typeof as&&0<as&&(p.L=I=1.5*as,p.j.info("backChannelRequestTimeoutMs_="+I)),I=p;const yn=a.g;if(yn){const So=yn.g?yn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(So){var ve=I.h;ve.g||-1==So.indexOf("spdy")&&-1==So.indexOf("quic")&&-1==So.indexOf("h2")||(ve.j=ve.l,ve.g=new Set,ve.h&&(vc(ve,ve.h),ve.h=null))}if(I.D){const Ic=yn.g?yn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ic&&(I.ya=Ic,Pt(I.I,I.D,Ic))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-a.F,p.j.info("Handshake RTT: "+p.R+"ms"));var qe=a;if((I=p).qa=k_(I,I.J?I.ia:null,I.W),qe.K){a_(I.h,qe);var St=qe,Jt=I.L;Jt&&(St.I=Jt),St.B&&(pc(St),yo(St)),I.g=qe}else C_(I);0<p.i.length&&Eo(p)}else"stop"!=bt[0]&&"close"!=bt[0]||Tr(p,7);else 3==p.G&&("stop"==bt[0]||"close"==bt[0]?"stop"==bt[0]?Tr(p,7):xc(p):"noop"!=bt[0]&&p.l&&p.l.ta(bt),p.v=0)}Js()}catch{}}Hn.prototype.ca=function(a){a=a.target;const _=this.M;_&&3==Vn(a)?_.j():this.Y(a)},Hn.prototype.Y=function(a){try{if(a==this.g)e:{const on=Vn(this.g);var _=this.g.Ba();if(this.g.Z(),!(3>on)&&(3!=on||this.g&&(this.h.h||this.g.oa()||T_(this.g)))){this.J||4!=on||7==_||Js(),pc(this);var p=this.g.Z();this.X=p;t:if(n_(this)){var I=T_(this.g);a="";var le=I.length,ve=4==Vn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){wr(this),ei(this);var qe="";break t}this.h.i=new u.TextDecoder}for(_=0;_<le;_++)this.h.h=!0,a+=this.h.i.decode(I[_],{stream:!(ve&&_==le-1)});I.length=0,this.h.g+=a,this.C=0,qe=this.h.g}else qe=this.g.oa();if(this.o=200==p,function ng(a,_,p,I,le,ve,qe){a.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+le+"]: "+_+"\n"+p+"\n"+ve+" "+qe})}(this.i,this.u,this.A,this.l,this.R,on,p),this.o){if(this.T&&!this.K){t:{if(this.g){var St,Jt=this.g;if((St=Jt.g?Jt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ot(St)){var bt=St;break t}}bt=null}if(!(p=bt)){this.o=!1,this.s=3,cn(12),wr(this),ei(this);break e}ss(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gc(this,p)}if(this.P){let yn;for(p=!0;!this.J&&this.C<qe.length;){if(yn=ig(this,qe),yn==mc){4==on&&(this.s=4,cn(14),p=!1),ss(this.i,this.l,null,"[Incomplete Response]");break}if(yn==e_){this.s=4,cn(15),ss(this.i,this.l,qe,"[Invalid Chunk]"),p=!1;break}ss(this.i,this.l,yn,null),gc(this,yn)}if(n_(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=on||0!=qe.length||this.h.h||(this.s=1,cn(16),p=!1),this.o=this.o&&p,p){if(0<qe.length&&!this.W){this.W=!0;var sn=this.j;sn.g==this&&sn.ba&&!sn.M&&(sn.j.info("Great, no buffering proxy detected. Bytes received: "+qe.length),bc(sn),sn.M=!0,cn(11))}}else ss(this.i,this.l,qe,"[Invalid Chunked Response]"),wr(this),ei(this)}else ss(this.i,this.l,qe,null),gc(this,qe);4==on&&wr(this),this.o&&!this.J&&(4==on?R_(this.j,this):(this.o=!1,yo(this)))}else(function Tg(a){const _={};a=(a.g&&2<=Vn(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let I=0;I<a.length;I++){if(ot(a[I]))continue;var p=re(a[I]);const le=p[0];if("string"!=typeof(p=p[1]))continue;p=p.trim();const ve=_[le]||[];_[le]=ve,ve.push(p)}!function X(a,_){for(const p in a)_.call(void 0,a[p],p,a)}(_,function(I){return I.join(", ")})})(this.g),400==p&&0<qe.indexOf("Unknown SID")?(this.s=3,cn(12)):(this.s=0,cn(13)),wr(this),ei(this)}}}catch{}},Hn.prototype.cancel=function(){this.J=!0,wr(this)},Hn.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(function rg(a,_){a.info(function(){return"TIMEOUT: "+_})}(this.i,this.A),2!=this.L&&(Js(),cn(17)),wr(this),this.s=2,ei(this)):r_(this,this.S-a)};var og=class{constructor(a,_){this.g=a,this.map=_}};function s_(a){this.l=a||10,a=u.PerformanceNavigationTiming?0<(a=u.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function i_(a){return!!a.h||!!a.g&&a.g.size>=a.j}function o_(a){return a.h?1:a.g?a.g.size:0}function yc(a,_){return a.h?a.h==_:!!a.g&&a.g.has(_)}function vc(a,_){a.g?a.g.add(_):a.h=_}function a_(a,_){a.h&&a.h==_?a.h=null:a.g&&a.g.has(_)&&a.g.delete(_)}function l_(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let _=a.i;for(const p of a.g.values())_=_.concat(p.D);return _}return Ve(a.i)}function c_(a,_){if(a.forEach&&"function"==typeof a.forEach)a.forEach(_,void 0);else if(h(a)||"string"==typeof a)Array.prototype.forEach.call(a,_,void 0);else for(var p=function lg(a){if(a.na&&"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(h(a)||"string"==typeof a){var _=[];a=a.length;for(var p=0;p<a;p++)_.push(p);return _}_=[],p=0;for(const I in a)_[p++]=I;return _}}}(a),I=function ag(a){if(a.V&&"function"==typeof a.V)return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(h(a)){for(var _=[],p=a.length,I=0;I<p;I++)_.push(a[I]);return _}for(I in _=[],p=0,a)_[p++]=a[I];return _}(a),le=I.length,ve=0;ve<le;ve++)_.call(void 0,I[ve],p&&p[ve],a)}s_.prototype.cancel=function(){if(this.i=l_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var u_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof xr){this.h=a.h,vo(this,a.j),this.o=a.o,this.g=a.g,wo(this,a.s),this.l=a.l;var _=a.i,p=new ri;p.i=_.i,_.g&&(p.g=new Map(_.g),p.h=_.h),h_(this,p),this.m=a.m}else a&&(_=String(a).match(u_))?(this.h=!1,vo(this,_[1]||"",!0),this.o=ti(_[2]||""),this.g=ti(_[3]||"",!0),wo(this,_[4]),this.l=ti(_[5]||"",!0),h_(this,_[6]||"",!0),this.m=ti(_[7]||"")):(this.h=!1,this.i=new ri(null,this.h))}function Fn(a){return new xr(a)}function vo(a,_,p){a.j=p?ti(_,!0):_,a.j&&(a.j=a.j.replace(/:$/,""))}function wo(a,_){if(_){if(_=Number(_),isNaN(_)||0>_)throw Error("Bad port number "+_);a.s=_}else a.s=null}function h_(a,_,p){_ instanceof ri?(a.i=_,function fg(a,_){_&&!a.j&&(Zn(a),a.i=null,a.g.forEach(function(p,I){var le=I.toLowerCase();I!=le&&(__(this,I),f_(this,le,p))},a)),a.j=_}(a.i,a.h)):(p||(_=ni(_,_g)),a.i=new ri(_,a.h))}function Pt(a,_,p){a.i.set(_,p)}function xo(a){return Pt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ti(a,_){return a?_?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ni(a,_,p){return"string"==typeof a?(a=encodeURI(a).replace(_,ug),p&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function ug(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}xr.prototype.toString=function(){var a=[],_=this.j;_&&a.push(ni(_,d_,!0),":");var p=this.g;return(p||"file"==_)&&(a.push("//"),(_=this.o)&&a.push(ni(_,d_,!0),"@"),a.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(p=this.s)&&a.push(":",String(p))),(p=this.l)&&(this.g&&"/"!=p.charAt(0)&&a.push("/"),a.push(ni(p,"/"==p.charAt(0)?dg:hg,!0))),(p=this.i.toString())&&a.push("?",p),(p=this.m)&&a.push("#",ni(p,mg)),a.join("")};var d_=/[#\/\?@]/g,hg=/[#\?:]/g,dg=/[#\?]/g,_g=/[#\?@]/g,mg=/#/g;function ri(a,_){this.h=this.g=null,this.i=a||null,this.j=!!_}function Zn(a){a.g||(a.g=new Map,a.h=0,a.i&&function cg(a,_){if(a){a=a.split("&");for(var p=0;p<a.length;p++){var I=a[p].indexOf("="),le=null;if(0<=I){var ve=a[p].substring(0,I);le=a[p].substring(I+1)}else ve=a[p];_(ve,le?decodeURIComponent(le.replace(/\+/g," ")):"")}}}(a.i,function(_,p){a.add(decodeURIComponent(_.replace(/\+/g," ")),p)}))}function __(a,_){Zn(a),_=is(a,_),a.g.has(_)&&(a.i=null,a.h-=a.g.get(_).length,a.g.delete(_))}function m_(a,_){return Zn(a),_=is(a,_),a.g.has(_)}function f_(a,_,p){__(a,_),0<p.length&&(a.i=null,a.g.set(is(a,_),Ve(p)),a.h+=p.length)}function is(a,_){return _=String(_),a.j&&(_=_.toLowerCase()),_}function er(a,_,p,I,le){try{le&&(le.onload=null,le.onerror=null,le.onabort=null,le.ontimeout=null),I(p)}catch{}}function yg(){this.g=new eg}function vg(a,_,p){const I=p||"";try{c_(a,function(le,ve){let qe=le;f(le)&&(qe=cc(le)),_.push(I+ve+"="+encodeURIComponent(qe))})}catch(le){throw _.push(I+"type="+encodeURIComponent("_badmap")),le}}function si(a){this.l=a.Ub||null,this.j=a.eb||!1}function To(a,_){rn.call(this),this.D=a,this.o=_,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function p_(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function ii(a){a.readyState=4,a.l=null,a.j=null,a.v=null,oi(a)}function oi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function g_(a){let _="";return mt(a,function(p,I){_+=I,_+=":",_+=p,_+="\r\n"}),_}function wc(a,_,p){e:{for(I in p){var I=!1;break e}I=!0}I||(p=g_(p),"string"==typeof a?null!=p&&encodeURIComponent(String(p)):Pt(a,_,p))}function jt(a){rn.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ri.prototype).add=function(a,_){Zn(this),this.i=null,a=is(this,a);var p=this.g.get(a);return p||this.g.set(a,p=[]),p.push(_),this.h+=1,this},r.forEach=function(a,_){Zn(this),this.g.forEach(function(p,I){p.forEach(function(le){a.call(_,le,I,this)},this)},this)},r.na=function(){Zn(this);const a=Array.from(this.g.values()),_=Array.from(this.g.keys()),p=[];for(let I=0;I<_.length;I++){const le=a[I];for(let ve=0;ve<le.length;ve++)p.push(_[I])}return p},r.V=function(a){Zn(this);let _=[];if("string"==typeof a)m_(this,a)&&(_=_.concat(this.g.get(is(this,a))));else{a=Array.from(this.g.values());for(let p=0;p<a.length;p++)_=_.concat(a[p])}return _},r.set=function(a,_){return Zn(this),this.i=null,m_(this,a=is(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[_]),this.h+=1,this},r.get=function(a,_){return a&&0<(a=this.V(a)).length?String(a[0]):_},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],_=Array.from(this.g.keys());for(var p=0;p<_.length;p++){var I=_[p];const ve=encodeURIComponent(String(I)),qe=this.V(I);for(I=0;I<qe.length;I++){var le=ve;""!==qe[I]&&(le+="="+encodeURIComponent(String(qe[I]))),a.push(le)}}return this.i=a.join("&")},Se(si,uc),si.prototype.g=function(){return new To(this.l,this.j)},si.prototype.i=function(a){return function(){return a}}({}),Se(To,rn),(r=To.prototype).open=function(a,_){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=_,this.readyState=1,oi(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const _={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(_.body=a),(this.D||u).fetch(new Request(this.A,_)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ii(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,oi(this)),this.g&&(this.readyState=3,oi(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;p_(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var _=a.value?a.value:new Uint8Array(0);(_=this.v.decode(_,{stream:!a.done}))&&(this.response=this.responseText+=_)}a.done?ii(this):oi(this),3==this.readyState&&p_(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,ii(this))},r.Qa=function(a){this.g&&(this.response=a,ii(this))},r.ga=function(){this.g&&ii(this)},r.setRequestHeader=function(a,_){this.u.append(a,_)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],_=this.h.entries();for(var p=_.next();!p.done;)a.push((p=p.value)[0]+": "+p[1]),p=_.next();return a.join("\r\n")},Object.defineProperty(To.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),Se(jt,rn);var wg=/^https?$/i,xg=["POST","PUT"];function y_(a,_){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=_,a.m=5,v_(a),bo(a)}function v_(a){a.A||(a.A=!0,ln(a,"complete"),ln(a,"error"))}function w_(a){if(a.h&&typeof o<"u"&&(!a.v[1]||4!=Vn(a)||2!=a.Z()))if(a.u&&4==Vn(a))Gd(a.Ea,0,a);else if(ln(a,"readystatechange"),4==Vn(a)){a.h=!1;try{const qe=a.Z();e:switch(qe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var _=!0;break e;default:_=!1}var p;if(!(p=_)){var I;if(I=0===qe){var le=String(a.D).match(u_)[1]||null;!le&&u.self&&u.self.location&&(le=u.self.location.protocol.slice(0,-1)),I=!wg.test(le?le.toLowerCase():"")}p=I}if(p)ln(a,"complete"),ln(a,"success");else{a.m=6;try{var ve=2<Vn(a)?a.g.statusText:""}catch{ve=""}a.l=ve+" ["+a.Z()+"]",v_(a)}}finally{bo(a)}}}function bo(a,_){if(a.g){x_(a);const p=a.g,I=a.v[0]?()=>{}:null;a.g=null,a.v=null,_||ln(a,"ready");try{p.onreadystatechange=I}catch{}}}function x_(a){a.I&&(u.clearTimeout(a.I),a.I=null)}function Vn(a){return a.g?a.g.readyState:0}function T_(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function ai(a,_,p){return p&&p.internalChannelParams&&p.internalChannelParams[a]||_}function b_(a){this.Aa=0,this.i=[],this.j=new Zs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ai("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ai("baseRetryDelayMs",5e3,a),this.cb=ai("retryDelaySeedMs",1e4,a),this.Wa=ai("forwardChannelMaxRetries",2,a),this.wa=ai("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new s_(a&&a.concurrentRequestLimit),this.Da=new yg,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function xc(a){if(I_(a),3==a.G){var _=a.U++,p=Fn(a.I);if(Pt(p,"SID",a.K),Pt(p,"RID",_),Pt(p,"TYPE","terminate"),li(a,p),(_=new Hn(a,a.j,_)).L=2,_.v=xo(Fn(p)),p=!1,u.navigator&&u.navigator.sendBeacon)try{p=u.navigator.sendBeacon(_.v.toString(),"")}catch{}!p&&u.Image&&((new Image).src=_.v,p=!0),p||(_.g=M_(_.j,null),_.g.ea(_.v)),_.F=Date.now(),yo(_)}P_(a)}function Io(a){a.g&&(bc(a),a.g.cancel(),a.g=null)}function I_(a){Io(a),a.u&&(u.clearTimeout(a.u),a.u=null),Ao(a),a.h.cancel(),a.s&&("number"==typeof a.s&&u.clearTimeout(a.s),a.s=null)}function Eo(a){if(!i_(a.h)&&!a.s){a.s=!0;var _=a.Ga;qs||Vd(),Ws||(qs(),Ws=!0),ec.add(_,a),a.B=0}}function E_(a,_){var p;p=_?_.l:a.U++;const I=Fn(a.I);Pt(I,"SID",a.K),Pt(I,"RID",p),Pt(I,"AID",a.T),li(a,I),a.m&&a.o&&wc(I,a.m,a.o),p=new Hn(a,a.j,p,a.B+1),null===a.m&&(p.H=a.o),_&&(a.i=_.D.concat(a.i)),_=A_(a,p,1e3),p.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),vc(a.h,p),fc(p,I,_)}function li(a,_){a.H&&mt(a.H,function(p,I){Pt(_,I,p)}),a.l&&c_({},function(p,I){Pt(_,I,p)})}function A_(a,_,p){p=Math.min(a.i.length,p);var I=a.l?O(a.l.Na,a.l,a):null;e:{var le=a.i;let ve=-1;for(;;){const qe=["count="+p];-1==ve?0<p?(ve=le[0].g,qe.push("ofs="+ve)):ve=0:qe.push("ofs="+ve);let St=!0;for(let Jt=0;Jt<p;Jt++){let bt=le[Jt].g;const sn=le[Jt].map;if(bt-=ve,0>bt)ve=Math.max(0,le[Jt].g-100),St=!1;else try{vg(sn,qe,"req"+bt+"_")}catch{I&&I(sn)}}if(St){I=qe.join("&");break e}}}return a=a.i.splice(0,p),_.D=a,I}function C_(a){if(!a.g&&!a.u){a.Y=1;var _=a.Fa;qs||Vd(),Ws||(qs(),Ws=!0),ec.add(_,a),a.v=0}}function Tc(a){return!(a.g||a.u||3<=a.v||(a.Y++,a.u=Hs(O(a.Fa,a),O_(a,a.v)),a.v++,0))}function bc(a){null!=a.A&&(u.clearTimeout(a.A),a.A=null)}function S_(a){a.g=new Hn(a,a.j,"rpc",a.Y),null===a.m&&(a.g.H=a.o),a.g.O=0;var _=Fn(a.qa);Pt(_,"RID","rpc"),Pt(_,"SID",a.K),Pt(_,"AID",a.T),Pt(_,"CI",a.F?"0":"1"),!a.F&&a.ja&&Pt(_,"TO",a.ja),Pt(_,"TYPE","xmlhttp"),li(a,_),a.m&&a.o&&wc(_,a.m,a.o),a.L&&(a.g.I=a.L);var p=a.g;a=a.ia,p.L=1,p.v=xo(Fn(_)),p.m=null,p.P=!0,t_(p,a)}function Ao(a){null!=a.C&&(u.clearTimeout(a.C),a.C=null)}function R_(a,_){var p=null;if(a.g==_){Ao(a),bc(a),a.g=null;var I=2}else{if(!yc(a.h,_))return;p=_.D,a_(a.h,_),I=1}if(0!=a.G)if(_.o)if(1==I){p=_.m?_.m.length:0,_=Date.now()-_.F;var le=a.B;ln(I=fo(),new Jd(I,p)),Eo(a)}else C_(a);else if(3==(le=_.s)||0==le&&0<_.X||!(1==I&&function bg(a,_){return!(o_(a.h)>=a.h.j-(a.s?1:0)||(a.s?(a.i=_.D.concat(a.i),0):1==a.G||2==a.G||a.B>=(a.Va?0:a.Wa)||(a.s=Hs(O(a.Ga,a,_),O_(a,a.B)),a.B++,0)))}(a,_)||2==I&&Tc(a)))switch(p&&0<p.length&&(_=a.h,_.i=_.i.concat(p)),le){case 1:Tr(a,5);break;case 4:Tr(a,10);break;case 3:Tr(a,6);break;default:Tr(a,2)}}function O_(a,_){let p=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(p*=2),p*_}function Tr(a,_){if(a.j.info("Error code "+_),2==_){var p=O(a.fb,a),I=a.Xa;const le=!I;I=new xr(I||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||vo(I,"https"),xo(I),le?function pg(a,_){const p=new Zs;if(u.Image){const I=new Image;I.onload=ne(er,p,"TestLoadImage: loaded",!0,_,I),I.onerror=ne(er,p,"TestLoadImage: error",!1,_,I),I.onabort=ne(er,p,"TestLoadImage: abort",!1,_,I),I.ontimeout=ne(er,p,"TestLoadImage: timeout",!1,_,I),u.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=a}else _(!1)}(I.toString(),p):function gg(a,_){new Zs;const I=new AbortController,le=setTimeout(()=>{I.abort(),er(0,0,!1,_)},1e4);fetch(a,{signal:I.signal}).then(ve=>{clearTimeout(le),er(0,0,!!ve.ok,_)}).catch(()=>{clearTimeout(le),er(0,0,!1,_)})}(I.toString(),p)}else cn(2);a.G=0,a.l&&a.l.sa(_),P_(a),I_(a)}function P_(a){if(a.G=0,a.ka=[],a.l){const _=l_(a.h);(0!=_.length||0!=a.i.length)&&(De(a.ka,_),De(a.ka,a.i),a.h.i.length=0,Ve(a.i),a.i.length=0),a.l.ra()}}function k_(a,_,p){var I=p instanceof xr?Fn(p):new xr(p);if(""!=I.g)_&&(I.g=_+"."+I.g),wo(I,I.s);else{var le=u.location;I=le.protocol,_=_?_+"."+le.hostname:le.hostname,le=+le.port;var ve=new xr(null);I&&vo(ve,I),_&&(ve.g=_),le&&wo(ve,le),p&&(ve.l=p),I=ve}return _=a.ya,(p=a.D)&&_&&Pt(I,p,_),Pt(I,"VER",a.la),li(a,I),I}function M_(a,_,p){if(_&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(_=new jt(a.Ca&&!a.pa?new si({eb:p}):a.pa)).Ha(a.J),_}function D_(){}function Co(){}function _n(a,_){rn.call(this),this.g=new b_(_),this.l=a,this.h=_&&_.messageUrlParams||null,a=_&&_.messageHeaders||null,_&&_.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=_&&_.initMessageHeaders||null,_&&_.messageContentType&&(a?a["X-WebChannel-Content-Type"]=_.messageContentType:a={"X-WebChannel-Content-Type":_.messageContentType}),_&&_.va&&(a?a["X-WebChannel-Client-Profile"]=_.va:a={"X-WebChannel-Client-Profile":_.va}),this.g.S=a,(a=_&&_.Sb)&&!ot(a)&&(this.g.m=a),this.v=_&&_.supportsCrossDomainXhr||!1,this.u=_&&_.sendRawJson||!1,(_=_&&_.httpSessionIdParam)&&!ot(_)&&(this.g.D=_,null!==(a=this.h)&&_ in a&&_ in(a=this.h)&&delete a[_]),this.j=new os(this)}function F_(a){hc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var _=a.__sm__;if(_){e:{for(const p in _){a=p;break e}a=void 0}(this.i=a)&&(a=this.i,_=null!==_&&a in _?_[a]:void 0),this.data=_}else this.data=a}function V_(){dc.call(this),this.status=1}function os(a){this.g=a}(r=jt.prototype).Ha=function(a){this.J=a},r.ea=function(a,_,p,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);_=_?_.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():_c.g(),this.v=function Wd(a){return a.h||(a.h=a.i())}(this.o?this.o:_c),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open(_,String(a),!0),this.B=!1}catch(ve){return void y_(this,ve)}if(a=p||"",p=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var le in I)p.set(le,I[le]);else{if("function"!=typeof I.keys||"function"!=typeof I.get)throw Error("Unknown input type for opt_headers: "+String(I));for(const ve of I.keys())p.set(ve,I.get(ve))}I=Array.from(p.keys()).find(ve=>"content-type"==ve.toLowerCase()),le=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(xg,_,void 0))||I||le||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,qe]of p)this.g.setRequestHeader(ve,qe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{x_(this),this.u=!0,this.g.send(a),this.u=!1}catch(ve){y_(this,ve)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ln(this,"complete"),ln(this,"abort"),bo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),bo(this,!0)),jt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?w_(this):this.bb())},r.bb=function(){w_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Vn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var _=this.g.responseText;return a&&0==_.indexOf(a)&&(_=_.substring(a.length)),Zp(_)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=b_.prototype).la=8,r.G=1,r.connect=function(a,_,p,I){cn(0),this.W=a,this.H=_||{},p&&void 0!==I&&(this.H.OSID=p,this.H.OAID=I),this.F=this.X,this.I=k_(this,null,this.W),Eo(this)},r.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const le=new Hn(this,this.j,a);let ve=this.o;if(this.S&&(ve?(ve=k(ve),Z(ve,this.S)):ve=this.S),null!==this.m||this.O||(le.H=ve,ve=null),this.P)e:{for(var _=0,p=0;p<this.i.length;p++){var I=this.i[p];if(void 0===(I="__data__"in I.map&&"string"==typeof(I=I.map.__data__)?I.length:void 0))break;if(4096<(_+=I)){_=p;break e}if(4096===_||p===this.i.length-1){_=p+1;break e}}_=1e3}else _=1e3;_=A_(this,le,_),Pt(p=Fn(this.I),"RID",a),Pt(p,"CVER",22),this.D&&Pt(p,"X-HTTP-Session-Id",this.D),li(this,p),ve&&(this.O?_="headers="+encodeURIComponent(String(g_(ve)))+"&"+_:this.m&&wc(p,this.m,ve)),vc(this.h,le),this.Ua&&Pt(p,"TYPE","init"),this.P?(Pt(p,"$req",_),Pt(p,"SID","null"),le.T=!0,fc(le,p,null)):fc(le,p,_),this.G=2}}else 3==this.G&&(a?E_(this,a):0==this.i.length||i_(this.h)||E_(this))},r.Fa=function(){if(this.u=null,S_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Hs(O(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,cn(10),Io(this),S_(this))},r.Za=function(){null!=this.C&&(this.C=null,Io(this),Tc(this),cn(19))},r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=D_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Co.prototype.g=function(a,_){return new _n(a,_)},Se(_n,rn),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){xc(this.g)},_n.prototype.o=function(a){var _=this.g;if("string"==typeof a){var p={};p.__data__=a,a=p}else this.u&&((p={}).__data__=cc(a),a=p);_.i.push(new og(_.Ya++,a)),3==_.G&&Eo(_)},_n.prototype.N=function(){this.g.l=null,delete this.j,xc(this.g),delete this.g,_n.aa.N.call(this)},Se(F_,hc),Se(V_,dc),Se(os,D_),os.prototype.ua=function(){ln(this.g,"a")},os.prototype.ta=function(a){ln(this.g,new F_(a))},os.prototype.sa=function(a){ln(this.g,new V_)},os.prototype.ra=function(){ln(this.g,"b")},Co.prototype.createWebChannel=Co.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,ce=U.createWebChannelTransport=function(){return new Co},pe=U.getStatEventTarget=function(){return fo()},me=U.Event=vr,q=U.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},po.NO_ERROR=0,po.TIMEOUT=8,po.HTTP_ERROR=6,w=U.ErrorCode=po,Hd.COMPLETE="complete",N=U.EventType=Hd,Kd.EventType=Xs,Xs.OPEN="a",Xs.CLOSE="b",Xs.ERROR="c",Xs.MESSAGE="d",rn.prototype.listen=rn.prototype.K,H=U.WebChannel=Kd,Ae=U.FetchXmlHttpFactory=si,jt.prototype.listenOnce=jt.prototype.L,jt.prototype.getLastError=jt.prototype.Ka,jt.prototype.getLastErrorCode=jt.prototype.Ba,jt.prototype.getStatus=jt.prototype.Z,jt.prototype.getResponseJson=jt.prototype.Oa,jt.prototype.getResponseText=jt.prototype.oa,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Ha,D=U.XhrIo=jt}).apply(typeof R<"u"?R:typeof self<"u"?self:typeof window<"u"?window:{});const ie="@firebase/firestore";class Oe{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Oe.UNAUTHENTICATED=new Oe(null),Oe.GOOGLE_CREDENTIALS=new Oe("google-credentials-uid"),Oe.FIRST_PARTY=new Oe("first-party-uid"),Oe.MOCK_USER=new Oe("mock-user");let Ce="10.13.2";const Ke=new C.Vy("@firebase/firestore");function Te(){return Ke.logLevel}function de(r,...e){if(Ke.logLevel<=C.$b.DEBUG){const t=e.map(Le);Ke.debug(`Firestore (${Ce}): ${r}`,...t)}}function Be(r,...e){if(Ke.logLevel<=C.$b.ERROR){const t=e.map(Le);Ke.error(`Firestore (${Ce}): ${r}`,...t)}}function oe(r,...e){if(Ke.logLevel<=C.$b.WARN){const t=e.map(Le);Ke.warn(`Firestore (${Ce}): ${r}`,...t)}}function Le(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function L(r="Unexpected state"){const e=`FIRESTORE (${Ce}) INTERNAL ASSERTION FAILED: `+r;throw Be(e),new Error(e)}function te(r,e){r||L()}function be(r,e){return r}const Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ye extends Y.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ct{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Dt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nt{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Oe.UNAUTHENTICATED))}shutdown(){}}class Et{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Qe{constructor(e){this.t=e,this.currentUser=Oe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let s=this.i;const i=f=>this.i!==s?(s=this.i,t(f)):Promise.resolve();let o=new ct;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ct,e.enqueueRetryable(()=>i(this.currentUser))};const u=()=>{const f=o;e.enqueueRetryable((0,l.A)(function*(){yield f.promise,yield i(n.currentUser)}))},h=f=>{de("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(f=>h(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(de("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ct)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(de("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(te("string"==typeof n.accessToken),new Dt(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return te(null===e||"string"==typeof e),new Oe(e)}}class ft{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Oe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class He{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ft(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Oe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ze{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class J{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=i=>{null!=i.error&&de("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,de("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const s=i=>{de("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):de("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(te("string"==typeof t.token),this.R=t.token,new ze(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function fe(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class G{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=fe(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[i]%62))}return n}}function S(r,e){return r<e?-1:r>e?1:0}function F(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}class Ie{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ye(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ye(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ye(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ye(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ie.fromMillis(Date.now())}static fromDate(e){return Ie.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ie(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?S(this.nanoseconds,e.nanoseconds):S(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class xe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new xe(e)}static min(){return new xe(new Ie(0,0))}static max(){return new xe(new Ie(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ze{constructor(e,t,n){void 0===t?t=0:t>e.length&&L(),void 0===n?n=e.length-t:n>e.length-t&&L(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ze.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ze?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Me extends Ze{construct(e,t,n){return new Me(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new ye(Q.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new Me(t)}static emptyPath(){return new Me([])}}const rt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class st extends Ze{construct(e,t,n){return new st(e,t,n)}static isValidIdentifier(e){return rt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),st.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new st(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new ye(Q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;s<e.length;){const u=e[s];if("\\"===u){if(s+1===e.length)throw new ye(Q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new ye(Q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=h,s+=2}else"`"===u?(o=!o,s++):"."!==u||o?(n+=u,s++):(i(),s++)}if(i(),o)throw new ye(Q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new st(t)}static emptyPath(){return new st([])}}class se{constructor(e){this.path=e}static fromPath(e){return new se(Me.fromString(e))}static fromName(e){return new se(Me.fromString(e).popFirst(5))}static empty(){return new se(Me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Me.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new Me(e.slice()))}}class Re{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Re(xe.min(),se.empty(),-1)}static max(){return new Re(xe.max(),se.empty(),-1)}}function Pe(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=se.comparator(r.documentKey,e.documentKey),0!==t?t:S(r.largestBatchId,e.largestBatchId))}const Ee="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ue{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function We(r){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,l.A)(function*(r){if(r.code!==Q.FAILED_PRECONDITION||r.message!==Ee)throw r;de("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,n)=>{t(e)})}static reject(e){return new M((t,n)=>{n(e)})}static waitFor(e){return new M((t,n)=>{let s=0,i=0,o=!1;e.forEach(u=>{++s,u.next(()=>{++i,o&&i===s&&t()},h=>n(h))}),o=!0,i===s&&t()})}static or(e){let t=M.resolve(!1);for(const n of e)t=t.next(s=>s?M.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,i)=>{n.push(t.call(this,s,i))}),this.waitFor(n)}static mapArray(e,t){return new M((n,s)=>{const i=e.length,o=new Array(i);let u=0;for(let h=0;h<i;h++){const f=h;t(e[f]).next(g=>{o[f]=g,++u,u===i&&n(o)},g=>s(g))}})}static doWhile(e,t){return new M((n,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):n()};i()})}}function ht(r){return"IndexedDbTransactionError"===r.name}let Bt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function yt(r){return null==r}function dn(r){return 0===r&&1/r==-1/0}function Ne(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Nt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Ec(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Rt{constructor(e,t){this.comparator=e,this.root=t||Yt.EMPTY}insert(e,t){return new Rt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Yt.BLACK,null,null))}remove(e){return new Rt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _i(this.root,e,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _i(this.root,e,this.comparator,!0)}}class _i{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Yt{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Yt.RED,this.left=s??Yt.EMPTY,this.right=i??Yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Yt(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Yt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();const e=this.left.check();if(e!==this.right.check())throw L();return e+(this.isRed()?0:1)}}Yt.EMPTY=null,Yt.RED=!0,Yt.BLACK=!1,Yt.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,n,s,i){return this}insert(e,t,n){return new Yt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class At{constructor(e){this.comparator=e,this.data=new Rt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ac(this.data.getIterator())}getIteratorFrom(e){return new Ac(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class Ac{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class un{constructor(e){this.fields=e,e.sort(st.comparator)}static empty(){return new un([])}unionWith(e){let t=new At(st.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new un(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return F(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Cc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class zt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Cc("Invalid base64 string: "+i):i}}(e);return new zt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new zt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return S(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}zt.EMPTY_BYTE_STRING=new zt("");const N_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cn(r){if(te(!!r),"string"==typeof r){let e=0;const t=N_.exec(r);if(te(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:kt(r.seconds),nanos:kt(r.nanos)}}function kt(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Sn(r){return"string"==typeof r?zt.fromBase64String(r):zt.fromUint8Array(r)}function mi(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function fi(r){const e=r.mapValue.fields.__previous_value__;return mi(e)?fi(e):e}function cs(r){const e=Cn(r.mapValue.fields.__local_write_time__.timestampValue);return new Ie(e.seconds,e.nanos)}class z_{constructor(e,t,n,s,i,o,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f}}class nr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new nr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof nr&&e.projectId===this.projectId&&e.database===this.database}}const jn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?mi(r)?4:kc(r)?9007199254740991:vi(r)?10:11:L()}function wn(r,e){if(r===e)return!0;const t=Bn(r);if(t!==Bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return cs(r).isEqual(cs(e));case 3:return function(s,i){if("string"==typeof s.timestampValue&&"string"==typeof i.timestampValue&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Cn(s.timestampValue),u=Cn(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return i=e,Sn(r.bytesValue).isEqual(Sn(i.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,i){return kt(s.geoPointValue.latitude)===kt(i.geoPointValue.latitude)&&kt(s.geoPointValue.longitude)===kt(i.geoPointValue.longitude)}(r,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return kt(s.integerValue)===kt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=kt(s.doubleValue),u=kt(i.doubleValue);return o===u?dn(o)===dn(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return F(r.arrayValue.values||[],e.arrayValue.values||[],wn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},u=i.mapValue.fields||{};if(Ne(o)!==Ne(u))return!1;for(const h in o)if(o.hasOwnProperty(h)&&(void 0===u[h]||!wn(o[h],u[h])))return!1;return!0}(r,e);default:return L()}var i}function us(r,e){return void 0!==(r.values||[]).find(t=>wn(t,e))}function Ln(r,e){if(r===e)return 0;const t=Bn(r),n=Bn(e);if(t!==n)return S(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return S(r.booleanValue,e.booleanValue);case 2:return function(i,o){const u=kt(i.integerValue||i.doubleValue),h=kt(o.integerValue||o.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(r,e);case 3:return Sc(r.timestampValue,e.timestampValue);case 4:return Sc(cs(r),cs(e));case 5:return S(r.stringValue,e.stringValue);case 6:return function(i,o){const u=Sn(i),h=Sn(o);return u.compareTo(h)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const u=i.split("/"),h=o.split("/");for(let f=0;f<u.length&&f<h.length;f++){const g=S(u[f],h[f]);if(0!==g)return g}return S(u.length,h.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const u=S(kt(i.latitude),kt(o.latitude));return 0!==u?u:S(kt(i.longitude),kt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Rc(r.arrayValue,e.arrayValue);case 10:return function(i,o){var u,h,f,g;const ne=null===(u=(i.fields||{}).value)||void 0===u?void 0:u.arrayValue,Se=null===(h=(o.fields||{}).value)||void 0===h?void 0:h.arrayValue,Ve=S((null===(f=ne?.values)||void 0===f?void 0:f.length)||0,(null===(g=Se?.values)||void 0===g?void 0:g.length)||0);return 0!==Ve?Ve:Rc(ne,Se)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===jn.mapValue&&o===jn.mapValue)return 0;if(i===jn.mapValue)return 1;if(o===jn.mapValue)return-1;const u=i.fields||{},h=Object.keys(u),f=o.fields||{},g=Object.keys(f);h.sort(),g.sort();for(let T=0;T<h.length&&T<g.length;++T){const O=S(h[T],g[T]);if(0!==O)return O;const ne=Ln(u[h[T]],f[g[T]]);if(0!==ne)return ne}return S(h.length,g.length)}(r.mapValue,e.mapValue);default:throw L()}}function Sc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return S(r,e);const t=Cn(r),n=Cn(e),s=S(t.seconds,n.seconds);return 0!==s?s:S(t.nanos,n.nanos)}function Rc(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=Ln(t[s],n[s]);if(i)return i}return S(t.length,n.length)}function Ir(r){return Go(r)}function Go(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Cn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Sn(r.bytesValue).toBase64():"referenceValue"in r?se.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=Go(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${Go(t.fields[o])}`;return s+"}"}(r.mapValue):L()}function rr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Uo(r){return!!r&&"integerValue"in r}function hs(r){return!!r&&"arrayValue"in r}function Oc(r){return!!r&&"nullValue"in r}function Pc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function yi(r){return!!r&&"mapValue"in r}function vi(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ds(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Nt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ds(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ds(r.arrayValue.values[t]);return e}return Object.assign({},r)}function kc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class Qt{constructor(e){this.value=e}static empty(){return new Qt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!yi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ds(t)}setAll(e){let t=st.emptyPath(),n={},s=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,n,s),n={},s=[],t=u.popLast()}o?n[u.lastSegment()]=ds(o):s.push(u.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());yi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];yi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Nt(t,(s,i)=>e[s]=i);for(const s of n)delete e[s]}clone(){return new Qt(ds(this.value))}}function Vc(r){const e=[];return Nt(r.fields,(t,n)=>{const s=new st([t]);if(yi(n)){const i=Vc(n.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new un(e)}class Ot{constructor(e,t,n,s,i,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=u}static newInvalidDocument(e){return new Ot(e,0,xe.min(),xe.min(),xe.min(),Qt.empty(),0)}static newFoundDocument(e,t,n,s){return new Ot(e,1,t,xe.min(),n,s,0)}static newNoDocument(e,t){return new Ot(e,2,t,xe.min(),xe.min(),Qt.empty(),0)}static newUnknownDocument(e,t){return new Ot(e,3,t,xe.min(),xe.min(),Qt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(xe.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=xe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gn{constructor(e,t){this.position=e,this.inclusive=t}}function Nc(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],o=r.position[s];if(n=i.field.isKeyField()?se.comparator(se.fromName(o.referenceValue),t.key):Ln(o,t.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function zc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!wn(r.position[t],e.position[t]))return!1;return!0}class _s{constructor(e,t="asc"){this.field=e,this.dir=t}}function L_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class jc{}class vt extends jc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new G_(e,t,n):"array-contains"===t?new q_(e,n):"in"===t?new qc(e,n):"not-in"===t?new W_(e,n):"array-contains-any"===t?new K_(e,n):new vt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new U_(e,n):new $_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ln(t,this.value)):null!==t&&Bn(this.value)===Bn(t)&&this.matchesComparison(Ln(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class It extends jc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new It(e,t)}matches(e){return Er(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Er(r){return"and"===r.op}function qo(r){return function Bc(r){for(const e of r.filters)if(e instanceof It)return!1;return!0}(r)&&Er(r)}function Wo(r){if(r instanceof vt)return r.field.canonicalString()+r.op.toString()+Ir(r.value);if(qo(r))return r.filters.map(e=>Wo(e)).join(",");{const e=r.filters.map(t=>Wo(t)).join(",");return`${r.op}(${e})`}}function Lc(r,e){return r instanceof vt?(n=r,(s=e)instanceof vt&&n.op===s.op&&n.field.isEqual(s.field)&&wn(n.value,s.value)):r instanceof It?function(n,s){return s instanceof It&&n.op===s.op&&n.filters.length===s.filters.length&&n.filters.reduce((i,o,u)=>i&&Lc(o,s.filters[u]),!0)}(r,e):void L();var n,s}function Uc(r){return r instanceof vt?`${(t=r).field.canonicalString()} ${t.op} ${Ir(t.value)}`:r instanceof It?function(t){return t.op.toString()+" {"+t.getFilters().map(Uc).join(" ,")+"}"}(r):"Filter";var t}class G_ extends vt{constructor(e,t,n){super(e,t,n),this.key=se.fromName(n.referenceValue)}matches(e){const t=se.comparator(e.key,this.key);return this.matchesComparison(t)}}class U_ extends vt{constructor(e,t){super(e,"in",t),this.keys=$c(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class $_ extends vt{constructor(e,t){super(e,"not-in",t),this.keys=$c(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $c(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>se.fromName(n.referenceValue))}class q_ extends vt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hs(t)&&us(t.arrayValue,this.value)}}class qc extends vt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&us(this.value.arrayValue,t)}}class W_ extends vt{constructor(e,t){super(e,"not-in",t)}matches(e){if(us(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!us(this.value.arrayValue,t)}}class K_ extends vt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>us(this.value.arrayValue,n))}}class Y_{constructor(e,t=null,n=[],s=[],i=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=u,this.ue=null}}function Ko(r,e=null,t=[],n=[],s=null,i=null,o=null){return new Y_(r,e,t,n,s,i,o)}function sr(r){const e=be(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Wo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(i=n).field.canonicalString()+i.dir;var i}).join(","),yt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Ir(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Ir(n)).join(",")),e.ue=t}return e.ue}function ms(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!L_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Lc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!zc(r.startAt,e.startAt)&&zc(r.endAt,e.endAt)}function wi(r){return se.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class Rn{constructor(e,t=null,n=[],s=[],i=null,o="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=h,this.ce=null,this.le=null,this.he=null}}function Ar(r){return new Rn(r)}function Qc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Yo(r){return null!==r.collectionGroup}function Cr(r){const e=be(r);if(null===e.ce){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new At(st.comparator);return o.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new _s(i,n))}),t.has(st.keyField().canonicalString())||e.ce.push(new _s(st.keyField(),n))}return e.ce}function Zt(r){const e=be(r);return e.le||(e.le=function Jc(r,e){if("F"===r.limitType)return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>new _s(s.field,"desc"===s.dir?"asc":"desc"));const t=r.endAt?new Gn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Gn(r.startAt.position,r.startAt.inclusive):null;return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Cr(r))),e.le}function Qo(r,e){const t=r.filters.concat([e]);return new Rn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ti(r,e,t){return new Rn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function fs(r,e){return ms(Zt(r),Zt(e))&&r.limitType===e.limitType}function Hc(r){return`${sr(Zt(r))}|lt:${r.limitType}`}function Sr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>Uc(s)).join(", ")}]`),yt(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>{return`${(o=s).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Ir(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Ir(s)).join(",")),`Target(${n})`}(Zt(r))}; limitType=${r.limitType})`}function ps(r,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return null!==n.collectionGroup?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):se.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,s){for(const i of Cr(n))if(!i.field.isKeyField()&&null===s.data.field(i.field))return!1;return!0}(r,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,e)&&(s=e,!((n=r).startAt&&!function(o,u,h){const f=Nc(o,u,h);return o.inclusive?f<=0:f<0}(n.startAt,Cr(n),s)||n.endAt&&!function(o,u,h){const f=Nc(o,u,h);return o.inclusive?f>=0:f>0}(n.endAt,Cr(n),s)));var n,s}function eu(r){return(e,t)=>{let n=!1;for(const s of Cr(r)){const i=Q_(s,e,t);if(0!==i)return i;n=n||s.field.isKeyField()}return 0}}function Q_(r,e,t){const n=r.field.isKeyField()?se.comparator(e.key,t.key):function(i,o,u){const h=o.data.field(i),f=u.data.field(i);return null!==h&&null!==f?Ln(h,f):L()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}class On{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,i]of n)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Nt(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return Ec(this.inner)}size(){return this.innerSize}}const X_=new Rt(se.comparator);function hn(){return X_}const tu=new Rt(se.comparator);function gs(...r){let e=tu;for(const t of r)e=e.insert(t.key,t);return e}function nu(r){let e=tu;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function xn(){return ys()}function ru(){return ys()}function ys(){return new On(r=>r.toString(),(r,e)=>r.isEqual(e))}const J_=new Rt(se.comparator),H_=new At(se.comparator);function _t(...r){let e=H_;for(const t of r)e=e.add(t);return e}const Z_=new At(S);function Jo(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dn(e)?"-0":e}}function su(r){return{integerValue:""+r}}function iu(r,e){return function Nn(r){return"number"==typeof r&&Number.isInteger(r)&&!dn(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?su(e):Jo(r,e)}class bi{constructor(){this._=void 0}}function em(r,e,t){return r instanceof Rr?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&mi(i)&&(i=fi(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):r instanceof ir?au(r,e):r instanceof or?lu(r,e):function(s,i){const o=ou(s,i),u=cu(o)+cu(s.Pe);return Uo(o)&&Uo(s.Pe)?su(u):Jo(s.serializer,u)}(r,e)}function tm(r,e,t){return r instanceof ir?au(r,e):r instanceof or?lu(r,e):t}function ou(r,e){return r instanceof Or?Uo(n=e)||(i=n)&&"doubleValue"in i?e:{integerValue:0}:null;var n,i}class Rr extends bi{}class ir extends bi{constructor(e){super(),this.elements=e}}function au(r,e){const t=uu(e);for(const n of r.elements)t.some(s=>wn(s,n))||t.push(n);return{arrayValue:{values:t}}}class or extends bi{constructor(e){super(),this.elements=e}}function lu(r,e){let t=uu(e);for(const n of r.elements)t=t.filter(s=>!wn(s,n));return{arrayValue:{values:t}}}class Or extends bi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function cu(r){return kt(r.integerValue||r.doubleValue)}function uu(r){return hs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class rm{constructor(e,t){this.version=e,this.transformResults=t}}class Mt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Mt}static exists(e){return new Mt(void 0,e)}static updateTime(e){return new Mt(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ii(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ei{}function hu(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new kr(r.key,Mt.none()):new Pr(r.key,r.data,Mt.none());{const t=r.data,n=Qt.empty();let s=new At(st.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?n.delete(i):n.set(i,o),s=s.add(i)}return new Pn(r.key,n,new un(s.toArray()),Mt.none())}}function sm(r,e,t){r instanceof Pr?function(s,i,o){const u=s.value.clone(),h=mu(s.fieldTransforms,i,o.transformResults);u.setAll(h),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof Pn?function(s,i,o){if(!Ii(s.precondition,i))return void i.convertToUnknownDocument(o.version);const u=mu(s.fieldTransforms,i,o.transformResults),h=i.data;h.setAll(_u(s)),h.setAll(u),i.convertToFoundDocument(o.version,h).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function ws(r,e,t,n){return r instanceof Pr?function(i,o,u,h){if(!Ii(i.precondition,o))return u;const f=i.value.clone(),g=fu(i.fieldTransforms,h,o);return f.setAll(g),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null}(r,e,t,n):r instanceof Pn?function(i,o,u,h){if(!Ii(i.precondition,o))return u;const f=fu(i.fieldTransforms,h,o),g=o.data;return g.setAll(_u(i)),g.setAll(f),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(T=>T.field))}(r,e,t,n):(u=t,Ii(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function im(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=ou(n.transform,s||null);null!=i&&(null===t&&(t=Qt.empty()),t.set(n.field,i))}return t||null}function du(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===s||n&&s&&F(n,s,(i,o)=>function nm(r,e){return r.field.isEqual(e.field)&&(s=e.transform,(n=r.transform)instanceof ir&&s instanceof ir||n instanceof or&&s instanceof or?F(n.elements,s.elements,wn):n instanceof Or&&s instanceof Or?wn(n.Pe,s.Pe):n instanceof Rr&&s instanceof Rr);var n,s}(i,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,s}class Pr extends Ei{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Pn extends Ei{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function _u(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function mu(r,e,t){const n=new Map;te(r.length===t.length);for(let s=0;s<t.length;s++){const i=r[s],o=i.transform,u=e.data.field(i.field);n.set(i.field,tm(o,u,t[s]))}return n}function fu(r,e,t){const n=new Map;for(const s of r){const i=s.transform,o=t.data.field(s.field);n.set(s.field,em(i,o,e))}return n}class kr extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ho extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zo{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&sm(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ru();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let u=this.applyToLocalView(o,i.mutatedFields);u=t.has(s.key)?null:u;const h=hu(o,u);null!==h&&n.set(s.key,h),o.isValidDocument()||o.convertToNoDocument(xe.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_t())}isEqual(e){return this.batchId===e.batchId&&F(this.mutations,e.mutations,(t,n)=>du(t,n))&&F(this.baseMutations,e.baseMutations,(t,n)=>du(t,n))}}class ea{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){te(e.mutations.length===n.length);let s=function(){return J_}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new ea(e,t,n,s)}}class ta{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class om{constructor(e,t){this.count=e,this.unchangedNames=t}}var $t,wt;function yu(r){if(void 0===r)return Be("GRPC error has no .code"),Q.UNKNOWN;switch(r){case $t.OK:return Q.OK;case $t.CANCELLED:return Q.CANCELLED;case $t.UNKNOWN:return Q.UNKNOWN;case $t.DEADLINE_EXCEEDED:return Q.DEADLINE_EXCEEDED;case $t.RESOURCE_EXHAUSTED:return Q.RESOURCE_EXHAUSTED;case $t.INTERNAL:return Q.INTERNAL;case $t.UNAVAILABLE:return Q.UNAVAILABLE;case $t.UNAUTHENTICATED:return Q.UNAUTHENTICATED;case $t.INVALID_ARGUMENT:return Q.INVALID_ARGUMENT;case $t.NOT_FOUND:return Q.NOT_FOUND;case $t.ALREADY_EXISTS:return Q.ALREADY_EXISTS;case $t.PERMISSION_DENIED:return Q.PERMISSION_DENIED;case $t.FAILED_PRECONDITION:return Q.FAILED_PRECONDITION;case $t.ABORTED:return Q.ABORTED;case $t.OUT_OF_RANGE:return Q.OUT_OF_RANGE;case $t.UNIMPLEMENTED:return Q.UNIMPLEMENTED;case $t.DATA_LOSS:return Q.DATA_LOSS;default:return L()}}(wt=$t||($t={}))[wt.OK=0]="OK",wt[wt.CANCELLED=1]="CANCELLED",wt[wt.UNKNOWN=2]="UNKNOWN",wt[wt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wt[wt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wt[wt.NOT_FOUND=5]="NOT_FOUND",wt[wt.ALREADY_EXISTS=6]="ALREADY_EXISTS",wt[wt.PERMISSION_DENIED=7]="PERMISSION_DENIED",wt[wt.UNAUTHENTICATED=16]="UNAUTHENTICATED",wt[wt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wt[wt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wt[wt.ABORTED=10]="ABORTED",wt[wt.OUT_OF_RANGE=11]="OUT_OF_RANGE",wt[wt.UNIMPLEMENTED=12]="UNIMPLEMENTED",wt[wt.INTERNAL=13]="INTERNAL",wt[wt.UNAVAILABLE=14]="UNAVAILABLE",wt[wt.DATA_LOSS=15]="DATA_LOSS";const am=new V([4294967295,4294967295],0);function wu(r){const e=function vu(){return new TextEncoder}().encode(r),t=new P;return t.update(e),new Uint8Array(t.digest())}function xu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new V([t,n],0),new V([s,i],0)]}class na{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new xs(`Invalid padding: ${t}`);if(n<0)throw new xs(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new xs(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new xs(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=V.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(V.fromNumber(n)));return 1===s.compare(am)&&(s=new V([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=wu(e),[n,s]=xu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new na(i,s,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(0===this.Ie)return;const t=wu(e),[n,s]=xu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class xs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ts{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,bs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ts(xe.min(),s,new Rt(S),hn(),_t())}}class bs{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new bs(n,t,_t(),_t(),_t())}}class Ci{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class Tu{constructor(e,t){this.targetId=e,this.me=t}}class bu{constructor(e,t,n=zt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Iu{constructor(){this.fe=0,this.ge=Au(),this.pe=zt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=_t(),t=_t(),n=_t();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:L()}}),new bs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Au()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,te(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class lm{constructor(e){this.Le=e,this.Be=new Map,this.ke=hn(),this.qe=Eu(),this.Qe=new Rt(S)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const i=s.target;if(wi(i))if(0===n){const o=new se(i.path);this.Ue(t,o,Ot.newNoDocument(o,xe.min()))}else te(1===n);else{const o=this.Ye(t);if(o!==n){const u=this.Ze(e),h=u?this.Xe(u,e,o):1;0!==h&&(this.je(t),this.Qe=this.Qe.insert(t,2===h?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let o,u;try{o=Sn(n).toUint8Array()}catch(h){if(h instanceof Cc)return oe("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new na(o,s,i)}catch(h){return oe(h instanceof xs?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(i=>{const o=this.Le.tt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const u=this.Je(o);if(u){if(i.current&&wi(u.target)){const h=new se(u.target.path);null!==this.ke.get(h)||this.it(o,h)||this.Ue(o,h,Ot.newNoDocument(h,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=_t();this.qe.forEach((i,o)=>{let u=!0;o.forEachWhile(h=>{const f=this.Je(h);return!f||"TargetPurposeLimboResolution"===f.purpose||(u=!1,!1)}),u&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Ts(e,t,this.Qe,this.ke,n);return this.ke=hn(),this.qe=Eu(),this.Qe=new Rt(S),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Iu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new At(S),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||de("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Iu),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Eu(){return new Rt(se.comparator)}function Au(){return new Rt(se.comparator)}const cm={asc:"ASCENDING",desc:"DESCENDING"},um={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hm={and:"AND",or:"OR"};class dm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ra(r,e){return r.useProto3Json||yt(e)?e:{value:e}}function Mr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cu(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function _m(r,e){return Mr(r,e.toTimestamp())}function Lt(r){return te(!!r),xe.fromTimestamp(function(t){const n=Cn(t);return new Ie(n.seconds,n.nanos)}(r))}function sa(r,e){return ia(r,e).canonicalString()}function ia(r,e){const t=(s=r,new Me(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===e?t:t.child(e)}function Su(r){const e=Me.fromString(r);return te(ju(e)),e}function Is(r,e){return sa(r.databaseId,e.path)}function Tn(r,e){const t=Su(e);if(t.get(1)!==r.databaseId.projectId)throw new ye(Q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new ye(Q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new se(Pu(t))}function Ru(r,e){return sa(r.databaseId,e)}function oa(r){return new Me(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Pu(r){return te(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function ku(r,e,t){return{name:Is(r,e),fields:t.value.mapValue.fields}}function Du(r,e){return{documents:[Ru(r,e.path)]}}function Si(r,e){const t={structuredQuery:{}},n=e.path;let s;null!==e.collectionGroup?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Ru(r,s);const i=function(f){if(0!==f.length)return zu(It.create(f,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(f){if(0!==f.length)return f.map(g=>{return{field:Un((O=g).field),direction:ym(O.dir)};var O})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=ra(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(f=e.startAt).inclusive,values:f.position}),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{_t:t,parent:s};var f}function Vu(r){let e=function Ou(r){const e=Su(r);return 4===e.length?Me.emptyPath():Pu(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){te(1===n);const g=t.from[0];g.allDescendants?s=g.collectionId:e=e.child(g.collectionId)}let i=[];t.where&&(i=function(T){const O=Nu(T);return O instanceof It&&qo(O)?O.getFilters():[O]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(O=>{return new _s(Dr((Se=O).field),function(De){switch(De){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Se.direction));var Se}));let u=null;t.limit&&(u=function(T){let O;return O="object"==typeof T?T.value:T,yt(O)?null:O}(t.limit));let h=null;var T;t.startAt&&(h=new Gn((T=t.startAt).values||[],!!T.before));let f=null;return t.endAt&&(f=function(T){return new Gn(T.values||[],!T.before)}(t.endAt)),function Yc(r,e,t,n,s,i,o,u){return new Rn(r,e,t,n,s,i,o,u)}(e,s,o,i,u,"F",h,f)}function Nu(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Dr(t.unaryFilter.field);return vt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Dr(t.unaryFilter.field);return vt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Dr(t.unaryFilter.field);return vt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Dr(t.unaryFilter.field);return vt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):void 0!==r.fieldFilter?vt.create(Dr((t=r).fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return It.create(t.compositeFilter.filters.map(n=>Nu(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L()}}(t.compositeFilter.op))}(r):L();var t}function ym(r){return cm[r]}function vm(r){return um[r]}function wm(r){return hm[r]}function Un(r){return{fieldPath:r.canonicalString()}}function Dr(r){return st.fromServerFormat(r.fieldPath)}function zu(r){return r instanceof vt?function(t){if("=="===t.op){if(Pc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Pc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Un(t.field),op:vm(t.op),value:t.value}}}(r):r instanceof It?function(t){const n=t.getFilters().map(s=>zu(s));return 1===n.length?n[0]:{compositeFilter:{op:wm(t.op),filters:n}}}(r):L()}function xm(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ju(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class kn{constructor(e,t,n,s,i=xe.min(),o=xe.min(),u=zt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new kn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Bu{constructor(e){this.ct=e}}function la(r){const e=Vu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Ti(e,e.limit,"L"):e}class ur{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(kt(e.integerValue));else if("doubleValue"in e){const n=kt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),dn(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Cn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Sn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?kc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):vi(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):L()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;const i=e.fields||{};this.dt(t,53);const o="value",u=(null===(s=null===(n=i[o].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.dt(t,15),t.At(kt(u)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),se.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}ur.vt=new ur;class Om{constructor(){this.un=new ma}addToCollectionParentIndex(e,t){return this.un.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(Re.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(Re.min())}updateCollectionGroup(e,t,n){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class ma{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new At(Me.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new At(Me.comparator)).toArray()}}new Uint8Array(0);class en{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new en(e,en.DEFAULT_COLLECTION_PERCENTILE,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}en.DEFAULT_COLLECTION_PERCENTILE=10,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,en.DEFAULT=new en(41943040,en.DEFAULT_COLLECTION_PERCENTILE,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),en.DISABLED=new en(-1,0,0);class dr{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new dr(0)}static kn(){return new dr(-1)}}class ch{constructor(){this.changes=new On(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?M.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mh{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==n&&ws(n.mutation,s,un.empty(),Ie.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,_t()).next(()=>n))}getLocalViewOfDocuments(e,t,n=_t()){const s=xn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(i=>{let o=gs();return i.forEach((u,h)=>{o=o.insert(u,h.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=xn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,_t()))}populateOverlays(e,t,n){const s=[];return n.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,s){let i=hn();const o=ys(),u=ys();return t.forEach((h,f)=>{const g=n.get(f.key);s.has(f.key)&&(void 0===g||g.mutation instanceof Pn)?i=i.insert(f.key,f):void 0!==g?(o.set(f.key,g.mutation.getFieldMask()),ws(g.mutation,f,g.mutation.getFieldMask(),Ie.now())):o.set(f.key,un.empty())}),this.recalculateAndSaveOverlays(e,i).next(h=>(h.forEach((f,g)=>o.set(f,g)),t.forEach((f,g)=>{var T;return u.set(f,new zm(g,null!==(T=o.get(f))&&void 0!==T?T:null))}),u))}recalculateAndSaveOverlays(e,t){const n=ys();let s=new Rt((o,u)=>o-u),i=_t();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(h=>{const f=t.get(h);if(null===f)return;let g=n.get(h)||un.empty();g=u.applyToLocalView(f,g),n.set(h,g);const T=(s.get(u.batchId)||_t()).add(h);s=s.insert(u.batchId,T)})}).next(()=>{const o=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,g=h.value,T=ru();g.forEach(O=>{if(!i.has(O)){const ne=hu(t.get(O),n.get(O));null!==ne&&T.set(O,ne),i=i.add(O)}}),o.push(this.documentOverlayCache.saveOverlays(e,f,T))}return M.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return se.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Yo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var o}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):M.resolve(xn());let u=-1,h=i;return o.next(f=>M.forEach(f,(g,T)=>(u<T.largestBatchId&&(u=T.largestBatchId),i.get(g)?M.resolve():this.remoteDocumentCache.getEntry(e,g).next(O=>{h=h.insert(g,O)}))).next(()=>this.populateOverlays(e,f,i)).next(()=>this.computeViews(e,h,f,_t())).next(g=>({batchId:u,changes:nu(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new se(t)).next(n=>{let s=gs();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let o=gs();return this.indexManager.getCollectionParents(e,i).next(u=>M.forEach(u,h=>{const f=(T=t,O=h.child(i),new Rn(O,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt));var T,O;return this.getDocumentsMatchingCollectionQuery(e,f,n,s).next(g=>{g.forEach((T,O)=>{o=o.insert(T,O)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(o=>{i.forEach((h,f)=>{const g=f.getKey();null===o.get(g)&&(o=o.insert(g,Ot.newInvalidDocument(g)))});let u=gs();return o.forEach((h,f)=>{const g=i.get(h);void 0!==g&&ws(g.mutation,f,un.empty(),Ie.now()),ps(t,f)&&(u=u.insert(h,f))}),u})}}class jm{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return M.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(s=t).id,version:s.version,createTime:Lt(s.createTime)}),M.resolve();var s}getNamedQuery(e,t){return M.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(s=t).name,query:la(s.bundledQuery),readTime:Lt(s.readTime)}),M.resolve();var s}}class Bm{constructor(){this.overlays=new Rt(se.comparator),this.Ir=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const n=xn();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,i)=>{this.ht(e,t,i)}),M.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Ir.get(n);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),M.resolve()}getOverlaysForCollection(e,t,n){const s=xn(),i=t.length+1,o=new se(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===i&&h.largestBatchId>n&&s.set(h.getKey(),h)}return M.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new Rt((f,g)=>f-g);const o=this.overlays.getIterator();for(;o.hasNext();){const f=o.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>n){let g=i.get(f.largestBatchId);null===g&&(g=xn(),i=i.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const u=xn(),h=i.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,g)=>u.set(f,g)),!(u.size()>=s)););return M.resolve(u)}ht(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const o=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new ta(t,n));let i=this.Ir.get(t);void 0===i&&(i=_t(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class Lm{constructor(){this.sessionToken=zt.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}}class fa{constructor(){this.Tr=new At(Wt.Er),this.dr=new At(Wt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Wt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Wt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new se(new Me([])),n=new Wt(t,e),s=new Wt(t,e+1),i=[];return this.dr.forEachInRange([n,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new se(new Me([])),n=new Wt(t,e),s=new Wt(t,e+1);let i=_t();return this.dr.forEachInRange([n,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Wt(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Wt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return se.comparator(e.key,t.key)||S(e.wr,t.wr)}static Ar(e,t){return S(e.wr,t.wr)||se.comparator(e.key,t.key)}}class Gm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new At(Wt.Er)}checkEmpty(e){return M.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.Sr;this.Sr++;const o=new Zo(i,t,n,s);this.mutationQueue.push(o);for(const u of s)this.br=this.br.add(new Wt(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.vr(t+1),i=s<0?0:s;return M.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Wt(t,0),s=new Wt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,s],o=>{const u=this.Dr(o.wr);i.push(u)}),M.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new At(S);return t.forEach(s=>{const i=new Wt(s,0),o=new Wt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],u=>{n=n.add(u.wr)})}),M.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;se.isDocumentKey(i)||(i=i.child(""));const o=new Wt(new se(i),0);let u=new At(S);return this.br.forEachWhile(h=>{const f=h.key.path;return!!n.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.wr)),!0)},o),M.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const s=this.Dr(n);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){te(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return M.forEach(t.mutations,s=>{const i=new Wt(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Wt(t,0),s=this.br.firstAfterOrEqual(n);return M.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return M.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Um{constructor(e){this.Mr=e,this.docs=new Rt(se.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return M.resolve(n?n.document.mutableCopy():Ot.newInvalidDocument(t))}getEntries(e,t){let n=hn();return t.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():Ot.newInvalidDocument(s))}),M.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=hn();const o=t.path,u=new se(o.child("")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:g}}=h.getNext();if(!o.isPrefixOf(f.path))break;f.path.length>o.length+1||Pe(new Re((r=g).readTime,r.key,-1),n)<=0||(s.has(g.key)||ps(t,g))&&(i=i.insert(g.key,g.mutableCopy()))}var r;return M.resolve(i)}getAllFromCollectionGroup(e,t,n,s){L()}Or(e,t){return M.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new $m(this)}getSize(e){return M.resolve(this.size)}}class $m extends ch{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),M.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class qm{constructor(e){this.persistence=e,this.Nr=new On(t=>sr(t),ms),this.lastRemoteSnapshotVersion=xe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new fa,this.targetCount=0,this.kr=dr.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),M.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new dr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Kn(t),M.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Nr.forEach((o,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),M.waitFor(i).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return M.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),M.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return M.resolve(n)}containsKey(e,t){return M.resolve(this.Br.containsKey(t))}}class pa{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Bt(0),this.Kr=!1,this.Kr=!0,this.$r=new Lm,this.referenceDelegate=e(this),this.Ur=new qm(this),this.indexManager=new Om,this.remoteDocumentCache=new Um(n=>this.referenceDelegate.Wr(n)),this.serializer=new Bu(t),this.Gr=new jm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Bm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Gm(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){de("MemoryPersistence","Starting transaction:",e);const s=new Wm(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return M.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Wm extends Ue{constructor(e){super(),this.currentSequenceNumber=e}}class Vi{constructor(e){this.persistence=e,this.Jr=new fa,this.Yr=null}static Zr(e){return new Vi(e)}get Xr(){if(this.Yr)return this.Yr;throw L()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),M.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),M.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.Xr,n=>{const s=se.fromPath(n);return this.ei(e,s).next(i=>{i||t.removeEntry(s,xe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return M.or([()=>M.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class wa{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=_t(),s=_t();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new wa(e,t.fromCache,n,s)}}class Ym{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ph{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,Y.nr)()?8:function lt(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,Y.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Ym;return this.Xi(e,t,o).next(u=>{if(i.result=u,this.zi)return this.es(e,t,o,u.size)})}).next(()=>i.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(Te()<=C.$b.DEBUG&&de("QueryEngine","SDK will not create cache indexes for query:",Sr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),M.resolve()):(Te()<=C.$b.DEBUG&&de("QueryEngine","Query:",Sr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(Te()<=C.$b.DEBUG&&de("QueryEngine","The SDK decides to create cache indexes for query:",Sr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Zt(t))):M.resolve())}Yi(e,t){if(Qc(t))return M.resolve(null);let n=Zt(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=Ti(t,null,"F"),n=Zt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=_t(...i);return this.Ji.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(h=>{const f=this.ts(t,u);return this.ns(t,f,o,h.readTime)?this.Yi(e,Ti(t,null,"F")):this.rs(e,f,t,h)}))})))}Zi(e,t,n,s){return Qc(t)||s.isEqual(xe.min())?M.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,s)?M.resolve(null):(Te()<=C.$b.DEBUG&&de("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Sr(t)),this.rs(e,o,t,function he(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=xe.fromTimestamp(1e9===n?new Ie(t+1,0):new Ie(t,n));return new Re(s,se.empty(),e)}(s,-1)).next(u=>u))})}ts(e,t){let n=new At(eu(e));return t.forEach((s,i)=>{ps(e,i)&&(n=n.add(i))}),n}ns(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,n){return Te()<=C.$b.DEBUG&&de("QueryEngine","Using full collection scan to execute query:",Sr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Re.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class Qm{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Rt(S),this._s=new On(i=>sr(i),ms),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function yh(r,e){return xa.apply(this,arguments)}function xa(){return(xa=(0,l.A)(function*(r,e){const t=be(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],u=[];let h=_t();for(const f of s){o.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}for(const f of i){u.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}return t.localDocuments.getDocuments(n,h).next(f=>({hs:f,removedBatchIds:o,addedBatchIds:u}))})})})).apply(this,arguments)}function vh(r){const e=be(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Hm(r,e){const t=be(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Br(r,e,t){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,l.A)(function*(r,e,t){const n=be(r),s=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!ht(o))throw o;de("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(s.target)})).apply(this,arguments)}function ji(r,e,t){const n=be(r);let s=xe.min(),i=_t();return n.persistence.runTransaction("Execute query","readwrite",o=>function(h,f,g){const T=be(h),O=T._s.get(g);return void 0!==O?M.resolve(T.os.get(O)):T.Ur.getTargetData(f,g)}(n,o,Zt(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,u.targetId).next(h=>{i=h})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?s:xe.min(),t?i:_t())).next(u=>(function bh(r,e,t){let n=r.us.get(e)||xe.min();t.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}(n,function Zc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),u),{documents:u,Ts:i})))}class Ca{constructor(){this.activeTargetIds=function Xo(){return Z_}()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ah{constructor(){this.so=new Ca,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Ca,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class tf{_o(e){}shutdown(){}}class Ch{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){de("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){de("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Gi=null;function Ra(){return null===Gi?Gi=268435456+Math.round(2147483648*Math.random()):Gi++,"0x"+Gi.toString(16)}const nf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class rf{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const tn="WebChannelConnection";class sf extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co="(default)"===this.databaseId.database?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,n,s,i,o){const u=Ra(),h=this.xo(t,n.toUriEncodedString());de("RestConnection",`Sending RPC '${t}' ${u}:`,h,s);const f={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(f,i,o),this.No(t,h,f,s).then(g=>(de("RestConnection",`Received RPC '${t}' ${u}: `,g),g),g=>{throw oe("RestConnection",`RPC '${t}' ${u} failed with error: `,g,"url: ",h,"request:",s),g})}Lo(t,n,s,i,o,u){return this.Mo(t,n,s,i,o)}Oo(t,n,s){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ce,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,n){return`${this.Do}/v1/${n}:${nf[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){const i=Ra();return new Promise((o,u)=>{const h=new D;h.setWithCredentials(!0),h.listenOnce(N.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case w.NO_ERROR:const g=h.getResponseJson();de(tn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(g)),o(g);break;case w.TIMEOUT:de(tn,`RPC '${e}' ${i} timed out`),u(new ye(Q.DEADLINE_EXCEEDED,"Request time out"));break;case w.HTTP_ERROR:const T=h.getStatus();if(de(tn,`RPC '${e}' ${i} failed with status:`,T,"response text:",h.getResponseText()),T>0){let O=h.getResponseJson();Array.isArray(O)&&(O=O[0]);const ne=O?.error;if(ne&&ne.status&&ne.message){const Se=function(De){const Je=De.toLowerCase().replace(/_/g,"-");return Object.values(Q).indexOf(Je)>=0?Je:Q.UNKNOWN}(ne.status);u(new ye(Se,ne.message))}else u(new ye(Q.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new ye(Q.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{de(tn,`RPC '${e}' ${i} completed.`)}});const f=JSON.stringify(s);de(tn,`RPC '${e}' ${i} sending request:`,s),h.send(t,"POST",f,n,15)})}Bo(e,t,n){const s=Ra(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ce(),u=pe(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.xmlHttpFactory=new Ae({})),this.Oo(h.initMessageHeaders,t,n),h.encodeInitMessageHeaders=!0;const g=i.join("");de(tn,`Creating RPC '${e}' stream ${s}: ${g}`,h);const T=o.createWebChannel(g,h);let O=!1,ne=!1;const Se=new rf({Io:De=>{ne?de(tn,`Not sending because RPC '${e}' stream ${s} is closed:`,De):(O||(de(tn,`Opening RPC '${e}' stream ${s} transport.`),T.open(),O=!0),de(tn,`RPC '${e}' stream ${s} sending:`,De),T.send(De))},To:()=>T.close()}),Ve=(De,Je,ot)=>{De.listen(Je,et=>{try{ot(et)}catch(dt){setTimeout(()=>{throw dt},0)}})};return Ve(T,H.EventType.OPEN,()=>{ne||(de(tn,`RPC '${e}' stream ${s} transport opened.`),Se.yo())}),Ve(T,H.EventType.CLOSE,()=>{ne||(ne=!0,de(tn,`RPC '${e}' stream ${s} transport closed`),Se.So())}),Ve(T,H.EventType.ERROR,De=>{ne||(ne=!0,oe(tn,`RPC '${e}' stream ${s} transport errored:`,De),Se.So(new ye(Q.UNAVAILABLE,"The operation could not be completed")))}),Ve(T,H.EventType.MESSAGE,De=>{var Je;if(!ne){const ot=De.data[0];te(!!ot);const dt=ot.error||(null===(Je=ot[0])||void 0===Je?void 0:Je.error);if(dt){de(tn,`RPC '${e}' stream ${s} received error:`,dt);const Tt=dt.status;let mt=function(j){const Z=$t[j];if(void 0!==Z)return yu(Z)}(Tt),X=dt.message;void 0===mt&&(mt=Q.INTERNAL,X="Unknown error status: "+Tt+" with message "+dt.message),ne=!0,Se.So(new ye(mt,X)),T.close()}else de(tn,`RPC '${e}' stream ${s} received:`,ot),Se.bo(ot)}}),Ve(u,me.STAT_EVENT,De=>{De.stat===q.PROXY?de(tn,`RPC '${e}' stream ${s} detected buffering proxy`):De.stat===q.NOPROXY&&de(tn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{Se.wo()},0),Se}}function Ui(){return typeof document<"u"?document:null}function Ms(r){return new dm(r,!0)}class Oa{constructor(e,t,n=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&de("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Rh{constructor(e,t,n,s,i,o,u,h){this.ui=e,this.Ho=n,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Oa(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,l.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,l.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,l.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===Q.RESOURCE_EXHAUSTED?(Be(t.toString()),Be("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===Q.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{const s=new ye(Q.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>1==++this.e_?this.E_(s):this.onNext(s))})}i_(){var e=this;this.state=5,this.t_.Go((0,l.A)(function*(){e.state=0,e.start()}))}I_(e){return de("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(de("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class of extends Rh{constructor(e,t,n,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function fm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:L(),s=e.targetChange.targetIds||[],i=function(f,g){return f.useProto3Json?(te(void 0===g||"string"==typeof g),zt.fromBase64String(g||"")):(te(void 0===g||g instanceof Buffer||g instanceof Uint8Array),zt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(f){const g=void 0===f.code?Q.UNKNOWN:yu(f.code);return new ye(g,f.message||"")}(o);t=new bu(n,s,i,u||null)}else if("documentChange"in e){const n=e.documentChange,s=Tn(r,n.document.name),i=Lt(n.document.updateTime),o=n.document.createTime?Lt(n.document.createTime):xe.min(),u=new Qt({mapValue:{fields:n.document.fields}}),h=Ot.newFoundDocument(s,i,o,u);t=new Ci(n.targetIds||[],n.removedTargetIds||[],h.key,h)}else if("documentDelete"in e){const n=e.documentDelete,s=Tn(r,n.document),i=n.readTime?Lt(n.readTime):xe.min(),o=Ot.newNoDocument(s,i);t=new Ci([],n.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const n=e.documentRemove,s=Tn(r,n.document);t=new Ci([],n.removedTargetIds||[],s,null)}else{if(!("filter"in e))return L();{const n=e.filter,{count:s=0,unchangedNames:i}=n,o=new om(s,i);t=new Tu(n.targetId,o)}}var f;return t}(this.serializer,e),n=function(i){if(!("targetChange"in i))return xe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?xe.min():o.readTime?Lt(o.readTime):xe.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=oa(this.serializer),t.addTarget=function(i,o){let u;const h=o.target;if(u=wi(h)?{documents:Du(i,h)}:{query:Si(i,h)._t},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=Cu(i,o.resumeToken);const f=ra(i,o.expectedCount);null!==f&&(u.expectedCount=f)}else if(o.snapshotVersion.compareTo(xe.min())>0){u.readTime=Mr(i,o.snapshotVersion.toTimestamp());const f=ra(i,o.expectedCount);null!==f&&(u.expectedCount=f)}return u}(this.serializer,e);const n=function gm(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=oa(this.serializer),t.removeTarget=e,this.a_(t)}}class af extends Rh{constructor(e,t,n,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return te(!!e.streamToken),this.lastStreamToken=e.streamToken,te(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){te(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function pm(r,e){return r&&r.length>0?(te(void 0!==e),r.map(t=>function(s,i){let o=Lt(s.updateTime?s.updateTime:i);return o.isEqual(xe.min())&&(o=Lt(i)),new rm(o,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Lt(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=oa(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Es(r,e){let t;if(e instanceof Pr)t={update:ku(r,e.key,e.value)};else if(e instanceof kr)t={delete:Is(r,e.key)};else if(e instanceof Pn)t={update:ku(r,e.key,e.data),updateMask:xm(e.fieldMask)};else{if(!(e instanceof Ho))return L();t={verify:Is(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const u=o.transform;if(u instanceof Rr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ir)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof or)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Or)return{fieldPath:o.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:_m(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:L()),t;var i}(this.serializer,n))};this.a_(t)}}class lf extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ye(Q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,ia(t,n),s,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ye(Q.UNKNOWN,i.toString())})}Lo(e,t,n,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Lo(e,ia(t,n),s,o,u,i)).catch(o=>{throw"FirebaseError"===o.name?(o.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ye(Q.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class cf{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Be(t),this.D_=!1):de("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class uf{constructor(e,t,n,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(u=>{n.enqueueAndForget((0,l.A)(function*(){var h;Kn(o)&&(de("RemoteStore","Restarting streams for network reachability change."),yield(h=(0,l.A)(function*(g){const T=be(g);T.L_.add(4),yield Lr(T),T.q_.set("Unknown"),T.L_.delete(4),yield Ds(T)}),function f(g){return h.apply(this,arguments)})(o))}))}),this.q_=new cf(n,s)}}function Ds(r){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,l.A)(function*(r){if(Kn(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Lr(r){return ka.apply(this,arguments)}function ka(){return(ka=(0,l.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function $i(r,e){const t=be(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Fa(t)?Da(t):$r(t).r_()&&Ma(t,e))}function Gr(r,e){const t=be(r),n=$r(t);t.N_.delete(e),n.r_()&&Oh(t,e),0===t.N_.size&&(n.r_()?n.o_():Kn(t)&&t.q_.set("Unknown"))}function Ma(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(xe.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}$r(r).A_(e)}function Oh(r,e){r.Q_.xe(e),$r(r).R_(e)}function Da(r){r.Q_=new lm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),$r(r).start(),r.q_.v_()}function Fa(r){return Kn(r)&&!$r(r).n_()&&r.N_.size>0}function Kn(r){return 0===be(r).L_.size}function Ph(r){r.Q_=void 0}function hf(r){return Va.apply(this,arguments)}function Va(){return(Va=(0,l.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function df(r){return Na.apply(this,arguments)}function Na(){return(Na=(0,l.A)(function*(r){r.N_.forEach((e,t)=>{Ma(r,e)})})).apply(this,arguments)}function _f(r,e){return za.apply(this,arguments)}function za(){return(za=(0,l.A)(function*(r,e){Ph(r),Fa(r)?(r.q_.M_(e),Da(r)):r.q_.set("Unknown")})).apply(this,arguments)}function mf(r,e,t){return ja.apply(this,arguments)}function ja(){return ja=(0,l.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof bu&&2===e.state&&e.cause)try{yield(n=(0,l.A)(function*(i,o){const u=o.cause;for(const h of o.targetIds)i.N_.has(h)&&(yield i.remoteSyncer.rejectListen(h,u),i.N_.delete(h),i.Q_.removeTarget(h))}),function s(i,o){return n.apply(this,arguments)})(r,e)}catch(n){de("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield qi(r,n)}else if(e instanceof Ci?r.Q_.Ke(e):e instanceof Tu?r.Q_.He(e):r.Q_.We(e),!t.isEqual(xe.min()))try{const n=yield vh(r.localStore);t.compareTo(n)>=0&&(yield function(i,o){const u=i.Q_.rt(o);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const g=i.N_.get(f);g&&i.N_.set(f,g.withResumeToken(h.resumeToken,o))}}),u.targetMismatches.forEach((h,f)=>{const g=i.N_.get(h);if(!g)return;i.N_.set(h,g.withResumeToken(zt.EMPTY_BYTE_STRING,g.snapshotVersion)),Oh(i,h);const T=new kn(g.target,h,f,g.sequenceNumber);Ma(i,T)}),i.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){de("RemoteStore","Failed to raise snapshot:",n),yield qi(r,n)}var n}),ja.apply(this,arguments)}function qi(r,e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,l.A)(function*(r,e,t){if(!ht(e))throw e;r.L_.add(1),yield Lr(r),r.q_.set("Offline"),t||(t=()=>vh(r.localStore)),r.asyncQueue.enqueueRetryable((0,l.A)(function*(){de("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Ds(r)}))})).apply(this,arguments)}function kh(r,e){return e().catch(t=>qi(r,t,e))}function Ur(r){return La.apply(this,arguments)}function La(){return(La=(0,l.A)(function*(r){const e=be(r),t=Yn(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;ff(e);)try{const s=yield Hm(e.localStore,n);if(null===s){0===e.O_.length&&t.o_();break}n=s.batchId,pf(e,s)}catch(s){yield qi(e,s)}Mh(e)&&Dh(e)})).apply(this,arguments)}function ff(r){return Kn(r)&&r.O_.length<10}function pf(r,e){r.O_.push(e);const t=Yn(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Mh(r){return Kn(r)&&!Yn(r).n_()&&r.O_.length>0}function Dh(r){Yn(r).start()}function gf(r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,l.A)(function*(r){Yn(r).p_()})).apply(this,arguments)}function yf(r){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,l.A)(function*(r){const e=Yn(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function vf(r,e,t){return $a.apply(this,arguments)}function $a(){return($a=(0,l.A)(function*(r,e,t){const n=r.O_.shift(),s=ea.from(n,e,t);yield kh(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Ur(r)})).apply(this,arguments)}function wf(r,e){return qa.apply(this,arguments)}function qa(){return qa=(0,l.A)(function*(r,e){var t;e&&Yn(r).V_&&(yield(t=(0,l.A)(function*(s,i){if(function gu(r){switch(r){default:return L();case Q.CANCELLED:case Q.UNKNOWN:case Q.DEADLINE_EXCEEDED:case Q.RESOURCE_EXHAUSTED:case Q.INTERNAL:case Q.UNAVAILABLE:case Q.UNAUTHENTICATED:return!1;case Q.INVALID_ARGUMENT:case Q.NOT_FOUND:case Q.ALREADY_EXISTS:case Q.PERMISSION_DENIED:case Q.FAILED_PRECONDITION:case Q.ABORTED:case Q.OUT_OF_RANGE:case Q.UNIMPLEMENTED:case Q.DATA_LOSS:return!0}}(u=i.code)&&u!==Q.ABORTED){const o=s.O_.shift();Yn(s).s_(),yield kh(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Ur(s)}var u}),function n(s,i){return t.apply(this,arguments)})(r,e)),Mh(r)&&Dh(r)}),qa.apply(this,arguments)}function Fh(r,e){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,l.A)(function*(r,e){const t=be(r);t.asyncQueue.verifyOperationInProgress(),de("RemoteStore","RemoteStore received new credentials");const n=Kn(t);t.L_.add(3),yield Lr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Ds(t)})).apply(this,arguments)}function Ka(r,e){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,l.A)(function*(r,e){const t=be(r);e?(t.L_.delete(2),yield Ds(t)):e||(t.L_.add(2),yield Lr(t),t.q_.set("Unknown"))})).apply(this,arguments)}function $r(r){return r.K_||(r.K_=function(t,n,s){const i=be(t);return i.w_(),new of(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:hf.bind(null,r),Ro:df.bind(null,r),mo:_f.bind(null,r),d_:mf.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.K_.s_(),Fa(r)?Da(r):r.q_.set("Unknown")):(yield r.K_.stop(),Ph(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Yn(r){return r.U_||(r.U_=function(t,n,s){const i=be(t);return i.w_(),new af(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:gf.bind(null,r),mo:wf.bind(null,r),f_:yf.bind(null,r),g_:vf.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.U_.s_(),yield Ur(r)):(yield r.U_.stop(),r.O_.length>0&&(de("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Qa{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const o=Date.now()+n,u=new Qa(e,t,o,s,i);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ye(Q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qr(r,e){if(Be("AsyncQueue",`${e}: ${r}`),ht(r))return new ye(Q.UNAVAILABLE,`${e}: ${r}`);throw r}class Wr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||se.comparator(t.key,n.key):(t,n)=>se.comparator(t.key,n.key),this.keyedMap=gs(),this.sortedSet=new Rt(this.comparator)}static emptySet(e){return new Wr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Wr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Vh{constructor(){this.W_=new Rt(se.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):L():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Kr{constructor(e,t,n,s,i,o,u,h,f){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,n,s,i){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new Kr(e,t,Wr.emptySet(t),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class xf{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Tf{constructor(){this.queries=Nh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const s=be(t),i=s.queries;s.queries=Nh(),i.forEach((o,u)=>{for(const h of u.j_)h.onError(n)})}(this,new ye(Q.ABORTED,"Firestore shutting down"))}}function Nh(){return new On(r=>Hc(r),fs)}function Xa(r,e){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,l.A)(function*(r,e){const t=be(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(n=2):(i=new xf,n=e.J_()?0:1);try{switch(n){case 0:i.z_=yield t.onListen(s,!0);break;case 1:i.z_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){const u=qr(o,`Initialization of query '${Sr(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&el(t)})).apply(this,arguments)}function Ha(r,e){return Za.apply(this,arguments)}function Za(){return(Za=(0,l.A)(function*(r,e){const t=be(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),0===i.j_.length?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function bf(r,e){const t=be(r);let n=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const u of o.j_)u.X_(s)&&(n=!0);o.z_=s}}n&&el(t)}function If(r,e,t){const n=be(r),s=n.queries.get(e);if(s)for(const i of s.j_)i.onError(t);n.queries.delete(e)}function el(r){r.Y_.forEach(e=>{e.next()})}var tl,zh;(zh=tl||(tl={})).ea="default",zh.Cache="cache";class nl{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)3!==s.type&&n.push(s);e=new Kr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=Kr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==tl.Cache}}class Lh{constructor(e){this.key=e}}class Gh{constructor(e){this.key=e}}class Uh{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=_t(),this.mutatedKeys=_t(),this.Aa=eu(e),this.Ra=new Wr(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Vh,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,u=!1;const h="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,f="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((g,T)=>{const O=s.get(g),ne=ps(this.query,T)?T:null,Se=!!O&&this.mutatedKeys.has(O.key),Ve=!!ne&&(ne.hasLocalMutations||this.mutatedKeys.has(ne.key)&&ne.hasCommittedMutations);let De=!1;O&&ne?O.data.isEqual(ne.data)?Se!==Ve&&(n.track({type:3,doc:ne}),De=!0):this.ga(O,ne)||(n.track({type:2,doc:ne}),De=!0,(h&&this.Aa(ne,h)>0||f&&this.Aa(ne,f)<0)&&(u=!0)):!O&&ne?(n.track({type:0,doc:ne}),De=!0):O&&!ne&&(n.track({type:1,doc:O}),De=!0,(h||f)&&(u=!0)),De&&(ne?(o=o.add(ne),i=Ve?i.add(g):i.delete(g)):(o=o.delete(g),i=i.delete(g)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const g="F"===this.query.limitType?o.last():o.first();o=o.delete(g.key),i=i.delete(g.key),n.track({type:1,doc:g})}return{Ra:o,fa:n,ns:u,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((g,T)=>function(ne,Se){const Ve=De=>{switch(De){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return Ve(ne)-Ve(Se)}(g.type,T.type)||this.Aa(g.doc,T.doc)),this.pa(n),s=null!=s&&s;const u=t&&!s?this.ya():[],h=0===this.da.size&&this.current&&!s?1:0,f=h!==this.Ea;return this.Ea=h,0!==o.length||f?{snapshot:new Kr(this.query,e.Ra,i,o,e.mutatedKeys,0===h,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Vh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=_t(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Gh(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Lh(n))}),t}ba(e){this.Ta=e.Ts,this.da=_t();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Kr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Cf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Sf{constructor(e){this.key=e,this.va=!1}}class Rf{constructor(e,t,n,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new On(u=>Hc(u),fs),this.Ma=new Map,this.xa=new Set,this.Oa=new Rt(se.comparator),this.Na=new Map,this.La=new fa,this.Ba={},this.ka=new Map,this.qa=dr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function Of(r,e){return rl.apply(this,arguments)}function rl(){return(rl=(0,l.A)(function*(r,e,t=!0){const n=Wi(r);let s;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=yield $h(n,e,t,!0),s})).apply(this,arguments)}function Pf(r,e){return sl.apply(this,arguments)}function sl(){return(sl=(0,l.A)(function*(r,e){const t=Wi(r);yield $h(t,e,!0,!1)})).apply(this,arguments)}function $h(r,e,t,n){return il.apply(this,arguments)}function il(){return(il=(0,l.A)(function*(r,e,t,n){const s=yield function jr(r,e){const t=be(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(i=>i?(s=i,M.resolve(s)):t.Ur.allocateTargetId(n).next(o=>(s=new kn(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.os.get(n.targetId);return(null===s||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}(r.localStore,Zt(e)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let u;return n&&(u=yield function ol(r,e,t,n,s){return al.apply(this,arguments)}(r,e,i,"current"===o,s.resumeToken)),r.isPrimaryClient&&t&&$i(r.remoteStore,s),u})).apply(this,arguments)}function al(){return al=(0,l.A)(function*(r,e,t,n,s){r.Ka=(T,O,ne)=>{return(Se=(0,l.A)(function*(De,Je,ot,et){let dt=Je.view.ma(ot);dt.ns&&(dt=yield ji(De.localStore,Je.query,!1).then(({documents:k})=>Je.view.ma(k,dt)));const Tt=et&&et.targetChanges.get(Je.targetId),mt=et&&null!=et.targetMismatches.get(Je.targetId),X=Je.view.applyChanges(dt,De.isPrimaryClient,Tt,mt);return yl(De,Je.targetId,X.wa),X.snapshot}),function Ve(De,Je,ot,et){return Se.apply(this,arguments)})(r,T,O,ne);var Se};const i=yield ji(r.localStore,e,!0),o=new Uh(e,i.Ts),u=o.ma(i.documents),h=bs.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,s),f=o.applyChanges(u,r.isPrimaryClient,h);yl(r,t,f.wa);const g=new Cf(e,t,o);return r.Fa.set(e,g),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),f.snapshot}),al.apply(this,arguments)}function kf(r,e,t){return ll.apply(this,arguments)}function ll(){return(ll=(0,l.A)(function*(r,e,t){const n=be(r),s=n.Fa.get(e),i=n.Ma.get(s.targetId);if(i.length>1)return n.Ma.set(s.targetId,i.filter(o=>!fs(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Br(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Gr(n.remoteStore,s.targetId),Yr(n,s.targetId)}).catch(We))):(Yr(n,s.targetId),yield Br(n.localStore,s.targetId,!0))})).apply(this,arguments)}function Mf(r,e){return cl.apply(this,arguments)}function cl(){return(cl=(0,l.A)(function*(r,e){const t=be(r),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&1===s.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Gr(t.remoteStore,n.targetId))})).apply(this,arguments)}function ul(){return(ul=(0,l.A)(function*(r,e,t){const n=function Rl(r){const e=be(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Nf.bind(null,e),e}(r);try{const s=yield function(o,u){const h=be(o),f=Ie.now(),g=u.reduce((ne,Se)=>ne.add(Se.key),_t());let T,O;return h.persistence.runTransaction("Locally write mutations","readwrite",ne=>{let Se=hn(),Ve=_t();return h.cs.getEntries(ne,g).next(De=>{Se=De,Se.forEach((Je,ot)=>{ot.isValidDocument()||(Ve=Ve.add(Je))})}).next(()=>h.localDocuments.getOverlayedDocuments(ne,Se)).next(De=>{T=De;const Je=[];for(const ot of u){const et=im(ot,T.get(ot.key).overlayedDocument);null!=et&&Je.push(new Pn(ot.key,et,Vc(et.value.mapValue),Mt.exists(!0)))}return h.mutationQueue.addMutationBatch(ne,f,Je,u)}).next(De=>{O=De;const Je=De.applyToLocalDocumentSet(T,Ve);return h.documentOverlayCache.saveOverlays(ne,De.batchId,Je)})}).then(()=>({batchId:O.batchId,changes:nu(T)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,u,h){let f=o.Ba[o.currentUser.toKey()];f||(f=new Rt(S)),f=f.insert(u,h),o.Ba[o.currentUser.toKey()]=f}(n,s.batchId,t),yield Mn(n,s.changes),yield Ur(n.remoteStore)}catch(s){const i=qr(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function qh(r,e){return hl.apply(this,arguments)}function hl(){return(hl=(0,l.A)(function*(r,e){const t=be(r);try{const n=yield function Jm(r,e){const t=be(r),n=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const u=[];e.targetChanges.forEach((g,T)=>{const O=s.get(T);if(!O)return;u.push(t.Ur.removeMatchingKeys(i,g.removedDocuments,T).next(()=>t.Ur.addMatchingKeys(i,g.addedDocuments,T)));let ne=O.withSequenceNumber(i.currentSequenceNumber);var Ve,De,Je;null!==e.targetMismatches.get(T)?ne=ne.withResumeToken(zt.EMPTY_BYTE_STRING,xe.min()).withLastLimboFreeSnapshotVersion(xe.min()):g.resumeToken.approximateByteSize()>0&&(ne=ne.withResumeToken(g.resumeToken,n)),s=s.insert(T,ne),De=ne,Je=g,(0===(Ve=O).resumeToken.approximateByteSize()||De.snapshotVersion.toMicroseconds()-Ve.snapshotVersion.toMicroseconds()>=3e8||Je.addedDocuments.size+Je.modifiedDocuments.size+Je.removedDocuments.size>0)&&u.push(t.Ur.updateTargetData(i,ne))});let h=hn(),f=_t();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(i,g))}),u.push(function wh(r,e,t){let n=_t(),s=_t();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=hn();return t.forEach((u,h)=>{const f=i.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(xe.min())?(e.removeEntry(u,h.readTime),o=o.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||0===h.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(h),o=o.insert(u,h)):de("LocalStore","Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)}),{Ps:o,Is:s}})}(i,o,e.documentUpdates).next(g=>{h=g.Ps,f=g.Is})),!n.isEqual(xe.min())){const g=t.Ur.getLastRemoteSnapshotVersion(i).next(T=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(g)}return M.waitFor(u).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,h,f)).next(()=>h)}).then(i=>(t.os=s,i))}(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(te(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?te(o.va):s.removedDocuments.size>0&&(te(o.va),o.va=!1))}),yield Mn(t,n,e)}catch(n){yield We(n)}})).apply(this,arguments)}function Wh(r,e,t){const n=be(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const s=[];n.Fa.forEach((i,o)=>{const u=o.view.Z_(e);u.snapshot&&s.push(u.snapshot)}),function(o,u){const h=be(o);h.onlineState=u;let f=!1;h.queries.forEach((g,T)=>{for(const O of T.j_)O.Z_(u)&&(f=!0)}),f&&el(h)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Ff(r,e,t){return dl.apply(this,arguments)}function dl(){return(dl=(0,l.A)(function*(r,e,t){const n=be(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Na.get(e),i=s&&s.key;if(i){let o=new Rt(se.comparator);o=o.insert(i,Ot.newNoDocument(i,xe.min()));const u=_t().add(i),h=new Ts(xe.min(),new Map,new Rt(S),o,u);yield qh(n,h),n.Oa=n.Oa.remove(i),n.Na.delete(e),vl(n)}else yield Br(n.localStore,e,!1).then(()=>Yr(n,e,t)).catch(We)})).apply(this,arguments)}function Vf(r,e){return _l.apply(this,arguments)}function _l(){return(_l=(0,l.A)(function*(r,e){const t=be(r),n=e.batch.batchId;try{const s=yield function Xm(r,e){const t=be(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,h,f,g){const T=f.batch,O=T.keys();let ne=M.resolve();return O.forEach(Se=>{ne=ne.next(()=>g.getEntry(h,Se)).next(Ve=>{const De=f.docVersions.get(Se);te(null!==De),Ve.version.compareTo(De)<0&&(T.applyToRemoteDocument(Ve,f),Ve.isValidDocument()&&(Ve.setReadTime(f.commitVersion),g.addEntry(Ve)))})}),ne.next(()=>u.mutationQueue.removeMutationBatch(h,T))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let h=_t();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}(t.localStore,e);gl(t,n,null),pl(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Mn(t,s)}catch(s){yield We(s)}})).apply(this,arguments)}function Nf(r,e,t){return ml.apply(this,arguments)}function ml(){return(ml=(0,l.A)(function*(r,e,t){const n=be(r);try{const s=yield function(o,u){const h=be(o);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return h.mutationQueue.lookupMutationBatch(f,u).next(T=>(te(null!==T),g=T.keys(),h.mutationQueue.removeMutationBatch(f,T))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,g,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>h.localDocuments.getDocuments(f,g))})}(n.localStore,e);gl(n,e,t),pl(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Mn(n,s)}catch(s){yield We(s)}})).apply(this,arguments)}function pl(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function gl(r,e,t){const n=be(r);let s=n.Ba[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function Yr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Kh(r,n)})}function Kh(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Gr(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),vl(r))}function yl(r,e,t){for(const n of t)n instanceof Lh?(r.La.addReference(n.key,e),jf(r,n)):n instanceof Gh?(de("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Kh(r,n.key)):L()}function jf(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(de("SyncEngine","New document in limbo: "+t),r.xa.add(n),vl(r))}function vl(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new se(Me.fromString(e)),n=r.qa.next();r.Na.set(n,new Sf(t)),r.Oa=r.Oa.insert(t,n),$i(r.remoteStore,new kn(Zt(Ar(t.path)),n,"TargetPurposeLimboResolution",Bt.oe))}}function Mn(r,e,t){return wl.apply(this,arguments)}function wl(){return wl=(0,l.A)(function*(r,e,t){const n=be(r),s=[],i=[],o=[];var u;n.Fa.isEmpty()||(n.Fa.forEach((u,h)=>{o.push(n.Ka(h,e,t).then(f=>{var g;if((f||t)&&n.isPrimaryClient){const T=f?!f.fromCache:null===(g=t?.targetChanges.get(h.targetId))||void 0===g?void 0:g.current;n.sharedClientState.updateQueryState(h.targetId,T?"current":"not-current")}if(f){s.push(f);const T=wa.Wi(h.targetId,f);i.push(T)}}))}),yield Promise.all(o),n.Ca.d_(s),yield(u=(0,l.A)(function*(f,g){const T=be(f);try{yield T.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>M.forEach(g,ne=>M.forEach(ne.$i,Se=>T.persistence.referenceDelegate.addReference(O,ne.targetId,Se)).next(()=>M.forEach(ne.Ui,Se=>T.persistence.referenceDelegate.removeReference(O,ne.targetId,Se)))))}catch(O){if(!ht(O))throw O;de("LocalStore","Failed to update sequence numbers: "+O)}for(const O of g){const ne=O.targetId;if(!O.fromCache){const Se=T.os.get(ne),De=Se.withLastLimboFreeSnapshotVersion(Se.snapshotVersion);T.os=T.os.insert(ne,De)}}}),function h(f,g){return u.apply(this,arguments)})(n.localStore,i))}),wl.apply(this,arguments)}function Bf(r,e){return xl.apply(this,arguments)}function xl(){return(xl=(0,l.A)(function*(r,e){const t=be(r);if(!t.currentUser.isEqual(e)){de("SyncEngine","User change. New user:",e.toKey());const n=yield yh(t.localStore,e);t.currentUser=e,(i=t).ka.forEach(u=>{u.forEach(h=>{h.reject(new ye(Q.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Mn(t,n.hs)}var i})).apply(this,arguments)}function Lf(r,e){const t=be(r),n=t.Na.get(e);if(n&&n.va)return _t().add(n.key);{let s=_t();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const u=t.Fa.get(o);s=s.unionWith(u.view.Va)}return s}}function Wi(r){const e=be(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=qh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Lf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ff.bind(null,e),e.Ca.d_=bf.bind(null,e.eventManager),e.Ca.$a=If.bind(null,e.eventManager),e}class Qr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,l.A)(function*(){t.serializer=Ms(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function gh(r,e,t,n){return new Qm(r,e,t,n)}(this.persistence,new ph,e.initialUser,this.serializer)}createPersistence(e){return new pa(Vi.Zr,this.serializer)}createSharedClientState(e){return new Ah}terminate(){var e=this;return(0,l.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Xr{initialize(e,t){var n=this;return(0,l.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=s=>Wh(n.syncEngine,s,1),n.remoteStore.remoteSyncer.handleCredentialChange=Bf.bind(null,n.syncEngine),yield Ka(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Tf}createDatastore(e){const t=Ms(e.databaseInfo.databaseId),n=new sf(e.databaseInfo);return new lf(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,s=this.datastore,i=e.asyncQueue,o=t=>Wh(this.syncEngine,t,0),u=Ch.D()?new Ch:new tf,new uf(n,s,i,o,u);var n,s,i,o,u}createSyncEngine(e,t){return function(s,i,o,u,h,f,g){const T=new Rf(s,i,o,u,h,f);return g&&(T.Qa=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,l.A)(function*(){var t,n,s;yield(s=(0,l.A)(function*(o){const u=be(o);de("RemoteStore","RemoteStore shutting down."),u.L_.add(5),yield Lr(u),u.k_.shutdown(),u.q_.set("Unknown")}),function i(o){return s.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}class Ki{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Be("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ep{constructor(e,t,n,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Oe.UNAUTHENTICATED,this.clientId=G.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var o=(0,l.A)(function*(u){de("FirestoreClient","Received user=",u.uid),yield i.authCredentialListener(u),i.user=u});return function(u){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(n,o=>(de("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ye(Q.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,l.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const s=qr(n,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Yi(r,e){return Pl.apply(this,arguments)}function Pl(){return Pl=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),de("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var s=(0,l.A)(function*(i){n.isEqual(i)||(yield yh(e.localStore,i),n=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Pl.apply(this,arguments)}function kl(r,e){return Ml.apply(this,arguments)}function Ml(){return(Ml=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function Dl(r){return Fl.apply(this,arguments)}(r);de("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Fh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Fh(e.remoteStore,s)),r._onlineComponents=e})).apply(this,arguments)}function Fl(){return(Fl=(0,l.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){de("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Yi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Hh(r){return"FirebaseError"===r.name?r.code===Q.FAILED_PRECONDITION||r.code===Q.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}(t))throw t;oe("Error using user provided cache. Falling back to memory cache: "+t),yield Yi(r,new Qr)}}else de("FirestoreClient","Using default OfflineComponentProvider"),yield Yi(r,new Qr);return r._offlineComponents})).apply(this,arguments)}function Qi(r){return Vl.apply(this,arguments)}function Vl(){return(Vl=(0,l.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(de("FirestoreClient","Using user provided OnlineComponentProvider"),yield kl(r,r._uninitializedComponentsProvider._online)):(de("FirestoreClient","Using default OnlineComponentProvider"),yield kl(r,new Xr))),r._onlineComponents})).apply(this,arguments)}function Hr(r){return zl.apply(this,arguments)}function zl(){return(zl=(0,l.A)(function*(r){const e=yield Qi(r),t=e.eventManager;return t.onListen=Of.bind(null,e.syncEngine),t.onUnlisten=kf.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Pf.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Mf.bind(null,e.syncEngine),t})).apply(this,arguments)}function sd(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const id=new Map;function jl(r,e,t){if(!t)throw new ye(Q.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function od(r){if(!se.isDocumentKey(r))throw new ye(Q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ad(r){if(se.isDocumentKey(r))throw new ye(Q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Xi(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":L()}function pt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new ye(Q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xi(r);throw new ye(Q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class cd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ye(Q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ye(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function dp(r,e,t,n){if(!0===e&&!0===n)throw new ye(Q.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=sd(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new ye(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ye(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ye(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Fs{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ye(Q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ye(Q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cd(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new nt;switch(n.type){case"firstParty":return new He(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new ye(Q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=id.get(t);n&&(de("ComponentProvider","Removing Datastore"),id.delete(t),n.terminate())}(this),Promise.resolve()}}class Xt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Xt(this.firestore,e,this._query)}}class Gt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gt(this.firestore,e,this._key)}}class bn extends Xt{constructor(e,t,n){super(e,t,Ar(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gt(this.firestore,null,new se(e))}withConverter(e){return new bn(this.firestore,e,this._path)}}function Vs(r,e,...t){if(r=(0,Y.Ku)(r),jl("collection","path",e),r instanceof Fs){const n=Me.fromString(e,...t);return ad(n),new bn(r,null,n)}{if(!(r instanceof Gt||r instanceof bn))throw new ye(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Me.fromString(e,...t));return ad(n),new bn(r.firestore,null,n)}}function Zr(r,e,...t){if(r=(0,Y.Ku)(r),1===arguments.length&&(e=G.newId()),jl("doc","path",e),r instanceof Fs){const n=Me.fromString(e,...t);return od(n),new Gt(r,null,new se(n))}{if(!(r instanceof Gt||r instanceof bn))throw new ye(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Me.fromString(e,...t));return od(n),new Gt(r.firestore,r instanceof bn?r.converter:null,new se(n))}}class mp{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Oa(this,"async_queue_retry"),this.Eu=()=>{const t=Ui();t&&de("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=Ui();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=Ui();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new ct;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,l.A)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!ht(t))throw t;de("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,Be("INTERNAL UNHANDLED ERROR: ",function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),u}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const s=Qa.createAndSchedule(this,e,t,n,i=>this.Vu(i));return this.lu.push(s),s}du(){this.hu&&L()}verifyOperationInProgress(){}mu(){var e=this;return(0,l.A)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function Bl(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const s=t;for(const i of["next","error","complete"])if(i in s&&"function"==typeof s[i])return!0;return!1}(r)}class Ct extends Fs{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new mp,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||hd(this),this._firestoreClient.terminate()}}function Ll(r,e){const t="object"==typeof r?r:(0,m.getApp)(),n="string"==typeof r?r:e||"(default)",s=(0,m._getProvider)(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=(0,Y.yU)("firestore");i&&function _p(r,e,t,n={}){var s;const i=(r=pt(r,Fs))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&oe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let u,h;if("string"==typeof n.mockUserToken)u=n.mockUserToken,h=Oe.MOCK_USER;else{u=(0,Y.Fy)(n.mockUserToken,null===(s=r._app)||void 0===s?void 0:s.options.projectId);const f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new ye(Q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Oe(f)}r._authCredentials=new Et(new Dt(u,h))}}(s,...i)}return s}function Ft(r){return r._firestoreClient||hd(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function hd(r){var e,t,n;const s=r._freezeSettings(),i=(h=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new z_(r._databaseId,h,r._persistenceKey,(g=s).host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,sd(g.experimentalLongPollingOptions),g.useFetchStreams));var h,g;r._firestoreClient=new ep(r._authCredentials,r._appCheckCredentials,r._queue,i),null!==(t=s.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=s.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class mr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new mr(zt.fromBase64String(e))}catch(t){throw new ye(Q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new mr(zt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class fr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ye(Q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class es{constructor(e){this._methodName=e}}class Gl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ye(Q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ye(Q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return S(this._lat,e._lat)||S(this._long,e._long)}}class Ji{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,e._values)}}const yp=/^__.*__$/;class vp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Pn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pr(e,this.data,t,this.fieldTransforms)}}function fd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}class Hi{constructor(e,t,n,s,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.yu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new Hi(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.vu(e),s}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.yu(),s}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return to(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if(fd(this.wu)&&yp.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class wp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ms(e)}Nu(e,t,n,s=!1){return new Hi({wu:e,methodName:t,Ou:n,path:st.emptyPath(),Du:!1,xu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pr(r){const e=r._freezeSettings(),t=Ms(r._databaseId);return new wp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Zi(r,e,t,n,s,i={}){const o=r.Nu(i.merge||i.mergeFields?2:0,e,t,s);Ql("Data must be an object, but it was:",o,n);const u=yd(n,o);let h,f;if(i.merge)h=new un(o.fieldMask),f=o.fieldTransforms;else if(i.mergeFields){const g=[];for(const T of i.mergeFields){const O=js(e,T,t);if(!o.contains(O))throw new ye(Q.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);wd(g,O)||g.push(O)}h=new un(g),f=o.fieldTransforms.filter(T=>h.covers(T.field))}else h=null,f=o.fieldTransforms;return new vp(new Qt(u),h,f)}function gr(r,e){if(vd(r=(0,Y.Ku)(r)))return Ql("Unsupported field value:",e,r),yd(r,e);if(r instanceof es)return function(n,s){if(!fd(s.wu))throw s.Mu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Mu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,s){const i=[];let o=0;for(const u of n){let h=gr(u,s.Fu(o));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,s){if(null===(n=(0,Y.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return iu(s.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const i=Ie.fromDate(n);return{timestampValue:Mr(s.serializer,i)}}if(n instanceof Ie){const i=new Ie(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Mr(s.serializer,i)}}if(n instanceof Gl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof mr)return{bytesValue:Cu(s.serializer,n._byteString)};if(n instanceof Gt){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:sa(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Ji)return u=s,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(h=>{if("number"!=typeof h)throw u.Mu("VectorValues must only contain numeric values.");return Jo(u.serializer,h)})}}}}};var u;throw s.Mu(`Unsupported field value: ${Xi(n)}`)}(r,e)}function yd(r,e){const t={};return Ec(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Nt(r,(n,s)=>{const i=gr(s,e.bu(n));null!=i&&(t[n]=i)}),{mapValue:{fields:t}}}function vd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Ie||r instanceof Gl||r instanceof mr||r instanceof Gt||r instanceof es||r instanceof Ji)}function Ql(r,e,t){if(!vd(t)||"object"!=typeof(s=t)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){const n=Xi(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var s}function js(r,e,t){if((e=(0,Y.Ku)(e))instanceof fr)return e._internalPath;if("string"==typeof e)return eo(r,e);throw to("Field path arguments must be of type string or ",r,!1,void 0,t)}const xp=new RegExp("[~\\*/\\[\\]]");function eo(r,e,t){if(e.search(xp)>=0)throw to(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new fr(...e.split("."))._internalPath}catch{throw to(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function to(r,e,t,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${n}`),o&&(h+=` in document ${s}`),h+=")"),new ye(Q.INVALID_ARGUMENT,u+r+h)}function wd(r,e){return r.some(t=>t.isEqual(e))}class Bs{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Gt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Tp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Tp extends Bs{data(){return super.data()}}function no(r,e){return"string"==typeof e?eo(r,e):e instanceof fr?e._internalPath:e._delegate._internalPath}function xd(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new ye(Q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xl{}class Ls extends Xl{}function Td(r,e,...t){let n=[];e instanceof Xl&&n.push(e),n=n.concat(t),function(i){const o=i.filter(h=>h instanceof ts).length,u=i.filter(h=>h instanceof Gs).length;if(o>1||o>0&&u>0)throw new ye(Q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class Gs extends Ls{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Gs(e,t,n)}_apply(e){const t=this._parse(e);return Cd(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t))}_parse(e){const t=pr(e.firestore);return function(i,o,u,h,f,g,T){let O;if(f.isKeyField()){if("array-contains"===g||"array-contains-any"===g)throw new ye(Q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if("in"===g||"not-in"===g){Ad(T,g);const ne=[];for(const Se of T)ne.push(Ed(h,i,Se));O={arrayValue:{values:ne}}}else O=Ed(h,i,T)}else"in"!==g&&"not-in"!==g&&"array-contains-any"!==g||Ad(T,g),O=function gd(r,e,t,n=!1){return gr(t,r.Nu(n?4:3,e))}(u,"where",T,"in"===g||"not-in"===g);return vt.create(f,g,O)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function bd(r,e,t){const n=e,s=no("where",r);return Gs._create(s,n,t)}class ts extends Xl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ts(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:It.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(s,i){let o=s;const u=i.getFlattenedFilters();for(const h of u)Cd(o,h),o=Qo(o,h)}(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ed(r,e,t){if("string"==typeof(t=(0,Y.Ku)(t))){if(""===t)throw new ye(Q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yo(e)&&-1!==t.indexOf("/"))throw new ye(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Me.fromString(t));if(!se.isDocumentKey(n))throw new ye(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rr(r,new se(n))}if(t instanceof Gt)return rr(r,t._key);throw new ye(Q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xi(t)}.`)}function Ad(r,e){if(!Array.isArray(r)||0===r.length)throw new ye(Q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Cd(r,e){const t=function(s,i){for(const o of s)for(const u of o.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new ye(Q.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Rd{convertValue(e,t="none"){switch(Bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Nt(e,(s,i)=>{n[s]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,s;const i=null===(s=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map(o=>kt(o.doubleValue));return new Ji(i)}convertGeoPoint(e){return new Gl(kt(e.latitude),kt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=fi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cs(e));default:return null}}convertTimestamp(e){const t=Cn(e);return new Ie(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Me.fromString(e);te(ju(n));const s=new nr(n.get(1),n.get(3)),i=new se(n.popFirst(5));return s.isEqual(t)||Be(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class yr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ns extends Bs{constructor(e,t,n,s,i,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ao(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ao extends ns{data(e={}){return super.data(e)}}class rs{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new yr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ao(this._firestore,this._userDataWriter,n.key,n,new yr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ye(Q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(u=>({type:"added",doc:new ao(s._firestore,s._userDataWriter,u.doc.key,u.doc,new yr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:o++}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const h=new ao(s._firestore,s._userDataWriter,u.doc.key,u.doc,new yr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,g=-1;return 0!==u.type&&(f=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),g=o.indexOf(u.doc.key)),{type:Ep(u.type),doc:h,oldIndex:f,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ep(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}class Qn extends Rd{constructor(e){super(),this.firestore=e}convertBytes(e){return new mr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Gt(this.firestore,null,t)}}function Od(r){r=pt(r,Xt);const e=pt(r.firestore,Ct),t=Ft(e),n=new Qn(e);return xd(r._query),function rd(r,e,t={}){const n=new ct;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,f){const g=new Ki({next:O=>{o.enqueueAndForget(()=>Ha(i,T)),O.fromCache&&"server"===h.source?f.reject(new ye(Q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(O)},error:O=>f.reject(O)}),T=new nl(u,g,{includeMetadataChanges:!0,_a:!0});return Xa(i,T)}(yield Hr(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(s=>new rs(e,n,r,s))}function Pd(r,e,t){r=pt(r,Gt);const n=pt(r.firestore,Ct),s=function oo(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return Us(n,[Zi(pr(n),"setDoc",r._key,s,null!==r.converter,t).toMutation(r._key,Mt.none())])}function lo(r,...e){var t,n,s;r=(0,Y.Ku)(r);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Bl(e[o])||(i=e[o],o++);const u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Bl(e[o])){const T=e[o];e[o]=null===(t=T.next)||void 0===t?void 0:t.bind(T),e[o+1]=null===(n=T.error)||void 0===n?void 0:n.bind(T),e[o+2]=null===(s=T.complete)||void 0===s?void 0:s.bind(T)}let h,f,g;if(r instanceof Gt)f=pt(r.firestore,Ct),g=Ar(r._key.path),h={next:T=>{e[o]&&e[o](Hl(f,r,T))},error:e[o+1],complete:e[o+2]};else{const T=pt(r,Xt);f=pt(T.firestore,Ct),g=T._query;const O=new Qn(f);h={next:ne=>{e[o]&&e[o](new rs(f,O,T,ne))},error:e[o+1],complete:e[o+2]},xd(r._query)}return function(O,ne,Se,Ve){const De=new Ki(Ve),Je=new nl(ne,De,Se);return O.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Xa(yield Hr(O),Je)})),()=>{De.za(),O.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Ha(yield Hr(O),Je)}))}}(Ft(f),g,u,h)}function Us(r,e){return function(n,s){const i=new ct;return n.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function Df(r,e,t){return ul.apply(this,arguments)}(yield function Nl(r){return Qi(r).then(e=>e.syncEngine)}(n),s,i)})),i.promise}(Ft(r),e)}function Hl(r,e,t){const n=t.docs.get(e._key),s=new Qn(r);return new ns(r,s,e._key,n,new yr(t.hasPendingWrites,t.fromCache),e.converter)}!function(e,t=!0){Ce=m.SDK_VERSION,(0,m._registerComponent)(new x.uA("firestore",(n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),u=new Ct(new Qe(n.getProvider("auth-internal")),new J(n.getProvider("app-check-internal")),function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new ye(Q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nr(f.options.projectId,g)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,m.registerVersion)(ie,"4.7.2",e),(0,m.registerVersion)(ie,"4.7.2","esm2017")}();var qt=v(51698),Fd=v(43234),uo=v(48891),Bp=v(30531),Lp=v(36484),Gp=v(62095);let Up=(()=>{var r;class e{examSessions_read(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=yield s._getDocument(u.data,"exam_sessions/"+n,s.getUserId());i.next({success:1,data:h,message:"successful"}),i.complete()}catch(g){console.log(g),i.next({success:0,data:"",message:""+g}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_write(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_sessions/"+n,i.getUserId(),s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(T){console.log(T),o.next({success:0,data:"",message:""+T}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_writeUserMap(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success&&h.data)try{var f=yield i._saveDocumentMerge(h.data,"exam_sessions/"+n,"user_map",s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(T){console.log(T),o.next({success:0,data:"",message:""+T}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_delete(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{yield s._removeDocument(u.data,"exam_sessions/"+n,s.getUserId()),i.next({success:1,data:"",message:"successful"}),i.complete()}catch(f){console.log(f),i.next({success:0,data:"",message:""+f}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribeUserMap(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,"user_map",T=>{i.next({success:1,data:T,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(T){console.log(T),i.next({success:0,data:void 0,message:""+T}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,s.getUserId(),T=>{i.next({success:1,data:T,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(T){console.log(T),i.next({success:0,data:void 0,message:""+T}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_unsubscribe(n){this.removeAllunsubscribe("exam_sessions_"+n)}examSessions_subscribeWithQuery(n,s){var i=this;return new qt.c(s&&3==s.length?o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=i.myOnSnapshotCollectionWithQuery(h.data,"exam_sessions/"+n,s,O=>{o.next({success:1,data:O,message:"successful"}),o.complete()});i.addUnsubscribe("exam_sessions_"+n,f)}catch(O){console.log(O),o.next({success:0,data:void 0,message:""+O}),o.complete()}else o.next({success:0,data:void 0,message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())}:o=>{o.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),o.complete(),o.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshotCollection(u.data,"exam_live_teachers/"+n,f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_teachers_"+n,h)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_teachers_"+n)}examLiveTeachers_teacher_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_live_teachers/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._getDocuments(h.data,"exam_lives/"+n,s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_live_students/"+n,s.getUserId(),f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_students_"+n,h)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_teacher_subscribe(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=i.myOnSnapshot(h.data,"exam_live_students/"+n,s,g=>{o.next({success:1,data:g})});i.addUnsubscribe("exam_live_students_"+n,f)}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_student_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_live_students/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(n,s,i){var o=this;return new qt.c(u=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var h=(0,l.A)(function*(f){if(f&&1==f.success)try{var g=yield o._saveDocumentMerge(f.data,"exam_live_students/"+n,s,i);u.next({success:1,data:g})}catch(T){console.log(T),u.next({success:0,message:"EXCEPTION",ex:T.toString()})}else u.next(f)});return function(f){return h.apply(this,arguments)}}())})}getFirestoreDb(n){return new qt.c(s=>{var i=this.createFirestoreKey("firestore_db"),o=this.getLocalFirestoreDb(i);null!=o&&0==n?(s.next({success:1,data:o,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(h=>{h&&1==h.success?(0,c.p)(this.getAuthApp(),h?.data?.token??"").then(()=>{var g=Ll(this.app);this.setLocalFirestoreDb(i,g),s.next({success:1,data:g,message:"successful"}),s.complete()}).catch(g=>{"auth/invalid-custom-token"===g.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:h.message??""}),s.complete())})})}getFirestoreDbForStudentExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_student_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,c.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var T=Ll(this.app);this.setLocalFirestoreDb(o,T),i.next({success:1,data:T,message:"successful"}),i.complete()}).catch(T=>{"auth/invalid-custom-token"===T.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}getFirestoreDbForTeacherExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_teacher_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,c.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var T=Ll(this.app);this.setLocalFirestoreDb(o,T),i.next({success:1,data:T,message:"successful"}),i.complete()}).catch(T=>{"auth/invalid-custom-token"===T.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}signInUserByToken(n){return new qt.c(s=>{(0,c.p)(this.getAuthApp(),n).then(()=>{s.next({success:1,data:"",message:"successful"}),s.complete()}).catch(i=>{"auth/invalid-custom-token"===i.code?(s.next({success:0,data:"",message:"EXPIRED"}),s.complete()):(s.next({success:0,data:"",message:"AUTH_ERROR"}),s.complete())})})}setLocalFirestoreDb(n,s){this.firestoreDbs[n]=s}getLocalFirestoreDb(n){if(this.firestoreDbs.hasOwnProperty(n))return this.firestoreDbs[n]}removeLocalFirestoreDb(n){this.firestoreDbs.hasOwnProperty(n)&&delete this.firestoreDbs[n]}createFirestoreKey(n){return this.userService.getUserObj().id+"_"+n}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(n,s){n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)||(this.listSubscribers[n]=[]),this.listSubscribers[n].push(s)}removeAllunsubscribe(n){if(n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)){for(var s=0;s<this.listSubscribers[n].length;s++)this.listSubscribers[n][s]();delete this.listSubscribers[n]}}_saveDocument(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield Pd(Zr(n,s,i),u.commonSerivce.myClone(o)),i})()}_saveDocumentMerge(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield Pd(Zr(n,s,i),u.commonSerivce.myClone(o),{merge:!0}),i})()}_getCollection(n,s){var i=this;return(0,l.A)(function*(){s=i.getBaseFirestore()+"/"+s;const o=Vs(n,s);return(yield Od(o)).docs.map(f=>f.data())})()}_getDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s;const u=Zr(n,s,i),h=yield function Ap(r){r=pt(r,Gt);const e=pt(r.firestore,Ct);return function nd(r,e,t={}){const n=new ct;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,f){const g=new Ki({next:O=>{o.enqueueAndForget(()=>Ha(i,T));const ne=O.docs.has(u);!ne&&O.fromCache?f.reject(new ye(Q.UNAVAILABLE,"Failed to get document because the client is offline.")):ne&&O.fromCache&&h&&"server"===h.source?f.reject(new ye(Q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(O)},error:O=>f.reject(O)}),T=new nl(Ar(u.path),g,{includeMetadataChanges:!0,_a:!0});return Xa(i,T)}(yield Hr(r),r.asyncQueue,e,t,n)})),n.promise}(Ft(e),r._key).then(t=>Hl(e,r,t))}(u);return h.exists()?h.data():null})()}_getDocuments(n,s,i){var o=this;return(0,l.A)(function*(){var u={};s=o.getBaseFirestore()+"/"+s;const h=Td(Vs(n,s),bd(function gp(){return new fr("__name__")}(),"in",i));return(yield Od(h)).forEach(g=>{u[g.id]=g.data()}),u})()}_removeDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s,yield function Cp(r){return Us(pt(r.firestore,Ct),[new kr(r._key,Mt.none())])}(Zr(n,s,i))})()}myOnSnapshot(n,s,i,o){return lo(Zr(n,s=this.getBaseFirestore()+"/"+s,i),h=>{o(h.data())})}myOnSnapshotCollection(n,s,i){return lo(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var f=[];h.forEach(g=>{f.push(g.data())}),i(f)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(n,s,i){return lo(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var f=[];h.docChanges().forEach(g=>{f.push(g.doc.data())}),i(f)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(n,s,i,o){return lo(Td(Vs(n,s=this.getBaseFirestore()+"/"+s),bd(i[0],i[1],i[2])),function(){var f=(0,l.A)(function*(g){var T=[];g.docChanges().forEach(O=>{T.push(O.doc.data())}),o(T)});return function(g){return f.apply(this,arguments)}}())}getBaseFirestore(){return Fd.c.firestoreBase}getInitApp(){return this.app}getAuthApp(){return(0,c.xI)(this.app)}constructor(n,s,i){this.firestoreServiceApi=n,this.userService=s,this.commonSerivce=i,this.firestoreDbs={},this.listSubscribers={},this.app=(0,d.Wp)(Fd.c.firestoreConfig_app1,"firestoreapp")}}return(r=e).\u0275fac=function(n){return new(n||r)(uo.KVO(Bp.B),uo.KVO(Lp.R),uo.KVO(Gp.R))},r.\u0275prov=uo.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},69666:(gt,ke,v)=>{function l(){return typeof aztExam<"u"?aztExam:void 0}v.d(ke,{J:()=>Y});var d=v(43234),c=v(48891),m=v(36484),x=v(42802),C=v(38566);let Y=(()=>{var y;class ae{monitorAtTeacherDashboard(P){try{let D=l();if(typeof D>"u"||!D||!D.showMonitorTeacher)return;D.ver=this.monitorService.getMNoteVer();var R=this.userService.getUserObj();D.showMonitorTeacher({user:{token:R.rememberToken,userid:R.id,username:R.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live",urlExamResultGetLastExamResultOfStudentId:"ExamLivestream/GetLastExamResultOfStudentId"},roomid:P.roomId,examid:P.examId,userlist:P.userList,examconfig:P.examConfig,firebaseApp:this.fireStoreService,filetypeStr:P.fileTypeStr})}catch(D){console.log(D)}}monitorAtStudentDashboard(P,R){try{let D=l();if(typeof D>"u"||!D)return;D.ver=this.monitorService.getMNoteVer();var U=this.userService.getUserObj();D.loadMonitor(()=>{if(!D.MonitorStudent)return;var Ae={user:{token:U.rememberToken,userid:U.id,username:U.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:P,element:"monitorScreen",examconfig:R,firebaseApp:this.fireStoreService,isStarted:!1};D.MonitorStudent.getInstance().prepairSession(Ae);let N=window.setInterval(()=>{let w=document.getElementById("monitorScreen");if(w){let q=w.getElementsByTagName("div")[0];q&&(q.setAttribute("class","mx-auto"),clearInterval(N))}},50)})}catch(D){console.log(D)}}monitorAtTestPage(P,R,U){let D=l();if(typeof D>"u"||!D)return U(!1);var Ae=this.userService.getUserObj(),H=R;D.ver=this.monitorService.getMNoteVer(),D.loadMonitor(()=>{if(!D.MonitorStudent)return U(!1);var N={user:{token:Ae.rememberToken,userid:Ae.id,username:Ae.fullName,studentid:H?H.id:0,studentname:H?H.fullName:null},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:P.roomId,element:"monitorScreenTakeTest",examconfig:P.examConfig,examid:P.examId,firebaseApp:this.fireStoreService,resultid:P.resultId,isStarted:!0,clickFromIframeFunc:()=>{},clickFromIframeFuncCaller:this};D.MonitorStudent.getInstance().startSession(N),U(!0)})}destroyMonitorAtStudentDashboard(){try{let R=l();if(typeof R>"u"||!R||!R.MonitorStudent)return;R.MonitorStudent.getInstance().stopSession()}catch(R){console.log(R)}}constructor(P,R,U){this.userService=P,this.monitorService=R,this.fireStoreService=U}}return(y=ae).\u0275fac=function(P){return new(P||y)(c.KVO(m.R),c.KVO(x.Q),c.KVO(C.s))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),ae})()},42802:(gt,ke,v)=>{v.d(ke,{Q:()=>c});var l=v(48891),d=v(55465);let c=(()=>{var m;class x{constructor(Y){this.envService=Y}getTmpVersionMonitor(){var Y=this.envService.getEnvValue("classliveUrl"),y="1.0";if(Y){var ae=Y.split("=");ae.length>1&&(y=ae[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+y}getMNoteVer(){var Y=this.envService.getEnvValue("classliveUrl"),y="1.0";if(Y){var ae=Y.split("=");ae.length>1&&(y=ae[1])}return y}checkValidForSetUpMonitor(){return!0}}return(m=x).\u0275fac=function(Y){return new(Y||m)(l.KVO(d.t))},m.\u0275prov=l.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),x})()},51935:(gt,ke,v)=>{v.d(ke,{h:()=>st});var l=v(91478),d=v(89163),c=v(33887),m=v(48891),x=v(54460),C=v(2915),Y=v(15343),y=v(76975);const ae=()=>({"mr-2":!0});function V(se,Ye){if(1&se&&(m.j41(0,"li"),m.EFF(1),m.k0s()),2&se){const $e=Ye.$implicit;m.R7$(),m.SpI("* ",$e.message,"")}}function P(se,Ye){1&se&&(m.j41(0,"span",8),m.EFF(1),m.nI1(2,"mytranslate"),m.j41(3,"span",9),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.EFF(6),m.nI1(7,"mytranslate"),m.nI1(8,"mytranslate"),m.k0s()),2&se&&(m.R7$(),m.SpI(" ",m.bMT(2,4,"lang_auto_click")," "),m.R7$(3),m.SpI('"',m.bMT(5,6,"lang_auto_tai_ve"),'"'),m.R7$(2),m.Lme(" ",m.bMT(7,8,"lang_auto_de_tai_ve")," ",m.bMT(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function R(se,Ye){if(1&se){const $e=m.RV6();m.j41(0,"button",17),m.bIt("click",function(){m.eBV($e);const W=m.XpG();return m.Njj(W.onPressTrue())}),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()}2&se&&(m.R7$(),m.SpI(" ",m.bMT(2,1,"lang_auto_tai_ve")," "))}let U=(()=>{var se;class Ye extends c._{onPressTrue(){this.dialogRef.close(!0)}constructor(E,W){super(E,W),this.data=E,this.dialogRef=W,this.result=E.result}}return(se=Ye).\u0275fac=function(E){return new(E||se)(m.rXU(d.Vh),m.rXU(d.CP,8))},se.\u0275cmp=m.VBU({type:se,selectors:[["app-push-error-student-export-docx"]],features:[m.Vt3],decls:30,vars:25,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16",3,"ngClass"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(E,W){1&E&&(m.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.j41(6,"div",4)(7,"a",5),m.nrm(8,"lucide-icon",6),m.k0s()()(),m.j41(9,"div",7)(10,"span",8),m.EFF(11),m.nI1(12,"mytranslate"),m.j41(13,"span",9),m.EFF(14),m.k0s(),m.EFF(15),m.nI1(16,"mytranslate"),m.nI1(17,"lowercase"),m.k0s(),m.j41(18,"span",8),m.EFF(19),m.nI1(20,"mytranslate"),m.k0s(),m.j41(21,"azt-mat-dialog-content",10)(22,"ul",11),m.DNE(23,V,2,1,"li",12),m.k0s()(),m.DNE(24,P,9,12,"span",13),m.k0s(),m.j41(25,"div",14)(26,"a",15),m.EFF(27),m.nI1(28,"mytranslate"),m.k0s(),m.DNE(29,R,3,3,"button",16),m.k0s()()()),2&E&&(m.R7$(4),m.JRh(m.bMT(5,12,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),m.R7$(4),m.Y8G("ngClass",m.lJ4(24,ae)),m.R7$(3),m.SpI(" ",m.bMT(12,14,"lang_auto_he_thong_tao_thanh_cong_cho")," "),m.R7$(3),m.Lme("",W.result.datas.length,"/",W.result.errs.length+W.result.datas.length,""),m.R7$(),m.SpI(" ",m.bMT(17,18,m.bMT(16,16,"lang_auto_hoc_sinh"))," "),m.R7$(4),m.SpI(" ",m.bMT(20,20,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),m.R7$(2),m.Y8G("defaultHeight",60),m.R7$(2),m.Y8G("ngForOf",W.result.errs),m.R7$(),m.Y8G("ngIf",W.result.datas.length>0),m.R7$(3),m.SpI(" ",m.bMT(28,22,"lang_cms_common_close_btn")," "),m.R7$(2),m.Y8G("ngIf",W.result.datas.length>0))},dependencies:[x.YU,x.Sq,x.bT,d.tx,C.U,Y.WGl,x.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),Ye})();var D=v(10936),Ae=v(65080),H=v(68774),N=v(47712),w=v(5502),q=v(81587),me=v(90796),pe=v(69135),ce=v(14987);const ie=(se,Ye)=>({"box-classrooms":se,"box-max-classrooms":Ye});function Oe(se,Ye){if(1&se&&(m.j41(0,"span",31),m.EFF(1),m.k0s()),2&se){let $e;const E=m.XpG();m.R7$(),m.JRh(null!==($e=null==E.studentsInClassResults[0].classObj?null:E.studentsInClassResults[0].classObj.name)&&void 0!==$e?$e:"")}}function Ce(se,Ye){if(1&se&&(m.j41(0,"div",36)(1,"div",18),m.nrm(2,"input",37),m.j41(3,"label",38,0),m.EFF(5),m.k0s()()()),2&se){let $e;const E=Ye.$implicit,W=m.sdS(4),$=m.XpG(2);m.Y8G("hidden",1===$.studentsInClassResults.length),m.R7$(2),m.Mz_("id","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),m.Y8G("value",null==E.classObj?null:E.classObj.id),m.R7$(),m.Mz_("for","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),m.Y8G("matTooltip",null!==($e=null==E.classObj?null:E.classObj.name)&&void 0!==$e?$e:"")("isDisabledTooltip",!1)("matTooltipDisabled",W.isDisabled),m.R7$(2),m.JRh(null==E.classObj?null:E.classObj.name)}}function Ke(se,Ye){if(1&se&&(m.j41(0,"div",32)(1,"ng-scrollbar",33)(2,"div",34),m.DNE(3,Ce,6,10,"div",35),m.k0s()()()),2&se){const $e=m.XpG();m.Y8G("ngClass",m.l_i(3,ie,$e.form.controls.listStudents.controls.length>21||$e.studentsInClassResults.length>18,$e.form.controls.listStudents.controls.length<=21&&$e.studentsInClassResults.length>18)),m.R7$(),m.Y8G("visibility","hover"),m.R7$(2),m.Y8G("ngForOf",$e.studentsInClassResults)}}function Te(se,Ye){if(1&se&&(m.j41(0,"label",38,0),m.EFF(2),m.k0s()),2&se){const $e=m.sdS(1),E=m.XpG().$implicit;m.Mz_("for","select-classroom-export__",E.controls.id.value,""),m.Y8G("matTooltip",E.controls.label.value)("isDisabledTooltip",!1)("matTooltipDisabled",$e.isDisabled),m.R7$(2),m.SpI(" ",E.controls.label.value," ")}}function at(se,Ye){if(1&se&&(m.j41(0,"label",44),m.nrm(1,"img",45),m.k0s()),2&se){const $e=m.XpG().$implicit;m.Mz_("for","select-classroom-export__",$e.controls.id.value,""),m.R7$(),m.Y8G("nameImages",$e.controls.nameImages.value)}}function de(se,Ye){if(1&se){const $e=m.RV6();m.j41(0,"div",39)(1,"div",40)(2,"input",41),m.bIt("change",function(){m.eBV($e);const W=m.XpG();return m.Njj(W.onChangeStudentOption())}),m.k0s(),m.DNE(3,Te,3,6,"label",42)(4,at,2,3,"label",43),m.k0s()()}if(2&se){const $e=Ye.$implicit;m.R7$(),m.Y8G("formGroup",$e),m.R7$(),m.Mz_("id","select-classroom-export__",$e.controls.id.value,""),m.R7$(),m.Y8G("ngIf",$e.controls.label.value||!$e.controls.isImage.value),m.R7$(),m.Y8G("ngIf",!$e.controls.label.value&&$e.controls.isImage.value&&$e.controls.nameImages.value)}}function Be(se,Ye){1&se&&(m.j41(0,"span",27),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()),2&se&&(m.R7$(),m.SpI("* ",m.bMT(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function oe(se,Ye){if(1&se){const $e=m.RV6();m.j41(0,"div",49),m.bIt("click",function(){m.eBV($e);const W=m.XpG(2);return m.Njj(W.showAskInfo=!0)}),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()}2&se&&(m.R7$(),m.SpI("+ ",m.bMT(2,1,"lang_testbank_test_config_add_information"),""))}function Le(se,Ye){if(1&se&&(m.j41(0,"div"),m.nrm(1,"add-info-print",50),m.k0s()),2&se){const $e=m.XpG(2);m.R7$(),m.Y8G("form",$e.form)}}function L(se,Ye){1&se&&(m.j41(0,"span",53),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()),2&se&&(m.R7$(),m.SpI("(",m.bMT(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function te(se,Ye){if(1&se){const $e=m.RV6();m.j41(0,"div",51),m.bIt("click",function(){m.eBV($e);const W=m.XpG(2);return m.Njj(W.showAskInfo=!1)}),m.EFF(1),m.nI1(2,"mytranslate"),m.nI1(3,"mytranslate"),m.nI1(4,"lowercase"),m.DNE(5,L,3,3,"span",52),m.k0s()}if(2&se){const $e=m.XpG(2);m.R7$(),m.Lme(" ",m.bMT(2,3,"lang_auto_huy")," ",m.bMT(4,7,m.bMT(3,5,"lang_testbank_test_config_add_information"))," "),m.R7$(4),m.Y8G("ngIf",$e.isAskInfo&&$e.showAskInfo)}}function Ge(se,Ye){if(1&se&&(m.j41(0,"div")(1,"span",46),m.EFF(2),m.nI1(3,"mytranslate"),m.k0s(),m.DNE(4,oe,3,3,"div",47)(5,Le,2,1,"div",26)(6,te,6,9,"div",48),m.k0s()),2&se){const $e=m.XpG();m.R7$(2),m.Lme("* ",m.bMT(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",$e.countStudentSelect,""),m.R7$(2),m.Y8G("ngIf",$e.isAskInfo&&!$e.showAskInfo),m.R7$(),m.Y8G("ngIf",$e.isAskInfo&&$e.showAskInfo),m.R7$(),m.Y8G("ngIf",$e.isAskInfo&&$e.showAskInfo)}}function be(se,Ye){1&se&&(m.j41(0,"div")(1,"div",15)(2,"span",27),m.EFF(3),m.nI1(4,"mytranslate"),m.k0s()()()),2&se&&(m.R7$(3),m.SpI("* ",m.bMT(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let Q=(()=>{var se;class Ye extends c._{confirmAction(){const E=this.form.value,W=this.studentsInClassResults.find($=>$.classObj?.id===E.classId);if(W){const $=E.listStudents?.filter(K=>K.choose).map(K=>K.id);W.results=W.results?.filter(K=>$?.includes(K.reId)),W.schoolName=this.showAskInfo?E.schoolName:void 0,W.subjectName=this.showAskInfo?E.subjectName:void 0,this.dialogRef.close(W)}else this.dialogRef.close()}setChangeSelectAll(){const E=this.form.controls.selectAll;if(E){E.setValue(!E.value);const W=this.form.controls.listStudents;W&&W.controls.forEach($=>{$.controls.choose.setValue(E.value)}),this.countStudentSelect=E.value?W.controls.length:0}}onChangeStudentOption(){const E=this.form.controls.listStudents;let W=!0,$=0;E&&E.controls.forEach(ge=>{!1===ge.controls.choose.value?W=!1:$++});const K=this.form.controls.selectAll;K&&K.setValue(W),this.countStudentSelect=$}setupArrayStudent(E){this.currNameClass=E.classObj?.name??"";const W=this.form.controls.listStudents;if(W){W.clear();let $=E.results??[];if(void 0!==E.classObj?.sortType){let K=E.classObj?.sortType;$=0==K?this.sortService.sortFirstNameStudents(this.commonService.myClone($)):99==K?this.sortService.sortTimeDESC(this.commonService.myClone($)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone($),"pos","id")}$.forEach(K=>{(K.confirmedAt||!this.data.examHasEssay&&1==K.status)&&W.push(new D.gE({isImage:new D.MJ(!!K.nameImages,{nonNullable:!0}),nameImages:new D.MJ(K.nameImages,{nonNullable:!0}),label:new D.MJ(K.fullName,{nonNullable:!0}),id:new D.MJ(K.reId,{nonNullable:!0}),choose:new D.MJ(!1,{nonNullable:!0})}))})}}classroomChange(E){this.setupArrayStudent(E)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let E=this.studentsInClassResults[0];this.form.controls.classId.setValue(E.classObj?.id),this.setupArrayStudent(E),this.form.controls.classId.valueChanges.subscribe($=>{const K=this.form.controls.selectAll;K&&K.setValue(!1),this.countStudentSelect=0;const ge=this.studentsInClassResults.find(he=>he.classObj?.id===$);ge&&this.setupArrayStudent(ge)})}}constructor(E,W,$){super(W,$),this.sortService=E,this.data=W,this.dialogRef=$,this.studentsInClassResults=[],this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=W.isAskInfo,this.studentsInClassResults=W.studentsInClassResults.map(K=>({...K,results:K.results?.map(ge=>({...ge,reId:Ae.P.generateIdRequired(10)}))})),this.form=new D.gE({classId:new D.MJ(0,{nonNullable:!0,validators:[D.k0.required]}),selectAll:new D.MJ(!1,{nonNullable:!0}),listStudents:new D.Yp([]),schoolName:new D.MJ("",{nonNullable:!0}),subjectName:new D.MJ("",{nonNullable:!0})})}}return(se=Ye).\u0275fac=function(E){return new(E||se)(m.rXU(H.g),m.rXU(d.Vh),m.rXU(d.CP,8))},se.\u0275cmp=m.VBU({type:se,selectors:[["app-select-student-to-export-docx"]],features:[m.Vt3],decls:48,vars:35,consts:[["c","isDisabled"],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"change","checked"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"change","id"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(E,W){1&E&&(m.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.j41(6,"div",5)(7,"a",6),m.nrm(8,"lucide-icon",7),m.k0s()()(),m.j41(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11),m.EFF(13),m.nI1(14,"mytranslate"),m.DNE(15,Oe,2,1,"span",12),m.k0s()(),m.DNE(16,Ke,4,6,"div",13),m.j41(17,"div",14)(18,"div",15)(19,"div",16),m.EFF(20),m.nI1(21,"mytranslate"),m.k0s()(),m.j41(22,"div",17)(23,"div",18)(24,"input",19),m.bIt("change",function(){return W.setChangeSelectAll()}),m.k0s(),m.j41(25,"label",20),m.EFF(26),m.nI1(27,"mytranslate"),m.k0s()()(),m.j41(28,"div",21)(29,"ng-scrollbar",22)(30,"div",23),m.DNE(31,de,5,5,"div",24),m.k0s()()(),m.j41(32,"div",15),m.DNE(33,Be,3,3,"span",25)(34,Ge,7,7,"div",26),m.k0s()(),m.j41(35,"div",14)(36,"div",15)(37,"span",27),m.EFF(38),m.nI1(39,"mytranslate"),m.k0s()()()(),m.DNE(40,be,5,3,"div",26),m.k0s(),m.j41(41,"div",28)(42,"a",29),m.EFF(43),m.nI1(44,"mytranslate"),m.k0s(),m.j41(45,"button",30),m.bIt("click",function(){return W.confirmAction()}),m.EFF(46),m.nI1(47,"mytranslate"),m.k0s()()()()),2&E&&(m.R7$(4),m.JRh(m.bMT(5,21,"lang_testbank_what_to_export_select_students_export")),m.R7$(6),m.Y8G("formGroup",W.form)("hidden",0===W.studentsInClassResults.length),m.R7$(),m.Y8G("hidden",1===W.studentsInClassResults.length&&null==W.studentsInClassResults[0].classObj),m.R7$(2),m.SpI(" ",m.bMT(14,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),m.R7$(2),m.Y8G("ngIf",1===W.studentsInClassResults.length),m.R7$(),m.Y8G("ngIf",W.studentsInClassResults.length>1),m.R7$(),m.Y8G("hidden",0===W.form.controls.listStudents.controls.length),m.R7$(3),m.SpI("",m.bMT(21,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),m.R7$(4),m.Y8G("checked",W.form.controls.selectAll.value),m.R7$(2),m.JRh(m.bMT(27,27,"lang_auto_chon_tat_ca")),m.R7$(3),m.Y8G("visibility","hover"),m.R7$(2),m.Y8G("ngForOf",W.form.controls.listStudents.controls),m.R7$(2),m.Y8G("ngIf",0===W.countStudentSelect),m.R7$(),m.Y8G("ngIf",W.countStudentSelect>0),m.R7$(),m.Y8G("hidden",W.form.controls.listStudents.controls.length>0),m.R7$(3),m.SpI("* ",m.bMT(39,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),m.R7$(2),m.Y8G("ngIf",0===W.studentsInClassResults.length),m.R7$(3),m.SpI(" ",m.bMT(44,31,"lang_cms_common_close_btn")," "),m.R7$(2),m.Y8G("disabled",0===W.countStudentSelect),m.R7$(),m.SpI(" ",m.bMT(47,33,"lang_cms_common_confirm_btn")," "))},dependencies:[x.YU,x.Sq,x.bT,d.tx,N.oV,w.Yh,D.qT,D.me,D.Zm,D.Fm,D.BC,D.cb,D.j4,D.JD,D.v8,q.t,me.y,pe.f,ce.i,Y.WGl,x.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),Ye})();var ye=v(5382),ct=v(64198),Dt=v(25539),nt=v(81234),Et=v(92229),Qe=v(50622),ft=v(91640),He=v(41325),ze=v(40949),J=v(51113),ue=v(53393),fe=v(99927),G=v(99172),S=v(32639),F=v(62095),B=v(46134),Ie=v(9280),xe=v(87515),Ze=v(10296),Me=v(46899),rt=v(32610);let st=(()=>{var se;class Ye{processHomeworks(E,W){return new Promise(($,K)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(W).subscribe(ge=>{if(1==ge.success){this.logger.remove();var he=[];ge.data?.studentObjs.forEach(ee=>{he.push({id:ee.id,fullName:ee.fullName,confirmedAt:ee.confirmedAt,homeworkAnswerId:ee.answer?.id,studentId:void 0,resultId:void 0,userId:void 0,nameImages:void 0,reId:"",status:void 0})}),this.sAztDialogService.open(Q,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:ge.data?.classroomObj,results:he,schoolName:void 0,subjectName:void 0}],examHasEssay:!1,isAskInfo:!1}}).afterClosed().subscribe(ee=>{if(ee){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===ee.results?.length?"":ee.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Re=new Et.Y(!0);this.logger.pushChild(Re),this.loadLibAction(Re).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===ee.results?.length?"":ee.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Pe=new Et.Y(!0);this.logger.pushChild(Pe);const Ee=new ye.n(1,{function:(Ue,We,Xe)=>{Pe.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===We?"":"th\u1ee9 "+(Ue+1)} ${Xe?": "+Xe:""}`)}});ee.results?.forEach(Ue=>{const We=new Et.Y;Pe.pushChild(We),Ee.addTask(this,this.makeFileHomework,[W,Ue,We],Ue.fullName??"")}),Ee.start().then(Ue=>{Pe.remove(),0===Ue.errs.length?this.finishHomework(ee.classObj?.name??"",ge.data?.homeworkObj?.name??"",Ue,$,K):(this.logger.remove(),this.sAztDialogService.open(U,{data:{result:Ue},restoreFocus:!1}).afterClosed().subscribe(We=>{We&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(ee.classObj?.name??"",ge.data?.homeworkObj?.name??"",Ue,$,K))}))})}).catch(Pe=>{this.logger.remove(),K(Pe)})}})}else this.logger.remove(),K(new Error(this.commonService.myTranslateInstant(ge.message)))})})}processClasses(E,W){return new Promise(($,K)=>{let ge;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),W){case"highest":ge=this.testedListApiService.getTestedHighestMark("export_tool",E);break;case"first":ge=this.testedListApiService.getTestedFirstMark("export_tool",E);break;default:ge=this.testedListApiService.getTestedLastMark("export_tool",E)}ge.subscribe(he=>{if(1==he.success){this.logger.remove();let ee=!!he.data?.questionObjs?.filter(Pe=>this.answerTypeService.isEssayAnswer(Pe)).length,Re=[];if(he.data?.studentsInClassResults?.forEach(Pe=>{let Ee=[];Pe.results?.forEach(Ue=>{Ee.push({id:Ue.id?Number(Ue.id):void 0,fullName:Ue.fullName??"",confirmedAt:Ue.confirmedAt,studentId:Ue.studentId?Number(Ue.studentCode):void 0,resultId:Ue.resultId,userId:Ue.userId?.toString(),nameImages:Ue.nameImages,reId:"",status:Ue.status})}),Re.push({classObj:Pe.classObj,results:Ee,schoolName:void 0,subjectName:void 0})}),he.data?.studentsNotInClassResults&&he.data?.studentsNotInClassResults?.length>0){let Pe=[];he.data.studentsNotInClassResults.forEach(Ee=>{Pe.push({id:Ee.id?Number(Ee.id):void 0,fullName:Ee.fullName??"",confirmedAt:Ee.confirmedAt,studentId:Ee.studentId?Number(Ee.studentCode):void 0,resultId:Ee.resultId,userId:Ee.userId?.toString(),nameImages:Ee.nameImages,reId:"",status:Ee.status})}),Re.push({classObj:{id:0,name:this.commonService.myTranslateInstant("lang_auto_tu_do")??""},results:Pe,schoolName:void 0,subjectName:void 0})}this.sAztDialogService.open(Q,{data:{studentsInClassResults:Re,examHasEssay:ee,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(Pe=>{Pe?(this.expandInfoParse=this.commonService.castJsonToObj(he.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===Pe.results?.length?"":Pe.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(E,Pe,Pe.classObj?.name??"",he.data?.examObj,Pe.classObj?.id).then(()=>{this.logger.remove(),$()}).catch(Ue=>{this.logger.remove(),K(Ue)})):(this.logger.remove(),$())})}else this.logger.remove(),K(new Error(this.commonService.myTranslateInstant(he.message)??""))})})}processUser(E,W,$,K,ge,he=!0,ee,Re,Pe,Ee,Ue){return new Promise((We,Xe)=>{this.reset(),ge=ge||this.logger,ge?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const M=new Et.Y(!0);ge?.pushChild(M),this.loadLibAction(M).then(()=>{ge?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(E,$??"",K??"",W,Ue).subscribe(je=>{if(1==je.success){this.expandInfoParse=this.commonService.castJsonToObj(je.data?.examObj?.expandInfo??"{}")??{},ge?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let tt=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const lt=je.data?.studentObj;ge?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${lt?.fullName??""}`);let ut="";ut=je.data?.classroomObj?je.data?.classroomObj.name??tt:tt;const it=je.data?.examTracks,ht=je.data?.examObj,Ut=je.data?.examResultObj,xt=this.commonService.castJsonToClassObjs(Dt.I,JSON.stringify(je.data?.questionObjs))??[];let mn=0,Kt=0;for(let yt=0;yt<xt.length;yt++)xt[yt].correctAnswer=this.commonService.isExistInArray(je.data?.correctQuestionIds,xt[yt].id),xt[yt].indexLabel=yt+(ht?.startQuestionIndex??1),ht?.resetQuestionIndex&&xt[yt].groupInfo&&xt[yt].groupInfo?.groupId&&(xt[yt].groupInfo&&mn!=xt[yt].groupInfo?.groupId&&(mn=xt[yt].groupInfo?.groupId??0,Kt=0),xt[yt].labelIndex=Kt+(ht?.startQuestionIndex??1),Kt++);const an={};let In=this.commonService.castJsonToObj(je.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(In??[],an);const Bt=new Et.Y;ge?.pushChild(Bt),this.processConvertDataUser(Bt,xt,lt,Ut).then(yt=>{if(yt){var dn=0;this.convertDataMarkNote(yt?.resultTeacherDraw).then(Nn=>{this.loadTeacherDrawResult(Nn,ge??new Et.Y,lt?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",yt).then(Vt=>{yt=Vt,Bt.remove();const zn=new Et.Y(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+`...${dn}%`);ge?.pushChild(zn);let gn=[];gn.push({content:this.getLineInfoData(ut,ht,it,Ut,lt,xt,yt,ee,Re).join("<br/>")+"<br/><br/><br/>",answers:[]}),gn=gn.concat(this.startGenUserLineFile(Ut,xt,yt,Pe,Ee));var Ht=0;this.sAztDocxService.exportToDocxBinary((0,nt.Wn)(gn),{isHeadless:!0},(En,fn,vn)=>{new Promise(An=>{setTimeout(()=>{0==En&&(dn=Ht),Ht=En/fn*50+dn;const pn=this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+"..."+Math.floor(Ht)+"%";zn?.pushMsg(pn)}),An(!0)})}).then(En=>{const fn=new Blob([En],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let vn=this.commonService.createFileNameExportFile([lt?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",Ut?.id?Ut.id.toString():""])+"_test_result";if(he)if(yt.mediaAnswerWraps.concat(yt.mediaWraps).length>0){const An=new l;An.file(vn+".docx",fn),yt.mediaAnswerWraps.concat(yt.mediaWraps).forEach(pn=>{const tr=new Blob([pn]);An.file("attachments/"+this.replaceParamFileName(pn.name),tr)}),An.generateAsync({type:"blob"}).then(pn=>{let tr=this.commonService.createFileNameExportFile([ut,vn])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(pn,tr),ge?.remove(),We()},pn=>{ge?.remove(),We(pn)})}else this.shareFileFlutterService.shareFileWithBlob(fn,vn+".docx"),ge?.remove(),We();else ge?.remove(),We({name:vn,blob:fn,medias:yt.mediaAnswerWraps.concat(yt.mediaWraps)})})})})}}).catch(yt=>{ge?.remove(),Xe(yt)})}else ge?.remove(),Xe(new Error(this.commonService.myTranslateInstant(je.message)))})}).catch(je=>{ge?.remove(),Xe(je)})})}finishClassroom(E,W,$,K,ge){if($.length>1){const he=new l;$.forEach(ee=>{ee.medias.length>0?(he.file(ee.name+"/"+ee.name+".docx",ee.blob),ee.medias.forEach(Re=>{const Pe=new Blob([Re]);he.file(ee.name+"/attachments/"+this.replaceParamFileName(Re.name),Pe)})):he.file(ee.name+".docx",ee.blob)}),he.generateAsync({type:"blob"}).then(ee=>{let Re=this.commonService.createFileNameExportFile([E,W])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(ee,Re),K()},ee=>{K(ee)})}else if($[0].medias.length>0){const he=new l;he.file($[0].name+"/"+$[0].name+".docx",$[0].blob),$[0].medias.forEach(ee=>{const Re=new Blob([ee]);he.file($[0].name+"/attachments/"+this.replaceParamFileName(ee.name),Re)}),he.generateAsync({type:"blob"}).then(ee=>{let Re=this.commonService.createFileNameExportFile([E,W])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(ee,Re),K()},ee=>{K(ee)})}else this.shareFileFlutterService.shareFileWithBlob($[0].blob,$[0].name+".docx"),K()}finishHomework(E,W,$,K,ge){if(1===$.datas.length)if($.datas[0].medias.length>0){const he=new l;he.file($.datas[0].name+"/"+$.datas[0].name+".docx",$.datas[0].blob),$.datas[0].medias.forEach(ee=>{const Re=new Blob([ee]);he.file($.datas[0].name+"/attachments/"+this.replaceParamFileName(ee.name),Re)}),he.generateAsync({type:"blob"}).then(ee=>{let Re=this.commonService.createFileNameExportFile([E,$.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(ee,Re),K()},ee=>{this.logger.remove(),K(ee)})}else this.shareFileFlutterService.shareFileWithBlob($.datas[0].blob,$.datas[0].name+".docx"),this.logger.remove(),K();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const he=new l;$.datas.forEach(ee=>{ee.medias.length>0?(he.file("results/"+ee.name+"/"+ee.name+".docx",ee.blob),ee.medias.forEach(Re=>{const Pe=new Blob([Re]);he.file("results/"+ee.name+"/attachments/"+this.replaceParamFileName(Re.name),Pe)})):he.file("results/"+ee.name+".docx",ee.blob)}),he.generateAsync({type:"blob"}).then(ee=>{let Re=this.commonService.createFileNameExportFile([E,W])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(ee,Re),this.logger.remove(),K()},ee=>{this.logger.remove(),ge(ee)})}}makeFileHomework(E,W,$){return new Promise((K,ge)=>{$.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(E,W.homeworkAnswerId??0).subscribe(he=>{if($.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(he.data?.answerObj),he.data?.answerObj){$.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let Re=this.commonService.castJsonToObj(he.data.answerObj.result??"")??{};this.convertDataMarkNote(Re).then(Pe=>{this.loadTeacherDrawResult(Pe,$,W.fullName??"").then(Ee=>{$.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let Ue=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${he.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${he.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${he.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${he.data?.answerObj?.id} <br/>`].forEach(Xe=>{Ue.push({content:Xe,answers:[]})});let We=this.commonService.castJsonToObj(he.data?.answerObj?.resultNote??"");if(We){const Xe=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],M=document.createElement("p");M.innerText=this.commonService.myTranslateInstant("lang_point")??"",M.setAttribute("docx-style",nt.$s.get("TB_RESULT_TXT"));const je=document.createElement("p");let tt=he.data?.answerObj?.point;Xe.forEach(it=>{it.mark===tt&&(tt=this.commonService.myTranslateInstant(it.lang))}),je.innerText=tt?.toString()??"",je.setAttribute("docx-style",nt.$s.get("TB_RESULT_POINT"));const lt=document.createElement("p");lt.setAttribute("docx-style",nt.$s.get("TB_RESULT_TXT")),lt.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const ut=document.createElement("span");ut.setAttribute("docx-style",nt.$s.get("TB_RESULT_COMMENT")),0===We?.IsHideMark&&(ut.innerText=this.getTextContentInTagHTML(We.Note),Ee.resultTeacherDraw?.commentEmoji&&(ut.appendChild(document.createElement("br")),Ee.resultTeacherDraw.commentEmoji.forEach(it=>{if(Ee.canvasList[it]){const ht=new Image;ht.src=Ee.canvasList[it].toDataURL(),ht.style.width=Ee.canvasList[it].width/5+"px",ht.style.height=Ee.canvasList[it].height/5+"px",ut.appendChild(ht)}}))),Ue.push({content:nt.$s.makeHeaderTable([M,je],[lt,ut]),answers:[]})}Ue=Ue.concat(this.getLineImageAnswer(Ee)),this.sAztDocxService.exportToDocxBinary((0,nt.Wn)(Ue),{isHeadless:!0},(Xe,M,je)=>{}).then(Xe=>{$.remove();const M=new Blob([Xe],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let je=`${this.commonService.convertVietnameseToEnglish(W.fullName??"")}_${he.data?.answerObj?.id??0}`;K({name:je,blob:M,medias:Ee.mediaAnswerWraps.concat(Ee.mediaWraps)})})}).catch(Ee=>{$.remove(),ge(Ee)})})}else $.remove(),ge(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(E,W,$,K,ge){return new Promise((he,ee)=>{const Re=new ye.n(1,{function:(Ue,We)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===We?"":` (${Ue+1}/${We})`}`),this.logger.percent=Ue/We}},1e3),Pe=[];let Ee=this.homeworkExamService.isOfflineExam(K);W.results?.forEach(Ue=>{Re.addTask(this,()=>new Promise((We,Xe)=>{const M=new Et.Y(!0,"");this.logger.pushChild(M),this.processUser(E,Number(Ue.resultId),Ue.userId,Ue.studentId?.toString(),M,!1,W.schoolName,W.subjectName,Ee,void 0,ge).then(je=>{je?(M.remove(),Pe.push(je),We()):(M.remove(),Xe(new Error))}).catch(je=>{M.remove(),Xe(je)})}))}),Re.start().then(Ue=>{Ue.errs.length>0?(this.logger.remove(),Ue.datas=Pe,this.sAztDialogService.open(U,{data:{result:Ue},restoreFocus:!1}).afterClosed().subscribe(We=>{We&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom($,K?.name??"",Pe,he,ee))})):this.finishClassroom($,K?.name??"",Pe,he,ee)})})}processConvertDataUser(E,W,$,K){return new Promise((ge,he)=>{let ee={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Re=(this.commonService.myParseJson(K?.files??"[]")??[]).filter(je=>(0,ct.rl)(je.mimes??"")||(0,ct.nL)(je.mimes??""));E.start();const M=new ye.n(1,{function:(je,tt,lt)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${je+1}/${tt}: ${lt}`)}});M.addTask(this,()=>new Promise((je,tt)=>{const lt=new Et.Y(!0);E.pushChild(lt),this.questionRenderService.parseRenderQuestions(W,ut=>{lt.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(ut)}%`)},void 0,50,!0).then(()=>{lt.remove(),je()}).catch(ut=>{const it=ht=>{Object.prototype.hasOwnProperty.call(ht,"type")&&"LOAD_IMAGE"===ht.type?tt(new Error(`${ht.message} ${this.commonService.trimMidLimitLength(ht.data[0],30)}`)):tt(ut)};lt.remove(),Array.isArray(ut)?it(ut[0]):it(ut)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),K&&K.result&&M.addTask(this,()=>new Promise((je,tt)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj(K?.result??"")??{},E,$?.fullName??"").then(lt=>{ee=lt,je()}).catch(lt=>{tt(lt)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),M.addTask(this,()=>new Promise((je,tt)=>{$?this.loadNameImage($).then(lt=>{$=lt,je()}).catch(lt=>{tt(lt)}):tt(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),ee.isExportMedia&&M.addTask(this,()=>new Promise((je,tt)=>{const lt=new Et.Y(!0);E.pushChild(lt);const ut=new ye.n(3,{function:(it,ht)=>{lt.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${it}/${ht})`)}},100);W.forEach(it=>{it.attachments&&it.attachments.length>0&&it.attachments.forEach(ht=>{ut.addTask(this,this.loadAztFile,[ht,ee,"att"])})}),ut.start().then(it=>{0===it.errs.length?(lt.remove(),je()):(lt.remove(),tt(it.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),Re.length&&M.addTask(this,()=>new Promise((je,tt)=>{const lt=new Et.Y(!0);E.pushChild(lt);const ut=new ye.n(3,{function:(it,ht)=>{lt.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${it}/${ht})`)}},100);Re.forEach(it=>{ut.addTask(this,this.loadAztFile,[it,ee,"ans"])}),ut.start().then(it=>{0===it.errs.length?(lt.remove(),je()):(lt.remove(),tt(it.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem_tu_luan")),M.start().then(je=>{E.remove(),0===je.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(W,K),ge(ee)):he(je.errs[0])})})}hasMultiple(E){let W=!1;for(let $=0;$<E.length;$++)if(this.answerTypeService.isOneChoiceAnswer(E[$])){W=!0;break}return W}hasEssay(E){let W=!1;for(let $=0;$<E.length;$++)if(this.answerTypeService.isEssayAnswer(E[$])){W=!0;break}return W}getLineInfoData(E,W,$,K,ge,he,ee,Re,Pe){const Ee=[];Ee.push(nt.$s.makeHeaderTable([nt.$s.createLineCenterBold(Re||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toUpperCase()} }`)],[nt.$s.createLineCenterBold(W?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),nt.$s.createLineCenterBold(Pe||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),nt.$s.createLineCenterBold(W?.minutes&&W?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+W?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const Ue=he.filter(We=>this.answerTypeService.isEssayAnswer(We)).length;return ge&&ge.nameImages&&parseInt(ge?.id??"0")<=0?Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${ge?.nameImages.url}" />`):Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${ge?.fullName}`),Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${E}`),W?.subjectMarks&&K?.subjectMarkValues&&K.subjectMarkValues.forEach((We,Xe)=>{Ee.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${Xe+1} </b>: ${We}/10`)}),this.hasMultiple(he)&&Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${K?.trueFalseMark} (${K?.rightAnswer}/${(K?.totalQuestion??0)-Ue} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(he)&&Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${K?.essayMark+" ("+Ue+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(he)&&ee.resultTeacherDraw&&Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj(K?.files??"")?.length??"0"}`),$&&0!=W?.autoMonitor&&(Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${$.exitFullScreen}`),Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${$.blurWindow}`)),Ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${K?.id}`),Ee}startGenUserLineFile(E,W,$,K,ge){let he=[];const ee=this.commonService.castJsonToObj(E?.answers??"");return ee&&W.forEach(Re=>{Re.groupInfo&&Re.groupInfo.isFirstInGroup&&he.push({content:`<br/><b>${Re.groupInfo.groupContent}</b><br/>`,answers:[]}),Re.attachments&&$.isExportMedia&&Re.attachments.forEach(Ee=>{he.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(Ee.name)}]`,answers:[]})}),he=he.concat(this.genLineQuestion(Re,K));const Pe=this.mapQuestResultObj(Re,ee??[]);switch(Re.answerType){case 1:he=he.concat(this.genLineAnswerType1(Re,Pe));break;case 3:he=he.concat(this.genLineAnswerType3(Re,Pe));break;case 4:he=he.concat(this.genLineAnswerType4(Re,Pe));break;case 5:he=he.concat(this.genLineAnswerTrueFalseType5(Re,Pe))}ge&&Re.help&&he.push({content:`<br/><b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b> ${Re.help}<br/><br/>`,answers:[]})}),this.hasEssay(W)&&(he=he.concat(this.getLineImageAnswer($))),he}genLineQuestion(E,W){const $=[];let K=this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"),ge=this.answerTypeService.isFillAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_fill_blank"):this.answerTypeService.isEssayAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_essay"):this.commonService.myTranslateInstant("azt_lang_sugg_type_multiple_choice"),he={content:"<b>"+K+" "+(E.labelIndex??E.indexLabel??1)+". "+(W?`(${ge})`:"")+"</b> "+(E.content?.includes("<img")?"<br/>":"")+E.content,answers:W&&(this.answerTypeService.isFillAnswer(E)||this.answerTypeService.isEssayAnswer(E))?[]:this.convertAnswerQuestion(E.answers??[],!!this.answerTypeService.isTrueFalseAnswer(E))};return $.push(he),$}mapQuestResultObj(E,W){return W.find(K=>K.QuestionId===E.id)||{QuestionId:E.id??0,AnswerContent:[]}}convertAnswerQuestion(E,W){let $=[];return E.forEach(K=>{let ge=K.alpha?K.alpha:K.key,he="<b>     "+(W?ge.toLocaleLowerCase()+")":ge)+".</b> "+K.content;$.push(he)}),$}genLineAnswerType1(E,W){const $=document.createElement("table"),K=E.correctAnswer?nt.JP:nt.ep;$.setAttribute("docx-style",nt.$s.get("TABLE"));const ge=[],he=document.createElement("tr");$.appendChild(he);const ee=document.createElement("td");ee.setAttribute("docx-style",nt.$s.get("CORRECT",[{key:nt.Xe,value:K}]));const Re=document.createElement("span"),Pe=E.answers?E.answers.filter(We=>E.answerResult?.includes(We.key)).map(We=>We.alpha??We.key).join(" & "):E.answerResult?.join(" & ");Re.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+Pe,Re.setAttribute("color",K),ee.appendChild(Re),he.appendChild(ee);const Ee=document.createElement("span"),Ue=document.createElement("span");return Ee.innerText="\u2713",Ee.setAttribute("color",nt.JP),Ue.innerText="\u2717",Ue.setAttribute("color",nt.ep),E.answers?.forEach((We,Xe)=>{const M=document.createElement("td"),je=document.createElement("span"),tt=[{key:nt.Xe,value:K}];tt.push({key:nt.n1,value:Xe+1===E.answers?.length?K:"FFFFFF"}),M.setAttribute("docx-style",nt.$s.get("KEY_RESULT",tt)),je.innerText=We.alpha??We.key,W.AnswerContent.filter(ut=>ut.Content===We.key).length>0&&M.appendChild(E.correctAnswer?Ee:Ue),M.appendChild(je),he.appendChild(M)}),ge.push({content:`<br>${$.outerHTML}<br><br><br>`,answers:[]}),ge}genLineAnswerTrueFalseType5(E,W){const $=[],K=E.correctAnswer?nt.JP:nt.ep,ge=this.commonService.myTranslateInstant("lang_auto_dung"),he=this.commonService.myTranslateInstant("lang_auto_sai"),ee=this.sAztAnswerTrueFalseService.checkLabelKeys([],E?.answers,E?.answerResult),Re=(tt,lt)=>{const ut=document.createElement("span");return ut.innerText=tt,ut.setAttribute("color",lt),ut},Ue=document.createElement("table");Ue.setAttribute("docx-style",nt.$s.get("TABLE"));const We=document.createElement("tr"),Xe=Re(this.commonService.myTranslateInstant("lang_auto_dap_an")??"",K),M=document.createElement("td"),je=[{key:nt.Xe,value:K}];return je.push({key:nt.n1,value:K}),M.setAttribute("docx-style",nt.$s.get("KEY_RESULT",je)),E.answers?.forEach(tt=>{const lt=this.sAztAnswerTrueFalseService.checkIsTrueType5(tt,ee,W.AnswerContent),ut=this.commonService.myTranslateInstant(this.sAztAnswerTrueFalseService.getAnswerChoiceTrueFalseQuestion(tt,W.AnswerContent))??"";M.appendChild(((tt,lt,ut)=>{const it=document.createElement("div"),ht=document.createElement("span"),Ut=lt?nt.JP:nt.ep;return ht.innerText=(tt.alpha??tt.key).toLowerCase()+"-",it.appendChild(Re(lt?"\u2713":"\u2717",Ut)),it.appendChild(ht),it.appendChild(Re(ut??"",Ut)),it})(tt,lt,ut)),M.appendChild(document.createElement("br"))}),We.appendChild(((tt,lt)=>{const ut=document.createElement("td");return ut.appendChild(tt),E.answers.length&&E.answers.forEach(it=>{const ht=document.createElement("span");ht.setAttribute("color",this.sAztAnswerTrueFalseService.checkIsTrueType5(it,ee,W.AnswerContent)?nt.JP:nt.ep),ht.innerText=` ${(it.alpha?it.alpha:it.key?it.key:it).toString().toLowerCase()}-${ee.includes((it.alpha?it.alpha:it.key?it.key:"")+"T")?ge:he} `,ut.appendChild(ht)}),ut.setAttribute("docx-style",lt),ut})(Xe,nt.$s.get("CORRECT",[{key:nt.Xe,value:K}]))),We.appendChild(M),Ue.appendChild(We),$.push({content:`<br>${Ue.outerHTML}<br><br><br><br><br><br>`,answers:[]}),$}genLineAnswerType3(E,W){const $=[];return $.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/><br/>`,answers:[]}),0===W.AnswerContent.length?$.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):W.AnswerContent.forEach(K=>{$.push({content:`<span>${K.Content}</span>`,answers:[]})}),$.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${E.essayMarkParsed} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${E.scorePerQuestion})</b>`,answers:[]}),$}genLineAnswerType4(E,W){const $=document.createElement("table"),K=E.correctAnswer?nt.JP:nt.ep;$.setAttribute("docx-style",nt.$s.get("TABLE"));const ge=[],he=document.createElement("tr");he.setAttribute("docx-style",nt.$s.get("TR")),$.appendChild(he);const ee=document.createElement("td");ee.setAttribute("docx-style",nt.$s.get("CORRECT",[{key:nt.Xe,value:K}]));const Re=document.createElement("span");Re.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+E.answerResult?.join(";")+"]",Re.setAttribute("color",K),ee.appendChild(Re),he.appendChild(ee),0===W.AnswerContent.length&&W.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const Pe=document.createElement("td"),Ee=document.createElement("span");return Pe.setAttribute("docx-style",nt.$s.get("FILL_RESULT",[{key:nt.Xe,value:K}])),Ee.innerText=W.AnswerContent.map(We=>We.Content).join(";"),Pe.appendChild(Ee),he.appendChild(Pe),ge.push({content:`<br>${$.outerHTML}<br><br><br>`,answers:[]}),ge}loadNameImage(E){return new Promise((W,$)=>{E&&E.nameImages&&parseInt(E?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(E.nameImages).then(K=>{K&&E.nameImages&&(E.nameImages.url=K),W(E)}).catch(K=>{$(K)}):W(E)})}loadCssFrameAction(){return new Promise(E=>{const W=document.createElement("div"),$=K=>{const ge=document.createElement("span");return ge.style.fontFamily=K,ge.innerText="Aa",ge};W.appendChild($("font_chu_dep")),W.appendChild($("font_chu_dep_z")),W.appendChild($("font_chu_in")),W.appendChild($("font_chu_in_nghieng")),W.appendChild($("font_chu_in_dam")),W.style.opacity="0",document.body.appendChild(W),setTimeout(()=>{W.remove(),E()},2e3)})}loadLibAction(E){return new Promise((W,$)=>{this.commonService.loadAzotaDocxJs().then(()=>{const K=new ye.n(1,{function:(ge,he,ee)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${ge+1}/${he}: ${ee}`)}});K.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),K.start().then(ge=>{E.remove(),ge.errs.length>0?$(ge.errs[0]):W()})}).catch(K=>{$(K)})})}reset(){}checkUrlIsImage(E){return null!=E.match(/\.(jpeg|jpg|png|gif)(\?.*)?$/)}loadAztFile(E,W,$){return new Promise((K,ge)=>{fetch(this.cdnService.getMyCdn(E.url??"")).then(he=>{he.ok?he.blob().then(ee=>{const Pe=new File([ee],E.name??"",{type:E.mimes});"ans"===$?W.isExportAnsMedia&&W.mediaAnswerWraps.push(Pe):W.isExportMedia&&W.mediaWraps.push(Pe),K()}):ge(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))}).catch(()=>{ge(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))})})}wrapLoadMedia(E,W){return this.checkUrlIsImage(E)?(0,ct.qO)(E,W):new Promise(($,K)=>{$(void 0)})}replaceImageToBase64(E,W,$,K,ge,he){return new Promise((ee,Re)=>{Object.prototype.hasOwnProperty.call(E,W)&&"string"==typeof E[W]?this.wrapLoadMedia(E[W],ge).then(Pe=>{if(Pe){const Ee=document.createElement("canvas");Ee.width=Pe.width,Ee.height=Pe.height,Ee.getContext("2d")?.drawImage(Pe,0,0),E[W]=$.canvasList.push(Ee)-1,ee()}else{he=he?he+1:1;let Ee=E[W].split(".");Ee=Ee.length>0?Ee[Ee.length-1]:"mp3";const Ue=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",he.toString(),K])+"."+Ee;this.loadAztFile({name:this.commonService.replaceAll(Ue,"_"," ")??"",url:E[W],path:"",extension:"",mimes:"",size:"0"},$,"ans").then(()=>{ee()}).catch(We=>{Re(new Error(this.commonService.myTranslateInstant(We.message)+(K.length>0?" : "+K:"")))})}}).catch(Pe=>{Re(new Error(this.commonService.myTranslateInstant(Pe.message)+(K.length>0?" : "+K:"")))}):Re(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+(K.length>0?" : "+K:"")))})}loadTeacherDrawResult(E,W,$,K){return new Promise((ge,he)=>{const ee=K??{canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Re=new ye.n(3,{function:(Pe,Ee)=>{W.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${Pe}/${Ee})`)}});if(ee.resultTeacherDraw=E,ee.resultTeacherDraw){ee.resultTeacherDraw.pages?.forEach((Ee,Ue)=>{Re.addTask(this,this.replaceImageToBase64,[Ee,"backgroundImage",ee,$,this.cdnService,Ue]),Ee.draw&&Re.addTask(this,this.replaceImageToBase64,[Ee,"draw",ee,$,this.cdnService,Ue])});const Pe=this.commonService.castJsonToObj(ee.resultTeacherDraw.staticTextConfig??"");if(ee.resultTeacherConfig=Pe,ee.resultTeacherConfig&&ee.resultTeacherConfig.urlImgCorrect&&ee.resultTeacherConfig.urlImgWrong&&(ee.resultTeacherConfig.urlImgCorrect=(ee.resultTeacherConfig.type?"":"assets/images/classlive/")+ee.resultTeacherConfig.urlImgCorrect,ee.resultTeacherConfig.urlImgWrong=(ee.resultTeacherConfig.type?"":"assets/images/classlive/")+ee.resultTeacherConfig.urlImgWrong,Re.addTask(this,this.replaceImageToBase64,[ee.resultTeacherConfig,"urlImgCorrect",ee,$]),Re.addTask(this,this.replaceImageToBase64,[ee.resultTeacherConfig,"urlImgWrong",ee,$])),ee.resultTeacherDraw.commentEmoji&&ee.resultTeacherDraw.commentEmoji.length>0)for(let Ee=0;Ee<ee.resultTeacherDraw.commentEmoji.length;Ee++)ee.resultTeacherDraw.commentEmoji[Ee]="https://azota889.github.io/storage_public/mnote/"+ee.resultTeacherDraw.commentEmoji[Ee],Re.addTask(this,this.replaceImageToBase64,[ee.resultTeacherDraw.commentEmoji,Ee,ee,$])}Re.start().then(Pe=>{0===Pe.errs.length?ge(ee):he(Pe.errs[0])})})}capitalized(E){return E?E.charAt(0).toUpperCase()+E.slice(1):""}wrapText(E,W,$,K,ge,he){const ee=document.createElement("span");ee.innerHTML=this.commonService.removeXssInHtml(W),(W=ee.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(Pe=>{for(var Ee=Pe.split(" "),Ue="",We=0;We<Ee.length;We++){var Xe=Ue+Ee[We]+" ";E.measureText(Xe).width>ge&&We>0?(E.fillText(Ue,$,K),Ue=Ee[We]+" ",K+=he):Ue=Xe}E.fillText(Ue,$,K)})}getLineImageAnswer(E){const W=[];return E.mediaAnswerWraps&&E.isExportAnsMedia&&E.mediaAnswerWraps.forEach($=>{W.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName($.name)}}</span>`,answers:[]})}),E.resultTeacherDraw&&E.resultTeacherDraw.pages?.forEach($=>{let K=E.canvasList[Number($.backgroundImage)];if(K){const ge=document.createElement("canvas");ge.width=$.width??1,ge.height=$.height??1;const he=ge.getContext("2d");if(he){he.fillStyle="#FFFFFF",he.fillRect(0,0,ge.width,ge.height);let Pe=document.createElement("canvas"),Ee=Pe.getContext("2d");0!==$.rotation&&Ee?(90===Math.abs($.rotation??0)?(Pe.width=K.height,Pe.height=K.width):(Pe.width=K.width,Pe.height=K.height),Ee.translate(Pe.width/2,Pe.height/2),Ee.rotate((($.rotation??0)>0?1:-1)*($.rotation??0)*Math.PI/180),Ee.drawImage(K,-K.width/2,-K.height/2),Ee.restore()):Pe=K;const Ue=ge.height/Pe.height*Pe.width;if(he.drawImage(Pe,0,0,Pe.width,Pe.height,(ge.width-Ue)/2,0,Ue,ge.height/Pe.height*Pe.height),$.draw){const M=E.canvasList[Number($.draw)];M&&he.drawImage(M,0,0)}if($.staticText&&$.staticText.length>0&&$.staticText.forEach(M=>{if(he.font=`${E.resultTeacherConfig?.fontSize}px ${E.resultTeacherConfig?.fontText}`,he.fillStyle=E.resultTeacherConfig?.fontColor??"#000000",E.resultTeacherConfig?.useCorrectText&&"correct"==M.value&&this.wrapText(he,E.resultTeacherConfig?.textCorrect??"",M.x,M.y,ge.width-M.x,25),E.resultTeacherConfig?.useCorrectText&&"wrong"==M.value&&this.wrapText(he,E.resultTeacherConfig?.textWrong??"",M.x,M.y,ge.width-M.x,25),!E.resultTeacherConfig?.useCorrectText&&"correct"==M.value){const je=E.canvasList[Number(E.resultTeacherConfig?.urlImgCorrect)];je&&he.drawImage(je,0,0,je.width,je.height,M.x,M.y,30,30)}if(!E.resultTeacherConfig?.useWrongText&&"wrong"==M.value){const je=E.canvasList[Number(E.resultTeacherConfig?.urlImgWrong)];je&&he.drawImage(je,0,0,je.width,je.height,M.x,M.y,30,30)}}),$.objText&&$.objText.length>0){let M=300;$.objText.forEach(je=>{he.font=`${parseFloat(je.textStyle.size)}px ${je.textStyle.font}`,he.fillStyle=je.textStyle.color,he.textAlign=je.textStyle.align??"center",he.lineWidth=je.textStyle.width??M,this.wrapText(he,je.value,je.x,je.y,ge.width-je.x,25)})}}const ee=693,Re=ee/ge.width;W.push({content:`<img src="${ge.toDataURL()}" style="width:${ee}px;height:${ge.height*Re}px" /><br/>`,answers:[]})}}),0===W.length?W.push({content:`<br/><br/>${nt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):W.unshift({content:`<br/>${nt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),W}convertDataMarkNote(E){return new Promise((W,$)=>{E&&E.urlDataMark?this.cdnService.loadTextCdn(this.cdnService.getMyCdn(E.urlDataMark)).subscribe(K=>{const ge=this.zipDataService.decodeContentGzip(K),he=this.commonService.castJsonToObj(ge);E.pages=[];let ee={};he?.pages.forEach((Ee,Ue)=>{let We={width:Ee.width,height:Ee.height,draw:Ee.draws?.[0]?.src??void 0,backgroundImage:Ee.backgroundSrc,rotation:Ee.backgroundRotate,objText:[],staticText:[]};Ee.childData?.length&&Ee.childData.forEach((Xe,M)=>{if("UIQuickMark"==Xe.className&&(We.staticText?.push({x:Xe.x+5,y:Xe.y+(Xe.height+5+Xe.fontSize)/2,value:"type_right"===Xe.type?"correct":"wrong"}),0===M&&(ee={txtCommentFont:Xe.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:Xe.width,correctHeight:Xe.height,wrongWidth:Xe.width,wrongHeight:Xe.height,fontText:Xe.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:Xe.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!ee.urlImgWrong&&"type_wrong"==Xe.type&&(ee.urlImgWrong=Xe.imageSrc),!ee.urlImgCorrect&&"type_right"==Xe.type&&(ee.urlImgCorrect=Xe.imageSrc),!ee.textWrong&&"type_wrong"==Xe.type&&(ee.textWrong=Xe.textContent),!ee.textCorrect&&"type_right"==Xe.type&&(ee.textCorrect=Xe.textContent),ee.useCorrectText=!ee.urlImgCorrect,ee.useWrongText=!ee.urlImgWrong,"UIText"===Xe.className){let je=this.getStyleContent(Xe.textContent);We.objText?.push({x:Xe.x+15,y:Xe.y+15,value:Xe.textContent,textStyle:{size:Xe.fontSize?Xe.fontSize:je?.fontSize,align:je?.textAlign??"left",color:je?.color,fill:!0,font:je?.fontFamily}})}}),E.pages?.push(We)}),E.staticTextConfig=this.commonService.serializeJson(ee),W(E)}):W(E??{})})}getStyleContent(E){let W=document.createElement("div");W.innerHTML=this.commonService.removeXssInHtml(E);let $=W.querySelector("p"),K=W.querySelector("span");return K?{fontSize:K.style.fontSize,color:K.style.color,fontFamily:K.style.fontFamily,textAlign:$?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(E){return(new DOMParser).parseFromString(E,"text/html").body.textContent??E}replaceParamFileName(E){return E.replace(/\?.*$/,"")}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}constructor(E,W,$,K,ge,he,ee,Re,Pe,Ee,Ue,We,Xe,M,je,tt){this.sAztAnswerTrueFalseService=E,this.homeworkExamService=W,this.checkDrawImgNameService=$,this.cdnService=K,this.zipDataService=ge,this.exportPdfUtilsService=he,this.answerTypeService=ee,this.exportPdfConvertDataService=Re,this.questionRenderService=Pe,this.commonService=Ee,this.answerService=Ue,this.examResultService=We,this.testedListApiService=Xe,this.shareFileFlutterService=M,this.sAztDialogService=je,this.sAztDocxService=tt,this.logger=new Et.Y,this.expandInfoParse={}}}return(se=Ye).\u0275fac=function(E){return new(E||se)(m.KVO(Qe.j),m.KVO(ft.Z),m.KVO(He.E),m.KVO(ze.B),m.KVO(J.j),m.KVO(ue.j),m.KVO(fe._),m.KVO(G.p),m.KVO(S.g),m.KVO(F.R),m.KVO(B._t),m.KVO(Ie._j),m.KVO(xe.h),m.KVO(Ze.R),m.KVO(Me.i),m.KVO(rt.I))},se.\u0275prov=m.jDH({token:se,factory:se.\u0275fac,providedIn:"root"}),Ye})()},92229:(gt,ke,v)=>{v.d(ke,{Y:()=>l});class l{pushChild(c){this.child.push(c)}pushMsg(c){this.msg=c}start(c){this.run=!0,c&&(this.msg=c)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const c=[];return this.msg&&""!==this.msg&&c.push(this.msg),`<p>${c.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let c=[];return this.child.filter(m=>m.run).forEach(m=>{c=c.concat(m.lines)}),c}constructor(c=!1,m="",x){this.run=c,this.msg=m,this.percent=x,this.child=[]}}},44101:(gt,ke,v)=>{v.d(ke,{i:()=>ls});var l=v(48891),d=v(407),c=v(59702),m=v(59640),x=v(50622),C=v(99927),Y=v(86622),y=v(46899);let ae=(()=>{var A;class Fe extends m.H{showExplain(){this.isTeacherRole||!this.examConfig||"SHOW_EXPLAIN"!==this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction||this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought?this.isShowExplainChange.emit(!this.isShowExplain):this.showDialogBuyExam(this.examObj)}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage(!0)}showDialogBuyExam(we){this.sAztDialogService.open(c.Q,{data:{examObj:we},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0})}isKey(we){return!(!this.questionObj?.answers||!this.questionObj.answerResult)&&(we.key?we.key==this.questionObj.answerResult[0]:we==this.questionObj.answerResult[0])}haveChoose(we){return!!this.userAnswersObj["id_"+this.questionObj?.id]&&(we.key?we.key.toString()==this.userAnswersObj["id_"+this.questionObj?.id]:we.toString()==this.userAnswersObj["id_"+this.questionObj?.id])}findKey(){this.questionObj?.answerResult&&this.labelArr.every(we=>!this.questionObj||!this.questionObj.answerResult||this.questionObj.answerResult[0]!=we.key||(this.key=(this.isShowOriginAnswer?we.key:we.alpha??we.key)??"",!1))}checkShowExplainButton(){this.isShowExplainButton=!!(this.questionObj.help||"lang_core_show_explain_required_payment"==this.questionObj.help&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigObj?.priceForAction)}checkLabelArr(){this.labelArr=this.sAztAnswerTrueFalseService.checkLabelArrOriginOrMix(this.questionAnswers,this.isShowOriginAnswer),this.findKey()}ngOnChanges(we){we.isShowOriginAnswer&&this.questionObj&&this.checkLabelArr()}ngOnInit(){if(super.ngOnInit(),this.isFillAnswer=this.questionObj?.correctAnswer??!1,this.answerTypeService.isTrueFalseAnswer(this.questionObj)?(this.keys=this.sAztAnswerTrueFalseService.checkLabelKeys(this.keys,this.questionObj?.answers,this.questionObj?.answerResult),this.isFillAnswer=!0):this.key=this.questionObj?.answerResult.length?this.questionObj.answerResult[0]:"",this.questionAnswers=(0,d.cloneDeep)(this.questionObj.answers??[]),this.checkLabelArr(),this.answerTypeService.isOneChoiceAnswer(this.questionObj))for(let we=0;we<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[we])&&this.haveChoose(this.labelArr[we]),!0!==this.isFillAnswer);we++);this.answerTypeService.isFillAnswer(this.questionObj)&&this.questionObj?.answerResult&&this.questionObj.answerResult.length>0&&(this.keys=this.questionObj.answerResult,this.isFillAnswer=this.questionObj?.correctAnswer??!1),this.checkShowExplainButton()}constructor(we,Ne,Nt,di){super(),this.sAztAnswerTrueFalseService=we,this.answerTypeService=Ne,this.answerBoxService=Nt,this.sAztDialogService=di,this.isShowExplain=!1,this.isOfflineMark=!1,this.isTeacherRole=!0,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.isShowExplainChange=new l.bkB,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1,this.isShowExplainButton=!1,this.questionAnswers=[]}}return(A=Fe).\u0275fac=function(we){return new(we||A)(l.rXU(x.j),l.rXU(C._),l.rXU(Y.C),l.rXU(y.i))},A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-base"]],inputs:{examObj:"examObj",questionObj:"questionObj",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isTeacherRole:"isTeacherRole",isShowOriginAnswer:"isShowOriginAnswer",examConfig:"examConfig",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab",backToLink:"backToLink"},outputs:{isShowExplainChange:"isShowExplainChange"},features:[l.Vt3,l.OA$],decls:0,vars:0,template:function(we,Ne){},encapsulation:2}),Fe})();var V=v(54460),P=v(15343),R=v(76975);const U=A=>({width:A,visibility:"visible"}),D=()=>({"ml-1":!0}),Ae=A=>({color:A}),H=A=>({"border-color":A}),N=()=>({"text-danger wrongIcon mr-1":!0}),w=()=>({"rightIcon text-success mr-1":!0}),q=()=>({"text-danger mr-1":!0}),me=()=>({"text-success mr-1":!0});function pe(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"span",6),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",7),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("ngStyle",l.eq3(6,U,b.questionObj.help?"125px":"0px")),l.R7$(),l.SpI(" ",l.bMT(2,4,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",b.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(8,D))}}function ce(A,Fe){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,N))}function ie(A,Fe){if(1&A&&l.DNE(0,ce,1,2,"lucide-icon",16),2&A){const b=l.XpG().$implicit,we=l.XpG(2);l.Y8G("ngIf",we.haveChoose(b))}}function Oe(A,Fe){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,w))}function Ce(A,Fe){if(1&A&&(l.j41(0,"div",12),l.DNE(1,ie,1,1,"ng-template",13)(2,Oe,1,2,"lucide-icon",14),l.j41(3,"span",15),l.EFF(4),l.k0s()()),2&A){const b=Fe.$implicit,we=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(we.isKey(b)&&we.haveChoose(b))),l.R7$(),l.Y8G("ngIf",we.isKey(b)&&we.haveChoose(b)),l.R7$(2),l.JRh(b.alpha?b.alpha:b.key?b.key:b)}}function Ke(A,Fe){if(1&A&&(l.j41(0,"div",8)(1,"span",9),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",10),l.DNE(5,Ce,5,3,"div",11),l.k0s()()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngStyle",l.eq3(7,Ae,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(3,5,"lang_auto_dap_an_dung"),": ",b.key,""),l.R7$(2),l.Y8G("ngStyle",l.eq3(9,H,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",b.labelArr)}}function Te(A,Fe){if(1&A&&(l.qex(0),l.j41(1,"span",25),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"mytranslate"),l.k0s(),l.bVm()),2&A){const b=Fe.$implicit,we=l.XpG(2);l.R7$(),l.Y8G("ngStyle",l.eq3(9,Ae,l.brH(2,3,b,we.keys,we.userAnswersObj["id_"+we.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b," - ",l.bMT(4,7,we.keys.includes((b.alpha?b.alpha:b.key?b.key:"")+"T")?"lang_auto_dung":"lang_auto_sai"),"\xa0 ")}}function at(A,Fe){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,q))}function de(A,Fe){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,me))}function Be(A,Fe){if(1&A&&(l.j41(0,"div",26),l.DNE(1,at,1,2,"lucide-icon",16),l.nI1(2,"isTrueAnswerType5"),l.DNE(3,de,1,2,"lucide-icon",14),l.nI1(4,"isTrueAnswerType5"),l.j41(5,"span",15),l.EFF(6),l.nI1(7,"getAnswerChoiceTrueFalseQuestion"),l.nI1(8,"mytranslate"),l.k0s()()),2&A){const b=Fe.$implicit,we=l.XpG(2);l.R7$(),l.Y8G("ngIf",!l.brH(2,4,b,we.keys,we.userAnswersObj["id_"+(null==we.questionObj?null:we.questionObj.id)])),l.R7$(2),l.Y8G("ngIf",l.brH(4,8,b,we.keys,we.userAnswersObj["id_"+(null==we.questionObj?null:we.questionObj.id)])),l.R7$(3),l.Lme("",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b," - ",l.bMT(8,15,l.i5U(7,12,b,we.userAnswersObj["id_"+we.questionObj.id])),"")}}function oe(A,Fe){if(1&A&&(l.j41(0,"div",19)(1,"span",20),l.EFF(2),l.nI1(3,"mytranslate"),l.DNE(4,Te,5,11,"ng-container",21),l.k0s(),l.j41(5,"div",22)(6,"div",23),l.DNE(7,Be,9,17,"div",24),l.k0s()()()),2&A){const b=l.XpG();l.R7$(2),l.SpI(" ",l.bMT(3,4,"lang_auto_dap_an_dung"),": "),l.R7$(2),l.Y8G("ngForOf",b.labelArr),l.R7$(),l.Y8G("ngStyle",l.eq3(6,H,b.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.Y8G("ngForOf",b.labelArr)}}function Le(A,Fe){if(1&A&&(l.j41(0,"span",9),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const b=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,Ae,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",b.keys.join("],["),"]")}}function L(A,Fe){if(1&A&&(l.j41(0,"div",8),l.DNE(1,Le,3,7,"span",27),l.j41(2,"div",28)(3,"div",29),l.EFF(4),l.nI1(5,"trimEndFillAnswer"),l.nI1(6,"mytranslate"),l.k0s()()()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",b.keys),l.R7$(),l.Y8G("ngStyle",l.eq3(8,H,b.isFillAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==b.userAnswersObj["id_"+b.questionObj.id]?l.i5U(5,3,b.userAnswersObj["id_"+b.questionObj.id],b.isOfflineMark):l.bMT(6,6,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function te(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"div")(1,"span",32),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG(2);return l.Njj(Ne.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.JRh(l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function Ge(A,Fe){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function be(A,Fe){if(1&A&&(l.qex(0),l.nrm(1,"div",33),l.bVm()),2&A){const b=l.XpG(3);l.R7$(),l.Y8G("innerText",b.userAnswersObj["id_"+b.questionObj.id])}}function Q(A,Fe){if(1&A&&(l.qex(0),l.DNE(1,Ge,3,3,"div",31)(2,be,2,1,"ng-container",31),l.bVm()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",!b.userAnswersObj["id_"+b.questionObj.id]),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+b.questionObj.id])}}function ye(A,Fe){if(1&A&&(l.j41(0,"div",30),l.DNE(1,te,4,3,"div",31)(2,Q,3,2,"ng-container",31),l.k0s()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==b.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=b.currentTab)}}let ct=(()=>{var A;class Fe extends ae{ngOnInit(){super.ngOnInit()}}return(A=Fe).\u0275fac=(()=>{let b;return function(Ne){return(b||(b=l.xGo(A)))(Ne||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-teacher"]],features:[l.Vt3],decls:11,vars:13,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none"],[1,"flex"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k","class","explainTxt text-pending cursor-pointer mt-2",3,"ngStyle","click",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box-type1 mt-2","style","flex-wrap: wrap",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k",1,"explainTxt","text-pending","cursor-pointer","mt-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"answer-box-type1","mt-2"],[1,"keyText","my-1",3,"ngStyle"],["id","type_1",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"answer-box-type1","mt-2",2,"flex-wrap","wrap"],[1,"keyText","my-1"],[4,"ngFor","ngForOf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],[1,"label-item",2,"display","block !important","width","auto !important"],["class","flex w-full mt-1","style","align-items: center",4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"flex","w-full","mt-1",2,"align-items","center"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(we,Ne){1&we&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,pe,4,9,"span",2),l.k0s(),l.DNE(3,Ke,6,11,"div",3),l.nI1(4,"isOneChoiceAnswer"),l.DNE(5,oe,8,8,"div",4),l.nI1(6,"isTrueFalseAnswer"),l.DNE(7,L,7,10,"div",3),l.nI1(8,"isFillAnswer"),l.DNE(9,ye,3,2,"div",5),l.nI1(10,"isEssayAnswer"),l.k0s()),2&we&&(l.R7$(2),l.Y8G("ngIf",Ne.questionObj.help),l.R7$(),l.Y8G("ngIf",l.bMT(4,5,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(6,7,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(8,9,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(10,11,Ne.questionObj)))},dependencies:[V.YU,V.Sq,V.bT,V.B3,P.WGl,R.wp,R.V6,R.Zm,R.N3,R.FC,R.jr,R.C0,R.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Fe})();var Dt=v(65162);const nt=A=>({"p-2":A}),Et=A=>({"justify-content":A}),Qe=A=>({"mt-3":A}),ft=(A,Fe,b)=>({width:A,"margin-right":Fe,"margin-left":b}),He=()=>({"ml-1":!0}),ze=A=>[A],J=A=>({backto:A}),ue=()=>({"text-transform":"uppercase"}),fe=(A,Fe)=>({"flex justify-between w-full items-center":A,"answer-box-type1":Fe}),G=A=>({"border-color":A}),S=A=>({color:A}),F=()=>({"text-danger mr-1":!0}),B=()=>({"mr-1":!0}),Ie=()=>({"text-success mr-1":!0}),xe=A=>({"w-full":A}),Ze=()=>({color:"#00ac33",width:"53px"}),Me=A=>({color:A,width:"53px"}),rt=()=>({color:"red"});function st(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("ngStyle",l.sMw(7,ft,b.isShowExplainButton?"125px":"0px",b.isShowExplainButton?"-40px":"0px",b.isMobileDevice?"":"8px")),l.BMQ("style",b.isShowExplainButton&&!b.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",b.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(11,He))}}function se(A,Fe){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const b=l.XpG();l.Y8G("routerLink",l.eq3(8,ze,l.bMT(1,4,"/on-luyen/"+b.questionObj.practiceHashId)))("queryParams",l.eq3(10,J,b.backToLink))("ngStyle",l.lJ4(12,ue)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function Ye(A,Fe){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const b=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,S,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung"),": ",b.key,"")}}function $e(A,Fe){1&A&&l.nrm(0,"span",17)}function E(A,Fe){1&A&&l.nrm(0,"lucide-icon",23),2&A&&l.Y8G("ngClass",l.lJ4(1,F))}function W(A,Fe){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,B))}function $(A,Fe){if(1&A&&l.DNE(0,E,1,2,"lucide-icon",22)(1,W,1,2,"lucide-icon",20),2&A){const b=l.XpG().$implicit,we=l.XpG(2);l.Y8G("ngIf",we.haveChoose(b)&&2!=we.examObj.whenShowAnswer&&!we.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",we.haveChoose(b)&&2!=we.examObj.whenShowAnswer&&we.notShowAnswerYet)}}function K(A,Fe){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,B))}function ge(A,Fe){if(1&A&&l.DNE(0,K,1,2,"lucide-icon",20),2&A){const b=l.XpG().$implicit,we=l.XpG(2);l.Y8G("ngIf",we.haveChoose(b)&&2==we.examObj.whenShowAnswer)}}function he(A,Fe){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,Ie))}function ee(A,Fe){if(1&A&&(l.j41(0,"div",18),l.DNE(1,$,2,2,"ng-template",19)(2,ge,1,1,"ng-template",19)(3,he,1,2,"lucide-icon",20),l.j41(4,"span",21),l.EFF(5),l.k0s()()),2&A){const b=Fe.$implicit,we=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(we.isKey(b)&&we.haveChoose(b))),l.R7$(),l.Y8G("ngIf",!(we.isKey(b)&&we.haveChoose(b))),l.R7$(),l.Y8G("ngIf",we.isKey(b)&&we.haveChoose(b)&&2!=we.examObj.whenShowAnswer),l.R7$(2),l.JRh(b.alpha?b.alpha:b.key?b.key:b)}}function Re(A,Fe){if(1&A&&(l.j41(0,"div",11),l.DNE(1,Ye,3,7,"span",12)(2,$e,1,0,"span",13),l.j41(3,"div",14),l.DNE(4,ee,6,4,"div",15),l.k0s()()),2&A){const b=l.XpG();l.Y8G("ngClass",l.l_i(5,fe,b.isMobileDevice,!b.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",b.keys&&2==b.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(8,G,b.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",b.labelArr)}}function Pe(A,Fe){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.bVm()),2&A){const b=Fe.$implicit,we=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.lJ4(5,Ze)),l.R7$(),l.Lme(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b,") ",l.bMT(3,3,we.keys.includes((b.alpha?b.alpha:b.key?b.key:"")+"T")?"lang_auto_dung":"lang_auto_sai")," ")}}function Ee(A,Fe){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,Pe,4,6,"ng-container",31),l.k0s()()),2&A){const b=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_auto_dap_an_dung"),":"),l.R7$(3),l.Y8G("ngForOf",b.labelArr)}}function Ue(A,Fe){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"getAnswerChoiceTrueFalseQuestion"),l.nI1(5,"mytranslate"),l.k0s(),l.bVm()),2&A){const b=Fe.$implicit,we=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.eq3(12,Me,l.brH(2,3,b,we.keys,we.userAnswersObj["id_"+we.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b,") ",l.bMT(5,10,l.i5U(4,7,b,we.userAnswersObj["id_"+we.questionObj.id]))," ")}}function We(A,Fe){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,Ue,6,14,"ng-container",31),l.k0s()()),2&A){const b=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_dap_an_thi_sinh_chon"),":"),l.R7$(3),l.Y8G("ngForOf",b.labelArr)}}function Xe(A,Fe){if(1&A&&(l.j41(0,"span",32),l.EFF(1),l.k0s()),2&A){const b=l.XpG().$implicit;l.Y8G("ngStyle",l.lJ4(2,rt)),l.R7$(),l.SpI(" ",b.alpha?b.alpha.toLowerCase():b.key?b.key.toLowerCase():b,") \xa0 ")}}function M(A,Fe){if(1&A&&(l.qex(0),l.DNE(1,Xe,2,3,"span",34),l.nI1(2,"isTrueAnswerType5"),l.bVm()),2&A){const b=Fe.$implicit,we=l.XpG(3);l.R7$(),l.Y8G("ngIf",!l.brH(2,1,b,we.keys,we.userAnswersObj["id_"+we.questionObj.id]))}}function je(A,Fe){if(1&A&&(l.j41(0,"div",33)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.DNE(4,M,3,5,"ng-container",31),l.k0s()),2&A){const b=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_cau_lam_sai"),":"),l.R7$(2),l.Y8G("ngForOf",b.labelArr)}}function tt(A,Fe){if(1&A&&(l.j41(0,"div",25),l.DNE(1,Ee,6,4,"div",26)(2,We,6,4,"div",26)(3,je,5,4,"div",27),l.k0s()),2&A){const b=l.XpG();l.Y8G("ngClass",l.eq3(4,xe,b.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function lt(A,Fe){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const b=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,S,b.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",b.keys.join("],["),"]")}}function ut(A,Fe){1&A&&l.nrm(0,"span",17)}function it(A,Fe){if(1&A&&(l.j41(0,"div",35),l.DNE(1,lt,3,7,"span",12)(2,ut,1,0,"span",13),l.j41(3,"div",36)(4,"div",37),l.EFF(5),l.nI1(6,"trimEndFillAnswer"),l.nI1(7,"mytranslate"),l.k0s()()()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",b.keys&&2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",b.keys&&2==b.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(9,G,b.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==b.userAnswersObj["id_"+b.questionObj.id]?l.i5U(6,4,b.userAnswersObj["id_"+b.questionObj.id],b.isOfflineMark):l.bMT(7,7,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function ht(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"div")(1,"span",40),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG(2);return l.Njj(Ne.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Ut(A,Fe){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function xt(A,Fe){if(1&A&&(l.qex(0),l.nrm(1,"div",41),l.bVm()),2&A){const b=l.XpG(3);l.R7$(),l.Y8G("innerText",b.userAnswersObj["id_"+b.questionObj.id])}}function mn(A,Fe){if(1&A&&(l.qex(0),l.DNE(1,Ut,3,3,"div",39)(2,xt,2,1,"ng-container",39),l.bVm()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===b.userAnswersObj["id_"+b.questionObj.id]),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+b.questionObj.id])}}function Kt(A,Fe){if(1&A&&(l.j41(0,"div",38),l.DNE(1,ht,4,3,"div",39)(2,mn,3,2,"ng-container",39),l.k0s()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==b.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=b.currentTab)}}let an=(()=>{var A;class Fe extends ae{}return(A=Fe).\u0275fac=(()=>{let b;return function(Ne){return(b||(b=l.xGo(A)))(Ne||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-full-answer-for-student"]],features:[l.Vt3],decls:12,vars:23,consts:[[1,"question-standalone-answer-box-for-student","box","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngClass","ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center",3,"ngClass"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","mt-2 font-bold",3,"ngClass",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"mt-2","font-bold",3,"ngClass"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"keyText","my-1",3,"ngStyle"],[1,"keyText","my-1","ml-2"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[3,"ngClass"],["class","keyText my-1 font-medium flex",4,"ngIf"],["class","keyText my-1 font-medium text-red flex",4,"ngIf"],[1,"keyText","my-1","font-medium","flex"],[2,"width","100px"],[1,"flex","justify-between"],[4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"keyText","my-1","font-medium","text-red","flex"],["class","lalala ml-1",3,"ngStyle",4,"ngIf"],[1,"answer-box-type1","mt-2"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(we,Ne){1&we&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,st,4,12,"span",2)(3,se,4,13,"a",3),l.k0s(),l.DNE(4,Re,5,10,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,tt,4,6,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,it,8,11,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,Kt,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&we&&(l.Y8G("ngClass",l.eq3(17,nt,!Ne.isMobileDevice))("ngStyle",l.eq3(19,Et,2==Ne.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(),l.Y8G("ngClass",l.eq3(21,Qe,Ne.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=Ne.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Ne.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,9,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,11,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,13,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,15,Ne.questionObj)))},dependencies:[V.YU,V.Sq,V.bT,V.B3,Dt.Wk,P.WGl,R.F2,R.wp,R.V6,R.Zm,R.N3,R.FC,R.jr,R.C0,R.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Fe})();const In=A=>({"justify-content":A}),Bt=(A,Fe)=>({width:A,"margin-right":Fe,"margin-left":"8px"}),yt=()=>({"ml-1":!0}),dn=A=>[A],Nn=A=>({backto:A}),Vt=()=>({"text-transform":"uppercase"});function zn(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("ngStyle",l.l_i(7,Bt,b.isShowExplainButton?"125px":"0px",b.isShowExplainButton?"-40px":"0px")),l.BMQ("style",b.isShowExplainButton&&!b.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",b.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(10,yt))}}function gn(A,Fe){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const b=l.XpG();l.Y8G("routerLink",l.eq3(8,dn,l.bMT(1,4,"/on-luyen/"+b.questionObj.practiceHashId)))("queryParams",l.eq3(10,Nn,b.backToLink))("ngStyle",l.lJ4(12,Vt)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function Ht(A,Fe){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function En(A,Fe){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function fn(A,Fe){if(1&A&&(l.j41(0,"span",13),l.DNE(1,Ht,3,3,"span",14)(2,En,3,3,"span",15),l.k0s()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+(null==b.questionObj?null:b.questionObj.id)]===b.key),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+(null==b.questionObj?null:b.questionObj.id)]!==b.key)}}function vn(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"div",11),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.showExplain())}),l.DNE(1,fn,3,2,"span",12),l.k0s()}if(2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function An(A,Fe){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.nI1(3,"mytranslate"),l.k0s()),2&A){const b=l.XpG(3);l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")+" "+b.countCorrectAnswerTrueFalse()+" "+l.bMT(3,3,"lang_azt_answer")," ")}}function pn(A,Fe){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_do_not_choose_any_correct_answer")," "))}function tr(A,Fe){if(1&A&&(l.j41(0,"span",13),l.DNE(1,An,4,5,"span",14)(2,pn,3,3,"span",15),l.k0s()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",b.countCorrectAnswerTrueFalse()),l.R7$(),l.Y8G("ngIf",!b.countCorrectAnswerTrueFalse())}}function Ro(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"div",18),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.showExplain())}),l.DNE(1,tr,3,2,"span",12),l.k0s()}if(2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function Oo(A,Fe){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function Po(A,Fe){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function ko(A,Fe){if(1&A&&(l.j41(0,"span",13),l.DNE(1,Oo,3,3,"span",14)(2,Po,3,3,"span",15),l.k0s()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",b.isFillAnswer),l.R7$(),l.Y8G("ngIf",!b.isFillAnswer)}}function Mo(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"div",19),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.showExplain())}),l.DNE(1,ko,3,2,"span",12),l.k0s()}if(2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf",2!=b.examObj.whenShowAnswer&&!b.notShowAnswerYet)}}function Do(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"div")(1,"span",22),l.bIt("click",function(){l.eBV(b);const Ne=l.XpG(2);return l.Njj(Ne.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Fo(A,Fe){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Vo(A,Fe){if(1&A&&(l.qex(0),l.nrm(1,"div",23),l.bVm()),2&A){const b=l.XpG(3);l.R7$(),l.Y8G("innerText",b.userAnswersObj["id_"+b.questionObj.id])}}function No(A,Fe){if(1&A&&(l.qex(0),l.DNE(1,Fo,3,3,"div",21)(2,Vo,2,1,"ng-container",21),l.bVm()),2&A){const b=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===b.userAnswersObj["id_"+b.questionObj.id]),l.R7$(),l.Y8G("ngIf",b.userAnswersObj["id_"+b.questionObj.id])}}function zo(A,Fe){if(1&A&&(l.j41(0,"div",20),l.DNE(1,Do,4,3,"div",21)(2,No,3,2,"ng-container",21),l.k0s()),2&A){const b=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==b.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=b.currentTab)}}let jo=(()=>{var A;class Fe extends ae{countCorrectAnswerTrueFalse(){return this.labelArr.filter(we=>this.sAztAnswerTrueFalseService.checkIsTrueType5(we,this.keys,this.userAnswersObj["id_"+this.questionObj?.id])).length}}return(A=Fe).\u0275fac=(()=>{let b;return function(Ne){return(b||(b=l.xGo(A)))(Ne||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-only-true-or-false-answer-for-student"]],features:[l.Vt3],decls:12,vars:17,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","answer-box-type1 cursor-pointer mt-2",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer","style","flex-wrap: wrap",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer",3,"click",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"answer-box-type1","cursor-pointer","mt-2",3,"click"],["class","font-medium text-base my-1 px-1",4,"ngIf"],[1,"font-medium","text-base","my-1","px-1"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-success"],[1,"text-danger"],[1,"answer-box-type1","mt-2","cursor-pointer",2,"flex-wrap","wrap",3,"click"],[1,"answer-box-type1","mt-2","cursor-pointer",3,"click"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(we,Ne){1&we&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,zn,4,11,"span",2)(3,gn,4,13,"a",3),l.k0s(),l.DNE(4,vn,2,1,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,Ro,2,1,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,Mo,2,1,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,zo,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&we&&(l.Y8G("ngStyle",l.eq3(15,In,2==Ne.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(2),l.Y8G("ngIf",2!=Ne.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Ne.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,7,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,9,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,11,Ne.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,13,Ne.questionObj)))},dependencies:[V.YU,V.bT,V.B3,Dt.Wk,P.WGl,R.F2,R.wp,R.V6,R.Zm,R.N3,R.FC],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Fe})();function Bo(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-full-answer-for-student",2),l.mxI("isShowExplainChange",function(Ne){l.eBV(b);const Nt=l.XpG();return l.DH7(Nt.isShowExplain,Ne)||(Nt.isShowExplain=Ne),l.Njj(Ne)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.isShowExplainChange.emit(Ne.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet)("isTeacherRole",b.isTeacherRole)("isShowOriginAnswer",b.isShowOriginAnswer),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}function ci(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-only-true-or-false-answer-for-student",3),l.mxI("isShowExplainChange",function(Ne){l.eBV(b);const Nt=l.XpG();return l.DH7(Nt.isShowExplain,Ne)||(Nt.isShowExplain=Ne),l.Njj(Ne)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.isShowExplainChange.emit(Ne.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("isTeacherRole",b.isTeacherRole)("isShowOriginAnswer",b.isShowOriginAnswer)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}let Lo=(()=>{var A;class Fe extends ae{constructor(){super(...arguments),this.checkShowFullAnswer=!1}ngOnInit(){this.checkShowFullAnswer=!(this.examConfig&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction&&!this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought)}}return(A=Fe).\u0275fac=(()=>{let b;return function(Ne){return(b||(b=l.xGo(A)))(Ne||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-student"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(we,Ne){1&we&&l.DNE(0,Bo,1,11,"azt-answer-box-with-user-full-answer-for-student",0)(1,ci,1,11,"azt-answer-box-with-user-only-true-or-false-answer-for-student",1),2&we&&(l.Y8G("ngIf",Ne.checkShowFullAnswer),l.R7$(),l.Y8G("ngIf",!Ne.checkShowFullAnswer))},dependencies:[V.bT,an,jo],encapsulation:2}),Fe})();function ui(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-student",2),l.mxI("isShowExplainChange",function(Ne){l.eBV(b);const Nt=l.XpG();return l.DH7(Nt.isShowExplain,Ne)||(Nt.isShowExplain=Ne),l.Njj(Ne)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.isShowExplainChange.emit(Ne.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet)("isTeacherRole",b.isTeacherRole)("isShowOriginAnswer",b.isShowOriginAnswer),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}function hi(A,Fe){if(1&A){const b=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-teacher",3),l.mxI("isShowExplainChange",function(Ne){l.eBV(b);const Nt=l.XpG();return l.DH7(Nt.isShowExplain,Ne)||(Nt.isShowExplain=Ne),l.Njj(Ne)}),l.bIt("isShowExplainChange",function(){l.eBV(b);const Ne=l.XpG();return l.Njj(Ne.isShowExplainChange.emit(Ne.isShowExplain))}),l.k0s()}if(2&A){const b=l.XpG();l.Y8G("examObj",b.examObj)("examConfig",b.examConfig)("questionObj",b.questionObj)("userAnswersObj",b.userAnswersObj)("notShowAnswerYet",b.notShowAnswerYet)("isShowOriginAnswer",b.isShowOriginAnswer)("isTeacherRole",b.isTeacherRole),l.R50("isShowExplain",b.isShowExplain),l.Y8G("backToLink",b.backToLink)("isOfflineMark",b.isOfflineMark)("currentTab",b.currentTab)}}let ls=(()=>{var A;class Fe extends ae{ngOnInit(){}}return(A=Fe).\u0275fac=(()=>{let b;return function(Ne){return(b||(b=l.xGo(A)))(Ne||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-view-base"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(we,Ne){1&we&&l.DNE(0,ui,1,11,"azt-answer-box-with-user-answer-for-student",0)(1,hi,1,11,"azt-answer-box-with-user-answer-for-teacher",1),2&we&&(l.Y8G("ngIf",!Ne.isTeacherRole),l.R7$(),l.Y8G("ngIf",Ne.isTeacherRole))},dependencies:[V.bT,ct,Lo],encapsulation:2}),Fe})()},84278:(gt,ke,v)=>{v.d(ke,{x:()=>pe});var l=v(64486),d=v(66793),c=v(30657),m=v(48891),x=v(54460),C=v(42789),Y=v(60780),y=v(58447),ae=v(15423),V=v(52325),P=v(54313),R=v(34660),U=v(97760),D=v(44101);const Ae=ce=>({"skeleton-box-loading":ce}),H=(ce,ie,Oe)=>({"pb-2":ce,"p-0":ie,"p-3":Oe}),N=()=>[];function w(ce,ie){if(1&ce&&m.nrm(0,"div",3),2&ce){const Oe=m.XpG();m.Y8G("ngClass",m.eq3(1,Ae,Oe.renderConfigObj.isFirstRender))}}function q(ce,ie){if(1&ce&&m.nrm(0,"azt-test-audio-ui",15),2&ce){const Oe=m.XpG(2);m.Y8G("questionObj",Oe.questionObj)("isShowList",!0)}}function me(ce,ie){if(1&ce){const Oe=m.RV6();m.j41(0,"div",4)(1,"div",5),m.nrm(2,"azt-question-group-content-box",6),m.j41(3,"div",7),m.DNE(4,q,1,2,"azt-test-audio-ui",8),m.j41(5,"div",9),m.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),m.k0s(),m.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),m.k0s()(),m.j41(10,"azt-answer-box-view-base",13),m.mxI("isShowExplainChange",function(Ke){m.eBV(Oe);const Te=m.XpG();return m.DH7(Te.isShowExplain,Ke)||(Te.isShowExplain=Ke),m.Njj(Ke)}),m.bIt("isShowExplainChange",function(Ke){m.eBV(Oe);const Te=m.XpG();return m.Njj(Te.isShowExplain=Ke)}),m.k0s(),m.nrm(11,"azt-question-explain-box",14),m.k0s()}if(2&ce){let Oe;const Ce=m.XpG();m.R7$(),m.xc7("font-size","1em")("line-height","1.7"),m.Y8G("id","question_render_container_"+Ce.questionObj.id)("ngClass",m.sMw(42,H,Ce.questionObj.attachments.length>0,Ce.isMobileDevice,!Ce.isMobileDevice)),m.R7$(),m.Y8G("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj),m.R7$(2),m.Y8G("ngIf",Ce.questionObj.attachments.length>0),m.R7$(2),m.Y8G("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj)("curQuestionIndex",Ce.curQuestionIndex),m.R7$(),m.Y8G("showForTeacher",!1)("curExamResultId",null!==(Oe=Ce.curExamResultId)&&void 0!==Oe?Oe:0)("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj)("curQuestionIndex",Ce.curQuestionIndex)("orgExamObjs",m.lJ4(46,N)),m.R7$(),m.Y8G("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj),m.R7$(),m.Y8G("examObj",Ce.examObj)("isShowOriginAnswer",Ce.isShowOriginAnswer)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj),m.R7$(),m.Y8G("examObj",Ce.examObj)("examConfig",Ce.examConfig)("isTeacherRole",!1)("isShowOriginAnswer",Ce.isShowOriginAnswer)("questionObj",Ce.questionObj)("userAnswersObj",Ce.userAnswersObj)("notShowAnswerYet",Ce.notShowAnswerYet),m.R50("isShowExplain",Ce.isShowExplain),m.Y8G("backToLink",Ce.backToLink)("isOfflineMark",Ce.isOfflineMark)("currentTab",Ce.currentTab),m.R7$(),m.Y8G("isShowExplain",Ce.isShowExplain)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj)}}let pe=(()=>{var ce;class ie extends l.I{ngOnInit(){super.ngOnInit();let Ce=new d.C(!1,!1,!1);super.initData(Ce,this.follower,this.questionObj),this.backToLink=`/test/answer-test/${this.examObj?.tenantId??0}/${this.examObj?.categoryId??0}/${this.examObj?.hashId}/${this.curExamResultId}`}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.isShowExplain=!1,this.isShowOriginAnswer=!1,this.isOfflineMark=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.checkShowFullAnswer=!1}}return(ce=ie).\u0275fac=function(Ce){return new(Ce||ce)},ce.\u0275cmp=m.VBU({type:ce,selectors:[["azt-question-standalone-for-student-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId",examConfig:"examConfig",isShowExplain:"isShowExplain",isShowOriginAnswer:"isShowOriginAnswer",isOfflineMark:"isOfflineMark",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[m.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","curExamResultId","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","isShowOriginAnswer","questionObj","renderConfigObj"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Ce,Ke){if(1&Ce&&(m.j41(0,"div",1),m.DNE(1,w,1,3,"div",2)(2,me,12,47,"ng-template",null,0,m.C5r),m.k0s()),2&Ce){const Te=m.sdS(3);m.Y8G("id","question_render_element_"+Ke.questionObj.id),m.R7$(),m.Y8G("ngIf",!Ke.renderConfigObj.isRenderElement)("ngIfElse",Te)}},dependencies:[x.YU,x.bT,C.N,Y.c,y.y,ae.N,V.Q,P.$,R.S,U.U,D.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ie})()},34815:(gt,ke,v)=>{v.d(ke,{o:()=>me});var l=v(64486),d=v(66793),c=v(30657),m=v(48891),x=v(54460),C=v(42789),Y=v(60780),y=v(58447),ae=v(15423),V=v(52325),P=v(54313),R=v(34660),U=v(97760),D=v(44101);const Ae=pe=>({"skeleton-box-loading":pe}),H=(pe,ce)=>({"pb-2":pe,"mob-web-width":ce});function N(pe,ce){if(1&pe&&m.nrm(0,"div",3),2&pe){const ie=m.XpG();m.Y8G("ngClass",m.eq3(1,Ae,ie.renderConfigObj.isFirstRender))}}function w(pe,ce){if(1&pe&&m.nrm(0,"azt-test-audio-ui",15),2&pe){const ie=m.XpG(2);m.Y8G("questionObj",ie.questionObj)("isShowList",!0)}}function q(pe,ce){if(1&pe){const ie=m.RV6();m.j41(0,"div",4)(1,"div",5),m.nrm(2,"azt-question-group-content-box",6),m.j41(3,"div",7),m.DNE(4,w,1,2,"azt-test-audio-ui",8),m.j41(5,"div",9),m.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),m.k0s(),m.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),m.k0s()(),m.j41(10,"azt-answer-box-view-base",13),m.mxI("isShowExplainChange",function(Ce){m.eBV(ie);const Ke=m.XpG();return m.DH7(Ke.isShowExplain,Ce)||(Ke.isShowExplain=Ce),m.Njj(Ce)}),m.bIt("isShowExplainChange",function(Ce){m.eBV(ie);const Ke=m.XpG();return m.Njj(Ke.isShowExplain=Ce)}),m.k0s(),m.nrm(11,"azt-question-explain-box",14),m.k0s()}if(2&pe){const ie=m.XpG();m.R7$(),m.xc7("font-size","1em")("line-height","1.7"),m.Y8G("id","question_render_container_"+ie.questionObj.id)("ngClass",m.l_i(39,H,ie.questionObj.attachments.length>0,ie.isMobileWebView)),m.R7$(),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj),m.R7$(2),m.Y8G("ngIf",ie.questionObj.attachments.length>0),m.R7$(2),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj)("curQuestionIndex",ie.curQuestionIndex),m.R7$(),m.Y8G("showForTeacher",!0)("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj)("curQuestionIndex",ie.curQuestionIndex)("orgExamObjs",ie.orgExamObjs),m.R7$(),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj),m.R7$(),m.Y8G("examObj",ie.examObj)("questionObj",ie.questionObj)("isShowOriginAnswer",ie.isShowOriginAnswer)("renderConfigObj",ie.renderConfigObj),m.R7$(),m.Y8G("examObj",ie.examObj)("isTeacherRole",!0)("isShowOriginAnswer",ie.isShowOriginAnswer)("questionObj",ie.questionObj)("userAnswersObj",ie.userAnswersObj)("notShowAnswerYet",ie.notShowAnswerYet)("isOfflineMark",ie.isOfflineMark),m.R50("isShowExplain",ie.isShowExplain),m.Y8G("currentTab",ie.currentTab),m.R7$(),m.Y8G("isShowExplain",ie.isShowExplain)("questionObj",ie.questionObj)("renderConfigObj",ie.renderConfigObj)}}let me=(()=>{var pe;class ce extends l.I{ngOnInit(){super.ngOnInit();let Oe=new d.C(!1,!1,!1);super.initData(Oe,this.follower,this.questionObj)}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.orgExamObjs=[],this.isShowExplain=!1,this.isOfflineMark=!1,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab"}}return(pe=ce).\u0275fac=function(Oe){return new(Oe||pe)},pe.\u0275cmp=m.VBU({type:pe,selectors:[["azt-question-standalone-for-teacher-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",orgExamObjs:"orgExamObjs",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isShowOriginAnswer:"isShowOriginAnswer",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[m.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"question-standalone-container","box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","questionObj","isShowOriginAnswer","renderConfigObj"],[3,"isShowExplainChange","examObj","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isOfflineMark","isShowExplain","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Oe,Ce){if(1&Oe&&(m.j41(0,"div",1),m.DNE(1,N,1,3,"div",2)(2,q,12,42,"ng-template",null,0,m.C5r),m.k0s()),2&Oe){const Ke=m.sdS(3);m.Y8G("id","question_render_element_"+Ce.questionObj.id),m.R7$(),m.Y8G("ngIf",!Ce.renderConfigObj.isRenderElement)("ngIfElse",Ke)}},dependencies:[x.YU,x.bT,C.N,Y.c,y.y,ae.N,V.Q,P.$,R.S,U.U,D.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ce})()},97760:(gt,ke,v)=>{v.d(ke,{U:()=>Ke});var l=v(59640),d=v(95887),c=v(89163),m=v(33887),x=v(25539),C=v(48891),Y=v(9280),y=v(54460),ae=v(52654),V=v(2915),P=v(52811),R=v(76975);function U(Te,at){1&Te&&(C.j41(0,"div",10)(1,"span",11),C.nrm(2,"azt-loading-ui"),C.k0s(),C.j41(3,"span",12),C.EFF(4),C.nI1(5,"mytranslate"),C.k0s()()),2&Te&&(C.R7$(4),C.JRh(C.bMT(5,1,"lang_auto_dang_chuan_bi_tai_lieu_doing")))}function D(Te,at){1&Te&&(C.j41(0,"div",13),C.EFF(1),C.nI1(2,"mytranslate"),C.k0s()),2&Te&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"lang_azt_cau_hoi_chua_co_lan_sua_nao")," "))}function Ae(Te,at){if(1&Te&&C.nrm(0,"azt-question-standalone-for-preview",17),2&Te){const de=C.XpG().$implicit,Be=C.XpG();C.Y8G("examObj",Be.data.examObj)("questionObj",de.questionLog)("follower",Be.data.follower)("curQuestionIndex",Be.data.curQuestionIndex)}}function H(Te,at){if(1&Te&&(C.qex(0),C.j41(1,"div",14),C.EFF(2),C.nI1(3,"mytranslate"),C.nI1(4,"formatFullDateTimeWithoutSecondByUserUnitPipe"),C.k0s(),C.j41(5,"div",15),C.DNE(6,Ae,1,4,"azt-question-standalone-for-preview",16),C.k0s(),C.bVm()),2&Te){const de=at.$implicit;C.R7$(2),C.SpI(" ",C.bMT(3,2,"lang_azota_ui_the_time_of_question_editing")+": "+C.bMT(4,4,de.createdAt)," "),C.R7$(4),C.Y8G("ngIf",de.questionLog)}}let N=(()=>{var Te;class at extends m._{closeDialog(){this.dialogRef.close()}getLogQuestion(Be){this.initStatusObj(),this.waitDestroy(this.questionService.apiQuestionsIdLogsGet(Be,this.data.isTeacher?void 0:this.data.curExamResultId).subscribe(oe=>{oe.success?((oe.data?.objs??[]).forEach(L=>{let te={createdAt:L.createdAt,questionLog:this.commonService.castJsonToClassObj(x.I,JSON.stringify(L.questionLog))};te.questionLog&&(te.questionLog.isLogEditQuestion=!0),this.questionLogCustomList.push(te)}),this.successStatusObj()):this.errorStatusObj(oe.message??"",!0)}))}ngOnInit(){this.getLogQuestion(this.data.questionObj.id)}constructor(Be,oe,Le){super(Le,oe),this.questionService=Be,this.dialogRef=oe,this.data=Le,this.questionLogCustomList=[]}}return(Te=at).\u0275fac=function(Be){return new(Be||Te)(C.rXU(Y.wP),C.rXU(c.CP,8),C.rXU(c.Vh,8))},Te.\u0275cmp=C.VBU({type:Te,selectors:[["show-question-edit-history-dialog"]],features:[C.Vt3],decls:15,vars:13,consts:[[1,"box"],[1,"font-medium","p-3","bg-slate-100","dark:bg-darkmode-400"],[3,"defaultHeight"],["class","flex justify-center items-center h-40",4,"ngIf"],["id","boxContentQuestion",1,"p-2"],["class","flex p-5 justify-center items-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","pt-3"],[1,"ml-auto"],[1,"btn","btn-secondary",3,"click"],[1,"flex","justify-center","items-center","h-40"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"flex","p-5","justify-center","items-center"],[1,"p-2","pb-0","text-xs","font-medium",2,"margin-bottom","-10px"],[1,"p-2"],[3,"examObj","questionObj","follower","curQuestionIndex",4,"ngIf"],[3,"examObj","questionObj","follower","curQuestionIndex"]],template:function(Be,oe){1&Be&&(C.j41(0,"div",0)(1,"div",1),C.EFF(2),C.nI1(3,"mytranslate"),C.nI1(4,"mytranslate"),C.k0s(),C.j41(5,"azt-mat-dialog-content",2),C.DNE(6,U,6,3,"div",3),C.j41(7,"div",4),C.DNE(8,D,3,3,"div",5)(9,H,7,6,"ng-container",6),C.k0s()(),C.j41(10,"div",7)(11,"div",8)(12,"button",9),C.bIt("click",function(){return oe.closeDialog()}),C.EFF(13),C.nI1(14,"mytranslate"),C.k0s()()()()),2&Be&&(C.R7$(2),C.Lme(" ",C.bMT(3,7,"lang_azota_ui_the_history_of_question_editing")," (",oe.questionLogCustomList.length+" "+C.bMT(4,9,"lang_testbank_powerpoint_times"),") "),C.R7$(3),C.Y8G("defaultHeight",60),C.R7$(),C.Y8G("ngIf",oe.statusObj.loading),C.R7$(2),C.Y8G("ngIf",!oe.questionLogCustomList.length&&!oe.statusObj.loading),C.R7$(),C.Y8G("ngForOf",oe.questionLogCustomList),C.R7$(4),C.SpI(" ",C.bMT(14,11,"lang_auto_dong")," "))},dependencies:[y.Sq,y.bT,ae.a,V.U,P.R,R.wp,R.bH],encapsulation:2}),at})();var w=v(30657),q=v(46899),me=v(65162),pe=v(9691),ce=v(47712),ie=v(15343);function Oe(Te,at){if(1&Te){const de=C.RV6();C.j41(0,"div",3)(1,"button",4),C.nI1(2,"mytranslate"),C.bIt("click",function(){C.eBV(de);const oe=C.XpG();return C.Njj(oe.goToEditQuestion())}),C.nrm(3,"lucide-icon",5),C.k0s()()}2&Te&&(C.R7$(),C.FS9("matTooltip",C.bMT(2,1,"lang_core_chinh_sua_de_thi")))}function Ce(Te,at){if(1&Te){const de=C.RV6();C.j41(0,"div")(1,"button",4),C.nI1(2,"mytranslate"),C.bIt("click",function(){C.eBV(de);const oe=C.XpG();return C.Njj(oe.showEditHistoryDialog())}),C.nrm(3,"lucide-icon",6),C.k0s()()}2&Te&&(C.R7$(),C.FS9("matTooltip",C.bMT(2,1,"lang_azota_ui_the_history_of_question_editing")))}let Ke=(()=>{var Te;class at extends l.H{checkEditQuestion(){const Be=this.questionObj?.createdAt,oe=this.questionObj?.updatedAt;let Le=this.timeService.calculationTimeOnlyMinutes(Be,oe);this.isEditQuestion=Number(Le)>0}isOrgQuestion(){return null!=this.orgExamObjs.find(Be=>Be.questionId==this.questionObj.id)}goToEditQuestion(){var Be=this.commonService.getMyParam(this.activeRoute,"cat_id")??"0",oe=this.activeRoute.snapshot.paramMap.get("result_id")??"0",Le=this.activeRoute.snapshot.paramMap.get("user_id")??"",L=this.activeRoute.snapshot.paramMap.get("student_id")??"",te=this.activeRoute.snapshot.paramMap.get("exam_id")??"",Ge=Be,be=te;let Q=this.orgExamObjs.find(Dt=>Dt.questionId==this.questionObj.id);Q&&(Ge=Q.orgCategoryId?.toString()??"0",be=Q.orgExamId?.toString()??"0");var ye=this.commonService.getMyQueryParam("backto")??"";let ct=`/admin/testbank/test-review/${te}/${Le}/${L}/${oe}`+(ye?"?backto="+encodeURIComponent(ye):"");window.location.href=this.commonService.getLocalRouter("/admin/testbank/update-exam/"+Ge)+"/"+be+"?backto="+encodeURIComponent(ct)+"&questionId="+this.questionObj.id}showEditHistoryDialog(){let Be={follower:new w.e,examObj:this.examObj,questionObj:this.questionObj,renderConfigObj:this.renderConfigObj,curQuestionIndex:this.curQuestionIndex,curExamResultId:this.curExamResultId,isTeacher:this.showForTeacher};this.sAztDialogService.open(N,{width:"750px",data:Be})}showFeedbackQuestionDialog(){this.sAztDialogService.open(d.g,{width:"750px",data:{questionObj:this.questionObj,role:this.showForTeacher?"TEACHER":"STUDENT",applyType:"MATRIX_QUESTION"},restoreFocus:!1,autoFocus:!1})}ngOnChanges(){this.checkEditQuestion()}constructor(Be,oe,Le){super(),this.sAztDialogService=Be,this.activeRoute=oe,this.timeService=Le,this.showForTeacher=!1,this.curExamResultId=0,this.isEditQuestion=!1}}return(Te=at).\u0275fac=function(Be){return new(Be||Te)(C.rXU(q.i),C.rXU(me.nX),C.rXU(pe.F))},Te.\u0275cmp=C.VBU({type:Te,selectors:[["azt-question-action-box"]],inputs:{examObj:"examObj",questionObj:"questionObj",renderConfigObj:"renderConfigObj",orgExamObjs:"orgExamObjs",showForTeacher:"showForTeacher",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId"},features:[C.Vt3,C.OA$],decls:4,vars:4,consts:[[1,"flex"],["class","mr-1",4,"ngIf"],[4,"ngIf"],[1,"mr-1"],[1,"btn","btn-outline-primary","btn-sm","p-1",3,"click","matTooltip"],["name","file-pen-line","size","18"],["name","history","size","18"]],template:function(Be,oe){1&Be&&(C.j41(0,"div",0),C.DNE(1,Oe,4,3,"div",1),C.nI1(2,"isOfflineExam"),C.DNE(3,Ce,4,3,"div",2),C.k0s()),2&Be&&(C.R7$(),C.Y8G("ngIf",oe.isOrgQuestion()&&!C.bMT(2,2,oe.examObj)),C.R7$(2),C.Y8G("ngIf",oe.isEditQuestion&&!oe.questionObj.isLogEditQuestion))},dependencies:[y.bT,ce.oV,ie.WGl,R.wp,R.st],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),at})()},86622:(gt,ke,v)=>{v.d(ke,{C:()=>c});var l=v(71217),d=v(48891);let c=(()=>{var m;class x{constructor(){this.switchEssayTabSource=new l.t(!1),this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(Y){this.switchEssayTabSource.next(Y)}}return(m=x).\u0275fac=function(Y){return new(Y||m)},m.\u0275prov=d.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),x})()},95887:(gt,ke,v)=>{v.d(ke,{g:()=>Be});var l=v(10936),d=v(89163),c=v(33887),m=v(15766),x=v(48891),C=v(96699),Y=v(54460),y=v(43404),ae=v(15343),V=v(81587),P=v(52811),R=v(9570),U=v(76975);const D=(oe,Le)=>({"btn-primary":oe,"btn-secondary":Le}),Ae=()=>({"mr-2":!0});function H(oe,Le){if(1&oe&&(x.j41(0,"div",22)(1,"b",23),x.EFF(2),x.k0s(),x.j41(3,"div",24),x.nrm(4,"azt-dynamic-hook",17),x.k0s()()),2&oe){let L;const te=Le.$implicit;x.R7$(2),x.SpI("",null!==(L=te.alpha)&&void 0!==L?L:te.key,"."),x.R7$(2),x.Y8G("content",te.content)}}function N(oe,Le){if(1&oe&&(x.j41(0,"div",20),x.DNE(1,H,5,2,"div",21),x.k0s()),2&oe){const L=x.XpG(2);x.R7$(),x.Y8G("ngForOf",L.data.questionObj.answers)}}function w(oe,Le){if(1&oe&&(x.j41(0,"h2",25),x.EFF(1),x.nI1(2,"mytranslate"),x.k0s()),2&oe){const L=x.XpG(2);x.R7$(),x.Lme(" ",x.bMT(2,2,"lang_auto_dap_an"),": ",L.data.questionObj.answerResult.join(", ")," ")}}function q(oe,Le){if(1&oe&&(x.j41(0,"div",8)(1,"h2",10),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",16),x.nrm(5,"azt-dynamic-hook",17),x.k0s(),x.DNE(6,N,2,1,"div",18)(7,w,3,4,"h2",19),x.k0s()),2&oe){const L=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,4,"lang_auto_noi_dung_cau_hoi")," "),x.R7$(3),x.Y8G("content",L.data.questionObj.content),x.R7$(),x.Y8G("ngIf",1==L.data.questionObj.answerType&&L.data.questionObj.answers&&L.data.questionObj.answers.length>0),x.R7$(),x.Y8G("ngIf",L.data.questionObj.answerResult&&L.data.questionObj.isRoleTeacher)}}function me(oe,Le){if(1&oe&&(x.j41(0,"div",8)(1,"h2",26),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",27),x.nrm(5,"azt-dynamic-hook",17),x.k0s()()),2&oe){const L=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,2,"lang_auto_loi_giai")," "),x.R7$(3),x.Y8G("content",L.data.questionObj.help)}}function pe(oe,Le){1&oe&&(x.qex(0),x.j41(1,"div",28)(2,"span",29),x.nrm(3,"azt-loading-ui"),x.k0s()(),x.bVm())}function ce(oe,Le){if(1&oe&&(x.j41(0,"div",44),x.nrm(1,"input",45),x.j41(2,"label",46),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()()),2&oe){const L=Le.$implicit,te=Le.index;x.R7$(),x.FS9("id","choice_"+te),x.FS9("formControlName","choice_"+te),x.R7$(),x.FS9("for","choice_"+te),x.R7$(),x.SpI(" ",x.bMT(4,4,L)," ")}}function ie(oe,Le){if(1&oe&&(x.qex(0),x.j41(1,"div",42),x.DNE(2,ce,5,6,"div",43),x.k0s(),x.bVm()),2&oe){const L=x.XpG().$implicit;x.R7$(),x.FS9("formGroupName","survey_"+L.id),x.R7$(),x.Y8G("ngForOf",L.choices)}}function Oe(oe,Le){if(1&oe&&(x.qex(0),x.j41(1,"mat-radio-button",49),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.bVm()),2&oe){const L=Le.$implicit,te=x.XpG(2).$implicit,Ge=x.XpG(3);x.R7$(),x.FS9("value",L),x.Y8G("checked",Ge.form.controls["survey_"+te.id].value==L),x.R7$(),x.JRh(x.bMT(3,3,L))}}function Ce(oe,Le){if(1&oe&&(x.j41(0,"mat-radio-group",47),x.DNE(1,Oe,4,5,"ng-container",48),x.k0s()),2&oe){const L=x.XpG().$implicit;x.FS9("formControlName","survey_"+L.id),x.R7$(),x.Y8G("ngForOf",L.choices)}}function Ke(oe,Le){if(1&oe&&(x.j41(0,"div",39)(1,"div",40)(2,"h2",41),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()(),x.j41(5,"div"),x.DNE(6,ie,3,2,"ng-container",11)(7,Ce,2,2,"ng-template",null,1,x.C5r),x.k0s()()),2&oe){const L=Le.$implicit,te=Le.index,Ge=x.sdS(8);x.R7$(3),x.Lme(" ",te+1+". ","",x.bMT(4,4,L.content)," "),x.R7$(3),x.Y8G("ngIf",L.multiChoice&&L.choices&&L.choices.length>1)("ngIfElse",Ge)}}function Te(oe,Le){if(1&oe&&(x.j41(0,"div"),x.DNE(1,Ke,9,6,"div",38),x.k0s()),2&oe){const L=x.XpG(2);x.R7$(),x.Y8G("ngForOf",L.surveyObjs)}}function at(oe,Le){if(1&oe){const L=x.RV6();x.DNE(0,Te,2,1,"div",30),x.j41(1,"div",31)(2,"button",32),x.bIt("click",function(){x.eBV(L);const Ge=x.XpG();return x.Njj(Ge.changeFeedBackEmotion(2))}),x.nrm(3,"lucide-icon",33),x.j41(4,"span"),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s()(),x.j41(7,"button",34),x.bIt("click",function(){x.eBV(L);const Ge=x.XpG();return x.Njj(Ge.changeFeedBackEmotion(1))}),x.nrm(8,"lucide-icon",35),x.j41(9,"span"),x.EFF(10),x.nI1(11,"mytranslate"),x.k0s()()(),x.j41(12,"div",36)(13,"textarea",37),x.nI1(14,"mytranslate"),x.bIt("keyup",function(){x.eBV(L);const Ge=x.XpG();return x.Njj(Ge.autoResizeFeedBackArea())}),x.k0s()()}if(2&oe){const L=x.XpG();x.Y8G("ngIf",L.surveyObjs.length),x.R7$(2),x.Y8G("disabled",L.disableLike)("ngClass",x.l_i(16,D,2==L.feedBackEmotion,2!=L.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(19,Ae)),x.R7$(2),x.JRh(x.bMT(6,10,"lang_test_market_introduce_rating_like")),x.R7$(2),x.Y8G("disabled",L.disableLike)("ngClass",x.l_i(20,D,1==L.feedBackEmotion,1!=L.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(23,Ae)),x.R7$(2),x.JRh(x.bMT(11,12,"lang_test_market_introduce_rating_dislike")),x.R7$(3),x.FS9("placeholder",x.bMT(14,14,"lang_global_question_ask_to_feedback_placeholder"))}}function de(oe,Le){1&oe&&(x.j41(0,"span",50),x.nrm(1,"azt-loading-ui"),x.k0s())}let Be=(()=>{var oe;class Le extends c._{getAnswerSurvey(){let te=[],Ge=this.commonService.getFormObj(this.form);for(let be in Ge)if(be.includes("survey_")){let Q={surveyId:Number(be.substring(be.indexOf("_")+1)),answers:[]};if(Ge[be]instanceof Object){let ye=this.surveyObjs.find(ct=>ct.id==Q.surveyId);if(ye)for(let ct in Ge[be])if(Ge[be][ct]){let Dt=Number(ct.substring(ct.indexOf("_")+1));if(Array.isArray(ye.choices)&&ye.choices[Dt]){let nt=ye.choices[Dt];Q.answers?.push(nt)}}}else Q.answers=[Ge[be]];te.push(Q)}return te}getFeedbackSurveys(){this.loadingFeedBackSurvey=!0,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksSurveysGet(this.applyType,this.role).subscribe(te=>{if(1==te.success){this.surveyObjs=te.data?.objs??[];let Ge={feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,m.M.noWhiteSpace]})};this.surveyObjs.length>0&&this.surveyObjs.forEach(be=>{if(be.multiChoice&&be.choices&&be.choices.length>1){let Q={};Ge[`survey_${be.id}`]=new l.gE({}),be.choices.forEach((ye,ct)=>{Q[`choice_${ct}`]=new l.MJ(!1,{nonNullable:!0})}),Ge[`survey_${be.id}`]=this.fb.group(Q)}else Ge[`survey_${be.id}`]=new l.MJ("",{nonNullable:!0,validators:[l.k0.required]})}),this.form=this.fb.group(Ge),this.loadingFeedBackSurvey=!1}else this.errorStatusObj(te.message??"",!0),this.loadingFeedBackSurvey=!1}))}getInfoFeedback(){this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksGet(this.questionId,this.applyType,this.role).subscribe(te=>{if(1==te.success){let Ge=te.data?.objs??[];Ge.length&&Ge[0].status&&(this.feedBackEmotion=Ge[0].status,this.disableLike=!0)}else this.errorStatusObj(te.message??"",!0),this.disableLike=!1}))}changeFeedBackEmotion(te){this.disableLike||(this.feedBackEmotion=te,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost({objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??void 0,content:"",surveyAnswers:[]}).subscribe(be=>{1==be.success?this.getInfoFeedback():this.errorStatusObj(be.message??"",!0)})))}autoResizeFeedBackArea(){const te=document.getElementById("text-area-feedback");te&&setTimeout(()=>{te.style.cssText="height:auto;",te.style.cssText="height:"+(te.scrollHeight+30)+"px"},0)}sendFeedBack(){if(this.form.invalid)this.showErrorSnack("lang_auto_vui_long_dien_day_du_thong_tin");else{this.initStatusObj(),this.sendingFeedBack=!0;let te={objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??0,content:this.form.controls.feedBackContent.value??void 0,surveyAnswers:this.getAnswerSurvey()};this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost(te).subscribe(Ge=>{1==Ge.success?(this.sendingFeedBack=!1,this.dialogRef.close(!0),this.successStatusObj("TEACHER"==this.role?"lang_test_market_success_feedback":"lang_test_market_success_feedback_student",!0)):(this.errorStatusObj(Ge.message??"",!0),this.sendingFeedBack=!1)}))}}btnCloseDialog(){this.dialogRef.close(!1)}ngOnInit(){this.questionId=this.data.questionObj.id,this.role=this.data.role,this.applyType=this.data.applyType,this.form=this.fb.group({feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,m.M.noWhiteSpace]})}),this.getInfoFeedback(),this.getFeedbackSurveys(),super.ngOnInit()}constructor(te,Ge,be,Q){super(Q,be),this.fb=te,this.testMarketFeedbackService=Ge,this.dialogRef=be,this.data=Q,this.role="",this.applyType="",this.form=new l.gE({}),this.feedBackEmotion=void 0,this.totalLike=0,this.totalDislike=0,this.sendingFeedBack=!1,this.loadingFeedBackSurvey=!1,this.disableLike=!1,this.surveyObjs=[]}}return(oe=Le).\u0275fac=function(te){return new(te||oe)(x.rXU(l.ok),x.rXU(C.l_),x.rXU(d.CP,8),x.rXU(d.Vh,8))},oe.\u0275cmp=x.VBU({type:oe,selectors:[["exam-matrix-feedback-dialog"]],features:[x.Vt3],decls:25,vars:19,consts:[["doneLoading",""],["SingleChoice",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-3","border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"intro-y","overflow-auto",2,"max-height","calc(100vh - 150px)"],[1,"text-md","mr-auto","font-bold"],["class","border-t border-slate-200/60 dark:border-darkmode-400 py-2 mt-2",4,"ngIf"],[1,"border-t","border-slate-200/60","dark:border-darkmode-400","py-2","mt-2"],[3,"formGroup"],[1,"font-medium","text-md","text-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"p-3","text-right"],["azt-track-service","exam-matrix-feedback-dialog-qXEblgFcT",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","exam-matrix-feedback-dialog-NGlD5D-IvA",1,"btn","btn-primary","mw-24",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"tex2jax_process","box-content",2,"width","auto"],[3,"content"],["class","grid grid-cols-12 gap-2 answers",4,"ngIf"],["class","font-medium text-md text-left text-success my-2",4,"ngIf"],[1,"grid","grid-cols-12","gap-2","answers"],["class","answer col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"answer","col-span-12","md:col-span-6"],[1,"answer-label"],[1,"answer-content"],[1,"font-medium","text-md","text-left","text-success","my-2"],[1,"font-medium","text-md","text-center"],[1,"help-content","box","px-3","mt-1",2,"display","inherit","border-top-right-radius","0","border-top-left-radius","0","box-shadow","none","overflow","auto","padding-bottom","20px"],[1,"flex","items-center","h-full","w-full"],[1,"w-8","h-8","mx-auto"],[4,"ngIf"],[1,"flex","items-center",2,"flex-wrap","wrap"],["azt-track-service","exam-matrix-feedback-dialog-PoMeFnagK",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-up","size","24",3,"ngClass"],["azt-track-service","exam-matrix-feedback-dialog-iJokCn34oQ",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-down","size","20",3,"ngClass"],[1,"items-center","mt-1"],["id","text-area-feedback","type","text","cols","10","rows","3","formControlName","feedBackContent",1,"form-control","mt-1",3,"keyup","placeholder"],["class","flex flex-wrap mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","mb-2"],[2,"min-width","300px"],[1,"text-md","mb-2"],[1,"block","px-2","ml-2","sm:flex",3,"formGroupName"],["class","mr-5",4,"ngFor","ngForOf"],[1,"mr-5"],["type","checkbox",1,"form-check-input",3,"id","formControlName"],[2,"vertical-align","middle","cursor","pointer","margin-left","3px",3,"for"],["color","primary",1,"px-2",2,"flex-direction","column",3,"formControlName"],[4,"ngFor","ngForOf"],[1,"mr-5",3,"checked","value"],[1,"w-4","h-4","mr-2"]],template:function(te,Ge){if(1&te){const be=x.RV6();x.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s(),x.DNE(7,q,8,6,"div",7)(8,me,6,4,"div",7),x.j41(9,"div",8)(10,"form",9)(11,"h2",10),x.EFF(12),x.nI1(13,"mytranslate"),x.k0s(),x.DNE(14,pe,4,0,"ng-container",11)(15,at,15,24,"ng-template",null,0,x.C5r),x.k0s()()()()(),x.j41(17,"div",12)(18,"button",13),x.bIt("click",function(){return x.eBV(be),x.Njj(Ge.btnCloseDialog())}),x.EFF(19),x.nI1(20,"mytranslate"),x.k0s(),x.j41(21,"button",14),x.bIt("click",function(){return x.eBV(be),x.Njj(Ge.sendFeedBack())}),x.DNE(22,de,2,0,"span",15),x.EFF(23),x.nI1(24,"mytranslate"),x.k0s()()()}if(2&te){const be=x.sdS(16);x.R7$(5),x.SpI(" ",x.bMT(6,11,Ge.data.questionObj.isRoleTeacher?"lang_global_question_ask_to_feedback":"lang_global_question_ask_to_report")," "),x.R7$(2),x.Y8G("ngIf",Ge.data.questionObj.content),x.R7$(),x.Y8G("ngIf",Ge.data.questionObj.help&&Ge.data.questionObj.isRoleTeacher),x.R7$(2),x.Y8G("formGroup",Ge.form),x.R7$(2),x.SpI(" ",x.bMT(13,13,"lang_auto_nhan_xet")," "),x.R7$(2),x.Y8G("ngIf",Ge.loadingFeedBackSurvey)("ngIfElse",be),x.R7$(5),x.SpI(" ",x.bMT(20,15,"lang_auto_dong")," "),x.R7$(2),x.Y8G("disabled",Ge.sendingFeedBack||Ge.form.invalid),x.R7$(),x.Y8G("ngIf",Ge.sendingFeedBack),x.R7$(),x.SpI(" ",x.bMT(24,17,"lang_button_send")," ")}},dependencies:[Y.YU,Y.Sq,Y.bT,y.VT,y._g,l.qT,l.me,l.Zm,l.BC,l.cb,l.j4,l.JD,l.$R,ae.WGl,V.t,P.R,R.x,U.wp],styles:[".answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}"]}),Le})()},14987:(gt,ke,v)=>{v.d(ke,{i:()=>y});var l=v(59640),d=v(48891),c=v(54460),m=v(10936),x=v(81587),C=v(76975);function Y(ae,V){if(1&ae&&(d.j41(0,"div",1)(1,"form",2),d.nrm(2,"input",3),d.nI1(3,"mytranslate"),d.nrm(4,"input",4),d.nI1(5,"mytranslate"),d.k0s()()),2&ae){const P=d.XpG();d.R7$(),d.Y8G("formGroup",P.form),d.R7$(),d.FS9("placeholder",d.bMT(3,3,"lang_auto_ten_truong")),d.R7$(2),d.FS9("placeholder",d.bMT(5,5,"lang_auto_mon_hoc_form"))}}let y=(()=>{var ae;class V extends l.H{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject})}ngOnInit(){this.initData()}}return(ae=V).\u0275fac=function(R){return new(R||ae)},ae.\u0275cmp=d.VBU({type:ae,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},features:[d.Vt3],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"]],template:function(R,U){1&R&&d.DNE(0,Y,6,7,"div",0),2&R&&d.Y8G("ngIf",U.form)},dependencies:[c.bT,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,x.t,C.wp],encapsulation:2}),V})()},30551:(gt,ke,v)=>{v.d(ke,{P:()=>q});var l=v(59640),d=v(48891),c=v(37642),m=v(36484),x=v(99927),C=v(54460),Y=v(60303),y=v(76975);const ae=me=>({"font-bold":me});function V(me,pe){if(1&me&&(d.j41(0,"td",11),d.EFF(1),d.k0s()),2&me){const ce=d.XpG().$implicit,ie=d.XpG().$implicit,Oe=d.XpG(2);d.BMQ("rowspan",ie.length),d.R7$(),d.JRh(Oe.toNumber(ce.index)+1)}}function P(me,pe){if(1&me&&(d.qex(0),d.j41(1,"tr"),d.DNE(2,V,2,2,"td",10),d.j41(3,"td",11),d.EFF(4),d.nI1(5,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(6,"td",12),d.EFF(7),d.k0s()(),d.bVm()),2&me){const ce=pe.$implicit,ie=pe.index,Oe=d.XpG(3);d.R7$(2),d.Y8G("ngIf",0==ie),d.R7$(2),d.JRh(d.bMT(5,4,1e3*ce.second)),d.R7$(2),d.Y8G("ngClass",d.eq3(6,ae,ce.isFontBold)),d.R7$(),d.JRh(Oe.isShowOriginAnswer?ce.key:ce.alpha?ce.alpha:ce.key)}}function R(me,pe){if(1&me&&(d.qex(0),d.DNE(1,P,8,8,"ng-container",9),d.bVm()),2&me){const ce=pe.$implicit;d.R7$(),d.Y8G("ngForOf",ce)}}function U(me,pe){if(1&me&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,R,2,1,"ng-container",9),d.k0s()),2&me){const ce=d.XpG();d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_cau_hoi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"lang_auto_dap_an")),d.R7$(2),d.Y8G("ngForOf",ce.groupObjs)}}function D(me,pe){1&me&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&me&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}function Ae(me,pe){if(1&me&&(d.qex(0),d.j41(1,"tr")(2,"td",11),d.EFF(3),d.k0s(),d.j41(4,"td",11),d.EFF(5),d.nI1(6,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(7,"td",11),d.EFF(8),d.k0s()(),d.bVm()),2&me){let ce;const ie=pe.$implicit;d.R7$(3),d.JRh(ie.userAgent),d.R7$(2),d.JRh(d.bMT(6,3,null!==(ce=ie.startedAt)&&void 0!==ce?ce:"")),d.R7$(3),d.JRh(ie.ip)}}function H(me,pe){if(1&me&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,Ae,9,5,"ng-container",9),d.k0s()),2&me){const ce=d.XpG(2);d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_thong_tin_thiet_bi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"IP")),d.R7$(2),d.Y8G("ngForOf",ce.ipTrackingDataObjs)}}function N(me,pe){1&me&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&me&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu")))}function w(me,pe){if(1&me&&(d.j41(0,"mat-tab",1),d.nI1(1,"mytranslate"),d.j41(2,"div",2),d.DNE(3,H,12,10,"table",3)(4,N,3,3,"ng-template",null,0,d.C5r),d.k0s()()),2&me){const ce=d.sdS(5),ie=d.XpG();d.FS9("label",d.bMT(1,3,"lang_auto_thong_tin_thiet_bi_IP")),d.R7$(3),d.Y8G("ngIf",ie.ipTrackingDataObjs.length>0)("ngIfElse",ce)}}let q=(()=>{var me;class pe extends l.H{findReTapQuesions(){var ie=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var Oe in ie)if(ie.hasOwnProperty(Oe)){var Ce=ie[Oe].map((Ke,Te)=>{let at=!1,de=this.questionObjs.find(Be=>Be.id==Ke.questionId);if(this.answerTypeService.isTrueFalseAnswer(de)){for(let Be=ie[Oe].length-1;Be>=0;Be--)if(ie[Oe][Be].key.includes(Ke.key.split("")[0])){at=Ke.key==ie[Oe][Be].key;break}}else at=Te==ie[Oe].length-1;return{...Ke,isFontBold:at}});this.groupObjs.push(Ce)}}toNumber(ie){return parseInt(ie,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(ie,Oe,Ce){super(),this.dictionaryService=ie,this.userService=Oe,this.answerTypeService=Ce,this.startQuestionIndex=1,this.isShowOriginAnswer=!1,this.ipTrackingDataObjs=[],this.isTeacherRole=this.userService.isTeacherRole(),this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return(me=pe).\u0275fac=function(ie){return new(ie||me)(d.rXU(c.E),d.rXU(m.R),d.rXU(x._))},me.\u0275cmp=d.VBU({type:me,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",isShowOriginAnswer:"isShowOriginAnswer",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs",ipTrackingDataObjs:"ipTrackingDataObjs",questionObjs:"questionObjs"},features:[d.Vt3],decls:8,vars:6,consts:[["noData",""],[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],[3,"label",4,"ngIf"],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(ie,Oe){if(1&ie&&(d.j41(0,"mat-tab-group")(1,"mat-tab",1),d.nI1(2,"mytranslate"),d.j41(3,"div",2),d.DNE(4,U,12,10,"table",3)(5,D,3,3,"ng-template",null,0,d.C5r),d.k0s()(),d.DNE(7,w,6,5,"mat-tab",4),d.k0s()),2&ie){const Ce=d.sdS(6);d.R7$(),d.FS9("label",d.bMT(2,4,"lang_auto_chi_tiet_chon_dap_an")),d.R7$(3),d.Y8G("ngIf",Oe.groupObjs.length>0)("ngIfElse",Ce),d.R7$(3),d.Y8G("ngIf",Oe.isTeacherRole)}},dependencies:[C.YU,C.Sq,C.bT,Y.mq,Y.T8,y.wp,y.Ky],encapsulation:2}),pe})()},78745:(gt,ke,v)=>{v.d(ke,{d:()=>D});var l=v(59640),d=v(48891),c=v(54460),m=v(17818),x=v(47712),C=v(15343),Y=v(64160),y=v(15437),ae=v(76975);const V=()=>({"mr-2":!0});function P(Ae,H){if(1&Ae){const N=d.RV6();d.qex(0),d.j41(1,"div",6)(2,"p",7),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"p",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"div",8),d.nrm(9,"input",9),d.j41(10,"button",10),d.bIt("click",function(){d.eBV(N);const q=d.XpG();return d.Njj(q.showCopySuccess())}),d.nrm(11,"lucide-icon",11),d.EFF(12),d.nI1(13,"mytranslate"),d.k0s()()(),d.bVm()}if(2&Ae){const N=d.XpG();d.R7$(3),d.JRh(d.bMT(4,6,"lang_auto_hoac")),d.R7$(3),d.JRh(d.bMT(7,8,"lang_classroom_QR_join_link_copy")),d.R7$(3),d.Y8G("value",N.linkUrl),d.R7$(),d.Y8G("cdkCopyToClipboard",N.copyLinkToClipboard(N.linkUrl)),d.R7$(),d.Y8G("ngClass",d.lJ4(12,V)),d.R7$(),d.SpI(" ",d.bMT(13,10,"lang_auto_sao_chep")," ")}}let R=(()=>{var Ae;class H extends l.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1,this.qrCodeDownloadLink=""}showCopySuccess(){this.showSuccessSnack("lang_auto_sao_chep_thanh_cong")}copyLinkToClipboard(w){return w}onChangeURL(w){this.qrCodeDownloadLink=w}downloadQrCode(){try{let w=""!=this.fileName?this.commonService.createFileNameExportFile([this.fileName])+".jpg":this.commonService.createFileNameExportFile(["azota-qr-code-"])+".jpg";this.commonService.downloadFileByUrl(this.qrCodeDownloadLink.changingThisBreaksApplicationSecurity,w)}catch{console.log("Download QrCode error")}}}return(Ae=H).\u0275fac=(()=>{let N;return function(q){return(N||(N=d.xGo(Ae)))(q||Ae)}})(),Ae.\u0275cmp=d.VBU({type:Ae,selectors:[["azt-show-link"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:8,vars:11,consts:[["azt-track-service","download-qr-code-9t-9Wiu2xv",1,"box","p-3","text-center",3,"click"],[2,"background","#fff","padding","5px"],["colorDark","#2361ad","imageSrc","'images/Azota-For-QrCode-01.png' | convertCdnLinkOfGitHub",3,"qrCodeURL","allowEmptyString","qrdata","elementType","width","errorCorrectionLevel"],["azt-track-service","download-qr-code-RqVBz6g1z7",1,"btn","btn-outline-primary","btn-transparent","btn-sm","mx-auto","mt-2",3,"click"],["name","download","size","16",3,"ngClass"],[4,"ngIf"],[1,"text-center"],[1,"h5","mt-2","font-medium"],[1,"azt-copy","relative","mt-2"],["type","text","readonly","",1,"form-control","py-3","px-4","border-transparent","bg-slate-100","pr-10",2,"padding-right","120px",3,"value"],["azt-track-service","download-qr-code-yW-aFu0tO",1,"btn","btn-outline-primary","absolute","my-auto","inset-y-0","right-0",2,"border-top-left-radius","0","border-bottom-left-radius","0",3,"click","cdkCopyToClipboard"],["name","copy","size","16",3,"ngClass"]],template:function(w,q){1&w&&(d.j41(0,"div",0),d.bIt("click",function(pe){return pe.stopPropagation()}),d.j41(1,"div",1)(2,"qrcode",2),d.bIt("qrCodeURL",function(pe){return q.onChangeURL(pe)}),d.k0s()(),d.j41(3,"a",3),d.bIt("click",function(){return q.downloadQrCode()}),d.nrm(4,"lucide-icon",4),d.EFF(5),d.nI1(6,"mytranslate"),d.k0s(),d.DNE(7,P,14,13,"ng-container",5),d.k0s()),2&w&&(d.R7$(2),d.Y8G("allowEmptyString",!0)("qrdata",q.linkUrl)("elementType","url")("width",128)("errorCorrectionLevel","M"),d.R7$(2),d.Y8G("ngClass",d.lJ4(10,V)),d.R7$(),d.SpI(" ",d.bMT(6,8,"lang_auto_tai_ve_may")," "),d.R7$(2),d.Y8G("ngIf",q.showLink))},dependencies:[c.YU,c.bT,Y.dF,C.WGl,y.c,ae.wp],encapsulation:2}),H})();const U=Ae=>({"w-80":Ae});let D=(()=>{var Ae;class H extends l.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1}}return(Ae=H).\u0275fac=(()=>{let N;return function(q){return(N||(N=d.xGo(Ae)))(q||Ae)}})(),Ae.\u0275cmp=d.VBU({type:Ae,selectors:[["azt-download-qr-code"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:7,vars:10,consts:[["showQrCode","matMenu"],["azt-track-service","download-qr-code-hiQXy_iTc",1,"btn","btn-outline-primary","btn-transparent","p-1",3,"matMenuTriggerFor","matTooltip"],["name","qr-code","size","24"],["xPosition","before"],[3,"ngClass"],[3,"linkUrl","fileName","showLink"]],template:function(w,q){if(1&w&&(d.j41(0,"button",1),d.nI1(1,"mytranslate"),d.nrm(2,"lucide-icon",2),d.k0s(),d.j41(3,"mat-menu",3,0)(5,"div",4),d.nrm(6,"azt-show-link",5),d.k0s()()),2&w){const me=d.sdS(4);d.FS9("matTooltip",d.bMT(1,6,"lang_auto_quet_hoac_tai_ma_qr_code")),d.Y8G("matMenuTriggerFor",me),d.R7$(5),d.Y8G("ngClass",d.eq3(8,U,q.showLink)),d.R7$(),d.Y8G("linkUrl",q.linkUrl)("fileName",q.fileName)("showLink",q.showLink)}},dependencies:[c.YU,m.kk,m.Cp,x.oV,C.WGl,R,ae.wp],encapsulation:2}),H})()},72802:(gt,ke,v)=>{v.d(ke,{f:()=>Et});var l=v(27691),d=v(48891),c=v(10936),m=v(67421),x=v(59640),C=v(30657),Y=v(83229),y=v(51913),ae=v(40949),V=v(55465),P=v(35095),R=v(41426),U=v(54460),D=v(47712),Ae=v(15343),H=v(7919),N=v(81587),w=v(84278),q=v(34815),me=v(76975);const pe=["mnoteContainer"],ce=Qe=>({display:Qe}),ie=Qe=>({border:Qe}),Oe=()=>({"mr-1":!0}),Ce=Qe=>({"is-invalid":Qe});function Ke(Qe,ft){1&Qe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Qe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Te(Qe,ft){1&Qe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Qe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function at(Qe,ft){1&Qe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Qe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function de(Qe,ft){if(1&Qe&&(d.j41(0,"div",18),d.DNE(1,Ke,3,3,"span",19)(2,Te,3,3,"span",19)(3,at,3,3,"span",19),d.k0s()),2&Qe){const He=d.XpG().index,ze=d.XpG();d.R7$(),d.Y8G("ngIf",null==ze.form.controls["cau"+He].errors?null:ze.form.controls["cau"+He].errors.min),d.R7$(),d.Y8G("ngIf",null==ze.form.controls["cau"+He].errors?null:ze.form.controls["cau"+He].errors.max),d.R7$(),d.Y8G("ngIf",null==ze.form.controls["cau"+He].errors?null:ze.form.controls["cau"+He].errors.pattern)}}function Be(Qe,ft){if(1&Qe){const He=d.RV6();d.j41(0,"div",11)(1,"div",12)(2,"lucide-icon",13),d.nI1(3,"mytranslate"),d.bIt("click",function(J){const ue=d.eBV(He).index,fe=d.XpG();return d.Njj(fe.toggleVisibility(J,ue))}),d.k0s(),d.j41(4,"span",14),d.EFF(5),d.nI1(6,"mytranslate"),d.j41(7,"span",15),d.nI1(8,"mytranslate"),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.nrm(11,"input",16),d.nI1(12,"mytranslate"),d.k0s(),d.DNE(13,de,4,3,"div",17),d.k0s()}if(2&Qe){let He;const ze=ft.$implicit,J=ft.index,ue=d.XpG();d.Y8G("ngStyle",d.eq3(25,ie,J==ue.questions.length-1?"none":"")),d.R7$(2),d.FS9("matTooltip",d.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),d.Y8G("ngClass",d.lJ4(27,Oe)),d.R7$(3),d.Lme(" ",d.bMT(6,17,"lang_auto_cau")," ",(null!==(He=ze.indexLabel)&&void 0!==He?He:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",ze.essMaxPoint," ",d.bMT(10,21,"lang_auto_diem_brackets"),""),d.R7$(2),d.FS9("placeholder",d.bMT(12,23,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",J,""),d.Y8G("readonly",!ue.showForTeacher)("decimal",!0)("ngClass",d.eq3(28,Ce,ue.form.controls["cau"+J]&&ue.form.controls["cau"+J].invalid)),d.R7$(2),d.Y8G("ngIf",ue.form.controls["cau"+J].errors)}}function oe(Qe,ft){if(1&Qe){const He=d.RV6();d.j41(0,"div",20)(1,"button",21),d.bIt("click",function(){d.eBV(He);const J=d.XpG();return d.Njj(J.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Qe){const He=d.XpG();d.R7$(),d.Y8G("disabled",He.isLoading||He.form.invalid),d.R7$(),d.SpI(" ",He.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}function Le(Qe,ft){if(1&Qe&&d.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Qe){let He;const ze=d.XpG().$implicit,J=d.XpG();d.Y8G("follower",J.followerRenderQuest)("examObj",J.examObj)("examConfig",J.examConfig)("questionObj",ze)("curQuestionIndex",null!==(He=ze.indexLabel)&&void 0!==He?He:0)("userAnswersObj",J.userAnswersObj)("currentTab","essay_tab")}}function L(Qe,ft){if(1&Qe&&d.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Qe){let He;const ze=d.XpG().$implicit,J=d.XpG();d.Y8G("follower",J.followerRenderQuest)("examObj",J.examObj)("questionObj",ze)("curQuestionIndex",null!==(He=ze.indexLabel)&&void 0!==He?He:0)("userAnswersObj",J.userAnswersObj)("orgExamObjs",J.orgExamObjs)("currentTab","essay_tab")}}function te(Qe,ft){1&Qe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Qe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Ge(Qe,ft){1&Qe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Qe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function be(Qe,ft){1&Qe&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Qe&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Q(Qe,ft){if(1&Qe&&(d.j41(0,"div",18),d.DNE(1,te,3,3,"span",19)(2,Ge,3,3,"span",19)(3,be,3,3,"span",19),d.k0s()),2&Qe){const He=d.XpG(2).index,ze=d.XpG();d.R7$(),d.Y8G("ngIf",null==ze.form.controls["cau"+He].errors?null:ze.form.controls["cau"+He].errors.min),d.R7$(),d.Y8G("ngIf",null==ze.form.controls["cau"+He].errors?null:ze.form.controls["cau"+He].errors.max),d.R7$(),d.Y8G("ngIf",null==ze.form.controls["cau"+He].errors?null:ze.form.controls["cau"+He].errors.pattern)}}function ye(Qe,ft){if(1&Qe&&(d.j41(0,"div",29)(1,"form",30)(2,"label",31),d.EFF(3),d.nI1(4,"mytranslate"),d.j41(5,"span",15),d.nI1(6,"mytranslate"),d.EFF(7),d.nI1(8,"mytranslate"),d.k0s(),d.EFF(9," : "),d.k0s(),d.nrm(10,"input",32),d.nI1(11,"mytranslate"),d.DNE(12,Q,4,3,"div",17),d.k0s()()),2&Qe){let He;const ze=d.XpG(),J=ze.$implicit,ue=ze.index,fe=d.XpG();d.R7$(),d.Y8G("formGroup",fe.form),d.R7$(),d.FS9("for","cau_"+ue),d.R7$(),d.Lme(" ",d.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(He=J.indexLabel)&&void 0!==He?He:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",J.essMaxPoint," ",d.bMT(8,19,"lang_auto_diem_brackets"),""),d.R7$(3),d.FS9("placeholder",d.bMT(11,21,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",ue,""),d.Y8G("readonly",!fe.showForTeacher)("ngClass",d.eq3(23,Ce,fe.form.controls["cau"+ue]&&fe.form.controls["cau"+ue].invalid))("id","cau_"+ue)("decimal",!0),d.R7$(2),d.Y8G("ngIf",fe.form.controls["cau"+ue].errors)}}function ct(Qe,ft){if(1&Qe&&(d.j41(0,"div",22)(1,"div",23),d.DNE(2,Le,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,L,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,ye,13,25,"div",26),d.k0s()()),2&Qe){const He=ft.index,ze=d.XpG();d.R7$(),d.Mz_("id","q_",He,""),d.R7$(),d.Y8G("ngIf",!ze.showForTeacher),d.R7$(),d.Y8G("ngIf",ze.showForTeacher),d.R7$(),d.Y8G("ngIf",ze.showForTeacher)}}function Dt(Qe,ft){1&Qe&&(d.j41(0,"div",33)(1,"b"),d.EFF(2),d.nI1(3,"mytranslate"),d.k0s(),d.EFF(4),d.nI1(5,"mytranslate"),d.k0s()),2&Qe&&(d.R7$(2),d.SpI("",d.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),d.R7$(2),d.SpI(" ",d.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function nt(Qe,ft){if(1&Qe){const He=d.RV6();d.j41(0,"div",34)(1,"button",35),d.bIt("click",function(){d.eBV(He);const J=d.XpG();return d.Njj(J.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Qe){const He=d.XpG();d.R7$(),d.Y8G("disabled",He.isLoading||He.form.invalid),d.R7$(),d.SpI(" ",He.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}let Et=(()=>{var Qe;class ft extends x.H{parseValue(ze){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[ze]}getMaxPoint(ze){var J=0;for(let ue=0;ue<this.questions.length;ue++)if(this.questions[ue].id==ze){J=this.questions[ue].scorePerQuestion??0;break}return J}toggleVisibility(ze,J){var ue=ze.target,fe=document.getElementById(`q_${J}`);fe&&("block"==fe?.style.display?(fe.style.display="none",ue&&(ue.textContent="visibility_off")):(fe.style.display="block",ue&&(ue.textContent="visibility")))}isValidPoint(){let ze=0;var J=this.form.value;for(var ue in J){var fe=Number(ue.substring(3));J[ue]>this.maxPointPerQuestion[fe]&&ze++}return!(ze>0)}validateForm(ze,J,ue,fe){let G="";this.form.get("cau"+fe)?.valueChanges.pipe((0,m.J)()).subscribe(([S,F])=>{if(G="string"==typeof F&&F.includes(",")?F.replace(",","."):F,isNaN(+G))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+fe].setValue(J);else{let B=parseFloat(G);B>ue&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),B<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(ze,J){var ue=(0,Y.q)(ze);this.apiUploadService.commonUploadForMarkResult(ue,`essay_note_${J}_${this.resultID}.png`,"image/png").subscribe(fe=>{fe.type!=l.hv.UploadProgress&&(1==fe.success?(this.mnoteJsonData.pages[J].draw=fe.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(ze){this.pagesCount=0;for(let J=0;J<ze.length;J++)ze[J].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let J=0;J<ze.length;J++)ze[J].draw&&this.uploadBase64ToCDN(ze[J].draw,J)}sendDataToIframe(){const ze=document.getElementById("mNote"),J=ze?ze.contentWindow:null;if(null!==J)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var ue=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=ue){for(let G=0;G<ue.pages.length;G++)ue.pages[G].backgroundImage&&(ue.pages[G].backgroundImage=this.cdnService.getMyCdn(ue.pages[G].backgroundImage)),ue.pages[G].draw&&(ue.pages[G].draw=this.cdnService.getMyCdn(ue.pages[G].draw));ue=JSON.stringify(ue),this.examResultObj.result=ue}}var fe=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(fe?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let G=0;G<this.jsonData.pages.length;G++)this.jsonData.pages[G].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[G].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[G].backgroundImage)),this.jsonData.pages[G].hasOwnProperty("draw")&&(this.jsonData.pages[G].draw=this.cdnService.getMyCdn(this.jsonData.pages[G].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),J.postMessage(this.jsonData,"*")}else{let G=[];this.files.forEach(F=>{var B=this.cdnService.getMyCdn(F.url);B&&G.push({backgroundImage:B})}),J.postMessage({cmd:"initMNote",pages:G,mode:this.showForTeacher?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:G}}}checkMapBGImageWithFileLength(ze){var J=this.commonService.willDeleteParseJson(ze);let ue=!1;if(0==this.files.length)ue=!0;else if(this.files.length>0&&J&&J.pages&&this.files.length==J.pages.length){let fe=0;this.files.forEach((G,S)=>{J.pages[S]&&J.pages[S].backgroundImage&&J.pages[S].backgroundImage.indexOf(G.path)>-1&&fe++}),fe==this.files.length&&(ue=!0)}return ue}addBGImageByFileUrl(ze){var J=this.commonService.willDeleteParseJson(ze);return this.files.forEach((ue,fe)=>{let G=!1;if(J&&J.pages){for(var S=0;S<J.pages.length;S++)if(J.pages[S]&&J.pages[S].backgroundImage&&J.pages[S].backgroundImage.indexOf(ue.path)>-1){G=!0;break}!1===G&&(J.pages[fe]&&J.pages[fe].id==fe?J.pages[fe].backgroundImage=this.cdnService.getMyCdn(ue.url??""):J.pages.splice(fe,0,{backgroundImage:this.cdnService.getMyCdn(ue.url??"")}))}}),JSON.stringify(J)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let ze=!1;for(const J in this.form.value)""!==this.form.value[J]&&(ze=!0);if(!ze)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const J in this.form.value)""===this.form.value[J]&&(this.form.value[J]=0,this.form.controls[J].setValue(0));if(this.files&&this.files.length>0){const J=document.getElementById("mNote"),ue=J?J.contentWindow:null;null!==ue&&ue.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(ze){if(this.checkMapBGImageWithFileLength(ze)){for(const G in this.form.value)"string"==typeof this.form.value[G]&&this.form.value[G].includes(",")&&(this.form.value[G]=this.form.value[G].replace(",","."));let fe=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var ue={id:this.resultID,result:ze,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(ue,fe).subscribe(G=>{1==G.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(G.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";var ze={};let J;this.examResultObj.confirmedAt&&(J=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(fe=>{let G=this.getMaxPoint(fe.id);this.totalMaxPoint+=G,fe.essMaxPoint=G,this.maxPointPerQuestion.push(fe.essMaxPoint)});for(let fe=0;fe<this.questions.length;fe++){var ue=`cau${fe}`;ze[ue]=new c.MJ(J?J[ue]:"",{validators:[c.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),c.k0.min(0),c.k0.max(this.questions[fe].essMaxPoint??0)]})}this.form=new c.gE(ze),this.form.valueChanges.subscribe(fe=>{let G=JSON.stringify(fe);G!=this.prevData&&(this.prevData=G,this.form.patchValue(fe))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(ze,J,ue,fe,G){super(),this.permissionService=ze,this.cdnService=J,this.envService=ue,this.examResultService=fe,this.apiUploadService=G,this.orgExamObjs=[],this.questions=[],this.files=[],this.userAnswersObj={},this.resultID=0,this.whiteListMNoteIframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new d.bkB,this.followerRenderQuest=new C.e,this.form=new c.gE({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=S=>{"MNoteJson"==S.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=S.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==S.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(Qe=ft).\u0275fac=function(ze){return new(ze||Qe)(d.rXU(y.p),d.rXU(ae.B),d.rXU(V.t),d.rXU(P._),d.rXU(R.T))},Qe.\u0275cmp=d.VBU({type:Qe,selectors:[["azt-mark-essay"]],viewQuery:function(ze,J){if(1&ze&&d.GBs(pe,5),2&ze){let ue;d.mGM(ue=d.lsd())&&(J.mnoteContainer=ue.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",examResultObj:"examResultObj",userAnswersObj:"userAnswersObj",resultID:"resultID",whiteListMNoteIframeSrc:"whiteListMNoteIframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode"},outputs:{saveResultEvent:"saveResultEvent"},features:[d.Vt3],decls:12,vars:12,consts:[["mnoteContainer",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(ze,J){1&ze&&(d.j41(0,"div",1)(1,"form",2),d.DNE(2,Be,14,30,"div",3),d.k0s(),d.DNE(3,oe,5,6,"div",4),d.k0s(),d.j41(4,"div",5),d.DNE(5,ct,5,5,"div",6),d.k0s(),d.DNE(6,Dt,6,6,"div",7),d.j41(7,"div",8,0),d.nrm(9,"iframe",9),d.nI1(10,"safe"),d.k0s(),d.DNE(11,nt,5,6,"div",10)),2&ze&&(d.R7$(),d.Y8G("formGroup",J.form),d.R7$(),d.Y8G("ngForOf",J.questions),d.R7$(),d.Y8G("ngIf",J.showForTeacher),d.R7$(2),d.Y8G("ngForOf",J.questions),d.R7$(),d.Y8G("ngIf",J.files&&0==J.files.length),d.R7$(),d.Y8G("ngStyle",d.eq3(10,ce,J.files&&0==J.files.length?"none":"block")),d.R7$(2),d.Y8G("src",d.bMT(10,8,J.whiteListMNoteIframeSrc),d.f$h),d.R7$(2),d.Y8G("ngIf",J.showForTeacher))},dependencies:[U.YU,U.Sq,U.bT,U.B3,D.oV,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,Ae.WGl,H.Z,N.t,w.x,q.o,me.wp,me.JI],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ft})()},74225:function(gt,ke,v){var l=this&&this.__awaiter||function(x,C,Y,y){return new(Y||(Y=Promise))(function(V,P){function R(Ae){try{D(y.next(Ae))}catch(H){P(H)}}function U(Ae){try{D(y.throw(Ae))}catch(H){P(H)}}function D(Ae){Ae.done?V(Ae.value):function ae(V){return V instanceof Y?V:new Y(function(P){P(V)})}(Ae.value).then(R,U)}D((y=y.apply(x,C||[])).next())})};Object.defineProperty(ke,"__esModule",{value:!0}),ke.decodeScanOfflineFile=ke.decode=void 0;const d=v(6178);ke.decode=function c(x){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decode(x)})},ke.decodeScanOfflineFile=function m(x){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decodeScanOfflineFile(x)})}},25028:(gt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.AzotaFile=ke.FileType=void 0;const l=v(56784),d=v(70073);class c{}ke.FileType=c,c.scanOffline="scanOffline";class m{constructor(){}static fromZipFolder(C){let Y=new m;return Y.folder=C,Y.readAztMain(),Y}readAztMain(){let C=this.folder.getUtf8Text("main.json");if(null==C)throw new l.InvalidAztFileException("Couldn't found main.json file");this.aztMain=d.AztMain.fromJsonString(C)}}ke.AzotaFile=m},6178:function(gt,ke,v){var l=this&&this.__awaiter||function(C,Y,y,ae){return new(y||(y=Promise))(function(P,R){function U(H){try{Ae(ae.next(H))}catch(N){R(N)}}function D(H){try{Ae(ae.throw(H))}catch(N){R(N)}}function Ae(H){H.done?P(H.value):function V(P){return P instanceof y?P:new y(function(R){R(P)})}(H.value).then(U,D)}Ae((ae=ae.apply(C,Y||[])).next())})};Object.defineProperty(ke,"__esModule",{value:!0}),ke.AzotaFileDecode=void 0;const d=v(59985),c=v(25589),m=v(25028);class x{static decode(Y){return l(this,void 0,void 0,function*(){return d.ZipFolder.fromZip(Y).then(y=>{let ae=m.AzotaFile.fromZipFolder(y);return ae.aztMain.fileType==m.FileType.scanOffline?c.ScanOfflineFile.fromZipFolder(ae.folder):ae})})}static decodeScanOfflineFile(Y){return x.decode(Y).then(y=>y)}}ke.AzotaFileDecode=x},70073:(gt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.AztMain=void 0;const l=v(37182);class d{static fromJsonString(m){return d.fromJson(JSON.parse(m))}static fromJson(m){return(0,l.plainToInstance)(d,m)}}ke.AztMain=d},56784:(gt,ke)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.InvalidAztFileException=void 0;class v extends Error{constructor(d){super(d)}}ke.InvalidAztFileException=v},81163:(gt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.Point2d=ke.DrawingRectangle=ke.DrawingCircle=ke.AnswerRegionResult=ke.StudentCodeRegionResult=ke.ExamCodeRegionResult=ke.ScanOfflineResult=ke.ScanOfflineData=void 0;const l=v(37182);class d{static fromJsonString(P){return d.fromJson(JSON.parse(P))}static fromJson(P){return(0,l.plainToInstance)(d,P)}}ke.ScanOfflineData=d,ke.ScanOfflineResult=class c{},ke.ExamCodeRegionResult=class m{},ke.StudentCodeRegionResult=class x{},ke.AnswerRegionResult=class C{},ke.DrawingCircle=class Y{},ke.DrawingRectangle=class y{},ke.Point2d=class ae{}},25589:(gt,ke,v)=>{Object.defineProperty(ke,"__esModule",{value:!0}),ke.ScanOfflineFile=void 0;const l=v(25028),d=v(56784),c=v(81163);class m extends l.AzotaFile{constructor(){super()}static fromZipFolder(C){let Y=new m;if(Y.folder=C,Y.readAztMain(),Y.aztMain.fileType!=l.FileType.scanOffline)throw new d.InvalidAztFileException(`fileType must be ${l.FileType.scanOffline}`);let ae=C.getUtf8Text(Y.aztMain.detailPath);if(null==ae)throw new d.InvalidAztFileException(`Couldn't found ${ae} file`);return Y.scanOfflineData=c.ScanOfflineData.fromJsonString(ae),Y}getWrappedImage(){var C,Y;return null==(null===(Y=null===(C=this.scanOfflineData)||void 0===C?void 0:C.scanResult)||void 0===Y?void 0:Y.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getWrappedImageExtension(){var C,Y;let y=null===(Y=null===(C=this.scanOfflineData)||void 0===C?void 0:C.scanResult)||void 0===Y?void 0:Y.wrappedScanFilePath;return null==y?null:y.substring(y.lastIndexOf("."))}}ke.ScanOfflineFile=m},59985:function(gt,ke,v){var l=this&&this.__awaiter||function(m,x,C,Y){return new(C||(C=Promise))(function(ae,V){function P(D){try{U(Y.next(D))}catch(Ae){V(Ae)}}function R(D){try{U(Y.throw(D))}catch(Ae){V(Ae)}}function U(D){D.done?ae(D.value):function y(ae){return ae instanceof C?ae:new C(function(V){V(ae)})}(D.value).then(P,R)}U((Y=Y.apply(m,x||[])).next())})};Object.defineProperty(ke,"__esModule",{value:!0}),ke.ZipFolder=void 0;const d=v(91478);class c{constructor(x){this.files=new Map,x.forEach((C,Y)=>{this.files.set(Y,C)})}static fromZip(x){return l(this,void 0,void 0,function*(){let Y=yield(new d).loadAsync(x).then(y=>{const ae=[];return y.forEach(function(V){let P=y.file(V);P&&ae.push(P.async("uint8array").then(R=>({path:V,data:R})))}),ae});return Promise.all(Y).then(y=>{let ae=new Map;return y.forEach(V=>{ae.set(V.path,V.data)}),new c(ae)})})}setBinary(x,C){this.files.set(x,C)}setUtf8Text(x,C){let Y=(new TextEncoder).encode(C);this.files.set(x,Y)}getBinary(x){var C;return null!==(C=this.files.get(x))&&void 0!==C?C:null}getUtf8Text(x){let C=this.files.get(x);return null===C?null:(new TextDecoder).decode(C)}toDocx(){return l(this,void 0,void 0,function*(){const x=new d;for(let[C,Y]of Array.from(this.files))x.file(C,Y,{binary:!0});return x.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return l(this,void 0,void 0,function*(){const x=new d;for(let[C,Y]of Array.from(this.files))x.file(C,Y,{binary:!0});return x.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}ke.ZipFolder=c}}]);