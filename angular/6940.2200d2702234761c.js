"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6940],{91581:(O,T,_)=>{_.d(T,{s:()=>k});var P=_(65879);let k=(()=>{class r{constructor(a){this.el=a,this.answerSizeManager=0,this.process()}ngOnChanges(a){a.answerSizeManager&&a.answerSizeManager.currentValue!==a.answerSizeManager.previousValue&&a.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(a=>{const p=this.el.nativeElement,f=p.children,C=[];for(let m=0;m<f.length;m++)C.push(this.getSizeWidthElement(f[m]));let d=1;[2,4].forEach(m=>{this.isLayout(a.width,C,m)&&(d=m)}),p.classList.remove("row");for(let m=0;m<f.length;m++){const e=f[m];e.classList.remove("col-sm-12"),e.classList.remove("col-md-6")}p.classList.add("layout"),p.classList.add("layout-"+d)})}isLayout(a,p,f){const C=Math.floor(a/f);for(const d of p)if(d+r.PADDING_ITEM>C)return!1;return!0}onElementLoaded(){return new Promise((a,p)=>{let f=!1;for(let C=0;C<=10;C++)setTimeout(()=>{if(!f){const d=this.actionGetSizeBox();d.width>0&&d.height&&(f=!0,a(d))}10===C&&!f&&p(new Error)},100*C)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(a){let p=0;for(let f=0;f<a.children.length;f++)p+=a.children[f].getBoundingClientRect().width;return p}}return r.PADDING_ITEM=40,r.\u0275fac=function(a){return new(a||r)(P.Y36(P.SBq))},r.\u0275dir=P.lG2({type:r,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[P.TTD]}),r})()},89745:(O,T,_)=>{_.d(T,{v:()=>P});class P{constructor(){this.answerLabelsMockup={}}}},70731:(O,T,_)=>{_.d(T,{Q:()=>P});class P{constructor(r,l,a,p){this.tasks=new Array,this.queues=new Array,this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=r,this.result_common_temp={datas:[],errs:[]},this.action_log_item=l,this.delay_time=a||1e3,this.end_with_error=p??!1}addTask(r,l,a,p){if(this.is_running)return;var f=a||[];const C=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(m=>{this.wrap_counter++,l.call(r,...f).then(e=>{this.wrap_counter_done++,this.callLog(p),m({status:!0,value:e,index:C})}).catch(e=>{this.wrap_counter_done++,this.callLog(p),m({status:!1,error:e,index:C})})}),name:p})}callLog(r){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],r)}start(){return new Promise(r=>{0===this.queues.length&&r({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let l=0;l<this.limit_one_process;l++){const a=this.queues.shift();if(!a)break;this.tasks.push(a)}this.count_task_root_done=0,this.is_running=!0,this.runner(r)})}checker(r,l){this.count_task_root_done++,r.status&&r.value?this.result_common_temp.datas.push({index:r.index,value:r.value}):r.error&&this.result_common_temp.errs.push({index:r.index,value:r.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,l(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,l(this.makeResultObj())),this.nextItem(l)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(r,l){return r.index-l.index}).map(r=>r.value),errs:this.result_common_temp.errs.sort(function(r,l){return r.index-l.index}).map(r=>r.value)}}nextItem(r){const l=this.queues.shift();l&&l.task.call(this).then(a=>{this.checker(a,r)})}runner(r){this.tasks.length>0?this.tasks.forEach(l=>{l.task.call(this).then(a=>{this.checker(a,r)})}):(this.is_running=!1,r(this.makeResultObj()))}}},32169:(O,T,_)=>{_.d(T,{n:()=>C});var P=_(49671),k=_(69862),r=_(70731),l=_(65879),a=_(46558),p=_(82228);const f=_(47246);let C=(()=>{class d{constructor(e,t){this.commonService=e,this.apiUploadService=t,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}convertBase64OfMathJaxToCdnUrl(e){return new Promise(t=>{var s=this.getValueContentQuestion(e.questionContent??""),n=this.getValueContentQuestion(e.answerConfig??""),i=e.answerMedia??"",c=this.removeBase64MathJaxInQuestionContent(e.questionText??"");if(0===s.length||0===n.length)return void t(e);let w=this.encodeContent(s[0].content),g=[];n.forEach((o,u)=>{g.push({i:u,d:this.encodeContent(o.content)})});let E=this.encodeContent(i);var v=0;let h=[];for(let o=0;o<w.raws.length;o++)w.raws[o].i=v,v++,h.push(w.raws[o]);for(let o=0;o<E.raws.length;o++)E.raws[o].i=v,v++,h.push(E.raws[o]);g.forEach(o=>{for(let u=0;u<o.d.raws.length;u++)o.d.raws[u].i=v,v++,h.push(o.d.raws[u])}),h.length>0?this.uploadRawContent(h.map(o=>o.l)).then(o=>{w.raws.forEach(u=>{let M=this.stringFirst+btoa(JSON.stringify({l:o,i:u.i}));s[0].content=this.commonService.replaceAll(s[0].content,u.l,M)??""}),E.raws.forEach(u=>{let M=this.stringFirst+btoa(JSON.stringify({l:o,i:u.i}));i=this.commonService.replaceAll(i,u.l,M)??""}),g.forEach(u=>{u.d.raws.forEach(M=>{let R=this.stringFirst+btoa(JSON.stringify({l:o,i:M.i}));n[u.i].content=this.commonService.replaceAll(n[u.i].content,M.l,R)??""})}),e.questionContent=JSON.stringify(s),e.answerConfig=JSON.stringify(n),e.answerMedia=i,e.questionText=c,t(e)}).catch(()=>{t(e)}):t(e)})}decodeMathJaxCodeToCdnUrl(e){return new Promise(t=>{const s=new r.Q(10);if(s.addTask(this,()=>new Promise(n=>{this.decodeContent(e.content??"").then(i=>{e.content=i,n(!0)}).catch(()=>{n(!1)})})),s.addTask(this,()=>new Promise(n=>{this.decodeContent(e.help??"").then(i=>{e.help=i,n(!0)}).catch(()=>{n(!1)})})),e.answers)for(let n=0;n<e.answers.length;n++)s.addTask(this,()=>new Promise(i=>{e.answers&&this.decodeContent(e.answers[n].content??"").then(c=>{e.answers&&(e.answers[n].content=c),i(!0)}).catch(()=>{i(!1)})}));s.start().then(()=>{t()})})}getValueContentQuestion(e){return this.commonService.castJsonToObj(e)??[]}getAllMatchWithContent(e){let s,t=[];for(;null!==(s=d.searchPattern.exec(e));)t.includes(s[0])||t.push(s[0]);return t}getRawContent(e,t){return new Promise((s,n)=>{const i=this.dataRaws.findIndex(c=>c.l===e);-1===i?fetch(e).then(c=>c.blob()).then(c=>c.arrayBuffer()).then(c=>{const w=f.inflate(c),g=this.commonService.castJsonToObj((new TextDecoder).decode(w));this.dataRaws.push({l:e,d:g??[]}),g&&g[t]?s(g[t]):n(new Error("Not found index"))}).catch(()=>{n(new Error("Exception at feed link"))}):this.dataRaws[i].d&&this.dataRaws[i].d[t]?s(this.dataRaws[i].d[t]):n(new Error("Not found index"))})}uploadRawContent(e){return new Promise((t,s)=>{const n=JSON.stringify(e),i=(new TextEncoder).encode(n),c=f.deflate(i),w=new Blob([c],{type:"application/octet-stream"}),g=new File([w],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(g).subscribe(E=>{E.type!=k.dt.UploadProgress&&(1==E.success&&E.data?t(E.data.url??""):s(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+E.message)))})})}removeBase64MathJaxInQuestionContent(e){return this.encodeContent(e).raws.forEach(s=>{e=this.commonService.replaceAll(e,s.l,"")??""}),e}encodeContent(e){let t=this.getAllMatchWithContent(e),s=[];for(let n=0;n<t.length;n++){let c=t[n].replace(d.searchPattern,"$1");c.startsWith(this.stringFirst)||s.push({l:c,i:s.length})}return{content:e,raws:s}}decodeContent(e){var t=this;return(0,P.Z)(function*(){let s=t.getAllMatchWithContent(e);for(let n=0;n<s.length;n++){const i=s[n];let c=i.replace(d.searchPattern,"$1");for(let w=0;w<t.stringFirstOld.length;w++)if(c.startsWith(t.stringFirstOld[w])){e=t.commonService.replaceAll(e,i,"")??"";continue}if(c.startsWith(t.stringFirst)){let w=t.commonService.castJsonToObj(atob(c.replace(t.stringFirst,"")));if(w){let g=yield t.getRawContent(w.l,w.i);e=t.commonService.replaceAll(e,c,g)??""}}}return e})()}}return d.searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,d.\u0275fac=function(e){return new(e||d)(l.LFG(a.z),l.LFG(p.W))},d.\u0275prov=l.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},19662:(O,T,_)=>{_.d(T,{h:()=>d});var P=_(8720),k=_(70731),r=_(70860),l=_(65879),a=_(32965),p=_(27161),f=_(46558),C=_(32169);let d=(()=>{class m{pushImage(t,s,n){if(n){let i=new RegExp("<div id='"+t+"'[^>]+></div>","g");n.content&&(n.content=n.content.replace(i,s??"")),n.answers&&n.answers.forEach(c=>{c.content=c.content?.replace(i,s??"")}),n.help&&(n.help=n.help.replace(i,s??"")),n.groupInfo&&n.groupInfo.groupContent&&(n.groupInfo.groupContent=n.groupInfo.groupContent.replace(i,s??""))}}parseRenderQuestions(t,s,n,i,c,w){return new Promise((g,E)=>{const h=new k.Q(25,{function:(o,u)=>{const M=(o+25)/u*100;s&&s(M>=100?99:M)}},i??1e3);t.forEach(o=>{h.addTask(this,this.parseRenderQuestion,[o,n,c,w])}),h.start().then(o=>{if(o.errs.length>0){const u=[];o.errs.forEach(M=>{let R=u.find(S=>S.type===M.type);R||u.push(M),R?.data.concat(M.data)}),E(u)}else g(t)})})}parseRenderQuestion(t,s,n,i){return new Promise((c,w)=>{var g=new r.W(this.cdnService,this.commonService,s||new P.v,h=>{w(h)});g.callbackPushImage=(h,o)=>{this.pushImage(h,o,t)},g.caller=this;const v=new k.Q(i?1:20,void 0,0);t.content&&v.addTask(this,()=>new Promise(h=>{t.content=g.render(this.commonService.removeBracket(t.content??""),()=>{h()})})),t.answers&&t.answers.forEach(h=>{v.addTask(this,()=>new Promise(o=>{h.content=g.render(h.content||"",()=>{o()})}))}),t.help&&v.addTask(this,()=>new Promise(h=>{t.help=g.render(t.help,()=>{h()})})),t.groupInfo&&t.groupInfo.groupContent&&v.addTask(this,()=>new Promise(h=>{t.groupInfo&&t.groupInfo.groupContent?t.groupInfo.groupContent=g.render(this.commonService.removeBracket(t.groupInfo.groupContent),()=>{h()}):h()})),n&&v.addTask(this,()=>new Promise(h=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(t).then(()=>{h()})})),v.start().then(h=>{h.errs.length>0||c()})})}constructor(t,s,n,i){this.cdnService=t,this.sAztAnswerTypeService=s,this.commonService=n,this.dataAztMathRawHelper=i}}return m.\u0275fac=function(t){return new(t||m)(l.LFG(a.E),l.LFG(p.i),l.LFG(f.z),l.LFG(C.n))},m.\u0275prov=l.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()}}]);