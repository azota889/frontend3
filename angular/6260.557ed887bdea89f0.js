"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6260],{76094:(U,y,i)=>{i.d(y,{x:()=>T});var T=function(r){return r[r.templateOriginalA4=20]="templateOriginalA4",r[r.templateA5Full50=22]="templateA5Full50",r[r.templateA4Essay=21]="templateA4Essay",r[r.templateA6Full20=23]="templateA6Full20",r[r.templateTrueFalseA4=15]="templateTrueFalseA4",r[r.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",r[r.templateTrueFalseA5=17]="templateTrueFalseA5",r[r.templateTrueFalseA6=18]="templateTrueFalseA6",r[r.templateA4WithFax=19]="templateA4WithFax",r[r.templateA4WithFaxV2=190]="templateA4WithFaxV2",r[r.templateTrueFalseA4WithColor=150]="templateTrueFalseA4WithColor",r[r.templateA4WithColorNew=200]="templateA4WithColorNew",r}(T||{})},17997:(U,y,i)=>{i.d(y,{H:()=>C});var T=i(76094),r=i(65879),w=i(46558),G=i(97151),B=i(61419),S=i(41385),W=i(38228);let C=(()=>{class m{constructor(s,a,d,o,F){this.commonService=s,this.shareFileFlutterService=a,this.encryptService=d,this.formatAnswerSheetService=o,this.exportExcelService=F,this.allAnswerSheet=T.x}exportFileNameOfStudentCode(s,a,d){return 100==s&&(a=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(a?"_"+a:"")+"_"+this.encryptService.createMd5(d).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(s,a,d,o,F,b){return a==this.allAnswerSheet.templateA5Full50?s.createA5AnswerSheetFullA4_50(b??50):a==this.allAnswerSheet.templateA4Essay?s.createA4AnswerSheet_35hh(b??50):a==this.allAnswerSheet.templateA6Full20?s.createA6AnswerSheetFullA4_20(b??20):a==this.allAnswerSheet.templateTrueFalseA4||a==this.allAnswerSheet.templateTrueFalseA4WithColor||a==this.allAnswerSheet.templateTrueFalseEssayA4||a==this.allAnswerSheet.templateTrueFalseA5||a==this.allAnswerSheet.templateTrueFalseA6||a==this.allAnswerSheet.templateA4WithFax||a==this.allAnswerSheet.templateA4WithFaxV2?s.createTrueFalseAnswerSheet():s.createAzotaAnswerSheet_A4(b??120)}exportFileNameOfAnswerSheet(s,a,d){var o="";return 100==s&&(a=""),(0==s||100==s)&&(o=this.commonService.createFileNameExportFile(["PhieuTL_"+d+(a?"_"+a:"")])),o}exportFileNameOfAnswerExcelOffline(s,a,d){var o="";return 100==s&&(a=""),(0==s||100==s)&&(o=this.commonService.createFileNameExportFile(["DapAn_"+(a?"_"+a:"")])),o}exportFileNameOfRawExam(s,a,d){var o="";return 100==s&&(a=""),(0==s||100==s)&&(o=this.commonService.createFileNameExportFile([(a?"_"+a:"")+"_"+this.encryptService.createMd5(d).substring(0,6)])),o}exportFileNameOfExamOffline(s,a,d,o){var F="";return 100==s&&(a=""),(0==s||100==s)&&(F=this.commonService.createFileNameExportFile([(o?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(o,3)+"_":"")+d+(a?"_"+a:"")])),F}printStudentCode(s,a){var d=[];let o=this.commonService.myClone(a);for(let F=0;F<o.length;F++)d.push({code:o[F].code??0,fullName:o[F]?.fullName??"",birthday:o[F]?.birthday??"",className:o[F].classroomName??""});this._exportExcelForCodeNumber(s,d)}_exportExcelForCodeNumber(s,a){let d=this.exportFileNameOfStudentCode(0,s?.name??"",s?.hashId??"");const o=this.exportExcelService.exportExcelForCodeNumber(a);this.shareFileFlutterService.shareFileWithBlob(o,d)}}return m.\u0275fac=function(s){return new(s||m)(r.LFG(w.z),r.LFG(G.g),r.LFG(B.j),r.LFG(S.j),r.LFG(W.L))},m.\u0275prov=r.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},56260:(U,y,i)=>{i.d(y,{F:()=>$});var T=i(49671),r=i(85965),G=i(8720),B=i(70731),S=i(89156),W=i(89745),C=i(79617),m=i(65879),R=i(36668),s=i(32965),a=i(46558),d=i(78953),o=i(19662),F=i(17997),b=i(41385),K=i(97151),Q=i(27161),z=i(71518);let $=(()=>{class P{constructor(n,e,_,l,c,E,t,p,v,I){this.docxService=n,this.cdnService=e,this.commonService=_,this.userService=l,this.questionRenderService=c,this.printAnswersheetService=E,this.formatAnswerSheetService=t,this.shareFileFlutterService=p,this.sAztAnswerTypeService=v,this.documentConfigService=I,this.configRenderService=new G.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new r,this.countRetryLoadJS=0}convertAnswerQuestion(n,e){let _=[],l=[];return n.answerResult&&this.isAnsDetail&&n.answerResult.forEach(c=>{let E=c;const t=n.answers?.find(p=>p.key===c);t&&(E=t.alpha??E),l.push(E)}),n.answers.forEach(c=>{let E="<b>     "+(l.includes(c.alpha??c.key)?"*":"")+(e?(c.alpha?c.alpha:c.key).toLowerCase()+")":(c.alpha?c.alpha:c.key)+".")+"</b> "+(0,C.uG)(c.content);_.push(E)}),_}getDataForExportDocxApi(n,e,_){let l=[],c=0;if(_){let t=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");l.push({content:`<b> ${t} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(_,3)+".</b>",answers:[]})}let E=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return e.forEach(t=>{1!==n.hideGroupQuestion&&t.groupInfo?.isFirstInGroup&&t.groupInfo.groupContent&&l.push({content:`<b>${t.groupInfo.groupContent}<b>`,answers:[]}),this.isEnableDebug&&l.push({content:` <br/><br/><br/>*** <b>Question ID: ${t.id}</b> ***`,answers:[]});let p={content:`<b>${E} `+((t.labelIndex??c)+(n.startQuestionIndex??1))+".</b> "+(this.checkImgAtStart(t.content??"")?"<br/>":"")+(0,C.uG)(t.content),answers:this.convertAnswerQuestion(t??[],this.sAztAnswerTypeService.isTrueFalseAnswer(t))};if(c++,l.push(p),this.isAnsDetail&&((t.help||this.sAztAnswerTypeService.isFillAnswer(t))&&l.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b><br/> ${t.help}`,answers:[]}),t.answerResult&&this.isAnsDetail)){let v=[];t.answerResult.forEach(I=>{let h=I;const x=t.answers?.find(D=>D.key===I);x&&(h=x.alpha??h),v.push(h)}),this.sAztAnswerTypeService.isFillAnswer(t)&&l.push({content:`${this.commonService.myTranslateInstant("lang_auto_dap_an")}: ${v.join(" | ")}`,answers:[]})}this.isEnableDebug&&l.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),l}itemConverterCaller(n,e,_,l,c){var E=this;return new Promise((t,p)=>{var v=0;this.questionRenderService.parseRenderQuestions(n.listQuestion,I=>{if(!this.saveLoadingMsg.includes(")")){v=I/2;var h=(this.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(v)+"%";this.changeMsg?this.changeMsg(h):S.G.changeMsgLoadingEffect(h)}},this.configRenderService,void 0,!0,c).then(I=>{let h=[];const x=[];if(e.examName&&x.push(C.Ip.createLineCenterBold(e.examName)),e.subject&&x.push(C.Ip.createLineCenterBold(e.subject)),e.examMinutes&&x.push(C.Ip.createLineCenterItalicized(e.examMinutes)),x.push(C.Ip.createLineCenterItalicized("-------------------------")),h.push({content:C.Ip.makeHeaderTable([C.Ip.createLineCenterBold(e.schoolName?e.schoolName:"")],x,!1),answers:[]}),h.push({content:C.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),h.push({content:C.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),h=h.concat(this.getDataForExportDocxApi(l,I,n.offlineExamMixQuestionObj?n.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx){var D=0;let O=n.offlineExamMixQuestionObj?.hashId?n.offlineExamMixQuestionObj.hashId.toString().padStart(3,"0"):void 0,L=O?this.commonService.myTranslateInstant("lang_auto_ma_de")+" "+O:"";this.docxService.exportToDocxBinary(h,{isHeadless:!0,footerLeft:L},function(){var M=(0,T.Z)(function*(g,u,f){new Promise(A=>{setTimeout(()=>{0==g&&(D=v),v=g/u*25+D;var N=(E.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(v)+"%";S.G.changeMsgLoadingEffect(N)}),A(!0)})});return function(g,u,f){return M.apply(this,arguments)}}()).then(M=>{t({userObj:_,data:M,input:h,additionParams:e,offlineExamMixQuestionObj:n.offlineExamMixQuestionObj})})}else p(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(I=>{p(new Error(I[0].message))})})}masterConverterCaller(n,e,_,l,c,E){return new Promise((t,p)=>{const v=this.userService.getUserObj();let I=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),h=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),x=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),D=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),O=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),L=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),M=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const g=new B.Q(1,{function:(u,f)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${f<=1?"":`(${u}/${f}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):S.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});n.forEach(u=>{g.addTask(this,this.itemConverterCaller,[u,{schoolName:l?.nameSchool??`{${I}}`,subject:l?.nameSubject??`{${h}}`,examName:e.name??`{${x}}`,examMinutes:e.minutes&&e.minutes>0?`${D}: `+e.minutes+` ${L} (${O})`:` ${D}: ${M}`,templateType:c??0,numberOfQuestion:u.listQuestion.length,examId:u.offlineExamMixQuestionObj?.hashId??0},v,e,E])}),g.start().then(u=>{if(u.errs.length>0)p(u.errs[0]);else if(1===u.datas.length){const f=u.datas[0],A=new Blob([f.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let N=this.createNameExam(e,_,f.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(A,N),t()}else u.datas.forEach(f=>{let A=this.createNameExam(e,_,f.offlineExamMixQuestionObj);A=this.replaceAllString(A,"/","_"),this.zipper.file("DOCS/"+A,f.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(f=>{let A=this.commonService.createFileNameExportFile([e.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(f,A),t()},f=>{p(f)})},200)})})}replaceAllString(n,e,_){for(;n.includes(e);)n=n.replace(e,_);return n}createNameExam(n,e,_){return e?this.printAnswersheetService.exportFileNameOfExamOffline(0,n.name??"",e?.hashId??"",_?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,n.name??"",n.hashId??"")+".docx"}downloadExam(n,e,_,l,c,E,t,p,v,I,h){return new Promise((x,D)=>{this.isAnsDetail=n,this.isEnableDebug=!!I,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=v,this.commonService.loadAzotaDocxJs().then(()=>{this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(e.hashId??"").subscribe(O=>{if(1==O.success){let L=0,M=0;c.forEach((g,u)=>{g.labelIndex=u,O.data?.resetQuestionIndex&&g.groupInfo&&g.groupInfo.groupId&&(L!=g.groupInfo.groupId&&(L=g.groupInfo.groupId,M=0),g.labelIndex=M,M++)})}this.masterConverterCaller([{listQuestion:c,offlineExamMixQuestionObj:l}],e,_,E,t,h).then(()=>{this.zipper=new r,p?p(10):S.G.closeLoadingEffect(10),x()}).catch(L=>{S.G.closeLoadingEffect(10),D(L)})})}).catch(()=>{p?p(10):S.G.closeLoadingEffect(10),D(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(n,e,_,l,c,E,t,p,v,I){return new Promise((h,x)=>{this.isAnsDetail=n,this.isEnableDebug=!!v,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=p,this.commonService.loadAzotaDocxJs().then(()=>{let D=!0;const O=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(e.hashId??"").subscribe(L=>{l.forEach(M=>{let g=this.commonService.castJsonToClassObjs(W.v,JSON.stringify(M.mixQuestions??[]))??[];if(g.length>0){if(1==L.success){let u=0,f=0;g.forEach((A,N)=>{A.labelIndex=N,L.data?.resetQuestionIndex&&A.groupInfo&&A.groupInfo.groupId&&(u!=A.groupInfo.groupId&&(u=A.groupInfo.groupId,f=0),A.labelIndex=f,f++)})}O.push({listQuestion:g,offlineExamMixQuestionObj:M})}else D=!1}),D?this.masterConverterCaller(O,e,_,c,E,I).then(()=>{this.zipper=new r,t?t(10):S.G.closeLoadingEffect(10),h()}).catch(M=>{t?t(10):S.G.closeLoadingEffect(10),x(M)}):(t?t(10):S.G.closeLoadingEffect(10),x(new Error("lang_testbank_exam_is_invalid_condition")))})}).catch(()=>{t?t(10):S.G.closeLoadingEffect(10),x(new Error("lang_core_lib_not_load"))})})}checkImgAtStart(n){return/^\s*<img/.test(n)}}return P.\u0275fac=function(n){return new(n||P)(m.LFG(R.n),m.LFG(s.E),m.LFG(a.z),m.LFG(d.U),m.LFG(o.h),m.LFG(F.H),m.LFG(b.j),m.LFG(K.g),m.LFG(Q.i),m.LFG(z.Cq))},P.\u0275prov=m.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()}}]);