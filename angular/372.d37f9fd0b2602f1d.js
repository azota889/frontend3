(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[372],{78339:(R,I,r)=>{"use strict";r.r(I),r.d(I,{HomeworkModule:()=>be});var w=r(54460),c=r(10936),x=r(89163),v=r(65162),o=r(69223),m=r(15343),b=r(13763),f=r(5502),S=r(46584),u=r(70050),_=r(7050),O=r(76407),j=r(91100),M=r(43234),G=r(1133),L=r(50866),C=r(81519),A=r(34514),F=r(47426),T=r(76627),ut=r(99503),pt=r(79347),gt=r(38009),W=r(9691),P=r(59640),ft=r(80037),bt=r(15766),kt=r(53043),$=r(39712),t=r(26860),Z=r(70254),H=r(46899),N=r(46134),B=r(51113),_t=r(36484),vt=r(3780),wt=r(88089),jt=r(9280),Q=r(39471),yt=r(97839),z=r(74960),U=r(18718),V=r(81587),St=r(27985),xt=r(63349),q=r(96451),E=r(73437);const Mt=["startTime"],Ot=["endTime"];function Dt(n,y){if(1&n&&t.nrm(0,"azt-loading-effect",3),2&n){const e=t.XpG();t.Y8G("currentStatusObj",e.statusObj)}}function It(n,y){1&n&&(t.j41(0,"div",74),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&n&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_auto_vui_long_nhap_ten_bai_tap")," "))}function Ct(n,y){1&n&&(t.j41(0,"div",75),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&n&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_testbank_test_config_end_time_bigger_time_star"),". "))}function Et(n,y){if(1&n){const e=t.RV6();t.j41(0,"div",76)(1,"button",77),t.bIt("click",function(){const s=t.eBV(e).index,d=t.XpG(2);return t.Njj(!!d.formHomework.files&&d.formHomework.files.splice(s,1))}),t.nrm(2,"lucide-icon",78),t.k0s(),t.j41(3,"a",79),t.bIt("click",function(){const s=t.eBV(e).$implicit,d=t.XpG(2);return t.Njj(d.onShowFile(s,-1))}),t.j41(4,"span",80),t.EFF(5),t.k0s()()()}if(2&n){const e=y.$implicit;t.R7$(4),t.Y8G("title",e.name),t.R7$(1),t.JRh(e.name)}}const Tt=function(n){return[n]},Rt=function(){return{standalone:!0}};function Nt(n,y){if(1&n){const e=t.RV6();t.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"h3",8),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",9)(8,"div",10)(9,"div",11)(10,"label",12),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()(),t.j41(13,"div",11)(14,"div",13),t.nrm(15,"input",14),t.nI1(16,"mytranslate"),t.k0s(),t.DNE(17,It,3,3,"div",15),t.k0s()(),t.j41(18,"div",16)(19,"div",17)(20,"label",18),t.EFF(21),t.nI1(22,"mytranslate"),t.nrm(23,"lucide-icon",19),t.k0s()(),t.j41(24,"div",17)(25,"div",20)(26,"div",21)(27,"mat-form-field",22)(28,"input",23),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.openDateTimePicker(1))}),t.nI1(29,"mytranslate"),t.k0s(),t.j41(30,"button",24),t.bIt("click",function(a){return t.eBV(e),t.XpG().openDateTimePicker(1),t.Njj(a.stopPropagation())}),t.nrm(31,"lucide-icon",25),t.k0s(),t.j41(32,"ngx-mat-datetime-picker",26,27)(34,"ngx-mat-datepicker-actions")(35,"button",28),t.EFF(36),t.nI1(37,"mytranslate"),t.k0s(),t.j41(38,"button",29),t.EFF(39,"OK"),t.k0s()()()()(),t.j41(40,"div",21)(41,"mat-form-field",22)(42,"input",30),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.openDateTimePicker(0))}),t.nI1(43,"mytranslate"),t.k0s(),t.j41(44,"button",31),t.bIt("click",function(a){return t.eBV(e),t.XpG().openDateTimePicker(0),t.Njj(a.stopPropagation())}),t.nrm(45,"lucide-icon",25),t.k0s(),t.j41(46,"ngx-mat-datetime-picker",26,32)(48,"ngx-mat-datepicker-actions")(49,"button",28),t.EFF(50),t.nI1(51,"mytranslate"),t.k0s(),t.j41(52,"button",29),t.EFF(53,"OK"),t.k0s()()()()(),t.j41(54,"div",33)(55,"button",34),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.clearTime())}),t.nrm(56,"lucide-icon",35),t.EFF(57),t.nI1(58,"mytranslate"),t.k0s()()(),t.j41(59,"div",36)(60,"div",37),t.EFF(61),t.nI1(62,"mytranslate"),t.k0s(),t.DNE(63,Ct,3,3,"div",38),t.k0s()()(),t.j41(64,"div",39)(65,"div",11)(66,"h3",40),t.EFF(67),t.nI1(68,"mytranslate"),t.k0s()(),t.j41(69,"div",41)(70,"azt-upload-multiple-box",42),t.bIt("uploadComplete",function(a){t.eBV(e);const s=t.XpG();return t.Njj(s.handleUploadComplete(a))}),t.j41(71,"a",43),t.nrm(72,"lucide-icon",44),t.j41(73,"span"),t.EFF(74),t.nI1(75,"mytranslate"),t.k0s()()(),t.j41(76,"div",45),t.EFF(77),t.nI1(78,"mytranslate"),t.k0s(),t.DNE(79,Et,6,2,"div",46),t.j41(80,"editor",47),t.bIt("ngModelChange",function(a){t.eBV(e);const s=t.XpG();return t.Njj(s.formHomework.content=a)}),t.k0s()()(),t.j41(81,"div",48)(82,"div",49)(83,"label",50),t.EFF(84),t.nI1(85,"mytranslate"),t.k0s()(),t.j41(86,"div",51)(87,"div",52)(88,"div",53),t.nrm(89,"input",54),t.j41(90,"label",55),t.EFF(91),t.nI1(92,"mytranslate"),t.k0s()(),t.j41(93,"div",56),t.nrm(94,"input",57),t.j41(95,"label",58),t.EFF(96),t.nI1(97,"mytranslate"),t.k0s()()()()(),t.j41(98,"div",59)(99,"div",49)(100,"label",50),t.EFF(101),t.nI1(102,"mytranslate"),t.k0s()(),t.j41(103,"div",51)(104,"div",52)(105,"div",53),t.nrm(106,"input",60),t.j41(107,"label",61),t.EFF(108),t.nI1(109,"mytranslate"),t.k0s()(),t.j41(110,"div",56),t.nrm(111,"input",62),t.j41(112,"label",63),t.EFF(113),t.nI1(114,"mytranslate"),t.k0s()()()()(),t.j41(115,"div",64)(116,"div",65)(117,"div",66),t.EFF(118),t.nI1(119,"mytranslate"),t.k0s()(),t.j41(120,"div",67)(121,"div",68),t.nrm(122,"azt-list-classroom-checkbox",69),t.k0s()()()(),t.j41(123,"div",70)(124,"div",71)(125,"button",72),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.saveHomework(0))}),t.EFF(126),t.nI1(127,"mytranslate"),t.k0s(),t.j41(128,"button",73),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.saveHomework(1))}),t.EFF(129),t.nI1(130,"mytranslate"),t.k0s()()()()()()()}if(2&n){const e=t.sdS(33),i=t.sdS(47),a=t.XpG();t.R7$(1),t.Y8G("formGroup",a.form),t.R7$(4),t.SpI(" ",t.bMT(6,44,"lang_auto_tao_bai_tap_moi")," "),t.R7$(6),t.SpI(" ",t.bMT(12,46,"lang_auto_ten")," "),t.R7$(4),t.FS9("placeholder",t.bMT(16,48,"lang_auto_nhap_ten")+" ..."),t.R7$(2),t.Y8G("ngIf",a.form.controls.homeworkName.errors),t.R7$(4),t.SpI(" ",t.bMT(22,50,"lang_testbank_test_config_time_assigne_homework")," "),t.R7$(7),t.FS9("placeholder",t.bMT(29,52,"lang_auto_tu")),t.Y8G("max",a.maxDate)("ngxMatDatetimePicker",e),t.R7$(4),t.Y8G("touchUi",!0),t.R7$(4),t.JRh(t.bMT(37,54,"lang_auto_dong")),t.R7$(6),t.FS9("placeholder",t.bMT(43,56,"lang_auto_den")),t.Y8G("max",a.maxDate)("ngxMatDatetimePicker",i),t.R7$(4),t.Y8G("touchUi",!0),t.R7$(4),t.JRh(t.bMT(51,58,"lang_auto_dong")),t.R7$(7),t.SpI(" ",t.bMT(58,60,"lang_auto_dat_lai")," "),t.R7$(4),t.SpI("",t.bMT(62,62,"lang_auto_bo_trong_neu_khong_muon_gioi_han_thoi_gian"),"."),t.R7$(2),t.Y8G("ngIf",a.calculatorTimeValidate(a.form.controls.homeworkDeadline.value,a.form.controls.homeworkStartDate.value)<=0),t.R7$(4),t.SpI(" ",t.bMT(68,64,"lang_auto_noi_dung")," "),t.R7$(3),t.Y8G("uploadToCdnMenu",a.allUploadToCdnMenuTypes.HOMEWORK)("fileType",t.eq3(88,Tt,a.allUploadFileTypes.SYNTHETIC))("notSupportedFile",a.notSupportedFile.WMV),t.R7$(4),t.JRh(t.bMT(75,66,"lang_homework_add_home_work_add_file_homework")),t.R7$(3),t.JRh(t.bMT(78,68,"lang_cms_add_homework_input_file")),t.R7$(2),t.Y8G("ngForOf",a.formHomework.files),t.R7$(1),t.FS9("apiKey",a.tinyEditorKey),t.Y8G("ngModel",a.formHomework.content)("ngModelOptions",t.lJ4(90,Rt))("init",a.initDataEditor),t.R7$(4),t.SpI(" ",t.bMT(85,70,"lang_auto_cho_xem_ket_qua")," "),t.R7$(7),t.SpI(" ",t.bMT(92,72,"lang_auto_khong")," "),t.R7$(5),t.SpI(" ",t.bMT(97,74,"lang_auto_co")," "),t.R7$(5),t.SpI(" ",t.bMT(102,76,"lang_auto_dang_nhap_de_nop_bai")," "),t.R7$(7),t.SpI(" ",t.bMT(109,78,"lang_auto_khong")," "),t.R7$(5),t.SpI(" ",t.bMT(114,80,"lang_auto_co")," "),t.R7$(5),t.SpI(" ",t.bMT(119,82,"lang_auto_giao_cho_lop")," "),t.R7$(4),t.Y8G("form",a.form)("classroomGroupData",a.classroomWithGroup)("permissionName",a.permissionTypes.homework),t.R7$(3),t.Y8G("disabled",a.form.invalid||a.checkDeadLineValid(a.form.controls.homeworkStartDate.value,a.form.controls.homeworkDeadline.value)<=0),t.R7$(1),t.SpI(" ",t.bMT(127,84,"lang_auto_luu_nhap")," "),t.R7$(2),t.Y8G("disabled",a.form.invalid||a.checkDeadLineValid(a.form.controls.homeworkStartDate.value,a.form.controls.homeworkDeadline.value)<=0),t.R7$(1),t.SpI(" ",t.bMT(130,86,"lang_auto_xuat_ban")," ")}}let Ft=(()=>{class n extends P.H{clearTime(){this.form.controls.homeworkDeadline.setValue(""),this.form.controls.homeworkStartDate.setValue("")}checkDeadLineValid(e,i){return""!=e&&""!=i?this.timeService.getDiffFromTwoDateWithZeroSecond(i,e):1}calculatorTimeValidate(e,i){return""!=e&&""!=i?this.timeService.calculationHomeworkTimeWithZeroSecond(e,i):1}handleUploadComplete(e){this.formHomework.files?.push(...e)}onShowFile(e,i){let a={...e,index:i};this.sAztDialogService.open(kt.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:a},restoreFocus:!1})}openDateTimePicker(e){1==e?this.startTime&&this.startTime.open():this.endTime&&this.endTime.open()}saveHomework(e){this.initStatusObj(),this.homeWorkContent=this.formHomework.content??"",this.uploadImageOfHomeworkService.replaceImageInContent(this.homeWorkContent).subscribe(i=>{null==i.errorMessage?(this.homeWorkContent=i.content,this.callApiToSaveHomework(e)):(this.showErrorSnack(i.errorMessage),this.stopStatusObj())})}callApiToSaveHomework(e){let i=this.form.getRawValue(),a=i.homeworkStartDate?this.timeService.formatDateTimeToPostToServer(i.homeworkStartDate):void 0,s=i.homeworkDeadline?this.timeService.formatDateTimeToPostToServer(i.homeworkDeadline):void 0,d="1"!=i.mustVerified?0:1,h="1"!=i.whenShowAnswer?0:1;this.homeWorkContent=this.zipDataService.convertContentGzip(this.homeWorkContent);let g=this.userService.getUserObj(),l=JSON.stringify({type:"homework",id:0,user:g.id});const p=this.sAztClassroomCheckboxService.getClassroomIdsCheckedInGroup(this.form.controls.classroomFormArray);let k={name:i.homeworkName,content:this.homeWorkContent,startDate:a,deadline:s,files:JSON.stringify(this.formHomework.files),mustVerified:d,whenShowAnswer:h,isPublished:e,categoryId:this.cateId?Number(this.cateId):void 0,classroomIds:p};this.waitDestroy(this.homeworkService.apiHomeworkSaveObjPost(l,k).subscribe(D=>{if(1==D.success){if(e){this.successStatusObj("lang_auto_xuat_ban_thanh_cong",!0);let ht=[];if(D.data?.objs)for(let K=0;K<D.data.objs.length;K++)ht.push(D.data?.objs[K].hashId);this.listIds=JSON.stringify(ht),this.commonService.myNavigationWithQueryString("/admin/testbank/publish-document/1/"+(this.cateId??0)+"/"+this.listIds,"?backto="+encodeURIComponent(`/admin/homework/add-new-homework/${this.cateId??0}?backto=`+this.backToLink))}else this.commonService.myNavigation(this.backToLink?this.backToLink:"/admin/testbank/document-management/1/0/1"),this.successStatusObj("lang_auto_luu_thanh_cong_chua_xuat_ban",!0);this.successStatusObj()}else this.errorStatusObj(D.message??"",!0)}))}getHomework(){this.waitDestroy(this.documentConfigService.apiDocumentConfigGetHomeworkConfigDataV2Post("add_new",[]).subscribe(e=>{1==e.success?(this.classroomWithGroup=e.data?.classroomGroupObjs??[],this.successStatusObj()):this.errorStatusObj(e.message??"",!0)}))}ngOnChanges(){this.initDataEditor=this.sAztTinyMceService.initConfigForTeacher()}ngOnInit(){this.initStatusObj(),this.initDataEditor=this.sAztTinyMceService.initConfigForTeacher(),this.waitDestroy((0,T.z)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([])=>{this.backToLink=this.commonService.getMyQueryParam("backto")??"",this.cateId=this.commonService.getMyParam(this.activeRoute,"cat_id")??"",this.getHomework()})),this.commonService.translateMetaData({title:"lang_cms_homework_add_exercise_title",description:"lang_cms_homework_add_exercise_description",image:"lang_cms_test_image"})}constructor(e,i,a,s,d,h,g,l,p,k,D){super(),this.sAztTinyMceService=e,this.sAztDialogService=i,this.activeRoute=a,this.homeworkService=s,this.classroomService=d,this.zipDataService=h,this.timeService=g,this.userService=l,this.sAztClassroomCheckboxService=p,this.uploadImageOfHomeworkService=k,this.documentConfigService=D,this.permissionTypes=gt.t,this.tinyEditorKey=M.c.tinyEditorKey,this.formHomework={files:[],content:""},this.prevData="",this.cateId="",this.listIds="",this.backToLink="",this.homeWorkContent="",this.initDataEditor={},this.maxDate=M.c.maxDateTimePicker,this.allUploadToCdnMenuTypes=$.b8,this.allUploadFileTypes=$.PO,this.notSupportedFile=$.Ym,this.classroomWithGroup=[],this.form=new c.gE({homeworkName:new c.MJ("",{nonNullable:!0,validators:[c.k0.required,c.k0.maxLength(180),bt.M.noWhiteSpace]}),homeworkStartDate:new c.MJ("",{nonNullable:!0}),homeworkDeadline:new c.MJ("",{nonNullable:!0}),mustVerified:new c.MJ("0",{nonNullable:!0}),whenShowAnswer:new c.MJ("0",{nonNullable:!0}),classroomFormArray:new c.Yp([]),whoAllow:new c.MJ(2,{nonNullable:!0})},{validators:[ft.j.classroomInGroupCheckBoxValidator]})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(Z.f),t.rXU(H.i),t.rXU(v.nX),t.rXU(N.MY),t.rXU(N.zS),t.rXU(B.j),t.rXU(W.F),t.rXU(_t.R),t.rXU(vt.Q),t.rXU(wt.J),t.rXU(jt.x_))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-add-home-work"]],viewQuery:function(i,a){if(1&i&&(t.GBs(Mt,5),t.GBs(Ot,5)),2&i){let s;t.mGM(s=t.lsd())&&(a.startTime=s.first),t.mGM(s=t.lsd())&&(a.endTime=s.first)}},features:[t.Jv_([{provide:C.$O,useClass:ut.fb,deps:[F.Ju,A.ij]},{provide:C.vq,useFactory:pt.Yw,deps:[W.F]}]),t.Vt3,t.OA$],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document","mx-auto",2,"max-width","1000px"],[1,"setting-basic"],[1,"text-md","uppercase","font-medium"],[1,"box","mt-2","p-5"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","homework-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","homework-name","formControlName","homeworkName","type","text",1,"form-control",3,"placeholder"],["class","text-xs text-danger mt-2",4,"ngIf"],["id","azt-config-time-assignment",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12"],["for","regular-form-1",1,"form-label","mb-0","font-medium","flex","items-center"],["name","info","size","16",1,"mr-1"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-5"],["appearance","outline"],["azt-track-service","add-home-work-2lcHTxnwVmR","matInput","","formControlName","homeworkStartDate","readonly","",3,"placeholder","max","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work-6MNUM1lV8t1","matSuffix","",2,"font-size","18px",3,"click"],["name","calendar-clock","size","16"],[3,"touchUi"],["startTime",""],["mat-raised-button","","color","secondary","ngxMatDatepickerCancel",""],["mat-raised-button","","color","primary","ngxMatDatepickerApply",""],["azt-track-service","add-home-work-ShSJ8gIBpK8","matInput","","formControlName","homeworkDeadline","readonly","",3,"placeholder","max","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work--BjU84v-g28","matSuffix","",2,"font-size","18px",3,"click"],["endTime",""],[1,"col-span-6","md:col-span-2"],["azt-track-service","add-home-work-NEdqGTKJIVb",1,"btn","btn-outline-secondary","w-full",3,"click"],["name","timer-reset","size","16",1,"mr-1"],[1,"text-xs","mt-2"],[1,"text-slate-500","mt-1"],["class","text-danger mt-1",4,"ngIf"],[1,"grid","grid-cols-12","mt-4"],[1,"text-md","font-medium"],[1,"col-span-12","lg:col-span-12","mt-3"],[2,"display","inline-block",3,"uploadToCdnMenu","fileType","notSupportedFile","uploadComplete"],["azt-track-service","add-home-work-4ML9tUkucGY",1,"btn","btn-sm","btn-primary-soft","mr-2"],["name","plus","size","16",1,"mr-1"],[1,"text-slate-600","text-xs","mt-2","mb-2"],["class","flex items-center mt-3 mb-3",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","apiKey","init","ngModelChange"],["id","azt-config-when-result",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["id","whenShowAnswer-off","type","radio","formControlName","whenShowAnswer","value","1",1,"form-check-input"],["for","whenShowAnswer-off",1,"form-check-label"],[1,"form-check","mr-8","mt-2","sm:mt-0"],["id","whenShowAnswer-tested","type","radio","formControlName","whenShowAnswer","value","0",1,"form-check-input"],["for","whenShowAnswer-tested",1,"form-check-label","flex","items-center"],["id","azt-config-login-require",1,"grid","grid-cols-12","mt-4"],["id","mustVerified-off","type","radio","formControlName","mustVerified","value","0",1,"form-check-input"],["for","mustVerified-off",1,"form-check-label"],["id","mustVerified-tested","type","radio","formControlName","mustVerified","value","1",1,"form-check-input"],["for","mustVerified-tested",1,"form-check-label","flex","items-center"],["id","azt-config-who-allow",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5","pr-5"],[1,"mb-0","font-medium","flex","items-center"],[1,"col-span-12","mt-4"],[1,"azt-list-classroom"],[3,"form","classroomGroupData","permissionName"],[1,"my-5"],[1,"text-right"],["azt-track-service","add-home-work-ZxDqD0KF4NR",1,"btn","btn-pending","w-24","mr-2",3,"disabled","click"],["azt-track-service","add-home-work-JgG_cpuccgD",1,"btn","w-24","btn-primary",3,"disabled","click"],[1,"text-xs","text-danger","mt-2"],[1,"text-danger","mt-1"],[1,"flex","items-center","mt-3","mb-3"],["azt-track-service","add-home-work-HeEXhrbob3P",1,"text-slate-600","mr-2",3,"click"],["name","x","size","16"],["azt-track-service","add-home-work-QFtSJlUphLG",3,"click"],[1,"text-slate-600",3,"title"]],template:function(i,a){if(1&i&&(t.j41(0,"teacher-layout",0),t.DNE(1,Dt,1,1,"azt-loading-effect",1),t.DNE(2,Nt,131,91,"ng-template",null,2,t.C5r),t.k0s()),2&i){const s=t.sdS(3);t.Y8G("headerBackToLink",a.backToLink),t.R7$(1),t.Y8G("ngIf",1==a.statusObj.loading)("ngIfElse",s)}},dependencies:[w.Sq,w.bT,Q.$z,yt.fg,z.rl,z.yw,C.m7,C.yF,C.HF,C.gx,C.Uq,o.xn,c.qT,c.me,c.Fm,c.BC,c.cb,c.vS,c.j4,c.JD,U.K,V.t,St.D,xt.V,q.Q,m.WGl,E.wp],encapsulation:2})}return n})();var tt=r(20512),J=r(53904),Pt=r(4375);function Lt(n,y){if(1&n&&(t.j41(0,"mat-option",15),t.EFF(1),t.k0s()),2&n){const e=y.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.name," ")}}function At(n,y){if(1&n&&t.nrm(0,"azt-loading-effect",16),2&n){const e=t.XpG();t.Y8G("currentStatusObj",e.statusObj)}}function Ht(n,y){1&n&&(t.j41(0,"div",19)(1,"span",20),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s()()),2&n&&(t.R7$(2),t.SpI("",t.bMT(3,1,"lang_homework_content_store_not_found_search"),"!"))}function Bt(n,y){if(1&n){const e=t.RV6();t.j41(0,"div",23)(1,"div",24),t.nrm(2,"img",25),t.nI1(3,"mycdn"),t.j41(4,"div",26)(5,"p",27),t.EFF(6),t.k0s(),t.j41(7,"div",28)(8,"div",29),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"a",30),t.bIt("click",function(){const s=t.eBV(e).$implicit,d=t.XpG(3);return t.Njj(d.downloadFrontFileContent(s.id?s.id:0))}),t.j41(12,"mat-icon",31),t.EFF(13,"save_alt"),t.k0s(),t.EFF(14),t.nI1(15,"mytranslate"),t.k0s()()()()()}if(2&n){const e=y.$implicit;t.R7$(2),t.FS9("src",t.bMT(3,4,e.thumb),t.B4B),t.R7$(4),t.JRh(e.name),t.R7$(3),t.JRh(t.bMT(10,6,"lang_homework_content_store_free")),t.R7$(5),t.SpI(" ",t.bMT(15,8,"lang_homework_content_store_download")," ")}}function Gt(n,y){if(1&n&&(t.j41(0,"div",21),t.DNE(1,Bt,16,10,"div",22),t.k0s()),2&n){const e=t.XpG(2);t.R7$(1),t.Y8G("ngForOf",e.objs)}}function $t(n,y){if(1&n&&(t.DNE(0,Ht,4,3,"div",17),t.DNE(1,Gt,2,1,"ng-template",null,18,t.C5r)),2&n){const e=t.sdS(2),i=t.XpG();t.Y8G("ngIf",i.isNullData)("ngIfElse",e)}}let zt=(()=>{class n extends P.H{getData(){this.initStatusObj(),this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(0).subscribe(e=>{1==e.success?(this.objs=e.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(e.message??"")}))}getInfo(){this.initStatusObj(),this.waitDestroy(this.userInfoService.apiUserInfoInfoGet().subscribe(e=>{1==e.success?(this.userObj=e.data,this.successStatusObj()):this.errorStatusObj(e.message??"")}))}getCategories(){this.initStatusObj(),this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetCategoriesObjsGet().subscribe(e=>{1==e.success?(this.categories=e.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(e.message??"")}))}selectValue(e){this.initStatusObj(),this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(e,void 0).subscribe(i=>{1==i.success?i.data?.objs&&i.data?.objs.length>0?(this.isNullData=!1,this.objs=i.data?.objs??new Array,this.successStatusObj()):(this.isNullData=!0,this.stopStatusObj()):this.errorStatusObj(i.message??"")}))}onSearch(){var e=this.getFormValue();this.initStatusObj(),""==e.searchContent?(this.isNullData=!1,this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(0).subscribe(i=>{1==i.success?(this.objs=i.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(i.message??"")}))):this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(0,e.searchContent).subscribe(i=>{1==i.success?(i.data?.objs&&0==i.data?.objs.length?this.isNullData=!0:this.objs=i.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(i.message??"")}))}downloadFrontFileContent(e){this.frontFileContentService.apiFrontFileContentGetFileLinkGet(e).subscribe(i=>{1==i.success&&i.data?.link?this.commonService.downloadFileByUrl(i.data.link):this.showErrorSnack("lang_cms_content_store_download_fail")})}getFormValue(){return this.form.getRawValue()}ngOnInit(){(0,T.z)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([e,i])=>{this.getData(),this.getInfo(),this.getCategories()}),this.commonService.translateMetaData({title:"lang_cms_homework_content_store_title",description:"lang_cms_homework_content_store_description",image:"lang_cms_test_image"}),super.ngOnInit()}constructor(e,i,a,s){super(),this.activeRoute=e,this.userInfoService=i,this.frontFileContentService=a,this.sAztDialogService=s,this.isNullData=!1,this.objs=[],this.categories=[],this.form=new c.gE({searchContent:new c.MJ("",{nonNullable:!0,validators:[c.k0.required]})})}ngOnDestroy(){super.ngOnDestroy()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(v.nX),t.rXU(tt.fv),t.rXU(tt.Uu),t.rXU(H.i))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-content-store"]],features:[t.Vt3],decls:20,vars:11,consts:[[3,"headerBackToLink"],["id","content-store",1,"container-fluid","component-wrap","W1200","m-auto","mt-3","pb-mb-80","pb-4"],[3,"formGroup"],[1,"flex",2,"justify-content","space-between"],[2,"width","60%","margin-top","5px"],[1,"search-bar","form-group"],[1,"input-group-append"],["type","text","formControlName","searchContent",1,"form-control",3,"placeholder","keyup.enter"],["azt-track-service","content-store-Z-NOMKYiG5Z","id","basic-addon2",1,"btn","btn-primary","ml-2",3,"click"],[1,"content-store-select",2,"width","38%"],["appearance","outline"],["name","category",3,"placeholder","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"value"],[3,"currentStatusObj"],["class","text-center mt-3 mb-3",4,"ngIf","ngIfElse"],["HasData",""],[1,"text-center","mt-3","mb-3"],[1,"h3"],[1,"grid","grid-cols-12","gap-5","mt-2"],["class","box col-span-12 md:col-span-4 sm:col-span-6 mb-2","style","margin: auto",4,"ngFor","ngForOf"],[1,"box","col-span-12","md:col-span-4","sm:col-span-6","mb-2",2,"margin","auto"],[1,"card"],["alt","thumbnail",1,"card-img-top",2,"width","80vw",3,"src"],[1,"card-body"],[1,"truncate","p-2","card-text"],[1,"actionZone","p-2"],[1,"azo-price","text-warning"],["azt-track-service","content-store-NDNy2GWJJPR",1,"actionBtn","clickable",3,"click"],[2,"vertical-align","sub"]],template:function(i,a){if(1&i&&(t.j41(0,"teacher-layout",0)(1,"div",1)(2,"form",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"input",7),t.bIt("keyup.enter",function(){return a.onSearch()}),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"button",8),t.bIt("click",function(){return a.onSearch()}),t.j41(10,"mat-icon"),t.EFF(11,"search"),t.k0s()()()()(),t.j41(12,"div",9)(13,"mat-form-field",10)(14,"mat-select",11),t.bIt("selectionChange",function(d){return a.selectValue(d.value)}),t.nI1(15,"mytranslate"),t.DNE(16,Lt,2,2,"mat-option",12),t.k0s()()()()(),t.DNE(17,At,1,1,"azt-loading-effect",13),t.DNE(18,$t,3,2,"ng-template",null,14,t.C5r),t.k0s()()),2&i){const s=t.sdS(19);t.Y8G("headerBackToLink","/admin/dashboard"),t.R7$(2),t.Y8G("formGroup",a.form),t.R7$(5),t.FS9("placeholder",t.bMT(8,7,"lang_homework_content_store_search")),t.R7$(7),t.FS9("placeholder",t.bMT(15,9,"lang_homework_content_store_all")),t.R7$(2),t.Y8G("ngForOf",a.categories),t.R7$(1),t.Y8G("ngIf",a.statusObj.loading)("ngIfElse",s)}},dependencies:[w.Sq,w.bT,F.wT,J.An,z.rl,Pt.VO,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,U.K,V.t,q.Q,E.wp,E.nf],styles:[".dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;border-radius:5px}.input-group-append[_ngcontent-%COMP%]{display:flex}.border-test[_ngcontent-%COMP%]{border:1px solid red;min-height:50px}.azo-price[_ngcontent-%COMP%]{padding-top:5px;font-weight:500;font-size:1.2rem}.content-store-select[_ngcontent-%COMP%]{margin-top:5px}.card-text[_ngcontent-%COMP%]{display:block!important;max-width:245px!important}.content-header[_ngcontent-%COMP%]{background:inherit;background-color:#0089a7;padding:20px 0}.user_amount[_ngcontent-%COMP%]{background:inherit;background-color:#009cbe;border:none;border-radius:5px;padding:10px;box-shadow:none}.user_amount[_ngcontent-%COMP%]:hover{text-decoration:none}.mat-card-avatar[_ngcontent-%COMP%]{height:50px;width:50px;border-radius:50%;flex-shrink:0;object-fit:cover}@media (max-width: 992px){.dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;margin-top:-15px;margin-left:-15px;margin-right:-15px;border-radius:0}}.actionZone[_ngcontent-%COMP%]{display:flex;justify-content:space-between}  .mat-form-field-underline{position:initial!important}@media (max-width: 768px){.card-text[_ngcontent-%COMP%]{display:block!important;max-width:120px}.header-col-center[_ngcontent-%COMP%]{text-align:center!important;display:block!important}.header-col-center[_ngcontent-%COMP%]   .nav[_ngcontent-%COMP%]{margin-left:auto!important;margin-right:auto!important;margin-bottom:10px!important;text-align:center!important;display:inline-flex!important}.user_amount[_ngcontent-%COMP%]{margin-left:0!important;margin-bottom:10px!important}.content-header[_ngcontent-%COMP%]{padding:20px 0 0}}"]})}return n})();var Ut=r(73014),X=r(27691),et=r(64198),Y=r(83229),it=r(33887),at=r(52811);let st=(()=>{class n extends it._{getData(){this.initStatusObj(),this.data.status?this.successStatusObj():this.stopStatusObj()}cleanResult(){var e=this.getFormValue(),i={homeworkHashId:this.data.itemHomework.hashId??"",id:this.data.ans_id,resendNote:e.reason};this.initStatusObj(),this.waitDestroy(this.answerService.apiAnswerResendAnswerPost(i).subscribe(a=>{1==a.success?(this.showSuccessSnack(this.commonService.myTranslateInstant("lang_send_request_must_resubmit_homework_with_reason")+": "+e.reason),this.result=!0,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.successStatusObj()):(this.showErrorSnack("lang_cms_send_request_error"),this.result=!1,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.errorStatusObj(a.message??""))}))}getFormValue(){return this.form.getRawValue()}ngOnInit(){this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"",this.getData(),super.ngOnInit()}constructor(e,i,a,s){super(s,e),this.dialogRef=e,this.answerService=i,this.activeRoute=a,this.data=s,this.result=!1,this.homeworkHashId="",this.form=new c.gE({reason:new c.MJ("",{nonNullable:!0,validators:[c.k0.required]})})}onNoClick(){this.dialogRef.close()}onSubmit(e){this.dialogRef.close(e)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(x.CP,8),t.rXU(N._t),t.rXU(v.nX),t.rXU(x.Vh,8))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["clean-result-dialog"]],features:[t.Vt3],decls:43,vars:31,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto","text-center"],[3,"hidden"],[1,"d-flex","justify-content-center"],[1,"sr-only","ml-2"],[1,"intro",3,"hidden"],["enctype","multipart/form-data",1,"form-horizontal","text-center",3,"formGroup"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger","text-center"],[1,"h5","mb-1"],[1,"text-danger"],[1,"h5","text-danger","mt-1","mb-1"],["type","text","id","reason","formControlName","reason",1,"form-control","mt-2"],[1,"text-right","mt-3"],["azt-track-service","clean-result-dialog-_f7PVI4E-S_",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","clean-result-dialog-xDCHUvnl-fJ",1,"btn","w-24","btn-primary",3,"click"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()(),t.nrm(7,"br"),t.j41(8,"div",5)(9,"div",6),t.nrm(10,"azt-loading-ui"),t.j41(11,"span",7),t.EFF(12,"..."),t.k0s()()(),t.j41(13,"div",8)(14,"form",9)(15,"div",10)(16,"p",11),t.EFF(17),t.nI1(18,"mytranslate"),t.k0s(),t.j41(19,"p",12),t.EFF(20),t.nI1(21,"mytranslate"),t.j41(22,"span",13),t.EFF(23),t.k0s(),t.EFF(24),t.nI1(25,"mytranslate"),t.j41(26,"span",13),t.EFF(27),t.nI1(28,"formatOnlyDateByUserUnitPipe"),t.k0s(),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s(),t.nrm(31,"hr"),t.j41(32,"p",14),t.EFF(33),t.nI1(34,"mytranslate"),t.k0s(),t.nrm(35,"input",15),t.k0s()()(),t.j41(36,"div",16)(37,"button",17),t.bIt("click",function(){return a.onNoClick()}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",18),t.bIt("click",function(){return a.cleanResult()}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()),2&i&&(t.R7$(5),t.JRh(t.bMT(6,13,"lang_homework_mark_exercise_utils_request_resubmit")),t.R7$(3),t.Y8G("hidden",!a.statusObj.loading),t.R7$(5),t.Y8G("hidden",a.statusObj.loading),t.R7$(1),t.Y8G("formGroup",a.form),t.R7$(3),t.SpI("(*) ",t.bMT(18,15,"lang_homework_mark_exercise_utils_note"),":"),t.R7$(3),t.SpI(" ",t.bMT(21,17,"lang_homework_mark_exercise_utils_request")," "),t.R7$(3),t.SpI(" ",a.data.name," "),t.R7$(1),t.SpI(" ",t.bMT(25,19,"lang_homework_mark_exercise_utils_in_homework"),"\xa0"),t.R7$(3),t.JRh(t.bMT(28,21,a.data.deadline?a.data.deadline:a.data.itemHomework.createdAt)),t.R7$(2),t.SpI("\xa0",t.bMT(30,23,"lang_homework_mark_exercise_utils_will_be_deleted"),"! "),t.R7$(4),t.JRh(t.bMT(34,25,"lang_homework_mark_exercise_utils_coment_request_resubmit")),t.R7$(5),t.SpI(" ",t.bMT(39,27,"lang_button_cancel")," "),t.R7$(3),t.SpI(" ",t.bMT(42,29,"lang_button_confirm")," "))},dependencies:[c.qT,c.me,c.BC,c.cb,c.j4,c.JD,V.t,at.R,E.wp,E.vv],encapsulation:2})}return n})();var Vt=r(66729);let nt=(()=>{class n extends it._{ngOnInit(){this.success=this.data.status}constructor(e,i,a){super(a,e),this.dialogRef=e,this.answerService=i,this.data=a,this.success=!1}checkNextAns(){this.dialogRef.close(),this.answerService.apiAnswerGetNextObjByHomeworkGet(this.data.homeworkHashId).subscribe(e=>{if(1==e.success)return this.commonService.myNavigationWithQueryString("/admin/homework/switch-mark-exercise/"+e.data?.obj?.id+"/"+this.data.homeworkHashId+"/0","?backto="+encodeURIComponent(this.data.backToLink)),void(window.location.href=this.commonService.getLocalRouter("/admin/homework/switch-mark-exercise/"+e.data?.obj?.id+"/"+this.data.homeworkHashId+"/0?backto="+encodeURIComponent(this.data.backToLink)));window.location.href=this.commonService.getLocalRouter("/admin/testbank/homework-results-list/"+this.data.classID+"/"+this.data.homeWorkID+"/"+this.data.homeworkHashId)})}onNoClick(){this.dialogRef.close()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(x.CP,8),t.rXU(N._t),t.rXU(x.Vh,8))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["notice-dialog"]],features:[t.Vt3],decls:22,vars:10,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto"],[1,"mr-1",2,"color","green"],[2,"color","red","font-size","120%","font-weight","500"],[3,"mark"],[1,"text-right","mt-3"],["azt-track-service","notice-dialog-YnLBVlTjw",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","notice-dialog-D6RUmpOZKX",1,"btn","w-24","btn-primary",3,"click"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4)(5,"mat-icon",5),t.EFF(6,"check_circle"),t.k0s(),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()(),t.nrm(9,"br"),t.j41(10,"div",3),t.EFF(11),t.nI1(12,"mytranslate"),t.j41(13,"span",6),t.nrm(14,"azt-check-mark",7),t.k0s()(),t.nrm(15,"br"),t.j41(16,"div",8)(17,"button",9),t.bIt("click",function(){return a.onNoClick()}),t.EFF(18,"Ok"),t.k0s(),t.j41(19,"button",10),t.bIt("click",function(){return a.checkNextAns()}),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s()()()()()),2&i&&(t.R7$(7),t.SpI(" ",t.bMT(8,4,"lang_homework_mark_exercise_utils_mark_success"),""),t.R7$(4),t.SpI(" ",t.bMT(12,6,"lang_homework_mark_exercise_utils_assignment_marking")," "),t.R7$(3),t.Y8G("mark",a.data.score),t.R7$(6),t.JRh(t.bMT(21,8,"lang_homework_mark_exercise_utils_mark_continue")))},dependencies:[J.An,Vt.D,E.wp],styles:["#ok[_ngcontent-%COMP%]:hover{background-color:#e7e7e7}#next[_ngcontent-%COMP%]:hover{background-color:#1e579d!important}"]})}return n})();var ot=r(51913),rt=r(40949),ct=r(41426),lt=r(68323),Jt=r(7919),Xt=r(87653);const Yt=["aztMarkNote"];function Kt(n,y){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"azt-mark-note",38,39),t.bIt("handleBackLink",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.goBack())})("doneLoadData",function(a){t.eBV(e);const s=t.XpG();return t.Njj(s.doneLoadData(a))})("markData",function(a){t.eBV(e);const s=t.XpG();return t.Njj(s.getMarkData(a))})("getIdHistory",function(a){t.eBV(e);const s=t.XpG();return t.Njj(s.getDataHistory(a))}),t.k0s(),t.bVm()}if(2&n){const e=t.XpG();t.R7$(1),t.Y8G("dataMarkNote",e.dataMarkNote)("showBackLink",!0)("markedByObj",e.markedByObj)("historyAnswerObjs",e.historyAnswerObjs)}}function Wt(n,y){if(1&n){const e=t.RV6();t.j41(0,"div",40)(1,"button",41),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.goBack())}),t.qSk(),t.j41(2,"svg",42),t.nrm(3,"polyline",43),t.k0s(),t.joV(),t.j41(4,"span",44),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()(),t.j41(7,"div",45),t.qSk(),t.j41(8,"svg",46),t.nrm(9,"path",47)(10,"path",48)(11,"path",49)(12,"path",50)(13,"path",51)(14,"path",52),t.k0s(),t.joV(),t.j41(15,"p",53),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s()()()}2&n&&(t.R7$(5),t.JRh(t.bMT(6,2,"lang_auto_quay_lai")),t.R7$(11),t.JRh(t.bMT(17,4,"lang_auto_chua_nop_bai")+"..."))}function Zt(n,y){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"mytranslate"),t.nI1(3,"mytranslate"),t.k0s()),2&n){const e=t.XpG();t.R7$(1),t.LHq(" ",t.bMT(2,4,"lang_testbank_tested_list_number_success")+" "," ",e.markData.totalRight+", "," ",t.bMT(3,6,"lang_testbank_tested_list_error")+" "," ",e.markData.totalWrong," ")}}function Qt(n,y){1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&n&&(t.R7$(1),t.JRh(t.bMT(2,1,"lang_core_chua_co_so_cau_dung_cau_sai")))}function qt(n,y){if(1&n){const e=t.RV6();t.j41(0,"div",54)(1,"button",55),t.bIt("click",function(){const s=t.eBV(e).$implicit,d=t.XpG();return t.Njj(d.setPoint(s))}),t.EFF(2),t.k0s()()}if(2&n){const e=y.$implicit;t.R7$(2),t.SpI(" ",e.name," ")}}function te(n,y){1&n&&t.nrm(0,"azt-loading-ui",56)}const ee=function(n){return{height:n}};let ie=(()=>{class n extends P.H{onResize(e){this.changeSizeMarkGeneral()}doneLoadData(e){this.loadingDataCdn=!1}uploadDrawBase64ToCDN(e,i,a){let s=(0,Y.q)(e),d=Date.now();this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${i}_${this.answerId}_${d}.png`,"image/png").subscribe(h=>{h.type!=X.hv.UploadProgress&&(1==h.success?(this.mnoteJsonData.pages?.[i]&&(this.mnoteJsonData.pages[i].draw=h.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,a,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(e,i){this.pagesCount=0;for(let a=0;a<e.length;a++)e[a].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,i,this.mnoteJsonData);else for(let a=0;a<e.length;a++)e[a].draw&&this.uploadDrawBase64ToCDN(e[a].draw,a,i)}sendDataToMarkNote(){let e=this.castObj(this.result.answerObj);if(e){let h=this.commonService.willDeleteParseJson(e.result??"");if(null!=h){let l=h.pages?.length??0;for(let p=0;p<l;p++)h?.pages?.[p].backgroundImage&&(h.pages[p].backgroundImage=this.cdnService.getMyCdn(h.pages[p].backgroundImage??"")),h.pages?.[p].draw&&(h.pages[p].draw=this.cdnService.getMyCdn(h.pages[p].draw));h=JSON.stringify(h),e.result=JSON.stringify(h)}let g=this.commonService.willDeleteParseJson(e.files??"");if(null!=g){for(let l=0;l<g.length;l++)g[l].url&&(g[l].url=this.cdnService.getMyCdn(g[l].url)),g[l].thumb&&(g[l].thumb=this.cdnService.getMyCdn(g[l].thumb));g=JSON.stringify(g),e.files=g}}let i=this.result.studentObj,a=this.result.classroomObj,s=this.result.homeworkObj,d=this.commonService.myParseJson(e?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let h=0;h<(this.jsonData.pages?.length??0);h++)this.jsonData.pages?.[h].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[h].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[h].backgroundImage??"")),this.jsonData.pages?.[h].hasOwnProperty("draw")&&(this.jsonData.pages[h].draw=this.cdnService.getMyCdn(this.jsonData.pages[h].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=e,this.jsonData.student_obj=i,this.jsonData.classroom_obj=a,this.jsonData.homework_obj=s,d&&d.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=d.hideMark),this.dataMarkNote=this.jsonData;else{let h=[];this.files.forEach(l=>{h.push({backgroundImage:l.url})});let g={cmd:"initMNote",mode:"edit",pages:h,answer_obj:e,student_obj:i,classroom_obj:a,homework_obj:s};d&&d.hasOwnProperty("hideMark")&&(g.hideMark=d.hideMark),this.dataMarkNote=g}}getHistoryObjs(e){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,e).subscribe(i=>{1==i.success?this.historyAnswerObjs=i.data?.objs??new Array:this.errorMessage=i.message??"",this.stopStatusObj()})}getDataHistory(e){this.historyId=e,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(e,10)).subscribe(i=>{if(1==i.success){if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),i.data){this.result=i.data,this.markedByObj=i.data.markedByObj,this.score=i.data?.answerObj?.point??0,this.pointExercise.value=i.data?.answerObj?.point??"",Number(this.pointExercise.value)<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="");let a=this.castJsonToObj(i.data.answerObj?.resultNote??"");if(this.commentExercise=a?.Note??"",this.showPoint=!a?.IsHideMark,this.files=this.commonService.myParseJson(i.data.answerObj?.files??"")??[],null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,this.sendDataToMarkNote(),this.successStatusObj()}}else this.errorMessage=i.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var e=this.commonService.myParseJson(this.result.answerObj?.result??"");e&&(this.jsonData=e,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(e){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,e).subscribe(i=>{1==i.success&&i.data?(this.studentObj=i.data.studentObj,this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(e){this.initStatusObj(),this.errorMessage="",this.answerId=e,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(i=>{if(1==i.success)if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),i.data?.hasOwnProperty("studentObj")&&null!=i.data?.studentObj){this.result=i.data,this.markedByObj=i.data.markedByObj,this.score=i.data?.answerObj?.point??0,this.pointExercise.value=i.data?.answerObj?.point??0,this.checkInputActive=!0,this.pointExercise.value<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="",this.checkInputActive=!1);let a=this.castJsonToObj(i.data.answerObj?.resultNote??"");if(this.commentExercise=a?.Note??"",this.showPoint=!a?.IsHideMark,this.homeworkID=i.data.homeworkObj?.id??0,this.classID=i.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(i.data.answerObj?.files??"")??[],this.studentObj=i.data.studentObj,this.classroomObj=i.data.classroomObj??{},null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??""),((0,et.rl)(this.files[s].mimes??"")||(0,et.nL)(this.files[s].mimes??""))&&(this.hasAttachmentFile=!0);this.homeworkObj=i.data.homeworkObj??{},this.studentName=i.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToMarkNote()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=i.message??"",this.stopStatusObj()})}openDialog(e,i){this.sAztDialogService.open(nt,{width:"280px",autoFocus:!1,data:{score:i,status:e,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline??void 0,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(e,i,a,s,d){let h={status:e,deadline:i,itemHomework:a,ans_id:s,name:d,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(st,{width:"380px",panelClass:"cleanResultDialogBox",data:h,restoreFocus:!1}).afterClosed().subscribe(l=>{if(l&&l.result&&l.isRedirect){let p="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+h.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+h.classID+"/"+h.itemHomework.id+"/"+this.homeworkHashId,p)}})}remark(e,i,a){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let d={id:e,comment:a.comment,hideMark:a.hideMark?1:0,point:i?parseFloat(i.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(a)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,d).subscribe(h=>{1==h.success?(this.openDialog(!0,h.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId)}checkModeUiEditor(){let i=(document.getElementById("mark-general-box")?.offsetHeight??0)-80-40-140-40-30;this.initDataEditor=this.sAztTinyMceService.initConfigTeacherHomework(i)}setPoint(e){this.pointExercise=this.commonService.myClone(e),this.checkInputActive=!0}setPointInput(e){if(e.target){this.checkInputActive=!0;let i=e.target.value;this.pointExercise.value=i,this.pointExercise.name=i}}getListPointDefault(){this.listPointAzt=[{value:1e3,name:"\u0110"},{value:1001,name:"C\u0110"},{value:2e3,name:"HT"},{value:2001,name:"CHT"},{value:3e3,name:"HTT"}]}getMarkData(e){e.checkChangeMark&&(this.markData=e,this.checkInputActive||(this.pointExercise.value=isNaN(this.markData.pointRaw??0)?"":this.markData.pointRaw,this.pointExercise.name=this.pointExercise.value?.toString()))}ngOnInit(){this.isMobileDevice||(document.body.style.overflowY="hidden"),this.getListPointDefault();const e=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),i=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),a=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let s=this.commonService.getMyQueryParam("backto");this.backToLink=s?s.includes("shareType")?decodeURIComponent(s):s:"",e?(this.getData(e),this.getHistoryObjs(e)):this.getStudentObj(i),a&&this.getDataHistory(a),this.checkModeUiEditor(),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}getSizeMarkEditor(e){this.sizeMarkEditor=e}changeSizeMarkGeneral(){let e=document.getElementById("mark-general"),i=document.getElementById("mark-general-box");i&&e&&(i.style.width=e.offsetWidth.toString()+"px")}uploadDrawBase64ToCdn(){return new Promise(e=>{let i=[];if(this.objectResult.pages){this.objectResult.pages.forEach(a=>{i.push(!1)});for(let a=0;a<this.objectResult.pages.length;a++)if(this.objectResult.pages[a]&&this.objectResult.pages[a].draws?.length)for(let s=0;s<(this.objectResult.pages[a].draws?.length??0);s++){let d=this.objectResult.pages[a].draws?.[s]??{};if(d.src&&d.src.includes("base64")){i[a]=!0;let h=(0,Y.q)(d.src);this.apiUploadService.commonUploadForMarkResult(h,`essay_note_${a}_${s}_${this.answerId}.png`,"image/png").subscribe(g=>{g.type!=X.hv.UploadProgress&&(d.src=g.data?.url,i[a]=!1),i.includes(!0)||e()})}}}})}saveDataMarkExercise(){var e=this;return(0,Ut.A)(function*(){if(e.loadingSaveData=!0,""==e.historyId)if(1==e.permissionService.hasMarkPointPermission("homework",e.homeworkObj)){if(!e.MarkNote)return;e.objectResult=e.MarkNote?.exportDataMarkNote();let i=!1;if(!e.objectResult.pages?.length&&!e.hasAttachmentFile)return e.loadingSaveData=!1,void e.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_vui_long_thu_lai");if(e.hasAttachmentFile&&!e.objectResult.pages?.length){let a={point:e.pointExercise.value?.toString(),urlDataMark:"",version:"0.1",comment:e.commentExercise,hideMark:!e.showPoint};e.remark(e.answerId,a.point??"0",a)}if(e.objectResult.pages?.length){for(let g=0;g<e.objectResult.pages.length;g++)if(e.objectResult.pages[g]&&e.objectResult.pages[g].draws?.length)for(let l=0;l<(e.objectResult.pages[g].draws?.length??0);l++){let p=e.objectResult.pages[g].draws?.[l]??{};p.src&&p.src.includes("base64")&&(i=!0)}i&&(yield e.uploadDrawBase64ToCdn());const a=e.serializeJson(e.objectResult),s=e.zipDataService.convertContentGzip(a),d=new Blob([s],{type:"text/plain"}),h=new File([d],"txt",{type:"text/plain"});e.apiUploadService.uploadToCdnForHomework(h).subscribe(g=>{if(1==g.success){let l=g.data?.url??"",p={point:e.pointExercise.value?.toString(),urlDataMark:l,version:"0.1",comment:e.commentExercise,hideMark:!e.showPoint};e.remark(e.answerId,p.point??"0",p)}else e.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");e.loadingSaveData=!1})}}else e.showErrorSnack("lang_cms_no_permission_on_homework"),e.stopStatusObj();else e.stopStatusObj(),e.showErrorSnack("lang_cms_cannot_remark_student_history_result")})()}ngAfterViewInit(){this.changeSizeMarkGeneral()}constructor(e,i,a,s,d,h,g,l,p){super(),this.sAztTinyMceService=e,this.activeRoute=i,this.answerService=a,this.permissionService=s,this.sAztDialogService=d,this.cdnService=h,this.zipDataService=g,this.apiUploadService=l,this.vcRef=p,this.tinyEditorKey=M.c.tinyEditorKey,this.answerId=0,this.homeworkID="",this.historyId="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.initDataEditor={},this.color="#000",this.dataMarkNote={},this.loadingSaveData=!1,this.loadingDataCdn=!0,this.listPointAzt=[],this.pointExercise={value:0,name:""},this.markData={},this.commentExercise="",this.showPoint=!0,this.sizeMarkEditor={width:200,height:800},this.checkInputActive=!1,this.objectResult={},this.hasAttachmentFile=!1,this.handleIframe=k=>{"MNoteJson"==k.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=k.data.data,this.uploadAll(this.mnoteJsonData.pages??[],k.data.data.point)),"MNoteReSubmit"==k.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==k.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId&&this.sendDataToMarkNote()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){document.body.style.overflowY="auto",window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(Z.f),t.rXU(v.nX),t.rXU(N._t),t.rXU(ot.p),t.rXU(H.i),t.rXU(rt.B),t.rXU(B.j),t.rXU(ct.T),t.rXU(t.c1b))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-mark-exercise-new"]],viewQuery:function(i,a){if(1&i&&t.GBs(Yt,5),2&i){let s;t.mGM(s=t.lsd())&&(a.MarkNote=s.first)}},hostBindings:function(i,a){1&i&&t.bIt("resize",function(d){return a.onResize(d)},!1,t.tSv)},features:[t.Vt3],decls:53,vars:41,consts:[[1,"content",2,"padding","0 12px"],[1,"grid","grid-cols-12","gap-3","mt-3"],[1,"col-span-12","md:col-span-8","mark-editor",3,"ngStyle"],[4,"ngIf"],["class","w-full",4,"ngIf"],["id","mark-general",1,"col-span-12","md:col-span-4","mark-general"],["id","mark-general-box",1,"box"],[1,"p-2"],[1,"box-head"],[1,"font-medium"],[1,"flex","items-center","mt-2"],[1,"info-student","flex","items-center"],[3,"nameCreateAvatar","size"],[1,"info","ml-2"],[1,"text-md"],[1,"text-xs"],[1,"score","ml-auto","flex","items-center"],["appOnlyNumber","","type","text","id","azt-score",1,"form-control","text-danger","font-medium",3,"decimal","max","value","placeholder","input"],[1,"bg-slate-200","dark:bg-darkmode-400","p-2","text-center","rounded","mt-3"],[4,"ngIf","ngIfElse"],["notMark",""],[1,"choose-score","mt-3"],[1,"score-list-one","grid","grid-cols-10","gap-3"],["class","score-item col-span-2",4,"ngFor","ngForOf"],[1,"comment","mt-3"],[1,"font-medium","text-md"],[1,"comment-editor","mt-2"],[3,"apiKey","ngModel","init","ngModelChange"],[1,"flex","items-center","mt-3"],[1,"form-check","form-switch"],["id","show-score","type","checkbox",1,"form-check-input","mr-2",3,"ngModel","ngModelChange"],["for","show-score",1,"form-check-label","ml-0"],[1,"ml-auto"],["azt-track-service","mark-exercise-new-yWLPF_cK9E",1,"btn","btn-pending",3,"disabled","click"],[1,"grid","grid-cols-2","gap-3","mt-3"],["azt-track-service","mark-exercise-new-xgpK5bMM5y",1,"btn","btn-secondary",3,"click"],["azt-track-service","mark-exercise-new-lNij5J4UCD",1,"btn","btn-primary",3,"disabled","click"],["class","mr-1",4,"ngIf"],[3,"dataMarkNote","showBackLink","markedByObj","historyAnswerObjs","handleBackLink","doneLoadData","markData","getIdHistory"],["aztMarkNote",""],[1,"w-full"],["azt-track-service","mark-exercise-new-KdZ2FWuCn",1,"btn","btn-transparent",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-5","h-5"],["points","15 18 9 12 15 6"],[1,"azt-hidden","sm:block"],[1,"text-center","mx-auto"],["width","87","height","102","viewBox","0 0 87 102","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M66.6719 13.9999L75.9738 81.8427L76.8095 88.649C77.0787 90.8417 75.5194 92.8374 73.3268 93.1066L14.7665 100.297C12.5739 100.566 10.5781 99.0069 10.3089 96.8142L1.29312 23.3867C1.1585 22.2904 1.93813 21.2925 3.03447 21.1579C3.0414 21.157 3.04832 21.1562 3.05526 21.1554L7.91363 20.6104M11.8422 20.1698L16.4292 19.6552L11.8422 20.1698Z","fill","white"],["d","M67.9103 13.8302C67.8165 13.1462 67.186 12.6678 66.5021 12.7615C65.8181 12.8553 65.3397 13.4858 65.4335 14.1697L67.9103 13.8302ZM75.9738 81.8427L77.2144 81.6903C77.2137 81.6845 77.213 81.6787 77.2122 81.6729L75.9738 81.8427ZM76.8095 88.649L78.0502 88.4967L76.8095 88.649ZM73.3268 93.1066L73.4791 94.3473L73.3268 93.1066ZM14.7665 100.297L14.9189 101.538L14.7665 100.297ZM10.3089 96.8142L11.5496 96.6619L10.3089 96.8142ZM3.05526 21.1554L3.1946 22.3976L3.05526 21.1554ZM8.05297 21.8527C8.73902 21.7757 9.23279 21.1572 9.15583 20.4711C9.07888 19.7851 8.46034 19.2913 7.77428 19.3682L8.05297 21.8527ZM11.7028 18.9276C11.0168 19.0045 10.523 19.6231 10.5999 20.3091C10.6769 20.9952 11.2954 21.4889 11.9815 21.412L11.7028 18.9276ZM16.5685 20.8974C17.2546 20.8205 17.7484 20.2019 17.6714 19.5159C17.5945 18.8298 16.9759 18.3361 16.2899 18.413L16.5685 20.8974ZM65.4335 14.1697L74.7353 82.0125L77.2122 81.6729L67.9103 13.8302L65.4335 14.1697ZM74.7331 81.995L75.5688 88.8013L78.0502 88.4967L77.2144 81.6903L74.7331 81.995ZM75.5688 88.8013C75.7539 90.3088 74.6819 91.6809 73.1744 91.866L73.4791 94.3473C76.357 93.994 78.4035 91.3745 78.0502 88.4967L75.5688 88.8013ZM73.1744 91.866L14.6142 99.0563L14.9189 101.538L73.4791 94.3473L73.1744 91.866ZM14.6142 99.0563C13.1067 99.2414 11.7347 98.1694 11.5496 96.6619L9.0682 96.9666C9.42156 99.8445 12.041 101.891 14.9189 101.538L14.6142 99.0563ZM11.5496 96.6619L2.5338 23.2344L0.0524334 23.539L9.0682 96.9666L11.5496 96.6619ZM2.5338 23.2344C2.48332 22.8232 2.77568 22.449 3.18681 22.3986L2.88213 19.9172C1.10059 20.1359 -0.166313 21.7575 0.0524334 23.539L2.5338 23.2344ZM3.18681 22.3986C3.1894 22.3982 3.192 22.3979 3.1946 22.3976L2.91592 19.9132C2.90465 19.9145 2.89339 19.9158 2.88213 19.9172L3.18681 22.3986ZM3.1946 22.3976L8.05297 21.8527L7.77428 19.3682L2.91592 19.9132L3.1946 22.3976ZM11.9815 21.412L16.5685 20.8974L16.2899 18.413L11.7028 18.9276L11.9815 21.412Z","fill","#1F64E7"],["fill-rule","evenodd","clip-rule","evenodd","d","M64.14 18.2692L72.5596 79.7529L73.3169 85.9212C73.5609 87.9083 72.1669 89.7146 70.2033 89.9557L17.7613 96.3948C15.7978 96.6359 14.0082 95.2204 13.7642 93.2333L5.61416 26.8568C5.47955 25.7605 6.25918 24.7626 7.35551 24.628L13.8431 23.8314","fill","#E8F0FE"],["d","M20.9219 4C20.9219 2.48122 22.1531 1.25 23.6719 1.25H69.2286C69.9577 1.25 70.6569 1.5395 71.1726 2.05485L84.6158 15.4898C85.1319 16.0056 85.4219 16.7053 85.4219 17.4349V80C85.4219 81.5188 84.1907 82.75 82.6719 82.75H23.6719C22.1531 82.75 20.9219 81.5188 20.9219 80V4Z","fill","white","stroke","#1F64E7","stroke-width","2.5"],["d","M69.6719 2.40283V14C69.6719 15.6569 71.015 17 72.6719 17H80.6055","stroke","#1F64E7","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["d","M31 17H57M31 29H74M31 42H74M31 55H74M31 68H57","stroke","#75A4FE","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],[1,"font-medium","mt-5"],[1,"score-item","col-span-2"],["azt-track-service","mark-exercise-new-YBVZ7xc_A",1,"border","border-slate-200","dark:border-darkmode-400","btn-score","btn",3,"click"],[1,"mr-1"]],template:function(i,a){if(1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.DNE(3,Kt,3,4,"ng-container",3),t.DNE(4,Wt,18,6,"div",4),t.k0s(),t.j41(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"h3",9),t.EFF(10),t.k0s(),t.j41(11,"div",10)(12,"div",11),t.nrm(13,"azt-create-avatar",12),t.j41(14,"div",13)(15,"p",14),t.EFF(16),t.k0s(),t.j41(17,"p",15),t.EFF(18),t.k0s()()(),t.j41(19,"div",16)(20,"input",17),t.bIt("input",function(d){return a.setPointInput(d)}),t.nI1(21,"mytranslate"),t.k0s()()()(),t.j41(22,"div",18),t.DNE(23,Zt,4,8,"span",19),t.DNE(24,Qt,3,3,"ng-template",null,20,t.C5r),t.k0s(),t.j41(26,"div",21)(27,"div",22),t.DNE(28,qt,3,1,"div",23),t.k0s()(),t.j41(29,"div",24)(30,"p",25),t.EFF(31),t.nI1(32,"mytranslate"),t.k0s(),t.j41(33,"div",26)(34,"editor",27),t.bIt("ngModelChange",function(d){return a.commentExercise=d}),t.k0s()()(),t.j41(35,"div",28)(36,"div",29)(37,"input",30),t.bIt("ngModelChange",function(d){return a.showPoint=d}),t.k0s(),t.j41(38,"label",31),t.EFF(39),t.nI1(40,"mytranslate"),t.k0s()(),t.j41(41,"div",32)(42,"button",33),t.bIt("click",function(){return a.handleOpenReSubmit()}),t.EFF(43),t.nI1(44,"mytranslate"),t.k0s()()(),t.j41(45,"div",34)(46,"button",35),t.bIt("click",function(){return a.goBack()}),t.EFF(47),t.nI1(48,"mytranslate"),t.k0s(),t.j41(49,"button",36),t.bIt("click",function(){return a.saveDataMarkExercise()}),t.DNE(50,te,1,0,"azt-loading-ui",37),t.EFF(51),t.nI1(52,"mytranslate"),t.k0s()()()()()()()),2&i){const s=t.sdS(25);t.R7$(2),t.Y8G("ngStyle",t.eq3(39,ee,a.sizeMarkEditor.height+"px")),t.R7$(1),t.Y8G("ngIf",a.dataMarkNote.answer_obj),t.R7$(1),t.Y8G("ngIf",!a.dataMarkNote||!a.dataMarkNote.answer_obj),t.R7$(6),t.SpI(" ",null==a.homeworkObj?null:a.homeworkObj.name," "),t.R7$(3),t.Y8G("nameCreateAvatar",null==a.studentObj?null:a.studentObj.fullName)("size",35),t.R7$(3),t.SpI(" ",null==a.studentObj?null:a.studentObj.fullName," "),t.R7$(2),t.SpI(" ",null==a.classroomObj?null:a.classroomObj.name," "),t.R7$(2),t.FS9("placeholder",t.bMT(21,27,"lang_auto_nhap_diem")),t.Y8G("decimal",!0)("max",999)("value",a.pointExercise.name),t.R7$(3),t.Y8G("ngIf",a.markData.totalRight||a.markData.totalWrong)("ngIfElse",s),t.R7$(5),t.Y8G("ngForOf",a.listPointAzt),t.R7$(3),t.SpI(" ",t.bMT(32,29,"lang_auto_nhan_xet")," "),t.R7$(3),t.FS9("apiKey",a.tinyEditorKey),t.Y8G("ngModel",a.commentExercise)("init",a.initDataEditor),t.R7$(3),t.Y8G("ngModel",a.showPoint),t.R7$(2),t.SpI(" ",t.bMT(40,31,"lang_auto_hien_thi_diem")," "),t.R7$(3),t.Y8G("disabled",""!==a.historyId),t.R7$(1),t.SpI(" ",t.bMT(44,33,"lang_auto_yeu_cau_nop_lai")," "),t.R7$(4),t.SpI(" ",t.bMT(48,35,"lang_auto_quay_lai")," "),t.R7$(2),t.Y8G("disabled",a.loadingSaveData||""!==a.historyId||""==a.pointExercise.name||a.loadingDataCdn),t.R7$(1),t.Y8G("ngIf",a.loadingSaveData),t.R7$(1),t.SpI(" ",t.bMT(52,37,"lang_auto_luu_du_lieu")," ")}},dependencies:[w.Sq,w.bT,w.B3,o.xn,c.Zm,c.BC,c.vS,lt.p,Jt.Z,at.R,Xt.i,E.wp],styles:[".btn-score[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.btn-score[_ngcontent-%COMP%]:hover{background:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}.choose-score[_ngcontent-%COMP%]{max-width:80%;margin-left:auto;margin-right:auto}.toolbar-list[_ngcontent-%COMP%]{width:100%;padding:5px;position:absolute;top:0;left:0;display:flex;align-items:center;border-bottom-left-radius:0;border-bottom-right-radius:0}.btn-icon[_ngcontent-%COMP%]{padding:10px;min-width:auto;line-height:initial}.toolbar-item[_ngcontent-%COMP%]{margin:0 3px}.toolbar-item[_ngcontent-%COMP%]:first-child{margin-left:0}.btn-icon-child[_ngcontent-%COMP%]{padding:5px}.azt-toolbar-active[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}  .dark .azt-toolbar-active{--tw-bg-opacity: 1;background-color:rgb(var(--color-darkmode-200)/var(--tw-bg-opacity))}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}@media screen and (max-width: 768px){.choose-score[_ngcontent-%COMP%]{max-width:80%}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}.content[_ngcontent-%COMP%]{margin-bottom:100px}}#mark-general-box[_ngcontent-%COMP%]{height:calc(100vh - 24px);overflow:auto}@media screen and (max-width: 768px){#mark-general-box[_ngcontent-%COMP%]{position:relative;min-height:100vh;height:auto;overflow:hidden}}"]})}return n})();var mt=r(55465),dt=r(17818),ae=r(47712);function se(n,y){if(1&n&&(t.j41(0,"button",15),t.nI1(1,"mytranslate"),t.j41(2,"mat-icon"),t.EFF(3,"history"),t.k0s()()),2&n){t.XpG();const e=t.sdS(8);t.FS9("matTooltip",t.bMT(1,2,"lang_homework_mark_exercise_history_submit")),t.Y8G("matMenuTriggerFor",e)}}function ne(n,y){if(1&n){const e=t.RV6();t.j41(0,"li")(1,"button",16),t.bIt("click",function(){const s=t.eBV(e).$implicit,d=t.XpG();return t.Njj(d.getDataHistory(s.id?s.id.toString():""))}),t.j41(2,"span"),t.EFF(3),t.nI1(4,"mytranslate"),t.nI1(5,"formatFullDateTimeWithoutSecondByUserUnitPipe"),t.k0s()()()}if(2&n){const e=y.$implicit,i=y.index;t.R7$(3),t.E5c("",t.bMT(4,3,"lang_homework_mark_exercise_times")," ",i+1," - ",t.bMT(5,5,e.createdAt),"")}}function oe(n,y){if(1&n&&(t.j41(0,"span"),t.nrm(1,"azt-create-avatar",18),t.nI1(2,"mytranslate"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(1),t.Y8G("customTooltip",t.bMT(2,4,"lang_homework_mark_exercise_teacher_mark")+": "+(null==e.markedByObj?null:e.markedByObj.fullName))("nameCreateAvatar",null==e.markedByObj?null:e.markedByObj.fullName)("size",25)("linkAvatar",null==e.markedByObj?null:e.markedByObj.avatar)}}function re(n,y){if(1&n&&(t.j41(0,"h4",17),t.DNE(1,oe,3,6,"span",13),t.EFF(2),t.k0s()),2&n){const e=t.XpG();t.R7$(1),t.Y8G("ngIf",e.isMarked),t.R7$(1),t.Lme(" ",null==e.studentObj?null:e.studentObj.fullName,", ",e.classroomObj.name," ")}}function ce(n,y){if(1&n&&(t.nrm(0,"azt-loading-effect",19),t.nI1(1,"mytranslate")),2&n){const e=t.XpG();t.Y8G("currentStatusObj",e.statusObj)("customText",t.bMT(1,2,"lang_homework_mark_exercise_loading_data_mark"))}}function le(n,y){if(1&n&&(t.j41(0,"div")(1,"div",20)(2,"div",21)(3,"div",22),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()()()),2&n){const e=t.XpG();t.R7$(4),t.JRh(t.bMT(5,1,e.errorMessage))}}function me(n,y){if(1&n&&(t.j41(0,"div",23),t.nrm(1,"iframe",24),t.nI1(2,"safe"),t.k0s()),2&n){const e=t.XpG();t.R7$(1),t.Y8G("src",t.bMT(2,1,e.whiteListMNoteIframeSrc),t.f$h)}}let de=(()=>{class n extends P.H{onPopState(e){this.goBack()}uploadDrawBase64ToCDN(e,i,a){let s=(0,Y.q)(e);this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${i}_${this.answerId}.png`,"image/png").subscribe(d=>{d.type!=X.hv.UploadProgress&&(1==d.success?(this.mnoteJsonData.pages?.[i]&&(this.mnoteJsonData.pages[i].draw=d.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,a,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(e,i){this.pagesCount=0;for(let a=0;a<e.length;a++)e[a].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,i,this.mnoteJsonData);else for(let a=0;a<e.length;a++)e[a].draw&&this.uploadDrawBase64ToCDN(e[a].draw,a,i)}reloadPage(){location.reload()}sendDataToIframe(){const e=document.getElementById("mNote"),i=e?e.contentWindow:null;if(null!==i){let a=this.castObj(this.result.answerObj);if(null!=a){let l=this.commonService.willDeleteParseJson(a.result??"");if(null!=l){let k=l.pages?.length??0;for(let D=0;D<k;D++)l?.pages?.[D].backgroundImage&&(l.pages[D].backgroundImage=this.cdnService.getMyCdn(l.pages[D].backgroundImage??"")),l.pages?.[D].draw&&(l.pages[D].draw=this.cdnService.getMyCdn(l.pages[D].draw));l=JSON.stringify(l),a.result=l}let p=this.commonService.willDeleteParseJson(a.files??"");if(null!=p){for(let k=0;k<p.length;k++)p[k].url&&(p[k].url=this.cdnService.getMyCdn(p[k].url)),p[k].thumb&&(p[k].thumb=this.cdnService.getMyCdn(p[k].thumb));p=JSON.stringify(p),a.files=p}}let s=this.result.studentObj,d=this.result.classroomObj,h=this.result.homeworkObj,g=this.commonService.myParseJson(a?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let l=0;l<(this.jsonData.pages?.length??0);l++)this.jsonData.pages?.[l].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[l].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[l].backgroundImage??"")),this.jsonData.pages?.[l].hasOwnProperty("draw")&&(this.jsonData.pages[l].draw=this.cdnService.getMyCdn(this.jsonData.pages[l].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=a,this.jsonData.student_obj=s,this.jsonData.classroom_obj=d,this.jsonData.homework_obj=h,g&&g.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=g.hideMark),i.postMessage(this.jsonData,"*");else{let l=[];this.files.forEach(k=>{l.push({backgroundImage:k.url})});let p={cmd:"initMNote",mode:"edit",pages:l,answer_obj:a,student_obj:s,classroom_obj:d,homework_obj:h};g&&g.hasOwnProperty("hideMark")&&(p.hideMark=g.hideMark),i.postMessage(p,"*")}}}sendDataToIframeHistory(){const e=document.getElementById("mNote");e&&1==this.countLoad&&(e.src+="");const i=e?e.contentWindow:null;if(null!==i){let a=this.castObj(this.result.answerObj);if(null!=a){let l=this.commonService.willDeleteParseJson(a?.result??"");if(null!=l){for(let k=0;k<l.pages.length;k++)l.pages[k].backgroundImage&&(l.pages[k].backgroundImage=this.cdnService.getMyCdn(l.pages[k].backgroundImage)),l.pages[k].draw&&(l.pages[k].draw=this.cdnService.getMyCdn(l.pages[k].draw));l=JSON.stringify(l),a.result=l}let p=this.commonService.willDeleteParseJson(a.files??"");if(null!=p){for(let k=0;k<p.length;k++)p[k].url&&(p[k].url=this.cdnService.getMyCdn(p[k].url)),p[k].thumb&&(p[k].thumb=this.cdnService.getMyCdn(p[k].thumb));p=JSON.stringify(p),a.files=p}}let s=this.studentObj,d=this.classroomObj,h=this.homeworkObj,g=this.commonService.willDeleteParseJson(a?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let l=0;l<(this.jsonData.pages?.length??0);l++)this.jsonData.pages?.[l].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[l].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[l].backgroundImage??"")),this.jsonData.pages?.[l].hasOwnProperty("draw")&&(this.jsonData.pages[l].draw=this.cdnService.getMyCdn(this.jsonData.pages[l].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="view",this.jsonData.answer_obj=a,this.jsonData.student_obj=s,this.jsonData.classroom_obj=d,this.jsonData.homework_obj=h,g&&g.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=g.hideMark),i.postMessage(this.jsonData,"*");else{let l=[];this.files.forEach(k=>{l.push({backgroundImage:k.url})});let p={cmd:"initMNote",mode:"view",pages:l,answer_obj:a,student_obj:s,classroom_obj:d,homework_obj:h};g&&g.hasOwnProperty("hideMark")&&(p.hideMark=g.hideMark),i.postMessage(p,"*")}}}getHistoryObjs(e){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,e).subscribe(i=>{1==i.success?this.historyAnswerObjs=i.data?.objs??new Array:this.errorMessage=i.message??"",this.stopStatusObj()})}getDataHistory(e){this.historyId=e,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(e,10)).subscribe(i=>{if(1==i.success){if(i.data){if(this.zipDataService.convertSubmittedAnswersHistoryObj(i.data?.answerObj),this.result=i.data,this.markedByObj=i.data?.markedByObj,this.score=i.data?.answerObj?.point??0,this.files=this.commonService.myParseJson(i.data?.answerObj?.files??"")??[],null!=this.files)for(let a=0;a<this.files.length;a++)this.files[a].url=this.cdnService.getMyCdn(this.files?.[a].url??""),this.files[a].thumb=this.cdnService.getMyCdn(this.files?.[a].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,1==this.countLoad&&(this.hasSendDataToIframe=!1),0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframeHistory())}this.successStatusObj(),this.countLoad++}else this.errorMessage=i.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var e=this.commonService.myParseJson(this.result.answerObj?.result??"");e&&(this.jsonData=e,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(e){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,e).subscribe(i=>{1==i.success&&i.data?(this.studentObj=i.data.studentObj,this.errorMessage="lang_auto_chua_nop_bai",this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(e){this.initStatusObj(),this.errorMessage="",this.answerId=e,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(i=>{if(1==i.success)if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),i.data?.hasOwnProperty("studentObj")&&null!=i.data?.studentObj){if(this.result=i.data,this.markedByObj=i.data.markedByObj,this.score=i.data?.answerObj?.point??0,this.homeworkID=i.data.homeworkObj?.id??0,this.classID=i.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(i.data.answerObj?.files??"")??[],this.studentObj=i.data.studentObj,this.classroomObj=i.data.classroomObj??{},null!=this.files)for(let a=0;a<this.files.length;a++)this.files[a].url=this.cdnService.getMyCdn(this.files?.[a].url??""),this.files[a].thumb=this.cdnService.getMyCdn(this.files?.[a].thumb??"");this.homeworkObj=i.data.homeworkObj??{},this.studentName=i.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframe()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=i.message??"",this.stopStatusObj()})}openDialog(e,i){this.sAztDialogService.open(nt,{width:"280px",autoFocus:!1,data:{score:i,status:e,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){null!=this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(e,i,a,s,d){let h={status:e,deadline:i,itemHomework:a,ans_id:s,name:d,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(st,{width:"380px",panelClass:"cleanResultDialogBox",data:h,restoreFocus:!1}).afterClosed().subscribe(l=>{if(l&&l.result&&l.isRedirect){let p="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+h.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+h.classID+"/"+h.itemHomework.id+"/"+this.homeworkHashId,p)}})}remark(e,i,a){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let d={id:e,comment:a.comment,hideMark:a.hideMark?1:0,point:i?parseFloat(i.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(a)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,d).subscribe(h=>{1==h.success?(this.openDialog(!0,h.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId);let e=document.body,i=document.getElementById("azota-app-html");i?.classList.remove("overflow-hidden"),i?.classList.remove("height-100"),e.classList.remove("overflow-hidden"),e.classList.remove("height-100")}ngOnInit(){let e=document.body,i=document.getElementById("azota-app-html");i?.classList.add("overflow-hidden"),i?.classList.add("height-100"),e.classList.add("overflow-hidden"),e.classList.add("height-100"),this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";const a=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),s=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),d=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let h=this.commonService.getMyQueryParam("backto");this.backToLink=h?h.includes("shareType")?decodeURIComponent(h):h:"",a?(this.getData(a),this.getHistoryObjs(a)):this.getStudentObj(s),d&&this.getDataHistory(d),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(e,i,a,s,d,h,g,l){super(),this.activeRoute=e,this.answerService=i,this.permissionService=a,this.sAztDialogService=s,this.cdnService=d,this.zipDataService=h,this.envService=g,this.apiUploadService=l,this.answerId=0,this.homeworkID="",this.historyId="",this.whiteListMNoteIframeSrc="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.handleIframe=p=>{"MNoteJson"==p.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=p.data.data,this.uploadAll(this.mnoteJsonData.pages??[],p.data.data.point)),"MNoteReSubmit"==p.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==p.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId?this.sendDataToIframe():this.sendDataToIframeHistory()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(v.nX),t.rXU(N._t),t.rXU(ot.p),t.rXU(H.i),t.rXU(rt.B),t.rXU(B.j),t.rXU(mt.t),t.rXU(ct.T))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-mark-exericse"]],hostBindings:function(i,a){1&i&&t.bIt("popstate",function(d){return a.onPopState(d)},!1,t.tSv)},features:[t.Vt3],decls:22,vars:13,consts:[["id","markContainer",1,"maxW1000"],["id","titleRow"],[1,"block-left"],["azt-track-service","mark-exercise-bqS4xx4zrp","mat-button","",3,"title","click"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],[1,"dropdown-menu","w-56","show","relative"],[1,"dropdown-content"],["azt-track-service","mark-exercise-7krhNQm3da",1,"dropdown-item","w-full",3,"click"],[4,"ngFor","ngForOf"],["class","studentInfo","style","padding-right: 10px; color: #fff",4,"ngIf"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"hidden"],[4,"ngIf"],["class","card-box listPhotos",4,"ngIf"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor"],["azt-track-service","mark-exercise-5mJpoIUV_A",1,"dropdown-item","w-full",3,"click"],[1,"studentInfo",2,"padding-right","10px","color","#fff"],[2,"cursor","pointer",3,"customTooltip","nameCreateAvatar","size","linkAvatar"],[3,"currentStatusObj","customText"],[1,"row","justify-content-center","py-5"],[1,"col-12","text-center"],[1,"alert","alert-danger"],[1,"card-box","listPhotos"],["id","mNote","frameborder","0",2,"width","100%","height","100%",3,"src"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),t.bIt("click",function(){return a.goBack()}),t.nI1(4,"mytranslate"),t.EFF(5,"keyboard_arrow_left"),t.k0s(),t.DNE(6,se,4,4,"button",4),t.j41(7,"mat-menu",null,5)(9,"div",6)(10,"ul",7)(11,"li")(12,"button",8),t.bIt("click",function(){return a.reloadPage()}),t.j41(13,"span"),t.EFF(14),t.nI1(15,"mytranslate"),t.k0s()()(),t.DNE(16,ne,6,7,"li",9),t.k0s()()()(),t.DNE(17,re,3,3,"h4",10),t.k0s(),t.DNE(18,ce,2,4,"azt-loading-effect",11),t.j41(19,"div",12),t.DNE(20,le,6,3,"div",13),t.DNE(21,me,3,3,"div",14),t.k0s()()),2&i&&(t.R7$(3),t.FS9("title",t.bMT(4,9,"lang_button_back")),t.R7$(3),t.Y8G("ngIf",null!=a.historyAnswerObjs&&a.historyAnswerObjs.length>0),t.R7$(8),t.JRh(t.bMT(15,11,"lang_homework_mark_exercise_last")),t.R7$(2),t.Y8G("ngForOf",a.historyAnswerObjs),t.R7$(1),t.Y8G("ngIf",a.classroomObj),t.R7$(1),t.Y8G("ngIf",a.statusObj.loading),t.R7$(1),t.Y8G("hidden",a.statusObj.loading),t.R7$(1),t.Y8G("ngIf",""!=a.errorMessage),t.R7$(1),t.Y8G("ngIf",""==a.errorMessage))},dependencies:[w.Sq,w.bT,Q.iY,J.An,dt.kk,dt.Cp,ae.oV,U.K,lt.p,E.wp,E.JI,E.bH],styles:["#markContainer[_ngcontent-%COMP%]{position:relative}  .studentInfo img{display:inline-flex!important}#titleRow[_ngcontent-%COMP%]{background-color:#00a7d0;height:40px;position:relative;align-items:center;display:flex;justify-content:space-between;color:#fff}#titleRow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}#titleRow[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:0;font-weight:500;font-size:16px;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;display:-webkit-box}#titleRow[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]{margin-right:5px}.block-left[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{border:none}.listPhotos[_ngcontent-%COMP%]{width:100%;position:fixed;top:40px;bottom:0}.file[_ngcontent-%COMP%]{border-width:0px;background:inherit;background-color:#f2f2f2;box-sizing:border-box;border-width:1px;border-style:solid;border-color:#e5e5e5;border-left:0px;border-right:0px;border-radius:0;box-shadow:none}.file[_ngcontent-%COMP%]:first-child{margin-top:52px}.file[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.back[_ngcontent-%COMP%]{padding:15px 10px}.back-to[_ngcontent-%COMP%]{color:#fff;display:flex}.back-to[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:10px}.block[_ngcontent-%COMP%]{padding-top:2px}.mat-expansion-indicator[_ngcontent-%COMP%]:after{color:#fff!important}.add-click[_ngcontent-%COMP%]{display:flex}.add-icon[_ngcontent-%COMP%]{margin-top:5px}.file-custom[_ngcontent-%COMP%]{margin-top:6px}.description__share[_ngcontent-%COMP%]{margin-top:10px}.description__share[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff;color:#666;margin-right:15px;padding:5px 10px 0}.row-check[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:10px 0}.col-check[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:5px}.exercise[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:25px 0 15px;border-bottom:1px solid #eee}.btn-custom[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff;border-radius:5px;padding:10px 25px}.files-custom[_ngcontent-%COMP%]{margin:0}.btn-share[_ngcontent-%COMP%]{border:1px solid #eee}.score-exercise[_ngcontent-%COMP%]{background-color:#ea3d19;border-radius:50%;padding:3px 5px 3px 7px;color:#fff;font-weight:600;margin:0 10px}#listNumber[_ngcontent-%COMP%]{display:contents}#markNumber[_ngcontent-%COMP%]{position:absolute;top:40px;right:50%;z-index:9;margin-right:-60px;color:#fff;text-transform:uppercase;width:120px}@media (min-width: 1000px){.mark-edit[_ngcontent-%COMP%]{width:250px}.file[_ngcontent-%COMP%]:first-child{margin-top:0}.listPhotos[_ngcontent-%COMP%]{width:1000px}}"]})}return n})();var he=r(91930);const ge=[{path:"",component:(()=>{class n extends P.H{ngOnInit(){super.ngOnInit()}constructor(e){super(),this.commonService=e}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(he.R))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["homework-master-page"]],features:[t.Vt3],decls:2,vars:0,consts:[["id","homework-layout"]],template:function(i,a){1&i&&(t.j41(0,"div",0),t.nrm(1,"router-outlet"),t.k0s())},dependencies:[v.n3],encapsulation:2})}return n})(),canActivate:[L.t],children:[{path:"add-new-homework/:cat_id",component:Ft},{path:"mark-exercise/:id/:hash_id/:studentId",component:de},{path:"switch-mark-exercise/:id/:hash_id/:studentId",component:(()=>{class n extends P.H{getData(e){this.initStatusObj(),this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(i=>{if(1==i.success)if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),null!=i.data?.studentObj){const a=i.data,s=this.envService.getVersionMarkNote(this.classliveUrl);a.answerObj?.result?(a.answerObj?.result??"").includes("urlDataMark")?this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(s>1e6?`/admin/homework/mark-exercise-new/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`:`/admin/homework/mark-exercise/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`),this.successStatusObj()}else this.stopStatusObj();else this.stopStatusObj()})}ngOnInit(){this.classliveUrl=this.envService.getEnvValue("classliveUrl")??"",this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";const e=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),i=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0);let a=this.commonService.getMyQueryParam("backto");this.backToLink=a?a.includes("shareType")?decodeURIComponent(a):a:"",e?this.getData(e):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/0/${this.homeworkHashId}/${i}`,`?backto=${encodeURIComponent(this.backToLink)}`),super.ngOnInit()}constructor(e,i,a,s){super(),this.activeRoute=e,this.answerService=i,this.zipDataService=a,this.envService=s,this.homeworkHashId="",this.backToLink="",this.classliveUrl=""}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(v.nX),t.rXU(N._t),t.rXU(B.j),t.rXU(mt.t))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-mark-exercise-new"]],features:[t.Vt3],decls:0,vars:0,template:function(i,a){},encapsulation:2})}return n})()},{path:"mark-exercise-new/:id/:hash_id/:studentId",component:ie},{path:"content-store",component:zt}]}];let fe=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.$C({type:n});static#i=this.\u0275inj=t.G2t({imports:[v.iI.forChild(ge),v.iI,G.XE]})}return n})(),be=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.$C({type:n});static#i=this.\u0275inj=t.G2t({providers:[{provide:o.vn,useValue:M.c.azt_tiny_mce_script_src}],imports:[f.Id,v.iI,w.MD,S.s,o.sv,fe,c.YN,c.X1,x.hM,u.L,b.Lk,j.Q,_.b,O.n,m.flO.pick(m.Ptg)]})}return n})()},7919:(R,I,r)=>{"use strict";r.d(I,{Z:()=>c});var w=r(26860);let c=(()=>{class x{constructor(o){this.el=o,this.hasDecimalPoint=!1,this.hasNegativeSign=!1,this.navigationKeys=["Backspace","Delete","Tab","Escape","Enter","Home","End","ArrowLeft","ArrowRight","Clear","Copy","Paste"],this.decimal=!1,this.decimalSeparator=".",this.decimalSeparator1=".",this.decimalSeparator2=",",this.allowNegatives=!1,this.allowPaste=!0,this.negativeSign="-",this.min=-1/0,this.max=1/0,this.regex=null,this.inputElement=o.nativeElement}ngOnChanges(o){if(o.pattern&&(this.regex=this.pattern?RegExp(this.pattern):null),o.min){const m=Number(this.min);this.min=isNaN(m)?-1/0:m}if(o.max){const m=Number(this.max);this.max=isNaN(m)?1/0:m}}onBeforeInput(o){if(isNaN(Number(o.data))){if(o.data===this.decimalSeparator1||o.data===this.decimalSeparator2||o.data===this.negativeSign&&this.allowNegatives)return;o.preventDefault(),o.stopPropagation()}}onKeyDown(o){if(this.navigationKeys.indexOf(o.key)>-1||("a"===o.key||"KeyA"===o.code)&&!0===o.ctrlKey||("c"===o.key||"KeyC"===o.code)&&!0===o.ctrlKey||("v"===o.key||"KeyV"===o.code)&&!0===o.ctrlKey||("x"===o.key||"KeyX"===o.code)&&!0===o.ctrlKey||("a"===o.key||"KeyA"===o.code)&&!0===o.metaKey||("c"===o.key||"KeyC"===o.code)&&!0===o.metaKey||("v"===o.key||"KeyV"===o.code)&&!0===o.metaKey||("x"===o.key||"KeyX"===o.code)&&!0===o.metaKey)return;let m="";var b=o.key;if(o.key===this.decimalSeparator2&&(b=this.decimalSeparator1),this.decimal&&b===this.decimalSeparator1)return m=this.forecastValue(b),m.split(this.decimalSeparator1).length>2||(this.hasDecimalPoint=m.indexOf(this.decimalSeparator1)>-1,this.setNewValue(b)),void o.preventDefault();if(b===this.negativeSign&&this.allowNegatives)return m=this.forecastValue(b),m.charAt(0)!==this.negativeSign||m.split(this.negativeSign).length>2?void o.preventDefault():void(this.hasNegativeSign=m.split(this.negativeSign).length>-1);if(" "===b||isNaN(Number(b)))return void o.preventDefault();if(m=m||this.forecastValue(b),this.regex&&!this.regex.test(m))return void o.preventDefault();const f=Number(m);(f>this.max||f<this.min)&&o.preventDefault()}onPaste(o){if(!0===this.allowPaste){let m="";window.clipboardData?m=window.clipboardData.getData("text"):o.clipboardData&&o.clipboardData.getData&&(m=o.clipboardData.getData("text/plain")),this.pasteData(m),o.preventDefault()}else o.preventDefault(),o.stopPropagation()}onDrop(o){const m=o.dataTransfer?.getData("text")??"";this.inputElement.focus(),this.pasteData(m),o.preventDefault()}pasteData(o){o=this.replaceDecimalSeparator(o);const m=this.sanitizeInput(o);if(!m.includes(this.negativeSign)||!this.hasNegativeSign||this.getSelection().includes(this.negativeSign)){if(!document.execCommand("insertText",!1,m))if(this.inputElement.setRangeText){const{selectionStart:f,selectionEnd:S}=this.inputElement;this.inputElement.setRangeText(m,f??0,S??0,"end"),typeof window.InstallTrigger<"u"&&this.inputElement.dispatchEvent(new Event("input",{cancelable:!0}))}else this.insertAtCursor(this.inputElement,m);this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}}setNewValue(o){o=this.replaceDecimalSeparator(o),this.insertAtCursor(this.inputElement,o),this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}insertAtCursor(o,m){const b=o.selectionStart??0,f=o.selectionEnd??0;o.value=o.value.substring(0,b)+m+o.value.substring(f,o.value.length);const S=b+m.length;o.focus(),o.setSelectionRange(S,S),this.triggerEvent(o,"input")}triggerEvent(o,m){if("createEvent"in document){const b=document.createEvent("HTMLEvents");b.initEvent(m,!1,!0),o.dispatchEvent(b)}}sanitizeInput(o){let b,m="";b=this.decimal&&this.isValidDecimal(o)?new RegExp(`${this.getNegativeSignRegExp()}[^0-9${this.decimalSeparator1}]`,"g"):new RegExp(`${this.getNegativeSignRegExp()}[^0-9]`,"g"),m=o.replace(b,"");const f=this.inputElement.maxLength;if(f>0){const S=f-this.inputElement.value.length+(m.includes(`${this.negativeSign}`)?1:0);m=S>0?m.substring(0,S):""}return m}getNegativeSignRegExp(){return!this.allowNegatives||this.hasNegativeSign&&!this.getSelection().includes(this.negativeSign)?"":`(?!^${this.negativeSign})`}isValidDecimal(o){if(this.hasDecimalPoint){const m=this.getSelection();return m&&m.indexOf(this.decimalSeparator1)>-1?o.split(this.decimalSeparator1).length<=2:o.indexOf(this.decimalSeparator1)<0}return o.split(this.decimalSeparator1).length<=2}getSelection(){return this.inputElement.value.substring(this.inputElement.selectionStart??0,this.inputElement.selectionEnd??0)}forecastValue(o){const b=this.inputElement.selectionEnd??0,f=this.inputElement.value;return f.substring(0,this.inputElement.selectionStart??0)+o+f.substring(b)}replaceDecimalSeparator(o){return o.replace(",",this.decimalSeparator).replace(".",this.decimalSeparator)}static#t=this.\u0275fac=function(m){return new(m||x)(w.rXU(w.aKT))};static#e=this.\u0275dir=w.FsC({type:x,selectors:[["","appOnlyNumber",""]],hostBindings:function(m,b){1&m&&w.bIt("beforeinput",function(S){return b.onBeforeInput(S)})("keydown",function(S){return b.onKeyDown(S)})("paste",function(S){return b.onPaste(S)})("drop",function(S){return b.onDrop(S)})},inputs:{decimal:"decimal",decimalSeparator:"decimalSeparator",decimalSeparator1:"decimalSeparator1",decimalSeparator2:"decimalSeparator2",allowNegatives:"allowNegatives",allowPaste:"allowPaste",negativeSign:"negativeSign",min:"min",max:"max",pattern:"pattern"},features:[w.OA$]})}return x})()},40111:(R,I,r)=>{"use strict";r.d(I,{k:()=>o});var w=r(64198),c=r(73202),x=r(26860),v=r(91930);let o=(()=>{class m{getMineTypeByFileType(f){let u="";switch(this.commonService.getEnumTypeWithDefault(c.d,f,c.d.unknown)){case c.d.doc:case c.d.docx:u="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case c.d.ppt:case c.d.pptx:u="application/vnd.openxmlformats-officedocument.presentationml.presentation";break;case c.d.xlsx:u="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";break;case c.d.pdf:u="application/pdf";break;case c.d.video:case c.d.mp4:u="video/mp4";break;case c.d.mov:u="video/mov";break;case c.d.webm:u="video/webm";break;case c.d.quicktime:u="video/quicktime";break;case c.d.audio:u="audio/mpeg";break;case c.d.mp3:u="audio/mp3";break;case c.d.wav:u="audio/wav";break;case c.d.jpeg:case c.d.image:u="image/jpeg";break;case c.d.google_docs:u="google_docs"}return u}getMineTypeByExtension(f){switch(new RegExp(/(?:\.([^.]+))?$/).exec(f)?.[1]){case"pdf":return"application/pdf";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xsl":case"csv":return"application/vnd.ms-excel";case"jpg":return"image/jpg";case"jpge":return"image/jpge";default:return"application/json-patch+json"}}getTypeFileByMime(f){return f.mimes&&(0,w.I7)(f.mimes)||f.name?.toLowerCase().endsWith(".azt")?c.d.docx:f.mimes&&(0,w.nL)(f.mimes)?c.d.xlsx:f.mimes&&(0,w.JK)(f.mimes)?c.d.audio:f.mimes&&(0,w.cZ)(f.mimes)?c.d.video:f.mimes&&(0,w.wu)(f.mimes)?c.d.image:f.mimes&&(0,w.Ev)(f.mimes)?c.d.pdf:f.mimes&&(0,w.rl)(f.mimes)?c.d.powerpoint:void 0}constructor(f){this.commonService=f}static#t=this.\u0275fac=function(S){return new(S||m)(x.KVO(v.R))};static#e=this.\u0275prov=x.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()},10296:(R,I,r)=>{"use strict";r.d(I,{R:()=>b});var w=r(43277),x=r(18148),v=r(26860),o=r(18350),m=r(91930);let b=(()=>{class f{constructor(u,_){this.mobileWebviewService=u,this.commonService=_}shareFileWithBlob(u,_){if(this.commonService.isMobileWebview(void 0)){x.L.openLoadingEffect(this.commonService.myTranslateInstant("lang_auto_dang_lay_du_lieu_tu_he_thong")??"");let O=new FileReader;O.readAsDataURL(u),O.onloadend=()=>{let j=O.result;"string"==typeof j&&(this.mobileWebviewService.sendShareFileBase64(_,String(j)),x.L.closeLoadingEffect(100))}}else w.saveAs(u,_)}shareFileWithBase64(u,_){this.commonService.isMobileWebview(void 0)?this.mobileWebviewService.sendShareFileBase64(_,u):w.saveAs(u,_)}static#t=this.\u0275fac=function(_){return new(_||f)(v.KVO(o.f),v.KVO(m.R))};static#e=this.\u0275prov=v.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},18148:(R,I,r)=>{"use strict";r.d(I,{L:()=>w});let w=(()=>{class c{static#t=this.idComponent="azt-status-loading-effect";static#e=this.idStatusContent="azt-status-loading-effect-content";static openLoadingEffect(v){c.getDomElement().style.display="flex",setTimeout(()=>{c.changeMsgLoadingEffect(v)},50)}static closeLoadingEffect(v){return new Promise(o=>{setTimeout(()=>{const m=c.getDomElement();m&&(m.style.display="none"),o(!0)},v)})}static changeMsgLoadingEffect(v){c.getDomContent().innerText=v}static getDomContent(){return document.getElementById(c.idStatusContent)??document.createElement("span")}static getDomElement(){return document.getElementById(c.idComponent)??this.createDomElement()}static createDomElement(){const v=document.createElement("div");return v.id=c.idComponent,v.setAttribute("style","position: fixed;display: flex;width: 100vw;height: 100%;background: #000000c7;color: #ffffff;font-size: 20px;font-weight: lighter;justify-content: center;align-items: center;cursor: progress;z-index: 9999;top: 0;left: 0;"),v.style.display="none",v.innerHTML=`\n        <div class="text-center" style="height: 85%; overflow-x: auto;">\n            <div class="flex justify-center mt-5">\n                <svg width="20" viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">\n                    <g fill="none" fill-rule="evenodd">\n                        <g transform="translate(2 1)" stroke="currentColor" stroke-width="1.5">\n                            <circle cx="42.601" cy="11.462" r="5" fill-opacity="1" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="1;0;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="49.063" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;1;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="42.601" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;1;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="49.125" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;1;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;1;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="4.938" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;1;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="11.462" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;1;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="5" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;0;1" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                        </g>\n                    </g>\n                </svg>\n            </div>\n            <div style="margin-top: 10px;position: relative;">\n                <span id="${c.idStatusContent}"></span>\n            </div>\n        </div>`,document.body.appendChild(v),v}}return c})()},43277:function(R,I){var r,c;void 0!==(c="function"==typeof(r=function(){"use strict";function v(u,_,O){var j=new XMLHttpRequest;j.open("GET",u),j.responseType="blob",j.onload=function(){S(j.response,_,O)},j.onerror=function(){console.error("could not download file")},j.send()}function o(u){var _=new XMLHttpRequest;_.open("HEAD",u,!1);try{_.send()}catch{}return 200<=_.status&&299>=_.status}function m(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var _=document.createEvent("MouseEvents");_.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(_)}}var b="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,f=b.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),S=b.saveAs||("object"!=typeof window||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(u,_,O){var j=b.URL||b.webkitURL,M=document.createElement("a");M.download=_=_||u.name||"download",M.rel="noopener","string"==typeof u?(M.href=u,M.origin===location.origin?m(M):o(M.href)?v(u,_,O):m(M,M.target="_blank")):(M.href=j.createObjectURL(u),setTimeout(function(){j.revokeObjectURL(M.href)},4e4),setTimeout(function(){m(M)},0))}:"msSaveOrOpenBlob"in navigator?function(u,_,O){if(_=_||u.name||"download","string"!=typeof u)navigator.msSaveOrOpenBlob(function x(u,_){return typeof _>"u"?_={autoBom:!1}:"object"!=typeof _&&(console.warn("Deprecated: Expected third argument to be a object"),_={autoBom:!_}),_.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\ufeff",u],{type:u.type}):u}(u,O),_);else if(o(u))v(u,_,O);else{var j=document.createElement("a");j.href=u,j.target="_blank",setTimeout(function(){m(j)})}}:function(u,_,O,j){if((j=j||open("","_blank"))&&(j.document.title=j.document.body.innerText="downloading..."),"string"==typeof u)return v(u,_,O);var M="application/octet-stream"===u.type,G=/constructor/i.test(b.HTMLElement)||b.safari,L=/CriOS\/[\d]+/.test(navigator.userAgent);if((L||M&&G||f)&&typeof FileReader<"u"){var C=new FileReader;C.onloadend=function(){var T=C.result;T=L?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),j?j.location.href=T:location=T,j=null},C.readAsDataURL(u)}else{var A=b.URL||b.webkitURL,F=A.createObjectURL(u);j?j.location=F:location.href=F,j=null,setTimeout(function(){A.revokeObjectURL(F)},4e4)}});b.saveAs=S.saveAs=S,R.exports=S})?r.apply(I,[]):r)&&(R.exports=c)}}]);