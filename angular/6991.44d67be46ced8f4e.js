(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6991],{75421:(ze,H,u)=>{"use strict";u.d(H,{u:()=>t});var x=u(89163),f=u(33887),v=u(26860),nt=u(76975);let t=(()=>{var W;class Ct extends f._{btnCloseDialog(){this.dialogRef.close(!1)}confirmDialog(){this.dialogRef.close(!0)}constructor(L,X){super(X,L),this.dialogRef=L,this.data=X}}return(W=Ct).\u0275fac=function(L){return new(L||W)(v.rXU(x.CP,8),v.rXU(x.Vh,8))},W.\u0275cmp=v.VBU({type:W,selectors:[["azt-dialog-danger"]],features:[v.Vt3],decls:12,vars:7,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md","flex"],[1,"text-md",3,"innerHtml"],[1,"p-3","text-right"],["azt-track-service","azt-dialog-danger-9EJYp6jGzr",1,"btn","w-24","btn-secondary","mr-2",3,"click"],["azt-track-service","azt-dialog-danger-ffMh3NrPRC",1,"btn","w-24","btn-danger",3,"click"]],template:function(L,X){1&L&&(v.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),v.nrm(4,"span",4),v.k0s()()(),v.j41(5,"div",5)(6,"button",6),v.bIt("click",function(){return X.btnCloseDialog()}),v.EFF(7),v.nI1(8,"mytranslate"),v.k0s(),v.j41(9,"button",7),v.bIt("click",function(){return X.confirmDialog()}),v.EFF(10),v.nI1(11,"mytranslate"),v.k0s()()()),2&L&&(v.R7$(4),v.Y8G("innerHtml",X.data.content,v.npT),v.R7$(3),v.SpI(" ",v.bMT(8,3,"lang_auto_huy")," "),v.R7$(3),v.SpI(" ",v.bMT(11,5,"lang_auto_xac_nhan")," "))},dependencies:[nt.wp],encapsulation:2}),Ct})()},66991:(ze,H,u)=>{"use strict";u.r(H),u.d(H,{AzotaDigitalizeModule:()=>n});var x=u(54460),f=u(10936),v=u(65162),nt=u(69223),t=u(26860),W=u(17715);const Ct=["image"];function Dt(e,a){1&e&&(t.j41(0,"div",6),t.nrm(1,"div",7),t.k0s())}function L(e,a){if(1&e&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&e){const r=t.XpG();t.R7$(1),t.JRh(r.loadImageErrorText)}}let St=(()=>{class e{constructor(){this.cropperOptions={},this.export=new t.bkB,this.ready=new t.bkB,this.isLoading=!0}ngOnInit(){}ngOnDestroy(){this.cropper&&(this.cropper.destroy(),this.cropper=null)}imageLoaded(r){this.loadError=!1;const i=r.target;this.imageElement=i,this.cropperOptions.checkCrossOrigin&&(i.crossOrigin="anonymous"),i.addEventListener("ready",()=>{this.ready.emit(!0),this.isLoading=!1,this.cropbox&&this.cropper.setCropBoxData(this.cropbox)});let o=NaN;if(this.settings){const{width:s,height:p}=this.settings;o=s/p}this.cropperOptions={aspectRatio:o,checkCrossOrigin:!0,...this.cropperOptions},this.cropper&&(this.cropper.destroy(),this.cropper=void 0),this.cropper=new W(i,this.cropperOptions)}imageLoadError(r){this.loadError=!0,this.isLoading=!1}exportCanvas(r){const i=this.cropper.getImageData(),o=this.cropper.getCropBoxData(),s=this.cropper.getCroppedCanvas(),p={imageData:i,cropData:o};new Promise(d=>{if(r)return d({dataUrl:s.toDataURL("image/png")});s.toBlob(g=>d({blob:g}))}).then(d=>{this.export.emit({...p,...d})})}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["angular-cropper"]],viewQuery:function(r,i){if(1&r&&t.GBs(Ct,7),2&r){let o;t.mGM(o=t.lsd())&&(i.image=o.first)}},inputs:{imageUrl:"imageUrl",settings:"settings",cropbox:"cropbox",loadImageErrorText:"loadImageErrorText",cropperOptions:"cropperOptions"},outputs:{export:"export",ready:"ready"},decls:6,vars:3,consts:[[1,"cropper-wrapper"],["class","loading-block",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"cropper"],["alt","image",3,"src","load","error"],["image",""],[1,"loading-block"],[1,"spinner"],[1,"alert","alert-warning"]],template:function(r,i){1&r&&(t.j41(0,"div",0),t.DNE(1,Dt,2,0,"div",1),t.DNE(2,L,2,1,"div",2),t.j41(3,"div",3)(4,"img",4,5),t.bIt("load",function(s){return i.imageLoaded(s)})("error",function(s){return i.imageLoadError(s)}),t.k0s()()()),2&r&&(t.R7$(1),t.Y8G("ngIf",i.isLoading),t.R7$(1),t.Y8G("ngIf",i.loadError),t.R7$(2),t.Y8G("src",i.imageUrl,t.B4B))},dependencies:[x.bT],styles:[':host{display:block}.cropper img{max-width:100%;max-height:100%;height:auto}.cropper-wrapper{position:relative;min-height:80px}.cropper-wrapper .loading-block{position:absolute;top:0;left:0;width:100%;height:100%}.cropper-wrapper .loading-block .spinner{width:31px;height:31px;margin:0 auto;border:2px solid rgba(97,100,193,.98);border-radius:50%;border-left-color:transparent;border-right-color:transparent;-webkit-animation:cssload-spin 425ms infinite linear;position:absolute;top:calc(50% - 15px);left:calc(50% - 15px);animation:cssload-spin 425ms infinite linear}@keyframes cssload-spin{to{transform:rotate(360deg)}}/*!\n * Cropper.js v1.4.1\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2018-07-15T09:54:43.167Z\n */.cropper-container{direction:ltr;font-size:0;line-height:0;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cropper-container img{display:block;height:100%;image-orientation:0deg;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;width:100%}.cropper-wrap-box,.cropper-canvas,.cropper-drag-box,.cropper-crop-box,.cropper-modal{inset:0;position:absolute}.cropper-wrap-box,.cropper-canvas{overflow:hidden}.cropper-drag-box{background-color:#fff;opacity:0}.cropper-modal{background-color:#000;opacity:.5}.cropper-view-box{display:block;height:100%;outline-color:#3399ffbf;outline:1px solid #39f;overflow:hidden;width:100%}.cropper-dashed{border:0 dashed #eee;display:block;opacity:.5;position:absolute}.cropper-dashed.dashed-h{border-bottom-width:1px;border-top-width:1px;height:calc(100% / 3);left:0;top:calc(100% / 3);width:100%}.cropper-dashed.dashed-v{border-left-width:1px;border-right-width:1px;height:100%;left:calc(100% / 3);top:0;width:calc(100% / 3)}.cropper-center{display:block;height:0;left:50%;opacity:.75;position:absolute;top:50%;width:0}.cropper-center:before,.cropper-center:after{background-color:#eee;content:" ";display:block;position:absolute}.cropper-center:before{height:1px;left:-3px;top:0;width:7px}.cropper-center:after{height:7px;left:0;top:-3px;width:1px}.cropper-face,.cropper-line,.cropper-point{display:block;height:100%;opacity:.1;position:absolute;width:100%}.cropper-face{background-color:#fff;left:0;top:0}.cropper-line{background-color:#39f}.cropper-line.line-e{cursor:ew-resize;right:-3px;top:0;width:5px}.cropper-line.line-n{cursor:ns-resize;height:5px;left:0;top:-3px}.cropper-line.line-w{cursor:ew-resize;left:-3px;top:0;width:5px}.cropper-line.line-s{bottom:-3px;cursor:ns-resize;height:5px;left:0}.cropper-point{background-color:#39f;height:5px;opacity:.75;width:5px}.cropper-point.point-e{cursor:ew-resize;margin-top:-3px;right:-3px;top:50%}.cropper-point.point-n{cursor:ns-resize;left:50%;margin-left:-3px;top:-3px}.cropper-point.point-w{cursor:ew-resize;left:-3px;margin-top:-3px;top:50%}.cropper-point.point-s{bottom:-3px;cursor:s-resize;left:50%;margin-left:-3px}.cropper-point.point-ne{cursor:nesw-resize;right:-3px;top:-3px}.cropper-point.point-nw{cursor:nwse-resize;left:-3px;top:-3px}.cropper-point.point-sw{bottom:-3px;cursor:nesw-resize;left:-3px}.cropper-point.point-se{bottom:-3px;cursor:nwse-resize;height:20px;opacity:1;right:-3px;width:20px}@media (min-width: 768px){.cropper-point.point-se{height:15px;width:15px}}@media (min-width: 992px){.cropper-point.point-se{height:10px;width:10px}}@media (min-width: 1200px){.cropper-point.point-se{height:5px;opacity:.75;width:5px}}.cropper-point.point-se:before{background-color:#39f;bottom:-50%;content:" ";display:block;height:200%;opacity:0;position:absolute;right:-50%;width:200%}.cropper-invisible{opacity:0}.cropper-bg{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC)}.cropper-hide{display:block;height:0;position:absolute;width:0}.cropper-hidden{display:none!important}.cropper-move{cursor:move}.cropper-crop{cursor:crosshair}.cropper-disabled .cropper-drag-box,.cropper-disabled .cropper-face,.cropper-disabled .cropper-line,.cropper-disabled .cropper-point{cursor:not-allowed}\n'],encapsulation:2}),e})(),xt=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[x.MD]}),e})();var S=u(15343),jt=u(10123),Rt=u(5502),w=u(21656),Mt=u(70050),Jt=u(7050),Qt=u(91100),Zt=u(43234),q=u(1133),tt=u(37714),M=u(59640),J=u(37497),Y=u(63028),dt=u(51113),V=u(73014),gt=u(85710),Pt=u(51698),Nt=u(79767),k=u(76975),ht=u(21973),ke=u(2812),mt=u(52909),Ft=u(17776);let et=(()=>{var e;class a{constructor(){this.subscriptions=new gt.yU,this.sAztBase64Service=(0,t.WQX)(ht.D),this.ocrService=(0,t.WQX)(Ft.so),this.commonService=(0,t.WQX)(ke.R),this.sAztUuidService=(0,t.WQX)(mt.D),this.digitalizedBookPageService=(0,t.WQX)(Y.gI)}callChangeBookPageDataApi(i,o,s,p){this.subscriptions.add(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrPost({bookId:i,bookPageId:o,ocrContent:s}).subscribe(d=>{if(!d.success)return p(!1,d.message);p(!0,"")}))}digitalizeOneImage(i,o,s,p){return new Pt.c(c=>{o("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:i}).subscribe({next:d=>{p(this.replaceOrcData(d)),c.next(!0),c.complete()},error:d=>{s(d.error.message),c.next(!1),c.complete()}}))})}replaceOrcData(i){let o=i.data,s=this.sAztUuidService.getUuid();return o=this.commonService.convertLatexTagToAztMathTag(o,s),o=(new k.bt).transform((new k.UN).transform(o)),o=this.commonService.replaceAll(o,"<table>","<table class='table table-bordered'>")??o,o=o.replace(new RegExp(s,"g"),"\n"),{htmlResult:o}}extractImageByOrcUtil(i,o){this.sAztBase64Service.convertImageUrlToBase64(i,s=>{if(!s)return o(void 0,[],"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(s),p=>{if(!p)return o(void 0,[],"Error to get Uint8Array from base64");let c={base64:this.sAztBase64Service.removePrefixOfBase64(s),width:100,height:100,extension:"png"};this.loadScriptHandleImage(()=>{this.imageUtils.detectImage(p).then(d=>o(c,d.images.map(g=>({base64:this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(g.content)),width:g.width,height:g.height,extension:g.extension})),void 0)).catch(d=>o(c,[],"Error when call imageUtils.detectImage"))})})})}waitAnswerSheetInitDone(i){if(Nt.A.azotaScanAnswerSheet)return i();setTimeout(()=>{this.waitAnswerSheetInitDone(i)},100)}loadScriptHandleImage(i){var o=this;if(this.imageUtils)return i();this.commonService.loadAnswerSheetJs().then((0,V.A)(function*(){o.waitAnswerSheetInitDone((0,V.A)(function*(){o.imageUtils=yield Nt.A.azotaScanAnswerSheet.imageUtils(),i()}))})).catch(s=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),i()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),a})();var wt=u(14159),Gt=u(27035),Kt=u(17178),qt=u(63016),yt=u(47947),$t=u(20036),Ot=u(15351);const te=(e,a)=>(e.push(a),e);let De=(()=>{var e;class a{processObservables(i,o){return(0,wt.H)(o).pipe((0,Gt.Z)((s,p)=>s.pipe((0,Kt.W)(c=>(console.error("Error in observable:",c),(0,qt.of)(null))),(0,yt.T)(c=>({result:c,index:p}))),i),function Ce(){return(0,Ot.N)((e,a)=>{(function Ut(e,a){return(0,Ot.N)((0,$t.S)(e,a,arguments.length>=2,!1,!0))})(te,[])(e).subscribe(a)})}(),(0,yt.T)(s=>s.sort((p,c)=>p.index-c.index).map(p=>p.result)))}}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),a})();var At=u(18718),ee=u(22613),ut=u(96451),It=u(46899),ie=u(53043);const ae=["*"];let ft=(()=>{var e;class a extends M.H{constructor(){super(...arguments),this.imageUrl="",this.sAztDialogService=(0,t.WQX)(It.i)}previewImage(){this.sAztDialogService.open(ie.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{url:this.imageUrl,mimes:"image/jpeg"},viewFullImageWithScroll:!0},restoreFocus:!1})}}return(e=a).\u0275fac=function(){let r;return function(o){return(r||(r=t.xGo(e)))(o||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["azt-preview-image-tag"]],inputs:{imageUrl:"imageUrl"},features:[t.Vt3],ngContentSelectors:ae,decls:2,vars:0,consts:[[3,"click"]],template:function(i,o){1&i&&(t.NAR(),t.j41(0,"span",0),t.bIt("click",function(){return o.previewImage()}),t.SdG(1),t.k0s())},encapsulation:2}),a})();const Bt=function(){return{"flex-none":!0,"mr-1":!0}};function oe(e,a){if(1&e){const r=t.RV6();t.qex(0),t.j41(1,"span",10),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.editBookPage(o.obj))}),t.nrm(2,"lucide-icon",11),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",12),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.callAgainOcrBookPageEvent.emit(o.obj))}),t.nrm(7,"lucide-icon",13),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s(),t.bVm()}2&e&&(t.R7$(2),t.Y8G("ngClass",t.lJ4(8,Bt)),t.R7$(1),t.SpI(" ",t.bMT(4,4,"lang_cms_admin_digitalized_edit_content")," "),t.R7$(4),t.Y8G("ngClass",t.lJ4(9,Bt)),t.R7$(1),t.SpI(" ",t.bMT(9,6,"lang_cms_admin_digitalized_re_digitalized_again")," "))}function xe(e,a){if(1&e&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e){const r=t.XpG();t.R7$(1),t.JRh(t.bMT(2,1,r.obj.logMessage))}}function we(e,a){if(1&e&&(t.j41(0,"div"),t.nrm(1,"div",15),t.nI1(2,"safeNormalHtmlContent"),t.nI1(3,"async"),t.nI1(4,"mathJaxContent"),t.k0s()),2&e){const r=t.XpG();let i;t.R7$(1),t.Y8G("innerHTML",t.bMT(2,1,t.bMT(3,3,t.bMT(4,5,null!==(i=r.obj.ocrContent)&&void 0!==i?i:""))),t.npT)}}let ye=(()=>{var e;class a extends M.H{constructor(){super(...arguments),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB}editBookPage(i){i.currentStatus="show_edit_form",this.changeBookPageStatusEvent.emit(i)}}return(e=a).\u0275fac=function(){let r;return function(o){return(r||(r=t.xGo(e)))(o||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-view-book-page"]],inputs:{obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"flex-none","items-center"],[4,"ngIf"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],["class","mb-3 text-pending",4,"ngIf"],[1,"text-primary","clickable","mr-2",3,"click"],["name","pencil","size","16",3,"ngClass"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"mb-3","text-pending"],[3,"innerHTML"]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,oe,10,10,"ng-container",4),t.k0s()(),t.j41(7,"div",5)(8,"azt-preview-image-tag",6),t.nrm(9,"img",7),t.k0s(),t.nrm(10,"hr",8),t.DNE(11,xe,3,3,"div",9),t.DNE(12,we,5,7,"div",4),t.k0s()),2&i&&(t.R7$(3),t.Lme("",t.bMT(4,7,"lang_cms_admin_digitalized_page"),": ",o.obj.currentPage,""),t.R7$(3),t.Y8G("ngIf",o.obj.isOrc),t.R7$(2),t.Y8G("imageUrl",o.obj.imageLink),t.R7$(1),t.Y8G("src",o.obj.imageLink,t.B4B),t.R7$(2),t.Y8G("ngIf",o.obj.logMessage),t.R7$(1),t.Y8G("ngIf",o.obj.isOrc))},dependencies:[x.YU,x.bT,ft,S.WGl,x.Jj,k.wp,k.km,k._y],encapsulation:2}),a})();var Lt=u(52811);let ne=(()=>{var e;class a extends M.H{}return(e=a).\u0275fac=function(){let r;return function(o){return(r||(r=t.xGo(e)))(o||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-processing-book-page"]],inputs:{obj:"obj"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],[1,"flex","items-center"],[1,"mr-1"]],template:function(i,o){if(1&i&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()(),t.j41(5,"div",3)(6,"azt-preview-image-tag",4),t.nrm(7,"img",5),t.k0s(),t.nrm(8,"hr",6),t.j41(9,"div",7),t.nrm(10,"azt-loading-ui",8),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()()),2&i){let s;t.R7$(3),t.Lme("",t.bMT(4,5,"lang_cms_admin_digitalized_page"),": ",o.obj.currentPage,""),t.R7$(3),t.Y8G("imageUrl",o.obj.imageLink),t.R7$(1),t.Y8G("src",o.obj.imageLink,t.B4B),t.R7$(4),t.SpI(" ",t.bMT(12,7,null!==(s=o.obj.logMessage)&&void 0!==s?s:"lang_lang_cms_admin_digitalized_is_waiting_to_process")," ")}},dependencies:[Lt.R,ft,k.wp],encapsulation:2}),a})();var Xt=u(89163),re=u(33887);const Oe=["angularCropper"];function Ae(e,a){if(1&e){const r=t.RV6();t.qex(0),t.j41(1,"img",10),t.bIt("click",function(){const s=t.eBV(r).$implicit,p=t.XpG(2);return t.Njj(p.chooseImage(s))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&e){const r=a.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,r.base64,"png"),t.B4B)}}function _(e,a){if(1&e&&(t.j41(0,"div",8),t.DNE(1,Ae,3,4,"ng-container",9),t.k0s()),2&e){const r=t.XpG();t.R7$(1),t.Y8G("ngForOf",r.base64Images)}}function se(e,a){if(1&e&&(t.nrm(0,"angular-cropper",11,12),t.nI1(2,"addBase64Extension")),2&e){const r=t.XpG();t.Y8G("cropperOptions",r.cropperOptions)("imageUrl",t.i5U(2,2,r.currentBase64Image.base64,"png"))}}let Yt=(()=>{var e;class a extends re._{chooseImage(i){this.currentBase64Image=i}cropImage(i){var o=this;return(0,V.A)(function*(){o.angularCropper?.cropper.getCroppedCanvas().toBlob(s=>{s&&o.sAztBase64Service.convertBlobToBase64(s,function(){var p=(0,V.A)(function*(c){let d=o.angularCropper?.cropper.getCropBoxData(),g=d?.width,h=d?.height;!g||!h||(o.base64Images.push({base64:c,width:g,height:h,extension:"png"}),yield o.sAztBase64Service.copyBase64ToClipBoard(c),o.showSuccessSnack("lang_cms_copy_success"),i&&o.dialogRef.close(o.base64Images))});return function(c){return p.apply(this,arguments)}}())})})()}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(i,o){super(o,i),this.dialogRef=i,this.data=o,this.sAztBase64Service=(0,t.WQX)(ht.D),this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=o.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(Xt.CP,8),t.rXU(Xt.Vh,8))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-coazt-image-editor"]],viewQuery:function(i,o){if(1&i&&t.GBs(Oe,5),2&i){let s;t.mGM(s=t.lsd())&&(o.angularCropper=s.first)}},features:[t.Vt3],decls:14,vars:11,consts:[[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn","btn-info","mr-2",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"],[3,"cropperOptions","imageUrl"],["angularCropper",""]],template:function(i,o){1&i&&(t.j41(0,"div",0),t.DNE(1,_,2,1,"div",1),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return o.cropImage(!0)}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",4),t.bIt("click",function(){return o.cropImage(!1)}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"span",5),t.bIt("click",function(){return o.closeDialog()}),t.EFF(10),t.nI1(11,"mytranslate"),t.k0s()(),t.j41(12,"div",6),t.DNE(13,se,3,5,"angular-cropper",7),t.k0s()()),2&i&&(t.R7$(1),t.Y8G("ngIf",o.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,5,"lang_button_crop_and_close")),t.R7$(3),t.JRh(t.bMT(8,7,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(11,9,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",o.currentBase64Image))},dependencies:[x.Sq,x.bT,St,k.wp,k.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]}),a})();function it(e,a){if(1&e){const r=t.RV6();t.qex(0),t.j41(1,"img",6),t.bIt("click",function(){const s=t.eBV(r).$implicit,p=t.XpG(2);return t.Njj(p.copyImage(s))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&e){const r=a.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,r.base64,r.extension),t.B4B)}}function Ie(e,a){if(1&e&&(t.j41(0,"div",4),t.DNE(1,it,3,4,"ng-container",5),t.k0s()),2&e){const r=t.XpG();t.R7$(1),t.Y8G("ngForOf",r.base64Images)}}let rt=(()=>{var e;class a extends M.H{constructor(){super(...arguments),this.replaceImageEvent=new t.bkB,this.sAztDialogService=(0,t.WQX)(It.i),this.sAztDigitalizeService=(0,t.WQX)(et),this.sAztBase64Service=(0,t.WQX)(ht.D),this.base64Images=[]}copyImage(i){var o=this;return(0,V.A)(function*(){yield o.sAztBase64Service.copyBase64ToClipBoard(i.base64),o.showSuccessSnack("lang_cms_copy_and_replace_success"),o.replaceImageEvent.emit(i)})()}cropImageDialog(){this.sAztDialogService.open(Yt,{data:{base64Images:this.base64Images},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(o=>{null!=o&&(this.base64Images=o)})}ngOnChanges(){this.initStatusObj(),this.sAztDigitalizeService.extractImageByOrcUtil(this.imageUrl,(i,o,s)=>{if(s)return this.errorStatusObj(s,!0);let p=[];i&&p.push(i),o.forEach(c=>p.push(c)),this.base64Images=p,this.stopStatusObj()})}}return(e=a).\u0275fac=function(){let r;return function(o){return(r||(r=t.xGo(e)))(o||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-list-digitalized-images"]],inputs:{imageUrl:"imageUrl"},outputs:{replaceImageEvent:"replaceImageEvent"},features:[t.Vt3,t.OA$],decls:6,vars:4,consts:[[2,"height","228px","overflow-x","scroll","overflow-y","hidden"],["class","list-base640-images",4,"ngIf"],[1,"mb-3","mt-3"],[1,"text-primary","clickable",3,"click"],[1,"list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"]],template:function(i,o){1&i&&(t.j41(0,"div",0),t.DNE(1,Ie,2,1,"div",1),t.k0s(),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return o.cropImageDialog()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()),2&i&&(t.R7$(1),t.Y8G("ngIf",o.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,2,"lang_button_crop")))},dependencies:[x.Sq,x.bT,k.wp,k.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;max-height:200px}"]}),a})();function R(e,a){1&e&&t.nrm(0,"azt-loading-ui",12)}const Be=function(){return{"flex-none":!0,"mr-1":!0}};let le=(()=>{var e;class a extends M.H{saveObj(){this.initStatusObj();let i=this.htmlFormControl.value;this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookObj.id,this.obj.id,i,(o,s)=>{if(!o)return this.errorStatusObj(s,!0);this.obj.ocrContent=i,this.changeBookPageStatusEvent.emit(this.obj),this.successStatusObj("lang_cms_update_success",!0)})}cancelObj(){this.showSuccessSnack("lang_cms_cancel_success"),this.htmlFormControl.setValue(this.obj.ocrContent??"")}replaceImage(i){let o=this.htmlFormControl.value.replace("<img>",`<img src='${this.sAztBase64Service.generateBase64Prefix(i.extension)+i.base64}'/>`);this.htmlFormControl.setValue(o)}ngOnChanges(){this.htmlFormControl.setValue(this.obj.ocrContent??"")}ngOnInit(){super.ngOnInit()}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(et),this.sAztBase64Service=(0,t.WQX)(ht.D),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB,this.htmlFormControl=new f.MJ("",{nonNullable:!0})}}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-edit-book-page"]],inputs:{bookObj:"bookObj",obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},features:[t.Vt3,t.OA$],decls:22,vars:25,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"p-3"],[3,"imageUrl","replaceImageEvent"],[3,"formControl","apiKey","init"],[1,"flex-none","items-center","text-right","mt-3"],[1,"btn","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary",3,"click"],["class","mr-1",4,"ngIf"],[1,"mr-1"]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"span",3),t.bIt("click",function(){return o.callAgainOcrBookPageEvent.emit(o.obj)}),t.nrm(6,"lucide-icon",4),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()(),t.j41(9,"div",5)(10,"app-digitalized-list-digitalized-images",6),t.bIt("replaceImageEvent",function(p){return o.replaceImage(p)}),t.k0s(),t.nrm(11,"editor",7),t.nI1(12,"getTinyMceKey"),t.nI1(13,"getTinyMceConfig"),t.j41(14,"div",8)(15,"button",9),t.bIt("click",function(){return o.cancelObj()}),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){return o.saveObj()}),t.DNE(19,R,1,0,"azt-loading-ui",11),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s()()()),2&i&&(t.R7$(3),t.Lme("",t.bMT(4,12,"lang_cms_admin_digitalized_page"),": ",o.obj.currentPage,""),t.R7$(3),t.Y8G("ngClass",t.lJ4(24,Be)),t.R7$(1),t.SpI(" ",t.bMT(8,14,"lang_cms_admin_digitalized_re_digitalized_again")," "),t.R7$(3),t.Y8G("imageUrl",o.obj.imageLink),t.R7$(1),t.FS9("apiKey",t.bMT(12,16,"")),t.Y8G("formControl",o.htmlFormControl)("init",t.bMT(13,18,"admin_for_digitalized")),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(5),t.JRh(t.bMT(17,20,"lang_auto_huy")),t.R7$(3),t.Y8G("ngIf",o.statusObj.loading),t.R7$(1),t.SpI(" ",t.bMT(21,22,"lang_auto_luu")," "))},dependencies:[x.YU,x.bT,f.BC,nt.xn,f.l_,Lt.R,S.WGl,rt,k.wp,k.Hw,k.yc],encapsulation:2}),a})();function A(e,a){if(1&e&&t.nrm(0,"azt-loading-effect",3),2&e){const r=t.XpG();t.Y8G("currentStatusObj",r.statusObj)}}function y(e,a){if(1&e){const r=t.RV6();t.j41(0,"app-digitalized-view-book-page",17),t.bIt("changeBookPageStatusEvent",function(o){t.eBV(r);const s=t.XpG(4);return t.Njj(s.changeBookPageStatus(o))})("callAgainOcrBookPageEvent",function(o){t.eBV(r);const s=t.XpG(4);return t.Njj(s.reDigitalizedOneObj(o))}),t.k0s()}if(2&e){const r=t.XpG(2).$implicit;t.Y8G("obj",r)}}function Ee(e,a){if(1&e){const r=t.RV6();t.j41(0,"app-digitalized-edit-book-page",18),t.bIt("changeBookPageStatusEvent",function(o){t.eBV(r);const s=t.XpG(4);return t.Njj(s.changeBookPageStatus(o))})("callAgainOcrBookPageEvent",function(o){t.eBV(r);const s=t.XpG(4);return t.Njj(s.reDigitalizedOneObj(o))}),t.k0s()}if(2&e){const r=t.XpG(2).$implicit,i=t.XpG(2);t.Y8G("bookObj",i.bookObj)("obj",r)}}function st(e,a){if(1&e&&t.nrm(0,"app-digitalized-processing-book-page",19),2&e){const r=t.XpG(2).$implicit;t.Y8G("obj",r)}}function Te(e,a){if(1&e&&(t.j41(0,"div"),t.DNE(1,y,1,1,"app-digitalized-view-book-page",14),t.DNE(2,Ee,1,2,"app-digitalized-edit-book-page",15),t.DNE(3,st,1,1,"app-digitalized-processing-book-page",16),t.k0s()),2&e){const r=t.XpG().$implicit;t.R7$(1),t.Y8G("ngIf","none"==r.currentStatus),t.R7$(1),t.Y8G("ngIf","show_edit_form"==r.currentStatus),t.R7$(1),t.Y8G("ngIf","calling_ocr_api"==r.currentStatus)}}function Q(e,a){if(1&e&&(t.qex(0),t.DNE(1,Te,4,3,"div",13),t.bVm()),2&e){const r=a.$implicit;t.R7$(1),t.Y8G("ngIf",r.isShow)}}function Se(e,a){if(1&e){const r=t.RV6();t.j41(0,"div",4)(1,"div",5)(2,"button",6),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.digitalizedAll())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"button",6),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.runDigitalizedCurrentPage())}),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s(),t.j41(8,"button",7),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.exportData("html"))}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",7),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.exportData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()(),t.j41(14,"div",8),t.DNE(15,Q,2,1,"ng-container",9),t.k0s(),t.j41(16,"div",10)(17,"div",11)(18,"azt-paging",12),t.bIt("goToPaginationPage",function(o){t.eBV(r);const s=t.XpG();return t.Njj(s.goToPage(o))}),t.k0s()()()()}if(2&e){const r=t.XpG();t.R7$(3),t.E5c("",t.bMT(4,9,"lang_cms_admin_digitalized_digitalized_all")," (",r.bookObj.totalDone," / ",r.bookObj.totalPage,")"),t.R7$(3),t.Lme("",t.bMT(7,11,"lang_cms_admin_digitalized_digitalized_current_page")," (",r.totalCurrentItems,")"),t.R7$(3),t.JRh(t.bMT(10,13,"lang_cms_admin_digitalized_digitalized_export_html")),t.R7$(3),t.JRh(t.bMT(13,15,"lang_cms_admin_digitalized_digitalized_export_docx")),t.R7$(3),t.Y8G("ngForOf",r.objs),t.R7$(3),t.Y8G("pageObj",r.pageObj)}}let I=(()=>{var e;class a extends M.H{digitalizedAll(){this.digitalizedObjs(this.objs.filter(i=>"none"==i.currentStatus&&1!=i.isOrc))}runDigitalizedCurrentPage(){this.digitalizedObjs(this.objs.filter(i=>i.isShow&&"none"==i.currentStatus&&1!=i.isOrc))}reDigitalizedOneObj(i){this.digitalizedObjs([i])}digitalizedObjs(i){this.showSuccessSnack(this.commonService.myTranslateInstant("lang_cms_admin_digitalized_for_total_object")+": "+i.length);let o=i.map(p=>p.id);this.objs.forEach(p=>!!o.includes(p.id)&&Object.assign(p,{...p,currentStatus:"calling_ocr_api"}));let s=[];i.forEach(p=>s.push(this.runDigitalizeOneImage(p))),this.waitDestroy(this.sAztConcurrencyApiService.processObservables(1,s).subscribe(p=>{}))}runDigitalizeOneImage(i){return this.sAztDigitalizeService.digitalizeOneImage(i.imageLink,o=>{console.log(`Digitalized for: Id: ${i.id} | Link: ${i.imageLink}`),this.objs.forEach(s=>s.id==i.id&&Object.assign(s,{...s,logMessage:o}))},o=>{console.log(`Digitalized error: Id: ${i.id} | Link: ${i.imageLink} | message: ${o}`),this.objs.forEach(s=>s.id==i.id&&Object.assign(s,{...s,logMessage:o,currentStatus:"none"}))},o=>{this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookId,i.id,o.htmlResult,(s,p)=>{if(!s)return console.log(`Digitalized error: Id: ${i.id} | Link: ${i.imageLink} | message: ${p}`),void this.objs.forEach(c=>c.id==i.id&&Object.assign(c,{...c,logMessage:p,currentStatus:"none"}));this.objs.forEach(c=>c.id==i.id&&Object.assign(c,{...c,logMessage:"",currentStatus:"show_edit_form",ocrContent:o.htmlResult,isOrc:1})),this.bookObj.totalDone=this.objs.filter(c=>c.isOrc).length,console.log(`Digitalized success: Id: ${i.id} | Link: ${i.imageLink}`)})})}changeBookPageStatus(i){this.objs.forEach(o=>o.id==i.id&&Object.assign(o,{...i}))}exportData(i){let o=new Date,s="";if(this.objs.forEach(p=>s+=`<page [page]='${p.currentPage}'/>`+(p.ocrContent??"")),s=this.commonService.decodeHtmlEntities(s),"html"!=i)this.commonService.loadAzotaDocxJs().then(()=>{(0,tt.w)().textToDocxBinary(s,null).then(p=>{let c=`azota-digitalize-book-${o.getDate()}${o.getMonth()+1}${o.getFullYear()}-${o.getTime()}.docx`;const d=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});d&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(d),c)}).catch(p=>{this.showErrorSnack(p)})}).catch(p=>{this.showErrorSnack(p)});else{let p=`azota-digitalize-book-${o.getDate()}${o.getMonth()+1}${o.getFullYear()}-${o.getTime()}.html`;const c=new Blob([s],{type:"text/plain"});c&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(c),p)}}goToPage(i){this.myNavigation(`/azota-digitalized/digitalized-one-book/${this.bookId}/${i}`),this.pageObj.setTotalPages(this.objs.length),this.pageObj.setPageNumber(i);let o=this.pageObj.getViewObjsOfCurrentPage(this.objs).map(s=>s.id);this.objs.forEach(s=>s.isShow=!!o.includes(s.id)),this.totalCurrentItems=this.objs.filter(s=>s.isShow).length}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageGetObjsGet(this.bookId).subscribe(i=>{if(!i.success||!i.data)return this.errorStatusObj(i.message,!0);this.bookObj=i.data.bookObj,this.objs=i.data.bookPageObjs.map((o,s)=>({...o,isShow:!1,currentPage:s+1,ocrContent:o.ocrContent?this.sAztZipDataService.decodeContentGzip(o.ocrContent):void 0,logMessage:o.isOrc?void 0:"lang_cms_admin_digitalized_not_call_ocr_status",currentStatus:o.isOrc?"show_edit_form":"none",base64Images:[]}))??[],this.goToPage(Number(this.commonService.getMyParam(this.activeRoute,"page")??0)),this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_digitalized_one_book_title",description:"lang_cms_admin_digitalized_one_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.initData()}constructor(i,o,s,p,c){super(),this.digitalizedBookPageService=i,this.activeRoute=o,this.sAztZipDataService=s,this.sAztDigitalizeService=p,this.sAztConcurrencyApiService=c,this.objs=[],this.bookId=0,this.backTo="/azota-digitalized/list-books",this.pageObj=new J.d(10),this.totalCurrentItems=0}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(Y.gI),t.rXU(v.nX),t.rXU(dt.j),t.rXU(et),t.rXU(De))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-digitalized-one-book"]],features:[t.Vt3],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[1,"flex","items-center","mb-3","pb-3",2,"border-bottom","1px solid #ccc"],[1,"btn","btn-primary","mr-3",3,"click"],[1,"btn","btn-success","mr-3",3,"click"],[1,"box"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","flex-wrap","sm:flex-row","sm:flex-nowrap","items-center","mt-3"],[1,"w-full","sm:w-auto","sm:mr-auto"],[3,"pageObj","goToPaginationPage"],[4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"obj",4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent"],[3,"obj"]],template:function(i,o){if(1&i&&(t.j41(0,"teacher-layout",0),t.DNE(1,A,1,1,"azt-loading-effect",1),t.DNE(2,Se,19,17,"ng-template",null,2,t.C5r),t.k0s()),2&i){const s=t.sdS(3);t.Y8G("headerBackToLink",o.backTo),t.R7$(1),t.Y8G("ngIf",1==o.statusObj.loading&&!o.bookObj)("ngIfElse",s)}},dependencies:[x.Sq,x.bT,At.K,ee.q,ut.Q,ye,ne,le,k.wp],encapsulation:2}),a})();class ${static validBookPage(a){const r=a;return r.controls.filter(o=>o.controls.isShow.value).length>0?(a.setErrors(null),null):(r.setErrors({validBookPage:!0}),{identityRevealed:!0})}}var lt=u(15766),ce=u(39712);let Et=(()=>{var e;class a extends M.H{selectAll(i){this.form.controls.bookPageFormArray.controls.map(o=>o.controls.isSelected.setValue(i))}deleteAllSelected(){this.form.controls.bookPageFormArray.controls.forEach(i=>{i.controls.isSelected.value&&i.controls.isShow.setValue(!1)})}countSelected(){this.totalPage=this.form.controls.bookPageFormArray.getRawValue().filter(i=>i.isShow).length,this.totalSelectedPage=this.form.controls.bookPageFormArray.getRawValue().filter(i=>i.isShow&&i.isSelected).length}cancel(){this.commonService.myNavigation(this.backTo)}handleUploadComplete(i){i.forEach(o=>{o.url&&this.form.controls.bookPageFormArray.push(new f.gE({id:new f.MJ(0,{nonNullable:!0}),randomUuid:new f.MJ(this.sAztUuidService.getUuid(),{nonNullable:!0}),name:new f.MJ(o.name??"",{nonNullable:!0}),imageLink:new f.MJ(o.url,{nonNullable:!0}),isShow:new f.MJ(!0,{nonNullable:!0}),isSelected:new f.MJ(!1,{nonNullable:!0})}))}),this.form.controls.bookPageFormArray.updateValueAndValidity()}removeBookPageObj(i){let o=this.form.controls.bookPageFormArray.controls.find(s=>s.controls.randomUuid.value==i);o?.controls.isShow.setValue(!1),this.form.controls.bookPageFormArray.updateValueAndValidity()}constructor(){super(),this.sAztUuidService=(0,t.WQX)(mt.D),this.backTo="",this.allUploadToCdnMenuTypes=ce.b8,this.allUploadFileTypes=ce.PO,this.totalSelectedPage=0,this.totalPage=0,this.form=new f.gE({name:new f.MJ("",{nonNullable:!0,validators:[lt.M.noWhiteSpace]}),bookPageFormArray:new f.Yp([],{validators:[$.validBookPage]})}),this.form.valueChanges.subscribe(i=>this.countSelected())}}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["app-base-create-or-update-book"]],features:[t.Vt3],decls:0,vars:0,template:function(i,o){},encapsulation:2}),a})();var Vt=u(32884),_t=u(27879),pe=u(63349);function de(e,a){if(1&e&&t.nrm(0,"azt-loading-effect",3),2&e){const r=t.XpG();t.Y8G("currentStatusObj",r.statusObj)}}const ge=function(e,a){return[e,a]};function F(e,a){if(1&e){const r=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"azt-upload-multiple-box",26),t.bIt("uploadComplete",function(o){t.eBV(r);const s=t.XpG(2);return t.Njj(s.handleUploadComplete(o))}),t.j41(3,"div",27),t.nrm(4,"lucide-icon",28),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&e){const r=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",r.allUploadToCdnMenuTypes.BUSINESS_PLUGINS)("fileType",t.l_i(7,ge,r.allUploadFileTypes.IMAGE,r.allUploadFileTypes.PDF))("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,5,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function P(e,a){if(1&e){const r=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",29),t.bIt("click",function(){t.eBV(r);const o=t.XpG(2);return t.Njj(o.deleteAllSelected())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()}if(2&e){const r=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,3,"lang_auto_xoa")," (",r.totalSelectedPage,"/",r.totalPage,")")}}function ct(e,a){1&e&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function he(e,a){if(1&e&&(t.qex(0),t.j41(1,"div",32)(2,"azt-preview-image-tag",33),t.nrm(3,"img",34),t.k0s(),t.j41(4,"div",7)(5,"span",35),t.EFF(6),t.k0s(),t.nrm(7,"input",36),t.k0s()(),t.bVm()),2&e){const r=a.$implicit,i=a.index;t.R7$(1),t.Y8G("hidden",!r.controls.isShow.value),t.R7$(1),t.Y8G("imageUrl",r.controls.imageLink.value),t.R7$(1),t.Y8G("src",r.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(i+1),t.R7$(1),t.Y8G("formControl",r.controls.isSelected)}}function Ht(e,a){if(1&e&&(t.j41(0,"div",30),t.DNE(1,he,8,5,"ng-container",31),t.k0s()),2&e){const r=t.XpG(2);t.R7$(1),t.Y8G("ngForOf",r.form.controls.bookPageFormArray.controls)}}const je=function(e){return{"error-border":e}};function me(e,a){if(1&e){const r=t.RV6();t.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"h3",8),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",9)(8,"button",10),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",11),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",12)(15,"div",13)(16,"div",14)(17,"label",15),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",14)(21,"div",16),t.nrm(22,"input",17),t.k0s()()(),t.DNE(23,F,7,10,"div",18),t.nrm(24,"hr",19),t.j41(25,"span",20),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.selectAll(o.totalSelectedPage!=o.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.k0s(),t.DNE(28,P,5,5,"span",21),t.j41(29,"div",22),t.DNE(30,ct,3,3,"div",23),t.DNE(31,Ht,2,1,"ng-template",null,24,t.C5r),t.k0s()(),t.j41(33,"div",25)(34,"button",10),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.cancel())}),t.EFF(35),t.nI1(36,"mytranslate"),t.k0s(),t.j41(37,"button",11),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.saveObj())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s()()()()()}if(2&e){const r=t.sdS(32),i=t.XpG();t.R7$(1),t.Y8G("formGroup",i.form),t.R7$(4),t.SpI(" ",t.bMT(6,18,i.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,20,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(1),t.JRh(t.bMT(13,22,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,24,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",i.form.controls.name)("ngClass",t.eq3(32,je,i.form.controls.name.invalid)),t.R7$(1),t.Y8G("ngIf",!i.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,26,i.totalSelectedPage!=i.totalPage?"lang_select_all":"lang_remove_all")," (",i.totalSelectedPage,"/",i.totalPage,") "),t.R7$(2),t.Y8G("ngIf",i.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",i.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",r),t.R7$(5),t.JRh(t.bMT(36,28,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(1),t.JRh(t.bMT(39,30,"lang_auto_luu"))}}let ue=(()=>{var e;class a extends Et{initForm(){}initData(){}saveObj(){this.initStatusObj();let i=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookAddObjPost({name:i.name}).subscribe(s=>{if(!s.success||!s.data?.obj)return this.errorStatusObj(s.message,!0);let p={bookId:s.data.obj.id,bookPageObjs:[]};i.bookPageFormArray.filter(c=>c.isShow).forEach(c=>{p.bookPageObjs.push({name:c.name,imageLink:c.imageLink})}),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageAddObjsPost(p).subscribe(c=>{if(!c.success)return this.errorStatusObj(c.message,!0);this.successStatusObj("lang_cms_add_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_create_book_title",description:"lang_cms_admin_create_book_title",image:"lang_cms_test_image"}),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(i,o){super(),this.digitalizedBookService=i,this.digitalizedBookPageService=o,this.bookId=0}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(Vt.Z),t.rXU(_t.g))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-create-book"]],features:[t.Vt3],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"disabled","click"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],["viewBookPageTpl",""],[1,"text-right","mt-5"],[3,"uploadToCdnMenu","fileType","convertPdfToImages","showProgress","uploadComplete"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(i,o){if(1&i&&(t.j41(0,"teacher-layout",0),t.DNE(1,de,1,1,"azt-loading-effect",1),t.DNE(2,me,40,34,"ng-template",null,2,t.C5r),t.k0s()),2&i){const s=t.sdS(3);t.Y8G("headerBackToLink",o.backTo),t.R7$(1),t.Y8G("ngIf",1==o.statusObj.loading)("ngIfElse",s)}},dependencies:[x.YU,x.Sq,x.bT,f.qT,f.me,f.Zm,f.BC,f.cb,f.l_,f.j4,At.K,pe.V,ft,ut.Q,S.WGl,k.wp],encapsulation:2}),a})();function vt(e,a){if(1&e&&t.nrm(0,"azt-loading-effect",3),2&e){const r=t.XpG();t.Y8G("currentStatusObj",r.statusObj)}}const Re=function(e,a){return[e,a]};function Tt(e,a){if(1&e){const r=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"azt-upload-multiple-box",26),t.bIt("uploadComplete",function(o){t.eBV(r);const s=t.XpG(2);return t.Njj(s.handleUploadComplete(o))}),t.j41(3,"div",27),t.nrm(4,"lucide-icon",28),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&e){const r=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",r.allUploadToCdnMenuTypes.BUSINESS_PLUGINS)("fileType",t.l_i(7,Re,r.allUploadFileTypes.IMAGE,r.allUploadFileTypes.PDF))("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,5,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Me(e,a){if(1&e){const r=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",29),t.bIt("click",function(){t.eBV(r);const o=t.XpG(2);return t.Njj(o.deleteAllSelected())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()}if(2&e){const r=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,3,"lang_auto_xoa")," (",r.totalSelectedPage,"/",r.totalPage,")")}}function Z(e,a){1&e&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function Pe(e,a){if(1&e&&(t.qex(0),t.j41(1,"div",32)(2,"azt-preview-image-tag",33),t.nrm(3,"img",34),t.k0s(),t.j41(4,"div",7)(5,"span",35),t.EFF(6),t.k0s(),t.nrm(7,"input",36),t.k0s()(),t.bVm()),2&e){const r=a.$implicit,i=a.index;t.R7$(1),t.Y8G("hidden",!r.controls.isShow.value),t.R7$(1),t.Y8G("imageUrl",r.controls.imageLink.value),t.R7$(1),t.Y8G("src",r.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(i+1),t.R7$(1),t.Y8G("formControl",r.controls.isSelected)}}function Ne(e,a){if(1&e&&(t.j41(0,"div",30),t.DNE(1,Pe,8,5,"ng-container",31),t.k0s()),2&e){const r=t.XpG(2);t.R7$(1),t.Y8G("ngForOf",r.form.controls.bookPageFormArray.controls)}}const fe=function(e){return{"error-border":e}};function Fe(e,a){if(1&e){const r=t.RV6();t.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"h3",8),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",9)(8,"button",10),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",11),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",12)(15,"div",13)(16,"div",14)(17,"label",15),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",14)(21,"div",16),t.nrm(22,"input",17),t.k0s()()(),t.DNE(23,Tt,7,10,"div",18),t.nrm(24,"hr",19),t.j41(25,"span",20),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.selectAll(o.totalSelectedPage!=o.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.k0s(),t.DNE(28,Me,5,5,"span",21),t.j41(29,"div",22),t.DNE(30,Z,3,3,"div",23),t.DNE(31,Ne,2,1,"ng-template",null,24,t.C5r),t.k0s()(),t.j41(33,"div",25)(34,"button",10),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.cancel())}),t.EFF(35),t.nI1(36,"mytranslate"),t.k0s(),t.j41(37,"button",11),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.saveObj())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s()()()()()}if(2&e){const r=t.sdS(32),i=t.XpG();t.R7$(1),t.Y8G("formGroup",i.form),t.R7$(4),t.SpI(" ",t.bMT(6,18,i.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,20,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(1),t.JRh(t.bMT(13,22,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,24,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",i.form.controls.name)("ngClass",t.eq3(32,fe,i.form.controls.name.invalid)),t.R7$(1),t.Y8G("ngIf",!i.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,26,i.totalSelectedPage!=i.totalPage?"lang_select_all":"lang_remove_all")," (",i.totalSelectedPage,"/",i.totalPage,") "),t.R7$(2),t.Y8G("ngIf",i.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",i.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",r),t.R7$(5),t.JRh(t.bMT(36,28,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(1),t.JRh(t.bMT(39,30,"lang_auto_luu"))}}let Ge=(()=>{var e;class a extends Et{initForm(i){this.form.controls.name.setValue(i.bookObj.name),i.bookPageObjs.forEach(o=>{this.form.controls.bookPageFormArray.push(new f.gE({id:new f.MJ(o.id,{nonNullable:!0}),randomUuid:new f.MJ(o.id.toString(),{nonNullable:!0}),name:new f.MJ(o.name,{nonNullable:!0}),imageLink:new f.MJ(o.imageLink,{nonNullable:!0}),isShow:new f.MJ(!0,{nonNullable:!0}),isSelected:new f.MJ(!1,{nonNullable:!0})}))})}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjGet(this.bookId).subscribe(i=>{if(!i.success||!i.data)return this.errorStatusObj(i.message,!0);this.initForm(i.data),this.stopStatusObj()}))}saveObj(){this.initStatusObj();let i=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookUpdateObjPost({id:this.bookId,name:i.name}).subscribe(s=>{if(!s.success)return this.errorStatusObj(s.message,!0);let p={bookId:this.bookId,ids:i.bookPageFormArray.filter(c=>!c.isShow&&c.id).map(c=>c.id)};if(p.ids.length<=0)return this.successStatusObj("lang_cms_update_success",!0),void this.cancel();this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageDeleteObjPost(p).subscribe(c=>{if(!c.success)return this.errorStatusObj(c.message,!0);this.successStatusObj("lang_cms_update_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_edit_book_title",description:"lang_cms_admin_edit_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(i,o,s){super(),this.digitalizedBookService=i,this.digitalizedBookPageService=o,this.activeRoute=s,this.bookId=0}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(Y.ZD),t.rXU(Y.gI),t.rXU(v.nX))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-update-book"]],features:[t.Vt3],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"disabled","click"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],["viewBookPageTpl",""],[1,"text-right","mt-5"],[3,"uploadToCdnMenu","fileType","convertPdfToImages","showProgress","uploadComplete"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(i,o){if(1&i&&(t.j41(0,"teacher-layout",0),t.DNE(1,vt,1,1,"azt-loading-effect",1),t.DNE(2,Fe,40,34,"ng-template",null,2,t.C5r),t.k0s()),2&i){const s=t.sdS(3);t.Y8G("headerBackToLink",o.backTo),t.R7$(1),t.Y8G("ngIf",1==o.statusObj.loading)("ngIfElse",s)}},dependencies:[x.YU,x.Sq,x.bT,f.qT,f.me,f.Zm,f.BC,f.cb,f.l_,f.j4,At.K,pe.V,ft,ut.Q,S.WGl,k.wp],encapsulation:2}),a})();var $e=u(75421),_e=u(25329);function Ue(e,a){if(1&e&&t.nrm(0,"azt-loading-effect",4),2&e){const r=t.XpG();t.Y8G("currentStatusObj",r.statusObj)}}function Le(e,a){1&e&&(t.j41(0,"span",25),t.nrm(1,"azt-loading-ui"),t.k0s())}const Wt=function(){return{"mr-1":!0}};function Xe(e,a){if(1&e){const r=t.RV6();t.qex(0),t.j41(1,"mat-card",13)(2,"mat-card-content",14)(3,"div",15)(4,"div",6)(5,"b"),t.EFF(6),t.k0s(),t.EFF(7),t.k0s(),t.j41(8,"div",16)(9,"button",17),t.nI1(10,"navigationLocalize"),t.nrm(11,"lucide-icon",18),t.j41(12,"span",19),t.EFF(13),t.nI1(14,"mytranslate"),t.k0s()(),t.j41(15,"a",20),t.nI1(16,"navigationLocalize"),t.nrm(17,"lucide-icon",21),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s(),t.j41(20,"button",22),t.bIt("click",function(){const s=t.eBV(r).$implicit,p=t.XpG(3);return t.Njj(p.deleteObj(s))}),t.DNE(21,Le,2,0,"span",23),t.nrm(22,"lucide-icon",24),t.j41(23,"span",19),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()()()(),t.bVm()}if(2&e){const r=a.$implicit,i=a.index,o=t.XpG(3);t.R7$(6),t.SpI("",i+1,"."),t.R7$(1),t.E5c(" ",r.name," (",r.totalDone," / ",r.totalPage,") "),t.R7$(2),t.Y8G("routerLink",t.bMT(10,13,"/azota-digitalized/digitalized-one-book/"+r.id+"/1")),t.R7$(2),t.Y8G("ngClass",t.lJ4(23,Wt)),t.R7$(2),t.JRh(t.bMT(14,15,"lang_cms_admin_digitalized_digitalized_btn")),t.R7$(2),t.Y8G("routerLink",t.bMT(16,17,"/azota-digitalized/edit-book/"+r.id)),t.R7$(2),t.Y8G("ngClass",t.lJ4(24,Wt)),t.R7$(1),t.SpI(" ",t.bMT(19,19,"lang_auto_sua")," "),t.R7$(3),t.Y8G("ngIf",o.deletingId==r.id),t.R7$(1),t.Y8G("ngClass",t.lJ4(25,Wt)),t.R7$(2),t.JRh(t.bMT(25,21,"lang_auto_xoa"))}}function Ye(e,a){if(1&e&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.DNE(3,Xe,26,26,"ng-container",12),t.k0s()(),t.bVm()),2&e){const r=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",r.objs)}}function Ve(e,a){1&e&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(1),t.JRh(t.bMT(2,1,"lang_cms_admin_digitalized_there_is_no_book")))}const He=function(e){return[e]};function We(e,a){if(1&e&&(t.j41(0,"div",5)(1,"span",6),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"a",7),t.nI1(5,"navigationLocalize"),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.DNE(8,Ye,4,1,"ng-container",8),t.DNE(9,Ve,3,3,"ng-template",null,9,t.C5r)),2&e){const r=t.sdS(10),i=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"lang_cms_admin_common_digitalize_list_book")),t.R7$(2),t.Y8G("routerLink",t.eq3(11,He,t.bMT(5,7,"/azota-digitalized/create-book"))),t.R7$(2),t.JRh(t.bMT(7,9,"lang_common_create")),t.R7$(2),t.Y8G("ngIf",i.objs.length>0)("ngIfElse",r)}}const ve=[{path:"",children:[{path:"list-books",component:(()=>{var e;class a extends M.H{deleteObj(i){const o=this.commonService.myTranslateInstant("lang_cms_admin_digitalized_are_your_sure_to_delete_this_book")+`: <b>${i.name}<b/>?`;this.sAztDialogService.open($e.u,{data:{content:o},restoreFocus:!1,width:"500px"}).afterClosed().subscribe(s=>{s&&(this.deletingId=i.id,this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookDeleteObjPost({ids:[i.id]}).subscribe(p=>{if(this.deletingId=void 0,!p.success)return this.errorStatusObj(p.message,!0);this.objs=this.objs.filter(c=>c.id!=i.id)})))})}getData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjsGet().subscribe(i=>{if(!i.success)return this.errorStatusObj(i.message,!0);this.objs=i.data?.objs??[],this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.getData(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_list_book",description:"lang_cms_admin_common_digitalize_list_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(i,o){super(),this.digitalizedBookService=i,this.sAztDialogService=o,this.headerBackTo="",this.objs=[]}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(Y.ZD),t.rXU(It.i))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-list-books"]],features:[t.Vt3],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"flex","items-center","mb-3"],[1,"w-full"],[1,"flex-none","btn","btn-primary",3,"routerLink"],[4,"ngIf","ngIfElse"],["emptyList",""],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],["appearance","outlined",1,"mb-2",2,"background-color","#fff","border","none"],[1,"form-control",2,"overflow-y","auto"],[1,"flex","align-items-center"],[1,"flex-none","items-center"],[1,"btn","btn-sm","btn-success-soft","mr-2",3,"routerLink"],["name","eye","size","18",3,"ngClass"],[1,"azt-hidden","md:inline-block"],[1,"btn","btn-sm","btn-primary-soft","mr-2",3,"routerLink"],["name","square-pen","size","18",3,"ngClass"],[1,"btn","btn-sm","btn-danger-soft",3,"click"],["class","w-4 h-4 flex mr-1",4,"ngIf"],["name","trash-2","size","18",3,"ngClass"],[1,"w-4","h-4","flex","mr-1"],[1,"text-center"]],template:function(i,o){if(1&i&&(t.j41(0,"teacher-layout",0)(1,"div",1),t.DNE(2,Ue,1,1,"azt-loading-effect",2),t.DNE(3,We,11,13,"ng-template",null,3,t.C5r),t.k0s()()),2&i){const s=t.sdS(4);t.Y8G("headerBackToLink",o.headerBackTo),t.R7$(2),t.Y8G("ngIf",o.statusObj.loading)("ngIfElse",s)}},dependencies:[v.Wk,x.YU,x.Sq,x.bT,_e.RN,_e.m2,At.K,Lt.R,ut.Q,S.WGl,k.F2,k.wp],encapsulation:2}),a})()},{path:"create-book",component:ue},{path:"edit-book/:bookId",component:Ge},{path:"digitalized-one-book/:bookId/:page",component:I}]}];let l=(()=>{var e;class a{}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[v.iI.forChild(ve),v.iI,q.XE]}),a})(),n=(()=>{var e;class a{}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({providers:[{provide:nt.vn,useValue:Zt.c.azt_tiny_mce_script_src}],imports:[v.iI,x.MD,f.YN,nt.sv,w.s,f.X1,l,Qt.Q,Mt.L,Rt.Id,Jt.b,S.flO.pick(S.Ptg),jt.AC,xt]}),a})()},17715:function(ze){ze.exports=function(){"use strict";function H(l){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(l)}function x(l,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(l,a.key,a)}}function v(l,n,e){return n in l?Object.defineProperty(l,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[n]=e,l}function nt(l,n){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(l);n&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(l,r).enumerable})),e.push.apply(e,a)}return e}function t(l){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?nt(Object(e),!0).forEach(function(a){v(l,a,e[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):nt(Object(e)).forEach(function(a){Object.defineProperty(l,a,Object.getOwnPropertyDescriptor(e,a))})}return l}function W(l){return function Ct(l){if(Array.isArray(l))return X(l)}(l)||function Dt(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}(l)||function L(l,n){if(l){if("string"==typeof l)return X(l,n);var e=Object.prototype.toString.call(l).slice(8,-1);if("Object"===e&&l.constructor&&(e=l.constructor.name),"Map"===e||"Set"===e)return Array.from(l);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return X(l,n)}}(l)||function St(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(l,n){(null==n||n>l.length)&&(n=l.length);for(var e=0,a=new Array(n);e<n;e++)a[e]=l[e];return a}var xt=typeof window<"u"&&typeof window.document<"u",S=xt?window:{},jt=!(!xt||!S.document.documentElement)&&"ontouchstart"in S.document.documentElement,Rt=!!xt&&"PointerEvent"in S,w="cropper",q="e",M="s",J="n",Y="ne",dt="nw",V="se",gt="sw",Pt="".concat(w,"-crop"),Nt="".concat(w,"-disabled"),k="".concat(w,"-hidden"),ht="".concat(w,"-hide"),ke="".concat(w,"-invisible"),mt="".concat(w,"-modal"),Ft="".concat(w,"-move"),et="".concat(w,"Action"),wt="".concat(w,"Preview"),Gt="crop",yt="crop",$t="cropend",Ot="cropmove",Ut="cropstart",te="dblclick",ee=Rt?"pointerdown":jt?"touchstart":"mousedown",ut=Rt?"pointermove":jt?"touchmove":"mousemove",It=Rt?"pointerup pointercancel":jt?"touchend touchcancel":"mouseup",Bt="zoom",oe="image/jpeg",xe=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,we=/^data:/,ye=/^data:image\/jpeg;base64,/,Lt=/^img|canvas$/i,re={viewMode:0,dragMode:Gt,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Ae=Number.isNaN||S.isNaN;function _(l){return"number"==typeof l&&!Ae(l)}var se=function(n){return n>0&&n<1/0};function Yt(l){return typeof l>"u"}function it(l){return"object"===H(l)&&null!==l}var Ie=Object.prototype.hasOwnProperty;function rt(l){if(!it(l))return!1;try{var n=l.constructor,e=n.prototype;return n&&e&&Ie.call(e,"isPrototypeOf")}catch{return!1}}function R(l){return"function"==typeof l}var Be=Array.prototype.slice;function le(l){return Array.from?Array.from(l):Be.call(l)}function A(l,n){return l&&R(n)&&(Array.isArray(l)||_(l.length)?le(l).forEach(function(e,a){n.call(l,e,a,l)}):it(l)&&Object.keys(l).forEach(function(e){n.call(l,l[e],e,l)})),l}var y=Object.assign||function(n){for(var e=arguments.length,a=new Array(e>1?e-1:0),r=1;r<e;r++)a[r-1]=arguments[r];return it(n)&&a.length>0&&a.forEach(function(i){it(i)&&Object.keys(i).forEach(function(o){n[o]=i[o]})}),n},Ee=/\.\d*(?:0|9){12}\d*$/;function st(l){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Ee.test(l)?Math.round(l*n)/n:l}var Te=/^width|height|left|top|marginLeft|marginTop$/;function Q(l,n){var e=l.style;A(n,function(a,r){Te.test(r)&&_(a)&&(a="".concat(a,"px")),e[r]=a})}function I(l,n){if(n){if(_(l.length))return void A(l,function(a){I(a,n)});if(l.classList)return void l.classList.add(n);var e=l.className.trim();e?e.indexOf(n)<0&&(l.className="".concat(e," ").concat(n)):l.className=n}}function $(l,n){if(n){if(_(l.length))return void A(l,function(e){$(e,n)});if(l.classList)return void l.classList.remove(n);l.className.indexOf(n)>=0&&(l.className=l.className.replace(n,""))}}function lt(l,n,e){if(n){if(_(l.length))return void A(l,function(a){lt(a,n,e)});e?I(l,n):$(l,n)}}var ce=/([a-z\d])([A-Z])/g;function Et(l){return l.replace(ce,"$1-$2").toLowerCase()}function Vt(l,n){return it(l[n])?l[n]:l.dataset?l.dataset[n]:l.getAttribute("data-".concat(Et(n)))}function _t(l,n,e){it(e)?l[n]=e:l.dataset?l.dataset[n]=e:l.setAttribute("data-".concat(Et(n)),e)}var de=/\s\s*/,ge=function(){var l=!1;if(xt){var n=!1,e=function(){},a=Object.defineProperty({},"once",{get:function(){return l=!0,n},set:function(i){n=i}});S.addEventListener("test",e,a),S.removeEventListener("test",e,a)}return l}();function F(l,n,e){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=e;n.trim().split(de).forEach(function(i){if(!ge){var o=l.listeners;o&&o[i]&&o[i][e]&&(r=o[i][e],delete o[i][e],0===Object.keys(o[i]).length&&delete o[i],0===Object.keys(o).length&&delete l.listeners)}l.removeEventListener(i,r,a)})}function P(l,n,e){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=e;n.trim().split(de).forEach(function(i){if(a.once&&!ge){var o=l.listeners,s=void 0===o?{}:o;r=function(){delete s[i][e],l.removeEventListener(i,r,a);for(var c=arguments.length,d=new Array(c),g=0;g<c;g++)d[g]=arguments[g];e.apply(l,d)},s[i]||(s[i]={}),s[i][e]&&l.removeEventListener(i,s[i][e],a),s[i][e]=r,l.listeners=s}l.addEventListener(i,r,a)})}function ct(l,n,e){var a;return R(Event)&&R(CustomEvent)?a=new CustomEvent(n,{detail:e,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(n,!0,!0,e),l.dispatchEvent(a)}function he(l){var n=l.getBoundingClientRect();return{left:n.left+(window.pageXOffset-document.documentElement.clientLeft),top:n.top+(window.pageYOffset-document.documentElement.clientTop)}}var Ht=S.location,je=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function me(l){var n=l.match(je);return null!==n&&(n[1]!==Ht.protocol||n[2]!==Ht.hostname||n[3]!==Ht.port)}function ue(l){var n="timestamp=".concat((new Date).getTime());return l+(-1===l.indexOf("?")?"?":"&")+n}function vt(l){var n=l.rotate,e=l.scaleX,a=l.scaleY,r=l.translateX,i=l.translateY,o=[];_(r)&&0!==r&&o.push("translateX(".concat(r,"px)")),_(i)&&0!==i&&o.push("translateY(".concat(i,"px)")),_(n)&&0!==n&&o.push("rotate(".concat(n,"deg)")),_(e)&&1!==e&&o.push("scaleX(".concat(e,")")),_(a)&&1!==a&&o.push("scaleY(".concat(a,")"));var s=o.length?o.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function Tt(l,n){var e=l.pageX,a=l.pageY,r={endX:e,endY:a};return n?r:t({startX:e,startY:a},r)}function Z(l){var n=l.aspectRatio,e=l.height,a=l.width,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",i=se(a),o=se(e);if(i&&o){var s=e*n;"contain"===r&&s>a||"cover"===r&&s<a?e=a/n:a=e*n}else i?e=a/n:o&&(a=e*n);return{width:a,height:e}}var fe=String.fromCharCode;var Ge=/^data:.*,/;function Ue(l){var e,n=new DataView(l);try{var a,r,i;if(255===n.getUint8(0)&&216===n.getUint8(1))for(var o=n.byteLength,s=2;s+1<o;){if(255===n.getUint8(s)&&225===n.getUint8(s+1)){r=s;break}s+=1}if(r){var c=r+10;if("Exif"===function Fe(l,n,e){var a="";e+=n;for(var r=n;r<e;r+=1)a+=fe(l.getUint8(r));return a}(n,r+4,4)){var d=n.getUint16(c);if(((a=18761===d)||19789===d)&&42===n.getUint16(c+2,a)){var g=n.getUint32(c+4,a);g>=8&&(i=c+g)}}}if(i){var z,b,h=n.getUint16(i,a);for(b=0;b<h;b+=1)if(274===n.getUint16(z=i+12*b+2,a)){e=n.getUint16(z+=8,a),n.setUint16(z,1,a);break}}}catch{e=1}return e}var Wt={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var n=this.element,e=this.options,a=this.container,r=this.cropper,i=Number(e.minContainerWidth),o=Number(e.minContainerHeight);I(r,k),$(n,k);var s={width:Math.max(a.offsetWidth,i>=0?i:200),height:Math.max(a.offsetHeight,o>=0?o:100)};this.containerData=s,Q(r,{width:s.width,height:s.height}),I(n,k),$(r,k)},initCanvas:function(){var n=this.containerData,e=this.imageData,a=this.options.viewMode,r=Math.abs(e.rotate)%180==90,i=r?e.naturalHeight:e.naturalWidth,o=r?e.naturalWidth:e.naturalHeight,s=i/o,p=n.width,c=n.height;n.height*s>n.width?3===a?p=n.height*s:c=n.width/s:3===a?c=n.width/s:p=n.height*s;var d={aspectRatio:s,naturalWidth:i,naturalHeight:o,width:p,height:c};this.canvasData=d,this.limited=1===a||2===a,this.limitCanvas(!0,!0),d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth),d.height=Math.min(Math.max(d.height,d.minHeight),d.maxHeight),d.left=(n.width-d.width)/2,d.top=(n.height-d.height)/2,d.oldLeft=d.left,d.oldTop=d.top,this.initialCanvasData=y({},d)},limitCanvas:function(n,e){var a=this.options,r=this.containerData,i=this.canvasData,o=this.cropBoxData,s=a.viewMode,p=i.aspectRatio,c=this.cropped&&o;if(n){var d=Number(a.minCanvasWidth)||0,g=Number(a.minCanvasHeight)||0;s>1?(d=Math.max(d,r.width),g=Math.max(g,r.height),3===s&&(g*p>d?d=g*p:g=d/p)):s>0&&(d?d=Math.max(d,c?o.width:0):g?g=Math.max(g,c?o.height:0):c&&((g=o.height)*p>(d=o.width)?d=g*p:g=d/p));var h=Z({aspectRatio:p,width:d,height:g});g=h.height,i.minWidth=d=h.width,i.minHeight=g,i.maxWidth=1/0,i.maxHeight=1/0}if(e)if(s>(c?0:1)){var z=r.width-i.width,b=r.height-i.height;i.minLeft=Math.min(0,z),i.minTop=Math.min(0,b),i.maxLeft=Math.max(0,z),i.maxTop=Math.max(0,b),c&&this.limited&&(i.minLeft=Math.min(o.left,o.left+(o.width-i.width)),i.minTop=Math.min(o.top,o.top+(o.height-i.height)),i.maxLeft=o.left,i.maxTop=o.top,2===s&&(i.width>=r.width&&(i.minLeft=Math.min(0,z),i.maxLeft=Math.max(0,z)),i.height>=r.height&&(i.minTop=Math.min(0,b),i.maxTop=Math.max(0,b))))}else i.minLeft=-i.width,i.minTop=-i.height,i.maxLeft=r.width,i.maxTop=r.height},renderCanvas:function(n,e){var a=this.canvasData,r=this.imageData;if(e){var i=function Pe(l){var n=l.width,e=l.height,a=l.degree;if(90==(a=Math.abs(a)%180))return{width:e,height:n};var r=a%90*Math.PI/180,i=Math.sin(r),o=Math.cos(r),s=n*o+e*i,p=n*i+e*o;return a>90?{width:p,height:s}:{width:s,height:p}}({width:r.naturalWidth*Math.abs(r.scaleX||1),height:r.naturalHeight*Math.abs(r.scaleY||1),degree:r.rotate||0}),o=i.width,s=i.height,p=a.width*(o/a.naturalWidth),c=a.height*(s/a.naturalHeight);a.left-=(p-a.width)/2,a.top-=(c-a.height)/2,a.width=p,a.height=c,a.aspectRatio=o/s,a.naturalWidth=o,a.naturalHeight=s,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,Q(this.canvas,y({width:a.width,height:a.height},vt({translateX:a.left,translateY:a.top}))),this.renderImage(n),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(n){var e=this.canvasData,a=this.imageData,r=a.naturalWidth*(e.width/e.naturalWidth),i=a.naturalHeight*(e.height/e.naturalHeight);y(a,{width:r,height:i,left:(e.width-r)/2,top:(e.height-i)/2}),Q(this.image,y({width:a.width,height:a.height},vt(y({translateX:a.left,translateY:a.top},a)))),n&&this.output()},initCropBox:function(){var n=this.options,e=this.canvasData,a=n.aspectRatio||n.initialAspectRatio,r=Number(n.autoCropArea)||.8,i={width:e.width,height:e.height};a&&(e.height*a>e.width?i.height=i.width/a:i.width=i.height*a),this.cropBoxData=i,this.limitCropBox(!0,!0),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),i.width=Math.max(i.minWidth,i.width*r),i.height=Math.max(i.minHeight,i.height*r),i.left=e.left+(e.width-i.width)/2,i.top=e.top+(e.height-i.height)/2,i.oldLeft=i.left,i.oldTop=i.top,this.initialCropBoxData=y({},i)},limitCropBox:function(n,e){var a=this.options,r=this.containerData,i=this.canvasData,o=this.cropBoxData,s=this.limited,p=a.aspectRatio;if(n){var c=Number(a.minCropBoxWidth)||0,d=Number(a.minCropBoxHeight)||0,g=s?Math.min(r.width,i.width,i.width+i.left,r.width-i.left):r.width,h=s?Math.min(r.height,i.height,i.height+i.top,r.height-i.top):r.height;c=Math.min(c,r.width),d=Math.min(d,r.height),p&&(c&&d?d*p>c?d=c/p:c=d*p:c?d=c/p:d&&(c=d*p),h*p>g?h=g/p:g=h*p),o.minWidth=Math.min(c,g),o.minHeight=Math.min(d,h),o.maxWidth=g,o.maxHeight=h}e&&(s?(o.minLeft=Math.max(0,i.left),o.minTop=Math.max(0,i.top),o.maxLeft=Math.min(r.width,i.left+i.width)-o.width,o.maxTop=Math.min(r.height,i.top+i.height)-o.height):(o.minLeft=0,o.minTop=0,o.maxLeft=r.width-o.width,o.maxTop=r.height-o.height))},renderCropBox:function(){var n=this.options,e=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,n.movable&&n.cropBoxMovable&&_t(this.face,et,a.width>=e.width&&a.height>=e.height?"move":"all"),Q(this.cropBox,y({width:a.width,height:a.height},vt({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),ct(this.element,yt,this.getData())}},Xe={initPreview:function(){var n=this.element,e=this.crossOrigin,a=this.options.preview,r=e?this.crossOriginUrl:this.url,i=n.alt||"The image to preview",o=document.createElement("img");if(e&&(o.crossOrigin=e),o.src=r,o.alt=i,this.viewBox.appendChild(o),this.viewBoxImage=o,a){var s=a;"string"==typeof a?s=n.ownerDocument.querySelectorAll(a):a.querySelector&&(s=[a]),this.previews=s,A(s,function(p){var c=document.createElement("img");_t(p,wt,{width:p.offsetWidth,height:p.offsetHeight,html:p.innerHTML}),e&&(c.crossOrigin=e),c.src=r,c.alt=i,c.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',p.innerHTML="",p.appendChild(c)})}},resetPreview:function(){A(this.previews,function(n){var e=Vt(n,wt);Q(n,{width:e.width,height:e.height}),n.innerHTML=e.html,function pe(l,n){if(it(l[n]))try{delete l[n]}catch{l[n]=void 0}else if(l.dataset)try{delete l.dataset[n]}catch{l.dataset[n]=void 0}else l.removeAttribute("data-".concat(Et(n)))}(n,wt)})},preview:function(){var n=this.imageData,e=this.canvasData,a=this.cropBoxData,r=a.width,i=a.height,o=n.width,s=n.height,p=a.left-e.left-n.left,c=a.top-e.top-n.top;!this.cropped||this.disabled||(Q(this.viewBoxImage,y({width:o,height:s},vt(y({translateX:-p,translateY:-c},n)))),A(this.previews,function(d){var g=Vt(d,wt),h=g.width,z=g.height,b=h,O=z,C=1;r&&(O=i*(C=h/r)),i&&O>z&&(b=r*(C=z/i),O=z),Q(d,{width:b,height:O}),Q(d.getElementsByTagName("img")[0],y({width:o*C,height:s*C},vt(y({translateX:-p*C,translateY:-c*C},n))))}))}},Ye={bind:function(){var n=this.element,e=this.options,a=this.cropper;R(e.cropstart)&&P(n,Ut,e.cropstart),R(e.cropmove)&&P(n,Ot,e.cropmove),R(e.cropend)&&P(n,$t,e.cropend),R(e.crop)&&P(n,yt,e.crop),R(e.zoom)&&P(n,Bt,e.zoom),P(a,ee,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&P(a,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&P(a,te,this.onDblclick=this.dblclick.bind(this)),P(n.ownerDocument,ut,this.onCropMove=this.cropMove.bind(this)),P(n.ownerDocument,It,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&P(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var n=this.element,e=this.options,a=this.cropper;R(e.cropstart)&&F(n,Ut,e.cropstart),R(e.cropmove)&&F(n,Ot,e.cropmove),R(e.cropend)&&F(n,$t,e.cropend),R(e.crop)&&F(n,yt,e.crop),R(e.zoom)&&F(n,Bt,e.zoom),F(a,ee,this.onCropStart),e.zoomable&&e.zoomOnWheel&&F(a,"wheel",this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&F(a,te,this.onDblclick),F(n.ownerDocument,ut,this.onCropMove),F(n.ownerDocument,It,this.onCropEnd),e.responsive&&F(window,"resize",this.onResize)}},Ve={resize:function(){if(!this.disabled){var i,o,n=this.options,e=this.container,a=this.containerData,r=e.offsetWidth/a.width;1===r&&e.offsetHeight===a.height||(n.restore&&(i=this.getCanvasData(),o=this.getCropBoxData()),this.render(),n.restore&&(this.setCanvasData(A(i,function(s,p){i[p]=s*r})),this.setCropBoxData(A(o,function(s,p){o[p]=s*r}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(function Se(l,n){return l.classList?l.classList.contains(n):l.className.indexOf(n)>-1}(this.dragBox,Pt)?"move":Gt)},wheel:function(n){var e=this,a=Number(this.options.wheelZoomRatio)||.1,r=1;this.disabled||(n.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),n.deltaY?r=n.deltaY>0?1:-1:n.wheelDelta?r=-n.wheelDelta/120:n.detail&&(r=n.detail>0?1:-1),this.zoom(-r*a,n)))},cropStart:function(n){var e=n.buttons,a=n.button;if(!(this.disabled||("mousedown"===n.type||"pointerdown"===n.type&&"mouse"===n.pointerType)&&(_(e)&&1!==e||_(a)&&0!==a||n.ctrlKey))){var o,r=this.options,i=this.pointers;n.changedTouches?A(n.changedTouches,function(s){i[s.identifier]=Tt(s)}):i[n.pointerId||0]=Tt(n),o=Object.keys(i).length>1&&r.zoomable&&r.zoomOnTouch?"zoom":Vt(n.target,et),xe.test(o)&&!1!==ct(this.element,Ut,{originalEvent:n,action:o})&&(n.preventDefault(),this.action=o,this.cropping=!1,"crop"===o&&(this.cropping=!0,I(this.dragBox,mt)))}},cropMove:function(n){var e=this.action;if(!this.disabled&&e){var a=this.pointers;n.preventDefault(),!1!==ct(this.element,Ot,{originalEvent:n,action:e})&&(n.changedTouches?A(n.changedTouches,function(r){y(a[r.identifier]||{},Tt(r,!0))}):y(a[n.pointerId||0]||{},Tt(n,!0)),this.change(n))}},cropEnd:function(n){if(!this.disabled){var e=this.action,a=this.pointers;n.changedTouches?A(n.changedTouches,function(r){delete a[r.identifier]}):delete a[n.pointerId||0],e&&(n.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,lt(this.dragBox,mt,this.cropped&&this.options.modal)),ct(this.element,$t,{originalEvent:n,action:e}))}}},He={change:function(n){var at,a=this.canvasData,r=this.containerData,i=this.cropBoxData,o=this.pointers,s=this.action,p=this.options.aspectRatio,c=i.left,d=i.top,g=i.width,h=i.height,z=c+g,b=d+h,O=0,C=0,E=r.width,j=r.height,B=!0;!p&&n.shiftKey&&(p=g&&h?g/h:1),this.limited&&(C=i.minTop,E=(O=i.minLeft)+Math.min(r.width,a.width,a.left+a.width),j=C+Math.min(r.height,a.height,a.top+a.height));var G=o[Object.keys(o)[0]],m={x:G.endX-G.startX,y:G.endY-G.startY},D=function(U){switch(U){case q:z+m.x>E&&(m.x=E-z);break;case"w":c+m.x<O&&(m.x=O-c);break;case J:d+m.y<C&&(m.y=C-d);break;case M:b+m.y>j&&(m.y=j-b)}};switch(s){case"all":c+=m.x,d+=m.y;break;case q:if(m.x>=0&&(z>=E||p&&(d<=C||b>=j))){B=!1;break}D(q),(g+=m.x)<0&&(s="w",c-=g=-g),p&&(d+=(i.height-(h=g/p))/2);break;case J:if(m.y<=0&&(d<=C||p&&(c<=O||z>=E))){B=!1;break}D(J),d+=m.y,(h-=m.y)<0&&(s=M,d-=h=-h),p&&(c+=(i.width-(g=h*p))/2);break;case"w":if(m.x<=0&&(c<=O||p&&(d<=C||b>=j))){B=!1;break}D("w"),c+=m.x,(g-=m.x)<0&&(s=q,c-=g=-g),p&&(d+=(i.height-(h=g/p))/2);break;case M:if(m.y>=0&&(b>=j||p&&(c<=O||z>=E))){B=!1;break}D(M),(h+=m.y)<0&&(s=J,d-=h=-h),p&&(c+=(i.width-(g=h*p))/2);break;case Y:if(p){if(m.y<=0&&(d<=C||z>=E)){B=!1;break}D(J),d+=m.y,g=(h-=m.y)*p}else D(J),D(q),m.x>=0?z<E?g+=m.x:m.y<=0&&d<=C&&(B=!1):g+=m.x,m.y<=0?d>C&&(h-=m.y,d+=m.y):(h-=m.y,d+=m.y);g<0&&h<0?(s=gt,d-=h=-h,c-=g=-g):g<0?(s=dt,c-=g=-g):h<0&&(s=V,d-=h=-h);break;case dt:if(p){if(m.y<=0&&(d<=C||c<=O)){B=!1;break}D(J),d+=m.y,c+=i.width-(g=(h-=m.y)*p)}else D(J),D("w"),m.x<=0?c>O?(g-=m.x,c+=m.x):m.y<=0&&d<=C&&(B=!1):(g-=m.x,c+=m.x),m.y<=0?d>C&&(h-=m.y,d+=m.y):(h-=m.y,d+=m.y);g<0&&h<0?(s=V,d-=h=-h,c-=g=-g):g<0?(s=Y,c-=g=-g):h<0&&(s=gt,d-=h=-h);break;case gt:if(p){if(m.x<=0&&(c<=O||b>=j)){B=!1;break}D("w"),c+=m.x,h=(g-=m.x)/p}else D(M),D("w"),m.x<=0?c>O?(g-=m.x,c+=m.x):m.y>=0&&b>=j&&(B=!1):(g-=m.x,c+=m.x),m.y>=0?b<j&&(h+=m.y):h+=m.y;g<0&&h<0?(s=Y,d-=h=-h,c-=g=-g):g<0?(s=V,c-=g=-g):h<0&&(s=dt,d-=h=-h);break;case V:if(p){if(m.x>=0&&(z>=E||b>=j)){B=!1;break}D(q),h=(g+=m.x)/p}else D(M),D(q),m.x>=0?z<E?g+=m.x:m.y>=0&&b>=j&&(B=!1):g+=m.x,m.y>=0?b<j&&(h+=m.y):h+=m.y;g<0&&h<0?(s=dt,d-=h=-h,c-=g=-g):g<0?(s=gt,c-=g=-g):h<0&&(s=Y,d-=h=-h);break;case"move":this.move(m.x,m.y),B=!1;break;case"zoom":this.zoom(function Re(l){var n=t({},l),e=0;return A(l,function(a,r){delete n[r],A(n,function(i){var o=Math.abs(a.startX-i.startX),s=Math.abs(a.startY-i.startY),p=Math.abs(a.endX-i.endX),c=Math.abs(a.endY-i.endY),d=Math.sqrt(o*o+s*s),h=(Math.sqrt(p*p+c*c)-d)/d;Math.abs(h)>Math.abs(e)&&(e=h)})}),e}(o),n),B=!1;break;case"crop":if(!m.x||!m.y){B=!1;break}at=he(this.cropper),c=G.startX-at.left,d=G.startY-at.top,g=i.minWidth,h=i.minHeight,m.x>0?s=m.y>0?V:Y:m.x<0&&(c-=g,s=m.y>0?gt:dt),m.y<0&&(d-=h),this.cropped||($(this.cropBox,k),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}B&&(i.width=g,i.height=h,i.left=c,i.top=d,this.action=s,this.renderCropBox()),A(o,function(T){T.startX=T.endX,T.startY=T.endY})}},We={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&I(this.dragBox,mt),$(this.cropBox,k),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=y({},this.initialImageData),this.canvasData=y({},this.initialCanvasData),this.cropBoxData=y({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(y(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),$(this.dragBox,mt),I(this.cropBox,k)),this},replace:function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&n&&(this.isImg&&(this.element.src=n),e?(this.url=n,this.image.src=n,this.ready&&(this.viewBoxImage.src=n,A(this.previews,function(a){a.getElementsByTagName("img")[0].src=n}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(n))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,$(this.cropper,Nt)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,I(this.cropper,Nt)),this},destroy:function(){var n=this.element;return n[w]?(n[w]=void 0,this.isImg&&this.replaced&&(n.src=this.originalUrl),this.uncreate(),this):this},move:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=this.canvasData,r=a.left,i=a.top;return this.moveTo(Yt(n)?n:r+Number(n),Yt(e)?e:i+Number(e))},moveTo:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=this.canvasData,r=!1;return n=Number(n),e=Number(e),this.ready&&!this.disabled&&this.options.movable&&(_(n)&&(a.left=n,r=!0),_(e)&&(a.top=e,r=!0),r&&this.renderCanvas(!0)),this},zoom:function(n,e){var a=this.canvasData;return n=Number(n),this.zoomTo(a.width*(n=n<0?1/(1-n):1+n)/a.naturalWidth,null,e)},zoomTo:function(n,e,a){var r=this.options,i=this.canvasData,o=i.width,s=i.height,p=i.naturalWidth,c=i.naturalHeight;if((n=Number(n))>=0&&this.ready&&!this.disabled&&r.zoomable){var d=p*n,g=c*n;if(!1===ct(this.element,Bt,{ratio:n,oldRatio:o/p,originalEvent:a}))return this;if(a){var h=this.pointers,z=he(this.cropper),b=h&&Object.keys(h).length?function Me(l){var n=0,e=0,a=0;return A(l,function(r){n+=r.startX,e+=r.startY,a+=1}),{pageX:n/=a,pageY:e/=a}}(h):{pageX:a.pageX,pageY:a.pageY};i.left-=(b.pageX-z.left-i.left)/o*(d-o),i.top-=(b.pageY-z.top-i.top)/s*(g-s)}else rt(e)&&_(e.x)&&_(e.y)?(i.left-=(e.x-i.left)/o*(d-o),i.top-=(e.y-i.top)/s*(g-s)):(i.left-=(d-o)/2,i.top-=(g-s)/2);i.width=d,i.height=g,this.renderCanvas(!0)}return this},rotate:function(n){return this.rotateTo((this.imageData.rotate||0)+Number(n))},rotateTo:function(n){return _(n=Number(n))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=n%360,this.renderCanvas(!0,!0)),this},scaleX:function(n){var e=this.imageData.scaleY;return this.scale(n,_(e)?e:1)},scaleY:function(n){var e=this.imageData.scaleX;return this.scale(_(e)?e:1,n)},scale:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=this.imageData,r=!1;return n=Number(n),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(_(n)&&(a.scaleX=n,r=!0),_(e)&&(a.scaleY=e,r=!0),r&&this.renderCanvas(!0,!0)),this},getData:function(){var o,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.options,a=this.imageData,r=this.canvasData,i=this.cropBoxData;if(this.ready&&this.cropped){var s=a.width/a.naturalWidth;if(A(o={x:i.left-r.left,y:i.top-r.top,width:i.width,height:i.height},function(d,g){o[g]=d/s}),n){var p=Math.round(o.y+o.height),c=Math.round(o.x+o.width);o.x=Math.round(o.x),o.y=Math.round(o.y),o.width=c-o.x,o.height=p-o.y}}else o={x:0,y:0,width:0,height:0};return e.rotatable&&(o.rotate=a.rotate||0),e.scalable&&(o.scaleX=a.scaleX||1,o.scaleY=a.scaleY||1),o},setData:function(n){var e=this.options,a=this.imageData,r=this.canvasData,i={};if(this.ready&&!this.disabled&&rt(n)){var o=!1;e.rotatable&&_(n.rotate)&&n.rotate!==a.rotate&&(a.rotate=n.rotate,o=!0),e.scalable&&(_(n.scaleX)&&n.scaleX!==a.scaleX&&(a.scaleX=n.scaleX,o=!0),_(n.scaleY)&&n.scaleY!==a.scaleY&&(a.scaleY=n.scaleY,o=!0)),o&&this.renderCanvas(!0,!0);var s=a.width/a.naturalWidth;_(n.x)&&(i.left=n.x*s+r.left),_(n.y)&&(i.top=n.y*s+r.top),_(n.width)&&(i.width=n.width*s),_(n.height)&&(i.height=n.height*s),this.setCropBoxData(i)}return this},getContainerData:function(){return this.ready?y({},this.containerData):{}},getImageData:function(){return this.sized?y({},this.imageData):{}},getCanvasData:function(){var n=this.canvasData,e={};return this.ready&&A(["left","top","width","height","naturalWidth","naturalHeight"],function(a){e[a]=n[a]}),e},setCanvasData:function(n){var e=this.canvasData,a=e.aspectRatio;return this.ready&&!this.disabled&&rt(n)&&(_(n.left)&&(e.left=n.left),_(n.top)&&(e.top=n.top),_(n.width)?(e.width=n.width,e.height=n.width/a):_(n.height)&&(e.height=n.height,e.width=n.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var e,n=this.cropBoxData;return this.ready&&this.cropped&&(e={left:n.left,top:n.top,width:n.width,height:n.height}),e||{}},setCropBoxData:function(n){var r,i,e=this.cropBoxData,a=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&rt(n)&&(_(n.left)&&(e.left=n.left),_(n.top)&&(e.top=n.top),_(n.width)&&n.width!==e.width&&(r=!0,e.width=n.width),_(n.height)&&n.height!==e.height&&(i=!0,e.height=n.height),a&&(r?e.height=e.width/a:i&&(e.width=e.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e=this.canvasData,a=function Ne(l,n,e,a){var r=n.aspectRatio,i=n.naturalWidth,o=n.naturalHeight,s=n.rotate,p=void 0===s?0:s,c=n.scaleX,d=void 0===c?1:c,g=n.scaleY,h=void 0===g?1:g,z=e.aspectRatio,b=e.naturalWidth,O=e.naturalHeight,C=a.fillColor,E=void 0===C?"transparent":C,j=a.imageSmoothingEnabled,B=void 0===j||j,at=a.imageSmoothingQuality,G=void 0===at?"low":at,m=a.maxWidth,D=void 0===m?1/0:m,T=a.maxHeight,U=void 0===T?1/0:T,ot=a.minWidth,bt=void 0===ot?0:ot,zt=a.minHeight,pt=void 0===zt?0:zt,K=document.createElement("canvas"),N=K.getContext("2d"),kt=Z({aspectRatio:z,width:D,height:U}),be=Z({aspectRatio:z,width:bt,height:pt},"cover"),Je=Math.min(kt.width,Math.max(be.width,b)),Qe=Math.min(kt.height,Math.max(be.height,O)),Ke=Z({aspectRatio:r,width:D,height:U}),qe=Z({aspectRatio:r,width:bt,height:pt},"cover"),ti=Math.min(Ke.width,Math.max(qe.width,i)),ei=Math.min(Ke.height,Math.max(qe.height,o)),ii=[-ti/2,-ei/2,ti,ei];return K.width=st(Je),K.height=st(Qe),N.fillStyle=E,N.fillRect(0,0,Je,Qe),N.save(),N.translate(Je/2,Qe/2),N.rotate(p*Math.PI/180),N.scale(d,h),N.imageSmoothingEnabled=B,N.imageSmoothingQuality=G,N.drawImage.apply(N,[l].concat(W(ii.map(function(ai){return Math.floor(st(ai))})))),N.restore(),K}(this.image,this.imageData,e,n);if(!this.cropped)return a;var r=this.getData(),i=r.x,o=r.y,s=r.width,p=r.height,c=a.width/Math.floor(e.naturalWidth);1!==c&&(i*=c,o*=c,s*=c,p*=c);var d=s/p,g=Z({aspectRatio:d,width:n.maxWidth||1/0,height:n.maxHeight||1/0}),h=Z({aspectRatio:d,width:n.minWidth||0,height:n.minHeight||0},"cover"),z=Z({aspectRatio:d,width:n.width||(1!==c?a.width:s),height:n.height||(1!==c?a.height:p)}),b=z.width,O=z.height;b=Math.min(g.width,Math.max(h.width,b)),O=Math.min(g.height,Math.max(h.height,O));var C=document.createElement("canvas"),E=C.getContext("2d");C.width=st(b),C.height=st(O),E.fillStyle=n.fillColor||"transparent",E.fillRect(0,0,b,O);var j=n.imageSmoothingEnabled,at=n.imageSmoothingQuality;E.imageSmoothingEnabled=void 0===j||j,at&&(E.imageSmoothingQuality=at);var U,ot,bt,zt,pt,K,G=a.width,m=a.height,D=i,T=o;D<=-s||D>G?(D=0,U=0,bt=0,pt=0):D<=0?(bt=-D,D=0,pt=U=Math.min(G,s+D)):D<=G&&(bt=0,pt=U=Math.min(s,G-D)),U<=0||T<=-p||T>m?(T=0,ot=0,zt=0,K=0):T<=0?(zt=-T,T=0,K=ot=Math.min(m,p+T)):T<=m&&(zt=0,K=ot=Math.min(p,m-T));var N=[D,T,U,ot];if(pt>0&&K>0){var kt=b/s;N.push(bt*kt,zt*kt,pt*kt,K*kt)}return E.drawImage.apply(E,[a].concat(W(N.map(function(be){return Math.floor(st(be))})))),C},setAspectRatio:function(n){var e=this.options;return!this.disabled&&!Yt(n)&&(e.aspectRatio=Math.max(0,n)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(n){var e=this.options,a=this.dragBox,r=this.face;if(this.ready&&!this.disabled){var i=n===Gt,o=e.movable&&"move"===n;e.dragMode=n=i||o?n:"none",_t(a,et,n),lt(a,Pt,i),lt(a,Ft,o),e.cropBoxMovable||(_t(r,et,n),lt(r,Pt,i),lt(r,Ft,o))}return this}},Ze=S.Cropper,ve=function(){function l(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function u(l,n){if(!(l instanceof n))throw new TypeError("Cannot call a class as a function")}(this,l),!n||!Lt.test(n.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=n,this.options=y({},re,rt(e)&&e),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return function f(l,n,e){return n&&x(l.prototype,n),e&&x(l,e),l}(l,[{key:"init",value:function(){var r,e=this.element,a=e.tagName.toLowerCase();if(!e[w]){if(e[w]=this,"img"===a){if(this.isImg=!0,r=e.getAttribute("src")||"",this.originalUrl=r,!r)return;r=e.src}else"canvas"===a&&window.HTMLCanvasElement&&(r=e.toDataURL());this.load(r)}}},{key:"load",value:function(e){var a=this;if(e){this.url=e,this.imageData={};var r=this.element,i=this.options;if(!i.rotatable&&!i.scalable&&(i.checkOrientation=!1),!i.checkOrientation||!window.ArrayBuffer)return void this.clone();if(we.test(e))return void(ye.test(e)?this.read(function $e(l){var n=l.replace(Ge,""),e=atob(n),a=new ArrayBuffer(e.length),r=new Uint8Array(a);return A(r,function(i,o){r[o]=e.charCodeAt(o)}),a}(e)):this.clone());var o=new XMLHttpRequest,s=this.clone.bind(this);this.reloading=!0,this.xhr=o,o.onabort=s,o.onerror=s,o.ontimeout=s,o.onprogress=function(){o.getResponseHeader("content-type")!==oe&&o.abort()},o.onload=function(){a.read(o.response)},o.onloadend=function(){a.reloading=!1,a.xhr=null},i.checkCrossOrigin&&me(e)&&r.crossOrigin&&(e=ue(e)),o.open("GET",e,!0),o.responseType="arraybuffer",o.withCredentials="use-credentials"===r.crossOrigin,o.send()}}},{key:"read",value:function(e){var a=this.options,r=this.imageData,i=Ue(e),o=0,s=1,p=1;if(i>1){this.url=function _e(l,n){for(var e=[],r=new Uint8Array(l);r.length>0;)e.push(fe.apply(null,le(r.subarray(0,8192)))),r=r.subarray(8192);return"data:".concat(n,";base64,").concat(btoa(e.join("")))}(e,oe);var c=function Le(l){var n=0,e=1,a=1;switch(l){case 2:e=-1;break;case 3:n=-180;break;case 4:a=-1;break;case 5:n=90,a=-1;break;case 6:n=90;break;case 7:n=90,e=-1;break;case 8:n=-90}return{rotate:n,scaleX:e,scaleY:a}}(i);o=c.rotate,s=c.scaleX,p=c.scaleY}a.rotatable&&(r.rotate=o),a.scalable&&(r.scaleX=s,r.scaleY=p),this.clone()}},{key:"clone",value:function(){var e=this.element,a=this.url,r=e.crossOrigin,i=a;this.options.checkCrossOrigin&&me(a)&&(r||(r="anonymous"),i=ue(a)),this.crossOrigin=r,this.crossOriginUrl=i;var o=document.createElement("img");r&&(o.crossOrigin=r),o.src=i||a,o.alt=e.alt||"The image to crop",this.image=o,o.onload=this.start.bind(this),o.onerror=this.stop.bind(this),I(o,ht),e.parentNode.insertBefore(o,e.nextSibling)}},{key:"start",value:function(){var e=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var r=S.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(S.navigator.userAgent),i=function(c,d){y(e.imageData,{naturalWidth:c,naturalHeight:d,aspectRatio:c/d}),e.initialImageData=y({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(!a.naturalWidth||r){var o=document.createElement("img"),s=document.body||document.documentElement;this.sizingImage=o,o.onload=function(){i(o.width,o.height),r||s.removeChild(o)},o.src=a.src,r||(o.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",s.appendChild(o))}else i(a.naturalWidth,a.naturalHeight)}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var e=this.element,a=this.options,r=this.image,i=e.parentNode,o=document.createElement("div");o.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var s=o.querySelector(".".concat(w,"-container")),p=s.querySelector(".".concat(w,"-canvas")),c=s.querySelector(".".concat(w,"-drag-box")),d=s.querySelector(".".concat(w,"-crop-box")),g=d.querySelector(".".concat(w,"-face"));this.container=i,this.cropper=s,this.canvas=p,this.dragBox=c,this.cropBox=d,this.viewBox=s.querySelector(".".concat(w,"-view-box")),this.face=g,p.appendChild(r),I(e,k),i.insertBefore(s,e.nextSibling),this.isImg||$(r,ht),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,I(d,k),a.guides||I(d.getElementsByClassName("".concat(w,"-dashed")),k),a.center||I(d.getElementsByClassName("".concat(w,"-center")),k),a.background&&I(s,"".concat(w,"-bg")),a.highlight||I(g,ke),a.cropBoxMovable&&(I(g,Ft),_t(g,et,"all")),a.cropBoxResizable||(I(d.getElementsByClassName("".concat(w,"-line")),k),I(d.getElementsByClassName("".concat(w,"-point")),k)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),R(a.ready)&&P(e,"ready",a.ready,{once:!0}),ct(e,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),$(this.element,k))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Ze,l}},{key:"setDefaults",value:function(e){y(re,rt(e)&&e)}}]),l}();return y(ve.prototype,Wt,Xe,Ye,Ve,He,We),ve}()}}]);