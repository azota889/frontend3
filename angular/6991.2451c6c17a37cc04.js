(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6991],{75421:(Ce,H,f)=>{"use strict";f.d(H,{u:()=>t});var x=f(89163),b=f(33887),k=f(26860),ot=f(76975);let t=(()=>{var J;class yt extends b._{btnCloseDialog(){this.dialogRef.close(!1)}confirmDialog(){this.dialogRef.close(!0)}constructor(X,V){super(V,X),this.dialogRef=X,this.data=V}}return(J=yt).\u0275fac=function(X){return new(X||J)(k.rXU(x.CP,8),k.rXU(x.Vh,8))},J.\u0275cmp=k.VBU({type:J,selectors:[["azt-dialog-danger"]],features:[k.Vt3],decls:12,vars:7,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md","flex"],[1,"text-md",3,"innerHtml"],[1,"p-3","text-right"],["azt-track-service","azt-dialog-danger-9EJYp6jGzr",1,"btn","w-24","btn-secondary","mr-2",3,"click"],["azt-track-service","azt-dialog-danger-ffMh3NrPRC",1,"btn","w-24","btn-danger",3,"click"]],template:function(X,V){1&X&&(k.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),k.nrm(4,"span",4),k.k0s()()(),k.j41(5,"div",5)(6,"button",6),k.bIt("click",function(){return V.btnCloseDialog()}),k.EFF(7),k.nI1(8,"mytranslate"),k.k0s(),k.j41(9,"button",7),k.bIt("click",function(){return V.confirmDialog()}),k.EFF(10),k.nI1(11,"mytranslate"),k.k0s()()()),2&X&&(k.R7$(4),k.Y8G("innerHtml",V.data.content,k.npT),k.R7$(3),k.SpI(" ",k.bMT(8,3,"lang_auto_huy")," "),k.R7$(3),k.SpI(" ",k.bMT(11,5,"lang_auto_xac_nhan")," "))},dependencies:[ot.wp],encapsulation:2}),yt})()},66991:(Ce,H,f)=>{"use strict";f.r(H),f.d(H,{AzotaDigitalizeModule:()=>g});var x=f(54460),b=f(10936),k=f(65162),ot=f(69223),t=f(26860),J=f(17715);const yt=["image"];function Ot(e,l){1&e&&(t.j41(0,"div",6),t.nrm(1,"div",7),t.k0s())}function X(e,l){if(1&e&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&e){const s=t.XpG();t.R7$(1),t.JRh(s.loadImageErrorText)}}let Et=(()=>{class e{constructor(){this.cropperOptions={},this.export=new t.bkB,this.ready=new t.bkB,this.isLoading=!0}ngOnInit(){}ngOnDestroy(){this.cropper&&(this.cropper.destroy(),this.cropper=null)}imageLoaded(s){this.loadError=!1;const a=s.target;this.imageElement=a,this.cropperOptions.checkCrossOrigin&&(a.crossOrigin="anonymous"),a.addEventListener("ready",()=>{this.ready.emit(!0),this.isLoading=!1,this.cropbox&&this.cropper.setCropBoxData(this.cropbox)});let n=NaN;if(this.settings){const{width:c,height:d}=this.settings;n=c/d}this.cropperOptions={aspectRatio:n,checkCrossOrigin:!0,...this.cropperOptions},this.cropper&&(this.cropper.destroy(),this.cropper=void 0),this.cropper=new J(a,this.cropperOptions)}imageLoadError(s){this.loadError=!0,this.isLoading=!1}exportCanvas(s){const a=this.cropper.getImageData(),n=this.cropper.getCropBoxData(),c=this.cropper.getCroppedCanvas(),d={imageData:a,cropData:n};new Promise(u=>{if(s)return u({dataUrl:c.toDataURL("image/png")});c.toBlob(_=>u({blob:_}))}).then(u=>{this.export.emit({...d,...u})})}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["angular-cropper"]],viewQuery:function(s,a){if(1&s&&t.GBs(yt,7),2&s){let n;t.mGM(n=t.lsd())&&(a.image=n.first)}},inputs:{imageUrl:"imageUrl",settings:"settings",cropbox:"cropbox",loadImageErrorText:"loadImageErrorText",cropperOptions:"cropperOptions"},outputs:{export:"export",ready:"ready"},decls:6,vars:3,consts:[[1,"cropper-wrapper"],["class","loading-block",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"cropper"],["alt","image",3,"src","load","error"],["image",""],[1,"loading-block"],[1,"spinner"],[1,"alert","alert-warning"]],template:function(s,a){1&s&&(t.j41(0,"div",0),t.DNE(1,Ot,2,0,"div",1),t.DNE(2,X,2,1,"div",2),t.j41(3,"div",3)(4,"img",4,5),t.bIt("load",function(c){return a.imageLoaded(c)})("error",function(c){return a.imageLoadError(c)}),t.k0s()()()),2&s&&(t.R7$(1),t.Y8G("ngIf",a.isLoading),t.R7$(1),t.Y8G("ngIf",a.loadError),t.R7$(2),t.Y8G("src",a.imageUrl,t.B4B))},dependencies:[x.bT],styles:[':host{display:block}.cropper img{max-width:100%;max-height:100%;height:auto}.cropper-wrapper{position:relative;min-height:80px}.cropper-wrapper .loading-block{position:absolute;top:0;left:0;width:100%;height:100%}.cropper-wrapper .loading-block .spinner{width:31px;height:31px;margin:0 auto;border:2px solid rgba(97,100,193,.98);border-radius:50%;border-left-color:transparent;border-right-color:transparent;-webkit-animation:cssload-spin 425ms infinite linear;position:absolute;top:calc(50% - 15px);left:calc(50% - 15px);animation:cssload-spin 425ms infinite linear}@keyframes cssload-spin{to{transform:rotate(360deg)}}/*!\n * Cropper.js v1.4.1\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2018-07-15T09:54:43.167Z\n */.cropper-container{direction:ltr;font-size:0;line-height:0;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cropper-container img{display:block;height:100%;image-orientation:0deg;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;width:100%}.cropper-wrap-box,.cropper-canvas,.cropper-drag-box,.cropper-crop-box,.cropper-modal{inset:0;position:absolute}.cropper-wrap-box,.cropper-canvas{overflow:hidden}.cropper-drag-box{background-color:#fff;opacity:0}.cropper-modal{background-color:#000;opacity:.5}.cropper-view-box{display:block;height:100%;outline-color:#3399ffbf;outline:1px solid #39f;overflow:hidden;width:100%}.cropper-dashed{border:0 dashed #eee;display:block;opacity:.5;position:absolute}.cropper-dashed.dashed-h{border-bottom-width:1px;border-top-width:1px;height:calc(100% / 3);left:0;top:calc(100% / 3);width:100%}.cropper-dashed.dashed-v{border-left-width:1px;border-right-width:1px;height:100%;left:calc(100% / 3);top:0;width:calc(100% / 3)}.cropper-center{display:block;height:0;left:50%;opacity:.75;position:absolute;top:50%;width:0}.cropper-center:before,.cropper-center:after{background-color:#eee;content:" ";display:block;position:absolute}.cropper-center:before{height:1px;left:-3px;top:0;width:7px}.cropper-center:after{height:7px;left:0;top:-3px;width:1px}.cropper-face,.cropper-line,.cropper-point{display:block;height:100%;opacity:.1;position:absolute;width:100%}.cropper-face{background-color:#fff;left:0;top:0}.cropper-line{background-color:#39f}.cropper-line.line-e{cursor:ew-resize;right:-3px;top:0;width:5px}.cropper-line.line-n{cursor:ns-resize;height:5px;left:0;top:-3px}.cropper-line.line-w{cursor:ew-resize;left:-3px;top:0;width:5px}.cropper-line.line-s{bottom:-3px;cursor:ns-resize;height:5px;left:0}.cropper-point{background-color:#39f;height:5px;opacity:.75;width:5px}.cropper-point.point-e{cursor:ew-resize;margin-top:-3px;right:-3px;top:50%}.cropper-point.point-n{cursor:ns-resize;left:50%;margin-left:-3px;top:-3px}.cropper-point.point-w{cursor:ew-resize;left:-3px;margin-top:-3px;top:50%}.cropper-point.point-s{bottom:-3px;cursor:s-resize;left:50%;margin-left:-3px}.cropper-point.point-ne{cursor:nesw-resize;right:-3px;top:-3px}.cropper-point.point-nw{cursor:nwse-resize;left:-3px;top:-3px}.cropper-point.point-sw{bottom:-3px;cursor:nesw-resize;left:-3px}.cropper-point.point-se{bottom:-3px;cursor:nwse-resize;height:20px;opacity:1;right:-3px;width:20px}@media (min-width: 768px){.cropper-point.point-se{height:15px;width:15px}}@media (min-width: 992px){.cropper-point.point-se{height:10px;width:10px}}@media (min-width: 1200px){.cropper-point.point-se{height:5px;opacity:.75;width:5px}}.cropper-point.point-se:before{background-color:#39f;bottom:-50%;content:" ";display:block;height:200%;opacity:0;position:absolute;right:-50%;width:200%}.cropper-invisible{opacity:0}.cropper-bg{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC)}.cropper-hide{display:block;height:0;position:absolute;width:0}.cropper-hidden{display:none!important}.cropper-move{cursor:move}.cropper-crop{cursor:crosshair}.cropper-disabled .cropper-drag-box,.cropper-disabled .cropper-face,.cropper-disabled .cropper-line,.cropper-disabled .cropper-point{cursor:not-allowed}\n'],encapsulation:2}),e})(),At=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[x.MD]}),e})();var S=f(15343),Tt=f(10123),St=f(44233),w=f(5502),jt=f(21656),Ht=f(70050),Jt=f(7050),Qt=f(91100),q=f(43234),tt=f(1133),nt=f(37714),R=f(59640),gt=f(37497),Y=f(63028),ht=f(51113),W=f(73014),Rt=f(27691),Zt=f(85710),M=f(51698),Kt=f(41426),qt=f(79767),O=f(76975),rt=f(21973),mt=f(2812),ut=f(52909),ft=f(39712),te=f(17776);let _t=(()=>{var e;class l{constructor(){this.subscriptions=new Zt.yU,this.sAztBase64Service=(0,t.WQX)(rt.D),this.ocrService=(0,t.WQX)(te.so),this.commonService=(0,t.WQX)(mt.R),this.sAztUuidService=(0,t.WQX)(ut.D),this.digitalizedBookPageService=(0,t.WQX)(Y.gI),this.apiUploadService=(0,t.WQX)(Kt.T)}runRemoveBackgroundNoise(a,n,c){return new M.c(d=>{this.removeBackgroundNoise(a.oldImageUrl,n,(h,u)=>{if(null==h||u)return c(u??""),d.next(void 0),void d.complete();this.apiUploadService.commonUploadFile(ft.b8.ADMIN_DIGITALIZE,this.sAztBase64Service.base64ToFile(h,"digitalized-file.png"),"").subscribe(_=>{_.type!=Rt.hv.UploadProgress&&(1===_.success&&_.data?.url?(d.next({...a,newImageUrl:_.data.url}),d.complete()):(c(_.message??""),d.next(void 0),d.complete()))})})})}removeBackgroundNoise(a,n,c){this.sAztBase64Service.convertImageUrlToBase64(a,d=>{if(!d)return c(void 0,"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(d),h=>{if(!h)return c(void 0,"Error to get Uint8Array from base64");this.loadScriptHandleImage(()=>{this.imageUtils.removeNoise(h,n).then(u=>c(this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(u.image)),void 0)).catch(u=>c(void 0,"Error when call imageUtils.detectImage"))})})})}callChangeBookPageDataApi(a,n,c,d){this.subscriptions.add(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrPost({bookId:a,bookPageId:n,ocrContent:c}).subscribe(u=>{if(!u.success)return d(!1,u.message);d(!0,"")}))}digitalizeOneImage(a,n,c,d){return new M.c(h=>{n("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:a}).subscribe({next:u=>{d(this.replaceOrcData(u)),h.next(!0),h.complete()},error:u=>{c(u.error.message),h.next(!1),h.complete()}}))})}replaceOrcData(a){let n=a.data,c=this.sAztUuidService.getUuid();return n=this.commonService.convertLatexTagToAztMathTag(n,c),n=(new O.bt).transform((new O.UN).transform(n)),n=this.commonService.replaceAll(n,"<table>","<table class='table table-bordered'>")??n,n=n.replace(new RegExp(c,"g"),"\n"),{htmlResult:n}}extractImageByOrcUtil(a,n){}waitAnswerSheetInitDone(a){if(qt.A.azotaScanAnswerSheet)return a();setTimeout(()=>{this.waitAnswerSheetInitDone(a)},100)}loadScriptHandleImage(a){var n=this;if(this.imageUtils)return a();this.commonService.loadAnswerSheetJs().then((0,W.A)(function*(){n.waitAnswerSheetInitDone((0,W.A)(function*(){n.imageUtils=yield qt.A.azotaScanAnswerSheet.imageUtils(),a()}))})).catch(c=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),a()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(e=l).\u0275fac=function(a){return new(a||e)},e.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),l})();var Mt=f(14159),Pt=f(27035),Nt=f(17178),Ft=f(63016),Gt=f(47947),De=f(20036),ee=f(15351);const ie=(e,l)=>(e.push(l),e);let Ut=(()=>{var e;class l{processObservables(a,n){return(0,Mt.H)(n).pipe((0,Pt.Z)((c,d)=>c.pipe((0,Nt.W)(h=>(console.error("Error in observable:",h),(0,Ft.of)(null))),(0,Gt.T)(h=>({result:h,index:d}))),a),function ae(){return(0,ee.N)((e,l)=>{(function xe(e,l){return(0,ee.N)((0,De.S)(e,l,arguments.length>=2,!1,!0))})(ie,[])(e).subscribe(l)})}(),(0,Gt.T)(c=>c.sort((d,h)=>d.index-h.index).map(d=>d.result)))}}return(e=l).\u0275fac=function(a){return new(a||e)},e.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),l})();var bt=f(18718),oe=f(22613),vt=f(96451),kt=f(46899),ne=f(53043);const we=["*"];let It=(()=>{var e;class l extends R.H{constructor(){super(...arguments),this.imageUrl="",this.sAztDialogService=(0,t.WQX)(kt.i)}previewImage(){this.sAztDialogService.open(ne.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{url:this.imageUrl,mimes:"image/jpeg"},viewFullImageWithScroll:!0},restoreFocus:!1})}}return(e=l).\u0275fac=function(){let s;return function(n){return(s||(s=t.xGo(e)))(n||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["azt-preview-image-tag"]],inputs:{imageUrl:"imageUrl"},features:[t.Vt3],ngContentSelectors:we,decls:2,vars:0,consts:[[3,"click"]],template:function(a,n){1&a&&(t.NAR(),t.j41(0,"span",0),t.bIt("click",function(){return n.previewImage()}),t.SdG(1),t.k0s())},encapsulation:2}),l})();const re=function(){return{"flex-none":!0,"mr-1":!0}};function ye(e,l){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"span",10),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.editBookPage(n.obj))}),t.nrm(2,"lucide-icon",11),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",12),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.callAgainOcrBookPageEvent.emit(n.obj))}),t.nrm(7,"lucide-icon",13),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s(),t.bVm()}2&e&&(t.R7$(2),t.Y8G("ngClass",t.lJ4(8,re)),t.R7$(1),t.SpI(" ",t.bMT(4,4,"lang_cms_admin_digitalized_edit_content")," "),t.R7$(4),t.Y8G("ngClass",t.lJ4(9,re)),t.R7$(1),t.SpI(" ",t.bMT(9,6,"lang_cms_admin_digitalized_re_digitalized_again")," "))}function se(e,l){if(1&e&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e){const s=t.XpG();t.R7$(1),t.JRh(t.bMT(2,1,s.obj.logMessage))}}function le(e,l){if(1&e&&(t.j41(0,"div"),t.nrm(1,"div",15),t.nI1(2,"safeNormalHtmlContent"),t.nI1(3,"async"),t.nI1(4,"mathJaxContent"),t.k0s()),2&e){const s=t.XpG();let a;t.R7$(1),t.Y8G("innerHTML",t.bMT(2,1,t.bMT(3,3,t.bMT(4,5,null!==(a=s.obj.ocrContent)&&void 0!==a?a:""))),t.npT)}}let ce=(()=>{var e;class l extends R.H{constructor(){super(...arguments),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB}editBookPage(a){a.currentStatus="show_edit_form",this.changeBookPageStatusEvent.emit(a)}}return(e=l).\u0275fac=function(){let s;return function(n){return(s||(s=t.xGo(e)))(n||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-view-book-page"]],inputs:{obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"flex-none","items-center"],[4,"ngIf"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],["class","mb-3 text-pending",4,"ngIf"],[1,"text-primary","clickable","mr-2",3,"click"],["name","pencil","size","16",3,"ngClass"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"mb-3","text-pending"],[3,"innerHTML"]],template:function(a,n){1&a&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,ye,10,10,"ng-container",4),t.k0s()(),t.j41(7,"div",5)(8,"azt-preview-image-tag",6),t.nrm(9,"img",7),t.k0s(),t.nrm(10,"hr",8),t.DNE(11,se,3,3,"div",9),t.DNE(12,le,5,7,"div",4),t.k0s()),2&a&&(t.R7$(3),t.Lme("",t.bMT(4,7,"lang_cms_admin_digitalized_page"),": ",n.obj.currentPage,""),t.R7$(3),t.Y8G("ngIf",n.obj.isOrc),t.R7$(2),t.Y8G("imageUrl",n.obj.imageLink),t.R7$(1),t.Y8G("src",n.obj.imageLink,t.B4B),t.R7$(2),t.Y8G("ngIf",n.obj.logMessage),t.R7$(1),t.Y8G("ngIf",n.obj.isOrc))},dependencies:[x.YU,x.bT,It,S.WGl,x.Jj,O.wp,O.km,O._y],encapsulation:2}),l})();var $t=f(52811);let Oe=(()=>{var e;class l extends R.H{}return(e=l).\u0275fac=function(){let s;return function(n){return(s||(s=t.xGo(e)))(n||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-processing-book-page"]],inputs:{obj:"obj"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],[1,"flex","items-center"],[1,"mr-1"]],template:function(a,n){if(1&a&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()(),t.j41(5,"div",3)(6,"azt-preview-image-tag",4),t.nrm(7,"img",5),t.k0s(),t.nrm(8,"hr",6),t.j41(9,"div",7),t.nrm(10,"azt-loading-ui",8),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()()),2&a){let c;t.R7$(3),t.Lme("",t.bMT(4,5,"lang_cms_admin_digitalized_page"),": ",n.obj.currentPage,""),t.R7$(3),t.Y8G("imageUrl",n.obj.imageLink),t.R7$(1),t.Y8G("src",n.obj.imageLink,t.B4B),t.R7$(4),t.SpI(" ",t.bMT(12,7,null!==(c=n.obj.logMessage)&&void 0!==c?c:"lang_lang_cms_admin_digitalized_is_waiting_to_process")," ")}},dependencies:[$t.R,It,O.wp],encapsulation:2}),l})();var v=f(89163),pe=f(33887);const Lt=["angularCropper"];function et(e,l){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"img",10),t.bIt("click",function(){const c=t.eBV(s).$implicit,d=t.XpG(2);return t.Njj(d.chooseImage(c))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&e){const s=l.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,s.base64,"png"),t.B4B)}}function Ae(e,l){if(1&e&&(t.j41(0,"div",8),t.DNE(1,et,3,4,"ng-container",9),t.k0s()),2&e){const s=t.XpG();t.R7$(1),t.Y8G("ngForOf",s.base64Images)}}function st(e,l){if(1&e&&(t.nrm(0,"angular-cropper",11,12),t.nI1(2,"addBase64Extension")),2&e){const s=t.XpG();t.Y8G("cropperOptions",s.cropperOptions)("imageUrl",t.i5U(2,2,s.currentBase64Image.base64,"png"))}}let P=(()=>{var e;class l extends pe._{chooseImage(a){this.currentBase64Image=a}cropImage(a){var n=this;return(0,W.A)(function*(){n.angularCropper?.cropper.getCroppedCanvas().toBlob(c=>{c&&n.sAztBase64Service.convertBlobToBase64(c,function(){var d=(0,W.A)(function*(h){let u=n.angularCropper?.cropper.getCropBoxData(),_=u?.width,z=u?.height;!_||!z||(n.base64Images.push({base64:h,width:_,height:z,extension:"png"}),yield n.sAztBase64Service.copyBase64ToClipBoard(h),n.showSuccessSnack("lang_cms_copy_success"),a&&n.dialogRef.close(n.base64Images))});return function(h){return d.apply(this,arguments)}}())})})()}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(a,n){super(n,a),this.dialogRef=a,this.data=n,this.sAztBase64Service=(0,t.WQX)(rt.D),this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=n.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return(e=l).\u0275fac=function(a){return new(a||e)(t.rXU(v.CP,8),t.rXU(v.Vh,8))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-coazt-image-editor"]],viewQuery:function(a,n){if(1&a&&t.GBs(Lt,5),2&a){let c;t.mGM(c=t.lsd())&&(n.angularCropper=c.first)}},features:[t.Vt3],decls:14,vars:11,consts:[[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn","btn-info","mr-2",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"],[3,"cropperOptions","imageUrl"],["angularCropper",""]],template:function(a,n){1&a&&(t.j41(0,"div",0),t.DNE(1,Ae,2,1,"div",1),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return n.cropImage(!0)}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",4),t.bIt("click",function(){return n.cropImage(!1)}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"span",5),t.bIt("click",function(){return n.closeDialog()}),t.EFF(10),t.nI1(11,"mytranslate"),t.k0s()(),t.j41(12,"div",6),t.DNE(13,st,3,5,"angular-cropper",7),t.k0s()()),2&a&&(t.R7$(1),t.Y8G("ngIf",n.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,5,"lang_button_crop_and_close")),t.R7$(3),t.JRh(t.bMT(8,7,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(11,9,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",n.currentBase64Image))},dependencies:[x.Sq,x.bT,Et,O.wp,O.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]}),l})();function Ie(e,l){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"img",6),t.bIt("click",function(){const c=t.eBV(s).$implicit,d=t.XpG(2);return t.Njj(d.copyImage(c))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&e){const s=l.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,s.base64,s.extension),t.B4B)}}function de(e,l){if(1&e&&(t.j41(0,"div",4),t.DNE(1,Ie,3,4,"ng-container",5),t.k0s()),2&e){const s=t.XpG();t.R7$(1),t.Y8G("ngForOf",s.base64Images)}}let A=(()=>{var e;class l extends R.H{constructor(){super(...arguments),this.replaceImageEvent=new t.bkB,this.sAztDialogService=(0,t.WQX)(kt.i),this.sAztDigitalizeService=(0,t.WQX)(_t),this.sAztBase64Service=(0,t.WQX)(rt.D),this.base64Images=[]}copyImage(a){var n=this;return(0,W.A)(function*(){yield n.sAztBase64Service.copyBase64ToClipBoard(a.base64),n.showSuccessSnack("lang_cms_copy_and_replace_success"),n.replaceImageEvent.emit(a)})()}cropImageDialog(){this.sAztDialogService.open(P,{data:{base64Images:this.base64Images},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(n=>{null!=n&&(this.base64Images=n)})}ngOnChanges(){this.initStatusObj(),this.sAztDigitalizeService.extractImageByOrcUtil(this.imageUrl,(a,n,c)=>{if(c)return this.errorStatusObj(c,!0);let d=[];a&&d.push(a),n.forEach(h=>d.push(h)),this.base64Images=d,this.stopStatusObj()})}}return(e=l).\u0275fac=function(){let s;return function(n){return(s||(s=t.xGo(e)))(n||e)}}(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-list-digitalized-images"]],inputs:{imageUrl:"imageUrl"},outputs:{replaceImageEvent:"replaceImageEvent"},features:[t.Vt3,t.OA$],decls:6,vars:4,consts:[[2,"height","228px","overflow-x","scroll","overflow-y","hidden"],["class","list-base640-images",4,"ngIf"],[1,"mb-3","mt-3"],[1,"text-primary","clickable",3,"click"],[1,"list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"]],template:function(a,n){1&a&&(t.j41(0,"div",0),t.DNE(1,de,2,1,"div",1),t.k0s(),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return n.cropImageDialog()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()),2&a&&(t.R7$(1),t.Y8G("ngIf",n.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,2,"lang_button_crop")))},dependencies:[x.Sq,x.bT,O.wp,O.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;max-height:200px}"]}),l})();function y(e,l){1&e&&t.nrm(0,"azt-loading-ui",12)}const Be=function(){return{"flex-none":!0,"mr-1":!0}};let lt=(()=>{var e;class l extends R.H{saveObj(){this.initStatusObj();let a=this.htmlFormControl.value;this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookObj.id,this.obj.id,a,(n,c)=>{if(!n)return this.errorStatusObj(c,!0);this.obj.ocrContent=a,this.changeBookPageStatusEvent.emit(this.obj),this.successStatusObj("lang_cms_update_success",!0)})}cancelObj(){this.showSuccessSnack("lang_cms_cancel_success"),this.htmlFormControl.setValue(this.obj.ocrContent??"")}replaceImage(a){let n=this.htmlFormControl.value.replace("<img>",`<img src='${this.sAztBase64Service.generateBase64Prefix(a.extension)+a.base64}'/>`);this.htmlFormControl.setValue(n)}ngOnChanges(){this.htmlFormControl.setValue(this.obj.ocrContent??"")}ngOnInit(){super.ngOnInit()}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(_t),this.sAztBase64Service=(0,t.WQX)(rt.D),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB,this.htmlFormControl=new b.MJ("",{nonNullable:!0})}}return(e=l).\u0275fac=function(a){return new(a||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-edit-book-page"]],inputs:{bookObj:"bookObj",obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},features:[t.Vt3,t.OA$],decls:22,vars:25,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"p-3"],[3,"imageUrl","replaceImageEvent"],[3,"formControl","apiKey","init"],[1,"flex-none","items-center","text-right","mt-3"],[1,"btn","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary",3,"click"],["class","mr-1",4,"ngIf"],[1,"mr-1"]],template:function(a,n){1&a&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"span",3),t.bIt("click",function(){return n.callAgainOcrBookPageEvent.emit(n.obj)}),t.nrm(6,"lucide-icon",4),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()(),t.j41(9,"div",5)(10,"app-digitalized-list-digitalized-images",6),t.bIt("replaceImageEvent",function(d){return n.replaceImage(d)}),t.k0s(),t.nrm(11,"editor",7),t.nI1(12,"getTinyMceKey"),t.nI1(13,"getTinyMceConfig"),t.j41(14,"div",8)(15,"button",9),t.bIt("click",function(){return n.cancelObj()}),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){return n.saveObj()}),t.DNE(19,y,1,0,"azt-loading-ui",11),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s()()()),2&a&&(t.R7$(3),t.Lme("",t.bMT(4,12,"lang_cms_admin_digitalized_page"),": ",n.obj.currentPage,""),t.R7$(3),t.Y8G("ngClass",t.lJ4(24,Be)),t.R7$(1),t.SpI(" ",t.bMT(8,14,"lang_cms_admin_digitalized_re_digitalized_again")," "),t.R7$(3),t.Y8G("imageUrl",n.obj.imageLink),t.R7$(1),t.FS9("apiKey",t.bMT(12,16,"")),t.Y8G("formControl",n.htmlFormControl)("init",t.bMT(13,18,"admin_for_digitalized")),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(5),t.JRh(t.bMT(17,20,"lang_auto_huy")),t.R7$(3),t.Y8G("ngIf",n.statusObj.loading),t.R7$(1),t.SpI(" ",t.bMT(21,22,"lang_auto_luu")," "))},dependencies:[x.YU,x.bT,b.BC,ot.xn,b.l_,$t.R,S.WGl,A,O.wp,O.Hw,O.yc],encapsulation:2}),l})();function Ee(e,l){if(1&e&&t.nrm(0,"azt-loading-effect",3),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function Q(e,l){if(1&e){const s=t.RV6();t.j41(0,"app-digitalized-view-book-page",17),t.bIt("changeBookPageStatusEvent",function(n){t.eBV(s);const c=t.XpG(4);return t.Njj(c.changeBookPageStatus(n))})("callAgainOcrBookPageEvent",function(n){t.eBV(s);const c=t.XpG(4);return t.Njj(c.reDigitalizedOneObj(n))}),t.k0s()}if(2&e){const s=t.XpG(2).$implicit;t.Y8G("obj",s)}}function Te(e,l){if(1&e){const s=t.RV6();t.j41(0,"app-digitalized-edit-book-page",18),t.bIt("changeBookPageStatusEvent",function(n){t.eBV(s);const c=t.XpG(4);return t.Njj(c.changeBookPageStatus(n))})("callAgainOcrBookPageEvent",function(n){t.eBV(s);const c=t.XpG(4);return t.Njj(c.reDigitalizedOneObj(n))}),t.k0s()}if(2&e){const s=t.XpG(2).$implicit,a=t.XpG(2);t.Y8G("bookObj",a.bookObj)("obj",s)}}function I(e,l){if(1&e&&t.nrm(0,"app-digitalized-processing-book-page",19),2&e){const s=t.XpG(2).$implicit;t.Y8G("obj",s)}}function $(e,l){if(1&e&&(t.j41(0,"div"),t.DNE(1,Q,1,1,"app-digitalized-view-book-page",14),t.DNE(2,Te,1,2,"app-digitalized-edit-book-page",15),t.DNE(3,I,1,1,"app-digitalized-processing-book-page",16),t.k0s()),2&e){const s=t.XpG().$implicit;t.R7$(1),t.Y8G("ngIf","none"==s.currentStatus),t.R7$(1),t.Y8G("ngIf","show_edit_form"==s.currentStatus),t.R7$(1),t.Y8G("ngIf","calling_ocr_api"==s.currentStatus)}}function ct(e,l){if(1&e&&(t.qex(0),t.DNE(1,$,4,3,"div",13),t.bVm()),2&e){const s=l.$implicit;t.R7$(1),t.Y8G("ngIf",s.isShow)}}function Se(e,l){if(1&e){const s=t.RV6();t.j41(0,"div",4)(1,"div",5)(2,"button",6),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.digitalizedAll())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"button",6),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.runDigitalizedCurrentPage())}),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s(),t.j41(8,"button",7),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.exportData("html"))}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",7),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.exportData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()(),t.j41(14,"div",8),t.DNE(15,ct,2,1,"ng-container",9),t.k0s(),t.j41(16,"div",10)(17,"div",11)(18,"azt-paging",12),t.bIt("goToPaginationPage",function(n){t.eBV(s);const c=t.XpG();return t.Njj(c.goToPage(n))}),t.k0s()()()()}if(2&e){const s=t.XpG();t.R7$(3),t.E5c("",t.bMT(4,9,"lang_cms_admin_digitalized_digitalized_all")," (",s.bookObj.totalDone," / ",s.bookObj.totalPage,")"),t.R7$(3),t.Lme("",t.bMT(7,11,"lang_cms_admin_digitalized_digitalized_current_page")," (",s.totalCurrentItems,")"),t.R7$(3),t.JRh(t.bMT(10,13,"lang_cms_admin_digitalized_digitalized_export_html")),t.R7$(3),t.JRh(t.bMT(13,15,"lang_cms_admin_digitalized_digitalized_export_docx")),t.R7$(3),t.Y8G("ngForOf",s.objs),t.R7$(3),t.Y8G("pageObj",s.pageObj)}}let Xt=(()=>{var e;class l extends R.H{digitalizedAll(){this.digitalizedObjs(this.objs.filter(a=>"none"==a.currentStatus&&1!=a.isOrc))}runDigitalizedCurrentPage(){this.digitalizedObjs(this.objs.filter(a=>a.isShow&&"none"==a.currentStatus&&1!=a.isOrc))}reDigitalizedOneObj(a){this.digitalizedObjs([a])}digitalizedObjs(a){this.showSuccessSnack(this.commonService.myTranslateInstant("lang_cms_admin_digitalized_for_total_object")+": "+a.length);let n=a.map(d=>d.id);this.objs.forEach(d=>!!n.includes(d.id)&&Object.assign(d,{...d,currentStatus:"calling_ocr_api"}));let c=[];a.forEach(d=>c.push(this.runDigitalizeOneImage(d))),this.waitDestroy(this.sAztConcurrencyApiService.processObservables(1,c).subscribe(d=>{}))}runDigitalizeOneImage(a){return this.sAztDigitalizeService.digitalizeOneImage(a.imageLink,n=>{console.log(`Digitalized for: Id: ${a.id} | Link: ${a.imageLink}`),this.objs.forEach(c=>c.id==a.id&&Object.assign(c,{...c,logMessage:n}))},n=>{console.log(`Digitalized error: Id: ${a.id} | Link: ${a.imageLink} | message: ${n}`),this.objs.forEach(c=>c.id==a.id&&Object.assign(c,{...c,logMessage:n,currentStatus:"none"}))},n=>{this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookId,a.id,n.htmlResult,(c,d)=>{if(!c)return console.log(`Digitalized error: Id: ${a.id} | Link: ${a.imageLink} | message: ${d}`),void this.objs.forEach(h=>h.id==a.id&&Object.assign(h,{...h,logMessage:d,currentStatus:"none"}));this.objs.forEach(h=>h.id==a.id&&Object.assign(h,{...h,logMessage:"",currentStatus:"show_edit_form",ocrContent:n.htmlResult,isOrc:1})),this.bookObj.totalDone=this.objs.filter(h=>h.isOrc).length,console.log(`Digitalized success: Id: ${a.id} | Link: ${a.imageLink}`)})})}changeBookPageStatus(a){this.objs.forEach(n=>n.id==a.id&&Object.assign(n,{...a}))}exportData(a){let n=new Date,c="";if(this.objs.forEach(d=>c+=`<page [page]='${d.currentPage}'/>`+(d.ocrContent??"")),c=this.commonService.decodeHtmlEntities(c),"html"!=a)this.commonService.loadAzotaDocxJs().then(()=>{(0,nt.w)().textToDocxBinary(c,null).then(d=>{let h=`azota-digitalize-book-${n.getDate()}${n.getMonth()+1}${n.getFullYear()}-${n.getTime()}.docx`;const u=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});u&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(u),h)}).catch(d=>{this.showErrorSnack(d)})}).catch(d=>{this.showErrorSnack(d)});else{let d=`azota-digitalize-book-${n.getDate()}${n.getMonth()+1}${n.getFullYear()}-${n.getTime()}.html`;const h=new Blob([c],{type:"text/plain"});h&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(h),d)}}goToPage(a){this.myNavigation(`/azota-digitalized/digitalized-one-book/${this.bookId}/${a}`),this.pageObj.setTotalPages(this.objs.length),this.pageObj.setPageNumber(a);let n=this.pageObj.getViewObjsOfCurrentPage(this.objs).map(c=>c.id);this.objs.forEach(c=>c.isShow=!!n.includes(c.id)),this.totalCurrentItems=this.objs.filter(c=>c.isShow).length}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageGetObjsGet(this.bookId).subscribe(a=>{if(!a.success||!a.data)return this.errorStatusObj(a.message,!0);this.bookObj=a.data.bookObj,this.objs=a.data.bookPageObjs.map((n,c)=>({...n,isShow:!1,currentPage:c+1,ocrContent:n.ocrContent?this.sAztZipDataService.decodeContentGzip(n.ocrContent):void 0,logMessage:n.isOrc?void 0:"lang_cms_admin_digitalized_not_call_ocr_status",currentStatus:n.isOrc?"show_edit_form":"none",base64Images:[]}))??[],this.goToPage(Number(this.commonService.getMyParam(this.activeRoute,"page")??0)),this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_digitalized_one_book_title",description:"lang_cms_admin_digitalized_one_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.initData()}constructor(a,n,c,d,h){super(),this.digitalizedBookPageService=a,this.activeRoute=n,this.sAztZipDataService=c,this.sAztDigitalizeService=d,this.sAztConcurrencyApiService=h,this.objs=[],this.bookId=0,this.backTo="/azota-digitalized/list-books",this.pageObj=new gt.d(10),this.totalCurrentItems=0}}return(e=l).\u0275fac=function(a){return new(a||e)(t.rXU(Y.gI),t.rXU(k.nX),t.rXU(ht.j),t.rXU(_t),t.rXU(Ut))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-digitalized-one-book"]],features:[t.Vt3],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[1,"flex","items-center","mb-3","pb-3",2,"border-bottom","1px solid #ccc"],[1,"btn","btn-primary","mr-3",3,"click"],[1,"btn","btn-success","mr-3",3,"click"],[1,"box"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","flex-wrap","sm:flex-row","sm:flex-nowrap","items-center","mt-3"],[1,"w-full","sm:w-auto","sm:mr-auto"],[3,"pageObj","goToPaginationPage"],[4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"obj",4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent"],[3,"obj"]],template:function(a,n){if(1&a&&(t.j41(0,"teacher-layout",0),t.DNE(1,Ee,1,1,"azt-loading-effect",1),t.DNE(2,Se,19,17,"ng-template",null,2,t.C5r),t.k0s()),2&a){const c=t.sdS(3);t.Y8G("headerBackToLink",n.backTo),t.R7$(1),t.Y8G("ngIf",1==n.statusObj.loading&&!n.bookObj)("ngIfElse",c)}},dependencies:[x.Sq,x.bT,bt.K,oe.q,vt.Q,ce,Oe,lt,O.wp],encapsulation:2}),l})();class Vt{static validBookPage(l){const s=l;return s.controls.filter(n=>n.controls.isShow.value).length>0?(l.setErrors(null),null):(s.setErrors({validBookPage:!0}),{identityRevealed:!0})}}var zt=f(15766);let ge=(()=>{var e;class l extends R.H{removeBackgroundNoise(a){this.initStatusObj();let c=this.form.controls.bookPageFormArray.getRawValue().filter(d=>(!!a||d.isSelected)&&d.isShow).map(d=>this.sAztDigitalizeService.runRemoveBackgroundNoise({uuid:d.randomUuid,oldImageUrl:d.imageLink,newImageUrl:""},this.defaultThreshold,h=>console.log("Remove noise error",h)));this.waitDestroy(this.sAztConcurrencyApiService.processObservables(20,c).subscribe(d=>{let h=this.form.controls.bookPageFormArray.getRawValue();h.forEach(u=>{let _=d.find(z=>z?.uuid==z?.uuid)?.newImageUrl;_&&(u.imageLink=_,u.needUpdate=!0)}),this.form.controls.bookPageFormArray.patchValue(h),this.stopStatusObj()}))}selectAll(a){this.form.controls.bookPageFormArray.controls.map(n=>n.controls.isSelected.setValue(a))}deleteAllSelected(){this.form.controls.bookPageFormArray.controls.forEach(a=>{a.controls.isSelected.value&&a.controls.isShow.setValue(!1)})}countSelected(){this.totalPage=this.form.controls.bookPageFormArray.getRawValue().filter(a=>a.isShow).length,this.totalSelectedPage=this.form.controls.bookPageFormArray.getRawValue().filter(a=>a.isShow&&a.isSelected).length}cancel(){this.commonService.myNavigation(this.backTo)}handleUploadComplete(a){a.forEach(n=>{n.url&&this.form.controls.bookPageFormArray.push(new b.gE({id:new b.MJ(0,{nonNullable:!0}),randomUuid:new b.MJ(this.sAztUuidService.getUuid(),{nonNullable:!0}),name:new b.MJ(n.name??"",{nonNullable:!0}),imageLink:new b.MJ(n.url,{nonNullable:!0}),isShow:new b.MJ(!0,{nonNullable:!0}),isSelected:new b.MJ(!1,{nonNullable:!0}),needUpdate:new b.MJ(!1,{nonNullable:!0})}))}),this.form.controls.bookPageFormArray.updateValueAndValidity()}removeBookPageObj(a){let n=this.form.controls.bookPageFormArray.controls.find(c=>c.controls.randomUuid.value==a);n?.controls.isShow.setValue(!1),this.form.controls.bookPageFormArray.updateValueAndValidity()}constructor(){super(),this.sAztUuidService=(0,t.WQX)(ut.D),this.sAztDigitalizeService=(0,t.WQX)(_t),this.sAztConcurrencyApiService=(0,t.WQX)(Ut),this.backTo="",this.allUploadToCdnMenuTypes=ft.b8,this.allUploadFileTypes=ft.PO,this.totalSelectedPage=0,this.totalPage=0,this.defaultThreshold=230,this.form=new b.gE({name:new b.MJ("",{nonNullable:!0,validators:[zt.M.noWhiteSpace]}),bookPageFormArray:new b.Yp([],{validators:[Vt.validBookPage]})}),this.form.valueChanges.subscribe(a=>this.countSelected())}}return(e=l).\u0275fac=function(a){return new(a||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["app-base-create-or-update-book"]],features:[t.Vt3],decls:0,vars:0,template:function(a,n){},encapsulation:2}),l})();var he=f(32884),me=f(27879),N=f(63349);function F(e,l){if(1&e&&t.nrm(0,"azt-loading-effect",3),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}const pt=function(e,l){return[e,l]};function ue(e,l){if(1&e){const s=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(n){t.eBV(s);const c=t.XpG(2);return t.Njj(c.handleUploadComplete(n))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&e){const s=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",s.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(7,pt,s.allUploadFileTypes.IMAGE,s.allUploadFileTypes.PDF))("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,5,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Yt(e,l){if(1&e){const s=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",21),t.bIt("click",function(){t.eBV(s);const n=t.XpG(2);return t.Njj(n.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(s);const n=t.XpG(2);return t.Njj(n.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&e){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",s.totalSelectedPage,"/",s.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",s.totalSelectedPage,"/",s.totalPage,")")}}function je(e,l){1&e&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function fe(e,l){if(1&e&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",7)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&e){const s=l.$implicit,a=l.index;t.R7$(1),t.Y8G("hidden",!s.controls.isShow.value),t.R7$(1),t.Y8G("imageUrl",s.controls.imageLink.value),t.R7$(1),t.Y8G("src",s.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(a+1),t.R7$(1),t.Y8G("formControl",s.controls.isSelected)}}function _e(e,l){if(1&e&&(t.j41(0,"div",31),t.DNE(1,fe,8,5,"ng-container",32),t.k0s()),2&e){const s=t.XpG(2);t.R7$(1),t.Y8G("ngForOf",s.form.controls.bookPageFormArray.controls)}}const Ct=function(e){return{"error-border":e}};function Re(e,l){if(1&e){const s=t.RV6();t.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"h3",8),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",9)(8,"button",10),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",11),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",12)(15,"div",13)(16,"div",14)(17,"label",15),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",14)(21,"div",16),t.nrm(22,"input",17),t.k0s()()(),t.DNE(23,ue,7,10,"div",18),t.nrm(24,"hr",19),t.j41(25,"span",20),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.selectAll(n.totalSelectedPage!=n.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",21),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,Yt,9,10,"span",22),t.j41(32,"div",23),t.DNE(33,je,3,3,"div",24),t.DNE(34,_e,2,1,"ng-template",null,25,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",10),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",11),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&e){const s=t.sdS(35),a=t.XpG();t.R7$(1),t.Y8G("formGroup",a.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,a.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",a.form.invalid),t.R7$(1),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",a.form.controls.name)("ngClass",t.eq3(35,Ct,a.form.controls.name.invalid)),t.R7$(1),t.Y8G("ngIf",!a.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,a.totalSelectedPage!=a.totalPage?"lang_select_all":"lang_remove_all")," (",a.totalSelectedPage,"/",a.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",a.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",a.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",s),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",a.form.invalid),t.R7$(1),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let Bt=(()=>{var e;class l extends ge{initForm(){}initData(){}saveObj(){this.initStatusObj();let a=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookAddObjPost({name:a.name}).subscribe(c=>{if(!c.success||!c.data?.obj)return this.errorStatusObj(c.message,!0);let d={bookId:c.data.obj.id,bookPageObjs:[]};a.bookPageFormArray.filter(h=>h.isShow).forEach(h=>{d.bookPageObjs.push({name:h.name,imageLink:h.imageLink})}),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageAddObjsPost(d).subscribe(h=>{if(!h.success)return this.errorStatusObj(h.message,!0);this.successStatusObj("lang_cms_add_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_create_book_title",description:"lang_cms_admin_create_book_title",image:"lang_cms_test_image"}),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(a,n){super(),this.digitalizedBookService=a,this.digitalizedBookPageService=n,this.bookId=0}}return(e=l).\u0275fac=function(a){return new(a||e)(t.rXU(he.Z),t.rXU(me.g))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-create-book"]],features:[t.Vt3],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"disabled","click"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],["viewBookPageTpl",""],[1,"text-right","mt-5"],[3,"uploadToCdnMenu","fileType","convertPdfToImages","showProgress","uploadComplete"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(a,n){if(1&a&&(t.j41(0,"teacher-layout",0),t.DNE(1,F,1,1,"azt-loading-effect",1),t.DNE(2,Re,43,37,"ng-template",null,2,t.C5r),t.k0s()),2&a){const c=t.sdS(3);t.Y8G("headerBackToLink",n.backTo),t.R7$(1),t.Y8G("ngIf",1==n.statusObj.loading)("ngIfElse",c)}},dependencies:[x.YU,x.Sq,x.bT,b.qT,b.me,b.Zm,b.BC,b.cb,b.l_,b.j4,bt.K,N.V,It,vt.Q,S.WGl,O.wp],encapsulation:2}),l})();function Me(e,l){if(1&e&&t.nrm(0,"azt-loading-effect",3),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}const Z=function(e,l){return[e,l]};function Pe(e,l){if(1&e){const s=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(n){t.eBV(s);const c=t.XpG(2);return t.Njj(c.handleUploadComplete(n))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&e){const s=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",s.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(7,Z,s.allUploadFileTypes.IMAGE,s.allUploadFileTypes.PDF))("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,5,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Ne(e,l){if(1&e){const s=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",21),t.bIt("click",function(){t.eBV(s);const n=t.XpG(2);return t.Njj(n.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(s);const n=t.XpG(2);return t.Njj(n.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&e){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",s.totalSelectedPage,"/",s.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",s.totalSelectedPage,"/",s.totalPage,")")}}function be(e,l){1&e&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function Fe(e,l){if(1&e&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",7)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&e){const s=l.$implicit,a=l.index;t.R7$(1),t.Y8G("hidden",!s.controls.isShow.value),t.R7$(1),t.Y8G("imageUrl",s.controls.imageLink.value),t.R7$(1),t.Y8G("src",s.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(a+1),t.R7$(1),t.Y8G("formControl",s.controls.isSelected)}}function Ge(e,l){if(1&e&&(t.j41(0,"div",31),t.DNE(1,Fe,8,5,"ng-container",32),t.k0s()),2&e){const s=t.XpG(2);t.R7$(1),t.Y8G("ngForOf",s.form.controls.bookPageFormArray.controls)}}const Ue=function(e){return{"error-border":e}};function $e(e,l){if(1&e){const s=t.RV6();t.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"h3",8),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",9)(8,"button",10),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",11),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",12)(15,"div",13)(16,"div",14)(17,"label",15),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",14)(21,"div",16),t.nrm(22,"input",17),t.k0s()()(),t.DNE(23,Pe,7,10,"div",18),t.nrm(24,"hr",19),t.j41(25,"span",20),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.selectAll(n.totalSelectedPage!=n.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",21),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,Ne,9,10,"span",22),t.j41(32,"div",23),t.DNE(33,be,3,3,"div",24),t.DNE(34,Ge,2,1,"ng-template",null,25,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",10),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",11),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&e){const s=t.sdS(35),a=t.XpG();t.R7$(1),t.Y8G("formGroup",a.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,a.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",a.form.invalid),t.R7$(1),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",a.form.controls.name)("ngClass",t.eq3(35,Ue,a.form.controls.name.invalid)),t.R7$(1),t.Y8G("ngIf",!a.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,a.totalSelectedPage!=a.totalPage?"lang_select_all":"lang_remove_all")," (",a.totalSelectedPage,"/",a.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",a.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",a.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",s),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",a.form.invalid),t.R7$(1),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let Le=(()=>{var e;class l extends ge{initForm(a){this.form.controls.name.setValue(a.bookObj.name),a.bookPageObjs.forEach(n=>{this.form.controls.bookPageFormArray.push(new b.gE({id:new b.MJ(n.id,{nonNullable:!0}),randomUuid:new b.MJ(n.id.toString(),{nonNullable:!0}),name:new b.MJ(n.name,{nonNullable:!0}),imageLink:new b.MJ(n.imageLink,{nonNullable:!0}),isShow:new b.MJ(!0,{nonNullable:!0}),isSelected:new b.MJ(!1,{nonNullable:!0}),needUpdate:new b.MJ(!1,{nonNullable:!0})}))})}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjGet(this.bookId).subscribe(a=>{if(!a.success||!a.data)return this.errorStatusObj(a.message,!0);this.initForm(a.data),this.stopStatusObj()}))}saveObj(){this.initStatusObj();let a=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookUpdateObjPost({id:this.bookId,name:a.name}).subscribe(c=>{if(!c.success)return this.errorStatusObj(c.message,!0);let d={bookId:this.bookId,objs:a.bookPageFormArray.filter(u=>u.needUpdate&&u.id).map(u=>({bookPageId:u.id,imageLink:u.imageLink}))},h={bookId:this.bookId,ids:a.bookPageFormArray.filter(u=>!u.isShow&&u.id).map(u=>u.id)};if(d.objs.length<=0)return this.processDeleteImages(h);this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateImagesPost(d).subscribe(u=>{this.processDeleteImages(h)}))}))}processDeleteImages(a){a.ids.length>0?this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageDeleteObjPost(a).subscribe(n=>{if(!n.success)return this.errorStatusObj(n.message,!0);this.successStatusObj("lang_cms_update_success",!0),this.cancel()})):(this.successStatusObj("lang_cms_update_success",!0),this.cancel())}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_edit_book_title",description:"lang_cms_admin_edit_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(a,n,c){super(),this.digitalizedBookService=a,this.digitalizedBookPageService=n,this.activeRoute=c,this.bookId=0}}return(e=l).\u0275fac=function(a){return new(a||e)(t.rXU(Y.ZD),t.rXU(Y.gI),t.rXU(k.nX))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-update-book"]],features:[t.Vt3],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"disabled","click"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],["viewBookPageTpl",""],[1,"text-right","mt-5"],[3,"uploadToCdnMenu","fileType","convertPdfToImages","showProgress","uploadComplete"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(a,n){if(1&a&&(t.j41(0,"teacher-layout",0),t.DNE(1,Me,1,1,"azt-loading-effect",1),t.DNE(2,$e,43,37,"ng-template",null,2,t.C5r),t.k0s()),2&a){const c=t.sdS(3);t.Y8G("headerBackToLink",n.backTo),t.R7$(1),t.Y8G("ngIf",1==n.statusObj.loading)("ngIfElse",c)}},dependencies:[x.YU,x.Sq,x.bT,b.qT,b.me,b.Zm,b.BC,b.cb,b.l_,b.j4,bt.K,N.V,It,vt.Q,S.WGl,O.wp],encapsulation:2}),l})();var Xe=f(75421),ve=f(25329);function Ve(e,l){if(1&e&&t.nrm(0,"azt-loading-effect",4),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function Ye(e,l){1&e&&(t.j41(0,"span",25),t.nrm(1,"azt-loading-ui"),t.k0s())}const Wt=function(){return{"mr-1":!0}};function We(e,l){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"mat-card",13)(2,"mat-card-content",14)(3,"div",15)(4,"div",6)(5,"b"),t.EFF(6),t.k0s(),t.EFF(7),t.k0s(),t.j41(8,"div",16)(9,"button",17),t.nI1(10,"navigationLocalize"),t.nrm(11,"lucide-icon",18),t.j41(12,"span",19),t.EFF(13),t.nI1(14,"mytranslate"),t.k0s()(),t.j41(15,"a",20),t.nI1(16,"navigationLocalize"),t.nrm(17,"lucide-icon",21),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s(),t.j41(20,"button",22),t.bIt("click",function(){const c=t.eBV(s).$implicit,d=t.XpG(3);return t.Njj(d.deleteObj(c))}),t.DNE(21,Ye,2,0,"span",23),t.nrm(22,"lucide-icon",24),t.j41(23,"span",19),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()()()(),t.bVm()}if(2&e){const s=l.$implicit,a=l.index,n=t.XpG(3);t.R7$(6),t.SpI("",a+1,"."),t.R7$(1),t.E5c(" ",s.name," (",s.totalDone," / ",s.totalPage,") "),t.R7$(2),t.Y8G("routerLink",t.bMT(10,13,"/azota-digitalized/digitalized-one-book/"+s.id+"/1")),t.R7$(2),t.Y8G("ngClass",t.lJ4(23,Wt)),t.R7$(2),t.JRh(t.bMT(14,15,"lang_cms_admin_digitalized_digitalized_btn")),t.R7$(2),t.Y8G("routerLink",t.bMT(16,17,"/azota-digitalized/edit-book/"+s.id)),t.R7$(2),t.Y8G("ngClass",t.lJ4(24,Wt)),t.R7$(1),t.SpI(" ",t.bMT(19,19,"lang_auto_sua")," "),t.R7$(3),t.Y8G("ngIf",n.deletingId==s.id),t.R7$(1),t.Y8G("ngClass",t.lJ4(25,Wt)),t.R7$(2),t.JRh(t.bMT(25,21,"lang_auto_xoa"))}}function He(e,l){if(1&e&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.DNE(3,We,26,26,"ng-container",12),t.k0s()(),t.bVm()),2&e){const s=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",s.objs)}}function Je(e,l){1&e&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(1),t.JRh(t.bMT(2,1,"lang_cms_admin_digitalized_there_is_no_book")))}const ke=function(e){return[e]};function p(e,l){if(1&e&&(t.j41(0,"div",5)(1,"span",6),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"a",7),t.nI1(5,"navigationLocalize"),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.DNE(8,He,4,1,"ng-container",8),t.DNE(9,Je,3,3,"ng-template",null,9,t.C5r)),2&e){const s=t.sdS(10),a=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"lang_cms_admin_common_digitalize_list_book")),t.R7$(2),t.Y8G("routerLink",t.eq3(11,ke,t.bMT(5,7,"/azota-digitalized/create-book"))),t.R7$(2),t.JRh(t.bMT(7,9,"lang_common_create")),t.R7$(2),t.Y8G("ngIf",a.objs.length>0)("ngIfElse",s)}}const r=[{path:"",children:[{path:"list-books",component:(()=>{var e;class l extends R.H{deleteObj(a){const n=this.commonService.myTranslateInstant("lang_cms_admin_digitalized_are_your_sure_to_delete_this_book")+`: <b>${a.name}<b/>?`;this.sAztDialogService.open(Xe.u,{data:{content:n},restoreFocus:!1,width:"500px"}).afterClosed().subscribe(c=>{c&&(this.deletingId=a.id,this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookDeleteObjPost({ids:[a.id]}).subscribe(d=>{if(this.deletingId=void 0,!d.success)return this.errorStatusObj(d.message,!0);this.objs=this.objs.filter(h=>h.id!=a.id)})))})}getData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjsGet().subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);this.objs=a.data?.objs??[],this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.getData(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_list_book",description:"lang_cms_admin_common_digitalize_list_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(a,n){super(),this.digitalizedBookService=a,this.sAztDialogService=n,this.headerBackTo="",this.objs=[]}}return(e=l).\u0275fac=function(a){return new(a||e)(t.rXU(Y.ZD),t.rXU(kt.i))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-list-books"]],features:[t.Vt3],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"flex","items-center","mb-3"],[1,"w-full"],[1,"flex-none","btn","btn-primary",3,"routerLink"],[4,"ngIf","ngIfElse"],["emptyList",""],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],["appearance","outlined",1,"mb-2",2,"background-color","#fff","border","none"],[1,"form-control",2,"overflow-y","auto"],[1,"flex","align-items-center"],[1,"flex-none","items-center"],[1,"btn","btn-sm","btn-success-soft","mr-2",3,"routerLink"],["name","eye","size","18",3,"ngClass"],[1,"azt-hidden","md:inline-block"],[1,"btn","btn-sm","btn-primary-soft","mr-2",3,"routerLink"],["name","square-pen","size","18",3,"ngClass"],[1,"btn","btn-sm","btn-danger-soft",3,"click"],["class","w-4 h-4 flex mr-1",4,"ngIf"],["name","trash-2","size","18",3,"ngClass"],[1,"w-4","h-4","flex","mr-1"],[1,"text-center"]],template:function(a,n){if(1&a&&(t.j41(0,"teacher-layout",0)(1,"div",1),t.DNE(2,Ve,1,1,"azt-loading-effect",2),t.DNE(3,p,11,13,"ng-template",null,3,t.C5r),t.k0s()()),2&a){const c=t.sdS(4);t.Y8G("headerBackToLink",n.headerBackTo),t.R7$(2),t.Y8G("ngIf",n.statusObj.loading)("ngIfElse",c)}},dependencies:[k.Wk,x.YU,x.Sq,x.bT,ve.RN,ve.m2,bt.K,$t.R,vt.Q,S.WGl,O.F2,O.wp],encapsulation:2}),l})()},{path:"create-book",component:Bt},{path:"edit-book/:bookId",component:Le},{path:"digitalized-one-book/:bookId/:page",component:Xt}]}];let o=(()=>{var e;class l{}return(e=l).\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[k.iI.forChild(r),k.iI,tt.XE]}),l})(),g=(()=>{var e;class l{}return(e=l).\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({providers:[{provide:ot.vn,useValue:q.c.azt_tiny_mce_script_src}],imports:[k.iI,x.MD,b.YN,ot.sv,jt.s,b.X1,o,Qt.Q,Ht.L,w.Id,Jt.b,S.flO.pick(S.Ptg),Tt.AC,At,St.An]}),l})()},17715:function(Ce){Ce.exports=function(){"use strict";function H(p){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(p)}function x(p,i){for(var r=0;r<i.length;r++){var o=i[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(p,o.key,o)}}function k(p,i,r){return i in p?Object.defineProperty(p,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):p[i]=r,p}function ot(p,i){var r=Object.keys(p);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(p);i&&(o=o.filter(function(g){return Object.getOwnPropertyDescriptor(p,g).enumerable})),r.push.apply(r,o)}return r}function t(p){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?ot(Object(r),!0).forEach(function(o){k(p,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(r)):ot(Object(r)).forEach(function(o){Object.defineProperty(p,o,Object.getOwnPropertyDescriptor(r,o))})}return p}function J(p){return function yt(p){if(Array.isArray(p))return V(p)}(p)||function Ot(p){if(typeof Symbol<"u"&&Symbol.iterator in Object(p))return Array.from(p)}(p)||function X(p,i){if(p){if("string"==typeof p)return V(p,i);var r=Object.prototype.toString.call(p).slice(8,-1);if("Object"===r&&p.constructor&&(r=p.constructor.name),"Map"===r||"Set"===r)return Array.from(p);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V(p,i)}}(p)||function Et(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(p,i){(null==i||i>p.length)&&(i=p.length);for(var r=0,o=new Array(i);r<i;r++)o[r]=p[r];return o}var At=typeof window<"u"&&typeof window.document<"u",S=At?window:{},Tt=!(!At||!S.document.documentElement)&&"ontouchstart"in S.document.documentElement,St=!!At&&"PointerEvent"in S,w="cropper",q="e",R="n",gt="ne",Y="nw",ht="se",W="sw",Rt="".concat(w,"-crop"),Zt="".concat(w,"-disabled"),M="".concat(w,"-hidden"),Kt="".concat(w,"-hide"),qt="".concat(w,"-invisible"),O="".concat(w,"-modal"),rt="".concat(w,"-move"),mt="".concat(w,"Action"),ut="".concat(w,"Preview"),ft="crop",Mt="crop",Pt="cropend",Nt="cropmove",Ft="cropstart",Gt="dblclick",ie=St?"pointerdown":Tt?"touchstart":"mousedown",ae=St?"pointermove":Tt?"touchmove":"mousemove",Ut=St?"pointerup pointercancel":Tt?"touchend touchcancel":"mouseup",kt="zoom",ne="image/jpeg",we=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,It=/^data:/,re=/^data:image\/jpeg;base64,/,ye=/^img|canvas$/i,ce={viewMode:0,dragMode:ft,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Oe=Number.isNaN||S.isNaN;function v(p){return"number"==typeof p&&!Oe(p)}var pe=function(i){return i>0&&i<1/0};function Lt(p){return typeof p>"u"}function et(p){return"object"===H(p)&&null!==p}var Ae=Object.prototype.hasOwnProperty;function st(p){if(!et(p))return!1;try{var i=p.constructor,r=i.prototype;return i&&r&&Ae.call(r,"isPrototypeOf")}catch{return!1}}function P(p){return"function"==typeof p}var Ie=Array.prototype.slice;function de(p){return Array.from?Array.from(p):Ie.call(p)}function A(p,i){return p&&P(i)&&(Array.isArray(p)||v(p.length)?de(p).forEach(function(r,o){i.call(p,r,o,p)}):et(p)&&Object.keys(p).forEach(function(r){i.call(p,p[r],r,p)})),p}var y=Object.assign||function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),g=1;g<r;g++)o[g-1]=arguments[g];return et(i)&&o.length>0&&o.forEach(function(e){et(e)&&Object.keys(e).forEach(function(l){i[l]=e[l]})}),i},Be=/\.\d*(?:0|9){12}\d*$/;function lt(p){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Be.test(p)?Math.round(p*i)/i:p}var Ee=/^width|height|left|top|marginLeft|marginTop$/;function Q(p,i){var r=p.style;A(i,function(o,g){Ee.test(g)&&v(o)&&(o="".concat(o,"px")),r[g]=o})}function I(p,i){if(i){if(v(p.length))return void A(p,function(o){I(o,i)});if(p.classList)return void p.classList.add(i);var r=p.className.trim();r?r.indexOf(i)<0&&(p.className="".concat(r," ").concat(i)):p.className=i}}function $(p,i){if(i){if(v(p.length))return void A(p,function(r){$(r,i)});if(p.classList)return void p.classList.remove(i);p.className.indexOf(i)>=0&&(p.className=p.className.replace(i,""))}}function ct(p,i,r){if(i){if(v(p.length))return void A(p,function(o){ct(o,i,r)});r?I(p,i):$(p,i)}}var Se=/([a-z\d])([A-Z])/g;function Xt(p){return p.replace(Se,"$1-$2").toLowerCase()}function Vt(p,i){return et(p[i])?p[i]:p.dataset?p.dataset[i]:p.getAttribute("data-".concat(Xt(i)))}function zt(p,i,r){et(r)?p[i]=r:p.dataset?p.dataset[i]=r:p.setAttribute("data-".concat(Xt(i)),r)}var he=/\s\s*/,me=function(){var p=!1;if(At){var i=!1,r=function(){},o=Object.defineProperty({},"once",{get:function(){return p=!0,i},set:function(e){i=e}});S.addEventListener("test",r,o),S.removeEventListener("test",r,o)}return p}();function N(p,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=r;i.trim().split(he).forEach(function(e){if(!me){var l=p.listeners;l&&l[e]&&l[e][r]&&(g=l[e][r],delete l[e][r],0===Object.keys(l[e]).length&&delete l[e],0===Object.keys(l).length&&delete p.listeners)}p.removeEventListener(e,g,o)})}function F(p,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=r;i.trim().split(he).forEach(function(e){if(o.once&&!me){var l=p.listeners,s=void 0===l?{}:l;g=function(){delete s[e][r],p.removeEventListener(e,g,o);for(var n=arguments.length,c=new Array(n),d=0;d<n;d++)c[d]=arguments[d];r.apply(p,c)},s[e]||(s[e]={}),s[e][r]&&p.removeEventListener(e,s[e][r],o),s[e][r]=g,p.listeners=s}p.addEventListener(e,g,o)})}function pt(p,i,r){var o;return P(Event)&&P(CustomEvent)?o=new CustomEvent(i,{detail:r,bubbles:!0,cancelable:!0}):(o=document.createEvent("CustomEvent")).initCustomEvent(i,!0,!0,r),p.dispatchEvent(o)}function ue(p){var i=p.getBoundingClientRect();return{left:i.left+(window.pageXOffset-document.documentElement.clientLeft),top:i.top+(window.pageYOffset-document.documentElement.clientTop)}}var Yt=S.location,je=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function fe(p){var i=p.match(je);return null!==i&&(i[1]!==Yt.protocol||i[2]!==Yt.hostname||i[3]!==Yt.port)}function _e(p){var i="timestamp=".concat((new Date).getTime());return p+(-1===p.indexOf("?")?"?":"&")+i}function Ct(p){var i=p.rotate,r=p.scaleX,o=p.scaleY,g=p.translateX,e=p.translateY,l=[];v(g)&&0!==g&&l.push("translateX(".concat(g,"px)")),v(e)&&0!==e&&l.push("translateY(".concat(e,"px)")),v(i)&&0!==i&&l.push("rotate(".concat(i,"deg)")),v(r)&&1!==r&&l.push("scaleX(".concat(r,")")),v(o)&&1!==o&&l.push("scaleY(".concat(o,")"));var s=l.length?l.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function Bt(p,i){var r=p.pageX,o=p.pageY,g={endX:r,endY:o};return i?g:t({startX:r,startY:o},g)}function Z(p){var i=p.aspectRatio,r=p.height,o=p.width,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",e=pe(o),l=pe(r);if(e&&l){var s=r*i;"contain"===g&&s>o||"cover"===g&&s<o?r=o/i:o=r*i}else e?r=o/i:l&&(o=r*i);return{width:o,height:r}}var be=String.fromCharCode;var Ge=/^data:.*,/;function Le(p){var r,i=new DataView(p);try{var o,g,e;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var l=i.byteLength,s=2;s+1<l;){if(255===i.getUint8(s)&&225===i.getUint8(s+1)){g=s;break}s+=1}if(g){var n=g+10;if("Exif"===function Fe(p,i,r){var o="";r+=i;for(var g=i;g<r;g+=1)o+=be(p.getUint8(g));return o}(i,g+4,4)){var c=i.getUint16(n);if(((o=18761===c)||19789===c)&&42===i.getUint16(n+2,o)){var d=i.getUint32(n+4,o);d>=8&&(e=n+d)}}}if(e){var u,_,h=i.getUint16(e,o);for(_=0;_<h;_+=1)if(274===i.getUint16(u=e+12*_+2,o)){r=i.getUint16(u+=8,o),i.setUint16(u,1,o);break}}}catch{r=1}return r}var ve={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var i=this.element,r=this.options,o=this.container,g=this.cropper,e=Number(r.minContainerWidth),l=Number(r.minContainerHeight);I(g,M),$(i,M);var s={width:Math.max(o.offsetWidth,e>=0?e:200),height:Math.max(o.offsetHeight,l>=0?l:100)};this.containerData=s,Q(g,{width:s.width,height:s.height}),I(i,M),$(g,M)},initCanvas:function(){var i=this.containerData,r=this.imageData,o=this.options.viewMode,g=Math.abs(r.rotate)%180==90,e=g?r.naturalHeight:r.naturalWidth,l=g?r.naturalWidth:r.naturalHeight,s=e/l,a=i.width,n=i.height;i.height*s>i.width?3===o?a=i.height*s:n=i.width/s:3===o?n=i.width/s:a=i.height*s;var c={aspectRatio:s,naturalWidth:e,naturalHeight:l,width:a,height:n};this.canvasData=c,this.limited=1===o||2===o,this.limitCanvas(!0,!0),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),c.left=(i.width-c.width)/2,c.top=(i.height-c.height)/2,c.oldLeft=c.left,c.oldTop=c.top,this.initialCanvasData=y({},c)},limitCanvas:function(i,r){var o=this.options,g=this.containerData,e=this.canvasData,l=this.cropBoxData,s=o.viewMode,a=e.aspectRatio,n=this.cropped&&l;if(i){var c=Number(o.minCanvasWidth)||0,d=Number(o.minCanvasHeight)||0;s>1?(c=Math.max(c,g.width),d=Math.max(d,g.height),3===s&&(d*a>c?c=d*a:d=c/a)):s>0&&(c?c=Math.max(c,n?l.width:0):d?d=Math.max(d,n?l.height:0):n&&((d=l.height)*a>(c=l.width)?c=d*a:d=c/a));var h=Z({aspectRatio:a,width:c,height:d});d=h.height,e.minWidth=c=h.width,e.minHeight=d,e.maxWidth=1/0,e.maxHeight=1/0}if(r)if(s>(n?0:1)){var u=g.width-e.width,_=g.height-e.height;e.minLeft=Math.min(0,u),e.minTop=Math.min(0,_),e.maxLeft=Math.max(0,u),e.maxTop=Math.max(0,_),n&&this.limited&&(e.minLeft=Math.min(l.left,l.left+(l.width-e.width)),e.minTop=Math.min(l.top,l.top+(l.height-e.height)),e.maxLeft=l.left,e.maxTop=l.top,2===s&&(e.width>=g.width&&(e.minLeft=Math.min(0,u),e.maxLeft=Math.max(0,u)),e.height>=g.height&&(e.minTop=Math.min(0,_),e.maxTop=Math.max(0,_))))}else e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=g.width,e.maxTop=g.height},renderCanvas:function(i,r){var o=this.canvasData,g=this.imageData;if(r){var e=function Pe(p){var i=p.width,r=p.height,o=p.degree;if(90==(o=Math.abs(o)%180))return{width:r,height:i};var g=o%90*Math.PI/180,e=Math.sin(g),l=Math.cos(g),s=i*l+r*e,a=i*e+r*l;return o>90?{width:a,height:s}:{width:s,height:a}}({width:g.naturalWidth*Math.abs(g.scaleX||1),height:g.naturalHeight*Math.abs(g.scaleY||1),degree:g.rotate||0}),l=e.width,s=e.height,a=o.width*(l/o.naturalWidth),n=o.height*(s/o.naturalHeight);o.left-=(a-o.width)/2,o.top-=(n-o.height)/2,o.width=a,o.height=n,o.aspectRatio=l/s,o.naturalWidth=l,o.naturalHeight=s,this.limitCanvas(!0,!1)}(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),this.limitCanvas(!1,!0),o.left=Math.min(Math.max(o.left,o.minLeft),o.maxLeft),o.top=Math.min(Math.max(o.top,o.minTop),o.maxTop),o.oldLeft=o.left,o.oldTop=o.top,Q(this.canvas,y({width:o.width,height:o.height},Ct({translateX:o.left,translateY:o.top}))),this.renderImage(i),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(i){var r=this.canvasData,o=this.imageData,g=o.naturalWidth*(r.width/r.naturalWidth),e=o.naturalHeight*(r.height/r.naturalHeight);y(o,{width:g,height:e,left:(r.width-g)/2,top:(r.height-e)/2}),Q(this.image,y({width:o.width,height:o.height},Ct(y({translateX:o.left,translateY:o.top},o)))),i&&this.output()},initCropBox:function(){var i=this.options,r=this.canvasData,o=i.aspectRatio||i.initialAspectRatio,g=Number(i.autoCropArea)||.8,e={width:r.width,height:r.height};o&&(r.height*o>r.width?e.height=e.width/o:e.width=e.height*o),this.cropBoxData=e,this.limitCropBox(!0,!0),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),e.width=Math.max(e.minWidth,e.width*g),e.height=Math.max(e.minHeight,e.height*g),e.left=r.left+(r.width-e.width)/2,e.top=r.top+(r.height-e.height)/2,e.oldLeft=e.left,e.oldTop=e.top,this.initialCropBoxData=y({},e)},limitCropBox:function(i,r){var o=this.options,g=this.containerData,e=this.canvasData,l=this.cropBoxData,s=this.limited,a=o.aspectRatio;if(i){var n=Number(o.minCropBoxWidth)||0,c=Number(o.minCropBoxHeight)||0,d=s?Math.min(g.width,e.width,e.width+e.left,g.width-e.left):g.width,h=s?Math.min(g.height,e.height,e.height+e.top,g.height-e.top):g.height;n=Math.min(n,g.width),c=Math.min(c,g.height),a&&(n&&c?c*a>n?c=n/a:n=c*a:n?c=n/a:c&&(n=c*a),h*a>d?h=d/a:d=h*a),l.minWidth=Math.min(n,d),l.minHeight=Math.min(c,h),l.maxWidth=d,l.maxHeight=h}r&&(s?(l.minLeft=Math.max(0,e.left),l.minTop=Math.max(0,e.top),l.maxLeft=Math.min(g.width,e.left+e.width)-l.width,l.maxTop=Math.min(g.height,e.top+e.height)-l.height):(l.minLeft=0,l.minTop=0,l.maxLeft=g.width-l.width,l.maxTop=g.height-l.height))},renderCropBox:function(){var i=this.options,r=this.containerData,o=this.cropBoxData;(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),this.limitCropBox(!1,!0),o.left=Math.min(Math.max(o.left,o.minLeft),o.maxLeft),o.top=Math.min(Math.max(o.top,o.minTop),o.maxTop),o.oldLeft=o.left,o.oldTop=o.top,i.movable&&i.cropBoxMovable&&zt(this.face,mt,o.width>=r.width&&o.height>=r.height?"move":"all"),Q(this.cropBox,y({width:o.width,height:o.height},Ct({translateX:o.left,translateY:o.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),pt(this.element,Mt,this.getData())}},Ve={initPreview:function(){var i=this.element,r=this.crossOrigin,o=this.options.preview,g=r?this.crossOriginUrl:this.url,e=i.alt||"The image to preview",l=document.createElement("img");if(r&&(l.crossOrigin=r),l.src=g,l.alt=e,this.viewBox.appendChild(l),this.viewBoxImage=l,o){var s=o;"string"==typeof o?s=i.ownerDocument.querySelectorAll(o):o.querySelector&&(s=[o]),this.previews=s,A(s,function(a){var n=document.createElement("img");zt(a,ut,{width:a.offsetWidth,height:a.offsetHeight,html:a.innerHTML}),r&&(n.crossOrigin=r),n.src=g,n.alt=e,n.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',a.innerHTML="",a.appendChild(n)})}},resetPreview:function(){A(this.previews,function(i){var r=Vt(i,ut);Q(i,{width:r.width,height:r.height}),i.innerHTML=r.html,function ge(p,i){if(et(p[i]))try{delete p[i]}catch{p[i]=void 0}else if(p.dataset)try{delete p.dataset[i]}catch{p.dataset[i]=void 0}else p.removeAttribute("data-".concat(Xt(i)))}(i,ut)})},preview:function(){var i=this.imageData,r=this.canvasData,o=this.cropBoxData,g=o.width,e=o.height,l=i.width,s=i.height,a=o.left-r.left-i.left,n=o.top-r.top-i.top;!this.cropped||this.disabled||(Q(this.viewBoxImage,y({width:l,height:s},Ct(y({translateX:-a,translateY:-n},i)))),A(this.previews,function(c){var d=Vt(c,ut),h=d.width,u=d.height,_=h,z=u,C=1;g&&(z=e*(C=h/g)),e&&z>u&&(_=g*(C=u/e),z=u),Q(c,{width:_,height:z}),Q(c.getElementsByTagName("img")[0],y({width:l*C,height:s*C},Ct(y({translateX:-a*C,translateY:-n*C},i))))}))}},Ye={bind:function(){var i=this.element,r=this.options,o=this.cropper;P(r.cropstart)&&F(i,Ft,r.cropstart),P(r.cropmove)&&F(i,Nt,r.cropmove),P(r.cropend)&&F(i,Pt,r.cropend),P(r.crop)&&F(i,Mt,r.crop),P(r.zoom)&&F(i,kt,r.zoom),F(o,ie,this.onCropStart=this.cropStart.bind(this)),r.zoomable&&r.zoomOnWheel&&F(o,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),r.toggleDragModeOnDblclick&&F(o,Gt,this.onDblclick=this.dblclick.bind(this)),F(i.ownerDocument,ae,this.onCropMove=this.cropMove.bind(this)),F(i.ownerDocument,Ut,this.onCropEnd=this.cropEnd.bind(this)),r.responsive&&F(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var i=this.element,r=this.options,o=this.cropper;P(r.cropstart)&&N(i,Ft,r.cropstart),P(r.cropmove)&&N(i,Nt,r.cropmove),P(r.cropend)&&N(i,Pt,r.cropend),P(r.crop)&&N(i,Mt,r.crop),P(r.zoom)&&N(i,kt,r.zoom),N(o,ie,this.onCropStart),r.zoomable&&r.zoomOnWheel&&N(o,"wheel",this.onWheel,{passive:!1,capture:!0}),r.toggleDragModeOnDblclick&&N(o,Gt,this.onDblclick),N(i.ownerDocument,ae,this.onCropMove),N(i.ownerDocument,Ut,this.onCropEnd),r.responsive&&N(window,"resize",this.onResize)}},Wt={resize:function(){if(!this.disabled){var e,l,i=this.options,r=this.container,o=this.containerData,g=r.offsetWidth/o.width;1===g&&r.offsetHeight===o.height||(i.restore&&(e=this.getCanvasData(),l=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(A(e,function(s,a){e[a]=s*g})),this.setCropBoxData(A(l,function(s,a){l[a]=s*g}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(function Te(p,i){return p.classList?p.classList.contains(i):p.className.indexOf(i)>-1}(this.dragBox,Rt)?"move":ft)},wheel:function(i){var r=this,o=Number(this.options.wheelZoomRatio)||.1,g=1;this.disabled||(i.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){r.wheeling=!1},50),i.deltaY?g=i.deltaY>0?1:-1:i.wheelDelta?g=-i.wheelDelta/120:i.detail&&(g=i.detail>0?1:-1),this.zoom(-g*o,i)))},cropStart:function(i){var r=i.buttons,o=i.button;if(!(this.disabled||("mousedown"===i.type||"pointerdown"===i.type&&"mouse"===i.pointerType)&&(v(r)&&1!==r||v(o)&&0!==o||i.ctrlKey))){var l,g=this.options,e=this.pointers;i.changedTouches?A(i.changedTouches,function(s){e[s.identifier]=Bt(s)}):e[i.pointerId||0]=Bt(i),l=Object.keys(e).length>1&&g.zoomable&&g.zoomOnTouch?"zoom":Vt(i.target,mt),we.test(l)&&!1!==pt(this.element,Ft,{originalEvent:i,action:l})&&(i.preventDefault(),this.action=l,this.cropping=!1,"crop"===l&&(this.cropping=!0,I(this.dragBox,O)))}},cropMove:function(i){var r=this.action;if(!this.disabled&&r){var o=this.pointers;i.preventDefault(),!1!==pt(this.element,Nt,{originalEvent:i,action:r})&&(i.changedTouches?A(i.changedTouches,function(g){y(o[g.identifier]||{},Bt(g,!0))}):y(o[i.pointerId||0]||{},Bt(i,!0)),this.change(i))}},cropEnd:function(i){if(!this.disabled){var r=this.action,o=this.pointers;i.changedTouches?A(i.changedTouches,function(g){delete o[g.identifier]}):delete o[i.pointerId||0],r&&(i.preventDefault(),Object.keys(o).length||(this.action=""),this.cropping&&(this.cropping=!1,ct(this.dragBox,O,this.cropped&&this.options.modal)),pt(this.element,Pt,{originalEvent:i,action:r}))}}},We={change:function(i){var it,o=this.canvasData,g=this.containerData,e=this.cropBoxData,l=this.pointers,s=this.action,a=this.options.aspectRatio,n=e.left,c=e.top,d=e.width,h=e.height,u=n+d,_=c+h,z=0,C=0,E=g.width,j=g.height,B=!0;!a&&i.shiftKey&&(a=d&&h?d/h:1),this.limited&&(C=e.minTop,E=(z=e.minLeft)+Math.min(g.width,o.width,o.left+o.width),j=C+Math.min(g.height,o.height,o.top+o.height));var U=l[Object.keys(l)[0]],m={x:U.endX-U.startX,y:U.endY-U.startY},D=function(L){switch(L){case q:u+m.x>E&&(m.x=E-u);break;case"w":n+m.x<z&&(m.x=z-n);break;case R:c+m.y<C&&(m.y=C-c);break;case"s":_+m.y>j&&(m.y=j-_)}};switch(s){case"all":n+=m.x,c+=m.y;break;case q:if(m.x>=0&&(u>=E||a&&(c<=C||_>=j))){B=!1;break}D(q),(d+=m.x)<0&&(s="w",n-=d=-d),a&&(c+=(e.height-(h=d/a))/2);break;case R:if(m.y<=0&&(c<=C||a&&(n<=z||u>=E))){B=!1;break}D(R),c+=m.y,(h-=m.y)<0&&(s="s",c-=h=-h),a&&(n+=(e.width-(d=h*a))/2);break;case"w":if(m.x<=0&&(n<=z||a&&(c<=C||_>=j))){B=!1;break}D("w"),n+=m.x,(d-=m.x)<0&&(s=q,n-=d=-d),a&&(c+=(e.height-(h=d/a))/2);break;case"s":if(m.y>=0&&(_>=j||a&&(n<=z||u>=E))){B=!1;break}D("s"),(h+=m.y)<0&&(s=R,c-=h=-h),a&&(n+=(e.width-(d=h*a))/2);break;case gt:if(a){if(m.y<=0&&(c<=C||u>=E)){B=!1;break}D(R),c+=m.y,d=(h-=m.y)*a}else D(R),D(q),m.x>=0?u<E?d+=m.x:m.y<=0&&c<=C&&(B=!1):d+=m.x,m.y<=0?c>C&&(h-=m.y,c+=m.y):(h-=m.y,c+=m.y);d<0&&h<0?(s=W,c-=h=-h,n-=d=-d):d<0?(s=Y,n-=d=-d):h<0&&(s=ht,c-=h=-h);break;case Y:if(a){if(m.y<=0&&(c<=C||n<=z)){B=!1;break}D(R),c+=m.y,n+=e.width-(d=(h-=m.y)*a)}else D(R),D("w"),m.x<=0?n>z?(d-=m.x,n+=m.x):m.y<=0&&c<=C&&(B=!1):(d-=m.x,n+=m.x),m.y<=0?c>C&&(h-=m.y,c+=m.y):(h-=m.y,c+=m.y);d<0&&h<0?(s=ht,c-=h=-h,n-=d=-d):d<0?(s=gt,n-=d=-d):h<0&&(s=W,c-=h=-h);break;case W:if(a){if(m.x<=0&&(n<=z||_>=j)){B=!1;break}D("w"),n+=m.x,h=(d-=m.x)/a}else D("s"),D("w"),m.x<=0?n>z?(d-=m.x,n+=m.x):m.y>=0&&_>=j&&(B=!1):(d-=m.x,n+=m.x),m.y>=0?_<j&&(h+=m.y):h+=m.y;d<0&&h<0?(s=gt,c-=h=-h,n-=d=-d):d<0?(s=ht,n-=d=-d):h<0&&(s=Y,c-=h=-h);break;case ht:if(a){if(m.x>=0&&(u>=E||_>=j)){B=!1;break}D(q),h=(d+=m.x)/a}else D("s"),D(q),m.x>=0?u<E?d+=m.x:m.y>=0&&_>=j&&(B=!1):d+=m.x,m.y>=0?_<j&&(h+=m.y):h+=m.y;d<0&&h<0?(s=Y,c-=h=-h,n-=d=-d):d<0?(s=W,n-=d=-d):h<0&&(s=gt,c-=h=-h);break;case"move":this.move(m.x,m.y),B=!1;break;case"zoom":this.zoom(function Re(p){var i=t({},p),r=0;return A(p,function(o,g){delete i[g],A(i,function(e){var l=Math.abs(o.startX-e.startX),s=Math.abs(o.startY-e.startY),a=Math.abs(o.endX-e.endX),n=Math.abs(o.endY-e.endY),c=Math.sqrt(l*l+s*s),h=(Math.sqrt(a*a+n*n)-c)/c;Math.abs(h)>Math.abs(r)&&(r=h)})}),r}(l),i),B=!1;break;case"crop":if(!m.x||!m.y){B=!1;break}it=ue(this.cropper),n=U.startX-it.left,c=U.startY-it.top,d=e.minWidth,h=e.minHeight,m.x>0?s=m.y>0?ht:gt:m.x<0&&(n-=d,s=m.y>0?W:Y),m.y<0&&(c-=h),this.cropped||($(this.cropBox,M),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}B&&(e.width=d,e.height=h,e.left=n,e.top=c,this.action=s,this.renderCropBox()),A(l,function(T){T.startX=T.endX,T.startY=T.endY})}},He={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&I(this.dragBox,O),$(this.cropBox,M),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=y({},this.initialImageData),this.canvasData=y({},this.initialCanvasData),this.cropBoxData=y({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(y(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),$(this.dragBox,O),I(this.cropBox,M)),this},replace:function(i){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&i&&(this.isImg&&(this.element.src=i),r?(this.url=i,this.image.src=i,this.ready&&(this.viewBoxImage.src=i,A(this.previews,function(o){o.getElementsByTagName("img")[0].src=i}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(i))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,$(this.cropper,Zt)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,I(this.cropper,Zt)),this},destroy:function(){var i=this.element;return i[w]?(i[w]=void 0,this.isImg&&this.replaced&&(i.src=this.originalUrl),this.uncreate(),this):this},move:function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,o=this.canvasData,g=o.left,e=o.top;return this.moveTo(Lt(i)?i:g+Number(i),Lt(r)?r:e+Number(r))},moveTo:function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,o=this.canvasData,g=!1;return i=Number(i),r=Number(r),this.ready&&!this.disabled&&this.options.movable&&(v(i)&&(o.left=i,g=!0),v(r)&&(o.top=r,g=!0),g&&this.renderCanvas(!0)),this},zoom:function(i,r){var o=this.canvasData;return i=Number(i),this.zoomTo(o.width*(i=i<0?1/(1-i):1+i)/o.naturalWidth,null,r)},zoomTo:function(i,r,o){var g=this.options,e=this.canvasData,l=e.width,s=e.height,a=e.naturalWidth,n=e.naturalHeight;if((i=Number(i))>=0&&this.ready&&!this.disabled&&g.zoomable){var c=a*i,d=n*i;if(!1===pt(this.element,kt,{ratio:i,oldRatio:l/a,originalEvent:o}))return this;if(o){var h=this.pointers,u=ue(this.cropper),_=h&&Object.keys(h).length?function Me(p){var i=0,r=0,o=0;return A(p,function(g){i+=g.startX,r+=g.startY,o+=1}),{pageX:i/=o,pageY:r/=o}}(h):{pageX:o.pageX,pageY:o.pageY};e.left-=(_.pageX-u.left-e.left)/l*(c-l),e.top-=(_.pageY-u.top-e.top)/s*(d-s)}else st(r)&&v(r.x)&&v(r.y)?(e.left-=(r.x-e.left)/l*(c-l),e.top-=(r.y-e.top)/s*(d-s)):(e.left-=(c-l)/2,e.top-=(d-s)/2);e.width=c,e.height=d,this.renderCanvas(!0)}return this},rotate:function(i){return this.rotateTo((this.imageData.rotate||0)+Number(i))},rotateTo:function(i){return v(i=Number(i))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=i%360,this.renderCanvas(!0,!0)),this},scaleX:function(i){var r=this.imageData.scaleY;return this.scale(i,v(r)?r:1)},scaleY:function(i){var r=this.imageData.scaleX;return this.scale(v(r)?r:1,i)},scale:function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,o=this.imageData,g=!1;return i=Number(i),r=Number(r),this.ready&&!this.disabled&&this.options.scalable&&(v(i)&&(o.scaleX=i,g=!0),v(r)&&(o.scaleY=r,g=!0),g&&this.renderCanvas(!0,!0)),this},getData:function(){var l,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.options,o=this.imageData,g=this.canvasData,e=this.cropBoxData;if(this.ready&&this.cropped){var s=o.width/o.naturalWidth;if(A(l={x:e.left-g.left,y:e.top-g.top,width:e.width,height:e.height},function(c,d){l[d]=c/s}),i){var a=Math.round(l.y+l.height),n=Math.round(l.x+l.width);l.x=Math.round(l.x),l.y=Math.round(l.y),l.width=n-l.x,l.height=a-l.y}}else l={x:0,y:0,width:0,height:0};return r.rotatable&&(l.rotate=o.rotate||0),r.scalable&&(l.scaleX=o.scaleX||1,l.scaleY=o.scaleY||1),l},setData:function(i){var r=this.options,o=this.imageData,g=this.canvasData,e={};if(this.ready&&!this.disabled&&st(i)){var l=!1;r.rotatable&&v(i.rotate)&&i.rotate!==o.rotate&&(o.rotate=i.rotate,l=!0),r.scalable&&(v(i.scaleX)&&i.scaleX!==o.scaleX&&(o.scaleX=i.scaleX,l=!0),v(i.scaleY)&&i.scaleY!==o.scaleY&&(o.scaleY=i.scaleY,l=!0)),l&&this.renderCanvas(!0,!0);var s=o.width/o.naturalWidth;v(i.x)&&(e.left=i.x*s+g.left),v(i.y)&&(e.top=i.y*s+g.top),v(i.width)&&(e.width=i.width*s),v(i.height)&&(e.height=i.height*s),this.setCropBoxData(e)}return this},getContainerData:function(){return this.ready?y({},this.containerData):{}},getImageData:function(){return this.sized?y({},this.imageData):{}},getCanvasData:function(){var i=this.canvasData,r={};return this.ready&&A(["left","top","width","height","naturalWidth","naturalHeight"],function(o){r[o]=i[o]}),r},setCanvasData:function(i){var r=this.canvasData,o=r.aspectRatio;return this.ready&&!this.disabled&&st(i)&&(v(i.left)&&(r.left=i.left),v(i.top)&&(r.top=i.top),v(i.width)?(r.width=i.width,r.height=i.width/o):v(i.height)&&(r.height=i.height,r.width=i.height*o),this.renderCanvas(!0)),this},getCropBoxData:function(){var r,i=this.cropBoxData;return this.ready&&this.cropped&&(r={left:i.left,top:i.top,width:i.width,height:i.height}),r||{}},setCropBoxData:function(i){var g,e,r=this.cropBoxData,o=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&st(i)&&(v(i.left)&&(r.left=i.left),v(i.top)&&(r.top=i.top),v(i.width)&&i.width!==r.width&&(g=!0,r.width=i.width),v(i.height)&&i.height!==r.height&&(e=!0,r.height=i.height),o&&(g?r.height=r.width/o:e&&(r.width=r.height*o)),this.renderCropBox()),this},getCroppedCanvas:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var r=this.canvasData,o=function Ne(p,i,r,o){var g=i.aspectRatio,e=i.naturalWidth,l=i.naturalHeight,s=i.rotate,a=void 0===s?0:s,n=i.scaleX,c=void 0===n?1:n,d=i.scaleY,h=void 0===d?1:d,u=r.aspectRatio,_=r.naturalWidth,z=r.naturalHeight,C=o.fillColor,E=void 0===C?"transparent":C,j=o.imageSmoothingEnabled,B=void 0===j||j,it=o.imageSmoothingQuality,U=void 0===it?"low":it,m=o.maxWidth,D=void 0===m?1/0:m,T=o.maxHeight,L=void 0===T?1/0:T,at=o.minWidth,Dt=void 0===at?0:at,xt=o.minHeight,dt=void 0===xt?0:xt,K=document.createElement("canvas"),G=K.getContext("2d"),wt=Z({aspectRatio:u,width:D,height:L}),ze=Z({aspectRatio:u,width:Dt,height:dt},"cover"),Qe=Math.min(wt.width,Math.max(ze.width,_)),Ze=Math.min(wt.height,Math.max(ze.height,z)),Ke=Z({aspectRatio:g,width:D,height:L}),qe=Z({aspectRatio:g,width:Dt,height:dt},"cover"),ti=Math.min(Ke.width,Math.max(qe.width,e)),ei=Math.min(Ke.height,Math.max(qe.height,l)),ii=[-ti/2,-ei/2,ti,ei];return K.width=lt(Qe),K.height=lt(Ze),G.fillStyle=E,G.fillRect(0,0,Qe,Ze),G.save(),G.translate(Qe/2,Ze/2),G.rotate(a*Math.PI/180),G.scale(c,h),G.imageSmoothingEnabled=B,G.imageSmoothingQuality=U,G.drawImage.apply(G,[p].concat(J(ii.map(function(ai){return Math.floor(lt(ai))})))),G.restore(),K}(this.image,this.imageData,r,i);if(!this.cropped)return o;var g=this.getData(),e=g.x,l=g.y,s=g.width,a=g.height,n=o.width/Math.floor(r.naturalWidth);1!==n&&(e*=n,l*=n,s*=n,a*=n);var c=s/a,d=Z({aspectRatio:c,width:i.maxWidth||1/0,height:i.maxHeight||1/0}),h=Z({aspectRatio:c,width:i.minWidth||0,height:i.minHeight||0},"cover"),u=Z({aspectRatio:c,width:i.width||(1!==n?o.width:s),height:i.height||(1!==n?o.height:a)}),_=u.width,z=u.height;_=Math.min(d.width,Math.max(h.width,_)),z=Math.min(d.height,Math.max(h.height,z));var C=document.createElement("canvas"),E=C.getContext("2d");C.width=lt(_),C.height=lt(z),E.fillStyle=i.fillColor||"transparent",E.fillRect(0,0,_,z);var j=i.imageSmoothingEnabled,it=i.imageSmoothingQuality;E.imageSmoothingEnabled=void 0===j||j,it&&(E.imageSmoothingQuality=it);var L,at,Dt,xt,dt,K,U=o.width,m=o.height,D=e,T=l;D<=-s||D>U?(D=0,L=0,Dt=0,dt=0):D<=0?(Dt=-D,D=0,dt=L=Math.min(U,s+D)):D<=U&&(Dt=0,dt=L=Math.min(s,U-D)),L<=0||T<=-a||T>m?(T=0,at=0,xt=0,K=0):T<=0?(xt=-T,T=0,K=at=Math.min(m,a+T)):T<=m&&(xt=0,K=at=Math.min(a,m-T));var G=[D,T,L,at];if(dt>0&&K>0){var wt=_/s;G.push(Dt*wt,xt*wt,dt*wt,K*wt)}return E.drawImage.apply(E,[o].concat(J(G.map(function(ze){return Math.floor(lt(ze))})))),C},setAspectRatio:function(i){var r=this.options;return!this.disabled&&!Lt(i)&&(r.aspectRatio=Math.max(0,i)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(i){var r=this.options,o=this.dragBox,g=this.face;if(this.ready&&!this.disabled){var e=i===ft,l=r.movable&&"move"===i;r.dragMode=i=e||l?i:"none",zt(o,mt,i),ct(o,Rt,e),ct(o,rt,l),r.cropBoxMovable||(zt(g,mt,i),ct(g,Rt,e),ct(g,rt,l))}return this}},Je=S.Cropper,ke=function(){function p(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function f(p,i){if(!(p instanceof i))throw new TypeError("Cannot call a class as a function")}(this,p),!i||!ye.test(i.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=i,this.options=y({},ce,st(r)&&r),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return function b(p,i,r){return i&&x(p.prototype,i),r&&x(p,r),p}(p,[{key:"init",value:function(){var g,r=this.element,o=r.tagName.toLowerCase();if(!r[w]){if(r[w]=this,"img"===o){if(this.isImg=!0,g=r.getAttribute("src")||"",this.originalUrl=g,!g)return;g=r.src}else"canvas"===o&&window.HTMLCanvasElement&&(g=r.toDataURL());this.load(g)}}},{key:"load",value:function(r){var o=this;if(r){this.url=r,this.imageData={};var g=this.element,e=this.options;if(!e.rotatable&&!e.scalable&&(e.checkOrientation=!1),!e.checkOrientation||!window.ArrayBuffer)return void this.clone();if(It.test(r))return void(re.test(r)?this.read(function Ue(p){var i=p.replace(Ge,""),r=atob(i),o=new ArrayBuffer(r.length),g=new Uint8Array(o);return A(g,function(e,l){g[l]=r.charCodeAt(l)}),o}(r)):this.clone());var l=new XMLHttpRequest,s=this.clone.bind(this);this.reloading=!0,this.xhr=l,l.onabort=s,l.onerror=s,l.ontimeout=s,l.onprogress=function(){l.getResponseHeader("content-type")!==ne&&l.abort()},l.onload=function(){o.read(l.response)},l.onloadend=function(){o.reloading=!1,o.xhr=null},e.checkCrossOrigin&&fe(r)&&g.crossOrigin&&(r=_e(r)),l.open("GET",r,!0),l.responseType="arraybuffer",l.withCredentials="use-credentials"===g.crossOrigin,l.send()}}},{key:"read",value:function(r){var o=this.options,g=this.imageData,e=Le(r),l=0,s=1,a=1;if(e>1){this.url=function $e(p,i){for(var r=[],g=new Uint8Array(p);g.length>0;)r.push(be.apply(null,de(g.subarray(0,8192)))),g=g.subarray(8192);return"data:".concat(i,";base64,").concat(btoa(r.join("")))}(r,ne);var n=function Xe(p){var i=0,r=1,o=1;switch(p){case 2:r=-1;break;case 3:i=-180;break;case 4:o=-1;break;case 5:i=90,o=-1;break;case 6:i=90;break;case 7:i=90,r=-1;break;case 8:i=-90}return{rotate:i,scaleX:r,scaleY:o}}(e);l=n.rotate,s=n.scaleX,a=n.scaleY}o.rotatable&&(g.rotate=l),o.scalable&&(g.scaleX=s,g.scaleY=a),this.clone()}},{key:"clone",value:function(){var r=this.element,o=this.url,g=r.crossOrigin,e=o;this.options.checkCrossOrigin&&fe(o)&&(g||(g="anonymous"),e=_e(o)),this.crossOrigin=g,this.crossOriginUrl=e;var l=document.createElement("img");g&&(l.crossOrigin=g),l.src=e||o,l.alt=r.alt||"The image to crop",this.image=l,l.onload=this.start.bind(this),l.onerror=this.stop.bind(this),I(l,Kt),r.parentNode.insertBefore(l,r.nextSibling)}},{key:"start",value:function(){var r=this,o=this.image;o.onload=null,o.onerror=null,this.sizing=!0;var g=S.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(S.navigator.userAgent),e=function(n,c){y(r.imageData,{naturalWidth:n,naturalHeight:c,aspectRatio:n/c}),r.initialImageData=y({},r.imageData),r.sizing=!1,r.sized=!0,r.build()};if(!o.naturalWidth||g){var l=document.createElement("img"),s=document.body||document.documentElement;this.sizingImage=l,l.onload=function(){e(l.width,l.height),g||s.removeChild(l)},l.src=o.src,g||(l.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",s.appendChild(l))}else e(o.naturalWidth,o.naturalHeight)}},{key:"stop",value:function(){var r=this.image;r.onload=null,r.onerror=null,r.parentNode.removeChild(r),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var r=this.element,o=this.options,g=this.image,e=r.parentNode,l=document.createElement("div");l.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var s=l.querySelector(".".concat(w,"-container")),a=s.querySelector(".".concat(w,"-canvas")),n=s.querySelector(".".concat(w,"-drag-box")),c=s.querySelector(".".concat(w,"-crop-box")),d=c.querySelector(".".concat(w,"-face"));this.container=e,this.cropper=s,this.canvas=a,this.dragBox=n,this.cropBox=c,this.viewBox=s.querySelector(".".concat(w,"-view-box")),this.face=d,a.appendChild(g),I(r,M),e.insertBefore(s,r.nextSibling),this.isImg||$(g,Kt),this.initPreview(),this.bind(),o.initialAspectRatio=Math.max(0,o.initialAspectRatio)||NaN,o.aspectRatio=Math.max(0,o.aspectRatio)||NaN,o.viewMode=Math.max(0,Math.min(3,Math.round(o.viewMode)))||0,I(c,M),o.guides||I(c.getElementsByClassName("".concat(w,"-dashed")),M),o.center||I(c.getElementsByClassName("".concat(w,"-center")),M),o.background&&I(s,"".concat(w,"-bg")),o.highlight||I(d,qt),o.cropBoxMovable&&(I(d,rt),zt(d,mt,"all")),o.cropBoxResizable||(I(c.getElementsByClassName("".concat(w,"-line")),M),I(c.getElementsByClassName("".concat(w,"-point")),M)),this.render(),this.ready=!0,this.setDragMode(o.dragMode),o.autoCrop&&this.crop(),this.setData(o.data),P(o.ready)&&F(r,"ready",o.ready,{once:!0}),pt(r,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),$(this.element,M))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Je,p}},{key:"setDefaults",value:function(r){y(ce,st(r)&&r)}}]),p}();return y(ke.prototype,ve,Ve,Ye,Wt,We,He),ke}()}}]);