"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6260],{76094:(K,G,i)=>{i.d(G,{x:()=>C});var C=function(l){return l[l.templateOriginalA4=11]="templateOriginalA4",l[l.templateA5Full50=12]="templateA5Full50",l[l.templateA4Essay=13]="templateA4Essay",l[l.templateA6Full20=14]="templateA6Full20",l[l.templateTrueFalseA4=15]="templateTrueFalseA4",l[l.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",l[l.templateTrueFalseA5=17]="templateTrueFalseA5",l[l.templateTrueFalseA6=18]="templateTrueFalseA6",l}(C||{})},17997:(K,G,i)=>{i.d(G,{H:()=>S});var C=i(76094),l=i(65879),N=i(46558),B=i(97151),I=i(61419),R=i(41385),x=i(38228);let S=(()=>{class O{constructor(r,n,m,o,E){this.commonService=r,this.shareFileFlutterService=n,this.encryptService=m,this.formatAnswerSheetService=o,this.exportExcelService=E,this.allAnswerSheet=C.x}exportFileNameOfStudentCode(r,n,m){return 100==r&&(n=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(n?"_"+n:"")+"_"+this.encryptService.createMd5(m).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(r,n,m,o,E,b){return n==this.allAnswerSheet.templateA5Full50?r.createA5AnswerSheetFullA4_50(b??50):n==this.allAnswerSheet.templateA4Essay?r.createA4AnswerSheet_35hh(b??50):n==this.allAnswerSheet.templateA6Full20?r.createA6AnswerSheetFullA4_20(b??20):n==this.allAnswerSheet.templateTrueFalseA4||n==this.allAnswerSheet.templateTrueFalseEssayA4||n==this.allAnswerSheet.templateTrueFalseA5||n==this.allAnswerSheet.templateTrueFalseA6?r.createTrueFalseAnswerSheet():r.createAzotaAnswerSheet_A4(b??120)}exportFileNameOfAnswerSheet(r,n,m){var o="";return 100==r&&(n=""),(0==r||100==r)&&(o=this.commonService.createFileNameExportFile(["PhieuTL_"+m+(n?"_"+n:"")])),o}exportFileNameOfAnswerExcelOffline(r,n,m){var o="";return 100==r&&(n=""),(0==r||100==r)&&(o=this.commonService.createFileNameExportFile(["DapAn_"+(n?"_"+n:"")])),o}exportFileNameOfRawExam(r,n,m){var o="";return 100==r&&(n=""),(0==r||100==r)&&(o=this.commonService.createFileNameExportFile([(n?"_"+n:"")+"_"+this.encryptService.createMd5(m).substring(0,6)])),o}exportFileNameOfExamOffline(r,n,m,o){var E="";return 100==r&&(n=""),(0==r||100==r)&&(E=this.commonService.createFileNameExportFile([(o?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(o,3)+"_":"")+m+(n?"_"+n:"")])),E}printStudentCode(r,n){var m=[];let o=this.commonService.myClone(n);for(let E=0;E<o.length;E++)m.push({code:o[E].code??0,fullName:o[E]?.fullName??"",birthday:o[E]?.birthday??"",className:o[E].classroomName??""});this._exportExcelForCodeNumber(r,m)}_exportExcelForCodeNumber(r,n){let m=this.exportFileNameOfStudentCode(0,r?.name??"",r?.hashId??"");const o=this.exportExcelService.exportExcelForCodeNumber(n);this.shareFileFlutterService.shareFileWithBlob(o,m)}}return O.\u0275fac=function(r){return new(r||O)(l.LFG(N.z),l.LFG(B.g),l.LFG(I.j),l.LFG(R.j),l.LFG(x.L))},O.\u0275prov=l.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()},56260:(K,G,i)=>{i.d(G,{F:()=>$});var C=i(85965),N=i(8720),B=i(70731),I=i(89156),R=i(89745),x=i(79617),S=i(65879),O=i(36668),z=i(32965),r=i(46558),n=i(78953),m=i(19662),o=i(17997),E=i(41385),b=i(97151),U=i(27161),W=i(54);let $=(()=>{class y{constructor(s,t,f,a,p,A,e,c,h,d){this.docxService=s,this.cdnService=t,this.commonService=f,this.userService=a,this.questionRenderService=p,this.printAnswersheetService=A,this.formatAnswerSheetService=e,this.shareFileFlutterService=c,this.sAztAnswerTypeService=h,this.documentConfigService=d,this.configRenderService=new N.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new C,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((s,t)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?typeof azotaDocx<"u"&&azotaDocx?s(!0):t(new Error("lang_core_lib_not_load")):(this.countRetryLoadJS++,this.countRetryLoadJS>3?t(new Error("lang_core_lib_not_load")):s(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(s,t){let f=[];return s.forEach(a=>{let p="<b>     "+(t?(a.alpha?a.alpha:a.key).toLowerCase()+")":(a.alpha?a.alpha:a.key)+".")+"</b> "+(0,x.uG)(a.content);f.push(p)}),f}getDataForExportDocxApi(s,t,f){let a=[],p=1;if(f){let e=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");a.push({content:`<b> ${e} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(f,3)+".</b>",answers:[]})}let A=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return t.forEach(e=>{1!==s.hideGroupQuestion&&e.groupInfo?.isFirstInGroup&&e.groupInfo.groupContent&&a.push({content:e.groupInfo.groupContent,answers:[]}),this.isEnableDebug&&a.push({content:` <br/><br/><br/>*** <b>Question ID: ${e.id}</b> ***`,answers:[]});let c={content:`<b>${A} `+((e.labelIndex??p)+(s.startQuestionIndex??1))+".</b> "+(e.content?.includes("<img")?"<br>":"")+(0,x.uG)(e.content),answers:this.convertAnswerQuestion(e.answers??[],this.sAztAnswerTypeService.isTrueFalseAnswer(e))};if(p++,a.push(c),this.isAnsDetail){if(e.answerResult){let h=[];if(e.answerResult.forEach(d=>{let v=d;const g=e.answers?.find(F=>F.key===d);g&&(v=g.alpha??v),h.push(v)}),this.sAztAnswerTypeService.isTrueFalseAnswer(e)){let d="";e.answers.forEach((v,g)=>{d+=`${(v.alpha??v.key).toLowerCase()} - ${h.includes(v.key)?this.commonService.myTranslateInstant("lang_auto_dung"):this.commonService.myTranslateInstant("lang_auto_sai")}${g==e.answers.length-1?"":" | "}`}),a.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_dap_an_dung")}</b>: ${d}`,answers:[]})}else a.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_dap_an_dung")}</b>: ${h.join(" | ")}`,answers:[]})}e.help&&a.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_giai_thich_chi_tiet_upper")}</b>: ${e.help}`,answers:[]})}this.isEnableDebug&&a.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),a}itemConverterCaller(s,t,f,a,p){return new Promise((A,e)=>{this.questionRenderService.parseRenderQuestions(s.listQuestion,c=>{this.saveLoadingMsg.includes(")")||(this.changeMsg?this.changeMsg(this.saveLoadingMsg+Math.floor(c)+"%"):I.G.changeMsgLoadingEffect(this.saveLoadingMsg+Math.floor(c)+"%"))},this.configRenderService,void 0,!0,p).then(c=>{let h=[];h.push({content:x.Ip.makeHeaderTable([x.Ip.createLineCenterBold(t.schoolName?t.schoolName:"")],[x.Ip.createLineCenterBold(t.examName??""),x.Ip.createLineCenterBold(t.subject??""),x.Ip.createLineCenterItalicized(t.examMinutes??""),x.Ip.createLineCenterItalicized("-------------------------")],!1),answers:[]}),h.push({content:x.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),h.push({content:x.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),h=h.concat(this.getDataForExportDocxApi(a,c,s.offlineExamMixQuestionObj?s.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx?this.docxService.exportToDocxBinary(h,{isHeadless:!0},(d,v,g)=>{}).then(d=>{A({userObj:f,data:d,input:h,additionParams:t,offlineExamMixQuestionObj:s.offlineExamMixQuestionObj})}):e(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(c=>{e(new Error(c[0].message))})})}masterConverterCaller(s,t,f,a,p,A){return new Promise((e,c)=>{const h=this.userService.getUserObj();let d=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),v=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),g=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),F=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),w=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),P=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),L=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const M=new B.Q(1,{function:(_,u)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${u<=1?"":`(${_}/${u}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):I.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});s.forEach(_=>{M.addTask(this,this.itemConverterCaller,[_,{schoolName:a?.nameSchool??`{${d}}`,subject:a?.nameSubject??`{${v}}`,examName:t.name??`{${g}}`,examMinutes:t.minutes&&t.minutes>0?`${F}: `+t.minutes+` ${P} (${w})`:` ${F}: ${L}`,templateType:p??0,numberOfQuestion:_.listQuestion.length,examId:_.offlineExamMixQuestionObj?.hashId??0},h,t,A])}),M.start().then(_=>{if(_.errs.length>0)c(_.errs[0]);else if(1===_.datas.length){const u=_.datas[0],D=new Blob([u.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let T=this.createNameExam(t,f,u.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(D,T),e()}else _.datas.forEach(u=>{let D=this.createNameExam(t,f,u.offlineExamMixQuestionObj);D=this.replaceAllString(D,"/","_"),this.zipper.file("DOCS/"+D,u.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(u=>{let D=this.commonService.createFileNameExportFile([t.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(u,D),e()},u=>{c(u)})},200)})})}replaceAllString(s,t,f){for(;s.includes(t);)s=s.replace(t,f);return s}createNameExam(s,t,f){return t?this.printAnswersheetService.exportFileNameOfExamOffline(0,s.name??"",t?.hashId??"",f?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,s.name??"",s.hashId??"")+".docx"}downloadExam(s,t,f,a,p,A,e,c,h,d,v){return new Promise((g,F)=>{this.isAnsDetail=s,this.isEnableDebug=!!d,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=h,this.loadScriptAction().then(w=>{w?this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(P=>{if(1==P.success){let L=0,M=0;p.forEach((_,u)=>{_.labelIndex=u,P.data?.resetQuestionIndex&&_.groupInfo&&_.groupInfo.groupId&&(L!=_.groupInfo.groupId&&(L=_.groupInfo.groupId,M=0),_.labelIndex=M,M++)})}this.masterConverterCaller([{listQuestion:p,offlineExamMixQuestionObj:a}],t,f,A,e,v).then(()=>{this.zipper=new C,c?c(10):I.G.closeLoadingEffect(10),g()}).catch(L=>{I.G.closeLoadingEffect(10),F(L)})}):(c?c(10):I.G.closeLoadingEffect(10),F(new Error("lang_core_lib_not_load")))}).catch(()=>{c?c(10):I.G.closeLoadingEffect(10),F(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(s,t,f,a,p,A,e,c,h,d){return new Promise((v,g)=>{this.isAnsDetail=s,this.isEnableDebug=!!h,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=c,this.loadScriptAction().then(F=>{if(F){let w=!0;const P=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(L=>{a.forEach(M=>{let _=this.commonService.castJsonToClassObjs(R.v,JSON.stringify(M.mixQuestions??[]))??[];if(_.length>0){if(1==L.success){let u=0,D=0;_.forEach((T,k)=>{T.labelIndex=k,L.data?.resetQuestionIndex&&T.groupInfo&&T.groupInfo.groupId&&(u!=T.groupInfo.groupId&&(u=T.groupInfo.groupId,D=0),T.labelIndex=D,D++)})}P.push({listQuestion:_,offlineExamMixQuestionObj:M})}else w=!1}),w?this.masterConverterCaller(P,t,f,p,A,d).then(()=>{this.zipper=new C,e?e(10):I.G.closeLoadingEffect(10),v()}).catch(M=>{e?e(10):I.G.closeLoadingEffect(10),g(M)}):(e?e(10):I.G.closeLoadingEffect(10),g(new Error("lang_testbank_exam_is_invalid_condition")))})}else e?e(10):I.G.closeLoadingEffect(10),g(new Error("lang_core_lib_not_load"))}).catch(()=>{e?e(10):I.G.closeLoadingEffect(10),g(new Error("lang_core_lib_not_load"))})})}}return y.\u0275fac=function(s){return new(s||y)(S.LFG(O.n),S.LFG(z.E),S.LFG(r.z),S.LFG(n.U),S.LFG(m.h),S.LFG(o.H),S.LFG(E.j),S.LFG(b.g),S.LFG(U.i),S.LFG(W.Cq))},y.\u0275prov=S.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()}}]);