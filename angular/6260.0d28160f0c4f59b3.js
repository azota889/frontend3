"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6260],{17997:(R,P,a)=>{a.d(P,{H:()=>E});var g=a(65879),G=a(46558),w=a(97151),z=a(61419),d=a(41385),N=a(38228);let E=(()=>{class f{constructor(n,r,_,s,m){this.commonService=n,this.shareFileFlutterService=r,this.encryptService=_,this.formatAnswerSheetService=s,this.exportExcelService=m}exportFileNameOfStudentCode(n,r,_){return 100==n&&(r=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(r?"_"+r:"")+"_"+this.encryptService.createMd5(_).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(n,r,_,s,m,D){return 12==r?n.createA5AnswerSheetFullA4_50(D??50):13==r?n.createA4AnswerSheet_35hh(D??50):14==r?n.createA6AnswerSheetFullA4_20(D??20):n.createAzotaAnswerSheet_A4(D??120)}exportFileNameOfAnswerSheet(n,r,_){var s="";return 100==n&&(r=""),(0==n||100==n)&&(s=this.commonService.createFileNameExportFile(["PhieuTL_"+_+(r?"_"+r:"")])),s}exportFileNameOfAnswerExcelOffline(n,r,_){var s="";return 100==n&&(r=""),(0==n||100==n)&&(s=this.commonService.createFileNameExportFile(["DapAn_"+(r?"_"+r:"")])),s}exportFileNameOfRawExam(n,r,_){var s="";return 100==n&&(r=""),(0==n||100==n)&&(s=this.commonService.createFileNameExportFile([(r?"_"+r:"")+"_"+this.encryptService.createMd5(_).substring(0,6)])),s}exportFileNameOfExamOffline(n,r,_,s){var m="";return 100==n&&(r=""),(0==n||100==n)&&(m=this.commonService.createFileNameExportFile([(s?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(s,3)+"_":"")+_+(r?"_"+r:"")])),m}printStudentCode(n,r){var _=[];let s=this.commonService.myClone(r);for(let m=0;m<s.length;m++)_.push({code:s[m].code??0,fullName:s[m]?.fullName??"",birthday:s[m]?.birthday??"",className:s[m].classroomName??""});this._exportExcelForCodeNumber(n,_)}_exportExcelForCodeNumber(n,r){let _=this.exportFileNameOfStudentCode(0,n?.name??"",n?.hashId??"");const s=this.exportExcelService.exportExcelForCodeNumber(r);this.shareFileFlutterService.shareFileWithBlob(s,_)}}return f.\u0275fac=function(n){return new(n||f)(g.LFG(G.z),g.LFG(w.g),g.LFG(z.j),g.LFG(d.j),g.LFG(N.L))},f.\u0275prov=g.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},56260:(R,P,a)=>{a.d(P,{F:()=>U});var g=a(85965),w=a(8720),z=a(70731),d=a(89156),N=a(89745),E=a(79617),f=a(65879),y=a(36668),n=a(32965),r=a(46558),_=a(78953),s=a(19662),m=a(17997),D=a(41385),B=a(97151);let U=(()=>{class O{constructor(i,e,c,o,v,S,t,l){this.docxService=i,this.cdnService=e,this.commonService=c,this.userService=o,this.questionRenderService=v,this.printAnswersheetService=S,this.formatAnswerSheetService=t,this.shareFileFlutterService=l,this.configRenderService=new w.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new g,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((i,e)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?typeof azotaDocx<"u"&&azotaDocx?i(!0):e(new Error("lang_core_lib_not_load")):(this.countRetryLoadJS++,this.countRetryLoadJS>3?e(new Error("lang_core_lib_not_load")):i(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(i){let e=[];return i.forEach(c=>{let o="<b>     "+(c.alpha?c.alpha:c.key)+".</b> "+(0,E.uG)(c.content);e.push(o)}),e}getDataForExportDocxApi(i,e,c){let o=[],v=1;if(c){let t=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");o.push({content:`<b> ${t} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(c,3)+".</b>",answers:[]})}let S=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return e.forEach(t=>{1!==i.hideGroupQuestion&&t.groupInfo?.isFirstInGroup&&t.groupInfo.groupContent&&o.push({content:t.groupInfo.groupContent,answers:[]}),this.isEnableDebug&&o.push({content:` <br/><br/><br/>*** <b>Question ID: ${t.id}</b> ***`,answers:[]});let l={content:`<b>${S} `+(v+(i.startQuestionIndex??1)-1)+".</b> "+(t.content?.includes("<img")?"<br>":"")+(0,E.uG)(t.content),answers:this.convertAnswerQuestion(t.answers??[])};if(v++,o.push(l),this.isAnsDetail){if(t.answerResult){let h=[];t.answerResult.forEach(x=>{let A=x;const p=t.answers?.find(I=>I.key===x);p&&(A=p.alpha??A),h.push(A)}),o.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_dap_an_dung")}</b>: ${h.join(" | ")}`,answers:[]})}t.help&&o.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_giai_thich_chi_tiet_upper")}</b>: ${t.help}`,answers:[]})}this.isEnableDebug&&o.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),o}itemConverterCaller(i,e,c,o,v){return new Promise((S,t)=>{this.questionRenderService.parseRenderQuestions(i.listQuestion,l=>{this.saveLoadingMsg.includes(")")||(this.changeMsg?this.changeMsg(this.saveLoadingMsg+Math.floor(l)+"%"):d.G.changeMsgLoadingEffect(this.saveLoadingMsg+Math.floor(l)+"%"))},this.configRenderService,void 0,!0,v).then(l=>{let h=[];h.push({content:E.Ip.makeHeaderTable([E.Ip.createLineCenterBold(e.schoolName?e.schoolName:"")],[E.Ip.createLineCenterBold(e.examName??""),E.Ip.createLineCenterBold(e.subject??""),E.Ip.createLineCenterItalicized(e.examMinutes??""),E.Ip.createLineCenterItalicized("-------------------------")],!1),answers:[]}),h.push({content:E.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),h.push({content:E.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),h=h.concat(this.getDataForExportDocxApi(o,l,i.offlineExamMixQuestionObj?i.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx?this.docxService.exportToDocxBinary(h,{isHeadless:!0},(x,A,p)=>{}).then(x=>{S({userObj:c,data:x,input:h,additionParams:e,offlineExamMixQuestionObj:i.offlineExamMixQuestionObj})}):t(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(l=>{t(new Error(l[0].message))})})}masterConverterCaller(i,e,c,o,v,S){return new Promise((t,l)=>{const h=this.userService.getUserObj();let x=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),A=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),p=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),I=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),C=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),F=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),T=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const b=new z.Q(1,{function:(M,u)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${u<=1?"":`(${M}/${u}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):d.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});i.forEach(M=>{b.addTask(this,this.itemConverterCaller,[M,{schoolName:o?.nameSchool??`{${x}}`,subject:o?.nameSubject??`{${A}}`,examName:e.name??`{${p}}`,examMinutes:e.minutes&&e.minutes>0?`${I}: `+e.minutes+` ${F} (${C})`:` ${I}: ${T}`,templateType:v??0,numberOfQuestion:M.listQuestion.length,examId:M.offlineExamMixQuestionObj?.hashId??0},h,e,S])}),b.start().then(M=>{if(M.errs.length>0)l(M.errs[0]);else if(1===M.datas.length){const u=M.datas[0],L=new Blob([u.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let W=this.createNameExam(e,c,u.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(L,W),t()}else M.datas.forEach(u=>{let L=this.createNameExam(e,c,u.offlineExamMixQuestionObj);L=this.replaceAllString(L,"/","_"),this.zipper.file("DOCS/"+L,u.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(u=>{let L=this.commonService.createFileNameExportFile([e.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(u,L),t()},u=>{l(u)})},200)})})}replaceAllString(i,e,c){for(;i.includes(e);)i=i.replace(e,c);return i}createNameExam(i,e,c){return e?this.printAnswersheetService.exportFileNameOfExamOffline(0,i.name??"",e?.hashId??"",c?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,i.name??"",i.hashId??"")+".docx"}downloadExam(i,e,c,o,v,S,t,l,h,x,A){return new Promise((p,I)=>{this.isAnsDetail=i,this.isEnableDebug=!!x,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=h,this.loadScriptAction().then(C=>{C?this.masterConverterCaller([{listQuestion:v,offlineExamMixQuestionObj:o}],e,c,S,t,A).then(()=>{this.zipper=new g,l?l(10):d.G.closeLoadingEffect(10),p()}).catch(F=>{d.G.closeLoadingEffect(10),I(F)}):(l?l(10):d.G.closeLoadingEffect(10),I(new Error("lang_core_lib_not_load")))}).catch(()=>{l?l(10):d.G.closeLoadingEffect(10),I(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(i,e,c,o,v,S,t,l,h,x){return new Promise((A,p)=>{this.isAnsDetail=i,this.isEnableDebug=!!h,this.expandInfoParse=this.commonService.castJsonToObj(e.expandInfo??"{}"),this.changeMsg=l,this.loadScriptAction().then(I=>{if(I){let C=!0;const F=[];o.forEach(T=>{let b=this.commonService.castJsonToClassObjs(N.v,JSON.stringify(T.mixQuestions??[]))??[];b.length>0?F.push({listQuestion:b,offlineExamMixQuestionObj:T}):C=!1}),C?this.masterConverterCaller(F,e,c,v,S,x).then(()=>{this.zipper=new g,t?t(10):d.G.closeLoadingEffect(10),A()}).catch(T=>{t?t(10):d.G.closeLoadingEffect(10),p(T)}):(t?t(10):d.G.closeLoadingEffect(10),p(new Error("lang_testbank_exam_is_invalid_condition")))}else t?t(10):d.G.closeLoadingEffect(10),p(new Error("lang_core_lib_not_load"))}).catch(()=>{t?t(10):d.G.closeLoadingEffect(10),p(new Error("lang_core_lib_not_load"))})})}}return O.\u0275fac=function(i){return new(i||O)(f.LFG(y.n),f.LFG(n.E),f.LFG(r.z),f.LFG(_.U),f.LFG(s.h),f.LFG(m.H),f.LFG(D.j),f.LFG(B.g))},O.\u0275prov=f.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()}}]);