"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[3895],{83895:(Ae,T,c)=>{c.r(T),c.d(T,{AzotaDigitalizeModule:()=>De});var m=c(54460),d=c(10936),h=c(65162),B=c(69223),x=c(62067),b=c(15343),Y=c(10123),M=c(44233),X=c(5502),L=c(21656),J=c(70050),W=c(7050),Z=c(91100),H=c(43234),Q=c(1133),K=c(89121),q=c(37714),tt=c(72888),u=c(59640),et=c(37497),t=c(48891),z=c(63028),it=c(51113),f=c(73014),ot=c(27691),nt=c(85710),G=c(51698),at=c(41426),F=c(79767),_=c(76975),C=c(21973),lt=c(62095),E=c(52909),D=c(39712),st=c(17776);let v=(()=>{var o;class l{constructor(){this.subscriptions=new nt.yU,this.sAztBase64Service=(0,t.WQX)(C.D),this.ocrService=(0,t.WQX)(st.so),this.commonService=(0,t.WQX)(lt.R),this.sAztUuidService=(0,t.WQX)(E.D),this.digitalizedBookPageService=(0,t.WQX)(z.gI),this.apiUploadService=(0,t.WQX)(at.T)}runRemoveBackgroundNoise(e,i,a){return new G.c(s=>{this.removeBackgroundNoise(e.oldImageUrl,i,(r,g)=>{if(null==r||g)return a(g??""),s.next(void 0),void s.complete();this.apiUploadService.commonUploadFile(D.b8.ADMIN_DIGITALIZE,this.sAztBase64Service.base64ToFile(r,"digitalized-file.png"),"").subscribe(p=>{p.type!=ot.hv.UploadProgress&&(1===p.success&&p.data?.url?(s.next({...e,newImageUrl:p.data.url}),s.complete()):(a(p.message??""),s.next(void 0),s.complete()))})})})}removeBackgroundNoise(e,i,a){this.sAztBase64Service.convertImageUrlToBase64(e,s=>{if(!s)return a(void 0,"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(s),r=>{if(!r)return a(void 0,"Error to get Uint8Array from base64");this.loadScriptHandleImage(()=>{this.imageUtils.removeNoise(r,i).then(g=>a(this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(g.image)),void 0)).catch(g=>a(void 0,"Error when call imageUtils.detectImage"))})})})}callChangeBookPageDataApi(e,i,a,s,r){this.subscriptions.add(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrPost({bookId:e,bookPageId:i,ocrContent:a,originOcrContent:s}).subscribe(p=>{if(!p.success)return r(!1,p.message);r(!0,"")}))}digitalizeOneImage(e,i,a,s){return new G.c(r=>{i("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:e}).subscribe({next:g=>{s(this.replaceOrcData(g)),r.next(!0),r.complete()},error:g=>{a(g.error.message),r.next(!1),r.complete()}}))})}replaceOrcData(e){let i=e.data,a=this.sAztUuidService.getUuid();return i=this.commonService.convertLatexTagToAztMathTag(i,a),i=(new _.bt).transform((new _.UN).transform(i)),i=this.commonService.replaceAll(i,"<table>","<table class='table table-bordered'>")??i,i=i.replace(new RegExp(a,"g"),"\n"),{htmlResult:i,originOcrData:e.data}}extractImageByOrcUtil(e,i){this.sAztBase64Service.convertImageUrlToBase64(e,a=>{if(!a)return i(void 0,[],"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(a),s=>{if(!s)return i(void 0,[],"Error to get Uint8Array from base64");let r={base64:this.sAztBase64Service.removePrefixOfBase64(a),width:100,height:100,extension:"png"};this.loadScriptHandleImage(()=>{this.imageUtils.detectImage(s).then(g=>i(r,g.images.map(p=>({base64:this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(p.content)),width:p.width,height:p.height,extension:p.extension})),void 0)).catch(g=>i(r,[],"Error when call imageUtils.detectImage"))})})})}waitAnswerSheetInitDone(e){if(F.A.azotaScanAnswerSheet)return e();setTimeout(()=>{this.waitAnswerSheetInitDone(e)},100)}loadScriptHandleImage(e){var i=this;if(this.imageUtils)return e();this.commonService.loadAnswerSheetJs().then((0,f.A)(function*(){i.waitAnswerSheetInitDone((0,f.A)(function*(){i.imageUtils=yield F.A.azotaScanAnswerSheet.imageUtils(),e()}))})).catch(a=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),e()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),l})();var rt=c(14159),ct=c(27035),gt=c(17178),dt=c(63016),R=c(47947),mt=c(81215),pt=c(15351);const _t=(o,l)=>(o.push(l),o);let w=(()=>{var o;class l{processObservables(e,i){return(0,rt.H)(i).pipe((0,ct.Z)((a,s)=>a.pipe((0,gt.W)(r=>(console.error("Error in observable:",r),(0,dt.of)(null))),(0,R.T)(r=>({result:r,index:s}))),e),function ut(){return(0,pt.N)((o,l)=>{(0,mt.T)(_t,[])(o).subscribe(l)})}(),(0,R.T)(a=>a.sort((s,r)=>s.index-r.index).map(s=>s.result)))}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),l})();var I=c(18718),bt=c(22613),O=c(96451),A=c(46899),ht=c(53043);const zt=["*"];let j=(()=>{var o;class l extends u.H{constructor(){super(...arguments),this.imageUrl="",this.sAztDialogService=(0,t.WQX)(A.i)}previewImage(){this.sAztDialogService.open(ht.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{url:this.imageUrl,mimes:"image/jpeg"},viewFullImageWithScroll:!0},restoreFocus:!1})}}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["azt-preview-image-tag"]],inputs:{imageUrl:"imageUrl"},features:[t.Vt3],ngContentSelectors:zt,decls:2,vars:0,consts:[[3,"click"]],template:function(e,i){1&e&&(t.NAR(),t.j41(0,"span",0),t.bIt("click",function(){return i.previewImage()}),t.SdG(1),t.k0s())},encapsulation:2}),l})();const P=()=>({"flex-none":!0,"mr-1":!0});function ft(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"span",10),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.editBookPage(i.obj))}),t.nrm(2,"lucide-icon",11),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.callAgainOcrBookPageEvent.emit(i.obj))}),t.nrm(7,"lucide-icon",13),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s(),t.bVm()}2&o&&(t.R7$(2),t.Y8G("ngClass",t.lJ4(8,P)),t.R7$(),t.SpI(" ",t.bMT(4,4,"lang_cms_admin_digitalized_edit_content")," "),t.R7$(4),t.Y8G("ngClass",t.lJ4(9,P)),t.R7$(),t.SpI(" ",t.bMT(9,6,"lang_cms_admin_digitalized_re_digitalized_again")," "))}function kt(o,l){if(1&o&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(t.bMT(2,1,n.obj.logMessage))}}function Ct(o,l){if(1&o&&(t.j41(0,"div"),t.nrm(1,"div",15),t.nI1(2,"mathJaxContent"),t.nI1(3,"async"),t.nI1(4,"safeNormalHtmlContent"),t.k0s()),2&o){let n;const e=t.XpG();t.R7$(),t.Y8G("innerHTML",t.bMT(4,5,t.bMT(3,3,t.bMT(2,1,null!==(n=e.obj.ocrContent)&&void 0!==n?n:""))),t.npT)}}let vt=(()=>{var o;class l extends u.H{constructor(){super(...arguments),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB}editBookPage(e){e.currentStatus="show_edit_form",this.changeBookPageStatusEvent.emit(e)}}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-view-book-page"]],inputs:{obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"flex-none","items-center"],[4,"ngIf"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],["class","mb-3 text-pending",4,"ngIf"],[1,"text-primary","clickable","mr-2",3,"click"],["name","pencil","size","16",3,"ngClass"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"mb-3","text-pending"],[3,"innerHTML"]],template:function(e,i){1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,ft,10,10,"ng-container",4),t.k0s()(),t.j41(7,"div",5)(8,"azt-preview-image-tag",6),t.nrm(9,"img",7),t.k0s(),t.nrm(10,"hr",8),t.DNE(11,kt,3,3,"div",9)(12,Ct,5,7,"div",4),t.k0s()),2&e&&(t.R7$(3),t.Lme("",t.bMT(4,7,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("ngIf",i.obj.isOrc),t.R7$(2),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.Y8G("src",i.obj.imageLink,t.B4B),t.R7$(2),t.Y8G("ngIf",i.obj.logMessage),t.R7$(),t.Y8G("ngIf",i.obj.isOrc))},dependencies:[m.YU,m.bT,j,b.WGl,m.Jj,_.wp,_.km,_._y],encapsulation:2}),l})();var S=c(52811);let It=(()=>{var o;class l extends u.H{}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-processing-book-page"]],inputs:{obj:"obj"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],[1,"flex","items-center"],[1,"mr-1"]],template:function(e,i){if(1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()(),t.j41(5,"div",3)(6,"azt-preview-image-tag",4),t.nrm(7,"img",5),t.k0s(),t.nrm(8,"hr",6),t.j41(9,"div",7),t.nrm(10,"azt-loading-ui",8),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()()),2&e){let a;t.R7$(3),t.Lme("",t.bMT(4,5,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.Y8G("src",i.obj.imageLink,t.B4B),t.R7$(4),t.SpI(" ",t.bMT(12,7,null!==(a=i.obj.logMessage)&&void 0!==a?a:"lang_lang_cms_admin_digitalized_is_waiting_to_process")," ")}},dependencies:[S.R,j,_.wp],encapsulation:2}),l})();var V=c(89163),Ot=c(33887);const jt=["angularCropper"];function Bt(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"img",11),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const i=t.eBV(n).$implicit,a=t.XpG(2);return t.Njj(a.chooseImage(i))}),t.k0s(),t.bVm()}if(2&o){const n=l.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,n.base64,"png"),t.B4B)}}function Dt(o,l){if(1&o&&(t.j41(0,"div",9),t.DNE(1,Bt,3,4,"ng-container",10),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.Y8G("ngForOf",n.base64Images)}}function At(o,l){if(1&o&&(t.nrm(0,"angular-cropper",12,0),t.nI1(2,"addBase64Extension")),2&o){const n=t.XpG();t.Y8G("cropperOptions",n.cropperOptions)("imageUrl",t.i5U(2,2,n.currentBase64Image.base64,"png"))}}let St=(()=>{var o;class l extends Ot._{chooseImage(e){this.currentBase64Image=e}cropImage(e){var i=this;return(0,f.A)(function*(){i.angularCropper?.cropper.getCroppedCanvas().toBlob(a=>{a&&i.sAztBase64Service.convertBlobToBase64(a,function(){var s=(0,f.A)(function*(r){let g=i.angularCropper?.cropper.getCropBoxData(),p=g?.width,k=g?.height;!p||!k||(i.base64Images.push({base64:r,width:p,height:k,extension:"png"}),yield i.sAztBase64Service.copyBase64ToClipBoard(r),i.showSuccessSnack("lang_cms_copy_success"),e&&i.dialogRef.close(i.base64Images))});return function(r){return s.apply(this,arguments)}}())})})()}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(e,i){super(i,e),this.dialogRef=e,this.data=i,this.sAztBase64Service=(0,t.WQX)(C.D),this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=i.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(V.CP,8),t.rXU(V.Vh,8))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-coazt-image-editor"]],viewQuery:function(e,i){if(1&e&&t.GBs(jt,5),2&e){let a;t.mGM(a=t.lsd())&&(i.angularCropper=a.first)}},features:[t.Vt3],decls:14,vars:11,consts:[["angularCropper",""],[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn","btn-info","mr-2",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"],[3,"cropperOptions","imageUrl"]],template:function(e,i){1&e&&(t.j41(0,"div",1),t.DNE(1,Dt,2,1,"div",2),t.j41(2,"div",3)(3,"span",4),t.bIt("click",function(){return i.cropImage(!0)}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",5),t.bIt("click",function(){return i.cropImage(!1)}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"span",6),t.bIt("click",function(){return i.closeDialog()}),t.EFF(10),t.nI1(11,"mytranslate"),t.k0s()(),t.j41(12,"div",7),t.DNE(13,At,3,5,"angular-cropper",8),t.k0s()()),2&e&&(t.R7$(),t.Y8G("ngIf",i.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,5,"lang_button_crop_and_close")),t.R7$(3),t.JRh(t.bMT(8,7,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(11,9,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",i.currentBase64Image))},dependencies:[m.Sq,m.bT,x.TJ,_.wp,_.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]}),l})();function yt(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"img",6),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const i=t.eBV(n).$implicit,a=t.XpG(2);return t.Njj(a.copyImage(i))}),t.k0s(),t.bVm()}if(2&o){const n=l.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,n.base64,n.extension),t.B4B)}}function Tt(o,l){if(1&o&&(t.j41(0,"div",4),t.DNE(1,yt,3,4,"ng-container",5),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.Y8G("ngForOf",n.base64Images)}}let xt=(()=>{var o;class l extends u.H{constructor(){super(...arguments),this.replaceImageEvent=new t.bkB,this.sAztDialogService=(0,t.WQX)(A.i),this.sAztDigitalizeService=(0,t.WQX)(v),this.sAztBase64Service=(0,t.WQX)(C.D),this.base64Images=[]}copyImage(e){var i=this;return(0,f.A)(function*(){yield i.sAztBase64Service.copyBase64ToClipBoard(e.base64),i.showSuccessSnack("lang_cms_copy_and_replace_success"),i.replaceImageEvent.emit(e)})()}cropImageDialog(){this.sAztDialogService.open(St,{data:{base64Images:this.base64Images},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(i=>{null!=i&&(this.base64Images=i)})}ngOnChanges(){this.initStatusObj(),this.sAztDigitalizeService.extractImageByOrcUtil(this.imageUrl,(e,i,a)=>{if(a)return this.errorStatusObj(a,!0);let s=[];e&&s.push(e),i.forEach(r=>s.push(r)),this.base64Images=s,this.stopStatusObj()})}}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-list-digitalized-images"]],inputs:{imageUrl:"imageUrl"},outputs:{replaceImageEvent:"replaceImageEvent"},features:[t.Vt3,t.OA$],decls:6,vars:4,consts:[[2,"height","228px","overflow-x","scroll","overflow-y","hidden"],["class","list-base640-images",4,"ngIf"],[1,"mb-3","mt-3"],[1,"text-primary","clickable",3,"click"],[1,"list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"]],template:function(e,i){1&e&&(t.j41(0,"div",0),t.DNE(1,Tt,2,1,"div",1),t.k0s(),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return i.cropImageDialog()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()),2&e&&(t.R7$(),t.Y8G("ngIf",i.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,2,"lang_button_crop")))},dependencies:[m.Sq,m.bT,_.wp,_.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;max-height:200px}"]}),l})();const Gt=()=>({"flex-none":!0,"mr-1":!0});function Ft(o,l){1&o&&t.nrm(0,"azt-loading-ui",13)}function Et(o,l){1&o&&t.nrm(0,"azt-loading-ui",13)}let Rt=(()=>{var o;class l extends u.H{saveAllObjs(){this.saveAllContentEvent.emit()}saveObj(){this.initStatusObj();let e=this.obj.htmlContentFormControl.value;this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookObj.id,this.obj.id,e,void 0,(i,a)=>{if(!i)return this.errorStatusObj(a,!0);this.obj.ocrContent=e,this.changeBookPageStatusEvent.emit(this.obj),this.successStatusObj("lang_cms_update_success",!0)})}cancelObj(){this.showSuccessSnack("lang_cms_cancel_success"),this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}replaceImage(e){let i=this.obj.htmlContentFormControl.value.replace("<img>",`<img src='${this.sAztBase64Service.generateBase64Prefix(e.extension)+e.base64}'/>`);this.obj.htmlContentFormControl.setValue(i)}ngOnChanges(){this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}ngOnInit(){super.ngOnInit()}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(v),this.sAztBase64Service=(0,t.WQX)(C.D),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB,this.saveAllContentEvent=new t.bkB}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-edit-book-page"]],inputs:{bookObj:"bookObj",obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent",saveAllContentEvent:"saveAllContentEvent"},features:[t.Vt3,t.OA$],decls:26,vars:29,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"p-3"],[3,"replaceImageEvent","imageUrl"],[3,"formControl","apiKey","init"],[1,"flex-none","items-center","text-right","mt-3"],[1,"btn","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","mr-3",3,"click"],["class","mr-1",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"mr-1"]],template:function(e,i){1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"span",3),t.bIt("click",function(){return i.callAgainOcrBookPageEvent.emit(i.obj)}),t.nrm(6,"lucide-icon",4),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()(),t.j41(9,"div",5)(10,"app-digitalized-list-digitalized-images",6),t.bIt("replaceImageEvent",function(s){return i.replaceImage(s)}),t.k0s(),t.nrm(11,"editor",7),t.nI1(12,"getTinyMceKey"),t.nI1(13,"getTinyMceConfig"),t.j41(14,"div",8)(15,"button",9),t.bIt("click",function(){return i.cancelObj()}),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){return i.saveObj()}),t.DNE(19,Ft,1,0,"azt-loading-ui",11),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s(),t.j41(22,"button",12),t.bIt("click",function(){return i.saveAllObjs()}),t.DNE(23,Et,1,0,"azt-loading-ui",11),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()),2&e&&(t.R7$(3),t.Lme("",t.bMT(4,14,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("ngClass",t.lJ4(28,Gt)),t.R7$(),t.SpI(" ",t.bMT(8,16,"lang_cms_admin_digitalized_re_digitalized_again")," "),t.R7$(3),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.FS9("apiKey",t.bMT(12,18,"")),t.Y8G("formControl",i.obj.htmlContentFormControl)("init",t.bMT(13,20,"admin_for_digitalized")),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(5),t.JRh(t.bMT(17,22,"lang_auto_huy")),t.R7$(3),t.Y8G("ngIf",i.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(21,24,"lang_digitalized_save_one")," "),t.R7$(3),t.Y8G("ngIf",i.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(25,26,"lang_digitalized_save_all")," "))},dependencies:[m.YU,m.bT,d.BC,B.xn,d.l_,S.R,b.WGl,xt,_.wp,_.Hw,_.yc],encapsulation:2}),l})();function wt(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",3),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function Pt(o,l){if(1&o){const n=t.RV6();t.j41(0,"app-digitalized-view-book-page",18),t.bIt("changeBookPageStatusEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.changeBookPageStatus(i))})("callAgainOcrBookPageEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.reDigitalizedOneObj(i))}),t.k0s()}if(2&o){const n=t.XpG(2).$implicit;t.Y8G("obj",n)}}function Vt(o,l){if(1&o){const n=t.RV6();t.j41(0,"app-digitalized-edit-book-page",19),t.bIt("changeBookPageStatusEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.changeBookPageStatus(i))})("callAgainOcrBookPageEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.reDigitalizedOneObj(i))})("saveAllContentEvent",function(){t.eBV(n);const i=t.XpG(5);return t.Njj(i.saveAllContent())}),t.k0s()}if(2&o){const n=t.XpG(2).$implicit,e=t.XpG(3);t.Y8G("bookObj",e.bookObj)("obj",n)}}function Ut(o,l){if(1&o&&t.nrm(0,"app-digitalized-processing-book-page",20),2&o){const n=t.XpG(2).$implicit;t.Y8G("obj",n)}}function Nt(o,l){if(1&o&&(t.j41(0,"div"),t.DNE(1,Pt,1,1,"app-digitalized-view-book-page",15)(2,Vt,1,2,"app-digitalized-edit-book-page",16)(3,Ut,1,1,"app-digitalized-processing-book-page",17),t.k0s()),2&o){const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf","none"==n.currentStatus),t.R7$(),t.Y8G("ngIf","show_edit_form"==n.currentStatus),t.R7$(),t.Y8G("ngIf","calling_ocr_api"==n.currentStatus)}}function $t(o,l){if(1&o&&(t.qex(0),t.DNE(1,Nt,4,3,"div",14),t.bVm()),2&o){const n=l.$implicit;t.R7$(),t.Y8G("ngIf",n.isShow)}}function Yt(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"button",7),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.digitalizedAll())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"button",7),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.runDigitalizedCurrentPage())}),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.exportData("html"))}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",8),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.exportData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s(),t.j41(14,"button",8),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.exportData("txt"))}),t.EFF(15),t.nI1(16,"mytranslate"),t.k0s()(),t.j41(17,"div",9),t.DNE(18,$t,2,1,"ng-container",10),t.k0s(),t.j41(19,"div",11)(20,"div",12)(21,"azt-paging",13),t.bIt("goToPaginationPage",function(i){t.eBV(n);const a=t.XpG(2);return t.Njj(a.goToPage(i))}),t.k0s()()()()}if(2&o){const n=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,10,"lang_cms_admin_digitalized_digitalized_all")," (",n.bookObj.totalDone," / ",n.bookObj.totalPage,")"),t.R7$(3),t.Lme("",t.bMT(7,12,"lang_cms_admin_digitalized_digitalized_current_page")," (",n.totalCurrentItems,")"),t.R7$(3),t.JRh(t.bMT(10,14,"lang_cms_admin_digitalized_digitalized_export_html")),t.R7$(3),t.JRh(t.bMT(13,16,"lang_cms_admin_digitalized_digitalized_export_docx")),t.R7$(3),t.JRh(t.bMT(16,18,"lang_cms_admin_digitalized_digitalized_export_txt")),t.R7$(3),t.Y8G("ngForOf",n.objs),t.R7$(3),t.Y8G("pageObj",n.pageObj)}}function Mt(o,l){if(1&o&&t.DNE(0,Yt,22,20,"div",4),2&o){const n=t.XpG();t.Y8G("ngIf",n.bookObj)}}let Xt=(()=>{var o;class l extends u.H{digitalizedAll(){this.digitalizedObjs(this.objs.filter(e=>"none"==e.currentStatus&&1!=e.isOrc))}runDigitalizedCurrentPage(){this.digitalizedObjs(this.objs.filter(e=>e.isShow&&"none"==e.currentStatus&&1!=e.isOrc))}reDigitalizedOneObj(e){this.digitalizedObjs([e])}digitalizedObjs(e){this.showSuccessSnack(this.commonService.myTranslateInstant("lang_cms_admin_digitalized_for_total_object")+": "+e.length);let i=e.map(s=>s.id);this.objs.forEach(s=>!!i.includes(s.id)&&Object.assign(s,{...s,currentStatus:"calling_ocr_api"}));let a=[];e.forEach(s=>a.push(this.runDigitalizeOneImage(s))),this.waitDestroy(this.sAztConcurrencyApiService.processObservables(1,a).subscribe(s=>{}))}runDigitalizeOneImage(e){return this.sAztDigitalizeService.digitalizeOneImage(e.imageLink,i=>{console.log(`Digitalized for: Id: ${e.id} | Link: ${e.imageLink}`),this.objs.forEach(a=>a.id==e.id&&Object.assign(a,{...a,logMessage:i}))},i=>{console.log(`Digitalized error: Id: ${e.id} | Link: ${e.imageLink} | message: ${i}`),this.objs.forEach(a=>a.id==e.id&&Object.assign(a,{...a,logMessage:i,currentStatus:"none"}))},i=>{this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookId,e.id,i.htmlResult,i.originOcrData,(a,s)=>{if(!a)return console.log(`Digitalized error: Id: ${e.id} | Link: ${e.imageLink} | message: ${s}`),void this.objs.forEach(r=>r.id==e.id&&Object.assign(r,{...r,logMessage:s,currentStatus:"none"}));this.objs.forEach(r=>r.id==e.id&&Object.assign(r,{...r,logMessage:"",currentStatus:"show_edit_form",ocrContent:i.htmlResult,originOcrContent:i.originOcrData,isOrc:1})),this.bookObj.totalDone=this.objs.filter(r=>r.isOrc).length,console.log(`Digitalized success: Id: ${e.id} | Link: ${e.imageLink}`)})})}saveAllContent(){this.initStatusObj();let e=this.objs.filter(a=>1==a.isOrc).map(a=>({bookPageId:a.id,ocrContent:a.htmlContentFormControl.value}));this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrObjsPost({bookId:this.bookId,objs:e}).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);this.objs.forEach(s=>{let r=e.find(g=>g.bookPageId==s.id);r&&(s.ocrContent=r.ocrContent)}),this.successStatusObj("lang_cms_update_success",!0)}))}changeBookPageStatus(e){this.objs.forEach(i=>i.id==e.id&&Object.assign(i,{...e}))}exportData(e){let i=new Date;if("txt"==e){let s="";this.objs.forEach(p=>s+=p.originOcrContent+"\n");let r=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.txt`;const g=new Blob([s],{type:"text/plain"});return void(g&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(g),r))}let a="";if(this.objs.forEach(s=>a+=`<page [page]='${s.currentPage}'/>`+(s.ocrContent??"")),a=this.commonService.decodeHtmlEntities(a),"html"!=e)this.commonService.loadAzotaDocxJs().then(()=>{(0,q.w)().textToDocxBinary(a,null).then(s=>{let r=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.docx`;const g=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});g&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(g),r)}).catch(s=>{this.showErrorSnack(s)})}).catch(s=>{this.showErrorSnack(s)});else{a=this.commonService.convertMathTagToLatex(a),a+=(0,tt.A3)("PHNjcmlwdD4KCWZ1bmN0aW9uIGdldFNlbGVjdGlvbkh0bWwoKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCA8PSAwKSByZXR1cm4gJyc7CgoJCXZhciByYW5nZSA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApOwoJCXZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQocmFuZ2UuY2xvbmVDb250ZW50cygpKTsKCQlyZXR1cm4gY29udGFpbmVyLmlubmVySFRNTDsKCX0KCWZ1bmN0aW9uIHNob3dTbmFjayhpc1N1Y2Nlc3MsIG1lc3NhZ2UpIHsKCQkvLyBTdGVwIDE6IENyZWF0ZSB0aGUgc25hY2sgZWxlbWVudAoJCXZhciBzbmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXNuYWNrLnRleHRDb250ZW50ID0gbWVzc2FnZTsKCgkJLy8gU3RlcCAyOiBTdHlsZSB0aGUgc25hY2sgZm9yIHRvcCBsZWZ0IGNlbnRlciBwb3NpdGlvbmluZwoJCXNuYWNrLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQlzbmFjay5zdHlsZS50b3AgPSAnMjBweCc7CgkJc25hY2suc3R5bGUubGVmdCA9ICc1MCUnOwoJCXNuYWNrLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKC01MCUpJzsgLy8gQ2VudGVyIGhvcml6b250YWxseQoJCXNuYWNrLnN0eWxlLndpZHRoID0gJzQwMHB4JzsKCQlzbmFjay5zdHlsZS5wYWRkaW5nID0gJzEwcHggMjBweCc7CgkJc25hY2suc3R5bGUuYmFja2dyb3VuZENvbG9yID0gaXNTdWNjZXNzID8gJyM0Q0FGNTAnIDogJ3JlZCc7IC8vIEdyZWVuIGJhY2tncm91bmQgZm9yIHN1Y2Nlc3MKCQlzbmFjay5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CgkJc25hY2suc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CgkJc25hY2suc3R5bGUuYm94U2hhZG93ID0gJzBweCAwcHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSknOwoJCXNuYWNrLnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gRW5zdXJlIGl0J3Mgb24gdG9wIG9mIG90aGVyIGVsZW1lbnRzCgkJc25hY2suc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7IC8vIENlbnRlciB0ZXh0IGhvcml6b250YWxseQoKCQkvLyBTdGVwIDM6IEFwcGVuZCB0aGUgc25hY2sgdG8gdGhlIGJvZHkKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNuYWNrKTsKCgkJLy8gU3RlcCA0OiBSZW1vdmUgdGhlIHNuYWNrIGFmdGVyIDYgc2Vjb25kcwoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCXNuYWNrLnJlbW92ZSgpOwoJCX0sIDEwMDApOyAvLyAxMDAwIG1pbGxpc2Vjb25kcyA9IDEgc2Vjb25kcwoJfQoJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5yYW5nZUNvdW50IDw9IDApIHJldHVybjsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oKSB7CgkJCXZhciBodG1sU291cmNlID0gZ2V0U2VsZWN0aW9uSHRtbCgpOwoJCQlpZiAoIWh0bWxTb3VyY2UpIHJldHVybjsKCgkJCW5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGh0bWxTb3VyY2UpLnRoZW4oZnVuY3Rpb24oKSB7CgkJCQlzaG93U25hY2sodHJ1ZSwgJ0NvcHkgdGjDoG5oIGPDtG5nIScpOwoJCQl9KS5jYXRjaChmdW5jdGlvbihlcnIpIHsKCQkJCXNob3dTbmFjayhmYWxzZSwgJ0NvcHkgbOG7l2k6ICcgKyBlcnIpOwoJCQl9KTsKCQl9LCB7CgkJCW9uY2U6IHRydWUKCQl9KTsKCX0pOwo8L3NjcmlwdD4=");let r=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.html`;const g=new Blob([a],{type:"text/plain"});g&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(g),r)}}goToPage(e){this.myNavigation(`/azota-digitalized/digitalized-one-book/${this.bookId}/${e}`),this.pageObj.setTotalPages(this.objs.length),this.pageObj.setPageNumber(e);let i=this.pageObj.getViewObjsOfCurrentPage(this.objs).map(a=>a.id);this.objs.forEach(a=>a.isShow=!!i.includes(a.id)),this.totalCurrentItems=this.objs.filter(a=>a.isShow).length}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageGetObjsGet(this.bookId).subscribe(e=>{if(!e.success||!e.data)return this.errorStatusObj(e.message,!0);this.bookObj=e.data.bookObj,this.objs=e.data.bookPageObjs.map((i,a)=>({...i,isShow:!1,currentPage:a+1,ocrContent:i.ocrContent?this.sAztZipDataService.decodeContentGzip(i.ocrContent):void 0,originOcrContent:i.originOcrContent?this.sAztZipDataService.decodeContentGzip(i.originOcrContent):void 0,logMessage:i.isOrc?void 0:"lang_cms_admin_digitalized_not_call_ocr_status",currentStatus:i.isOrc?"show_edit_form":"none",base64Images:[],htmlContentFormControl:new d.MJ("",{nonNullable:!0})}))??[],this.goToPage(Number(this.commonService.getMyParam(this.activeRoute,"page")??0)),this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_digitalized_one_book_title",description:"lang_cms_admin_digitalized_one_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.initData()}constructor(e,i,a,s,r){super(),this.digitalizedBookPageService=e,this.activeRoute=i,this.sAztZipDataService=a,this.sAztDigitalizeService=s,this.sAztConcurrencyApiService=r,this.objs=[],this.bookId=0,this.backTo="/azota-digitalized/list-books",this.pageObj=new et.d(10),this.totalCurrentItems=0}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(z.gI),t.rXU(h.nX),t.rXU(it.j),t.rXU(v),t.rXU(w))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-digitalized-one-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],["class","mt-5",4,"ngIf"],[1,"mt-5"],[1,"flex","items-center","mb-3","pb-3",2,"border-bottom","1px solid #ccc"],[1,"btn","btn-primary","mr-3",3,"click"],[1,"btn","btn-success","mr-3",3,"click"],[1,"box"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","flex-wrap","sm:flex-row","sm:flex-nowrap","items-center","mt-3"],[1,"w-full","sm:w-auto","sm:mr-auto"],[3,"goToPaginationPage","pageObj"],[4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent",4,"ngIf"],[3,"obj",4,"ngIf"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","obj"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent","bookObj","obj"],[3,"obj"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",1),t.DNE(1,wt,1,1,"azt-loading-effect",2)(2,Mt,1,1,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",i.statusObj.loading)("ngIfElse",a)}},dependencies:[m.Sq,m.bT,I.K,bt.q,O.Q,vt,It,Rt,_.wp],encapsulation:2}),l})();class Lt{static validBookPage(l){const n=l;return n.controls.filter(i=>i.controls.isShow.value).length>0?(l.setErrors(null),null):(n.setErrors({validBookPage:!0}),{identityRevealed:!0})}}var Jt=c(15766);let U=(()=>{var o;class l extends u.H{removeBackgroundNoise(e){this.initStatusObj();let a=this.form.controls.bookPageFormArray.getRawValue().filter(s=>(!!e||s.isSelected)&&s.isShow).map(s=>this.sAztDigitalizeService.runRemoveBackgroundNoise({uuid:s.randomUuid,oldImageUrl:s.imageLink,newImageUrl:""},this.defaultThreshold,r=>console.log("Remove noise error",r)));this.waitDestroy(this.sAztConcurrencyApiService.processObservables(20,a).subscribe(s=>{let r=this.form.controls.bookPageFormArray.getRawValue();r.forEach(g=>{let p=s.find(k=>k?.uuid==k?.uuid)?.newImageUrl;p&&(g.imageLink=p,g.needUpdate=!0)}),this.form.controls.bookPageFormArray.patchValue(r),this.stopStatusObj()}))}selectAll(e){this.form.controls.bookPageFormArray.controls.map(i=>i.controls.isSelected.setValue(e))}deleteAllSelected(){this.form.controls.bookPageFormArray.controls.forEach(e=>{e.controls.isSelected.value&&e.controls.isShow.setValue(!1)})}countSelected(){this.totalPage=this.form.controls.bookPageFormArray.getRawValue().filter(e=>e.isShow).length,this.totalSelectedPage=this.form.controls.bookPageFormArray.getRawValue().filter(e=>e.isShow&&e.isSelected).length}cancel(){this.commonService.myNavigation(this.backTo)}handleUploadComplete(e){e.forEach(i=>{i.url&&this.form.controls.bookPageFormArray.push(new d.gE({id:new d.MJ(0,{nonNullable:!0}),randomUuid:new d.MJ(this.sAztUuidService.getUuid(),{nonNullable:!0}),name:new d.MJ(i.name??"",{nonNullable:!0}),imageLink:new d.MJ(i.url,{nonNullable:!0}),isShow:new d.MJ(!0,{nonNullable:!0}),isSelected:new d.MJ(!1,{nonNullable:!0}),needUpdate:new d.MJ(!1,{nonNullable:!0})}))}),this.form.controls.bookPageFormArray.updateValueAndValidity()}removeBookPageObj(e){let i=this.form.controls.bookPageFormArray.controls.find(a=>a.controls.randomUuid.value==e);i?.controls.isShow.setValue(!1),this.form.controls.bookPageFormArray.updateValueAndValidity()}constructor(){super(),this.sAztUuidService=(0,t.WQX)(E.D),this.sAztDigitalizeService=(0,t.WQX)(v),this.sAztConcurrencyApiService=(0,t.WQX)(w),this.backTo="",this.allUploadToCdnMenuTypes=D.b8,this.allUploadFileTypes=D.PO,this.totalSelectedPage=0,this.totalPage=0,this.defaultThreshold=230,this.form=new d.gE({name:new d.MJ("",{nonNullable:!0,validators:[Jt.M.noWhiteSpace]}),bookPageFormArray:new d.Yp([],{validators:[Lt.validBookPage]})}),this.form.valueChanges.subscribe(e=>this.countSelected())}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-base-create-or-update-book"]],features:[t.Vt3],decls:0,vars:0,template:function(e,i){},encapsulation:2}),l})();var Wt=c(32884),Zt=c(27879),N=c(63349);const Ht=o=>({"error-border":o}),Qt=(o,l)=>[o,l];function Kt(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",4),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function qt(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(i){t.eBV(n);const a=t.XpG(2);return t.Njj(a.handleUploadComplete(i))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&o){const n=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",n.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(7,Qt,n.allUploadFileTypes.IMAGE,n.allUploadFileTypes.PDF))("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,5,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function te(o,l){if(1&o){const n=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&o){const n=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",n.totalSelectedPage,"/",n.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",n.totalSelectedPage,"/",n.totalPage,")")}}function ee(o,l){1&o&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function ie(o,l){if(1&o&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&o){const n=l.$implicit,e=l.index;t.R7$(),t.Y8G("hidden",!n.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",n.controls.imageLink.value),t.R7$(),t.Y8G("src",n.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(e+1),t.R7$(),t.Y8G("formControl",n.controls.isSelected)}}function oe(o,l){if(1&o&&(t.j41(0,"div",31),t.DNE(1,ie,8,5,"ng-container",32),t.k0s()),2&o){const n=t.XpG(2);t.R7$(),t.Y8G("ngForOf",n.form.controls.bookPageFormArray.controls)}}function ne(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,qt,7,10,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.selectAll(i.totalSelectedPage!=i.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,te,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,ee,3,3,"div",25)(34,oe,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&o){const n=t.sdS(35),e=t.XpG();t.R7$(),t.Y8G("formGroup",e.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,e.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",e.form.controls.name)("ngClass",t.eq3(35,Ht,e.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!e.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,e.totalSelectedPage!=e.totalPage?"lang_select_all":"lang_remove_all")," (",e.totalSelectedPage,"/",e.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",e.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",e.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",n),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let ae=(()=>{var o;class l extends U{initForm(){}initData(){}saveObj(){this.initStatusObj();let e=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookAddObjPost({name:e.name}).subscribe(a=>{if(!a.success||!a.data?.obj)return this.errorStatusObj(a.message,!0);let s={bookId:a.data.obj.id,bookPageObjs:[]};e.bookPageFormArray.filter(r=>r.isShow).forEach(r=>{s.bookPageObjs.push({name:r.name,imageLink:r.imageLink})}),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageAddObjsPost(s).subscribe(r=>{if(!r.success)return this.errorStatusObj(r.message,!0);this.successStatusObj("lang_cms_add_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_create_book_title",description:"lang_cms_admin_create_book_title",image:"lang_cms_test_image"}),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(e,i){super(),this.digitalizedBookService=e,this.digitalizedBookPageService=i,this.bookId=0}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(Wt.Z),t.rXU(Zt.g))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-create-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2),t.DNE(1,Kt,1,1,"azt-loading-effect",3)(2,ne,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",1==i.statusObj.loading)("ngIfElse",a)}},dependencies:[m.YU,m.Sq,m.bT,d.qT,d.me,d.Zm,d.BC,d.cb,d.l_,d.j4,I.K,N.V,j,O.Q,b.WGl,_.wp],encapsulation:2}),l})();const le=o=>({"error-border":o}),se=(o,l)=>[o,l];function re(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",4),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function ce(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(i){t.eBV(n);const a=t.XpG(2);return t.Njj(a.handleUploadComplete(i))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&o){const n=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",n.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(7,se,n.allUploadFileTypes.IMAGE,n.allUploadFileTypes.PDF))("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,5,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function ge(o,l){if(1&o){const n=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&o){const n=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",n.totalSelectedPage,"/",n.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",n.totalSelectedPage,"/",n.totalPage,")")}}function de(o,l){1&o&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function me(o,l){if(1&o&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&o){const n=l.$implicit,e=l.index;t.R7$(),t.Y8G("hidden",!n.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",n.controls.imageLink.value),t.R7$(),t.Y8G("src",n.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(e+1),t.R7$(),t.Y8G("formControl",n.controls.isSelected)}}function pe(o,l){if(1&o&&(t.j41(0,"div",31),t.DNE(1,me,8,5,"ng-container",32),t.k0s()),2&o){const n=t.XpG(2);t.R7$(),t.Y8G("ngForOf",n.form.controls.bookPageFormArray.controls)}}function _e(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,ce,7,10,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.selectAll(i.totalSelectedPage!=i.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,ge,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,de,3,3,"div",25)(34,pe,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&o){const n=t.sdS(35),e=t.XpG();t.R7$(),t.Y8G("formGroup",e.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,e.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",e.form.controls.name)("ngClass",t.eq3(35,le,e.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!e.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,e.totalSelectedPage!=e.totalPage?"lang_select_all":"lang_remove_all")," (",e.totalSelectedPage,"/",e.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",e.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",e.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",n),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let ue=(()=>{var o;class l extends U{initForm(e){this.form.controls.name.setValue(e.bookObj.name),e.bookPageObjs.forEach(i=>{this.form.controls.bookPageFormArray.push(new d.gE({id:new d.MJ(i.id,{nonNullable:!0}),randomUuid:new d.MJ(i.id.toString(),{nonNullable:!0}),name:new d.MJ(i.name,{nonNullable:!0}),imageLink:new d.MJ(i.imageLink,{nonNullable:!0}),isShow:new d.MJ(!0,{nonNullable:!0}),isSelected:new d.MJ(!1,{nonNullable:!0}),needUpdate:new d.MJ(!1,{nonNullable:!0})}))})}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjGet(this.bookId).subscribe(e=>{if(!e.success||!e.data)return this.errorStatusObj(e.message,!0);this.initForm(e.data),this.stopStatusObj()}))}saveObj(){this.initStatusObj();let e=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookUpdateObjPost({id:this.bookId,name:e.name}).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);let s={bookId:this.bookId,objs:e.bookPageFormArray.filter(g=>g.needUpdate&&g.id).map(g=>({bookPageId:g.id,imageLink:g.imageLink}))},r={bookId:this.bookId,ids:e.bookPageFormArray.filter(g=>!g.isShow&&g.id).map(g=>g.id)};if(s.objs.length<=0)return this.processDeleteImages(r);this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateImagesPost(s).subscribe(g=>{this.processDeleteImages(r)}))}))}processDeleteImages(e){e.ids.length>0?this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageDeleteObjPost(e).subscribe(i=>{if(!i.success)return this.errorStatusObj(i.message,!0);this.successStatusObj("lang_cms_update_success",!0),this.cancel()})):(this.successStatusObj("lang_cms_update_success",!0),this.cancel())}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_edit_book_title",description:"lang_cms_admin_edit_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(e,i,a){super(),this.digitalizedBookService=e,this.digitalizedBookPageService=i,this.activeRoute=a,this.bookId=0}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(z.ZD),t.rXU(z.gI),t.rXU(h.nX))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-update-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2),t.DNE(1,re,1,1,"azt-loading-effect",3)(2,_e,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",1==i.statusObj.loading)("ngIfElse",a)}},dependencies:[m.YU,m.Sq,m.bT,d.qT,d.me,d.Zm,d.BC,d.cb,d.l_,d.j4,I.K,N.V,j,O.Q,b.WGl,_.wp],encapsulation:2}),l})();var be=c(75421),$=c(25329);const he=o=>[o],y=()=>({"mr-1":!0});function ze(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",5),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function fe(o,l){1&o&&(t.j41(0,"span",25),t.nrm(1,"azt-loading-ui"),t.k0s())}function ke(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"mat-card",13)(2,"mat-card-content",14)(3,"div",15)(4,"div",7)(5,"b"),t.EFF(6),t.k0s(),t.EFF(7),t.k0s(),t.j41(8,"div",16)(9,"button",17),t.nI1(10,"navigationLocalize"),t.nrm(11,"lucide-icon",18),t.j41(12,"span",19),t.EFF(13),t.nI1(14,"mytranslate"),t.k0s()(),t.j41(15,"a",20),t.nI1(16,"navigationLocalize"),t.nrm(17,"lucide-icon",21),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s(),t.j41(20,"button",22),t.bIt("click",function(){const i=t.eBV(n).$implicit,a=t.XpG(3);return t.Njj(a.deleteObj(i))}),t.DNE(21,fe,2,0,"span",23),t.nrm(22,"lucide-icon",24),t.j41(23,"span",19),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()()()(),t.bVm()}if(2&o){const n=l.$implicit,e=l.index,i=t.XpG(3);t.R7$(6),t.SpI("",e+1,"."),t.R7$(),t.E5c(" ",n.name," (",n.totalDone," / ",n.totalPage,") "),t.R7$(2),t.Y8G("routerLink",t.bMT(10,13,"/azota-digitalized/digitalized-one-book/"+n.id+"/1")),t.R7$(2),t.Y8G("ngClass",t.lJ4(23,y)),t.R7$(2),t.JRh(t.bMT(14,15,"lang_cms_admin_digitalized_digitalized_btn")),t.R7$(2),t.Y8G("routerLink",t.bMT(16,17,"/azota-digitalized/edit-book/"+n.id)),t.R7$(2),t.Y8G("ngClass",t.lJ4(24,y)),t.R7$(),t.SpI(" ",t.bMT(19,19,"lang_auto_sua")," "),t.R7$(3),t.Y8G("ngIf",i.deletingId==n.id),t.R7$(),t.Y8G("ngClass",t.lJ4(25,y)),t.R7$(2),t.JRh(t.bMT(25,21,"lang_auto_xoa"))}}function Ce(o,l){if(1&o&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.DNE(3,ke,26,26,"ng-container",12),t.k0s()(),t.bVm()),2&o){const n=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",n.objs)}}function ve(o,l){1&o&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o&&(t.R7$(),t.JRh(t.bMT(2,1,"lang_cms_admin_digitalized_there_is_no_book")))}function Ie(o,l){if(1&o&&(t.j41(0,"div",6)(1,"span",7),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"a",8),t.nI1(5,"navigationLocalize"),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.DNE(8,Ce,4,1,"ng-container",9)(9,ve,3,3,"ng-template",null,1,t.C5r)),2&o){const n=t.sdS(10),e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"lang_cms_admin_common_digitalize_list_book")),t.R7$(2),t.Y8G("routerLink",t.eq3(11,he,t.bMT(5,7,"/azota-digitalized/create-book"))),t.R7$(2),t.JRh(t.bMT(7,9,"lang_common_create")),t.R7$(2),t.Y8G("ngIf",e.objs.length>0)("ngIfElse",n)}}const je=[{path:"",component:K.z,children:[{path:"list-books",component:(()=>{var o;class l extends u.H{deleteObj(e){const i=this.commonService.myTranslateInstant("lang_cms_admin_digitalized_are_your_sure_to_delete_this_book")+`: <b>${e.name}<b/>?`;this.sAztDialogService.open(be.u,{data:{content:i},restoreFocus:!1,width:"500px"}).afterClosed().subscribe(a=>{a&&(this.deletingId=e.id,this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookDeleteObjPost({ids:[e.id]}).subscribe(s=>{if(this.deletingId=void 0,!s.success)return this.errorStatusObj(s.message,!0);this.objs=this.objs.filter(r=>r.id!=e.id)})))})}getData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjsGet().subscribe(e=>{if(!e.success)return this.errorStatusObj(e.message,!0);this.objs=e.data?.objs??[],this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.getData(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_list_book",description:"lang_cms_admin_common_digitalize_list_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(e,i){super(),this.digitalizedBookService=e,this.sAztDialogService=i,this.headerBackTo="",this.objs=[]}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(z.ZD),t.rXU(A.i))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-list-books"]],features:[t.Vt3],decls:5,vars:3,consts:[["doneLoading",""],["emptyList",""],[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"flex","items-center","mb-3"],[1,"w-full"],[1,"flex-none","btn","btn-primary",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],["appearance","outlined",1,"mb-2",2,"background-color","#fff","border","none"],[1,"form-control",2,"overflow-y","auto"],[1,"flex","align-items-center"],[1,"flex-none","items-center"],[1,"btn","btn-sm","btn-success-soft","mr-2",3,"routerLink"],["name","eye","size","18",3,"ngClass"],[1,"azt-hidden","md:inline-block"],[1,"btn","btn-sm","btn-primary-soft","mr-2",3,"routerLink"],["name","square-pen","size","18",3,"ngClass"],[1,"btn","btn-sm","btn-danger-soft",3,"click"],["class","w-4 h-4 flex mr-1",4,"ngIf"],["name","trash-2","size","18",3,"ngClass"],[1,"w-4","h-4","flex","mr-1"],[1,"text-center"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2)(1,"div",3),t.DNE(2,ze,1,1,"azt-loading-effect",4)(3,Ie,11,13,"ng-template",null,0,t.C5r),t.k0s()()),2&e){const a=t.sdS(4);t.Y8G("headerBackToLink",i.headerBackTo),t.R7$(2),t.Y8G("ngIf",i.statusObj.loading)("ngIfElse",a)}},dependencies:[h.Wk,m.YU,m.Sq,m.bT,$.RN,$.m2,I.K,S.R,O.Q,b.WGl,_.F2,_.wp],encapsulation:2}),l})()},{path:"create-book",component:ae},{path:"edit-book/:bookId",component:ue},{path:"digitalized-one-book/:bookId/:page",component:Xt}]}];let Be=(()=>{var o;class l{}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[h.iI.forChild(je),h.iI,Q.XE]}),l})(),De=(()=>{var o;class l{}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({providers:[{provide:B.vn,useValue:H.c.azt_tiny_mce_script_src}],imports:[h.iI,m.MD,d.YN,B.sv,L.s,d.X1,Be,Z.Q,J.L,X.Id,W.b,b.flO.pick(b.Ptg),Y.AC,x.DL,M.An]}),l})()}}]);