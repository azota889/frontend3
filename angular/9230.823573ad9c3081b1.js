"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[9230],{59702:(vt,Pe,v)=>{v.d(Pe,{Q:()=>Ge});var l=v(89163),f=v(33887),c=v(48891),_=v(85969),w=v(41891),S=v(27842),H=v(54460),y=v(47712),oe=v(18718),G=v(2915),k=v(69135),N=v(52811),U=v(15343),ie=v(76975);const ze=(he,Ke)=>({"bg-info text-white":he,"bg-slate-300":Ke}),re=()=>({"text-pending":!0});function W(he,Ke){if(1&he&&c.eu8(0,5),2&he){c.XpG();const Q=c.sdS(5);c.Y8G("ngTemplateOutlet",Q)}}function I(he,Ke){if(1&he&&c.eu8(0,5),2&he){c.XpG();const Q=c.sdS(3);c.Y8G("ngTemplateOutlet",Q)}}function J(he,Ke){if(1&he&&(c.j41(0,"div",7),c.nrm(1,"azt-loading-effect",8),c.k0s()),2&he){const Q=c.XpG(2);c.R7$(),c.Y8G("currentStatusObj",Q.statusObj)}}function ye(he,Ke){1&he&&c.nrm(0,"azt-loading-ui",15)}function xe(he,Ke){if(1&he){const Q=c.RV6();c.j41(0,"div",9),c.nrm(1,"iframe",10),c.nI1(2,"safe"),c.j41(3,"div",11)(4,"button",12),c.bIt("click",function(){c.eBV(Q);const Be=c.XpG(2);return c.Njj(Be.handleCloseDialog())}),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s(),c.j41(7,"button",13),c.bIt("click",function(){c.eBV(Q);const Be=c.XpG(2);return c.Njj(Be.orderBuyExam())}),c.DNE(8,ye,1,0,"azt-loading-ui",14),c.j41(9,"span"),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()()}if(2&he){let Q;const se=c.XpG(2);c.R7$(),c.Y8G("src",c.bMT(2,5,null!==(Q=se.showIframeInContent)&&void 0!==Q?Q:""),c.f$h),c.R7$(4),c.SpI(" ",c.bMT(6,7,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",se.statusObj.loading),c.R7$(),c.Y8G("ngIf",se.statusObj.loading),c.R7$(2),c.JRh(c.bMT(11,9,"lang_payment_confirm_payment_button"))}}function Ee(he,Ke){if(1&he&&c.DNE(0,J,2,1,"div",6)(1,xe,12,11,"ng-template",null,2,c.C5r),2&he){const Q=c.sdS(2),se=c.XpG();c.Y8G("ngIf",se.statusObj.loading)("ngIfElse",Q)}}function ue(he,Ke){if(1&he&&c.nrm(0,"azt-loading-effect",8),2&he){const Q=c.XpG(2);c.Y8G("currentStatusObj",Q.statusObj)}}function Me(he,Ke){if(1&he){const Q=c.RV6();c.j41(0,"div",40)(1,"div",41),c.bIt("click",function(){const Be=c.eBV(Q).$implicit,we=c.XpG(3);return c.Njj(we.chooseCombo(Be))}),c.j41(2,"div",40),c.EFF(3),c.k0s(),c.j41(4,"div",42)(5,"div",43),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s(),c.j41(8,"div",44),c.EFF(9),c.nI1(10,"formatMoney"),c.k0s()()()()}if(2&he){const Q=Ke.$implicit,se=c.XpG(3);c.R7$(),c.Y8G("ngClass",c.l_i(9,ze,(null==se.currentComboObj?null:se.currentComboObj.id)==Q.id,(null==se.currentComboObj?null:se.currentComboObj.id)!=Q.id)),c.R7$(2),c.JRh(Q.name),c.R7$(3),c.Lme("",Q.items.length," ",c.bMT(7,5,"lang_payment_total_exam_in_combo"),""),c.R7$(3),c.JRh(c.bMT(10,7,Q.price)+" VND")}}function Ce(he,Ke){if(1&he&&(c.qex(0),c.j41(1,"div",47)(2,"div",48),c.nrm(3,"lucide-icon",49),c.k0s(),c.j41(4,"div",50)(5,"div",51,3),c.EFF(7),c.k0s()()(),c.bVm()),2&he){const Q=Ke.$implicit,se=c.sdS(6);c.R7$(3),c.Y8G("ngClass",c.lJ4(5,re)),c.R7$(2),c.FS9("matTooltip",Q.name),c.Y8G("isDisabledTooltip",!1)("matTooltipDisabled",se.isDisabled),c.R7$(2),c.SpI(" ",Q.name," ")}}function Xe(he,Ke){if(1&he&&(c.j41(0,"div",45),c.DNE(1,Ce,8,6,"ng-container",46),c.k0s()),2&he){const Q=c.XpG(3);c.R7$(),c.Y8G("ngForOf",Q.currentComboObj.items)}}function Fe(he,Ke){1&he&&c.nrm(0,"azt-loading-ui",15)}function mt(he,Ke){if(1&he){const Q=c.RV6();c.j41(0,"azt-mat-dialog-content",18)(1,"div",19)(2,"div"),c.DNE(3,Me,11,12,"div",20),c.k0s(),c.DNE(4,Xe,2,1,"div",21),c.j41(5,"div",22)(6,"div",23),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.j41(9,"div",24)(10,"div",25)(11,"div",26)(12,"div",27),c.nrm(13,"img",28),c.nI1(14,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(15,"div",26)(16,"div",27),c.nrm(17,"img",29),c.nI1(18,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(19,"div",26)(20,"div",27),c.nrm(21,"img",30),c.nI1(22,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(23,"div",26)(24,"div",27),c.nrm(25,"img",31),c.nI1(26,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(27,"div",26)(28,"div",27),c.nrm(29,"img",32),c.nI1(30,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(31,"div",26)(32,"div",27),c.nrm(33,"img",33),c.nI1(34,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(35,"div",26)(36,"div",27),c.nrm(37,"img",34),c.nI1(38,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(39,"div",26)(40,"div",27),c.nrm(41,"img",35),c.nI1(42,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(43,"div",26)(44,"div",27),c.nrm(45,"img",36),c.nI1(46,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(47,"div",26)(48,"div",27),c.nrm(49,"img",37),c.nI1(50,"convertCdnLinkOfGitHub"),c.k0s()()()()()()(),c.j41(51,"div",38)(52,"div",39)(53,"button",12),c.bIt("click",function(){c.eBV(Q);const Be=c.XpG(2);return c.Njj(Be.handleCloseDialog())}),c.EFF(54),c.nI1(55,"mytranslate"),c.k0s(),c.j41(56,"button",13),c.bIt("click",function(){c.eBV(Q);const Be=c.XpG(2);return c.Njj(Be.orderBuyExam())}),c.DNE(57,Fe,1,0,"azt-loading-ui",14),c.j41(58,"span"),c.EFF(59),c.nI1(60,"mytranslate"),c.k0s()()()()}if(2&he){const Q=c.XpG(2);c.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 90px)"),c.R7$(3),c.Y8G("ngForOf",Q.comboObjs),c.R7$(),c.Y8G("ngIf",Q.currentComboObj),c.R7$(3),c.SpI(" ",c.bMT(8,18,"lang_payment_supported_payment_methods")," "),c.R7$(6),c.Y8G("src",c.bMT(14,20,"images/method-payment/vnpay_full.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(18,22,"images/method-payment/vietcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(22,24,"images/method-payment/techcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(26,26,"images/method-payment/vietinbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(30,28,"images/method-payment/mbbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(34,30,"images/method-payment/agribank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(38,32,"images/method-payment/bidv.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(42,34,"images/method-payment/acb.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(46,36,"images/method-payment/hdbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(50,38,"images/method-payment/vpbank.svg"),c.B4B),c.R7$(5),c.SpI(" ",c.bMT(55,40,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",Q.statusObj.loading),c.R7$(),c.Y8G("ngIf",Q.statusObj.loading),c.R7$(2),c.JRh(c.bMT(60,42,"lang_payment_confirm_payment_button"))}}function fe(he,Ke){if(1&he&&(c.j41(0,"div",16),c.DNE(1,ue,1,1,"azt-loading-effect",17)(2,mt,61,44,"ng-template",null,2,c.C5r),c.k0s()),2&he){const Q=c.sdS(3),se=c.XpG();c.R7$(),c.Y8G("ngIf",se.statusObj.loading)("ngIfElse",Q)}}let Ge=(()=>{var he;class Ke extends f._{handleCloseDialog(){this.dialogRef.close(!1)}chooseCombo(se){this.currentComboObj=se}orderBuyExam(){if(!this.currentComboObj)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.initStatusObj();let se="userRole=student&productType=exam&backTo="+encodeURIComponent(this.commonService.getCurrentUrlWithoutLocale());this.waitDestroy(this.productOrderService.apiProductOrderBuyExamByMoneyGet(this.commonService.getCurrentHostName(),this.commonService.getCurrentLang(),this.currentComboObj.id,se).subscribe(Be=>{if(!Be.success)return this.errorStatusObj(Be.message,!0);window.location.href=Be.data?.value??""}))}initData(){this.initStatusObj(),this.waitDestroy(this.comboPackageService.apiComboPackageListComboPackagesByExamHashIdGet(this.data.examObj.hashId??"").subscribe(se=>se.success?se.data?.objs?.length?(this.comboObjs=se.data?.objs??[],this.currentComboObj=this.commonService.getFirstOfArray(this.comboObjs),this.showIframeInContent=this.currentComboObj?.description,this.stopStatusObj(),void(this.showIframeInContent&&this.sAztAzotaTrackingService.sendForceCustomEvent("PAYMENT_VIEW_IFRAME_CONTENT",[]))):this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0):this.errorStatusObj(se.message,!0)))}setViewport(){const se=document.createElement("meta");se.name="viewport",se.setAttribute("id","viewPortIframe");const Be=me=>{se.setAttribute("content",me),document.head.appendChild(se)},we=window.innerWidth;if(we<768){const lt=420!==we?we/420:1;Be(`width=420, user-scalable=no, initial-scale=${lt}, minimum-scale=${lt}, maximum-scale=${lt}`)}else Be("width=960, user-scalable=no, initial-scale=1.0")}removeViewPort(){document.getElementById("viewPortIframe")?.remove()}ngOnInit(){super.ngOnInit(),this.initData(),this.setViewport()}constructor(se,Be,we,$,me){super(Be,se),this.dialogRef=se,this.data=Be,this.productOrderService=we,this.comboPackageService=$,this.sAztAzotaTrackingService=me,this.comboObjs=[],this.showIframeInContent=void 0}ngOnDestroy(){this.removeViewPort()}}return(he=Ke).\u0275fac=function(se){return new(se||he)(c.rXU(l.CP,8),c.rXU(l.Vh,8),c.rXU(_.Hg),c.rXU(w.E),c.rXU(S.M))},he.\u0275cmp=c.VBU({type:he,selectors:[["payment-dialog"]],features:[c.Vt3],decls:6,vars:2,consts:[["showIframeContent",""],["showListExamContent",""],["doneLoading",""],["c","isDisabled"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet"],["class","box py-4 px-4",4,"ngIf","ngIfElse"],[1,"box","py-4","px-4"],[3,"currentStatusObj"],[1,"bg-white",2,"height","100%"],["width","100%",2,"height","calc(var(--vh, 1vh) * 100 - 70px)",3,"src"],[1,"text-center","mt-4","text-center","absolute","bottom-2","w-full"],[1,"btn","btn-secondary-soft","w-32","mr-4","btn-lg","text-xl",3,"click"],[1,"btn","btn-primary","btn-lg","text-xl",3,"click","disabled"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"box","py-4","px-4",2,"height","100%"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"minHeight"],[2,"margin-right","-5px"],["class","pb-2",4,"ngFor","ngForOf"],["class","box border border-slate-200 dark:border-darkmode-400 pt-2",4,"ngIf"],[1,"mt-4"],[1,"font-medium"],[1,"mt-2"],[1,"grid","grid-cols-10","gap-4"],[1,"col-span-5","md:col-span-2","flex","justify-center"],[1,"p-1","rounded-lg","border","border-slate-200","dark:border-darkmode-400","w-full","h-full"],["alt","Vnpay",2,"height","100%",3,"src"],["alt","vietcombank",3,"src"],["alt","techcombank",3,"src"],["alt","vietinbank",3,"src"],["alt","mbbank",3,"src"],["alt","agribank",3,"src"],["alt","bidv",3,"src"],["alt","acb",3,"src"],["alt","hdbank",3,"src"],["alt","vpbank",3,"src"],[1,"flex","mt-4"],[1,"ml-auto"],[1,"pb-2"],[1,"clickable","box","pl-2","pr-2","pt-2",3,"click","ngClass"],[1,"pb-2","flex","items-center","font-medium"],[1,"mr-auto"],[1,"text-lg"],[1,"box","border","border-slate-200","dark:border-darkmode-400","pt-2"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-3","border-b","border-slate-200","dark:border-darkmode-400"],[1,"flex-none","image-fit","rounded-md","overflow-hidden"],["name","file-check","size","40",3,"ngClass"],[1,"ml-4","mr-auto"],[2,"line-height","1.2",3,"matTooltip","isDisabledTooltip","matTooltipDisabled"]],template:function(se,Be){1&se&&c.DNE(0,W,1,1,"ng-container",4)(1,I,1,1,"ng-container",4)(2,Ee,3,2,"ng-template",null,0,c.C5r)(4,fe,4,2,"ng-template",null,1,c.C5r),2&se&&(c.Y8G("ngIf",!Be.showIframeInContent),c.R7$(),c.Y8G("ngIf",Be.showIframeInContent))},dependencies:[H.YU,H.Sq,H.bT,H.T3,y.oV,oe.K,G.U,k.f,N.R,U.WGl,ie.wp,ie.JI,ie.gt,ie.t0],encapsulation:2}),Ke})()},57081:(vt,Pe,v)=>{v.d(Pe,{w:()=>S});var l=v(48891),f=v(62095),c=v(68774),_=v(50589),w=v(99927);let S=(()=>{var H;class y{_saveSortTypeOfSetting(G){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,G)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(G){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==G}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(G,k){var N=[];return k.forEach(U=>{U.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(G,U.results??new Array),N.push(U)}),N}_filterExamResultObjsByFilterSettingObjNotInClassroom(G,k){var N=[];if(G.isMarked||G.isNotMarked||G.isOnTest||G.isNotSubmit||G.isNotTested)for(var U of k){let ie=!1,ze=G.isOnTest||G.isNotSubmit;G.isMarked&&1==U.isMarked&&(!ze||!(1!=U.status&&(U.isMarked||U.isNotMarked)))&&(ie=!0),G.isNotMarked&&1==U.isNotMarked&&(!ze||!(1!=U.status&&(U.isMarked||U.isNotMarked)))&&(ie=!0),G.isOnTest&&(1==U.isOnTest||0==U.status&&(U.isMarked||U.isNotMarked))&&(ie=!0),G.isNotTested&&1==U.isNotTested&&(ie=!0),G.isNotSubmit&&(1==U.isNotSubmit||-1==U.status&&(U.isMarked||U.isNotMarked))&&(ie=!0),ie&&N.push(U)}else N=k;return N}_searchExamResultObjsByFullNameInClassroom(G,k){var N=[];return this.commonService.myClone(G).forEach(ie=>{var ze=this._searchExamResultObjsByFullNameNotInClassroom(ie.results??[],k);ze.length>0&&(ie.results=ze,N.push(ie))}),N}_searchExamResultObjsByFullNameNotInClassroom(G,k){k=this.commonService.convertVietnameseToEnglish(k).toLowerCase();var N=[];return G.forEach(U=>{-1!=this.commonService.convertVietnameseToEnglish(U.fullName??"").toLowerCase().indexOf(k)&&N.push(U)}),N}_sortExamResultObjsBySettingObjByClassroom(G,k,N){return"isSortByNameAsc"==N?this.sortService.sortFirstNameStudentsInClass(G):"isSortByTimeDesc"==N?this.sortService.sortTimeStudentsInClass(G,1):"isSortByMarkDesc"==N?this.sortService.sortMarkStudentsInClass(G,1,k):this._sortExamResultObjsBySortTypeOfClassroom(G)}_sortExamResultObjsBySettingObjNotInClassroom(G,k,N){return"isSortByNameAsc"==N?this.sortService.sortFirstNameStudents(G):"isSortByTimeDesc"==N?this.sortService.sortTimeDESC(G):"isSortByMarkDesc"==N?this.sortService.sortMarkDESC(G,k):G}_sortExamResultObjsBySortTypeOfClassroom(G){var k=G.map(N=>({...N}));return k.forEach((N,U)=>{N.results=0==N.classObj?.sortType?this.sortService.sortFirstNameStudents(N.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(N.results??[],"pos","id"),k[U]=N}),k}_changeExamResultStatusForAllClassroom(G,k,N){var U=[];return G.forEach((ie,ze)=>{ie.results=this._changeExamResultStatusForOneClassroom(ie.results??new Array,k),ie={indexCounter:ze,...ie,countSubmitted:N?ie.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(ie.results??new Array),showOnTab:ie.showOnTab},U.push(ie)}),U}_changeExamResultStatusForOneClassroom(G,k){var N=[...G];return N.forEach((U,ie)=>{U.confirmedAt&&""!=U.confirmedAt&&U.resultId&&U.resultId>0?U.isMarked=!0:U.resultId&&U.resultId>0&&(!U.confirmedAt||""==U.confirmedAt)?U.isNotMarked=!0:U.resultId&&0!=U.resultId||!U.startedTest||""==U.startedTest||0!=U.status?U.resultId&&0!=U.resultId||!U.startedTest||""==U.startedTest||-1!=U.status?null==U.startedTest&&(U.isNotTested=!0):U.isNotSubmit=!0:U.isOnTest=!0,N[ie]=U}),N.forEach((U,ie)=>{U.files&&""!=U.files&&!Array.isArray(U.files)&&(U.filesParse=this.commonService.myParseJson(U.files)),N[ie]=U}),N}_countTotalSubmittedOfExamResultObjs(G){var k=0;return G.forEach(N=>{(N.isMarked||N.isNotMarked)&&k++}),k}_counterTotalEssayOfQuestionObjs(G){let k=0;return G.forEach(N=>{this.answerTypeService.isEssayAnswer(N)&&k++}),k}_checkCounterEssayQuestionObjs(G){let k=0;return G.forEach(N=>{N.isEssay&&k++}),k}constructor(G,k,N,U){this.commonService=G,this.sortService=k,this.browserStorageService=N,this.answerTypeService=U,this.sortByStorageKey="exam_list_sort_by"}}return(H=y).\u0275fac=function(G){return new(G||H)(l.KVO(f.R),l.KVO(c.g),l.KVO(_.z),l.KVO(w._))},H.\u0275prov=l.jDH({token:H,factory:H.\u0275fac,providedIn:"root"}),y})()},87515:(vt,Pe,v)=>{v.d(Pe,{h:()=>N});var l=v(10936),f=v(51698),c=v(48891),_=v(62095),w=v(9280),S=v(51913),H=v(41715),y=v(50589),oe=v(79064),G=v(91640),k=v(57081);let N=(()=>{var U;class ie{constructor(re,W,I,J,ye,xe,Ee,ue){this.commonService=re,this.examPageResultService=W,this.permissionService=I,this.globalService=J,this.browserStorageService=ye,this.gzipHelper=xe,this.homeworkExamService=Ee,this.sAztExamResultListSortService=ue}getTestedUserObjs(re,W,I){return this.globalService.startIntervalFunc(re),this.getTestedOfExamResult(re,W,"default",I)}getTestedLastMark(re,W,I){return this.globalService.startIntervalFunc(re),this.getTestedOfExamResult(re,W,"last",void 0,I)}getTestedHighestMark(re,W,I){return this.globalService.startIntervalFunc(re),this.getTestedOfExamResult(re,W,"highest",void 0,I)}getTestedFirstMark(re,W,I){return this.globalService.startIntervalFunc(re),this.getTestedOfExamResult(re,W,"first",void 0,I)}getTestedAllResult(re,W,I){return this.globalService.startIntervalFunc(re),this.getTestedOfExamResult(re,W,"all",void 0,I)}getTestedOfExamResult(re,W,I,J,ye){return new f.c(xe=>{let Ee="tested_list_result_v2_"+W,ue=this.browserStorageService.getSimpleSessionStorage(Ee)??"",Me=this.gzipHelper.resultContentSupport(ue),Ce=Me&&this.commonService.willDeleteParseJson(Me)?this.commonService.willDeleteParseJson(Me):void 0;J&&ue&&Ce?(xe.next({status:200,success:1,data:Ce,message:"successful"}),xe.complete()):this.examPageResultService.apiExamPageResultGetNewObjV2Post({examId:W,classroomIds:ye}).subscribe(Fe=>{if(1==Fe.success){let fe=Fe.data?.serverSecond??0,Ge=Fe.data?.examObj,he=Fe.data?.classroomWithAvatarAndStudentObjs??new Array,Ke=Fe.data?.totalAttended??0,Q=Fe.data?.examQuestionObjs??new Array,se=Fe.data?.examCreatorObj,Be=Fe.data?.offlineExamObj,we=Fe.data?.hasEssayQuestion,$=Fe.data?.totalQuestion??0,me=Fe.data?.offlineMixQuestionObjs,lt=Fe.data?.canResetStudentCode,Dt=Fe.data?.hasCreateStudentCode,nt=Fe.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",Ge)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",Ge)?this.getAllExamResultObjs(re,[],W,"",Et=>{if(Et.hasOwnProperty("success")&&1==Et.success){let Ye=this.mergeStudentWithAvatar(Et.studentWithResultObjs??[]),ft={},Je=[];Ye?.forEach(V=>{let Te=V.parentId??"0";ft.hasOwnProperty(Te)?ft[Te].push(...V.examResultObjs??[]):ft[Te]=V.examResultObjs??[],Je=Je.concat(ft[Te])});let je=Ge?this.filterExamResultOnTest(Je,Ge,fe):{},K=[],ae=[];if(this.homeworkExamService.mustInClassroom(Ge)&&he.length>0)for(let V=0;V<he.length;V++){let Te=he[V].classroomObj;Te.classroomGroup=he[V].classroomGroup;let ve=he[V].studentObjs??[],Ze=[];if(ve.length>0)for(let Re=0;Re<ve.length;Re++){let rt=ve[Re].parentId??"0";this.commonService.isExistInArray(ae,ve[Re].parentId)||ae.push(ve[Re].parentId??"0"),ft.hasOwnProperty(rt)&&(Array.isArray(ve[Re].examResultObjs)||(ve[Re].examResultObjs=[]),ve[Re].examResultObjs=this.findExamResultOfStudent(ft[rt],ve[Re].id??"0"));let st=je.hasOwnProperty(ve[Re].parentId??0)?je[ve[Re].parentId??0]:0;if("all"==I)if(ve[Re].examResultObjs?.length)ve[Re].examResultObjs?.forEach((te,We)=>{let Ue=this.commonService.castJsonToObj(JSON.stringify(te));Ue&&(Ue.resultId=Ue.testStatus&&Ue.testStatus>0?Ue.id:0);let E=this.createStudentWithResult(ve[Re],Ue,st,$,We,ve[Re].examResultObjs?.length??0);Ze.push(E)});else{let te=this.createStudentWithResult(ve[Re],void 0,st,$,-1,0);Ze.push(te)}else{let te=this.filterExamResultByType(ve[Re].examResultObjs??[],I),We=te.hasOwnProperty(ve[Re].parentId??0)?te[ve[Re].parentId??0]:void 0,E=this.createStudentWithResult(ve[Re],We,st,$,(We&&null!=We.indexTest&&We.indexTest>=0?We.indexTest:"first"==I?0:(ve[Re].examResultObjs?.length??0)-1)??0,ve[Re].examResultObjs?.length??0);Ze.push(E)}}K.push({classObj:Te,results:Ze})}let de=[],j=this.commonService.myClone(Ye)??[];for(let V=0;V<j?.length;V++)if(!this.commonService.isExistInArray(ae,j[V].parentId)){let Te=je.hasOwnProperty(j[V].parentId??0)?je[j[V].parentId??0]:0;if("all"==I)if(j[V].examResultObjs?.length)j[V].examResultObjs?.forEach((ve,Ze)=>{let Re=this.commonService.castJsonToObj(JSON.stringify(ve));Re&&(Re.resultId=Re.testStatus&&Re.testStatus>0?Re.id:0);let rt=this.createStudentWithResult(j[V],Re,Te,$,Ze,j[V].examResultObjs?.length??0);de.push(rt)});else{let ve=this.createStudentWithResult(j[V],void 0,Te,$,-1,0);de.push(ve)}else{let ve=this.filterExamResultByType(j[V].examResultObjs??[],I),Ze=ve.hasOwnProperty(j[V].parentId??0)?ve[j[V].parentId??0]:void 0,rt=this.createStudentWithResult(j[V],Ze,Te,$,(Ze&&null!=Ze?.indexTest&&Ze.indexTest>=0?Ze.indexTest:"first"==I?0:(j[V].examResultObjs?.length??0)-1)??0,j[V].examResultObjs?.length??0);de.push(rt)}}"all"!=I&&de.sort((V,Te)=>this.compareTwoDate(V.createdAt??"",Te.createdAt??""));let C=0;(K.length||de.length)&&(K.forEach(V=>{V.results?.forEach(Te=>{let ve=this.getMaxGroupId(Te.groupPoints??[]);C<ve&&(C=ve)})}),de.forEach(V=>{let Te=this.getMaxGroupId(V.groupPoints??[]);C<Te&&(C=Te)})),"export_tool"==re&&ye?.length&&(K=K.filter(V=>this.commonService.isExistInArray(ye,V.classObj?.id)),this.commonService.isExistInArray(ye,-1)||(de=[]));let M={studentsInClassResults:K.length>0?K:[],studentsNotInClassResults:de.length>0?de:[],totalAttended:Ke,totalQuestion:$,totalUsers:0,examCreatorObj:se,offlineMixQuestionObjs:me,examObj:Ge,hasEssayQuestion:we,offlineExamObj:Be,canResetStudentCode:lt,hasCreateStudentCode:Dt,questionObjs:Q,fileTypeStr:nt,errorConfigClassroomPermission:Fe.data?.errorConfigClassroomPermission,errorMessage:Fe.data?.errorMessage,maxGroupId:C};if("export_tool"!=re){let V=this.gzipHelper.zipBigContent(JSON.stringify(M));this.browserStorageService.saveSimpleSessionStorage(Ee,V)}xe.next({status:200,success:1,data:M,message:"successful"}),xe.complete()}else xe.next({status:Et.code,success:0,data:null,message:Et.message??""}),xe.complete()}):(xe.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:Ke,totalQuestion:$,hasEssayQuestion:we,totalUsers:0,examCreatorObj:se,offlineMixQuestionObjs:me,examObj:Ge,offlineExamObj:Be,canResetStudentCode:lt,hasCreateStudentCode:Dt,questionObjs:Q,fileTypeStr:Fe.data?.fileTypeStr,errorConfigClassroomPermission:Fe.data?.errorConfigClassroomPermission,errorMessage:Fe.data?.errorMessage,maxGroupId:0},message:"successful"}),xe.complete())}else xe.next({status:Fe.code,success:0,data:null,message:Fe.message??""}),xe.complete()})})}getAllExamResultObjs(re,W,I,J,ye){this.examPageResultService.apiExamPageResultGetObjsV2Get(I,"test_review"==re||"export_tool"==re?"export":"tested_list",J).subscribe(Ee=>{1==Ee.success?(Ee.data?.objs&&W.push(...Ee.data.objs),Ee.data?.nextPage?this.globalService.isStopIntervalFunc(re)?ye({studentWithResultObjs:W,success:1}):setTimeout(()=>{this.getAllExamResultObjs(re,W,I,Ee.data?.nextPage??"",ye)},300):ye({studentWithResultObjs:W,success:1})):ye({code:Ee.code,studentWithResultObjs:[],success:0,message:Ee.message??""})})}compareTwoDate(re,W){var I=new Date(re).getTime();I=isNaN(I)?0:I;var J=new Date(W).getTime();return I-(J=isNaN(J)?0:J)>0?1:I-J<0?-1:0}filterExamResultOnTest(re,W,I){var J={};return re.forEach(ye=>{var xe=this.commonService.myClone(ye)??{};if(xe.testStatus)J[xe.userId??0]=xe.testStatus;else if(xe.startedTest&&I)if(W.endTime){var Ee=Math.floor(new Date(W.endTime).getTime()/1e3);J[xe.userId??0]=I<=Ee+60*(W.minutes??0)+600?0:-1}else{var ue=xe.startedTest?Math.floor(new Date(xe.startedTest).getTime()/1e3):0;J[xe.userId??0]=I<=ue+86400?0:-1}else J[xe.userId??0]=0}),J}filterExamResultByType(re,W){var I={};if(re.length>1)re.forEach((ye,xe)=>{var Ee=this.commonService.myClone(ye);ye.testStatus&&(Ee.resultId=Ee.id,Ee.indexTest=xe,"default"==W&&(I[Ee.userId??0]=Ee),"last"==W&&(I[Ee.userId??0]=Ee),"first"==W&&(I.hasOwnProperty(Ee.userId??0)||(I[Ee.userId??0]=Ee)),"highest"==W)&&(I.hasOwnProperty(Ee.userId??0)?(I[Ee.userId??0].mark??-1)<=(Ee.mark??-1)&&(I[Ee.userId??0]=Ee):I[Ee.userId??0]=Ee)});else{var J=this.commonService.myClone(re[0]??{});J.resultId=J.testStatus?J.id:0,J.indexTest=0,I[J.userId??0]=J}return I}findExamResultOfStudent(re,W){var I=[];return re.forEach(J=>{(J.studentId==W||null==J.studentId)&&I.push(J)}),I}addResultIdToExamResult(re){var W=[];return re.forEach(I=>{var J=this.commonService.myClone(I)??{};J.resultId=J.id,J.testStatus&&W.push(J)}),W}compareLengthWithExamQuestion(re,W){var I=this.commonService.myClone(re);if(W>0&&re.length<W)for(var J=0;J<W-re.length;J++)I.push("");return I}mergeStudentWithAvatar(re){var W=[];return re.forEach(I=>{var J=W.filter(xe=>xe.parentId==I.parentId);if(J&&0!=J.length)for(var ye=0;ye<W.length;ye++)W[ye].parentId==I.parentId&&(W[ye].examResultObjs=W[ye].examResultObjs?.concat(I.examResultObjs??[]));else W.push(I)}),W}createStudentWithResult(re,W,I,J,ye,xe){return{id:re.id,userId:re.parentId,studentId:re.id,identificationNumber:W?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??re.identificationNumber??0,offlineMixQuestionHashId:W?.offlineMark?.rawOfflineMixquestionId??0,studentCode:W?.offlineMark?.studentCode??0,gender:re.gender,fullName:re.fullName,avatar:re.avatar,birthday:re.birthday,resultId:W?.hasOwnProperty("resultId")?W.resultId:0,answers:W?.hasOwnProperty("answers")?W.answers:null,rightAnswer:W?.hasOwnProperty("rightAnswer")?W.rightAnswer:0,totalQuestion:W?.hasOwnProperty("totalQuestion")?W.totalQuestion:0,mark:W?.hasOwnProperty("mark")?W?.mark:null,trueFalseMark:W?.hasOwnProperty("trueFalseMark")?W.trueFalseMark:null,essayMark:W?.hasOwnProperty("essayMark")?W.essayMark:null,files:W?.hasOwnProperty("files")?W.files:null,infors:W?.hasOwnProperty("infors")?W?.infors:null,confirmedAt:W?.hasOwnProperty("confirmedAt")?W?.confirmedAt:null,startedTest:W?.hasOwnProperty("startedTest")?W?.startedTest:null,createdAt:W?.hasOwnProperty("createdAt")?W.createdAt:null,totalExamResultObjs:re.examResultObjs.length,answeredQuestions:W?.hasOwnProperty("answeredQuestions")?W.answeredQuestions:[],groupPoints:this.getGroupPoints(W?.answeredQuestions?W?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:W?.examTrackObj?.exitFullScreen,blurCount:W?.examTrackObj?.blurWindow},status:I,nameImages:re.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion(W?.answerMixObjs??[],J)??[],testedTime:ye+1,totalTestTime:xe,subjectMarkValues:W?.subjectMarks,isOffline:W?.isOffline??!1,countEssayQuestion:this.sAztExamResultListSortService._checkCounterEssayQuestionObjs(W?.hasOwnProperty("answeredQuestions")&&W?.answeredQuestions?W.answeredQuestions:[]),checkBoxGroupControl:new l.gE({isShow:new l.MJ(!1,{nonNullable:!0}),selectedCheckbox:new l.MJ(!1,{nonNullable:!0})}),questionTypeMarks:W?.questionTypeMarks??[],schoolName:re.schoolName??"",phone:re.phone??"",email:re.email??"",userName:re?.userName??""}}getGroupPoints(re){let W=[];return re.forEach(I=>{let J=!1;for(let ye=0;ye<W.length;ye++)W[ye].id==I.groupId&&(J=!0,W[ye].point+=I.correct&&I.scorePerQuestion?I.scorePerQuestion:0);!J&&I.groupId&&W.push({id:I.groupId,point:I.correct&&I.scorePerQuestion?I.scorePerQuestion:0})}),W.sort((I,J)=>(I.id??0)-(J.id??0)),W}getMaxGroupId(re){let W=[];return re.forEach(I=>{I.id&&!this.commonService.isExistInArray(W,I.id)&&W.push(I.id)}),W.length}}return(U=ie).\u0275fac=function(re){return new(re||U)(c.KVO(_.R),c.KVO(w.TE),c.KVO(S.p),c.KVO(H.r),c.KVO(y.z),c.KVO(oe.f),c.KVO(G.Z),c.KVO(k.w))},U.\u0275prov=c.jDH({token:U,factory:U.\u0275fac,providedIn:"root"}),ie})()},32835:(vt,Pe,v)=>{v.d(Pe,{i:()=>f});var l=v(48891);let f=(()=>{var c;class _{processData(S){let H=[],y=[];if(S)for(var oe=0;oe<S.length;oe++)if("scroll"!=S[oe][0]){var G={index:S[oe][0],alpha:S[oe][1],key:S[oe][2],questionId:Number(S[oe][3]),second:Number(S[oe][4])};H.push(G)}else{var k={scrollPos:Number(S[oe][1]),second:Number(S[oe][2])};y.push(k)}return[H,y]}}return(c=_).\u0275fac=function(S){return new(S||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),_})()},97099:(vt,Pe,v)=>{v.d(Pe,{B:()=>ze});var l=v(54460),f=v(10936),c=v(65162),_=v(53220),w=v(81275),S=v(15343),H=v(59055),y=v(44233),oe=v(5502),G=v(21656),k=v(70050),N=v(76407),U=v(91100),ie=v(48891);let ze=(()=>{var re;class W{}return(re=W).\u0275fac=function(J){return new(J||re)},re.\u0275mod=ie.$C({type:re}),re.\u0275inj=ie.G2t({imports:[l.MD,G.s,U.Q,k.L,f.YN,f.X1,oe.Id,_.h,c.iI,S.flO.pick(S.Ptg),w.rc,H.e,N.n,y.An]}),W})()},54479:(vt,Pe,v)=>{v.d(Pe,{t:()=>je});var l=v(73014),f=v(27691),c=v(48891),_=v(10936),w=v(59640),S=v(30657),H=v(64198),y=v(83229),oe=v(40949),G=v(35095),k=v(41426),N=v(51113),U=v(54460),ie=v(47712),ze=v(7919),re=v(81587),W=v(84278),I=v(34815),J=v(15343),ye=v(58588),xe=v(76975);const Ee=["mnoteContainer"],ue=["aztMarkNote"],Me=K=>({display:K}),Ce=K=>({border:K}),Xe=()=>({"mr-1 cursor-pointer":!0}),Fe=K=>({"is-invalid":K});function mt(K,ae){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function fe(K,ae){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Ge(K,ae){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function he(K,ae){if(1&K&&(c.j41(0,"div",19),c.DNE(1,mt,3,3,"span",10)(2,fe,3,3,"span",10)(3,Ge,3,3,"span",10),c.k0s()),2&K){const de=c.XpG().index,j=c.XpG();c.R7$(),c.Y8G("ngIf",null==j.form.controls["cau"+de].errors?null:j.form.controls["cau"+de].errors.min),c.R7$(),c.Y8G("ngIf",null==j.form.controls["cau"+de].errors?null:j.form.controls["cau"+de].errors.max),c.R7$(),c.Y8G("ngIf",null==j.form.controls["cau"+de].errors?null:j.form.controls["cau"+de].errors.pattern)}}function Ke(K,ae){if(1&K){const de=c.RV6();c.j41(0,"div",12)(1,"div",13)(2,"lucide-icon",14),c.nI1(3,"mytranslate"),c.bIt("click",function(C){const M=c.eBV(de).index,V=c.XpG();return c.Njj(V.toggleVisibility(C,M))}),c.k0s(),c.j41(4,"span",15),c.EFF(5),c.nI1(6,"mytranslate"),c.j41(7,"span",16),c.nI1(8,"mytranslate"),c.EFF(9),c.nI1(10,"mytranslate"),c.k0s()(),c.nrm(11,"input",17),c.nI1(12,"mytranslate"),c.k0s(),c.DNE(13,he,4,3,"div",18),c.k0s()}if(2&K){let de;const j=ae.$implicit,C=ae.index,M=c.XpG();c.Y8G("ngStyle",c.eq3(25,Ce,C==M.questions.length-1?"none":"")),c.R7$(2),c.FS9("matTooltip",c.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),c.Y8G("ngClass",c.lJ4(27,Xe)),c.R7$(3),c.Lme(" ",c.bMT(6,17,"lang_auto_cau")," ",(null!==(de=j.indexLabel)&&void 0!==de?de:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",j.essMaxPoint," ",c.bMT(10,21,"lang_auto_diem_brackets"),""),c.R7$(2),c.FS9("placeholder",c.bMT(12,23,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",C,""),c.Y8G("readonly",!M.showForTeacher)("decimal",!0)("ngClass",c.eq3(28,Fe,M.form.controls["cau"+C]&&M.form.controls["cau"+C].invalid)),c.R7$(2),c.Y8G("ngIf",M.form.controls["cau"+C].errors)}}function Q(K,ae){if(1&K){const de=c.RV6();c.j41(0,"div",20)(1,"button",21),c.bIt("click",function(){c.eBV(de);const C=c.XpG();return c.Njj(C.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&K){const de=c.XpG();c.R7$(),c.Y8G("disabled",de.isLoading||de.form.invalid||de.loadingDataCdn&&de.files.length>0),c.R7$(),c.SpI(" ",de.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}function se(K,ae){if(1&K&&c.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&K){let de;const j=c.XpG().$implicit,C=c.XpG();c.Y8G("follower",C.followerRenderQuest)("examObj",C.examObj)("examConfig",C.examConfig)("questionObj",j)("curQuestionIndex",null!==(de=j.indexLabel)&&void 0!==de?de:0)("userAnswersObj",C.userAnswersObj)("currentTab","essay_tab")}}function Be(K,ae){if(1&K&&c.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&K){let de;const j=c.XpG().$implicit,C=c.XpG();c.Y8G("follower",C.followerRenderQuest)("examObj",C.examObj)("questionObj",j)("curQuestionIndex",null!==(de=j.indexLabel)&&void 0!==de?de:0)("userAnswersObj",C.userAnswersObj)("orgExamObjs",C.orgExamObjs)("currentTab","essay_tab")}}function we(K,ae){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function $(K,ae){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function me(K,ae){1&K&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&K&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function lt(K,ae){if(1&K&&(c.j41(0,"div",19),c.DNE(1,we,3,3,"span",10)(2,$,3,3,"span",10)(3,me,3,3,"span",10),c.k0s()),2&K){const de=c.XpG(2).index,j=c.XpG();c.R7$(),c.Y8G("ngIf",null==j.form.controls["cau"+de].errors?null:j.form.controls["cau"+de].errors.min),c.R7$(),c.Y8G("ngIf",null==j.form.controls["cau"+de].errors?null:j.form.controls["cau"+de].errors.max),c.R7$(),c.Y8G("ngIf",null==j.form.controls["cau"+de].errors?null:j.form.controls["cau"+de].errors.pattern)}}function Dt(K,ae){if(1&K&&(c.j41(0,"div",29)(1,"form",30)(2,"label",31),c.EFF(3),c.nI1(4,"mytranslate"),c.j41(5,"span",16),c.nI1(6,"mytranslate"),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.EFF(9," : "),c.k0s(),c.nrm(10,"input",32),c.nI1(11,"mytranslate"),c.DNE(12,lt,4,3,"div",18),c.k0s()()),2&K){let de;const j=c.XpG(),C=j.$implicit,M=j.index,V=c.XpG();c.R7$(),c.Y8G("formGroup",V.form),c.R7$(),c.FS9("for","cau_"+M),c.R7$(),c.Lme(" ",c.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(de=C.indexLabel)&&void 0!==de?de:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",C.essMaxPoint," ",c.bMT(8,19,"lang_auto_diem_brackets"),""),c.R7$(3),c.FS9("placeholder",c.bMT(11,21,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",M,""),c.Y8G("readonly",!V.showForTeacher)("ngClass",c.eq3(23,Fe,V.form.controls["cau"+M]&&V.form.controls["cau"+M].invalid))("id","cau_"+M)("decimal",!0),c.R7$(2),c.Y8G("ngIf",V.form.controls["cau"+M].errors)}}function nt(K,ae){if(1&K&&(c.j41(0,"div",22)(1,"div",23),c.DNE(2,se,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,Be,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,Dt,13,25,"div",26),c.k0s()()),2&K){const de=ae.index,j=c.XpG();c.R7$(),c.Mz_("id","q_",de,""),c.R7$(),c.Y8G("ngIf",!j.showForTeacher),c.R7$(),c.Y8G("ngIf",j.showForTeacher),c.R7$(),c.Y8G("ngIf",j.showForTeacher)}}function Et(K,ae){1&K&&(c.j41(0,"div",33)(1,"b"),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s(),c.EFF(4),c.nI1(5,"mytranslate"),c.k0s()),2&K&&(c.R7$(2),c.SpI("",c.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),c.R7$(2),c.SpI(" ",c.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Ye(K,ae){if(1&K){const de=c.RV6();c.j41(0,"azt-mark-note",35,1),c.bIt("doneLoadData",function(C){c.eBV(de);const M=c.XpG(2);return c.Njj(M.doneLoadData(C))}),c.k0s()}if(2&K){const de=c.XpG(2);c.Y8G("dataMarkNote",de.dataMarkNote)("screenType","exam")("modeView",de.showForTeacher?"teacher":"student")}}function ft(K,ae){if(1&K&&(c.qex(0),c.DNE(1,Ye,2,3,"azt-mark-note",34),c.bVm()),2&K){const de=c.XpG();c.R7$(),c.Y8G("ngIf",1===de.curSelectedTab||de.changeSelectedTab)}}function Je(K,ae){if(1&K){const de=c.RV6();c.j41(0,"div",36)(1,"button",37),c.bIt("click",function(){c.eBV(de);const C=c.XpG();return c.Njj(C.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&K){const de=c.XpG();c.R7$(),c.Y8G("disabled",de.isLoading||de.form.invalid||de.loadingDataCdn&&de.files.length>0),c.R7$(),c.SpI(" ",de.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}let je=(()=>{var K;class ae extends w.H{getMaxPoint(j){var C=0;for(let M=0;M<this.questions.length;M++)if(this.questions[M].id==j){C=this.questions[M].scorePerQuestion??0;break}return C}toggleVisibility(j,C){var M=j.target,V=document.getElementById(`q_${C}`);V&&("block"==V?.style.display?(V.style.display="none",M&&(M.textContent="visibility_off")):(V.style.display="block",M&&(M.textContent="visibility")))}remark(j){for(const V in this.form.value)"string"==typeof this.form.value[V]&&this.form.value[V].includes(",")&&(this.form.value[V]=this.form.value[V].replace(",","."));let C=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var M={id:this.resultID,result:j,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(M,C).subscribe(V=>{1==V.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(V.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}initDataMarkNote(){if(this.examResultObj.result)this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId};else{for(let j=0;j<this.files.length;j++)this.files[j].url=this.cdnService.getMyCdn(this.files[j].url??"");this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)}}}saveDataMarkExercise(){var j=this;return(0,l.A)(function*(){let C=!1;for(const M in j.form.value)""!==j.form.value[M]&&(C=!0);if(C){for(const M in j.form.value)""===j.form.value[M]&&(j.form.value[M]=0,j.form.controls[M].setValue(0));if(j.isLoading=!0,j.files&&j.files.length>0){j.objectResult=j.MarkNote?.exportDataMarkNote();let M=!1;if(!j.objectResult.pages?.length&&j.files.find(V=>(0,H.nL)(V.mimes??"")||(0,H.rl)(V.mimes??"")))return void j.remark("");if(j.objectResult.pages?.length){for(let Re=0;Re<j.objectResult.pages.length;Re++)if(j.objectResult.pages[Re]&&j.objectResult.pages[Re].draws?.length)for(let rt=0;rt<(j.objectResult.pages[Re].draws?.length??0);rt++){let st=j.objectResult.pages[Re].draws?.[rt]??{};st.src&&st.src.includes("base64")&&(M=!0)}M&&(yield j.uploadDrawBase64ToCdn());const V=j.serializeJson(j.objectResult),Te=j.zipDataService.convertContentGzip(V),ve=new Blob([Te],{type:"text/plain"}),Ze=new File([ve],"txt",{type:"text/plain"});j.apiUploadService.uploadToCdnForHomework(Ze).subscribe(Re=>{1==Re.success?j.remark(j.serializeJson({urlDataMark:Re.data?.url??"",version:"0.1"})):j.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai")})}}else j.remark("")}else j.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan")})()}uploadDrawBase64ToCdn(){return new Promise(j=>{let C=[];if(this.objectResult.pages){this.objectResult.pages.forEach(M=>{C.push(!1)});for(let M=0;M<this.objectResult.pages.length;M++)if(this.objectResult.pages[M]&&this.objectResult.pages[M].draws?.length)for(let V=0;V<(this.objectResult.pages[M].draws?.length??0);V++){let Te=this.objectResult.pages[M].draws?.[V]??{};if(Te.src&&Te.src.includes("base64")){C[M]=!0;let ve=(0,y.q)(Te.src);this.apiUploadService.commonUploadForMarkResult(ve,`essay_note_${M}_${V}_${this.resultID}.png`,"image/png").subscribe(Ze=>{Ze.type!=f.hv.UploadProgress&&(Te.src=Ze.data?.url,C[M]=!1),C.includes(!0)||j()})}}}})}doneLoadData(j){this.loadingDataCdn=!1}ngOnInit(){this.initDataMarkNote();var j={};let C;this.examResultObj.confirmedAt&&(C=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(V=>{let Te=this.getMaxPoint(V.id);this.totalMaxPoint+=Te,V.essMaxPoint=Te,this.maxPointPerQuestion.push(V.essMaxPoint)});for(let V=0;V<this.questions.length;V++){var M=`cau${V}`;j[M]=new _.MJ(C?C[M]:"",{validators:[_.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),_.k0.min(0),_.k0.max(this.questions[V].essMaxPoint??0)]})}this.form=new _.gE(j),this.form.valueChanges.subscribe(V=>{let Te=JSON.stringify(V);Te!=this.prevData&&(this.prevData=Te,this.form.patchValue(V))}),super.ngOnInit()}constructor(j,C,M,V){super(),this.cdnService=j,this.examResultService=C,this.apiUploadService=M,this.zipDataService=V,this.orgExamObjs=[],this.questions=[],this.files=[],this.resultID=0,this.userAnswersObj={},this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new c.bkB,this.followerRenderQuest=new S.e,this.form=new _.gE({}),this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.jsonData={},this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return(K=ae).\u0275fac=function(j){return new(j||K)(c.rXU(oe.B),c.rXU(G._),c.rXU(k.T),c.rXU(N.j))},K.\u0275cmp=c.VBU({type:K,selectors:[["azt-mark-essay-new"]],viewQuery:function(j,C){if(1&j&&(c.GBs(Ee,5),c.GBs(ue,5)),2&j){let M;c.mGM(M=c.lsd())&&(C.mnoteContainer=M.first),c.mGM(M=c.lsd())&&(C.MarkNote=M.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",resultID:"resultID",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},features:[c.Vt3],decls:11,vars:10,consts:[["mnoteContainer",""],["aztMarkNote",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"doneLoadData","dataMarkNote","screenType","modeView"],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(j,C){1&j&&(c.j41(0,"div",2)(1,"form",3),c.DNE(2,Ke,14,30,"div",4),c.k0s(),c.DNE(3,Q,5,6,"div",5),c.k0s(),c.j41(4,"div",6),c.DNE(5,nt,5,5,"div",7),c.k0s(),c.DNE(6,Et,6,6,"div",8),c.j41(7,"div",9,0),c.DNE(9,ft,2,1,"ng-container",10),c.k0s(),c.DNE(10,Je,5,6,"div",11)),2&j&&(c.R7$(),c.Y8G("formGroup",C.form),c.R7$(),c.Y8G("ngForOf",C.questions),c.R7$(),c.Y8G("ngIf",C.showForTeacher),c.R7$(2),c.Y8G("ngForOf",C.questions),c.R7$(),c.Y8G("ngIf",C.files&&0==C.files.length),c.R7$(),c.Y8G("ngStyle",c.eq3(8,Me,C.files&&0==C.files.length?"none":"block")),c.R7$(2),c.Y8G("ngIf",C.dataMarkNote&&C.dataMarkNote.answer_obj&&C.files&&C.files.length>0),c.R7$(),c.Y8G("ngIf",C.showForTeacher))},dependencies:[U.YU,U.Sq,U.bT,U.B3,ie.oV,ze.Z,re.t,W.x,I.o,_.qT,_.me,_.BC,_.cb,_.j4,_.JD,J.WGl,ye.i,xe.wp],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:#2361ae2e;border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ae})()},94315:(vt,Pe,v)=>{v.d(Pe,{eX:()=>U});class l{constructor(){this.x=0,this.y=0}toBase64String(){return(new re).writeCvPoint2u(this).toBase64String()}}class f{constructor(){this.x=0,this.y=0}toBase64String(){return(new re).writeCvPoint2f(this).toBase64String()}}class c{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new re).writeCvRect2f(this).toBase64String()}}class _{constructor(){this.center=new f,this.filled=!1}toBase64String(){return(new re).writeAnswerCircle(this).toBase64String()}}class w{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new re).writeTableAnswer(this).toBase64String()}}class S{constructor(){this.top=new f,this.left=new f,this.bottom=new f,this.right=new f}toBase64String(){return(new re).writeResultRect(this).toBase64String()}}class H{constructor(){this.id=0,this.region=new c}toBase64String(){return(new re).writeCropRegion(this).toBase64String()}}class y{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new S,this.studentId=new w,this.examId=new w,this.answerTable=new w,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new re).writeResultOutput(this).toBase64String()}}class oe{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new re).writeAnswerSheetInput(this).toBase64String()}}class G{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new re).writeSmallAnswerCircle(this).toBase64String()}}class k{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new re).writeSmallTableAnswer(this).toBase64String()}}class N{constructor(){this.studentId=new k,this.examId=new k,this.answerTable=new k}toBase64String(){return(new re).writeDrawData(this).toBase64String()}}class U{constructor(I){this.bytes=I,this.cursor=0,this.length=I.byteLength}updateCursor(I){if(this.cursor=this.cursor+I,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let I=this.bytes[this.cursor];return this.updateCursor(1),I}parseInt(){let I=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(I).getInt32(0)}parseDouble(){let I=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(I).getFloat64(0,!0)}parseString(){let I=new TextDecoder("utf-8"),J=this.cursor,ye=this.bytes[this.cursor];for(;0!=ye;)this.updateCursor(1),ye=this.bytes[this.cursor];let xe=this.bytes.slice(J,this.cursor),Ee=I.decode(xe);return this.updateCursor(1),Ee}parseBool(){let I=this.bytes[this.cursor];return this.updateCursor(1),I>0}parseCvPoint2u(){let I=new l;return I.x=this.parseUchar(),I.y=this.parseUchar(),I}parseCvPoint2f(){let I=new f;return I.x=this.parseDouble(),I.y=this.parseDouble(),I}parseCvRect2f(){let I=new c;return I.x=this.parseDouble(),I.y=this.parseDouble(),I.width=this.parseDouble(),I.height=this.parseDouble(),I}parseAnswerCircle(){let I=new _;return I.center=this.parseCvPoint2f(),I.filled=this.parseBool(),I}parseTableAnswer(){let I=new w,J=0;I.rows=this.parseInt(),I.cols=this.parseInt(),I.radius=this.parseInt(),J=this.parseInt();for(let ye=0;ye<J;ye++)I.answers.push(this.parseAnswerCircle());return I}parseResultRect(){let I=new S;return I.top=this.parseCvPoint2f(),I.left=this.parseCvPoint2f(),I.bottom=this.parseCvPoint2f(),I.right=this.parseCvPoint2f(),I}parseCropRegion(){let I=new H;return I.id=this.parseInt(),I.region=this.parseCvRect2f(),I}parseResultOutput(){let I=new y,J=0;I.type=this.parseInt(),I.errorCode=this.parseInt(),I.paperCorner=this.parseResultRect(),I.studentId=this.parseTableAnswer(),I.examId=this.parseTableAnswer(),I.answerTable=this.parseTableAnswer(),I.imageWidth=this.parseInt(),I.imageHeight=this.parseInt(),I.imageSize=this.parseInt(),J=this.parseInt();for(let ye=0;ye<J;ye++)I.cropRegion.push(this.parseCropRegion());return I}parseAnswerSheetInput(){let I=new oe;return I.templateType=this.parseInt(),I.imageWidth=this.parseInt(),I.imageHeight=this.parseInt(),I}parseSmallAnswerCircle(){let I=new G;return I.position=this.parseUchar(),I.x=this.parseUchar(),I.y=this.parseUchar(),I.filledCols=this.parseUchar(),I.rows=this.parseUchar(),I}parseSmallTableAnswer(){let I=new k,J=0;I.rows=this.parseUchar(),I.cols=this.parseUchar(),I.radius=this.parseUchar(),J=this.parseInt();for(let ye=0;ye<J;ye++)I.answers.push(this.parseSmallAnswerCircle());return I}parseDrawData(){let I=new N;return I.studentId=this.parseSmallTableAnswer(),I.examId=this.parseSmallTableAnswer(),I.answerTable=this.parseSmallTableAnswer(),I}}const ie=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class re{constructor(){this.bytes=[]}writeUchar(I){return this.bytes.push(I),this}writeUint8Array(I){for(let J=0;J<I.length;J++)this.bytes.push(I[J]);return this}writeArrayBuffer(I){let J=new Uint8Array(I);return this.writeUint8Array(J),this}writeInt(I){let J=new ArrayBuffer(4);return new DataView(J).setUint32(0,I,!1),this.writeArrayBuffer(J),this}writeDouble(I){let J=new ArrayBuffer(8);return new DataView(J).setFloat64(0,I,!0),this.writeArrayBuffer(J),this}writeString(I){let ye=(new TextEncoder).encode(I);return this.writeUint8Array(ye),this.writeUchar(0),this}writeBool(I){return this.writeUchar(I?1:0),this}toBase64String(){return function ze(W){let J,I="",ye=W.length;for(J=2;J<ye;J+=3)I+=ie[W[J-2]>>2],I+=ie[(3&W[J-2])<<4|W[J-1]>>4],I+=ie[(15&W[J-1])<<2|W[J]>>6],I+=ie[63&W[J]];return J===ye+1&&(I+=ie[W[J-2]>>2],I+=ie[(3&W[J-2])<<4],I+="=="),J===ye&&(I+=ie[W[J-2]>>2],I+=ie[(3&W[J-2])<<4|W[J-1]>>4],I+=ie[(15&W[J-1])<<2],I+="="),I}(new Uint8Array(this.bytes))}writeCvPoint2u(I){return this.writeUchar(I.x),this.writeUchar(I.y),this}writeCvPoint2f(I){return this.writeDouble(I.x),this.writeDouble(I.y),this}writeCvRect2f(I){return this.writeDouble(I.x),this.writeDouble(I.y),this.writeDouble(I.width),this.writeDouble(I.height),this}writeAnswerCircle(I){return this.writeCvPoint2f(I.center),this.writeBool(I.filled),this}writeTableAnswer(I){this.writeInt(I.rows),this.writeInt(I.cols),this.writeInt(I.radius),this.writeInt(I.answers.length);for(let J of I.answers)this.writeAnswerCircle(J);return this}writeResultRect(I){return this.writeCvPoint2f(I.top),this.writeCvPoint2f(I.left),this.writeCvPoint2f(I.bottom),this.writeCvPoint2f(I.right),this}writeCropRegion(I){return this.writeInt(I.id),this.writeCvRect2f(I.region),this}writeResultOutput(I){this.writeInt(I.type),this.writeInt(I.errorCode),this.writeResultRect(I.paperCorner),this.writeTableAnswer(I.studentId),this.writeTableAnswer(I.examId),this.writeTableAnswer(I.answerTable),this.writeInt(I.imageWidth),this.writeInt(I.imageHeight),this.writeInt(I.imageSize),this.writeInt(I.cropRegion.length);for(let J of I.cropRegion)this.writeCropRegion(J);return this}writeAnswerSheetInput(I){return this.writeInt(I.templateType),this.writeInt(I.imageWidth),this.writeInt(I.imageHeight),this}writeSmallAnswerCircle(I){return this.writeUchar(I.position),this.writeUchar(I.x),this.writeUchar(I.y),this.writeUchar(I.filledCols),this.writeUchar(I.rows),this}writeSmallTableAnswer(I){this.writeUchar(I.rows),this.writeUchar(I.cols),this.writeUchar(I.radius),this.writeInt(I.answers.length);for(let J of I.answers)this.writeSmallAnswerCircle(J);return this}writeDrawData(I){return this.writeSmallTableAnswer(I.studentId),this.writeSmallTableAnswer(I.examId),this.writeSmallTableAnswer(I.answerTable),this}}},72267:(vt,Pe,v)=>{v.d(Pe,{E:()=>w});var l=v(48891),f=v(62095),c=v(51113),_=v(99927);let w=(()=>{var S;class H{addIndexLabelToQuestionObjs(oe){for(let G=0;G<(oe?.length??0);G++)oe?.[G]&&(oe[G].indexLabel=G);return oe}getEssayQuestionObjs(oe){let G=[];for(let k=0;k<(oe?.length??0);k++)this.answerTypeService.isEssayAnswer(oe?.[k])&&oe?.[k]&&G.push(oe[k]);return G}getTrueFalseQuestionObjs(oe){let G=[];for(let k=0;k<(oe?.length??0);k++)(this.answerTypeService.isOneChoiceAnswer(oe?.[k])||this.answerTypeService.isTrueFalseAnswer(oe?.[k])||this.answerTypeService.isFillAnswer(oe?.[k]))&&oe?.[k]&&G.push(oe[k]);return G}convertAnswersArr(oe){let G={};return 0!=oe.length&&oe.forEach(k=>{let N=!!k.AnswerContent?.filter(U=>U.Status)?.length;k.AnswerContent&&k.AnswerContent.length&&(G[`id_${k.QuestionId}`]=N?[...k.AnswerContent]:k.AnswerContent[0].Content)}),G}mapStudentObjWithTestedObj(oe,G,k){var N=this.commonService.castObj(oe?.studentObj),U=G?.filter(ie=>ie.userId==k?.parentId);return N&&U&&U.length>0&&(N={...N,offlineMarkObj:U[0].offlineMarkObj,nameImage:U[0].nameImage??""}),k=N}mapStudentObjWithTestedObjForFrontendStudent(oe,G,k){var N=this.commonService.castObj(oe?.studentObj),U=G?.filter(ie=>ie.userId==k?.parentId);return N&&U&&U.length>0&&(N={...N,offlineMarkObj:U[0].offlineMarkObj,nameImage:U[0].nameImage??""}),k=N}constructor(oe,G,k){this.commonService=oe,this.zipDataService=G,this.answerTypeService=k}}return(S=H).\u0275fac=function(oe){return new(oe||S)(l.KVO(f.R),l.KVO(c.j),l.KVO(_._))},S.\u0275prov=l.jDH({token:S,factory:S.\u0275fac,providedIn:"root"}),H})()},57332:(vt,Pe,v)=>{v.d(Pe,{V:()=>Ee});var l=v(89163),f=v(33887),c=v(48891),_=v(2145),w=v(54460),S=v(68323),H=v(90796),y=v(52811),oe=v(15343),G=v(76975);const k=()=>({"mr-2 text-danger flex-none":!0});function N(ue,Me){1&ue&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ue&&(c.R7$(),c.JRh(c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_this_exam_result")))}function U(ue,Me){1&ue&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ue&&(c.R7$(),c.SpI("",c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_multiple_exam_result"),":"))}function ie(ue,Me){if(1&ue&&(c.j41(0,"div",8),c.nrm(1,"lucide-icon",9),c.j41(2,"div"),c.DNE(3,N,3,3,"span",10)(4,U,3,3,"span",10),c.k0s()()),2&ue){const Ce=c.XpG();c.R7$(),c.Y8G("ngClass",c.lJ4(3,k)),c.R7$(2),c.Y8G("ngIf",1==Ce.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",Ce.data.examResultIds.length>1)}}function ze(ue,Me){if(1&ue&&(c.j41(0,"div",21)(1,"span",22),c.EFF(2),c.k0s()()),2&ue){const Ce=c.XpG().$implicit;c.R7$(2),c.JRh(Ce.fullName)}}function re(ue,Me){if(1&ue&&c.nrm(0,"img",23),2&ue){const Ce=c.XpG().$implicit;c.Y8G("nameImages",Ce.nameImages)}}function W(ue,Me){if(1&ue&&(c.j41(0,"div",14)(1,"div",15)(2,"div",16),c.nrm(3,"azt-create-avatar",17),c.k0s(),c.j41(4,"div",18),c.DNE(5,ze,3,1,"div",19)(6,re,1,1,"img",20),c.k0s()()()),2&ue){let Ce;const Xe=Me.$implicit,Fe=c.XpG(2);c.R7$(3),c.Y8G("linkAvatar",null!==(Ce=Xe.avatar)&&void 0!==Ce?Ce:"")("nameCreateAvatar",Xe.fullName)("size",32),c.R7$(2),c.Y8G("ngIf",!Xe.nameImages||Fe.commonService.convertStringToNumber(Xe.id)>0),c.R7$(),c.Y8G("ngIf",Xe.nameImages&&Fe.commonService.convertStringToNumber(Xe.studentId)<=0)}}function I(ue,Me){if(1&ue&&(c.j41(0,"div",12),c.DNE(1,W,7,5,"div",13),c.k0s()),2&ue){const Ce=c.XpG();c.R7$(),c.Y8G("ngForOf",Ce.data.examResults)}}function J(ue,Me){1&ue&&(c.j41(0,"div",8)(1,"div",24)(2,"button",25)(3,"div",26),c.nrm(4,"lucide-icon",27),c.k0s()(),c.j41(5,"div",28),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s()()()),2&ue&&(c.R7$(6),c.JRh(c.bMT(7,1,"lang_testbank_are_you_sure_to_delete_no_exam_result")))}function ye(ue,Me){1&ue&&(c.j41(0,"span",31),c.nrm(1,"azt-loading-ui"),c.k0s())}function xe(ue,Me){if(1&ue){const Ce=c.RV6();c.j41(0,"button",29),c.bIt("click",function(){c.eBV(Ce);const Fe=c.XpG();return c.Njj(Fe.confirmDelete())}),c.DNE(1,ye,2,0,"span",30),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s()}if(2&ue){const Ce=c.XpG();c.Y8G("disabled",Ce.statusObj.loading),c.R7$(),c.Y8G("ngIf",Ce.statusObj.loading),c.R7$(),c.SpI(" ",c.bMT(3,3,"lang_cms_common_confirm_btn")," ")}}let Ee=(()=>{var ue;class Me extends f._{confirmDelete(){this.initStatusObj(),this.waitDestroy(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjsPost({examHashId:this.examHashId,examResultIds:this.examResultIds}).subscribe(Xe=>{1==Xe.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(Xe.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(Xe,Fe,mt){super(mt,Fe),this.offlineExamResultService=Xe,this.dialogRef=Fe,this.examHashId="",this.examResultIds=[],this.examHashId=mt.examHashId,this.examResultIds=mt.examResultIds}}return(ue=Me).\u0275fac=function(Xe){return new(Xe||ue)(c.rXU(_.Fs),c.rXU(l.CP,8),c.rXU(l.Vh,8))},ue.\u0275cmp=c.VBU({type:ue,selectors:[["coazt-delete-offline-exam-result-dialog"]],features:[c.Vt3],decls:11,vars:7,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],["class","text-md flex",4,"ngIf"],["class","grid grid-cols-12 gap-3","style","overflow-y: auto; max-height: calc(100vh - 150px)",4,"ngIf"],[1,"p-3","flex","justify-end"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor","class","btn w-32 btn-danger",3,"disabled","click",4,"ngIf"],[1,"text-md","flex"],["name","trash-2","size","24",3,"ngClass"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"grid","grid-cols-12","gap-3",2,"overflow-y","auto","max-height","calc(100vh - 150px)"],["class","col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"flex","items-center","p-3","student-exam-result-up","w-full"],[1,"w-8","h-8","image-fit","lg:mr-1"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"ml-2","text-left","mt-0",2,"width","calc(100% - 3.5rem)"],["class","azt-student-name flex items-center","style","flex-wrap: wrap",4,"ngIf"],["appDrawNameImage","","class","mb-1 img-name-fluid",3,"nameImages",4,"ngIf"],[1,"azt-student-name","flex","items-center",2,"flex-wrap","wrap"],[1,"font-medium","mr-2"],["appDrawNameImage","",1,"mb-1","img-name-fluid",3,"nameImages"],[1,"mx-auto","text-center"],[1,"btn","btn-sm","btn-primary-soft","p-1"],[1,"w-6","h-6"],["name","circle-x","size","24"],[1,"mt-4"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"click","disabled"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(Xe,Fe){1&Xe&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2),c.DNE(3,ie,5,4,"div",3)(4,I,2,1,"div",4)(5,J,8,3,"div",3),c.k0s()(),c.j41(6,"div",5)(7,"button",6),c.bIt("click",function(){return Fe.btnCloseDialog()}),c.EFF(8),c.nI1(9,"mytranslate"),c.k0s(),c.DNE(10,xe,4,5,"button",7),c.k0s()()),2&Xe&&(c.R7$(3),c.Y8G("ngIf",Fe.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",Fe.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",!Fe.data.examResultIds.length),c.R7$(3),c.SpI(" ",c.bMT(9,5,"lang_cms_common_close_btn")," "),c.R7$(2),c.Y8G("ngIf",Fe.data.examResultIds.length))},dependencies:[w.YU,w.Sq,w.bT,S.p,H.y,y.R,oe.WGl,G.wp],encapsulation:2}),Me})()},92801:(vt,Pe,v)=>{v.d(Pe,{$:()=>I});var l=v(89163),f=v(33887),c=v(48891),_=v(54460),w=v(47426),S=v(95670),H=v(43404),y=v(4375),oe=v(47712),G=v(76975);function k(J,ye){if(1&J&&(c.j41(0,"div")(1,"div",10)(2,"div",11),c.EFF(3),c.k0s(),c.nrm(4,"input",12),c.k0s()()),2&J){const xe=c.XpG().$implicit;c.R7$(3),c.SpI(" ",xe.title," "),c.R7$(),c.FS9("value",xe.contents[0]),c.Y8G("disabled",!0)}}function N(J,ye){if(1&J&&(c.j41(0,"div",17)(1,"span",18),c.EFF(2),c.k0s()()),2&J){const xe=ye.$implicit;c.R7$(),c.FS9("matTooltip",xe),c.R7$(),c.JRh(xe)}}function U(J,ye){if(1&J&&(c.j41(0,"div")(1,"div",13)(2,"span",14),c.EFF(3),c.k0s()(),c.j41(4,"div",15),c.DNE(5,N,3,2,"div",16),c.k0s()()),2&J){const xe=c.XpG().$implicit;c.R7$(3),c.JRh(xe.title),c.R7$(2),c.Y8G("ngForOf",xe.contents)}}function ie(J,ye){if(1&J&&(c.j41(0,"mat-radio-button",21)(1,"span",18),c.EFF(2),c.k0s()()),2&J){const xe=ye.$implicit;c.Y8G("checked",!0)("disabled",!0),c.R7$(),c.FS9("matTooltip",xe),c.R7$(),c.JRh(xe)}}function ze(J,ye){if(1&J&&(c.j41(0,"div")(1,"div",13)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"mat-radio-group",15),c.DNE(5,ie,3,4,"mat-radio-button",20),c.k0s()()),2&J){const xe=c.XpG().$implicit;c.R7$(3),c.JRh(xe.title),c.R7$(2),c.Y8G("ngForOf",xe.contents)}}function re(J,ye){if(1&J){const xe=c.RV6();c.j41(0,"div")(1,"div",10)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"div",22)(5,"mat-form-field",23)(6,"mat-select",24),c.mxI("valueChange",function(ue){c.eBV(xe);const Me=c.XpG().$implicit;return c.DH7(Me.contents[0],ue)||(Me.contents[0]=ue),c.Njj(ue)}),c.j41(7,"mat-option",25),c.EFF(8),c.k0s()()()()()}if(2&J){const xe=c.XpG().$implicit;c.R7$(3),c.JRh(xe.title),c.R7$(3),c.R50("value",xe.contents[0]),c.Y8G("disabled",!0),c.R7$(),c.FS9("value",xe.contents[0]),c.R7$(),c.JRh(xe.contents[0])}}function W(J,ye){if(1&J&&(c.qex(0,8),c.DNE(1,k,5,3,"div",9)(2,U,6,2,"div",9)(3,ze,6,2,"div",9)(4,re,9,5,"div",9),c.bVm()),2&J){const xe=ye.$implicit;c.R7$(),c.Y8G("ngIf",0==xe.type),c.R7$(),c.Y8G("ngIf",1==xe.type),c.R7$(),c.Y8G("ngIf",2==xe.type),c.R7$(),c.Y8G("ngIf",3==xe.type)}}let I=(()=>{var J;class ye extends f._{constructor(Ee,ue){super(ue,Ee),this.dialogRef=Ee,this.data=ue}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return(J=ye).\u0275fac=function(Ee){return new(Ee||J)(c.rXU(l.CP,8),c.rXU(l.Vh))},J.\u0275cmp=c.VBU({type:J,selectors:[["app-result-info-dialog"]],features:[c.Vt3],decls:12,vars:7,consts:[[1,"box","result-info-dialog"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"valueChange","value","disabled"],[2,"color","#1e293c",3,"value"]],template:function(Ee,ue){1&Ee&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s()(),c.DNE(7,W,5,4,"ng-container",5),c.k0s()(),c.j41(8,"div",6)(9,"button",7),c.bIt("click",function(){return ue.btnCloseDialog()}),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()),2&Ee&&(c.R7$(5),c.SpI(" ",c.bMT(6,3,"lang_testbank_test_config_verify_profile_student")," "),c.R7$(2),c.Y8G("ngForOf",ue.data),c.R7$(3),c.SpI(" ",c.bMT(11,5,"lang_auto_dong")," "))},dependencies:[_.Sq,_.bT,w.wT,S.rl,H.VT,H._g,y.VO,oe.oV,G.wp],encapsulation:2}),ye})()},43726:(vt,Pe,v)=>{v.d(Pe,{U:()=>K});var l=v(59640),f=v(53043),c=v(57332),_=v(73014),w=v(89163),S=v(33887),H=v(43234),y=v(48891),oe=v(36484),G=v(74225),k=v(94315),N=v(62095),U=v(51113),ie=v(99927),ze=v(40949);const W=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let I=(()=>{var ae;class de{constructor(C,M,V,Te){this.commonService=C,this.zipDataService=M,this.sAztAnswerTypeService=V,this.cdnService=Te,this.totalPointExam=0}drawAzotaFileToCanvas(C,M,V,Te){return new Promise((ve,Ze)=>{var Re="",rt=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(C.images??""));rt&&rt.url&&rt.url.includes(".azt")?this.httpGetAsync(this.cdnService.getMyCdn(rt.url)).then(st=>{st&&st.length>0?G.decodeScanOfflineFile(st).then(te=>{let We=this._arrayBufferToBase64(te.getWrappedImage()??new Uint8Array),Ue=te.getWrappedImageExtension(),E=te.scanOfflineData?.scanResult;if(We){let B=new Image;B.src="data:image/"+Ue+";base64,"+We,B.crossOrigin="anonymous",B.onload=()=>{var z=document.createElement("canvas");z.width=B.width,z.height=B.height;const L=z.getContext("2d");L?.drawImage(B,0,0,z.width,z.height);let _e=C.resultsData?.answerObjs??[];if(E?.examCodeRegion?.circles&&E?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.examCodeRegion?.circles,L),E?.studentCodeRegion?.circles&&E?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.studentCodeRegion?.circles,L),E?.answerRegion?.circles&&E?.answerRegion?.circles.length>0&&this.drawCircles(E?.answerRegion?.circles,L,_e,1,V?.filter(le=>this.sAztAnswerTypeService.isOneChoiceAnswer(le))),E?.answerRegion?.trueFalseCircles&&E?.answerRegion?.trueFalseCircles.length>0&&this.drawCircles(E?.answerRegion?.trueFalseCircles,L,_e,5,V?.filter(le=>this.sAztAnswerTypeService.isTrueFalseAnswer(le))),E?.answerRegion?.fillBlankCircles&&E?.answerRegion?.fillBlankCircles.length>0&&this.drawCircles(E?.answerRegion?.fillBlankCircles,L,_e,4,V?.filter(le=>this.sAztAnswerTypeService.isFillAnswer(le))),E?.answerRegion?.essayCircles&&E?.answerRegion?.essayCircles.length>0&&M&&this.drawCommonCircles(E?.answerRegion?.essayCircles,L),E?.answerRegion?.handwrittenAnswers&&E?.answerRegion?.handwrittenAnswers.length>0){let le=E?.answerRegion?.handwrittenAnswers,X="18px";if(L){L.fillStyle="#00ff00",L.font=X+" Comic Sans MS",L.textAlign="center";for(let Se=0;Se<le.length;Se++){let be=le[Se];this.fillTextAnswerDrawForFileAzt(be.recognizedText??"",L,_e[Se],((be.bottomRight.x??0)+(be.topLeft.x??0))/2-3,((be.bottomRight.y??0)+(be.topLeft.y??0))/2+5)}}}L&&L.fillText((this.commonService.myTranslateInstant("lang_auto_tong")??"T\u1ed5ng")+" = "+this.totalPointExam.toFixed(2),25,125),Re=z.toDataURL("image/jpeg",.9),ve({imgUrl:Re,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}}else ve({imgUrl:Re,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}):ve({imgUrl:Re,studentCode:0,subExamCode:0})}).catch(st=>{Ze(st)}):ve({imgUrl:Re,studentCode:0,subExamCode:0})})}drawScanFileToCanvas(C){return new Promise(M=>{var V="",Te=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(C.images??""));let ve=Te?this.cdnService.getMyCdn(Te.url):"";if(Te&&ve){let Ze=new Image;Ze.src=ve,Ze.crossOrigin="anonymous",Ze.onload=()=>{var Re=document.createElement("canvas");Re.width=Ze.width,Re.height=Ze.height;const rt=Re.getContext("2d");rt?.drawImage(Ze,0,0,Re.width,Re.height);var st=C.resultsData?.answerObjs??[],te=this.commonService.willDeleteParseJson(C.resultsData?.pos??"");if("2.0"==te.version)try{let Ut=Uint8Array.from(atob(te.resultFilledPos),In=>In.charCodeAt(0)),xt=new k.eX(Ut).parseDrawData(),mn=xt.studentId?.answers??[];for(var We=0;We<mn.length;We++)this.tickStudentIdAndExamId(mn[We],rt,xt.answerTable?.radius??0);let Kt=xt.examId?.answers??[];for(We=0;We<Kt.length;We++)this.tickStudentIdAndExamId(Kt[We],rt,xt.answerTable?.radius??0);let an=xt.answerTable?.answers??[];for(We=0;We<an.length;We++)this.answerPaintedRightOrWrong(an[We],rt,xt.answerTable?.radius??0,st);V=Re.toDataURL("image/jpeg",.9),M(V)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),M("")}else if("3.0"==te.version)try{let Ut=te.answersHandwritten??[],xt=(Ut[0].answerRegion.height??0)-20+"px";if(rt){rt.fillStyle="#00ff00",rt.font=xt+" Comic Sans MS",rt.textAlign="center";for(let Kt=0;Kt<Ut.length;Kt++){let an=Ut[Kt],Bt=this.getTextAnswerDraw(W[-1==an.answer?26:an.answer],rt,st[Kt]);rt.fillText(Bt,(an.answerRegion.x??0)+(an.answerRegion.width??0)/2,(an.answerRegion.y??0)+(an.answerRegion.height??0)/2+5)}}V=Re.toDataURL("image/jpeg",.9),M(V)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),M("")}else{var Ue=te.configurationPos.split("_"),E=te.resultFilledPos.split("_"),B=te.tableAnchorPos.split("_"),z=this.checkWrongOrTrueAnswer(st),L=0;for(We=0;We<Ue.length;We++)if(1==We||2==We){var _e=Ue[We].split("*");L+=parseInt(_e[1],10)}var le=0;for(We=0;We<B.length;We++)if(We>=2){var X={},Ae={},Se=B[We].split("*"),be=Se[0].split(":"),Le=Se[1].split(":"),qe={},Qe=Ue[We].split("*");qe.row=parseInt(Qe[0],10),qe.col=parseInt(Qe[1],10),qe.radius=parseInt(Qe[2],10),X.x=parseInt(be[0],10),X.y=parseInt(be[1],10),Ae.x=parseInt(Le[0],10),Ae.y=parseInt(Le[1],10);for(var P=(Ae.y-X.y)/(qe.row+1),Ne=X.y,tt=0;tt<qe.row;tt++)if((Ne+=P)>X.y&&Ne<Ae.y){var at=le<st.length?this.checkAnswerStudentRight(le,st):0;le++,0!=at&&rt&&(rt.beginPath(),rt.arc(X.x+P*at,Ne,qe.radius,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle="#f3c12c",rt.stroke())}}var ct=0;for(tt=0;tt<E.length;tt++)if("empty"!=E[tt]){var it=E[tt].split(":"),ut={x:parseInt(it[0],10),y:parseInt(it[1],10),line:parseInt(it[2],10)};tt<L+z.length&&(tt>=L?(rt&&(rt.beginPath(),rt.arc(ut.x,ut.y,ut.line,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle=z[ct],rt.stroke()),ct++):rt&&(rt.beginPath(),rt.arc(ut.x,ut.y,ut.line,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle="#00ff00",rt.stroke()))}V=Re.toDataURL("image/jpeg",.9),M(V)}}}else M("")})}_arrayBufferToBase64(C){for(var M="",V=new Uint8Array(C),Te=V.byteLength,ve=0;ve<Te;ve++)M+=String.fromCharCode(V[ve]);return window.btoa(M)}httpGetAsync(C){return new Promise((M,V)=>{try{const Te=new XMLHttpRequest;Te.open("GET",C,!0),Te.responseType="arraybuffer",Te.onload=ve=>{if(200===Te.status||304===Te.status){const Ze=Te.response;if(Ze){const Re=new Uint8Array(Ze);M(Re)}else M(new Uint8Array)}else M(new Uint8Array)},Te.onerror=ve=>{V(new Error("lang_core_cant_loading_url"))},Te.send(null)}catch(Te){V(Te)}})}fillTextAnswerDrawForFileAzt(C,M,V,Te,ve){let Ze="";V&&(C?V.rightAnswer&&"ESSAY"!=V.content&&V.rightAnswer!=C?(M.fillStyle="#f3c12c",M.fillText("["+V.rightAnswer+"]",Te+15,ve),M.fillStyle="red",Ze=C+"-",Te-=10):V.rightAnswer&&"ESSAY"!=V.content?(M.fillStyle="#00ff00",Ze+=C):(M.fillStyle="red",Ze+=C):(M.fillStyle="#f3c12c",Ze+=V.rightAnswer)),M.fillText(Ze,Te,ve)}drawCommonCircles(C,M){C.length>0&&C.forEach(V=>{if(V.filled){let Te=V.center.x,ve=V.center.y;M&&(M.beginPath(),M.arc(Te,ve,V.radius+1,0,2*Math.PI,!1),M.lineWidth=2,M.strokeStyle="#00ff00",M.stroke())}})}drawCircles(C,M,V,Te,ve){let Ze=[],Re=[],rt=["A","B","C","D"],st=0;if(V.length>0){let E=V.filter(L=>1==L.answerType||2==L.answerType).length??0,B=V.filter(L=>5==L.answerType).length??0,z=V.filter(L=>4==L.answerType).length??0;st=1==Te?E:4==Te?z:B;for(let L=0;L<V.length;L++){let _e="";if(this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:V[L].answerType})){let le=V[L].rightAnswer?.split("|")??[];for(let X=0;X<rt.length;X++)_e=L+1-E+""+rt[X]+"F",le.includes(rt[X])&&(_e=L+1-E+""+rt[X]+"T"),this.commonService.isExistInArray(Ze,_e)||Ze.push(_e)}else this.sAztAnswerTypeService.isFillAnswer({answerType:V[L].answerType})?(_e=L+1-E-B+"_"+V[L].rightAnswer,this.commonService.isExistInArray(Ze,_e)||Ze.push(_e)):this.sAztAnswerTypeService.isOneChoiceAnswer({answerType:V[L].answerType})&&(_e=L+1+""+V[L].rightAnswer,this.commonService.isExistInArray(Ze,_e)||Ze.push(_e));this.sAztAnswerTypeService.isEssayAnswer({answerType:V[L].answerType})&&Re.push(L+1)}}let Ue=1==Te?1:5==Te?2:4==Te?3:1;if(M){M.fillStyle="#ff0024",M.font="25px Comic Sans MS";let E=0,B=0,z=0,L="P"+Ue+": ",_e=!1;(ve??[]).forEach(le=>{let X=V.find(Ae=>le.id==Ae.questionId);if((this.sAztAnswerTypeService.isOneChoiceAnswer(le)||this.sAztAnswerTypeService.isFillAnswer(le))&&(E++,X?.isRight&&(B+=le.testedScore??0,z++)),this.sAztAnswerTypeService.isTrueFalseAnswer(le)){B+=le.testedScore??0;let Ae=0,Se="";for(let be=0;be<4;be++)X?.rightAnswers?.includes(W[be])?Se+="T":Se+="F";if(X?.content)for(let be=0;be<4;be++)X.content[be]==Se[be]&&Ae++;_e=!0,L+=" "+Ae+"/4;"}}),this.totalPointExam+=B,L+=_e?" = "+B.toFixed(2):z+"/"+E+" = "+B.toFixed(2),M.fillText(L,25,25+25*Ue)}C.forEach(E=>{let B=0;B=this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:Te})?Number(E.label.substring(0,E.label.length-2)):this.sAztAnswerTypeService.isFillAnswer({answerType:Te})?Number(E.label.substring(0,E.label.indexOf("_"))):Number(E.label.substring(0,E.label.length-1));let z="";if(0==Ze.length)z="#00ff00";else if(this.sAztAnswerTypeService.isFillAnswer({answerType:Te})){let L=E.label.substring(0,E.label.indexOf("_")+1),_e=Ze.find(le=>le.includes(L));if(_e){let le=_e?.split("_"),X=E.label.split("_");if(E.filled&&(z="red"),le[0]==X[0])if("-"==X[2]&&le[1].includes("-"))0==Number(X[1])&&(z=E.filled?"#00ff00":"#f3c12c");else if(","==X[2]&&le[1].includes(",")){let Ae=le[1].indexOf(",");Number(X[1])==Ae&&(z=E.filled?"#00ff00":"#f3c12c")}else"-"!=X[2]&&","!=X[2]&&le[1][Number(X[1])]==X[2]&&(z=E.filled?"#00ff00":"#f3c12c")}}else this.commonService.isExistInArray(Ze,E.label)?z=E.filled?"#00ff00":"#f3c12c":E.filled&&(z="red");if(z&&B<=st&&!this.commonService.isExistInArray(Re,B)){let L=E.center.x,_e=E.center.y;M&&(M.beginPath(),M.arc(L,_e,E.radius+1,0,2*Math.PI,!1),M.lineWidth=2,M.strokeStyle=z,M.stroke())}})}checkAnswerStudentRight(C,M){var V=0;return M[C]&&""!=M[C].rightAnswer&&0==M[C].isRight&&(V="A"==M[C].rightAnswer?1:"B"==M[C].rightAnswer?2:"C"==M[C].rightAnswer?3:"D"==M[C].rightAnswer?4:"E"==M[C].rightAnswer?5:"F"==M[C].rightAnswer?6:"G"==M[C].rightAnswer?7:"H"==M[C].rightAnswer?8:0),V}checkWrongOrTrueAnswer(C){for(var M=[],V=0;V<C.length;V++)""!=C[V].content&&(1==C[V].isRight?M.push("#00ff00"):0==C[V].isRight&&M.push("red"));return M}tickStudentIdAndExamId(C,M,V){var Te=256*Math.floor((C.position??0)/16)+C.x,ve=(C.position??0)%16*256+C.y;(C.filledCols??0)>=128&&M&&(M.beginPath(),M.arc(Te,ve,V,0,2*Math.PI,!1),M.lineWidth=3,M.strokeStyle="#00ff00",M.stroke())}answerPaintedRightOrWrong(C,M,V,Te){var ve=256*Math.floor((C.position??0)/16)+C.x,Ze=(C.position??0)%16*256+C.y,Re=C.rows??0,st="#fff0";Te.length>Re&&((C.filledCols??0)>=128?st=1==Te[Re].isRight?"#00ff00":"red":(C.filledCols??0)%128+1==this.checkAnswerStudentRight(Re,Te)&&(st="#f3c12c"),M&&(M.beginPath(),M.arc(ve,Ze,V,0,2*Math.PI,!1),M.lineWidth=3,M.strokeStyle=st,M.stroke()))}getTextAnswerDraw(C,M,V){let Te="";return V&&(C?V.isRight?(M.fillStyle="#00ff00",Te+=C):(M.fillStyle="red",Te=C+" - ["+V.rightAnswer+"]"):(M.fillStyle="#f3c12c",Te+=V.rightAnswer)),Te}}return(ae=de).\u0275fac=function(C){return new(C||ae)(y.KVO(N.R),y.KVO(U.j),y.KVO(ie._),y.KVO(ze.B))},ae.\u0275prov=y.jDH({token:ae,factory:ae.\u0275fac,providedIn:"root"}),de})();var J=v(54460),ye=v(52811),xe=v(15343),Ee=v(76975);const ue=()=>({"flex-none mr-1":!0});function Me(ae,de){1&ae&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ae&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function Ce(ae,de){1&ae&&(y.j41(0,"span",17),y.nrm(1,"azt-loading-ui"),y.k0s())}function Xe(ae,de){if(1&ae){const j=y.RV6();y.j41(0,"img",18),y.bIt("click",function(M){y.eBV(j);const V=y.XpG(2);return y.Njj(V.clickOnImage(M))}),y.k0s()}if(2&ae){const j=y.XpG(2);y.Aen(j.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",j.fileScanUrl,y.B4B)}}function Fe(ae,de){if(1&ae&&(y.j41(0,"div",14,1),y.DNE(2,Ce,2,0,"span",15)(3,Xe,1,3,"img",16),y.k0s()),2&ae){const j=y.XpG();y.R7$(2),y.Y8G("ngIf",j.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!j.loadingScanUrl)}}function mt(ae,de){1&ae&&(y.j41(0,"span",19),y.nrm(1,"azt-loading-ui"),y.k0s())}let Ge=(()=>{var ae;class de extends S._{confirmEdit(){this.initStatusObj(),this.processor.uploadToServer().then(C=>{if(!C.success){let M=C.errorMessage;return"azt_lang_core_code_exam"==M&&(M=this.commonService.myTranslateInstant("lang_core_offline_exam_not_found_offline_mix_question_hash_id")??"M\xe3 \u0111\u1ec1 thi kh\xf4ng t\u1ed3n t\u1ea1i"),this.errorStatusObj(M??"lang_core_invalid_data",!0)}this.successStatusObj("lang_auto_luu_thanh_cong",!0),this.dialogRef.close(!0)})}btnCloseDialog(){this.dialogRef.close(!1)}loadScriptHandleImage(){var C=this;this.commonService.loadAnswerSheetJs().then(()=>{var M=this.userService.getUserObj();window.azotaScanAnswerSheet.examResultProcessor(M.rememberToken,"https://"+H.c.base_embed_link,this.data.resultId,M.id).then(function(){var V=(0,_.A)(function*(Te){C.processor=Te,C.initData()});return function(Te){return V.apply(this,arguments)}}())}).catch(M=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}clickOnImage(C){const M=C.target,V=M.getBoundingClientRect();this.processData.clickToImage(M.naturalWidth/V.width*(C.clientX-V.left),M.naturalHeight/V.height*(C.clientY-V.top)),this.processDrawImage()}drawCircleImg(C,M){C&&C.length>0&&(this.circleRadius=C[0].radius,C.forEach(V=>{if(V.filled&&M){let Te=V.center.x,ve=V.center.y;M.beginPath(),M.arc(Te,ve,V.radius+1,0,2*Math.PI,!1),M.lineWidth=3,M.strokeStyle="red",M.stroke()}}))}processDrawImage(){let C=this.drawScanExamService._arrayBufferToBase64(this.processData.getWrappedImage()??new Uint8Array),M=this.processData.getWrappedImageExtension(),V=this.processData.getFilledCircles();if(this.imgSize=this.processor.getImageSize(),!C)return this.loadingScanUrl=!1,void(this.fileScanUrl="");let Te=new Image;Te.src="data:image/"+M+";base64,"+C,Te.crossOrigin="anonymous";var ve=document.createElement("canvas");ve.width=this.imgSize.width,ve.height=this.imgSize.height;const Ze=ve.getContext("2d");Te.onload=()=>{Ze?.drawImage(Te,0,0,ve.width,ve.height),this.drawCircleImg(V,Ze),this.fileScanUrl=ve.toDataURL("image/jpeg",.9),this.loadingScanUrl=!1}}initData(){this.data.resultId&&(this.loadingScanUrl=!0,this.processData=this.processor.getData(),this.processDrawImage())}ngOnInit(){super.ngOnInit(),this.loadScriptHandleImage()}constructor(C,M,V,Te){super(Te,V),this.userService=C,this.drawScanExamService=M,this.dialogRef=V,this.loadingScanUrl=!0,this.fileScanUrl="",this.circleRadius=0,this.imgSize={width:0,height:0}}}return(ae=de).\u0275fac=function(C){return new(C||ae)(y.rXU(oe.R),y.rXU(I),y.rXU(w.CP,8),y.rXU(w.Vh,8))},ae.\u0275cmp=y.VBU({type:ae,selectors:[["app-edit-scan-file-dialog"]],features:[y.Vt3],decls:20,vars:12,consts:[["showImgScan",""],["imageHolding",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md","font-semibold","flex","text-slate-500","items-center"],["name","info","size","16",3,"ngClass"],[2,"vertical-align","midle"],[1,"text-center","mx-auto","mt-1",2,"height","calc(100vh - 200px)","overflow-y","auto"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-32","btn-primary","items-center",3,"click","disabled"],["class","inline-block mr-2",4,"ngIf"],["id","image-holding"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["id","img-container","alt","img",3,"src","style","click",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["id","img-container","alt","img",3,"click","src"],[1,"inline-block","mr-2"]],template:function(C,M){if(1&C){const V=y.RV6();y.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3",5),y.nrm(4,"lucide-icon",6),y.j41(5,"span",7),y.EFF(6,"Click \u1ea3nh \u0111\u1ec3 \u0111\xe1nh d\u1ea5u v\u1ecb tr\xed c\u1ea7n s\u1eeda"),y.k0s()(),y.j41(7,"div",8),y.DNE(8,Me,4,3,"ng-container",9)(9,Fe,4,2,"ng-template",null,0,y.C5r),y.k0s()()(),y.j41(11,"div",10)(12,"button",11),y.bIt("click",function(){return y.eBV(V),y.Njj(M.btnCloseDialog())}),y.EFF(13),y.nI1(14,"mytranslate"),y.k0s(),y.j41(15,"button",12),y.bIt("click",function(){return y.eBV(V),y.Njj(M.confirmEdit())}),y.DNE(16,mt,2,0,"span",13),y.j41(17,"span",7),y.EFF(18),y.nI1(19,"mytranslate"),y.k0s()()()()}if(2&C){const V=y.sdS(10);y.R7$(4),y.Y8G("ngClass",y.lJ4(11,ue)),y.R7$(4),y.Y8G("ngIf",!M.loadingScanUrl&&!M.fileScanUrl)("ngIfElse",V),y.R7$(5),y.SpI(" ",y.bMT(14,7,"lang_cms_common_close_btn")," "),y.R7$(2),y.Y8G("disabled",M.statusObj.loading),y.R7$(),y.Y8G("ngIf",M.statusObj.loading),y.R7$(2),y.JRh(y.bMT(19,9,"lang_auto_luu"))}},dependencies:[J.YU,J.bT,ye.R,xe.WGl,Ee.wp],encapsulation:2}),de})();var he=v(46899),Ke=v(47712);const Q=()=>({"text-slate-800":!0}),se=()=>({"text-danger":!0}),Be=ae=>({"text-success":ae});function we(ae,de){if(1&ae){const j=y.RV6();y.j41(0,"div",20)(1,"a",21),y.nI1(2,"mytranslate"),y.bIt("click",function(){let M;y.eBV(j);const V=y.XpG(2);return y.Njj(V.deleteOfflineExamResultObj(null!==(M=null==V.examObj?null:V.examObj.hashId)&&void 0!==M?M:"",V.examResultIdParam))}),y.nrm(3,"lucide-icon",22),y.k0s()()}2&ae&&(y.R7$(),y.Y8G("matTooltip",y.bMT(2,2,"lang_auto_xoa")),y.R7$(2),y.Y8G("ngClass",y.lJ4(4,se)))}function $(ae,de){1&ae&&(y.j41(0,"span",23),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ae&&(y.R7$(),y.SpI("",y.bMT(2,1,"lang_auto_anh_cham"),": "))}function me(ae,de){1&ae&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ae&&(y.R7$(),y.JRh(y.bMT(2,1,"lang_auto_luu_trong_app_mobile")))}function lt(ae,de){1&ae&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ae&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function Dt(ae,de){1&ae&&(y.j41(0,"span",29),y.nrm(1,"azt-loading-ui"),y.k0s())}function nt(ae,de){if(1&ae&&y.nrm(0,"img",30),2&ae){const j=y.XpG(4);y.Aen(j.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",j.fileScanUrl,y.B4B)}}function Et(ae,de){if(1&ae){const j=y.RV6();y.j41(0,"a",26),y.bIt("click",function(){y.eBV(j);const M=y.XpG(3);return y.Njj(M.onShowFile(M.fileScanUrl))}),y.DNE(1,Dt,2,0,"span",27)(2,nt,1,3,"img",28),y.k0s()}if(2&ae){const j=y.XpG(3);y.R7$(),y.Y8G("ngIf",j.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!j.loadingScanUrl)}}function Ye(ae,de){if(1&ae&&(y.j41(0,"div",24),y.DNE(1,lt,4,3,"ng-container",25)(2,Et,3,2,"ng-template",null,2,y.C5r),y.k0s()),2&ae){const j=y.sdS(3),C=y.XpG(2);y.R7$(),y.Y8G("ngIf",!C.loadingScanUrl&&!C.fileScanUrl)("ngIfElse",j)}}function ft(ae,de){if(1&ae){const j=y.RV6();y.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"h3",7)(4,"span"),y.EFF(5),y.nI1(6,"mytranslate"),y.k0s()(),y.j41(7,"div",8)(8,"a",9),y.nI1(9,"mytranslate"),y.bIt("click",function(){let M;y.eBV(j);const V=y.XpG();return y.Njj(V.openEditScanFile(null!==(M=null==V.examObj?null:V.examObj.hashId)&&void 0!==M?M:"",V.examResultIdParam))}),y.nrm(10,"lucide-icon",10),y.k0s()(),y.DNE(11,we,4,5,"div",11),y.k0s()(),y.j41(12,"div",12)(13,"div",6)(14,"span",13),y.eu8(15,14),y.k0s(),y.j41(16,"span",15),y.nI1(17,"mytranslate"),y.eu8(18,14),y.k0s()(),y.j41(19,"div",16),y.DNE(20,$,3,3,"span",17)(21,me,3,3,"span",18),y.k0s(),y.DNE(22,Ye,4,2,"div",19),y.k0s()()}if(2&ae){const j=y.XpG(),C=y.sdS(2),M=y.sdS(4);y.R7$(5),y.SpI(" ",y.bMT(6,10,"lang_auto_thi_offline")," "),y.R7$(3),y.Y8G("matTooltip",y.bMT(9,12,"lang_auto_sua")),y.R7$(2),y.Y8G("ngClass",y.lJ4(16,Q)),y.R7$(),y.Y8G("ngIf",j.isDeletableExamResultObj),y.R7$(4),y.Y8G("ngTemplateOutlet",C),y.R7$(),y.FS9("matTooltip",y.bMT(17,14,"lang_auto_so_bao_danh")),y.R7$(2),y.Y8G("ngTemplateOutlet",M),y.R7$(2),y.Y8G("ngIf",!j.isMobileWebView),y.R7$(),y.Y8G("ngIf",!j.checkHttpLinkImg),y.R7$(),y.Y8G("ngIf",j.checkHttpLinkImg)}}function Je(ae,de){if(1&ae&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatOfflineExamHashIdToNumber"),y.k0s()),2&ae){let j;const C=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_auto_ma_de_thi"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,Be,!(null!=C.offlineMarkObj&&C.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),y.R7$(),y.JRh(y.i5U(4,5,null!==(j=null==C.offlineMixQuestionObj?null:C.offlineMixQuestionObj.hashId)&&void 0!==j?j:0,3))}}function je(ae,de){if(1&ae&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatStudentCodeToNumber"),y.k0s()),2&ae){let j;const C=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,Be,!(null!=C.offlineMarkObj&&C.offlineMarkObj.isErrorForStudentCode))),y.R7$(),y.JRh(y.i5U(4,5,(null!==(j=null==C.offlineMarkObj?null:C.offlineMarkObj.studentCode)&&void 0!==j?j:0)<0?0:null==C.offlineMarkObj?null:C.offlineMarkObj.studentCode,6))}}let K=(()=>{var ae;class de extends l.H{checkAzotaFile(C){return!(!C||!C.includes(".azt"))}checkHttpUrl(C){return!(!C||!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(C))}openEditScanFile(C,M){M&&this.sAztDialogService.open(Ge,{data:{examHashId:C,resultId:M,userId:Number(this.userIdParam)},width:"750px",restoreFocus:!1}).afterClosed().subscribe(Te=>{Te&&window.location.reload()})}deleteOfflineExamResultObj(C,M){M&&this.sAztDialogService.open(c.V,{data:{examHashId:C,examResultIds:[M],examResults:[]},restoreFocus:!1}).afterClosed().subscribe(Te=>{Te&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(C){this.sAztDialogService.open(f.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:C,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let C=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),M=this.castJsonToObj(C);this.checkHttpLinkImg=this.checkHttpUrl(M?.url),this.loadingScanUrl=!0,this.checkAzotaFile(M?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam,this.questionObjs,this.essayMark).then(V=>{V.imgUrl?this.fileScanUrl=V.imgUrl:this.checkHttpLinkImg=!0,this.drawScanExamService.totalPointExam=0,this.loadingScanUrl=!1}).catch(V=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(V=>{V?this.fileScanUrl=V:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(V=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(C,M,V){super(),this.sAztDialogService=C,this.zipDataService=M,this.drawScanExamService=V,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return(ae=de).\u0275fac=function(C){return new(C||ae)(y.rXU(he.i),y.rXU(U.j),y.rXU(I))},ae.\u0275cmp=y.VBU({type:ae,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj",questionObjs:"questionObjs",essayMark:"essayMark"},features:[y.Vt3,y.OA$],decls:5,vars:1,consts:[["viewExamCodeTpl",""],["viewStudentCodeTpl",""],["showImgScan",""],["class","info-exam-offline mt-3 mb-3",4,"ngIf"],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],[1,"mx-1","items-center"],[1,"text-slate-800",3,"click","matTooltip"],["name","file-pen-line","size","18",3,"ngClass"],["class","mx-1 items-center mr-0",4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],[4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],[1,"mx-1","items-center","mr-0"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click","matTooltip"],["name","trash-2","size","18",3,"ngClass"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["alt","img",3,"src"],[3,"ngClass"]],template:function(C,M){1&C&&y.DNE(0,ft,23,17,"div",3)(1,Je,5,10,"ng-template",null,0,y.C5r)(3,je,5,10,"ng-template",null,1,y.C5r),2&C&&y.Y8G("ngIf",M.offlineMarkObj)},dependencies:[J.YU,J.bT,J.T3,Ke.oV,ye.R,xe.WGl,Ee.wp,Ee.Po,Ee.IX],encapsulation:2}),de})()},37642:(vt,Pe,v)=>{v.d(Pe,{E:()=>f});var l=v(48891);let f=(()=>{var c;class _{getDictionaryByGroupFieldTS(S,H){for(var y={},oe=0;oe<S.length;oe++)S[oe].hasOwnProperty(H)&&("number"==typeof S[oe][H]||"string"==typeof S[oe][H])&&(y.hasOwnProperty(S[oe][H])||(y[S[oe][H]]=[]),y[S[oe][H]].push(S[oe]));return y}getDictionaryByFieldTS(S,H){for(var y={},oe=0;oe<S.length;oe++)S[oe].hasOwnProperty(H)&&("number"==typeof S[oe][H]||"string"==typeof S[oe][H])&&(y[S[oe][H]]=S[oe]);return y}getDictionaryBy2FieldsTS(S,H,y){for(var oe={},G=0;G<S.length;G++)S[G].hasOwnProperty(H)&&("number"==typeof S[G][H]||"string"==typeof S[G][H])&&S[G].hasOwnProperty(y)&&("number"==typeof S[G][y]||"string"==typeof S[G][y])&&(oe[S[G][H]+"_"+S[G][y]]=S[G]);return oe}getListValueByFieldNumberTS(S,H){for(var y=[],oe=0;oe<S.length;oe++)S[oe].hasOwnProperty(H)&&"number"==typeof S[oe][H]&&y.push(S[oe][H]);return y}getListValueByField(S,H){for(var y=[],oe=0;oe<S.length;oe++)if(S[oe].hasOwnProperty(H)){var G=y.filter(k=>k[H]==S[oe][H]);(!G||0==G.length)&&y.push(S[oe])}return y}}return(c=_).\u0275fac=function(S){return new(S||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),_})()},99172:(vt,Pe,v)=>{v.d(Pe,{p:()=>S});var l=v(73014),f=v(48891),c=v(62095),_=v(40949),w=v(53393);let S=(()=>{var H;class y{processEssayResultToBase64(G){var k=this;return(0,l.A)(function*(){for(const N of G.pages??[]){if(N.draw){const U=yield k.exportPdfUtilsService.convertAndRetryToBase64(N.draw);N.draw=U}if(N.backgroundImage){const U=yield k.exportPdfUtilsService.convertAndRetryToBase64(N.backgroundImage);N.backgroundImage=U}}if(G.commentEmoji&&G.commentEmoji.length){let N="https://azota889.github.io/storage_public/mnote/",U=G.commentEmoji.length;for(let ie=0;ie<U;ie++){let ze=N+G.commentEmoji[ie];const re=yield k.exportPdfUtilsService.convertAndRetryToBase64(ze);G.commentEmoji[ie]=re}}return G})()}convertAnswersArr(G,k){0!=G.length&&G.forEach(N=>{N.QuestionId&&N.AnswerContent&&N.AnswerContent[0]&&N.AnswerContent[0].Content&&(k[`id_${N.QuestionId}`]=N.AnswerContent[0].Content)})}findScaleDirection(G,k){return G/k>=.7070707070707071?"w":"h"}constructor(G,k,N){this.commonService=G,this.cdnService=k,this.exportPdfUtilsService=N}}return(H=y).\u0275fac=function(G){return new(G||H)(f.KVO(c.R),f.KVO(_.B),f.KVO(w.j))},H.\u0275prov=f.jDH({token:H,factory:H.\u0275fac,providedIn:"root"}),y})()},53393:(vt,Pe,v)=>{v.d(Pe,{j:()=>H});var l=v(73014),f=function(y){return y[y.Cdn=0]="Cdn",y[y.CdnTimestamp=1]="CdnTimestamp",y[y.Rawlink=2]="Rawlink",y[y.RawlinkTimestamp=3]="RawlinkTimestamp",y}(f||{}),c=v(48891),_=v(62095),w=v(40949),S=v(99927);let H=(()=>{var y;class oe{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){const k=navigator.userAgent,U=(()=>{let ze=null;const re=k.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(re[1]))return"IE "+((/\brv[ :]+(\d+)/g.exec(k)||[])[1]||"");if("Chrome"===re[1]){const I=k.match(/\b(OPR|Edge)\/(\d+)/);if(null!==I)return I.slice(1).join(" ").replace("OPR","Opera")}const W=re[2]?[re[1],re[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!==(ze=k.match(/version\/(\d+)/i))&&W.splice(1,1,ze[1]),W.join(" ")})().toString();return!(!["chrome"].includes(U.split(" ")[0].toLowerCase())||parseInt(U.split(" ")[1],10)<80)}getExtensionFile(k){if(!k)return"";const N=k.split(".");return N.length<=1?"":N[N.length-1].toLocaleLowerCase().split("_")[0]}findImageSrcInContent(k){let N="";if(k.includes("img")){const U=k.indexOf("img"),ie=k.indexOf("src=",U),ze=k.indexOf('"',Number(ie)+5);N=k.substring(Number(ie)+5,Number(ze))}return N}asyncTimeout(k){return(0,l.A)(function*(){return`Waited ${yield new Promise(U=>{setTimeout(()=>U(k),k)})} milliseconds`})()}parseEssayMarkResult(k,N){let U=k.filter(re=>this.answerTypeService.isEssayAnswer(re));if(0!=U.length&&N&&N.essayResult){var ie=this.commonService.willDeleteParseJson(N.essayResult);if(ie){var ze=Object.entries(ie);for(let re=0;re<U.length;re++)U[re].essayMarkParsed=ze[re][1]}}}convertToBase64(k,N){var U=this;return(0,l.A)(function*(){let ie=k;switch(N){case f.Cdn:ie=U.cdnService.getMyCdn(k);break;case f.CdnTimestamp:ie=U.cdnService.getMyCdn(k)+"?t="+Date.now();break;case f.RawlinkTimestamp:ie=k+"?t="+Date.now()}const re=yield(yield fetch(ie)).blob(),W=yield new Promise(I=>{const J=new FileReader;J.readAsDataURL(re),J.onloadend=()=>{I(J.result)}});return W&&"string"==typeof W?W:k})()}convertAndRetryToBase64(k){var N=this;return(0,l.A)(function*(){let U=N.getExtensionFile(k);if(["pdf","jpg","jpeg","png","gif"].includes(U)){let ie;const ze=[f.Cdn,f.CdnTimestamp,f.Rawlink,f.RawlinkTimestamp];try{ie=yield N.convertToBase64(k,ze[0])}catch{try{ie=yield N.convertToBase64(k,ze[1])}catch{try{ie=yield N.convertToBase64(k,ze[2])}catch{try{ie=yield N.convertToBase64(k,ze[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+k),ie=k}}}}return ie}return k})()}eraseCanvas(k){k&&(k.beginPath(),k.rect(0,0,k.canvas.width,k.canvas.height),k.fillStyle="white",k.fill())}addContentToPdf(k,N){k.addImage(N,"JPEG",0,0,k.internal.pageSize.getWidth(),k.internal.pageSize.getHeight())}drawTextWrap(k,N,U,ie,ze){const re=k.split(" "),W=[];let I=re[0];if(N){N.font=ze||`${ie}px Arial`;for(let J=1;J<re.length;J++){const ye=re[J];N.measureText(I+" "+ye).width<U?I+=" "+ye:(W.push(I),I=ye)}W.push(I)}return W}essayText2LinesArr(k,N,U,ie,ze){const re=new RegExp("(<br>|<br/>)+","igm"),I=(this.replaceAllByRegExp(k,re,"<br>")??"").split("<br>"),J=[];for(let ye=0;ye<I.length;ye++)J.push(this.drawTextWrap(I[ye],N,U,ie,ze));return J}replaceAllByRegExp(k,N,U){return U?k?k.toString().replace(N,U):void 0:k}removeTagAssistiveMml(){const k=document.getElementsByTagName("mjx-assistive-mml");for(;k.length>0;)k[0].remove()}constructor(k,N,U){this.commonService=k,this.cdnService=N,this.answerTypeService=U}}return(y=oe).\u0275fac=function(k){return new(k||y)(c.KVO(_.R),c.KVO(w.B),c.KVO(S._))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),oe})()},38566:(vt,Pe,v)=>{v.d(Pe,{s:()=>Up});var G,k,l=v(73014),f=v(92757),c=v(18936),_=v(85980),w=v(64627),S=v(56094),H=v(17791),y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oe={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function s(q,O,F){F||(F=0);var Y=Array(16);if("string"==typeof O)for(var ee=0;16>ee;++ee)Y[ee]=O.charCodeAt(F++)|O.charCodeAt(F++)<<8|O.charCodeAt(F++)<<16|O.charCodeAt(F++)<<24;else for(ee=0;16>ee;++ee)Y[ee]=O[F++]|O[F++]<<8|O[F++]<<16|O[F++]<<24;var ce=q.g[3],D=(O=q.g[0])+(ce^(F=q.g[1])&((ee=q.g[2])^ce))+Y[0]+3614090360&4294967295;D=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=(F=(ee=(ce=(O=F+(D<<7&4294967295|D>>>25))+((D=ce+(ee^O&(F^ee))+Y[1]+3905402710&4294967295)<<12&4294967295|D>>>20))+((D=ee+(F^ce&(O^F))+Y[2]+606105819&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^ee&(ce^O))+Y[3]+3250441966&4294967295)<<22&4294967295|D>>>10))+((D=O+(ce^F&(ee^ce))+Y[4]+4118548399&4294967295)<<7&4294967295|D>>>25))+((D=ce+(ee^O&(F^ee))+Y[5]+1200080426&4294967295)<<12&4294967295|D>>>20))+((D=ee+(F^ce&(O^F))+Y[6]+2821735955&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^ee&(ce^O))+Y[7]+4249261313&4294967295)<<22&4294967295|D>>>10))+((D=O+(ce^F&(ee^ce))+Y[8]+1770035416&4294967295)<<7&4294967295|D>>>25))+((D=ce+(ee^O&(F^ee))+Y[9]+2336552879&4294967295)<<12&4294967295|D>>>20))+((D=ee+(F^ce&(O^F))+Y[10]+4294925233&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^ee&(ce^O))+Y[11]+2304563134&4294967295)<<22&4294967295|D>>>10))+((D=O+(ce^F&(ee^ce))+Y[12]+1804603682&4294967295)<<7&4294967295|D>>>25))+((D=ce+(ee^O&(F^ee))+Y[13]+4254626195&4294967295)<<12&4294967295|D>>>20))+((D=ee+(F^ce&(O^F))+Y[14]+2792965006&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^ee&(ce^O))+Y[15]+1236535329&4294967295)<<22&4294967295|D>>>10))+((D=O+(ee^ce&(F^ee))+Y[1]+4129170786&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^ee&(O^F))+Y[6]+3225465664&4294967295)<<9&4294967295|D>>>23))+((D=ee+(O^F&(ce^O))+Y[11]+643717713&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(ee^ce))+Y[0]+3921069994&4294967295)<<20&4294967295|D>>>12))+((D=O+(ee^ce&(F^ee))+Y[5]+3593408605&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^ee&(O^F))+Y[10]+38016083&4294967295)<<9&4294967295|D>>>23))+((D=ee+(O^F&(ce^O))+Y[15]+3634488961&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(ee^ce))+Y[4]+3889429448&4294967295)<<20&4294967295|D>>>12))+((D=O+(ee^ce&(F^ee))+Y[9]+568446438&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^ee&(O^F))+Y[14]+3275163606&4294967295)<<9&4294967295|D>>>23))+((D=ee+(O^F&(ce^O))+Y[3]+4107603335&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(ee^ce))+Y[8]+1163531501&4294967295)<<20&4294967295|D>>>12))+((D=O+(ee^ce&(F^ee))+Y[13]+2850285829&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^ee&(O^F))+Y[2]+4243563512&4294967295)<<9&4294967295|D>>>23))+((D=ee+(O^F&(ce^O))+Y[7]+1735328473&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(ee^ce))+Y[12]+2368359562&4294967295)<<20&4294967295|D>>>12))+((D=O+(F^ee^ce)+Y[5]+4294588738&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^ee)+Y[8]+2272392833&4294967295)<<11&4294967295|D>>>21))+((D=ee+(ce^O^F)+Y[11]+1839030562&4294967295)<<16&4294967295|D>>>16))+((D=F+(ee^ce^O)+Y[14]+4259657740&4294967295)<<23&4294967295|D>>>9))+((D=O+(F^ee^ce)+Y[1]+2763975236&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^ee)+Y[4]+1272893353&4294967295)<<11&4294967295|D>>>21))+((D=ee+(ce^O^F)+Y[7]+4139469664&4294967295)<<16&4294967295|D>>>16))+((D=F+(ee^ce^O)+Y[10]+3200236656&4294967295)<<23&4294967295|D>>>9))+((D=O+(F^ee^ce)+Y[13]+681279174&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^ee)+Y[0]+3936430074&4294967295)<<11&4294967295|D>>>21))+((D=ee+(ce^O^F)+Y[3]+3572445317&4294967295)<<16&4294967295|D>>>16))+((D=F+(ee^ce^O)+Y[6]+76029189&4294967295)<<23&4294967295|D>>>9))+((D=O+(F^ee^ce)+Y[9]+3654602809&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^ee)+Y[12]+3873151461&4294967295)<<11&4294967295|D>>>21))+((D=ee+(ce^O^F)+Y[15]+530742520&4294967295)<<16&4294967295|D>>>16))+((D=F+(ee^ce^O)+Y[2]+3299628645&4294967295)<<23&4294967295|D>>>9))+((D=O+(ee^(F|~ce))+Y[0]+4096336452&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~ee))+Y[7]+1126891415&4294967295)<<10&4294967295|D>>>22))+((D=ee+(O^(ce|~F))+Y[14]+2878612391&4294967295)<<15&4294967295|D>>>17))+((D=F+(ce^(ee|~O))+Y[5]+4237533241&4294967295)<<21&4294967295|D>>>11))+((D=O+(ee^(F|~ce))+Y[12]+1700485571&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~ee))+Y[3]+2399980690&4294967295)<<10&4294967295|D>>>22))+((D=ee+(O^(ce|~F))+Y[10]+4293915773&4294967295)<<15&4294967295|D>>>17))+((D=F+(ce^(ee|~O))+Y[1]+2240044497&4294967295)<<21&4294967295|D>>>11))+((D=O+(ee^(F|~ce))+Y[8]+1873313359&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~ee))+Y[15]+4264355552&4294967295)<<10&4294967295|D>>>22))+((D=ee+(O^(ce|~F))+Y[6]+2734768916&4294967295)<<15&4294967295|D>>>17))+((D=F+(ce^(ee|~O))+Y[13]+1309151649&4294967295)<<21&4294967295|D>>>11))+((ce=(O=F+((D=O+(ee^(F|~ce))+Y[4]+4149444226&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~ee))+Y[11]+3174756917&4294967295)<<10&4294967295|D>>>22))^((ee=ce+((D=ee+(O^(ce|~F))+Y[2]+718787259&4294967295)<<15&4294967295|D>>>17))|~O))+Y[9]+3951481745&4294967295,q.g[0]=q.g[0]+O&4294967295,q.g[1]=q.g[1]+(ee+(D<<21&4294967295|D>>>11))&4294967295,q.g[2]=q.g[2]+ee&4294967295,q.g[3]=q.g[3]+ce&4294967295}function o(q,O){this.h=O;for(var F=[],Y=!0,ee=q.length-1;0<=ee;ee--){var ce=0|q[ee];Y&&ce==O||(F[ee]=ce,Y=!1)}this.g=F}(function e(q,O){function F(){}F.prototype=O.prototype,q.D=O.prototype,q.prototype=new F,q.prototype.constructor=q,q.C=function(Y,ee,ce){for(var D=Array(arguments.length-2),Dn=2;Dn<arguments.length;Dn++)D[Dn-2]=arguments[Dn];return O.prototype[ee].apply(Y,D)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(q,O){void 0===O&&(O=q.length);for(var F=O-this.blockSize,Y=this.B,ee=this.h,ce=0;ce<O;){if(0==ee)for(;ce<=F;)s(this,q,ce),ce+=this.blockSize;if("string"==typeof q){for(;ce<O;)if(Y[ee++]=q.charCodeAt(ce++),ee==this.blockSize){s(this,Y),ee=0;break}}else for(;ce<O;)if(Y[ee++]=q[ce++],ee==this.blockSize){s(this,Y),ee=0;break}}this.h=ee,this.o+=O},n.prototype.v=function(){var q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);q[0]=128;for(var O=1;O<q.length-8;++O)q[O]=0;var F=8*this.o;for(O=q.length-8;O<q.length;++O)q[O]=255&F,F/=256;for(this.u(q),q=Array(16),O=F=0;4>O;++O)for(var Y=0;32>Y;Y+=8)q[F++]=this.g[O]>>>Y&255;return q};var u={};function h(q){return-128<=q&&128>q?function i(q,O){var F=u;return Object.prototype.hasOwnProperty.call(F,q)?F[q]:F[q]=O(q)}(q,function(O){return new o([0|O],0>O?-1:0)}):new o([0|q],0>q?-1:0)}function m(q){if(isNaN(q)||!isFinite(q))return x;if(0>q)return Oe(m(-q));for(var O=[],F=1,Y=0;q>=F;Y++)O[Y]=q/F|0,F*=4294967296;return new o(O,0)}var x=h(0),R=h(1),Z=h(16777216);function Ie(q){if(0!=q.h)return!1;for(var O=0;O<q.g.length;O++)if(0!=q.g[O])return!1;return!0}function De(q){return-1==q.h}function Oe(q){for(var O=q.g.length,F=[],Y=0;Y<O;Y++)F[Y]=~q.g[Y];return new o(F,~q.h).add(R)}function He(q,O){return q.add(Oe(O))}function ot(q,O){for(;(65535&q[O])!=q[O];)q[O+1]+=q[O]>>>16,q[O]&=65535,O++}function et(q,O){this.g=q,this.h=O}function ht(q,O){if(Ie(O))throw Error("division by zero");if(Ie(q))return new et(x,x);if(De(q))return O=ht(Oe(q),O),new et(Oe(O.g),Oe(O.h));if(De(O))return O=ht(q,Oe(O)),new et(Oe(O.g),O.h);if(30<q.g.length){if(De(q)||De(O))throw Error("slowDivide_ only works with positive integers.");for(var F=R,Y=O;0>=Y.l(q);)F=Tt(F),Y=Tt(Y);var ee=_t(F,1),ce=_t(Y,1);for(Y=_t(Y,2),F=_t(F,2);!Ie(Y);){var D=ce.add(Y);0>=D.l(q)&&(ee=ee.add(F),ce=D),Y=_t(Y,1),F=_t(F,1)}return O=He(q,ee.j(O)),new et(ee,O)}for(ee=x;0<=q.l(O);){for(F=Math.max(1,Math.floor(q.m()/O.m())),Y=48>=(Y=Math.ceil(Math.log(F)/Math.LN2))?1:Math.pow(2,Y-48),D=(ce=m(F)).j(O);De(D)||0<D.l(q);)D=(ce=m(F-=Y)).j(O);Ie(ce)&&(ce=R),ee=ee.add(ce),q=He(q,D)}return new et(ee,q)}function Tt(q){for(var O=q.g.length+1,F=[],Y=0;Y<O;Y++)F[Y]=q.i(Y)<<1|q.i(Y-1)>>>31;return new o(F,q.h)}function _t(q,O){var F=O>>5;O%=32;for(var Y=q.g.length-F,ee=[],ce=0;ce<Y;ce++)ee[ce]=0<O?q.i(ce+F)>>>O|q.i(ce+F+1)<<32-O:q.i(ce+F);return new o(ee,q.h)}(r=o.prototype).m=function(){if(De(this))return-Oe(this).m();for(var q=0,O=1,F=0;F<this.g.length;F++){var Y=this.i(F);q+=(0<=Y?Y:4294967296+Y)*O,O*=4294967296}return q},r.toString=function(q){if(2>(q=q||10)||36<q)throw Error("radix out of range: "+q);if(Ie(this))return"0";if(De(this))return"-"+Oe(this).toString(q);for(var O=m(Math.pow(q,6)),F=this,Y="";;){var ee=ht(F,O).g,ce=((0<(F=He(F,ee.j(O))).g.length?F.g[0]:F.h)>>>0).toString(q);if(Ie(F=ee))return ce+Y;for(;6>ce.length;)ce="0"+ce;Y=ce+Y}},r.i=function(q){return 0>q?0:q<this.g.length?this.g[q]:this.h},r.l=function(q){return De(q=He(this,q))?-1:Ie(q)?0:1},r.abs=function(){return De(this)?Oe(this):this},r.add=function(q){for(var O=Math.max(this.g.length,q.g.length),F=[],Y=0,ee=0;ee<=O;ee++){var ce=Y+(65535&this.i(ee))+(65535&q.i(ee)),D=(ce>>>16)+(this.i(ee)>>>16)+(q.i(ee)>>>16);Y=D>>>16,F[ee]=(D&=65535)<<16|(ce&=65535)}return new o(F,-2147483648&F[F.length-1]?-1:0)},r.j=function(q){if(Ie(this)||Ie(q))return x;if(De(this))return De(q)?Oe(this).j(Oe(q)):Oe(Oe(this).j(q));if(De(q))return Oe(this.j(Oe(q)));if(0>this.l(Z)&&0>q.l(Z))return m(this.m()*q.m());for(var O=this.g.length+q.g.length,F=[],Y=0;Y<2*O;Y++)F[Y]=0;for(Y=0;Y<this.g.length;Y++)for(var ee=0;ee<q.g.length;ee++){var ce=this.i(Y)>>>16,D=65535&this.i(Y),Dn=q.i(ee)>>>16,$s=65535&q.i(ee);F[2*Y+2*ee]+=D*$s,ot(F,2*Y+2*ee),F[2*Y+2*ee+1]+=ce*$s,ot(F,2*Y+2*ee+1),F[2*Y+2*ee+1]+=D*Dn,ot(F,2*Y+2*ee+1),F[2*Y+2*ee+2]+=ce*Dn,ot(F,2*Y+2*ee+2)}for(Y=0;Y<O;Y++)F[Y]=F[2*Y+1]<<16|F[2*Y];for(Y=O;Y<2*O;Y++)F[Y]=0;return new o(F,0)},r.A=function(q){return ht(this,q).h},r.and=function(q){for(var O=Math.max(this.g.length,q.g.length),F=[],Y=0;Y<O;Y++)F[Y]=this.i(Y)&q.i(Y);return new o(F,this.h&q.h)},r.or=function(q){for(var O=Math.max(this.g.length,q.g.length),F=[],Y=0;Y<O;Y++)F[Y]=this.i(Y)|q.i(Y);return new o(F,this.h|q.h)},r.xor=function(q){for(var O=Math.max(this.g.length,q.g.length),F=[],Y=0;Y<O;Y++)F[Y]=this.i(Y)^q.i(Y);return new o(F,this.h^q.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,k=oe.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=m,o.fromString=function g(q,O){if(0==q.length)throw Error("number format error: empty string");if(2>(O=O||10)||36<O)throw Error("radix out of range: "+O);if("-"==q.charAt(0))return Oe(g(q.substring(1),O));if(0<=q.indexOf("-"))throw Error('number format error: interior "-" character');for(var F=m(Math.pow(O,8)),Y=x,ee=0;ee<q.length;ee+=8){var ce=Math.min(8,q.length-ee),D=parseInt(q.substring(ee,ee+ce),O);8>ce?(ce=m(Math.pow(O,ce)),Y=Y.j(ce).add(m(D))):Y=(Y=Y.j(F)).add(m(D))}return Y},G=oe.Integer=o}).apply(typeof y<"u"?y:typeof self<"u"?self:typeof window<"u"?window:{});var ie,ze,re,W,I,J,ye,xe,Ee,N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},U={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,p){return a==Array.prototype||a==Object.prototype||(a[d]=p.value),a},n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof N&&N];for(var d=0;d<a.length;++d){var p=a[d];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}(this);!function s(a,d){if(d)e:{var p=n;a=a.split(".");for(var b=0;b<a.length-1;b++){var ne=a[b];if(!(ne in p))break e;p=p[ne]}(d=d(b=p[a=a[a.length-1]]))!=b&&null!=d&&e(p,a,{configurable:!0,writable:!0,value:d})}}("Array.prototype.values",function(a){return a||function(){return function i(a,d){a instanceof String&&(a+="");var p=0,b=!1,ne={next:function(){if(!b&&p<a.length){var pe=p++;return{value:d(pe,a[pe]),done:!1}}return b=!0,{done:!0,value:void 0}}};return ne[Symbol.iterator]=function(){return ne},ne}(this,function(d,p){return p})}});var o=o||{},u=this||self;function h(a){var d=typeof a;return"array"==(d="object"!=d?d:a?Array.isArray(a)?"array":d:"null")||"object"==d&&"number"==typeof a.length}function m(a){var d=typeof a;return"object"==d&&null!=a||"function"==d}function g(a,d,p){return a.call.apply(a.bind,arguments)}function x(a,d,p){if(!a)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var ne=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ne,b),a.apply(d,ne)}}return function(){return a.apply(d,arguments)}}function R(a,d,p){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:x).apply(null,arguments)}function Z(a,d){var p=Array.prototype.slice.call(arguments,1);return function(){var b=p.slice();return b.push.apply(b,arguments),a.apply(this,b)}}function Ie(a,d){function p(){}p.prototype=d.prototype,a.aa=d.prototype,a.prototype=new p,a.prototype.constructor=a,a.Qb=function(b,ne,pe){for(var $e=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)$e[Ct-2]=arguments[Ct];return d.prototype[ne].apply(b,$e)}}function De(a){const d=a.length;if(0<d){const p=Array(d);for(let b=0;b<d;b++)p[b]=a[b];return p}return[]}function Oe(a,d){for(let p=1;p<arguments.length;p++){const b=arguments[p];if(h(b)){const ne=a.length||0,pe=b.length||0;a.length=ne+pe;for(let $e=0;$e<pe;$e++)a[ne+$e]=b[$e]}else a.push(b)}}function ot(a){return/^[\s\xa0]*$/.test(a)}function et(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function ht(a){return ht[" "](a),a}ht[" "]=function(){};var Tt=!(-1==et().indexOf("Gecko")||-1!=et().toLowerCase().indexOf("webkit")&&-1==et().indexOf("Edge")||-1!=et().indexOf("Trident")||-1!=et().indexOf("MSIE")||-1!=et().indexOf("Edge"));function _t(a,d,p){for(const b in a)d.call(p,a[b],b,a)}function O(a){const d={};for(const p in a)d[p]=a[p];return d}const F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(a,d){let p,b;for(let ne=1;ne<arguments.length;ne++){for(p in b=arguments[ne],b)a[p]=b[p];for(let pe=0;pe<F.length;pe++)p=F[pe],Object.prototype.hasOwnProperty.call(b,p)&&(a[p]=b[p])}}function ee(a){var d=1;a=a.split(":");const p=[];for(;0<d&&a.length;)p.push(a.shift()),d--;return a.length&&p.push(a.join(":")),p}function ce(a){u.setTimeout(()=>{throw a},0)}function D(){var a=ec;let d=null;return a.g&&(d=a.g,a.g=a.g.next,a.g||(a.h=null),d.next=null),d}var $s=new class He{constructor(d,p){this.i=d,this.j=p,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}(()=>new $p,a=>a.reset());class $p{constructor(){this.next=this.g=this.h=null}set(d,p){this.h=d,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let qs,Ws=!1,ec=new class Dn{constructor(){this.h=this.g=null}add(d,p){const b=$s.get();b.set(d,p),this.h?this.h.next=b:this.g=b,this.h=b}},Vd=()=>{const a=u.Promise.resolve(void 0);qs=()=>{a.then(qp)}};var qp=()=>{for(var a;a=D();){try{a.h.call(a.g)}catch(p){ce(p)}var d=$s;d.j(a),100>d.h&&(d.h++,a.next=d.g,d.g=a)}Ws=!1};function Hn(){this.s=this.s,this.C=this.C}function nn(a,d){this.type=a,this.g=this.target=d,this.defaultPrevented=!1}Hn.prototype.s=!1,Hn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Hn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},nn.prototype.h=function(){this.defaultPrevented=!0};var Wp=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,d=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const p=()=>{};u.addEventListener("test",p,d),u.removeEventListener("test",p,d)}catch{}return a}();function Ks(a,d){if(nn.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var p=this.type=a.type,b=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=d,d=a.relatedTarget){if(Tt){e:{try{ht(d.nodeName);var ne=!0;break e}catch{}ne=!1}ne||(d=null)}}else"mouseover"==p?d=a.fromElement:"mouseout"==p&&(d=a.toElement);this.relatedTarget=d,b?(this.clientX=void 0!==b.clientX?b.clientX:b.pageX,this.clientY=void 0!==b.clientY?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Kp[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Ks.aa.h.call(this)}}Ie(Ks,nn);var Kp={2:"touch",3:"pen",4:"mouse"};Ks.prototype.h=function(){Ks.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ys="closure_listenable_"+(1e6*Math.random()|0),Yp=0;function Qp(a,d,p,b,ne){this.listener=a,this.proxy=null,this.src=d,this.type=p,this.capture=!!b,this.ha=ne,this.key=++Yp,this.da=this.fa=!1}function ho(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function _o(a){this.src=a,this.g={},this.h=0}function tc(a,d){var p=d.type;if(p in a.g){var pe,b=a.g[p],ne=Array.prototype.indexOf.call(b,d,void 0);(pe=0<=ne)&&Array.prototype.splice.call(b,ne,1),pe&&(ho(d),0==a.g[p].length&&(delete a.g[p],a.h--))}}function nc(a,d,p,b){for(var ne=0;ne<a.length;++ne){var pe=a[ne];if(!pe.da&&pe.listener==d&&pe.capture==!!p&&pe.ha==b)return ne}return-1}_o.prototype.add=function(a,d,p,b,ne){var pe=a.toString();(a=this.g[pe])||(a=this.g[pe]=[],this.h++);var $e=nc(a,d,b,ne);return-1<$e?(d=a[$e],p||(d.fa=!1)):((d=new Qp(d,this.src,pe,!!b,ne)).fa=p,a.push(d)),d};var rc="closure_lm_"+(1e6*Math.random()|0),sc={};function jd(a,d,p,b,ne){if(b&&b.once)return zd(a,d,p,b,ne);if(Array.isArray(d)){for(var pe=0;pe<d.length;pe++)jd(a,d[pe],p,b,ne);return null}return p=lc(p),a&&a[Ys]?a.K(d,p,m(b)?!!b.capture:!!b,ne):Nd(a,d,p,!1,b,ne)}function Nd(a,d,p,b,ne,pe){if(!d)throw Error("Invalid event type");var $e=m(ne)?!!ne.capture:!!ne,Ct=oc(a);if(Ct||(a[rc]=Ct=new _o(a)),(p=Ct.add(d,p,b,$e,pe)).proxy)return p;if(b=function Xp(){const d=Hp;return function a(p){return d.call(a.src,a.listener,p)}}(),p.proxy=b,b.src=a,b.listener=p,a.addEventListener)Wp||(ne=$e),void 0===ne&&(ne=!1),a.addEventListener(d.toString(),b,ne);else if(a.attachEvent)a.attachEvent(Ld(d.toString()),b);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(b)}return p}function zd(a,d,p,b,ne){if(Array.isArray(d)){for(var pe=0;pe<d.length;pe++)zd(a,d[pe],p,b,ne);return null}return p=lc(p),a&&a[Ys]?a.L(d,p,m(b)?!!b.capture:!!b,ne):Nd(a,d,p,!0,b,ne)}function Bd(a,d,p,b,ne){if(Array.isArray(d))for(var pe=0;pe<d.length;pe++)Bd(a,d[pe],p,b,ne);else b=m(b)?!!b.capture:!!b,p=lc(p),a&&a[Ys]?(a=a.i,(d=String(d).toString())in a.g&&-1<(p=nc(pe=a.g[d],p,b,ne))&&(ho(pe[p]),Array.prototype.splice.call(pe,p,1),0==pe.length&&(delete a.g[d],a.h--))):a&&(a=oc(a))&&(d=a.g[d.toString()],a=-1,d&&(a=nc(d,p,b,ne)),(p=-1<a?d[a]:null)&&ic(p))}function ic(a){if("number"!=typeof a&&a&&!a.da){var d=a.src;if(d&&d[Ys])tc(d.i,a);else{var p=a.type,b=a.proxy;d.removeEventListener?d.removeEventListener(p,b,a.capture):d.detachEvent?d.detachEvent(Ld(p),b):d.addListener&&d.removeListener&&d.removeListener(b),(p=oc(d))?(tc(p,a),0==p.h&&(p.src=null,d[rc]=null)):ho(a)}}}function Ld(a){return a in sc?sc[a]:sc[a]="on"+a}function Hp(a,d){if(a.da)a=!0;else{d=new Ks(d,this);var p=a.listener,b=a.ha||a.src;a.fa&&ic(a),a=p.call(b,d)}return a}function oc(a){return(a=a[rc])instanceof _o?a:null}var ac="__closure_events_fn_"+(1e9*Math.random()>>>0);function lc(a){return"function"==typeof a?a:(a[ac]||(a[ac]=function(d){return a.handleEvent(d)}),a[ac])}function rn(){Hn.call(this),this.i=new _o(this),this.M=this,this.F=null}function ln(a,d){var p,b=a.F;if(b)for(p=[];b;b=b.F)p.push(b);if(a=a.M,b=d.type||d,"string"==typeof d)d=new nn(d,a);else if(d instanceof nn)d.target=d.target||a;else{var ne=d;Y(d=new nn(b,a),ne)}if(ne=!0,p)for(var pe=p.length-1;0<=pe;pe--){var $e=d.g=p[pe];ne=mo($e,b,!0,d)&&ne}if(ne=mo($e=d.g=a,b,!0,d)&&ne,ne=mo($e,b,!1,d)&&ne,p)for(pe=0;pe<p.length;pe++)ne=mo($e=d.g=p[pe],b,!1,d)&&ne}function mo(a,d,p,b){if(!(d=a.i.g[String(d)]))return!0;d=d.concat();for(var ne=!0,pe=0;pe<d.length;++pe){var $e=d[pe];if($e&&!$e.da&&$e.capture==p){var Ct=$e.listener,Ht=$e.ha||$e.src;$e.fa&&tc(a.i,$e),ne=!1!==Ct.call(Ht,b)&&ne}}return ne&&!b.defaultPrevented}function Gd(a,d,p){if("function"==typeof a)p&&(a=R(a,p));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=R(a.handleEvent,a)}return 2147483647<Number(d)?-1:u.setTimeout(a,d||0)}function Ud(a){a.g=Gd(()=>{a.g=null,a.i&&(a.i=!1,Ud(a))},a.l);const d=a.h;a.h=null,a.m.apply(null,d)}Ie(rn,Hn),rn.prototype[Ys]=!0,rn.prototype.removeEventListener=function(a,d,p,b){Bd(this,a,d,p,b)},rn.prototype.N=function(){if(rn.aa.N.call(this),this.i){var d,a=this.i;for(d in a.g){for(var p=a.g[d],b=0;b<p.length;b++)ho(p[b]);delete a.g[d],a.h--}}this.F=null},rn.prototype.K=function(a,d,p,b){return this.i.add(String(a),d,!1,p,b)},rn.prototype.L=function(a,d,p,b){return this.i.add(String(a),d,!0,p,b)};class Jp extends Hn{constructor(d,p){super(),this.m=d,this.l=p,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:Ud(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qs(a){Hn.call(this),this.h=a,this.g={}}Ie(Qs,Hn);var $d=[];function qd(a){_t(a.g,function(d,p){this.g.hasOwnProperty(p)&&ic(d)},a),a.g={}}Qs.prototype.N=function(){Qs.aa.N.call(this),qd(this)},Qs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cc=u.JSON.stringify,Zp=u.JSON.parse,eg=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function uc(){}function Kd(){}uc.prototype.h=null;var Xs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function hc(){nn.call(this,"d")}function dc(){nn.call(this,"c")}Ie(hc,nn),Ie(dc,nn);var vr={},Yd=null;function fo(){return Yd=Yd||new rn}function Qd(a){nn.call(this,vr.La,a)}function Hs(a){const d=fo();ln(d,new Qd(d))}function Xd(a,d){nn.call(this,vr.STAT_EVENT,a),this.stat=d}function cn(a){const d=fo();ln(d,new Xd(d,a))}function Hd(a,d){nn.call(this,vr.Ma,a),this.size=d}function Js(a,d){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},d)}function Zs(){this.g=!0}function ss(a,d,p,b){a.info(function(){return"XMLHTTP TEXT ("+d+"): "+function sg(a,d){if(!a.g)return d;if(!d)return null;try{var p=JSON.parse(d);if(p)for(a=0;a<p.length;a++)if(Array.isArray(p[a])){var b=p[a];if(!(2>b.length)){var ne=b[1];if(Array.isArray(ne)&&!(1>ne.length)){var pe=ne[0];if("noop"!=pe&&"stop"!=pe&&"close"!=pe)for(var $e=1;$e<ne.length;$e++)ne[$e]=""}}}return cc(p)}catch{return d}}(a,p)+(b?" "+b:"")})}vr.La="serverreachability",Ie(Qd,nn),vr.STAT_EVENT="statevent",Ie(Xd,nn),vr.Ma="timingevent",Ie(Hd,nn),Zs.prototype.xa=function(){this.g=!1},Zs.prototype.info=function(){};var _c,po={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Jd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function go(){}function Jn(a,d,p,b){this.j=a,this.i=d,this.l=p,this.R=b||1,this.U=new Qs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zd}function Zd(){this.i=null,this.g="",this.h=!1}Ie(go,uc),go.prototype.g=function(){return new XMLHttpRequest},go.prototype.i=function(){return{}},_c=new go;var e_={},mc={};function fc(a,d,p){a.L=1,a.v=xo(Fn(d)),a.m=p,a.P=!0,t_(a,null)}function t_(a,d){a.F=Date.now(),yo(a),a.A=Fn(a.v);var p=a.A,b=a.R;Array.isArray(b)||(b=[String(b)]),f_(p.i,"t",b),a.C=0,p=a.j.J,a.h=new Zd,a.g=M_(a.j,p?d:null,!a.m),0<a.O&&(a.M=new Jp(R(a.Y,a,a.g),a.O)),d=a.U,p=a.g,b=a.ca;var ne="readystatechange";Array.isArray(ne)||(ne&&($d[0]=ne.toString()),ne=$d);for(var pe=0;pe<ne.length;pe++){var $e=jd(p,ne[pe],b||d.handleEvent,!1,d.h||d);if(!$e)break;d.g[$e.key]=$e}d=a.H?O(a.H):{},a.m?(a.u||(a.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,d)):(a.u="GET",a.g.ea(a.A,a.u,null,d)),Hs(),function tg(a,d,p,b,ne,pe){a.info(function(){if(a.g)if(pe)for(var $e="",Ct=pe.split("&"),Ht=0;Ht<Ct.length;Ht++){var bt=Ct[Ht].split("=");if(1<bt.length){var sn=bt[0];bt=bt[1];var on=sn.split("_");$e=2<=on.length&&"type"==on[1]?$e+(sn+"=")+bt+"&":$e+(sn+"=redacted&")}}else $e=null;else $e=pe;return"XMLHTTP REQ ("+b+") [attempt "+ne+"]: "+d+"\n"+p+"\n"+$e})}(a.i,a.u,a.A,a.l,a.R,a.m)}function n_(a){return!!a.g&&"GET"==a.u&&2!=a.L&&a.j.Ca}function ig(a,d){var p=a.C,b=d.indexOf("\n",p);return-1==b?mc:(p=Number(d.substring(p,b)),isNaN(p)?e_:(b+=1)+p>d.length?mc:(d=d.slice(b,b+p),a.C=b+p,d))}function yo(a){a.S=Date.now()+a.I,r_(a,a.I)}function r_(a,d){if(null!=a.B)throw Error("WatchDog timer not null");a.B=Js(R(a.ba,a),d)}function pc(a){a.B&&(u.clearTimeout(a.B),a.B=null)}function ei(a){0==a.j.G||a.J||R_(a.j,a)}function wr(a){pc(a);var d=a.M;d&&"function"==typeof d.ma&&d.ma(),a.M=null,qd(a.U),a.g&&(d=a.g,a.g=null,d.abort(),d.ma())}function gc(a,d){try{var p=a.j;if(0!=p.G&&(p.g==a||yc(p.h,a)))if(!a.K&&yc(p.h,a)&&3==p.G){try{var b=p.Da.g.parse(d)}catch{b=null}if(Array.isArray(b)&&3==b.length){var ne=b;if(0==ne[0]){e:if(!p.u){if(p.g){if(!(p.g.F+3e3<a.F))break e;Ao(p),Io(p)}Tc(p),cn(18)}}else p.za=ne[1],0<p.za-p.T&&37500>ne[2]&&p.F&&0==p.v&&!p.C&&(p.C=Js(R(p.Za,p),6e3));if(1>=o_(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Tr(p,11)}else if((a.K||p.g==a)&&Ao(p),!ot(d))for(ne=p.Da.g.parse(d),d=0;d<ne.length;d++){let bt=ne[d];if(p.T=bt[0],bt=bt[1],2==p.G)if("c"==bt[0]){p.K=bt[1],p.ia=bt[2];const sn=bt[3];null!=sn&&(p.la=sn,p.j.info("VER="+p.la));const on=bt[4];null!=on&&(p.Aa=on,p.j.info("SVER="+p.Aa));const as=bt[5];null!=as&&"number"==typeof as&&0<as&&(p.L=b=1.5*as,p.j.info("backChannelRequestTimeoutMs_="+b)),b=p;const yn=a.g;if(yn){const Co=yn.g?yn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Co){var pe=b.h;pe.g||-1==Co.indexOf("spdy")&&-1==Co.indexOf("quic")&&-1==Co.indexOf("h2")||(pe.j=pe.l,pe.g=new Set,pe.h&&(vc(pe,pe.h),pe.h=null))}if(b.D){const Ic=yn.g?yn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ic&&(b.ya=Ic,Pt(b.I,b.D,Ic))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-a.F,p.j.info("Handshake RTT: "+p.R+"ms"));var $e=a;if((b=p).qa=k_(b,b.J?b.ia:null,b.W),$e.K){a_(b.h,$e);var Ct=$e,Ht=b.L;Ht&&(Ct.I=Ht),Ct.B&&(pc(Ct),yo(Ct)),b.g=$e}else S_(b);0<p.i.length&&Eo(p)}else"stop"!=bt[0]&&"close"!=bt[0]||Tr(p,7);else 3==p.G&&("stop"==bt[0]||"close"==bt[0]?"stop"==bt[0]?Tr(p,7):xc(p):"noop"!=bt[0]&&p.l&&p.l.ta(bt),p.v=0)}Hs()}catch{}}Jn.prototype.ca=function(a){a=a.target;const d=this.M;d&&3==Vn(a)?d.j():this.Y(a)},Jn.prototype.Y=function(a){try{if(a==this.g)e:{const on=Vn(this.g);var d=this.g.Ba();if(this.g.Z(),!(3>on)&&(3!=on||this.g&&(this.h.h||this.g.oa()||T_(this.g)))){this.J||4!=on||7==d||Hs(),pc(this);var p=this.g.Z();this.X=p;t:if(n_(this)){var b=T_(this.g);a="";var ne=b.length,pe=4==Vn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){wr(this),ei(this);var $e="";break t}this.h.i=new u.TextDecoder}for(d=0;d<ne;d++)this.h.h=!0,a+=this.h.i.decode(b[d],{stream:!(pe&&d==ne-1)});b.length=0,this.h.g+=a,this.C=0,$e=this.h.g}else $e=this.g.oa();if(this.o=200==p,function ng(a,d,p,b,ne,pe,$e){a.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+ne+"]: "+d+"\n"+p+"\n"+pe+" "+$e})}(this.i,this.u,this.A,this.l,this.R,on,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Ct,Ht=this.g;if((Ct=Ht.g?Ht.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ot(Ct)){var bt=Ct;break t}}bt=null}if(!(p=bt)){this.o=!1,this.s=3,cn(12),wr(this),ei(this);break e}ss(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gc(this,p)}if(this.P){let yn;for(p=!0;!this.J&&this.C<$e.length;){if(yn=ig(this,$e),yn==mc){4==on&&(this.s=4,cn(14),p=!1),ss(this.i,this.l,null,"[Incomplete Response]");break}if(yn==e_){this.s=4,cn(15),ss(this.i,this.l,$e,"[Invalid Chunk]"),p=!1;break}ss(this.i,this.l,yn,null),gc(this,yn)}if(n_(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=on||0!=$e.length||this.h.h||(this.s=1,cn(16),p=!1),this.o=this.o&&p,p){if(0<$e.length&&!this.W){this.W=!0;var sn=this.j;sn.g==this&&sn.ba&&!sn.M&&(sn.j.info("Great, no buffering proxy detected. Bytes received: "+$e.length),bc(sn),sn.M=!0,cn(11))}}else ss(this.i,this.l,$e,"[Invalid Chunked Response]"),wr(this),ei(this)}else ss(this.i,this.l,$e,null),gc(this,$e);4==on&&wr(this),this.o&&!this.J&&(4==on?R_(this.j,this):(this.o=!1,yo(this)))}else(function Tg(a){const d={};a=(a.g&&2<=Vn(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let b=0;b<a.length;b++){if(ot(a[b]))continue;var p=ee(a[b]);const ne=p[0];if("string"!=typeof(p=p[1]))continue;p=p.trim();const pe=d[ne]||[];d[ne]=pe,pe.push(p)}!function q(a,d){for(const p in a)d.call(void 0,a[p],p,a)}(d,function(b){return b.join(", ")})})(this.g),400==p&&0<$e.indexOf("Unknown SID")?(this.s=3,cn(12)):(this.s=0,cn(13)),wr(this),ei(this)}}}catch{}},Jn.prototype.cancel=function(){this.J=!0,wr(this)},Jn.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(function rg(a,d){a.info(function(){return"TIMEOUT: "+d})}(this.i,this.A),2!=this.L&&(Hs(),cn(17)),wr(this),this.s=2,ei(this)):r_(this,this.S-a)};var og=class{constructor(a,d){this.g=a,this.map=d}};function s_(a){this.l=a||10,a=u.PerformanceNavigationTiming?0<(a=u.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function i_(a){return!!a.h||!!a.g&&a.g.size>=a.j}function o_(a){return a.h?1:a.g?a.g.size:0}function yc(a,d){return a.h?a.h==d:!!a.g&&a.g.has(d)}function vc(a,d){a.g?a.g.add(d):a.h=d}function a_(a,d){a.h&&a.h==d?a.h=null:a.g&&a.g.has(d)&&a.g.delete(d)}function l_(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let d=a.i;for(const p of a.g.values())d=d.concat(p.D);return d}return De(a.i)}function c_(a,d){if(a.forEach&&"function"==typeof a.forEach)a.forEach(d,void 0);else if(h(a)||"string"==typeof a)Array.prototype.forEach.call(a,d,void 0);else for(var p=function lg(a){if(a.na&&"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(h(a)||"string"==typeof a){var d=[];a=a.length;for(var p=0;p<a;p++)d.push(p);return d}d=[],p=0;for(const b in a)d[p++]=b;return d}}}(a),b=function ag(a){if(a.V&&"function"==typeof a.V)return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(h(a)){for(var d=[],p=a.length,b=0;b<p;b++)d.push(a[b]);return d}for(b in d=[],p=0,a)d[p++]=a[b];return d}(a),ne=b.length,pe=0;pe<ne;pe++)d.call(void 0,b[pe],p&&p[pe],a)}s_.prototype.cancel=function(){if(this.i=l_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var u_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof xr){this.h=a.h,vo(this,a.j),this.o=a.o,this.g=a.g,wo(this,a.s),this.l=a.l;var d=a.i,p=new ri;p.i=d.i,d.g&&(p.g=new Map(d.g),p.h=d.h),h_(this,p),this.m=a.m}else a&&(d=String(a).match(u_))?(this.h=!1,vo(this,d[1]||"",!0),this.o=ti(d[2]||""),this.g=ti(d[3]||"",!0),wo(this,d[4]),this.l=ti(d[5]||"",!0),h_(this,d[6]||"",!0),this.m=ti(d[7]||"")):(this.h=!1,this.i=new ri(null,this.h))}function Fn(a){return new xr(a)}function vo(a,d,p){a.j=p?ti(d,!0):d,a.j&&(a.j=a.j.replace(/:$/,""))}function wo(a,d){if(d){if(d=Number(d),isNaN(d)||0>d)throw Error("Bad port number "+d);a.s=d}else a.s=null}function h_(a,d,p){d instanceof ri?(a.i=d,function fg(a,d){d&&!a.j&&(Zn(a),a.i=null,a.g.forEach(function(p,b){var ne=b.toLowerCase();b!=ne&&(__(this,b),f_(this,ne,p))},a)),a.j=d}(a.i,a.h)):(p||(d=ni(d,_g)),a.i=new ri(d,a.h))}function Pt(a,d,p){a.i.set(d,p)}function xo(a){return Pt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ti(a,d){return a?d?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ni(a,d,p){return"string"==typeof a?(a=encodeURI(a).replace(d,ug),p&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function ug(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}xr.prototype.toString=function(){var a=[],d=this.j;d&&a.push(ni(d,d_,!0),":");var p=this.g;return(p||"file"==d)&&(a.push("//"),(d=this.o)&&a.push(ni(d,d_,!0),"@"),a.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(p=this.s)&&a.push(":",String(p))),(p=this.l)&&(this.g&&"/"!=p.charAt(0)&&a.push("/"),a.push(ni(p,"/"==p.charAt(0)?dg:hg,!0))),(p=this.i.toString())&&a.push("?",p),(p=this.m)&&a.push("#",ni(p,mg)),a.join("")};var d_=/[#\/\?@]/g,hg=/[#\?:]/g,dg=/[#\?]/g,_g=/[#\?@]/g,mg=/#/g;function ri(a,d){this.h=this.g=null,this.i=a||null,this.j=!!d}function Zn(a){a.g||(a.g=new Map,a.h=0,a.i&&function cg(a,d){if(a){a=a.split("&");for(var p=0;p<a.length;p++){var b=a[p].indexOf("="),ne=null;if(0<=b){var pe=a[p].substring(0,b);ne=a[p].substring(b+1)}else pe=a[p];d(pe,ne?decodeURIComponent(ne.replace(/\+/g," ")):"")}}}(a.i,function(d,p){a.add(decodeURIComponent(d.replace(/\+/g," ")),p)}))}function __(a,d){Zn(a),d=is(a,d),a.g.has(d)&&(a.i=null,a.h-=a.g.get(d).length,a.g.delete(d))}function m_(a,d){return Zn(a),d=is(a,d),a.g.has(d)}function f_(a,d,p){__(a,d),0<p.length&&(a.i=null,a.g.set(is(a,d),De(p)),a.h+=p.length)}function is(a,d){return d=String(d),a.j&&(d=d.toLowerCase()),d}function er(a,d,p,b,ne){try{ne&&(ne.onload=null,ne.onerror=null,ne.onabort=null,ne.ontimeout=null),b(p)}catch{}}function yg(){this.g=new eg}function vg(a,d,p){const b=p||"";try{c_(a,function(ne,pe){let $e=ne;m(ne)&&($e=cc(ne)),d.push(b+pe+"="+encodeURIComponent($e))})}catch(ne){throw d.push(b+"type="+encodeURIComponent("_badmap")),ne}}function si(a){this.l=a.Ub||null,this.j=a.eb||!1}function To(a,d){rn.call(this),this.D=a,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function p_(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function ii(a){a.readyState=4,a.l=null,a.j=null,a.v=null,oi(a)}function oi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function g_(a){let d="";return _t(a,function(p,b){d+=b,d+=":",d+=p,d+="\r\n"}),d}function wc(a,d,p){e:{for(b in p){var b=!1;break e}b=!0}b||(p=g_(p),"string"==typeof a?null!=p&&encodeURIComponent(String(p)):Pt(a,d,p))}function zt(a){rn.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ri.prototype).add=function(a,d){Zn(this),this.i=null,a=is(this,a);var p=this.g.get(a);return p||this.g.set(a,p=[]),p.push(d),this.h+=1,this},r.forEach=function(a,d){Zn(this),this.g.forEach(function(p,b){p.forEach(function(ne){a.call(d,ne,b,this)},this)},this)},r.na=function(){Zn(this);const a=Array.from(this.g.values()),d=Array.from(this.g.keys()),p=[];for(let b=0;b<d.length;b++){const ne=a[b];for(let pe=0;pe<ne.length;pe++)p.push(d[b])}return p},r.V=function(a){Zn(this);let d=[];if("string"==typeof a)m_(this,a)&&(d=d.concat(this.g.get(is(this,a))));else{a=Array.from(this.g.values());for(let p=0;p<a.length;p++)d=d.concat(a[p])}return d},r.set=function(a,d){return Zn(this),this.i=null,m_(this,a=is(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[d]),this.h+=1,this},r.get=function(a,d){return a&&0<(a=this.V(a)).length?String(a[0]):d},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],d=Array.from(this.g.keys());for(var p=0;p<d.length;p++){var b=d[p];const pe=encodeURIComponent(String(b)),$e=this.V(b);for(b=0;b<$e.length;b++){var ne=pe;""!==$e[b]&&(ne+="="+encodeURIComponent(String($e[b]))),a.push(ne)}}return this.i=a.join("&")},Ie(si,uc),si.prototype.g=function(){return new To(this.l,this.j)},si.prototype.i=function(a){return function(){return a}}({}),Ie(To,rn),(r=To.prototype).open=function(a,d){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=d,this.readyState=1,oi(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(d.body=a),(this.D||u).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ii(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,oi(this)),this.g&&(this.readyState=3,oi(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;p_(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var d=a.value?a.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!a.done}))&&(this.response=this.responseText+=d)}a.done?ii(this):oi(this),3==this.readyState&&p_(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,ii(this))},r.Qa=function(a){this.g&&(this.response=a,ii(this))},r.ga=function(){this.g&&ii(this)},r.setRequestHeader=function(a,d){this.u.append(a,d)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],d=this.h.entries();for(var p=d.next();!p.done;)a.push((p=p.value)[0]+": "+p[1]),p=d.next();return a.join("\r\n")},Object.defineProperty(To.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),Ie(zt,rn);var wg=/^https?$/i,xg=["POST","PUT"];function y_(a,d){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=d,a.m=5,v_(a),bo(a)}function v_(a){a.A||(a.A=!0,ln(a,"complete"),ln(a,"error"))}function w_(a){if(a.h&&typeof o<"u"&&(!a.v[1]||4!=Vn(a)||2!=a.Z()))if(a.u&&4==Vn(a))Gd(a.Ea,0,a);else if(ln(a,"readystatechange"),4==Vn(a)){a.h=!1;try{const $e=a.Z();e:switch($e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break e;default:d=!1}var p;if(!(p=d)){var b;if(b=0===$e){var ne=String(a.D).match(u_)[1]||null;!ne&&u.self&&u.self.location&&(ne=u.self.location.protocol.slice(0,-1)),b=!wg.test(ne?ne.toLowerCase():"")}p=b}if(p)ln(a,"complete"),ln(a,"success");else{a.m=6;try{var pe=2<Vn(a)?a.g.statusText:""}catch{pe=""}a.l=pe+" ["+a.Z()+"]",v_(a)}}finally{bo(a)}}}function bo(a,d){if(a.g){x_(a);const p=a.g,b=a.v[0]?()=>{}:null;a.g=null,a.v=null,d||ln(a,"ready");try{p.onreadystatechange=b}catch{}}}function x_(a){a.I&&(u.clearTimeout(a.I),a.I=null)}function Vn(a){return a.g?a.g.readyState:0}function T_(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function ai(a,d,p){return p&&p.internalChannelParams&&p.internalChannelParams[a]||d}function b_(a){this.Aa=0,this.i=[],this.j=new Zs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ai("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ai("baseRetryDelayMs",5e3,a),this.cb=ai("retryDelaySeedMs",1e4,a),this.Wa=ai("forwardChannelMaxRetries",2,a),this.wa=ai("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new s_(a&&a.concurrentRequestLimit),this.Da=new yg,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function xc(a){if(I_(a),3==a.G){var d=a.U++,p=Fn(a.I);if(Pt(p,"SID",a.K),Pt(p,"RID",d),Pt(p,"TYPE","terminate"),li(a,p),(d=new Jn(a,a.j,d)).L=2,d.v=xo(Fn(p)),p=!1,u.navigator&&u.navigator.sendBeacon)try{p=u.navigator.sendBeacon(d.v.toString(),"")}catch{}!p&&u.Image&&((new Image).src=d.v,p=!0),p||(d.g=M_(d.j,null),d.g.ea(d.v)),d.F=Date.now(),yo(d)}P_(a)}function Io(a){a.g&&(bc(a),a.g.cancel(),a.g=null)}function I_(a){Io(a),a.u&&(u.clearTimeout(a.u),a.u=null),Ao(a),a.h.cancel(),a.s&&("number"==typeof a.s&&u.clearTimeout(a.s),a.s=null)}function Eo(a){if(!i_(a.h)&&!a.s){a.s=!0;var d=a.Ga;qs||Vd(),Ws||(qs(),Ws=!0),ec.add(d,a),a.B=0}}function E_(a,d){var p;p=d?d.l:a.U++;const b=Fn(a.I);Pt(b,"SID",a.K),Pt(b,"RID",p),Pt(b,"AID",a.T),li(a,b),a.m&&a.o&&wc(b,a.m,a.o),p=new Jn(a,a.j,p,a.B+1),null===a.m&&(p.H=a.o),d&&(a.i=d.D.concat(a.i)),d=A_(a,p,1e3),p.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),vc(a.h,p),fc(p,b,d)}function li(a,d){a.H&&_t(a.H,function(p,b){Pt(d,b,p)}),a.l&&c_({},function(p,b){Pt(d,b,p)})}function A_(a,d,p){p=Math.min(a.i.length,p);var b=a.l?R(a.l.Na,a.l,a):null;e:{var ne=a.i;let pe=-1;for(;;){const $e=["count="+p];-1==pe?0<p?(pe=ne[0].g,$e.push("ofs="+pe)):pe=0:$e.push("ofs="+pe);let Ct=!0;for(let Ht=0;Ht<p;Ht++){let bt=ne[Ht].g;const sn=ne[Ht].map;if(bt-=pe,0>bt)pe=Math.max(0,ne[Ht].g-100),Ct=!1;else try{vg(sn,$e,"req"+bt+"_")}catch{b&&b(sn)}}if(Ct){b=$e.join("&");break e}}}return a=a.i.splice(0,p),d.D=a,b}function S_(a){if(!a.g&&!a.u){a.Y=1;var d=a.Fa;qs||Vd(),Ws||(qs(),Ws=!0),ec.add(d,a),a.v=0}}function Tc(a){return!(a.g||a.u||3<=a.v||(a.Y++,a.u=Js(R(a.Fa,a),O_(a,a.v)),a.v++,0))}function bc(a){null!=a.A&&(u.clearTimeout(a.A),a.A=null)}function C_(a){a.g=new Jn(a,a.j,"rpc",a.Y),null===a.m&&(a.g.H=a.o),a.g.O=0;var d=Fn(a.qa);Pt(d,"RID","rpc"),Pt(d,"SID",a.K),Pt(d,"AID",a.T),Pt(d,"CI",a.F?"0":"1"),!a.F&&a.ja&&Pt(d,"TO",a.ja),Pt(d,"TYPE","xmlhttp"),li(a,d),a.m&&a.o&&wc(d,a.m,a.o),a.L&&(a.g.I=a.L);var p=a.g;a=a.ia,p.L=1,p.v=xo(Fn(d)),p.m=null,p.P=!0,t_(p,a)}function Ao(a){null!=a.C&&(u.clearTimeout(a.C),a.C=null)}function R_(a,d){var p=null;if(a.g==d){Ao(a),bc(a),a.g=null;var b=2}else{if(!yc(a.h,d))return;p=d.D,a_(a.h,d),b=1}if(0!=a.G)if(d.o)if(1==b){p=d.m?d.m.length:0,d=Date.now()-d.F;var ne=a.B;ln(b=fo(),new Hd(b,p)),Eo(a)}else S_(a);else if(3==(ne=d.s)||0==ne&&0<d.X||!(1==b&&function bg(a,d){return!(o_(a.h)>=a.h.j-(a.s?1:0)||(a.s?(a.i=d.D.concat(a.i),0):1==a.G||2==a.G||a.B>=(a.Va?0:a.Wa)||(a.s=Js(R(a.Ga,a,d),O_(a,a.B)),a.B++,0)))}(a,d)||2==b&&Tc(a)))switch(p&&0<p.length&&(d=a.h,d.i=d.i.concat(p)),ne){case 1:Tr(a,5);break;case 4:Tr(a,10);break;case 3:Tr(a,6);break;default:Tr(a,2)}}function O_(a,d){let p=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(p*=2),p*d}function Tr(a,d){if(a.j.info("Error code "+d),2==d){var p=R(a.fb,a),b=a.Xa;const ne=!b;b=new xr(b||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||vo(b,"https"),xo(b),ne?function pg(a,d){const p=new Zs;if(u.Image){const b=new Image;b.onload=Z(er,p,"TestLoadImage: loaded",!0,d,b),b.onerror=Z(er,p,"TestLoadImage: error",!1,d,b),b.onabort=Z(er,p,"TestLoadImage: abort",!1,d,b),b.ontimeout=Z(er,p,"TestLoadImage: timeout",!1,d,b),u.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=a}else d(!1)}(b.toString(),p):function gg(a,d){new Zs;const b=new AbortController,ne=setTimeout(()=>{b.abort(),er(0,0,!1,d)},1e4);fetch(a,{signal:b.signal}).then(pe=>{clearTimeout(ne),er(0,0,!!pe.ok,d)}).catch(()=>{clearTimeout(ne),er(0,0,!1,d)})}(b.toString(),p)}else cn(2);a.G=0,a.l&&a.l.sa(d),P_(a),I_(a)}function P_(a){if(a.G=0,a.ka=[],a.l){const d=l_(a.h);(0!=d.length||0!=a.i.length)&&(Oe(a.ka,d),Oe(a.ka,a.i),a.h.i.length=0,De(a.i),a.i.length=0),a.l.ra()}}function k_(a,d,p){var b=p instanceof xr?Fn(p):new xr(p);if(""!=b.g)d&&(b.g=d+"."+b.g),wo(b,b.s);else{var ne=u.location;b=ne.protocol,d=d?d+"."+ne.hostname:ne.hostname,ne=+ne.port;var pe=new xr(null);b&&vo(pe,b),d&&(pe.g=d),ne&&wo(pe,ne),p&&(pe.l=p),b=pe}return d=a.ya,(p=a.D)&&d&&Pt(b,p,d),Pt(b,"VER",a.la),li(a,b),b}function M_(a,d,p){if(d&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(d=new zt(a.Ca&&!a.pa?new si({eb:p}):a.pa)).Ha(a.J),d}function D_(){}function So(){}function _n(a,d){rn.call(this),this.g=new b_(d),this.l=a,this.h=d&&d.messageUrlParams||null,a=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(a?a["X-WebChannel-Content-Type"]=d.messageContentType:a={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(a?a["X-WebChannel-Client-Profile"]=d.va:a={"X-WebChannel-Client-Profile":d.va}),this.g.S=a,(a=d&&d.Sb)&&!ot(a)&&(this.g.m=a),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!ot(d)&&(this.g.D=d,null!==(a=this.h)&&d in a&&d in(a=this.h)&&delete a[d]),this.j=new os(this)}function F_(a){hc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var d=a.__sm__;if(d){e:{for(const p in d){a=p;break e}a=void 0}(this.i=a)&&(a=this.i,d=null!==d&&a in d?d[a]:void 0),this.data=d}else this.data=a}function V_(){dc.call(this),this.status=1}function os(a){this.g=a}(r=zt.prototype).Ha=function(a){this.J=a},r.ea=function(a,d,p,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);d=d?d.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():_c.g(),this.v=function Wd(a){return a.h||(a.h=a.i())}(this.o?this.o:_c),this.g.onreadystatechange=R(this.Ea,this);try{this.B=!0,this.g.open(d,String(a),!0),this.B=!1}catch(pe){return void y_(this,pe)}if(a=p||"",p=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var ne in b)p.set(ne,b[ne]);else{if("function"!=typeof b.keys||"function"!=typeof b.get)throw Error("Unknown input type for opt_headers: "+String(b));for(const pe of b.keys())p.set(pe,b.get(pe))}b=Array.from(p.keys()).find(pe=>"content-type"==pe.toLowerCase()),ne=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(xg,d,void 0))||b||ne||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[pe,$e]of p)this.g.setRequestHeader(pe,$e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{x_(this),this.u=!0,this.g.send(a),this.u=!1}catch(pe){y_(this,pe)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ln(this,"complete"),ln(this,"abort"),bo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),bo(this,!0)),zt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?w_(this):this.bb())},r.bb=function(){w_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Vn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var d=this.g.responseText;return a&&0==d.indexOf(a)&&(d=d.substring(a.length)),Zp(d)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=b_.prototype).la=8,r.G=1,r.connect=function(a,d,p,b){cn(0),this.W=a,this.H=d||{},p&&void 0!==b&&(this.H.OSID=p,this.H.OAID=b),this.F=this.X,this.I=k_(this,null,this.W),Eo(this)},r.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const ne=new Jn(this,this.j,a);let pe=this.o;if(this.S&&(pe?(pe=O(pe),Y(pe,this.S)):pe=this.S),null!==this.m||this.O||(ne.H=pe,pe=null),this.P)e:{for(var d=0,p=0;p<this.i.length;p++){var b=this.i[p];if(void 0===(b="__data__"in b.map&&"string"==typeof(b=b.map.__data__)?b.length:void 0))break;if(4096<(d+=b)){d=p;break e}if(4096===d||p===this.i.length-1){d=p+1;break e}}d=1e3}else d=1e3;d=A_(this,ne,d),Pt(p=Fn(this.I),"RID",a),Pt(p,"CVER",22),this.D&&Pt(p,"X-HTTP-Session-Id",this.D),li(this,p),pe&&(this.O?d="headers="+encodeURIComponent(String(g_(pe)))+"&"+d:this.m&&wc(p,this.m,pe)),vc(this.h,ne),this.Ua&&Pt(p,"TYPE","init"),this.P?(Pt(p,"$req",d),Pt(p,"SID","null"),ne.T=!0,fc(ne,p,null)):fc(ne,p,d),this.G=2}}else 3==this.G&&(a?E_(this,a):0==this.i.length||i_(this.h)||E_(this))},r.Fa=function(){if(this.u=null,C_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Js(R(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,cn(10),Io(this),C_(this))},r.Za=function(){null!=this.C&&(this.C=null,Io(this),Tc(this),cn(19))},r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=D_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},So.prototype.g=function(a,d){return new _n(a,d)},Ie(_n,rn),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){xc(this.g)},_n.prototype.o=function(a){var d=this.g;if("string"==typeof a){var p={};p.__data__=a,a=p}else this.u&&((p={}).__data__=cc(a),a=p);d.i.push(new og(d.Ya++,a)),3==d.G&&Eo(d)},_n.prototype.N=function(){this.g.l=null,delete this.j,xc(this.g),delete this.g,_n.aa.N.call(this)},Ie(F_,hc),Ie(V_,dc),Ie(os,D_),os.prototype.ua=function(){ln(this.g,"a")},os.prototype.ta=function(a){ln(this.g,new F_(a))},os.prototype.sa=function(a){ln(this.g,new V_)},os.prototype.ra=function(){ln(this.g,"b")},So.prototype.createWebChannel=So.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,Ee=U.createWebChannelTransport=function(){return new So},xe=U.getStatEventTarget=function(){return fo()},ye=U.Event=vr,J=U.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},po.NO_ERROR=0,po.TIMEOUT=8,po.HTTP_ERROR=6,I=U.ErrorCode=po,Jd.COMPLETE="complete",W=U.EventType=Jd,Kd.EventType=Xs,Xs.OPEN="a",Xs.CLOSE="b",Xs.ERROR="c",Xs.MESSAGE="d",rn.prototype.listen=rn.prototype.K,re=U.WebChannel=Kd,ze=U.FetchXmlHttpFactory=si,zt.prototype.listenOnce=zt.prototype.L,zt.prototype.getLastError=zt.prototype.Ka,zt.prototype.getLastErrorCode=zt.prototype.Ba,zt.prototype.getStatus=zt.prototype.Z,zt.prototype.getResponseJson=zt.prototype.Oa,zt.prototype.getResponseText=zt.prototype.oa,zt.prototype.send=zt.prototype.ea,zt.prototype.setWithCredentials=zt.prototype.Ha,ie=U.XhrIo=zt}).apply(typeof N<"u"?N:typeof self<"u"?self:typeof window<"u"?window:{});const ue="@firebase/firestore";class Me{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Me.UNAUTHENTICATED=new Me(null),Me.GOOGLE_CREDENTIALS=new Me("google-credentials-uid"),Me.FIRST_PARTY=new Me("first-party-uid"),Me.MOCK_USER=new Me("mock-user");let Ce="10.13.2";const Xe=new S.Vy("@firebase/firestore");function Fe(){return Xe.logLevel}function fe(r,...e){if(Xe.logLevel<=S.$b.DEBUG){const t=e.map(Ke);Xe.debug(`Firestore (${Ce}): ${r}`,...t)}}function Ge(r,...e){if(Xe.logLevel<=S.$b.ERROR){const t=e.map(Ke);Xe.error(`Firestore (${Ce}): ${r}`,...t)}}function he(r,...e){if(Xe.logLevel<=S.$b.WARN){const t=e.map(Ke);Xe.warn(`Firestore (${Ce}): ${r}`,...t)}}function Ke(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function Q(r="Unexpected state"){const e=`FIRESTORE (${Ce}) INTERNAL ASSERTION FAILED: `+r;throw Ge(e),new Error(e)}function se(r,e){r||Q()}function we(r,e){return r}const $={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class me extends H.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Dt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nt{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Me.UNAUTHENTICATED))}shutdown(){}}class Et{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ye{constructor(e){this.t=e,this.currentUser=Me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let s=this.i;const i=m=>this.i!==s?(s=this.i,t(m)):Promise.resolve();let o=new lt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new lt,e.enqueueRetryable(()=>i(this.currentUser))};const u=()=>{const m=o;e.enqueueRetryable((0,l.A)(function*(){yield m.promise,yield i(n.currentUser)}))},h=m=>{fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(m=>h(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?h(m):(fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new lt)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(se("string"==typeof n.accessToken),new Dt(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return se(null===e||"string"==typeof e),new Me(e)}}class ft{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Me.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Je{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ft(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Me.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class je{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class K{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=i=>{null!=i.error&&fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,fe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const s=i=>{fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(se("string"==typeof t.token),this.R=t.token,new je(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function de(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class j{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=de(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[i]%62))}return n}}function C(r,e){return r<e?-1:r>e?1:0}function M(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}class Te{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new me($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new me($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new me($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new me($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Te.fromMillis(Date.now())}static fromDate(e){return Te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Te(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?C(this.nanoseconds,e.nanoseconds):C(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ve{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ve(e)}static min(){return new ve(new Te(0,0))}static max(){return new ve(new Te(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ze{constructor(e,t,n){void 0===t?t=0:t>e.length&&Q(),void 0===n?n=e.length-t:n>e.length-t&&Q(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ze.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ze?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Re extends Ze{construct(e,t,n){return new Re(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new me($.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new Re(t)}static emptyPath(){return new Re([])}}const rt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class st extends Ze{construct(e,t,n){return new st(e,t,n)}static isValidIdentifier(e){return rt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),st.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new st(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new me($.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;s<e.length;){const u=e[s];if("\\"===u){if(s+1===e.length)throw new me($.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new me($.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=h,s+=2}else"`"===u?(o=!o,s++):"."!==u||o?(n+=u,s++):(i(),s++)}if(i(),o)throw new me($.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new st(t)}static emptyPath(){return new st([])}}class te{constructor(e){this.path=e}static fromPath(e){return new te(Re.fromString(e))}static fromName(e){return new te(Re.fromString(e).popFirst(5))}static empty(){return new te(Re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Re.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new te(new Re(e.slice()))}}class Ae{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ae(ve.min(),te.empty(),-1)}static max(){return new Ae(ve.max(),te.empty(),-1)}}function Se(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=te.comparator(r.documentKey,e.documentKey),0!==t?t:C(r.largestBatchId,e.largestBatchId))}const be="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Le{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function qe(r){return Qe.apply(this,arguments)}function Qe(){return(Qe=(0,l.A)(function*(r){if(r.code!==$.FAILED_PRECONDITION||r.message!==be)throw r;fe("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Q(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):P.reject(t)}static resolve(e){return new P((t,n)=>{t(e)})}static reject(e){return new P((t,n)=>{n(e)})}static waitFor(e){return new P((t,n)=>{let s=0,i=0,o=!1;e.forEach(u=>{++s,u.next(()=>{++i,o&&i===s&&t()},h=>n(h))}),o=!0,i===s&&t()})}static or(e){let t=P.resolve(!1);for(const n of e)t=t.next(s=>s?P.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,i)=>{n.push(t.call(this,s,i))}),this.waitFor(n)}static mapArray(e,t){return new P((n,s)=>{const i=e.length,o=new Array(i);let u=0;for(let h=0;h<i;h++){const m=h;t(e[m]).next(g=>{o[m]=g,++u,u===i&&n(o)},g=>s(g))}})}static doWhile(e,t){return new P((n,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):n()};i()})}}function ut(r){return"IndexedDbTransactionError"===r.name}let Bt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function gt(r){return null==r}function dn(r){return 0===r&&1/r==-1/0}function Ve(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function jt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Ec(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Rt{constructor(e,t){this.comparator=e,this.root=t||Yt.EMPTY}insert(e,t){return new Rt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Yt.BLACK,null,null))}remove(e){return new Rt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _i(this.root,e,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _i(this.root,e,this.comparator,!0)}}class _i{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Yt{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Yt.RED,this.left=s??Yt.EMPTY,this.right=i??Yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Yt(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Yt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Q();const e=this.left.check();if(e!==this.right.check())throw Q();return e+(this.isRed()?0:1)}}Yt.EMPTY=null,Yt.RED=!0,Yt.BLACK=!1,Yt.EMPTY=new class{constructor(){this.size=0}get key(){throw Q()}get value(){throw Q()}get color(){throw Q()}get left(){throw Q()}get right(){throw Q()}copy(e,t,n,s,i){return this}insert(e,t,n){return new Yt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class At{constructor(e){this.comparator=e,this.data=new Rt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ac(this.data.getIterator())}getIteratorFrom(e){return new Ac(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class Ac{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class un{constructor(e){this.fields=e,e.sort(st.comparator)}static empty(){return new un([])}unionWith(e){let t=new At(st.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new un(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return M(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Sc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Nt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Sc("Invalid base64 string: "+i):i}}(e);return new Nt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Nt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return C(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Nt.EMPTY_BYTE_STRING=new Nt("");const j_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sn(r){if(se(!!r),"string"==typeof r){let e=0;const t=j_.exec(r);if(se(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:kt(r.seconds),nanos:kt(r.nanos)}}function kt(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Cn(r){return"string"==typeof r?Nt.fromBase64String(r):Nt.fromUint8Array(r)}function mi(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function fi(r){const e=r.mapValue.fields.__previous_value__;return mi(e)?fi(e):e}function cs(r){const e=Sn(r.mapValue.fields.__local_write_time__.timestampValue);return new Te(e.seconds,e.nanos)}class N_{constructor(e,t,n,s,i,o,u,h,m){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=m}}class nr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new nr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof nr&&e.projectId===this.projectId&&e.database===this.database}}const zn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?mi(r)?4:kc(r)?9007199254740991:vi(r)?10:11:Q()}function wn(r,e){if(r===e)return!0;const t=Bn(r);if(t!==Bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return cs(r).isEqual(cs(e));case 3:return function(s,i){if("string"==typeof s.timestampValue&&"string"==typeof i.timestampValue&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Sn(s.timestampValue),u=Sn(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return i=e,Cn(r.bytesValue).isEqual(Cn(i.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,i){return kt(s.geoPointValue.latitude)===kt(i.geoPointValue.latitude)&&kt(s.geoPointValue.longitude)===kt(i.geoPointValue.longitude)}(r,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return kt(s.integerValue)===kt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=kt(s.doubleValue),u=kt(i.doubleValue);return o===u?dn(o)===dn(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return M(r.arrayValue.values||[],e.arrayValue.values||[],wn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},u=i.mapValue.fields||{};if(Ve(o)!==Ve(u))return!1;for(const h in o)if(o.hasOwnProperty(h)&&(void 0===u[h]||!wn(o[h],u[h])))return!1;return!0}(r,e);default:return Q()}var i}function us(r,e){return void 0!==(r.values||[]).find(t=>wn(t,e))}function Ln(r,e){if(r===e)return 0;const t=Bn(r),n=Bn(e);if(t!==n)return C(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return C(r.booleanValue,e.booleanValue);case 2:return function(i,o){const u=kt(i.integerValue||i.doubleValue),h=kt(o.integerValue||o.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(r,e);case 3:return Cc(r.timestampValue,e.timestampValue);case 4:return Cc(cs(r),cs(e));case 5:return C(r.stringValue,e.stringValue);case 6:return function(i,o){const u=Cn(i),h=Cn(o);return u.compareTo(h)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const u=i.split("/"),h=o.split("/");for(let m=0;m<u.length&&m<h.length;m++){const g=C(u[m],h[m]);if(0!==g)return g}return C(u.length,h.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const u=C(kt(i.latitude),kt(o.latitude));return 0!==u?u:C(kt(i.longitude),kt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Rc(r.arrayValue,e.arrayValue);case 10:return function(i,o){var u,h,m,g;const Z=null===(u=(i.fields||{}).value)||void 0===u?void 0:u.arrayValue,Ie=null===(h=(o.fields||{}).value)||void 0===h?void 0:h.arrayValue,De=C((null===(m=Z?.values)||void 0===m?void 0:m.length)||0,(null===(g=Ie?.values)||void 0===g?void 0:g.length)||0);return 0!==De?De:Rc(Z,Ie)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===zn.mapValue&&o===zn.mapValue)return 0;if(i===zn.mapValue)return 1;if(o===zn.mapValue)return-1;const u=i.fields||{},h=Object.keys(u),m=o.fields||{},g=Object.keys(m);h.sort(),g.sort();for(let x=0;x<h.length&&x<g.length;++x){const R=C(h[x],g[x]);if(0!==R)return R;const Z=Ln(u[h[x]],m[g[x]]);if(0!==Z)return Z}return C(h.length,g.length)}(r.mapValue,e.mapValue);default:throw Q()}}function Cc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return C(r,e);const t=Sn(r),n=Sn(e),s=C(t.seconds,n.seconds);return 0!==s?s:C(t.nanos,n.nanos)}function Rc(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=Ln(t[s],n[s]);if(i)return i}return C(t.length,n.length)}function Ir(r){return Go(r)}function Go(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Sn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Cn(r.bytesValue).toBase64():"referenceValue"in r?te.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=Go(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${Go(t.fields[o])}`;return s+"}"}(r.mapValue):Q()}function rr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Uo(r){return!!r&&"integerValue"in r}function hs(r){return!!r&&"arrayValue"in r}function Oc(r){return!!r&&"nullValue"in r}function Pc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function yi(r){return!!r&&"mapValue"in r}function vi(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ds(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return jt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ds(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ds(r.arrayValue.values[t]);return e}return Object.assign({},r)}function kc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class Qt{constructor(e){this.value=e}static empty(){return new Qt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!yi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ds(t)}setAll(e){let t=st.emptyPath(),n={},s=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,n,s),n={},s=[],t=u.popLast()}o?n[u.lastSegment()]=ds(o):s.push(u.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());yi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];yi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){jt(t,(s,i)=>e[s]=i);for(const s of n)delete e[s]}clone(){return new Qt(ds(this.value))}}function Vc(r){const e=[];return jt(r.fields,(t,n)=>{const s=new st([t]);if(yi(n)){const i=Vc(n.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new un(e)}class Ot{constructor(e,t,n,s,i,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=u}static newInvalidDocument(e){return new Ot(e,0,ve.min(),ve.min(),ve.min(),Qt.empty(),0)}static newFoundDocument(e,t,n,s){return new Ot(e,1,t,ve.min(),n,s,0)}static newNoDocument(e,t){return new Ot(e,2,t,ve.min(),ve.min(),Qt.empty(),0)}static newUnknownDocument(e,t){return new Ot(e,3,t,ve.min(),ve.min(),Qt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ve.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ve.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gn{constructor(e,t){this.position=e,this.inclusive=t}}function jc(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],o=r.position[s];if(n=i.field.isKeyField()?te.comparator(te.fromName(o.referenceValue),t.key):Ln(o,t.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function Nc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!wn(r.position[t],e.position[t]))return!1;return!0}class _s{constructor(e,t="asc"){this.field=e,this.dir=t}}function L_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class zc{}class yt extends zc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new G_(e,t,n):"array-contains"===t?new q_(e,n):"in"===t?new qc(e,n):"not-in"===t?new W_(e,n):"array-contains-any"===t?new K_(e,n):new yt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new U_(e,n):new $_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ln(t,this.value)):null!==t&&Bn(this.value)===Bn(t)&&this.matchesComparison(Ln(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Q()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class It extends zc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new It(e,t)}matches(e){return Er(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Er(r){return"and"===r.op}function qo(r){return function Bc(r){for(const e of r.filters)if(e instanceof It)return!1;return!0}(r)&&Er(r)}function Wo(r){if(r instanceof yt)return r.field.canonicalString()+r.op.toString()+Ir(r.value);if(qo(r))return r.filters.map(e=>Wo(e)).join(",");{const e=r.filters.map(t=>Wo(t)).join(",");return`${r.op}(${e})`}}function Lc(r,e){return r instanceof yt?(n=r,(s=e)instanceof yt&&n.op===s.op&&n.field.isEqual(s.field)&&wn(n.value,s.value)):r instanceof It?function(n,s){return s instanceof It&&n.op===s.op&&n.filters.length===s.filters.length&&n.filters.reduce((i,o,u)=>i&&Lc(o,s.filters[u]),!0)}(r,e):void Q();var n,s}function Uc(r){return r instanceof yt?`${(t=r).field.canonicalString()} ${t.op} ${Ir(t.value)}`:r instanceof It?function(t){return t.op.toString()+" {"+t.getFilters().map(Uc).join(" ,")+"}"}(r):"Filter";var t}class G_ extends yt{constructor(e,t,n){super(e,t,n),this.key=te.fromName(n.referenceValue)}matches(e){const t=te.comparator(e.key,this.key);return this.matchesComparison(t)}}class U_ extends yt{constructor(e,t){super(e,"in",t),this.keys=$c(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class $_ extends yt{constructor(e,t){super(e,"not-in",t),this.keys=$c(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $c(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>te.fromName(n.referenceValue))}class q_ extends yt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hs(t)&&us(t.arrayValue,this.value)}}class qc extends yt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&us(this.value.arrayValue,t)}}class W_ extends yt{constructor(e,t){super(e,"not-in",t)}matches(e){if(us(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!us(this.value.arrayValue,t)}}class K_ extends yt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>us(this.value.arrayValue,n))}}class Y_{constructor(e,t=null,n=[],s=[],i=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=u,this.ue=null}}function Ko(r,e=null,t=[],n=[],s=null,i=null,o=null){return new Y_(r,e,t,n,s,i,o)}function sr(r){const e=we(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Wo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(i=n).field.canonicalString()+i.dir;var i}).join(","),gt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Ir(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Ir(n)).join(",")),e.ue=t}return e.ue}function ms(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!L_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Lc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Nc(r.startAt,e.startAt)&&Nc(r.endAt,e.endAt)}function wi(r){return te.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class Rn{constructor(e,t=null,n=[],s=[],i=null,o="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=h,this.ce=null,this.le=null,this.he=null}}function Ar(r){return new Rn(r)}function Qc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Yo(r){return null!==r.collectionGroup}function Sr(r){const e=we(r);if(null===e.ce){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new At(st.comparator);return o.filters.forEach(h=>{h.getFlattenedFilters().forEach(m=>{m.isInequality()&&(u=u.add(m.field))})}),u})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new _s(i,n))}),t.has(st.keyField().canonicalString())||e.ce.push(new _s(st.keyField(),n))}return e.ce}function Zt(r){const e=we(r);return e.le||(e.le=function Hc(r,e){if("F"===r.limitType)return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>new _s(s.field,"desc"===s.dir?"asc":"desc"));const t=r.endAt?new Gn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Gn(r.startAt.position,r.startAt.inclusive):null;return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Sr(r))),e.le}function Qo(r,e){const t=r.filters.concat([e]);return new Rn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ti(r,e,t){return new Rn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function fs(r,e){return ms(Zt(r),Zt(e))&&r.limitType===e.limitType}function Jc(r){return`${sr(Zt(r))}|lt:${r.limitType}`}function Cr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>Uc(s)).join(", ")}]`),gt(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>{return`${(o=s).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Ir(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Ir(s)).join(",")),`Target(${n})`}(Zt(r))}; limitType=${r.limitType})`}function ps(r,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return null!==n.collectionGroup?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):te.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,s){for(const i of Sr(n))if(!i.field.isKeyField()&&null===s.data.field(i.field))return!1;return!0}(r,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,e)&&(s=e,!((n=r).startAt&&!function(o,u,h){const m=jc(o,u,h);return o.inclusive?m<=0:m<0}(n.startAt,Sr(n),s)||n.endAt&&!function(o,u,h){const m=jc(o,u,h);return o.inclusive?m>=0:m>0}(n.endAt,Sr(n),s)));var n,s}function eu(r){return(e,t)=>{let n=!1;for(const s of Sr(r)){const i=Q_(s,e,t);if(0!==i)return i;n=n||s.field.isKeyField()}return 0}}function Q_(r,e,t){const n=r.field.isKeyField()?te.comparator(e.key,t.key):function(i,o,u){const h=o.data.field(i),m=u.data.field(i);return null!==h&&null!==m?Ln(h,m):Q()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Q()}}class On{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,i]of n)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){jt(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return Ec(this.inner)}size(){return this.innerSize}}const X_=new Rt(te.comparator);function hn(){return X_}const tu=new Rt(te.comparator);function gs(...r){let e=tu;for(const t of r)e=e.insert(t.key,t);return e}function nu(r){let e=tu;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function xn(){return ys()}function ru(){return ys()}function ys(){return new On(r=>r.toString(),(r,e)=>r.isEqual(e))}const H_=new Rt(te.comparator),J_=new At(te.comparator);function dt(...r){let e=J_;for(const t of r)e=e.add(t);return e}const Z_=new At(C);function Ho(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dn(e)?"-0":e}}function su(r){return{integerValue:""+r}}function iu(r,e){return function jn(r){return"number"==typeof r&&Number.isInteger(r)&&!dn(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?su(e):Ho(r,e)}class bi{constructor(){this._=void 0}}function em(r,e,t){return r instanceof Rr?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&mi(i)&&(i=fi(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):r instanceof ir?au(r,e):r instanceof or?lu(r,e):function(s,i){const o=ou(s,i),u=cu(o)+cu(s.Pe);return Uo(o)&&Uo(s.Pe)?su(u):Ho(s.serializer,u)}(r,e)}function tm(r,e,t){return r instanceof ir?au(r,e):r instanceof or?lu(r,e):t}function ou(r,e){return r instanceof Or?Uo(n=e)||(i=n)&&"doubleValue"in i?e:{integerValue:0}:null;var n,i}class Rr extends bi{}class ir extends bi{constructor(e){super(),this.elements=e}}function au(r,e){const t=uu(e);for(const n of r.elements)t.some(s=>wn(s,n))||t.push(n);return{arrayValue:{values:t}}}class or extends bi{constructor(e){super(),this.elements=e}}function lu(r,e){let t=uu(e);for(const n of r.elements)t=t.filter(s=>!wn(s,n));return{arrayValue:{values:t}}}class Or extends bi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function cu(r){return kt(r.integerValue||r.doubleValue)}function uu(r){return hs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class rm{constructor(e,t){this.version=e,this.transformResults=t}}class Mt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Mt}static exists(e){return new Mt(void 0,e)}static updateTime(e){return new Mt(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ii(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ei{}function hu(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new kr(r.key,Mt.none()):new Pr(r.key,r.data,Mt.none());{const t=r.data,n=Qt.empty();let s=new At(st.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?n.delete(i):n.set(i,o),s=s.add(i)}return new Pn(r.key,n,new un(s.toArray()),Mt.none())}}function sm(r,e,t){r instanceof Pr?function(s,i,o){const u=s.value.clone(),h=mu(s.fieldTransforms,i,o.transformResults);u.setAll(h),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof Pn?function(s,i,o){if(!Ii(s.precondition,i))return void i.convertToUnknownDocument(o.version);const u=mu(s.fieldTransforms,i,o.transformResults),h=i.data;h.setAll(_u(s)),h.setAll(u),i.convertToFoundDocument(o.version,h).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function ws(r,e,t,n){return r instanceof Pr?function(i,o,u,h){if(!Ii(i.precondition,o))return u;const m=i.value.clone(),g=fu(i.fieldTransforms,h,o);return m.setAll(g),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),null}(r,e,t,n):r instanceof Pn?function(i,o,u,h){if(!Ii(i.precondition,o))return u;const m=fu(i.fieldTransforms,h,o),g=o.data;return g.setAll(_u(i)),g.setAll(m),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(x=>x.field))}(r,e,t,n):(u=t,Ii(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function im(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=ou(n.transform,s||null);null!=i&&(null===t&&(t=Qt.empty()),t.set(n.field,i))}return t||null}function du(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===s||n&&s&&M(n,s,(i,o)=>function nm(r,e){return r.field.isEqual(e.field)&&(s=e.transform,(n=r.transform)instanceof ir&&s instanceof ir||n instanceof or&&s instanceof or?M(n.elements,s.elements,wn):n instanceof Or&&s instanceof Or?wn(n.Pe,s.Pe):n instanceof Rr&&s instanceof Rr);var n,s}(i,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,s}class Pr extends Ei{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Pn extends Ei{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function _u(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function mu(r,e,t){const n=new Map;se(r.length===t.length);for(let s=0;s<t.length;s++){const i=r[s],o=i.transform,u=e.data.field(i.field);n.set(i.field,tm(o,u,t[s]))}return n}function fu(r,e,t){const n=new Map;for(const s of r){const i=s.transform,o=t.data.field(s.field);n.set(s.field,em(i,o,e))}return n}class kr extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Jo extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zo{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&sm(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ru();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let u=this.applyToLocalView(o,i.mutatedFields);u=t.has(s.key)?null:u;const h=hu(o,u);null!==h&&n.set(s.key,h),o.isValidDocument()||o.convertToNoDocument(ve.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),dt())}isEqual(e){return this.batchId===e.batchId&&M(this.mutations,e.mutations,(t,n)=>du(t,n))&&M(this.baseMutations,e.baseMutations,(t,n)=>du(t,n))}}class ea{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){se(e.mutations.length===n.length);let s=function(){return H_}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new ea(e,t,n,s)}}class ta{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class om{constructor(e,t){this.count=e,this.unchangedNames=t}}var $t,wt;function yu(r){if(void 0===r)return Ge("GRPC error has no .code"),$.UNKNOWN;switch(r){case $t.OK:return $.OK;case $t.CANCELLED:return $.CANCELLED;case $t.UNKNOWN:return $.UNKNOWN;case $t.DEADLINE_EXCEEDED:return $.DEADLINE_EXCEEDED;case $t.RESOURCE_EXHAUSTED:return $.RESOURCE_EXHAUSTED;case $t.INTERNAL:return $.INTERNAL;case $t.UNAVAILABLE:return $.UNAVAILABLE;case $t.UNAUTHENTICATED:return $.UNAUTHENTICATED;case $t.INVALID_ARGUMENT:return $.INVALID_ARGUMENT;case $t.NOT_FOUND:return $.NOT_FOUND;case $t.ALREADY_EXISTS:return $.ALREADY_EXISTS;case $t.PERMISSION_DENIED:return $.PERMISSION_DENIED;case $t.FAILED_PRECONDITION:return $.FAILED_PRECONDITION;case $t.ABORTED:return $.ABORTED;case $t.OUT_OF_RANGE:return $.OUT_OF_RANGE;case $t.UNIMPLEMENTED:return $.UNIMPLEMENTED;case $t.DATA_LOSS:return $.DATA_LOSS;default:return Q()}}(wt=$t||($t={}))[wt.OK=0]="OK",wt[wt.CANCELLED=1]="CANCELLED",wt[wt.UNKNOWN=2]="UNKNOWN",wt[wt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wt[wt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wt[wt.NOT_FOUND=5]="NOT_FOUND",wt[wt.ALREADY_EXISTS=6]="ALREADY_EXISTS",wt[wt.PERMISSION_DENIED=7]="PERMISSION_DENIED",wt[wt.UNAUTHENTICATED=16]="UNAUTHENTICATED",wt[wt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wt[wt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wt[wt.ABORTED=10]="ABORTED",wt[wt.OUT_OF_RANGE=11]="OUT_OF_RANGE",wt[wt.UNIMPLEMENTED=12]="UNIMPLEMENTED",wt[wt.INTERNAL=13]="INTERNAL",wt[wt.UNAVAILABLE=14]="UNAVAILABLE",wt[wt.DATA_LOSS=15]="DATA_LOSS";const am=new G([4294967295,4294967295],0);function wu(r){const e=function vu(){return new TextEncoder}().encode(r),t=new k;return t.update(e),new Uint8Array(t.digest())}function xu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new G([t,n],0),new G([s,i],0)]}class na{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new xs(`Invalid padding: ${t}`);if(n<0)throw new xs(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new xs(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new xs(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=G.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(G.fromNumber(n)));return 1===s.compare(am)&&(s=new G([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=wu(e),[n,s]=xu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new na(i,s,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(0===this.Ie)return;const t=wu(e),[n,s]=xu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class xs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ts{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,bs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ts(ve.min(),s,new Rt(C),hn(),dt())}}class bs{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new bs(n,t,dt(),dt(),dt())}}class Si{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class Tu{constructor(e,t){this.targetId=e,this.me=t}}class bu{constructor(e,t,n=Nt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Iu{constructor(){this.fe=0,this.ge=Au(),this.pe=Nt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=dt(),t=dt(),n=dt();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:Q()}}),new bs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Au()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,se(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class lm{constructor(e){this.Le=e,this.Be=new Map,this.ke=hn(),this.qe=Eu(),this.Qe=new Rt(C)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Q()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const i=s.target;if(wi(i))if(0===n){const o=new te(i.path);this.Ue(t,o,Ot.newNoDocument(o,ve.min()))}else se(1===n);else{const o=this.Ye(t);if(o!==n){const u=this.Ze(e),h=u?this.Xe(u,e,o):1;0!==h&&(this.je(t),this.Qe=this.Qe.insert(t,2===h?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let o,u;try{o=Cn(n).toUint8Array()}catch(h){if(h instanceof Sc)return he("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new na(o,s,i)}catch(h){return he(h instanceof xs?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(i=>{const o=this.Le.tt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const u=this.Je(o);if(u){if(i.current&&wi(u.target)){const h=new te(u.target.path);null!==this.ke.get(h)||this.it(o,h)||this.Ue(o,h,Ot.newNoDocument(h,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=dt();this.qe.forEach((i,o)=>{let u=!0;o.forEachWhile(h=>{const m=this.Je(h);return!m||"TargetPurposeLimboResolution"===m.purpose||(u=!1,!1)}),u&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Ts(e,t,this.Qe,this.ke,n);return this.ke=hn(),this.qe=Eu(),this.Qe=new Rt(C),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Iu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new At(C),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||fe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Iu),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Eu(){return new Rt(te.comparator)}function Au(){return new Rt(te.comparator)}const cm={asc:"ASCENDING",desc:"DESCENDING"},um={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hm={and:"AND",or:"OR"};class dm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ra(r,e){return r.useProto3Json||gt(e)?e:{value:e}}function Mr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Su(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function _m(r,e){return Mr(r,e.toTimestamp())}function Lt(r){return se(!!r),ve.fromTimestamp(function(t){const n=Sn(t);return new Te(n.seconds,n.nanos)}(r))}function sa(r,e){return ia(r,e).canonicalString()}function ia(r,e){const t=(s=r,new Re(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===e?t:t.child(e)}function Cu(r){const e=Re.fromString(r);return se(zu(e)),e}function Is(r,e){return sa(r.databaseId,e.path)}function Tn(r,e){const t=Cu(e);if(t.get(1)!==r.databaseId.projectId)throw new me($.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new me($.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new te(Pu(t))}function Ru(r,e){return sa(r.databaseId,e)}function oa(r){return new Re(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Pu(r){return se(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function ku(r,e,t){return{name:Is(r,e),fields:t.value.mapValue.fields}}function Du(r,e){return{documents:[Ru(r,e.path)]}}function Ci(r,e){const t={structuredQuery:{}},n=e.path;let s;null!==e.collectionGroup?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Ru(r,s);const i=function(m){if(0!==m.length)return Nu(It.create(m,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(m){if(0!==m.length)return m.map(g=>{return{field:Un((R=g).field),direction:ym(R.dir)};var R})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=ra(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(m=e.startAt).inclusive,values:m.position}),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{_t:t,parent:s};var m}function Vu(r){let e=function Ou(r){const e=Cu(r);return 4===e.length?Re.emptyPath():Pu(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){se(1===n);const g=t.from[0];g.allDescendants?s=g.collectionId:e=e.child(g.collectionId)}let i=[];t.where&&(i=function(x){const R=ju(x);return R instanceof It&&qo(R)?R.getFilters():[R]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(R=>{return new _s(Dr((Ie=R).field),function(Oe){switch(Oe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Ie.direction));var Ie}));let u=null;t.limit&&(u=function(x){let R;return R="object"==typeof x?x.value:x,gt(R)?null:R}(t.limit));let h=null;var x;t.startAt&&(h=new Gn((x=t.startAt).values||[],!!x.before));let m=null;return t.endAt&&(m=function(x){return new Gn(x.values||[],!x.before)}(t.endAt)),function Yc(r,e,t,n,s,i,o,u){return new Rn(r,e,t,n,s,i,o,u)}(e,s,o,i,u,"F",h,m)}function ju(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Dr(t.unaryFilter.field);return yt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Dr(t.unaryFilter.field);return yt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Dr(t.unaryFilter.field);return yt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Dr(t.unaryFilter.field);return yt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Q()}}(r):void 0!==r.fieldFilter?yt.create(Dr((t=r).fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Q()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return It.create(t.compositeFilter.filters.map(n=>ju(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Q()}}(t.compositeFilter.op))}(r):Q();var t}function ym(r){return cm[r]}function vm(r){return um[r]}function wm(r){return hm[r]}function Un(r){return{fieldPath:r.canonicalString()}}function Dr(r){return st.fromServerFormat(r.fieldPath)}function Nu(r){return r instanceof yt?function(t){if("=="===t.op){if(Pc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Pc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Un(t.field),op:vm(t.op),value:t.value}}}(r):r instanceof It?function(t){const n=t.getFilters().map(s=>Nu(s));return 1===n.length?n[0]:{compositeFilter:{op:wm(t.op),filters:n}}}(r):Q()}function xm(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function zu(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class kn{constructor(e,t,n,s,i=ve.min(),o=ve.min(),u=Nt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new kn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Bu{constructor(e){this.ct=e}}function la(r){const e=Vu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Ti(e,e.limit,"L"):e}class ur{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(kt(e.integerValue));else if("doubleValue"in e){const n=kt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),dn(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Sn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Cn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?kc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):vi(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Q()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;const i=e.fields||{};this.dt(t,53);const o="value",u=(null===(s=null===(n=i[o].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.dt(t,15),t.At(kt(u)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),te.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}ur.vt=new ur;class Om{constructor(){this.un=new ma}addToCollectionParentIndex(e,t){return this.un.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Ae.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Ae.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class ma{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new At(Re.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new At(Re.comparator)).toArray()}}new Uint8Array(0);class en{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new en(e,en.DEFAULT_COLLECTION_PERCENTILE,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}en.DEFAULT_COLLECTION_PERCENTILE=10,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,en.DEFAULT=new en(41943040,en.DEFAULT_COLLECTION_PERCENTILE,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),en.DISABLED=new en(-1,0,0);class dr{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new dr(0)}static kn(){return new dr(-1)}}class ch{constructor(){this.changes=new On(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Nm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mh{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==n&&ws(n.mutation,s,un.empty(),Te.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,dt()).next(()=>n))}getLocalViewOfDocuments(e,t,n=dt()){const s=xn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(i=>{let o=gs();return i.forEach((u,h)=>{o=o.insert(u,h.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=xn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,dt()))}populateOverlays(e,t,n){const s=[];return n.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,s){let i=hn();const o=ys(),u=ys();return t.forEach((h,m)=>{const g=n.get(m.key);s.has(m.key)&&(void 0===g||g.mutation instanceof Pn)?i=i.insert(m.key,m):void 0!==g?(o.set(m.key,g.mutation.getFieldMask()),ws(g.mutation,m,g.mutation.getFieldMask(),Te.now())):o.set(m.key,un.empty())}),this.recalculateAndSaveOverlays(e,i).next(h=>(h.forEach((m,g)=>o.set(m,g)),t.forEach((m,g)=>{var x;return u.set(m,new Nm(g,null!==(x=o.get(m))&&void 0!==x?x:null))}),u))}recalculateAndSaveOverlays(e,t){const n=ys();let s=new Rt((o,u)=>o-u),i=dt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(h=>{const m=t.get(h);if(null===m)return;let g=n.get(h)||un.empty();g=u.applyToLocalView(m,g),n.set(h,g);const x=(s.get(u.batchId)||dt()).add(h);s=s.insert(u.batchId,x)})}).next(()=>{const o=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),m=h.key,g=h.value,x=ru();g.forEach(R=>{if(!i.has(R)){const Z=hu(t.get(R),n.get(R));null!==Z&&x.set(R,Z),i=i.add(R)}}),o.push(this.documentOverlayCache.saveOverlays(e,m,x))}return P.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return te.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Yo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var o}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):P.resolve(xn());let u=-1,h=i;return o.next(m=>P.forEach(m,(g,x)=>(u<x.largestBatchId&&(u=x.largestBatchId),i.get(g)?P.resolve():this.remoteDocumentCache.getEntry(e,g).next(R=>{h=h.insert(g,R)}))).next(()=>this.populateOverlays(e,m,i)).next(()=>this.computeViews(e,h,m,dt())).next(g=>({batchId:u,changes:nu(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new te(t)).next(n=>{let s=gs();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let o=gs();return this.indexManager.getCollectionParents(e,i).next(u=>P.forEach(u,h=>{const m=(x=t,R=h.child(i),new Rn(R,null,x.explicitOrderBy.slice(),x.filters.slice(),x.limit,x.limitType,x.startAt,x.endAt));var x,R;return this.getDocumentsMatchingCollectionQuery(e,m,n,s).next(g=>{g.forEach((x,R)=>{o=o.insert(x,R)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(o=>{i.forEach((h,m)=>{const g=m.getKey();null===o.get(g)&&(o=o.insert(g,Ot.newInvalidDocument(g)))});let u=gs();return o.forEach((h,m)=>{const g=i.get(h);void 0!==g&&ws(g.mutation,m,un.empty(),Te.now()),ps(t,m)&&(u=u.insert(h,m))}),u})}}class zm{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return P.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(s=t).id,version:s.version,createTime:Lt(s.createTime)}),P.resolve();var s}getNamedQuery(e,t){return P.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(s=t).name,query:la(s.bundledQuery),readTime:Lt(s.readTime)}),P.resolve();var s}}class Bm{constructor(){this.overlays=new Rt(te.comparator),this.Ir=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const n=xn();return P.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,i)=>{this.ht(e,t,i)}),P.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Ir.get(n);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){const s=xn(),i=t.length+1,o=new te(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const h=u.getNext().value,m=h.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===i&&h.largestBatchId>n&&s.set(h.getKey(),h)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new Rt((m,g)=>m-g);const o=this.overlays.getIterator();for(;o.hasNext();){const m=o.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>n){let g=i.get(m.largestBatchId);null===g&&(g=xn(),i=i.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const u=xn(),h=i.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((m,g)=>u.set(m,g)),!(u.size()>=s)););return P.resolve(u)}ht(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const o=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new ta(t,n));let i=this.Ir.get(t);void 0===i&&(i=dt(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class Lm{constructor(){this.sessionToken=Nt.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class fa{constructor(){this.Tr=new At(Wt.Er),this.dr=new At(Wt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Wt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Wt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new te(new Re([])),n=new Wt(t,e),s=new Wt(t,e+1),i=[];return this.dr.forEachInRange([n,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new te(new Re([])),n=new Wt(t,e),s=new Wt(t,e+1);let i=dt();return this.dr.forEachInRange([n,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Wt(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Wt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return te.comparator(e.key,t.key)||C(e.wr,t.wr)}static Ar(e,t){return C(e.wr,t.wr)||te.comparator(e.key,t.key)}}class Gm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new At(Wt.Er)}checkEmpty(e){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.Sr;this.Sr++;const o=new Zo(i,t,n,s);this.mutationQueue.push(o);for(const u of s)this.br=this.br.add(new Wt(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.vr(t+1),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Wt(t,0),s=new Wt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,s],o=>{const u=this.Dr(o.wr);i.push(u)}),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new At(C);return t.forEach(s=>{const i=new Wt(s,0),o=new Wt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],u=>{n=n.add(u.wr)})}),P.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;te.isDocumentKey(i)||(i=i.child(""));const o=new Wt(new te(i),0);let u=new At(C);return this.br.forEachWhile(h=>{const m=h.key.path;return!!n.isPrefixOf(m)&&(m.length===s&&(u=u.add(h.wr)),!0)},o),P.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const s=this.Dr(n);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){se(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return P.forEach(t.mutations,s=>{const i=new Wt(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Wt(t,0),s=this.br.firstAfterOrEqual(n);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return P.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Um{constructor(e){this.Mr=e,this.docs=new Rt(te.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():Ot.newInvalidDocument(t))}getEntries(e,t){let n=hn();return t.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():Ot.newInvalidDocument(s))}),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=hn();const o=t.path,u=new te(o.child("")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:m,value:{document:g}}=h.getNext();if(!o.isPrefixOf(m.path))break;m.path.length>o.length+1||Se(new Ae((r=g).readTime,r.key,-1),n)<=0||(s.has(g.key)||ps(t,g))&&(i=i.insert(g.key,g.mutableCopy()))}var r;return P.resolve(i)}getAllFromCollectionGroup(e,t,n,s){Q()}Or(e,t){return P.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new $m(this)}getSize(e){return P.resolve(this.size)}}class $m extends ch{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),P.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class qm{constructor(e){this.persistence=e,this.Nr=new On(t=>sr(t),ms),this.lastRemoteSnapshotVersion=ve.min(),this.highestTargetId=0,this.Lr=0,this.Br=new fa,this.targetCount=0,this.kr=dr.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),P.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new dr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Kn(t),P.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Nr.forEach((o,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),P.waitFor(i).next(()=>s)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this.Br.containsKey(t))}}class pa{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Bt(0),this.Kr=!1,this.Kr=!0,this.$r=new Lm,this.referenceDelegate=e(this),this.Ur=new qm(this),this.indexManager=new Om,this.remoteDocumentCache=new Um(n=>this.referenceDelegate.Wr(n)),this.serializer=new Bu(t),this.Gr=new zm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Bm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Gm(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){fe("MemoryPersistence","Starting transaction:",e);const s=new Wm(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return P.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Wm extends Le{constructor(e){super(),this.currentSequenceNumber=e}}class Vi{constructor(e){this.persistence=e,this.Jr=new fa,this.Yr=null}static Zr(e){return new Vi(e)}get Xr(){if(this.Yr)return this.Yr;throw Q()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),P.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Xr,n=>{const s=te.fromPath(n);return this.ei(e,s).next(i=>{i||t.removeEntry(s,ve.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return P.or([()=>P.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class wa{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=dt(),s=dt();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new wa(e,t.fromCache,n,s)}}class Ym{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ph{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,H.nr)()?8:function at(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,H.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Ym;return this.Xi(e,t,o).next(u=>{if(i.result=u,this.zi)return this.es(e,t,o,u.size)})}).next(()=>i.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(Fe()<=S.$b.DEBUG&&fe("QueryEngine","SDK will not create cache indexes for query:",Cr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),P.resolve()):(Fe()<=S.$b.DEBUG&&fe("QueryEngine","Query:",Cr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(Fe()<=S.$b.DEBUG&&fe("QueryEngine","The SDK decides to create cache indexes for query:",Cr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Zt(t))):P.resolve())}Yi(e,t){if(Qc(t))return P.resolve(null);let n=Zt(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=Ti(t,null,"F"),n=Zt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=dt(...i);return this.Ji.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(h=>{const m=this.ts(t,u);return this.ns(t,m,o,h.readTime)?this.Yi(e,Ti(t,null,"F")):this.rs(e,m,t,h)}))})))}Zi(e,t,n,s){return Qc(t)||s.isEqual(ve.min())?P.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,s)?P.resolve(null):(Fe()<=S.$b.DEBUG&&fe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Cr(t)),this.rs(e,o,t,function le(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=ve.fromTimestamp(1e9===n?new Te(t+1,0):new Te(t,n));return new Ae(s,te.empty(),e)}(s,-1)).next(u=>u))})}ts(e,t){let n=new At(eu(e));return t.forEach((s,i)=>{ps(e,i)&&(n=n.add(i))}),n}ns(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,n){return Fe()<=S.$b.DEBUG&&fe("QueryEngine","Using full collection scan to execute query:",Cr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ae.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class Qm{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Rt(C),this._s=new On(i=>sr(i),ms),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function yh(r,e){return xa.apply(this,arguments)}function xa(){return(xa=(0,l.A)(function*(r,e){const t=we(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],u=[];let h=dt();for(const m of s){o.push(m.batchId);for(const g of m.mutations)h=h.add(g.key)}for(const m of i){u.push(m.batchId);for(const g of m.mutations)h=h.add(g.key)}return t.localDocuments.getDocuments(n,h).next(m=>({hs:m,removedBatchIds:o,addedBatchIds:u}))})})})).apply(this,arguments)}function vh(r){const e=we(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Jm(r,e){const t=we(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Br(r,e,t){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,l.A)(function*(r,e,t){const n=we(r),s=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!ut(o))throw o;fe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(s.target)})).apply(this,arguments)}function zi(r,e,t){const n=we(r);let s=ve.min(),i=dt();return n.persistence.runTransaction("Execute query","readwrite",o=>function(h,m,g){const x=we(h),R=x._s.get(g);return void 0!==R?P.resolve(x.os.get(R)):x.Ur.getTargetData(m,g)}(n,o,Zt(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,u.targetId).next(h=>{i=h})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?s:ve.min(),t?i:dt())).next(u=>(function bh(r,e,t){let n=r.us.get(e)||ve.min();t.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}(n,function Zc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),u),{documents:u,Ts:i})))}class Sa{constructor(){this.activeTargetIds=function Xo(){return Z_}()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ah{constructor(){this.so=new Sa,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Sa,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class tf{_o(e){}shutdown(){}}class Sh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){fe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){fe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Gi=null;function Ra(){return null===Gi?Gi=268435456+Math.round(2147483648*Math.random()):Gi++,"0x"+Gi.toString(16)}const nf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class rf{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const tn="WebChannelConnection";class sf extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co="(default)"===this.databaseId.database?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,n,s,i,o){const u=Ra(),h=this.xo(t,n.toUriEncodedString());fe("RestConnection",`Sending RPC '${t}' ${u}:`,h,s);const m={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(m,i,o),this.No(t,h,m,s).then(g=>(fe("RestConnection",`Received RPC '${t}' ${u}: `,g),g),g=>{throw he("RestConnection",`RPC '${t}' ${u} failed with error: `,g,"url: ",h,"request:",s),g})}Lo(t,n,s,i,o,u){return this.Mo(t,n,s,i,o)}Oo(t,n,s){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ce,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,n){return`${this.Do}/v1/${n}:${nf[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){const i=Ra();return new Promise((o,u)=>{const h=new ie;h.setWithCredentials(!0),h.listenOnce(W.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case I.NO_ERROR:const g=h.getResponseJson();fe(tn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(g)),o(g);break;case I.TIMEOUT:fe(tn,`RPC '${e}' ${i} timed out`),u(new me($.DEADLINE_EXCEEDED,"Request time out"));break;case I.HTTP_ERROR:const x=h.getStatus();if(fe(tn,`RPC '${e}' ${i} failed with status:`,x,"response text:",h.getResponseText()),x>0){let R=h.getResponseJson();Array.isArray(R)&&(R=R[0]);const Z=R?.error;if(Z&&Z.status&&Z.message){const Ie=function(Oe){const He=Oe.toLowerCase().replace(/_/g,"-");return Object.values($).indexOf(He)>=0?He:$.UNKNOWN}(Z.status);u(new me(Ie,Z.message))}else u(new me($.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new me($.UNAVAILABLE,"Connection failed."));break;default:Q()}}finally{fe(tn,`RPC '${e}' ${i} completed.`)}});const m=JSON.stringify(s);fe(tn,`RPC '${e}' ${i} sending request:`,s),h.send(t,"POST",m,n,15)})}Bo(e,t,n){const s=Ra(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ee(),u=xe(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;void 0!==m&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.xmlHttpFactory=new ze({})),this.Oo(h.initMessageHeaders,t,n),h.encodeInitMessageHeaders=!0;const g=i.join("");fe(tn,`Creating RPC '${e}' stream ${s}: ${g}`,h);const x=o.createWebChannel(g,h);let R=!1,Z=!1;const Ie=new rf({Io:Oe=>{Z?fe(tn,`Not sending because RPC '${e}' stream ${s} is closed:`,Oe):(R||(fe(tn,`Opening RPC '${e}' stream ${s} transport.`),x.open(),R=!0),fe(tn,`RPC '${e}' stream ${s} sending:`,Oe),x.send(Oe))},To:()=>x.close()}),De=(Oe,He,ot)=>{Oe.listen(He,et=>{try{ot(et)}catch(ht){setTimeout(()=>{throw ht},0)}})};return De(x,re.EventType.OPEN,()=>{Z||(fe(tn,`RPC '${e}' stream ${s} transport opened.`),Ie.yo())}),De(x,re.EventType.CLOSE,()=>{Z||(Z=!0,fe(tn,`RPC '${e}' stream ${s} transport closed`),Ie.So())}),De(x,re.EventType.ERROR,Oe=>{Z||(Z=!0,he(tn,`RPC '${e}' stream ${s} transport errored:`,Oe),Ie.So(new me($.UNAVAILABLE,"The operation could not be completed")))}),De(x,re.EventType.MESSAGE,Oe=>{var He;if(!Z){const ot=Oe.data[0];se(!!ot);const ht=ot.error||(null===(He=ot[0])||void 0===He?void 0:He.error);if(ht){fe(tn,`RPC '${e}' stream ${s} received error:`,ht);const Tt=ht.status;let _t=function(F){const Y=$t[F];if(void 0!==Y)return yu(Y)}(Tt),q=ht.message;void 0===_t&&(_t=$.INTERNAL,q="Unknown error status: "+Tt+" with message "+ht.message),Z=!0,Ie.So(new me(_t,q)),x.close()}else fe(tn,`RPC '${e}' stream ${s} received:`,ot),Ie.bo(ot)}}),De(u,ye.STAT_EVENT,Oe=>{Oe.stat===J.PROXY?fe(tn,`RPC '${e}' stream ${s} detected buffering proxy`):Oe.stat===J.NOPROXY&&fe(tn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{Ie.wo()},0),Ie}}function Ui(){return typeof document<"u"?document:null}function Ms(r){return new dm(r,!0)}class Oa{constructor(e,t,n=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&fe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Rh{constructor(e,t,n,s,i,o,u,h){this.ui=e,this.Ho=n,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Oa(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,l.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,l.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,l.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===$.RESOURCE_EXHAUSTED?(Ge(t.toString()),Ge("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===$.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{const s=new me($.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>1==++this.e_?this.E_(s):this.onNext(s))})}i_(){var e=this;this.state=5,this.t_.Go((0,l.A)(function*(){e.state=0,e.start()}))}I_(e){return fe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(fe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class of extends Rh{constructor(e,t,n,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function fm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(m=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===m?1:"REMOVE"===m?2:"CURRENT"===m?3:"RESET"===m?4:Q(),s=e.targetChange.targetIds||[],i=function(m,g){return m.useProto3Json?(se(void 0===g||"string"==typeof g),Nt.fromBase64String(g||"")):(se(void 0===g||g instanceof Buffer||g instanceof Uint8Array),Nt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(m){const g=void 0===m.code?$.UNKNOWN:yu(m.code);return new me(g,m.message||"")}(o);t=new bu(n,s,i,u||null)}else if("documentChange"in e){const n=e.documentChange,s=Tn(r,n.document.name),i=Lt(n.document.updateTime),o=n.document.createTime?Lt(n.document.createTime):ve.min(),u=new Qt({mapValue:{fields:n.document.fields}}),h=Ot.newFoundDocument(s,i,o,u);t=new Si(n.targetIds||[],n.removedTargetIds||[],h.key,h)}else if("documentDelete"in e){const n=e.documentDelete,s=Tn(r,n.document),i=n.readTime?Lt(n.readTime):ve.min(),o=Ot.newNoDocument(s,i);t=new Si([],n.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const n=e.documentRemove,s=Tn(r,n.document);t=new Si([],n.removedTargetIds||[],s,null)}else{if(!("filter"in e))return Q();{const n=e.filter,{count:s=0,unchangedNames:i}=n,o=new om(s,i);t=new Tu(n.targetId,o)}}var m;return t}(this.serializer,e),n=function(i){if(!("targetChange"in i))return ve.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ve.min():o.readTime?Lt(o.readTime):ve.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=oa(this.serializer),t.addTarget=function(i,o){let u;const h=o.target;if(u=wi(h)?{documents:Du(i,h)}:{query:Ci(i,h)._t},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=Su(i,o.resumeToken);const m=ra(i,o.expectedCount);null!==m&&(u.expectedCount=m)}else if(o.snapshotVersion.compareTo(ve.min())>0){u.readTime=Mr(i,o.snapshotVersion.toTimestamp());const m=ra(i,o.expectedCount);null!==m&&(u.expectedCount=m)}return u}(this.serializer,e);const n=function gm(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Q()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=oa(this.serializer),t.removeTarget=e,this.a_(t)}}class af extends Rh{constructor(e,t,n,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return se(!!e.streamToken),this.lastStreamToken=e.streamToken,se(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){se(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function pm(r,e){return r&&r.length>0?(se(void 0!==e),r.map(t=>function(s,i){let o=Lt(s.updateTime?s.updateTime:i);return o.isEqual(ve.min())&&(o=Lt(i)),new rm(o,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Lt(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=oa(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Es(r,e){let t;if(e instanceof Pr)t={update:ku(r,e.key,e.value)};else if(e instanceof kr)t={delete:Is(r,e.key)};else if(e instanceof Pn)t={update:ku(r,e.key,e.data),updateMask:xm(e.fieldMask)};else{if(!(e instanceof Jo))return Q();t={verify:Is(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const u=o.transform;if(u instanceof Rr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ir)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof or)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Or)return{fieldPath:o.field.canonicalString(),increment:u.Pe};throw Q()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:_m(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:Q()),t;var i}(this.serializer,n))};this.a_(t)}}class lf extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new me($.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,ia(t,n),s,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new me($.UNKNOWN,i.toString())})}Lo(e,t,n,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Lo(e,ia(t,n),s,o,u,i)).catch(o=>{throw"FirebaseError"===o.name?(o.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new me($.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class cf{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Ge(t),this.D_=!1):fe("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class uf{constructor(e,t,n,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(u=>{n.enqueueAndForget((0,l.A)(function*(){var h;Kn(o)&&(fe("RemoteStore","Restarting streams for network reachability change."),yield(h=(0,l.A)(function*(g){const x=we(g);x.L_.add(4),yield Lr(x),x.q_.set("Unknown"),x.L_.delete(4),yield Ds(x)}),function m(g){return h.apply(this,arguments)})(o))}))}),this.q_=new cf(n,s)}}function Ds(r){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,l.A)(function*(r){if(Kn(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Lr(r){return ka.apply(this,arguments)}function ka(){return(ka=(0,l.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function $i(r,e){const t=we(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Fa(t)?Da(t):$r(t).r_()&&Ma(t,e))}function Gr(r,e){const t=we(r),n=$r(t);t.N_.delete(e),n.r_()&&Oh(t,e),0===t.N_.size&&(n.r_()?n.o_():Kn(t)&&t.q_.set("Unknown"))}function Ma(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ve.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}$r(r).A_(e)}function Oh(r,e){r.Q_.xe(e),$r(r).R_(e)}function Da(r){r.Q_=new lm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),$r(r).start(),r.q_.v_()}function Fa(r){return Kn(r)&&!$r(r).n_()&&r.N_.size>0}function Kn(r){return 0===we(r).L_.size}function Ph(r){r.Q_=void 0}function hf(r){return Va.apply(this,arguments)}function Va(){return(Va=(0,l.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function df(r){return ja.apply(this,arguments)}function ja(){return(ja=(0,l.A)(function*(r){r.N_.forEach((e,t)=>{Ma(r,e)})})).apply(this,arguments)}function _f(r,e){return Na.apply(this,arguments)}function Na(){return(Na=(0,l.A)(function*(r,e){Ph(r),Fa(r)?(r.q_.M_(e),Da(r)):r.q_.set("Unknown")})).apply(this,arguments)}function mf(r,e,t){return za.apply(this,arguments)}function za(){return za=(0,l.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof bu&&2===e.state&&e.cause)try{yield(n=(0,l.A)(function*(i,o){const u=o.cause;for(const h of o.targetIds)i.N_.has(h)&&(yield i.remoteSyncer.rejectListen(h,u),i.N_.delete(h),i.Q_.removeTarget(h))}),function s(i,o){return n.apply(this,arguments)})(r,e)}catch(n){fe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield qi(r,n)}else if(e instanceof Si?r.Q_.Ke(e):e instanceof Tu?r.Q_.He(e):r.Q_.We(e),!t.isEqual(ve.min()))try{const n=yield vh(r.localStore);t.compareTo(n)>=0&&(yield function(i,o){const u=i.Q_.rt(o);return u.targetChanges.forEach((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const g=i.N_.get(m);g&&i.N_.set(m,g.withResumeToken(h.resumeToken,o))}}),u.targetMismatches.forEach((h,m)=>{const g=i.N_.get(h);if(!g)return;i.N_.set(h,g.withResumeToken(Nt.EMPTY_BYTE_STRING,g.snapshotVersion)),Oh(i,h);const x=new kn(g.target,h,m,g.sequenceNumber);Ma(i,x)}),i.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){fe("RemoteStore","Failed to raise snapshot:",n),yield qi(r,n)}var n}),za.apply(this,arguments)}function qi(r,e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,l.A)(function*(r,e,t){if(!ut(e))throw e;r.L_.add(1),yield Lr(r),r.q_.set("Offline"),t||(t=()=>vh(r.localStore)),r.asyncQueue.enqueueRetryable((0,l.A)(function*(){fe("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Ds(r)}))})).apply(this,arguments)}function kh(r,e){return e().catch(t=>qi(r,t,e))}function Ur(r){return La.apply(this,arguments)}function La(){return(La=(0,l.A)(function*(r){const e=we(r),t=Yn(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;ff(e);)try{const s=yield Jm(e.localStore,n);if(null===s){0===e.O_.length&&t.o_();break}n=s.batchId,pf(e,s)}catch(s){yield qi(e,s)}Mh(e)&&Dh(e)})).apply(this,arguments)}function ff(r){return Kn(r)&&r.O_.length<10}function pf(r,e){r.O_.push(e);const t=Yn(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Mh(r){return Kn(r)&&!Yn(r).n_()&&r.O_.length>0}function Dh(r){Yn(r).start()}function gf(r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,l.A)(function*(r){Yn(r).p_()})).apply(this,arguments)}function yf(r){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,l.A)(function*(r){const e=Yn(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function vf(r,e,t){return $a.apply(this,arguments)}function $a(){return($a=(0,l.A)(function*(r,e,t){const n=r.O_.shift(),s=ea.from(n,e,t);yield kh(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Ur(r)})).apply(this,arguments)}function wf(r,e){return qa.apply(this,arguments)}function qa(){return qa=(0,l.A)(function*(r,e){var t;e&&Yn(r).V_&&(yield(t=(0,l.A)(function*(s,i){if(function gu(r){switch(r){default:return Q();case $.CANCELLED:case $.UNKNOWN:case $.DEADLINE_EXCEEDED:case $.RESOURCE_EXHAUSTED:case $.INTERNAL:case $.UNAVAILABLE:case $.UNAUTHENTICATED:return!1;case $.INVALID_ARGUMENT:case $.NOT_FOUND:case $.ALREADY_EXISTS:case $.PERMISSION_DENIED:case $.FAILED_PRECONDITION:case $.ABORTED:case $.OUT_OF_RANGE:case $.UNIMPLEMENTED:case $.DATA_LOSS:return!0}}(u=i.code)&&u!==$.ABORTED){const o=s.O_.shift();Yn(s).s_(),yield kh(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Ur(s)}var u}),function n(s,i){return t.apply(this,arguments)})(r,e)),Mh(r)&&Dh(r)}),qa.apply(this,arguments)}function Fh(r,e){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,l.A)(function*(r,e){const t=we(r);t.asyncQueue.verifyOperationInProgress(),fe("RemoteStore","RemoteStore received new credentials");const n=Kn(t);t.L_.add(3),yield Lr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Ds(t)})).apply(this,arguments)}function Ka(r,e){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,l.A)(function*(r,e){const t=we(r);e?(t.L_.delete(2),yield Ds(t)):e||(t.L_.add(2),yield Lr(t),t.q_.set("Unknown"))})).apply(this,arguments)}function $r(r){return r.K_||(r.K_=function(t,n,s){const i=we(t);return i.w_(),new of(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:hf.bind(null,r),Ro:df.bind(null,r),mo:_f.bind(null,r),d_:mf.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.K_.s_(),Fa(r)?Da(r):r.q_.set("Unknown")):(yield r.K_.stop(),Ph(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Yn(r){return r.U_||(r.U_=function(t,n,s){const i=we(t);return i.w_(),new af(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:gf.bind(null,r),mo:wf.bind(null,r),f_:yf.bind(null,r),g_:vf.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.U_.s_(),yield Ur(r)):(yield r.U_.stop(),r.O_.length>0&&(fe("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Qa{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const o=Date.now()+n,u=new Qa(e,t,o,s,i);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new me($.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qr(r,e){if(Ge("AsyncQueue",`${e}: ${r}`),ut(r))return new me($.UNAVAILABLE,`${e}: ${r}`);throw r}class Wr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||te.comparator(t.key,n.key):(t,n)=>te.comparator(t.key,n.key),this.keyedMap=gs(),this.sortedSet=new Rt(this.comparator)}static emptySet(e){return new Wr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Wr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Vh{constructor(){this.W_=new Rt(te.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Q():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Kr{constructor(e,t,n,s,i,o,u,h,m){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,t,n,s,i){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new Kr(e,t,Wr.emptySet(t),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class xf{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Tf{constructor(){this.queries=jh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const s=we(t),i=s.queries;s.queries=jh(),i.forEach((o,u)=>{for(const h of u.j_)h.onError(n)})}(this,new me($.ABORTED,"Firestore shutting down"))}}function jh(){return new On(r=>Jc(r),fs)}function Xa(r,e){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,l.A)(function*(r,e){const t=we(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(n=2):(i=new xf,n=e.J_()?0:1);try{switch(n){case 0:i.z_=yield t.onListen(s,!0);break;case 1:i.z_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){const u=qr(o,`Initialization of query '${Cr(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&el(t)})).apply(this,arguments)}function Ja(r,e){return Za.apply(this,arguments)}function Za(){return(Za=(0,l.A)(function*(r,e){const t=we(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),0===i.j_.length?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function bf(r,e){const t=we(r);let n=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const u of o.j_)u.X_(s)&&(n=!0);o.z_=s}}n&&el(t)}function If(r,e,t){const n=we(r),s=n.queries.get(e);if(s)for(const i of s.j_)i.onError(t);n.queries.delete(e)}function el(r){r.Y_.forEach(e=>{e.next()})}var tl,Nh;(Nh=tl||(tl={})).ea="default",Nh.Cache="cache";class nl{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)3!==s.type&&n.push(s);e=new Kr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=Kr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==tl.Cache}}class Lh{constructor(e){this.key=e}}class Gh{constructor(e){this.key=e}}class Uh{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=dt(),this.mutatedKeys=dt(),this.Aa=eu(e),this.Ra=new Wr(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Vh,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,u=!1;const h="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,m="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((g,x)=>{const R=s.get(g),Z=ps(this.query,x)?x:null,Ie=!!R&&this.mutatedKeys.has(R.key),De=!!Z&&(Z.hasLocalMutations||this.mutatedKeys.has(Z.key)&&Z.hasCommittedMutations);let Oe=!1;R&&Z?R.data.isEqual(Z.data)?Ie!==De&&(n.track({type:3,doc:Z}),Oe=!0):this.ga(R,Z)||(n.track({type:2,doc:Z}),Oe=!0,(h&&this.Aa(Z,h)>0||m&&this.Aa(Z,m)<0)&&(u=!0)):!R&&Z?(n.track({type:0,doc:Z}),Oe=!0):R&&!Z&&(n.track({type:1,doc:R}),Oe=!0,(h||m)&&(u=!0)),Oe&&(Z?(o=o.add(Z),i=De?i.add(g):i.delete(g)):(o=o.delete(g),i=i.delete(g)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const g="F"===this.query.limitType?o.last():o.first();o=o.delete(g.key),i=i.delete(g.key),n.track({type:1,doc:g})}return{Ra:o,fa:n,ns:u,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((g,x)=>function(Z,Ie){const De=Oe=>{switch(Oe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Q()}};return De(Z)-De(Ie)}(g.type,x.type)||this.Aa(g.doc,x.doc)),this.pa(n),s=null!=s&&s;const u=t&&!s?this.ya():[],h=0===this.da.size&&this.current&&!s?1:0,m=h!==this.Ea;return this.Ea=h,0!==o.length||m?{snapshot:new Kr(this.query,e.Ra,i,o,e.mutatedKeys,0===h,m,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Vh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=dt(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Gh(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Lh(n))}),t}ba(e){this.Ta=e.Ts,this.da=dt();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Kr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Sf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Cf{constructor(e){this.key=e,this.va=!1}}class Rf{constructor(e,t,n,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new On(u=>Jc(u),fs),this.Ma=new Map,this.xa=new Set,this.Oa=new Rt(te.comparator),this.Na=new Map,this.La=new fa,this.Ba={},this.ka=new Map,this.qa=dr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function Of(r,e){return rl.apply(this,arguments)}function rl(){return(rl=(0,l.A)(function*(r,e,t=!0){const n=Wi(r);let s;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=yield $h(n,e,t,!0),s})).apply(this,arguments)}function Pf(r,e){return sl.apply(this,arguments)}function sl(){return(sl=(0,l.A)(function*(r,e){const t=Wi(r);yield $h(t,e,!0,!1)})).apply(this,arguments)}function $h(r,e,t,n){return il.apply(this,arguments)}function il(){return(il=(0,l.A)(function*(r,e,t,n){const s=yield function zr(r,e){const t=we(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(i=>i?(s=i,P.resolve(s)):t.Ur.allocateTargetId(n).next(o=>(s=new kn(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.os.get(n.targetId);return(null===s||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}(r.localStore,Zt(e)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let u;return n&&(u=yield function ol(r,e,t,n,s){return al.apply(this,arguments)}(r,e,i,"current"===o,s.resumeToken)),r.isPrimaryClient&&t&&$i(r.remoteStore,s),u})).apply(this,arguments)}function al(){return al=(0,l.A)(function*(r,e,t,n,s){r.Ka=(x,R,Z)=>{return(Ie=(0,l.A)(function*(Oe,He,ot,et){let ht=He.view.ma(ot);ht.ns&&(ht=yield zi(Oe.localStore,He.query,!1).then(({documents:O})=>He.view.ma(O,ht)));const Tt=et&&et.targetChanges.get(He.targetId),_t=et&&null!=et.targetMismatches.get(He.targetId),q=He.view.applyChanges(ht,Oe.isPrimaryClient,Tt,_t);return yl(Oe,He.targetId,q.wa),q.snapshot}),function De(Oe,He,ot,et){return Ie.apply(this,arguments)})(r,x,R,Z);var Ie};const i=yield zi(r.localStore,e,!0),o=new Uh(e,i.Ts),u=o.ma(i.documents),h=bs.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,s),m=o.applyChanges(u,r.isPrimaryClient,h);yl(r,t,m.wa);const g=new Sf(e,t,o);return r.Fa.set(e,g),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),m.snapshot}),al.apply(this,arguments)}function kf(r,e,t){return ll.apply(this,arguments)}function ll(){return(ll=(0,l.A)(function*(r,e,t){const n=we(r),s=n.Fa.get(e),i=n.Ma.get(s.targetId);if(i.length>1)return n.Ma.set(s.targetId,i.filter(o=>!fs(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Br(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Gr(n.remoteStore,s.targetId),Yr(n,s.targetId)}).catch(qe))):(Yr(n,s.targetId),yield Br(n.localStore,s.targetId,!0))})).apply(this,arguments)}function Mf(r,e){return cl.apply(this,arguments)}function cl(){return(cl=(0,l.A)(function*(r,e){const t=we(r),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&1===s.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Gr(t.remoteStore,n.targetId))})).apply(this,arguments)}function ul(){return(ul=(0,l.A)(function*(r,e,t){const n=function Rl(r){const e=we(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jf.bind(null,e),e}(r);try{const s=yield function(o,u){const h=we(o),m=Te.now(),g=u.reduce((Z,Ie)=>Z.add(Ie.key),dt());let x,R;return h.persistence.runTransaction("Locally write mutations","readwrite",Z=>{let Ie=hn(),De=dt();return h.cs.getEntries(Z,g).next(Oe=>{Ie=Oe,Ie.forEach((He,ot)=>{ot.isValidDocument()||(De=De.add(He))})}).next(()=>h.localDocuments.getOverlayedDocuments(Z,Ie)).next(Oe=>{x=Oe;const He=[];for(const ot of u){const et=im(ot,x.get(ot.key).overlayedDocument);null!=et&&He.push(new Pn(ot.key,et,Vc(et.value.mapValue),Mt.exists(!0)))}return h.mutationQueue.addMutationBatch(Z,m,He,u)}).next(Oe=>{R=Oe;const He=Oe.applyToLocalDocumentSet(x,De);return h.documentOverlayCache.saveOverlays(Z,Oe.batchId,He)})}).then(()=>({batchId:R.batchId,changes:nu(x)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,u,h){let m=o.Ba[o.currentUser.toKey()];m||(m=new Rt(C)),m=m.insert(u,h),o.Ba[o.currentUser.toKey()]=m}(n,s.batchId,t),yield Mn(n,s.changes),yield Ur(n.remoteStore)}catch(s){const i=qr(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function qh(r,e){return hl.apply(this,arguments)}function hl(){return(hl=(0,l.A)(function*(r,e){const t=we(r);try{const n=yield function Hm(r,e){const t=we(r),n=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const u=[];e.targetChanges.forEach((g,x)=>{const R=s.get(x);if(!R)return;u.push(t.Ur.removeMatchingKeys(i,g.removedDocuments,x).next(()=>t.Ur.addMatchingKeys(i,g.addedDocuments,x)));let Z=R.withSequenceNumber(i.currentSequenceNumber);var De,Oe,He;null!==e.targetMismatches.get(x)?Z=Z.withResumeToken(Nt.EMPTY_BYTE_STRING,ve.min()).withLastLimboFreeSnapshotVersion(ve.min()):g.resumeToken.approximateByteSize()>0&&(Z=Z.withResumeToken(g.resumeToken,n)),s=s.insert(x,Z),Oe=Z,He=g,(0===(De=R).resumeToken.approximateByteSize()||Oe.snapshotVersion.toMicroseconds()-De.snapshotVersion.toMicroseconds()>=3e8||He.addedDocuments.size+He.modifiedDocuments.size+He.removedDocuments.size>0)&&u.push(t.Ur.updateTargetData(i,Z))});let h=hn(),m=dt();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(i,g))}),u.push(function wh(r,e,t){let n=dt(),s=dt();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=hn();return t.forEach((u,h)=>{const m=i.get(u);h.isFoundDocument()!==m.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(ve.min())?(e.removeEntry(u,h.readTime),o=o.insert(u,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||0===h.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(h),o=o.insert(u,h)):fe("LocalStore","Ignoring outdated watch update for ",u,". Current version:",m.version," Watch version:",h.version)}),{Ps:o,Is:s}})}(i,o,e.documentUpdates).next(g=>{h=g.Ps,m=g.Is})),!n.isEqual(ve.min())){const g=t.Ur.getLastRemoteSnapshotVersion(i).next(x=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(g)}return P.waitFor(u).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,h,m)).next(()=>h)}).then(i=>(t.os=s,i))}(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(se(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?se(o.va):s.removedDocuments.size>0&&(se(o.va),o.va=!1))}),yield Mn(t,n,e)}catch(n){yield qe(n)}})).apply(this,arguments)}function Wh(r,e,t){const n=we(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const s=[];n.Fa.forEach((i,o)=>{const u=o.view.Z_(e);u.snapshot&&s.push(u.snapshot)}),function(o,u){const h=we(o);h.onlineState=u;let m=!1;h.queries.forEach((g,x)=>{for(const R of x.j_)R.Z_(u)&&(m=!0)}),m&&el(h)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Ff(r,e,t){return dl.apply(this,arguments)}function dl(){return(dl=(0,l.A)(function*(r,e,t){const n=we(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Na.get(e),i=s&&s.key;if(i){let o=new Rt(te.comparator);o=o.insert(i,Ot.newNoDocument(i,ve.min()));const u=dt().add(i),h=new Ts(ve.min(),new Map,new Rt(C),o,u);yield qh(n,h),n.Oa=n.Oa.remove(i),n.Na.delete(e),vl(n)}else yield Br(n.localStore,e,!1).then(()=>Yr(n,e,t)).catch(qe)})).apply(this,arguments)}function Vf(r,e){return _l.apply(this,arguments)}function _l(){return(_l=(0,l.A)(function*(r,e){const t=we(r),n=e.batch.batchId;try{const s=yield function Xm(r,e){const t=we(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,h,m,g){const x=m.batch,R=x.keys();let Z=P.resolve();return R.forEach(Ie=>{Z=Z.next(()=>g.getEntry(h,Ie)).next(De=>{const Oe=m.docVersions.get(Ie);se(null!==Oe),De.version.compareTo(Oe)<0&&(x.applyToRemoteDocument(De,m),De.isValidDocument()&&(De.setReadTime(m.commitVersion),g.addEntry(De)))})}),Z.next(()=>u.mutationQueue.removeMutationBatch(h,x))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let h=dt();for(let m=0;m<u.mutationResults.length;++m)u.mutationResults[m].transformResults.length>0&&(h=h.add(u.batch.mutations[m].key));return h}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}(t.localStore,e);gl(t,n,null),pl(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Mn(t,s)}catch(s){yield qe(s)}})).apply(this,arguments)}function jf(r,e,t){return ml.apply(this,arguments)}function ml(){return(ml=(0,l.A)(function*(r,e,t){const n=we(r);try{const s=yield function(o,u){const h=we(o);return h.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let g;return h.mutationQueue.lookupMutationBatch(m,u).next(x=>(se(null!==x),g=x.keys(),h.mutationQueue.removeMutationBatch(m,x))).next(()=>h.mutationQueue.performConsistencyCheck(m)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(m,g,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,g)).next(()=>h.localDocuments.getDocuments(m,g))})}(n.localStore,e);gl(n,e,t),pl(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Mn(n,s)}catch(s){yield qe(s)}})).apply(this,arguments)}function pl(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function gl(r,e,t){const n=we(r);let s=n.Ba[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function Yr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Kh(r,n)})}function Kh(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Gr(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),vl(r))}function yl(r,e,t){for(const n of t)n instanceof Lh?(r.La.addReference(n.key,e),zf(r,n)):n instanceof Gh?(fe("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Kh(r,n.key)):Q()}function zf(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(fe("SyncEngine","New document in limbo: "+t),r.xa.add(n),vl(r))}function vl(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new te(Re.fromString(e)),n=r.qa.next();r.Na.set(n,new Cf(t)),r.Oa=r.Oa.insert(t,n),$i(r.remoteStore,new kn(Zt(Ar(t.path)),n,"TargetPurposeLimboResolution",Bt.oe))}}function Mn(r,e,t){return wl.apply(this,arguments)}function wl(){return wl=(0,l.A)(function*(r,e,t){const n=we(r),s=[],i=[],o=[];var u;n.Fa.isEmpty()||(n.Fa.forEach((u,h)=>{o.push(n.Ka(h,e,t).then(m=>{var g;if((m||t)&&n.isPrimaryClient){const x=m?!m.fromCache:null===(g=t?.targetChanges.get(h.targetId))||void 0===g?void 0:g.current;n.sharedClientState.updateQueryState(h.targetId,x?"current":"not-current")}if(m){s.push(m);const x=wa.Wi(h.targetId,m);i.push(x)}}))}),yield Promise.all(o),n.Ca.d_(s),yield(u=(0,l.A)(function*(m,g){const x=we(m);try{yield x.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>P.forEach(g,Z=>P.forEach(Z.$i,Ie=>x.persistence.referenceDelegate.addReference(R,Z.targetId,Ie)).next(()=>P.forEach(Z.Ui,Ie=>x.persistence.referenceDelegate.removeReference(R,Z.targetId,Ie)))))}catch(R){if(!ut(R))throw R;fe("LocalStore","Failed to update sequence numbers: "+R)}for(const R of g){const Z=R.targetId;if(!R.fromCache){const Ie=x.os.get(Z),Oe=Ie.withLastLimboFreeSnapshotVersion(Ie.snapshotVersion);x.os=x.os.insert(Z,Oe)}}}),function h(m,g){return u.apply(this,arguments)})(n.localStore,i))}),wl.apply(this,arguments)}function Bf(r,e){return xl.apply(this,arguments)}function xl(){return(xl=(0,l.A)(function*(r,e){const t=we(r);if(!t.currentUser.isEqual(e)){fe("SyncEngine","User change. New user:",e.toKey());const n=yield yh(t.localStore,e);t.currentUser=e,(i=t).ka.forEach(u=>{u.forEach(h=>{h.reject(new me($.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Mn(t,n.hs)}var i})).apply(this,arguments)}function Lf(r,e){const t=we(r),n=t.Na.get(e);if(n&&n.va)return dt().add(n.key);{let s=dt();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const u=t.Fa.get(o);s=s.unionWith(u.view.Va)}return s}}function Wi(r){const e=we(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=qh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Lf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ff.bind(null,e),e.Ca.d_=bf.bind(null,e.eventManager),e.Ca.$a=If.bind(null,e.eventManager),e}class Qr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,l.A)(function*(){t.serializer=Ms(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function gh(r,e,t,n){return new Qm(r,e,t,n)}(this.persistence,new ph,e.initialUser,this.serializer)}createPersistence(e){return new pa(Vi.Zr,this.serializer)}createSharedClientState(e){return new Ah}terminate(){var e=this;return(0,l.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Xr{initialize(e,t){var n=this;return(0,l.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=s=>Wh(n.syncEngine,s,1),n.remoteStore.remoteSyncer.handleCredentialChange=Bf.bind(null,n.syncEngine),yield Ka(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Tf}createDatastore(e){const t=Ms(e.databaseInfo.databaseId),n=new sf(e.databaseInfo);return new lf(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,s=this.datastore,i=e.asyncQueue,o=t=>Wh(this.syncEngine,t,0),u=Sh.D()?new Sh:new tf,new uf(n,s,i,o,u);var n,s,i,o,u}createSyncEngine(e,t){return function(s,i,o,u,h,m,g){const x=new Rf(s,i,o,u,h,m);return g&&(x.Qa=!0),x}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,l.A)(function*(){var t,n,s;yield(s=(0,l.A)(function*(o){const u=we(o);fe("RemoteStore","RemoteStore shutting down."),u.L_.add(5),yield Lr(u),u.k_.shutdown(),u.q_.set("Unknown")}),function i(o){return s.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}class Ki{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Ge("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ep{constructor(e,t,n,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Me.UNAUTHENTICATED,this.clientId=j.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var o=(0,l.A)(function*(u){fe("FirestoreClient","Received user=",u.uid),yield i.authCredentialListener(u),i.user=u});return function(u){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(n,o=>(fe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new me($.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,l.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const s=qr(n,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Yi(r,e){return Pl.apply(this,arguments)}function Pl(){return Pl=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),fe("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var s=(0,l.A)(function*(i){n.isEqual(i)||(yield yh(e.localStore,i),n=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Pl.apply(this,arguments)}function kl(r,e){return Ml.apply(this,arguments)}function Ml(){return(Ml=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function Dl(r){return Fl.apply(this,arguments)}(r);fe("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Fh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Fh(e.remoteStore,s)),r._onlineComponents=e})).apply(this,arguments)}function Fl(){return(Fl=(0,l.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){fe("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Yi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Jh(r){return"FirebaseError"===r.name?r.code===$.FAILED_PRECONDITION||r.code===$.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}(t))throw t;he("Error using user provided cache. Falling back to memory cache: "+t),yield Yi(r,new Qr)}}else fe("FirestoreClient","Using default OfflineComponentProvider"),yield Yi(r,new Qr);return r._offlineComponents})).apply(this,arguments)}function Qi(r){return Vl.apply(this,arguments)}function Vl(){return(Vl=(0,l.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(fe("FirestoreClient","Using user provided OnlineComponentProvider"),yield kl(r,r._uninitializedComponentsProvider._online)):(fe("FirestoreClient","Using default OnlineComponentProvider"),yield kl(r,new Xr))),r._onlineComponents})).apply(this,arguments)}function Jr(r){return Nl.apply(this,arguments)}function Nl(){return(Nl=(0,l.A)(function*(r){const e=yield Qi(r),t=e.eventManager;return t.onListen=Of.bind(null,e.syncEngine),t.onUnlisten=kf.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Pf.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Mf.bind(null,e.syncEngine),t})).apply(this,arguments)}function sd(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const id=new Map;function zl(r,e,t){if(!t)throw new me($.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function od(r){if(!te.isDocumentKey(r))throw new me($.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ad(r){if(te.isDocumentKey(r))throw new me($.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Xi(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":Q()}function pt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new me($.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xi(r);throw new me($.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class cd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new me($.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new me($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function dp(r,e,t,n){if(!0===e&&!0===n)throw new me($.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=sd(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new me($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new me($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new me($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Fs{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new me($.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new me($.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cd(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new nt;switch(n.type){case"firstParty":return new Je(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new me($.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=id.get(t);n&&(fe("ComponentProvider","Removing Datastore"),id.delete(t),n.terminate())}(this),Promise.resolve()}}class Xt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Xt(this.firestore,e,this._query)}}class Gt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gt(this.firestore,e,this._key)}}class bn extends Xt{constructor(e,t,n){super(e,t,Ar(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gt(this.firestore,null,new te(e))}withConverter(e){return new bn(this.firestore,e,this._path)}}function Vs(r,e,...t){if(r=(0,H.Ku)(r),zl("collection","path",e),r instanceof Fs){const n=Re.fromString(e,...t);return ad(n),new bn(r,null,n)}{if(!(r instanceof Gt||r instanceof bn))throw new me($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Re.fromString(e,...t));return ad(n),new bn(r.firestore,null,n)}}function Zr(r,e,...t){if(r=(0,H.Ku)(r),1===arguments.length&&(e=j.newId()),zl("doc","path",e),r instanceof Fs){const n=Re.fromString(e,...t);return od(n),new Gt(r,null,new te(n))}{if(!(r instanceof Gt||r instanceof bn))throw new me($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Re.fromString(e,...t));return od(n),new Gt(r.firestore,r instanceof bn?r.converter:null,new te(n))}}class mp{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Oa(this,"async_queue_retry"),this.Eu=()=>{const t=Ui();t&&fe("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=Ui();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=Ui();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new lt;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,l.A)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!ut(t))throw t;fe("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,Ge("INTERNAL UNHANDLED ERROR: ",function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),u}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const s=Qa.createAndSchedule(this,e,t,n,i=>this.Vu(i));return this.lu.push(s),s}du(){this.hu&&Q()}verifyOperationInProgress(){}mu(){var e=this;return(0,l.A)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function Bl(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const s=t;for(const i of["next","error","complete"])if(i in s&&"function"==typeof s[i])return!0;return!1}(r)}class St extends Fs{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new mp,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||hd(this),this._firestoreClient.terminate()}}function Ll(r,e){const t="object"==typeof r?r:(0,_.getApp)(),n="string"==typeof r?r:e||"(default)",s=(0,_._getProvider)(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=(0,H.yU)("firestore");i&&function _p(r,e,t,n={}){var s;const i=(r=pt(r,Fs))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&he("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let u,h;if("string"==typeof n.mockUserToken)u=n.mockUserToken,h=Me.MOCK_USER;else{u=(0,H.Fy)(n.mockUserToken,null===(s=r._app)||void 0===s?void 0:s.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new me($.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Me(m)}r._authCredentials=new Et(new Dt(u,h))}}(s,...i)}return s}function Ft(r){return r._firestoreClient||hd(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function hd(r){var e,t,n;const s=r._freezeSettings(),i=(h=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new N_(r._databaseId,h,r._persistenceKey,(g=s).host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,sd(g.experimentalLongPollingOptions),g.useFetchStreams));var h,g;r._firestoreClient=new ep(r._authCredentials,r._appCheckCredentials,r._queue,i),null!==(t=s.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=s.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class mr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new mr(Nt.fromBase64String(e))}catch(t){throw new me($.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new mr(Nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class fr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new me($.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class es{constructor(e){this._methodName=e}}class Gl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new me($.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new me($.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return C(this._lat,e._lat)||C(this._long,e._long)}}class Hi{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,e._values)}}const yp=/^__.*__$/;class vp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Pn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pr(e,this.data,t,this.fieldTransforms)}}function fd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Q()}}class Ji{constructor(e,t,n,s,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.yu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new Ji(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.vu(e),s}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.yu(),s}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return to(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if(fd(this.wu)&&yp.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class wp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ms(e)}Nu(e,t,n,s=!1){return new Ji({wu:e,methodName:t,Ou:n,path:st.emptyPath(),Du:!1,xu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pr(r){const e=r._freezeSettings(),t=Ms(r._databaseId);return new wp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Zi(r,e,t,n,s,i={}){const o=r.Nu(i.merge||i.mergeFields?2:0,e,t,s);Ql("Data must be an object, but it was:",o,n);const u=yd(n,o);let h,m;if(i.merge)h=new un(o.fieldMask),m=o.fieldTransforms;else if(i.mergeFields){const g=[];for(const x of i.mergeFields){const R=zs(e,x,t);if(!o.contains(R))throw new me($.INVALID_ARGUMENT,`Field '${R}' is specified in your field mask but missing from your input data.`);wd(g,R)||g.push(R)}h=new un(g),m=o.fieldTransforms.filter(x=>h.covers(x.field))}else h=null,m=o.fieldTransforms;return new vp(new Qt(u),h,m)}function gr(r,e){if(vd(r=(0,H.Ku)(r)))return Ql("Unsupported field value:",e,r),yd(r,e);if(r instanceof es)return function(n,s){if(!fd(s.wu))throw s.Mu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Mu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,s){const i=[];let o=0;for(const u of n){let h=gr(u,s.Fu(o));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,s){if(null===(n=(0,H.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return iu(s.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const i=Te.fromDate(n);return{timestampValue:Mr(s.serializer,i)}}if(n instanceof Te){const i=new Te(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Mr(s.serializer,i)}}if(n instanceof Gl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof mr)return{bytesValue:Su(s.serializer,n._byteString)};if(n instanceof Gt){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:sa(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Hi)return u=s,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(h=>{if("number"!=typeof h)throw u.Mu("VectorValues must only contain numeric values.");return Ho(u.serializer,h)})}}}}};var u;throw s.Mu(`Unsupported field value: ${Xi(n)}`)}(r,e)}function yd(r,e){const t={};return Ec(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jt(r,(n,s)=>{const i=gr(s,e.bu(n));null!=i&&(t[n]=i)}),{mapValue:{fields:t}}}function vd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Te||r instanceof Gl||r instanceof mr||r instanceof Gt||r instanceof es||r instanceof Hi)}function Ql(r,e,t){if(!vd(t)||"object"!=typeof(s=t)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){const n=Xi(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var s}function zs(r,e,t){if((e=(0,H.Ku)(e))instanceof fr)return e._internalPath;if("string"==typeof e)return eo(r,e);throw to("Field path arguments must be of type string or ",r,!1,void 0,t)}const xp=new RegExp("[~\\*/\\[\\]]");function eo(r,e,t){if(e.search(xp)>=0)throw to(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new fr(...e.split("."))._internalPath}catch{throw to(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function to(r,e,t,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${n}`),o&&(h+=` in document ${s}`),h+=")"),new me($.INVALID_ARGUMENT,u+r+h)}function wd(r,e){return r.some(t=>t.isEqual(e))}class Bs{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Gt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Tp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Tp extends Bs{data(){return super.data()}}function no(r,e){return"string"==typeof e?eo(r,e):e instanceof fr?e._internalPath:e._delegate._internalPath}function xd(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new me($.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xl{}class Ls extends Xl{}function Td(r,e,...t){let n=[];e instanceof Xl&&n.push(e),n=n.concat(t),function(i){const o=i.filter(h=>h instanceof ts).length,u=i.filter(h=>h instanceof Gs).length;if(o>1||o>0&&u>0)throw new me($.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class Gs extends Ls{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Gs(e,t,n)}_apply(e){const t=this._parse(e);return Sd(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t))}_parse(e){const t=pr(e.firestore);return function(i,o,u,h,m,g,x){let R;if(m.isKeyField()){if("array-contains"===g||"array-contains-any"===g)throw new me($.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if("in"===g||"not-in"===g){Ad(x,g);const Z=[];for(const Ie of x)Z.push(Ed(h,i,Ie));R={arrayValue:{values:Z}}}else R=Ed(h,i,x)}else"in"!==g&&"not-in"!==g&&"array-contains-any"!==g||Ad(x,g),R=function gd(r,e,t,n=!1){return gr(t,r.Nu(n?4:3,e))}(u,"where",x,"in"===g||"not-in"===g);return yt.create(m,g,R)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function bd(r,e,t){const n=e,s=no("where",r);return Gs._create(s,n,t)}class ts extends Xl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ts(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:It.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(s,i){let o=s;const u=i.getFlattenedFilters();for(const h of u)Sd(o,h),o=Qo(o,h)}(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ed(r,e,t){if("string"==typeof(t=(0,H.Ku)(t))){if(""===t)throw new me($.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yo(e)&&-1!==t.indexOf("/"))throw new me($.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Re.fromString(t));if(!te.isDocumentKey(n))throw new me($.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rr(r,new te(n))}if(t instanceof Gt)return rr(r,t._key);throw new me($.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xi(t)}.`)}function Ad(r,e){if(!Array.isArray(r)||0===r.length)throw new me($.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Sd(r,e){const t=function(s,i){for(const o of s)for(const u of o.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new me($.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Rd{convertValue(e,t="none"){switch(Bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Cn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Q()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return jt(e,(s,i)=>{n[s]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,s;const i=null===(s=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map(o=>kt(o.doubleValue));return new Hi(i)}convertGeoPoint(e){return new Gl(kt(e.latitude),kt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=fi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cs(e));default:return null}}convertTimestamp(e){const t=Sn(e);return new Te(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Re.fromString(e);se(zu(n));const s=new nr(n.get(1),n.get(3)),i=new te(n.popFirst(5));return s.isEqual(t)||Ge(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class yr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ns extends Bs{constructor(e,t,n,s,i,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ao(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ao extends ns{data(e={}){return super.data(e)}}class rs{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new yr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ao(this._firestore,this._userDataWriter,n.key,n,new yr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new me($.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(u=>({type:"added",doc:new ao(s._firestore,s._userDataWriter,u.doc.key,u.doc,new yr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:o++}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const h=new ao(s._firestore,s._userDataWriter,u.doc.key,u.doc,new yr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let m=-1,g=-1;return 0!==u.type&&(m=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),g=o.indexOf(u.doc.key)),{type:Ep(u.type),doc:h,oldIndex:m,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ep(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Q()}}class Qn extends Rd{constructor(e){super(),this.firestore=e}convertBytes(e){return new mr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Gt(this.firestore,null,t)}}function Od(r){r=pt(r,Xt);const e=pt(r.firestore,St),t=Ft(e),n=new Qn(e);return xd(r._query),function rd(r,e,t={}){const n=new lt;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,m){const g=new Ki({next:R=>{o.enqueueAndForget(()=>Ja(i,x)),R.fromCache&&"server"===h.source?m.reject(new me($.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(R)},error:R=>m.reject(R)}),x=new nl(u,g,{includeMetadataChanges:!0,_a:!0});return Xa(i,x)}(yield Jr(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(s=>new rs(e,n,r,s))}function Pd(r,e,t){r=pt(r,Gt);const n=pt(r.firestore,St),s=function oo(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return Us(n,[Zi(pr(n),"setDoc",r._key,s,null!==r.converter,t).toMutation(r._key,Mt.none())])}function lo(r,...e){var t,n,s;r=(0,H.Ku)(r);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Bl(e[o])||(i=e[o],o++);const u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Bl(e[o])){const x=e[o];e[o]=null===(t=x.next)||void 0===t?void 0:t.bind(x),e[o+1]=null===(n=x.error)||void 0===n?void 0:n.bind(x),e[o+2]=null===(s=x.complete)||void 0===s?void 0:s.bind(x)}let h,m,g;if(r instanceof Gt)m=pt(r.firestore,St),g=Ar(r._key.path),h={next:x=>{e[o]&&e[o](Jl(m,r,x))},error:e[o+1],complete:e[o+2]};else{const x=pt(r,Xt);m=pt(x.firestore,St),g=x._query;const R=new Qn(m);h={next:Z=>{e[o]&&e[o](new rs(m,R,x,Z))},error:e[o+1],complete:e[o+2]},xd(r._query)}return function(R,Z,Ie,De){const Oe=new Ki(De),He=new nl(Z,Oe,Ie);return R.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Xa(yield Jr(R),He)})),()=>{Oe.za(),R.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Ja(yield Jr(R),He)}))}}(Ft(m),g,u,h)}function Us(r,e){return function(n,s){const i=new lt;return n.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function Df(r,e,t){return ul.apply(this,arguments)}(yield function jl(r){return Qi(r).then(e=>e.syncEngine)}(n),s,i)})),i.promise}(Ft(r),e)}function Jl(r,e,t){const n=t.docs.get(e._key),s=new Qn(r);return new ns(r,s,e._key,n,new yr(t.hasPendingWrites,t.fromCache),e.converter)}!function(e,t=!0){Ce=_.SDK_VERSION,(0,_._registerComponent)(new w.uA("firestore",(n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),u=new St(new Ye(n.getProvider("auth-internal")),new K(n.getProvider("app-check-internal")),function(m,g){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new me($.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nr(m.options.projectId,g)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,_.registerVersion)(ue,"4.7.2",e),(0,_.registerVersion)(ue,"4.7.2","esm2017")}();var qt=v(51698),Fd=v(43234),uo=v(48891),Bp=v(30531),Lp=v(36484),Gp=v(62095);let Up=(()=>{var r;class e{examSessions_read(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=yield s._getDocument(u.data,"exam_sessions/"+n,s.getUserId());i.next({success:1,data:h,message:"successful"}),i.complete()}catch(g){console.log(g),i.next({success:0,data:"",message:""+g}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_write(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var m=yield i._saveDocument(h.data,"exam_sessions/"+n,i.getUserId(),s);o.next({success:1,data:m,message:"successful"}),o.complete()}catch(x){console.log(x),o.next({success:0,data:"",message:""+x}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_writeUserMap(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success&&h.data)try{var m=yield i._saveDocumentMerge(h.data,"exam_sessions/"+n,"user_map",s);o.next({success:1,data:m,message:"successful"}),o.complete()}catch(x){console.log(x),o.next({success:0,data:"",message:""+x}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_delete(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{yield s._removeDocument(u.data,"exam_sessions/"+n,s.getUserId()),i.next({success:1,data:"",message:"successful"}),i.complete()}catch(m){console.log(m),i.next({success:0,data:"",message:""+m}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribeUserMap(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,"user_map",x=>{i.next({success:1,data:x,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(x){console.log(x),i.next({success:0,data:void 0,message:""+x}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,s.getUserId(),x=>{i.next({success:1,data:x,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(x){console.log(x),i.next({success:0,data:void 0,message:""+x}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_unsubscribe(n){this.removeAllunsubscribe("exam_sessions_"+n)}examSessions_subscribeWithQuery(n,s){var i=this;return new qt.c(s&&3==s.length?o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var m=i.myOnSnapshotCollectionWithQuery(h.data,"exam_sessions/"+n,s,R=>{o.next({success:1,data:R,message:"successful"}),o.complete()});i.addUnsubscribe("exam_sessions_"+n,m)}catch(R){console.log(R),o.next({success:0,data:void 0,message:""+R}),o.complete()}else o.next({success:0,data:void 0,message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())}:o=>{o.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),o.complete(),o.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshotCollection(u.data,"exam_live_teachers/"+n,m=>{i.next({success:1,data:m})});s.addUnsubscribe("exam_live_teachers_"+n,h)}catch(m){console.log(m),i.next({success:0,message:"EXCEPTION",ex:m.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_teachers_"+n)}examLiveTeachers_teacher_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var m=yield i._saveDocument(h.data,"exam_live_teachers/"+n,i.getUserId(),s);o.next({success:1,data:m})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var m=yield i._getDocuments(h.data,"exam_lives/"+n,s);o.next({success:1,data:m})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_live_students/"+n,s.getUserId(),m=>{i.next({success:1,data:m})});s.addUnsubscribe("exam_live_students_"+n,h)}catch(m){console.log(m),i.next({success:0,message:"EXCEPTION",ex:m.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_teacher_subscribe(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var m=i.myOnSnapshot(h.data,"exam_live_students/"+n,s,g=>{o.next({success:1,data:g})});i.addUnsubscribe("exam_live_students_"+n,m)}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_student_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var m=yield i._saveDocument(h.data,"exam_live_students/"+n,i.getUserId(),s);o.next({success:1,data:m})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(n,s,i){var o=this;return new qt.c(u=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var h=(0,l.A)(function*(m){if(m&&1==m.success)try{var g=yield o._saveDocumentMerge(m.data,"exam_live_students/"+n,s,i);u.next({success:1,data:g})}catch(x){console.log(x),u.next({success:0,message:"EXCEPTION",ex:x.toString()})}else u.next(m)});return function(m){return h.apply(this,arguments)}}())})}getFirestoreDb(n){return new qt.c(s=>{var i=this.createFirestoreKey("firestore_db"),o=this.getLocalFirestoreDb(i);null!=o&&0==n?(s.next({success:1,data:o,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(h=>{h&&1==h.success?(0,c.p)(this.getAuthApp(),h?.data?.token??"").then(()=>{var g=Ll(this.app);this.setLocalFirestoreDb(i,g),s.next({success:1,data:g,message:"successful"}),s.complete()}).catch(g=>{"auth/invalid-custom-token"===g.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:h.message??""}),s.complete())})})}getFirestoreDbForStudentExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_student_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(s).subscribe(m=>{m&&1==m.success?(0,c.p)(this.getAuthApp(),m?.data?.token??"").then(()=>{var x=Ll(this.app);this.setLocalFirestoreDb(o,x),i.next({success:1,data:x,message:"successful"}),i.complete()}).catch(x=>{"auth/invalid-custom-token"===x.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:m.message??""}),i.complete())})})}getFirestoreDbForTeacherExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_teacher_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(s).subscribe(m=>{m&&1==m.success?(0,c.p)(this.getAuthApp(),m?.data?.token??"").then(()=>{var x=Ll(this.app);this.setLocalFirestoreDb(o,x),i.next({success:1,data:x,message:"successful"}),i.complete()}).catch(x=>{"auth/invalid-custom-token"===x.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:m.message??""}),i.complete())})})}signInUserByToken(n){return new qt.c(s=>{(0,c.p)(this.getAuthApp(),n).then(()=>{s.next({success:1,data:"",message:"successful"}),s.complete()}).catch(i=>{"auth/invalid-custom-token"===i.code?(s.next({success:0,data:"",message:"EXPIRED"}),s.complete()):(s.next({success:0,data:"",message:"AUTH_ERROR"}),s.complete())})})}setLocalFirestoreDb(n,s){this.firestoreDbs[n]=s}getLocalFirestoreDb(n){if(this.firestoreDbs.hasOwnProperty(n))return this.firestoreDbs[n]}removeLocalFirestoreDb(n){this.firestoreDbs.hasOwnProperty(n)&&delete this.firestoreDbs[n]}createFirestoreKey(n){return this.userService.getUserObj().id+"_"+n}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(n,s){n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)||(this.listSubscribers[n]=[]),this.listSubscribers[n].push(s)}removeAllunsubscribe(n){if(n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)){for(var s=0;s<this.listSubscribers[n].length;s++)this.listSubscribers[n][s]();delete this.listSubscribers[n]}}_saveDocument(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield Pd(Zr(n,s,i),u.commonSerivce.myClone(o)),i})()}_saveDocumentMerge(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield Pd(Zr(n,s,i),u.commonSerivce.myClone(o),{merge:!0}),i})()}_getCollection(n,s){var i=this;return(0,l.A)(function*(){s=i.getBaseFirestore()+"/"+s;const o=Vs(n,s);return(yield Od(o)).docs.map(m=>m.data())})()}_getDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s;const u=Zr(n,s,i),h=yield function Ap(r){r=pt(r,Gt);const e=pt(r.firestore,St);return function nd(r,e,t={}){const n=new lt;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,m){const g=new Ki({next:R=>{o.enqueueAndForget(()=>Ja(i,x));const Z=R.docs.has(u);!Z&&R.fromCache?m.reject(new me($.UNAVAILABLE,"Failed to get document because the client is offline.")):Z&&R.fromCache&&h&&"server"===h.source?m.reject(new me($.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(R)},error:R=>m.reject(R)}),x=new nl(Ar(u.path),g,{includeMetadataChanges:!0,_a:!0});return Xa(i,x)}(yield Jr(r),r.asyncQueue,e,t,n)})),n.promise}(Ft(e),r._key).then(t=>Jl(e,r,t))}(u);return h.exists()?h.data():null})()}_getDocuments(n,s,i){var o=this;return(0,l.A)(function*(){var u={};s=o.getBaseFirestore()+"/"+s;const h=Td(Vs(n,s),bd(function gp(){return new fr("__name__")}(),"in",i));return(yield Od(h)).forEach(g=>{u[g.id]=g.data()}),u})()}_removeDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s,yield function Sp(r){return Us(pt(r.firestore,St),[new kr(r._key,Mt.none())])}(Zr(n,s,i))})()}myOnSnapshot(n,s,i,o){return lo(Zr(n,s=this.getBaseFirestore()+"/"+s,i),h=>{o(h.data())})}myOnSnapshotCollection(n,s,i){return lo(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var m=[];h.forEach(g=>{m.push(g.data())}),i(m)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(n,s,i){return lo(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var m=[];h.docChanges().forEach(g=>{m.push(g.doc.data())}),i(m)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(n,s,i,o){return lo(Td(Vs(n,s=this.getBaseFirestore()+"/"+s),bd(i[0],i[1],i[2])),function(){var m=(0,l.A)(function*(g){var x=[];g.docChanges().forEach(R=>{x.push(R.doc.data())}),o(x)});return function(g){return m.apply(this,arguments)}}())}getBaseFirestore(){return Fd.c.firestoreBase}getInitApp(){return this.app}getAuthApp(){return(0,c.xI)(this.app)}constructor(n,s,i){this.firestoreServiceApi=n,this.userService=s,this.commonSerivce=i,this.firestoreDbs={},this.listSubscribers={},this.app=(0,f.Wp)(Fd.c.firestoreConfig_app1,"firestoreapp")}}return(r=e).\u0275fac=function(n){return new(n||r)(uo.KVO(Bp.B),uo.KVO(Lp.R),uo.KVO(Gp.R))},r.\u0275prov=uo.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},69666:(vt,Pe,v)=>{function l(){return typeof aztExam<"u"?aztExam:void 0}v.d(Pe,{J:()=>H});var f=v(43234),c=v(48891),_=v(36484),w=v(42802),S=v(38566);let H=(()=>{var y;class oe{monitorAtTeacherDashboard(k){try{let ie=l();if(typeof ie>"u"||!ie||!ie.showMonitorTeacher)return;ie.ver=this.monitorService.getMNoteVer();var N=this.userService.getUserObj();ie.showMonitorTeacher({user:{token:N.rememberToken,userid:N.id,username:N.fullName},config:{domainApi:f.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live",urlExamResultGetLastExamResultOfStudentId:"ExamLivestream/GetLastExamResultOfStudentId"},roomid:k.roomId,examid:k.examId,userlist:k.userList,examconfig:k.examConfig,firebaseApp:this.fireStoreService,filetypeStr:k.fileTypeStr})}catch(ie){console.log(ie)}}monitorAtStudentDashboard(k,N){try{let ie=l();if(typeof ie>"u"||!ie)return;ie.ver=this.monitorService.getMNoteVer();var U=this.userService.getUserObj();ie.loadMonitor(()=>{if(!ie.MonitorStudent)return;var ze={user:{token:U.rememberToken,userid:U.id,username:U.fullName},config:{domainApi:f.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:k,element:"monitorScreen",examconfig:N,firebaseApp:this.fireStoreService,isStarted:!1};ie.MonitorStudent.getInstance().prepairSession(ze);let W=window.setInterval(()=>{let I=document.getElementById("monitorScreen");if(I){let J=I.getElementsByTagName("div")[0];J&&(J.setAttribute("class","mx-auto"),clearInterval(W))}},50)})}catch(ie){console.log(ie)}}monitorAtTestPage(k,N,U){let ie=l();if(typeof ie>"u"||!ie)return U(!1);var ze=this.userService.getUserObj(),re=N;ie.ver=this.monitorService.getMNoteVer(),ie.loadMonitor(()=>{if(!ie.MonitorStudent)return U(!1);var W={user:{token:ze.rememberToken,userid:ze.id,username:ze.fullName,studentid:re?re.id:0,studentname:re?re.fullName:null},config:{domainApi:f.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:k.roomId,element:"monitorScreenTakeTest",examconfig:k.examConfig,examid:k.examId,firebaseApp:this.fireStoreService,resultid:k.resultId,isStarted:!0,clickFromIframeFunc:()=>{},clickFromIframeFuncCaller:this};ie.MonitorStudent.getInstance().startSession(W),U(!0)})}destroyMonitorAtStudentDashboard(){try{let N=l();if(typeof N>"u"||!N||!N.MonitorStudent)return;N.MonitorStudent.getInstance().stopSession()}catch(N){console.log(N)}}constructor(k,N,U){this.userService=k,this.monitorService=N,this.fireStoreService=U}}return(y=oe).\u0275fac=function(k){return new(k||y)(c.KVO(_.R),c.KVO(w.Q),c.KVO(S.s))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),oe})()},42802:(vt,Pe,v)=>{v.d(Pe,{Q:()=>c});var l=v(48891),f=v(55465);let c=(()=>{var _;class w{constructor(H){this.envService=H}getTmpVersionMonitor(){var H=this.envService.getEnvValue("classliveUrl"),y="1.0";if(H){var oe=H.split("=");oe.length>1&&(y=oe[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+y}getMNoteVer(){var H=this.envService.getEnvValue("classliveUrl"),y="1.0";if(H){var oe=H.split("=");oe.length>1&&(y=oe[1])}return y}checkValidForSetUpMonitor(){return!0}}return(_=w).\u0275fac=function(H){return new(H||_)(l.KVO(f.t))},_.\u0275prov=l.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),w})()},51935:(vt,Pe,v)=>{v.d(Pe,{h:()=>st});var l=v(91478),f=v(89163),c=v(33887),_=v(48891),w=v(54460),S=v(2915),H=v(15343),y=v(76975);const oe=()=>({"mr-2":!0});function G(te,We){if(1&te&&(_.j41(0,"li"),_.EFF(1),_.k0s()),2&te){const Ue=We.$implicit;_.R7$(),_.SpI("* ",Ue.message,"")}}function k(te,We){1&te&&(_.j41(0,"span",8),_.EFF(1),_.nI1(2,"mytranslate"),_.j41(3,"span",9),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.EFF(6),_.nI1(7,"mytranslate"),_.nI1(8,"mytranslate"),_.k0s()),2&te&&(_.R7$(),_.SpI(" ",_.bMT(2,4,"lang_auto_click")," "),_.R7$(3),_.SpI('"',_.bMT(5,6,"lang_auto_tai_ve"),'"'),_.R7$(2),_.Lme(" ",_.bMT(7,8,"lang_auto_de_tai_ve")," ",_.bMT(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function N(te,We){if(1&te){const Ue=_.RV6();_.j41(0,"button",17),_.bIt("click",function(){_.eBV(Ue);const B=_.XpG();return _.Njj(B.onPressTrue())}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&te&&(_.R7$(),_.SpI(" ",_.bMT(2,1,"lang_auto_tai_ve")," "))}let U=(()=>{var te;class We extends c._{onPressTrue(){this.dialogRef.close(!0)}constructor(E,B){super(E,B),this.data=E,this.dialogRef=B,this.result=E.result}}return(te=We).\u0275fac=function(E){return new(E||te)(_.rXU(f.Vh),_.rXU(f.CP,8))},te.\u0275cmp=_.VBU({type:te,selectors:[["app-push-error-student-export-docx"]],features:[_.Vt3],decls:30,vars:25,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16",3,"ngClass"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(E,B){1&E&&(_.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",4)(7,"a",5),_.nrm(8,"lucide-icon",6),_.k0s()()(),_.j41(9,"div",7)(10,"span",8),_.EFF(11),_.nI1(12,"mytranslate"),_.j41(13,"span",9),_.EFF(14),_.k0s(),_.EFF(15),_.nI1(16,"mytranslate"),_.nI1(17,"lowercase"),_.k0s(),_.j41(18,"span",8),_.EFF(19),_.nI1(20,"mytranslate"),_.k0s(),_.j41(21,"azt-mat-dialog-content",10)(22,"ul",11),_.DNE(23,G,2,1,"li",12),_.k0s()(),_.DNE(24,k,9,12,"span",13),_.k0s(),_.j41(25,"div",14)(26,"a",15),_.EFF(27),_.nI1(28,"mytranslate"),_.k0s(),_.DNE(29,N,3,3,"button",16),_.k0s()()()),2&E&&(_.R7$(4),_.JRh(_.bMT(5,12,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),_.R7$(4),_.Y8G("ngClass",_.lJ4(24,oe)),_.R7$(3),_.SpI(" ",_.bMT(12,14,"lang_auto_he_thong_tao_thanh_cong_cho")," "),_.R7$(3),_.Lme("",B.result.datas.length,"/",B.result.errs.length+B.result.datas.length,""),_.R7$(),_.SpI(" ",_.bMT(17,18,_.bMT(16,16,"lang_auto_hoc_sinh"))," "),_.R7$(4),_.SpI(" ",_.bMT(20,20,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),_.R7$(2),_.Y8G("defaultHeight",60),_.R7$(2),_.Y8G("ngForOf",B.result.errs),_.R7$(),_.Y8G("ngIf",B.result.datas.length>0),_.R7$(3),_.SpI(" ",_.bMT(28,22,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("ngIf",B.result.datas.length>0))},dependencies:[w.YU,w.Sq,w.bT,f.tx,S.U,H.WGl,w.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),We})();var ie=v(10936),ze=v(65080),re=v(68774),W=v(47712),I=v(5502),J=v(81587),ye=v(90796),xe=v(69135),Ee=v(14987);const ue=(te,We)=>({"box-classrooms":te,"box-max-classrooms":We});function Me(te,We){if(1&te&&(_.j41(0,"span",31),_.EFF(1),_.k0s()),2&te){let Ue;const E=_.XpG();_.R7$(),_.JRh(null!==(Ue=null==E.studentsInClassResults[0].classObj?null:E.studentsInClassResults[0].classObj.name)&&void 0!==Ue?Ue:"")}}function Ce(te,We){if(1&te&&(_.j41(0,"div",36)(1,"div",18),_.nrm(2,"input",37),_.j41(3,"label",38,0),_.EFF(5),_.k0s()()()),2&te){let Ue;const E=We.$implicit,B=_.sdS(4),z=_.XpG(2);_.Y8G("hidden",1===z.studentsInClassResults.length),_.R7$(2),_.Mz_("id","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),_.Y8G("value",null==E.classObj?null:E.classObj.id),_.R7$(),_.Mz_("for","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),_.Y8G("matTooltip",null!==(Ue=null==E.classObj?null:E.classObj.name)&&void 0!==Ue?Ue:"")("isDisabledTooltip",!1)("matTooltipDisabled",B.isDisabled),_.R7$(2),_.JRh(null==E.classObj?null:E.classObj.name)}}function Xe(te,We){if(1&te&&(_.j41(0,"div",32)(1,"ng-scrollbar",33)(2,"div",34),_.DNE(3,Ce,6,10,"div",35),_.k0s()()()),2&te){const Ue=_.XpG();_.Y8G("ngClass",_.l_i(3,ue,Ue.form.controls.listStudents.controls.length>21||Ue.studentsInClassResults.length>18,Ue.form.controls.listStudents.controls.length<=21&&Ue.studentsInClassResults.length>18)),_.R7$(),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",Ue.studentsInClassResults)}}function Fe(te,We){if(1&te&&(_.j41(0,"label",38,0),_.EFF(2),_.k0s()),2&te){const Ue=_.sdS(1),E=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",E.controls.id.value,""),_.Y8G("matTooltip",E.controls.label.value)("isDisabledTooltip",!1)("matTooltipDisabled",Ue.isDisabled),_.R7$(2),_.SpI(" ",E.controls.label.value," ")}}function mt(te,We){if(1&te&&(_.j41(0,"label",44),_.nrm(1,"img",45),_.k0s()),2&te){const Ue=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",Ue.controls.id.value,""),_.R7$(),_.Y8G("nameImages",Ue.controls.nameImages.value)}}function fe(te,We){if(1&te){const Ue=_.RV6();_.j41(0,"div",39)(1,"div",40)(2,"input",41),_.bIt("change",function(){_.eBV(Ue);const B=_.XpG();return _.Njj(B.onChangeStudentOption())}),_.k0s(),_.DNE(3,Fe,3,6,"label",42)(4,mt,2,3,"label",43),_.k0s()()}if(2&te){const Ue=We.$implicit;_.R7$(),_.Y8G("formGroup",Ue),_.R7$(),_.Mz_("id","select-classroom-export__",Ue.controls.id.value,""),_.R7$(),_.Y8G("ngIf",Ue.controls.label.value||!Ue.controls.isImage.value),_.R7$(),_.Y8G("ngIf",!Ue.controls.label.value&&Ue.controls.isImage.value&&Ue.controls.nameImages.value)}}function Ge(te,We){1&te&&(_.j41(0,"span",27),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&te&&(_.R7$(),_.SpI("* ",_.bMT(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function he(te,We){if(1&te){const Ue=_.RV6();_.j41(0,"div",49),_.bIt("click",function(){_.eBV(Ue);const B=_.XpG(2);return _.Njj(B.showAskInfo=!0)}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&te&&(_.R7$(),_.SpI("+ ",_.bMT(2,1,"lang_testbank_test_config_add_information"),""))}function Ke(te,We){if(1&te&&(_.j41(0,"div"),_.nrm(1,"add-info-print",50),_.k0s()),2&te){const Ue=_.XpG(2);_.R7$(),_.Y8G("form",Ue.form)}}function Q(te,We){1&te&&(_.j41(0,"span",53),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&te&&(_.R7$(),_.SpI("(",_.bMT(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function se(te,We){if(1&te){const Ue=_.RV6();_.j41(0,"div",51),_.bIt("click",function(){_.eBV(Ue);const B=_.XpG(2);return _.Njj(B.showAskInfo=!1)}),_.EFF(1),_.nI1(2,"mytranslate"),_.nI1(3,"mytranslate"),_.nI1(4,"lowercase"),_.DNE(5,Q,3,3,"span",52),_.k0s()}if(2&te){const Ue=_.XpG(2);_.R7$(),_.Lme(" ",_.bMT(2,3,"lang_auto_huy")," ",_.bMT(4,7,_.bMT(3,5,"lang_testbank_test_config_add_information"))," "),_.R7$(4),_.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo)}}function Be(te,We){if(1&te&&(_.j41(0,"div")(1,"span",46),_.EFF(2),_.nI1(3,"mytranslate"),_.k0s(),_.DNE(4,he,3,3,"div",47)(5,Ke,2,1,"div",26)(6,se,6,9,"div",48),_.k0s()),2&te){const Ue=_.XpG();_.R7$(2),_.Lme("* ",_.bMT(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",Ue.countStudentSelect,""),_.R7$(2),_.Y8G("ngIf",Ue.isAskInfo&&!Ue.showAskInfo),_.R7$(),_.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo),_.R7$(),_.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo)}}function we(te,We){1&te&&(_.j41(0,"div")(1,"div",15)(2,"span",27),_.EFF(3),_.nI1(4,"mytranslate"),_.k0s()()()),2&te&&(_.R7$(3),_.SpI("* ",_.bMT(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let $=(()=>{var te;class We extends c._{confirmAction(){const E=this.form.value,B=this.studentsInClassResults.find(z=>z.classObj?.id===E.classId);if(B){const z=E.listStudents?.filter(L=>L.choose).map(L=>L.id);B.results=B.results?.filter(L=>z?.includes(L.reId)),B.schoolName=this.showAskInfo?E.schoolName:void 0,B.subjectName=this.showAskInfo?E.subjectName:void 0,this.dialogRef.close(B)}else this.dialogRef.close()}setChangeSelectAll(){const E=this.form.controls.selectAll;if(E){E.setValue(!E.value);const B=this.form.controls.listStudents;B&&B.controls.forEach(z=>{z.controls.choose.setValue(E.value)}),this.countStudentSelect=E.value?B.controls.length:0}}onChangeStudentOption(){const E=this.form.controls.listStudents;let B=!0,z=0;E&&E.controls.forEach(_e=>{!1===_e.controls.choose.value?B=!1:z++});const L=this.form.controls.selectAll;L&&L.setValue(B),this.countStudentSelect=z}setupArrayStudent(E){this.currNameClass=E.classObj?.name??"";const B=this.form.controls.listStudents;if(B){B.clear();let z=E.results??[];if(void 0!==E.classObj?.sortType){let L=E.classObj?.sortType;z=0==L?this.sortService.sortFirstNameStudents(this.commonService.myClone(z)):99==L?this.sortService.sortTimeDESC(this.commonService.myClone(z)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone(z),"pos","id")}z.forEach(L=>{(L.confirmedAt||!this.data.examHasEssay&&1==L.status)&&B.push(new ie.gE({isImage:new ie.MJ(!!L.nameImages,{nonNullable:!0}),nameImages:new ie.MJ(L.nameImages,{nonNullable:!0}),label:new ie.MJ(L.fullName,{nonNullable:!0}),id:new ie.MJ(L.reId,{nonNullable:!0}),choose:new ie.MJ(!1,{nonNullable:!0})}))})}}classroomChange(E){this.setupArrayStudent(E)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let E=this.studentsInClassResults[0];this.form.controls.classId.setValue(E.classObj?.id),this.setupArrayStudent(E),this.form.controls.classId.valueChanges.subscribe(z=>{const L=this.form.controls.selectAll;L&&L.setValue(!1),this.countStudentSelect=0;const _e=this.studentsInClassResults.find(le=>le.classObj?.id===z);_e&&this.setupArrayStudent(_e)})}}constructor(E,B,z){super(B,z),this.sortService=E,this.data=B,this.dialogRef=z,this.studentsInClassResults=[],this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=B.isAskInfo,this.studentsInClassResults=B.studentsInClassResults.map(L=>({...L,results:L.results?.map(_e=>({..._e,reId:ze.P.generateIdRequired(10)}))})),this.form=new ie.gE({classId:new ie.MJ(0,{nonNullable:!0,validators:[ie.k0.required]}),selectAll:new ie.MJ(!1,{nonNullable:!0}),listStudents:new ie.Yp([]),schoolName:new ie.MJ("",{nonNullable:!0}),subjectName:new ie.MJ("",{nonNullable:!0})})}}return(te=We).\u0275fac=function(E){return new(E||te)(_.rXU(re.g),_.rXU(f.Vh),_.rXU(f.CP,8))},te.\u0275cmp=_.VBU({type:te,selectors:[["app-select-student-to-export-docx"]],features:[_.Vt3],decls:48,vars:35,consts:[["c","isDisabled"],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"change","checked"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"change","id"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(E,B){1&E&&(_.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",5)(7,"a",6),_.nrm(8,"lucide-icon",7),_.k0s()()(),_.j41(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11),_.EFF(13),_.nI1(14,"mytranslate"),_.DNE(15,Me,2,1,"span",12),_.k0s()(),_.DNE(16,Xe,4,6,"div",13),_.j41(17,"div",14)(18,"div",15)(19,"div",16),_.EFF(20),_.nI1(21,"mytranslate"),_.k0s()(),_.j41(22,"div",17)(23,"div",18)(24,"input",19),_.bIt("change",function(){return B.setChangeSelectAll()}),_.k0s(),_.j41(25,"label",20),_.EFF(26),_.nI1(27,"mytranslate"),_.k0s()()(),_.j41(28,"div",21)(29,"ng-scrollbar",22)(30,"div",23),_.DNE(31,fe,5,5,"div",24),_.k0s()()(),_.j41(32,"div",15),_.DNE(33,Ge,3,3,"span",25)(34,Be,7,7,"div",26),_.k0s()(),_.j41(35,"div",14)(36,"div",15)(37,"span",27),_.EFF(38),_.nI1(39,"mytranslate"),_.k0s()()()(),_.DNE(40,we,5,3,"div",26),_.k0s(),_.j41(41,"div",28)(42,"a",29),_.EFF(43),_.nI1(44,"mytranslate"),_.k0s(),_.j41(45,"button",30),_.bIt("click",function(){return B.confirmAction()}),_.EFF(46),_.nI1(47,"mytranslate"),_.k0s()()()()),2&E&&(_.R7$(4),_.JRh(_.bMT(5,21,"lang_testbank_what_to_export_select_students_export")),_.R7$(6),_.Y8G("formGroup",B.form)("hidden",0===B.studentsInClassResults.length),_.R7$(),_.Y8G("hidden",1===B.studentsInClassResults.length&&null==B.studentsInClassResults[0].classObj),_.R7$(2),_.SpI(" ",_.bMT(14,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),_.R7$(2),_.Y8G("ngIf",1===B.studentsInClassResults.length),_.R7$(),_.Y8G("ngIf",B.studentsInClassResults.length>1),_.R7$(),_.Y8G("hidden",0===B.form.controls.listStudents.controls.length),_.R7$(3),_.SpI("",_.bMT(21,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),_.R7$(4),_.Y8G("checked",B.form.controls.selectAll.value),_.R7$(2),_.JRh(_.bMT(27,27,"lang_auto_chon_tat_ca")),_.R7$(3),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",B.form.controls.listStudents.controls),_.R7$(2),_.Y8G("ngIf",0===B.countStudentSelect),_.R7$(),_.Y8G("ngIf",B.countStudentSelect>0),_.R7$(),_.Y8G("hidden",B.form.controls.listStudents.controls.length>0),_.R7$(3),_.SpI("* ",_.bMT(39,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),_.R7$(2),_.Y8G("ngIf",0===B.studentsInClassResults.length),_.R7$(3),_.SpI(" ",_.bMT(44,31,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("disabled",0===B.countStudentSelect),_.R7$(),_.SpI(" ",_.bMT(47,33,"lang_cms_common_confirm_btn")," "))},dependencies:[w.YU,w.Sq,w.bT,f.tx,W.oV,I.Yh,ie.qT,ie.me,ie.Zm,ie.Fm,ie.BC,ie.cb,ie.j4,ie.JD,ie.v8,J.t,ye.y,xe.f,Ee.i,H.WGl,w.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),We})();var me=v(5382),lt=v(64198),Dt=v(25539),nt=v(81234),Et=v(92229),Ye=v(50622),ft=v(91640),Je=v(41325),je=v(40949),K=v(51113),ae=v(53393),de=v(99927),j=v(99172),C=v(32639),M=v(62095),V=v(46134),Te=v(9280),ve=v(87515),Ze=v(10296),Re=v(46899),rt=v(32610);let st=(()=>{var te;class We{processHomeworks(E,B){return new Promise((z,L)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(B).subscribe(_e=>{if(1==_e.success){this.logger.remove();var le=[];_e.data?.studentObjs.forEach(X=>{le.push({id:X.id,fullName:X.fullName,confirmedAt:X.confirmedAt,homeworkAnswerId:X.answer?.id,studentId:void 0,resultId:void 0,userId:void 0,nameImages:void 0,reId:"",status:void 0})}),this.sAztDialogService.open($,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:_e.data?.classroomObj,results:le,schoolName:void 0,subjectName:void 0}],examHasEssay:!1,isAskInfo:!1}}).afterClosed().subscribe(X=>{if(X){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===X.results?.length?"":X.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Ae=new Et.Y(!0);this.logger.pushChild(Ae),this.loadLibAction(Ae).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===X.results?.length?"":X.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Se=new Et.Y(!0);this.logger.pushChild(Se);const be=new me.n(1,{function:(Le,qe,Qe)=>{Se.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===qe?"":"th\u1ee9 "+(Le+1)} ${Qe?": "+Qe:""}`)}});X.results?.forEach(Le=>{const qe=new Et.Y;Se.pushChild(qe),be.addTask(this,this.makeFileHomework,[B,Le,qe],Le.fullName??"")}),be.start().then(Le=>{Se.remove(),0===Le.errs.length?this.finishHomework(X.classObj?.name??"",_e.data?.homeworkObj?.name??"",Le,z,L):(this.logger.remove(),this.sAztDialogService.open(U,{data:{result:Le},restoreFocus:!1}).afterClosed().subscribe(qe=>{qe&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(X.classObj?.name??"",_e.data?.homeworkObj?.name??"",Le,z,L))}))})}).catch(Se=>{this.logger.remove(),L(Se)})}})}else this.logger.remove(),L(new Error(this.commonService.myTranslateInstant(_e.message)))})})}processClasses(E,B){return new Promise((z,L)=>{let _e;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),B){case"highest":_e=this.testedListApiService.getTestedHighestMark("export_tool",E);break;case"first":_e=this.testedListApiService.getTestedFirstMark("export_tool",E);break;default:_e=this.testedListApiService.getTestedLastMark("export_tool",E)}_e.subscribe(le=>{if(1==le.success){this.logger.remove();let X=!!le.data?.questionObjs?.filter(Se=>this.answerTypeService.isEssayAnswer(Se)).length,Ae=[];if(le.data?.studentsInClassResults?.forEach(Se=>{let be=[];Se.results?.forEach(Le=>{be.push({id:Le.id?Number(Le.id):void 0,fullName:Le.fullName??"",confirmedAt:Le.confirmedAt,studentId:Le.studentId?Number(Le.studentCode):void 0,resultId:Le.resultId,userId:Le.userId?.toString(),nameImages:Le.nameImages,reId:"",status:Le.status})}),Ae.push({classObj:Se.classObj,results:be,schoolName:void 0,subjectName:void 0})}),le.data?.studentsNotInClassResults&&le.data?.studentsNotInClassResults?.length>0){let Se=[];le.data.studentsNotInClassResults.forEach(be=>{Se.push({id:be.id?Number(be.id):void 0,fullName:be.fullName??"",confirmedAt:be.confirmedAt,studentId:be.studentId?Number(be.studentCode):void 0,resultId:be.resultId,userId:be.userId?.toString(),nameImages:be.nameImages,reId:"",status:be.status})}),Ae.push({classObj:{id:0,name:this.commonService.myTranslateInstant("lang_auto_tu_do")??""},results:Se,schoolName:void 0,subjectName:void 0})}this.sAztDialogService.open($,{data:{studentsInClassResults:Ae,examHasEssay:X,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(Se=>{Se?(this.expandInfoParse=this.commonService.castJsonToObj(le.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===Se.results?.length?"":Se.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(E,Se,Se.classObj?.name??"",le.data?.examObj,Se.classObj?.id).then(()=>{this.logger.remove(),z()}).catch(Le=>{this.logger.remove(),L(Le)})):(this.logger.remove(),z())})}else this.logger.remove(),L(new Error(this.commonService.myTranslateInstant(le.message)??""))})})}processUser(E,B,z,L,_e,le=!0,X,Ae,Se,be,Le){return new Promise((qe,Qe)=>{this.reset(),_e=_e||this.logger,_e?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const P=new Et.Y(!0);_e?.pushChild(P),this.loadLibAction(P).then(()=>{_e?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(E,z??"",L??"",B,Le).subscribe(Ne=>{if(1==Ne.success){this.expandInfoParse=this.commonService.castJsonToObj(Ne.data?.examObj?.expandInfo??"{}")??{},_e?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let tt=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const at=Ne.data?.studentObj;_e?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${at?.fullName??""}`);let ct="";ct=Ne.data?.classroomObj?Ne.data?.classroomObj.name??tt:tt;const it=Ne.data?.examTracks,ut=Ne.data?.examObj,Ut=Ne.data?.examResultObj,xt=this.commonService.castJsonToClassObjs(Dt.I,JSON.stringify(Ne.data?.questionObjs))??[];let mn=0,Kt=0;for(let gt=0;gt<xt.length;gt++)xt[gt].correctAnswer=this.commonService.isExistInArray(Ne.data?.correctQuestionIds,xt[gt].id),xt[gt].indexLabel=gt+(ut?.startQuestionIndex??1),ut?.resetQuestionIndex&&xt[gt].groupInfo&&xt[gt].groupInfo?.groupId&&(xt[gt].groupInfo&&mn!=xt[gt].groupInfo?.groupId&&(mn=xt[gt].groupInfo?.groupId??0,Kt=0),xt[gt].labelIndex=Kt+(ut?.startQuestionIndex??1),Kt++);const an={};let In=this.commonService.castJsonToObj(Ne.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(In??[],an);const Bt=new Et.Y;_e?.pushChild(Bt),this.processConvertDataUser(Bt,xt,at,Ut).then(gt=>{if(gt){var dn=0;this.convertDataMarkNote(gt?.resultTeacherDraw).then(jn=>{this.loadTeacherDrawResult(jn,_e??new Et.Y,at?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",gt).then(Vt=>{gt=Vt,Bt.remove();const Nn=new Et.Y(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+`...${dn}%`);_e?.pushChild(Nn);let gn=[];gn.push({content:this.getLineInfoData(ct,ut,it,Ut,at,xt,gt,X,Ae).join("<br/>")+"<br/><br/><br/>",answers:[]}),gn=gn.concat(this.startGenUserLineFile(Ut,xt,gt,Se,be));var Jt=0;this.sAztDocxService.exportToDocxBinary((0,nt.Wn)(gn),{isHeadless:!0},(En,fn,vn)=>{new Promise(An=>{setTimeout(()=>{0==En&&(dn=Jt),Jt=En/fn*50+dn;const pn=this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+"..."+Math.floor(Jt)+"%";Nn?.pushMsg(pn)}),An(!0)})}).then(En=>{const fn=new Blob([En],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let vn=this.commonService.createFileNameExportFile([at?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",Ut?.id?Ut.id.toString():""])+"_test_result";if(le)if(gt.mediaAnswerWraps.concat(gt.mediaWraps).length>0){const An=new l;An.file(vn+".docx",fn),gt.mediaAnswerWraps.concat(gt.mediaWraps).forEach(pn=>{const tr=new Blob([pn]);An.file("attachments/"+this.replaceParamFileName(pn.name),tr)}),An.generateAsync({type:"blob"}).then(pn=>{let tr=this.commonService.createFileNameExportFile([ct,vn])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(pn,tr),_e?.remove(),qe()},pn=>{_e?.remove(),qe(pn)})}else this.shareFileFlutterService.shareFileWithBlob(fn,vn+".docx"),_e?.remove(),qe();else _e?.remove(),qe({name:vn,blob:fn,medias:gt.mediaAnswerWraps.concat(gt.mediaWraps)})})})})}}).catch(gt=>{_e?.remove(),Qe(gt)})}else _e?.remove(),Qe(new Error(this.commonService.myTranslateInstant(Ne.message)))})}).catch(Ne=>{_e?.remove(),Qe(Ne)})})}finishClassroom(E,B,z,L,_e){if(z.length>1){const le=new l;z.forEach(X=>{X.medias.length>0?(le.file(X.name+"/"+X.name+".docx",X.blob),X.medias.forEach(Ae=>{const Se=new Blob([Ae]);le.file(X.name+"/attachments/"+this.replaceParamFileName(Ae.name),Se)})):le.file(X.name+".docx",X.blob)}),le.generateAsync({type:"blob"}).then(X=>{let Ae=this.commonService.createFileNameExportFile([E,B])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(X,Ae),L()},X=>{L(X)})}else if(z[0].medias.length>0){const le=new l;le.file(z[0].name+"/"+z[0].name+".docx",z[0].blob),z[0].medias.forEach(X=>{const Ae=new Blob([X]);le.file(z[0].name+"/attachments/"+this.replaceParamFileName(X.name),Ae)}),le.generateAsync({type:"blob"}).then(X=>{let Ae=this.commonService.createFileNameExportFile([E,B])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(X,Ae),L()},X=>{L(X)})}else this.shareFileFlutterService.shareFileWithBlob(z[0].blob,z[0].name+".docx"),L()}finishHomework(E,B,z,L,_e){if(1===z.datas.length)if(z.datas[0].medias.length>0){const le=new l;le.file(z.datas[0].name+"/"+z.datas[0].name+".docx",z.datas[0].blob),z.datas[0].medias.forEach(X=>{const Ae=new Blob([X]);le.file(z.datas[0].name+"/attachments/"+this.replaceParamFileName(X.name),Ae)}),le.generateAsync({type:"blob"}).then(X=>{let Ae=this.commonService.createFileNameExportFile([E,z.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(X,Ae),L()},X=>{this.logger.remove(),L(X)})}else this.shareFileFlutterService.shareFileWithBlob(z.datas[0].blob,z.datas[0].name+".docx"),this.logger.remove(),L();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const le=new l;z.datas.forEach(X=>{X.medias.length>0?(le.file("results/"+X.name+"/"+X.name+".docx",X.blob),X.medias.forEach(Ae=>{const Se=new Blob([Ae]);le.file("results/"+X.name+"/attachments/"+this.replaceParamFileName(Ae.name),Se)})):le.file("results/"+X.name+".docx",X.blob)}),le.generateAsync({type:"blob"}).then(X=>{let Ae=this.commonService.createFileNameExportFile([E,B])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(X,Ae),this.logger.remove(),L()},X=>{this.logger.remove(),_e(X)})}}makeFileHomework(E,B,z){return new Promise((L,_e)=>{z.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(E,B.homeworkAnswerId??0).subscribe(le=>{if(z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(le.data?.answerObj),le.data?.answerObj){z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let Ae=this.commonService.castJsonToObj(le.data.answerObj.result??"")??{};this.convertDataMarkNote(Ae).then(Se=>{this.loadTeacherDrawResult(Se,z,B.fullName??"").then(be=>{z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let Le=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${le.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${le.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${le.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${le.data?.answerObj?.id} <br/>`].forEach(Qe=>{Le.push({content:Qe,answers:[]})});let qe=this.commonService.castJsonToObj(le.data?.answerObj?.resultNote??"");if(qe){const Qe=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],P=document.createElement("p");P.innerText=this.commonService.myTranslateInstant("lang_point")??"",P.setAttribute("docx-style",nt.$s.get("TB_RESULT_TXT"));const Ne=document.createElement("p");let tt=le.data?.answerObj?.point;Qe.forEach(it=>{it.mark===tt&&(tt=this.commonService.myTranslateInstant(it.lang))}),Ne.innerText=tt?.toString()??"",Ne.setAttribute("docx-style",nt.$s.get("TB_RESULT_POINT"));const at=document.createElement("p");at.setAttribute("docx-style",nt.$s.get("TB_RESULT_TXT")),at.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const ct=document.createElement("span");ct.setAttribute("docx-style",nt.$s.get("TB_RESULT_COMMENT")),0===qe?.IsHideMark&&(ct.innerText=this.getTextContentInTagHTML(qe.Note),be.resultTeacherDraw?.commentEmoji&&(ct.appendChild(document.createElement("br")),be.resultTeacherDraw.commentEmoji.forEach(it=>{if(be.canvasList[it]){const ut=new Image;ut.src=be.canvasList[it].toDataURL(),ut.style.width=be.canvasList[it].width/5+"px",ut.style.height=be.canvasList[it].height/5+"px",ct.appendChild(ut)}}))),Le.push({content:nt.$s.makeHeaderTable([P,Ne],[at,ct]),answers:[]})}Le=Le.concat(this.getLineImageAnswer(be)),this.sAztDocxService.exportToDocxBinary((0,nt.Wn)(Le),{isHeadless:!0},(Qe,P,Ne)=>{}).then(Qe=>{z.remove();const P=new Blob([Qe],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let Ne=`${this.commonService.convertVietnameseToEnglish(B.fullName??"")}_${le.data?.answerObj?.id??0}`;L({name:Ne,blob:P,medias:be.mediaAnswerWraps.concat(be.mediaWraps)})})}).catch(be=>{z.remove(),_e(be)})})}else z.remove(),_e(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(E,B,z,L,_e){return new Promise((le,X)=>{const Ae=new me.n(1,{function:(Le,qe)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===qe?"":` (${Le+1}/${qe})`}`),this.logger.percent=Le/qe}},1e3),Se=[];let be=this.homeworkExamService.isOfflineExam(L);B.results?.forEach(Le=>{Ae.addTask(this,()=>new Promise((qe,Qe)=>{const P=new Et.Y(!0,"");this.logger.pushChild(P),this.processUser(E,Number(Le.resultId),Le.userId,Le.studentId?.toString(),P,!1,B.schoolName,B.subjectName,be,void 0,_e).then(Ne=>{Ne?(P.remove(),Se.push(Ne),qe()):(P.remove(),Qe(new Error))}).catch(Ne=>{P.remove(),Qe(Ne)})}))}),Ae.start().then(Le=>{Le.errs.length>0?(this.logger.remove(),Le.datas=Se,this.sAztDialogService.open(U,{data:{result:Le},restoreFocus:!1}).afterClosed().subscribe(qe=>{qe&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom(z,L?.name??"",Se,le,X))})):this.finishClassroom(z,L?.name??"",Se,le,X)})})}processConvertDataUser(E,B,z,L){return new Promise((_e,le)=>{let X={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Ae=(this.commonService.myParseJson(L?.files??"[]")??[]).filter(Ne=>(0,lt.rl)(Ne.mimes??"")||(0,lt.nL)(Ne.mimes??""));E.start();const P=new me.n(1,{function:(Ne,tt,at)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${Ne+1}/${tt}: ${at}`)}});P.addTask(this,()=>new Promise((Ne,tt)=>{const at=new Et.Y(!0);E.pushChild(at),this.questionRenderService.parseRenderQuestions(B,ct=>{at.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(ct)}%`)},void 0,50,!0).then(()=>{at.remove(),Ne()}).catch(ct=>{const it=ut=>{Object.prototype.hasOwnProperty.call(ut,"type")&&"LOAD_IMAGE"===ut.type?tt(new Error(`${ut.message} ${this.commonService.trimMidLimitLength(ut.data[0],30)}`)):tt(ct)};at.remove(),Array.isArray(ct)?it(ct[0]):it(ct)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),L&&L.result&&P.addTask(this,()=>new Promise((Ne,tt)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj(L?.result??"")??{},E,z?.fullName??"").then(at=>{X=at,Ne()}).catch(at=>{tt(at)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),P.addTask(this,()=>new Promise((Ne,tt)=>{z?this.loadNameImage(z).then(at=>{z=at,Ne()}).catch(at=>{tt(at)}):tt(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),X.isExportMedia&&P.addTask(this,()=>new Promise((Ne,tt)=>{const at=new Et.Y(!0);E.pushChild(at);const ct=new me.n(3,{function:(it,ut)=>{at.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${it}/${ut})`)}},100);B.forEach(it=>{it.attachments&&it.attachments.length>0&&it.attachments.forEach(ut=>{ct.addTask(this,this.loadAztFile,[ut,X,"att"])})}),ct.start().then(it=>{0===it.errs.length?(at.remove(),Ne()):(at.remove(),tt(it.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),Ae.length&&P.addTask(this,()=>new Promise((Ne,tt)=>{const at=new Et.Y(!0);E.pushChild(at);const ct=new me.n(3,{function:(it,ut)=>{at.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${it}/${ut})`)}},100);Ae.forEach(it=>{ct.addTask(this,this.loadAztFile,[it,X,"ans"])}),ct.start().then(it=>{0===it.errs.length?(at.remove(),Ne()):(at.remove(),tt(it.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem_tu_luan")),P.start().then(Ne=>{E.remove(),0===Ne.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(B,L),_e(X)):le(Ne.errs[0])})})}hasMultiple(E){let B=!1;for(let z=0;z<E.length;z++)if(this.answerTypeService.isOneChoiceAnswer(E[z])){B=!0;break}return B}hasEssay(E){let B=!1;for(let z=0;z<E.length;z++)if(this.answerTypeService.isEssayAnswer(E[z])){B=!0;break}return B}getLineInfoData(E,B,z,L,_e,le,X,Ae,Se){const be=[];be.push(nt.$s.makeHeaderTable([nt.$s.createLineCenterBold(Ae||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toUpperCase()} }`)],[nt.$s.createLineCenterBold(B?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),nt.$s.createLineCenterBold(Se||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),nt.$s.createLineCenterBold(B?.minutes&&B?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+B?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const Le=le.filter(qe=>this.answerTypeService.isEssayAnswer(qe)).length;return _e&&_e.nameImages&&parseInt(_e?.id??"0")<=0?be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${_e?.nameImages.url}" />`):be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${_e?.fullName}`),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${E}`),B?.subjectMarks&&L?.subjectMarkValues&&L.subjectMarkValues.forEach((qe,Qe)=>{be.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${Qe+1} </b>: ${qe}/10`)}),this.hasMultiple(le)&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${L?.trueFalseMark} (${L?.rightAnswer}/${(L?.totalQuestion??0)-Le} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(le)&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${L?.essayMark+" ("+Le+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(le)&&X.resultTeacherDraw&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj(L?.files??"")?.length??"0"}`),z&&0!=B?.autoMonitor&&(be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${z.exitFullScreen}`),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${z.blurWindow}`)),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${L?.id}`),be}startGenUserLineFile(E,B,z,L,_e){let le=[];const X=this.commonService.castJsonToObj(E?.answers??"");return X&&B.forEach(Ae=>{Ae.groupInfo&&Ae.groupInfo.isFirstInGroup&&le.push({content:`<br/><b>${Ae.groupInfo.groupContent}</b><br/>`,answers:[]}),Ae.attachments&&z.isExportMedia&&Ae.attachments.forEach(be=>{le.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(be.name)}]`,answers:[]})}),le=le.concat(this.genLineQuestion(Ae,L));const Se=this.mapQuestResultObj(Ae,X??[]);switch(Ae.answerType){case 1:le=le.concat(this.genLineAnswerType1(Ae,Se));break;case 3:le=le.concat(this.genLineAnswerType3(Ae,Se));break;case 4:le=le.concat(this.genLineAnswerType4(Ae,Se));break;case 5:le=le.concat(this.genLineAnswerTrueFalseType5(Ae,Se))}_e&&Ae.help&&le.push({content:`<br/><b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b> ${Ae.help}<br/><br/>`,answers:[]})}),this.hasEssay(B)&&(le=le.concat(this.getLineImageAnswer(z))),le}genLineQuestion(E,B){const z=[];let L=this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"),_e=this.answerTypeService.isFillAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_fill_blank"):this.answerTypeService.isEssayAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_essay"):this.commonService.myTranslateInstant("azt_lang_sugg_type_multiple_choice"),le={content:"<b>"+L+" "+(E.labelIndex??E.indexLabel??1)+". "+(B?`(${_e})`:"")+"</b> "+(E.content?.includes("<img")?"<br/>":"")+E.content,answers:B&&(this.answerTypeService.isFillAnswer(E)||this.answerTypeService.isEssayAnswer(E))?[]:this.convertAnswerQuestion(E.answers??[],!!this.answerTypeService.isTrueFalseAnswer(E))};return z.push(le),z}mapQuestResultObj(E,B){return B.find(L=>L.QuestionId===E.id)||{QuestionId:E.id??0,AnswerContent:[]}}convertAnswerQuestion(E,B){let z=[];return E.forEach(L=>{let _e=L.alpha?L.alpha:L.key,le="<b>     "+(B?_e.toLocaleLowerCase()+")":_e)+".</b> "+L.content;z.push(le)}),z}genLineAnswerType1(E,B){const z=document.createElement("table"),L=E.correctAnswer?nt.JP:nt.ep;z.setAttribute("docx-style",nt.$s.get("TABLE"));const _e=[],le=document.createElement("tr");z.appendChild(le);const X=document.createElement("td");X.setAttribute("docx-style",nt.$s.get("CORRECT",[{key:nt.Xe,value:L}]));const Ae=document.createElement("span"),Se=E.answers?E.answers.filter(qe=>E.answerResult?.includes(qe.key)).map(qe=>qe.alpha??qe.key).join(" & "):E.answerResult?.join(" & ");Ae.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+Se,Ae.setAttribute("color",L),X.appendChild(Ae),le.appendChild(X);const be=document.createElement("span"),Le=document.createElement("span");return be.innerText="\u2713",be.setAttribute("color",nt.JP),Le.innerText="\u2717",Le.setAttribute("color",nt.ep),E.answers?.forEach((qe,Qe)=>{const P=document.createElement("td"),Ne=document.createElement("span"),tt=[{key:nt.Xe,value:L}];tt.push({key:nt.n1,value:Qe+1===E.answers?.length?L:"FFFFFF"}),P.setAttribute("docx-style",nt.$s.get("KEY_RESULT",tt)),Ne.innerText=qe.alpha??qe.key,B.AnswerContent.filter(ct=>ct.Content===qe.key).length>0&&P.appendChild(E.correctAnswer?be:Le),P.appendChild(Ne),le.appendChild(P)}),_e.push({content:`<br>${z.outerHTML}<br><br><br>`,answers:[]}),_e}genLineAnswerTrueFalseType5(E,B){const z=[],L=E.correctAnswer?nt.JP:nt.ep,_e=this.commonService.myTranslateInstant("lang_auto_dung"),le=this.commonService.myTranslateInstant("lang_auto_sai"),X=this.sAztAnswerTrueFalseService.checkLabelKeys([],E?.answers,E?.answerResult),Ae=(tt,at)=>{const ct=document.createElement("span");return ct.innerText=tt,ct.setAttribute("color",at),ct},Le=document.createElement("table");Le.setAttribute("docx-style",nt.$s.get("TABLE"));const qe=document.createElement("tr"),Qe=Ae(this.commonService.myTranslateInstant("lang_auto_dap_an")??"",L),P=document.createElement("td"),Ne=[{key:nt.Xe,value:L}];return Ne.push({key:nt.n1,value:L}),P.setAttribute("docx-style",nt.$s.get("KEY_RESULT",Ne)),E.answers?.forEach(tt=>{const at=this.sAztAnswerTrueFalseService.checkIsTrueType5(tt,X,B.AnswerContent),ct=this.commonService.myTranslateInstant(this.sAztAnswerTrueFalseService.getAnswerChoiceTrueFalseQuestion(tt,B.AnswerContent))??"";P.appendChild(((tt,at,ct)=>{const it=document.createElement("div"),ut=document.createElement("span"),Ut=at?nt.JP:nt.ep;return ut.innerText=(tt.alpha??tt.key).toLowerCase()+"-",it.appendChild(Ae(at?"\u2713":"\u2717",Ut)),it.appendChild(ut),it.appendChild(Ae(ct??"",Ut)),it})(tt,at,ct)),P.appendChild(document.createElement("br"))}),qe.appendChild(((tt,at)=>{const ct=document.createElement("td");return ct.appendChild(tt),E.answers.length&&E.answers.forEach(it=>{const ut=document.createElement("span");ut.setAttribute("color",this.sAztAnswerTrueFalseService.checkIsTrueType5(it,X,B.AnswerContent)?nt.JP:nt.ep),ut.innerText=` ${(it.alpha?it.alpha:it.key?it.key:it).toString().toLowerCase()}-${X.includes((it.alpha?it.alpha:it.key?it.key:"")+"T")?_e:le} `,ct.appendChild(ut)}),ct.setAttribute("docx-style",at),ct})(Qe,nt.$s.get("CORRECT",[{key:nt.Xe,value:L}]))),qe.appendChild(P),Le.appendChild(qe),z.push({content:`<br>${Le.outerHTML}<br><br><br><br><br><br>`,answers:[]}),z}genLineAnswerType3(E,B){const z=[];return z.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/><br/>`,answers:[]}),0===B.AnswerContent.length?z.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):B.AnswerContent.forEach(L=>{z.push({content:`<span>${L.Content}</span>`,answers:[]})}),z.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${E.essayMarkParsed} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${E.scorePerQuestion})</b>`,answers:[]}),z}genLineAnswerType4(E,B){const z=document.createElement("table"),L=E.correctAnswer?nt.JP:nt.ep;z.setAttribute("docx-style",nt.$s.get("TABLE"));const _e=[],le=document.createElement("tr");le.setAttribute("docx-style",nt.$s.get("TR")),z.appendChild(le);const X=document.createElement("td");X.setAttribute("docx-style",nt.$s.get("CORRECT",[{key:nt.Xe,value:L}]));const Ae=document.createElement("span");Ae.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+E.answerResult?.join(";")+"]",Ae.setAttribute("color",L),X.appendChild(Ae),le.appendChild(X),0===B.AnswerContent.length&&B.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const Se=document.createElement("td"),be=document.createElement("span");return Se.setAttribute("docx-style",nt.$s.get("FILL_RESULT",[{key:nt.Xe,value:L}])),be.innerText=B.AnswerContent.map(qe=>qe.Content).join(";"),Se.appendChild(be),le.appendChild(Se),_e.push({content:`<br>${z.outerHTML}<br><br><br>`,answers:[]}),_e}loadNameImage(E){return new Promise((B,z)=>{E&&E.nameImages&&parseInt(E?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(E.nameImages).then(L=>{L&&E.nameImages&&(E.nameImages.url=L),B(E)}).catch(L=>{z(L)}):B(E)})}loadCssFrameAction(){return new Promise(E=>{const B=document.createElement("div"),z=L=>{const _e=document.createElement("span");return _e.style.fontFamily=L,_e.innerText="Aa",_e};B.appendChild(z("font_chu_dep")),B.appendChild(z("font_chu_dep_z")),B.appendChild(z("font_chu_in")),B.appendChild(z("font_chu_in_nghieng")),B.appendChild(z("font_chu_in_dam")),B.style.opacity="0",document.body.appendChild(B),setTimeout(()=>{B.remove(),E()},2e3)})}loadLibAction(E){return new Promise((B,z)=>{this.commonService.loadAzotaDocxJs().then(()=>{const L=new me.n(1,{function:(_e,le,X)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${_e+1}/${le}: ${X}`)}});L.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),L.start().then(_e=>{E.remove(),_e.errs.length>0?z(_e.errs[0]):B()})}).catch(L=>{z(L)})})}reset(){}checkUrlIsImage(E){return null!=E.match(/\.(jpeg|jpg|png|gif)(\?.*)?$/)}loadAztFile(E,B,z){return new Promise((L,_e)=>{fetch(this.cdnService.getMyCdn(E.url??"")).then(le=>{le.ok?le.blob().then(X=>{const Se=new File([X],E.name??"",{type:E.mimes});"ans"===z?B.isExportAnsMedia&&B.mediaAnswerWraps.push(Se):B.isExportMedia&&B.mediaWraps.push(Se),L()}):_e(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))}).catch(()=>{_e(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))})})}wrapLoadMedia(E,B){return this.checkUrlIsImage(E)?(0,lt.qO)(E,B):new Promise((z,L)=>{z(void 0)})}replaceImageToBase64(E,B,z,L,_e,le){return new Promise((X,Ae)=>{Object.prototype.hasOwnProperty.call(E,B)&&"string"==typeof E[B]?this.wrapLoadMedia(E[B],_e).then(Se=>{if(Se){const be=document.createElement("canvas");be.width=Se.width,be.height=Se.height,be.getContext("2d")?.drawImage(Se,0,0),E[B]=z.canvasList.push(be)-1,X()}else{le=le?le+1:1;let be=E[B].split(".");be=be.length>0?be[be.length-1]:"mp3";const Le=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",le.toString(),L])+"."+be;this.loadAztFile({name:this.commonService.replaceAll(Le,"_"," ")??"",url:E[B],path:"",extension:"",mimes:"",size:"0"},z,"ans").then(()=>{X()}).catch(qe=>{Ae(new Error(this.commonService.myTranslateInstant(qe.message)+(L.length>0?" : "+L:"")))})}}).catch(Se=>{Ae(new Error(this.commonService.myTranslateInstant(Se.message)+(L.length>0?" : "+L:"")))}):Ae(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+(L.length>0?" : "+L:"")))})}loadTeacherDrawResult(E,B,z,L){return new Promise((_e,le)=>{const X=L??{canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Ae=new me.n(3,{function:(Se,be)=>{B.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${Se}/${be})`)}});if(X.resultTeacherDraw=E,X.resultTeacherDraw){X.resultTeacherDraw.pages?.forEach((be,Le)=>{Ae.addTask(this,this.replaceImageToBase64,[be,"backgroundImage",X,z,this.cdnService,Le]),be.draw&&Ae.addTask(this,this.replaceImageToBase64,[be,"draw",X,z,this.cdnService,Le])});const Se=this.commonService.castJsonToObj(X.resultTeacherDraw.staticTextConfig??"");if(X.resultTeacherConfig=Se,X.resultTeacherConfig&&X.resultTeacherConfig.urlImgCorrect&&X.resultTeacherConfig.urlImgWrong&&(X.resultTeacherConfig.urlImgCorrect=(X.resultTeacherConfig.type?"":"assets/images/classlive/")+X.resultTeacherConfig.urlImgCorrect,X.resultTeacherConfig.urlImgWrong=(X.resultTeacherConfig.type?"":"assets/images/classlive/")+X.resultTeacherConfig.urlImgWrong,Ae.addTask(this,this.replaceImageToBase64,[X.resultTeacherConfig,"urlImgCorrect",X,z]),Ae.addTask(this,this.replaceImageToBase64,[X.resultTeacherConfig,"urlImgWrong",X,z])),X.resultTeacherDraw.commentEmoji&&X.resultTeacherDraw.commentEmoji.length>0)for(let be=0;be<X.resultTeacherDraw.commentEmoji.length;be++)X.resultTeacherDraw.commentEmoji[be]="https://azota889.github.io/storage_public/mnote/"+X.resultTeacherDraw.commentEmoji[be],Ae.addTask(this,this.replaceImageToBase64,[X.resultTeacherDraw.commentEmoji,be,X,z])}Ae.start().then(Se=>{0===Se.errs.length?_e(X):le(Se.errs[0])})})}capitalized(E){return E?E.charAt(0).toUpperCase()+E.slice(1):""}wrapText(E,B,z,L,_e,le){const X=document.createElement("span");X.innerHTML=this.commonService.removeXssInHtml(B),(B=X.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(Se=>{for(var be=Se.split(" "),Le="",qe=0;qe<be.length;qe++){var Qe=Le+be[qe]+" ";E.measureText(Qe).width>_e&&qe>0?(E.fillText(Le,z,L),Le=be[qe]+" ",L+=le):Le=Qe}E.fillText(Le,z,L)})}getLineImageAnswer(E){const B=[];return E.mediaAnswerWraps&&E.isExportAnsMedia&&E.mediaAnswerWraps.forEach(z=>{B.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(z.name)}}</span>`,answers:[]})}),E.resultTeacherDraw&&E.resultTeacherDraw.pages?.forEach(z=>{let L=E.canvasList[Number(z.backgroundImage)];if(L){const _e=document.createElement("canvas");_e.width=z.width??1,_e.height=z.height??1;const le=_e.getContext("2d");if(le){le.fillStyle="#FFFFFF",le.fillRect(0,0,_e.width,_e.height);let Se=document.createElement("canvas"),be=Se.getContext("2d");0!==z.rotation&&be?(90===Math.abs(z.rotation??0)?(Se.width=L.height,Se.height=L.width):(Se.width=L.width,Se.height=L.height),be.translate(Se.width/2,Se.height/2),be.rotate(((z.rotation??0)>0?1:-1)*(z.rotation??0)*Math.PI/180),be.drawImage(L,-L.width/2,-L.height/2),be.restore()):Se=L;const Le=_e.height/Se.height*Se.width;if(le.drawImage(Se,0,0,Se.width,Se.height,(_e.width-Le)/2,0,Le,_e.height/Se.height*Se.height),z.draw){const P=E.canvasList[Number(z.draw)];P&&le.drawImage(P,0,0)}if(z.staticText&&z.staticText.length>0&&z.staticText.forEach(P=>{if(le.font=`${E.resultTeacherConfig?.fontSize}px ${E.resultTeacherConfig?.fontText}`,le.fillStyle=E.resultTeacherConfig?.fontColor??"#000000",E.resultTeacherConfig?.useCorrectText&&"correct"==P.value&&this.wrapText(le,E.resultTeacherConfig?.textCorrect??"",P.x,P.y,_e.width-P.x,25),E.resultTeacherConfig?.useCorrectText&&"wrong"==P.value&&this.wrapText(le,E.resultTeacherConfig?.textWrong??"",P.x,P.y,_e.width-P.x,25),!E.resultTeacherConfig?.useCorrectText&&"correct"==P.value){const Ne=E.canvasList[Number(E.resultTeacherConfig?.urlImgCorrect)];Ne&&le.drawImage(Ne,0,0,Ne.width,Ne.height,P.x,P.y,30,30)}if(!E.resultTeacherConfig?.useWrongText&&"wrong"==P.value){const Ne=E.canvasList[Number(E.resultTeacherConfig?.urlImgWrong)];Ne&&le.drawImage(Ne,0,0,Ne.width,Ne.height,P.x,P.y,30,30)}}),z.objText&&z.objText.length>0){let P=300;z.objText.forEach(Ne=>{le.font=`${parseFloat(Ne.textStyle.size)}px ${Ne.textStyle.font}`,le.fillStyle=Ne.textStyle.color,le.textAlign=Ne.textStyle.align??"center",le.lineWidth=Ne.textStyle.width??P,this.wrapText(le,Ne.value,Ne.x,Ne.y,_e.width-Ne.x,25)})}}const X=693,Ae=X/_e.width;B.push({content:`<img src="${_e.toDataURL()}" style="width:${X}px;height:${_e.height*Ae}px" /><br/>`,answers:[]})}}),0===B.length?B.push({content:`<br/><br/>${nt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):B.unshift({content:`<br/>${nt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),B}convertDataMarkNote(E){return new Promise((B,z)=>{E&&E.urlDataMark?this.cdnService.loadTextCdn(this.cdnService.getMyCdn(E.urlDataMark)).subscribe(L=>{const _e=this.zipDataService.decodeContentGzip(L),le=this.commonService.castJsonToObj(_e);E.pages=[];let X={};le?.pages.forEach((be,Le)=>{let qe={width:be.width,height:be.height,draw:be.draws?.[0]?.src??void 0,backgroundImage:be.backgroundSrc,rotation:be.backgroundRotate,objText:[],staticText:[]};be.childData?.length&&be.childData.forEach((Qe,P)=>{if("UIQuickMark"==Qe.className&&(qe.staticText?.push({x:Qe.x+5,y:Qe.y+(Qe.height+5+Qe.fontSize)/2,value:"type_right"===Qe.type?"correct":"wrong"}),0===P&&(X={txtCommentFont:Qe.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:Qe.width,correctHeight:Qe.height,wrongWidth:Qe.width,wrongHeight:Qe.height,fontText:Qe.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:Qe.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!X.urlImgWrong&&"type_wrong"==Qe.type&&(X.urlImgWrong=Qe.imageSrc),!X.urlImgCorrect&&"type_right"==Qe.type&&(X.urlImgCorrect=Qe.imageSrc),!X.textWrong&&"type_wrong"==Qe.type&&(X.textWrong=Qe.textContent),!X.textCorrect&&"type_right"==Qe.type&&(X.textCorrect=Qe.textContent),X.useCorrectText=!X.urlImgCorrect,X.useWrongText=!X.urlImgWrong,"UIText"===Qe.className){let Ne=this.getStyleContent(Qe.textContent);qe.objText?.push({x:Qe.x+15,y:Qe.y+15,value:Qe.textContent,textStyle:{size:Qe.fontSize?Qe.fontSize:Ne?.fontSize,align:Ne?.textAlign??"left",color:Ne?.color,fill:!0,font:Ne?.fontFamily}})}}),E.pages?.push(qe)}),E.staticTextConfig=this.commonService.serializeJson(X),B(E)}):B(E??{})})}getStyleContent(E){let B=document.createElement("div");B.innerHTML=this.commonService.removeXssInHtml(E);let z=B.querySelector("p"),L=B.querySelector("span");return L?{fontSize:L.style.fontSize,color:L.style.color,fontFamily:L.style.fontFamily,textAlign:z?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(E){return(new DOMParser).parseFromString(E,"text/html").body.textContent??E}replaceParamFileName(E){return E.replace(/\?.*$/,"")}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}constructor(E,B,z,L,_e,le,X,Ae,Se,be,Le,qe,Qe,P,Ne,tt){this.sAztAnswerTrueFalseService=E,this.homeworkExamService=B,this.checkDrawImgNameService=z,this.cdnService=L,this.zipDataService=_e,this.exportPdfUtilsService=le,this.answerTypeService=X,this.exportPdfConvertDataService=Ae,this.questionRenderService=Se,this.commonService=be,this.answerService=Le,this.examResultService=qe,this.testedListApiService=Qe,this.shareFileFlutterService=P,this.sAztDialogService=Ne,this.sAztDocxService=tt,this.logger=new Et.Y,this.expandInfoParse={}}}return(te=We).\u0275fac=function(E){return new(E||te)(_.KVO(Ye.j),_.KVO(ft.Z),_.KVO(Je.E),_.KVO(je.B),_.KVO(K.j),_.KVO(ae.j),_.KVO(de._),_.KVO(j.p),_.KVO(C.g),_.KVO(M.R),_.KVO(V._t),_.KVO(Te._j),_.KVO(ve.h),_.KVO(Ze.R),_.KVO(Re.i),_.KVO(rt.I))},te.\u0275prov=_.jDH({token:te,factory:te.\u0275fac,providedIn:"root"}),We})()},92229:(vt,Pe,v)=>{v.d(Pe,{Y:()=>l});class l{pushChild(c){this.child.push(c)}pushMsg(c){this.msg=c}start(c){this.run=!0,c&&(this.msg=c)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const c=[];return this.msg&&""!==this.msg&&c.push(this.msg),`<p>${c.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let c=[];return this.child.filter(_=>_.run).forEach(_=>{c=c.concat(_.lines)}),c}constructor(c=!1,_="",w){this.run=c,this.msg=_,this.percent=w,this.child=[]}}},44101:(vt,Pe,v)=>{v.d(Pe,{i:()=>ls});var l=v(48891),f=v(407),c=v(59702),_=v(59640),w=v(50622),S=v(99927),H=v(86622),y=v(46899);let oe=(()=>{var A;class ke extends _.H{showExplain(){this.isTeacherRole||!this.examConfig||"SHOW_EXPLAIN"!==this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction||this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought?this.isShowExplainChange.emit(!this.isShowExplain):this.showDialogBuyExam(this.examObj)}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage(!0)}showDialogBuyExam(ge){this.sAztDialogService.open(c.Q,{data:{examObj:ge},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0})}isKey(ge){return!(!this.questionObj?.answers||!this.questionObj.answerResult)&&(ge.key?ge.key==this.questionObj.answerResult[0]:ge==this.questionObj.answerResult[0])}haveChoose(ge){return!!this.userAnswersObj["id_"+this.questionObj?.id]&&(ge.key?ge.key.toString()==this.userAnswersObj["id_"+this.questionObj?.id]:ge.toString()==this.userAnswersObj["id_"+this.questionObj?.id])}findKey(){this.questionObj?.answerResult&&this.labelArr.every(ge=>!this.questionObj||!this.questionObj.answerResult||this.questionObj.answerResult[0]!=ge.key||(this.key=(this.isShowOriginAnswer?ge.key:ge.alpha??ge.key)??"",!1))}checkShowExplainButton(){this.isShowExplainButton=!!(this.questionObj.help||"lang_core_show_explain_required_payment"==this.questionObj.help&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigObj?.priceForAction)}checkLabelArr(){this.labelArr=this.sAztAnswerTrueFalseService.checkLabelArrOriginOrMix(this.questionAnswers,this.isShowOriginAnswer),this.findKey()}ngOnChanges(ge){ge.isShowOriginAnswer&&this.questionObj&&this.checkLabelArr()}ngOnInit(){if(super.ngOnInit(),this.isFillAnswer=this.questionObj?.correctAnswer??!1,this.answerTypeService.isTrueFalseAnswer(this.questionObj)?(this.keys=this.sAztAnswerTrueFalseService.checkLabelKeys(this.keys,this.questionObj?.answers,this.questionObj?.answerResult),this.isFillAnswer=!0):this.key=this.questionObj?.answerResult.length?this.questionObj.answerResult[0]:"",this.questionAnswers=(0,f.cloneDeep)(this.questionObj.answers??[]),this.checkLabelArr(),this.answerTypeService.isOneChoiceAnswer(this.questionObj))for(let ge=0;ge<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[ge])&&this.haveChoose(this.labelArr[ge]),!0!==this.isFillAnswer);ge++);this.answerTypeService.isFillAnswer(this.questionObj)&&this.questionObj?.answerResult&&this.questionObj.answerResult.length>0&&(this.keys=this.questionObj.answerResult,this.isFillAnswer=this.questionObj?.correctAnswer??!1),this.checkShowExplainButton()}constructor(ge,Ve,jt,di){super(),this.sAztAnswerTrueFalseService=ge,this.answerTypeService=Ve,this.answerBoxService=jt,this.sAztDialogService=di,this.isShowExplain=!1,this.isOfflineMark=!1,this.isTeacherRole=!0,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.isShowExplainChange=new l.bkB,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1,this.isShowExplainButton=!1,this.questionAnswers=[]}}return(A=ke).\u0275fac=function(ge){return new(ge||A)(l.rXU(w.j),l.rXU(S._),l.rXU(H.C),l.rXU(y.i))},A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-base"]],inputs:{examObj:"examObj",questionObj:"questionObj",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isTeacherRole:"isTeacherRole",isShowOriginAnswer:"isShowOriginAnswer",examConfig:"examConfig",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab",backToLink:"backToLink"},outputs:{isShowExplainChange:"isShowExplainChange"},features:[l.Vt3,l.OA$],decls:0,vars:0,template:function(ge,Ve){},encapsulation:2}),ke})();var G=v(54460),k=v(15343),N=v(76975);const U=A=>({width:A,visibility:"visible"}),ie=()=>({"ml-1":!0}),ze=A=>({color:A}),re=A=>({"border-color":A}),W=()=>({"text-danger wrongIcon mr-1":!0}),I=()=>({"rightIcon text-success mr-1":!0}),J=()=>({"text-danger mr-1":!0}),ye=()=>({"text-success mr-1":!0});function xe(A,ke){if(1&A){const T=l.RV6();l.j41(0,"span",6),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",7),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("ngStyle",l.eq3(6,U,T.questionObj.help?"125px":"0px")),l.R7$(),l.SpI(" ",l.bMT(2,4,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",T.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(8,ie))}}function Ee(A,ke){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,W))}function ue(A,ke){if(1&A&&l.DNE(0,Ee,1,2,"lucide-icon",16),2&A){const T=l.XpG().$implicit,ge=l.XpG(2);l.Y8G("ngIf",ge.haveChoose(T))}}function Me(A,ke){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,I))}function Ce(A,ke){if(1&A&&(l.j41(0,"div",12),l.DNE(1,ue,1,1,"ng-template",13)(2,Me,1,2,"lucide-icon",14),l.j41(3,"span",15),l.EFF(4),l.k0s()()),2&A){const T=ke.$implicit,ge=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(ge.isKey(T)&&ge.haveChoose(T))),l.R7$(),l.Y8G("ngIf",ge.isKey(T)&&ge.haveChoose(T)),l.R7$(2),l.JRh(T.alpha?T.alpha:T.key?T.key:T)}}function Xe(A,ke){if(1&A&&(l.j41(0,"div",8)(1,"span",9),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",10),l.DNE(5,Ce,5,3,"div",11),l.k0s()()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngStyle",l.eq3(7,ze,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(3,5,"lang_auto_dap_an_dung"),": ",T.key,""),l.R7$(2),l.Y8G("ngStyle",l.eq3(9,re,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",T.labelArr)}}function Fe(A,ke){if(1&A&&(l.qex(0),l.j41(1,"span",25),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"mytranslate"),l.k0s(),l.bVm()),2&A){const T=ke.$implicit,ge=l.XpG(2);l.R7$(),l.Y8G("ngStyle",l.eq3(9,ze,l.brH(2,3,T,ge.keys,ge.userAnswersObj["id_"+ge.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T," - ",l.bMT(4,7,ge.keys.includes((T.alpha?T.alpha:T.key?T.key:"")+"T")?"lang_auto_dung":"lang_auto_sai"),"\xa0 ")}}function mt(A,ke){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,J))}function fe(A,ke){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,ye))}function Ge(A,ke){if(1&A&&(l.j41(0,"div",26),l.DNE(1,mt,1,2,"lucide-icon",16),l.nI1(2,"isTrueAnswerType5"),l.DNE(3,fe,1,2,"lucide-icon",14),l.nI1(4,"isTrueAnswerType5"),l.j41(5,"span",15),l.EFF(6),l.nI1(7,"getAnswerChoiceTrueFalseQuestion"),l.nI1(8,"mytranslate"),l.k0s()()),2&A){const T=ke.$implicit,ge=l.XpG(2);l.R7$(),l.Y8G("ngIf",!l.brH(2,4,T,ge.keys,ge.userAnswersObj["id_"+(null==ge.questionObj?null:ge.questionObj.id)])),l.R7$(2),l.Y8G("ngIf",l.brH(4,8,T,ge.keys,ge.userAnswersObj["id_"+(null==ge.questionObj?null:ge.questionObj.id)])),l.R7$(3),l.Lme("",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T," - ",l.bMT(8,15,l.i5U(7,12,T,ge.userAnswersObj["id_"+ge.questionObj.id])),"")}}function he(A,ke){if(1&A&&(l.j41(0,"div",19)(1,"span",20),l.EFF(2),l.nI1(3,"mytranslate"),l.DNE(4,Fe,5,11,"ng-container",21),l.k0s(),l.j41(5,"div",22)(6,"div",23),l.DNE(7,Ge,9,17,"div",24),l.k0s()()()),2&A){const T=l.XpG();l.R7$(2),l.SpI(" ",l.bMT(3,4,"lang_auto_dap_an_dung"),": "),l.R7$(2),l.Y8G("ngForOf",T.labelArr),l.R7$(),l.Y8G("ngStyle",l.eq3(6,re,T.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.Y8G("ngForOf",T.labelArr)}}function Ke(A,ke){if(1&A&&(l.j41(0,"span",9),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const T=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,ze,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",T.keys.join("],["),"]")}}function Q(A,ke){if(1&A&&(l.j41(0,"div",8),l.DNE(1,Ke,3,7,"span",27),l.j41(2,"div",28)(3,"div",29),l.EFF(4),l.nI1(5,"trimEndFillAnswer"),l.nI1(6,"mytranslate"),l.k0s()()()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",T.keys),l.R7$(),l.Y8G("ngStyle",l.eq3(8,re,T.isFillAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==T.userAnswersObj["id_"+T.questionObj.id]?l.i5U(5,3,T.userAnswersObj["id_"+T.questionObj.id],T.isOfflineMark):l.bMT(6,6,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function se(A,ke){if(1&A){const T=l.RV6();l.j41(0,"div")(1,"span",32),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG(2);return l.Njj(Ve.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.JRh(l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function Be(A,ke){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function we(A,ke){if(1&A&&(l.qex(0),l.nrm(1,"div",33),l.bVm()),2&A){const T=l.XpG(3);l.R7$(),l.Y8G("innerText",T.userAnswersObj["id_"+T.questionObj.id])}}function $(A,ke){if(1&A&&(l.qex(0),l.DNE(1,Be,3,3,"div",31)(2,we,2,1,"ng-container",31),l.bVm()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",!T.userAnswersObj["id_"+T.questionObj.id]),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+T.questionObj.id])}}function me(A,ke){if(1&A&&(l.j41(0,"div",30),l.DNE(1,se,4,3,"div",31)(2,$,3,2,"ng-container",31),l.k0s()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==T.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=T.currentTab)}}let lt=(()=>{var A;class ke extends oe{ngOnInit(){super.ngOnInit()}}return(A=ke).\u0275fac=(()=>{let T;return function(Ve){return(T||(T=l.xGo(A)))(Ve||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-teacher"]],features:[l.Vt3],decls:11,vars:13,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none"],[1,"flex"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k","class","explainTxt text-pending cursor-pointer mt-2",3,"ngStyle","click",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box-type1 mt-2","style","flex-wrap: wrap",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k",1,"explainTxt","text-pending","cursor-pointer","mt-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"answer-box-type1","mt-2"],[1,"keyText","my-1",3,"ngStyle"],["id","type_1",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"answer-box-type1","mt-2",2,"flex-wrap","wrap"],[1,"keyText","my-1"],[4,"ngFor","ngForOf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],[1,"label-item",2,"display","block !important","width","auto !important"],["class","flex w-full mt-1","style","align-items: center",4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"flex","w-full","mt-1",2,"align-items","center"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(ge,Ve){1&ge&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,xe,4,9,"span",2),l.k0s(),l.DNE(3,Xe,6,11,"div",3),l.nI1(4,"isOneChoiceAnswer"),l.DNE(5,he,8,8,"div",4),l.nI1(6,"isTrueFalseAnswer"),l.DNE(7,Q,7,10,"div",3),l.nI1(8,"isFillAnswer"),l.DNE(9,me,3,2,"div",5),l.nI1(10,"isEssayAnswer"),l.k0s()),2&ge&&(l.R7$(2),l.Y8G("ngIf",Ve.questionObj.help),l.R7$(),l.Y8G("ngIf",l.bMT(4,5,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(6,7,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(8,9,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(10,11,Ve.questionObj)))},dependencies:[G.YU,G.Sq,G.bT,G.B3,k.WGl,N.wp,N.V6,N.Zm,N.N3,N.FC,N.jr,N.C0,N.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),ke})();var Dt=v(65162);const nt=A=>({"p-2":A}),Et=A=>({"justify-content":A}),Ye=A=>({"mt-3":A}),ft=(A,ke,T)=>({width:A,"margin-right":ke,"margin-left":T}),Je=()=>({"ml-1":!0}),je=A=>[A],K=A=>({backto:A}),ae=()=>({"text-transform":"uppercase"}),de=(A,ke)=>({"flex justify-between w-full items-center":A,"answer-box-type1":ke}),j=A=>({"border-color":A}),C=A=>({color:A}),M=()=>({"text-danger mr-1":!0}),V=()=>({"mr-1":!0}),Te=()=>({"text-success mr-1":!0}),ve=A=>({"w-full":A}),Ze=()=>({color:"#00ac33",width:"53px"}),Re=A=>({color:A,width:"53px"}),rt=()=>({color:"red"});function st(A,ke){if(1&A){const T=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("ngStyle",l.sMw(7,ft,T.isShowExplainButton?"125px":"0px",T.isShowExplainButton?"-40px":"0px",T.isMobileDevice?"":"8px")),l.BMQ("style",T.isShowExplainButton&&!T.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",T.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(11,Je))}}function te(A,ke){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const T=l.XpG();l.Y8G("routerLink",l.eq3(8,je,l.bMT(1,4,"/on-luyen/"+T.questionObj.practiceHashId)))("queryParams",l.eq3(10,K,T.backToLink))("ngStyle",l.lJ4(12,ae)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function We(A,ke){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const T=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,C,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung"),": ",T.key,"")}}function Ue(A,ke){1&A&&l.nrm(0,"span",17)}function E(A,ke){1&A&&l.nrm(0,"lucide-icon",23),2&A&&l.Y8G("ngClass",l.lJ4(1,M))}function B(A,ke){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,V))}function z(A,ke){if(1&A&&l.DNE(0,E,1,2,"lucide-icon",22)(1,B,1,2,"lucide-icon",20),2&A){const T=l.XpG().$implicit,ge=l.XpG(2);l.Y8G("ngIf",ge.haveChoose(T)&&2!=ge.examObj.whenShowAnswer&&!ge.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",ge.haveChoose(T)&&2!=ge.examObj.whenShowAnswer&&ge.notShowAnswerYet)}}function L(A,ke){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,V))}function _e(A,ke){if(1&A&&l.DNE(0,L,1,2,"lucide-icon",20),2&A){const T=l.XpG().$implicit,ge=l.XpG(2);l.Y8G("ngIf",ge.haveChoose(T)&&2==ge.examObj.whenShowAnswer)}}function le(A,ke){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,Te))}function X(A,ke){if(1&A&&(l.j41(0,"div",18),l.DNE(1,z,2,2,"ng-template",19)(2,_e,1,1,"ng-template",19)(3,le,1,2,"lucide-icon",20),l.j41(4,"span",21),l.EFF(5),l.k0s()()),2&A){const T=ke.$implicit,ge=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(ge.isKey(T)&&ge.haveChoose(T))),l.R7$(),l.Y8G("ngIf",!(ge.isKey(T)&&ge.haveChoose(T))),l.R7$(),l.Y8G("ngIf",ge.isKey(T)&&ge.haveChoose(T)&&2!=ge.examObj.whenShowAnswer),l.R7$(2),l.JRh(T.alpha?T.alpha:T.key?T.key:T)}}function Ae(A,ke){if(1&A&&(l.j41(0,"div",11),l.DNE(1,We,3,7,"span",12)(2,Ue,1,0,"span",13),l.j41(3,"div",14),l.DNE(4,X,6,4,"div",15),l.k0s()()),2&A){const T=l.XpG();l.Y8G("ngClass",l.l_i(5,de,T.isMobileDevice,!T.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",T.keys&&2==T.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(8,j,T.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",T.labelArr)}}function Se(A,ke){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.bVm()),2&A){const T=ke.$implicit,ge=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.lJ4(5,Ze)),l.R7$(),l.Lme(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T,") ",l.bMT(3,3,ge.keys.includes((T.alpha?T.alpha:T.key?T.key:"")+"T")?"lang_auto_dung":"lang_auto_sai")," ")}}function be(A,ke){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,Se,4,6,"ng-container",31),l.k0s()()),2&A){const T=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_auto_dap_an_dung"),":"),l.R7$(3),l.Y8G("ngForOf",T.labelArr)}}function Le(A,ke){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"getAnswerChoiceTrueFalseQuestion"),l.nI1(5,"mytranslate"),l.k0s(),l.bVm()),2&A){const T=ke.$implicit,ge=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.eq3(12,Re,l.brH(2,3,T,ge.keys,ge.userAnswersObj["id_"+ge.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T,") ",l.bMT(5,10,l.i5U(4,7,T,ge.userAnswersObj["id_"+ge.questionObj.id]))," ")}}function qe(A,ke){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,Le,6,14,"ng-container",31),l.k0s()()),2&A){const T=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_dap_an_thi_sinh_chon"),":"),l.R7$(3),l.Y8G("ngForOf",T.labelArr)}}function Qe(A,ke){if(1&A&&(l.j41(0,"span",32),l.EFF(1),l.k0s()),2&A){const T=l.XpG().$implicit;l.Y8G("ngStyle",l.lJ4(2,rt)),l.R7$(),l.SpI(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T,") \xa0 ")}}function P(A,ke){if(1&A&&(l.qex(0),l.DNE(1,Qe,2,3,"span",34),l.nI1(2,"isTrueAnswerType5"),l.bVm()),2&A){const T=ke.$implicit,ge=l.XpG(3);l.R7$(),l.Y8G("ngIf",!l.brH(2,1,T,ge.keys,ge.userAnswersObj["id_"+ge.questionObj.id]))}}function Ne(A,ke){if(1&A&&(l.j41(0,"div",33)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.DNE(4,P,3,5,"ng-container",31),l.k0s()),2&A){const T=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_cau_lam_sai"),":"),l.R7$(2),l.Y8G("ngForOf",T.labelArr)}}function tt(A,ke){if(1&A&&(l.j41(0,"div",25),l.DNE(1,be,6,4,"div",26)(2,qe,6,4,"div",26)(3,Ne,5,4,"div",27),l.k0s()),2&A){const T=l.XpG();l.Y8G("ngClass",l.eq3(4,ve,T.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function at(A,ke){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const T=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,C,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",T.keys.join("],["),"]")}}function ct(A,ke){1&A&&l.nrm(0,"span",17)}function it(A,ke){if(1&A&&(l.j41(0,"div",35),l.DNE(1,at,3,7,"span",12)(2,ct,1,0,"span",13),l.j41(3,"div",36)(4,"div",37),l.EFF(5),l.nI1(6,"trimEndFillAnswer"),l.nI1(7,"mytranslate"),l.k0s()()()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",T.keys&&2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",T.keys&&2==T.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(9,j,T.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==T.userAnswersObj["id_"+T.questionObj.id]?l.i5U(6,4,T.userAnswersObj["id_"+T.questionObj.id],T.isOfflineMark):l.bMT(7,7,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function ut(A,ke){if(1&A){const T=l.RV6();l.j41(0,"div")(1,"span",40),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG(2);return l.Njj(Ve.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Ut(A,ke){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function xt(A,ke){if(1&A&&(l.qex(0),l.nrm(1,"div",41),l.bVm()),2&A){const T=l.XpG(3);l.R7$(),l.Y8G("innerText",T.userAnswersObj["id_"+T.questionObj.id])}}function mn(A,ke){if(1&A&&(l.qex(0),l.DNE(1,Ut,3,3,"div",39)(2,xt,2,1,"ng-container",39),l.bVm()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===T.userAnswersObj["id_"+T.questionObj.id]),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+T.questionObj.id])}}function Kt(A,ke){if(1&A&&(l.j41(0,"div",38),l.DNE(1,ut,4,3,"div",39)(2,mn,3,2,"ng-container",39),l.k0s()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==T.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=T.currentTab)}}let an=(()=>{var A;class ke extends oe{}return(A=ke).\u0275fac=(()=>{let T;return function(Ve){return(T||(T=l.xGo(A)))(Ve||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-full-answer-for-student"]],features:[l.Vt3],decls:12,vars:23,consts:[[1,"question-standalone-answer-box-for-student","box","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngClass","ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center",3,"ngClass"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","mt-2 font-bold",3,"ngClass",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"mt-2","font-bold",3,"ngClass"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"keyText","my-1",3,"ngStyle"],[1,"keyText","my-1","ml-2"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[3,"ngClass"],["class","keyText my-1 font-medium flex",4,"ngIf"],["class","keyText my-1 font-medium text-red flex",4,"ngIf"],[1,"keyText","my-1","font-medium","flex"],[2,"width","100px"],[1,"flex","justify-between"],[4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"keyText","my-1","font-medium","text-red","flex"],["class","lalala ml-1",3,"ngStyle",4,"ngIf"],[1,"answer-box-type1","mt-2"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(ge,Ve){1&ge&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,st,4,12,"span",2)(3,te,4,13,"a",3),l.k0s(),l.DNE(4,Ae,5,10,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,tt,4,6,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,it,8,11,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,Kt,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&ge&&(l.Y8G("ngClass",l.eq3(17,nt,!Ve.isMobileDevice))("ngStyle",l.eq3(19,Et,2==Ve.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(),l.Y8G("ngClass",l.eq3(21,Ye,Ve.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=Ve.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Ve.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,9,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,11,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,13,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,15,Ve.questionObj)))},dependencies:[G.YU,G.Sq,G.bT,G.B3,Dt.Wk,k.WGl,N.F2,N.wp,N.V6,N.Zm,N.N3,N.FC,N.jr,N.C0,N.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),ke})();const In=A=>({"justify-content":A}),Bt=(A,ke)=>({width:A,"margin-right":ke,"margin-left":"8px"}),gt=()=>({"ml-1":!0}),dn=A=>[A],jn=A=>({backto:A}),Vt=()=>({"text-transform":"uppercase"});function Nn(A,ke){if(1&A){const T=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("ngStyle",l.l_i(7,Bt,T.isShowExplainButton?"125px":"0px",T.isShowExplainButton?"-40px":"0px")),l.BMQ("style",T.isShowExplainButton&&!T.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",T.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(10,gt))}}function gn(A,ke){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const T=l.XpG();l.Y8G("routerLink",l.eq3(8,dn,l.bMT(1,4,"/on-luyen/"+T.questionObj.practiceHashId)))("queryParams",l.eq3(10,jn,T.backToLink))("ngStyle",l.lJ4(12,Vt)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function Jt(A,ke){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function En(A,ke){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function fn(A,ke){if(1&A&&(l.j41(0,"span",13),l.DNE(1,Jt,3,3,"span",14)(2,En,3,3,"span",15),l.k0s()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+(null==T.questionObj?null:T.questionObj.id)]===T.key),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+(null==T.questionObj?null:T.questionObj.id)]!==T.key)}}function vn(A,ke){if(1&A){const T=l.RV6();l.j41(0,"div",11),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.showExplain())}),l.DNE(1,fn,3,2,"span",12),l.k0s()}if(2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function An(A,ke){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.nI1(3,"mytranslate"),l.k0s()),2&A){const T=l.XpG(3);l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")+" "+T.countCorrectAnswerTrueFalse()+" "+l.bMT(3,3,"lang_azt_answer")," ")}}function pn(A,ke){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_do_not_choose_any_correct_answer")," "))}function tr(A,ke){if(1&A&&(l.j41(0,"span",13),l.DNE(1,An,4,5,"span",14)(2,pn,3,3,"span",15),l.k0s()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",T.countCorrectAnswerTrueFalse()),l.R7$(),l.Y8G("ngIf",!T.countCorrectAnswerTrueFalse())}}function Ro(A,ke){if(1&A){const T=l.RV6();l.j41(0,"div",18),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.showExplain())}),l.DNE(1,tr,3,2,"span",12),l.k0s()}if(2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function Oo(A,ke){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function Po(A,ke){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function ko(A,ke){if(1&A&&(l.j41(0,"span",13),l.DNE(1,Oo,3,3,"span",14)(2,Po,3,3,"span",15),l.k0s()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",T.isFillAnswer),l.R7$(),l.Y8G("ngIf",!T.isFillAnswer)}}function Mo(A,ke){if(1&A){const T=l.RV6();l.j41(0,"div",19),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.showExplain())}),l.DNE(1,ko,3,2,"span",12),l.k0s()}if(2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function Do(A,ke){if(1&A){const T=l.RV6();l.j41(0,"div")(1,"span",22),l.bIt("click",function(){l.eBV(T);const Ve=l.XpG(2);return l.Njj(Ve.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Fo(A,ke){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Vo(A,ke){if(1&A&&(l.qex(0),l.nrm(1,"div",23),l.bVm()),2&A){const T=l.XpG(3);l.R7$(),l.Y8G("innerText",T.userAnswersObj["id_"+T.questionObj.id])}}function jo(A,ke){if(1&A&&(l.qex(0),l.DNE(1,Fo,3,3,"div",21)(2,Vo,2,1,"ng-container",21),l.bVm()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===T.userAnswersObj["id_"+T.questionObj.id]),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+T.questionObj.id])}}function No(A,ke){if(1&A&&(l.j41(0,"div",20),l.DNE(1,Do,4,3,"div",21)(2,jo,3,2,"ng-container",21),l.k0s()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==T.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=T.currentTab)}}let zo=(()=>{var A;class ke extends oe{countCorrectAnswerTrueFalse(){return this.labelArr.filter(ge=>this.sAztAnswerTrueFalseService.checkIsTrueType5(ge,this.keys,this.userAnswersObj["id_"+this.questionObj?.id])).length}}return(A=ke).\u0275fac=(()=>{let T;return function(Ve){return(T||(T=l.xGo(A)))(Ve||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-only-true-or-false-answer-for-student"]],features:[l.Vt3],decls:12,vars:17,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","answer-box-type1 cursor-pointer mt-2",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer","style","flex-wrap: wrap",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer",3,"click",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"answer-box-type1","cursor-pointer","mt-2",3,"click"],["class","font-medium text-base my-1 px-1",4,"ngIf"],[1,"font-medium","text-base","my-1","px-1"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-success"],[1,"text-danger"],[1,"answer-box-type1","mt-2","cursor-pointer",2,"flex-wrap","wrap",3,"click"],[1,"answer-box-type1","mt-2","cursor-pointer",3,"click"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(ge,Ve){1&ge&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,Nn,4,11,"span",2)(3,gn,4,13,"a",3),l.k0s(),l.DNE(4,vn,2,1,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,Ro,2,1,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,Mo,2,1,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,No,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&ge&&(l.Y8G("ngStyle",l.eq3(15,In,2==Ve.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(2),l.Y8G("ngIf",2!=Ve.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Ve.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,7,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,9,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,11,Ve.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,13,Ve.questionObj)))},dependencies:[G.YU,G.bT,G.B3,Dt.Wk,k.WGl,N.F2,N.wp,N.V6,N.Zm,N.N3,N.FC],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),ke})();function Bo(A,ke){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-full-answer-for-student",2),l.mxI("isShowExplainChange",function(Ve){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,Ve)||(jt.isShowExplain=Ve),l.Njj(Ve)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.isShowExplainChange.emit(Ve.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet)("isTeacherRole",T.isTeacherRole)("isShowOriginAnswer",T.isShowOriginAnswer),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}function ci(A,ke){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-only-true-or-false-answer-for-student",3),l.mxI("isShowExplainChange",function(Ve){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,Ve)||(jt.isShowExplain=Ve),l.Njj(Ve)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.isShowExplainChange.emit(Ve.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("isTeacherRole",T.isTeacherRole)("isShowOriginAnswer",T.isShowOriginAnswer)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}let Lo=(()=>{var A;class ke extends oe{constructor(){super(...arguments),this.checkShowFullAnswer=!1}ngOnInit(){this.checkShowFullAnswer=!(this.examConfig&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction&&!this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought)}}return(A=ke).\u0275fac=(()=>{let T;return function(Ve){return(T||(T=l.xGo(A)))(Ve||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-student"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(ge,Ve){1&ge&&l.DNE(0,Bo,1,11,"azt-answer-box-with-user-full-answer-for-student",0)(1,ci,1,11,"azt-answer-box-with-user-only-true-or-false-answer-for-student",1),2&ge&&(l.Y8G("ngIf",Ve.checkShowFullAnswer),l.R7$(),l.Y8G("ngIf",!Ve.checkShowFullAnswer))},dependencies:[G.bT,an,zo],encapsulation:2}),ke})();function ui(A,ke){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-student",2),l.mxI("isShowExplainChange",function(Ve){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,Ve)||(jt.isShowExplain=Ve),l.Njj(Ve)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.isShowExplainChange.emit(Ve.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet)("isTeacherRole",T.isTeacherRole)("isShowOriginAnswer",T.isShowOriginAnswer),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}function hi(A,ke){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-teacher",3),l.mxI("isShowExplainChange",function(Ve){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,Ve)||(jt.isShowExplain=Ve),l.Njj(Ve)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const Ve=l.XpG();return l.Njj(Ve.isShowExplainChange.emit(Ve.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet)("isShowOriginAnswer",T.isShowOriginAnswer)("isTeacherRole",T.isTeacherRole),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}let ls=(()=>{var A;class ke extends oe{ngOnInit(){}}return(A=ke).\u0275fac=(()=>{let T;return function(Ve){return(T||(T=l.xGo(A)))(Ve||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-view-base"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(ge,Ve){1&ge&&l.DNE(0,ui,1,11,"azt-answer-box-with-user-answer-for-student",0)(1,hi,1,11,"azt-answer-box-with-user-answer-for-teacher",1),2&ge&&(l.Y8G("ngIf",!Ve.isTeacherRole),l.R7$(),l.Y8G("ngIf",Ve.isTeacherRole))},dependencies:[G.bT,lt,Lo],encapsulation:2}),ke})()},84278:(vt,Pe,v)=>{v.d(Pe,{x:()=>xe});var l=v(64486),f=v(66793),c=v(30657),_=v(48891),w=v(54460),S=v(42789),H=v(60780),y=v(58447),oe=v(15423),G=v(52325),k=v(54313),N=v(34660),U=v(97760),ie=v(44101);const ze=Ee=>({"skeleton-box-loading":Ee}),re=(Ee,ue,Me)=>({"pb-2":Ee,"p-0":ue,"p-3":Me}),W=()=>[];function I(Ee,ue){if(1&Ee&&_.nrm(0,"div",3),2&Ee){const Me=_.XpG();_.Y8G("ngClass",_.eq3(1,ze,Me.renderConfigObj.isFirstRender))}}function J(Ee,ue){if(1&Ee&&_.nrm(0,"azt-test-audio-ui",15),2&Ee){const Me=_.XpG(2);_.Y8G("questionObj",Me.questionObj)("isShowList",!0)}}function ye(Ee,ue){if(1&Ee){const Me=_.RV6();_.j41(0,"div",4)(1,"div",5),_.nrm(2,"azt-question-group-content-box",6),_.j41(3,"div",7),_.DNE(4,J,1,2,"azt-test-audio-ui",8),_.j41(5,"div",9),_.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),_.k0s(),_.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),_.k0s()(),_.j41(10,"azt-answer-box-view-base",13),_.mxI("isShowExplainChange",function(Xe){_.eBV(Me);const Fe=_.XpG();return _.DH7(Fe.isShowExplain,Xe)||(Fe.isShowExplain=Xe),_.Njj(Xe)}),_.bIt("isShowExplainChange",function(Xe){_.eBV(Me);const Fe=_.XpG();return _.Njj(Fe.isShowExplain=Xe)}),_.k0s(),_.nrm(11,"azt-question-explain-box",14),_.k0s()}if(2&Ee){let Me;const Ce=_.XpG();_.R7$(),_.xc7("font-size","1em")("line-height","1.7"),_.Y8G("id","question_render_container_"+Ce.questionObj.id)("ngClass",_.sMw(42,re,Ce.questionObj.attachments.length>0,Ce.isMobileDevice,!Ce.isMobileDevice)),_.R7$(),_.Y8G("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj),_.R7$(2),_.Y8G("ngIf",Ce.questionObj.attachments.length>0),_.R7$(2),_.Y8G("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj)("curQuestionIndex",Ce.curQuestionIndex),_.R7$(),_.Y8G("showForTeacher",!1)("curExamResultId",null!==(Me=Ce.curExamResultId)&&void 0!==Me?Me:0)("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj)("curQuestionIndex",Ce.curQuestionIndex)("orgExamObjs",_.lJ4(46,W)),_.R7$(),_.Y8G("examObj",Ce.examObj)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj),_.R7$(),_.Y8G("examObj",Ce.examObj)("isShowOriginAnswer",Ce.isShowOriginAnswer)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj),_.R7$(),_.Y8G("examObj",Ce.examObj)("examConfig",Ce.examConfig)("isTeacherRole",!1)("isShowOriginAnswer",Ce.isShowOriginAnswer)("questionObj",Ce.questionObj)("userAnswersObj",Ce.userAnswersObj)("notShowAnswerYet",Ce.notShowAnswerYet),_.R50("isShowExplain",Ce.isShowExplain),_.Y8G("backToLink",Ce.backToLink)("isOfflineMark",Ce.isOfflineMark)("currentTab",Ce.currentTab),_.R7$(),_.Y8G("isShowExplain",Ce.isShowExplain)("questionObj",Ce.questionObj)("renderConfigObj",Ce.renderConfigObj)}}let xe=(()=>{var Ee;class ue extends l.I{ngOnInit(){super.ngOnInit();let Ce=new f.C(!1,!1,!1);super.initData(Ce,this.follower,this.questionObj),this.backToLink=`/test/answer-test/${this.examObj?.tenantId??0}/${this.examObj?.categoryId??0}/${this.examObj?.hashId}/${this.curExamResultId}`}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.isShowExplain=!1,this.isShowOriginAnswer=!1,this.isOfflineMark=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.checkShowFullAnswer=!1}}return(Ee=ue).\u0275fac=function(Ce){return new(Ce||Ee)},Ee.\u0275cmp=_.VBU({type:Ee,selectors:[["azt-question-standalone-for-student-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId",examConfig:"examConfig",isShowExplain:"isShowExplain",isShowOriginAnswer:"isShowOriginAnswer",isOfflineMark:"isOfflineMark",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[_.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","curExamResultId","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","isShowOriginAnswer","questionObj","renderConfigObj"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Ce,Xe){if(1&Ce&&(_.j41(0,"div",1),_.DNE(1,I,1,3,"div",2)(2,ye,12,47,"ng-template",null,0,_.C5r),_.k0s()),2&Ce){const Fe=_.sdS(3);_.Y8G("id","question_render_element_"+Xe.questionObj.id),_.R7$(),_.Y8G("ngIf",!Xe.renderConfigObj.isRenderElement)("ngIfElse",Fe)}},dependencies:[w.YU,w.bT,S.N,H.c,y.y,oe.N,G.Q,k.$,N.S,U.U,ie.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ue})()},34815:(vt,Pe,v)=>{v.d(Pe,{o:()=>ye});var l=v(64486),f=v(66793),c=v(30657),_=v(48891),w=v(54460),S=v(42789),H=v(60780),y=v(58447),oe=v(15423),G=v(52325),k=v(54313),N=v(34660),U=v(97760),ie=v(44101);const ze=xe=>({"skeleton-box-loading":xe}),re=(xe,Ee)=>({"pb-2":xe,"mob-web-width":Ee});function W(xe,Ee){if(1&xe&&_.nrm(0,"div",3),2&xe){const ue=_.XpG();_.Y8G("ngClass",_.eq3(1,ze,ue.renderConfigObj.isFirstRender))}}function I(xe,Ee){if(1&xe&&_.nrm(0,"azt-test-audio-ui",15),2&xe){const ue=_.XpG(2);_.Y8G("questionObj",ue.questionObj)("isShowList",!0)}}function J(xe,Ee){if(1&xe){const ue=_.RV6();_.j41(0,"div",4)(1,"div",5),_.nrm(2,"azt-question-group-content-box",6),_.j41(3,"div",7),_.DNE(4,I,1,2,"azt-test-audio-ui",8),_.j41(5,"div",9),_.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),_.k0s(),_.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),_.k0s()(),_.j41(10,"azt-answer-box-view-base",13),_.mxI("isShowExplainChange",function(Ce){_.eBV(ue);const Xe=_.XpG();return _.DH7(Xe.isShowExplain,Ce)||(Xe.isShowExplain=Ce),_.Njj(Ce)}),_.bIt("isShowExplainChange",function(Ce){_.eBV(ue);const Xe=_.XpG();return _.Njj(Xe.isShowExplain=Ce)}),_.k0s(),_.nrm(11,"azt-question-explain-box",14),_.k0s()}if(2&xe){const ue=_.XpG();_.R7$(),_.xc7("font-size","1em")("line-height","1.7"),_.Y8G("id","question_render_container_"+ue.questionObj.id)("ngClass",_.l_i(39,re,ue.questionObj.attachments.length>0,ue.isMobileWebView)),_.R7$(),_.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj),_.R7$(2),_.Y8G("ngIf",ue.questionObj.attachments.length>0),_.R7$(2),_.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj)("curQuestionIndex",ue.curQuestionIndex),_.R7$(),_.Y8G("showForTeacher",!0)("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj)("curQuestionIndex",ue.curQuestionIndex)("orgExamObjs",ue.orgExamObjs),_.R7$(),_.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj),_.R7$(),_.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("isShowOriginAnswer",ue.isShowOriginAnswer)("renderConfigObj",ue.renderConfigObj),_.R7$(),_.Y8G("examObj",ue.examObj)("isTeacherRole",!0)("isShowOriginAnswer",ue.isShowOriginAnswer)("questionObj",ue.questionObj)("userAnswersObj",ue.userAnswersObj)("notShowAnswerYet",ue.notShowAnswerYet)("isOfflineMark",ue.isOfflineMark),_.R50("isShowExplain",ue.isShowExplain),_.Y8G("currentTab",ue.currentTab),_.R7$(),_.Y8G("isShowExplain",ue.isShowExplain)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj)}}let ye=(()=>{var xe;class Ee extends l.I{ngOnInit(){super.ngOnInit();let Me=new f.C(!1,!1,!1);super.initData(Me,this.follower,this.questionObj)}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.orgExamObjs=[],this.isShowExplain=!1,this.isOfflineMark=!1,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab"}}return(xe=Ee).\u0275fac=function(Me){return new(Me||xe)},xe.\u0275cmp=_.VBU({type:xe,selectors:[["azt-question-standalone-for-teacher-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",orgExamObjs:"orgExamObjs",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isShowOriginAnswer:"isShowOriginAnswer",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[_.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"question-standalone-container","box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","questionObj","isShowOriginAnswer","renderConfigObj"],[3,"isShowExplainChange","examObj","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isOfflineMark","isShowExplain","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Me,Ce){if(1&Me&&(_.j41(0,"div",1),_.DNE(1,W,1,3,"div",2)(2,J,12,42,"ng-template",null,0,_.C5r),_.k0s()),2&Me){const Xe=_.sdS(3);_.Y8G("id","question_render_element_"+Ce.questionObj.id),_.R7$(),_.Y8G("ngIf",!Ce.renderConfigObj.isRenderElement)("ngIfElse",Xe)}},dependencies:[w.YU,w.bT,S.N,H.c,y.y,oe.N,G.Q,k.$,N.S,U.U,ie.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),Ee})()},97760:(vt,Pe,v)=>{v.d(Pe,{U:()=>Xe});var l=v(59640),f=v(95887),c=v(89163),_=v(33887),w=v(25539),S=v(48891),H=v(9280),y=v(54460),oe=v(52654),G=v(2915),k=v(52811),N=v(76975);function U(Fe,mt){1&Fe&&(S.j41(0,"div",10)(1,"span",11),S.nrm(2,"azt-loading-ui"),S.k0s(),S.j41(3,"span",12),S.EFF(4),S.nI1(5,"mytranslate"),S.k0s()()),2&Fe&&(S.R7$(4),S.JRh(S.bMT(5,1,"lang_auto_dang_chuan_bi_tai_lieu_doing")))}function ie(Fe,mt){1&Fe&&(S.j41(0,"div",13),S.EFF(1),S.nI1(2,"mytranslate"),S.k0s()),2&Fe&&(S.R7$(),S.SpI(" ",S.bMT(2,1,"lang_azt_cau_hoi_chua_co_lan_sua_nao")," "))}function ze(Fe,mt){if(1&Fe&&S.nrm(0,"azt-question-standalone-for-preview",17),2&Fe){const fe=S.XpG().$implicit,Ge=S.XpG();S.Y8G("examObj",Ge.data.examObj)("questionObj",fe.questionLog)("follower",Ge.data.follower)("curQuestionIndex",Ge.data.curQuestionIndex)}}function re(Fe,mt){if(1&Fe&&(S.qex(0),S.j41(1,"div",14),S.EFF(2),S.nI1(3,"mytranslate"),S.nI1(4,"formatFullDateTimeWithoutSecondByUserUnitPipe"),S.k0s(),S.j41(5,"div",15),S.DNE(6,ze,1,4,"azt-question-standalone-for-preview",16),S.k0s(),S.bVm()),2&Fe){const fe=mt.$implicit;S.R7$(2),S.SpI(" ",S.bMT(3,2,"lang_azota_ui_the_time_of_question_editing")+": "+S.bMT(4,4,fe.createdAt)," "),S.R7$(4),S.Y8G("ngIf",fe.questionLog)}}let W=(()=>{var Fe;class mt extends _._{closeDialog(){this.dialogRef.close()}getLogQuestion(Ge){this.initStatusObj(),this.waitDestroy(this.questionService.apiQuestionsIdLogsGet(Ge,this.data.isTeacher?void 0:this.data.curExamResultId).subscribe(he=>{he.success?((he.data?.objs??[]).forEach(Q=>{let se={createdAt:Q.createdAt,questionLog:this.commonService.castJsonToClassObj(w.I,JSON.stringify(Q.questionLog))};se.questionLog&&(se.questionLog.isLogEditQuestion=!0),this.questionLogCustomList.push(se)}),this.successStatusObj()):this.errorStatusObj(he.message??"",!0)}))}ngOnInit(){this.getLogQuestion(this.data.questionObj.id)}constructor(Ge,he,Ke){super(Ke,he),this.questionService=Ge,this.dialogRef=he,this.data=Ke,this.questionLogCustomList=[]}}return(Fe=mt).\u0275fac=function(Ge){return new(Ge||Fe)(S.rXU(H.wP),S.rXU(c.CP,8),S.rXU(c.Vh,8))},Fe.\u0275cmp=S.VBU({type:Fe,selectors:[["show-question-edit-history-dialog"]],features:[S.Vt3],decls:15,vars:13,consts:[[1,"box"],[1,"font-medium","p-3","bg-slate-100","dark:bg-darkmode-400"],[3,"defaultHeight"],["class","flex justify-center items-center h-40",4,"ngIf"],["id","boxContentQuestion",1,"p-2"],["class","flex p-5 justify-center items-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","pt-3"],[1,"ml-auto"],[1,"btn","btn-secondary",3,"click"],[1,"flex","justify-center","items-center","h-40"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"flex","p-5","justify-center","items-center"],[1,"p-2","pb-0","text-xs","font-medium",2,"margin-bottom","-10px"],[1,"p-2"],[3,"examObj","questionObj","follower","curQuestionIndex",4,"ngIf"],[3,"examObj","questionObj","follower","curQuestionIndex"]],template:function(Ge,he){1&Ge&&(S.j41(0,"div",0)(1,"div",1),S.EFF(2),S.nI1(3,"mytranslate"),S.nI1(4,"mytranslate"),S.k0s(),S.j41(5,"azt-mat-dialog-content",2),S.DNE(6,U,6,3,"div",3),S.j41(7,"div",4),S.DNE(8,ie,3,3,"div",5)(9,re,7,6,"ng-container",6),S.k0s()(),S.j41(10,"div",7)(11,"div",8)(12,"button",9),S.bIt("click",function(){return he.closeDialog()}),S.EFF(13),S.nI1(14,"mytranslate"),S.k0s()()()()),2&Ge&&(S.R7$(2),S.Lme(" ",S.bMT(3,7,"lang_azota_ui_the_history_of_question_editing")," (",he.questionLogCustomList.length+" "+S.bMT(4,9,"lang_testbank_powerpoint_times"),") "),S.R7$(3),S.Y8G("defaultHeight",60),S.R7$(),S.Y8G("ngIf",he.statusObj.loading),S.R7$(2),S.Y8G("ngIf",!he.questionLogCustomList.length&&!he.statusObj.loading),S.R7$(),S.Y8G("ngForOf",he.questionLogCustomList),S.R7$(4),S.SpI(" ",S.bMT(14,11,"lang_auto_dong")," "))},dependencies:[y.Sq,y.bT,oe.a,G.U,k.R,N.wp,N.bH],encapsulation:2}),mt})();var I=v(30657),J=v(46899),ye=v(65162),xe=v(9691),Ee=v(47712),ue=v(15343);function Me(Fe,mt){if(1&Fe){const fe=S.RV6();S.j41(0,"div",3)(1,"button",4),S.nI1(2,"mytranslate"),S.bIt("click",function(){S.eBV(fe);const he=S.XpG();return S.Njj(he.goToEditQuestion())}),S.nrm(3,"lucide-icon",5),S.k0s()()}2&Fe&&(S.R7$(),S.FS9("matTooltip",S.bMT(2,1,"lang_core_chinh_sua_de_thi")))}function Ce(Fe,mt){if(1&Fe){const fe=S.RV6();S.j41(0,"div")(1,"button",4),S.nI1(2,"mytranslate"),S.bIt("click",function(){S.eBV(fe);const he=S.XpG();return S.Njj(he.showEditHistoryDialog())}),S.nrm(3,"lucide-icon",6),S.k0s()()}2&Fe&&(S.R7$(),S.FS9("matTooltip",S.bMT(2,1,"lang_azota_ui_the_history_of_question_editing")))}let Xe=(()=>{var Fe;class mt extends l.H{checkEditQuestion(){const Ge=this.questionObj?.createdAt,he=this.questionObj?.updatedAt;let Ke=this.timeService.calculationTimeOnlyMinutes(Ge,he);this.isEditQuestion=Number(Ke)>0}isOrgQuestion(){return null!=this.orgExamObjs.find(Ge=>Ge.questionId==this.questionObj.id)}goToEditQuestion(){var Ge=this.commonService.getMyParam(this.activeRoute,"cat_id")??"0",he=this.activeRoute.snapshot.paramMap.get("result_id")??"0",Ke=this.activeRoute.snapshot.paramMap.get("user_id")??"",Q=this.activeRoute.snapshot.paramMap.get("student_id")??"",se=this.activeRoute.snapshot.paramMap.get("exam_id")??"",Be=Ge,we=se;let $=this.orgExamObjs.find(Dt=>Dt.questionId==this.questionObj.id);$&&(Be=$.orgCategoryId?.toString()??"0",we=$.orgExamId?.toString()??"0");var me=this.commonService.getMyQueryParam("backto")??"";let lt=`/admin/testbank/test-review/${se}/${Ke}/${Q}/${he}`+(me?"?backto="+encodeURIComponent(me):"");window.location.href=this.commonService.getLocalRouter("/admin/testbank/update-exam/"+Be)+"/"+we+"?backto="+encodeURIComponent(lt)+"&questionId="+this.questionObj.id}showEditHistoryDialog(){let Ge={follower:new I.e,examObj:this.examObj,questionObj:this.questionObj,renderConfigObj:this.renderConfigObj,curQuestionIndex:this.curQuestionIndex,curExamResultId:this.curExamResultId,isTeacher:this.showForTeacher};this.sAztDialogService.open(W,{width:"750px",data:Ge})}showFeedbackQuestionDialog(){this.sAztDialogService.open(f.g,{width:"750px",data:{questionObj:this.questionObj,role:this.showForTeacher?"TEACHER":"STUDENT",applyType:"MATRIX_QUESTION"},restoreFocus:!1,autoFocus:!1})}ngOnChanges(){this.checkEditQuestion()}constructor(Ge,he,Ke){super(),this.sAztDialogService=Ge,this.activeRoute=he,this.timeService=Ke,this.showForTeacher=!1,this.curExamResultId=0,this.isEditQuestion=!1}}return(Fe=mt).\u0275fac=function(Ge){return new(Ge||Fe)(S.rXU(J.i),S.rXU(ye.nX),S.rXU(xe.F))},Fe.\u0275cmp=S.VBU({type:Fe,selectors:[["azt-question-action-box"]],inputs:{examObj:"examObj",questionObj:"questionObj",renderConfigObj:"renderConfigObj",orgExamObjs:"orgExamObjs",showForTeacher:"showForTeacher",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId"},features:[S.Vt3,S.OA$],decls:4,vars:4,consts:[[1,"flex"],["class","mr-1",4,"ngIf"],[4,"ngIf"],[1,"mr-1"],[1,"btn","btn-outline-primary","btn-sm","p-1",3,"click","matTooltip"],["name","file-pen-line","size","18"],["name","history","size","18"]],template:function(Ge,he){1&Ge&&(S.j41(0,"div",0),S.DNE(1,Me,4,3,"div",1),S.nI1(2,"isOfflineExam"),S.DNE(3,Ce,4,3,"div",2),S.k0s()),2&Ge&&(S.R7$(),S.Y8G("ngIf",he.isOrgQuestion()&&!S.bMT(2,2,he.examObj)),S.R7$(2),S.Y8G("ngIf",he.isEditQuestion&&!he.questionObj.isLogEditQuestion))},dependencies:[y.bT,Ee.oV,ue.WGl,N.wp,N.st],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),mt})()},86622:(vt,Pe,v)=>{v.d(Pe,{C:()=>c});var l=v(71217),f=v(48891);let c=(()=>{var _;class w{constructor(){this.switchEssayTabSource=new l.t(!1),this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(H){this.switchEssayTabSource.next(H)}}return(_=w).\u0275fac=function(H){return new(H||_)},_.\u0275prov=f.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),w})()},95887:(vt,Pe,v)=>{v.d(Pe,{g:()=>Ge});var l=v(10936),f=v(89163),c=v(33887),_=v(15766),w=v(48891),S=v(96699),H=v(54460),y=v(43404),oe=v(15343),G=v(81587),k=v(52811),N=v(9570),U=v(76975);const ie=(he,Ke)=>({"btn-primary":he,"btn-secondary":Ke}),ze=()=>({"mr-2":!0});function re(he,Ke){if(1&he&&(w.j41(0,"div",22)(1,"b",23),w.EFF(2),w.k0s(),w.j41(3,"div",24),w.nrm(4,"azt-dynamic-hook",17),w.k0s()()),2&he){let Q;const se=Ke.$implicit;w.R7$(2),w.SpI("",null!==(Q=se.alpha)&&void 0!==Q?Q:se.key,"."),w.R7$(2),w.Y8G("content",se.content)}}function W(he,Ke){if(1&he&&(w.j41(0,"div",20),w.DNE(1,re,5,2,"div",21),w.k0s()),2&he){const Q=w.XpG(2);w.R7$(),w.Y8G("ngForOf",Q.data.questionObj.answers)}}function I(he,Ke){if(1&he&&(w.j41(0,"h2",25),w.EFF(1),w.nI1(2,"mytranslate"),w.k0s()),2&he){const Q=w.XpG(2);w.R7$(),w.Lme(" ",w.bMT(2,2,"lang_auto_dap_an"),": ",Q.data.questionObj.answerResult.join(", ")," ")}}function J(he,Ke){if(1&he&&(w.j41(0,"div",8)(1,"h2",10),w.EFF(2),w.nI1(3,"mytranslate"),w.k0s(),w.j41(4,"div",16),w.nrm(5,"azt-dynamic-hook",17),w.k0s(),w.DNE(6,W,2,1,"div",18)(7,I,3,4,"h2",19),w.k0s()),2&he){const Q=w.XpG();w.R7$(2),w.SpI(" ",w.bMT(3,4,"lang_auto_noi_dung_cau_hoi")," "),w.R7$(3),w.Y8G("content",Q.data.questionObj.content),w.R7$(),w.Y8G("ngIf",1==Q.data.questionObj.answerType&&Q.data.questionObj.answers&&Q.data.questionObj.answers.length>0),w.R7$(),w.Y8G("ngIf",Q.data.questionObj.answerResult&&Q.data.questionObj.isRoleTeacher)}}function ye(he,Ke){if(1&he&&(w.j41(0,"div",8)(1,"h2",26),w.EFF(2),w.nI1(3,"mytranslate"),w.k0s(),w.j41(4,"div",27),w.nrm(5,"azt-dynamic-hook",17),w.k0s()()),2&he){const Q=w.XpG();w.R7$(2),w.SpI(" ",w.bMT(3,2,"lang_auto_loi_giai")," "),w.R7$(3),w.Y8G("content",Q.data.questionObj.help)}}function xe(he,Ke){1&he&&(w.qex(0),w.j41(1,"div",28)(2,"span",29),w.nrm(3,"azt-loading-ui"),w.k0s()(),w.bVm())}function Ee(he,Ke){if(1&he&&(w.j41(0,"div",44),w.nrm(1,"input",45),w.j41(2,"label",46),w.EFF(3),w.nI1(4,"mytranslate"),w.k0s()()),2&he){const Q=Ke.$implicit,se=Ke.index;w.R7$(),w.FS9("id","choice_"+se),w.FS9("formControlName","choice_"+se),w.R7$(),w.FS9("for","choice_"+se),w.R7$(),w.SpI(" ",w.bMT(4,4,Q)," ")}}function ue(he,Ke){if(1&he&&(w.qex(0),w.j41(1,"div",42),w.DNE(2,Ee,5,6,"div",43),w.k0s(),w.bVm()),2&he){const Q=w.XpG().$implicit;w.R7$(),w.FS9("formGroupName","survey_"+Q.id),w.R7$(),w.Y8G("ngForOf",Q.choices)}}function Me(he,Ke){if(1&he&&(w.qex(0),w.j41(1,"mat-radio-button",49),w.EFF(2),w.nI1(3,"mytranslate"),w.k0s(),w.bVm()),2&he){const Q=Ke.$implicit,se=w.XpG(2).$implicit,Be=w.XpG(3);w.R7$(),w.FS9("value",Q),w.Y8G("checked",Be.form.controls["survey_"+se.id].value==Q),w.R7$(),w.JRh(w.bMT(3,3,Q))}}function Ce(he,Ke){if(1&he&&(w.j41(0,"mat-radio-group",47),w.DNE(1,Me,4,5,"ng-container",48),w.k0s()),2&he){const Q=w.XpG().$implicit;w.FS9("formControlName","survey_"+Q.id),w.R7$(),w.Y8G("ngForOf",Q.choices)}}function Xe(he,Ke){if(1&he&&(w.j41(0,"div",39)(1,"div",40)(2,"h2",41),w.EFF(3),w.nI1(4,"mytranslate"),w.k0s()(),w.j41(5,"div"),w.DNE(6,ue,3,2,"ng-container",11)(7,Ce,2,2,"ng-template",null,1,w.C5r),w.k0s()()),2&he){const Q=Ke.$implicit,se=Ke.index,Be=w.sdS(8);w.R7$(3),w.Lme(" ",se+1+". ","",w.bMT(4,4,Q.content)," "),w.R7$(3),w.Y8G("ngIf",Q.multiChoice&&Q.choices&&Q.choices.length>1)("ngIfElse",Be)}}function Fe(he,Ke){if(1&he&&(w.j41(0,"div"),w.DNE(1,Xe,9,6,"div",38),w.k0s()),2&he){const Q=w.XpG(2);w.R7$(),w.Y8G("ngForOf",Q.surveyObjs)}}function mt(he,Ke){if(1&he){const Q=w.RV6();w.DNE(0,Fe,2,1,"div",30),w.j41(1,"div",31)(2,"button",32),w.bIt("click",function(){w.eBV(Q);const Be=w.XpG();return w.Njj(Be.changeFeedBackEmotion(2))}),w.nrm(3,"lucide-icon",33),w.j41(4,"span"),w.EFF(5),w.nI1(6,"mytranslate"),w.k0s()(),w.j41(7,"button",34),w.bIt("click",function(){w.eBV(Q);const Be=w.XpG();return w.Njj(Be.changeFeedBackEmotion(1))}),w.nrm(8,"lucide-icon",35),w.j41(9,"span"),w.EFF(10),w.nI1(11,"mytranslate"),w.k0s()()(),w.j41(12,"div",36)(13,"textarea",37),w.nI1(14,"mytranslate"),w.bIt("keyup",function(){w.eBV(Q);const Be=w.XpG();return w.Njj(Be.autoResizeFeedBackArea())}),w.k0s()()}if(2&he){const Q=w.XpG();w.Y8G("ngIf",Q.surveyObjs.length),w.R7$(2),w.Y8G("disabled",Q.disableLike)("ngClass",w.l_i(16,ie,2==Q.feedBackEmotion,2!=Q.feedBackEmotion)),w.R7$(),w.Y8G("ngClass",w.lJ4(19,ze)),w.R7$(2),w.JRh(w.bMT(6,10,"lang_test_market_introduce_rating_like")),w.R7$(2),w.Y8G("disabled",Q.disableLike)("ngClass",w.l_i(20,ie,1==Q.feedBackEmotion,1!=Q.feedBackEmotion)),w.R7$(),w.Y8G("ngClass",w.lJ4(23,ze)),w.R7$(2),w.JRh(w.bMT(11,12,"lang_test_market_introduce_rating_dislike")),w.R7$(3),w.FS9("placeholder",w.bMT(14,14,"lang_global_question_ask_to_feedback_placeholder"))}}function fe(he,Ke){1&he&&(w.j41(0,"span",50),w.nrm(1,"azt-loading-ui"),w.k0s())}let Ge=(()=>{var he;class Ke extends c._{getAnswerSurvey(){let se=[],Be=this.commonService.getFormObj(this.form);for(let we in Be)if(we.includes("survey_")){let $={surveyId:Number(we.substring(we.indexOf("_")+1)),answers:[]};if(Be[we]instanceof Object){let me=this.surveyObjs.find(lt=>lt.id==$.surveyId);if(me)for(let lt in Be[we])if(Be[we][lt]){let Dt=Number(lt.substring(lt.indexOf("_")+1));if(Array.isArray(me.choices)&&me.choices[Dt]){let nt=me.choices[Dt];$.answers?.push(nt)}}}else $.answers=[Be[we]];se.push($)}return se}getFeedbackSurveys(){this.loadingFeedBackSurvey=!0,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksSurveysGet(this.applyType,this.role).subscribe(se=>{if(1==se.success){this.surveyObjs=se.data?.objs??[];let Be={feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,_.M.noWhiteSpace]})};this.surveyObjs.length>0&&this.surveyObjs.forEach(we=>{if(we.multiChoice&&we.choices&&we.choices.length>1){let $={};Be[`survey_${we.id}`]=new l.gE({}),we.choices.forEach((me,lt)=>{$[`choice_${lt}`]=new l.MJ(!1,{nonNullable:!0})}),Be[`survey_${we.id}`]=this.fb.group($)}else Be[`survey_${we.id}`]=new l.MJ("",{nonNullable:!0,validators:[l.k0.required]})}),this.form=this.fb.group(Be),this.loadingFeedBackSurvey=!1}else this.errorStatusObj(se.message??"",!0),this.loadingFeedBackSurvey=!1}))}getInfoFeedback(){this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksGet(this.questionId,this.applyType,this.role).subscribe(se=>{if(1==se.success){let Be=se.data?.objs??[];Be.length&&Be[0].status&&(this.feedBackEmotion=Be[0].status,this.disableLike=!0)}else this.errorStatusObj(se.message??"",!0),this.disableLike=!1}))}changeFeedBackEmotion(se){this.disableLike||(this.feedBackEmotion=se,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost({objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??void 0,content:"",surveyAnswers:[]}).subscribe(we=>{1==we.success?this.getInfoFeedback():this.errorStatusObj(we.message??"",!0)})))}autoResizeFeedBackArea(){const se=document.getElementById("text-area-feedback");se&&setTimeout(()=>{se.style.cssText="height:auto;",se.style.cssText="height:"+(se.scrollHeight+30)+"px"},0)}sendFeedBack(){if(this.form.invalid)this.showErrorSnack("lang_auto_vui_long_dien_day_du_thong_tin");else{this.initStatusObj(),this.sendingFeedBack=!0;let se={objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??0,content:this.form.controls.feedBackContent.value??void 0,surveyAnswers:this.getAnswerSurvey()};this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost(se).subscribe(Be=>{1==Be.success?(this.sendingFeedBack=!1,this.dialogRef.close(!0),this.successStatusObj("TEACHER"==this.role?"lang_test_market_success_feedback":"lang_test_market_success_feedback_student",!0)):(this.errorStatusObj(Be.message??"",!0),this.sendingFeedBack=!1)}))}}btnCloseDialog(){this.dialogRef.close(!1)}ngOnInit(){this.questionId=this.data.questionObj.id,this.role=this.data.role,this.applyType=this.data.applyType,this.form=this.fb.group({feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,_.M.noWhiteSpace]})}),this.getInfoFeedback(),this.getFeedbackSurveys(),super.ngOnInit()}constructor(se,Be,we,$){super($,we),this.fb=se,this.testMarketFeedbackService=Be,this.dialogRef=we,this.data=$,this.role="",this.applyType="",this.form=new l.gE({}),this.feedBackEmotion=void 0,this.totalLike=0,this.totalDislike=0,this.sendingFeedBack=!1,this.loadingFeedBackSurvey=!1,this.disableLike=!1,this.surveyObjs=[]}}return(he=Ke).\u0275fac=function(se){return new(se||he)(w.rXU(l.ok),w.rXU(S.l_),w.rXU(f.CP,8),w.rXU(f.Vh,8))},he.\u0275cmp=w.VBU({type:he,selectors:[["exam-matrix-feedback-dialog"]],features:[w.Vt3],decls:25,vars:19,consts:[["doneLoading",""],["SingleChoice",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-3","border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"intro-y","overflow-auto",2,"max-height","calc(100vh - 150px)"],[1,"text-md","mr-auto","font-bold"],["class","border-t border-slate-200/60 dark:border-darkmode-400 py-2 mt-2",4,"ngIf"],[1,"border-t","border-slate-200/60","dark:border-darkmode-400","py-2","mt-2"],[3,"formGroup"],[1,"font-medium","text-md","text-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"p-3","text-right"],["azt-track-service","exam-matrix-feedback-dialog-qXEblgFcT",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","exam-matrix-feedback-dialog-NGlD5D-IvA",1,"btn","btn-primary","mw-24",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"tex2jax_process","box-content",2,"width","auto"],[3,"content"],["class","grid grid-cols-12 gap-2 answers",4,"ngIf"],["class","font-medium text-md text-left text-success my-2",4,"ngIf"],[1,"grid","grid-cols-12","gap-2","answers"],["class","answer col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"answer","col-span-12","md:col-span-6"],[1,"answer-label"],[1,"answer-content"],[1,"font-medium","text-md","text-left","text-success","my-2"],[1,"font-medium","text-md","text-center"],[1,"help-content","box","px-3","mt-1",2,"display","inherit","border-top-right-radius","0","border-top-left-radius","0","box-shadow","none","overflow","auto","padding-bottom","20px"],[1,"flex","items-center","h-full","w-full"],[1,"w-8","h-8","mx-auto"],[4,"ngIf"],[1,"flex","items-center",2,"flex-wrap","wrap"],["azt-track-service","exam-matrix-feedback-dialog-PoMeFnagK",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-up","size","24",3,"ngClass"],["azt-track-service","exam-matrix-feedback-dialog-iJokCn34oQ",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-down","size","20",3,"ngClass"],[1,"items-center","mt-1"],["id","text-area-feedback","type","text","cols","10","rows","3","formControlName","feedBackContent",1,"form-control","mt-1",3,"keyup","placeholder"],["class","flex flex-wrap mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","mb-2"],[2,"min-width","300px"],[1,"text-md","mb-2"],[1,"block","px-2","ml-2","sm:flex",3,"formGroupName"],["class","mr-5",4,"ngFor","ngForOf"],[1,"mr-5"],["type","checkbox",1,"form-check-input",3,"id","formControlName"],[2,"vertical-align","middle","cursor","pointer","margin-left","3px",3,"for"],["color","primary",1,"px-2",2,"flex-direction","column",3,"formControlName"],[4,"ngFor","ngForOf"],[1,"mr-5",3,"checked","value"],[1,"w-4","h-4","mr-2"]],template:function(se,Be){if(1&se){const we=w.RV6();w.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),w.EFF(5),w.nI1(6,"mytranslate"),w.k0s(),w.DNE(7,J,8,6,"div",7)(8,ye,6,4,"div",7),w.j41(9,"div",8)(10,"form",9)(11,"h2",10),w.EFF(12),w.nI1(13,"mytranslate"),w.k0s(),w.DNE(14,xe,4,0,"ng-container",11)(15,mt,15,24,"ng-template",null,0,w.C5r),w.k0s()()()()(),w.j41(17,"div",12)(18,"button",13),w.bIt("click",function(){return w.eBV(we),w.Njj(Be.btnCloseDialog())}),w.EFF(19),w.nI1(20,"mytranslate"),w.k0s(),w.j41(21,"button",14),w.bIt("click",function(){return w.eBV(we),w.Njj(Be.sendFeedBack())}),w.DNE(22,fe,2,0,"span",15),w.EFF(23),w.nI1(24,"mytranslate"),w.k0s()()()}if(2&se){const we=w.sdS(16);w.R7$(5),w.SpI(" ",w.bMT(6,11,Be.data.questionObj.isRoleTeacher?"lang_global_question_ask_to_feedback":"lang_global_question_ask_to_report")," "),w.R7$(2),w.Y8G("ngIf",Be.data.questionObj.content),w.R7$(),w.Y8G("ngIf",Be.data.questionObj.help&&Be.data.questionObj.isRoleTeacher),w.R7$(2),w.Y8G("formGroup",Be.form),w.R7$(2),w.SpI(" ",w.bMT(13,13,"lang_auto_nhan_xet")," "),w.R7$(2),w.Y8G("ngIf",Be.loadingFeedBackSurvey)("ngIfElse",we),w.R7$(5),w.SpI(" ",w.bMT(20,15,"lang_auto_dong")," "),w.R7$(2),w.Y8G("disabled",Be.sendingFeedBack||Be.form.invalid),w.R7$(),w.Y8G("ngIf",Be.sendingFeedBack),w.R7$(),w.SpI(" ",w.bMT(24,17,"lang_button_send")," ")}},dependencies:[H.YU,H.Sq,H.bT,y.VT,y._g,l.qT,l.me,l.Zm,l.BC,l.cb,l.j4,l.JD,l.$R,oe.WGl,G.t,k.R,N.x,U.wp],styles:[".answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}"]}),Ke})()},14987:(vt,Pe,v)=>{v.d(Pe,{i:()=>y});var l=v(59640),f=v(48891),c=v(54460),_=v(10936),w=v(81587),S=v(76975);function H(oe,G){if(1&oe&&(f.j41(0,"div",1)(1,"form",2),f.nrm(2,"input",3),f.nI1(3,"mytranslate"),f.nrm(4,"input",4),f.nI1(5,"mytranslate"),f.k0s()()),2&oe){const k=f.XpG();f.R7$(),f.Y8G("formGroup",k.form),f.R7$(),f.FS9("placeholder",f.bMT(3,3,"lang_auto_ten_truong")),f.R7$(2),f.FS9("placeholder",f.bMT(5,5,"lang_auto_mon_hoc_form"))}}let y=(()=>{var oe;class G extends l.H{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject})}ngOnInit(){this.initData()}}return(oe=G).\u0275fac=function(N){return new(N||oe)},oe.\u0275cmp=f.VBU({type:oe,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},features:[f.Vt3],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"]],template:function(N,U){1&N&&f.DNE(0,H,6,7,"div",0),2&N&&f.Y8G("ngIf",U.form)},dependencies:[c.bT,_.qT,_.me,_.BC,_.cb,_.j4,_.JD,w.t,S.wp],encapsulation:2}),G})()},30551:(vt,Pe,v)=>{v.d(Pe,{P:()=>J});var l=v(59640),f=v(48891),c=v(37642),_=v(36484),w=v(99927),S=v(54460),H=v(60303),y=v(76975);const oe=ye=>({"font-bold":ye});function G(ye,xe){if(1&ye&&(f.j41(0,"td",11),f.EFF(1),f.k0s()),2&ye){const Ee=f.XpG().$implicit,ue=f.XpG().$implicit,Me=f.XpG(2);f.BMQ("rowspan",ue.length),f.R7$(),f.JRh(Me.toNumber(Ee.index)+1)}}function k(ye,xe){if(1&ye&&(f.qex(0),f.j41(1,"tr"),f.DNE(2,G,2,2,"td",10),f.j41(3,"td",11),f.EFF(4),f.nI1(5,"formatFullDateTimeTimezoneByUserUnitPipe"),f.k0s(),f.j41(6,"td",12),f.EFF(7),f.k0s()(),f.bVm()),2&ye){const Ee=xe.$implicit,ue=xe.index,Me=f.XpG(3);f.R7$(2),f.Y8G("ngIf",0==ue),f.R7$(2),f.JRh(f.bMT(5,4,1e3*Ee.second)),f.R7$(2),f.Y8G("ngClass",f.eq3(6,oe,Ee.isFontBold)),f.R7$(),f.JRh(Me.isShowOriginAnswer?Ee.key:Ee.alpha?Ee.alpha:Ee.key)}}function N(ye,xe){if(1&ye&&(f.qex(0),f.DNE(1,k,8,8,"ng-container",9),f.bVm()),2&ye){const Ee=xe.$implicit;f.R7$(),f.Y8G("ngForOf",Ee)}}function U(ye,xe){if(1&ye&&(f.j41(0,"table",5)(1,"tr")(2,"th",6),f.EFF(3),f.nI1(4,"mytranslate"),f.k0s(),f.j41(5,"th",7),f.EFF(6),f.nI1(7,"mytranslate"),f.k0s(),f.j41(8,"th",8),f.EFF(9),f.nI1(10,"mytranslate"),f.k0s()(),f.DNE(11,N,2,1,"ng-container",9),f.k0s()),2&ye){const Ee=f.XpG();f.R7$(3),f.JRh(f.bMT(4,4,"lang_auto_cau_hoi")),f.R7$(3),f.JRh(f.bMT(7,6,"lang_auto_thoi_gian")),f.R7$(3),f.JRh(f.bMT(10,8,"lang_auto_dap_an")),f.R7$(2),f.Y8G("ngForOf",Ee.groupObjs)}}function ie(ye,xe){1&ye&&(f.j41(0,"div",13),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&ye&&(f.R7$(),f.JRh(f.bMT(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}function ze(ye,xe){if(1&ye&&(f.qex(0),f.j41(1,"tr")(2,"td",11),f.EFF(3),f.k0s(),f.j41(4,"td",11),f.EFF(5),f.nI1(6,"formatFullDateTimeTimezoneByUserUnitPipe"),f.k0s(),f.j41(7,"td",11),f.EFF(8),f.k0s()(),f.bVm()),2&ye){let Ee;const ue=xe.$implicit;f.R7$(3),f.JRh(ue.userAgent),f.R7$(2),f.JRh(f.bMT(6,3,null!==(Ee=ue.startedAt)&&void 0!==Ee?Ee:"")),f.R7$(3),f.JRh(ue.ip)}}function re(ye,xe){if(1&ye&&(f.j41(0,"table",5)(1,"tr")(2,"th",6),f.EFF(3),f.nI1(4,"mytranslate"),f.k0s(),f.j41(5,"th",7),f.EFF(6),f.nI1(7,"mytranslate"),f.k0s(),f.j41(8,"th",8),f.EFF(9),f.nI1(10,"mytranslate"),f.k0s()(),f.DNE(11,ze,9,5,"ng-container",9),f.k0s()),2&ye){const Ee=f.XpG(2);f.R7$(3),f.JRh(f.bMT(4,4,"lang_auto_thong_tin_thiet_bi")),f.R7$(3),f.JRh(f.bMT(7,6,"lang_auto_thoi_gian")),f.R7$(3),f.JRh(f.bMT(10,8,"IP")),f.R7$(2),f.Y8G("ngForOf",Ee.ipTrackingDataObjs)}}function W(ye,xe){1&ye&&(f.j41(0,"div",13),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&ye&&(f.R7$(),f.JRh(f.bMT(2,1,"lang_auto_khong_co_du_lieu")))}function I(ye,xe){if(1&ye&&(f.j41(0,"mat-tab",1),f.nI1(1,"mytranslate"),f.j41(2,"div",2),f.DNE(3,re,12,10,"table",3)(4,W,3,3,"ng-template",null,0,f.C5r),f.k0s()()),2&ye){const Ee=f.sdS(5),ue=f.XpG();f.FS9("label",f.bMT(1,3,"lang_auto_thong_tin_thiet_bi_IP")),f.R7$(3),f.Y8G("ngIf",ue.ipTrackingDataObjs.length>0)("ngIfElse",Ee)}}let J=(()=>{var ye;class xe extends l.H{findReTapQuesions(){var ue=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var Me in ue)if(ue.hasOwnProperty(Me)){var Ce=ue[Me].map((Xe,Fe)=>{let mt=!1,fe=this.questionObjs.find(Ge=>Ge.id==Xe.questionId);if(this.answerTypeService.isTrueFalseAnswer(fe)){for(let Ge=ue[Me].length-1;Ge>=0;Ge--)if(ue[Me][Ge].key.includes(Xe.key.split("")[0])){mt=Xe.key==ue[Me][Ge].key;break}}else mt=Fe==ue[Me].length-1;return{...Xe,isFontBold:mt}});this.groupObjs.push(Ce)}}toNumber(ue){return parseInt(ue,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(ue,Me,Ce){super(),this.dictionaryService=ue,this.userService=Me,this.answerTypeService=Ce,this.startQuestionIndex=1,this.isShowOriginAnswer=!1,this.ipTrackingDataObjs=[],this.isTeacherRole=this.userService.isTeacherRole(),this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return(ye=xe).\u0275fac=function(ue){return new(ue||ye)(f.rXU(c.E),f.rXU(_.R),f.rXU(w._))},ye.\u0275cmp=f.VBU({type:ye,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",isShowOriginAnswer:"isShowOriginAnswer",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs",ipTrackingDataObjs:"ipTrackingDataObjs",questionObjs:"questionObjs"},features:[f.Vt3],decls:8,vars:6,consts:[["noData",""],[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],[3,"label",4,"ngIf"],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(ue,Me){if(1&ue&&(f.j41(0,"mat-tab-group")(1,"mat-tab",1),f.nI1(2,"mytranslate"),f.j41(3,"div",2),f.DNE(4,U,12,10,"table",3)(5,ie,3,3,"ng-template",null,0,f.C5r),f.k0s()(),f.DNE(7,I,6,5,"mat-tab",4),f.k0s()),2&ue){const Ce=f.sdS(6);f.R7$(),f.FS9("label",f.bMT(2,4,"lang_auto_chi_tiet_chon_dap_an")),f.R7$(3),f.Y8G("ngIf",Me.groupObjs.length>0)("ngIfElse",Ce),f.R7$(3),f.Y8G("ngIf",Me.isTeacherRole)}},dependencies:[S.YU,S.Sq,S.bT,H.mq,H.T8,y.wp,y.Ky],encapsulation:2}),xe})()},72802:(vt,Pe,v)=>{v.d(Pe,{f:()=>Et});var l=v(27691),f=v(48891),c=v(10936),_=v(67421),w=v(59640),S=v(30657),H=v(83229),y=v(51913),oe=v(40949),G=v(55465),k=v(35095),N=v(41426),U=v(54460),ie=v(47712),ze=v(15343),re=v(7919),W=v(81587),I=v(84278),J=v(34815),ye=v(76975);const xe=["mnoteContainer"],Ee=Ye=>({display:Ye}),ue=Ye=>({border:Ye}),Me=()=>({"mr-1":!0}),Ce=Ye=>({"is-invalid":Ye});function Xe(Ye,ft){1&Ye&&(f.j41(0,"span"),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&Ye&&(f.R7$(),f.SpI(" ",f.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Fe(Ye,ft){1&Ye&&(f.j41(0,"span"),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&Ye&&(f.R7$(),f.SpI(" ",f.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function mt(Ye,ft){1&Ye&&(f.j41(0,"span"),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&Ye&&(f.R7$(),f.SpI(" ",f.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function fe(Ye,ft){if(1&Ye&&(f.j41(0,"div",18),f.DNE(1,Xe,3,3,"span",19)(2,Fe,3,3,"span",19)(3,mt,3,3,"span",19),f.k0s()),2&Ye){const Je=f.XpG().index,je=f.XpG();f.R7$(),f.Y8G("ngIf",null==je.form.controls["cau"+Je].errors?null:je.form.controls["cau"+Je].errors.min),f.R7$(),f.Y8G("ngIf",null==je.form.controls["cau"+Je].errors?null:je.form.controls["cau"+Je].errors.max),f.R7$(),f.Y8G("ngIf",null==je.form.controls["cau"+Je].errors?null:je.form.controls["cau"+Je].errors.pattern)}}function Ge(Ye,ft){if(1&Ye){const Je=f.RV6();f.j41(0,"div",11)(1,"div",12)(2,"lucide-icon",13),f.nI1(3,"mytranslate"),f.bIt("click",function(K){const ae=f.eBV(Je).index,de=f.XpG();return f.Njj(de.toggleVisibility(K,ae))}),f.k0s(),f.j41(4,"span",14),f.EFF(5),f.nI1(6,"mytranslate"),f.j41(7,"span",15),f.nI1(8,"mytranslate"),f.EFF(9),f.nI1(10,"mytranslate"),f.k0s()(),f.nrm(11,"input",16),f.nI1(12,"mytranslate"),f.k0s(),f.DNE(13,fe,4,3,"div",17),f.k0s()}if(2&Ye){let Je;const je=ft.$implicit,K=ft.index,ae=f.XpG();f.Y8G("ngStyle",f.eq3(25,ue,K==ae.questions.length-1?"none":"")),f.R7$(2),f.FS9("matTooltip",f.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),f.Y8G("ngClass",f.lJ4(27,Me)),f.R7$(3),f.Lme(" ",f.bMT(6,17,"lang_auto_cau")," ",(null!==(Je=je.indexLabel)&&void 0!==Je?Je:0)+1," "),f.R7$(2),f.FS9("matTooltip",f.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),f.R7$(2),f.Lme("(",je.essMaxPoint," ",f.bMT(10,21,"lang_auto_diem_brackets"),""),f.R7$(2),f.FS9("placeholder",f.bMT(12,23,"lang_auto_nhap_diem")),f.Mz_("formControlName","cau",K,""),f.Y8G("readonly",!ae.showForTeacher)("decimal",!0)("ngClass",f.eq3(28,Ce,ae.form.controls["cau"+K]&&ae.form.controls["cau"+K].invalid)),f.R7$(2),f.Y8G("ngIf",ae.form.controls["cau"+K].errors)}}function he(Ye,ft){if(1&Ye){const Je=f.RV6();f.j41(0,"div",20)(1,"button",21),f.bIt("click",function(){f.eBV(Je);const K=f.XpG();return f.Njj(K.getMnoteJsonData())}),f.EFF(2),f.nI1(3,"mytranslate"),f.nI1(4,"mytranslate"),f.k0s()()}if(2&Ye){const Je=f.XpG();f.R7$(),f.Y8G("disabled",Je.isLoading||Je.form.invalid),f.R7$(),f.SpI(" ",Je.isLoading?f.bMT(3,2,"lang_auto_dang_luu_doing"):f.bMT(4,4,"lang_auto_luu_diem")," ")}}function Ke(Ye,ft){if(1&Ye&&f.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Ye){let Je;const je=f.XpG().$implicit,K=f.XpG();f.Y8G("follower",K.followerRenderQuest)("examObj",K.examObj)("examConfig",K.examConfig)("questionObj",je)("curQuestionIndex",null!==(Je=je.indexLabel)&&void 0!==Je?Je:0)("userAnswersObj",K.userAnswersObj)("currentTab","essay_tab")}}function Q(Ye,ft){if(1&Ye&&f.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Ye){let Je;const je=f.XpG().$implicit,K=f.XpG();f.Y8G("follower",K.followerRenderQuest)("examObj",K.examObj)("questionObj",je)("curQuestionIndex",null!==(Je=je.indexLabel)&&void 0!==Je?Je:0)("userAnswersObj",K.userAnswersObj)("orgExamObjs",K.orgExamObjs)("currentTab","essay_tab")}}function se(Ye,ft){1&Ye&&(f.j41(0,"span"),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&Ye&&(f.R7$(),f.SpI(" ",f.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Be(Ye,ft){1&Ye&&(f.j41(0,"span"),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&Ye&&(f.R7$(),f.SpI(" ",f.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function we(Ye,ft){1&Ye&&(f.j41(0,"span"),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&Ye&&(f.R7$(),f.SpI(" ",f.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function $(Ye,ft){if(1&Ye&&(f.j41(0,"div",18),f.DNE(1,se,3,3,"span",19)(2,Be,3,3,"span",19)(3,we,3,3,"span",19),f.k0s()),2&Ye){const Je=f.XpG(2).index,je=f.XpG();f.R7$(),f.Y8G("ngIf",null==je.form.controls["cau"+Je].errors?null:je.form.controls["cau"+Je].errors.min),f.R7$(),f.Y8G("ngIf",null==je.form.controls["cau"+Je].errors?null:je.form.controls["cau"+Je].errors.max),f.R7$(),f.Y8G("ngIf",null==je.form.controls["cau"+Je].errors?null:je.form.controls["cau"+Je].errors.pattern)}}function me(Ye,ft){if(1&Ye&&(f.j41(0,"div",29)(1,"form",30)(2,"label",31),f.EFF(3),f.nI1(4,"mytranslate"),f.j41(5,"span",15),f.nI1(6,"mytranslate"),f.EFF(7),f.nI1(8,"mytranslate"),f.k0s(),f.EFF(9," : "),f.k0s(),f.nrm(10,"input",32),f.nI1(11,"mytranslate"),f.DNE(12,$,4,3,"div",17),f.k0s()()),2&Ye){let Je;const je=f.XpG(),K=je.$implicit,ae=je.index,de=f.XpG();f.R7$(),f.Y8G("formGroup",de.form),f.R7$(),f.FS9("for","cau_"+ae),f.R7$(),f.Lme(" ",f.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(Je=K.indexLabel)&&void 0!==Je?Je:0)+1," "),f.R7$(2),f.FS9("matTooltip",f.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),f.R7$(2),f.Lme("(",K.essMaxPoint," ",f.bMT(8,19,"lang_auto_diem_brackets"),""),f.R7$(3),f.FS9("placeholder",f.bMT(11,21,"lang_auto_nhap_diem")),f.Mz_("formControlName","cau",ae,""),f.Y8G("readonly",!de.showForTeacher)("ngClass",f.eq3(23,Ce,de.form.controls["cau"+ae]&&de.form.controls["cau"+ae].invalid))("id","cau_"+ae)("decimal",!0),f.R7$(2),f.Y8G("ngIf",de.form.controls["cau"+ae].errors)}}function lt(Ye,ft){if(1&Ye&&(f.j41(0,"div",22)(1,"div",23),f.DNE(2,Ke,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,Q,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,me,13,25,"div",26),f.k0s()()),2&Ye){const Je=ft.index,je=f.XpG();f.R7$(),f.Mz_("id","q_",Je,""),f.R7$(),f.Y8G("ngIf",!je.showForTeacher),f.R7$(),f.Y8G("ngIf",je.showForTeacher),f.R7$(),f.Y8G("ngIf",je.showForTeacher)}}function Dt(Ye,ft){1&Ye&&(f.j41(0,"div",33)(1,"b"),f.EFF(2),f.nI1(3,"mytranslate"),f.k0s(),f.EFF(4),f.nI1(5,"mytranslate"),f.k0s()),2&Ye&&(f.R7$(2),f.SpI("",f.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),f.R7$(2),f.SpI(" ",f.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function nt(Ye,ft){if(1&Ye){const Je=f.RV6();f.j41(0,"div",34)(1,"button",35),f.bIt("click",function(){f.eBV(Je);const K=f.XpG();return f.Njj(K.getMnoteJsonData())}),f.EFF(2),f.nI1(3,"mytranslate"),f.nI1(4,"mytranslate"),f.k0s()()}if(2&Ye){const Je=f.XpG();f.R7$(),f.Y8G("disabled",Je.isLoading||Je.form.invalid),f.R7$(),f.SpI(" ",Je.isLoading?f.bMT(3,2,"lang_auto_dang_luu_doing"):f.bMT(4,4,"lang_auto_luu_diem")," ")}}let Et=(()=>{var Ye;class ft extends w.H{parseValue(je){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[je]}getMaxPoint(je){var K=0;for(let ae=0;ae<this.questions.length;ae++)if(this.questions[ae].id==je){K=this.questions[ae].scorePerQuestion??0;break}return K}toggleVisibility(je,K){var ae=je.target,de=document.getElementById(`q_${K}`);de&&("block"==de?.style.display?(de.style.display="none",ae&&(ae.textContent="visibility_off")):(de.style.display="block",ae&&(ae.textContent="visibility")))}isValidPoint(){let je=0;var K=this.form.value;for(var ae in K){var de=Number(ae.substring(3));K[ae]>this.maxPointPerQuestion[de]&&je++}return!(je>0)}validateForm(je,K,ae,de){let j="";this.form.get("cau"+de)?.valueChanges.pipe((0,_.J)()).subscribe(([C,M])=>{if(j="string"==typeof M&&M.includes(",")?M.replace(",","."):M,isNaN(+j))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+de].setValue(K);else{let V=parseFloat(j);V>ae&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),V<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(je,K){var ae=(0,H.q)(je);this.apiUploadService.commonUploadForMarkResult(ae,`essay_note_${K}_${this.resultID}.png`,"image/png").subscribe(de=>{de.type!=l.hv.UploadProgress&&(1==de.success?(this.mnoteJsonData.pages[K].draw=de.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(je){this.pagesCount=0;for(let K=0;K<je.length;K++)je[K].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let K=0;K<je.length;K++)je[K].draw&&this.uploadBase64ToCDN(je[K].draw,K)}sendDataToIframe(){const je=document.getElementById("mNote"),K=je?je.contentWindow:null;if(null!==K)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var ae=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=ae){for(let j=0;j<ae.pages.length;j++)ae.pages[j].backgroundImage&&(ae.pages[j].backgroundImage=this.cdnService.getMyCdn(ae.pages[j].backgroundImage)),ae.pages[j].draw&&(ae.pages[j].draw=this.cdnService.getMyCdn(ae.pages[j].draw));ae=JSON.stringify(ae),this.examResultObj.result=ae}}var de=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(de?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let j=0;j<this.jsonData.pages.length;j++)this.jsonData.pages[j].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[j].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[j].backgroundImage)),this.jsonData.pages[j].hasOwnProperty("draw")&&(this.jsonData.pages[j].draw=this.cdnService.getMyCdn(this.jsonData.pages[j].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),K.postMessage(this.jsonData,"*")}else{let j=[];this.files.forEach(M=>{var V=this.cdnService.getMyCdn(M.url);V&&j.push({backgroundImage:V})}),K.postMessage({cmd:"initMNote",pages:j,mode:this.showForTeacher?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:j}}}checkMapBGImageWithFileLength(je){var K=this.commonService.willDeleteParseJson(je);let ae=!1;if(0==this.files.length)ae=!0;else if(this.files.length>0&&K&&K.pages&&this.files.length==K.pages.length){let de=0;this.files.forEach((j,C)=>{K.pages[C]&&K.pages[C].backgroundImage&&K.pages[C].backgroundImage.indexOf(j.path)>-1&&de++}),de==this.files.length&&(ae=!0)}return ae}addBGImageByFileUrl(je){var K=this.commonService.willDeleteParseJson(je);return this.files.forEach((ae,de)=>{let j=!1;if(K&&K.pages){for(var C=0;C<K.pages.length;C++)if(K.pages[C]&&K.pages[C].backgroundImage&&K.pages[C].backgroundImage.indexOf(ae.path)>-1){j=!0;break}!1===j&&(K.pages[de]&&K.pages[de].id==de?K.pages[de].backgroundImage=this.cdnService.getMyCdn(ae.url??""):K.pages.splice(de,0,{backgroundImage:this.cdnService.getMyCdn(ae.url??"")}))}}),JSON.stringify(K)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let je=!1;for(const K in this.form.value)""!==this.form.value[K]&&(je=!0);if(!je)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const K in this.form.value)""===this.form.value[K]&&(this.form.value[K]=0,this.form.controls[K].setValue(0));if(this.files&&this.files.length>0){const K=document.getElementById("mNote"),ae=K?K.contentWindow:null;null!==ae&&ae.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(je){if(this.checkMapBGImageWithFileLength(je)){for(const j in this.form.value)"string"==typeof this.form.value[j]&&this.form.value[j].includes(",")&&(this.form.value[j]=this.form.value[j].replace(",","."));let de=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var ae={id:this.resultID,result:je,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(ae,de).subscribe(j=>{1==j.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(j.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";var je={};let K;this.examResultObj.confirmedAt&&(K=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(de=>{let j=this.getMaxPoint(de.id);this.totalMaxPoint+=j,de.essMaxPoint=j,this.maxPointPerQuestion.push(de.essMaxPoint)});for(let de=0;de<this.questions.length;de++){var ae=`cau${de}`;je[ae]=new c.MJ(K?K[ae]:"",{validators:[c.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),c.k0.min(0),c.k0.max(this.questions[de].essMaxPoint??0)]})}this.form=new c.gE(je),this.form.valueChanges.subscribe(de=>{let j=JSON.stringify(de);j!=this.prevData&&(this.prevData=j,this.form.patchValue(de))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(je,K,ae,de,j){super(),this.permissionService=je,this.cdnService=K,this.envService=ae,this.examResultService=de,this.apiUploadService=j,this.orgExamObjs=[],this.questions=[],this.files=[],this.userAnswersObj={},this.resultID=0,this.whiteListMNoteIframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new f.bkB,this.followerRenderQuest=new S.e,this.form=new c.gE({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=C=>{"MNoteJson"==C.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=C.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==C.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(Ye=ft).\u0275fac=function(je){return new(je||Ye)(f.rXU(y.p),f.rXU(oe.B),f.rXU(G.t),f.rXU(k._),f.rXU(N.T))},Ye.\u0275cmp=f.VBU({type:Ye,selectors:[["azt-mark-essay"]],viewQuery:function(je,K){if(1&je&&f.GBs(xe,5),2&je){let ae;f.mGM(ae=f.lsd())&&(K.mnoteContainer=ae.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",examResultObj:"examResultObj",userAnswersObj:"userAnswersObj",resultID:"resultID",whiteListMNoteIframeSrc:"whiteListMNoteIframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode"},outputs:{saveResultEvent:"saveResultEvent"},features:[f.Vt3],decls:12,vars:12,consts:[["mnoteContainer",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(je,K){1&je&&(f.j41(0,"div",1)(1,"form",2),f.DNE(2,Ge,14,30,"div",3),f.k0s(),f.DNE(3,he,5,6,"div",4),f.k0s(),f.j41(4,"div",5),f.DNE(5,lt,5,5,"div",6),f.k0s(),f.DNE(6,Dt,6,6,"div",7),f.j41(7,"div",8,0),f.nrm(9,"iframe",9),f.nI1(10,"safe"),f.k0s(),f.DNE(11,nt,5,6,"div",10)),2&je&&(f.R7$(),f.Y8G("formGroup",K.form),f.R7$(),f.Y8G("ngForOf",K.questions),f.R7$(),f.Y8G("ngIf",K.showForTeacher),f.R7$(2),f.Y8G("ngForOf",K.questions),f.R7$(),f.Y8G("ngIf",K.files&&0==K.files.length),f.R7$(),f.Y8G("ngStyle",f.eq3(10,Ee,K.files&&0==K.files.length?"none":"block")),f.R7$(2),f.Y8G("src",f.bMT(10,8,K.whiteListMNoteIframeSrc),f.f$h),f.R7$(2),f.Y8G("ngIf",K.showForTeacher))},dependencies:[U.YU,U.Sq,U.bT,U.B3,ie.oV,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,ze.WGl,re.Z,W.t,I.x,J.o,ye.wp,ye.JI],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ft})()},74225:function(vt,Pe,v){var l=this&&this.__awaiter||function(w,S,H,y){return new(H||(H=Promise))(function(G,k){function N(ze){try{ie(y.next(ze))}catch(re){k(re)}}function U(ze){try{ie(y.throw(ze))}catch(re){k(re)}}function ie(ze){ze.done?G(ze.value):function oe(G){return G instanceof H?G:new H(function(k){k(G)})}(ze.value).then(N,U)}ie((y=y.apply(w,S||[])).next())})};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.decodeScanOfflineFile=Pe.decode=void 0;const f=v(6178);Pe.decode=function c(w){return l(this,void 0,void 0,function*(){return f.AzotaFileDecode.decode(w)})},Pe.decodeScanOfflineFile=function _(w){return l(this,void 0,void 0,function*(){return f.AzotaFileDecode.decodeScanOfflineFile(w)})}},25028:(vt,Pe,v)=>{Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.AzotaFile=Pe.FileType=void 0;const l=v(56784),f=v(70073);class c{}Pe.FileType=c,c.scanOffline="scanOffline";class _{constructor(){}static fromZipFolder(S){let H=new _;return H.folder=S,H.readAztMain(),H}readAztMain(){let S=this.folder.getUtf8Text("main.json");if(null==S)throw new l.InvalidAztFileException("Couldn't found main.json file");this.aztMain=f.AztMain.fromJsonString(S)}}Pe.AzotaFile=_},6178:function(vt,Pe,v){var l=this&&this.__awaiter||function(S,H,y,oe){return new(y||(y=Promise))(function(k,N){function U(re){try{ze(oe.next(re))}catch(W){N(W)}}function ie(re){try{ze(oe.throw(re))}catch(W){N(W)}}function ze(re){re.done?k(re.value):function G(k){return k instanceof y?k:new y(function(N){N(k)})}(re.value).then(U,ie)}ze((oe=oe.apply(S,H||[])).next())})};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.AzotaFileDecode=void 0;const f=v(59985),c=v(25589),_=v(25028);class w{static decode(H){return l(this,void 0,void 0,function*(){return f.ZipFolder.fromZip(H).then(y=>{let oe=_.AzotaFile.fromZipFolder(y);return oe.aztMain.fileType==_.FileType.scanOffline?c.ScanOfflineFile.fromZipFolder(oe.folder):oe})})}static decodeScanOfflineFile(H){return w.decode(H).then(y=>y)}}Pe.AzotaFileDecode=w},70073:(vt,Pe,v)=>{Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.AztMain=void 0;const l=v(37182);class f{static fromJsonString(_){return f.fromJson(JSON.parse(_))}static fromJson(_){return(0,l.plainToInstance)(f,_)}}Pe.AztMain=f},56784:(vt,Pe)=>{Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.InvalidAztFileException=void 0;class v extends Error{constructor(f){super(f)}}Pe.InvalidAztFileException=v},81163:(vt,Pe,v)=>{Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Point2d=Pe.DrawingRectangle=Pe.DrawingCircle=Pe.AnswerRegionResult=Pe.StudentCodeRegionResult=Pe.ExamCodeRegionResult=Pe.ScanOfflineResult=Pe.ScanOfflineData=void 0;const l=v(37182);class f{static fromJsonString(k){return f.fromJson(JSON.parse(k))}static fromJson(k){return(0,l.plainToInstance)(f,k)}}Pe.ScanOfflineData=f,Pe.ScanOfflineResult=class c{},Pe.ExamCodeRegionResult=class _{},Pe.StudentCodeRegionResult=class w{},Pe.AnswerRegionResult=class S{},Pe.DrawingCircle=class H{},Pe.DrawingRectangle=class y{},Pe.Point2d=class oe{}},25589:(vt,Pe,v)=>{Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.ScanOfflineFile=void 0;const l=v(25028),f=v(56784),c=v(81163);class _ extends l.AzotaFile{constructor(){super()}static fromZipFolder(S){let H=new _;if(H.folder=S,H.readAztMain(),H.aztMain.fileType!=l.FileType.scanOffline)throw new f.InvalidAztFileException(`fileType must be ${l.FileType.scanOffline}`);let oe=S.getUtf8Text(H.aztMain.detailPath);if(null==oe)throw new f.InvalidAztFileException(`Couldn't found ${oe} file`);return H.scanOfflineData=c.ScanOfflineData.fromJsonString(oe),H}getWrappedImage(){var S,H;return null==(null===(H=null===(S=this.scanOfflineData)||void 0===S?void 0:S.scanResult)||void 0===H?void 0:H.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getWrappedImageExtension(){var S,H;let y=null===(H=null===(S=this.scanOfflineData)||void 0===S?void 0:S.scanResult)||void 0===H?void 0:H.wrappedScanFilePath;return null==y?null:y.substring(y.lastIndexOf("."))}}Pe.ScanOfflineFile=_},59985:function(vt,Pe,v){var l=this&&this.__awaiter||function(_,w,S,H){return new(S||(S=Promise))(function(oe,G){function k(ie){try{U(H.next(ie))}catch(ze){G(ze)}}function N(ie){try{U(H.throw(ie))}catch(ze){G(ze)}}function U(ie){ie.done?oe(ie.value):function y(oe){return oe instanceof S?oe:new S(function(G){G(oe)})}(ie.value).then(k,N)}U((H=H.apply(_,w||[])).next())})};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.ZipFolder=void 0;const f=v(91478);class c{constructor(w){this.files=new Map,w.forEach((S,H)=>{this.files.set(H,S)})}static fromZip(w){return l(this,void 0,void 0,function*(){let H=yield(new f).loadAsync(w).then(y=>{const oe=[];return y.forEach(function(G){let k=y.file(G);k&&oe.push(k.async("uint8array").then(N=>({path:G,data:N})))}),oe});return Promise.all(H).then(y=>{let oe=new Map;return y.forEach(G=>{oe.set(G.path,G.data)}),new c(oe)})})}setBinary(w,S){this.files.set(w,S)}setUtf8Text(w,S){let H=(new TextEncoder).encode(S);this.files.set(w,H)}getBinary(w){var S;return null!==(S=this.files.get(w))&&void 0!==S?S:null}getUtf8Text(w){let S=this.files.get(w);return null===S?null:(new TextDecoder).decode(S)}toDocx(){return l(this,void 0,void 0,function*(){const w=new f;for(let[S,H]of Array.from(this.files))w.file(S,H,{binary:!0});return w.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return l(this,void 0,void 0,function*(){const w=new f;for(let[S,H]of Array.from(this.files))w.file(S,H,{binary:!0});return w.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}Pe.ZipFolder=c}}]);