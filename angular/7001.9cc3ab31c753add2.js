"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7001],{61325:(F,k,l)=>{l.d(k,{$:()=>T});var A=l(69862),v=l(65592),b=l(61713),y=l(65879),S=l(46558),D=l(84672),I=l(77757);let T=(()=>{class f{replaceImageInContent(c,n){return new v.y(o=>{if(n.includes("<img ")){var e=this.findAllSubString(n,"<img"),d=[],p=[];e.forEach(h=>{var u=n.indexOf("src=",h),O=n.indexOf('"',Number(u)+5),z=n.substring(Number(u)+5,Number(O)+1);z.includes(";base64")?d.push({oldUrl:z}):z.includes("blob:")&&p.push({oldUrl:z})}),d.length>0?this.reUploadBase64File(c,d,(h,u)=>{null==u?p&&p.length>0?this.reUploadBlobFile(c,p,(O,z)=>{null!=z?(n=this.replaceHomeworkContent(n,h),n=this.replaceHomeworkContent(n,O),o.next({errorMessage:void 0,content:n}),o.complete()):(o.next({errorMessage:z,content:n}),o.complete())}):(n=this.replaceHomeworkContent(n,h),o.next({errorMessage:void 0,content:n}),o.complete()):(o.next({errorMessage:u,content:n}),o.complete())}):p.length>0?this.reUploadBlobFile(c,p,(h,u)=>{null==u?(n=this.replaceHomeworkContent(n,h),o.next({errorMessage:void 0,content:n}),o.complete()):(o.next({errorMessage:u,content:n}),o.complete())}):(n=this.replaceHomeworkContent(n,[]),o.next({errorMessage:void 0,content:n}),o.complete())}else o.next({errorMessage:void 0,content:n}),o.complete()})}replaceHomeworkContent(c,n){return n.length>0&&n.forEach(o=>{c=c.replace(o.oldUrl??"  ",o.newUrl+'" class="w-100 img-fluid"')}),c}findAllSubString(c,n){for(var o=0,e=0,d=[];c.indexOf(n,o)>-1;)e=c.indexOf(n,o),d.push(e),o=e+n.length;return d}getTypeFile(c){var n=c.indexOf(";");return c.substring(5,n)}getFileName(c){var n=c.split("").reverse().join(""),o=n.indexOf(";"),e=n.indexOf("/",o);return n.substring(o,e).split("").reverse().join("")}convertBlobToBase64(c){return new Promise(n=>{var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",function(){var e=document.createElement("canvas"),d=e.getContext("2d");e.width=o.width,e.height=o.height,d?.drawImage(o,0,0);var p=e.toDataURL("image/png");n(p)},!1),o.src=c})}reUploadBase64File(c,n,o){if(n&&n.length>0){let h,p=n.length;for(var e=[],d=0;d<n.length;d++){const u=n[d],O=u.oldUrl?.substring(0,u.oldUrl.length-1);this.startUploadBlobFile(c,u,O??"",[],(z,w)=>{null==w?e=e.concat(z):h=w,p-=1,0==p&&o(e,h)})}}else o([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(c,n,o){if(n&&n.length>0){let h,p=n.length;for(var e=[],d=0;d<n.length;d++){const u=n[d],O=u?.oldUrl?.substring(0,u.oldUrl.length-1);this.convertBlobToBase64(O??"").then(z=>{this.startUploadBlobFile(c,u,z,[],(w,M)=>{null==M?e=e.concat(w):h=M,p-=1,0==p&&o(e,h)})})}}else o([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(c,n,o,e,d){if(o&&""!=o){var p=this.getTypeFile(o),h=this.myPdfService.b64toFile(o,this.getFileName(p),p);(0,b.hv)(h).then(u=>{this.apiUploadService.commonUploadFile(c,u,"").subscribe(O=>{if(O.type!=A.dt.UploadProgress)if(1==O.success){var z={...n,newUrl:O.data?.url??""};e.push(z),d(e,void 0)}else d(e,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",O.message??"none"))})})}else d(e,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(c,n,o){this.commonService=c,this.apiUploadService=n,this.myPdfService=o}}return f.\u0275fac=function(c){return new(c||f)(y.LFG(S.z),y.LFG(D.W),y.LFG(I.z))},f.\u0275prov=y.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},28368:(F,k,l)=>{l.d(k,{y:()=>T});var A=l(20553),v=l(65879),b=l(88489);let y=(()=>{class f{getMode(){return""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light"}constructor(c){this.browserStorageService=c}}return f.\u0275fac=function(c){return new(c||f)(v.LFG(b.n))},f.\u0275prov=v.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();var S=l(46558),D=l(61325),I=l(32965);let T=(()=>{class f{constructor(c,n,o,e){this.darkModeService=c,this.commonService=n,this.sAztUploadImageOfExamService=o,this.cdnService=e}get initConfigUrlScript(){return{language_url:A.N.azt_tiny_mce_vi_langs_src}}initConfigForAdmin(){var o={};return o={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["code","fullscreen","link"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | link | code | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(o.skin="oxide-dark",o.content_css="dark"),o}initConfigForAdminWithUploadImageBox(c){var e={};return e={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen link",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | link | code | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,min_height:250,file_picker_callback:(d,p,h)=>{this.file_picker_callback(c,d,p,h)},content_css:[this.cdnService.convertCdnLinkOfGitHub("angular/styles.6c8c340cca20c274.css")],...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}initConfigForTeacher(){var o={};return o={height:250,min_height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["fullscreen"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(o.skin="oxide-dark",o.content_css="dark"),o}initConfigTeacherHomework(c){var e={};return e={min_height:c,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}initConfigStudentHomework(){var o={};return o={height:450,min_height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",readonly:1,plugins:["emoticons advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | emoticons",emoticons_database:"emojis",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(o.skin="oxide-dark",o.content_css="dark"),o}initConfigForTeacherWithUploadImageBox(c){var e={};return e={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,min_height:250,file_picker_callback:(d,p,h)=>{this.file_picker_callback(c,d,p,h)},...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}file_picker_callback(c,n,o,e){let d=document.createElement("input");d.setAttribute("type","file"),d.setAttribute("accept","image/*"),d.onchange=()=>{let p=d.files?.[0],h=new FileReader;h.onload=()=>{let O=`<img src="${"data:image/png;base64, "+h.result.split(",")[1]}">`;this.sAztUploadImageOfExamService.replaceImageInContent(c,O).subscribe(z=>{if(z.errorMessage)this.commonService.snackError(z.errorMessage);else{let w=document.createElement("div");w.innerHTML=this.commonService.removeXssInHtml(z.content);let M=w.firstChild;M&&M.src&&n(M.src)}})},h.readAsDataURL(p)},d.click()}}return f.\u0275fac=function(c){return new(c||f)(v.LFG(y),v.LFG(S.z),v.LFG(D.$),v.LFG(I.E))},f.\u0275prov=v.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},54284:(F,k,l)=>{l.d(k,{h:()=>y});var A=l(37734),v=l(61713),b=l(65879);let y=(()=>{class S extends A.Q{constructor(){super(...arguments),this.limitSize=200,this.selectFile=I=>{const T=I.target,f=T.files;if(f){if(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(f).find(n=>(0,v.EO)(n.size)>=this.limitSize))return this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB"));const c=[];Array.from(f).forEach(n=>{c.push(n)}),this.emitUploadToEditorComplete(c)}T.value=""}}}return S.\u0275fac=function(){let D;return function(T){return(D||(D=b.n5z(S)))(T||S)}}(),S.\u0275cmp=b.Xpm({type:S,selectors:[["ng-component"]],inputs:{fileType:"fileType",limitSize:"limitSize"},features:[b.qOj],decls:0,vars:0,template:function(I,T){},encapsulation:2}),S})()},27001:(F,k,l)=>{l.r(k),l.d(k,{AzotaDigitalizeModule:()=>Te});var A=l(96814),v=l(56223),b=l(12044),y=l(42753),S=l(37722),D=l(60381),I=l(95545),T=l(56731),f=l(84155),U=l(78217),c=l(24090),n=l(20553),o=l(82481),e=l(65879),d=l(37734),p=l(49671),h=l(47394),u=l(36727),O=l(32965),z=l(46558),w=l(9e4);let M=(()=>{class i{constructor(){this.subscriptions=new h.w0,this.ocrService=(0,e.f3M)(w.Kx),this.cdnService=(0,e.f3M)(O.E),this.commonService=(0,e.f3M)(z.z)}digitalizeData(t,a,r,s){if(!t.image.url)return s(t);a("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:t.image.url}).subscribe({next:m=>{a("lang_digitalize_load_detect_image_script"),this.loadScriptHandleImage(()=>{a("lang_digitalize_call_detect_image_function"),this.imageUtils.detectImage(t.image.fileBytes).then(C=>{t.image.base64Images=C.images.map(E=>({base64:this.commonService.generateBase64Prefix(E.extension)+this.uint8ArrayToBase64(new Uint8Array(E.content)),width:E.width,height:E.height}));let _=(new u.$e).transform((new u.h8).transform(m.data));_=this.commonService.replaceAll(_,"$$$$","$$")??_,_=this.commonService.replaceAll(_,"$$$","$$")??_,_=this.commonService.replaceAll(_,"<table>","<table class='table table-bordered'>")??_,t.htmlResult=_,t.isProcessed=!0,s(t)}).catch(C=>r("lang_digitalize_error_when_call_detect_image"))})},error:m=>r(m.error.message)}))}uint8ArrayToBase64(t){let a="";const r=t.byteLength;for(let s=0;s<r;s++)a+=String.fromCharCode(t[s]);return btoa(a)}waitAnswerSheetInitDone(t){if(window.azotaScanAnswerSheet)return t();setTimeout(()=>{this.waitAnswerSheetInitDone(t)},100)}loadScriptHandleImage(t){var a=this;if(this.imageUtils)return t();this.commonService.loadAnswerSheetJs().then((0,p.Z)(function*(){a.waitAnswerSheetInitDone((0,p.Z)(function*(){a.imageUtils=yield window.azotaScanAnswerSheet.imageUtils(),t()}))})).catch(r=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),t()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var j=l(43389),N=l(98129),H=l(61713),P=l(63120),$=l(77757),K=l(2459),Q=l(9769),G=l(26306),Y=l(22096),L=l(37398),W=l(69732),B=l(79360);const X=(i,g)=>(i.push(g),i);let ee=(()=>{class i{processObservables(t,a){return(0,K.D)(a).pipe((0,Q.z)((r,s)=>r.pipe((0,G.K)(m=>(console.error("Error in observable:",m),(0,Y.of)(null))),(0,L.U)(m=>({result:m,index:s}))),t),function q(){return(0,B.e)((i,g)=>{(function V(i,g){return(0,B.e)((0,W.U)(i,g,arguments.length>=2,!1,!0))})(X,[])(i).subscribe(g)})}(),(0,L.U)(r=>r.sort((s,m)=>s.index-m.index).map(s=>s.result)))}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var te=l(84672),ie=l(54284),ne=l(7827);const oe=["*"];let ae=(()=>{class i extends ie.h{constructor(){super(...arguments),this.emitFiles=new e.vpe}emitUploadToEditorComplete(t){t.length>0&&this.emitFiles.emit(t)}onDrop(t){try{this.emitFiles.emit(t)}catch(a){alert(a)}}}return i.\u0275fac=function(){let g;return function(a){return(g||(g=e.n5z(i)))(a||i)}}(),i.\u0275cmp=e.Xpm({type:i,selectors:[["azt-upload-multiple-document-to-editor"]],outputs:{emitFiles:"emitFiles"},features:[e.qOj],ngContentSelectors:oe,decls:5,vars:2,consts:[[1,"upload-document","h-full",3,"appDropZone","click"],[3,"hidden"],["type","file","multiple","",1,"form-control","file-input",3,"accept","change"],["fileSelect",""]],template:function(t,a){if(1&t){const r=e.EpF();e.F$t(),e.TgZ(0,"div",0),e.NdJ("appDropZone",function(m){return a.onDrop(m)})("click",function(){e.CHM(r);const m=e.MAs(3);return e.KtG(m.click())}),e.TgZ(1,"form",1)(2,"input",2,3),e.NdJ("change",function(m){return a.selectFile(m)}),e.qZA()(),e.Hsn(4),e.qZA()}2&t&&(e.xp6(1),e.Q6J("hidden",!0),e.xp6(1),e.s9C("accept",a.fileType))},dependencies:[v._Y,v.JL,v.F,ne.i],encapsulation:2}),i})();function re(i,g){if(1&i&&e._UZ(0,"azt-loading-effect",2),2&i){const t=e.oxw();e.Q6J("currentStatusObj",t.statusObj)("customText",t.statusObj.errorMessage)}}const le=function(i,g){return[i,g]};function se(i,g){if(1&i){const t=e.EpF();e.TgZ(0,"azt-upload-multiple-document-to-editor",3),e.NdJ("emitFiles",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.handleUploadComplete(r))}),e.TgZ(1,"a",4),e.O4$(),e.TgZ(2,"svg",5),e._UZ(3,"line",6)(4,"line",7),e.qZA(),e.kcU(),e.TgZ(5,"span"),e._uU(6),e.ALo(7,"mytranslate"),e.qZA()()()}if(2&i){const t=e.oxw();e.Q6J("fileType",e.WLB(4,le,t.allUploadFileTypes.PDF,t.allUploadFileTypes.IMAGE)),e.xp6(6),e.Oqu(e.lcZ(7,2,"lang_digitalize_book_upload_file"))}}let ce=(()=>{class i extends d.Q{handleUploadComplete(t){this.initStatusObj("lang_digitalize_convert_pdf_to_images"),this.convertAllPdfToImages(t).then(a=>{let r=[];a.forEach(s=>{let m=this.apiUploadService.commonUploadFile(this.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE,s,"");r.push(m)}),this.initStatusObj("lang_digitalize_upload_images_to_cdn"),this.sAztConcurrencyApiService.processObservables(this.uploadThread,r).subscribe(s=>{if(s.find(x=>!x?.success))return this.errorStatusObj("lang_digitalize_book_upload_file_error",!0);let C=[],_=s.map(x=>x?.data).filter(this.commonService.notEmpty),E=a.map(x=>this.convertFileToUint8Array(x));this.initStatusObj("lang_digitalize_convert_file_to_byte_array"),Promise.all(E).then(x=>{_.forEach((J,Z)=>{let R=this.commonService.getItemAtIndexOfArray(x,Z);if(null==R)throw Error("lang_digitalize_missing_file_byte_array");C.push({...J,fileBytes:R,base64Images:[]})}),this.stopStatusObj(),this.uploadData.emit(C)}).catch(x=>console.error("lang_digitalize_convert_to_uint8_array_error: ",x))})})}convertAllPdfToImages(t){var a=this;let r=[];return t.forEach(s=>{if((0,H.Or)(s.type))return void r.push(new Promise(function(){var C=(0,p.Z)(function*(_,E){_([s])});return function(_,E){return C.apply(this,arguments)}}()));let m=new Promise(function(){var C=(0,p.Z)(function*(_,E){let x=[],Z=yield a.withTimeout(a.myPdfService.getImageWithPdf(s),3e5);x.push(...Z),_(x)});return function(_,E){return C.apply(this,arguments)}}());r.push(m)}),new Promise(function(){var s=(0,p.Z)(function*(m,C){Promise.all(r).then(_=>{m(a.commonService.concatMultipleArray(_))}).catch(_=>{a.showErrorSnack("lang_azt_pdf_invalid_format"),m([])})});return function(m,C){return s.apply(this,arguments)}}())}withTimeout(t,a){return new Promise((r,s)=>{const m=setTimeout(()=>{s(new Error("Operation timed out"))},a);t.then(C=>{clearTimeout(m),r(C)}).catch(C=>{clearTimeout(m),s(C)})})}convertFileToUint8Array(t){return new Promise((a,r)=>{const s=new FileReader;s.onload=()=>{if(s.result instanceof ArrayBuffer){const m=new Uint8Array(s.result);a(m)}else r(new Error("Error reading file as ArrayBuffer."))},s.onerror=()=>{r(new Error("Error reading file."))},s.readAsArrayBuffer(t)})}ngOnInit(){super.ngOnInit()}constructor(t,a,r){super(),this.myPdfService=t,this.sAztConcurrencyApiService=a,this.apiUploadService=r,this.uploadData=new e.vpe,this.allUploadToCdnMenuTypes=P.j6,this.allUploadFileTypes=P.AZ,this.uploadThread=10}}return i.\u0275fac=function(t){return new(t||i)(e.Y36($.z),e.Y36(ee),e.Y36(te.W))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-digitalize-pdf-to-images"]],outputs:{uploadData:"uploadData"},features:[e.qOj],decls:3,vars:2,consts:[[3,"currentStatusObj","customText",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj","customText"],[3,"fileType","emitFiles"],[1,"btn","btn-primary-soft","w-full"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"]],template:function(t,a){if(1&t&&(e.YNc(0,re,1,2,"azt-loading-effect",0),e.YNc(1,se,8,7,"ng-template",null,1,e.W1O)),2&t){const r=e.MAs(2);e.Q6J("ngIf",a.statusObj.loading)("ngIfElse",r)}},dependencies:[A.O5,j.l,ae,u.JV],encapsulation:2}),i})();const ge=function(i){return{"mb-2":i}},me=function(i){return{"border-pending":i}};function de(i,g){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"span",5),e._uU(2),e.qZA(),e.TgZ(3,"img",6),e.NdJ("click",function(){const s=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.chooseImage.emit(s))}),e.qZA()()}if(2&i){const t=g.$implicit,a=g.last,r=e.oxw();e.Q6J("ngClass",e.VKq(4,ge,!a)),e.xp6(2),e.Oqu(t.position),e.xp6(1),e.Q6J("src",t.image.url,e.LSH)("ngClass",e.VKq(6,me,t.position==(null==r.currentObj?null:r.currentObj.position)))}}let pe=(()=>{class i extends d.Q{ngOnInit(){super.ngOnInit()}constructor(){super(),this.chooseImage=new e.vpe}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-digitalize-list-images"]],inputs:{objs:"objs",currentObj:"currentObj"},outputs:{chooseImage:"chooseImage"},features:[e.qOj],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.ALo(3,"mytranslate"),e.qZA(),e.TgZ(4,"ng-scrollbar",2),e.YNc(5,de,4,8,"div",3),e.qZA()()),2&t&&(e.xp6(2),e.AsE("",e.lcZ(3,4,"lang_digitalize_book_total_page"),": ",a.objs.length,""),e.xp6(2),e.Q6J("visibility","hover"),e.xp6(1),e.Q6J("ngForOf",a.objs))},dependencies:[A.mk,A.sg,I.KC,u.JV],encapsulation:2}),i})();var ue=l(28368);function fe(i,g){if(1&i&&e._UZ(0,"azt-loading-effect",2),2&i){const t=e.oxw();e.Q6J("currentStatusObj",t.statusObj)("customText",t.statusObj.errorMessage)}}function he(i,g){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",13),e.NdJ("click",function(){const s=e.CHM(t).$implicit,m=e.oxw(3);return e.KtG(m.chooseImages(s))}),e.qZA(),e.BQk()}if(2&i){const t=g.$implicit;e.xp6(1),e.s9C("src",t.base64,e.LSH)}}function _e(i,g){if(1&i&&(e.TgZ(0,"div",11),e.YNc(1,he,2,1,"ng-container",12),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.obj.image.base64Images)}}function ve(i,g){if(1&i){const t=e.EpF();e.TgZ(0,"div",3)(1,"span",4),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.digitalizeData())}),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()(),e.YNc(4,_e,2,1,"div",5),e.TgZ(5,"div",6)(6,"div",7)(7,"div",8),e._UZ(8,"div",9),e.ALo(9,"safeNormalHtmlContent"),e.ALo(10,"async"),e.ALo(11,"mathJaxContent"),e.qZA()(),e.TgZ(12,"div",7)(13,"div",8),e._UZ(14,"editor",10),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,7,"lang_digitalize_book_call_ocr_again")),e.xp6(2),e.Q6J("ngIf",t.obj.image.base64Images.length>0),e.xp6(4),e.Q6J("innerHTML",e.lcZ(9,9,e.lcZ(10,11,e.lcZ(11,13,t.obj.htmlResult))),e.oJD),e.xp6(6),e.s9C("apiKey",t.tinyEditorKey),e.Q6J("formControl",t.htmlFormControl)("init",t.initDataEditor),e.uIk("style","width: 100%;min-height:300px;",e.Ckj)}}let ze=(()=>{class i extends d.Q{constructor(){super(...arguments),this.changeObj=new e.vpe,this.htmlFormControl=new v.NI("",{nonNullable:!0}),this.initDataEditor={},this.tinyEditorKey=n.N.tinyEditorKey,this.tinyMceService=(0,e.f3M)(ue.y),this.sAztDigitalizeService=(0,e.f3M)(M)}digitalizeData(){this.sAztDigitalizeService.digitalizeData(this.obj,t=>{this.initStatusObj(t)},t=>{this.errorStatusObj(t,!0)},t=>{this.obj=t,this.setNewValue(!0),this.stopStatusObj()})}chooseImages(t){this.obj.htmlResult=this.obj.htmlResult.replace("<img>",`<img src='${t.base64}'/>`),this.setNewValue(!0)}setNewValue(t){t&&this.htmlFormControl.setValue(this.obj.htmlResult),this.changeObj.emit(this.obj)}ngOnChanges(){this.obj.isProcessed||this.digitalizeData()}ngOnInit(){this.htmlFormControl.valueChanges.subscribe(()=>{this.obj.htmlResult=this.htmlFormControl.getRawValue(),this.setNewValue(!1)}),this.initDataEditor=this.tinyMceService.initConfigForAdminWithUploadImageBox(P.j6.ADMIN)}}return i.\u0275fac=function(){let g;return function(a){return(g||(g=e.n5z(i)))(a||i)}}(),i.\u0275cmp=e.Xpm({type:i,selectors:[["app-digitalize-preview-result"]],inputs:{obj:"obj"},outputs:{changeObj:"changeObj"},features:[e.qOj,e.TTD],decls:3,vars:2,consts:[[3,"currentStatusObj","customText",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj","customText"],[1,"text-right"],[1,"mb-3","btn","btn-pending","end-flex",3,"click"],["class","box p-3 mb-3 list-base640-images",4,"ngIf"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-6"],[1,"box","p-3"],[3,"innerHTML"],[3,"formControl","apiKey","init"],[1,"box","p-3","mb-3","list-base640-images"],[4,"ngFor","ngForOf"],[1,"mr-2","mb-2","box","clickable",3,"src","click"]],template:function(t,a){if(1&t&&(e.YNc(0,fe,1,2,"azt-loading-effect",0),e.YNc(1,ve,15,15,"ng-template",null,1,e.W1O)),2&t){const r=e.MAs(2);e.Q6J("ngIf",a.statusObj.loading)("ngIfElse",r)}},dependencies:[A.sg,A.O5,v.JJ,y.PG,v.oH,j.l,A.Ov,u.JV,u.Pc,u.fF],styles:[".list-base640-images[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px}"]}),i})();function Ce(i,g){if(1&i&&e._UZ(0,"azt-loading-effect",4),2&i){const t=e.oxw();e.Q6J("currentStatusObj",t.statusObj)}}function Oe(i,g){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"app-digitalize-list-images",16),e.NdJ("chooseImage",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.chooseImage(r))}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("objs",t.objs)("currentObj",t.curObj)}}function Ae(i,g){if(1&i){const t=e.EpF();e.TgZ(0,"app-digitalize-preview-result",17),e.NdJ("changeObj",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.changeObj(r))}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("obj",t.curObj)}}function Se(i,g){1&i&&(e.TgZ(0,"p",15),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"lang_digitalize_book_please_choose_image")))}function ye(i,g){if(1&i){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"app-digitalize-pdf-to-images",9),e.NdJ("uploadData",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.uploadData(r))}),e.qZA()(),e.TgZ(5,"div",10)(6,"div",11),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.downloadData("html"))}),e._uU(7),e.ALo(8,"mytranslate"),e.qZA()(),e.TgZ(9,"div",10)(10,"div",11),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.downloadData("docx"))}),e._uU(11),e.ALo(12,"mytranslate"),e.qZA()()(),e.YNc(13,Oe,2,2,"div",12),e.qZA(),e.TgZ(14,"div",13),e.YNc(15,Ae,1,1,"app-digitalize-preview-result",14),e.YNc(16,Se,3,3,"p",12),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(7),e.Oqu(e.lcZ(8,5,"lang_digitalize_book_download_result_html")),e.xp6(4),e.Oqu(e.lcZ(12,7,"lang_digitalize_book_download_result_docx")),e.xp6(2),e.Q6J("ngIf",t.objs.length>0),e.xp6(2),e.Q6J("ngIf",t.curObj),e.xp6(1),e.Q6J("ngIf",!t.curObj)}}const xe=[{path:"",children:[{path:"digitalize-book",component:(()=>{class i extends d.Q{chooseImage(t){this.curObj=t}changeObj(t){let a=this.objs.find(r=>r.position==t.position);a&&(a={...t}),this.totalOrcDone=this.objs.filter(r=>r.isProcessed).length}uploadData(t){this.objs=t.map((a,r)=>({image:a,htmlResult:"",isProcessed:!1,position:r+1}))}downloadData(t){let a=new Date,r="";if(this.objs.forEach(s=>{r+=s.isProcessed?`<page [page]='${s.position}'/>`+s.htmlResult:`<page [page]='${s.position}'/><img src='${this.commonService.generateBase64Prefix("png")+this.sAztDigitalizeService.uint8ArrayToBase64(s.image.fileBytes)}'/>`}),r=this.commonService.decodeHtmlEntities(r),"html"!=t)this.commonService.loadAzotaDocxJs().then(()=>{azotaDocx.textToDocxBinary(r,null).then(s=>{let m=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.docx`;const C=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});C&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(C),m)}).catch(s=>{this.showErrorSnack(s)})}).catch(s=>{this.showErrorSnack(s)});else{let s=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.html`;const m=new Blob([r],{type:"text/plain"});m&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(m),s)}}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_book",description:"lang_cms_admin_common_digitalize_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(){super(),this.headerBackTo="",this.objs=[],this.totalOrcDone=0,this.sAztDigitalizeService=(0,e.f3M)(M)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-digitalize-book"]],features:[e.qOj],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-3"],[1,"box","p-3","mb-3","grid","grid-cols-12","gap-2"],[1,"col-span-12"],[3,"uploadData"],[1,"col-span-6"],[1,"btn","btn-primary","w-full",3,"click"],["class","box p-3",4,"ngIf"],[1,"col-span-9"],[3,"obj","changeObj",4,"ngIf"],[1,"box","p-3"],[3,"objs","currentObj","chooseImage"],[3,"obj","changeObj"]],template:function(t,a){if(1&t&&(e.TgZ(0,"teacher-layout",0)(1,"div",1),e.YNc(2,Ce,1,1,"azt-loading-effect",2),e.YNc(3,ye,17,9,"ng-template",null,3,e.W1O),e.qZA()()),2&t){const r=e.MAs(4);e.Q6J("headerBackToLink",a.headerBackTo),e.xp6(2),e.Q6J("ngIf",a.statusObj.loading)("ngIfElse",r)}},dependencies:[A.O5,j.l,N._,ce,pe,ze,u.JV],encapsulation:2}),i})()}]}];let be=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[b.Bz.forChild(xe),b.Bz,o.fQ]}),i})(),Te=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:y.f8,useValue:n.N.azt_tiny_mce_script_src}],imports:[b.Bz,A.ez,v.u5,y.Z_,T.j,v.UX,be,c.W,f.Z,I.kb,U.d,S.qyJ.pick(S.ciZ),D.l1]}),i})()}}]);