(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[4324],{32586:(Oe,et,x)=>{"use strict";x.d(et,{Y:()=>gt});var j=x(59640),K=x(64198),ot=x(26860);let gt=(()=>{class t extends j.H{constructor(){super(...arguments),this.limitSize=200,this.selectFile=st=>{const mt=st.target,it=mt.files;if(it){if(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(it).find(at=>(0,K.hD)(at.size)>=this.limitSize))return this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB"));const Rt=[];Array.from(it).forEach(at=>{Rt.push(at)}),this.emitUploadToEditorComplete(Rt)}mt.value=""}}static#t=this.\u0275fac=function(){let st;return function(it){return(st||(st=ot.xGo(t)))(it||t)}}();static#e=this.\u0275cmp=ot.VBU({type:t,selectors:[["ng-component"]],inputs:{fileType:"fileType",limitSize:"limitSize"},features:[ot.Vt3],decls:0,vars:0,template:function(mt,it){},encapsulation:2})}return t})()},64324:(Oe,et,x)=>{"use strict";x.r(et),x.d(et,{AzotaDigitalizeModule:()=>At});var j=x(54460),K=x(10936),ot=x(65162),gt=x(69223),t=x(26860),Zt=x(17715);const st=["image"];function mt(s,y){1&s&&(t.j41(0,"div",6),t.nrm(1,"div",7),t.k0s())}function it(s,y){if(1&s&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&s){const r=t.XpG();t.R7$(1),t.JRh(r.loadImageErrorText)}}let Rt=(()=>{class s{constructor(){this.cropperOptions={},this.export=new t.bkB,this.ready=new t.bkB,this.isLoading=!0}ngOnInit(){}ngOnDestroy(){this.cropper&&(this.cropper.destroy(),this.cropper=null)}imageLoaded(r){this.loadError=!1;const h=r.target;this.imageElement=h,this.cropperOptions.checkCrossOrigin&&(h.crossOrigin="anonymous"),h.addEventListener("ready",()=>{this.ready.emit(!0),this.isLoading=!1,this.cropbox&&this.cropper.setCropBoxData(this.cropbox)});let p=NaN;if(this.settings){const{width:m,height:w}=this.settings;p=m/w}this.cropperOptions={aspectRatio:p,checkCrossOrigin:!0,...this.cropperOptions},this.cropper&&(this.cropper.destroy(),this.cropper=void 0),this.cropper=new Zt(h,this.cropperOptions)}imageLoadError(r){this.loadError=!0,this.isLoading=!1}exportCanvas(r){const h=this.cropper.getImageData(),p=this.cropper.getCropBoxData(),m=this.cropper.getCroppedCanvas(),w={imageData:h,cropData:p};new Promise(M=>{if(r)return M({dataUrl:m.toDataURL("image/png")});m.toBlob(pt=>M({blob:pt}))}).then(M=>{this.export.emit({...w,...M})})}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275cmp=t.VBU({type:s,selectors:[["angular-cropper"]],viewQuery:function(r,h){if(1&r&&t.GBs(st,7),2&r){let p;t.mGM(p=t.lsd())&&(h.image=p.first)}},inputs:{imageUrl:"imageUrl",settings:"settings",cropbox:"cropbox",loadImageErrorText:"loadImageErrorText",cropperOptions:"cropperOptions"},outputs:{export:"export",ready:"ready"},decls:6,vars:3,consts:[[1,"cropper-wrapper"],["class","loading-block",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"cropper"],["alt","image",3,"src","load","error"],["image",""],[1,"loading-block"],[1,"spinner"],[1,"alert","alert-warning"]],template:function(r,h){1&r&&(t.j41(0,"div",0),t.DNE(1,mt,2,0,"div",1),t.DNE(2,it,2,1,"div",2),t.j41(3,"div",3)(4,"img",4,5),t.bIt("load",function(m){return h.imageLoaded(m)})("error",function(m){return h.imageLoadError(m)}),t.k0s()()()),2&r&&(t.R7$(1),t.Y8G("ngIf",h.isLoading),t.R7$(1),t.Y8G("ngIf",h.loadError),t.R7$(2),t.Y8G("src",h.imageUrl,t.B4B))},dependencies:[j.bT],styles:[':host{display:block}.cropper img{max-width:100%;max-height:100%;height:auto}.cropper-wrapper{position:relative;min-height:80px}.cropper-wrapper .loading-block{position:absolute;top:0;left:0;width:100%;height:100%}.cropper-wrapper .loading-block .spinner{width:31px;height:31px;margin:0 auto;border:2px solid rgba(97,100,193,.98);border-radius:50%;border-left-color:transparent;border-right-color:transparent;-webkit-animation:cssload-spin 425ms infinite linear;position:absolute;top:calc(50% - 15px);left:calc(50% - 15px);animation:cssload-spin 425ms infinite linear}@keyframes cssload-spin{to{transform:rotate(360deg)}}/*!\n * Cropper.js v1.4.1\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2018-07-15T09:54:43.167Z\n */.cropper-container{direction:ltr;font-size:0;line-height:0;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cropper-container img{display:block;height:100%;image-orientation:0deg;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;width:100%}.cropper-wrap-box,.cropper-canvas,.cropper-drag-box,.cropper-crop-box,.cropper-modal{inset:0;position:absolute}.cropper-wrap-box,.cropper-canvas{overflow:hidden}.cropper-drag-box{background-color:#fff;opacity:0}.cropper-modal{background-color:#000;opacity:.5}.cropper-view-box{display:block;height:100%;outline-color:#3399ffbf;outline:1px solid #39f;overflow:hidden;width:100%}.cropper-dashed{border:0 dashed #eee;display:block;opacity:.5;position:absolute}.cropper-dashed.dashed-h{border-bottom-width:1px;border-top-width:1px;height:calc(100% / 3);left:0;top:calc(100% / 3);width:100%}.cropper-dashed.dashed-v{border-left-width:1px;border-right-width:1px;height:100%;left:calc(100% / 3);top:0;width:calc(100% / 3)}.cropper-center{display:block;height:0;left:50%;opacity:.75;position:absolute;top:50%;width:0}.cropper-center:before,.cropper-center:after{background-color:#eee;content:" ";display:block;position:absolute}.cropper-center:before{height:1px;left:-3px;top:0;width:7px}.cropper-center:after{height:7px;left:0;top:-3px;width:1px}.cropper-face,.cropper-line,.cropper-point{display:block;height:100%;opacity:.1;position:absolute;width:100%}.cropper-face{background-color:#fff;left:0;top:0}.cropper-line{background-color:#39f}.cropper-line.line-e{cursor:ew-resize;right:-3px;top:0;width:5px}.cropper-line.line-n{cursor:ns-resize;height:5px;left:0;top:-3px}.cropper-line.line-w{cursor:ew-resize;left:-3px;top:0;width:5px}.cropper-line.line-s{bottom:-3px;cursor:ns-resize;height:5px;left:0}.cropper-point{background-color:#39f;height:5px;opacity:.75;width:5px}.cropper-point.point-e{cursor:ew-resize;margin-top:-3px;right:-3px;top:50%}.cropper-point.point-n{cursor:ns-resize;left:50%;margin-left:-3px;top:-3px}.cropper-point.point-w{cursor:ew-resize;left:-3px;margin-top:-3px;top:50%}.cropper-point.point-s{bottom:-3px;cursor:s-resize;left:50%;margin-left:-3px}.cropper-point.point-ne{cursor:nesw-resize;right:-3px;top:-3px}.cropper-point.point-nw{cursor:nwse-resize;left:-3px;top:-3px}.cropper-point.point-sw{bottom:-3px;cursor:nesw-resize;left:-3px}.cropper-point.point-se{bottom:-3px;cursor:nwse-resize;height:20px;opacity:1;right:-3px;width:20px}@media (min-width: 768px){.cropper-point.point-se{height:15px;width:15px}}@media (min-width: 992px){.cropper-point.point-se{height:10px;width:10px}}@media (min-width: 1200px){.cropper-point.point-se{height:5px;opacity:.75;width:5px}}.cropper-point.point-se:before{background-color:#39f;bottom:-50%;content:" ";display:block;height:200%;opacity:0;position:absolute;right:-50%;width:200%}.cropper-invisible{opacity:0}.cropper-bg{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC)}.cropper-hide{display:block;height:0;position:absolute;width:0}.cropper-hidden{display:none!important}.cropper-move{cursor:move}.cropper-crop{cursor:crosshair}.cropper-disabled .cropper-drag-box,.cropper-disabled .cropper-face,.cropper-disabled .cropper-line,.cropper-disabled .cropper-point{cursor:not-allowed}\n'],encapsulation:2}),s})(),at=(()=>{class s{}return s.\u0275fac=function(r){return new(r||s)},s.\u0275mod=t.$C({type:s}),s.\u0275inj=t.G2t({imports:[j.MD]}),s})();var X=x(15343),Lt=x(10123),wt=x(5502),I=x(46584),Ft=x(70050),qt=x(7050),te=x(91100),Yt=x(43234),ct=x(1133),lt=x(52909),Z=x(59640),$=x(73014),xt=x(85710),L=x(73437),Ct=x(25693),Ot=x(5849);let Mt=(()=>{class s{constructor(){this.subscriptions=new xt.yU,this.ocrService=(0,t.WQX)(Ot.so),this.commonService=(0,t.WQX)(Ct.R)}digitalizeData(r,h,p,m){if(!r.image.url)return m(r);h("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:r.image.url}).subscribe({next:w=>{h("lang_digitalize_load_detect_image_script"),this.loadScriptHandleImage(()=>{h("lang_digitalize_call_detect_image_function"),this.imageUtils.detectImage(r.image.fileBytes).then(D=>m(this.replaceOrcData(r,w,D.images))).catch(D=>m(this.replaceOrcData(r,w,[])))})},error:w=>p(w.error.message)}))}uint8ArrayToBase64(r){let h="";const p=r.byteLength;for(let m=0;m<p;m++)h+=String.fromCharCode(r[m]);return btoa(h)}replaceOrcData(r,h,p){r.image.base64Images=p.map(D=>({base64:this.uint8ArrayToBase64(new Uint8Array(D.content)),width:D.width,height:D.height,extension:D.extension}));let m=h.data,w={};return[m,w]=this.commonService.extractOriginDataOfLatex(m),m=(new L.bt).transform((new L.UN).transform(m)),m=this.commonService.replaceBackToOriginDataOfLatex(m,w),m=this.commonService.convertLatexTagToDollarDollar(m),m=this.commonService.replaceAll(m,"<table>","<table class='table table-bordered'>")??m,r.htmlResult=m,r}waitAnswerSheetInitDone(r){if(window.azotaScanAnswerSheet)return r();setTimeout(()=>{this.waitAnswerSheetInitDone(r)},100)}loadScriptHandleImage(r){var h=this;if(this.imageUtils)return r();this.commonService.loadAnswerSheetJs().then((0,$.A)(function*(){h.waitAnswerSheetInitDone((0,$.A)(function*(){h.imageUtils=yield window.azotaScanAnswerSheet.imageUtils(),r()}))})).catch(p=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),r()})}ngOnDestroy(){this.subscriptions.unsubscribe()}static#t=this.\u0275fac=function(h){return new(h||s)};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var U=function(s){return s[s.NONE=0]="NONE",s[s.PROCESSING=1]="PROCESSING",s[s.PROCESS_ERROR=2]="PROCESS_ERROR",s[s.PROCESSED=3]="PROCESSED",s}(U||{}),k=function(s){return s[s.CHOOSE_IMAGES=0]="CHOOSE_IMAGES",s[s.PROCESS_IMAGES=1]="PROCESS_IMAGES",s}(k||{}),Ut=x(18718),De=x(96451),jt=x(64198),Dt=x(39712),Et=x(63709),kt=x(14159),Xt=x(27035),ee=x(17178),ie=x(63016),Bt=x(47947),$t=x(20036),Nt=x(15351);const ae=(s,y)=>(s.push(y),s);let Se=(()=>{class s{processObservables(r,h){return(0,kt.H)(h).pipe((0,Xt.Z)((p,m)=>p.pipe((0,ee.W)(w=>(console.error("Error in observable:",w),(0,ie.of)(null))),(0,Bt.T)(w=>({result:w,index:m}))),r),function Ee(){return(0,Nt.N)((s,y)=>{(function Vt(s,y){return(0,Nt.N)((0,$t.S)(s,y,arguments.length>=2,!1,!0))})(ae,[])(s).subscribe(y)})}(),(0,Bt.T)(p=>p.sort((m,w)=>m.index-w.index).map(m=>m.result)))}static#t=this.\u0275fac=function(h){return new(h||s)};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var Ae=x(41426),re=x(32586),ne=x(34068);const oe=["*"];let se=(()=>{class s extends re.Y{constructor(){super(...arguments),this.emitFiles=new t.bkB}emitUploadToEditorComplete(r){r.length>0&&this.emitFiles.emit(r)}onDrop(r){try{this.emitFiles.emit(r)}catch(h){alert(h)}}static#t=this.\u0275fac=function(){let r;return function(p){return(r||(r=t.xGo(s)))(p||s)}}();static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["azt-upload-multiple-document-to-editor"]],outputs:{emitFiles:"emitFiles"},features:[t.Vt3],ngContentSelectors:oe,decls:5,vars:2,consts:[[1,"upload-document","h-full",3,"appDropZone","click"],[3,"hidden"],["type","file","multiple","",1,"form-control","file-input",3,"accept","change"],["fileSelect",""]],template:function(h,p){if(1&h){const m=t.RV6();t.NAR(),t.j41(0,"div",0),t.bIt("appDropZone",function(D){return p.onDrop(D)})("click",function(){t.eBV(m);const D=t.sdS(3);return t.Njj(D.click())}),t.j41(1,"form",1)(2,"input",2,3),t.bIt("change",function(D){return p.selectFile(D)}),t.k0s()(),t.SdG(4),t.k0s()}2&h&&(t.R7$(1),t.Y8G("hidden",!0),t.R7$(1),t.FS9("accept",p.fileType))},dependencies:[K.qT,K.cb,K.cV,ne.F],encapsulation:2})}return s})();function ce(s,y){if(1&s&&t.nrm(0,"azt-loading-effect",2),2&s){const r=t.XpG();t.Y8G("currentStatusObj",r.statusObj)("customText",r.statusObj.errorMessage)}}const le=function(s,y){return[s,y]},Ht=function(){return{"mr-2":!0}};function he(s,y){if(1&s){const r=t.RV6();t.j41(0,"azt-upload-multiple-document-to-editor",3),t.bIt("emitFiles",function(p){t.eBV(r);const m=t.XpG();return t.Njj(m.handleUploadComplete(p))}),t.j41(1,"a",4),t.nrm(2,"lucide-icon",5),t.j41(3,"span"),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()()}if(2&s){const r=t.XpG();t.Y8G("fileType",t.l_i(5,le,r.allUploadFileTypes.PDF,r.allUploadFileTypes.IMAGE)),t.R7$(2),t.Y8G("ngClass",t.lJ4(8,Ht)),t.R7$(2),t.JRh(t.bMT(5,3,"lang_digitalize_book_upload_file"))}}let Ie=(()=>{class s extends Z.H{handleUploadComplete(r){this.initStatusObj("lang_digitalize_convert_pdf_to_images"),this.convertAllPdfToImages(r).then(h=>{let p=[];h.forEach(m=>{let w=this.apiUploadService.commonUploadFile(this.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE,m,"");p.push(w)}),this.initStatusObj("lang_digitalize_upload_images_to_cdn"),this.sAztConcurrencyApiService.processObservables(this.uploadThread,p).subscribe(m=>{if(m.find(H=>!H?.success))return this.errorStatusObj("lang_digitalize_book_upload_file_error",!0);let D=[],M=m.map(H=>H?.data).filter(this.commonService.notEmpty),pt=h.map(H=>this.convertFileToUint8Array(H));this.initStatusObj("lang_digitalize_convert_file_to_byte_array"),Promise.all(pt).then(H=>{M.forEach((we,Kt)=>{let xe=this.commonService.getItemAtIndexOfArray(H,Kt);if(null==xe)throw Error("lang_digitalize_missing_file_byte_array");D.push({...we,fileBytes:xe,base64Images:[]})}),this.stopStatusObj(),this.uploadData.emit(D)}).catch(H=>console.error("lang_digitalize_convert_to_uint8_array_error: ",H))})})}convertAllPdfToImages(r){var h=this;let p=[];return r.forEach(m=>{if((0,jt.wu)(m.type))return void p.push(new Promise(function(){var D=(0,$.A)(function*(M,pt){M([m])});return function(M,pt){return D.apply(this,arguments)}}()));let w=new Promise(function(){var D=(0,$.A)(function*(M,pt){let H=[],Kt=yield h.withTimeout(h.myPdfService.getImageWithPdf(m),3e5);H.push(...Kt),M(H)});return function(M,pt){return D.apply(this,arguments)}}());p.push(w)}),new Promise(function(){var m=(0,$.A)(function*(w,D){Promise.all(p).then(M=>{w(h.commonService.concatMultipleArray(M))}).catch(M=>{h.showErrorSnack("lang_azt_pdf_invalid_format"),w([])})});return function(w,D){return m.apply(this,arguments)}}())}withTimeout(r,h){return new Promise((p,m)=>{const w=setTimeout(()=>{m(new Error("Operation timed out"))},h);r.then(D=>{clearTimeout(w),p(D)}).catch(D=>{clearTimeout(w),m(D)})})}convertFileToUint8Array(r){return new Promise((h,p)=>{const m=new FileReader;m.onload=()=>{if(m.result instanceof ArrayBuffer){const w=new Uint8Array(m.result);h(w)}else p(new Error("Error reading file as ArrayBuffer."))},m.onerror=()=>{p(new Error("Error reading file."))},m.readAsArrayBuffer(r)})}ngOnInit(){super.ngOnInit()}constructor(r,h,p){super(),this.myPdfService=r,this.sAztConcurrencyApiService=h,this.apiUploadService=p,this.uploadData=new t.bkB,this.allUploadToCdnMenuTypes=Dt.b8,this.allUploadFileTypes=Dt.PO,this.uploadThread=10}static#t=this.\u0275fac=function(h){return new(h||s)(t.rXU(Et.C),t.rXU(Se),t.rXU(Ae.T))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-digitalize-pdf-to-images"]],outputs:{uploadData:"uploadData"},features:[t.Vt3],decls:3,vars:2,consts:[[3,"currentStatusObj","customText",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj","customText"],[3,"fileType","emitFiles"],[1,"btn","btn-primary-soft","w-full"],["name","plus","size","16",3,"ngClass"]],template:function(h,p){if(1&h&&(t.DNE(0,ce,1,2,"azt-loading-effect",0),t.DNE(1,he,6,9,"ng-template",null,1,t.C5r)),2&h){const m=t.sdS(2);t.Y8G("ngIf",p.statusObj.loading)("ngIfElse",m)}},dependencies:[j.YU,j.bT,Ut.K,se,X.WGl,L.wp],encapsulation:2})}return s})();const Te=function(s){return{"mb-2":s}},ze=function(s){return{"border-pending":s}};function Re(s,y){if(1&s){const r=t.RV6();t.j41(0,"div",4)(1,"span",5),t.EFF(2),t.k0s(),t.j41(3,"img",6),t.bIt("click",function(){const m=t.eBV(r).$implicit,w=t.XpG();return t.Njj(w.chooseImageEvent(m))}),t.k0s()()}if(2&s){const r=y.$implicit,h=y.last,p=t.XpG();t.Y8G("ngClass",t.eq3(4,Te,!h)),t.R7$(2),t.JRh(r.position),t.R7$(1),t.Y8G("src",r.image.url,t.B4B)("ngClass",t.eq3(6,ze,p.listSelectedUuids.includes(r.uuid)))}}let pe=(()=>{class s extends Z.H{chooseImageEvent(r){let h=this.objs.find(p=>p.uuid==r.uuid);h&&(h.isSelected=!h.isSelected,this.listSelectedUuids=this.objs.filter(p=>p.isSelected).map(p=>p.uuid),this.chooseImages.emit(this.objs.filter(p=>p.isSelected)))}ngOnChanges(){this.listSelectedUuids=this.objs.filter(r=>r.isSelected).map(r=>r.uuid)}ngOnInit(){super.ngOnInit()}constructor(){super(),this.chooseImages=new t.bkB,this.listSelectedUuids=[]}static#t=this.\u0275fac=function(h){return new(h||s)};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-digitalize-choose-images"]],inputs:{objs:"objs"},outputs:{chooseImages:"chooseImages"},features:[t.Vt3,t.OA$],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(h,p){1&h&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"ng-scrollbar",2),t.DNE(5,Re,4,8,"div",3),t.k0s()()),2&h&&(t.R7$(2),t.Lme("",t.bMT(3,4,"lang_digitalize_book_total_page"),": ",p.objs.length,""),t.R7$(2),t.Y8G("visibility","hover"),t.R7$(1),t.Y8G("ngForOf",p.objs))},dependencies:[j.YU,j.Sq,wt.Yh,L.wp],encapsulation:2})}return s})();const de=function(s){return{"mb-2":s}},ue=function(s){return{"border-pending":s}};function Me(s,y){if(1&s){const r=t.RV6();t.j41(0,"div",4)(1,"span",5),t.EFF(2),t.k0s(),t.j41(3,"img",6),t.bIt("click",function(){const m=t.eBV(r).$implicit,w=t.XpG();return t.Njj(w.processImage.emit(m))}),t.k0s()()}if(2&s){const r=y.$implicit,h=y.last,p=t.XpG();t.Y8G("ngClass",t.eq3(4,de,!h)),t.R7$(2),t.JRh(r.position),t.R7$(1),t.Y8G("src",r.image.url,t.B4B)("ngClass",t.eq3(6,ue,(null==p.currentObj?null:p.currentObj.uuid)==r.uuid))}}let je=(()=>{class s extends Z.H{ngOnInit(){super.ngOnInit(),this.viewObjs=this.objs.filter(r=>r.isSelected)}constructor(){super(),this.processImage=new t.bkB,this.viewObjs=[]}static#t=this.\u0275fac=function(h){return new(h||s)};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-digitalize-process-images"]],inputs:{objs:"objs",currentObj:"currentObj"},outputs:{processImage:"processImage"},features:[t.Vt3],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(h,p){1&h&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"ng-scrollbar",2),t.DNE(5,Me,4,8,"div",3),t.k0s()()),2&h&&(t.R7$(2),t.Lme("",t.bMT(3,4,"lang_digitalize_book_total_page"),": ",p.viewObjs.length,""),t.R7$(2),t.Y8G("visibility","hover"),t.R7$(1),t.Y8G("ngForOf",p.viewObjs))},dependencies:[j.YU,j.Sq,wt.Yh,L.wp],encapsulation:2})}return s})();var C=x(46899),ge=x(70254),Pt=x(89163),ht=x(33887);const ke=["angularCropper"];function ft(s,y){if(1&s){const r=t.RV6();t.qex(0),t.j41(1,"img",9),t.bIt("click",function(){const m=t.eBV(r).$implicit,w=t.XpG(2);return t.Njj(w.chooseImage(m))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&s){const r=y.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,r.base64,"png"),t.B4B)}}function Y(s,y){if(1&s&&(t.j41(0,"div",7),t.DNE(1,ft,3,4,"ng-container",8),t.k0s()),2&s){const r=t.XpG();t.R7$(1),t.Y8G("ngForOf",r.base64Images)}}function Be(s,y){if(1&s&&(t.nrm(0,"angular-cropper",10,11),t.nI1(2,"addBase64Extension")),2&s){const r=t.XpG();t.Y8G("cropperOptions",r.cropperOptions)("imageUrl",t.i5U(2,2,r.currentBase64Image.base64,"png"))}}let me=(()=>{class s extends ht._{chooseImage(r){this.currentBase64Image=r}cropImage(){this.angularCropper?.cropper.getCroppedCanvas().toBlob(r=>{r&&this.commonService.convertBlobToBase64(r,h=>{let p=this.angularCropper?.cropper.getCropBoxData(),m=p?.width,w=p?.height;!m||!w||this.base64Images.push({position:this.base64Images.length,base64:h,width:m,height:w,extension:"png"})})})}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(r,h){super(h,r),this.dialogRef=r,this.data=h,this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=h.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}static#t=this.\u0275fac=function(h){return new(h||s)(t.rXU(Pt.CP,8),t.rXU(Pt.Vh,8))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-coazt-image-editor"]],viewQuery:function(h,p){if(1&h&&t.GBs(ke,5),2&h){let m;t.mGM(m=t.lsd())&&(p.angularCropper=m.first)}},features:[t.Vt3],decls:11,vars:8,consts:[[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2","w-32",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"],[3,"cropperOptions","imageUrl"],["angularCropper",""]],template:function(h,p){1&h&&(t.j41(0,"div",0),t.DNE(1,Y,2,1,"div",1),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return p.cropImage()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",4),t.bIt("click",function(){return p.closeDialog()}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()(),t.j41(9,"div",5),t.DNE(10,Be,3,5,"angular-cropper",6),t.k0s()()),2&h&&(t.R7$(1),t.Y8G("ngIf",p.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,4,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(8,6,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",p.currentBase64Image))},dependencies:[j.Sq,j.bT,Rt,L.wp,L.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]})}return s})();function R(s,y){if(1&s){const r=t.RV6();t.qex(0),t.j41(1,"img",8),t.bIt("click",function(){const m=t.eBV(r).$implicit,w=t.XpG(2);return t.Njj(w.chooseImage(m))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&s){const r=y.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,r.base64,r.extension),t.B4B)}}function T(s,y){if(1&s&&(t.j41(0,"div",6),t.DNE(1,R,3,4,"ng-container",7),t.k0s()),2&s){const r=t.XpG();t.R7$(1),t.Y8G("ngForOf",r.obj.image.base64Images)}}function Ne(s,y){if(1&s&&(t.j41(0,"div",9),t.nrm(1,"editor",10)(2,"hr",11)(3,"div",12),t.nI1(4,"safeNormalHtmlContent"),t.nI1(5,"async"),t.nI1(6,"mathJaxContent"),t.k0s()),2&s){const r=t.XpG();t.R7$(1),t.FS9("apiKey",r.tinyEditorKey),t.Y8G("formControl",r.htmlFormControl)("init",r.initDataEditor),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(2),t.Y8G("innerHTML",t.bMT(4,5,t.bMT(5,7,t.bMT(6,9,r.obj.htmlResult))),t.npT)}}let vt=(()=>{class s extends Z.H{constructor(){super(...arguments),this.changeObj=new t.bkB,this.sAztDialogService=(0,t.WQX)(C.i),this.tinyMceService=(0,t.WQX)(ge.f),this.sAztDigitalizeService=(0,t.WQX)(Mt),this.htmlFormControl=new K.MJ("",{nonNullable:!0}),this.initDataEditor={},this.tinyEditorKey=Yt.c.tinyEditorKey,this.showTinyMceEditor=!1,this.reRenderComponent=void 0}chooseImage(r){this.obj.htmlResult=this.obj.htmlResult.replace("<img>",`<img src='${this.commonService.generateBase64Prefix(r.extension)+r.base64}'/>`),this.htmlFormControl.setValue(this.obj.htmlResult)}cropImageDialog(){let r=[{position:-1,base64:this.sAztDigitalizeService.uint8ArrayToBase64(new Uint8Array(this.obj.image.fileBytes)),width:100,height:100,extension:"png"}],h=this.obj.image.base64Images.map((m,w)=>({...m,position:w}));r=r.concat(h),this.sAztDialogService.open(me,{data:{base64Images:r},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(m=>{null!=m&&(this.obj.image.base64Images=m.slice(1),this.changeObj.emit(this.obj))})}ngOnChanges(){console.log("On change value"),this.reRenderComponent=void 0,this.htmlFormControl.setValue(this.obj.htmlResult),setTimeout(()=>this.reRenderComponent="OK",0)}ngOnInit(){this.htmlFormControl.valueChanges.subscribe(()=>{this.obj.htmlResult=this.htmlFormControl.getRawValue(),this.changeObj.emit(this.obj)}),this.initDataEditor=this.tinyMceService.initConfigForAdminForDigitalized(Dt.b8.ADMIN)}static#t=this.\u0275fac=function(){let r;return function(p){return(r||(r=t.xGo(s)))(p||s)}}();static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-digitalize-preview-result"]],inputs:{obj:"obj"},outputs:{changeObj:"changeObj"},features:[t.Vt3,t.OA$],decls:8,vars:5,consts:[["class","box p-3 mb-3 list-base640-images",4,"ngIf"],[1,"mb-3"],[1,"btn","btn-primary","w-32",3,"click"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-12"],["class","box p-3",4,"ngIf"],[1,"box","p-3","mb-3","list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"],[1,"box","p-3"],[3,"formControl","apiKey","init"],[1,"mt-8","mb-8"],[3,"innerHTML"]],template:function(h,p){1&h&&(t.DNE(0,T,2,1,"div",0),t.j41(1,"div",1)(2,"span",2),t.bIt("click",function(){return p.cropImageDialog()}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3)(6,"div",4),t.DNE(7,Ne,7,11,"div",5),t.k0s()()),2&h&&(t.Y8G("ngIf",p.obj.image.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(4,3,"lang_button_crop")),t.R7$(4),t.Y8G("ngIf",p.reRenderComponent))},dependencies:[j.Sq,j.bT,K.BC,gt.xn,K.l_,j.Jj,L.wp,L.km,L._y,L.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px}"]})}return s})();function Pe(s,y){if(1&s&&t.nrm(0,"azt-loading-effect",4),2&s){const r=t.XpG();t.Y8G("currentStatusObj",r.statusObj)}}function rt(s,y){if(1&s){const r=t.RV6();t.j41(0,"app-digitalize-pdf-to-images",16),t.bIt("uploadData",function(p){t.eBV(r);const m=t.XpG(2);return t.Njj(m.uploadData(p))}),t.k0s()}}function Ge(s,y){if(1&s){const r=t.RV6();t.j41(0,"div",17),t.bIt("click",function(){t.eBV(r);const p=t.XpG(2);return t.Njj(p.showChooseLayout())}),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()}2&s&&(t.R7$(1),t.JRh(t.bMT(2,1,"lang_digitalize_book_go_back_choose_layout")))}function B(s,y){if(1&s){const r=t.RV6();t.j41(0,"app-digitalize-choose-images",21),t.bIt("chooseImages",function(p){t.eBV(r);const m=t.XpG(3);return t.Njj(m.chooseImages(p))}),t.k0s()}if(2&s){const r=t.XpG(3);t.Y8G("objs",r.objs)}}function q(s,y){if(1&s){const r=t.RV6();t.j41(0,"app-digitalize-process-images",22),t.bIt("processImage",function(p){t.eBV(r);const m=t.XpG(3);return t.Njj(m.processImage(p))}),t.k0s()}if(2&s){const r=t.XpG(3);t.Y8G("objs",r.objs)("currentObj",r.currentObj)}}function _t(s,y){if(1&s&&(t.j41(0,"div",18),t.DNE(1,B,1,1,"app-digitalize-choose-images",19),t.DNE(2,q,1,2,"app-digitalize-process-images",20),t.k0s()),2&s){const r=t.XpG(2);t.R7$(1),t.Y8G("ngIf",r.currentLayout==r.allLayouts.CHOOSE_IMAGES),t.R7$(1),t.Y8G("ngIf",r.currentLayout==r.allLayouts.PROCESS_IMAGES)}}function Le(s,y){if(1&s){const r=t.RV6();t.j41(0,"div")(1,"div",12),t.bIt("click",function(){t.eBV(r);const p=t.XpG(3);return t.Njj(p.startProcess())}),t.EFF(2),t.nI1(3,"mytranslate"),t.nI1(4,"mytranslate"),t.k0s()()}if(2&s){const r=t.XpG(3);t.R7$(2),t.E5c("",t.bMT(3,3,"lang_digitalize_book_start_call_orc_api")," (",r.totalSelected," ",t.bMT(4,5,"lang_digitalize_book_total_images"),")")}}function Wt(s,y){1&s&&(t.EFF(0),t.nI1(1,"mytranslate")),2&s&&t.SpI(" ",t.bMT(1,1,"lang_digitalize_book_please_choose_image")," ")}function Qt(s,y){if(1&s&&(t.qex(0),t.j41(1,"div",18),t.DNE(2,Le,5,7,"div",23),t.DNE(3,Wt,2,3,"ng-template",null,24,t.C5r),t.k0s(),t.bVm()),2&s){const r=t.sdS(4),h=t.XpG(2);t.R7$(2),t.Y8G("ngIf",h.totalSelected>0)("ngIfElse",r)}}function St(s,y){if(1&s){const r=t.RV6();t.j41(0,"div")(1,"span",25),t.bIt("click",function(){t.eBV(r);const p=t.XpG(4);return t.Njj(p.processAllAgain())}),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s()()}2&s&&(t.R7$(2),t.JRh(t.bMT(3,1,"lang_digitalize_book_call_ocr_all_again")))}function Fe(s,y){if(1&s){const r=t.RV6();t.j41(0,"div")(1,"span",26),t.bIt("click",function(){t.eBV(r);const p=t.XpG(4);return t.Njj(p.processCurrentPageAgain())}),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s()()}2&s&&(t.R7$(2),t.JRh(t.bMT(3,1,"lang_digitalize_book_call_ocr_current_page_again")))}function fe(s,y){if(1&s){const r=t.RV6();t.j41(0,"div")(1,"app-digitalize-preview-result",27),t.bIt("changeObj",function(p){t.eBV(r);const m=t.XpG(4);return t.Njj(m.changeObj(p))}),t.k0s()()}if(2&s){const r=t.XpG(4);t.R7$(1),t.Y8G("obj",r.currentObj)}}function ve(s,y){if(1&s&&t.nrm(0,"azt-loading-effect",29),2&s){const r=t.XpG(5);t.Y8G("currentStatusObj",r.processStatusObj)("customText",r.processStatusObj.errorMessage)}}function Q(s,y){if(1&s&&(t.j41(0,"div"),t.DNE(1,ve,1,2,"azt-loading-effect",28),t.k0s()),2&s){const r=t.XpG(4);t.R7$(1),t.Y8G("ngIf",r.processStatusObj.loading)}}function V(s,y){if(1&s&&(t.qex(0),t.DNE(1,St,4,3,"div",15),t.DNE(2,Fe,4,3,"div",15),t.DNE(3,fe,2,1,"div",15),t.DNE(4,Q,2,1,"div",15),t.bVm()),2&s){const r=t.XpG(3);t.R7$(1),t.Y8G("ngIf",r.currentObj.processStatus==r.allProcessStatuses.PROCESS_ERROR),t.R7$(1),t.Y8G("ngIf",r.currentObj.processStatus==r.allProcessStatuses.PROCESSED),t.R7$(1),t.Y8G("ngIf",r.currentObj.processStatus==r.allProcessStatuses.PROCESSED),t.R7$(1),t.Y8G("ngIf",r.currentObj.processStatus==r.allProcessStatuses.NONE||r.currentObj.processStatus==r.allProcessStatuses.PROCESSING)}}function bt(s,y){1&s&&(t.qex(0),t.j41(1,"div",18),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.bVm()),2&s&&(t.R7$(2),t.JRh(t.bMT(3,1,"lang_digitalize_book_please_choose_image")))}function _e(s,y){if(1&s&&(t.qex(0),t.DNE(1,V,5,4,"ng-container",15),t.DNE(2,bt,4,3,"ng-container",15),t.bVm()),2&s){const r=t.XpG(2);t.R7$(1),t.Y8G("ngIf",r.currentObj),t.R7$(1),t.Y8G("ngIf",!r.currentObj)}}function Jt(s,y){if(1&s){const r=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),t.DNE(4,rt,1,0,"app-digitalize-pdf-to-images",9),t.DNE(5,Ge,3,3,"div",10),t.k0s(),t.j41(6,"div",11)(7,"div",12),t.bIt("click",function(){t.eBV(r);const p=t.XpG();return t.Njj(p.downloadData("html"))}),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s()(),t.j41(10,"div",11)(11,"div",12),t.bIt("click",function(){t.eBV(r);const p=t.XpG();return t.Njj(p.downloadData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.DNE(14,_t,3,2,"div",13),t.k0s(),t.j41(15,"div",14),t.DNE(16,Qt,5,2,"ng-container",15),t.DNE(17,_e,3,2,"ng-container",15),t.k0s()()}if(2&s){const r=t.XpG();t.R7$(4),t.Y8G("ngIf",r.currentLayout==r.allLayouts.CHOOSE_IMAGES),t.R7$(1),t.Y8G("ngIf",r.currentLayout==r.allLayouts.PROCESS_IMAGES),t.R7$(3),t.JRh(t.bMT(9,7,"lang_digitalize_book_download_result_html")),t.R7$(4),t.JRh(t.bMT(13,9,"lang_digitalize_book_download_result_docx")),t.R7$(2),t.Y8G("ngIf",r.objs.length>0),t.R7$(2),t.Y8G("ngIf",r.currentLayout==r.allLayouts.CHOOSE_IMAGES),t.R7$(1),t.Y8G("ngIf",r.currentLayout==r.allLayouts.PROCESS_IMAGES)}}const be=[{path:"",children:[{path:"digitalize-book",component:(()=>{class s extends Z.H{startProcess(){this.currentLayout=k.PROCESS_IMAGES;let r=this.objs.filter(p=>p.isSelected);this.processImage(this.commonService.getFirstOfArray(r));let h=r.filter(p=>![U.PROCESSING,U.PROCESSED].includes(p.processStatus));this.callOrcApi("startProcess",h,0)}processCurrentPageAgain(){return this.currentObj?this.currentObj.processStatus==U.PROCESSING?this.showErrorSnack("lang_digitalize_current_page_is_processing"):void this.callOrcApi("processCurrentPageAgain",[this.currentObj],0):this.showErrorSnack("lang_digitalize_not_select_any_current_page")}processAllAgain(){let r=this.objs.filter(h=>h.isSelected&&![U.PROCESSING,U.PROCESSED].includes(h.processStatus));if(r.length<=0)return this.showErrorSnack("lang_digitalize_not_found_any_error_record");this.callOrcApi("processAllAgain",r,0)}callOrcApi(r,h,p=0,m=1){if(console.log("Call orc api for: "+r+", totalObjs: "+h.length+", startIndex: "+p),p>=h.length)return void(this.processStatusObj.loading=!1);p<=0&&h.forEach(M=>M.processStatus=U.PROCESSING);let D=h.slice(p,p+m).map(M=>this.runDigitalizeOneImage(M));Promise.all(D).then(()=>{console.log("Call done ocr api for: "+h.length,", startIndex: "+p),this.callOrcApi(r,h,p+m,m)})}runDigitalizeOneImage(r){return new Promise((h,p)=>{this.sAztDigitalizeService.digitalizeData(r,m=>{this.processStatusObj={loading:!0,errorMessage:m,mustShowErrorBox:!1}},m=>{r.processStatus=U.PROCESS_ERROR,console.log("lang_digitalize_error_at_digitalized_function",m),this.replaceCurrentObj(r),h()},m=>{r={...m,processStatus:U.PROCESSED},this.replaceCurrentObj(r),h()})})}replaceCurrentObj(r){let h=this.objs.find(p=>p.uuid==r.uuid);if(null==h)return this.showErrorSnack("lang_digitalize_not_found_position_in_replace_function");Object.assign(h,r),console.log("Orc done: ","cur position:"+this.currentObj?.position+", orc position: "+h?.position+", orc image url: "+h?.image.url),this.currentObj&&this.processImage(this.currentObj)}chooseImages(r){let h=r.map(p=>p.uuid);this.objs.forEach(p=>p.isSelected=!!h.includes(p.uuid)||p.isSelected),this.totalSelected=this.objs.filter(p=>p.isSelected).length}processImage(r){if(!r)return;let h=this.objs.find(p=>p.uuid==r.uuid);h&&(this.currentObj={...h}),console.log("View new image: status: "+h?.processStatus+", position: "+h?.position+", url: "+h?.image.url)}showChooseLayout(){this.objs.forEach(r=>r.isSelected=!1),this.totalSelected=this.objs.filter(r=>r.isSelected).length,this.currentLayout=k.CHOOSE_IMAGES}changeObj(r){let h=this.objs.find(p=>p.uuid==r.uuid);h&&Object.assign(h,r)}uploadData(r){this.objs=r.map((h,p)=>({uuid:this.sAztUuidService.getUuid(),image:h,htmlResult:"",position:p+1,isSelected:!1,processStatus:U.NONE}))}downloadData(r){let h=new Date,p="";if(this.objs.forEach(m=>{p+=`<page [page]='${m.position}'/>`+(m.processStatus==U.PROCESSED?m.htmlResult:"")}),p=this.commonService.decodeHtmlEntities(p),"html"!=r)p=this.commonService.convertDollarDollarToLatexTag(p),this.commonService.loadAzotaDocxJs().then(()=>{azotaDocx.textToDocxBinary(p,null).then(m=>{let w=`azota-digitalize-book-${h.getDate()}${h.getMonth()+1}${h.getFullYear()}-${h.getTime()}.docx`;const D=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});D&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(D),w)}).catch(m=>{this.showErrorSnack(m)})}).catch(m=>{this.showErrorSnack(m)});else{let m=`azota-digitalize-book-${h.getDate()}${h.getMonth()+1}${h.getFullYear()}-${h.getTime()}.html`;const w=new Blob([p],{type:"text/plain"});w&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(w),m)}}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_book",description:"lang_cms_admin_common_digitalize_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(Mt),this.sAztUuidService=(0,t.WQX)(lt.D),this.processStatusObj={loading:!1,errorMessage:"",mustShowErrorBox:!1},this.headerBackTo="",this.objs=[],this.totalSelected=0,this.currentLayout=k.CHOOSE_IMAGES,this.allLayouts=k,this.allProcessStatuses=U}static#t=this.\u0275fac=function(h){return new(h||s)};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-digitalize-book"]],features:[t.Vt3],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-3"],[1,"box","p-3","mb-3","grid","grid-cols-12","gap-2"],[1,"col-span-12"],[3,"uploadData",4,"ngIf"],["class","btn btn-primary-soft w-full",3,"click",4,"ngIf"],[1,"col-span-6"],[1,"btn","btn-primary","w-full",3,"click"],["class","box p-3",4,"ngIf"],[1,"col-span-9"],[4,"ngIf"],[3,"uploadData"],[1,"btn","btn-primary-soft","w-full",3,"click"],[1,"box","p-3"],[3,"objs","chooseImages",4,"ngIf"],[3,"objs","currentObj","processImage",4,"ngIf"],[3,"objs","chooseImages"],[3,"objs","currentObj","processImage"],[4,"ngIf","ngIfElse"],["notSelectAnyObj",""],[1,"mb-3","btn","btn-pending",3,"click"],[1,"mb-3","btn","btn-info",3,"click"],[3,"obj","changeObj"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"currentStatusObj","customText"]],template:function(h,p){if(1&h&&(t.j41(0,"teacher-layout",0)(1,"div",1),t.DNE(2,Pe,1,1,"azt-loading-effect",2),t.DNE(3,Jt,18,11,"ng-template",null,3,t.C5r),t.k0s()()),2&h){const m=t.sdS(4);t.Y8G("headerBackToLink",p.headerBackTo),t.R7$(2),t.Y8G("ngIf",p.statusObj.loading)("ngIfElse",m)}},dependencies:[j.bT,Ut.K,De.Q,Ie,pe,je,vt,L.wp],encapsulation:2})}return s})()}]}];let ye=(()=>{class s{static#t=this.\u0275fac=function(h){return new(h||s)};static#e=this.\u0275mod=t.$C({type:s});static#i=this.\u0275inj=t.G2t({imports:[ot.iI.forChild(be),ot.iI,ct.XE]})}return s})(),At=(()=>{class s{static#t=this.\u0275fac=function(h){return new(h||s)};static#e=this.\u0275mod=t.$C({type:s});static#i=this.\u0275inj=t.G2t({providers:[{provide:gt.vn,useValue:Yt.c.azt_tiny_mce_script_src}],imports:[ot.iI,j.MD,K.YN,gt.sv,I.s,K.X1,ye,te.Q,Ft.L,wt.Id,qt.b,X.flO.pick(X.Ptg),Lt.AC,at]})}return s})()},17715:function(Oe){Oe.exports=function(){"use strict";function et(n){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}function j(n,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function ot(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function gt(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable})),a.push.apply(a,i)}return a}function t(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?gt(Object(a),!0).forEach(function(i){ot(n,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):gt(Object(a)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(a,i))})}return n}function Zt(n){return function st(n){if(Array.isArray(n))return Gt(n)}(n)||function mt(n){if(typeof Symbol<"u"&&Symbol.iterator in Object(n))return Array.from(n)}(n)||function it(n,e){if(n){if("string"==typeof n)return Gt(n,e);var a=Object.prototype.toString.call(n).slice(8,-1);if("Object"===a&&n.constructor&&(a=n.constructor.name),"Map"===a||"Set"===a)return Array.from(n);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Gt(n,e)}}(n)||function Rt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gt(n,e){(null==e||e>n.length)&&(e=n.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=n[a];return i}var at=typeof window<"u"&&typeof window.document<"u",X=at?window:{},Lt=!(!at||!X.document.documentElement)&&"ontouchstart"in X.document.documentElement,wt=!!at&&"PointerEvent"in X,I="cropper",Z="s",$="n",xt="ne",L="nw",Ct="se",Ot="sw",Mt="".concat(I,"-crop"),U="".concat(I,"-disabled"),k="".concat(I,"-hidden"),Ut="".concat(I,"-hide"),De="".concat(I,"-invisible"),jt="".concat(I,"-modal"),Dt="".concat(I,"-move"),Et="".concat(I,"Action"),kt="".concat(I,"Preview"),Xt="crop",Bt="crop",$t="cropend",Nt="cropmove",Vt="cropstart",ae="dblclick",re=wt?"pointerdown":Lt?"touchstart":"mousedown",ne=wt?"pointermove":Lt?"touchmove":"mousemove",oe=wt?"pointerup pointercancel":Lt?"touchend touchcancel":"mouseup",Ht="zoom",he="image/jpeg",Ie=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Te=/^data:/,ze=/^data:image\/jpeg;base64,/,Re=/^img|canvas$/i,ue={viewMode:0,dragMode:Xt,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},je=Number.isNaN||X.isNaN;function C(n){return"number"==typeof n&&!je(n)}var ge=function(e){return e>0&&e<1/0};function Pt(n){return typeof n>"u"}function ht(n){return"object"===et(n)&&null!==n}var ke=Object.prototype.hasOwnProperty;function ft(n){if(!ht(n))return!1;try{var e=n.constructor,a=e.prototype;return e&&a&&ke.call(a,"isPrototypeOf")}catch{return!1}}function Y(n){return"function"==typeof n}var Be=Array.prototype.slice;function me(n){return Array.from?Array.from(n):Be.call(n)}function R(n,e){return n&&Y(e)&&(Array.isArray(n)||C(n.length)?me(n).forEach(function(a,i){e.call(n,a,i,n)}):ht(n)&&Object.keys(n).forEach(function(a){e.call(n,n[a],a,n)})),n}var T=Object.assign||function(e){for(var a=arguments.length,i=new Array(a>1?a-1:0),c=1;c<a;c++)i[c-1]=arguments[c];return ht(e)&&i.length>0&&i.forEach(function(o){ht(o)&&Object.keys(o).forEach(function(l){e[l]=o[l]})}),e},Ne=/\.\d*(?:0|9){12}\d*$/;function vt(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Ne.test(n)?Math.round(n*e)/e:n}var Pe=/^width|height|left|top|marginLeft|marginTop$/;function rt(n,e){var a=n.style;R(e,function(i,c){Pe.test(c)&&C(i)&&(i="".concat(i,"px")),a[c]=i})}function B(n,e){if(e){if(C(n.length))return void R(n,function(i){B(i,e)});if(n.classList)return void n.classList.add(e);var a=n.className.trim();a?a.indexOf(e)<0&&(n.className="".concat(a," ").concat(e)):n.className=e}}function q(n,e){if(e){if(C(n.length))return void R(n,function(a){q(a,e)});if(n.classList)return void n.classList.remove(e);n.className.indexOf(e)>=0&&(n.className=n.className.replace(e,""))}}function _t(n,e,a){if(e){if(C(n.length))return void R(n,function(i){_t(i,e,a)});a?B(n,e):q(n,e)}}var Le=/([a-z\d])([A-Z])/g;function Wt(n){return n.replace(Le,"$1-$2").toLowerCase()}function Qt(n,e){return ht(n[e])?n[e]:n.dataset?n.dataset[e]:n.getAttribute("data-".concat(Wt(e)))}function St(n,e,a){ht(a)?n[e]=a:n.dataset?n.dataset[e]=a:n.setAttribute("data-".concat(Wt(e)),a)}var fe=/\s\s*/,ve=function(){var n=!1;if(at){var e=!1,a=function(){},i=Object.defineProperty({},"once",{get:function(){return n=!0,e},set:function(o){e=o}});X.addEventListener("test",a,i),X.removeEventListener("test",a,i)}return n}();function Q(n,e,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=a;e.trim().split(fe).forEach(function(o){if(!ve){var l=n.listeners;l&&l[o]&&l[o][a]&&(c=l[o][a],delete l[o][a],0===Object.keys(l[o]).length&&delete l[o],0===Object.keys(l).length&&delete n.listeners)}n.removeEventListener(o,c,i)})}function V(n,e,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=a;e.trim().split(fe).forEach(function(o){if(i.once&&!ve){var l=n.listeners,d=void 0===l?{}:l;c=function(){delete d[o][a],n.removeEventListener(o,c,i);for(var f=arguments.length,g=new Array(f),u=0;u<f;u++)g[u]=arguments[u];a.apply(n,g)},d[o]||(d[o]={}),d[o][a]&&n.removeEventListener(o,d[o][a],i),d[o][a]=c,n.listeners=d}n.addEventListener(o,c,i)})}function bt(n,e,a){var i;return Y(Event)&&Y(CustomEvent)?i=new CustomEvent(e,{detail:a,bubbles:!0,cancelable:!0}):(i=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,a),n.dispatchEvent(i)}function _e(n){var e=n.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var Jt=X.location,Xe=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function be(n){var e=n.match(Xe);return null!==e&&(e[1]!==Jt.protocol||e[2]!==Jt.hostname||e[3]!==Jt.port)}function ye(n){var e="timestamp=".concat((new Date).getTime());return n+(-1===n.indexOf("?")?"?":"&")+e}function At(n){var e=n.rotate,a=n.scaleX,i=n.scaleY,c=n.translateX,o=n.translateY,l=[];C(c)&&0!==c&&l.push("translateX(".concat(c,"px)")),C(o)&&0!==o&&l.push("translateY(".concat(o,"px)")),C(e)&&0!==e&&l.push("rotate(".concat(e,"deg)")),C(a)&&1!==a&&l.push("scaleX(".concat(a,")")),C(i)&&1!==i&&l.push("scaleY(".concat(i,")"));var d=l.length?l.join(" "):"none";return{WebkitTransform:d,msTransform:d,transform:d}}function y(n,e){var a=n.pageX,i=n.pageY,c={endX:a,endY:i};return e?c:t({startX:a,startY:i},c)}function h(n){var e=n.aspectRatio,a=n.height,i=n.width,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",o=ge(i),l=ge(a);if(o&&l){var d=a*e;"contain"===c&&d>i||"cover"===c&&d<i?a=i/e:i=a*e}else o?a=i/e:l&&(i=a*e);return{width:i,height:a}}var w=String.fromCharCode;var M=/^data:.*,/;function we(n){var a,e=new DataView(n);try{var i,c,o;if(255===e.getUint8(0)&&216===e.getUint8(1))for(var l=e.byteLength,d=2;d+1<l;){if(255===e.getUint8(d)&&225===e.getUint8(d+1)){c=d;break}d+=1}if(c){var f=c+10;if("Exif"===function D(n,e,a){var i="";a+=e;for(var c=e;c<a;c+=1)i+=w(n.getUint8(c));return i}(e,c+4,4)){var g=e.getUint16(f);if(((i=18761===g)||19789===g)&&42===e.getUint16(f+2,i)){var u=e.getUint32(f+4,i);u>=8&&(o=f+u)}}}if(o){var E,O,v=e.getUint16(o,i);for(O=0;O<v;O+=1)if(274===e.getUint16(E=o+12*O+2,i)){a=e.getUint16(E+=8,i),e.setUint16(E,1,i);break}}}catch{a=1}return a}var xe={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,a=this.options,i=this.container,c=this.cropper,o=Number(a.minContainerWidth),l=Number(a.minContainerHeight);B(c,k),q(e,k);var d={width:Math.max(i.offsetWidth,o>=0?o:200),height:Math.max(i.offsetHeight,l>=0?l:100)};this.containerData=d,rt(c,{width:d.width,height:d.height}),B(e,k),q(c,k)},initCanvas:function(){var e=this.containerData,a=this.imageData,i=this.options.viewMode,c=Math.abs(a.rotate)%180==90,o=c?a.naturalHeight:a.naturalWidth,l=c?a.naturalWidth:a.naturalHeight,d=o/l,_=e.width,f=e.height;e.height*d>e.width?3===i?_=e.height*d:f=e.width/d:3===i?f=e.width/d:_=e.height*d;var g={aspectRatio:d,naturalWidth:o,naturalHeight:l,width:_,height:f};this.canvasData=g,this.limited=1===i||2===i,this.limitCanvas(!0,!0),g.width=Math.min(Math.max(g.width,g.minWidth),g.maxWidth),g.height=Math.min(Math.max(g.height,g.minHeight),g.maxHeight),g.left=(e.width-g.width)/2,g.top=(e.height-g.height)/2,g.oldLeft=g.left,g.oldTop=g.top,this.initialCanvasData=T({},g)},limitCanvas:function(e,a){var i=this.options,c=this.containerData,o=this.canvasData,l=this.cropBoxData,d=i.viewMode,_=o.aspectRatio,f=this.cropped&&l;if(e){var g=Number(i.minCanvasWidth)||0,u=Number(i.minCanvasHeight)||0;d>1?(g=Math.max(g,c.width),u=Math.max(u,c.height),3===d&&(u*_>g?g=u*_:u=g/_)):d>0&&(g?g=Math.max(g,f?l.width:0):u?u=Math.max(u,f?l.height:0):f&&((u=l.height)*_>(g=l.width)?g=u*_:u=g/_));var v=h({aspectRatio:_,width:g,height:u});u=v.height,o.minWidth=g=v.width,o.minHeight=u,o.maxWidth=1/0,o.maxHeight=1/0}if(a)if(d>(f?0:1)){var E=c.width-o.width,O=c.height-o.height;o.minLeft=Math.min(0,E),o.minTop=Math.min(0,O),o.maxLeft=Math.max(0,E),o.maxTop=Math.max(0,O),f&&this.limited&&(o.minLeft=Math.min(l.left,l.left+(l.width-o.width)),o.minTop=Math.min(l.top,l.top+(l.height-o.height)),o.maxLeft=l.left,o.maxTop=l.top,2===d&&(o.width>=c.width&&(o.minLeft=Math.min(0,E),o.maxLeft=Math.max(0,E)),o.height>=c.height&&(o.minTop=Math.min(0,O),o.maxTop=Math.max(0,O))))}else o.minLeft=-o.width,o.minTop=-o.height,o.maxLeft=c.width,o.maxTop=c.height},renderCanvas:function(e,a){var i=this.canvasData,c=this.imageData;if(a){var o=function p(n){var e=n.width,a=n.height,i=n.degree;if(90==(i=Math.abs(i)%180))return{width:a,height:e};var c=i%90*Math.PI/180,o=Math.sin(c),l=Math.cos(c),d=e*l+a*o,_=e*o+a*l;return i>90?{width:_,height:d}:{width:d,height:_}}({width:c.naturalWidth*Math.abs(c.scaleX||1),height:c.naturalHeight*Math.abs(c.scaleY||1),degree:c.rotate||0}),l=o.width,d=o.height,_=i.width*(l/i.naturalWidth),f=i.height*(d/i.naturalHeight);i.left-=(_-i.width)/2,i.top-=(f-i.height)/2,i.width=_,i.height=f,i.aspectRatio=l/d,i.naturalWidth=l,i.naturalHeight=d,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,rt(this.canvas,T({width:i.width,height:i.height},At({translateX:i.left,translateY:i.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var a=this.canvasData,i=this.imageData,c=i.naturalWidth*(a.width/a.naturalWidth),o=i.naturalHeight*(a.height/a.naturalHeight);T(i,{width:c,height:o,left:(a.width-c)/2,top:(a.height-o)/2}),rt(this.image,T({width:i.width,height:i.height},At(T({translateX:i.left,translateY:i.top},i)))),e&&this.output()},initCropBox:function(){var e=this.options,a=this.canvasData,i=e.aspectRatio||e.initialAspectRatio,c=Number(e.autoCropArea)||.8,o={width:a.width,height:a.height};i&&(a.height*i>a.width?o.height=o.width/i:o.width=o.height*i),this.cropBoxData=o,this.limitCropBox(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.width=Math.max(o.minWidth,o.width*c),o.height=Math.max(o.minHeight,o.height*c),o.left=a.left+(a.width-o.width)/2,o.top=a.top+(a.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCropBoxData=T({},o)},limitCropBox:function(e,a){var i=this.options,c=this.containerData,o=this.canvasData,l=this.cropBoxData,d=this.limited,_=i.aspectRatio;if(e){var f=Number(i.minCropBoxWidth)||0,g=Number(i.minCropBoxHeight)||0,u=d?Math.min(c.width,o.width,o.width+o.left,c.width-o.left):c.width,v=d?Math.min(c.height,o.height,o.height+o.top,c.height-o.top):c.height;f=Math.min(f,c.width),g=Math.min(g,c.height),_&&(f&&g?g*_>f?g=f/_:f=g*_:f?g=f/_:g&&(f=g*_),v*_>u?v=u/_:u=v*_),l.minWidth=Math.min(f,u),l.minHeight=Math.min(g,v),l.maxWidth=u,l.maxHeight=v}a&&(d?(l.minLeft=Math.max(0,o.left),l.minTop=Math.max(0,o.top),l.maxLeft=Math.min(c.width,o.left+o.width)-l.width,l.maxTop=Math.min(c.height,o.top+o.height)-l.height):(l.minLeft=0,l.minTop=0,l.maxLeft=c.width-l.width,l.maxTop=c.height-l.height))},renderCropBox:function(){var e=this.options,a=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,e.movable&&e.cropBoxMovable&&St(this.face,Et,i.width>=a.width&&i.height>=a.height?"move":"all"),rt(this.cropBox,T({width:i.width,height:i.height},At({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),bt(this.element,Bt,this.getData())}},Je={initPreview:function(){var e=this.element,a=this.crossOrigin,i=this.options.preview,c=a?this.crossOriginUrl:this.url,o=e.alt||"The image to preview",l=document.createElement("img");if(a&&(l.crossOrigin=a),l.src=c,l.alt=o,this.viewBox.appendChild(l),this.viewBoxImage=l,i){var d=i;"string"==typeof i?d=e.ownerDocument.querySelectorAll(i):i.querySelector&&(d=[i]),this.previews=d,R(d,function(_){var f=document.createElement("img");St(_,kt,{width:_.offsetWidth,height:_.offsetHeight,html:_.innerHTML}),a&&(f.crossOrigin=a),f.src=c,f.alt=o,f.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',_.innerHTML="",_.appendChild(f)})}},resetPreview:function(){R(this.previews,function(e){var a=Qt(e,kt);rt(e,{width:a.width,height:a.height}),e.innerHTML=a.html,function Fe(n,e){if(ht(n[e]))try{delete n[e]}catch{n[e]=void 0}else if(n.dataset)try{delete n.dataset[e]}catch{n.dataset[e]=void 0}else n.removeAttribute("data-".concat(Wt(e)))}(e,kt)})},preview:function(){var e=this.imageData,a=this.canvasData,i=this.cropBoxData,c=i.width,o=i.height,l=e.width,d=e.height,_=i.left-a.left-e.left,f=i.top-a.top-e.top;!this.cropped||this.disabled||(rt(this.viewBoxImage,T({width:l,height:d},At(T({translateX:-_,translateY:-f},e)))),R(this.previews,function(g){var u=Qt(g,kt),v=u.width,E=u.height,O=v,z=E,S=1;c&&(z=o*(S=v/c)),o&&z>E&&(O=c*(S=E/o),z=E),rt(g,{width:O,height:z}),rt(g.getElementsByTagName("img")[0],T({width:l*S,height:d*S},At(T({translateX:-_*S,translateY:-f*S},e))))}))}},Ke={bind:function(){var e=this.element,a=this.options,i=this.cropper;Y(a.cropstart)&&V(e,Vt,a.cropstart),Y(a.cropmove)&&V(e,Nt,a.cropmove),Y(a.cropend)&&V(e,$t,a.cropend),Y(a.crop)&&V(e,Bt,a.crop),Y(a.zoom)&&V(e,Ht,a.zoom),V(i,re,this.onCropStart=this.cropStart.bind(this)),a.zoomable&&a.zoomOnWheel&&V(i,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&V(i,ae,this.onDblclick=this.dblclick.bind(this)),V(e.ownerDocument,ne,this.onCropMove=this.cropMove.bind(this)),V(e.ownerDocument,oe,this.onCropEnd=this.cropEnd.bind(this)),a.responsive&&V(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,a=this.options,i=this.cropper;Y(a.cropstart)&&Q(e,Vt,a.cropstart),Y(a.cropmove)&&Q(e,Nt,a.cropmove),Y(a.cropend)&&Q(e,$t,a.cropend),Y(a.crop)&&Q(e,Bt,a.crop),Y(a.zoom)&&Q(e,Ht,a.zoom),Q(i,re,this.onCropStart),a.zoomable&&a.zoomOnWheel&&Q(i,"wheel",this.onWheel,{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&Q(i,ae,this.onDblclick),Q(e.ownerDocument,ne,this.onCropMove),Q(e.ownerDocument,oe,this.onCropEnd),a.responsive&&Q(window,"resize",this.onResize)}},Ze={resize:function(){if(!this.disabled){var o,l,e=this.options,a=this.container,i=this.containerData,c=a.offsetWidth/i.width;1===c&&a.offsetHeight===i.height||(e.restore&&(o=this.getCanvasData(),l=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(R(o,function(d,_){o[_]=d*c})),this.setCropBoxData(R(l,function(d,_){l[_]=d*c}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(function Ge(n,e){return n.classList?n.classList.contains(e):n.className.indexOf(e)>-1}(this.dragBox,Mt)?"move":Xt)},wheel:function(e){var a=this,i=Number(this.options.wheelZoomRatio)||.1,c=1;this.disabled||(e.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){a.wheeling=!1},50),e.deltaY?c=e.deltaY>0?1:-1:e.wheelDelta?c=-e.wheelDelta/120:e.detail&&(c=e.detail>0?1:-1),this.zoom(-c*i,e)))},cropStart:function(e){var a=e.buttons,i=e.button;if(!(this.disabled||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(C(a)&&1!==a||C(i)&&0!==i||e.ctrlKey))){var l,c=this.options,o=this.pointers;e.changedTouches?R(e.changedTouches,function(d){o[d.identifier]=y(d)}):o[e.pointerId||0]=y(e),l=Object.keys(o).length>1&&c.zoomable&&c.zoomOnTouch?"zoom":Qt(e.target,Et),Ie.test(l)&&!1!==bt(this.element,Vt,{originalEvent:e,action:l})&&(e.preventDefault(),this.action=l,this.cropping=!1,"crop"===l&&(this.cropping=!0,B(this.dragBox,jt)))}},cropMove:function(e){var a=this.action;if(!this.disabled&&a){var i=this.pointers;e.preventDefault(),!1!==bt(this.element,Nt,{originalEvent:e,action:a})&&(e.changedTouches?R(e.changedTouches,function(c){T(i[c.identifier]||{},y(c,!0))}):T(i[e.pointerId||0]||{},y(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var a=this.action,i=this.pointers;e.changedTouches?R(e.changedTouches,function(c){delete i[c.identifier]}):delete i[e.pointerId||0],a&&(e.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,_t(this.dragBox,jt,this.cropped&&this.options.modal)),bt(this.element,$t,{originalEvent:e,action:a}))}}},qe={change:function(e){var dt,i=this.canvasData,c=this.containerData,o=this.cropBoxData,l=this.pointers,d=this.action,_=this.options.aspectRatio,f=o.left,g=o.top,u=o.width,v=o.height,E=f+u,O=g+v,z=0,S=0,P=c.width,F=c.height,N=!0;!_&&e.shiftKey&&(_=u&&v?u/v:1),this.limited&&(S=o.minTop,P=(z=o.minLeft)+Math.min(c.width,i.width,i.left+i.width),F=S+Math.min(c.height,i.height,i.top+i.height));var J=l[Object.keys(l)[0]],b={x:J.endX-J.startX,y:J.endY-J.startY},A=function(tt){switch(tt){case"e":E+b.x>P&&(b.x=P-E);break;case"w":f+b.x<z&&(b.x=z-f);break;case $:g+b.y<S&&(b.y=S-g);break;case Z:O+b.y>F&&(b.y=F-O)}};switch(d){case"all":f+=b.x,g+=b.y;break;case"e":if(b.x>=0&&(E>=P||_&&(g<=S||O>=F))){N=!1;break}A("e"),(u+=b.x)<0&&(d="w",f-=u=-u),_&&(g+=(o.height-(v=u/_))/2);break;case $:if(b.y<=0&&(g<=S||_&&(f<=z||E>=P))){N=!1;break}A($),g+=b.y,(v-=b.y)<0&&(d=Z,g-=v=-v),_&&(f+=(o.width-(u=v*_))/2);break;case"w":if(b.x<=0&&(f<=z||_&&(g<=S||O>=F))){N=!1;break}A("w"),f+=b.x,(u-=b.x)<0&&(d="e",f-=u=-u),_&&(g+=(o.height-(v=u/_))/2);break;case Z:if(b.y>=0&&(O>=F||_&&(f<=z||E>=P))){N=!1;break}A(Z),(v+=b.y)<0&&(d=$,g-=v=-v),_&&(f+=(o.width-(u=v*_))/2);break;case xt:if(_){if(b.y<=0&&(g<=S||E>=P)){N=!1;break}A($),g+=b.y,u=(v-=b.y)*_}else A($),A("e"),b.x>=0?E<P?u+=b.x:b.y<=0&&g<=S&&(N=!1):u+=b.x,b.y<=0?g>S&&(v-=b.y,g+=b.y):(v-=b.y,g+=b.y);u<0&&v<0?(d=Ot,g-=v=-v,f-=u=-u):u<0?(d=L,f-=u=-u):v<0&&(d=Ct,g-=v=-v);break;case L:if(_){if(b.y<=0&&(g<=S||f<=z)){N=!1;break}A($),g+=b.y,f+=o.width-(u=(v-=b.y)*_)}else A($),A("w"),b.x<=0?f>z?(u-=b.x,f+=b.x):b.y<=0&&g<=S&&(N=!1):(u-=b.x,f+=b.x),b.y<=0?g>S&&(v-=b.y,g+=b.y):(v-=b.y,g+=b.y);u<0&&v<0?(d=Ct,g-=v=-v,f-=u=-u):u<0?(d=xt,f-=u=-u):v<0&&(d=Ot,g-=v=-v);break;case Ot:if(_){if(b.x<=0&&(f<=z||O>=F)){N=!1;break}A("w"),f+=b.x,v=(u-=b.x)/_}else A(Z),A("w"),b.x<=0?f>z?(u-=b.x,f+=b.x):b.y>=0&&O>=F&&(N=!1):(u-=b.x,f+=b.x),b.y>=0?O<F&&(v+=b.y):v+=b.y;u<0&&v<0?(d=xt,g-=v=-v,f-=u=-u):u<0?(d=Ct,f-=u=-u):v<0&&(d=L,g-=v=-v);break;case Ct:if(_){if(b.x>=0&&(E>=P||O>=F)){N=!1;break}A("e"),v=(u+=b.x)/_}else A(Z),A("e"),b.x>=0?E<P?u+=b.x:b.y>=0&&O>=F&&(N=!1):u+=b.x,b.y>=0?O<F&&(v+=b.y):v+=b.y;u<0&&v<0?(d=L,g-=v=-v,f-=u=-u):u<0?(d=Ot,f-=u=-u):v<0&&(d=xt,g-=v=-v);break;case"move":this.move(b.x,b.y),N=!1;break;case"zoom":this.zoom(function s(n){var e=t({},n),a=0;return R(n,function(i,c){delete e[c],R(e,function(o){var l=Math.abs(i.startX-o.startX),d=Math.abs(i.startY-o.startY),_=Math.abs(i.endX-o.endX),f=Math.abs(i.endY-o.endY),g=Math.sqrt(l*l+d*d),v=(Math.sqrt(_*_+f*f)-g)/g;Math.abs(v)>Math.abs(a)&&(a=v)})}),a}(l),e),N=!1;break;case"crop":if(!b.x||!b.y){N=!1;break}dt=_e(this.cropper),f=J.startX-dt.left,g=J.startY-dt.top,u=o.minWidth,v=o.minHeight,b.x>0?d=b.y>0?Ct:xt:b.x<0&&(f-=u,d=b.y>0?Ot:L),b.y<0&&(g-=v),this.cropped||(q(this.cropBox,k),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}N&&(o.width=u,o.height=v,o.left=f,o.top=g,this.action=d,this.renderCropBox()),R(l,function(G){G.startX=G.endX,G.startY=G.endY})}},ti={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&B(this.dragBox,jt),q(this.cropBox,k),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=T({},this.initialImageData),this.canvasData=T({},this.initialCanvasData),this.cropBoxData=T({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(T(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),q(this.dragBox,jt),B(this.cropBox,k)),this},replace:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&e&&(this.isImg&&(this.element.src=e),a?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,R(this.previews,function(i){i.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,q(this.cropper,U)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,B(this.cropper,U)),this},destroy:function(){var e=this.element;return e[I]?(e[I]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,c=i.left,o=i.top;return this.moveTo(Pt(e)?e:c+Number(e),Pt(a)?a:o+Number(a))},moveTo:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,c=!1;return e=Number(e),a=Number(a),this.ready&&!this.disabled&&this.options.movable&&(C(e)&&(i.left=e,c=!0),C(a)&&(i.top=a,c=!0),c&&this.renderCanvas(!0)),this},zoom:function(e,a){var i=this.canvasData;return e=Number(e),this.zoomTo(i.width*(e=e<0?1/(1-e):1+e)/i.naturalWidth,null,a)},zoomTo:function(e,a,i){var c=this.options,o=this.canvasData,l=o.width,d=o.height,_=o.naturalWidth,f=o.naturalHeight;if((e=Number(e))>=0&&this.ready&&!this.disabled&&c.zoomable){var g=_*e,u=f*e;if(!1===bt(this.element,Ht,{ratio:e,oldRatio:l/_,originalEvent:i}))return this;if(i){var v=this.pointers,E=_e(this.cropper),O=v&&Object.keys(v).length?function r(n){var e=0,a=0,i=0;return R(n,function(c){e+=c.startX,a+=c.startY,i+=1}),{pageX:e/=i,pageY:a/=i}}(v):{pageX:i.pageX,pageY:i.pageY};o.left-=(O.pageX-E.left-o.left)/l*(g-l),o.top-=(O.pageY-E.top-o.top)/d*(u-d)}else ft(a)&&C(a.x)&&C(a.y)?(o.left-=(a.x-o.left)/l*(g-l),o.top-=(a.y-o.top)/d*(u-d)):(o.left-=(g-l)/2,o.top-=(u-d)/2);o.width=g,o.height=u,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return C(e=Number(e))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var a=this.imageData.scaleY;return this.scale(e,C(a)?a:1)},scaleY:function(e){var a=this.imageData.scaleX;return this.scale(C(a)?a:1,e)},scale:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.imageData,c=!1;return e=Number(e),a=Number(a),this.ready&&!this.disabled&&this.options.scalable&&(C(e)&&(i.scaleX=e,c=!0),C(a)&&(i.scaleY=a,c=!0),c&&this.renderCanvas(!0,!0)),this},getData:function(){var l,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this.options,i=this.imageData,c=this.canvasData,o=this.cropBoxData;if(this.ready&&this.cropped){var d=i.width/i.naturalWidth;if(R(l={x:o.left-c.left,y:o.top-c.top,width:o.width,height:o.height},function(g,u){l[u]=g/d}),e){var _=Math.round(l.y+l.height),f=Math.round(l.x+l.width);l.x=Math.round(l.x),l.y=Math.round(l.y),l.width=f-l.x,l.height=_-l.y}}else l={x:0,y:0,width:0,height:0};return a.rotatable&&(l.rotate=i.rotate||0),a.scalable&&(l.scaleX=i.scaleX||1,l.scaleY=i.scaleY||1),l},setData:function(e){var a=this.options,i=this.imageData,c=this.canvasData,o={};if(this.ready&&!this.disabled&&ft(e)){var l=!1;a.rotatable&&C(e.rotate)&&e.rotate!==i.rotate&&(i.rotate=e.rotate,l=!0),a.scalable&&(C(e.scaleX)&&e.scaleX!==i.scaleX&&(i.scaleX=e.scaleX,l=!0),C(e.scaleY)&&e.scaleY!==i.scaleY&&(i.scaleY=e.scaleY,l=!0)),l&&this.renderCanvas(!0,!0);var d=i.width/i.naturalWidth;C(e.x)&&(o.left=e.x*d+c.left),C(e.y)&&(o.top=e.y*d+c.top),C(e.width)&&(o.width=e.width*d),C(e.height)&&(o.height=e.height*d),this.setCropBoxData(o)}return this},getContainerData:function(){return this.ready?T({},this.containerData):{}},getImageData:function(){return this.sized?T({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,a={};return this.ready&&R(["left","top","width","height","naturalWidth","naturalHeight"],function(i){a[i]=e[i]}),a},setCanvasData:function(e){var a=this.canvasData,i=a.aspectRatio;return this.ready&&!this.disabled&&ft(e)&&(C(e.left)&&(a.left=e.left),C(e.top)&&(a.top=e.top),C(e.width)?(a.width=e.width,a.height=e.width/i):C(e.height)&&(a.height=e.height,a.width=e.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var a,e=this.cropBoxData;return this.ready&&this.cropped&&(a={left:e.left,top:e.top,width:e.width,height:e.height}),a||{}},setCropBoxData:function(e){var c,o,a=this.cropBoxData,i=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&ft(e)&&(C(e.left)&&(a.left=e.left),C(e.top)&&(a.top=e.top),C(e.width)&&e.width!==a.width&&(c=!0,a.width=e.width),C(e.height)&&e.height!==a.height&&(o=!0,a.height=e.height),i&&(c?a.height=a.width/i:o&&(a.width=a.height*i)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var a=this.canvasData,i=function m(n,e,a,i){var c=e.aspectRatio,o=e.naturalWidth,l=e.naturalHeight,d=e.rotate,_=void 0===d?0:d,f=e.scaleX,g=void 0===f?1:f,u=e.scaleY,v=void 0===u?1:u,E=a.aspectRatio,O=a.naturalWidth,z=a.naturalHeight,S=i.fillColor,P=void 0===S?"transparent":S,F=i.imageSmoothingEnabled,N=void 0===F||F,dt=i.imageSmoothingQuality,J=void 0===dt?"low":dt,b=i.maxWidth,A=void 0===b?1/0:b,G=i.maxHeight,tt=void 0===G?1/0:G,ut=i.minWidth,It=void 0===ut?0:ut,Tt=i.minHeight,yt=void 0===Tt?0:Tt,nt=document.createElement("canvas"),W=nt.getContext("2d"),zt=h({aspectRatio:E,width:A,height:tt}),Ce=h({aspectRatio:E,width:It,height:yt},"cover"),Ye=Math.min(zt.width,Math.max(Ce.width,O)),Ue=Math.min(zt.height,Math.max(Ce.height,z)),Ve=h({aspectRatio:c,width:A,height:tt}),He=h({aspectRatio:c,width:It,height:yt},"cover"),We=Math.min(Ve.width,Math.max(He.width,o)),Qe=Math.min(Ve.height,Math.max(He.height,l)),ii=[-We/2,-Qe/2,We,Qe];return nt.width=vt(Ye),nt.height=vt(Ue),W.fillStyle=P,W.fillRect(0,0,Ye,Ue),W.save(),W.translate(Ye/2,Ue/2),W.rotate(_*Math.PI/180),W.scale(g,v),W.imageSmoothingEnabled=N,W.imageSmoothingQuality=J,W.drawImage.apply(W,[n].concat(Zt(ii.map(function(ai){return Math.floor(vt(ai))})))),W.restore(),nt}(this.image,this.imageData,a,e);if(!this.cropped)return i;var c=this.getData(),o=c.x,l=c.y,d=c.width,_=c.height,f=i.width/Math.floor(a.naturalWidth);1!==f&&(o*=f,l*=f,d*=f,_*=f);var g=d/_,u=h({aspectRatio:g,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),v=h({aspectRatio:g,width:e.minWidth||0,height:e.minHeight||0},"cover"),E=h({aspectRatio:g,width:e.width||(1!==f?i.width:d),height:e.height||(1!==f?i.height:_)}),O=E.width,z=E.height;O=Math.min(u.width,Math.max(v.width,O)),z=Math.min(u.height,Math.max(v.height,z));var S=document.createElement("canvas"),P=S.getContext("2d");S.width=vt(O),S.height=vt(z),P.fillStyle=e.fillColor||"transparent",P.fillRect(0,0,O,z);var F=e.imageSmoothingEnabled,dt=e.imageSmoothingQuality;P.imageSmoothingEnabled=void 0===F||F,dt&&(P.imageSmoothingQuality=dt);var tt,ut,It,Tt,yt,nt,J=i.width,b=i.height,A=o,G=l;A<=-d||A>J?(A=0,tt=0,It=0,yt=0):A<=0?(It=-A,A=0,yt=tt=Math.min(J,d+A)):A<=J&&(It=0,yt=tt=Math.min(d,J-A)),tt<=0||G<=-_||G>b?(G=0,ut=0,Tt=0,nt=0):G<=0?(Tt=-G,G=0,nt=ut=Math.min(b,_+G)):G<=b&&(Tt=0,nt=ut=Math.min(_,b-G));var W=[A,G,tt,ut];if(yt>0&&nt>0){var zt=O/d;W.push(It*zt,Tt*zt,yt*zt,nt*zt)}return P.drawImage.apply(P,[i].concat(Zt(W.map(function(Ce){return Math.floor(vt(Ce))})))),S},setAspectRatio:function(e){var a=this.options;return!this.disabled&&!Pt(e)&&(a.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var a=this.options,i=this.dragBox,c=this.face;if(this.ready&&!this.disabled){var o=e===Xt,l=a.movable&&"move"===e;a.dragMode=e=o||l?e:"none",St(i,Et,e),_t(i,Mt,o),_t(i,Dt,l),a.cropBoxMovable||(St(c,Et,e),_t(c,Mt,o),_t(c,Dt,l))}return this}},ei=X.Cropper,$e=function(){function n(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function x(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),!e||!Re.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=T({},ue,ft(a)&&a),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return function K(n,e,a){return e&&j(n.prototype,e),a&&j(n,a),n}(n,[{key:"init",value:function(){var c,a=this.element,i=a.tagName.toLowerCase();if(!a[I]){if(a[I]=this,"img"===i){if(this.isImg=!0,c=a.getAttribute("src")||"",this.originalUrl=c,!c)return;c=a.src}else"canvas"===i&&window.HTMLCanvasElement&&(c=a.toDataURL());this.load(c)}}},{key:"load",value:function(a){var i=this;if(a){this.url=a,this.imageData={};var c=this.element,o=this.options;if(!o.rotatable&&!o.scalable&&(o.checkOrientation=!1),!o.checkOrientation||!window.ArrayBuffer)return void this.clone();if(Te.test(a))return void(ze.test(a)?this.read(function pt(n){var e=n.replace(M,""),a=atob(e),i=new ArrayBuffer(a.length),c=new Uint8Array(i);return R(c,function(o,l){c[l]=a.charCodeAt(l)}),i}(a)):this.clone());var l=new XMLHttpRequest,d=this.clone.bind(this);this.reloading=!0,this.xhr=l,l.onabort=d,l.onerror=d,l.ontimeout=d,l.onprogress=function(){l.getResponseHeader("content-type")!==he&&l.abort()},l.onload=function(){i.read(l.response)},l.onloadend=function(){i.reloading=!1,i.xhr=null},o.checkCrossOrigin&&be(a)&&c.crossOrigin&&(a=ye(a)),l.open("GET",a,!0),l.responseType="arraybuffer",l.withCredentials="use-credentials"===c.crossOrigin,l.send()}}},{key:"read",value:function(a){var i=this.options,c=this.imageData,o=we(a),l=0,d=1,_=1;if(o>1){this.url=function H(n,e){for(var a=[],c=new Uint8Array(n);c.length>0;)a.push(w.apply(null,me(c.subarray(0,8192)))),c=c.subarray(8192);return"data:".concat(e,";base64,").concat(btoa(a.join("")))}(a,he);var f=function Kt(n){var e=0,a=1,i=1;switch(n){case 2:a=-1;break;case 3:e=-180;break;case 4:i=-1;break;case 5:e=90,i=-1;break;case 6:e=90;break;case 7:e=90,a=-1;break;case 8:e=-90}return{rotate:e,scaleX:a,scaleY:i}}(o);l=f.rotate,d=f.scaleX,_=f.scaleY}i.rotatable&&(c.rotate=l),i.scalable&&(c.scaleX=d,c.scaleY=_),this.clone()}},{key:"clone",value:function(){var a=this.element,i=this.url,c=a.crossOrigin,o=i;this.options.checkCrossOrigin&&be(i)&&(c||(c="anonymous"),o=ye(i)),this.crossOrigin=c,this.crossOriginUrl=o;var l=document.createElement("img");c&&(l.crossOrigin=c),l.src=o||i,l.alt=a.alt||"The image to crop",this.image=l,l.onload=this.start.bind(this),l.onerror=this.stop.bind(this),B(l,Ut),a.parentNode.insertBefore(l,a.nextSibling)}},{key:"start",value:function(){var a=this,i=this.image;i.onload=null,i.onerror=null,this.sizing=!0;var c=X.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(X.navigator.userAgent),o=function(f,g){T(a.imageData,{naturalWidth:f,naturalHeight:g,aspectRatio:f/g}),a.initialImageData=T({},a.imageData),a.sizing=!1,a.sized=!0,a.build()};if(!i.naturalWidth||c){var l=document.createElement("img"),d=document.body||document.documentElement;this.sizingImage=l,l.onload=function(){o(l.width,l.height),c||d.removeChild(l)},l.src=i.src,c||(l.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",d.appendChild(l))}else o(i.naturalWidth,i.naturalHeight)}},{key:"stop",value:function(){var a=this.image;a.onload=null,a.onerror=null,a.parentNode.removeChild(a),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var a=this.element,i=this.options,c=this.image,o=a.parentNode,l=document.createElement("div");l.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var d=l.querySelector(".".concat(I,"-container")),_=d.querySelector(".".concat(I,"-canvas")),f=d.querySelector(".".concat(I,"-drag-box")),g=d.querySelector(".".concat(I,"-crop-box")),u=g.querySelector(".".concat(I,"-face"));this.container=o,this.cropper=d,this.canvas=_,this.dragBox=f,this.cropBox=g,this.viewBox=d.querySelector(".".concat(I,"-view-box")),this.face=u,_.appendChild(c),B(a,k),o.insertBefore(d,a.nextSibling),this.isImg||q(c,Ut),this.initPreview(),this.bind(),i.initialAspectRatio=Math.max(0,i.initialAspectRatio)||NaN,i.aspectRatio=Math.max(0,i.aspectRatio)||NaN,i.viewMode=Math.max(0,Math.min(3,Math.round(i.viewMode)))||0,B(g,k),i.guides||B(g.getElementsByClassName("".concat(I,"-dashed")),k),i.center||B(g.getElementsByClassName("".concat(I,"-center")),k),i.background&&B(d,"".concat(I,"-bg")),i.highlight||B(u,De),i.cropBoxMovable&&(B(u,Dt),St(u,Et,"all")),i.cropBoxResizable||(B(g.getElementsByClassName("".concat(I,"-line")),k),B(g.getElementsByClassName("".concat(I,"-point")),k)),this.render(),this.ready=!0,this.setDragMode(i.dragMode),i.autoCrop&&this.crop(),this.setData(i.data),Y(i.ready)&&V(a,"ready",i.ready,{once:!0}),bt(a,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),q(this.element,k))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ei,n}},{key:"setDefaults",value:function(a){T(ue,ft(a)&&a)}}]),n}();return T($e.prototype,xe,Je,Ke,Ze,qe,ti),$e}()}}]);