"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6260],{76094:(K,N,n)=>{n.d(N,{x:()=>C});var C=function(s){return s[s.templateOriginalA4=20]="templateOriginalA4",s[s.templateA5Full50=22]="templateA5Full50",s[s.templateA4Essay=21]="templateA4Essay",s[s.templateA6Full20=23]="templateA6Full20",s[s.templateTrueFalseA4=15]="templateTrueFalseA4",s[s.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",s[s.templateTrueFalseA5=17]="templateTrueFalseA5",s[s.templateTrueFalseA6=18]="templateTrueFalseA6",s[s.templateA4WithFax=19]="templateA4WithFax",s[s.templateA4WithFaxV2=190]="templateA4WithFaxV2",s}(C||{})},17997:(K,N,n)=>{n.d(N,{H:()=>g});var C=n(76094),s=n(65879),R=n(46558),w=n(97151),v=n(61419),B=n(41385),x=n(38228);let g=(()=>{class O{constructor(a,r,m,o,E){this.commonService=a,this.shareFileFlutterService=r,this.encryptService=m,this.formatAnswerSheetService=o,this.exportExcelService=E,this.allAnswerSheet=C.x}exportFileNameOfStudentCode(a,r,m){return 100==a&&(r=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(r?"_"+r:"")+"_"+this.encryptService.createMd5(m).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(a,r,m,o,E,b){return r==this.allAnswerSheet.templateA5Full50?a.createA5AnswerSheetFullA4_50(b??50):r==this.allAnswerSheet.templateA4Essay?a.createA4AnswerSheet_35hh(b??50):r==this.allAnswerSheet.templateA6Full20?a.createA6AnswerSheetFullA4_20(b??20):r==this.allAnswerSheet.templateTrueFalseA4||r==this.allAnswerSheet.templateTrueFalseEssayA4||r==this.allAnswerSheet.templateTrueFalseA5||r==this.allAnswerSheet.templateTrueFalseA6||r==this.allAnswerSheet.templateA4WithFax||r==this.allAnswerSheet.templateA4WithFaxV2?a.createTrueFalseAnswerSheet():a.createAzotaAnswerSheet_A4(b??120)}exportFileNameOfAnswerSheet(a,r,m){var o="";return 100==a&&(r=""),(0==a||100==a)&&(o=this.commonService.createFileNameExportFile(["PhieuTL_"+m+(r?"_"+r:"")])),o}exportFileNameOfAnswerExcelOffline(a,r,m){var o="";return 100==a&&(r=""),(0==a||100==a)&&(o=this.commonService.createFileNameExportFile(["DapAn_"+(r?"_"+r:"")])),o}exportFileNameOfRawExam(a,r,m){var o="";return 100==a&&(r=""),(0==a||100==a)&&(o=this.commonService.createFileNameExportFile([(r?"_"+r:"")+"_"+this.encryptService.createMd5(m).substring(0,6)])),o}exportFileNameOfExamOffline(a,r,m,o){var E="";return 100==a&&(r=""),(0==a||100==a)&&(E=this.commonService.createFileNameExportFile([(o?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(o,3)+"_":"")+m+(r?"_"+r:"")])),E}printStudentCode(a,r){var m=[];let o=this.commonService.myClone(r);for(let E=0;E<o.length;E++)m.push({code:o[E].code??0,fullName:o[E]?.fullName??"",birthday:o[E]?.birthday??"",className:o[E].classroomName??""});this._exportExcelForCodeNumber(a,m)}_exportExcelForCodeNumber(a,r){let m=this.exportFileNameOfStudentCode(0,a?.name??"",a?.hashId??"");const o=this.exportExcelService.exportExcelForCodeNumber(r);this.shareFileFlutterService.shareFileWithBlob(o,m)}}return O.\u0275fac=function(a){return new(a||O)(s.LFG(R.z),s.LFG(w.g),s.LFG(v.j),s.LFG(B.j),s.LFG(x.L))},O.\u0275prov=s.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()},56260:(K,N,n)=>{n.d(N,{F:()=>Q});var C=n(85965),R=n(8720),w=n(70731),v=n(89156),B=n(89745),x=n(79617),g=n(65879),O=n(36668),W=n(32965),a=n(46558),r=n(78953),m=n(19662),o=n(17997),E=n(41385),b=n(97151),z=n(27161),U=n(71518);let Q=(()=>{class y{constructor(i,t,f,l,c,p,e,_,u,I){this.docxService=i,this.cdnService=t,this.commonService=f,this.userService=l,this.questionRenderService=c,this.printAnswersheetService=p,this.formatAnswerSheetService=e,this.shareFileFlutterService=_,this.sAztAnswerTypeService=u,this.documentConfigService=I,this.configRenderService=new R.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new C,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((i,t)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?typeof azotaDocx<"u"&&azotaDocx?i(!0):t(new Error("lang_core_lib_not_load")):(this.countRetryLoadJS++,this.countRetryLoadJS>3?t(new Error("lang_core_lib_not_load")):i(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(i,t){let f=[],l=[];return i.answerResult&&this.isAnsDetail&&i.answerResult.forEach(c=>{let p=c;const e=i.answers?.find(_=>_.key===c);e&&(p=e.alpha??p),l.push(p)}),i.answers.forEach(c=>{let p="<b>     "+(l.includes(c.alpha??c.key)?"*":"")+(t?(c.alpha?c.alpha:c.key).toLowerCase()+")":(c.alpha?c.alpha:c.key)+".")+"</b> "+(0,x.uG)(c.content);f.push(p)}),f}getDataForExportDocxApi(i,t,f){let l=[],c=0;if(f){let e=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");l.push({content:`<b> ${e} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(f,3)+".</b>",answers:[]})}let p=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return t.forEach(e=>{1!==i.hideGroupQuestion&&e.groupInfo?.isFirstInGroup&&e.groupInfo.groupContent&&l.push({content:`<b>${e.groupInfo.groupContent}<b>`,answers:[]}),this.isEnableDebug&&l.push({content:` <br/><br/><br/>*** <b>Question ID: ${e.id}</b> ***`,answers:[]});let _={content:`<b>${p} `+((e.labelIndex??c)+(i.startQuestionIndex??1))+".</b> "+(0,x.uG)(e.content),answers:this.convertAnswerQuestion(e??[],this.sAztAnswerTypeService.isTrueFalseAnswer(e))};if(c++,l.push(_),this.isAnsDetail&&((e.help||this.sAztAnswerTypeService.isFillAnswer(e))&&l.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b><br/> ${e.help}`,answers:[]}),e.answerResult&&this.isAnsDetail)){let u=[];e.answerResult.forEach(I=>{let D=I;const A=e.answers?.find(M=>M.key===I);A&&(D=A.alpha??D),u.push(D)}),this.sAztAnswerTypeService.isFillAnswer(e)&&l.push({content:`${this.commonService.myTranslateInstant("lang_auto_dap_an")}: ${u.join(" | ")}`,answers:[]})}this.isEnableDebug&&l.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),l}itemConverterCaller(i,t,f,l,c){return new Promise((p,e)=>{this.questionRenderService.parseRenderQuestions(i.listQuestion,_=>{this.saveLoadingMsg.includes(")")||(this.changeMsg?this.changeMsg(this.saveLoadingMsg+Math.floor(_)+"%"):v.G.changeMsgLoadingEffect(this.saveLoadingMsg+Math.floor(_)+"%"))},this.configRenderService,void 0,!0,c).then(_=>{let u=[];u.push({content:x.Ip.makeHeaderTable([x.Ip.createLineCenterBold(t.schoolName?t.schoolName:"")],[x.Ip.createLineCenterBold(t.examName??""),x.Ip.createLineCenterBold(t.subject??""),x.Ip.createLineCenterItalicized(t.examMinutes??""),x.Ip.createLineCenterItalicized("-------------------------")],!1),answers:[]}),u.push({content:x.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),u.push({content:x.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),u=u.concat(this.getDataForExportDocxApi(l,_,i.offlineExamMixQuestionObj?i.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx?this.docxService.exportToDocxBinary(u,{isHeadless:!0},(I,D,A)=>{}).then(I=>{p({userObj:f,data:I,input:u,additionParams:t,offlineExamMixQuestionObj:i.offlineExamMixQuestionObj})}):e(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(_=>{e(new Error(_[0].message))})})}masterConverterCaller(i,t,f,l,c,p){return new Promise((e,_)=>{const u=this.userService.getUserObj();let I=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),D=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),A=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),M=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),G=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),T=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),L=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const F=new w.Q(1,{function:(h,d)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${d<=1?"":`(${h}/${d}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):v.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});i.forEach(h=>{F.addTask(this,this.itemConverterCaller,[h,{schoolName:l?.nameSchool??`{${I}}`,subject:l?.nameSubject??`{${D}}`,examName:t.name??`{${A}}`,examMinutes:t.minutes&&t.minutes>0?`${M}: `+t.minutes+` ${T} (${G})`:` ${M}: ${L}`,templateType:c??0,numberOfQuestion:h.listQuestion.length,examId:h.offlineExamMixQuestionObj?.hashId??0},u,t,p])}),F.start().then(h=>{if(h.errs.length>0)_(h.errs[0]);else if(1===h.datas.length){const d=h.datas[0],S=new Blob([d.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let P=this.createNameExam(t,f,d.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(S,P),e()}else h.datas.forEach(d=>{let S=this.createNameExam(t,f,d.offlineExamMixQuestionObj);S=this.replaceAllString(S,"/","_"),this.zipper.file("DOCS/"+S,d.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(d=>{let S=this.commonService.createFileNameExportFile([t.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(d,S),e()},d=>{_(d)})},200)})})}replaceAllString(i,t,f){for(;i.includes(t);)i=i.replace(t,f);return i}createNameExam(i,t,f){return t?this.printAnswersheetService.exportFileNameOfExamOffline(0,i.name??"",t?.hashId??"",f?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,i.name??"",i.hashId??"")+".docx"}downloadExam(i,t,f,l,c,p,e,_,u,I,D){return new Promise((A,M)=>{this.isAnsDetail=i,this.isEnableDebug=!!I,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=u,this.loadScriptAction().then(G=>{G?this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(T=>{if(1==T.success){let L=0,F=0;c.forEach((h,d)=>{h.labelIndex=d,T.data?.resetQuestionIndex&&h.groupInfo&&h.groupInfo.groupId&&(L!=h.groupInfo.groupId&&(L=h.groupInfo.groupId,F=0),h.labelIndex=F,F++)})}this.masterConverterCaller([{listQuestion:c,offlineExamMixQuestionObj:l}],t,f,p,e,D).then(()=>{this.zipper=new C,_?_(10):v.G.closeLoadingEffect(10),A()}).catch(L=>{v.G.closeLoadingEffect(10),M(L)})}):(_?_(10):v.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load")))}).catch(()=>{_?_(10):v.G.closeLoadingEffect(10),M(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(i,t,f,l,c,p,e,_,u,I){return new Promise((D,A)=>{this.isAnsDetail=i,this.isEnableDebug=!!u,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=_,this.loadScriptAction().then(M=>{if(M){let G=!0;const T=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(L=>{l.forEach(F=>{let h=this.commonService.castJsonToClassObjs(B.v,JSON.stringify(F.mixQuestions??[]))??[];if(h.length>0){if(1==L.success){let d=0,S=0;h.forEach((P,k)=>{P.labelIndex=k,L.data?.resetQuestionIndex&&P.groupInfo&&P.groupInfo.groupId&&(d!=P.groupInfo.groupId&&(d=P.groupInfo.groupId,S=0),P.labelIndex=S,S++)})}T.push({listQuestion:h,offlineExamMixQuestionObj:F})}else G=!1}),G?this.masterConverterCaller(T,t,f,c,p,I).then(()=>{this.zipper=new C,e?e(10):v.G.closeLoadingEffect(10),D()}).catch(F=>{e?e(10):v.G.closeLoadingEffect(10),A(F)}):(e?e(10):v.G.closeLoadingEffect(10),A(new Error("lang_testbank_exam_is_invalid_condition")))})}else e?e(10):v.G.closeLoadingEffect(10),A(new Error("lang_core_lib_not_load"))}).catch(()=>{e?e(10):v.G.closeLoadingEffect(10),A(new Error("lang_core_lib_not_load"))})})}}return y.\u0275fac=function(i){return new(i||y)(g.LFG(O.n),g.LFG(W.E),g.LFG(a.z),g.LFG(r.U),g.LFG(m.h),g.LFG(o.H),g.LFG(E.j),g.LFG(b.g),g.LFG(z.i),g.LFG(U.Cq))},y.\u0275prov=g.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()}}]);