"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6940],{91581:(S,T,u)=>{u.d(T,{s:()=>O});var M=u(65879);let O=(()=>{class n{constructor(a){this.el=a,this.answerSizeManager=0,this.process()}ngOnChanges(a){a.answerSizeManager&&a.answerSizeManager.currentValue!==a.answerSizeManager.previousValue&&a.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(a=>{const p=this.el.nativeElement,f=p.children,w=[];for(let h=0;h<f.length;h++)w.push(this.getSizeWidthElement(f[h]));let C=1;[2,4].forEach(h=>{this.isLayout(a.width,w,h)&&(C=h)}),p.classList.remove("row");for(let h=0;h<f.length;h++){const i=f[h];i.classList.remove("col-sm-12"),i.classList.remove("col-md-6")}p.classList.add("layout"),p.classList.add("layout-"+C)})}isLayout(a,p,f){const w=Math.floor(a/f);for(const C of p)if(C+n.PADDING_ITEM>w)return!1;return!0}onElementLoaded(){return new Promise((a,p)=>{let f=!1;for(let w=0;w<=10;w++)setTimeout(()=>{if(!f){const C=this.actionGetSizeBox();C.width>0&&C.height&&(f=!0,a(C))}10===w&&!f&&p(new Error)},100*w)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(a){let p=0;for(let f=0;f<a.children.length;f++)p+=a.children[f].getBoundingClientRect().width;return p}}return n.PADDING_ITEM=40,n.\u0275fac=function(a){return new(a||n)(M.Y36(M.SBq))},n.\u0275dir=M.lG2({type:n,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[M.TTD]}),n})()},89745:(S,T,u)=>{u.d(T,{v:()=>M});class M{constructor(){this.answerLabelsMockup={}}}},70731:(S,T,u)=>{u.d(T,{Q:()=>M});class M{constructor(n,c,a,p){this.tasks=new Array,this.queues=new Array,this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=n,this.result_common_temp={datas:[],errs:[]},this.action_log_item=c,this.delay_time=a||1e3,this.end_with_error=p??!1}addTask(n,c,a,p){if(this.is_running)return;var f=a||[];const w=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(h=>{this.wrap_counter++,c.call(n,...f).then(i=>{this.wrap_counter_done++,this.callLog(p),h({status:!0,value:i,index:w})}).catch(i=>{this.wrap_counter_done++,this.callLog(p),h({status:!1,error:i,index:w})})}),name:p})}callLog(n){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],n)}start(){return new Promise(n=>{0===this.queues.length&&n({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let c=0;c<this.limit_one_process;c++){const a=this.queues.shift();if(!a)break;this.tasks.push(a)}this.count_task_root_done=0,this.is_running=!0,this.runner(n)})}checker(n,c){this.count_task_root_done++,n.status&&n.value?this.result_common_temp.datas.push({index:n.index,value:n.value}):n.error&&this.result_common_temp.errs.push({index:n.index,value:n.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,c(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,c(this.makeResultObj())),this.nextItem(c)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(n,c){return n.index-c.index}).map(n=>n.value),errs:this.result_common_temp.errs.sort(function(n,c){return n.index-c.index}).map(n=>n.value)}}nextItem(n){const c=this.queues.shift();c&&c.task.call(this).then(a=>{this.checker(a,n)})}runner(n){this.tasks.length>0?this.tasks.forEach(c=>{c.task.call(this).then(a=>{this.checker(a,n)})}):(this.is_running=!1,n(this.makeResultObj()))}}},32169:(S,T,u)=>{u.d(T,{n:()=>C});var M=u(49671),O=u(69862),n=u(70731),c=u(65879),a=u(46558),p=u(32965),f=u(84672);const w=u(47246);let C=(()=>{class h{constructor(e,t,r){this.commonService=e,this.sAztCdnService=t,this.apiUploadService=r,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}convertBase64OfMathJaxToCdnUrl(e){return new Promise(t=>{var r=this.getValueContentQuestion(e.questionContent??""),s=this.getValueContentQuestion(e.answerConfig??""),d=e.answerMedia??"",l=this.removeBase64MathJaxInQuestionContent(e.questionText??"");if(0===r.length||0===s.length)return void t(e);let m=this.encodeContent(r[0].content),g=[];s.forEach((_,E)=>{g.push({i:E,d:this.encodeContent(_.content)})});let o=this.encodeContent(d);var v=0;let P=[];for(let _=0;_<m.raws.length;_++)m.raws[_].i=v,v++,P.push(m.raws[_]);for(let _=0;_<o.raws.length;_++)o.raws[_].i=v,v++,P.push(o.raws[_]);g.forEach(_=>{for(let E=0;E<_.d.raws.length;E++)_.d.raws[E].i=v,v++,P.push(_.d.raws[E])}),P.length>0?this.uploadRawContent(P.map(_=>_.l)).then(_=>{m.raws.forEach(E=>{let R=this.stringFirst+btoa(JSON.stringify({l:_,i:E.i}));r[0].content=this.commonService.replaceAll(r[0].content,E.l,R)??""}),o.raws.forEach(E=>{let R=this.stringFirst+btoa(JSON.stringify({l:_,i:E.i}));d=this.commonService.replaceAll(d,E.l,R)??""}),g.forEach(E=>{E.d.raws.forEach(R=>{let k=this.stringFirst+btoa(JSON.stringify({l:_,i:R.i}));s[E.i].content=this.commonService.replaceAll(s[E.i].content,R.l,k)??""})}),e.questionContent=JSON.stringify(r),e.answerConfig=JSON.stringify(s),e.answerMedia=d,e.questionText=l,t(e)}).catch(()=>{t(e)}):t(e)})}decodeMathJaxCodeToCdnUrl(e){return new Promise(t=>{const r=new n.Q(10);if(r.addTask(this,()=>new Promise(s=>{this.decodeContent(e.content??"").then(d=>{e.content=d,s(!0)}).catch(()=>{s(!1)})})),r.addTask(this,()=>new Promise(s=>{this.decodeContent(e.help??"").then(d=>{e.help=d,s(!0)}).catch(()=>{s(!1)})})),e.answers)for(let s=0;s<e.answers.length;s++)r.addTask(this,()=>new Promise(d=>{e.answers&&this.decodeContent(e.answers[s].content??"").then(l=>{e.answers&&(e.answers[s].content=l),d(!0)}).catch(()=>{d(!1)})}));r.start().then(()=>{t()})})}getValueContentQuestion(e){return this.commonService.castJsonToObj(e)??[]}getAllMatchWithContent(e){let r,t=[];for(;null!==(r=h.searchPattern.exec(e));)t.includes(r[0])||t.push(r[0]);return t}getRawContent(e,t){return e=this.sAztCdnService.getMyCdn(e),new Promise((r,s)=>{const d=this.dataRaws.findIndex(l=>l.l===e);-1===d?fetch(e).then(l=>l.blob()).then(l=>l.arrayBuffer()).then(l=>{const m=w.inflate(l),g=this.commonService.castJsonToObj((new TextDecoder).decode(m));this.dataRaws.push({l:e,d:g??[]}),g&&g[t]?r(g[t]):s(new Error("Not found index"))}).catch(()=>{s(new Error("Exception at feed link"))}):this.dataRaws[d].d&&this.dataRaws[d].d[t]?r(this.dataRaws[d].d[t]):s(new Error("Not found index"))})}uploadRawContent(e){return new Promise((t,r)=>{const s=JSON.stringify(e),d=(new TextEncoder).encode(s),l=w.deflate(d),m=new Blob([l],{type:"application/octet-stream"}),g=new File([m],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(g).subscribe(o=>{o.type!=O.dt.UploadProgress&&(1==o.success&&o.data?t(o.data.url??""):r(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+o.message)))})})}removeBase64MathJaxInQuestionContent(e){return this.encodeContent(e).raws.forEach(r=>{e=this.commonService.replaceAll(e,r.l,"")??""}),e}encodeContent(e){let t=this.getAllMatchWithContent(e),r=[];for(let s=0;s<t.length;s++){let l=t[s].replace(h.searchPattern,"$1");l.startsWith(this.stringFirst)||r.push({l,i:r.length})}return{content:e,raws:r}}decodeContent(e){var t=this;return(0,M.Z)(function*(){let r=t.getAllMatchWithContent(e);for(let s=0;s<r.length;s++){const d=r[s];let l=d.replace(h.searchPattern,"$1");for(let m=0;m<t.stringFirstOld.length;m++)if(l.startsWith(t.stringFirstOld[m])){e=t.commonService.replaceAll(e,d,"")??"";continue}if(l.startsWith(t.stringFirst)){let m=t.commonService.castJsonToObj(atob(l.replace(t.stringFirst,"")));if(m){let g=yield t.getRawContent(m.l,m.i);e=t.commonService.replaceAll(e,l,g)??""}}}return e})()}}return h.searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,h.\u0275fac=function(e){return new(e||h)(c.LFG(a.z),c.LFG(p.E),c.LFG(f.W))},h.\u0275prov=c.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},19662:(S,T,u)=>{u.d(T,{h:()=>w});var M=u(8720),O=u(70731),n=u(70860),c=u(65879),a=u(32965),p=u(46558),f=u(32169);let w=(()=>{class C{pushImage(i,e,t){if(t){let r=new RegExp("<div id='"+i+"'[^>]+></div>","g");t.content&&(t.content=t.content.replace(r,e??"")),t.answers&&t.answers.forEach(s=>{s.content=s.content?.replace(r,e??"")}),t.help&&(t.help=t.help.replace(r,e??"")),t.groupInfo&&t.groupInfo.groupContent&&(t.groupInfo.groupContent=t.groupInfo.groupContent.replace(r,e??""))}}parseRenderQuestions(i,e,t,r,s,d){return new Promise((l,m)=>{const o=new O.Q(25,{function:(v,P)=>{e&&e(v/P*100)}},r??1e3);i.forEach(v=>{o.addTask(this,this.parseRenderQuestion,[v,t,s,d])}),o.start().then(v=>{if(v.errs.length>0){const P=[];v.errs.forEach(_=>{let E=P.find(R=>R.type===_.type);E||P.push(_),E?.data.concat(_.data)}),m(P)}else l(i)})})}parseRenderQuestion(i,e,t,r){return new Promise((s,d)=>{var l=new n.W(this.cdnService,this.commonService,e||new M.v,o=>{d(o)});l.callbackPushImage=(o,v)=>{this.pushImage(o,v,i)},l.caller=this;const g=new O.Q(r?1:20,void 0,0);i.content&&g.addTask(this,()=>new Promise(o=>{i.content=l.render(this.commonService.removeBracket(i.content??""),()=>{o()})})),i.answers&&i.answers.forEach(o=>{g.addTask(this,()=>new Promise(v=>{o.content=l.render(o.content||"",()=>{v()})}))}),i.help&&g.addTask(this,()=>new Promise(o=>{i.help=l.render(i.help,()=>{o()})})),i.groupInfo&&i.groupInfo.groupContent&&g.addTask(this,()=>new Promise(o=>{i.groupInfo&&i.groupInfo.groupContent?i.groupInfo.groupContent=l.render(this.commonService.removeBracket(i.groupInfo.groupContent),()=>{o()}):o()})),t&&g.addTask(this,()=>new Promise(o=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(i).then(()=>{o()})})),g.start().then(o=>{o.errs.length>0||s()})})}constructor(i,e,t){this.cdnService=i,this.commonService=e,this.dataAztMathRawHelper=t}}return C.\u0275fac=function(i){return new(i||C)(c.LFG(a.E),c.LFG(p.z),c.LFG(f.n))},C.\u0275prov=c.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()}}]);