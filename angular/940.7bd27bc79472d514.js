"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[940],{91581:(O,P,u)=>{u.d(P,{s:()=>k});var M=u(65879);let k=(()=>{class r{constructor(a){this.el=a,this.answerSizeManager=0,this.process()}ngOnChanges(a){a.answerSizeManager&&a.answerSizeManager.currentValue!==a.answerSizeManager.previousValue&&a.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(a=>{const f=this.el.nativeElement,m=f.children,g=[];for(let C=0;C<m.length;C++)g.push(this.getSizeWidthElement(m[C]));let o=1;[2,4].forEach(C=>{this.isLayout(a.width,g,C)&&(o=C)}),f.classList.remove("row");for(let C=0;C<m.length;C++){const e=m[C];e.classList.remove("col-sm-12"),e.classList.remove("col-md-6")}f.classList.add("layout"),f.classList.add("layout-"+o)})}isLayout(a,f,m){const g=Math.floor(a/m);for(const o of f)if(o+r.PADDING_ITEM>g)return!1;return!0}onElementLoaded(){return new Promise((a,f)=>{let m=!1;for(let g=0;g<=10;g++)setTimeout(()=>{if(!m){const o=this.actionGetSizeBox();o.width>0&&o.height&&(m=!0,a(o))}10===g&&!m&&f(new Error)},100*g)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(a){let f=0;for(let m=0;m<a.children.length;m++)f+=a.children[m].getBoundingClientRect().width;return f}}return r.PADDING_ITEM=40,r.\u0275fac=function(a){return new(a||r)(M.Y36(M.SBq))},r.\u0275dir=M.lG2({type:r,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[M.TTD]}),r})()},89745:(O,P,u)=>{u.d(P,{v:()=>M});class M{constructor(){this.answerLabelsMockup={}}}},70731:(O,P,u)=>{u.d(P,{Q:()=>M});class M{constructor(r,i,a,f){this.tasks=new Array,this.queues=new Array,this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=r,this.result_common_temp={datas:[],errs:[]},this.action_log_item=i,this.delay_time=a||1e3,this.end_with_error=f??!1}addTask(r,i,a,f){if(this.is_running)return;var m=a||[];const g=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(C=>{this.wrap_counter++,i.call(r,...m).then(e=>{this.wrap_counter_done++,this.callLog(f),C({status:!0,value:e,index:g})}).catch(e=>{this.wrap_counter_done++,this.callLog(f),C({status:!1,error:e,index:g})})}),name:f})}callLog(r){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],r)}start(){return new Promise(r=>{0===this.queues.length&&r({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let i=0;i<this.limit_one_process;i++){const a=this.queues.shift();if(!a)break;this.tasks.push(a)}this.count_task_root_done=0,this.is_running=!0,this.runner(r)})}checker(r,i){this.count_task_root_done++,r.status&&r.value?this.result_common_temp.datas.push({index:r.index,value:r.value}):r.error&&this.result_common_temp.errs.push({index:r.index,value:r.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,i(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,i(this.makeResultObj())),this.nextItem(i)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(r,i){return r.index-i.index}).map(r=>r.value),errs:this.result_common_temp.errs.sort(function(r,i){return r.index-i.index}).map(r=>r.value)}}nextItem(r){const i=this.queues.shift();i&&i.task.call(this).then(a=>{this.checker(a,r)})}runner(r){this.tasks.length>0?this.tasks.forEach(i=>{i.task.call(this).then(a=>{this.checker(a,r)})}):(this.is_running=!1,r(this.makeResultObj()))}}},32169:(O,P,u)=>{u.d(P,{n:()=>g});var M=u(49671),k=u(69862),r=u(70731),i=u(65879),a=u(46558),f=u(82228);const m=u(47246);let g=(()=>{class o{constructor(e,n){this.commonService=e,this.apiUploadService=n,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}convertBase64OfMathJaxToCdnUrl(e){return new Promise(n=>{var t=this.getValueContentQuestion(e.questionContent??""),s=this.getValueContentQuestion(e.answerConfig??""),l=e.answerMedia??"",_=this.removeBase64MathJaxInQuestionContent(e.questionText??"");if(0===t.length||0===s.length)return void n(e);let d=this.encodeContent(t[0].content),E=[];s.forEach((h,p)=>{E.push({i:p,d:this.encodeContent(h.content)})});let w=this.encodeContent(l);var c=0;let v=[];for(let h=0;h<d.raws.length;h++)d.raws[h].i=c,c++,v.push(d.raws[h]);for(let h=0;h<w.raws.length;h++)w.raws[h].i=c,c++,v.push(w.raws[h]);E.forEach(h=>{for(let p=0;p<h.d.raws.length;p++)h.d.raws[p].i=c,c++,v.push(h.d.raws[p])}),v.length>0?this.uploadRawContent(v.map(h=>h.l)).then(h=>{d.raws.forEach(p=>{let T=this.stringFirst+btoa(JSON.stringify({l:h,i:p.i}));t[0].content=this.commonService.replaceAll(t[0].content,p.l,T)??""}),w.raws.forEach(p=>{let T=this.stringFirst+btoa(JSON.stringify({l:h,i:p.i}));l=this.commonService.replaceAll(l,p.l,T)??""}),E.forEach(p=>{p.d.raws.forEach(T=>{let S=this.stringFirst+btoa(JSON.stringify({l:h,i:T.i}));s[p.i].content=this.commonService.replaceAll(s[p.i].content,T.l,S)??""})}),e.questionContent=JSON.stringify(t),e.answerConfig=JSON.stringify(s),e.answerMedia=l,e.questionText=_,n(e)}).catch(()=>{n(e)}):n(e)})}decodeMathJaxCodeToCdnUrl(e){return new Promise(n=>{const t=new r.Q(10);if(t.addTask(this,()=>new Promise(s=>{this.decodeContent(e.content??"").then(l=>{e.content=l,s(!0)}).catch(()=>{s(!1)})})),t.addTask(this,()=>new Promise(s=>{this.decodeContent(e.help??"").then(l=>{e.help=l,s(!0)}).catch(()=>{s(!1)})})),e.answers)for(let s=0;s<e.answers.length;s++)t.addTask(this,()=>new Promise(l=>{e.answers&&this.decodeContent(e.answers[s].content??"").then(_=>{e.answers&&(e.answers[s].content=_),l(!0)}).catch(()=>{l(!1)})}));t.start().then(()=>{n()})})}getValueContentQuestion(e){return this.commonService.castJsonToObj(e)??[]}getAllMatchWithContent(e){let t,n=[];for(;null!==(t=o.searchPattern.exec(e));)n.includes(t[0])||n.push(t[0]);return n}getRawContent(e,n){return new Promise((t,s)=>{const l=this.dataRaws.findIndex(_=>_.l===e);-1===l?fetch(e).then(_=>_.blob()).then(_=>_.arrayBuffer()).then(_=>{const d=m.inflate(_),E=this.commonService.castJsonToObj((new TextDecoder).decode(d));this.dataRaws.push({l:e,d:E??[]}),E&&E[n]?t(E[n]):s(new Error("Not found index"))}).catch(()=>{s(new Error("Exception at feed link"))}):this.dataRaws[l].d&&this.dataRaws[l].d[n]?t(this.dataRaws[l].d[n]):s(new Error("Not found index"))})}uploadRawContent(e){return new Promise((n,t)=>{const s=JSON.stringify(e),l=(new TextEncoder).encode(s),_=m.deflate(l),d=new Blob([_],{type:"application/octet-stream"}),E=new File([d],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(E).subscribe(w=>{w.type!=k.dt.UploadProgress&&(1==w.success&&w.data?n(w.data.url??""):t(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+w.message)))})})}removeBase64MathJaxInQuestionContent(e){return this.encodeContent(e).raws.forEach(t=>{e=this.commonService.replaceAll(e,t.l,"")??""}),e}encodeContent(e){let n=this.getAllMatchWithContent(e),t=[];for(let s=0;s<n.length;s++){let _=n[s].replace(o.searchPattern,"$1");_.startsWith(this.stringFirst)||t.push({l:_,i:t.length})}return{content:e,raws:t}}decodeContent(e){var n=this;return(0,M.Z)(function*(){let t=n.getAllMatchWithContent(e);for(let s=0;s<t.length;s++){const l=t[s];let _=l.replace(o.searchPattern,"$1");for(let d=0;d<n.stringFirstOld.length;d++)if(_.startsWith(n.stringFirstOld[d])){e=n.commonService.replaceAll(e,l,"")??"";continue}if(_.startsWith(n.stringFirst)){let d=n.commonService.castJsonToObj(atob(_.replace(n.stringFirst,"")));if(d){let E=yield n.getRawContent(d.l,d.i);e=n.commonService.replaceAll(e,_,E)??""}}}return e})()}}return o.searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,o.\u0275fac=function(e){return new(e||o)(i.LFG(a.z),i.LFG(f.W))},o.\u0275prov=i.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},19662:(O,P,u)=>{u.d(P,{h:()=>g});var M=u(8720),k=u(70731),r=u(70860),i=u(65879),a=u(32965),f=u(46558),m=u(32169);let g=(()=>{class o{pushImage(e,n,t){if(t){let s=new RegExp("<div id='"+e+"'[^>]+></div>","g");t.content&&(t.content=t.content.replace(s,n??"")),t.answers&&t.answers.forEach(l=>{l.content=l.content?.replace(s,n??"")}),t.help&&(t.help=t.help.replace(s,n??"")),t.groupInfo&&t.groupInfo.groupContent&&(t.groupInfo.groupContent=t.groupInfo.groupContent.replace(s,n??""))}}parseRenderQuestions(e,n,t,s,l,_){return new Promise((d,E)=>{const c=new k.Q(25,{function:(v,h)=>{const p=(v+25)/h*100;n&&n(p>=100?99:p)}},s??1e3);e.forEach(v=>{c.addTask(this,this.parseRenderQuestion,[v,t,l,_])}),c.start().then(v=>{if(v.errs.length>0){const h=[];v.errs.forEach(p=>{let T=h.find(S=>S.type===p.type);T||h.push(p),T?.data.concat(p.data)}),E(h)}else d(e)})})}parseRenderQuestion(e,n,t,s){return new Promise((l,_)=>{var d=new r.W(this.cdnService,this.commonService,n||new M.v,c=>{_(c)});d.callbackPushImage=(c,v)=>{this.pushImage(c,v,e)},d.caller=this;const w=new k.Q(s?1:20,void 0,0);e.content&&w.addTask(this,()=>new Promise(c=>{e.content=d.render(this.commonService.removeBracket(e.content??""),()=>{c()})})),e.answers&&e.answers.forEach(c=>{w.addTask(this,()=>new Promise(v=>{c.content=d.render(c.content||"",()=>{v()})}))}),e.help&&w.addTask(this,()=>new Promise(c=>{e.help=d.render(e.help,()=>{c()})})),e.groupInfo&&e.groupInfo.groupContent&&w.addTask(this,()=>new Promise(c=>{e.groupInfo&&e.groupInfo.groupContent?e.groupInfo.groupContent=d.render(this.commonService.removeBracket(e.groupInfo.groupContent),()=>{c()}):c()})),t&&w.addTask(this,()=>new Promise(c=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(e).then(()=>{c()})})),w.start().then(c=>{c.errs.length>0||l()})})}constructor(e,n,t){this.cdnService=e,this.commonService=n,this.dataAztMathRawHelper=t}}return o.\u0275fac=function(e){return new(e||o)(i.LFG(a.E),i.LFG(f.z),i.LFG(m.n))},o.\u0275prov=i.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()}}]);