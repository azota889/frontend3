"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7787],{5955:(R,O,d)=>{d.d(O,{C:()=>T});var M=d(26860);let T=(()=>{class s{static#t=this.PADDING_ITEM=40;constructor(a){this.el=a,this.answerSizeManager=0,this.process()}ngOnChanges(a){a.answerSizeManager&&a.answerSizeManager.currentValue!==a.answerSizeManager.previousValue&&a.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(a=>{const u=this.el.nativeElement,p=u.children,w=[];for(let f=0;f<p.length;f++)w.push(this.getSizeWidthElement(p[f]));let E=1;[2,4].forEach(f=>{this.isLayout(a.width,w,f)&&(E=f)}),u.classList.remove("row");for(let f=0;f<p.length;f++){const i=p[f];i.classList.remove("col-sm-12"),i.classList.remove("col-md-6")}u.classList.add("layout"),u.classList.add("layout-"+E)})}isLayout(a,u,p){const w=Math.floor(a/p);for(const E of u)if(E+s.PADDING_ITEM>w)return!1;return!0}onElementLoaded(){return new Promise((a,u)=>{let p=!1;for(let w=0;w<=10;w++)setTimeout(()=>{if(!p){const E=this.actionGetSizeBox();E.width>0&&E.height&&(p=!0,a(E))}10===w&&!p&&u(new Error)},100*w)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(a){let u=0;for(let p=0;p<a.children.length;p++)u+=a.children[p].getBoundingClientRect().width;return u}static#e=this.\u0275fac=function(u){return new(u||s)(M.rXU(M.aKT))};static#s=this.\u0275dir=M.FsC({type:s,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[M.OA$]})}return s})()},25539:(R,O,d)=>{d.d(O,{I:()=>M});class M{constructor(){this.answerLabelsMockup={}}}},5382:(R,O,d)=>{d.d(O,{n:()=>M});class M{constructor(s,l,a,u){this.tasks=new Array,this.queues=new Array,this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=s,this.result_common_temp={datas:[],errs:[]},this.action_log_item=l,this.delay_time=a||1e3,this.end_with_error=u??!1}addTask(s,l,a,u){if(this.is_running)return;var p=a||[];const w=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(f=>{this.wrap_counter++,l.call(s,...p).then(i=>{this.wrap_counter_done++,this.callLog(u),f({status:!0,value:i,index:w})}).catch(i=>{this.wrap_counter_done++,this.callLog(u),f({status:!1,error:i,index:w})})}),name:u})}callLog(s){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],s)}start(){return new Promise(s=>{0===this.queues.length&&s({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let l=0;l<this.limit_one_process;l++){const a=this.queues.shift();if(!a)break;this.tasks.push(a)}this.count_task_root_done=0,this.is_running=!0,this.runner(s)})}checker(s,l){this.count_task_root_done++,s.status&&s.value?this.result_common_temp.datas.push({index:s.index,value:s.value}):s.error&&this.result_common_temp.errs.push({index:s.index,value:s.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,l(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,l(this.makeResultObj())),this.nextItem(l)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(s,l){return s.index-l.index}).map(s=>s.value),errs:this.result_common_temp.errs.sort(function(s,l){return s.index-l.index}).map(s=>s.value)}}nextItem(s){const l=this.queues.shift();l&&l.task.call(this).then(a=>{this.checker(a,s)})}runner(s){this.tasks.length>0?this.tasks.forEach(l=>{l.task.call(this).then(a=>{this.checker(a,s)})}):(this.is_running=!1,s(this.makeResultObj()))}}},76671:(R,O,d)=>{d.d(O,{c:()=>E});var M=d(73014),T=d(27691),s=d(5382),l=d(26860),a=d(91930),u=d(40949),p=d(41426);const w=d(4060);let E=(()=>{class f{constructor(t,e,n){this.commonService=t,this.sAztCdnService=e,this.apiUploadService=n,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}static#t=this.searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g;convertBase64OfMathJaxToCdnUrl(t){return new Promise(e=>{var n=this.getValueContentQuestion(t.questionContent??""),r=this.getValueContentQuestion(t.answerConfig??""),_=t.answerMedia??"",c=this.removeBase64MathJaxInQuestionContent(t.questionText??"");if(0===n.length||0===r.length)return void e(t);let m=this.encodeContent(n[0].content),g=[];r.forEach((h,C)=>{g.push({i:C,d:this.encodeContent(h.content)})});let o=this.encodeContent(_);var v=0;let P=[];for(let h=0;h<m.raws.length;h++)m.raws[h].i=v,v++,P.push(m.raws[h]);for(let h=0;h<o.raws.length;h++)o.raws[h].i=v,v++,P.push(o.raws[h]);g.forEach(h=>{for(let C=0;C<h.d.raws.length;C++)h.d.raws[C].i=v,v++,P.push(h.d.raws[C])}),P.length>0?this.uploadRawContent(P.map(h=>h.l)).then(h=>{m.raws.forEach(C=>{let k=this.stringFirst+btoa(JSON.stringify({l:h,i:C.i}));n[0].content=this.commonService.replaceAll(n[0].content,C.l,k)??""}),o.raws.forEach(C=>{let k=this.stringFirst+btoa(JSON.stringify({l:h,i:C.i}));_=this.commonService.replaceAll(_,C.l,k)??""}),g.forEach(C=>{C.d.raws.forEach(k=>{let I=this.stringFirst+btoa(JSON.stringify({l:h,i:k.i}));r[C.i].content=this.commonService.replaceAll(r[C.i].content,k.l,I)??""})}),t.questionContent=JSON.stringify(n),t.answerConfig=JSON.stringify(r),t.answerMedia=_,t.questionText=c,e(t)}).catch(()=>{e(t)}):e(t)})}decodeMathJaxCodeToCdnUrl(t){return new Promise(e=>{const n=new s.n(10);if(n.addTask(this,()=>new Promise(r=>{this.decodeContent(t.content??"").then(_=>{t.content=_,r(!0)}).catch(()=>{r(!1)})})),n.addTask(this,()=>new Promise(r=>{this.decodeContent(t.help??"").then(_=>{t.help=_,r(!0)}).catch(()=>{r(!1)})})),t.answers)for(let r=0;r<t.answers.length;r++)n.addTask(this,()=>new Promise(_=>{t.answers&&this.decodeContent(t.answers[r].content??"").then(c=>{t.answers&&(t.answers[r].content=c),_(!0)}).catch(()=>{_(!1)})}));n.start().then(()=>{e()})})}getValueContentQuestion(t){return this.commonService.castJsonToObj(t)??[]}getAllMatchWithContent(t){let n,e=[];for(;null!==(n=f.searchPattern.exec(t));)e.includes(n[0])||e.push(n[0]);return e}getRawContent(t,e){return t=this.sAztCdnService.getMyCdn(t),new Promise((n,r)=>{const _=this.dataRaws.findIndex(c=>c.l===t);-1===_?fetch(t).then(c=>c.blob()).then(c=>c.arrayBuffer()).then(c=>{const m=w.inflate(c),g=this.commonService.castJsonToObj((new TextDecoder).decode(m));this.dataRaws.push({l:t,d:g??[]}),g&&g[e]?n(g[e]):r(new Error("Not found index"))}).catch(()=>{r(new Error("Exception at feed link"))}):this.dataRaws[_].d&&this.dataRaws[_].d[e]?n(this.dataRaws[_].d[e]):r(new Error("Not found index"))})}uploadRawContent(t){return new Promise((e,n)=>{const r=JSON.stringify(t),_=(new TextEncoder).encode(r),c=w.deflate(_),m=new Blob([c],{type:"application/octet-stream"}),g=new File([m],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(g).subscribe(o=>{o.type!=T.hv.UploadProgress&&(1==o.success&&o.data?e(o.data.url??""):n(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+o.message)))})})}removeBase64MathJaxInQuestionContent(t){return this.encodeContent(t).raws.forEach(n=>{t=this.commonService.replaceAll(t,n.l,"")??""}),t}encodeContent(t){let e=this.getAllMatchWithContent(t),n=[];for(let r=0;r<e.length;r++){let c=e[r].replace(f.searchPattern,"$1");c.startsWith(this.stringFirst)||n.push({l:c,i:n.length})}return{content:t,raws:n}}decodeContent(t){var e=this;return(0,M.A)(function*(){let n=e.getAllMatchWithContent(t);for(let r=0;r<n.length;r++){const _=n[r];let c=_.replace(f.searchPattern,"$1");for(let m=0;m<e.stringFirstOld.length;m++)if(c.startsWith(e.stringFirstOld[m])){t=e.commonService.replaceAll(t,_,"")??"";continue}if(c.startsWith(e.stringFirst)){let m=e.commonService.castJsonToObj(atob(c.replace(e.stringFirst,"")));if(m){let g=yield e.getRawContent(m.l,m.i);t=e.commonService.replaceAll(t,c,g)??""}}}return t})()}static#e=this.\u0275fac=function(e){return new(e||f)(l.KVO(a.R),l.KVO(u.B),l.KVO(p.T))};static#s=this.\u0275prov=l.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},32639:(R,O,d)=>{d.d(O,{g:()=>w});var M=d(65106),T=d(5382),s=d(4744),l=d(26860),a=d(40949),u=d(91930),p=d(76671);let w=(()=>{class E{pushImage(i,t,e){if(e){let n=new RegExp("<div id='"+i+"'[^>]+></div>","g");e.content&&(e.content=e.content.replace(n,t??"")),e.answers&&e.answers.forEach(r=>{r.content=r.content?.replace(n,t??"")}),e.help&&(e.help=e.help.replace(n,t??"")),e.groupInfo&&e.groupInfo.groupContent&&(e.groupInfo.groupContent=e.groupInfo.groupContent.replace(n,t??""))}}parseRenderQuestions(i,t,e,n,r,_){return new Promise((c,m)=>{const o=new T.n(25,{function:(v,P)=>{t&&t(v/P*100)}},n??1e3);i.forEach(v=>{o.addTask(this,this.parseRenderQuestion,[v,e,r,_])}),o.start().then(v=>{if(v.errs.length>0){const P=[];v.errs.forEach(h=>{let C=P.find(k=>k.type===h.type);C||P.push(h),C?.data.concat(h.data)}),m(P)}else c(i)})})}parseRenderQuestion(i,t,e,n){return new Promise((r,_)=>{var c=new s.h(this.cdnService,this.commonService,t||new M.y,o=>{_(o)});c.callbackPushImage=(o,v)=>{this.pushImage(o,v,i)},c.caller=this;const g=new T.n(n?1:20,void 0,0);i.content&&g.addTask(this,()=>new Promise(o=>{i.content=c.render(this.commonService.removeBracket(i.content??""),()=>{o()})})),i.answers&&i.answers.forEach(o=>{g.addTask(this,()=>new Promise(v=>{o.content=c.render(o.content||"",()=>{v()})}))}),i.help&&g.addTask(this,()=>new Promise(o=>{i.help=c.render(i.help,()=>{o()})})),i.groupInfo&&i.groupInfo.groupContent&&g.addTask(this,()=>new Promise(o=>{i.groupInfo&&i.groupInfo.groupContent?i.groupInfo.groupContent=c.render(this.commonService.removeBracket(i.groupInfo.groupContent),()=>{o()}):o()})),e&&g.addTask(this,()=>new Promise(o=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(i).then(()=>{o()})})),g.start().then(o=>{o.errs.length>0||r()})})}constructor(i,t,e){this.cdnService=i,this.commonService=t,this.dataAztMathRawHelper=e}static#t=this.\u0275fac=function(t){return new(t||E)(l.KVO(a.B),l.KVO(u.R),l.KVO(p.c))};static#e=this.\u0275prov=l.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}return E})()}}]);