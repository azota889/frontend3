"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[254],{84123:(E,m,g)=>{g.d(m,{W:()=>b});var _=g(27691),u=g(51698),v=g(64198),p=g(26860),k=g(91930),S=g(41426),C=g(63709);let b=(()=>{class c{replaceImageInContent(a,e){return new u.c(t=>{if(e.includes("<img ")){var i=this.findAllSubString(e,"<img"),n=[],r=[];i.forEach(o=>{var l=e.indexOf("src=",o),d=e.indexOf('"',Number(l)+5),s=e.substring(Number(l)+5,Number(d)+1);s.includes(";base64")?n.push({oldUrl:s}):s.includes("blob:")&&r.push({oldUrl:s})}),n.length>0?this.reUploadBase64File(a,n,(o,l)=>{null==l?r&&r.length>0?this.reUploadBlobFile(a,r,(d,s)=>{null!=s?(e=this.replaceHomeworkContent(e,o),e=this.replaceHomeworkContent(e,d),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:s,content:e}),t.complete())}):(e=this.replaceHomeworkContent(e,o),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:l,content:e}),t.complete())}):r.length>0?this.reUploadBlobFile(a,r,(o,l)=>{null==l?(e=this.replaceHomeworkContent(e,o),t.next({errorMessage:void 0,content:e}),t.complete()):(t.next({errorMessage:l,content:e}),t.complete())}):(e=this.replaceHomeworkContent(e,[]),t.next({errorMessage:void 0,content:e}),t.complete())}else t.next({errorMessage:void 0,content:e}),t.complete()})}replaceHomeworkContent(a,e){return e.length>0&&e.forEach(t=>{a=a.replace(t.oldUrl??"  ",t.newUrl+'" class="w-100 img-fluid"')}),a}findAllSubString(a,e){for(var t=0,i=0,n=[];a.indexOf(e,t)>-1;)i=a.indexOf(e,t),n.push(i),t=i+e.length;return n}getTypeFile(a){var e=a.indexOf(";");return a.substring(5,e)}getFileName(a){var e=a.split("").reverse().join(""),t=e.indexOf(";"),i=e.indexOf("/",t);return e.substring(t,i).split("").reverse().join("")}convertBlobToBase64(a){return new Promise(e=>{var t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",function(){var i=document.createElement("canvas"),n=i.getContext("2d");i.width=t.width,i.height=t.height,n?.drawImage(t,0,0);var r=i.toDataURL("image/png");e(r)},!1),t.src=a})}reUploadBase64File(a,e,t){if(e&&e.length>0){let o,r=e.length;for(var i=[],n=0;n<e.length;n++){const l=e[n],d=l.oldUrl?.substring(0,l.oldUrl.length-1);this.startUploadBlobFile(a,l,d??"",[],(s,f)=>{null==f?i=i.concat(s):o=f,r-=1,0==r&&t(i,o)})}}else t([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(a,e,t){if(e&&e.length>0){let o,r=e.length;for(var i=[],n=0;n<e.length;n++){const l=e[n],d=l?.oldUrl?.substring(0,l.oldUrl.length-1);this.convertBlobToBase64(d??"").then(s=>{this.startUploadBlobFile(a,l,s,[],(f,h)=>{null==h?i=i.concat(f):o=h,r-=1,0==r&&t(i,o)})})}}else t([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(a,e,t,i,n){if(t&&""!=t){var r=this.getTypeFile(t),o=this.myPdfService.b64toFile(t,this.getFileName(r),r);(0,v.w4)(o).then(l=>{this.apiUploadService.commonUploadFile(a,l,"").subscribe(d=>{if(d.type!=_.hv.UploadProgress)if(1==d.success){var s={...e,newUrl:d.data?.url??""};i.push(s),n(i,void 0)}else n(i,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",d.message??"none"))})})}else n(i,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(a,e,t){this.commonService=a,this.apiUploadService=e,this.myPdfService=t}static#e=this.\u0275fac=function(e){return new(e||c)(p.KVO(k.R),p.KVO(S.T),p.KVO(C.C))};static#t=this.\u0275prov=p.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},70254:(E,m,g)=>{g.d(m,{f:()=>b});var _=g(43234),u=g(26860),v=g(50589);let p=(()=>{class c{getMode(){return""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light"}constructor(a){this.browserStorageService=a}static#e=this.\u0275fac=function(e){return new(e||c)(u.KVO(v.z))};static#t=this.\u0275prov=u.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();var k=g(91930),S=g(84123),C=g(40949);let b=(()=>{class c{constructor(a,e,t,i){this.darkModeService=a,this.commonService=e,this.sAztUploadImageOfExamService=t,this.cdnService=i}get initConfigUrlScript(){return{language_url:_.c.azt_tiny_mce_vi_langs_src}}initConfigForAdmin(){var t={};return t={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["code","fullscreen","link"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | link | code | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForAdminWithUploadImageBox(a){var i={};return i={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen link",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | link | code | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,min_height:250,file_picker_callback:(n,r,o)=>{this.file_picker_callback(a,n,r,o)},content_css:[this.cdnService.convertCdnLinkOfGitHub("angular/styles.6c8c340cca20c274.css")],...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(i.skin="oxide-dark",i.content_css="dark"),i}initConfigForAdminForDigitalized(a){var i={};return i={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,valid_elements:"*[*]",plugins:"image code autoresize fullscreen link azt-math-editor azt-manager-plugins",external_plugins:{"azt-math-editor":"/assets/output-scratch-mode-v2/azt-math-editor/plugin.1.0.0.min.js","azt-manager-plugins":"/assets/output-scratch-mode-v2/azt-manager-plugins/plugin.1.0.0.min.js"},toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | link | code | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,min_height:250,file_picker_callback:(n,r,o)=>{this.file_picker_callback(a,n,r,o)},content_css:[this.cdnService.convertCdnLinkOfGitHub("angular/styles.6c8c340cca20c274.css")],...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(i.skin="oxide-dark",i.content_css="dark"),i}initConfigForTeacher(){var t={};return t={height:250,min_height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["fullscreen"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigTeacherHomework(a){var i={};return i={min_height:a,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(i.skin="oxide-dark",i.content_css="dark"),i}initConfigStudentHomework(){var t={};return t={height:450,min_height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",readonly:1,plugins:["emoticons advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | emoticons",emoticons_database:"emojis",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForTeacherWithUploadImageBox(a){var i={};return i={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,min_height:250,file_picker_callback:(n,r,o)=>{this.file_picker_callback(a,n,r,o)},...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(i.skin="oxide-dark",i.content_css="dark"),i}file_picker_callback(a,e,t,i){let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept","image/*"),n.onchange=()=>{let r=n.files?.[0],o=new FileReader;o.onload=()=>{let d=`<img src="${"data:image/png;base64, "+o.result.split(",")[1]}">`;this.sAztUploadImageOfExamService.replaceImageInContent(a,d).subscribe(s=>{if(s.errorMessage)this.commonService.snackError(s.errorMessage);else{let f=document.createElement("div");f.innerHTML=this.commonService.removeXssInHtml(s.content);let h=f.firstChild;h&&h.src&&e(h.src)}})},o.readAsDataURL(r)},n.click()}static#e=this.\u0275fac=function(e){return new(e||c)(u.KVO(p),u.KVO(k.R),u.KVO(S.W),u.KVO(C.B))};static#t=this.\u0275prov=u.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()}}]);