"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6260],{76094:(U,y,r)=>{r.d(y,{x:()=>F});var F=function(l){return l[l.templateOriginalA4=11]="templateOriginalA4",l[l.templateA5Full50=12]="templateA5Full50",l[l.templateA4Essay=13]="templateA4Essay",l[l.templateA6Full20=14]="templateA6Full20",l[l.templateTrueFalseA4=15]="templateTrueFalseA4",l[l.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",l[l.templateTrueFalseA5=17]="templateTrueFalseA5",l[l.templateTrueFalseA6=18]="templateTrueFalseA6",l}(F||{})},17997:(U,y,r)=>{r.d(y,{H:()=>x});var F=r(76094),l=r(65879),w=r(46558),B=r(97151),v=r(61419),R=r(41385),g=r(38228);let x=(()=>{class D{constructor(a,n,f,i,u){this.commonService=a,this.shareFileFlutterService=n,this.encryptService=f,this.formatAnswerSheetService=i,this.exportExcelService=u,this.allAnswerSheet=F.x}exportFileNameOfStudentCode(a,n,f){return 100==a&&(n=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(n?"_"+n:"")+"_"+this.encryptService.createMd5(f).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(a,n,f,i,u,O){return n==this.allAnswerSheet.templateA5Full50?a.createA5AnswerSheetFullA4_50(O??50):n==this.allAnswerSheet.templateA4Essay?a.createA4AnswerSheet_35hh(O??50):n==this.allAnswerSheet.templateA6Full20?a.createA6AnswerSheetFullA4_20(O??20):n==this.allAnswerSheet.templateTrueFalseA4||n==this.allAnswerSheet.templateTrueFalseEssayA4||n==this.allAnswerSheet.templateTrueFalseA5||n==this.allAnswerSheet.templateTrueFalseA6?a.createTrueFalseAnswerSheet():a.createAzotaAnswerSheet_A4(O??120)}exportFileNameOfAnswerSheet(a,n,f){var i="";return 100==a&&(n=""),(0==a||100==a)&&(i=this.commonService.createFileNameExportFile(["PhieuTL_"+f+(n?"_"+n:"")])),i}exportFileNameOfAnswerExcelOffline(a,n,f){var i="";return 100==a&&(n=""),(0==a||100==a)&&(i=this.commonService.createFileNameExportFile(["DapAn_"+(n?"_"+n:"")])),i}exportFileNameOfRawExam(a,n,f){var i="";return 100==a&&(n=""),(0==a||100==a)&&(i=this.commonService.createFileNameExportFile([(n?"_"+n:"")+"_"+this.encryptService.createMd5(f).substring(0,6)])),i}exportFileNameOfExamOffline(a,n,f,i){var u="";return 100==a&&(n=""),(0==a||100==a)&&(u=this.commonService.createFileNameExportFile([(i?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(i,3)+"_":"")+f+(n?"_"+n:"")])),u}printStudentCode(a,n){var f=[];let i=this.commonService.myClone(n);for(let u=0;u<i.length;u++)f.push({code:i[u].code??0,fullName:i[u]?.fullName??"",birthday:i[u]?.birthday??"",className:i[u].classroomName??""});this._exportExcelForCodeNumber(a,f)}_exportExcelForCodeNumber(a,n){let f=this.exportFileNameOfStudentCode(0,a?.name??"",a?.hashId??"");const i=this.exportExcelService.exportExcelForCodeNumber(n);this.shareFileFlutterService.shareFileWithBlob(i,f)}}return D.\u0275fac=function(a){return new(a||D)(l.LFG(w.z),l.LFG(B.g),l.LFG(v.j),l.LFG(R.j),l.LFG(g.L))},D.\u0275prov=l.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()},56260:(U,y,r)=>{r.d(y,{F:()=>z});var F=r(85965),w=r(8720),B=r(70731),v=r(89156),R=r(89745),g=r(79617),x=r(65879),D=r(36668),G=r(32965),a=r(46558),n=r(78953),f=r(19662),i=r(17997),u=r(41385),O=r(97151);let z=(()=>{class C{constructor(s,t,c,o,S,A,e,_){this.docxService=s,this.cdnService=t,this.commonService=c,this.userService=o,this.questionRenderService=S,this.printAnswersheetService=A,this.formatAnswerSheetService=e,this.shareFileFlutterService=_,this.configRenderService=new w.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new F,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((s,t)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?typeof azotaDocx<"u"&&azotaDocx?s(!0):t(new Error("lang_core_lib_not_load")):(this.countRetryLoadJS++,this.countRetryLoadJS>3?t(new Error("lang_core_lib_not_load")):s(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(s){let t=[];return s.forEach(c=>{let o="<b>     "+(c.alpha?c.alpha:c.key)+".</b> "+(0,g.uG)(c.content);t.push(o)}),t}getDataForExportDocxApi(s,t,c){let o=[],S=1;if(c){let e=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");o.push({content:`<b> ${e} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(c,3)+".</b>",answers:[]})}let A=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return t.forEach(e=>{1!==s.hideGroupQuestion&&e.groupInfo?.isFirstInGroup&&e.groupInfo.groupContent&&o.push({content:e.groupInfo.groupContent,answers:[]}),this.isEnableDebug&&o.push({content:` <br/><br/><br/>*** <b>Question ID: ${e.id}</b> ***`,answers:[]});let _={content:`<b>${A} `+(S+(s.startQuestionIndex??1)-1)+".</b> "+(e.content?.includes("<img")?"<br>":"")+(0,g.uG)(e.content),answers:this.convertAnswerQuestion(e.answers??[])};if(S++,o.push(_),this.isAnsDetail){if(e.answerResult){let h=[];if(e.answerResult.forEach(m=>{let p=m;const d=e.answers?.find(I=>I.key===m);d&&(p=d.alpha??p),h.push(p)}),5==e.answerType){let m="";e.answers.forEach((p,d)=>{m+=`${p.key} - ${h.includes(p.key)?this.commonService.myTranslateInstant("lang_auto_dung"):this.commonService.myTranslateInstant("lang_auto_sai")}${d==e.answers.length-1?"":" | "}`}),o.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_dap_an")}</b>: ${m}`,answers:[]})}else o.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_dap_an_dung")}</b>: ${h.join(" | ")}`,answers:[]})}e.help&&o.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_giai_thich_chi_tiet_upper")}</b>: ${e.help}`,answers:[]})}this.isEnableDebug&&o.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),o}itemConverterCaller(s,t,c,o,S){return new Promise((A,e)=>{this.questionRenderService.parseRenderQuestions(s.listQuestion,_=>{this.saveLoadingMsg.includes(")")||(this.changeMsg?this.changeMsg(this.saveLoadingMsg+Math.floor(_)+"%"):v.G.changeMsgLoadingEffect(this.saveLoadingMsg+Math.floor(_)+"%"))},this.configRenderService,void 0,!0,S).then(_=>{let h=[];h.push({content:g.Ip.makeHeaderTable([g.Ip.createLineCenterBold(t.schoolName?t.schoolName:"")],[g.Ip.createLineCenterBold(t.examName??""),g.Ip.createLineCenterBold(t.subject??""),g.Ip.createLineCenterItalicized(t.examMinutes??""),g.Ip.createLineCenterItalicized("-------------------------")],!1),answers:[]}),h.push({content:g.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),h.push({content:g.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),h=h.concat(this.getDataForExportDocxApi(o,_,s.offlineExamMixQuestionObj?s.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx?this.docxService.exportToDocxBinary(h,{isHeadless:!0},(m,p,d)=>{}).then(m=>{A({userObj:c,data:m,input:h,additionParams:t,offlineExamMixQuestionObj:s.offlineExamMixQuestionObj})}):e(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(_=>{e(new Error(_[0].message))})})}masterConverterCaller(s,t,c,o,S,A){return new Promise((e,_)=>{const h=this.userService.getUserObj();let m=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),p=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),d=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),I=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),b=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),T=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),P=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const N=new B.Q(1,{function:(M,E)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${E<=1?"":`(${M}/${E}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):v.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});s.forEach(M=>{N.addTask(this,this.itemConverterCaller,[M,{schoolName:o?.nameSchool??`{${m}}`,subject:o?.nameSubject??`{${p}}`,examName:t.name??`{${d}}`,examMinutes:t.minutes&&t.minutes>0?`${I}: `+t.minutes+` ${T} (${b})`:` ${I}: ${P}`,templateType:S??0,numberOfQuestion:M.listQuestion.length,examId:M.offlineExamMixQuestionObj?.hashId??0},h,t,A])}),N.start().then(M=>{if(M.errs.length>0)_(M.errs[0]);else if(1===M.datas.length){const E=M.datas[0],L=new Blob([E.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let W=this.createNameExam(t,c,E.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(L,W),e()}else M.datas.forEach(E=>{let L=this.createNameExam(t,c,E.offlineExamMixQuestionObj);L=this.replaceAllString(L,"/","_"),this.zipper.file("DOCS/"+L,E.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(E=>{let L=this.commonService.createFileNameExportFile([t.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(E,L),e()},E=>{_(E)})},200)})})}replaceAllString(s,t,c){for(;s.includes(t);)s=s.replace(t,c);return s}createNameExam(s,t,c){return t?this.printAnswersheetService.exportFileNameOfExamOffline(0,s.name??"",t?.hashId??"",c?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,s.name??"",s.hashId??"")+".docx"}downloadExam(s,t,c,o,S,A,e,_,h,m,p){return new Promise((d,I)=>{this.isAnsDetail=s,this.isEnableDebug=!!m,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=h,this.loadScriptAction().then(b=>{b?this.masterConverterCaller([{listQuestion:S,offlineExamMixQuestionObj:o}],t,c,A,e,p).then(()=>{this.zipper=new F,_?_(10):v.G.closeLoadingEffect(10),d()}).catch(T=>{v.G.closeLoadingEffect(10),I(T)}):(_?_(10):v.G.closeLoadingEffect(10),I(new Error("lang_core_lib_not_load")))}).catch(()=>{_?_(10):v.G.closeLoadingEffect(10),I(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(s,t,c,o,S,A,e,_,h,m){return new Promise((p,d)=>{this.isAnsDetail=s,this.isEnableDebug=!!h,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=_,this.loadScriptAction().then(I=>{if(I){let b=!0;const T=[];o.forEach(P=>{let N=this.commonService.castJsonToClassObjs(R.v,JSON.stringify(P.mixQuestions??[]))??[];N.length>0?T.push({listQuestion:N,offlineExamMixQuestionObj:P}):b=!1}),b?this.masterConverterCaller(T,t,c,S,A,m).then(()=>{this.zipper=new F,e?e(10):v.G.closeLoadingEffect(10),p()}).catch(P=>{e?e(10):v.G.closeLoadingEffect(10),d(P)}):(e?e(10):v.G.closeLoadingEffect(10),d(new Error("lang_testbank_exam_is_invalid_condition")))}else e?e(10):v.G.closeLoadingEffect(10),d(new Error("lang_core_lib_not_load"))}).catch(()=>{e?e(10):v.G.closeLoadingEffect(10),d(new Error("lang_core_lib_not_load"))})})}}return C.\u0275fac=function(s){return new(s||C)(x.LFG(D.n),x.LFG(G.E),x.LFG(a.z),x.LFG(n.U),x.LFG(f.h),x.LFG(i.H),x.LFG(u.j),x.LFG(O.g))},C.\u0275prov=x.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()}}]);