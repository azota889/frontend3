"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[1614],{51614:(W,v,i)=>{i.d(v,{X:()=>N});var o=i(48891),d=i(76627),j=i(59640),S=i(84828),L=i(17776),b=i(54460),k=i(47426),C=i(95670),F=i(4375),_=i(10936),I=i(44233),E=i(43166),O=i(76975);function y(e,s){if(1&e&&o.eu8(0,7),2&e){o.XpG();const l=o.sdS(4);o.Y8G("ngTemplateOutlet",l)}}function T(e,s){if(1&e&&o.eu8(0,7),2&e){o.XpG();const l=o.sdS(6);o.Y8G("ngTemplateOutlet",l)}}function B(e,s){if(1&e&&(o.j41(0,"mat-option",22),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&e){const l=s.$implicit;o.Y8G("value",l.id),o.R7$(),o.SpI(" ",o.bMT(2,2,l.key)," ")}}function R(e,s){if(1&e&&(o.j41(0,"mat-option",22),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&e){const l=s.$implicit;o.Y8G("value",l.id),o.R7$(),o.SpI(" ",o.bMT(2,2,l.key)," ")}}function D(e,s){if(1&e&&(o.qex(0),o.j41(1,"mat-option",22),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.bVm()),2&e){const l=s.$implicit;o.R7$(),o.Y8G("value",l.id),o.R7$(),o.SpI(" ",o.bMT(3,2,l.title)," ")}}function M(e,s){if(1&e&&(o.j41(0,"div",23)(1,"div",11)(2,"label",24),o.EFF(3),o.nI1(4,"mytranslate"),o.k0s()(),o.j41(5,"mat-form-field",13)(6,"mat-select",14,4)(8,"mat-option"),o.nrm(9,"ngx-mat-select-search",15),o.nI1(10,"mytranslate"),o.nI1(11,"mytranslate"),o.k0s(),o.j41(12,"mat-option",22),o.EFF(13),o.nI1(14,"mytranslate"),o.k0s(),o.DNE(15,D,4,4,"ng-container",25),o.k0s()()()),2&e){const l=o.sdS(7),n=o.XpG(2);o.R7$(3),o.SpI(" ",o.bMT(4,8,"lang_core_sach")," "),o.R7$(3),o.Y8G("formControl",n.form.controls.bookIdFormControl),o.R7$(3),o.FS9("placeholderLabel",o.bMT(10,10,"lang_bot_common_search_by_name")),o.FS9("noEntriesFoundLabel",o.bMT(11,12,"lang_bot_common_search_not_found")),o.Y8G("formControl",l.searchControl),o.R7$(3),o.Y8G("value",0),o.R7$(),o.SpI("- ",o.bMT(14,14,"lang_create_tree_category_default_book")," -"),o.R7$(2),o.Y8G("ngForOf",l.filter(n.listBookObjs,"title"))}}function $(e,s){1&e&&(o.j41(0,"div",26),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&e&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"lang_auto_vui_long_chon_khoi_hoc_va_mon_hoc")," "))}function G(e,s){if(1&e&&(o.j41(0,"form",8)(1,"div",9)(2,"div",10)(3,"div",11)(4,"label",12),o.EFF(5),o.nI1(6,"mytranslate"),o.k0s()(),o.j41(7,"mat-form-field",13)(8,"mat-select",14,2)(10,"mat-option"),o.nrm(11,"ngx-mat-select-search",15),o.nI1(12,"mytranslate"),o.nI1(13,"mytranslate"),o.k0s(),o.j41(14,"mat-option",16),o.EFF(15),o.nI1(16,"mytranslate"),o.k0s(),o.DNE(17,B,3,4,"mat-option",17),o.k0s()()(),o.j41(18,"div",10)(19,"div",11)(20,"label",18),o.EFF(21),o.nI1(22,"mytranslate"),o.k0s()(),o.j41(23,"mat-form-field",13)(24,"mat-select",14,3)(26,"mat-option"),o.nrm(27,"ngx-mat-select-search",15),o.nI1(28,"mytranslate"),o.nI1(29,"mytranslate"),o.k0s(),o.j41(30,"mat-option",16),o.EFF(31),o.nI1(32,"mytranslate"),o.k0s(),o.DNE(33,R,3,4,"mat-option",17),o.k0s()()(),o.DNE(34,M,16,16,"div",19),o.j41(35,"div",20),o.DNE(36,$,3,3,"div",21),o.k0s()()()),2&e){const l=o.sdS(9),n=o.sdS(25),t=o.XpG();o.Y8G("formGroup",t.form),o.R7$(5),o.SpI(" ",o.bMT(6,19,"lang_auto_khoi_hoc")," "),o.R7$(3),o.Y8G("formControl",t.form.controls.schoolLevel),o.R7$(3),o.FS9("placeholderLabel",o.bMT(12,21,"lang_bot_common_search_by_name")),o.FS9("noEntriesFoundLabel",o.bMT(13,23,"lang_bot_common_search_not_found")),o.Y8G("formControl",l.searchControl),o.R7$(3),o.Y8G("value",0),o.R7$(),o.SpI("",o.bMT(16,25,"lang_auto_---chon_khoi"),"---"),o.R7$(2),o.Y8G("ngForOf",l.filter(l.mergeSchoolLevel(t.schoolLevelObjs),"key")),o.R7$(4),o.SpI(" ",o.bMT(22,27,"lang_auto_mon_hoc")," "),o.R7$(3),o.Y8G("formControl",t.form.controls.schoolSubject),o.R7$(3),o.FS9("placeholderLabel",o.bMT(28,29,"lang_bot_common_search_by_name")),o.FS9("noEntriesFoundLabel",o.bMT(29,31,"lang_bot_common_search_not_found")),o.Y8G("formControl",n.searchControl),o.R7$(3),o.Y8G("value",0),o.R7$(),o.SpI("",o.bMT(32,33,"lang_auto_---chon_mon"),"---"),o.R7$(2),o.Y8G("ngForOf",n.filter(t.schoolSubjectObjs,"key")),o.R7$(),o.Y8G("ngIf",t.form.controls.bookIdFormControl),o.R7$(2),o.Y8G("ngIf",t.form.controls.schoolLevel.invalid||t.form.controls.schoolSubject.invalid)}}function x(e,s){if(1&e&&(o.j41(0,"mat-option",22),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&e){const l=s.$implicit;o.Y8G("value",l.id),o.R7$(),o.SpI(" ",o.bMT(2,2,l.key)," ")}}function Y(e,s){if(1&e&&(o.j41(0,"mat-option",22),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&e){const l=s.$implicit;o.Y8G("value",l.id),o.R7$(),o.SpI(" ",o.bMT(2,2,l.key)," ")}}function A(e,s){if(1&e&&(o.qex(0),o.j41(1,"mat-option",22),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.bVm()),2&e){const l=s.$implicit;o.R7$(),o.Y8G("value",l.id),o.R7$(),o.SpI(" ",o.bMT(3,2,l.title)," ")}}function P(e,s){if(1&e&&(o.j41(0,"div",34)(1,"label",35),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.j41(4,"mat-form-field",29)(5,"mat-select",14,4)(7,"mat-option"),o.nrm(8,"ngx-mat-select-search",15),o.nI1(9,"mytranslate"),o.nI1(10,"mytranslate"),o.k0s(),o.j41(11,"mat-option",22),o.EFF(12),o.nI1(13,"mytranslate"),o.k0s(),o.DNE(14,A,4,4,"ng-container",25),o.k0s()()()),2&e){const l=o.sdS(6),n=o.XpG(2);o.R7$(2),o.SpI(" ",o.bMT(3,8,"lang_core_sach")," "),o.R7$(3),o.Y8G("formControl",n.form.controls.bookIdFormControl),o.R7$(3),o.FS9("placeholderLabel",o.bMT(9,10,"lang_bot_common_search_by_name")),o.FS9("noEntriesFoundLabel",o.bMT(10,12,"lang_bot_common_search_not_found")),o.Y8G("formControl",l.searchControl),o.R7$(3),o.Y8G("value",0),o.R7$(),o.SpI("- ",o.bMT(13,14,"lang_create_tree_category_default_book")," -"),o.R7$(2),o.Y8G("ngForOf",l.filter(n.listBookObjs,"title"))}}function K(e,s){1&e&&(o.j41(0,"div",36)(1,"div",26),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s()()),2&e&&(o.R7$(2),o.SpI(" ",o.bMT(3,1,"lang_auto_vui_long_chon_khoi_hoc_va_mon_hoc")," "))}function w(e,s){if(1&e&&(o.j41(0,"form",8)(1,"div",9)(2,"div",27)(3,"label",28),o.EFF(4),o.nI1(5,"mytranslate"),o.k0s(),o.j41(6,"mat-form-field",29)(7,"mat-select",14,2)(9,"mat-option"),o.nrm(10,"ngx-mat-select-search",15),o.nI1(11,"mytranslate"),o.nI1(12,"mytranslate"),o.k0s(),o.j41(13,"mat-option",16),o.EFF(14),o.nI1(15,"mytranslate"),o.k0s(),o.DNE(16,x,3,4,"mat-option",17),o.k0s()()(),o.j41(17,"div",30)(18,"label",31),o.EFF(19),o.nI1(20,"mytranslate"),o.k0s(),o.j41(21,"mat-form-field",29)(22,"mat-select",14,3)(24,"mat-option"),o.nrm(25,"ngx-mat-select-search",15),o.nI1(26,"mytranslate"),o.nI1(27,"mytranslate"),o.k0s(),o.j41(28,"mat-option",16),o.EFF(29),o.nI1(30,"mytranslate"),o.k0s(),o.DNE(31,Y,3,4,"mat-option",17),o.k0s()()(),o.DNE(32,P,15,16,"div",32),o.k0s(),o.DNE(33,K,4,3,"div",33),o.k0s()),2&e){const l=o.sdS(8),n=o.sdS(23),t=o.XpG();o.Y8G("formGroup",t.form),o.R7$(4),o.SpI(" ",o.bMT(5,19,"lang_auto_khoi_hoc")," "),o.R7$(3),o.Y8G("formControl",t.form.controls.schoolLevel),o.R7$(3),o.FS9("placeholderLabel",o.bMT(11,21,"lang_bot_common_search_by_name")),o.FS9("noEntriesFoundLabel",o.bMT(12,23,"lang_bot_common_search_not_found")),o.Y8G("formControl",l.searchControl),o.R7$(3),o.Y8G("value",0),o.R7$(),o.SpI("",o.bMT(15,25,"lang_auto_---chon_khoi"),"---"),o.R7$(2),o.Y8G("ngForOf",l.filter(l.mergeSchoolLevel(t.schoolLevelObjs),"key")),o.R7$(3),o.SpI(" ",o.bMT(20,27,"lang_auto_mon_hoc")," "),o.R7$(3),o.Y8G("formControl",t.form.controls.schoolSubject),o.R7$(3),o.FS9("placeholderLabel",o.bMT(26,29,"lang_bot_common_search_by_name")),o.FS9("noEntriesFoundLabel",o.bMT(27,31,"lang_bot_common_search_not_found")),o.Y8G("formControl",n.searchControl),o.R7$(3),o.Y8G("value",0),o.R7$(),o.SpI("",o.bMT(30,33,"lang_auto_---chon_mon"),"---"),o.R7$(2),o.Y8G("ngForOf",n.filter(t.schoolSubjectObjs,"key")),o.R7$(),o.Y8G("ngIf",t.form.controls.bookIdFormControl),o.R7$(),o.Y8G("ngIf",t.form.controls.schoolLevel.invalid||t.form.controls.schoolSubject.invalid)}}let N=(()=>{var e;class s extends j.H{getChangeKey(){let n=this.form.getRawValue();return n.schoolLevel+"_"+n.schoolSubject+"_"+(n.bookIdFormControl??0)}updateLevelAndSubjectToForm(n,t,a){let m=this.commonService.concatMultipleArray(this.schoolLevelObjs.map(r=>r.schoolSubjectObjs)).find(r=>r.id==t)?.key,h=this.schoolLevelObjs.find(r=>r.schoolLevel?.id==n);this.schoolSubjectObjs=h?.schoolSubjectObjs??[];let c=this.schoolSubjectObjs.find(r=>r.id==t||r.key?.toLowerCase()==m?.toLowerCase());n=h?.schoolLevel?.id??0,t=c?.id??0,a=a??0;let f=this.form.getRawValue();f.schoolLevel!=n&&this.form.controls.schoolLevel.setValue(n),f.schoolSubject!=t&&this.form.controls.schoolSubject.setValue(t),f.bookIdFormControl!=a&&this.form.controls.bookIdFormControl?.setValue(a),this.getBookObjs(n,t,a,r=>{let u=this.form.getRawValue();if(u.schoolLevel!=r.schoolLevelId||u.schoolSubject!=r.schoolSubjectId||u.bookIdFormControl!=r.bookId)return;this.listBookObjs=r.books;let g=this.listBookObjs.find(U=>U.id==a);a=g?.id??0,this.showBookData&&u.bookIdFormControl!=a&&this.form.controls.bookIdFormControl?.setValue(a);let p=this.getChangeKey();this.lastChangeKey!=p&&(this.lastChangeKey=p,this.changeDataEvent.emit({bookName:g?.title}))})}getBookObjs(n,t,a,m){if(!this.showBookData)return m({schoolLevelId:n,schoolSubjectId:t,bookId:a,books:[]});if(!n||!t)return m({schoolLevelId:n,schoolSubjectId:t,bookId:a,books:[]});let h=this.listBookByLevelSubject.find(c=>c.levelId==n&&c.subjectId==t);if(null!=h)return m({schoolLevelId:n,schoolSubjectId:t,bookId:a,books:h.books});this.isLoadingBook=!0,this.waitDestroy(this.aiElearningService.aiApiV1ElearningGetElearningBookGet(n,t).subscribe({next:c=>{c=c.filter(f=>f.isActive),this.listBookByLevelSubject.push({levelId:n,subjectId:t,books:c}),this.isLoadingBook=!1,m({schoolLevelId:n,schoolSubjectId:t,bookId:a,books:c})},error:c=>{this.isLoadingBook=!1,this.errorStatusObj(c.message,!0),m({schoolLevelId:n,schoolSubjectId:t,bookId:a,books:[]})}}))}getSubjectAndLevel(){this.initStatusObj(),this.waitDestroy(this.commonListService.apiCommonListSubjectAndLevelsGet(this.commonService.getBusinessDomainUrl()).subscribe(n=>{if(!n.success)return this.errorStatusObj(n.message,!0);if(this.schoolLevelObjs=n.data?.schoolLevelSubjectObjs??[],this.removeLevelSubjectWithOtherName&&(this.schoolLevelObjs=this.schoolLevelObjs.filter(t=>"azt_lang_core_khoi_khac"!=t.schoolLevel?.key),this.schoolLevelObjs.forEach(t=>t.schoolSubjectObjs=t.schoolSubjectObjs.filter(a=>"azt_auto_lang_khac"!=a.key))),this.useExamSchoolLogData&&0==this.form.controls.schoolLevel.value)return this.updateLevelAndSubjectToForm(n.data?.examSchoolLogObj?.lastSchoolLevelId??0,n.data?.examSchoolLogObj?.lastSchoolSubjectId??0,void 0),this.stopStatusObj();if(this.useFirstAsDefault&&0==this.form.controls.schoolLevel.value){let t=this.commonService.getLastOfArray(this.schoolLevelObjs),a=this.commonService.getFirstOfArray(t?.schoolSubjectObjs??[]);if(t&&a)return this.updateLevelAndSubjectToForm(t.schoolLevel?.id??0,a.id,this.form.controls.bookIdFormControl?.value),this.stopStatusObj()}this.updateLevelAndSubjectToForm(this.form.controls.schoolLevel.value,this.form.controls.schoolSubject.value,this.form.controls.bookIdFormControl?.value),this.stopStatusObj()}))}listenChangeLevelSubjectBook(){let n=[this.form.controls.schoolSubject.valueChanges,this.form.controls.schoolLevel.valueChanges];this.form.controls.bookIdFormControl&&n.push(this.form.controls.bookIdFormControl?.valueChanges),(0,d.z)(n).subscribe(t=>{let a=this.form.getRawValue();this.updateLevelAndSubjectToForm(a.schoolLevel,a.schoolSubject,a.bookIdFormControl)})}ngOnInit(){this.listenChangeLevelSubjectBook(),this.getSubjectAndLevel()}constructor(n,t){super(),this.commonListService=n,this.aiElearningService=t,this.removeLevelSubjectWithOtherName=!1,this.showBookData=!1,this.useExamSchoolLogData=!1,this.useFirstAsDefault=!1,this.layout="default",this.changeDataEvent=new o.bkB,this.schoolLevelObjs=[],this.schoolSubjectObjs=[],this.listBookObjs=[],this.lastChangeKey=void 0,this.listBookByLevelSubject=[],this.isLoadingBook=!1}}return(e=s).\u0275fac=function(n){return new(n||e)(o.rXU(S.Nz),o.rXU(L.T5))},e.\u0275cmp=o.VBU({type:e,selectors:[["config-level-subject-book"]],inputs:{form:"form",removeLevelSubjectWithOtherName:"removeLevelSubjectWithOtherName",showBookData:"showBookData",useExamSchoolLogData:"useExamSchoolLogData",useFirstAsDefault:"useFirstAsDefault",layout:"layout"},outputs:{changeDataEvent:"changeDataEvent"},features:[o.Vt3],decls:7,vars:2,consts:[["defaultLayoutTpl",""],["labelInOneLineTpl",""],["searchInListSchoolLevel","searchInList"],["searchInListSchoolSubject","searchInList"],["searchInListBook","searchInList"],[1,"config-level-subject"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet"],[3,"formGroup"],["id","azt-config-level-subject",1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-6"],[1,"font-medium"],["for","schoolLevel",1,"form-label","flex","items-center"],["appearance","outline"],["searchInList","",3,"formControl"],[3,"formControl","placeholderLabel","noEntriesFoundLabel"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["for","schoolSubject",1,"form-label","flex","items-center"],["class","col-span-12",4,"ngIf"],[1,"col-span-12",2,"margin-top","-20px"],["class","text-xs mt-2 text-danger",4,"ngIf"],[3,"value"],[1,"col-span-12"],["for","bookSelected",1,"form-label","flex","items-center"],[4,"ngFor","ngForOf"],[1,"text-xs","mt-2","text-danger"],[1,"col-span-3","flex","items-center"],["for","schoolLevel",1,"mr-1","flex-none","whitespace-nowrap"],["appearance","outline",1,"box",2,"width","100%"],[1,"col-span-4","flex","items-center"],["for","schoolSubject",1,"ml-2","mr-1","whitespace-nowrap","flex-none"],["class","col-span-5 flex items-center",4,"ngIf"],["style","margin-top: -20px",4,"ngIf"],[1,"col-span-5","flex","items-center"],["for","bookSelected",1,"ml-2","mr-1","flex-none","whitespace-nowrap"],[2,"margin-top","-20px"]],template:function(n,t){1&n&&(o.j41(0,"div",5),o.DNE(1,y,1,1,"ng-container",6)(2,T,1,1,"ng-container",6),o.k0s(),o.DNE(3,G,37,35,"ng-template",null,0,o.C5r)(5,w,34,35,"ng-template",null,1,o.C5r)),2&n&&(o.R7$(),o.Y8G("ngIf","default"==t.layout),o.R7$(),o.Y8G("ngIf","label_in_one_line"==t.layout))},dependencies:[b.Sq,b.bT,b.T3,k.wT,C.rl,F.VO,_.qT,_.BC,_.cb,_.l_,_.j4,I.U9,E.x,O.wp],encapsulation:2}),s})()}}]);