"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[4596],{71069:(O,v,c)=>{c.d(v,{Z:()=>p});var m=c(69862),S=c(65592),E=c(61713),u=c(65879),M=c(46558),k=c(82228),_=c(77757);let p=(()=>{class d{replaceImageInContent(t){return new S.y(e=>{if(t.includes("<img ")){var a=this.findAllSubString(t,"<img"),r=[],n=[];a.forEach(o=>{var i=t.indexOf("src=",o),l=t.indexOf('"',Number(i)+5),s=t.substring(Number(i)+5,Number(l)+1);s.includes(";base64")?r.push({oldUrl:s}):s.includes("blob:")&&n.push({oldUrl:s})}),r.length>0?this.reUploadBase64File(r,(o,i)=>{null==i?n&&n.length>0?this.reUploadBlobFile(n,(l,s)=>{null!=s?(t=this.replaceHomeworkContent(t,o),t=this.replaceHomeworkContent(t,l),e.next({errorMessage:void 0,content:t}),e.complete()):(e.next({errorMessage:s,content:t}),e.complete())}):(t=this.replaceHomeworkContent(t,o),e.next({errorMessage:void 0,content:t}),e.complete()):(e.next({errorMessage:i,content:t}),e.complete())}):n.length>0?this.reUploadBlobFile(n,(o,i)=>{null==i?(t=this.replaceHomeworkContent(t,o),e.next({errorMessage:void 0,content:t}),e.complete()):(e.next({errorMessage:i,content:t}),e.complete())}):(t=this.replaceHomeworkContent(t,[]),e.next({errorMessage:void 0,content:t}),e.complete())}else e.next({errorMessage:void 0,content:t}),e.complete()})}replaceHomeworkContent(t,e){return e.length>0&&e.forEach(a=>{t=t.replace(a.oldUrl??"  ",a.newUrl+'" class="w-100 img-fluid"')}),t}findAllSubString(t,e){for(var a=0,r=0,n=[];t.indexOf(e,a)>-1;)r=t.indexOf(e,a),n.push(r),a=r+e.length;return n}getTypeFile(t){var e=t.indexOf(";");return t.substring(5,e)}getFileName(t){var e=t.split("").reverse().join(""),a=e.indexOf(";"),r=e.indexOf("/",a);return e.substring(a,r).split("").reverse().join("")}convertBlobToBase64(t){return new Promise(e=>{var a=new Image;a.crossOrigin="Anonymous",a.addEventListener("load",function(){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=a.width,r.height=a.height,n?.drawImage(a,0,0);var o=r.toDataURL("image/png");e(o)},!1),a.src=t})}reUploadBase64File(t,e){if(t&&t.length>0){let o,n=t.length;for(var a=[],r=0;r<t.length;r++){const i=t[r],l=i.oldUrl?.substring(0,i.oldUrl.length-1);this.startUploadBlobFile(i,l??"",[],(s,g)=>{null==g?a=a.concat(s):o=g,n-=1,0==n&&e(a,o)})}}else e([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(t,e){if(t&&t.length>0){let o,n=t.length;for(var a=[],r=0;r<t.length;r++){const i=t[r],l=i?.oldUrl?.substring(0,i.oldUrl.length-1);this.convertBlobToBase64(l??"").then(s=>{this.startUploadBlobFile(i,s,[],(g,h)=>{null==h?a=a.concat(g):o=h,n-=1,0==n&&e(a,o)})})}}else e([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(t,e,a,r){if(e&&""!=e){var n=this.getTypeFile(e),o=this.myPdfService.b64toFile(e,this.getFileName(n),n);(0,E.hv)(o).then(i=>{this.apiUploadService.uploadToCdnForHomework(i).subscribe(l=>{if(l.type!=m.dt.UploadProgress)if(1==l.success){var s={...t,newUrl:l.data?.url??""};a.push(s),r(a,void 0)}else r(a,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",l.message??"none"))})})}else r(a,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(t,e,a){this.commonService=t,this.apiUploadService=e,this.myPdfService=a}}return d.\u0275fac=function(t){return new(t||d)(u.LFG(M.z),u.LFG(k.W),u.LFG(_.z))},d.\u0275prov=u.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},61325:(O,v,c)=>{c.d(v,{$:()=>p});var m=c(69862),S=c(65592),E=c(61713),u=c(65879),M=c(46558),k=c(82228),_=c(77757);let p=(()=>{class d{replaceImageInContent(t,e){return new S.y(a=>{if(e.includes("<img ")){var r=this.findAllSubString(e,"<img"),n=[],o=[];r.forEach(i=>{var l=e.indexOf("src=",i),s=e.indexOf('"',Number(l)+5),g=e.substring(Number(l)+5,Number(s)+1);g.includes(";base64")?n.push({oldUrl:g}):g.includes("blob:")&&o.push({oldUrl:g})}),n.length>0?this.reUploadBase64File(t,n,(i,l)=>{null==l?o&&o.length>0?this.reUploadBlobFile(t,o,(s,g)=>{null!=g?(e=this.replaceHomeworkContent(e,i),e=this.replaceHomeworkContent(e,s),a.next({errorMessage:void 0,content:e}),a.complete()):(a.next({errorMessage:g,content:e}),a.complete())}):(e=this.replaceHomeworkContent(e,i),a.next({errorMessage:void 0,content:e}),a.complete()):(a.next({errorMessage:l,content:e}),a.complete())}):o.length>0?this.reUploadBlobFile(t,o,(i,l)=>{null==l?(e=this.replaceHomeworkContent(e,i),a.next({errorMessage:void 0,content:e}),a.complete()):(a.next({errorMessage:l,content:e}),a.complete())}):(e=this.replaceHomeworkContent(e,[]),a.next({errorMessage:void 0,content:e}),a.complete())}else a.next({errorMessage:void 0,content:e}),a.complete()})}replaceHomeworkContent(t,e){return e.length>0&&e.forEach(a=>{t=t.replace(a.oldUrl??"  ",a.newUrl+'" class="w-100 img-fluid"')}),t}findAllSubString(t,e){for(var a=0,r=0,n=[];t.indexOf(e,a)>-1;)r=t.indexOf(e,a),n.push(r),a=r+e.length;return n}getTypeFile(t){var e=t.indexOf(";");return t.substring(5,e)}getFileName(t){var e=t.split("").reverse().join(""),a=e.indexOf(";"),r=e.indexOf("/",a);return e.substring(a,r).split("").reverse().join("")}convertBlobToBase64(t){return new Promise(e=>{var a=new Image;a.crossOrigin="Anonymous",a.addEventListener("load",function(){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=a.width,r.height=a.height,n?.drawImage(a,0,0);var o=r.toDataURL("image/png");e(o)},!1),a.src=t})}reUploadBase64File(t,e,a){if(e&&e.length>0){let i,o=e.length;for(var r=[],n=0;n<e.length;n++){const l=e[n],s=l.oldUrl?.substring(0,l.oldUrl.length-1);this.startUploadBlobFile(t,l,s??"",[],(g,h)=>{null==h?r=r.concat(g):i=h,o-=1,0==o&&a(r,i)})}}else a([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(t,e,a){if(e&&e.length>0){let i,o=e.length;for(var r=[],n=0;n<e.length;n++){const l=e[n],s=l?.oldUrl?.substring(0,l.oldUrl.length-1);this.convertBlobToBase64(s??"").then(g=>{this.startUploadBlobFile(t,l,g,[],(h,x)=>{null==x?r=r.concat(h):i=x,o-=1,0==o&&a(r,i)})})}}else a([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(t,e,a,r,n){if(a&&""!=a){var o=this.getTypeFile(a),i=this.myPdfService.b64toFile(a,this.getFileName(o),o);(0,E.hv)(i).then(l=>{this.apiUploadService.commonUploadFile(t,l,"").subscribe(s=>{if(s.type!=m.dt.UploadProgress)if(1==s.success){var g={...e,newUrl:s.data?.url??""};r.push(g),n(r,void 0)}else n(r,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",s.message??"none"))})})}else n(r,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(t,e,a){this.commonService=t,this.apiUploadService=e,this.myPdfService=a}}return d.\u0275fac=function(t){return new(t||d)(u.LFG(M.z),u.LFG(k.W),u.LFG(_.z))},d.\u0275prov=u.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},28368:(O,v,c)=>{c.d(v,{y:()=>k});var m=c(65879),S=c(88489);let E=(()=>{class _{getMode(){return""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light"}constructor(d){this.browserStorageService=d}}return _.\u0275fac=function(d){return new(d||_)(m.LFG(S.n))},_.\u0275prov=m.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})();var u=c(46558),M=c(61325);let k=(()=>{class _{constructor(d,f,t){this.darkModeService=d,this.commonService=f,this.sAztUploadImageOfExamService=t}initConfigForAdmin(){var t={};return t={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["code","fullscreen","link"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | link | code | fullscreen"},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForTeacher(){var t={};return t={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["fullscreen"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | fullscreen"},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigTeacherHomework(d){var e={};return e={min_height:d,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"| fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:"@font-face { font-family: font_chu_dep; src: url('https://cdn.jsdelivr.net/gh/azota889/storage_public/azota_assets/fonts/HP0015HB.ttf');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};"},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}initConfigStudentHomework(){var t={};return t={height:450,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",readonly:1,plugins:["emoticons advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | emoticons",emoticons_database:"emojis",content_style:"@font-face { font-family: font_chu_dep; src: url('https://cdn.jsdelivr.net/gh/azota889/storage_public/azota_assets/fonts/HP0015HB.ttf');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};"},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForTeacherWithUploadImageBox(d){var e={};return e={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen",toolbar:"| fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,file_picker_callback:(a,r,n)=>{this.file_picker_callback(d,a,r,n)}},"dark"==this.darkModeService.getMode()&&(e.skin="oxide-dark",e.content_css="dark"),e}file_picker_callback(d,f,t,e){let a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("accept","image/*"),a.onchange=()=>{let r=a.files?.[0],n=new FileReader;n.onload=()=>{let i=`<img src="${"data:image/png;base64, "+n.result.split(",")[1]}">`;this.sAztUploadImageOfExamService.replaceImageInContent(d,i).subscribe(l=>{if(l.errorMessage)this.commonService.snackError(l.errorMessage);else{let s=document.createElement("div");s.innerHTML=this.commonService.removeXssInHtml(l.content);let g=s.firstChild;g&&g.src&&f(g.src)}})},n.readAsDataURL(r)},a.click()}}return _.\u0275fac=function(d){return new(d||_)(m.LFG(E),m.LFG(u.z),m.LFG(M.$))},_.\u0275prov=m.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()}}]);