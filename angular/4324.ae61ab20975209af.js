(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[4324],{32586:(De,it,w)=>{"use strict";w.d(it,{Y:()=>gt});var j=w(59640),Z=w(64198),rt=w(26860);let gt=(()=>{var t;class yt extends j.H{constructor(){super(...arguments),this.limitSize=200,this.selectFile=wt=>{const nt=wt.target,mt=nt.files;if(mt){if(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(mt).find(U=>(0,Z.hD)(U.size)>=this.limitSize))return this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB"));const st=[];Array.from(mt).forEach(U=>{st.push(U)}),this.emitUploadToEditorComplete(st)}nt.value=""}}}return(t=yt).\u0275fac=function(){let ut;return function(nt){return(ut||(ut=rt.xGo(t)))(nt||t)}}(),t.\u0275cmp=rt.VBU({type:t,selectors:[["ng-component"]],inputs:{fileType:"fileType",limitSize:"limitSize"},features:[rt.Vt3],decls:0,vars:0,template:function(wt,nt){},encapsulation:2}),yt})()},64324:(De,it,w)=>{"use strict";w.r(it),w.d(it,{AzotaDigitalizeModule:()=>It});var j=w(54460),Z=w(10936),rt=w(65162),gt=w(69223),t=w(26860),yt=w(17715);const ut=["image"];function wt(n,C){1&n&&(t.j41(0,"div",6),t.nrm(1,"div",7),t.k0s())}function nt(n,C){if(1&n&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&n){const h=t.XpG();t.R7$(1),t.JRh(h.loadImageErrorText)}}let qt=(()=>{class n{constructor(){this.cropperOptions={},this.export=new t.bkB,this.ready=new t.bkB,this.isLoading=!0}ngOnInit(){}ngOnDestroy(){this.cropper&&(this.cropper.destroy(),this.cropper=null)}imageLoaded(h){this.loadError=!1;const l=h.target;this.imageElement=l,this.cropperOptions.checkCrossOrigin&&(l.crossOrigin="anonymous"),l.addEventListener("ready",()=>{this.ready.emit(!0),this.isLoading=!1,this.cropbox&&this.cropper.setCropBoxData(this.cropbox)});let p=NaN;if(this.settings){const{width:m,height:v}=this.settings;p=m/v}this.cropperOptions={aspectRatio:p,checkCrossOrigin:!0,...this.cropperOptions},this.cropper&&(this.cropper.destroy(),this.cropper=void 0),this.cropper=new yt(l,this.cropperOptions)}imageLoadError(h){this.loadError=!0,this.isLoading=!1}exportCanvas(h){const l=this.cropper.getImageData(),p=this.cropper.getCropBoxData(),m=this.cropper.getCroppedCanvas(),v={imageData:l,cropData:p};new Promise(z=>{if(h)return z({dataUrl:m.toDataURL("image/png")});m.toBlob(F=>z({blob:F}))}).then(z=>{this.export.emit({...v,...z})})}}return n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["angular-cropper"]],viewQuery:function(h,l){if(1&h&&t.GBs(ut,7),2&h){let p;t.mGM(p=t.lsd())&&(l.image=p.first)}},inputs:{imageUrl:"imageUrl",settings:"settings",cropbox:"cropbox",loadImageErrorText:"loadImageErrorText",cropperOptions:"cropperOptions"},outputs:{export:"export",ready:"ready"},decls:6,vars:3,consts:[[1,"cropper-wrapper"],["class","loading-block",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"cropper"],["alt","image",3,"src","load","error"],["image",""],[1,"loading-block"],[1,"spinner"],[1,"alert","alert-warning"]],template:function(h,l){1&h&&(t.j41(0,"div",0),t.DNE(1,wt,2,0,"div",1),t.DNE(2,nt,2,1,"div",2),t.j41(3,"div",3)(4,"img",4,5),t.bIt("load",function(m){return l.imageLoaded(m)})("error",function(m){return l.imageLoadError(m)}),t.k0s()()()),2&h&&(t.R7$(1),t.Y8G("ngIf",l.isLoading),t.R7$(1),t.Y8G("ngIf",l.loadError),t.R7$(2),t.Y8G("src",l.imageUrl,t.B4B))},dependencies:[j.bT],styles:[':host{display:block}.cropper img{max-width:100%;max-height:100%;height:auto}.cropper-wrapper{position:relative;min-height:80px}.cropper-wrapper .loading-block{position:absolute;top:0;left:0;width:100%;height:100%}.cropper-wrapper .loading-block .spinner{width:31px;height:31px;margin:0 auto;border:2px solid rgba(97,100,193,.98);border-radius:50%;border-left-color:transparent;border-right-color:transparent;-webkit-animation:cssload-spin 425ms infinite linear;position:absolute;top:calc(50% - 15px);left:calc(50% - 15px);animation:cssload-spin 425ms infinite linear}@keyframes cssload-spin{to{transform:rotate(360deg)}}/*!\n * Cropper.js v1.4.1\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2018-07-15T09:54:43.167Z\n */.cropper-container{direction:ltr;font-size:0;line-height:0;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cropper-container img{display:block;height:100%;image-orientation:0deg;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;width:100%}.cropper-wrap-box,.cropper-canvas,.cropper-drag-box,.cropper-crop-box,.cropper-modal{inset:0;position:absolute}.cropper-wrap-box,.cropper-canvas{overflow:hidden}.cropper-drag-box{background-color:#fff;opacity:0}.cropper-modal{background-color:#000;opacity:.5}.cropper-view-box{display:block;height:100%;outline-color:#3399ffbf;outline:1px solid #39f;overflow:hidden;width:100%}.cropper-dashed{border:0 dashed #eee;display:block;opacity:.5;position:absolute}.cropper-dashed.dashed-h{border-bottom-width:1px;border-top-width:1px;height:calc(100% / 3);left:0;top:calc(100% / 3);width:100%}.cropper-dashed.dashed-v{border-left-width:1px;border-right-width:1px;height:100%;left:calc(100% / 3);top:0;width:calc(100% / 3)}.cropper-center{display:block;height:0;left:50%;opacity:.75;position:absolute;top:50%;width:0}.cropper-center:before,.cropper-center:after{background-color:#eee;content:" ";display:block;position:absolute}.cropper-center:before{height:1px;left:-3px;top:0;width:7px}.cropper-center:after{height:7px;left:0;top:-3px;width:1px}.cropper-face,.cropper-line,.cropper-point{display:block;height:100%;opacity:.1;position:absolute;width:100%}.cropper-face{background-color:#fff;left:0;top:0}.cropper-line{background-color:#39f}.cropper-line.line-e{cursor:ew-resize;right:-3px;top:0;width:5px}.cropper-line.line-n{cursor:ns-resize;height:5px;left:0;top:-3px}.cropper-line.line-w{cursor:ew-resize;left:-3px;top:0;width:5px}.cropper-line.line-s{bottom:-3px;cursor:ns-resize;height:5px;left:0}.cropper-point{background-color:#39f;height:5px;opacity:.75;width:5px}.cropper-point.point-e{cursor:ew-resize;margin-top:-3px;right:-3px;top:50%}.cropper-point.point-n{cursor:ns-resize;left:50%;margin-left:-3px;top:-3px}.cropper-point.point-w{cursor:ew-resize;left:-3px;margin-top:-3px;top:50%}.cropper-point.point-s{bottom:-3px;cursor:s-resize;left:50%;margin-left:-3px}.cropper-point.point-ne{cursor:nesw-resize;right:-3px;top:-3px}.cropper-point.point-nw{cursor:nwse-resize;left:-3px;top:-3px}.cropper-point.point-sw{bottom:-3px;cursor:nesw-resize;left:-3px}.cropper-point.point-se{bottom:-3px;cursor:nwse-resize;height:20px;opacity:1;right:-3px;width:20px}@media (min-width: 768px){.cropper-point.point-se{height:15px;width:15px}}@media (min-width: 992px){.cropper-point.point-se{height:10px;width:10px}}@media (min-width: 1200px){.cropper-point.point-se{height:5px;opacity:.75;width:5px}}.cropper-point.point-se:before{background-color:#39f;bottom:-50%;content:" ";display:block;height:200%;opacity:0;position:absolute;right:-50%;width:200%}.cropper-invisible{opacity:0}.cropper-bg{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC)}.cropper-hide{display:block;height:0;position:absolute;width:0}.cropper-hidden{display:none!important}.cropper-move{cursor:move}.cropper-crop{cursor:crosshair}.cropper-disabled .cropper-drag-box,.cropper-disabled .cropper-face,.cropper-disabled .cropper-line,.cropper-disabled .cropper-point{cursor:not-allowed}\n'],encapsulation:2}),n})(),st=(()=>{class n{}return n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[j.MD]}),n})();var U=w(15343),Lt=w(10123),xt=w(5502),I=w(46584),Ft=w(70050),te=w(7050),ee=w(91100),Yt=w(43234),ct=w(1133),lt=w(52909),q=w(59640),V=w(73014),Ot=w(85710),L=w(73437),Dt=w(25693),Et=w(5849);let kt=(()=>{var n;class C{constructor(){this.subscriptions=new Ot.yU,this.ocrService=(0,t.WQX)(Et.so),this.commonService=(0,t.WQX)(Dt.R)}digitalizeData(l,p,m,v){if(!l.image.url)return v(l);p("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:l.image.url}).subscribe({next:x=>{p("lang_digitalize_load_detect_image_script"),this.loadScriptHandleImage(()=>{p("lang_digitalize_call_detect_image_function"),this.imageUtils.detectImage(l.image.fileBytes).then(z=>v(this.replaceOrcData(l,x,z.images))).catch(z=>v(this.replaceOrcData(l,x,[])))})},error:x=>m(x.error.message)}))}uint8ArrayToBase64(l){let p="";const m=l.byteLength;for(let v=0;v<m;v++)p+=String.fromCharCode(l[v]);return btoa(p)}replaceOrcData(l,p,m){l.image.base64Images=m.map(z=>({base64:this.uint8ArrayToBase64(new Uint8Array(z.content)),width:z.width,height:z.height,extension:z.extension}));let v=p.data,x={};return[v,x]=this.commonService.extractOriginDataOfLatex(v),v=(new L.bt).transform((new L.UN).transform(v)),v=this.commonService.replaceBackToOriginDataOfLatex(v,x),v=this.commonService.convertLatexTagToDollarDollar(v),v=this.commonService.replaceAll(v,"<table>","<table class='table table-bordered'>")??v,l.htmlResult=v,l}waitAnswerSheetInitDone(l){if(window.azotaScanAnswerSheet)return l();setTimeout(()=>{this.waitAnswerSheetInitDone(l)},100)}loadScriptHandleImage(l){var p=this;if(this.imageUtils)return l();this.commonService.loadAnswerSheetJs().then((0,V.A)(function*(){p.waitAnswerSheetInitDone((0,V.A)(function*(){p.imageUtils=yield window.azotaScanAnswerSheet.imageUtils(),l()}))})).catch(m=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),l()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(n=C).\u0275fac=function(l){return new(l||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),C})();var $=function(n){return n[n.NONE=0]="NONE",n[n.PROCESSING=1]="PROCESSING",n[n.PROCESS_ERROR=2]="PROCESS_ERROR",n[n.PROCESSED=3]="PROCESSED",n}($||{}),k=function(n){return n[n.CHOOSE_IMAGES=0]="CHOOSE_IMAGES",n[n.PROCESS_IMAGES=1]="PROCESS_IMAGES",n}(k||{}),Xt=w(18718),Ee=w(96451),Bt=w(64198),zt=w(39712),At=w(63709),Nt=w(14159),$t=w(27035),ie=w(17178),ae=w(63016),Pt=w(47947),Vt=w(20036),Gt=w(15351);const oe=(n,C)=>(n.push(C),n);let Ae=(()=>{var n;class C{processObservables(l,p){return(0,Nt.H)(p).pipe((0,$t.Z)((m,v)=>m.pipe((0,ie.W)(x=>(console.error("Error in observable:",x),(0,ae.of)(null))),(0,Pt.T)(x=>({result:x,index:v}))),l),function ze(){return(0,Gt.N)((n,C)=>{(function Ht(n,C){return(0,Gt.N)((0,Vt.S)(n,C,arguments.length>=2,!1,!0))})(oe,[])(n).subscribe(C)})}(),(0,Pt.T)(m=>m.sort((v,x)=>v.index-x.index).map(v=>v.result)))}}return(n=C).\u0275fac=function(l){return new(l||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),C})();var Se=w(41426),re=w(32586),ne=w(34068);const se=["*"];let ce=(()=>{var n;class C extends re.Y{constructor(){super(...arguments),this.emitFiles=new t.bkB}emitUploadToEditorComplete(l){l.length>0&&this.emitFiles.emit(l)}onDrop(l){try{this.emitFiles.emit(l)}catch(p){alert(p)}}}return(n=C).\u0275fac=function(){let h;return function(p){return(h||(h=t.xGo(n)))(p||n)}}(),n.\u0275cmp=t.VBU({type:n,selectors:[["azt-upload-multiple-document-to-editor"]],outputs:{emitFiles:"emitFiles"},features:[t.Vt3],ngContentSelectors:se,decls:5,vars:2,consts:[[1,"upload-document","h-full",3,"appDropZone","click"],[3,"hidden"],["type","file","multiple","",1,"form-control","file-input",3,"accept","change"],["fileSelect",""]],template:function(l,p){if(1&l){const m=t.RV6();t.NAR(),t.j41(0,"div",0),t.bIt("appDropZone",function(x){return p.onDrop(x)})("click",function(){t.eBV(m);const x=t.sdS(3);return t.Njj(x.click())}),t.j41(1,"form",1)(2,"input",2,3),t.bIt("change",function(x){return p.selectFile(x)}),t.k0s()(),t.SdG(4),t.k0s()}2&l&&(t.R7$(1),t.Y8G("hidden",!0),t.R7$(1),t.FS9("accept",p.fileType))},dependencies:[Z.qT,Z.cb,Z.cV,ne.F],encapsulation:2}),C})();function le(n,C){if(1&n&&t.nrm(0,"azt-loading-effect",2),2&n){const h=t.XpG();t.Y8G("currentStatusObj",h.statusObj)("customText",h.statusObj.errorMessage)}}const he=function(n,C){return[n,C]},Wt=function(){return{"mr-2":!0}};function pe(n,C){if(1&n){const h=t.RV6();t.j41(0,"azt-upload-multiple-document-to-editor",3),t.bIt("emitFiles",function(p){t.eBV(h);const m=t.XpG();return t.Njj(m.handleUploadComplete(p))}),t.j41(1,"a",4),t.nrm(2,"lucide-icon",5),t.j41(3,"span"),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()()}if(2&n){const h=t.XpG();t.Y8G("fileType",t.l_i(5,he,h.allUploadFileTypes.PDF,h.allUploadFileTypes.IMAGE)),t.R7$(2),t.Y8G("ngClass",t.lJ4(8,Wt)),t.R7$(2),t.JRh(t.bMT(5,3,"lang_digitalize_book_upload_file"))}}let Ie=(()=>{var n;class C extends q.H{handleUploadComplete(l){this.initStatusObj("lang_digitalize_convert_pdf_to_images"),this.convertAllPdfToImages(l).then(p=>{let m=[];p.forEach(v=>{let x=this.apiUploadService.commonUploadFile(this.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE,v,"");m.push(x)}),this.initStatusObj("lang_digitalize_upload_images_to_cdn"),this.sAztConcurrencyApiService.processObservables(this.uploadThread,m).subscribe(v=>{if(v.find(W=>!W?.success))return this.errorStatusObj("lang_digitalize_book_upload_file_error",!0);let z=[],F=v.map(W=>W?.data).filter(this.commonService.notEmpty),Tt=p.map(W=>this.convertFileToUint8Array(W));this.initStatusObj("lang_digitalize_convert_file_to_byte_array"),Promise.all(Tt).then(W=>{F.forEach((we,Zt)=>{let xe=this.commonService.getItemAtIndexOfArray(W,Zt);if(null==xe)throw Error("lang_digitalize_missing_file_byte_array");z.push({...we,fileBytes:xe,base64Images:[]})}),this.stopStatusObj(),this.uploadData.emit(z)}).catch(W=>console.error("lang_digitalize_convert_to_uint8_array_error: ",W))})})}convertAllPdfToImages(l){var p=this;let m=[];return l.forEach(v=>{if((0,Bt.wu)(v.type))return void m.push(new Promise(function(){var z=(0,V.A)(function*(F,Tt){F([v])});return function(F,Tt){return z.apply(this,arguments)}}()));let x=new Promise(function(){var z=(0,V.A)(function*(F,Tt){let W=[],Zt=yield p.withTimeout(p.myPdfService.getImageWithPdf(v),3e5);W.push(...Zt),F(W)});return function(F,Tt){return z.apply(this,arguments)}}());m.push(x)}),new Promise(function(){var v=(0,V.A)(function*(x,z){Promise.all(m).then(F=>{x(p.commonService.concatMultipleArray(F))}).catch(F=>{p.showErrorSnack("lang_azt_pdf_invalid_format"),x([])})});return function(x,z){return v.apply(this,arguments)}}())}withTimeout(l,p){return new Promise((m,v)=>{const x=setTimeout(()=>{v(new Error("Operation timed out"))},p);l.then(z=>{clearTimeout(x),m(z)}).catch(z=>{clearTimeout(x),v(z)})})}convertFileToUint8Array(l){return new Promise((p,m)=>{const v=new FileReader;v.onload=()=>{if(v.result instanceof ArrayBuffer){const x=new Uint8Array(v.result);p(x)}else m(new Error("Error reading file as ArrayBuffer."))},v.onerror=()=>{m(new Error("Error reading file."))},v.readAsArrayBuffer(l)})}ngOnInit(){super.ngOnInit()}constructor(l,p,m){super(),this.myPdfService=l,this.sAztConcurrencyApiService=p,this.apiUploadService=m,this.uploadData=new t.bkB,this.allUploadToCdnMenuTypes=zt.b8,this.allUploadFileTypes=zt.PO,this.uploadThread=10}}return(n=C).\u0275fac=function(l){return new(l||n)(t.rXU(At.C),t.rXU(Ae),t.rXU(Se.T))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalize-pdf-to-images"]],outputs:{uploadData:"uploadData"},features:[t.Vt3],decls:3,vars:2,consts:[[3,"currentStatusObj","customText",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj","customText"],[3,"fileType","emitFiles"],[1,"btn","btn-primary-soft","w-full"],["name","plus","size","16",3,"ngClass"]],template:function(l,p){if(1&l&&(t.DNE(0,le,1,2,"azt-loading-effect",0),t.DNE(1,pe,6,9,"ng-template",null,1,t.C5r)),2&l){const m=t.sdS(2);t.Y8G("ngIf",p.statusObj.loading)("ngIfElse",m)}},dependencies:[j.YU,j.bT,Xt.K,ce,U.WGl,L.wp],encapsulation:2}),C})();const Te=function(n){return{"mb-2":n}},Re=function(n){return{"border-pending":n}};function Me(n,C){if(1&n){const h=t.RV6();t.j41(0,"div",4)(1,"span",5),t.EFF(2),t.k0s(),t.j41(3,"img",6),t.bIt("click",function(){const m=t.eBV(h).$implicit,v=t.XpG();return t.Njj(v.chooseImageEvent(m))}),t.k0s()()}if(2&n){const h=C.$implicit,l=C.last,p=t.XpG();t.Y8G("ngClass",t.eq3(4,Te,!l)),t.R7$(2),t.JRh(h.position),t.R7$(1),t.Y8G("src",h.image.url,t.B4B)("ngClass",t.eq3(6,Re,p.listSelectedUuids.includes(h.uuid)))}}let de=(()=>{var n;class C extends q.H{chooseImageEvent(l){let p=this.objs.find(m=>m.uuid==l.uuid);p&&(p.isSelected=!p.isSelected,this.listSelectedUuids=this.objs.filter(m=>m.isSelected).map(m=>m.uuid),this.chooseImages.emit(this.objs.filter(m=>m.isSelected)))}ngOnChanges(){this.listSelectedUuids=this.objs.filter(l=>l.isSelected).map(l=>l.uuid)}ngOnInit(){super.ngOnInit()}constructor(){super(),this.chooseImages=new t.bkB,this.listSelectedUuids=[]}}return(n=C).\u0275fac=function(l){return new(l||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalize-choose-images"]],inputs:{objs:"objs"},outputs:{chooseImages:"chooseImages"},features:[t.Vt3,t.OA$],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(l,p){1&l&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"ng-scrollbar",2),t.DNE(5,Me,4,8,"div",3),t.k0s()()),2&l&&(t.R7$(2),t.Lme("",t.bMT(3,4,"lang_digitalize_book_total_page"),": ",p.objs.length,""),t.R7$(2),t.Y8G("visibility","hover"),t.R7$(1),t.Y8G("ngForOf",p.objs))},dependencies:[j.YU,j.Sq,xt.Yh,L.wp],encapsulation:2}),C})();const ge=function(n){return{"mb-2":n}},ue=function(n){return{"border-pending":n}};function je(n,C){if(1&n){const h=t.RV6();t.j41(0,"div",4)(1,"span",5),t.EFF(2),t.k0s(),t.j41(3,"img",6),t.bIt("click",function(){const m=t.eBV(h).$implicit,v=t.XpG();return t.Njj(v.processImage.emit(m))}),t.k0s()()}if(2&n){const h=C.$implicit,l=C.last,p=t.XpG();t.Y8G("ngClass",t.eq3(4,ge,!l)),t.R7$(2),t.JRh(h.position),t.R7$(1),t.Y8G("src",h.image.url,t.B4B)("ngClass",t.eq3(6,ue,(null==p.currentObj?null:p.currentObj.uuid)==h.uuid))}}let ke=(()=>{var n;class C extends q.H{ngOnInit(){super.ngOnInit(),this.viewObjs=this.objs.filter(l=>l.isSelected)}constructor(){super(),this.processImage=new t.bkB,this.viewObjs=[]}}return(n=C).\u0275fac=function(l){return new(l||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalize-process-images"]],inputs:{objs:"objs",currentObj:"currentObj"},outputs:{processImage:"processImage"},features:[t.Vt3],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(l,p){1&l&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"ng-scrollbar",2),t.DNE(5,je,4,8,"div",3),t.k0s()()),2&l&&(t.R7$(2),t.Lme("",t.bMT(3,4,"lang_digitalize_book_total_page"),": ",p.viewObjs.length,""),t.R7$(2),t.Y8G("visibility","hover"),t.R7$(1),t.Y8G("ngForOf",p.viewObjs))},dependencies:[j.YU,j.Sq,xt.Yh,L.wp],encapsulation:2}),C})();var O=w(46899),me=w(70254),Ut=w(89163),ht=w(33887);const Be=["angularCropper"];function ft(n,C){if(1&n){const h=t.RV6();t.qex(0),t.j41(1,"img",9),t.bIt("click",function(){const m=t.eBV(h).$implicit,v=t.XpG(2);return t.Njj(v.chooseImage(m))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&n){const h=C.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,h.base64,"png"),t.B4B)}}function X(n,C){if(1&n&&(t.j41(0,"div",7),t.DNE(1,ft,3,4,"ng-container",8),t.k0s()),2&n){const h=t.XpG();t.R7$(1),t.Y8G("ngForOf",h.base64Images)}}function Ne(n,C){if(1&n&&(t.nrm(0,"angular-cropper",10,11),t.nI1(2,"addBase64Extension")),2&n){const h=t.XpG();t.Y8G("cropperOptions",h.cropperOptions)("imageUrl",t.i5U(2,2,h.currentBase64Image.base64,"png"))}}let fe=(()=>{var n;class C extends ht._{chooseImage(l){this.currentBase64Image=l}cropImage(){this.angularCropper?.cropper.getCroppedCanvas().toBlob(l=>{l&&this.commonService.convertBlobToBase64(l,p=>{let m=this.angularCropper?.cropper.getCropBoxData(),v=m?.width,x=m?.height;!v||!x||this.base64Images.push({position:this.base64Images.length,base64:p,width:v,height:x,extension:"png"})})})}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(l,p){super(p,l),this.dialogRef=l,this.data=p,this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=p.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return(n=C).\u0275fac=function(l){return new(l||n)(t.rXU(Ut.CP,8),t.rXU(Ut.Vh,8))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-coazt-image-editor"]],viewQuery:function(l,p){if(1&l&&t.GBs(Be,5),2&l){let m;t.mGM(m=t.lsd())&&(p.angularCropper=m.first)}},features:[t.Vt3],decls:11,vars:8,consts:[[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2","w-32",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"],[3,"cropperOptions","imageUrl"],["angularCropper",""]],template:function(l,p){1&l&&(t.j41(0,"div",0),t.DNE(1,X,2,1,"div",1),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return p.cropImage()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",4),t.bIt("click",function(){return p.closeDialog()}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()(),t.j41(9,"div",5),t.DNE(10,Ne,3,5,"angular-cropper",6),t.k0s()()),2&l&&(t.R7$(1),t.Y8G("ngIf",p.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,4,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(8,6,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",p.currentBase64Image))},dependencies:[j.Sq,j.bT,qt,L.wp,L.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]}),C})();function M(n,C){if(1&n){const h=t.RV6();t.qex(0),t.j41(1,"img",8),t.bIt("click",function(){const m=t.eBV(h).$implicit,v=t.XpG(2);return t.Njj(v.chooseImage(m))}),t.nI1(2,"addBase64Extension"),t.k0s(),t.bVm()}if(2&n){const h=C.$implicit;t.R7$(1),t.FS9("src",t.i5U(2,1,h.base64,h.extension),t.B4B)}}function T(n,C){if(1&n&&(t.j41(0,"div",6),t.DNE(1,M,3,4,"ng-container",7),t.k0s()),2&n){const h=t.XpG();t.R7$(1),t.Y8G("ngForOf",h.obj.image.base64Images)}}function Pe(n,C){if(1&n&&(t.j41(0,"div",9),t.nrm(1,"editor",10)(2,"hr",11)(3,"div",12),t.nI1(4,"safeNormalHtmlContent"),t.nI1(5,"async"),t.nI1(6,"mathJaxContent"),t.k0s()),2&n){const h=t.XpG();t.R7$(1),t.FS9("apiKey",h.tinyEditorKey),t.Y8G("formControl",h.htmlFormControl)("init",h.initDataEditor),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(2),t.Y8G("innerHTML",t.bMT(4,5,t.bMT(5,7,t.bMT(6,9,h.obj.htmlResult))),t.npT)}}let vt=(()=>{var n;class C extends q.H{constructor(){super(...arguments),this.changeObj=new t.bkB,this.sAztDialogService=(0,t.WQX)(O.i),this.tinyMceService=(0,t.WQX)(me.f),this.sAztDigitalizeService=(0,t.WQX)(kt),this.htmlFormControl=new Z.MJ("",{nonNullable:!0}),this.initDataEditor={},this.tinyEditorKey=Yt.c.tinyEditorKey,this.showTinyMceEditor=!1,this.reRenderComponent=void 0}chooseImage(l){this.obj.htmlResult=this.obj.htmlResult.replace("<img>",`<img src='${this.commonService.generateBase64Prefix(l.extension)+l.base64}'/>`),this.htmlFormControl.setValue(this.obj.htmlResult)}cropImageDialog(){let l=[{position:-1,base64:this.sAztDigitalizeService.uint8ArrayToBase64(new Uint8Array(this.obj.image.fileBytes)),width:100,height:100,extension:"png"}],p=this.obj.image.base64Images.map((v,x)=>({...v,position:x}));l=l.concat(p),this.sAztDialogService.open(fe,{data:{base64Images:l},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(v=>{null!=v&&(this.obj.image.base64Images=v.slice(1),this.changeObj.emit(this.obj))})}ngOnChanges(){console.log("On change value"),this.reRenderComponent=void 0,this.htmlFormControl.setValue(this.obj.htmlResult),setTimeout(()=>this.reRenderComponent="OK",0)}ngOnInit(){this.htmlFormControl.valueChanges.subscribe(()=>{this.obj.htmlResult=this.htmlFormControl.getRawValue(),this.changeObj.emit(this.obj)}),this.initDataEditor=this.tinyMceService.initConfigForAdminForDigitalized(zt.b8.ADMIN)}}return(n=C).\u0275fac=function(){let h;return function(p){return(h||(h=t.xGo(n)))(p||n)}}(),n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalize-preview-result"]],inputs:{obj:"obj"},outputs:{changeObj:"changeObj"},features:[t.Vt3,t.OA$],decls:8,vars:5,consts:[["class","box p-3 mb-3 list-base640-images",4,"ngIf"],[1,"mb-3"],[1,"btn","btn-primary","w-32",3,"click"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-12"],["class","box p-3",4,"ngIf"],[1,"box","p-3","mb-3","list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"src","click"],[1,"box","p-3"],[3,"formControl","apiKey","init"],[1,"mt-8","mb-8"],[3,"innerHTML"]],template:function(l,p){1&l&&(t.DNE(0,T,2,1,"div",0),t.j41(1,"div",1)(2,"span",2),t.bIt("click",function(){return p.cropImageDialog()}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3)(6,"div",4),t.DNE(7,Pe,7,11,"div",5),t.k0s()()),2&l&&(t.Y8G("ngIf",p.obj.image.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(4,3,"lang_button_crop")),t.R7$(4),t.Y8G("ngIf",p.reRenderComponent))},dependencies:[j.Sq,j.bT,Z.BC,gt.xn,Z.l_,j.Jj,L.wp,L.km,L._y,L.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px}"]}),C})();function Ge(n,C){if(1&n&&t.nrm(0,"azt-loading-effect",4),2&n){const h=t.XpG();t.Y8G("currentStatusObj",h.statusObj)}}function at(n,C){if(1&n){const h=t.RV6();t.j41(0,"app-digitalize-pdf-to-images",16),t.bIt("uploadData",function(p){t.eBV(h);const m=t.XpG(2);return t.Njj(m.uploadData(p))}),t.k0s()}}function Ue(n,C){if(1&n){const h=t.RV6();t.j41(0,"div",17),t.bIt("click",function(){t.eBV(h);const p=t.XpG(2);return t.Njj(p.showChooseLayout())}),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()}2&n&&(t.R7$(1),t.JRh(t.bMT(2,1,"lang_digitalize_book_go_back_choose_layout")))}function B(n,C){if(1&n){const h=t.RV6();t.j41(0,"app-digitalize-choose-images",21),t.bIt("chooseImages",function(p){t.eBV(h);const m=t.XpG(3);return t.Njj(m.chooseImages(p))}),t.k0s()}if(2&n){const h=t.XpG(3);t.Y8G("objs",h.objs)}}function tt(n,C){if(1&n){const h=t.RV6();t.j41(0,"app-digitalize-process-images",22),t.bIt("processImage",function(p){t.eBV(h);const m=t.XpG(3);return t.Njj(m.processImage(p))}),t.k0s()}if(2&n){const h=t.XpG(3);t.Y8G("objs",h.objs)("currentObj",h.currentObj)}}function _t(n,C){if(1&n&&(t.j41(0,"div",18),t.DNE(1,B,1,1,"app-digitalize-choose-images",19),t.DNE(2,tt,1,2,"app-digitalize-process-images",20),t.k0s()),2&n){const h=t.XpG(2);t.R7$(1),t.Y8G("ngIf",h.currentLayout==h.allLayouts.CHOOSE_IMAGES),t.R7$(1),t.Y8G("ngIf",h.currentLayout==h.allLayouts.PROCESS_IMAGES)}}function Le(n,C){if(1&n){const h=t.RV6();t.j41(0,"div")(1,"div",12),t.bIt("click",function(){t.eBV(h);const p=t.XpG(3);return t.Njj(p.startProcess())}),t.EFF(2),t.nI1(3,"mytranslate"),t.nI1(4,"mytranslate"),t.k0s()()}if(2&n){const h=t.XpG(3);t.R7$(2),t.E5c("",t.bMT(3,3,"lang_digitalize_book_start_call_orc_api")," (",h.totalSelected," ",t.bMT(4,5,"lang_digitalize_book_total_images"),")")}}function Qt(n,C){1&n&&(t.EFF(0),t.nI1(1,"mytranslate")),2&n&&t.SpI(" ",t.bMT(1,1,"lang_digitalize_book_please_choose_image")," ")}function Jt(n,C){if(1&n&&(t.qex(0),t.j41(1,"div",18),t.DNE(2,Le,5,7,"div",23),t.DNE(3,Qt,2,3,"ng-template",null,24,t.C5r),t.k0s(),t.bVm()),2&n){const h=t.sdS(4),l=t.XpG(2);t.R7$(2),t.Y8G("ngIf",l.totalSelected>0)("ngIfElse",h)}}function St(n,C){if(1&n){const h=t.RV6();t.j41(0,"div")(1,"span",25),t.bIt("click",function(){t.eBV(h);const p=t.XpG(4);return t.Njj(p.processAllAgain())}),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s()()}2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"lang_digitalize_book_call_ocr_all_again")))}function Fe(n,C){if(1&n){const h=t.RV6();t.j41(0,"div")(1,"span",26),t.bIt("click",function(){t.eBV(h);const p=t.XpG(4);return t.Njj(p.processCurrentPageAgain())}),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s()()}2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"lang_digitalize_book_call_ocr_current_page_again")))}function ve(n,C){if(1&n){const h=t.RV6();t.j41(0,"div")(1,"app-digitalize-preview-result",27),t.bIt("changeObj",function(p){t.eBV(h);const m=t.XpG(4);return t.Njj(m.changeObj(p))}),t.k0s()()}if(2&n){const h=t.XpG(4);t.R7$(1),t.Y8G("obj",h.currentObj)}}function _e(n,C){if(1&n&&t.nrm(0,"azt-loading-effect",29),2&n){const h=t.XpG(5);t.Y8G("currentStatusObj",h.processStatusObj)("customText",h.processStatusObj.errorMessage)}}function J(n,C){if(1&n&&(t.j41(0,"div"),t.DNE(1,_e,1,2,"azt-loading-effect",28),t.k0s()),2&n){const h=t.XpG(4);t.R7$(1),t.Y8G("ngIf",h.processStatusObj.loading)}}function H(n,C){if(1&n&&(t.qex(0),t.DNE(1,St,4,3,"div",15),t.DNE(2,Fe,4,3,"div",15),t.DNE(3,ve,2,1,"div",15),t.DNE(4,J,2,1,"div",15),t.bVm()),2&n){const h=t.XpG(3);t.R7$(1),t.Y8G("ngIf",h.currentObj.processStatus==h.allProcessStatuses.PROCESS_ERROR),t.R7$(1),t.Y8G("ngIf",h.currentObj.processStatus==h.allProcessStatuses.PROCESSED),t.R7$(1),t.Y8G("ngIf",h.currentObj.processStatus==h.allProcessStatuses.PROCESSED),t.R7$(1),t.Y8G("ngIf",h.currentObj.processStatus==h.allProcessStatuses.NONE||h.currentObj.processStatus==h.allProcessStatuses.PROCESSING)}}function bt(n,C){1&n&&(t.qex(0),t.j41(1,"div",18),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.bVm()),2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"lang_digitalize_book_please_choose_image")))}function be(n,C){if(1&n&&(t.qex(0),t.DNE(1,H,5,4,"ng-container",15),t.DNE(2,bt,4,3,"ng-container",15),t.bVm()),2&n){const h=t.XpG(2);t.R7$(1),t.Y8G("ngIf",h.currentObj),t.R7$(1),t.Y8G("ngIf",!h.currentObj)}}function Kt(n,C){if(1&n){const h=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),t.DNE(4,at,1,0,"app-digitalize-pdf-to-images",9),t.DNE(5,Ue,3,3,"div",10),t.k0s(),t.j41(6,"div",11)(7,"div",12),t.bIt("click",function(){t.eBV(h);const p=t.XpG();return t.Njj(p.downloadData("html"))}),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s()(),t.j41(10,"div",11)(11,"div",12),t.bIt("click",function(){t.eBV(h);const p=t.XpG();return t.Njj(p.downloadData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.DNE(14,_t,3,2,"div",13),t.k0s(),t.j41(15,"div",14),t.DNE(16,Jt,5,2,"ng-container",15),t.DNE(17,be,3,2,"ng-container",15),t.k0s()()}if(2&n){const h=t.XpG();t.R7$(4),t.Y8G("ngIf",h.currentLayout==h.allLayouts.CHOOSE_IMAGES),t.R7$(1),t.Y8G("ngIf",h.currentLayout==h.allLayouts.PROCESS_IMAGES),t.R7$(3),t.JRh(t.bMT(9,7,"lang_digitalize_book_download_result_html")),t.R7$(4),t.JRh(t.bMT(13,9,"lang_digitalize_book_download_result_docx")),t.R7$(2),t.Y8G("ngIf",h.objs.length>0),t.R7$(2),t.Y8G("ngIf",h.currentLayout==h.allLayouts.CHOOSE_IMAGES),t.R7$(1),t.Y8G("ngIf",h.currentLayout==h.allLayouts.PROCESS_IMAGES)}}const Ce=[{path:"",children:[{path:"digitalize-book",component:(()=>{var n;class C extends q.H{startProcess(){this.currentLayout=k.PROCESS_IMAGES;let l=this.objs.filter(m=>m.isSelected);this.processImage(this.commonService.getFirstOfArray(l));let p=l.filter(m=>![$.PROCESSING,$.PROCESSED].includes(m.processStatus));this.callOrcApi("startProcess",p,0)}processCurrentPageAgain(){return this.currentObj?this.currentObj.processStatus==$.PROCESSING?this.showErrorSnack("lang_digitalize_current_page_is_processing"):void this.callOrcApi("processCurrentPageAgain",[this.currentObj],0):this.showErrorSnack("lang_digitalize_not_select_any_current_page")}processAllAgain(){let l=this.objs.filter(p=>p.isSelected&&![$.PROCESSING,$.PROCESSED].includes(p.processStatus));if(l.length<=0)return this.showErrorSnack("lang_digitalize_not_found_any_error_record");this.callOrcApi("processAllAgain",l,0)}callOrcApi(l,p,m=0,v=1){if(console.log("Call orc api for: "+l+", totalObjs: "+p.length+", startIndex: "+m),m>=p.length)return void(this.processStatusObj.loading=!1);m<=0&&p.forEach(F=>F.processStatus=$.PROCESSING);let z=p.slice(m,m+v).map(F=>this.runDigitalizeOneImage(F));Promise.all(z).then(()=>{console.log("Call done ocr api for: "+p.length,", startIndex: "+m),this.callOrcApi(l,p,m+v,v)})}runDigitalizeOneImage(l){return new Promise((p,m)=>{this.sAztDigitalizeService.digitalizeData(l,v=>{this.processStatusObj={loading:!0,errorMessage:v,mustShowErrorBox:!1}},v=>{l.processStatus=$.PROCESS_ERROR,console.log("lang_digitalize_error_at_digitalized_function",v),this.replaceCurrentObj(l),p()},v=>{l={...v,processStatus:$.PROCESSED},this.replaceCurrentObj(l),p()})})}replaceCurrentObj(l){let p=this.objs.find(m=>m.uuid==l.uuid);if(null==p)return this.showErrorSnack("lang_digitalize_not_found_position_in_replace_function");Object.assign(p,l),console.log("Orc done: ","cur position:"+this.currentObj?.position+", orc position: "+p?.position+", orc image url: "+p?.image.url),this.currentObj&&this.processImage(this.currentObj)}chooseImages(l){let p=l.map(m=>m.uuid);this.objs.forEach(m=>m.isSelected=!!p.includes(m.uuid)||m.isSelected),this.totalSelected=this.objs.filter(m=>m.isSelected).length}processImage(l){if(!l)return;let p=this.objs.find(m=>m.uuid==l.uuid);p&&(this.currentObj={...p}),console.log("View new image: status: "+p?.processStatus+", position: "+p?.position+", url: "+p?.image.url)}showChooseLayout(){this.objs.forEach(l=>l.isSelected=!1),this.totalSelected=this.objs.filter(l=>l.isSelected).length,this.currentLayout=k.CHOOSE_IMAGES}changeObj(l){let p=this.objs.find(m=>m.uuid==l.uuid);p&&Object.assign(p,l)}uploadData(l){this.objs=l.map((p,m)=>({uuid:this.sAztUuidService.getUuid(),image:p,htmlResult:"",position:m+1,isSelected:!1,processStatus:$.NONE}))}downloadData(l){let p=new Date,m="";if(this.objs.forEach(v=>{m+=`<page [page]='${v.position}'/>`+(v.processStatus==$.PROCESSED?v.htmlResult:"")}),m=this.commonService.decodeHtmlEntities(m),"html"!=l)m=this.commonService.convertDollarDollarToLatexTag(m),this.commonService.loadAzotaDocxJs().then(()=>{azotaDocx.textToDocxBinary(m,null).then(v=>{let x=`azota-digitalize-book-${p.getDate()}${p.getMonth()+1}${p.getFullYear()}-${p.getTime()}.docx`;const z=new Blob([v],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});z&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(z),x)}).catch(v=>{this.showErrorSnack(v)})}).catch(v=>{this.showErrorSnack(v)});else{let v=`azota-digitalize-book-${p.getDate()}${p.getMonth()+1}${p.getFullYear()}-${p.getTime()}.html`;const x=new Blob([m],{type:"text/plain"});x&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(x),v)}}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_book",description:"lang_cms_admin_common_digitalize_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(kt),this.sAztUuidService=(0,t.WQX)(lt.D),this.processStatusObj={loading:!1,errorMessage:"",mustShowErrorBox:!1},this.headerBackTo="",this.objs=[],this.totalSelected=0,this.currentLayout=k.CHOOSE_IMAGES,this.allLayouts=k,this.allProcessStatuses=$}}return(n=C).\u0275fac=function(l){return new(l||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalize-book"]],features:[t.Vt3],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-3"],[1,"box","p-3","mb-3","grid","grid-cols-12","gap-2"],[1,"col-span-12"],[3,"uploadData",4,"ngIf"],["class","btn btn-primary-soft w-full",3,"click",4,"ngIf"],[1,"col-span-6"],[1,"btn","btn-primary","w-full",3,"click"],["class","box p-3",4,"ngIf"],[1,"col-span-9"],[4,"ngIf"],[3,"uploadData"],[1,"btn","btn-primary-soft","w-full",3,"click"],[1,"box","p-3"],[3,"objs","chooseImages",4,"ngIf"],[3,"objs","currentObj","processImage",4,"ngIf"],[3,"objs","chooseImages"],[3,"objs","currentObj","processImage"],[4,"ngIf","ngIfElse"],["notSelectAnyObj",""],[1,"mb-3","btn","btn-pending",3,"click"],[1,"mb-3","btn","btn-info",3,"click"],[3,"obj","changeObj"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"currentStatusObj","customText"]],template:function(l,p){if(1&l&&(t.j41(0,"teacher-layout",0)(1,"div",1),t.DNE(2,Ge,1,1,"azt-loading-effect",2),t.DNE(3,Kt,18,11,"ng-template",null,3,t.C5r),t.k0s()()),2&l){const m=t.sdS(4);t.Y8G("headerBackToLink",p.headerBackTo),t.R7$(2),t.Y8G("ngIf",p.statusObj.loading)("ngIfElse",m)}},dependencies:[j.bT,Xt.K,Ee.Q,Ie,de,ke,vt,L.wp],encapsulation:2}),C})()}]}];let ye=(()=>{var n;class C{}return(n=C).\u0275fac=function(l){return new(l||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[rt.iI.forChild(Ce),rt.iI,ct.XE]}),C})(),It=(()=>{var n;class C{}return(n=C).\u0275fac=function(l){return new(l||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({providers:[{provide:gt.vn,useValue:Yt.c.azt_tiny_mce_script_src}],imports:[rt.iI,j.MD,Z.YN,gt.sv,I.s,Z.X1,ye,ee.Q,Ft.L,xt.Id,te.b,U.flO.pick(U.Ptg),Lt.AC,st]}),C})()},17715:function(De){De.exports=function(){"use strict";function it(o){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(o)}function j(o,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}function rt(o,e,a){return e in o?Object.defineProperty(o,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[e]=a,o}function gt(o,e){var a=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(o,s).enumerable})),a.push.apply(a,i)}return a}function t(o){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?gt(Object(a),!0).forEach(function(i){rt(o,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):gt(Object(a)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(a,i))})}return o}function yt(o){return function ut(o){if(Array.isArray(o))return mt(o)}(o)||function wt(o){if(typeof Symbol<"u"&&Symbol.iterator in Object(o))return Array.from(o)}(o)||function nt(o,e){if(o){if("string"==typeof o)return mt(o,e);var a=Object.prototype.toString.call(o).slice(8,-1);if("Object"===a&&o.constructor&&(a=o.constructor.name),"Map"===a||"Set"===a)return Array.from(o);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mt(o,e)}}(o)||function qt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(o,e){(null==e||e>o.length)&&(e=o.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=o[a];return i}var st=typeof window<"u"&&typeof window.document<"u",U=st?window:{},Lt=!(!st||!U.document.documentElement)&&"ontouchstart"in U.document.documentElement,xt=!!st&&"PointerEvent"in U,I="cropper",q="s",V="n",Ot="ne",L="nw",Dt="se",Et="sw",kt="".concat(I,"-crop"),$="".concat(I,"-disabled"),k="".concat(I,"-hidden"),Xt="".concat(I,"-hide"),Ee="".concat(I,"-invisible"),Bt="".concat(I,"-modal"),zt="".concat(I,"-move"),At="".concat(I,"Action"),Nt="".concat(I,"Preview"),$t="crop",Pt="crop",Vt="cropend",Gt="cropmove",Ht="cropstart",oe="dblclick",re=xt?"pointerdown":Lt?"touchstart":"mousedown",ne=xt?"pointermove":Lt?"touchmove":"mousemove",se=xt?"pointerup pointercancel":Lt?"touchend touchcancel":"mouseup",Wt="zoom",pe="image/jpeg",Ie=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Te=/^data:/,Re=/^data:image\/jpeg;base64,/,Me=/^img|canvas$/i,ue={viewMode:0,dragMode:$t,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},ke=Number.isNaN||U.isNaN;function O(o){return"number"==typeof o&&!ke(o)}var me=function(e){return e>0&&e<1/0};function Ut(o){return typeof o>"u"}function ht(o){return"object"===it(o)&&null!==o}var Be=Object.prototype.hasOwnProperty;function ft(o){if(!ht(o))return!1;try{var e=o.constructor,a=e.prototype;return e&&a&&Be.call(a,"isPrototypeOf")}catch{return!1}}function X(o){return"function"==typeof o}var Ne=Array.prototype.slice;function fe(o){return Array.from?Array.from(o):Ne.call(o)}function M(o,e){return o&&X(e)&&(Array.isArray(o)||O(o.length)?fe(o).forEach(function(a,i){e.call(o,a,i,o)}):ht(o)&&Object.keys(o).forEach(function(a){e.call(o,o[a],a,o)})),o}var T=Object.assign||function(e){for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];return ht(e)&&i.length>0&&i.forEach(function(r){ht(r)&&Object.keys(r).forEach(function(c){e[c]=r[c]})}),e},Pe=/\.\d*(?:0|9){12}\d*$/;function vt(o){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Pe.test(o)?Math.round(o*e)/e:o}var Ge=/^width|height|left|top|marginLeft|marginTop$/;function at(o,e){var a=o.style;M(e,function(i,s){Ge.test(s)&&O(i)&&(i="".concat(i,"px")),a[s]=i})}function B(o,e){if(e){if(O(o.length))return void M(o,function(i){B(i,e)});if(o.classList)return void o.classList.add(e);var a=o.className.trim();a?a.indexOf(e)<0&&(o.className="".concat(a," ").concat(e)):o.className=e}}function tt(o,e){if(e){if(O(o.length))return void M(o,function(a){tt(a,e)});if(o.classList)return void o.classList.remove(e);o.className.indexOf(e)>=0&&(o.className=o.className.replace(e,""))}}function _t(o,e,a){if(e){if(O(o.length))return void M(o,function(i){_t(i,e,a)});a?B(o,e):tt(o,e)}}var Le=/([a-z\d])([A-Z])/g;function Qt(o){return o.replace(Le,"$1-$2").toLowerCase()}function Jt(o,e){return ht(o[e])?o[e]:o.dataset?o.dataset[e]:o.getAttribute("data-".concat(Qt(e)))}function St(o,e,a){ht(a)?o[e]=a:o.dataset?o.dataset[e]=a:o.setAttribute("data-".concat(Qt(e)),a)}var ve=/\s\s*/,_e=function(){var o=!1;if(st){var e=!1,a=function(){},i=Object.defineProperty({},"once",{get:function(){return o=!0,e},set:function(r){e=r}});U.addEventListener("test",a,i),U.removeEventListener("test",a,i)}return o}();function J(o,e,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=a;e.trim().split(ve).forEach(function(r){if(!_e){var c=o.listeners;c&&c[r]&&c[r][a]&&(s=c[r][a],delete c[r][a],0===Object.keys(c[r]).length&&delete c[r],0===Object.keys(c).length&&delete o.listeners)}o.removeEventListener(r,s,i)})}function H(o,e,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=a;e.trim().split(ve).forEach(function(r){if(i.once&&!_e){var c=o.listeners,d=void 0===c?{}:c;s=function(){delete d[r][a],o.removeEventListener(r,s,i);for(var f=arguments.length,u=new Array(f),g=0;g<f;g++)u[g]=arguments[g];a.apply(o,u)},d[r]||(d[r]={}),d[r][a]&&o.removeEventListener(r,d[r][a],i),d[r][a]=s,o.listeners=d}o.addEventListener(r,s,i)})}function bt(o,e,a){var i;return X(Event)&&X(CustomEvent)?i=new CustomEvent(e,{detail:a,bubbles:!0,cancelable:!0}):(i=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,a),o.dispatchEvent(i)}function be(o){var e=o.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var Kt=U.location,$e=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Ce(o){var e=o.match($e);return null!==e&&(e[1]!==Kt.protocol||e[2]!==Kt.hostname||e[3]!==Kt.port)}function ye(o){var e="timestamp=".concat((new Date).getTime());return o+(-1===o.indexOf("?")?"?":"&")+e}function It(o){var e=o.rotate,a=o.scaleX,i=o.scaleY,s=o.translateX,r=o.translateY,c=[];O(s)&&0!==s&&c.push("translateX(".concat(s,"px)")),O(r)&&0!==r&&c.push("translateY(".concat(r,"px)")),O(e)&&0!==e&&c.push("rotate(".concat(e,"deg)")),O(a)&&1!==a&&c.push("scaleX(".concat(a,")")),O(i)&&1!==i&&c.push("scaleY(".concat(i,")"));var d=c.length?c.join(" "):"none";return{WebkitTransform:d,msTransform:d,transform:d}}function C(o,e){var a=o.pageX,i=o.pageY,s={endX:a,endY:i};return e?s:t({startX:a,startY:i},s)}function l(o){var e=o.aspectRatio,a=o.height,i=o.width,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",r=me(i),c=me(a);if(r&&c){var d=a*e;"contain"===s&&d>i||"cover"===s&&d<i?a=i/e:i=a*e}else r?a=i/e:c&&(i=a*e);return{width:i,height:a}}var v=String.fromCharCode;var z=/^data:.*,/;function W(o){var a,e=new DataView(o);try{var i,s,r;if(255===e.getUint8(0)&&216===e.getUint8(1))for(var c=e.byteLength,d=2;d+1<c;){if(255===e.getUint8(d)&&225===e.getUint8(d+1)){s=d;break}d+=1}if(s){var f=s+10;if("Exif"===function x(o,e,a){var i="";a+=e;for(var s=e;s<a;s+=1)i+=v(o.getUint8(s));return i}(e,s+4,4)){var u=e.getUint16(f);if(((i=18761===u)||19789===u)&&42===e.getUint16(f+2,i)){var g=e.getUint32(f+4,i);g>=8&&(r=f+g)}}}if(r){var E,D,_=e.getUint16(r,i);for(D=0;D<_;D+=1)if(274===e.getUint16(E=r+12*D+2,i)){a=e.getUint16(E+=8,i),e.setUint16(E,1,i);break}}}catch{a=1}return a}var Zt={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,a=this.options,i=this.container,s=this.cropper,r=Number(a.minContainerWidth),c=Number(a.minContainerHeight);B(s,k),tt(e,k);var d={width:Math.max(i.offsetWidth,r>=0?r:200),height:Math.max(i.offsetHeight,c>=0?c:100)};this.containerData=d,at(s,{width:d.width,height:d.height}),B(e,k),tt(s,k)},initCanvas:function(){var e=this.containerData,a=this.imageData,i=this.options.viewMode,s=Math.abs(a.rotate)%180==90,r=s?a.naturalHeight:a.naturalWidth,c=s?a.naturalWidth:a.naturalHeight,d=r/c,b=e.width,f=e.height;e.height*d>e.width?3===i?b=e.height*d:f=e.width/d:3===i?f=e.width/d:b=e.height*d;var u={aspectRatio:d,naturalWidth:r,naturalHeight:c,width:b,height:f};this.canvasData=u,this.limited=1===i||2===i,this.limitCanvas(!0,!0),u.width=Math.min(Math.max(u.width,u.minWidth),u.maxWidth),u.height=Math.min(Math.max(u.height,u.minHeight),u.maxHeight),u.left=(e.width-u.width)/2,u.top=(e.height-u.height)/2,u.oldLeft=u.left,u.oldTop=u.top,this.initialCanvasData=T({},u)},limitCanvas:function(e,a){var i=this.options,s=this.containerData,r=this.canvasData,c=this.cropBoxData,d=i.viewMode,b=r.aspectRatio,f=this.cropped&&c;if(e){var u=Number(i.minCanvasWidth)||0,g=Number(i.minCanvasHeight)||0;d>1?(u=Math.max(u,s.width),g=Math.max(g,s.height),3===d&&(g*b>u?u=g*b:g=u/b)):d>0&&(u?u=Math.max(u,f?c.width:0):g?g=Math.max(g,f?c.height:0):f&&((g=c.height)*b>(u=c.width)?u=g*b:g=u/b));var _=l({aspectRatio:b,width:u,height:g});g=_.height,r.minWidth=u=_.width,r.minHeight=g,r.maxWidth=1/0,r.maxHeight=1/0}if(a)if(d>(f?0:1)){var E=s.width-r.width,D=s.height-r.height;r.minLeft=Math.min(0,E),r.minTop=Math.min(0,D),r.maxLeft=Math.max(0,E),r.maxTop=Math.max(0,D),f&&this.limited&&(r.minLeft=Math.min(c.left,c.left+(c.width-r.width)),r.minTop=Math.min(c.top,c.top+(c.height-r.height)),r.maxLeft=c.left,r.maxTop=c.top,2===d&&(r.width>=s.width&&(r.minLeft=Math.min(0,E),r.maxLeft=Math.max(0,E)),r.height>=s.height&&(r.minTop=Math.min(0,D),r.maxTop=Math.max(0,D))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=s.width,r.maxTop=s.height},renderCanvas:function(e,a){var i=this.canvasData,s=this.imageData;if(a){var r=function p(o){var e=o.width,a=o.height,i=o.degree;if(90==(i=Math.abs(i)%180))return{width:a,height:e};var s=i%90*Math.PI/180,r=Math.sin(s),c=Math.cos(s),d=e*c+a*r,b=e*r+a*c;return i>90?{width:b,height:d}:{width:d,height:b}}({width:s.naturalWidth*Math.abs(s.scaleX||1),height:s.naturalHeight*Math.abs(s.scaleY||1),degree:s.rotate||0}),c=r.width,d=r.height,b=i.width*(c/i.naturalWidth),f=i.height*(d/i.naturalHeight);i.left-=(b-i.width)/2,i.top-=(f-i.height)/2,i.width=b,i.height=f,i.aspectRatio=c/d,i.naturalWidth=c,i.naturalHeight=d,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,at(this.canvas,T({width:i.width,height:i.height},It({translateX:i.left,translateY:i.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var a=this.canvasData,i=this.imageData,s=i.naturalWidth*(a.width/a.naturalWidth),r=i.naturalHeight*(a.height/a.naturalHeight);T(i,{width:s,height:r,left:(a.width-s)/2,top:(a.height-r)/2}),at(this.image,T({width:i.width,height:i.height},It(T({translateX:i.left,translateY:i.top},i)))),e&&this.output()},initCropBox:function(){var e=this.options,a=this.canvasData,i=e.aspectRatio||e.initialAspectRatio,s=Number(e.autoCropArea)||.8,r={width:a.width,height:a.height};i&&(a.height*i>a.width?r.height=r.width/i:r.width=r.height*i),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*s),r.height=Math.max(r.minHeight,r.height*s),r.left=a.left+(a.width-r.width)/2,r.top=a.top+(a.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=T({},r)},limitCropBox:function(e,a){var i=this.options,s=this.containerData,r=this.canvasData,c=this.cropBoxData,d=this.limited,b=i.aspectRatio;if(e){var f=Number(i.minCropBoxWidth)||0,u=Number(i.minCropBoxHeight)||0,g=d?Math.min(s.width,r.width,r.width+r.left,s.width-r.left):s.width,_=d?Math.min(s.height,r.height,r.height+r.top,s.height-r.top):s.height;f=Math.min(f,s.width),u=Math.min(u,s.height),b&&(f&&u?u*b>f?u=f/b:f=u*b:f?u=f/b:u&&(f=u*b),_*b>g?_=g/b:g=_*b),c.minWidth=Math.min(f,g),c.minHeight=Math.min(u,_),c.maxWidth=g,c.maxHeight=_}a&&(d?(c.minLeft=Math.max(0,r.left),c.minTop=Math.max(0,r.top),c.maxLeft=Math.min(s.width,r.left+r.width)-c.width,c.maxTop=Math.min(s.height,r.top+r.height)-c.height):(c.minLeft=0,c.minTop=0,c.maxLeft=s.width-c.width,c.maxTop=s.height-c.height))},renderCropBox:function(){var e=this.options,a=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,e.movable&&e.cropBoxMovable&&St(this.face,At,i.width>=a.width&&i.height>=a.height?"move":"all"),at(this.cropBox,T({width:i.width,height:i.height},It({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),bt(this.element,Pt,this.getData())}},xe={initPreview:function(){var e=this.element,a=this.crossOrigin,i=this.options.preview,s=a?this.crossOriginUrl:this.url,r=e.alt||"The image to preview",c=document.createElement("img");if(a&&(c.crossOrigin=a),c.src=s,c.alt=r,this.viewBox.appendChild(c),this.viewBoxImage=c,i){var d=i;"string"==typeof i?d=e.ownerDocument.querySelectorAll(i):i.querySelector&&(d=[i]),this.previews=d,M(d,function(b){var f=document.createElement("img");St(b,Nt,{width:b.offsetWidth,height:b.offsetHeight,html:b.innerHTML}),a&&(f.crossOrigin=a),f.src=s,f.alt=r,f.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',b.innerHTML="",b.appendChild(f)})}},resetPreview:function(){M(this.previews,function(e){var a=Jt(e,Nt);at(e,{width:a.width,height:a.height}),e.innerHTML=a.html,function Fe(o,e){if(ht(o[e]))try{delete o[e]}catch{o[e]=void 0}else if(o.dataset)try{delete o.dataset[e]}catch{o.dataset[e]=void 0}else o.removeAttribute("data-".concat(Qt(e)))}(e,Nt)})},preview:function(){var e=this.imageData,a=this.canvasData,i=this.cropBoxData,s=i.width,r=i.height,c=e.width,d=e.height,b=i.left-a.left-e.left,f=i.top-a.top-e.top;!this.cropped||this.disabled||(at(this.viewBoxImage,T({width:c,height:d},It(T({translateX:-b,translateY:-f},e)))),M(this.previews,function(u){var g=Jt(u,Nt),_=g.width,E=g.height,D=_,R=E,A=1;s&&(R=r*(A=_/s)),r&&R>E&&(D=s*(A=E/r),R=E),at(u,{width:D,height:R}),at(u.getElementsByTagName("img")[0],T({width:c*A,height:d*A},It(T({translateX:-b*A,translateY:-f*A},e))))}))}},Ke={bind:function(){var e=this.element,a=this.options,i=this.cropper;X(a.cropstart)&&H(e,Ht,a.cropstart),X(a.cropmove)&&H(e,Gt,a.cropmove),X(a.cropend)&&H(e,Vt,a.cropend),X(a.crop)&&H(e,Pt,a.crop),X(a.zoom)&&H(e,Wt,a.zoom),H(i,re,this.onCropStart=this.cropStart.bind(this)),a.zoomable&&a.zoomOnWheel&&H(i,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&H(i,oe,this.onDblclick=this.dblclick.bind(this)),H(e.ownerDocument,ne,this.onCropMove=this.cropMove.bind(this)),H(e.ownerDocument,se,this.onCropEnd=this.cropEnd.bind(this)),a.responsive&&H(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,a=this.options,i=this.cropper;X(a.cropstart)&&J(e,Ht,a.cropstart),X(a.cropmove)&&J(e,Gt,a.cropmove),X(a.cropend)&&J(e,Vt,a.cropend),X(a.crop)&&J(e,Pt,a.crop),X(a.zoom)&&J(e,Wt,a.zoom),J(i,re,this.onCropStart),a.zoomable&&a.zoomOnWheel&&J(i,"wheel",this.onWheel,{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&J(i,oe,this.onDblclick),J(e.ownerDocument,ne,this.onCropMove),J(e.ownerDocument,se,this.onCropEnd),a.responsive&&J(window,"resize",this.onResize)}},Ze={resize:function(){if(!this.disabled){var r,c,e=this.options,a=this.container,i=this.containerData,s=a.offsetWidth/i.width;1===s&&a.offsetHeight===i.height||(e.restore&&(r=this.getCanvasData(),c=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(M(r,function(d,b){r[b]=d*s})),this.setCropBoxData(M(c,function(d,b){c[b]=d*s}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(function Ue(o,e){return o.classList?o.classList.contains(e):o.className.indexOf(e)>-1}(this.dragBox,kt)?"move":$t)},wheel:function(e){var a=this,i=Number(this.options.wheelZoomRatio)||.1,s=1;this.disabled||(e.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){a.wheeling=!1},50),e.deltaY?s=e.deltaY>0?1:-1:e.wheelDelta?s=-e.wheelDelta/120:e.detail&&(s=e.detail>0?1:-1),this.zoom(-s*i,e)))},cropStart:function(e){var a=e.buttons,i=e.button;if(!(this.disabled||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(O(a)&&1!==a||O(i)&&0!==i||e.ctrlKey))){var c,s=this.options,r=this.pointers;e.changedTouches?M(e.changedTouches,function(d){r[d.identifier]=C(d)}):r[e.pointerId||0]=C(e),c=Object.keys(r).length>1&&s.zoomable&&s.zoomOnTouch?"zoom":Jt(e.target,At),Ie.test(c)&&!1!==bt(this.element,Ht,{originalEvent:e,action:c})&&(e.preventDefault(),this.action=c,this.cropping=!1,"crop"===c&&(this.cropping=!0,B(this.dragBox,Bt)))}},cropMove:function(e){var a=this.action;if(!this.disabled&&a){var i=this.pointers;e.preventDefault(),!1!==bt(this.element,Gt,{originalEvent:e,action:a})&&(e.changedTouches?M(e.changedTouches,function(s){T(i[s.identifier]||{},C(s,!0))}):T(i[e.pointerId||0]||{},C(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var a=this.action,i=this.pointers;e.changedTouches?M(e.changedTouches,function(s){delete i[s.identifier]}):delete i[e.pointerId||0],a&&(e.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,_t(this.dragBox,Bt,this.cropped&&this.options.modal)),bt(this.element,Vt,{originalEvent:e,action:a}))}}},qe={change:function(e){var pt,i=this.canvasData,s=this.containerData,r=this.cropBoxData,c=this.pointers,d=this.action,b=this.options.aspectRatio,f=r.left,u=r.top,g=r.width,_=r.height,E=f+g,D=u+_,R=0,A=0,P=s.width,Y=s.height,N=!0;!b&&e.shiftKey&&(b=g&&_?g/_:1),this.limited&&(A=r.minTop,P=(R=r.minLeft)+Math.min(s.width,i.width,i.left+i.width),Y=A+Math.min(s.height,i.height,i.top+i.height));var K=c[Object.keys(c)[0]],y={x:K.endX-K.startX,y:K.endY-K.startY},S=function(et){switch(et){case"e":E+y.x>P&&(y.x=P-E);break;case"w":f+y.x<R&&(y.x=R-f);break;case V:u+y.y<A&&(y.y=A-u);break;case q:D+y.y>Y&&(y.y=Y-D)}};switch(d){case"all":f+=y.x,u+=y.y;break;case"e":if(y.x>=0&&(E>=P||b&&(u<=A||D>=Y))){N=!1;break}S("e"),(g+=y.x)<0&&(d="w",f-=g=-g),b&&(u+=(r.height-(_=g/b))/2);break;case V:if(y.y<=0&&(u<=A||b&&(f<=R||E>=P))){N=!1;break}S(V),u+=y.y,(_-=y.y)<0&&(d=q,u-=_=-_),b&&(f+=(r.width-(g=_*b))/2);break;case"w":if(y.x<=0&&(f<=R||b&&(u<=A||D>=Y))){N=!1;break}S("w"),f+=y.x,(g-=y.x)<0&&(d="e",f-=g=-g),b&&(u+=(r.height-(_=g/b))/2);break;case q:if(y.y>=0&&(D>=Y||b&&(f<=R||E>=P))){N=!1;break}S(q),(_+=y.y)<0&&(d=V,u-=_=-_),b&&(f+=(r.width-(g=_*b))/2);break;case Ot:if(b){if(y.y<=0&&(u<=A||E>=P)){N=!1;break}S(V),u+=y.y,g=(_-=y.y)*b}else S(V),S("e"),y.x>=0?E<P?g+=y.x:y.y<=0&&u<=A&&(N=!1):g+=y.x,y.y<=0?u>A&&(_-=y.y,u+=y.y):(_-=y.y,u+=y.y);g<0&&_<0?(d=Et,u-=_=-_,f-=g=-g):g<0?(d=L,f-=g=-g):_<0&&(d=Dt,u-=_=-_);break;case L:if(b){if(y.y<=0&&(u<=A||f<=R)){N=!1;break}S(V),u+=y.y,f+=r.width-(g=(_-=y.y)*b)}else S(V),S("w"),y.x<=0?f>R?(g-=y.x,f+=y.x):y.y<=0&&u<=A&&(N=!1):(g-=y.x,f+=y.x),y.y<=0?u>A&&(_-=y.y,u+=y.y):(_-=y.y,u+=y.y);g<0&&_<0?(d=Dt,u-=_=-_,f-=g=-g):g<0?(d=Ot,f-=g=-g):_<0&&(d=Et,u-=_=-_);break;case Et:if(b){if(y.x<=0&&(f<=R||D>=Y)){N=!1;break}S("w"),f+=y.x,_=(g-=y.x)/b}else S(q),S("w"),y.x<=0?f>R?(g-=y.x,f+=y.x):y.y>=0&&D>=Y&&(N=!1):(g-=y.x,f+=y.x),y.y>=0?D<Y&&(_+=y.y):_+=y.y;g<0&&_<0?(d=Ot,u-=_=-_,f-=g=-g):g<0?(d=Dt,f-=g=-g):_<0&&(d=L,u-=_=-_);break;case Dt:if(b){if(y.x>=0&&(E>=P||D>=Y)){N=!1;break}S("e"),_=(g+=y.x)/b}else S(q),S("e"),y.x>=0?E<P?g+=y.x:y.y>=0&&D>=Y&&(N=!1):g+=y.x,y.y>=0?D<Y&&(_+=y.y):_+=y.y;g<0&&_<0?(d=L,u-=_=-_,f-=g=-g):g<0?(d=Et,f-=g=-g):_<0&&(d=Ot,u-=_=-_);break;case"move":this.move(y.x,y.y),N=!1;break;case"zoom":this.zoom(function n(o){var e=t({},o),a=0;return M(o,function(i,s){delete e[s],M(e,function(r){var c=Math.abs(i.startX-r.startX),d=Math.abs(i.startY-r.startY),b=Math.abs(i.endX-r.endX),f=Math.abs(i.endY-r.endY),u=Math.sqrt(c*c+d*d),_=(Math.sqrt(b*b+f*f)-u)/u;Math.abs(_)>Math.abs(a)&&(a=_)})}),a}(c),e),N=!1;break;case"crop":if(!y.x||!y.y){N=!1;break}pt=be(this.cropper),f=K.startX-pt.left,u=K.startY-pt.top,g=r.minWidth,_=r.minHeight,y.x>0?d=y.y>0?Dt:Ot:y.x<0&&(f-=g,d=y.y>0?Et:L),y.y<0&&(u-=_),this.cropped||(tt(this.cropBox,k),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}N&&(r.width=g,r.height=_,r.left=f,r.top=u,this.action=d,this.renderCropBox()),M(c,function(G){G.startX=G.endX,G.startY=G.endY})}},ti={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&B(this.dragBox,Bt),tt(this.cropBox,k),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=T({},this.initialImageData),this.canvasData=T({},this.initialCanvasData),this.cropBoxData=T({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(T(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),tt(this.dragBox,Bt),B(this.cropBox,k)),this},replace:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&e&&(this.isImg&&(this.element.src=e),a?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,M(this.previews,function(i){i.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,tt(this.cropper,$)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,B(this.cropper,$)),this},destroy:function(){var e=this.element;return e[I]?(e[I]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,s=i.left,r=i.top;return this.moveTo(Ut(e)?e:s+Number(e),Ut(a)?a:r+Number(a))},moveTo:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,s=!1;return e=Number(e),a=Number(a),this.ready&&!this.disabled&&this.options.movable&&(O(e)&&(i.left=e,s=!0),O(a)&&(i.top=a,s=!0),s&&this.renderCanvas(!0)),this},zoom:function(e,a){var i=this.canvasData;return e=Number(e),this.zoomTo(i.width*(e=e<0?1/(1-e):1+e)/i.naturalWidth,null,a)},zoomTo:function(e,a,i){var s=this.options,r=this.canvasData,c=r.width,d=r.height,b=r.naturalWidth,f=r.naturalHeight;if((e=Number(e))>=0&&this.ready&&!this.disabled&&s.zoomable){var u=b*e,g=f*e;if(!1===bt(this.element,Wt,{ratio:e,oldRatio:c/b,originalEvent:i}))return this;if(i){var _=this.pointers,E=be(this.cropper),D=_&&Object.keys(_).length?function h(o){var e=0,a=0,i=0;return M(o,function(s){e+=s.startX,a+=s.startY,i+=1}),{pageX:e/=i,pageY:a/=i}}(_):{pageX:i.pageX,pageY:i.pageY};r.left-=(D.pageX-E.left-r.left)/c*(u-c),r.top-=(D.pageY-E.top-r.top)/d*(g-d)}else ft(a)&&O(a.x)&&O(a.y)?(r.left-=(a.x-r.left)/c*(u-c),r.top-=(a.y-r.top)/d*(g-d)):(r.left-=(u-c)/2,r.top-=(g-d)/2);r.width=u,r.height=g,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return O(e=Number(e))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var a=this.imageData.scaleY;return this.scale(e,O(a)?a:1)},scaleY:function(e){var a=this.imageData.scaleX;return this.scale(O(a)?a:1,e)},scale:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.imageData,s=!1;return e=Number(e),a=Number(a),this.ready&&!this.disabled&&this.options.scalable&&(O(e)&&(i.scaleX=e,s=!0),O(a)&&(i.scaleY=a,s=!0),s&&this.renderCanvas(!0,!0)),this},getData:function(){var c,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this.options,i=this.imageData,s=this.canvasData,r=this.cropBoxData;if(this.ready&&this.cropped){var d=i.width/i.naturalWidth;if(M(c={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height},function(u,g){c[g]=u/d}),e){var b=Math.round(c.y+c.height),f=Math.round(c.x+c.width);c.x=Math.round(c.x),c.y=Math.round(c.y),c.width=f-c.x,c.height=b-c.y}}else c={x:0,y:0,width:0,height:0};return a.rotatable&&(c.rotate=i.rotate||0),a.scalable&&(c.scaleX=i.scaleX||1,c.scaleY=i.scaleY||1),c},setData:function(e){var a=this.options,i=this.imageData,s=this.canvasData,r={};if(this.ready&&!this.disabled&&ft(e)){var c=!1;a.rotatable&&O(e.rotate)&&e.rotate!==i.rotate&&(i.rotate=e.rotate,c=!0),a.scalable&&(O(e.scaleX)&&e.scaleX!==i.scaleX&&(i.scaleX=e.scaleX,c=!0),O(e.scaleY)&&e.scaleY!==i.scaleY&&(i.scaleY=e.scaleY,c=!0)),c&&this.renderCanvas(!0,!0);var d=i.width/i.naturalWidth;O(e.x)&&(r.left=e.x*d+s.left),O(e.y)&&(r.top=e.y*d+s.top),O(e.width)&&(r.width=e.width*d),O(e.height)&&(r.height=e.height*d),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?T({},this.containerData):{}},getImageData:function(){return this.sized?T({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,a={};return this.ready&&M(["left","top","width","height","naturalWidth","naturalHeight"],function(i){a[i]=e[i]}),a},setCanvasData:function(e){var a=this.canvasData,i=a.aspectRatio;return this.ready&&!this.disabled&&ft(e)&&(O(e.left)&&(a.left=e.left),O(e.top)&&(a.top=e.top),O(e.width)?(a.width=e.width,a.height=e.width/i):O(e.height)&&(a.height=e.height,a.width=e.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var a,e=this.cropBoxData;return this.ready&&this.cropped&&(a={left:e.left,top:e.top,width:e.width,height:e.height}),a||{}},setCropBoxData:function(e){var s,r,a=this.cropBoxData,i=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&ft(e)&&(O(e.left)&&(a.left=e.left),O(e.top)&&(a.top=e.top),O(e.width)&&e.width!==a.width&&(s=!0,a.width=e.width),O(e.height)&&e.height!==a.height&&(r=!0,a.height=e.height),i&&(s?a.height=a.width/i:r&&(a.width=a.height*i)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var a=this.canvasData,i=function m(o,e,a,i){var s=e.aspectRatio,r=e.naturalWidth,c=e.naturalHeight,d=e.rotate,b=void 0===d?0:d,f=e.scaleX,u=void 0===f?1:f,g=e.scaleY,_=void 0===g?1:g,E=a.aspectRatio,D=a.naturalWidth,R=a.naturalHeight,A=i.fillColor,P=void 0===A?"transparent":A,Y=i.imageSmoothingEnabled,N=void 0===Y||Y,pt=i.imageSmoothingQuality,K=void 0===pt?"low":pt,y=i.maxWidth,S=void 0===y?1/0:y,G=i.maxHeight,et=void 0===G?1/0:G,dt=i.minWidth,Rt=void 0===dt?0:dt,Mt=i.minHeight,Ct=void 0===Mt?0:Mt,ot=document.createElement("canvas"),Q=ot.getContext("2d"),jt=l({aspectRatio:E,width:S,height:et}),Oe=l({aspectRatio:E,width:Rt,height:Ct},"cover"),Ye=Math.min(jt.width,Math.max(Oe.width,D)),Xe=Math.min(jt.height,Math.max(Oe.height,R)),He=l({aspectRatio:s,width:S,height:et}),We=l({aspectRatio:s,width:Rt,height:Ct},"cover"),Qe=Math.min(He.width,Math.max(We.width,r)),Je=Math.min(He.height,Math.max(We.height,c)),ii=[-Qe/2,-Je/2,Qe,Je];return ot.width=vt(Ye),ot.height=vt(Xe),Q.fillStyle=P,Q.fillRect(0,0,Ye,Xe),Q.save(),Q.translate(Ye/2,Xe/2),Q.rotate(b*Math.PI/180),Q.scale(u,_),Q.imageSmoothingEnabled=N,Q.imageSmoothingQuality=K,Q.drawImage.apply(Q,[o].concat(yt(ii.map(function(ai){return Math.floor(vt(ai))})))),Q.restore(),ot}(this.image,this.imageData,a,e);if(!this.cropped)return i;var s=this.getData(),r=s.x,c=s.y,d=s.width,b=s.height,f=i.width/Math.floor(a.naturalWidth);1!==f&&(r*=f,c*=f,d*=f,b*=f);var u=d/b,g=l({aspectRatio:u,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),_=l({aspectRatio:u,width:e.minWidth||0,height:e.minHeight||0},"cover"),E=l({aspectRatio:u,width:e.width||(1!==f?i.width:d),height:e.height||(1!==f?i.height:b)}),D=E.width,R=E.height;D=Math.min(g.width,Math.max(_.width,D)),R=Math.min(g.height,Math.max(_.height,R));var A=document.createElement("canvas"),P=A.getContext("2d");A.width=vt(D),A.height=vt(R),P.fillStyle=e.fillColor||"transparent",P.fillRect(0,0,D,R);var Y=e.imageSmoothingEnabled,pt=e.imageSmoothingQuality;P.imageSmoothingEnabled=void 0===Y||Y,pt&&(P.imageSmoothingQuality=pt);var et,dt,Rt,Mt,Ct,ot,K=i.width,y=i.height,S=r,G=c;S<=-d||S>K?(S=0,et=0,Rt=0,Ct=0):S<=0?(Rt=-S,S=0,Ct=et=Math.min(K,d+S)):S<=K&&(Rt=0,Ct=et=Math.min(d,K-S)),et<=0||G<=-b||G>y?(G=0,dt=0,Mt=0,ot=0):G<=0?(Mt=-G,G=0,ot=dt=Math.min(y,b+G)):G<=y&&(Mt=0,ot=dt=Math.min(b,y-G));var Q=[S,G,et,dt];if(Ct>0&&ot>0){var jt=D/d;Q.push(Rt*jt,Mt*jt,Ct*jt,ot*jt)}return P.drawImage.apply(P,[i].concat(yt(Q.map(function(Oe){return Math.floor(vt(Oe))})))),A},setAspectRatio:function(e){var a=this.options;return!this.disabled&&!Ut(e)&&(a.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var a=this.options,i=this.dragBox,s=this.face;if(this.ready&&!this.disabled){var r=e===$t,c=a.movable&&"move"===e;a.dragMode=e=r||c?e:"none",St(i,At,e),_t(i,kt,r),_t(i,zt,c),a.cropBoxMovable||(St(s,At,e),_t(s,kt,r),_t(s,zt,c))}return this}},ei=U.Cropper,Ve=function(){function o(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function w(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),!e||!Me.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=T({},ue,ft(a)&&a),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return function Z(o,e,a){return e&&j(o.prototype,e),a&&j(o,a),o}(o,[{key:"init",value:function(){var s,a=this.element,i=a.tagName.toLowerCase();if(!a[I]){if(a[I]=this,"img"===i){if(this.isImg=!0,s=a.getAttribute("src")||"",this.originalUrl=s,!s)return;s=a.src}else"canvas"===i&&window.HTMLCanvasElement&&(s=a.toDataURL());this.load(s)}}},{key:"load",value:function(a){var i=this;if(a){this.url=a,this.imageData={};var s=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer)return void this.clone();if(Te.test(a))return void(Re.test(a)?this.read(function F(o){var e=o.replace(z,""),a=atob(e),i=new ArrayBuffer(a.length),s=new Uint8Array(i);return M(s,function(r,c){s[c]=a.charCodeAt(c)}),i}(a)):this.clone());var c=new XMLHttpRequest,d=this.clone.bind(this);this.reloading=!0,this.xhr=c,c.onabort=d,c.onerror=d,c.ontimeout=d,c.onprogress=function(){c.getResponseHeader("content-type")!==pe&&c.abort()},c.onload=function(){i.read(c.response)},c.onloadend=function(){i.reloading=!1,i.xhr=null},r.checkCrossOrigin&&Ce(a)&&s.crossOrigin&&(a=ye(a)),c.open("GET",a,!0),c.responseType="arraybuffer",c.withCredentials="use-credentials"===s.crossOrigin,c.send()}}},{key:"read",value:function(a){var i=this.options,s=this.imageData,r=W(a),c=0,d=1,b=1;if(r>1){this.url=function Tt(o,e){for(var a=[],s=new Uint8Array(o);s.length>0;)a.push(v.apply(null,fe(s.subarray(0,8192)))),s=s.subarray(8192);return"data:".concat(e,";base64,").concat(btoa(a.join("")))}(a,pe);var f=function we(o){var e=0,a=1,i=1;switch(o){case 2:a=-1;break;case 3:e=-180;break;case 4:i=-1;break;case 5:e=90,i=-1;break;case 6:e=90;break;case 7:e=90,a=-1;break;case 8:e=-90}return{rotate:e,scaleX:a,scaleY:i}}(r);c=f.rotate,d=f.scaleX,b=f.scaleY}i.rotatable&&(s.rotate=c),i.scalable&&(s.scaleX=d,s.scaleY=b),this.clone()}},{key:"clone",value:function(){var a=this.element,i=this.url,s=a.crossOrigin,r=i;this.options.checkCrossOrigin&&Ce(i)&&(s||(s="anonymous"),r=ye(i)),this.crossOrigin=s,this.crossOriginUrl=r;var c=document.createElement("img");s&&(c.crossOrigin=s),c.src=r||i,c.alt=a.alt||"The image to crop",this.image=c,c.onload=this.start.bind(this),c.onerror=this.stop.bind(this),B(c,Xt),a.parentNode.insertBefore(c,a.nextSibling)}},{key:"start",value:function(){var a=this,i=this.image;i.onload=null,i.onerror=null,this.sizing=!0;var s=U.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(U.navigator.userAgent),r=function(f,u){T(a.imageData,{naturalWidth:f,naturalHeight:u,aspectRatio:f/u}),a.initialImageData=T({},a.imageData),a.sizing=!1,a.sized=!0,a.build()};if(!i.naturalWidth||s){var c=document.createElement("img"),d=document.body||document.documentElement;this.sizingImage=c,c.onload=function(){r(c.width,c.height),s||d.removeChild(c)},c.src=i.src,s||(c.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",d.appendChild(c))}else r(i.naturalWidth,i.naturalHeight)}},{key:"stop",value:function(){var a=this.image;a.onload=null,a.onerror=null,a.parentNode.removeChild(a),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var a=this.element,i=this.options,s=this.image,r=a.parentNode,c=document.createElement("div");c.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var d=c.querySelector(".".concat(I,"-container")),b=d.querySelector(".".concat(I,"-canvas")),f=d.querySelector(".".concat(I,"-drag-box")),u=d.querySelector(".".concat(I,"-crop-box")),g=u.querySelector(".".concat(I,"-face"));this.container=r,this.cropper=d,this.canvas=b,this.dragBox=f,this.cropBox=u,this.viewBox=d.querySelector(".".concat(I,"-view-box")),this.face=g,b.appendChild(s),B(a,k),r.insertBefore(d,a.nextSibling),this.isImg||tt(s,Xt),this.initPreview(),this.bind(),i.initialAspectRatio=Math.max(0,i.initialAspectRatio)||NaN,i.aspectRatio=Math.max(0,i.aspectRatio)||NaN,i.viewMode=Math.max(0,Math.min(3,Math.round(i.viewMode)))||0,B(u,k),i.guides||B(u.getElementsByClassName("".concat(I,"-dashed")),k),i.center||B(u.getElementsByClassName("".concat(I,"-center")),k),i.background&&B(d,"".concat(I,"-bg")),i.highlight||B(g,Ee),i.cropBoxMovable&&(B(g,zt),St(g,At,"all")),i.cropBoxResizable||(B(u.getElementsByClassName("".concat(I,"-line")),k),B(u.getElementsByClassName("".concat(I,"-point")),k)),this.render(),this.ready=!0,this.setDragMode(i.dragMode),i.autoCrop&&this.crop(),this.setData(i.data),X(i.ready)&&H(a,"ready",i.ready,{once:!0}),bt(a,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),tt(this.element,k))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ei,o}},{key:"setDefaults",value:function(a){T(ue,ft(a)&&a)}}]),o}();return T(Ve.prototype,Zt,xe,Ke,Ze,qe,ti),Ve}()}}]);