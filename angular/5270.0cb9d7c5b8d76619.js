"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[5270],{61325:(Z,j,c)=>{c.d(j,{$:()=>I});var z=c(69862),v=c(65592),E=c(61713),b=c(65879),x=c(46558),D=c(84672),T=c(77757);let I=(()=>{class _{replaceImageInContent(p,a){return new v.y(l=>{if(a.includes("<img ")){var t=this.findAllSubString(a,"<img"),m=[],d=[];t.forEach(f=>{var u=a.indexOf("src=",f),S=a.indexOf('"',Number(u)+5),C=a.substring(Number(u)+5,Number(S)+1);C.includes(";base64")?m.push({oldUrl:C}):C.includes("blob:")&&d.push({oldUrl:C})}),m.length>0?this.reUploadBase64File(p,m,(f,u)=>{null==u?d&&d.length>0?this.reUploadBlobFile(p,d,(S,C)=>{null!=C?(a=this.replaceHomeworkContent(a,f),a=this.replaceHomeworkContent(a,S),l.next({errorMessage:void 0,content:a}),l.complete()):(l.next({errorMessage:C,content:a}),l.complete())}):(a=this.replaceHomeworkContent(a,f),l.next({errorMessage:void 0,content:a}),l.complete()):(l.next({errorMessage:u,content:a}),l.complete())}):d.length>0?this.reUploadBlobFile(p,d,(f,u)=>{null==u?(a=this.replaceHomeworkContent(a,f),l.next({errorMessage:void 0,content:a}),l.complete()):(l.next({errorMessage:u,content:a}),l.complete())}):(a=this.replaceHomeworkContent(a,[]),l.next({errorMessage:void 0,content:a}),l.complete())}else l.next({errorMessage:void 0,content:a}),l.complete()})}replaceHomeworkContent(p,a){return a.length>0&&a.forEach(l=>{p=p.replace(l.oldUrl??"  ",l.newUrl+'" class="w-100 img-fluid"')}),p}findAllSubString(p,a){for(var l=0,t=0,m=[];p.indexOf(a,l)>-1;)t=p.indexOf(a,l),m.push(t),l=t+a.length;return m}getTypeFile(p){var a=p.indexOf(";");return p.substring(5,a)}getFileName(p){var a=p.split("").reverse().join(""),l=a.indexOf(";"),t=a.indexOf("/",l);return a.substring(l,t).split("").reverse().join("")}convertBlobToBase64(p){return new Promise(a=>{var l=new Image;l.crossOrigin="Anonymous",l.addEventListener("load",function(){var t=document.createElement("canvas"),m=t.getContext("2d");t.width=l.width,t.height=l.height,m?.drawImage(l,0,0);var d=t.toDataURL("image/png");a(d)},!1),l.src=p})}reUploadBase64File(p,a,l){if(a&&a.length>0){let f,d=a.length;for(var t=[],m=0;m<a.length;m++){const u=a[m],S=u.oldUrl?.substring(0,u.oldUrl.length-1);this.startUploadBlobFile(p,u,S??"",[],(C,w)=>{null==w?t=t.concat(C):f=w,d-=1,0==d&&l(t,f)})}}else l([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(p,a,l){if(a&&a.length>0){let f,d=a.length;for(var t=[],m=0;m<a.length;m++){const u=a[m],S=u?.oldUrl?.substring(0,u.oldUrl.length-1);this.convertBlobToBase64(S??"").then(C=>{this.startUploadBlobFile(p,u,C,[],(w,A)=>{null==A?t=t.concat(w):f=A,d-=1,0==d&&l(t,f)})})}}else l([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(p,a,l,t,m){if(l&&""!=l){var d=this.getTypeFile(l),f=this.myPdfService.b64toFile(l,this.getFileName(d),d);(0,E.hv)(f).then(u=>{this.apiUploadService.commonUploadFile(p,u,"").subscribe(S=>{if(S.type!=z.dt.UploadProgress)if(1==S.success){var C={...a,newUrl:S.data?.url??""};t.push(C),m(t,void 0)}else m(t,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",S.message??"none"))})})}else m(t,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(p,a,l){this.commonService=p,this.apiUploadService=a,this.myPdfService=l}}return _.\u0275fac=function(p){return new(p||_)(b.LFG(x.z),b.LFG(D.W),b.LFG(T.z))},_.\u0275prov=b.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},28368:(Z,j,c)=>{c.d(j,{y:()=>I});var z=c(20553),v=c(65879),E=c(88489);let b=(()=>{class _{getMode(){return""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light"}constructor(p){this.browserStorageService=p}}return _.\u0275fac=function(p){return new(p||_)(v.LFG(E.n))},_.\u0275prov=v.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})();var x=c(46558),D=c(61325),T=c(32965);let I=(()=>{class _{constructor(p,a,l,t){this.darkModeService=p,this.commonService=a,this.sAztUploadImageOfExamService=l,this.cdnService=t}get initConfigUrlScript(){return{language_url:z.N.azt_tiny_mce_vi_langs_src}}initConfigForAdmin(){var l={};return l={height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["code","fullscreen","link"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | link | code | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(l.skin="oxide-dark",l.content_css="dark"),l}initConfigForAdminWithUploadImageBox(p){var t={};return t={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen link",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | link | code | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,min_height:250,file_picker_callback:(m,d,f)=>{this.file_picker_callback(p,m,d,f)},content_css:[this.cdnService.convertCdnLinkOfGitHub("angular/styles.6c8c340cca20c274.css")],...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigForTeacher(){var l={};return l={height:250,min_height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",plugins:["fullscreen"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | fullscreen",...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(l.skin="oxide-dark",l.content_css="dark"),l}initConfigTeacherHomework(p){var t={};return t={min_height:p,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}initConfigStudentHomework(){var l={};return l={height:450,min_height:250,menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",readonly:1,plugins:["emoticons advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | emoticons",emoticons_database:"emojis",content_style:`@font-face { font-family: font_chu_dep; src: url('${this.cdnService.convertCdnLinkOfGitHub("fonts/HP0015HB.ttf")}');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};`,...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(l.skin="oxide-dark",l.content_css="dark"),l}initConfigForTeacherWithUploadImageBox(p){var t={};return t={selector:"textarea#file-picker",menubar:!1,language:"vi"===this.commonService.getCurrentLang()?"vi":"en",branding:!1,plugins:"image code autoresize fullscreen",toolbar:"fontsize | bold italic underline | forecolor backcolor | alignleft aligncenter alignright | image | fullscreen",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",height:250,min_height:250,file_picker_callback:(m,d,f)=>{this.file_picker_callback(p,m,d,f)},...this.initConfigUrlScript},"dark"==this.darkModeService.getMode()&&(t.skin="oxide-dark",t.content_css="dark"),t}file_picker_callback(p,a,l,t){let m=document.createElement("input");m.setAttribute("type","file"),m.setAttribute("accept","image/*"),m.onchange=()=>{let d=m.files?.[0],f=new FileReader;f.onload=()=>{let S=`<img src="${"data:image/png;base64, "+f.result.split(",")[1]}">`;this.sAztUploadImageOfExamService.replaceImageInContent(p,S).subscribe(C=>{if(C.errorMessage)this.commonService.snackError(C.errorMessage);else{let w=document.createElement("div");w.innerHTML=this.commonService.removeXssInHtml(C.content);let A=w.firstChild;A&&A.src&&a(A.src)}})},f.readAsDataURL(d)},m.click()}}return _.\u0275fac=function(p){return new(p||_)(v.LFG(b),v.LFG(x.z),v.LFG(D.$),v.LFG(T.E))},_.\u0275prov=v.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},54284:(Z,j,c)=>{c.d(j,{h:()=>b});var z=c(37734),v=c(61713),E=c(65879);let b=(()=>{class x extends z.Q{constructor(){super(...arguments),this.limitSize=200,this.selectFile=T=>{const I=T.target,_=I.files;if(_){if(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(_).find(a=>(0,v.EO)(a.size)>=this.limitSize))return this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB"));const p=[];Array.from(_).forEach(a=>{p.push(a)}),this.emitUploadToEditorComplete(p)}I.value=""}}}return x.\u0275fac=function(){let D;return function(I){return(D||(D=E.n5z(x)))(I||x)}}(),x.\u0275cmp=E.Xpm({type:x,selectors:[["ng-component"]],inputs:{fileType:"fileType",limitSize:"limitSize"},features:[E.qOj],decls:0,vars:0,template:function(T,I){},encapsulation:2}),x})()},55270:(Z,j,c)=>{c.r(j),c.d(j,{AzotaDigitalizeModule:()=>Qt});var z=c(96814),v=c(56223),E=c(12044),b=c(42753),x=c(37722),D=c(60381),T=c(95545),I=c(56731),_=c(84155),M=c(78217),p=c(24090),a=c(20553),l=c(82481),t=c(65879),m=c(37734),d=c(49671),f=c(47394),u=c(36727),S=c(46558),C=c(9e4);let w=(()=>{class i{constructor(){this.subscriptions=new f.w0,this.ocrService=(0,t.f3M)(C.Kx),this.commonService=(0,t.f3M)(S.z)}digitalizeData(e,o,n,r){if(!e.image.url)return r(e);o("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:e.image.url}).subscribe({next:g=>{o("lang_digitalize_load_detect_image_script"),this.loadScriptHandleImage(()=>{o("lang_digitalize_call_detect_image_function"),this.imageUtils.detectImage(e.image.fileBytes).then(O=>{e.image.base64Images=O.images.map(k=>({base64:this.commonService.generateBase64Prefix(k.extension)+this.uint8ArrayToBase64(new Uint8Array(k.content)),width:k.width,height:k.height}));let h=(new u.$e).transform((new u.h8).transform(g.data));h=this.commonService.replaceAll(h,"<latex>","S$$$$")??h,h=this.commonService.replaceAll(h,"</latex>","E$$$$")??h,h=this.commonService.replaceAll(h,"<table>","<table class='table table-bordered'>")??h,e.htmlResult=h,r(e)}).catch(O=>n("lang_digitalize_error_when_call_detect_image"))})},error:g=>n(g.error.message)}))}uint8ArrayToBase64(e){let o="";const n=e.byteLength;for(let r=0;r<n;r++)o+=String.fromCharCode(e[r]);return btoa(o)}waitAnswerSheetInitDone(e){if(window.azotaScanAnswerSheet)return e();setTimeout(()=>{this.waitAnswerSheetInitDone(e)},100)}loadScriptHandleImage(e){var o=this;if(this.imageUtils)return e();this.commonService.loadAnswerSheetJs().then((0,d.Z)(function*(){o.waitAnswerSheetInitDone((0,d.Z)(function*(){o.imageUtils=yield window.azotaScanAnswerSheet.imageUtils(),e()}))})).catch(n=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),e()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var A=function(i){return i[i.NONE=0]="NONE",i[i.PROCESSING=1]="PROCESSING",i[i.PROCESS_ERROR=2]="PROCESS_ERROR",i[i.PROCESSED=3]="PROCESSED",i}(A||{}),U=function(i){return i[i.CHOOSE_IMAGES=0]="CHOOSE_IMAGES",i[i.PROCESS_IMAGES=1]="PROCESS_IMAGES",i}(U||{}),B=c(43389),Q=c(98129),H=c(61713),P=c(63120),G=c(77757),K=c(2459),$=c(9769),Y=c(26306),W=c(22096),L=c(37398),V=c(69732),R=c(79360);const q=(i,s)=>(i.push(s),i);let et=(()=>{class i{processObservables(e,o){return(0,K.D)(o).pipe((0,$.z)((n,r)=>n.pipe((0,Y.K)(g=>(console.error("Error in observable:",g),(0,W.of)(null))),(0,L.U)(g=>({result:g,index:r}))),e),function tt(){return(0,R.e)((i,s)=>{(function X(i,s){return(0,R.e)((0,V.U)(i,s,arguments.length>=2,!1,!0))})(q,[])(i).subscribe(s)})}(),(0,L.U)(n=>n.sort((r,g)=>r.index-g.index).map(r=>r.result)))}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var it=c(84672),ot=c(54284),nt=c(7827);const at=["*"];let rt=(()=>{class i extends ot.h{constructor(){super(...arguments),this.emitFiles=new t.vpe}emitUploadToEditorComplete(e){e.length>0&&this.emitFiles.emit(e)}onDrop(e){try{this.emitFiles.emit(e)}catch(o){alert(o)}}}return i.\u0275fac=function(){let s;return function(o){return(s||(s=t.n5z(i)))(o||i)}}(),i.\u0275cmp=t.Xpm({type:i,selectors:[["azt-upload-multiple-document-to-editor"]],outputs:{emitFiles:"emitFiles"},features:[t.qOj],ngContentSelectors:at,decls:5,vars:2,consts:[[1,"upload-document","h-full",3,"appDropZone","click"],[3,"hidden"],["type","file","multiple","",1,"form-control","file-input",3,"accept","change"],["fileSelect",""]],template:function(e,o){if(1&e){const n=t.EpF();t.F$t(),t.TgZ(0,"div",0),t.NdJ("appDropZone",function(g){return o.onDrop(g)})("click",function(){t.CHM(n);const g=t.MAs(3);return t.KtG(g.click())}),t.TgZ(1,"form",1)(2,"input",2,3),t.NdJ("change",function(g){return o.selectFile(g)}),t.qZA()(),t.Hsn(4),t.qZA()}2&e&&(t.xp6(1),t.Q6J("hidden",!0),t.xp6(1),t.s9C("accept",o.fileType))},dependencies:[v._Y,v.JL,v.F,nt.i],encapsulation:2}),i})();function lt(i,s){if(1&i&&t._UZ(0,"azt-loading-effect",2),2&i){const e=t.oxw();t.Q6J("currentStatusObj",e.statusObj)("customText",e.statusObj.errorMessage)}}const st=function(i,s){return[i,s]};function ct(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"azt-upload-multiple-document-to-editor",3),t.NdJ("emitFiles",function(n){t.CHM(e);const r=t.oxw();return t.KtG(r.handleUploadComplete(n))}),t.TgZ(1,"a",4),t.O4$(),t.TgZ(2,"svg",5),t._UZ(3,"line",6)(4,"line",7),t.qZA(),t.kcU(),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"mytranslate"),t.qZA()()()}if(2&i){const e=t.oxw();t.Q6J("fileType",t.WLB(4,st,e.allUploadFileTypes.PDF,e.allUploadFileTypes.IMAGE)),t.xp6(6),t.Oqu(t.lcZ(7,2,"lang_digitalize_book_upload_file"))}}let pt=(()=>{class i extends m.Q{handleUploadComplete(e){this.initStatusObj("lang_digitalize_convert_pdf_to_images"),this.convertAllPdfToImages(e).then(o=>{let n=[];o.forEach(r=>{let g=this.apiUploadService.commonUploadFile(this.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE,r,"");n.push(g)}),this.initStatusObj("lang_digitalize_upload_images_to_cdn"),this.sAztConcurrencyApiService.processObservables(this.uploadThread,n).subscribe(r=>{if(r.find(y=>!y?.success))return this.errorStatusObj("lang_digitalize_book_upload_file_error",!0);let O=[],h=r.map(y=>y?.data).filter(this.commonService.notEmpty),k=o.map(y=>this.convertFileToUint8Array(y));this.initStatusObj("lang_digitalize_convert_file_to_byte_array"),Promise.all(k).then(y=>{h.forEach((J,F)=>{let N=this.commonService.getItemAtIndexOfArray(y,F);if(null==N)throw Error("lang_digitalize_missing_file_byte_array");O.push({...J,fileBytes:N,base64Images:[]})}),this.stopStatusObj(),this.uploadData.emit(O)}).catch(y=>console.error("lang_digitalize_convert_to_uint8_array_error: ",y))})})}convertAllPdfToImages(e){var o=this;let n=[];return e.forEach(r=>{if((0,H.Or)(r.type))return void n.push(new Promise(function(){var O=(0,d.Z)(function*(h,k){h([r])});return function(h,k){return O.apply(this,arguments)}}()));let g=new Promise(function(){var O=(0,d.Z)(function*(h,k){let y=[],F=yield o.withTimeout(o.myPdfService.getImageWithPdf(r),3e5);y.push(...F),h(y)});return function(h,k){return O.apply(this,arguments)}}());n.push(g)}),new Promise(function(){var r=(0,d.Z)(function*(g,O){Promise.all(n).then(h=>{g(o.commonService.concatMultipleArray(h))}).catch(h=>{o.showErrorSnack("lang_azt_pdf_invalid_format"),g([])})});return function(g,O){return r.apply(this,arguments)}}())}withTimeout(e,o){return new Promise((n,r)=>{const g=setTimeout(()=>{r(new Error("Operation timed out"))},o);e.then(O=>{clearTimeout(g),n(O)}).catch(O=>{clearTimeout(g),r(O)})})}convertFileToUint8Array(e){return new Promise((o,n)=>{const r=new FileReader;r.onload=()=>{if(r.result instanceof ArrayBuffer){const g=new Uint8Array(r.result);o(g)}else n(new Error("Error reading file as ArrayBuffer."))},r.onerror=()=>{n(new Error("Error reading file."))},r.readAsArrayBuffer(e)})}ngOnInit(){super.ngOnInit()}constructor(e,o,n){super(),this.myPdfService=e,this.sAztConcurrencyApiService=o,this.apiUploadService=n,this.uploadData=new t.vpe,this.allUploadToCdnMenuTypes=P.j6,this.allUploadFileTypes=P.AZ,this.uploadThread=10}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(G.z),t.Y36(et),t.Y36(it.W))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-pdf-to-images"]],outputs:{uploadData:"uploadData"},features:[t.qOj],decls:3,vars:2,consts:[[3,"currentStatusObj","customText",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj","customText"],[3,"fileType","emitFiles"],[1,"btn","btn-primary-soft","w-full"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"]],template:function(e,o){if(1&e&&(t.YNc(0,lt,1,2,"azt-loading-effect",0),t.YNc(1,ct,8,7,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",n)}},dependencies:[z.O5,B.l,rt,u.JV],encapsulation:2}),i})();const gt=function(i){return{"mb-2":i}},mt=function(i){return{"border-pending":i}};function dt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"span",5),t._uU(2),t.qZA(),t.TgZ(3,"img",6),t.NdJ("click",function(){const r=t.CHM(e).$implicit,g=t.oxw();return t.KtG(g.chooseImageEvent(r))}),t.qZA()()}if(2&i){const e=s.$implicit,o=s.last,n=t.oxw();t.Q6J("ngClass",t.VKq(4,gt,!o)),t.xp6(2),t.Oqu(e.position),t.xp6(1),t.Q6J("src",e.image.url,t.LSH)("ngClass",t.VKq(6,mt,n.listSelectedPositions.includes(e.position)))}}let ut=(()=>{class i extends m.Q{chooseImageEvent(e){let o=this.objs.find(n=>n.position==e.position);o&&(o.isSelected=!o.isSelected,this.listSelectedPositions=this.objs.filter(n=>n.isSelected).map(n=>n.position),this.chooseImages.emit(this.objs.filter(n=>n.isSelected)))}ngOnInit(){super.ngOnInit(),this.listSelectedPositions=this.objs.filter(e=>e.isSelected).map(e=>e.position)}constructor(){super(),this.chooseImages=new t.vpe,this.listSelectedPositions=[]}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-choose-images"]],inputs:{objs:"objs"},outputs:{chooseImages:"chooseImages"},features:[t.qOj],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"ng-scrollbar",2),t.YNc(5,dt,4,8,"div",3),t.qZA()()),2&e&&(t.xp6(2),t.AsE("",t.lcZ(3,4,"lang_digitalize_book_total_page"),": ",o.objs.length,""),t.xp6(2),t.Q6J("visibility","hover"),t.xp6(1),t.Q6J("ngForOf",o.objs))},dependencies:[z.mk,z.sg,T.KC,u.JV],encapsulation:2}),i})();const _t=function(i){return{"mb-2":i}},ft=function(i){return{"border-pending":i}};function ht(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"span",5),t._uU(2),t.qZA(),t.TgZ(3,"img",6),t.NdJ("click",function(){const r=t.CHM(e).$implicit,g=t.oxw();return t.KtG(g.processImage.emit(r))}),t.qZA()()}if(2&i){const e=s.$implicit,o=s.last,n=t.oxw();t.Q6J("ngClass",t.VKq(4,_t,!o)),t.xp6(2),t.Oqu(e.position),t.xp6(1),t.Q6J("src",e.image.url,t.LSH)("ngClass",t.VKq(6,ft,(null==n.currentObj?null:n.currentObj.position)==e.position))}}let vt=(()=>{class i extends m.Q{ngOnInit(){super.ngOnInit(),this.viewObjs=this.objs.filter(e=>e.isSelected)}constructor(){super(),this.processImage=new t.vpe,this.viewObjs=[]}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-process-images"]],inputs:{objs:"objs",currentObj:"currentObj"},outputs:{processImage:"processImage"},features:[t.qOj],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"ng-scrollbar",2),t.YNc(5,ht,4,8,"div",3),t.qZA()()),2&e&&(t.xp6(2),t.AsE("",t.lcZ(3,4,"lang_digitalize_book_total_page"),": ",o.viewObjs.length,""),t.xp6(2),t.Q6J("visibility","hover"),t.xp6(1),t.Q6J("ngForOf",o.viewObjs))},dependencies:[z.mk,z.sg,T.KC,u.JV],encapsulation:2}),i})();var Ct=c(28368);function Ot(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"img",10),t.NdJ("click",function(){const r=t.CHM(e).$implicit,g=t.oxw(2);return t.KtG(g.chooseImages(r))}),t.qZA(),t.BQk()}if(2&i){const e=s.$implicit;t.xp6(1),t.s9C("src",e.base64,t.LSH)}}function zt(i,s){if(1&i&&(t.TgZ(0,"div",8),t.YNc(1,Ot,2,1,"ng-container",9),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.obj.image.base64Images)}}function St(i,s){if(1&i&&(t.TgZ(0,"div",11)(1,"div",5),t._UZ(2,"editor",12),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.s9C("apiKey",e.tinyEditorKey),t.Q6J("formControl",e.htmlFormControl)("init",e.initDataEditor),t.uIk("style","width: 100%;min-height:300px;",t.Ckj)}}const At=function(i,s){return{"col-span-6":i,"col-span-12":s}};let xt=(()=>{class i extends m.Q{constructor(){super(...arguments),this.changeObj=new t.vpe,this.htmlFormControl=new v.NI("",{nonNullable:!0}),this.initDataEditor={},this.tinyEditorKey=a.N.tinyEditorKey,this.showTinyMceEditor=!1,this.tinyMceService=(0,t.f3M)(Ct.y)}chooseImages(e){this.obj.htmlResult=this.obj.htmlResult.replace("<img>",`<img src='${e.base64}'/>`),this.htmlFormControl.setValue(this.obj.htmlResult)}ngOnInit(){this.htmlFormControl.setValue(this.obj.htmlResult),this.htmlFormControl.valueChanges.subscribe(()=>{this.obj.htmlResult=this.htmlFormControl.getRawValue(),this.changeObj.emit(this.obj)}),this.initDataEditor=this.tinyMceService.initConfigForAdminWithUploadImageBox(P.j6.ADMIN)}}return i.\u0275fac=function(){let s;return function(o){return(s||(s=t.n5z(i)))(o||i)}}(),i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-preview-result"]],inputs:{obj:"obj"},outputs:{changeObj:"changeObj"},features:[t.qOj],decls:13,vars:16,consts:[[1,"text-right"],[1,"mb-3","mr-2","btn","btn-primary","end-flex",3,"click"],["class","box p-3 mb-3 list-base640-images",4,"ngIf"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-6",3,"ngClass"],[1,"box","p-3"],[3,"innerHTML"],["class","col-span-6",4,"ngIf"],[1,"box","p-3","mb-3","list-base640-images"],[4,"ngFor","ngForOf"],[1,"mr-2","mb-2","box","clickable",3,"src","click"],[1,"col-span-6"],[3,"formControl","apiKey","init"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"span",1),t.NdJ("click",function(){return o.showTinyMceEditor=!o.showTinyMceEditor}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()(),t.YNc(4,zt,2,1,"div",2),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5),t._UZ(8,"div",6),t.ALo(9,"safeNormalHtmlContent"),t.ALo(10,"async"),t.ALo(11,"mathJaxContent"),t.qZA()(),t.YNc(12,St,3,4,"div",7),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,5,"lang_digitalize_show_tinymce_editor")),t.xp6(2),t.Q6J("ngIf",o.obj.image.base64Images.length>0),t.xp6(2),t.Q6J("ngClass",t.WLB(13,At,o.showTinyMceEditor,!o.showTinyMceEditor)),t.xp6(2),t.Q6J("innerHTML",t.lcZ(9,7,t.lcZ(10,9,t.lcZ(11,11,o.obj.htmlResult))),t.oJD),t.xp6(4),t.Q6J("ngIf",o.showTinyMceEditor))},dependencies:[z.mk,z.sg,z.O5,v.JJ,b.PG,v.oH,z.Ov,u.JV,u.Pc,u.fF],styles:[".list-base640-images[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px}"]}),i})();function bt(i,s){if(1&i&&t._UZ(0,"azt-loading-effect",4),2&i){const e=t.oxw();t.Q6J("currentStatusObj",e.statusObj)}}function yt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-digitalize-pdf-to-images",16),t.NdJ("uploadData",function(n){t.CHM(e);const r=t.oxw(2);return t.KtG(r.uploadData(n))}),t.qZA()}}function Et(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",17),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.showChooseLayout())}),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()}2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_digitalize_book_go_back_choose_layout")))}function Tt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-digitalize-choose-images",21),t.NdJ("chooseImages",function(n){t.CHM(e);const r=t.oxw(3);return t.KtG(r.chooseImages(n))}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("objs",e.objs)}}function It(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-digitalize-process-images",22),t.NdJ("processImage",function(n){t.CHM(e);const r=t.oxw(3);return t.KtG(r.processImage(n))}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("objs",e.objs)("currentObj",e.currentObj)}}function Dt(i,s){if(1&i&&(t.TgZ(0,"div",18),t.YNc(1,Tt,1,1,"app-digitalize-choose-images",19),t.YNc(2,It,1,2,"app-digitalize-process-images",20),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.CHOOSE_IMAGES),t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.PROCESS_IMAGES)}}function kt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"div",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(3);return t.KtG(n.startProcess())}),t._uU(2),t.ALo(3,"mytranslate"),t.ALo(4,"mytranslate"),t.qZA()()}if(2&i){const e=t.oxw(3);t.xp6(2),t.lnq("",t.lcZ(3,3,"lang_digitalize_book_start_call_orc_api")," (",e.totalSelected," ",t.lcZ(4,5,"lang_digitalize_book_total_images"),")")}}function wt(i,s){1&i&&(t._uU(0),t.ALo(1,"mytranslate")),2&i&&t.hij(" ",t.lcZ(1,1,"lang_digitalize_book_please_choose_image")," ")}function jt(i,s){if(1&i&&(t.ynx(0),t.TgZ(1,"div",18),t.YNc(2,kt,5,7,"div",23),t.YNc(3,wt,2,3,"ng-template",null,24,t.W1O),t.qZA(),t.BQk()),2&i){const e=t.MAs(4),o=t.oxw(2);t.xp6(2),t.Q6J("ngIf",o.totalSelected>0)("ngIfElse",e)}}function Mt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"span",25),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(4);return t.KtG(n.processAgain(n.currentObj))}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()}2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"lang_digitalize_book_call_ocr_again")))}function Ut(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"app-digitalize-preview-result",26),t.NdJ("changeObj",function(n){t.CHM(e);const r=t.oxw(4);return t.KtG(r.changeObj(n))}),t.qZA()()}if(2&i){const e=t.oxw(4);t.xp6(1),t.Q6J("obj",e.currentObj)}}function Zt(i,s){if(1&i&&t._UZ(0,"azt-loading-effect",28),2&i){const e=t.oxw(5);t.Q6J("currentStatusObj",e.processStatusObj)("customText",e.processStatusObj.errorMessage)}}function Pt(i,s){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Zt,1,2,"azt-loading-effect",27),t.qZA()),2&i){const e=t.oxw(4);t.xp6(1),t.Q6J("ngIf",e.processStatusObj.loading)}}function Ft(i,s){if(1&i&&(t.ynx(0),t.YNc(1,Mt,4,3,"div",15),t.YNc(2,Ut,2,1,"div",15),t.YNc(3,Pt,2,1,"div",15),t.BQk()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.currentObj.processStatus==e.allProcessStatuses.PROCESS_ERROR),t.xp6(1),t.Q6J("ngIf",e.currentObj.processStatus==e.allProcessStatuses.PROCESSED),t.xp6(1),t.Q6J("ngIf",e.currentObj.processStatus==e.allProcessStatuses.NONE||e.currentObj.processStatus==e.allProcessStatuses.PROCESSING)}}function Bt(i,s){1&i&&(t.ynx(0),t.TgZ(1,"div",18),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.BQk()),2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"lang_digitalize_book_please_choose_image")))}function Lt(i,s){if(1&i&&(t.ynx(0),t.YNc(1,Ft,4,3,"ng-container",15),t.YNc(2,Bt,4,3,"ng-container",15),t.BQk()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.currentObj),t.xp6(1),t.Q6J("ngIf",!e.currentObj)}}function Rt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),t.YNc(4,yt,1,0,"app-digitalize-pdf-to-images",9),t.YNc(5,Et,3,3,"div",10),t.qZA(),t.TgZ(6,"div",11)(7,"div",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.downloadData("html"))}),t._uU(8),t.ALo(9,"mytranslate"),t.qZA()(),t.TgZ(10,"div",11)(11,"div",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.downloadData("docx"))}),t._uU(12),t.ALo(13,"mytranslate"),t.qZA()()(),t.YNc(14,Dt,3,2,"div",13),t.qZA(),t.TgZ(15,"div",14),t.YNc(16,jt,5,2,"ng-container",15),t.YNc(17,Lt,3,2,"ng-container",15),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.currentLayout==e.allLayouts.CHOOSE_IMAGES),t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.PROCESS_IMAGES),t.xp6(3),t.Oqu(t.lcZ(9,7,"lang_digitalize_book_download_result_html")),t.xp6(4),t.Oqu(t.lcZ(13,9,"lang_digitalize_book_download_result_docx")),t.xp6(2),t.Q6J("ngIf",e.objs.length>0),t.xp6(2),t.Q6J("ngIf",e.currentLayout==e.allLayouts.CHOOSE_IMAGES),t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.PROCESS_IMAGES)}}const Jt=[{path:"",children:[{path:"digitalize-book",component:(()=>{class i extends m.Q{startProcess(){this.currentLayout=U.PROCESS_IMAGES;let e=this.objs.filter(o=>o.isSelected);this.currentObj=this.commonService.getFirstOfArray(e),this.callOrcApi(e,0)}processAgain(e){this.callOrcApi([e],0)}callOrcApi(e,o=0){let n=this.commonService.getItemAtIndexOfArray(e,o),r=this.objs.find(g=>g.position==n?.position);if(null!=r&&null!=n)return r.processStatus==A.PROCESSING||r.processStatus==A.PROCESSED?this.callOrcApi(e,o+1):(r.processStatus=A.PROCESSING,void this.sAztDigitalizeService.digitalizeData(r,g=>{this.processStatusObj={loading:!0,errorMessage:g,mustShowErrorBox:!1}},g=>{r.processStatus=A.PROCESS_ERROR,this.replaceCurrentObj(r),this.callOrcApi(e,o+1)},g=>{r={...g,processStatus:A.PROCESSED},this.replaceCurrentObj(r),this.callOrcApi(e,o+1)}));this.processStatusObj.loading=!1}replaceCurrentObj(e){let o=this.objs.find(n=>n.position==e.position);null!=o&&(Object.assign(o,e),o.position==this.currentObj?.position&&Object.assign(this.currentObj,e))}chooseImages(e){let o=e.map(n=>n.position);this.objs.forEach(n=>n.isSelected=!!o.includes(n.position)||n.isSelected),this.totalSelected=this.objs.filter(n=>n.isSelected).length}processImage(e){let o=this.objs.find(n=>n.position==e.position);o&&(this.currentObj=o)}showChooseLayout(){this.currentLayout=U.CHOOSE_IMAGES}changeObj(e){let o=this.objs.find(n=>n.position==e.position);o&&(o={...e})}uploadData(e){this.objs=e.map((o,n)=>({image:o,htmlResult:"",position:n+1,isSelected:!1,processStatus:A.NONE}))}downloadData(e){let o=new Date,n="";if(this.objs.forEach(r=>{n+=`<page [page]='${r.position}'/>`+(r.processStatus==A.PROCESSED?r.htmlResult:"")}),n=this.commonService.decodeHtmlEntities(n),"html"!=e)n=this.commonService.replaceAll(n,"S$$","<latex>")??n,n=this.commonService.replaceAll(n,"E$$","</latex>")??n,this.commonService.loadAzotaDocxJs().then(()=>{azotaDocx.textToDocxBinary(n,null).then(r=>{let g=`azota-digitalize-book-${o.getDate()}${o.getMonth()+1}${o.getFullYear()}-${o.getTime()}.docx`;const O=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});O&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(O),g)}).catch(r=>{this.showErrorSnack(r)})}).catch(r=>{this.showErrorSnack(r)});else{let r=`azota-digitalize-book-${o.getDate()}${o.getMonth()+1}${o.getFullYear()}-${o.getTime()}.html`;const g=new Blob([n],{type:"text/plain"});g&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(g),r)}}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_book",description:"lang_cms_admin_common_digitalize_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(){super(),this.sAztDigitalizeService=(0,t.f3M)(w),this.processStatusObj={loading:!1,errorMessage:"",mustShowErrorBox:!1},this.headerBackTo="",this.objs=[],this.totalSelected=0,this.currentLayout=U.CHOOSE_IMAGES,this.allLayouts=U,this.allProcessStatuses=A}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-book"]],features:[t.qOj],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-3"],[1,"box","p-3","mb-3","grid","grid-cols-12","gap-2"],[1,"col-span-12"],[3,"uploadData",4,"ngIf"],["class","btn btn-primary-soft w-full",3,"click",4,"ngIf"],[1,"col-span-6"],[1,"btn","btn-primary","w-full",3,"click"],["class","box p-3",4,"ngIf"],[1,"col-span-9"],[4,"ngIf"],[3,"uploadData"],[1,"btn","btn-primary-soft","w-full",3,"click"],[1,"box","p-3"],[3,"objs","chooseImages",4,"ngIf"],[3,"objs","currentObj","processImage",4,"ngIf"],[3,"objs","chooseImages"],[3,"objs","currentObj","processImage"],[4,"ngIf","ngIfElse"],["notSelectAnyObj",""],[1,"mb-3","btn","btn-pending",3,"click"],[3,"obj","changeObj"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"currentStatusObj","customText"]],template:function(e,o){if(1&e&&(t.TgZ(0,"teacher-layout",0)(1,"div",1),t.YNc(2,bt,1,1,"azt-loading-effect",2),t.YNc(3,Rt,18,11,"ng-template",null,3,t.W1O),t.qZA()()),2&e){const n=t.MAs(4);t.Q6J("headerBackToLink",o.headerBackTo),t.xp6(2),t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",n)}},dependencies:[z.O5,B.l,Q._,pt,ut,vt,xt,u.JV],encapsulation:2}),i})()}]}];let Nt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[E.Bz.forChild(Jt),E.Bz,l.fQ]}),i})(),Qt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[{provide:b.f8,useValue:a.N.azt_tiny_mce_script_src}],imports:[E.Bz,z.ez,v.u5,b.Z_,I.j,v.UX,Nt,p.W,_.Z,T.kb,M.d,x.qyJ.pick(x.ciZ),D.l1]}),i})()}}]);