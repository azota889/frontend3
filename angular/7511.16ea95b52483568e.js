(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7511],{33733:(I,D,r)=>{"use strict";r.r(D),r.d(D,{HomeworkModule:()=>_t});var x=r(96814),c=r(56223),S=r(19347),w=r(12044),n=r(42753),d=r(37722),k=r(21494),f=r(95545),O=r(56731),h=r(84155),v=r(78217),M=r(35529),y=r(24090),j=r(20553),J=r(82481),P=r(71026),T=r(29023),H=r(73445),E=r(23680),Z=r(52572),ge=r(44683),pe=r(13217),fe=r(76359),q=r(84003),L=r(37734),_e=r(47180),ke=r(91765),be=r(15828),z=r(63120),e=r(65879),V=r(28368),U=r(2783),N=r(78820),R=r(85929),we=r(78953),ve=r(13978),xe=r(71069),ye=r(71518),$=r(32296),Se=r(2032),F=r(64170),X=r(92596),B=r(43389),G=r(67679),Oe=r(68547),je=r(32443),ee=r(98129),A=r(36727);const Me=["startTime"],Ce=["endTime"];function De(o,u){if(1&o&&e._UZ(0,"azt-loading-effect",3),2&o){const t=e.oxw();e.Q6J("currentStatusObj",t.statusObj)}}function Te(o,u){1&o&&(e.TgZ(0,"div",89),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"lang_auto_vui_long_nhap_ten_bai_tap")," "))}function Ae(o,u){1&o&&(e.TgZ(0,"div",90),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"lang_testbank_test_config_end_time_bigger_time_star"),". "))}function Ze(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"div",91)(1,"button",92),e.NdJ("click",function(){const s=e.CHM(t).index,p=e.oxw(2);return e.KtG(!!p.formHomework.files&&p.formHomework.files.splice(s,1))}),e.O4$(),e.TgZ(2,"svg",28),e._UZ(3,"line",93)(4,"line",94),e.qZA()(),e.kcU(),e.TgZ(5,"a",95),e.NdJ("click",function(){const s=e.CHM(t).$implicit,p=e.oxw(2);return e.KtG(p.onShowFile(s,-1))}),e.TgZ(6,"span",96),e._uU(7),e.qZA()()()}if(2&o){const t=u.$implicit;e.xp6(6),e.Q6J("title",t.name),e.xp6(1),e.Oqu(t.name)}}const Ie=function(o){return[o]},Ne=function(){return{standalone:!0}};function Ee(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"h3",8),e._uU(5),e.ALo(6,"mytranslate"),e.qZA(),e.TgZ(7,"div",9)(8,"div",10)(9,"div",11)(10,"label",12),e._uU(11),e.ALo(12,"mytranslate"),e.qZA()(),e.TgZ(13,"div",11)(14,"div",13),e._UZ(15,"input",14),e.ALo(16,"mytranslate"),e.qZA(),e.YNc(17,Te,3,3,"div",15),e.qZA()(),e.TgZ(18,"div",16)(19,"div",17)(20,"label",18),e._uU(21),e.ALo(22,"mytranslate"),e.O4$(),e.TgZ(23,"svg",19),e.ALo(24,"mytranslate"),e._UZ(25,"circle",20)(26,"line",21)(27,"line",22),e.qZA()()(),e.kcU(),e.TgZ(28,"div",17)(29,"div",23)(30,"div",24)(31,"mat-form-field",25)(32,"input",26),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.openDateTimePicker(1))}),e.ALo(33,"mytranslate"),e.qZA(),e.TgZ(34,"button",27),e.NdJ("click",function(a){return e.CHM(t),e.oxw().openDateTimePicker(1),e.KtG(a.stopPropagation())}),e.O4$(),e.TgZ(35,"svg",28),e._UZ(36,"path",29)(37,"path",30)(38,"path",31)(39,"path",32)(40,"path",33)(41,"path",34),e.qZA()(),e.kcU(),e.TgZ(42,"ngx-mat-datetime-picker",35,36)(44,"ngx-mat-datepicker-actions")(45,"button",37),e._uU(46),e.ALo(47,"mytranslate"),e.qZA(),e.TgZ(48,"button",38),e._uU(49,"OK"),e.qZA()()()()(),e.TgZ(50,"div",24)(51,"mat-form-field",25)(52,"input",39),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.openDateTimePicker(0))}),e.ALo(53,"mytranslate"),e.qZA(),e.TgZ(54,"button",40),e.NdJ("click",function(a){return e.CHM(t),e.oxw().openDateTimePicker(0),e.KtG(a.stopPropagation())}),e.O4$(),e.TgZ(55,"svg",28),e._UZ(56,"path",29)(57,"path",30)(58,"path",31)(59,"path",32)(60,"path",33)(61,"path",34),e.qZA()(),e.kcU(),e.TgZ(62,"ngx-mat-datetime-picker",35,41)(64,"ngx-mat-datepicker-actions")(65,"button",37),e._uU(66),e.ALo(67,"mytranslate"),e.qZA(),e.TgZ(68,"button",38),e._uU(69,"OK"),e.qZA()()()()(),e.TgZ(70,"div",42)(71,"button",43),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.clearTime())}),e.O4$(),e.TgZ(72,"svg",44),e._UZ(73,"path",45)(74,"path",46)(75,"path",47)(76,"path",48),e.qZA(),e._uU(77),e.ALo(78,"mytranslate"),e.qZA()()(),e.kcU(),e.TgZ(79,"div",49)(80,"div",50),e._uU(81),e.ALo(82,"mytranslate"),e.qZA(),e.YNc(83,Ae,3,3,"div",51),e.qZA()()(),e.TgZ(84,"div",52)(85,"div",11)(86,"h3",53),e._uU(87),e.ALo(88,"mytranslate"),e.qZA()(),e.TgZ(89,"div",54)(90,"azt-upload-multiple-box",55),e.NdJ("uploadComplete",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.handleUploadComplete(a))}),e.TgZ(91,"a",56),e.O4$(),e.TgZ(92,"svg",57),e._UZ(93,"line",58)(94,"line",59),e.qZA(),e.kcU(),e.TgZ(95,"span"),e._uU(96),e.ALo(97,"mytranslate"),e.qZA()()(),e.TgZ(98,"div",60),e._uU(99),e.ALo(100,"mytranslate"),e.qZA(),e.YNc(101,Ze,8,2,"div",61),e.TgZ(102,"editor",62),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.formHomework.content=a)}),e.qZA()()(),e.TgZ(103,"div",63)(104,"div",64)(105,"label",65),e._uU(106),e.ALo(107,"mytranslate"),e.qZA()(),e.TgZ(108,"div",66)(109,"div",67)(110,"div",68),e._UZ(111,"input",69),e.TgZ(112,"label",70),e._uU(113),e.ALo(114,"mytranslate"),e.qZA()(),e.TgZ(115,"div",71),e._UZ(116,"input",72),e.TgZ(117,"label",73),e._uU(118),e.ALo(119,"mytranslate"),e.qZA()()()()(),e.TgZ(120,"div",74)(121,"div",64)(122,"label",65),e._uU(123),e.ALo(124,"mytranslate"),e.qZA()(),e.TgZ(125,"div",66)(126,"div",67)(127,"div",68),e._UZ(128,"input",75),e.TgZ(129,"label",76),e._uU(130),e.ALo(131,"mytranslate"),e.qZA()(),e.TgZ(132,"div",71),e._UZ(133,"input",77),e.TgZ(134,"label",78),e._uU(135),e.ALo(136,"mytranslate"),e.qZA()()()()(),e.TgZ(137,"div",79)(138,"div",80)(139,"div",81),e._uU(140),e.ALo(141,"mytranslate"),e.qZA()(),e.TgZ(142,"div",82)(143,"div",83),e._UZ(144,"azt-list-classroom-checkbox",84),e.qZA()()()(),e.TgZ(145,"div",85)(146,"div",86)(147,"button",87),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.saveHomework(0))}),e._uU(148),e.ALo(149,"mytranslate"),e.qZA(),e.TgZ(150,"button",88),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.saveHomework(1))}),e._uU(151),e.ALo(152,"mytranslate"),e.qZA()()()()()()()}if(2&o){const t=e.MAs(43),i=e.MAs(63),a=e.oxw();e.xp6(1),e.Q6J("formGroup",a.form),e.xp6(4),e.hij(" ",e.lcZ(6,45,"lang_auto_tao_bai_tap_moi")," "),e.xp6(6),e.hij(" ",e.lcZ(12,47,"lang_auto_ten")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(16,49,"lang_auto_nhap_ten")+" ..."),e.xp6(2),e.Q6J("ngIf",a.form.controls.homeworkName.errors),e.xp6(4),e.hij(" ",e.lcZ(22,51,"lang_testbank_test_config_time_assigne_homework")," "),e.xp6(2),e.s9C("matTooltip",e.lcZ(24,53,"lang_homework_add_home_work_startDate_introduce")),e.xp6(9),e.s9C("placeholder",e.lcZ(33,55,"lang_auto_tu")),e.Q6J("max",a.maxDate)("ngxMatDatetimePicker",t),e.xp6(10),e.Q6J("touchUi",!0),e.xp6(4),e.Oqu(e.lcZ(47,57,"lang_auto_dong")),e.xp6(6),e.s9C("placeholder",e.lcZ(53,59,"lang_auto_den")),e.Q6J("max",a.maxDate)("ngxMatDatetimePicker",i),e.xp6(10),e.Q6J("touchUi",!0),e.xp6(4),e.Oqu(e.lcZ(67,61,"lang_auto_dong")),e.xp6(11),e.hij(" ",e.lcZ(78,63,"lang_auto_dat_lai")," "),e.xp6(4),e.hij("",e.lcZ(82,65,"lang_auto_bo_trong_neu_khong_muon_gioi_han_thoi_gian"),"."),e.xp6(2),e.Q6J("ngIf",a.calculatorTimeValidate(a.form.controls.homeworkDeadline.value,a.form.controls.homeworkStartDate.value)<=0),e.xp6(4),e.hij(" ",e.lcZ(88,67,"lang_auto_noi_dung")," "),e.xp6(3),e.Q6J("uploadToCdnMenu",a.allUploadToCdnMenuTypes.HOMEWORK)("fileType",e.VKq(91,Ie,a.allUploadFileTypes.SYNTHETIC))("notSupportedFile",a.notSupportedFile.WMV),e.xp6(6),e.Oqu(e.lcZ(97,69,"lang_homework_add_home_work_add_file_homework")),e.xp6(3),e.Oqu(e.lcZ(100,71,"lang_cms_add_homework_input_file")),e.xp6(2),e.Q6J("ngForOf",a.formHomework.files),e.xp6(1),e.s9C("apiKey",a.tinyEditorKey),e.Q6J("ngModel",a.formHomework.content)("ngModelOptions",e.DdM(93,Ne))("init",a.initDataEditor),e.xp6(4),e.hij(" ",e.lcZ(107,73,"lang_auto_cho_xem_ket_qua")," "),e.xp6(7),e.hij(" ",e.lcZ(114,75,"lang_auto_khong")," "),e.xp6(5),e.hij(" ",e.lcZ(119,77,"lang_auto_co")," "),e.xp6(5),e.hij(" ",e.lcZ(124,79,"lang_auto_dang_nhap_de_nop_bai")," "),e.xp6(7),e.hij(" ",e.lcZ(131,81,"lang_auto_khong")," "),e.xp6(5),e.hij(" ",e.lcZ(136,83,"lang_auto_co")," "),e.xp6(5),e.hij(" ",e.lcZ(141,85,"lang_auto_giao_cho_lop")," "),e.xp6(4),e.Q6J("form",a.form)("classroomGroupData",a.classroomWithGroup)("permissionName",a.permissionTypes.homework),e.xp6(3),e.Q6J("disabled",a.form.invalid||a.checkDeadLineValid(a.form.controls.homeworkStartDate.value,a.form.controls.homeworkDeadline.value)<=0),e.xp6(1),e.hij(" ",e.lcZ(149,87,"lang_auto_luu_nhap")," "),e.xp6(2),e.Q6J("disabled",a.form.invalid||a.checkDeadLineValid(a.form.controls.homeworkStartDate.value,a.form.controls.homeworkDeadline.value)<=0),e.xp6(1),e.hij(" ",e.lcZ(152,89,"lang_auto_xuat_ban")," ")}}let Le=(()=>{class o extends L.Q{clearTime(){this.form.controls.homeworkDeadline.setValue(""),this.form.controls.homeworkStartDate.setValue("")}checkDeadLineValid(t,i){return""!=t&&""!=i?this.timeService.getDiffFromTwoDateWithZeroSecond(i,t):1}calculatorTimeValidate(t,i){return""!=t&&""!=i?this.timeService.calculationHomeworkTimeWithZeroSecond(t,i):1}handleUploadComplete(t){this.formHomework.files?.push(...t)}onShowFile(t,i){let a={...t,index:i};this.sAztDialogService.open(be.q,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:a},restoreFocus:!1})}openDateTimePicker(t){1==t?this.startTime&&this.startTime.open():this.endTime&&this.endTime.open()}saveHomework(t){this.initStatusObj(),this.homeWorkContent=this.formHomework.content??"",this.uploadImageOfHomeworkService.replaceImageInContent(this.homeWorkContent).subscribe(i=>{null==i.errorMessage?(this.homeWorkContent=i.content,this.callApiToSaveHomework(t)):(this.showErrorSnack(i.errorMessage),this.stopStatusObj())})}callApiToSaveHomework(t){let i=this.form.getRawValue(),a=i.homeworkStartDate?this.timeService.formatDateTimeToPostToServer(i.homeworkStartDate):void 0,s=i.homeworkDeadline?this.timeService.formatDateTimeToPostToServer(i.homeworkDeadline):void 0,p="1"!=i.mustVerified?0:1,m="1"!=i.whenShowAnswer?0:1;this.homeWorkContent=this.zipDataService.convertContentGzip(this.homeWorkContent);let _=this.userService.getUserObj(),l=JSON.stringify({type:"homework",id:0,user:_.id});const g=this.sAztClassroomCheckboxService.getClassroomIdsCheckedInGroup(this.form.controls.classroomFormArray);let b={name:i.homeworkName,content:this.homeWorkContent,startDate:a,deadline:s,files:JSON.stringify(this.formHomework.files),mustVerified:p,whenShowAnswer:m,isPublished:t,categoryId:this.cateId?Number(this.cateId):void 0,classroomIds:g};this.waitDestroy(this.homeworkService.apiHomeworkSaveObjPost(l,b).subscribe(C=>{if(1==C.success){if(t){this.successStatusObj("lang_auto_xuat_ban_thanh_cong",!0);let ue=[];if(C.data?.objs)for(let W=0;W<C.data.objs.length;W++)ue.push(C.data?.objs[W].hashId);this.listIds=JSON.stringify(ue),this.commonService.myNavigationWithQueryString("/admin/testbank/publish-document/1/"+(this.cateId??0)+"/"+this.listIds,"?backto="+encodeURIComponent(`/admin/homework/add-new-homework/${this.cateId??0}?backto=`+this.backToLink))}else this.commonService.myNavigation(this.backToLink?this.backToLink:"/admin/testbank/document-management/1/0/1"),this.successStatusObj("lang_auto_luu_thanh_cong_chua_xuat_ban",!0);this.successStatusObj()}else this.errorStatusObj(C.message??"",!0)}))}getHomework(){this.waitDestroy(this.documentConfigService.apiDocumentConfigGetHomeworkConfigDataV2Post("add_new",[]).subscribe(t=>{1==t.success?(this.classroomWithGroup=t.data?.classroomGroupObjs??[],this.successStatusObj()):this.errorStatusObj(t.message??"",!0)}))}ngOnChanges(){this.initDataEditor=this.sAztTinyMceService.initConfigForTeacher()}ngOnInit(){this.initStatusObj(),this.initDataEditor=this.sAztTinyMceService.initConfigForTeacher(),this.waitDestroy((0,Z.a)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([])=>{this.backToLink=this.commonService.getMyQueryParam("backto")??"",this.cateId=this.commonService.getMyParam(this.activeRoute,"cat_id")??"",this.getHomework()})),this.commonService.translateMetaData({title:"lang_cms_homework_add_exercise_title",description:"lang_cms_homework_add_exercise_description",image:"lang_cms_test_image"})}constructor(t,i,a,s,p,m,_,l,g,b,C){super(),this.sAztTinyMceService=t,this.sAztDialogService=i,this.activeRoute=a,this.homeworkService=s,this.classroomService=p,this.zipDataService=m,this.timeService=_,this.userService=l,this.sAztClassroomCheckboxService=g,this.uploadImageOfHomeworkService=b,this.documentConfigService=C,this.permissionTypes=fe.y,this.tinyEditorKey=j.N.tinyEditorKey,this.formHomework={files:[],content:""},this.prevData="",this.cateId="",this.listIds="",this.backToLink="",this.homeWorkContent="",this.initDataEditor={},this.maxDate=j.N.maxDateTimePicker,this.allUploadToCdnMenuTypes=z.j6,this.allUploadFileTypes=z.AZ,this.notSupportedFile=z.lN,this.classroomWithGroup=[],this.form=new c.cw({homeworkName:new c.NI("",{nonNullable:!0,validators:[c.kI.required,c.kI.maxLength(180),ke._.noWhiteSpace]}),homeworkStartDate:new c.NI("",{nonNullable:!0}),homeworkDeadline:new c.NI("",{nonNullable:!0}),mustVerified:new c.NI("0",{nonNullable:!0}),whenShowAnswer:new c.NI("0",{nonNullable:!0}),classroomFormArray:new c.Oe([]),whoAllow:new c.NI(2,{nonNullable:!0})},{validators:[_e.h.classroomInGroupCheckBoxValidator]})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(V.y),e.Y36(U.C),e.Y36(w.gz),e.Y36(N.Lk),e.Y36(N.um),e.Y36(R.a),e.Y36(q.D),e.Y36(we.U),e.Y36(ve.f),e.Y36(xe.Z),e.Y36(ye.Cq))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-home-work"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Me,5),e.Gf(Ce,5)),2&t){let a;e.iGM(a=e.CRH())&&(i.startTime=a.first),e.iGM(a=e.CRH())&&(i.endTime=a.first)}},features:[e._Bn([{provide:T.fM,useClass:ge.WG,deps:[E.Ad,H.o8]},{provide:T.ab,useFactory:pe.hx,deps:[q.D]}]),e.qOj,e.TTD],decls:4,vars:3,consts:[[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document","mx-auto",2,"max-width","1000px"],[1,"setting-basic"],[1,"text-md","uppercase","font-medium"],[1,"box","mt-2","p-5"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","homework-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","homework-name","formControlName","homeworkName","type","text",1,"form-control",3,"placeholder"],["class","text-xs text-danger mt-2",4,"ngIf"],["id","azt-config-time-assignment",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12"],["for","regular-form-1",1,"form-label","mb-0","font-medium","flex","items-center"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-4","h-4","ml-2",3,"matTooltip"],["cx","12","cy","12","r","10"],["x1","12","y1","16","x2","12","y2","12"],["x1","12","y1","8","x2","12.01","y2","8"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-5"],["appearance","outline"],["azt-track-service","add-home-work-2lcHTxnwVmR","matInput","","formControlName","homeworkStartDate","readonly","",3,"placeholder","max","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work-6MNUM1lV8t1","matSuffix","",2,"font-size","18px",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","lucide"],["d","M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5"],["d","M16 2v4"],["d","M8 2v4"],["d","M3 10h5"],["d","M17.5 17.5 16 16.25V14"],["d","M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z"],[3,"touchUi"],["startTime",""],["mat-raised-button","","color","secondary","ngxMatDatepickerCancel",""],["mat-raised-button","","color","primary","ngxMatDatepickerApply",""],["azt-track-service","add-home-work-ShSJ8gIBpK8","matInput","","formControlName","homeworkDeadline","readonly","",3,"placeholder","max","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work--BjU84v-g28","matSuffix","",2,"font-size","18px",3,"click"],["endTime",""],[1,"col-span-6","md:col-span-2"],["azt-track-service","add-home-work-NEdqGTKJIVb",1,"btn","btn-outline-secondary","w-full",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-4","h-4","mr-2"],["d","M10 2h4"],["d","M12 14v-4"],["d","M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6"],["d","M9 17H4v5"],[1,"text-xs","mt-2"],[1,"text-slate-500","mt-1"],["class","text-danger mt-1",4,"ngIf"],[1,"grid","grid-cols-12","mt-4"],[1,"text-md","font-medium"],[1,"col-span-12","lg:col-span-12","mt-3"],[2,"display","inline-block",3,"uploadToCdnMenu","fileType","notSupportedFile","uploadComplete"],["azt-track-service","add-home-work-4ML9tUkucGY",1,"btn","btn-sm","btn-primary-soft","mr-2"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],[1,"text-slate-600","text-xs","mt-2","mb-2"],["class","flex items-center mt-3 mb-3",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","apiKey","init","ngModelChange"],["id","azt-config-when-result",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["id","whenShowAnswer-off","type","radio","formControlName","whenShowAnswer","value","1",1,"form-check-input"],["for","whenShowAnswer-off",1,"form-check-label"],[1,"form-check","mr-8","mt-2","sm:mt-0"],["id","whenShowAnswer-tested","type","radio","formControlName","whenShowAnswer","value","0",1,"form-check-input"],["for","whenShowAnswer-tested",1,"form-check-label","flex","items-center"],["id","azt-config-login-require",1,"grid","grid-cols-12","mt-4"],["id","mustVerified-off","type","radio","formControlName","mustVerified","value","0",1,"form-check-input"],["for","mustVerified-off",1,"form-check-label"],["id","mustVerified-tested","type","radio","formControlName","mustVerified","value","1",1,"form-check-input"],["for","mustVerified-tested",1,"form-check-label","flex","items-center"],["id","azt-config-who-allow",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5","pr-5"],[1,"mb-0","font-medium","flex","items-center"],[1,"col-span-12","mt-4"],[1,"azt-list-classroom"],[3,"form","classroomGroupData","permissionName"],[1,"my-5"],[1,"text-right"],["azt-track-service","add-home-work-ZxDqD0KF4NR",1,"btn","btn-pending","w-24","mr-2",3,"disabled","click"],["azt-track-service","add-home-work-JgG_cpuccgD",1,"btn","w-24","btn-primary",3,"disabled","click"],[1,"text-xs","text-danger","mt-2"],[1,"text-danger","mt-1"],[1,"flex","items-center","mt-3","mb-3"],["azt-track-service","add-home-work-HeEXhrbob3P",1,"text-slate-600","mr-2",3,"click"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],["azt-track-service","add-home-work-QFtSJlUphLG",3,"click"],[1,"text-slate-600",3,"title"]],template:function(t,i){if(1&t&&(e.TgZ(0,"teacher-layout",0),e.YNc(1,De,1,1,"azt-loading-effect",1),e.YNc(2,Ee,153,94,"ng-template",null,2,e.W1O),e.qZA()),2&t){const a=e.MAs(3);e.Q6J("headerBackToLink",i.backToLink),e.xp6(1),e.Q6J("ngIf",1==i.statusObj.loading)("ngIfElse",a)}},dependencies:[x.sg,x.O5,$.lW,Se.Nt,F.KE,F.R9,X.gM,T.rZ,T.T$,T.c_,T.dW,T.cL,n.PG,c._Y,c.Fj,c._,c.JJ,c.JL,c.On,c.sg,c.u,B.l,G.M,Oe.B,je.B,ee._,A.JV],encapsulation:2}),o})();var te=r(68479),Y=r(30617),Pe=r(98525);function He(o,u){if(1&o&&(e.TgZ(0,"mat-option",15),e._uU(1),e.qZA()),2&o){const t=u.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function Ue(o,u){if(1&o&&e._UZ(0,"azt-loading-effect",16),2&o){const t=e.oxw();e.Q6J("currentStatusObj",t.statusObj)}}function Re(o,u){1&o&&(e.TgZ(0,"div",19)(1,"span",20),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&o&&(e.xp6(2),e.hij("",e.lcZ(3,1,"lang_homework_content_store_not_found_search"),"!"))}function Je(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"div",23)(1,"div",24),e._UZ(2,"img",25),e.ALo(3,"mycdn"),e.TgZ(4,"div",26)(5,"p",27),e._uU(6),e.qZA(),e.TgZ(7,"div",28)(8,"div",29),e._uU(9),e.ALo(10,"mytranslate"),e.qZA(),e.TgZ(11,"a",30),e.NdJ("click",function(){const s=e.CHM(t).$implicit,p=e.oxw(3);return e.KtG(p.downloadFrontFileContent(s.id?s.id:0))}),e.TgZ(12,"mat-icon",31),e._uU(13,"save_alt"),e.qZA(),e._uU(14),e.ALo(15,"mytranslate"),e.qZA()()()()()}if(2&o){const t=u.$implicit;e.xp6(2),e.s9C("src",e.lcZ(3,4,t.thumb),e.LSH),e.xp6(4),e.Oqu(t.name),e.xp6(3),e.Oqu(e.lcZ(10,6,"lang_homework_content_store_free")),e.xp6(5),e.hij(" ",e.lcZ(15,8,"lang_homework_content_store_download")," ")}}function ze(o,u){if(1&o&&(e.TgZ(0,"div",21),e.YNc(1,Je,16,10,"div",22),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.objs)}}function Fe(o,u){if(1&o&&(e.YNc(0,Re,4,3,"div",17),e.YNc(1,ze,2,1,"ng-template",null,18,e.W1O)),2&o){const t=e.MAs(2),i=e.oxw();e.Q6J("ngIf",i.isNullData)("ngIfElse",t)}}let Be=(()=>{class o extends L.Q{getData(){this.initStatusObj(),this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(0).subscribe(t=>{1==t.success?(this.objs=t.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(t.message??"")}))}getInfo(){this.initStatusObj(),this.waitDestroy(this.userInfoService.apiUserInfoInfoGet().subscribe(t=>{1==t.success?(this.userObj=t.data,this.successStatusObj()):this.errorStatusObj(t.message??"")}))}getCategories(){this.initStatusObj(),this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetCategoriesObjsGet().subscribe(t=>{1==t.success?(this.categories=t.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(t.message??"")}))}selectValue(t){this.initStatusObj(),this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(t,void 0).subscribe(i=>{1==i.success?i.data?.objs&&i.data?.objs.length>0?(this.isNullData=!1,this.objs=i.data?.objs??new Array,this.successStatusObj()):(this.isNullData=!0,this.stopStatusObj()):this.errorStatusObj(i.message??"")}))}onSearch(){var t=this.getFormValue();this.initStatusObj(),""==t.searchContent?(this.isNullData=!1,this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(0).subscribe(i=>{1==i.success?(this.objs=i.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(i.message??"")}))):this.waitDestroy(this.frontFileContentService.apiFrontFileContentGetObjsGet(0,t.searchContent).subscribe(i=>{1==i.success?(i.data?.objs&&0==i.data?.objs.length?this.isNullData=!0:this.objs=i.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(i.message??"")}))}downloadFrontFileContent(t){this.frontFileContentService.apiFrontFileContentGetFileLinkGet(t).subscribe(i=>{1==i.success&&i.data?.link?this.commonService.downloadFileByUrl(i.data.link):this.showErrorSnack("lang_cms_content_store_download_fail")})}getFormValue(){return this.form.getRawValue()}ngOnInit(){(0,Z.a)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([t,i])=>{this.getData(),this.getInfo(),this.getCategories()}),this.commonService.translateMetaData({title:"lang_cms_homework_content_store_title",description:"lang_cms_homework_content_store_description",image:"lang_cms_test_image"}),super.ngOnInit()}constructor(t,i,a,s){super(),this.activeRoute=t,this.userInfoService=i,this.frontFileContentService=a,this.sAztDialogService=s,this.isNullData=!1,this.objs=[],this.categories=[],this.form=new c.cw({searchContent:new c.NI("",{nonNullable:!0,validators:[c.kI.required]})})}ngOnDestroy(){super.ngOnDestroy()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(w.gz),e.Y36(te.$C),e.Y36(te.cd),e.Y36(U.C))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-content-store"]],features:[e.qOj],decls:20,vars:11,consts:[[3,"headerBackToLink"],["id","content-store",1,"container-fluid","component-wrap","W1200","m-auto","mt-3","pb-mb-80","pb-4"],[3,"formGroup"],[1,"flex",2,"justify-content","space-between"],[2,"width","60%","margin-top","5px"],[1,"search-bar","form-group"],[1,"input-group-append"],["type","text","formControlName","searchContent",1,"form-control",3,"placeholder","keyup.enter"],["azt-track-service","content-store-Z-NOMKYiG5Z","id","basic-addon2",1,"btn","btn-primary","ml-2",3,"click"],[1,"content-store-select",2,"width","38%"],["appearance","outline"],["name","category",3,"placeholder","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"value"],[3,"currentStatusObj"],["class","text-center mt-3 mb-3",4,"ngIf","ngIfElse"],["HasData",""],[1,"text-center","mt-3","mb-3"],[1,"h3"],[1,"grid","grid-cols-12","gap-5","mt-2"],["class","box col-span-12 md:col-span-4 sm:col-span-6 mb-2","style","margin: auto",4,"ngFor","ngForOf"],[1,"box","col-span-12","md:col-span-4","sm:col-span-6","mb-2",2,"margin","auto"],[1,"card"],["alt","thumbnail",1,"card-img-top",2,"width","80vw",3,"src"],[1,"card-body"],[1,"truncate","p-2","card-text"],[1,"actionZone","p-2"],[1,"azo-price","text-warning"],["azt-track-service","content-store-NDNy2GWJJPR",1,"actionBtn","clickable",3,"click"],[2,"vertical-align","sub"]],template:function(t,i){if(1&t&&(e.TgZ(0,"teacher-layout",0)(1,"div",1)(2,"form",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"input",7),e.NdJ("keyup.enter",function(){return i.onSearch()}),e.ALo(8,"mytranslate"),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){return i.onSearch()}),e.TgZ(10,"mat-icon"),e._uU(11,"search"),e.qZA()()()()(),e.TgZ(12,"div",9)(13,"mat-form-field",10)(14,"mat-select",11),e.NdJ("selectionChange",function(s){return i.selectValue(s.value)}),e.ALo(15,"mytranslate"),e.YNc(16,He,2,2,"mat-option",12),e.qZA()()()()(),e.YNc(17,Ue,1,1,"azt-loading-effect",13),e.YNc(18,Fe,3,2,"ng-template",null,14,e.W1O),e.qZA()()),2&t){const a=e.MAs(19);e.Q6J("headerBackToLink","/admin/dashboard"),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(5),e.s9C("placeholder",e.lcZ(8,7,"lang_homework_content_store_search")),e.xp6(7),e.s9C("placeholder",e.lcZ(15,9,"lang_homework_content_store_all")),e.xp6(2),e.Q6J("ngForOf",i.categories),e.xp6(1),e.Q6J("ngIf",i.statusObj.loading)("ngIfElse",a)}},dependencies:[x.sg,x.O5,E.ey,Y.Hw,F.KE,Pe.gD,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,B.l,G.M,ee._,A.JV,A.QN],styles:[".dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;border-radius:5px}.input-group-append[_ngcontent-%COMP%]{display:flex}.border-test[_ngcontent-%COMP%]{border:1px solid red;min-height:50px}.azo-price[_ngcontent-%COMP%]{padding-top:5px;font-weight:500;font-size:1.2rem}.content-store-select[_ngcontent-%COMP%]{margin-top:5px}.card-text[_ngcontent-%COMP%]{display:block!important;max-width:245px!important}.content-header[_ngcontent-%COMP%]{background:inherit;background-color:#0089a7;padding:20px 0}.user_amount[_ngcontent-%COMP%]{background:inherit;background-color:#009cbe;border:none;border-radius:5px;padding:10px;box-shadow:none}.user_amount[_ngcontent-%COMP%]:hover{text-decoration:none}.mat-card-avatar[_ngcontent-%COMP%]{height:50px;width:50px;border-radius:50%;flex-shrink:0;object-fit:cover}@media (max-width: 992px){.dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;margin-top:-15px;margin-left:-15px;margin-right:-15px;border-radius:0}}.actionZone[_ngcontent-%COMP%]{display:flex;justify-content:space-between}  .mat-form-field-underline{position:initial!important}@media (max-width: 768px){.card-text[_ngcontent-%COMP%]{display:block!important;max-width:120px}.header-col-center[_ngcontent-%COMP%]{text-align:center!important;display:block!important}.header-col-center[_ngcontent-%COMP%]   .nav[_ngcontent-%COMP%]{margin-left:auto!important;margin-right:auto!important;margin-bottom:10px!important;text-align:center!important;display:inline-flex!important}.user_amount[_ngcontent-%COMP%]{margin-left:0!important;margin-bottom:10px!important}.content-header[_ngcontent-%COMP%]{padding:20px 0 0}}"]}),o})();var Ge=r(49671),Q=r(69862),ie=r(61713),K=r(20597),ae=r(72164),oe=r(71646);let se=(()=>{class o extends ae.e{getData(){this.initStatusObj(),this.data.status?this.successStatusObj():this.stopStatusObj()}cleanResult(){var t=this.getFormValue(),i={homeworkHashId:this.data.itemHomework.hashId??"",id:this.data.ans_id,resendNote:t.reason};this.initStatusObj(),this.waitDestroy(this.answerService.apiAnswerResendAnswerPost(i).subscribe(a=>{1==a.success?(this.showSuccessSnack(this.commonService.myTranslateInstant("lang_send_request_must_resubmit_homework_with_reason")+": "+t.reason),this.result=!0,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.successStatusObj()):(this.showErrorSnack("lang_cms_send_request_error"),this.result=!1,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.errorStatusObj(a.message??""))}))}getFormValue(){return this.form.getRawValue()}ngOnInit(){this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"",this.getData(),super.ngOnInit()}constructor(t,i,a,s){super(s,t),this.dialogRef=t,this.answerService=i,this.activeRoute=a,this.data=s,this.result=!1,this.homeworkHashId="",this.form=new c.cw({reason:new c.NI("",{nonNullable:!0,validators:[c.kI.required]})})}onNoClick(){this.dialogRef.close()}onSubmit(t){this.dialogRef.close(t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(S.so,8),e.Y36(N.P6),e.Y36(w.gz),e.Y36(S.WI,8))},o.\u0275cmp=e.Xpm({type:o,selectors:[["clean-result-dialog"]],features:[e.qOj],decls:44,vars:31,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto","text-center"],[3,"hidden"],[1,"d-flex","justify-content-center"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"intro",3,"hidden"],["enctype","multipart/form-data",1,"form-horizontal","text-center",3,"formGroup"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger","text-center"],[1,"h5","mb-1"],[1,"text-danger"],[1,"h5","text-danger","mt-1","mb-1"],["type","text","id","reason","formControlName","reason",1,"form-control","mt-2"],[1,"text-right","mt-3"],["azt-track-service","clean-result-dialog-_f7PVI4E-S_",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","clean-result-dialog-xDCHUvnl-fJ",1,"btn","w-24","btn-primary",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e._uU(5),e.ALo(6,"mytranslate"),e.qZA()(),e._UZ(7,"br"),e.TgZ(8,"div",5)(9,"div",6)(10,"span",7),e._UZ(11,"azt-loading-ui"),e.qZA(),e.TgZ(12,"span",8),e._uU(13,"..."),e.qZA()()(),e.TgZ(14,"div",9)(15,"form",10)(16,"div",11)(17,"p",12),e._uU(18),e.ALo(19,"mytranslate"),e.qZA(),e.TgZ(20,"p",13),e._uU(21),e.ALo(22,"mytranslate"),e.TgZ(23,"span",14),e._uU(24),e.qZA(),e._uU(25),e.ALo(26,"mytranslate"),e.TgZ(27,"span",14),e._uU(28),e.ALo(29,"formatOnlyDateByUserUnitPipe"),e.qZA(),e._uU(30),e.ALo(31,"mytranslate"),e.qZA(),e._UZ(32,"hr"),e.TgZ(33,"p",15),e._uU(34),e.ALo(35,"mytranslate"),e.qZA(),e._UZ(36,"input",16),e.qZA()()(),e.TgZ(37,"div",17)(38,"button",18),e.NdJ("click",function(){return i.onNoClick()}),e._uU(39),e.ALo(40,"mytranslate"),e.qZA(),e.TgZ(41,"button",19),e.NdJ("click",function(){return i.cleanResult()}),e._uU(42),e.ALo(43,"mytranslate"),e.qZA()()()()()),2&t&&(e.xp6(5),e.Oqu(e.lcZ(6,13,"lang_homework_mark_exercise_utils_request_resubmit")),e.xp6(3),e.Q6J("hidden",!i.statusObj.loading),e.xp6(6),e.Q6J("hidden",i.statusObj.loading),e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(3),e.hij("(*) ",e.lcZ(19,15,"lang_homework_mark_exercise_utils_note"),":"),e.xp6(3),e.hij(" ",e.lcZ(22,17,"lang_homework_mark_exercise_utils_request")," "),e.xp6(3),e.hij(" ",i.data.name," "),e.xp6(1),e.hij(" ",e.lcZ(26,19,"lang_homework_mark_exercise_utils_in_homework"),"\xa0"),e.xp6(3),e.Oqu(e.lcZ(29,21,i.data.deadline?i.data.deadline:i.data.itemHomework.createdAt)),e.xp6(2),e.hij("\xa0",e.lcZ(31,23,"lang_homework_mark_exercise_utils_will_be_deleted"),"! "),e.xp6(4),e.Oqu(e.lcZ(35,25,"lang_homework_mark_exercise_utils_coment_request_resubmit")),e.xp6(5),e.hij(" ",e.lcZ(40,27,"lang_button_cancel")," "),e.xp6(3),e.hij(" ",e.lcZ(43,29,"lang_button_confirm")," "))},dependencies:[c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,G.M,oe.n,A.JV,A.YK],encapsulation:2}),o})();var Ye=r(91675);let ne=(()=>{class o extends ae.e{ngOnInit(){this.success=this.data.status}constructor(t,i,a){super(a,t),this.dialogRef=t,this.answerService=i,this.data=a,this.success=!1}checkNextAns(){this.dialogRef.close(),this.answerService.apiAnswerGetNextObjByHomeworkGet(this.data.homeworkHashId).subscribe(t=>{if(1==t.success)return this.commonService.myNavigationWithQueryString("/admin/homework/switch-mark-exercise/"+t.data?.obj?.id+"/"+this.data.homeworkHashId+"/0","?backto="+encodeURIComponent(this.data.backToLink)),void(window.location.href=this.commonService.getLocalRouter("/admin/homework/switch-mark-exercise/"+t.data?.obj?.id+"/"+this.data.homeworkHashId+"/0?backto="+encodeURIComponent(this.data.backToLink)));window.location.href=this.commonService.getLocalRouter("/admin/testbank/homework-results-list/"+this.data.classID+"/"+this.data.homeWorkID+"/"+this.data.homeworkHashId)})}onNoClick(){this.dialogRef.close()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(S.so,8),e.Y36(N.P6),e.Y36(S.WI,8))},o.\u0275cmp=e.Xpm({type:o,selectors:[["notice-dialog"]],features:[e.qOj],decls:22,vars:10,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto"],[1,"mr-1",2,"color","green"],[2,"color","red","font-size","120%","font-weight","500"],[3,"mark"],[1,"text-right","mt-3"],["azt-track-service","notice-dialog-YnLBVlTjw",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","notice-dialog-D6RUmpOZKX",1,"btn","w-24","btn-primary",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4)(5,"mat-icon",5),e._uU(6,"check_circle"),e.qZA(),e._uU(7),e.ALo(8,"mytranslate"),e.qZA()(),e._UZ(9,"br"),e.TgZ(10,"div",3),e._uU(11),e.ALo(12,"mytranslate"),e.TgZ(13,"span",6),e._UZ(14,"azt-check-mark",7),e.qZA()(),e._UZ(15,"br"),e.TgZ(16,"div",8)(17,"button",9),e.NdJ("click",function(){return i.onNoClick()}),e._uU(18,"Ok"),e.qZA(),e.TgZ(19,"button",10),e.NdJ("click",function(){return i.checkNextAns()}),e._uU(20),e.ALo(21,"mytranslate"),e.qZA()()()()()),2&t&&(e.xp6(7),e.hij(" ",e.lcZ(8,4,"lang_homework_mark_exercise_utils_mark_success"),""),e.xp6(4),e.hij(" ",e.lcZ(12,6,"lang_homework_mark_exercise_utils_assignment_marking")," "),e.xp6(3),e.Q6J("mark",i.data.score),e.xp6(6),e.Oqu(e.lcZ(21,8,"lang_homework_mark_exercise_utils_mark_continue")))},dependencies:[Y.Hw,Ye.B,A.JV],styles:["#ok[_ngcontent-%COMP%]:hover{background-color:#e7e7e7}#next[_ngcontent-%COMP%]:hover{background-color:#1e579d!important}"]}),o})();var re=r(94690),ce=r(32965),le=r(84672),de=r(85904),Qe=r(76024),Ke=r(62703);const We=["aztMarkNote"];function qe(o,u){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"azt-mark-note",38,39),e.NdJ("handleBackLink",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.goBack())})("doneLoadData",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.doneLoadData(a))})("markData",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.getMarkData(a))})("getIdHistory",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.getDataHistory(a))}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("dataMarkNote",t.dataMarkNote)("showBackLink",!0)("markedByObj",t.markedByObj)("historyAnswerObjs",t.historyAnswerObjs)}}function Ve(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"div",40)(1,"button",41),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.goBack())}),e.O4$(),e.TgZ(2,"svg",42),e._UZ(3,"polyline",43),e.qZA(),e.kcU(),e.TgZ(4,"span",44),e._uU(5),e.ALo(6,"mytranslate"),e.qZA()(),e.TgZ(7,"div",45),e.O4$(),e.TgZ(8,"svg",46),e._UZ(9,"path",47)(10,"path",48)(11,"path",49)(12,"path",50)(13,"path",51)(14,"path",52),e.qZA(),e.kcU(),e.TgZ(15,"p",53),e._uU(16),e.ALo(17,"mytranslate"),e.qZA()()()}2&o&&(e.xp6(5),e.Oqu(e.lcZ(6,2,"lang_auto_quay_lai")),e.xp6(11),e.Oqu(e.lcZ(17,4,"lang_auto_chua_nop_bai")+"..."))}function $e(o,u){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"mytranslate"),e.ALo(3,"mytranslate"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.HOy(" ",e.lcZ(2,4,"lang_testbank_tested_list_number_success")+" "," ",t.markData.totalRight+", "," ",e.lcZ(3,6,"lang_testbank_tested_list_error")+" "," ",t.markData.totalWrong," ")}}function Xe(o,u){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"lang_core_chua_co_so_cau_dung_cau_sai")))}function et(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"div",54)(1,"button",55),e.NdJ("click",function(){const s=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.setPoint(s))}),e._uU(2),e.qZA()()}if(2&o){const t=u.$implicit;e.xp6(2),e.hij(" ",t.name," ")}}function tt(o,u){1&o&&(e.TgZ(0,"span",56),e._UZ(1,"azt-loading-ui"),e.qZA())}const it=function(o){return{height:o}};let at=(()=>{class o extends L.Q{onResize(t){this.changeSizeMarkGeneral()}doneLoadData(t){this.loadingDataCdn=!1}uploadDrawBase64ToCDN(t,i,a){let s=(0,K.G)(t),p=Date.now();this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${i}_${this.answerId}_${p}.png`,"image/png").subscribe(m=>{m.type!=Q.dt.UploadProgress&&(1==m.success?(this.mnoteJsonData.pages?.[i]&&(this.mnoteJsonData.pages[i].draw=m.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,a,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(t,i){this.pagesCount=0;for(let a=0;a<t.length;a++)t[a].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,i,this.mnoteJsonData);else for(let a=0;a<t.length;a++)t[a].draw&&this.uploadDrawBase64ToCDN(t[a].draw,a,i)}sendDataToMarkNote(){let t=this.castObj(this.result.answerObj);if(t){let m=this.commonService.willDeleteParseJson(t.result??"");if(null!=m){let l=m.pages?.length??0;for(let g=0;g<l;g++)m?.pages?.[g].backgroundImage&&(m.pages[g].backgroundImage=this.cdnService.getMyCdn(m.pages[g].backgroundImage??"")),m.pages?.[g].draw&&(m.pages[g].draw=this.cdnService.getMyCdn(m.pages[g].draw));m=JSON.stringify(m),t.result=JSON.stringify(m)}let _=this.commonService.willDeleteParseJson(t.files??"");if(null!=_){for(let l=0;l<_.length;l++)_[l].url&&(_[l].url=this.cdnService.getMyCdn(_[l].url)),_[l].thumb&&(_[l].thumb=this.cdnService.getMyCdn(_[l].thumb));_=JSON.stringify(_),t.files=_}}let i=this.result.studentObj,a=this.result.classroomObj,s=this.result.homeworkObj,p=this.commonService.myParseJson(t?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let m=0;m<(this.jsonData.pages?.length??0);m++)this.jsonData.pages?.[m].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[m].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[m].backgroundImage??"")),this.jsonData.pages?.[m].hasOwnProperty("draw")&&(this.jsonData.pages[m].draw=this.cdnService.getMyCdn(this.jsonData.pages[m].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=t,this.jsonData.student_obj=i,this.jsonData.classroom_obj=a,this.jsonData.homework_obj=s,p&&p.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=p.hideMark),this.dataMarkNote=this.jsonData;else{let m=[];this.files.forEach(l=>{m.push({backgroundImage:l.url})});let _={cmd:"initMNote",mode:"edit",pages:m,answer_obj:t,student_obj:i,classroom_obj:a,homework_obj:s};p&&p.hasOwnProperty("hideMark")&&(_.hideMark=p.hideMark),this.dataMarkNote=_}}getHistoryObjs(t){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,t).subscribe(i=>{1==i.success?this.historyAnswerObjs=i.data?.objs??new Array:this.errorMessage=i.message??"",this.stopStatusObj()})}getDataHistory(t){this.historyId=t,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(t,10)).subscribe(i=>{if(1==i.success){if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),i.data){this.result=i.data,this.markedByObj=i.data.markedByObj,this.score=i.data?.answerObj?.point??0,this.pointExercise.value=i.data?.answerObj?.point??"",Number(this.pointExercise.value)<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="");let a=this.castJsonToObj(i.data.answerObj?.resultNote??"");if(this.commentExercise=a?.Note??"",this.showPoint=!a?.IsHideMark,this.files=this.commonService.myParseJson(i.data.answerObj?.files??"")??[],null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,this.sendDataToMarkNote(),this.successStatusObj()}}else this.errorMessage=i.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var t=this.commonService.myParseJson(this.result.answerObj?.result??"");t&&(this.jsonData=t,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(t){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,t).subscribe(i=>{1==i.success&&i.data?(this.studentObj=i.data.studentObj,this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(t){this.initStatusObj(),this.errorMessage="",this.answerId=t,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,t).subscribe(i=>{if(1==i.success)if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),i.data?.hasOwnProperty("studentObj")&&null!=i.data?.studentObj){this.result=i.data,this.markedByObj=i.data.markedByObj,this.score=i.data?.answerObj?.point??0,this.pointExercise.value=i.data?.answerObj?.point??0,this.checkInputActive=!0,this.pointExercise.value<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="",this.checkInputActive=!1);let a=this.castJsonToObj(i.data.answerObj?.resultNote??"");if(this.commentExercise=a?.Note??"",this.showPoint=!a?.IsHideMark,this.homeworkID=i.data.homeworkObj?.id??0,this.classID=i.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(i.data.answerObj?.files??"")??[],this.studentObj=i.data.studentObj,this.classroomObj=i.data.classroomObj??{},null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??""),((0,ie.ZA)(this.files[s].mimes??"")||(0,ie.AW)(this.files[s].mimes??""))&&(this.hasAttachmentFile=!0);this.homeworkObj=i.data.homeworkObj??{},this.studentName=i.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToMarkNote()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=i.message??"",this.stopStatusObj()})}openDialog(t,i){this.sAztDialogService.open(ne,{width:"280px",autoFocus:!1,data:{score:i,status:t,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline??void 0,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(t,i,a,s,p){let m={status:t,deadline:i,itemHomework:a,ans_id:s,name:p,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(se,{width:"380px",panelClass:"cleanResultDialogBox",data:m,restoreFocus:!1}).afterClosed().subscribe(l=>{if(l&&l.result&&l.isRedirect){let g="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+m.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+m.classID+"/"+m.itemHomework.id+"/"+this.homeworkHashId,g)}})}remark(t,i,a){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let p={id:t,comment:a.comment,hideMark:a.hideMark?1:0,point:i?parseFloat(i.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(a)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,p).subscribe(m=>{1==m.success?(this.openDialog(!0,m.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId)}checkModeUiEditor(){let i=(document.getElementById("mark-general-box")?.offsetHeight??0)-80-40-140-40-30;this.initDataEditor=this.sAztTinyMceService.initConfigTeacherHomework(i)}setPoint(t){this.pointExercise=this.commonService.myClone(t),this.checkInputActive=!0}setPointInput(t){if(t.target){this.checkInputActive=!0;let i=t.target.value;this.pointExercise.value=i,this.pointExercise.name=i}}getListPointDefault(){this.listPointAzt=[{value:1e3,name:"\u0110"},{value:1001,name:"C\u0110"},{value:2e3,name:"HT"},{value:2001,name:"CHT"},{value:3e3,name:"HTT"}]}getMarkData(t){t.checkChangeMark&&(this.markData=t,this.checkInputActive||(this.pointExercise.value=isNaN(this.markData.pointRaw??0)?"":this.markData.pointRaw,this.pointExercise.name=this.pointExercise.value?.toString()))}ngOnInit(){this.isMobileDevice||(document.body.style.overflowY="hidden"),this.getListPointDefault();const t=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),i=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),a=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let s=this.commonService.getMyQueryParam("backto");this.backToLink=s?s.includes("shareType")?decodeURIComponent(s):s:"",t?(this.getData(t),this.getHistoryObjs(t)):this.getStudentObj(i),a&&this.getDataHistory(a),this.checkModeUiEditor(),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}getSizeMarkEditor(t){this.sizeMarkEditor=t}changeSizeMarkGeneral(){let t=document.getElementById("mark-general"),i=document.getElementById("mark-general-box");i&&t&&(i.style.width=t.offsetWidth.toString()+"px")}uploadDrawBase64ToCdn(){return new Promise(t=>{let i=[];if(this.objectResult.pages){this.objectResult.pages.forEach(a=>{i.push(!1)});for(let a=0;a<this.objectResult.pages.length;a++)if(this.objectResult.pages[a]&&this.objectResult.pages[a].draws?.length)for(let s=0;s<(this.objectResult.pages[a].draws?.length??0);s++){let p=this.objectResult.pages[a].draws?.[s]??{};if(p.src&&p.src.includes("base64")){i[a]=!0;let m=(0,K.G)(p.src);this.apiUploadService.commonUploadForMarkResult(m,`essay_note_${a}_${s}_${this.answerId}.png`,"image/png").subscribe(_=>{_.type!=Q.dt.UploadProgress&&(p.src=_.data?.url,i[a]=!1),i.includes(!0)||t()})}}}})}saveDataMarkExercise(){var t=this;return(0,Ge.Z)(function*(){if(t.loadingSaveData=!0,""==t.historyId)if(1==t.permissionService.hasMarkPointPermission("homework",t.homeworkObj)){if(!t.MarkNote)return;t.objectResult=t.MarkNote?.exportDataMarkNote();let i=!1;if(!t.objectResult.pages?.length&&!t.hasAttachmentFile)return t.loadingSaveData=!1,void t.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_vui_long_thu_lai");if(t.hasAttachmentFile&&!t.objectResult.pages?.length){let a={point:t.pointExercise.value?.toString(),urlDataMark:"",version:"0.1",comment:t.commentExercise,hideMark:!t.showPoint};t.remark(t.answerId,a.point??"0",a)}if(t.objectResult.pages?.length){for(let _=0;_<t.objectResult.pages.length;_++)if(t.objectResult.pages[_]&&t.objectResult.pages[_].draws?.length)for(let l=0;l<(t.objectResult.pages[_].draws?.length??0);l++){let g=t.objectResult.pages[_].draws?.[l]??{};g.src&&g.src.includes("base64")&&(i=!0)}i&&(yield t.uploadDrawBase64ToCdn());const a=t.serializeJson(t.objectResult),s=t.zipDataService.convertContentGzip(a),p=new Blob([s],{type:"text/plain"}),m=new File([p],"txt",{type:"text/plain"});t.apiUploadService.uploadToCdnForHomework(m).subscribe(_=>{if(1==_.success){let l=_.data?.url??"",g={point:t.pointExercise.value?.toString(),urlDataMark:l,version:"0.1",comment:t.commentExercise,hideMark:!t.showPoint};t.remark(t.answerId,g.point??"0",g)}else t.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");t.loadingSaveData=!1})}}else t.showErrorSnack("lang_cms_no_permission_on_homework"),t.stopStatusObj();else t.stopStatusObj(),t.showErrorSnack("lang_cms_cannot_remark_student_history_result")})()}ngAfterViewInit(){this.changeSizeMarkGeneral()}constructor(t,i,a,s,p,m,_,l,g){super(),this.sAztTinyMceService=t,this.activeRoute=i,this.answerService=a,this.permissionService=s,this.sAztDialogService=p,this.cdnService=m,this.zipDataService=_,this.apiUploadService=l,this.vcRef=g,this.tinyEditorKey=j.N.tinyEditorKey,this.answerId=0,this.homeworkID="",this.historyId="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.initDataEditor={},this.color="#000",this.dataMarkNote={},this.loadingSaveData=!1,this.loadingDataCdn=!0,this.listPointAzt=[],this.pointExercise={value:0,name:""},this.markData={},this.commentExercise="",this.showPoint=!0,this.sizeMarkEditor={width:200,height:800},this.checkInputActive=!1,this.objectResult={},this.hasAttachmentFile=!1,this.handleIframe=b=>{"MNoteJson"==b.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=b.data.data,this.uploadAll(this.mnoteJsonData.pages??[],b.data.data.point)),"MNoteReSubmit"==b.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==b.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId&&this.sendDataToMarkNote()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){document.body.style.overflowY="auto",window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(V.y),e.Y36(w.gz),e.Y36(N.P6),e.Y36(re.j),e.Y36(U.C),e.Y36(ce.E),e.Y36(R.a),e.Y36(le.W),e.Y36(e.s_b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-mark-exercise-new"]],viewQuery:function(t,i){if(1&t&&e.Gf(We,5),2&t){let a;e.iGM(a=e.CRH())&&(i.MarkNote=a.first)}},hostBindings:function(t,i){1&t&&e.NdJ("resize",function(s){return i.onResize(s)},!1,e.Jf7)},features:[e.qOj],decls:53,vars:41,consts:[[1,"content",2,"padding","0 12px"],[1,"grid","grid-cols-12","gap-3","mt-3"],[1,"col-span-12","md:col-span-8","mark-editor",3,"ngStyle"],[4,"ngIf"],["class","w-full",4,"ngIf"],["id","mark-general",1,"col-span-12","md:col-span-4","mark-general"],["id","mark-general-box",1,"box"],[1,"p-2"],[1,"box-head"],[1,"font-medium"],[1,"flex","items-center","mt-2"],[1,"info-student","flex","items-center"],[3,"nameCreateAvatar","size"],[1,"info","ml-2"],[1,"text-md"],[1,"text-xs"],[1,"score","ml-auto","flex","items-center"],["appOnlyNumber","","type","text","id","azt-score",1,"form-control","text-danger","font-medium",3,"decimal","max","value","placeholder","input"],[1,"bg-slate-200","dark:bg-darkmode-400","p-2","text-center","rounded","mt-3"],[4,"ngIf","ngIfElse"],["notMark",""],[1,"choose-score","mt-3"],[1,"score-list-one","grid","grid-cols-10","gap-3"],["class","score-item col-span-2",4,"ngFor","ngForOf"],[1,"comment","mt-3"],[1,"font-medium","text-md"],[1,"comment-editor","mt-2"],[3,"apiKey","ngModel","init","ngModelChange"],[1,"flex","items-center","mt-3"],[1,"form-check","form-switch"],["id","show-score","type","checkbox",1,"form-check-input","mr-2",3,"ngModel","ngModelChange"],["for","show-score",1,"form-check-label","ml-0"],[1,"ml-auto"],["azt-track-service","mark-exercise-new-yWLPF_cK9E",1,"btn","btn-pending",3,"disabled","click"],[1,"grid","grid-cols-2","gap-3","mt-3"],["azt-track-service","mark-exercise-new-xgpK5bMM5y",1,"btn","btn-secondary",3,"click"],["azt-track-service","mark-exercise-new-lNij5J4UCD",1,"btn","btn-primary",3,"disabled","click"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[3,"dataMarkNote","showBackLink","markedByObj","historyAnswerObjs","handleBackLink","doneLoadData","markData","getIdHistory"],["aztMarkNote",""],[1,"w-full"],["azt-track-service","mark-exercise-new-KdZ2FWuCn",1,"btn","btn-transparent",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-5","h-5"],["points","15 18 9 12 15 6"],[1,"azt-hidden","sm:block"],[1,"text-center","mx-auto"],["width","87","height","102","viewBox","0 0 87 102","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M66.6719 13.9999L75.9738 81.8427L76.8095 88.649C77.0787 90.8417 75.5194 92.8374 73.3268 93.1066L14.7665 100.297C12.5739 100.566 10.5781 99.0069 10.3089 96.8142L1.29312 23.3867C1.1585 22.2904 1.93813 21.2925 3.03447 21.1579C3.0414 21.157 3.04832 21.1562 3.05526 21.1554L7.91363 20.6104M11.8422 20.1698L16.4292 19.6552L11.8422 20.1698Z","fill","white"],["d","M67.9103 13.8302C67.8165 13.1462 67.186 12.6678 66.5021 12.7615C65.8181 12.8553 65.3397 13.4858 65.4335 14.1697L67.9103 13.8302ZM75.9738 81.8427L77.2144 81.6903C77.2137 81.6845 77.213 81.6787 77.2122 81.6729L75.9738 81.8427ZM76.8095 88.649L78.0502 88.4967L76.8095 88.649ZM73.3268 93.1066L73.4791 94.3473L73.3268 93.1066ZM14.7665 100.297L14.9189 101.538L14.7665 100.297ZM10.3089 96.8142L11.5496 96.6619L10.3089 96.8142ZM3.05526 21.1554L3.1946 22.3976L3.05526 21.1554ZM8.05297 21.8527C8.73902 21.7757 9.23279 21.1572 9.15583 20.4711C9.07888 19.7851 8.46034 19.2913 7.77428 19.3682L8.05297 21.8527ZM11.7028 18.9276C11.0168 19.0045 10.523 19.6231 10.5999 20.3091C10.6769 20.9952 11.2954 21.4889 11.9815 21.412L11.7028 18.9276ZM16.5685 20.8974C17.2546 20.8205 17.7484 20.2019 17.6714 19.5159C17.5945 18.8298 16.9759 18.3361 16.2899 18.413L16.5685 20.8974ZM65.4335 14.1697L74.7353 82.0125L77.2122 81.6729L67.9103 13.8302L65.4335 14.1697ZM74.7331 81.995L75.5688 88.8013L78.0502 88.4967L77.2144 81.6903L74.7331 81.995ZM75.5688 88.8013C75.7539 90.3088 74.6819 91.6809 73.1744 91.866L73.4791 94.3473C76.357 93.994 78.4035 91.3745 78.0502 88.4967L75.5688 88.8013ZM73.1744 91.866L14.6142 99.0563L14.9189 101.538L73.4791 94.3473L73.1744 91.866ZM14.6142 99.0563C13.1067 99.2414 11.7347 98.1694 11.5496 96.6619L9.0682 96.9666C9.42156 99.8445 12.041 101.891 14.9189 101.538L14.6142 99.0563ZM11.5496 96.6619L2.5338 23.2344L0.0524334 23.539L9.0682 96.9666L11.5496 96.6619ZM2.5338 23.2344C2.48332 22.8232 2.77568 22.449 3.18681 22.3986L2.88213 19.9172C1.10059 20.1359 -0.166313 21.7575 0.0524334 23.539L2.5338 23.2344ZM3.18681 22.3986C3.1894 22.3982 3.192 22.3979 3.1946 22.3976L2.91592 19.9132C2.90465 19.9145 2.89339 19.9158 2.88213 19.9172L3.18681 22.3986ZM3.1946 22.3976L8.05297 21.8527L7.77428 19.3682L2.91592 19.9132L3.1946 22.3976ZM11.9815 21.412L16.5685 20.8974L16.2899 18.413L11.7028 18.9276L11.9815 21.412Z","fill","#1F64E7"],["fill-rule","evenodd","clip-rule","evenodd","d","M64.14 18.2692L72.5596 79.7529L73.3169 85.9212C73.5609 87.9083 72.1669 89.7146 70.2033 89.9557L17.7613 96.3948C15.7978 96.6359 14.0082 95.2204 13.7642 93.2333L5.61416 26.8568C5.47955 25.7605 6.25918 24.7626 7.35551 24.628L13.8431 23.8314","fill","#E8F0FE"],["d","M20.9219 4C20.9219 2.48122 22.1531 1.25 23.6719 1.25H69.2286C69.9577 1.25 70.6569 1.5395 71.1726 2.05485L84.6158 15.4898C85.1319 16.0056 85.4219 16.7053 85.4219 17.4349V80C85.4219 81.5188 84.1907 82.75 82.6719 82.75H23.6719C22.1531 82.75 20.9219 81.5188 20.9219 80V4Z","fill","white","stroke","#1F64E7","stroke-width","2.5"],["d","M69.6719 2.40283V14C69.6719 15.6569 71.015 17 72.6719 17H80.6055","stroke","#1F64E7","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["d","M31 17H57M31 29H74M31 42H74M31 55H74M31 68H57","stroke","#75A4FE","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],[1,"font-medium","mt-5"],[1,"score-item","col-span-2"],["azt-track-service","mark-exercise-new-YBVZ7xc_A",1,"border","border-slate-200","dark:border-darkmode-400","btn-score","btn",3,"click"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,qe,3,4,"ng-container",3),e.YNc(4,Ve,18,6,"div",4),e.qZA(),e.TgZ(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"h3",9),e._uU(10),e.qZA(),e.TgZ(11,"div",10)(12,"div",11),e._UZ(13,"azt-create-avatar",12),e.TgZ(14,"div",13)(15,"p",14),e._uU(16),e.qZA(),e.TgZ(17,"p",15),e._uU(18),e.qZA()()(),e.TgZ(19,"div",16)(20,"input",17),e.NdJ("input",function(s){return i.setPointInput(s)}),e.ALo(21,"mytranslate"),e.qZA()()()(),e.TgZ(22,"div",18),e.YNc(23,$e,4,8,"span",19),e.YNc(24,Xe,3,3,"ng-template",null,20,e.W1O),e.qZA(),e.TgZ(26,"div",21)(27,"div",22),e.YNc(28,et,3,1,"div",23),e.qZA()(),e.TgZ(29,"div",24)(30,"p",25),e._uU(31),e.ALo(32,"mytranslate"),e.qZA(),e.TgZ(33,"div",26)(34,"editor",27),e.NdJ("ngModelChange",function(s){return i.commentExercise=s}),e.qZA()()(),e.TgZ(35,"div",28)(36,"div",29)(37,"input",30),e.NdJ("ngModelChange",function(s){return i.showPoint=s}),e.qZA(),e.TgZ(38,"label",31),e._uU(39),e.ALo(40,"mytranslate"),e.qZA()(),e.TgZ(41,"div",32)(42,"button",33),e.NdJ("click",function(){return i.handleOpenReSubmit()}),e._uU(43),e.ALo(44,"mytranslate"),e.qZA()()(),e.TgZ(45,"div",34)(46,"button",35),e.NdJ("click",function(){return i.goBack()}),e._uU(47),e.ALo(48,"mytranslate"),e.qZA(),e.TgZ(49,"button",36),e.NdJ("click",function(){return i.saveDataMarkExercise()}),e.YNc(50,tt,2,0,"span",37),e._uU(51),e.ALo(52,"mytranslate"),e.qZA()()()()()()()),2&t){const a=e.MAs(25);e.xp6(2),e.Q6J("ngStyle",e.VKq(39,it,i.sizeMarkEditor.height+"px")),e.xp6(1),e.Q6J("ngIf",i.dataMarkNote.answer_obj),e.xp6(1),e.Q6J("ngIf",!i.dataMarkNote||!i.dataMarkNote.answer_obj),e.xp6(6),e.hij(" ",null==i.homeworkObj?null:i.homeworkObj.name," "),e.xp6(3),e.Q6J("nameCreateAvatar",null==i.studentObj?null:i.studentObj.fullName)("size",35),e.xp6(3),e.hij(" ",null==i.studentObj?null:i.studentObj.fullName," "),e.xp6(2),e.hij(" ",null==i.classroomObj?null:i.classroomObj.name," "),e.xp6(2),e.s9C("placeholder",e.lcZ(21,27,"lang_auto_nhap_diem")),e.Q6J("decimal",!0)("max",999)("value",i.pointExercise.name),e.xp6(3),e.Q6J("ngIf",i.markData.totalRight||i.markData.totalWrong)("ngIfElse",a),e.xp6(5),e.Q6J("ngForOf",i.listPointAzt),e.xp6(3),e.hij(" ",e.lcZ(32,29,"lang_auto_nhan_xet")," "),e.xp6(3),e.s9C("apiKey",i.tinyEditorKey),e.Q6J("ngModel",i.commentExercise)("init",i.initDataEditor),e.xp6(3),e.Q6J("ngModel",i.showPoint),e.xp6(2),e.hij(" ",e.lcZ(40,31,"lang_auto_hien_thi_diem")," "),e.xp6(3),e.Q6J("disabled",""!==i.historyId),e.xp6(1),e.hij(" ",e.lcZ(44,33,"lang_auto_yeu_cau_nop_lai")," "),e.xp6(4),e.hij(" ",e.lcZ(48,35,"lang_auto_quay_lai")," "),e.xp6(2),e.Q6J("disabled",i.loadingSaveData||""!==i.historyId||""==i.pointExercise.name||i.loadingDataCdn),e.xp6(1),e.Q6J("ngIf",i.loadingSaveData),e.xp6(1),e.hij(" ",e.lcZ(52,37,"lang_auto_luu_du_lieu")," ")}},dependencies:[x.sg,x.O5,x.PC,n.PG,c.Wl,c.JJ,c.On,de.g,Qe.Y,oe.n,Ke.H,A.JV],styles:[".btn-score[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.btn-score[_ngcontent-%COMP%]:hover{background:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}.choose-score[_ngcontent-%COMP%]{max-width:80%;margin-left:auto;margin-right:auto}.toolbar-list[_ngcontent-%COMP%]{width:100%;padding:5px;position:absolute;top:0;left:0;display:flex;align-items:center;border-bottom-left-radius:0;border-bottom-right-radius:0}.btn-icon[_ngcontent-%COMP%]{padding:10px;min-width:auto;line-height:initial}.toolbar-item[_ngcontent-%COMP%]{margin:0 3px}.toolbar-item[_ngcontent-%COMP%]:first-child{margin-left:0}.btn-icon-child[_ngcontent-%COMP%]{padding:5px}.azt-toolbar-active[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}  .dark .azt-toolbar-active{--tw-bg-opacity: 1;background-color:rgb(var(--color-darkmode-200)/var(--tw-bg-opacity))}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}@media screen and (max-width: 768px){.choose-score[_ngcontent-%COMP%]{max-width:80%}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}.content[_ngcontent-%COMP%]{margin-bottom:100px}}#mark-general-box[_ngcontent-%COMP%]{height:calc(100vh - 24px);overflow:auto}@media screen and (max-width: 768px){#mark-general-box[_ngcontent-%COMP%]{position:relative;min-height:100vh;height:auto;overflow:hidden}}"]}),o})();var me=r(75270),he=r(77988);function ot(o,u){if(1&o&&(e.TgZ(0,"button",15),e.ALo(1,"mytranslate"),e.TgZ(2,"mat-icon"),e._uU(3,"history"),e.qZA()()),2&o){e.oxw();const t=e.MAs(8);e.s9C("matTooltip",e.lcZ(1,2,"lang_homework_mark_exercise_history_submit")),e.Q6J("matMenuTriggerFor",t)}}function st(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"li")(1,"button",16),e.NdJ("click",function(){const s=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.getDataHistory(s.id?s.id.toString():""))}),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"mytranslate"),e.ALo(5,"formatFullDateTimeWithoutSecondByUserUnitPipe"),e.qZA()()()}if(2&o){const t=u.$implicit,i=u.index;e.xp6(3),e.lnq("",e.lcZ(4,3,"lang_homework_mark_exercise_times")," ",i+1," - ",e.lcZ(5,5,t.createdAt),"")}}function nt(o,u){if(1&o&&(e.TgZ(0,"span"),e._UZ(1,"azt-create-avatar",18),e.ALo(2,"mytranslate"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("customTooltip",e.lcZ(2,4,"lang_homework_mark_exercise_teacher_mark")+": "+(null==t.markedByObj?null:t.markedByObj.fullName))("nameCreateAvatar",null==t.markedByObj?null:t.markedByObj.fullName)("size",25)("linkAvatar",null==t.markedByObj?null:t.markedByObj.avatar)}}function rt(o,u){if(1&o&&(e.TgZ(0,"h4",17),e.YNc(1,nt,3,6,"span",13),e._uU(2),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isMarked),e.xp6(1),e.AsE(" ",null==t.studentObj?null:t.studentObj.fullName,", ",t.classroomObj.name," ")}}function ct(o,u){if(1&o&&(e._UZ(0,"azt-loading-effect",19),e.ALo(1,"mytranslate")),2&o){const t=e.oxw();e.Q6J("currentStatusObj",t.statusObj)("customText",e.lcZ(1,2,"lang_homework_mark_exercise_loading_data_mark"))}}function lt(o,u){if(1&o&&(e.TgZ(0,"div")(1,"div",20)(2,"div",21)(3,"div",22),e._uU(4),e.ALo(5,"mytranslate"),e.qZA()()()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(e.lcZ(5,1,t.errorMessage))}}function dt(o,u){if(1&o&&(e.TgZ(0,"div",23),e._UZ(1,"iframe",24),e.ALo(2,"safe"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("src",e.lcZ(2,1,t.whiteListMNoteIframeSrc),e.uOi)}}let mt=(()=>{class o extends L.Q{onPopState(t){this.goBack()}uploadDrawBase64ToCDN(t,i,a){let s=(0,K.G)(t);this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${i}_${this.answerId}.png`,"image/png").subscribe(p=>{p.type!=Q.dt.UploadProgress&&(1==p.success?(this.mnoteJsonData.pages?.[i]&&(this.mnoteJsonData.pages[i].draw=p.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,a,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(t,i){this.pagesCount=0;for(let a=0;a<t.length;a++)t[a].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,i,this.mnoteJsonData);else for(let a=0;a<t.length;a++)t[a].draw&&this.uploadDrawBase64ToCDN(t[a].draw,a,i)}reloadPage(){location.reload()}sendDataToIframe(){const t=document.getElementById("mNote"),i=t?t.contentWindow:null;if(null!==i){let a=this.castObj(this.result.answerObj);if(null!=a){let l=this.commonService.willDeleteParseJson(a.result??"");if(null!=l){let b=l.pages?.length??0;for(let C=0;C<b;C++)l?.pages?.[C].backgroundImage&&(l.pages[C].backgroundImage=this.cdnService.getMyCdn(l.pages[C].backgroundImage??"")),l.pages?.[C].draw&&(l.pages[C].draw=this.cdnService.getMyCdn(l.pages[C].draw));l=JSON.stringify(l),a.result=l}let g=this.commonService.willDeleteParseJson(a.files??"");if(null!=g){for(let b=0;b<g.length;b++)g[b].url&&(g[b].url=this.cdnService.getMyCdn(g[b].url)),g[b].thumb&&(g[b].thumb=this.cdnService.getMyCdn(g[b].thumb));g=JSON.stringify(g),a.files=g}}let s=this.result.studentObj,p=this.result.classroomObj,m=this.result.homeworkObj,_=this.commonService.myParseJson(a?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let l=0;l<(this.jsonData.pages?.length??0);l++)this.jsonData.pages?.[l].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[l].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[l].backgroundImage??"")),this.jsonData.pages?.[l].hasOwnProperty("draw")&&(this.jsonData.pages[l].draw=this.cdnService.getMyCdn(this.jsonData.pages[l].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=a,this.jsonData.student_obj=s,this.jsonData.classroom_obj=p,this.jsonData.homework_obj=m,_&&_.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=_.hideMark),i.postMessage(this.jsonData,"*");else{let l=[];this.files.forEach(b=>{l.push({backgroundImage:b.url})});let g={cmd:"initMNote",mode:"edit",pages:l,answer_obj:a,student_obj:s,classroom_obj:p,homework_obj:m};_&&_.hasOwnProperty("hideMark")&&(g.hideMark=_.hideMark),i.postMessage(g,"*")}}}sendDataToIframeHistory(){const t=document.getElementById("mNote");t&&1==this.countLoad&&(t.src+="");const i=t?t.contentWindow:null;if(null!==i){let a=this.castObj(this.result.answerObj);if(null!=a){let l=this.commonService.willDeleteParseJson(a?.result??"");if(null!=l){for(let b=0;b<l.pages.length;b++)l.pages[b].backgroundImage&&(l.pages[b].backgroundImage=this.cdnService.getMyCdn(l.pages[b].backgroundImage)),l.pages[b].draw&&(l.pages[b].draw=this.cdnService.getMyCdn(l.pages[b].draw));l=JSON.stringify(l),a.result=l}let g=this.commonService.willDeleteParseJson(a.files??"");if(null!=g){for(let b=0;b<g.length;b++)g[b].url&&(g[b].url=this.cdnService.getMyCdn(g[b].url)),g[b].thumb&&(g[b].thumb=this.cdnService.getMyCdn(g[b].thumb));g=JSON.stringify(g),a.files=g}}let s=this.studentObj,p=this.classroomObj,m=this.homeworkObj,_=this.commonService.willDeleteParseJson(a?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let l=0;l<(this.jsonData.pages?.length??0);l++)this.jsonData.pages?.[l].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[l].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[l].backgroundImage??"")),this.jsonData.pages?.[l].hasOwnProperty("draw")&&(this.jsonData.pages[l].draw=this.cdnService.getMyCdn(this.jsonData.pages[l].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="view",this.jsonData.answer_obj=a,this.jsonData.student_obj=s,this.jsonData.classroom_obj=p,this.jsonData.homework_obj=m,_&&_.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=_.hideMark),i.postMessage(this.jsonData,"*");else{let l=[];this.files.forEach(b=>{l.push({backgroundImage:b.url})});let g={cmd:"initMNote",mode:"view",pages:l,answer_obj:a,student_obj:s,classroom_obj:p,homework_obj:m};_&&_.hasOwnProperty("hideMark")&&(g.hideMark=_.hideMark),i.postMessage(g,"*")}}}getHistoryObjs(t){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,t).subscribe(i=>{1==i.success?this.historyAnswerObjs=i.data?.objs??new Array:this.errorMessage=i.message??"",this.stopStatusObj()})}getDataHistory(t){this.historyId=t,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(t,10)).subscribe(i=>{if(1==i.success){if(i.data){if(this.zipDataService.convertSubmittedAnswersHistoryObj(i.data?.answerObj),this.result=i.data,this.markedByObj=i.data?.markedByObj,this.score=i.data?.answerObj?.point??0,this.files=this.commonService.myParseJson(i.data?.answerObj?.files??"")??[],null!=this.files)for(let a=0;a<this.files.length;a++)this.files[a].url=this.cdnService.getMyCdn(this.files?.[a].url??""),this.files[a].thumb=this.cdnService.getMyCdn(this.files?.[a].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,1==this.countLoad&&(this.hasSendDataToIframe=!1),0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframeHistory())}this.successStatusObj(),this.countLoad++}else this.errorMessage=i.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var t=this.commonService.myParseJson(this.result.answerObj?.result??"");t&&(this.jsonData=t,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(t){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,t).subscribe(i=>{1==i.success&&i.data?(this.studentObj=i.data.studentObj,this.errorMessage="lang_auto_chua_nop_bai",this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(t){this.initStatusObj(),this.errorMessage="",this.answerId=t,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,t).subscribe(i=>{if(1==i.success)if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),i.data?.hasOwnProperty("studentObj")&&null!=i.data?.studentObj){if(this.result=i.data,this.markedByObj=i.data.markedByObj,this.score=i.data?.answerObj?.point??0,this.homeworkID=i.data.homeworkObj?.id??0,this.classID=i.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(i.data.answerObj?.files??"")??[],this.studentObj=i.data.studentObj,this.classroomObj=i.data.classroomObj??{},null!=this.files)for(let a=0;a<this.files.length;a++)this.files[a].url=this.cdnService.getMyCdn(this.files?.[a].url??""),this.files[a].thumb=this.cdnService.getMyCdn(this.files?.[a].thumb??"");this.homeworkObj=i.data.homeworkObj??{},this.studentName=i.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframe()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=i.message??"",this.stopStatusObj()})}openDialog(t,i){this.sAztDialogService.open(ne,{width:"280px",autoFocus:!1,data:{score:i,status:t,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){null!=this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(t,i,a,s,p){let m={status:t,deadline:i,itemHomework:a,ans_id:s,name:p,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(se,{width:"380px",panelClass:"cleanResultDialogBox",data:m,restoreFocus:!1}).afterClosed().subscribe(l=>{if(l&&l.result&&l.isRedirect){let g="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+m.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+m.classID+"/"+m.itemHomework.id+"/"+this.homeworkHashId,g)}})}remark(t,i,a){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let p={id:t,comment:a.comment,hideMark:a.hideMark?1:0,point:i?parseFloat(i.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(a)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,p).subscribe(m=>{1==m.success?(this.openDialog(!0,m.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId);let t=document.body,i=document.getElementById("azota-app-html");i?.classList.remove("overflow-hidden"),i?.classList.remove("height-100"),t.classList.remove("overflow-hidden"),t.classList.remove("height-100")}ngOnInit(){let t=document.body,i=document.getElementById("azota-app-html");i?.classList.add("overflow-hidden"),i?.classList.add("height-100"),t.classList.add("overflow-hidden"),t.classList.add("height-100"),this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";const a=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),s=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),p=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let m=this.commonService.getMyQueryParam("backto");this.backToLink=m?m.includes("shareType")?decodeURIComponent(m):m:"",a?(this.getData(a),this.getHistoryObjs(a)):this.getStudentObj(s),p&&this.getDataHistory(p),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(t,i,a,s,p,m,_,l){super(),this.activeRoute=t,this.answerService=i,this.permissionService=a,this.sAztDialogService=s,this.cdnService=p,this.zipDataService=m,this.envService=_,this.apiUploadService=l,this.answerId=0,this.homeworkID="",this.historyId="",this.whiteListMNoteIframeSrc="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.handleIframe=g=>{"MNoteJson"==g.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=g.data.data,this.uploadAll(this.mnoteJsonData.pages??[],g.data.data.point)),"MNoteReSubmit"==g.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==g.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId?this.sendDataToIframe():this.sendDataToIframeHistory()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(w.gz),e.Y36(N.P6),e.Y36(re.j),e.Y36(U.C),e.Y36(ce.E),e.Y36(R.a),e.Y36(me.h),e.Y36(le.W))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-mark-exericse"]],hostBindings:function(t,i){1&t&&e.NdJ("popstate",function(s){return i.onPopState(s)},!1,e.Jf7)},features:[e.qOj],decls:22,vars:13,consts:[["id","markContainer",1,"maxW1000"],["id","titleRow"],[1,"block-left"],["azt-track-service","mark-exercise-bqS4xx4zrp","mat-button","",3,"title","click"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],[1,"dropdown-menu","w-56","show","relative"],[1,"dropdown-content"],["azt-track-service","mark-exercise-7krhNQm3da",1,"dropdown-item","w-full",3,"click"],[4,"ngFor","ngForOf"],["class","studentInfo","style","padding-right: 10px; color: #fff",4,"ngIf"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"hidden"],[4,"ngIf"],["class","card-box listPhotos",4,"ngIf"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor"],["azt-track-service","mark-exercise-5mJpoIUV_A",1,"dropdown-item","w-full",3,"click"],[1,"studentInfo",2,"padding-right","10px","color","#fff"],[2,"cursor","pointer",3,"customTooltip","nameCreateAvatar","size","linkAvatar"],[3,"currentStatusObj","customText"],[1,"row","justify-content-center","py-5"],[1,"col-12","text-center"],[1,"alert","alert-danger"],[1,"card-box","listPhotos"],["id","mNote","frameborder","0",2,"width","100%","height","100%",3,"src"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),e.NdJ("click",function(){return i.goBack()}),e.ALo(4,"mytranslate"),e._uU(5,"keyboard_arrow_left"),e.qZA(),e.YNc(6,ot,4,4,"button",4),e.TgZ(7,"mat-menu",null,5)(9,"div",6)(10,"ul",7)(11,"li")(12,"button",8),e.NdJ("click",function(){return i.reloadPage()}),e.TgZ(13,"span"),e._uU(14),e.ALo(15,"mytranslate"),e.qZA()()(),e.YNc(16,st,6,7,"li",9),e.qZA()()()(),e.YNc(17,rt,3,3,"h4",10),e.qZA(),e.YNc(18,ct,2,4,"azt-loading-effect",11),e.TgZ(19,"div",12),e.YNc(20,lt,6,3,"div",13),e.YNc(21,dt,3,3,"div",14),e.qZA()()),2&t&&(e.xp6(3),e.s9C("title",e.lcZ(4,9,"lang_button_back")),e.xp6(3),e.Q6J("ngIf",null!=i.historyAnswerObjs&&i.historyAnswerObjs.length>0),e.xp6(8),e.Oqu(e.lcZ(15,11,"lang_homework_mark_exercise_last")),e.xp6(2),e.Q6J("ngForOf",i.historyAnswerObjs),e.xp6(1),e.Q6J("ngIf",i.classroomObj),e.xp6(1),e.Q6J("ngIf",i.statusObj.loading),e.xp6(1),e.Q6J("hidden",i.statusObj.loading),e.xp6(1),e.Q6J("ngIf",""!=i.errorMessage),e.xp6(1),e.Q6J("ngIf",""==i.errorMessage))},dependencies:[x.sg,x.O5,$.RK,Y.Hw,he.VK,he.p6,X.gM,B.l,de.g,A.JV,A.CR,A.$n],styles:["#markContainer[_ngcontent-%COMP%]{position:relative}  .studentInfo img{display:inline-flex!important}#titleRow[_ngcontent-%COMP%]{background-color:#00a7d0;height:40px;position:relative;align-items:center;display:flex;justify-content:space-between;color:#fff}#titleRow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}#titleRow[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:0;font-weight:500;font-size:16px;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;display:-webkit-box}#titleRow[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]{margin-right:5px}.block-left[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{border:none}.listPhotos[_ngcontent-%COMP%]{width:100%;position:fixed;top:40px;bottom:0}.file[_ngcontent-%COMP%]{border-width:0px;background:inherit;background-color:#f2f2f2;box-sizing:border-box;border-width:1px;border-style:solid;border-color:#e5e5e5;border-left:0px;border-right:0px;border-radius:0;box-shadow:none}.file[_ngcontent-%COMP%]:first-child{margin-top:52px}.file[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.back[_ngcontent-%COMP%]{padding:15px 10px}.back-to[_ngcontent-%COMP%]{color:#fff;display:flex}.back-to[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:10px}.block[_ngcontent-%COMP%]{padding-top:2px}.mat-expansion-indicator[_ngcontent-%COMP%]:after{color:#fff!important}.add-click[_ngcontent-%COMP%]{display:flex}.add-icon[_ngcontent-%COMP%]{margin-top:5px}.file-custom[_ngcontent-%COMP%]{margin-top:6px}.description__share[_ngcontent-%COMP%]{margin-top:10px}.description__share[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff;color:#666;margin-right:15px;padding:5px 10px 0}.row-check[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:10px 0}.col-check[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:5px}.exercise[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:25px 0 15px;border-bottom:1px solid #eee}.btn-custom[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff;border-radius:5px;padding:10px 25px}.files-custom[_ngcontent-%COMP%]{margin:0}.btn-share[_ngcontent-%COMP%]{border:1px solid #eee}.score-exercise[_ngcontent-%COMP%]{background-color:#ea3d19;border-radius:50%;padding:3px 5px 3px 7px;color:#fff;font-weight:600;margin:0 10px}#listNumber[_ngcontent-%COMP%]{display:contents}#markNumber[_ngcontent-%COMP%]{position:absolute;top:40px;right:50%;z-index:9;margin-right:-60px;color:#fff;text-transform:uppercase;width:120px}@media (min-width: 1000px){.mark-edit[_ngcontent-%COMP%]{width:250px}.file[_ngcontent-%COMP%]:first-child{margin-top:0}.listPhotos[_ngcontent-%COMP%]{width:1000px}}"]}),o})();var ht=r(46558);const pt=[{path:"",component:(()=>{class o extends L.Q{ngOnInit(){super.ngOnInit()}constructor(t){super(),this.commonService=t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ht.z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["homework-master-page"]],features:[e.qOj],decls:2,vars:0,consts:[["id","homework-layout"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"router-outlet"),e.qZA())},dependencies:[w.lC],encapsulation:2}),o})(),canActivate:[P.v],children:[{path:"add-new-homework/:cat_id",component:Le},{path:"mark-exercise/:id/:hash_id/:studentId",component:mt},{path:"switch-mark-exercise/:id/:hash_id/:studentId",component:(()=>{class o extends L.Q{getData(t){this.initStatusObj(),this.answerService.apiAnswerGetObjGet(this.homeworkHashId,t).subscribe(i=>{if(1==i.success)if(this.zipDataService.convertSubmittedAnswersObj(i.data?.answerObj),null!=i.data?.studentObj){const a=i.data,s=this.envService.getVersionMarkNote(this.classliveUrl),p=1e6;a.answerObj?.result?(a.answerObj?.result??"").includes("urlDataMark")?this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(s>p?`/admin/homework/mark-exercise-new/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`:`/admin/homework/mark-exercise/${a.answerObj?.id??0}/${this.homeworkHashId}/${i.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`),this.successStatusObj()}else this.stopStatusObj();else this.stopStatusObj()})}ngOnInit(){this.classliveUrl=this.envService.getEnvValue("classliveUrl")??"",this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";const t=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),i=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0);let a=this.commonService.getMyQueryParam("backto");this.backToLink=a?a.includes("shareType")?decodeURIComponent(a):a:"",t?this.getData(t):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/0/${this.homeworkHashId}/${i}`,`?backto=${encodeURIComponent(this.backToLink)}`),super.ngOnInit()}constructor(t,i,a,s){super(),this.activeRoute=t,this.answerService=i,this.zipDataService=a,this.envService=s,this.homeworkHashId="",this.backToLink="",this.classliveUrl=""}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(w.gz),e.Y36(N.P6),e.Y36(R.a),e.Y36(me.h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-mark-exercise-new"]],features:[e.qOj],decls:0,vars:0,template:function(t,i){},encapsulation:2}),o})()},{path:"mark-exercise-new/:id/:hash_id/:studentId",component:at},{path:"content-store",component:Be}]}];let ft=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[w.Bz.forChild(pt),w.Bz,J.fQ]}),o})(),_t=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[{provide:n.f8,useValue:j.N.azt_tiny_mce_script_src}],imports:[f.kb,w.Bz,x.ez,O.j,n.Z_,ft,c.u5,c.UX,S.Is,h.Z,k.xC,y.W,v.d,M.k,d.qyJ.pick(d.ciZ)]}),o})()},76024:(I,D,r)=>{"use strict";r.d(D,{Y:()=>c});var x=r(65879);let c=(()=>{class S{constructor(n){this.el=n,this.hasDecimalPoint=!1,this.hasNegativeSign=!1,this.navigationKeys=["Backspace","Delete","Tab","Escape","Enter","Home","End","ArrowLeft","ArrowRight","Clear","Copy","Paste"],this.decimal=!1,this.decimalSeparator=".",this.decimalSeparator1=".",this.decimalSeparator2=",",this.allowNegatives=!1,this.allowPaste=!0,this.negativeSign="-",this.min=-1/0,this.max=1/0,this.regex=null,this.inputElement=n.nativeElement}ngOnChanges(n){if(n.pattern&&(this.regex=this.pattern?RegExp(this.pattern):null),n.min){const d=Number(this.min);this.min=isNaN(d)?-1/0:d}if(n.max){const d=Number(this.max);this.max=isNaN(d)?1/0:d}}onBeforeInput(n){if(isNaN(Number(n.data))){if(n.data===this.decimalSeparator1||n.data===this.decimalSeparator2||n.data===this.negativeSign&&this.allowNegatives)return;n.preventDefault(),n.stopPropagation()}}onKeyDown(n){if(this.navigationKeys.indexOf(n.key)>-1||("a"===n.key||"KeyA"===n.code)&&!0===n.ctrlKey||("c"===n.key||"KeyC"===n.code)&&!0===n.ctrlKey||("v"===n.key||"KeyV"===n.code)&&!0===n.ctrlKey||("x"===n.key||"KeyX"===n.code)&&!0===n.ctrlKey||("a"===n.key||"KeyA"===n.code)&&!0===n.metaKey||("c"===n.key||"KeyC"===n.code)&&!0===n.metaKey||("v"===n.key||"KeyV"===n.code)&&!0===n.metaKey||("x"===n.key||"KeyX"===n.code)&&!0===n.metaKey)return;let d="";var k=n.key;if(n.key===this.decimalSeparator2&&(k=this.decimalSeparator1),this.decimal&&k===this.decimalSeparator1)return d=this.forecastValue(k),d.split(this.decimalSeparator1).length>2||(this.hasDecimalPoint=d.indexOf(this.decimalSeparator1)>-1,this.setNewValue(k)),void n.preventDefault();if(k===this.negativeSign&&this.allowNegatives)return d=this.forecastValue(k),d.charAt(0)!==this.negativeSign||d.split(this.negativeSign).length>2?void n.preventDefault():void(this.hasNegativeSign=d.split(this.negativeSign).length>-1);if(" "===k||isNaN(Number(k)))return void n.preventDefault();if(d=d||this.forecastValue(k),this.regex&&!this.regex.test(d))return void n.preventDefault();const f=Number(d);(f>this.max||f<this.min)&&n.preventDefault()}onPaste(n){if(!0===this.allowPaste){let d="";window.clipboardData?d=window.clipboardData.getData("text"):n.clipboardData&&n.clipboardData.getData&&(d=n.clipboardData.getData("text/plain")),this.pasteData(d),n.preventDefault()}else n.preventDefault(),n.stopPropagation()}onDrop(n){const d=n.dataTransfer?.getData("text")??"";this.inputElement.focus(),this.pasteData(d),n.preventDefault()}pasteData(n){n=this.replaceDecimalSeparator(n);const d=this.sanitizeInput(n);if(!d.includes(this.negativeSign)||!this.hasNegativeSign||this.getSelection().includes(this.negativeSign)){if(!document.execCommand("insertText",!1,d))if(this.inputElement.setRangeText){const{selectionStart:f,selectionEnd:O}=this.inputElement;this.inputElement.setRangeText(d,f??0,O??0,"end"),typeof window.InstallTrigger<"u"&&this.inputElement.dispatchEvent(new Event("input",{cancelable:!0}))}else this.insertAtCursor(this.inputElement,d);this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}}setNewValue(n){n=this.replaceDecimalSeparator(n),this.insertAtCursor(this.inputElement,n),this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}insertAtCursor(n,d){const k=n.selectionStart??0,f=n.selectionEnd??0;n.value=n.value.substring(0,k)+d+n.value.substring(f,n.value.length);const O=k+d.length;n.focus(),n.setSelectionRange(O,O),this.triggerEvent(n,"input")}triggerEvent(n,d){if("createEvent"in document){const k=document.createEvent("HTMLEvents");k.initEvent(d,!1,!0),n.dispatchEvent(k)}}sanitizeInput(n){let k,d="";k=this.decimal&&this.isValidDecimal(n)?new RegExp(`${this.getNegativeSignRegExp()}[^0-9${this.decimalSeparator1}]`,"g"):new RegExp(`${this.getNegativeSignRegExp()}[^0-9]`,"g"),d=n.replace(k,"");const f=this.inputElement.maxLength;if(f>0){const O=f-this.inputElement.value.length+(d.includes(`${this.negativeSign}`)?1:0);d=O>0?d.substring(0,O):""}return d}getNegativeSignRegExp(){return!this.allowNegatives||this.hasNegativeSign&&!this.getSelection().includes(this.negativeSign)?"":`(?!^${this.negativeSign})`}isValidDecimal(n){if(this.hasDecimalPoint){const d=this.getSelection();return d&&d.indexOf(this.decimalSeparator1)>-1?n.split(this.decimalSeparator1).length<=2:n.indexOf(this.decimalSeparator1)<0}return n.split(this.decimalSeparator1).length<=2}getSelection(){return this.inputElement.value.substring(this.inputElement.selectionStart??0,this.inputElement.selectionEnd??0)}forecastValue(n){const k=this.inputElement.selectionEnd??0,f=this.inputElement.value;return f.substring(0,this.inputElement.selectionStart??0)+n+f.substring(k)}replaceDecimalSeparator(n){return n.replace(",",this.decimalSeparator).replace(".",this.decimalSeparator)}}return S.\u0275fac=function(n){return new(n||S)(x.Y36(x.SBq))},S.\u0275dir=x.lG2({type:S,selectors:[["","appOnlyNumber",""]],hostBindings:function(n,d){1&n&&x.NdJ("beforeinput",function(f){return d.onBeforeInput(f)})("keydown",function(f){return d.onKeyDown(f)})("paste",function(f){return d.onPaste(f)})("drop",function(f){return d.onDrop(f)})},inputs:{decimal:"decimal",decimalSeparator:"decimalSeparator",decimalSeparator1:"decimalSeparator1",decimalSeparator2:"decimalSeparator2",allowNegatives:"allowNegatives",allowPaste:"allowPaste",negativeSign:"negativeSign",min:"min",max:"max",pattern:"pattern"},features:[x.TTD]}),S})()},95273:(I,D,r)=>{"use strict";r.d(D,{v:()=>n});var x=r(61713),c=r(78226),S=r(65879),w=r(46558);let n=(()=>{class d{getMineTypeByFileType(f){let h="";switch(this.commonService.getEnumTypeWithDefault(c.s,f,c.s.unknown)){case c.s.doc:case c.s.docx:h="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case c.s.ppt:case c.s.pptx:h="application/vnd.openxmlformats-officedocument.presentationml.presentation";break;case c.s.xlsx:h="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";break;case c.s.pdf:h="application/pdf";break;case c.s.video:case c.s.mp4:h="video/mp4";break;case c.s.mov:h="video/mov";break;case c.s.webm:h="video/webm";break;case c.s.quicktime:h="video/quicktime";break;case c.s.audio:h="audio/mpeg";break;case c.s.mp3:h="audio/mp3";break;case c.s.wav:h="audio/wav";break;case c.s.jpeg:case c.s.image:h="image/jpeg";break;case c.s.google_docs:h="google_docs"}return h}getMineTypeByExtension(f){switch(new RegExp(/(?:\.([^.]+))?$/).exec(f)?.[1]){case"pdf":return"application/pdf";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xsl":case"csv":return"application/vnd.ms-excel";case"jpg":return"image/jpg";case"jpge":return"image/jpge";default:return"application/json-patch+json"}}getTypeFileByMime(f){return f.mimes&&(0,x.MH)(f.mimes)||f.name?.toLowerCase().endsWith(".azt")?c.s.docx:f.mimes&&(0,x.AW)(f.mimes)?c.s.xlsx:f.mimes&&(0,x.F0)(f.mimes)?c.s.audio:f.mimes&&(0,x.Wv)(f.mimes)?c.s.video:f.mimes&&(0,x.Or)(f.mimes)?c.s.image:f.mimes&&(0,x._4)(f.mimes)?c.s.pdf:f.mimes&&(0,x.ZA)(f.mimes)?c.s.powerpoint:void 0}constructor(f){this.commonService=f}}return d.\u0275fac=function(f){return new(f||d)(S.LFG(w.z))},d.\u0275prov=S.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},97151:(I,D,r)=>{"use strict";r.d(D,{g:()=>k});var x=r(10217),S=r(89156),w=r(65879),n=r(23433),d=r(46558);let k=(()=>{class f{constructor(h,v){this.mobileWebviewService=h,this.commonService=v}shareFileWithBlob(h,v){if(this.commonService.isMobileWebview(void 0)){S.G.openLoadingEffect(this.commonService.myTranslateInstant("lang_auto_dang_lay_du_lieu_tu_he_thong")??"");let M=new FileReader;M.readAsDataURL(h),M.onloadend=()=>{let y=M.result;"string"==typeof y&&(this.mobileWebviewService.sendShareFileBase64(v,String(y)),S.G.closeLoadingEffect(100))}}else x.saveAs(h,v)}shareFileWithBase64(h,v){this.commonService.isMobileWebview(void 0)?this.mobileWebviewService.sendShareFileBase64(v,h):x.saveAs(h,v)}}return f.\u0275fac=function(h){return new(h||f)(w.LFG(n.r),w.LFG(d.z))},f.\u0275prov=w.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},89156:(I,D,r)=>{"use strict";r.d(D,{G:()=>x});let x=(()=>{class c{static openLoadingEffect(w){c.getDomElement().style.display="flex",setTimeout(()=>{c.changeMsgLoadingEffect(w)},50)}static closeLoadingEffect(w){return new Promise(n=>{setTimeout(()=>{const d=c.getDomElement();d&&(d.style.display="none"),n(!0)},w)})}static changeMsgLoadingEffect(w){c.getDomContent().innerText=w}static getDomContent(){return document.getElementById(c.idStatusContent)??document.createElement("span")}static getDomElement(){return document.getElementById(c.idComponent)??this.createDomElement()}static createDomElement(){const w=document.createElement("div");return w.id=c.idComponent,w.setAttribute("style","position: fixed;display: flex;width: 100vw;height: 100%;background: #000000c7;color: #ffffff;font-size: 20px;font-weight: lighter;justify-content: center;align-items: center;cursor: progress;z-index: 9999;top: 0;left: 0;"),w.style.display="none",w.innerHTML=`\n        <div class="text-center" style="height: 85%; overflow-x: auto;">\n            <div class="flex justify-center mt-5">\n                <svg width="20" viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">\n                    <g fill="none" fill-rule="evenodd">\n                        <g transform="translate(2 1)" stroke="currentColor" stroke-width="1.5">\n                            <circle cx="42.601" cy="11.462" r="5" fill-opacity="1" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="1;0;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="49.063" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;1;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="42.601" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;1;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="49.125" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;1;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;1;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="4.938" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;1;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="11.462" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;1;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="5" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;0;1" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                        </g>\n                    </g>\n                </svg>\n            </div>\n            <div style="margin-top: 10px;position: relative;">\n                <span id="${c.idStatusContent}"></span>\n            </div>\n        </div>`,document.body.appendChild(w),w}}return c.idComponent="azt-status-loading-effect",c.idStatusContent="azt-status-loading-effect-content",c})()},10217:function(I,D){var r,c;void 0!==(c="function"==typeof(r=function(){"use strict";function w(h,v,M){var y=new XMLHttpRequest;y.open("GET",h),y.responseType="blob",y.onload=function(){O(y.response,v,M)},y.onerror=function(){console.error("could not download file")},y.send()}function n(h){var v=new XMLHttpRequest;v.open("HEAD",h,!1);try{v.send()}catch{}return 200<=v.status&&299>=v.status}function d(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var v=document.createEvent("MouseEvents");v.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(v)}}var k="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,f=k.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),O=k.saveAs||("object"!=typeof window||window!==k?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(h,v,M){var y=k.URL||k.webkitURL,j=document.createElement("a");j.download=v=v||h.name||"download",j.rel="noopener","string"==typeof h?(j.href=h,j.origin===location.origin?d(j):n(j.href)?w(h,v,M):d(j,j.target="_blank")):(j.href=y.createObjectURL(h),setTimeout(function(){y.revokeObjectURL(j.href)},4e4),setTimeout(function(){d(j)},0))}:"msSaveOrOpenBlob"in navigator?function(h,v,M){if(v=v||h.name||"download","string"!=typeof h)navigator.msSaveOrOpenBlob(function S(h,v){return typeof v>"u"?v={autoBom:!1}:"object"!=typeof v&&(console.warn("Deprecated: Expected third argument to be a object"),v={autoBom:!v}),v.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\ufeff",h],{type:h.type}):h}(h,M),v);else if(n(h))w(h,v,M);else{var y=document.createElement("a");y.href=h,y.target="_blank",setTimeout(function(){d(y)})}}:function(h,v,M,y){if((y=y||open("","_blank"))&&(y.document.title=y.document.body.innerText="downloading..."),"string"==typeof h)return w(h,v,M);var j="application/octet-stream"===h.type,J=/constructor/i.test(k.HTMLElement)||k.safari,P=/CriOS\/[\d]+/.test(navigator.userAgent);if((P||j&&J||f)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var Z=T.result;Z=P?Z:Z.replace(/^data:[^;]*;/,"data:attachment/file;"),y?y.location.href=Z:location=Z,y=null},T.readAsDataURL(h)}else{var H=k.URL||k.webkitURL,E=H.createObjectURL(h);y?y.location=E:location.href=E,y=null,setTimeout(function(){H.revokeObjectURL(E)},4e4)}});k.saveAs=O.saveAs=O,I.exports=O})?r.apply(D,[]):r)&&(I.exports=c)}}]);