"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[6477],{37157:(N,R,s)=>{s.d(R,{Z:()=>y});var u=s(51698),c=s(14159),k=s(27035),r=s(17178),T=s(48915),j=s(63016),E=s(47947),x=s(81215),F=s(15351);const w=(z,C)=>(z.push(C),z);var I=s(48891);let y=(()=>{var z;class C{processObservables(A,P,_){return new u.c(m=>{this.processMultipleObservables(A,P,_).subscribe({next:t=>{m.next(t),m.complete()},error:t=>{m.next(P.map(b=>null)),m.complete()}})})}processMultipleObservables(A,P,_){return(0,c.H)(P).pipe((0,k.Z)((m,t)=>m.pipe((0,r.W)(b=>(console.error("Error in observable:",b),_?(0,T.$)(()=>b):(0,j.of)(null))),(0,E.T)(b=>({result:b,index:t}))),A),function U(){return(0,F.N)((z,C)=>{(0,x.T)(w,[])(z).subscribe(C)})}(),(0,E.T)(m=>m.sort((t,b)=>t.index-b.index).map(t=>t.result)))}}return(z=C).\u0275fac=function(A){return new(A||z)},z.\u0275prov=I.jDH({token:z,factory:z.\u0275fac,providedIn:"root"}),C})()},75421:(N,R,s)=>{s.d(R,{u:()=>U});var u=s(10936),c=s(89163),k=s(33887),r=s(48891),T=s(54460),j=s(15343),E=s(76975);const x=()=>({"mr-2 text-danger":!0});function F(I,y){if(1&I&&r.nrm(0,"lucide-icon",10),2&I){const z=r.XpG();r.Y8G("name",z.data.iconName)("ngClass",r.lJ4(2,x))}}function w(I,y){if(1&I&&(r.j41(0,"div",11)(1,"div",3)(2,"span"),r.EFF(3),r.nI1(4,"mytranslate"),r.k0s(),r.j41(5,"b"),r.EFF(6),r.k0s(),r.j41(7,"span"),r.EFF(8),r.nI1(9,"mytranslate"),r.k0s()(),r.j41(10,"div",12),r.nrm(11,"input",13),r.k0s()()),2&I){const z=r.XpG();r.R7$(3),r.JRh(r.bMT(4,4,"lang_azt_enter")+" "),r.R7$(3),r.JRh('"'+z.data.textConfirm+'" '),r.R7$(2),r.JRh(r.bMT(9,6,"lang_azt_for_delete_data")),r.R7$(3),r.Y8G("formControl",z.confirmValue)}}let U=(()=>{var I;class y extends k._{btnCloseDialog(){this.dialogRef.close(!1)}confirmDialog(){this.dialogRef.close(!0)}constructor(C,h){super(h,C),this.dialogRef=C,this.data=h,this.confirmValue=new u.MJ("",{nonNullable:!0})}}return(I=y).\u0275fac=function(C){return new(C||I)(r.rXU(c.CP,8),r.rXU(c.Vh,8))},I.\u0275cmp=r.VBU({type:I,selectors:[["azt-dialog-danger"]],features:[r.Vt3],decls:14,vars:10,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md"],["size","24",3,"name","ngClass",4,"ngIf"],[1,"text-md",3,"innerHtml"],["class","mt-3",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","azt-dialog-danger-9EJYp6jGzr",1,"btn","w-24","btn-secondary","mr-2",3,"click"],["azt-track-service","azt-dialog-danger-ffMh3NrPRC",1,"btn","w-24","btn-danger",3,"click","disabled"],["size","24",3,"name","ngClass"],[1,"mt-3"],[1,"mt-2"],["type","text",1,"form-control",3,"formControl"]],template:function(C,h){1&C&&(r.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),r.DNE(4,F,1,3,"lucide-icon",4),r.nrm(5,"span",5),r.k0s(),r.DNE(6,w,12,8,"div",6),r.k0s()(),r.j41(7,"div",7)(8,"button",8),r.bIt("click",function(){return h.btnCloseDialog()}),r.EFF(9),r.nI1(10,"mytranslate"),r.k0s(),r.j41(11,"button",9),r.bIt("click",function(){return h.confirmDialog()}),r.EFF(12),r.nI1(13,"mytranslate"),r.k0s()()()),2&C&&(r.R7$(4),r.Y8G("ngIf",h.data.iconName),r.R7$(),r.Y8G("innerHtml",h.data.content,r.npT),r.R7$(),r.Y8G("ngIf",h.data.textConfirm),r.R7$(3),r.SpI(" ",r.bMT(10,6,"lang_auto_huy")," "),r.R7$(2),r.Y8G("disabled",h.data.textConfirm&&h.data.textConfirm!==h.confirmValue.value),r.R7$(),r.SpI(" ",r.bMT(13,8,"lang_auto_xac_nhan")," "))},dependencies:[T.YU,T.bT,u.me,u.BC,u.l_,j.WGl,E.wp],encapsulation:2}),y})()},12145:(N,R,s)=>{s.d(R,{Y:()=>C});var u=s(73014),c=s(27691),k=s(48891),r=s(85710),T=s(51698),j=s(48451),E=s(79767),x=s(76975),F=s(21973),w=s(53793),U=s(52909),I=s(39712),y=s(39444),z=s(63028);let C=(()=>{var h;class A{constructor(){this.subscriptions=new r.yU,this.sAztBase64Service=(0,k.WQX)(F.D),this.ocrService=(0,k.WQX)(y.so),this.commonService=(0,k.WQX)(w.R),this.sAztUuidService=(0,k.WQX)(U.D),this.digitalizedBookPageService=(0,k.WQX)(z.gI),this.apiUploadService=(0,k.WQX)(j.T)}runRemoveBackgroundNoise(_,m,t){return new T.c(b=>{this.removeBackgroundNoise(_.oldImageUrl,m,(v,f)=>{if(null==v||f)return t(f??""),b.next(void 0),void b.complete();this.apiUploadService.commonUploadFile(I.b8.ADMIN_DIGITALIZE,this.sAztBase64Service.base64ToFile(v,"digitalized-file.png"),"").subscribe(D=>{D.type!=c.hv.UploadProgress&&(1===D.success&&D.data?.url?(b.next({..._,newImageUrl:D.data.url}),b.complete()):(t(D.message??""),b.next(void 0),b.complete()))})})})}removeBackgroundNoise(_,m,t){this.sAztBase64Service.convertImageUrlToBase64(_,b=>{if(!b)return t(void 0,"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(b),v=>{if(!v)return t(void 0,"Error to get Uint8Array from base64");this.loadScriptHandleImage(()=>{this.imageUtils.removeNoise(v,m).then(f=>t(this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(f.image)),void 0)).catch(f=>t(void 0,"Error when call imageUtils.detectImage"))})})})}callChangeBookPageDataApi(_,m,t,b,v){this.subscriptions.add(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrPost({bookId:_,bookPageId:m,ocrContent:t,originOcrContent:b}).subscribe(D=>{if(!D.success)return v(!1,D.message);v(!0,"")}))}digitalizeOneImage(_,m,t,b){return new T.c(v=>{m("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.commonService.wrapApiResponse(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:_})).subscribe(f=>{if(!f.success||!f.data)return t(f.message),v.next(!1),void v.complete();b(this.replaceOrcData(f.data)),v.next(!0),v.complete()}))})}replaceOrcData(_){let m=_.data,t=this.sAztUuidService.getUuid();return m=this.commonService.convertLatexTagToAztMathTag(m,t),m=(new x.bt).transform((new x.UN).transform(m)),m=this.commonService.replaceAll(m,"<table>","<table class='table table-bordered'>")??m,m=m.replace(new RegExp(t,"g"),"\n"),{htmlResult:m,originOcrData:_.data}}extractImageByOrcUtil(_,m){this.sAztBase64Service.convertImageUrlToBase64(_,t=>{if(!t)return m(void 0,[],"Error to get base64 from url");this.sAztBase64Service.getImageDimensions(t,b=>{this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(t),v=>{if(!v)return m(void 0,[],"Error to get Uint8Array from base64");let f={base64:this.sAztBase64Service.removePrefixOfBase64(t),x:0,y:0,width:b.width,height:b.height,extension:"png"};this.loadScriptHandleImage(()=>{this.imageUtils.detectImage(v).then(D=>m(f,D.images.map(G=>({base64:this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(G.content)),x:G.x,y:G.y,width:G.width,height:G.height,extension:G.extension})),void 0)).catch(D=>m(f,[],"Error when call imageUtils.detectImage"))})})})})}waitAnswerSheetInitDone(_){if(E.A.azotaScanAnswerSheet)return _();setTimeout(()=>{this.waitAnswerSheetInitDone(_)},100)}loadScriptHandleImage(_){var m=this;if(this.imageUtils)return _();this.commonService.loadAnswerSheetJs().then((0,u.A)(function*(){m.waitAnswerSheetInitDone((0,u.A)(function*(){m.imageUtils=yield E.A.azotaScanAnswerSheet.imageUtils(),_()}))})).catch(t=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),_()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(h=A).\u0275fac=function(_){return new(_||h)},h.\u0275prov=k.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),A})()},86477:(N,R,s)=>{s.r(R),s.d(R,{AzotaDigitalizeModule:()=>_e});var u=s(54460),c=s(10936),k=s(65162),r=s(69223),T=s(62067),j=s(15343),E=s(10123),x=s(44233),F=s(5502),w=s(21656),U=s(70050),I=s(7050),y=s(35143),z=s(43234),C=s(1133),h=s(89121),A=s(37714),P=s(72888),_=s(59640),m=s(37497),t=s(48891),b=s(63028),v=s(51113),f=s(12145),D=s(37157),G=s(36484),M=s(18718),et=s(22613),V=s(96451),Y=s(46899),it=s(53043);const nt=["*"];let $=(()=>{var n;class l extends _.H{constructor(){super(...arguments),this.imageUrl="",this.sAztDialogService=(0,t.WQX)(Y.i)}previewImage(){this.sAztDialogService.open(it.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{url:this.imageUrl,mimes:"image/jpeg"},viewFullImageWithScroll:!0},restoreFocus:!1})}}return(n=l).\u0275fac=(()=>{let o;return function(i){return(o||(o=t.xGo(n)))(i||n)}})(),n.\u0275cmp=t.VBU({type:n,selectors:[["azt-preview-image-tag"]],inputs:{imageUrl:"imageUrl"},features:[t.Vt3],ngContentSelectors:nt,decls:2,vars:0,consts:[[3,"click"]],template:function(e,i){1&e&&(t.NAR(),t.j41(0,"span",0),t.bIt("click",function(){return i.previewImage()}),t.SdG(1),t.k0s())},encapsulation:2}),l})();var O=s(76975);const Z=()=>({"flex-none":!0,"mr-1":!0});function ot(n,l){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"span",10),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.editBookPage(i.obj))}),t.nrm(2,"lucide-icon",11),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",12),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.callAgainOcrBookPageEvent.emit(i.obj))}),t.nrm(7,"lucide-icon",13),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s(),t.bVm()}2&n&&(t.R7$(2),t.Y8G("ngClass",t.lJ4(8,Z)),t.R7$(),t.SpI(" ",t.bMT(4,4,"lang_cms_admin_digitalized_edit_content")," "),t.R7$(4),t.Y8G("ngClass",t.lJ4(9,Z)),t.R7$(),t.SpI(" ",t.bMT(9,6,"lang_cms_admin_digitalized_re_digitalized_again")," "))}function at(n,l){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.JRh(t.bMT(2,1,o.obj.logMessage))}}function lt(n,l){if(1&n&&(t.j41(0,"div"),t.nrm(1,"div",15),t.nI1(2,"mathJaxContent"),t.nI1(3,"async"),t.nI1(4,"safeNormalHtmlContent"),t.k0s()),2&n){let o;const e=t.XpG();t.R7$(),t.Y8G("innerHTML",t.bMT(4,5,t.bMT(3,3,t.bMT(2,1,null!==(o=e.obj.ocrContent)&&void 0!==o?o:""))),t.npT)}}let st=(()=>{var n;class l extends _.H{constructor(){super(...arguments),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB}editBookPage(e){e.currentStatus="show_edit_form",this.changeBookPageStatusEvent.emit(e)}}return(n=l).\u0275fac=(()=>{let o;return function(i){return(o||(o=t.xGo(n)))(i||n)}})(),n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-view-book-page"]],inputs:{obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"flex-none","items-center"],[4,"ngIf"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],["class","mb-3 text-pending",4,"ngIf"],[1,"text-primary","clickable","mr-2",3,"click"],["name","pencil","size","16",3,"ngClass"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"mb-3","text-pending"],[3,"innerHTML"]],template:function(e,i){1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,ot,10,10,"ng-container",4),t.k0s()(),t.j41(7,"div",5)(8,"azt-preview-image-tag",6),t.nrm(9,"img",7),t.k0s(),t.nrm(10,"hr",8),t.DNE(11,at,3,3,"div",9)(12,lt,5,7,"div",4),t.k0s()),2&e&&(t.R7$(3),t.Lme("",t.bMT(4,7,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("ngIf",i.obj.isOrc),t.R7$(2),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.Y8G("src",i.obj.imageLink,t.B4B),t.R7$(2),t.Y8G("ngIf",i.obj.logMessage),t.R7$(),t.Y8G("ngIf",i.obj.isOrc))},dependencies:[u.YU,u.bT,$,j.WGl,u.Jj,O.wp,O.km,O._y],encapsulation:2}),l})();var L=s(52811);let rt=(()=>{var n;class l extends _.H{}return(n=l).\u0275fac=(()=>{let o;return function(i){return(o||(o=t.xGo(n)))(i||n)}})(),n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-processing-book-page"]],inputs:{obj:"obj"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],[1,"flex","items-center"],[1,"mr-1"]],template:function(e,i){if(1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()(),t.j41(5,"div",3)(6,"azt-preview-image-tag",4),t.nrm(7,"img",5),t.k0s(),t.nrm(8,"hr",6),t.j41(9,"div",7),t.nrm(10,"azt-loading-ui",8),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()()),2&e){let a;t.R7$(3),t.Lme("",t.bMT(4,5,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.Y8G("src",i.obj.imageLink,t.B4B),t.R7$(4),t.SpI(" ",t.bMT(12,7,null!==(a=i.obj.logMessage)&&void 0!==a?a:"lang_lang_cms_admin_digitalized_is_waiting_to_process")," ")}},dependencies:[L.R,$,O.wp],encapsulation:2}),l})();var X=s(21973),W=s(73014),K=s(89163),ct=s(33887);const gt=["angularCropper"];function dt(n,l){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"img",11),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const i=t.eBV(o).$implicit,a=t.XpG(2);return t.Njj(a.chooseImage(i))}),t.k0s(),t.bVm()}if(2&n){const o=l.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,o.base64,"png"),t.B4B)}}function mt(n,l){if(1&n&&(t.j41(0,"div",9),t.DNE(1,dt,3,4,"ng-container",10),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.base64Images)}}function _t(n,l){if(1&n&&(t.nrm(0,"angular-cropper",12,0),t.nI1(2,"addBase64Extension")),2&n){const o=t.XpG();t.Y8G("cropperOptions",o.cropperOptions)("imageUrl",t.i5U(2,2,o.currentBase64Image.base64,"png"))}}let pt=(()=>{var n;class l extends ct._{chooseImage(e){this.currentBase64Image=e}cropImage(e){var i=this;return(0,W.A)(function*(){i.angularCropper?.cropper.getCroppedCanvas().toBlob(a=>{a&&i.sAztBase64Service.convertBlobToBase64(a,function(){var g=(0,W.A)(function*(d){let p=i.angularCropper?.cropper.getCropBoxData(),S=p?.width,B=p?.height;!S||!B||(i.base64Images.push({base64:d,x:0,y:0,width:S,height:B,extension:"png"}),yield i.sAztBase64Service.copyBase64ToClipBoard(d),i.showSuccessSnack("lang_cms_copy_success"),e&&i.dialogRef.close(i.base64Images))});return function(d){return g.apply(this,arguments)}}())})})()}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(e,i){super(i,e),this.dialogRef=e,this.data=i,this.sAztBase64Service=(0,t.WQX)(X.D),this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=i.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return(n=l).\u0275fac=function(e){return new(e||n)(t.rXU(K.CP,8),t.rXU(K.Vh,8))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-coazt-image-editor"]],viewQuery:function(e,i){if(1&e&&t.GBs(gt,5),2&e){let a;t.mGM(a=t.lsd())&&(i.angularCropper=a.first)}},features:[t.Vt3],decls:14,vars:11,consts:[["angularCropper",""],[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn","btn-info","mr-2",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"],[3,"cropperOptions","imageUrl"]],template:function(e,i){1&e&&(t.j41(0,"div",1),t.DNE(1,mt,2,1,"div",2),t.j41(2,"div",3)(3,"span",4),t.bIt("click",function(){return i.cropImage(!0)}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",5),t.bIt("click",function(){return i.cropImage(!1)}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"span",6),t.bIt("click",function(){return i.closeDialog()}),t.EFF(10),t.nI1(11,"mytranslate"),t.k0s()(),t.j41(12,"div",7),t.DNE(13,_t,3,5,"angular-cropper",8),t.k0s()()),2&e&&(t.R7$(),t.Y8G("ngIf",i.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,5,"lang_button_crop_and_close")),t.R7$(3),t.JRh(t.bMT(8,7,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(11,9,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",i.currentBase64Image))},dependencies:[u.Sq,u.bT,T.TJ,O.wp,O.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]}),l})();function ut(n,l){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"img",6),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const i=t.eBV(o).$implicit,a=t.XpG(2);return t.Njj(a.copyImage(i))}),t.k0s(),t.bVm()}if(2&n){const o=l.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,o.base64,o.extension),t.B4B)}}function bt(n,l){if(1&n&&(t.j41(0,"div",4),t.DNE(1,ut,3,4,"ng-container",5),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.base64Images)}}let zt=(()=>{var n;class l extends _.H{constructor(){super(...arguments),this.replaceImageEvent=new t.bkB,this.sAztDialogService=(0,t.WQX)(Y.i),this.sAztDigitalizeService=(0,t.WQX)(f.Y),this.sAztBase64Service=(0,t.WQX)(X.D),this.base64Images=[]}copyImage(e){var i=this;return(0,W.A)(function*(){yield i.sAztBase64Service.copyBase64ToClipBoard(e.base64),i.showSuccessSnack("lang_cms_copy_and_replace_success"),i.replaceImageEvent.emit(e)})()}cropImageDialog(){this.sAztDialogService.open(pt,{data:{base64Images:this.base64Images},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(i=>{null!=i&&(this.base64Images=i)})}ngOnChanges(){this.initStatusObj(),this.sAztDigitalizeService.extractImageByOrcUtil(this.imageUrl,(e,i,a)=>{if(a)return this.errorStatusObj(a,!0);let g=[];e&&g.push(e),i.forEach(d=>g.push(d)),this.base64Images=g,this.stopStatusObj()})}}return(n=l).\u0275fac=(()=>{let o;return function(i){return(o||(o=t.xGo(n)))(i||n)}})(),n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-list-digitalized-images"]],inputs:{imageUrl:"imageUrl"},outputs:{replaceImageEvent:"replaceImageEvent"},features:[t.Vt3,t.OA$],decls:6,vars:4,consts:[[2,"height","228px","overflow-x","scroll","overflow-y","hidden"],["class","list-base640-images",4,"ngIf"],[1,"mb-3","mt-3"],[1,"text-primary","clickable",3,"click"],[1,"list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"]],template:function(e,i){1&e&&(t.j41(0,"div",0),t.DNE(1,bt,2,1,"div",1),t.k0s(),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return i.cropImageDialog()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()),2&e&&(t.R7$(),t.Y8G("ngIf",i.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,2,"lang_button_crop")))},dependencies:[u.Sq,u.bT,O.wp,O.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;max-height:200px}"]}),l})();const ht=()=>({"flex-none":!0,"mr-1":!0});function ft(n,l){1&n&&t.nrm(0,"azt-loading-ui",13)}function kt(n,l){1&n&&t.nrm(0,"azt-loading-ui",13)}let Ct=(()=>{var n;class l extends _.H{saveAllObjs(){this.saveAllContentEvent.emit()}saveObj(){this.initStatusObj();let e=this.obj.htmlContentFormControl.value;this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookObj.id,this.obj.id,e,void 0,(i,a)=>{if(!i)return this.errorStatusObj(a,!0);this.obj.ocrContent=e,this.changeBookPageStatusEvent.emit(this.obj),this.successStatusObj("lang_cms_update_success",!0)})}cancelObj(){this.showSuccessSnack("lang_cms_cancel_success"),this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}replaceImage(e){let i=this.obj.htmlContentFormControl.value.replace("<img>",`<img src='${this.sAztBase64Service.generateBase64Prefix(e.extension)+e.base64}'/>`);this.obj.htmlContentFormControl.setValue(i)}ngOnChanges(){this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}ngOnInit(){super.ngOnInit()}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(f.Y),this.sAztBase64Service=(0,t.WQX)(X.D),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB,this.saveAllContentEvent=new t.bkB}}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-edit-book-page"]],inputs:{bookObj:"bookObj",obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent",saveAllContentEvent:"saveAllContentEvent"},features:[t.Vt3,t.OA$],decls:26,vars:29,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"p-3"],[3,"replaceImageEvent","imageUrl"],[3,"formControl","apiKey","init"],[1,"flex-none","items-center","text-right","mt-3"],[1,"btn","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","mr-3",3,"click"],["class","mr-1",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"mr-1"]],template:function(e,i){1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"span",3),t.bIt("click",function(){return i.callAgainOcrBookPageEvent.emit(i.obj)}),t.nrm(6,"lucide-icon",4),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()(),t.j41(9,"div",5)(10,"app-digitalized-list-digitalized-images",6),t.bIt("replaceImageEvent",function(g){return i.replaceImage(g)}),t.k0s(),t.nrm(11,"editor",7),t.nI1(12,"getTinyMceKey"),t.nI1(13,"getTinyMceConfig"),t.j41(14,"div",8)(15,"button",9),t.bIt("click",function(){return i.cancelObj()}),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){return i.saveObj()}),t.DNE(19,ft,1,0,"azt-loading-ui",11),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s(),t.j41(22,"button",12),t.bIt("click",function(){return i.saveAllObjs()}),t.DNE(23,kt,1,0,"azt-loading-ui",11),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()),2&e&&(t.R7$(3),t.Lme("",t.bMT(4,14,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("ngClass",t.lJ4(28,ht)),t.R7$(),t.SpI(" ",t.bMT(8,16,"lang_cms_admin_digitalized_re_digitalized_again")," "),t.R7$(3),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.FS9("apiKey",t.bMT(12,18,"")),t.Y8G("formControl",i.obj.htmlContentFormControl)("init",t.bMT(13,20,"admin_for_digitalized")),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(5),t.JRh(t.bMT(17,22,"lang_auto_huy")),t.R7$(3),t.Y8G("ngIf",i.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(21,24,"lang_digitalized_save_one")," "),t.R7$(3),t.Y8G("ngIf",i.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(25,26,"lang_digitalized_save_all")," "))},dependencies:[u.YU,u.bT,c.BC,r.xn,c.l_,L.R,j.WGl,zt,O.wp,O.Hw,O.yc],encapsulation:2}),l})();function vt(n,l){if(1&n&&t.nrm(0,"azt-loading-effect",3),2&n){const o=t.XpG();t.Y8G("currentStatusObj",o.statusObj)}}function It(n,l){if(1&n){const o=t.RV6();t.j41(0,"app-digitalized-view-book-page",18),t.bIt("changeBookPageStatusEvent",function(i){t.eBV(o);const a=t.XpG(5);return t.Njj(a.changeBookPageStatus(i))})("callAgainOcrBookPageEvent",function(i){t.eBV(o);const a=t.XpG(5);return t.Njj(a.reDigitalizedOneObj(i))}),t.k0s()}if(2&n){const o=t.XpG(2).$implicit;t.Y8G("obj",o)}}function Ot(n,l){if(1&n){const o=t.RV6();t.j41(0,"app-digitalized-edit-book-page",19),t.bIt("changeBookPageStatusEvent",function(i){t.eBV(o);const a=t.XpG(5);return t.Njj(a.changeBookPageStatus(i))})("callAgainOcrBookPageEvent",function(i){t.eBV(o);const a=t.XpG(5);return t.Njj(a.reDigitalizedOneObj(i))})("saveAllContentEvent",function(){t.eBV(o);const i=t.XpG(5);return t.Njj(i.saveAllContent())}),t.k0s()}if(2&n){const o=t.XpG(2).$implicit,e=t.XpG(3);t.Y8G("bookObj",e.bookObj)("obj",o)}}function Dt(n,l){if(1&n&&t.nrm(0,"app-digitalized-processing-book-page",20),2&n){const o=t.XpG(2).$implicit;t.Y8G("obj",o)}}function Bt(n,l){if(1&n&&(t.j41(0,"div"),t.DNE(1,It,1,1,"app-digitalized-view-book-page",15)(2,Ot,1,2,"app-digitalized-edit-book-page",16)(3,Dt,1,1,"app-digitalized-processing-book-page",17),t.k0s()),2&n){const o=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf","none"==o.currentStatus),t.R7$(),t.Y8G("ngIf","show_edit_form"==o.currentStatus),t.R7$(),t.Y8G("ngIf","calling_ocr_api"==o.currentStatus)}}function jt(n,l){if(1&n&&(t.qex(0),t.DNE(1,Bt,4,3,"div",14),t.bVm()),2&n){const o=l.$implicit;t.R7$(),t.Y8G("ngIf",o.isShow)}}function At(n,l){if(1&n){const o=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"button",7),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.digitalizedAll())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"button",7),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.runDigitalizedCurrentPage())}),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.exportData("html"))}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",8),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.exportData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s(),t.j41(14,"button",8),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.exportData("txt"))}),t.EFF(15),t.nI1(16,"mytranslate"),t.k0s()(),t.j41(17,"div",9),t.DNE(18,jt,2,1,"ng-container",10),t.k0s(),t.j41(19,"div",11)(20,"div",12)(21,"azt-paging",13),t.bIt("goToPaginationPage",function(i){t.eBV(o);const a=t.XpG(2);return t.Njj(a.goToPage(i))}),t.k0s()()()()}if(2&n){const o=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,10,"lang_cms_admin_digitalized_digitalized_all")," (",o.bookObj.totalDone," / ",o.bookObj.totalPage,")"),t.R7$(3),t.Lme("",t.bMT(7,12,"lang_cms_admin_digitalized_digitalized_current_page")," (",o.totalCurrentItems,")"),t.R7$(3),t.JRh(t.bMT(10,14,"lang_cms_admin_digitalized_digitalized_export_html")),t.R7$(3),t.JRh(t.bMT(13,16,"lang_cms_admin_digitalized_digitalized_export_docx")),t.R7$(3),t.JRh(t.bMT(16,18,"lang_cms_admin_digitalized_digitalized_export_txt")),t.R7$(3),t.Y8G("ngForOf",o.objs),t.R7$(3),t.Y8G("pageObj",o.pageObj)}}function St(n,l){if(1&n&&t.DNE(0,At,22,20,"div",4),2&n){const o=t.XpG();t.Y8G("ngIf",o.bookObj)}}let Tt=(()=>{var n;class l extends _.H{digitalizedAll(){this.digitalizedObjs(this.objs.filter(e=>"none"==e.currentStatus&&1!=e.isOrc))}runDigitalizedCurrentPage(){this.digitalizedObjs(this.objs.filter(e=>e.isShow&&"none"==e.currentStatus&&1!=e.isOrc))}reDigitalizedOneObj(e){this.digitalizedObjs([e])}digitalizedObjs(e){this.showSuccessSnack(this.commonService.myTranslateInstant("lang_cms_admin_digitalized_for_total_object")+": "+e.length);let i=e.map(g=>g.id);this.objs.forEach(g=>!!i.includes(g.id)&&Object.assign(g,{...g,currentStatus:"calling_ocr_api"}));let a=[];e.forEach(g=>a.push(this.runDigitalizeOneImage(g))),this.waitDestroy(this.sAztConcurrencyApiService.processObservables(1,a,!1).subscribe(g=>{}))}runDigitalizeOneImage(e){return this.sAztDigitalizeService.digitalizeOneImage(e.imageLink,i=>{console.log(`Digitalized for: Id: ${e.id} | Link: ${e.imageLink}`),this.objs.forEach(a=>a.id==e.id&&Object.assign(a,{...a,logMessage:i}))},i=>{console.log(`Digitalized error: Id: ${e.id} | Link: ${e.imageLink} | message: ${i}`),this.objs.forEach(a=>a.id==e.id&&Object.assign(a,{...a,logMessage:i,currentStatus:"none"}))},i=>{this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookId,e.id,i.htmlResult,i.originOcrData,(a,g)=>{if(!a)return console.log(`Digitalized error: Id: ${e.id} | Link: ${e.imageLink} | message: ${g}`),void this.objs.forEach(d=>d.id==e.id&&Object.assign(d,{...d,logMessage:g,currentStatus:"none"}));this.objs.forEach(d=>d.id==e.id&&Object.assign(d,{...d,logMessage:"",currentStatus:"show_edit_form",ocrContent:i.htmlResult,originOcrContent:i.originOcrData,isOrc:1})),this.bookObj.totalDone=this.objs.filter(d=>d.isOrc).length,console.log(`Digitalized success: Id: ${e.id} | Link: ${e.imageLink}`)})})}saveAllContent(){this.initStatusObj();let e=this.objs.filter(a=>1==a.isOrc).map(a=>({bookPageId:a.id,ocrContent:a.htmlContentFormControl.value}));this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrObjsPost({bookId:this.bookId,objs:e}).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);this.objs.forEach(g=>{let d=e.find(p=>p.bookPageId==g.id);d&&(g.ocrContent=d.ocrContent)}),this.successStatusObj("lang_cms_update_success",!0)}))}changeBookPageStatus(e){this.objs.forEach(i=>i.id==e.id&&Object.assign(i,{...e}))}exportData(e){let i=new Date;if("txt"==e){let p="";this.objs.forEach(pe=>p+=pe.originOcrContent+"\n");let S=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.txt`;const B=new Blob([p],{type:"text/plain"});return void(B&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(B),S))}let a="";if(this.objs.forEach(p=>a+=`<page [page]='${p.currentPage}'/>`+(p.ocrContent??"")),a=this.commonService.decodeHtmlEntities(a),"html"==e){a=this.commonService.convertMathTagToLatex(a),a+=(0,P.A3)("PHNjcmlwdD4KCWZ1bmN0aW9uIGdldFNlbGVjdGlvbkh0bWwoKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCA8PSAwKSByZXR1cm4gJyc7CgoJCXZhciByYW5nZSA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApOwoJCXZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQocmFuZ2UuY2xvbmVDb250ZW50cygpKTsKCQlyZXR1cm4gY29udGFpbmVyLmlubmVySFRNTDsKCX0KCWZ1bmN0aW9uIHNob3dTbmFjayhpc1N1Y2Nlc3MsIG1lc3NhZ2UpIHsKCQkvLyBTdGVwIDE6IENyZWF0ZSB0aGUgc25hY2sgZWxlbWVudAoJCXZhciBzbmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXNuYWNrLnRleHRDb250ZW50ID0gbWVzc2FnZTsKCgkJLy8gU3RlcCAyOiBTdHlsZSB0aGUgc25hY2sgZm9yIHRvcCBsZWZ0IGNlbnRlciBwb3NpdGlvbmluZwoJCXNuYWNrLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQlzbmFjay5zdHlsZS50b3AgPSAnMjBweCc7CgkJc25hY2suc3R5bGUubGVmdCA9ICc1MCUnOwoJCXNuYWNrLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKC01MCUpJzsgLy8gQ2VudGVyIGhvcml6b250YWxseQoJCXNuYWNrLnN0eWxlLndpZHRoID0gJzQwMHB4JzsKCQlzbmFjay5zdHlsZS5wYWRkaW5nID0gJzEwcHggMjBweCc7CgkJc25hY2suc3R5bGUuYmFja2dyb3VuZENvbG9yID0gaXNTdWNjZXNzID8gJyM0Q0FGNTAnIDogJ3JlZCc7IC8vIEdyZWVuIGJhY2tncm91bmQgZm9yIHN1Y2Nlc3MKCQlzbmFjay5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CgkJc25hY2suc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CgkJc25hY2suc3R5bGUuYm94U2hhZG93ID0gJzBweCAwcHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSknOwoJCXNuYWNrLnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gRW5zdXJlIGl0J3Mgb24gdG9wIG9mIG90aGVyIGVsZW1lbnRzCgkJc25hY2suc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7IC8vIENlbnRlciB0ZXh0IGhvcml6b250YWxseQoKCQkvLyBTdGVwIDM6IEFwcGVuZCB0aGUgc25hY2sgdG8gdGhlIGJvZHkKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNuYWNrKTsKCgkJLy8gU3RlcCA0OiBSZW1vdmUgdGhlIHNuYWNrIGFmdGVyIDYgc2Vjb25kcwoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCXNuYWNrLnJlbW92ZSgpOwoJCX0sIDEwMDApOyAvLyAxMDAwIG1pbGxpc2Vjb25kcyA9IDEgc2Vjb25kcwoJfQoJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5yYW5nZUNvdW50IDw9IDApIHJldHVybjsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oKSB7CgkJCXZhciBodG1sU291cmNlID0gZ2V0U2VsZWN0aW9uSHRtbCgpOwoJCQlpZiAoIWh0bWxTb3VyY2UpIHJldHVybjsKCgkJCW5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGh0bWxTb3VyY2UpLnRoZW4oZnVuY3Rpb24oKSB7CgkJCQlzaG93U25hY2sodHJ1ZSwgJ0NvcHkgdGjDoG5oIGPDtG5nIScpOwoJCQl9KS5jYXRjaChmdW5jdGlvbihlcnIpIHsKCQkJCXNob3dTbmFjayhmYWxzZSwgJ0NvcHkgbOG7l2k6ICcgKyBlcnIpOwoJCQl9KTsKCQl9LCB7CgkJCW9uY2U6IHRydWUKCQl9KTsKCX0pOwo8L3NjcmlwdD4=");let S=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.html`;const B=new Blob([a],{type:"text/plain"});return void(B&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(B),S))}let g=this.userService.getUserObj(),d=z.c.azt_ai_base_api;this.commonService.loadAzotaDocxJs().then(()=>{(0,A.w)().textToDocxBinary(a,"Bearer "+g.rememberToken,d,null).then(p=>{let S=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.docx`;const B=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});B&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(B),S)}).catch(p=>{this.showErrorSnack(p)})}).catch(p=>{this.showErrorSnack(p)})}goToPage(e){this.myNavigation(`/azota-digitalized/digitalized-one-book/${this.bookId}/${e}`),this.pageObj.setTotalPages(this.objs.length),this.pageObj.setPageNumber(e);let i=this.pageObj.getViewObjsOfCurrentPage(this.objs).map(a=>a.id);this.objs.forEach(a=>a.isShow=!!i.includes(a.id)),this.totalCurrentItems=this.objs.filter(a=>a.isShow).length}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageGetObjsGet(this.bookId).subscribe(e=>{if(!e.success||!e.data)return this.errorStatusObj(e.message,!0);this.bookObj=e.data.bookObj,this.objs=e.data.bookPageObjs.map((i,a)=>({...i,isShow:!1,currentPage:a+1,ocrContent:i.ocrContent?this.sAztZipDataService.decodeContentGzip(i.ocrContent):void 0,originOcrContent:i.originOcrContent?this.sAztZipDataService.decodeContentGzip(i.originOcrContent):void 0,logMessage:i.isOrc?void 0:"lang_cms_admin_digitalized_not_call_ocr_status",currentStatus:i.isOrc?"show_edit_form":"none",base64Images:[],htmlContentFormControl:new c.MJ("",{nonNullable:!0})}))??[],this.goToPage(Number(this.commonService.getMyParam(this.activeRoute,"page")??0)),this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_digitalized_one_book_title",description:"lang_cms_admin_digitalized_one_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.initData()}constructor(e,i,a,g,d,p){super(),this.digitalizedBookPageService=e,this.activeRoute=i,this.sAztZipDataService=a,this.sAztDigitalizeService=g,this.sAztConcurrencyApiService=d,this.userService=p,this.objs=[],this.bookId=0,this.backTo="/azota-digitalized/list-books",this.pageObj=new m.d(10),this.totalCurrentItems=0}}return(n=l).\u0275fac=function(e){return new(e||n)(t.rXU(b.gI),t.rXU(k.nX),t.rXU(v.j),t.rXU(f.Y),t.rXU(D.Z),t.rXU(G.R))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-digitalized-one-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],["class","mt-5",4,"ngIf"],[1,"mt-5"],[1,"flex","items-center","mb-3","pb-3",2,"border-bottom","1px solid #ccc"],[1,"btn","btn-primary","mr-3",3,"click"],[1,"btn","btn-success","mr-3",3,"click"],[1,"box"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","flex-wrap","sm:flex-row","sm:flex-nowrap","items-center","mt-3"],[1,"w-full","sm:w-auto","sm:mr-auto"],[3,"goToPaginationPage","pageObj"],[4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent",4,"ngIf"],[3,"obj",4,"ngIf"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","obj"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent","bookObj","obj"],[3,"obj"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",1),t.DNE(1,vt,1,1,"azt-loading-effect",2)(2,St,1,1,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",i.statusObj.loading)("ngIfElse",a)}},dependencies:[u.Sq,u.bT,M.K,et.q,V.Q,st,rt,Ct,O.wp],encapsulation:2}),l})();var yt=s(52909);class Et{static validBookPage(l){const o=l;return o.controls.filter(i=>i.controls.isShow.value).length>0?(l.setErrors(null),null):(o.setErrors({validBookPage:!0}),{identityRevealed:!0})}}var Rt=s(15766),H=s(39712);let Q=(()=>{var n;class l extends _.H{removeBackgroundNoise(e){this.initStatusObj();let a=this.form.controls.bookPageFormArray.getRawValue().filter(g=>(!!e||g.isSelected)&&g.isShow).map(g=>this.sAztDigitalizeService.runRemoveBackgroundNoise({uuid:g.randomUuid,oldImageUrl:g.imageLink,newImageUrl:""},this.defaultThreshold,d=>console.log("Remove noise error",d)));this.waitDestroy(this.sAztConcurrencyApiService.processObservables(20,a,!1).subscribe(g=>{let d=this.form.controls.bookPageFormArray.getRawValue();d.forEach(p=>{let S=g.find(B=>B?.uuid==B?.uuid)?.newImageUrl;S&&(p.imageLink=S,p.needUpdate=!0)}),this.form.controls.bookPageFormArray.patchValue(d),this.stopStatusObj()}))}selectAll(e){this.form.controls.bookPageFormArray.controls.map(i=>i.controls.isSelected.setValue(e))}deleteAllSelected(){this.form.controls.bookPageFormArray.controls.forEach(e=>{e.controls.isSelected.value&&e.controls.isShow.setValue(!1)})}countSelected(){this.totalPage=this.form.controls.bookPageFormArray.getRawValue().filter(e=>e.isShow).length,this.totalSelectedPage=this.form.controls.bookPageFormArray.getRawValue().filter(e=>e.isShow&&e.isSelected).length}cancel(){this.commonService.myNavigation(this.backTo)}handleUploadComplete(e){e.forEach(i=>{i.url&&this.form.controls.bookPageFormArray.push(new c.gE({id:new c.MJ(0,{nonNullable:!0}),randomUuid:new c.MJ(this.sAztUuidService.getUuid(),{nonNullable:!0}),name:new c.MJ(i.name??"",{nonNullable:!0}),imageLink:new c.MJ(i.url,{nonNullable:!0}),isShow:new c.MJ(!0,{nonNullable:!0}),isSelected:new c.MJ(!1,{nonNullable:!0}),needUpdate:new c.MJ(!1,{nonNullable:!0})}))}),this.form.controls.bookPageFormArray.updateValueAndValidity()}removeBookPageObj(e){let i=this.form.controls.bookPageFormArray.controls.find(a=>a.controls.randomUuid.value==e);i?.controls.isShow.setValue(!1),this.form.controls.bookPageFormArray.updateValueAndValidity()}constructor(){super(),this.sAztUuidService=(0,t.WQX)(yt.D),this.sAztDigitalizeService=(0,t.WQX)(f.Y),this.sAztConcurrencyApiService=(0,t.WQX)(D.Z),this.backTo="",this.allUploadToCdnMenuTypes=H.b8,this.allUploadFileTypes=H.PO,this.totalSelectedPage=0,this.totalPage=0,this.defaultThreshold=230,this.form=new c.gE({name:new c.MJ("",{nonNullable:!0,validators:[Rt.M.noWhiteSpace]}),bookPageFormArray:new c.Yp([],{validators:[Et.validBookPage]})}),this.form.valueChanges.subscribe(e=>this.countSelected())}}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-base-create-or-update-book"]],features:[t.Vt3],decls:0,vars:0,template:function(e,i){},encapsulation:2}),l})();var xt=s(32884),Pt=s(27879),q=s(63349);const Gt=n=>({"error-border":n}),Ft=(n,l)=>[n,l];function wt(n,l){if(1&n&&t.nrm(0,"azt-loading-effect",4),2&n){const o=t.XpG();t.Y8G("currentStatusObj",o.statusObj)}}function Ut(n,l){if(1&n){const o=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(i){t.eBV(o);const a=t.XpG(2);return t.Njj(a.handleUploadComplete(i))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&n){const o=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",o.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,Ft,o.allUploadFileTypes.IMAGE,o.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Mt(n,l){if(1&n){const o=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&n){const o=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",o.totalSelectedPage,"/",o.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",o.totalSelectedPage,"/",o.totalPage,")")}}function Vt(n,l){1&n&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function $t(n,l){if(1&n&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&n){const o=l.$implicit,e=l.index;t.R7$(),t.Y8G("hidden",!o.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",o.controls.imageLink.value),t.R7$(),t.Y8G("src",o.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(e+1),t.R7$(),t.Y8G("formControl",o.controls.isSelected)}}function Nt(n,l){if(1&n&&(t.j41(0,"div",31),t.DNE(1,$t,8,5,"ng-container",32),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngForOf",o.form.controls.bookPageFormArray.controls)}}function Yt(n,l){if(1&n){const o=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,Ut,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.selectAll(i.totalSelectedPage!=i.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,Mt,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,Vt,3,3,"div",25)(34,Nt,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&n){const o=t.sdS(35),e=t.XpG();t.R7$(),t.Y8G("formGroup",e.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,e.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",e.form.controls.name)("ngClass",t.eq3(35,Gt,e.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!e.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,e.totalSelectedPage!=e.totalPage?"lang_select_all":"lang_remove_all")," (",e.totalSelectedPage,"/",e.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",e.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",e.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",o),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let Lt=(()=>{var n;class l extends Q{initForm(){}initData(){}saveObj(){this.initStatusObj();let e=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookAddObjPost({name:e.name}).subscribe(a=>{if(!a.success||!a.data?.obj)return this.errorStatusObj(a.message,!0);let g={bookId:a.data.obj.id,bookPageObjs:[]};e.bookPageFormArray.filter(d=>d.isShow).forEach(d=>{g.bookPageObjs.push({name:d.name,imageLink:d.imageLink})}),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageAddObjsPost(g).subscribe(d=>{if(!d.success)return this.errorStatusObj(d.message,!0);this.successStatusObj("lang_cms_add_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_create_book_title",description:"lang_cms_admin_create_book_title",image:"lang_cms_test_image"}),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(e,i){super(),this.digitalizedBookService=e,this.digitalizedBookPageService=i,this.bookId=0}}return(n=l).\u0275fac=function(e){return new(e||n)(t.rXU(xt.Z),t.rXU(Pt.g))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-create-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2),t.DNE(1,wt,1,1,"azt-loading-effect",3)(2,Yt,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",1==i.statusObj.loading)("ngIfElse",a)}},dependencies:[u.YU,u.Sq,u.bT,c.qT,c.me,c.Zm,c.BC,c.cb,c.l_,c.j4,M.K,q.V,$,V.Q,j.WGl,O.wp],encapsulation:2}),l})();const Xt=n=>({"error-border":n}),Wt=(n,l)=>[n,l];function Jt(n,l){if(1&n&&t.nrm(0,"azt-loading-effect",4),2&n){const o=t.XpG();t.Y8G("currentStatusObj",o.statusObj)}}function Zt(n,l){if(1&n){const o=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(i){t.eBV(o);const a=t.XpG(2);return t.Njj(a.handleUploadComplete(i))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&n){const o=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",o.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,Wt,o.allUploadFileTypes.IMAGE,o.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Kt(n,l){if(1&n){const o=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&n){const o=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",o.totalSelectedPage,"/",o.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",o.totalSelectedPage,"/",o.totalPage,")")}}function Ht(n,l){1&n&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function Qt(n,l){if(1&n&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&n){const o=l.$implicit,e=l.index;t.R7$(),t.Y8G("hidden",!o.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",o.controls.imageLink.value),t.R7$(),t.Y8G("src",o.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(e+1),t.R7$(),t.Y8G("formControl",o.controls.isSelected)}}function qt(n,l){if(1&n&&(t.j41(0,"div",31),t.DNE(1,Qt,8,5,"ng-container",32),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngForOf",o.form.controls.bookPageFormArray.controls)}}function te(n,l){if(1&n){const o=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,Zt,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.selectAll(i.totalSelectedPage!=i.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,Kt,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,Ht,3,3,"div",25)(34,qt,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&n){const o=t.sdS(35),e=t.XpG();t.R7$(),t.Y8G("formGroup",e.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,e.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",e.form.controls.name)("ngClass",t.eq3(35,Xt,e.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!e.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,e.totalSelectedPage!=e.totalPage?"lang_select_all":"lang_remove_all")," (",e.totalSelectedPage,"/",e.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",e.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",e.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",o),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let ee=(()=>{var n;class l extends Q{initForm(e){this.form.controls.name.setValue(e.bookObj.name),e.bookPageObjs.forEach(i=>{this.form.controls.bookPageFormArray.push(new c.gE({id:new c.MJ(i.id,{nonNullable:!0}),randomUuid:new c.MJ(i.id.toString(),{nonNullable:!0}),name:new c.MJ(i.name,{nonNullable:!0}),imageLink:new c.MJ(i.imageLink,{nonNullable:!0}),isShow:new c.MJ(!0,{nonNullable:!0}),isSelected:new c.MJ(!1,{nonNullable:!0}),needUpdate:new c.MJ(!1,{nonNullable:!0})}))})}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjGet(this.bookId).subscribe(e=>{if(!e.success||!e.data)return this.errorStatusObj(e.message,!0);this.initForm(e.data),this.stopStatusObj()}))}saveObj(){this.initStatusObj();let e=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookUpdateObjPost({id:this.bookId,name:e.name}).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);let g={bookId:this.bookId,objs:e.bookPageFormArray.filter(p=>p.needUpdate&&p.id).map(p=>({bookPageId:p.id,imageLink:p.imageLink}))},d={bookId:this.bookId,ids:e.bookPageFormArray.filter(p=>!p.isShow&&p.id).map(p=>p.id)};if(g.objs.length<=0)return this.processDeleteImages(d);this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateImagesPost(g).subscribe(p=>{this.processDeleteImages(d)}))}))}processDeleteImages(e){e.ids.length>0?this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageDeleteObjPost(e).subscribe(i=>{if(!i.success)return this.errorStatusObj(i.message,!0);this.successStatusObj("lang_cms_update_success",!0),this.cancel()})):(this.successStatusObj("lang_cms_update_success",!0),this.cancel())}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_edit_book_title",description:"lang_cms_admin_edit_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(e,i,a){super(),this.digitalizedBookService=e,this.digitalizedBookPageService=i,this.activeRoute=a,this.bookId=0}}return(n=l).\u0275fac=function(e){return new(e||n)(t.rXU(b.ZD),t.rXU(b.gI),t.rXU(k.nX))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-update-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2),t.DNE(1,Jt,1,1,"azt-loading-effect",3)(2,te,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",1==i.statusObj.loading)("ngIfElse",a)}},dependencies:[u.YU,u.Sq,u.bT,c.qT,c.me,c.Zm,c.BC,c.cb,c.l_,c.j4,M.K,q.V,$,V.Q,j.WGl,O.wp],encapsulation:2}),l})();var ie=s(75421),tt=s(25329);const ne=n=>[n],J=()=>({"mr-1":!0});function oe(n,l){if(1&n&&t.nrm(0,"azt-loading-effect",5),2&n){const o=t.XpG();t.Y8G("currentStatusObj",o.statusObj)}}function ae(n,l){1&n&&(t.j41(0,"span",25),t.nrm(1,"azt-loading-ui"),t.k0s())}function le(n,l){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"mat-card",13)(2,"mat-card-content",14)(3,"div",15)(4,"div",7)(5,"b"),t.EFF(6),t.k0s(),t.EFF(7),t.k0s(),t.j41(8,"div",16)(9,"button",17),t.nI1(10,"navigationLocalize"),t.nrm(11,"lucide-icon",18),t.j41(12,"span",19),t.EFF(13),t.nI1(14,"mytranslate"),t.k0s()(),t.j41(15,"a",20),t.nI1(16,"navigationLocalize"),t.nrm(17,"lucide-icon",21),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s(),t.j41(20,"button",22),t.bIt("click",function(){const i=t.eBV(o).$implicit,a=t.XpG(3);return t.Njj(a.deleteObj(i))}),t.DNE(21,ae,2,0,"span",23),t.nrm(22,"lucide-icon",24),t.j41(23,"span",19),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()()()(),t.bVm()}if(2&n){const o=l.$implicit,e=l.index,i=t.XpG(3);t.R7$(6),t.SpI("",e+1,"."),t.R7$(),t.E5c(" ",o.name," (",o.totalDone," / ",o.totalPage,") "),t.R7$(2),t.Y8G("routerLink",t.bMT(10,13,"/azota-digitalized/digitalized-one-book/"+o.id+"/1")),t.R7$(2),t.Y8G("ngClass",t.lJ4(23,J)),t.R7$(2),t.JRh(t.bMT(14,15,"lang_cms_admin_digitalized_digitalized_btn")),t.R7$(2),t.Y8G("routerLink",t.bMT(16,17,"/azota-digitalized/edit-book/"+o.id)),t.R7$(2),t.Y8G("ngClass",t.lJ4(24,J)),t.R7$(),t.SpI(" ",t.bMT(19,19,"lang_auto_sua")," "),t.R7$(3),t.Y8G("ngIf",i.deletingId==o.id),t.R7$(),t.Y8G("ngClass",t.lJ4(25,J)),t.R7$(2),t.JRh(t.bMT(25,21,"lang_auto_xoa"))}}function se(n,l){if(1&n&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.DNE(3,le,26,26,"ng-container",12),t.k0s()(),t.bVm()),2&n){const o=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",o.objs)}}function re(n,l){1&n&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"lang_cms_admin_digitalized_there_is_no_book")))}function ce(n,l){if(1&n&&(t.j41(0,"div",6)(1,"span",7),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"a",8),t.nI1(5,"navigationLocalize"),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.DNE(8,se,4,1,"ng-container",9)(9,re,3,3,"ng-template",null,1,t.C5r)),2&n){const o=t.sdS(10),e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"lang_cms_admin_common_digitalize_list_book")),t.R7$(2),t.Y8G("routerLink",t.eq3(11,ne,t.bMT(5,7,"/azota-digitalized/create-book"))),t.R7$(2),t.JRh(t.bMT(7,9,"lang_common_create")),t.R7$(2),t.Y8G("ngIf",e.objs.length>0)("ngIfElse",o)}}const de=[{path:"",component:h.z,children:[{path:"list-books",component:(()=>{var n;class l extends _.H{deleteObj(e){const i=this.commonService.myTranslateInstant("lang_cms_admin_digitalized_are_your_sure_to_delete_this_book")+`: <b>${e.name}<b/>?`;this.sAztDialogService.open(ie.u,{data:{content:i},restoreFocus:!1,width:"500px"}).afterClosed().subscribe(a=>{a&&(this.deletingId=e.id,this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookDeleteObjPost({ids:[e.id]}).subscribe(g=>{if(this.deletingId=void 0,!g.success)return this.errorStatusObj(g.message,!0);this.objs=this.objs.filter(d=>d.id!=e.id)})))})}getData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjsGet().subscribe(e=>{if(!e.success)return this.errorStatusObj(e.message,!0);this.objs=e.data?.objs??[],this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.getData(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_list_book",description:"lang_cms_admin_common_digitalize_list_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(e,i){super(),this.digitalizedBookService=e,this.sAztDialogService=i,this.headerBackTo="",this.objs=[]}}return(n=l).\u0275fac=function(e){return new(e||n)(t.rXU(b.ZD),t.rXU(Y.i))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-digitalized-list-books"]],features:[t.Vt3],decls:5,vars:3,consts:[["doneLoading",""],["emptyList",""],[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"flex","items-center","mb-3"],[1,"w-full"],[1,"flex-none","btn","btn-primary",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],["appearance","outlined",1,"mb-2",2,"background-color","#fff","border","none"],[1,"form-control",2,"overflow-y","auto"],[1,"flex","align-items-center"],[1,"flex-none","items-center"],[1,"btn","btn-sm","btn-success-soft","mr-2",3,"routerLink"],["name","eye","size","18",3,"ngClass"],[1,"azt-hidden","md:inline-block"],[1,"btn","btn-sm","btn-primary-soft","mr-2",3,"routerLink"],["name","square-pen","size","18",3,"ngClass"],[1,"btn","btn-sm","btn-danger-soft",3,"click"],["class","w-4 h-4 flex mr-1",4,"ngIf"],["name","trash-2","size","18",3,"ngClass"],[1,"w-4","h-4","flex","mr-1"],[1,"text-center"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2)(1,"div",3),t.DNE(2,oe,1,1,"azt-loading-effect",4)(3,ce,11,13,"ng-template",null,0,t.C5r),t.k0s()()),2&e){const a=t.sdS(4);t.Y8G("headerBackToLink",i.headerBackTo),t.R7$(2),t.Y8G("ngIf",i.statusObj.loading)("ngIfElse",a)}},dependencies:[k.Wk,u.YU,u.Sq,u.bT,tt.RN,tt.m2,M.K,L.R,V.Q,j.WGl,O.F2,O.wp],encapsulation:2}),l})()},{path:"create-book",component:Lt},{path:"edit-book/:bookId",component:ee},{path:"digitalized-one-book/:bookId/:page",component:Tt}]}];let me=(()=>{var n;class l{}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[k.iI.forChild(de),k.iI,C.XE]}),l})(),_e=(()=>{var n;class l{}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({providers:[{provide:r.vn,useValue:z.c.azt_tiny_mce_script_src}],imports:[k.iI,u.MD,c.YN,r.sv,w.s,c.X1,me,y.Q,U.L,F.Id,I.b,j.flO.pick(j.Ptg),E.AC,T.DL,x.An]}),l})()}}]);