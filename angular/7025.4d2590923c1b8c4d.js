"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7025],{6408:(W,j,n)=>{n.d(j,{h:()=>M});var e=n(10936),t=n(99974),i=n(48891),P=n(96699);let M=(()=>{var x;class d{constructor(m){this.testMarketQuestionService=m,this.schoolLevelSubjectObjs=[],this.formSchoolInfo=new e.gE({schoolLevel:new e.MJ(0,{nonNullable:!0}),schoolSubject:new e.MJ(0,{nonNullable:!0})})}initialData(){return new Promise(m=>{this.testMarketQuestionService.apiTestMarketQuestionsSubjectLevelsGet().subscribe(f=>{1==f.success?(this.schoolLevelSubjectObjs=f.data?.schoolLevelSubjectObjs??[],this.formSchoolInfo.controls.schoolLevel.setValue(12),this.formSchoolInfo.controls.schoolSubject.setValue(40),this.apiLeechData(void 0).then(v=>{m(v.map(c=>new t.Q(c.id,c.pr,c.type,void 0,c.name,c.examHashId,c.examCategoryId,0,!c.isLeaf,!1,void 0,c.isLeaf)))}).catch(()=>{m([])})):m([])})})}apiLeechData(m){return new Promise(f=>{const v=[];this.testMarketQuestionService.apiTestMarketQuestionsKnowledgeGet(Number(this.formSchoolInfo.controls.schoolLevel.value),Number(this.formSchoolInfo.controls.schoolSubject.value),m).subscribe(c=>{1===c.success&&c.data&&(c.data.objs||[]).forEach(p=>{v.push({pr:m??0,id:p.id??0,name:p.name?p.name:"",examHashId:"",examCategoryId:"",type:"knowledge",isLeaf:p.isLeaf??!1})}),f(v)})})}}return(x=d).\u0275fac=function(m){return new(m||x)(i.KVO(P.e2))},x.\u0275prov=i.jDH({token:x,factory:x.\u0275fac,providedIn:"root"}),d})()},51783:(W,j,n)=>{n.d(j,{G:()=>d,e:()=>x});var e=n(17509),t=n(71217),i=n(47947),P=n(99974),M=n(48891),F=n(9280);let x=(()=>{var _;class m{constructor(v){this.documentService=v,this.leechApiCacheMaps=new Map,this.lastNodeSelected=[],this.lastNodesSelected=[]}initialData(v=0,c=void 0){return new Promise(k=>{this.apiLeechData(v,c).then(p=>{k(p.map(g=>new P.Q(g.id,g.pr,g.type,g.shareType,g.name,g.examHashId,g.examCategoryId,0,"cate"===g.type,g.isLeaf)))})})}apiLeechData(v,c,k=!1){return new Promise(p=>{let g=this.getCacheKey(v,c);if(k&&this.leechApiCacheMaps.has(g)&&this.leechApiCacheMaps.get(g))return void p(this.leechApiCacheMaps.get(g)??[]);const I=[];let S={categoryId:v,documentType:void 0,shareType:c,fileType:"exam_online",classroomId:void 0,name:void 0,suggestExamPurpose:void 0,lite:1,getGlobal:0,page:1,itemPerPage:-1};this.documentService.apiDocumentsGet(S.categoryId,S.documentType,S.shareType,S.fileType,S.classroomId,S.name,S.suggestExamPurpose,S.lite,S.getGlobal,S.page,S.itemPerPage).subscribe(A=>{1===A.success&&A.data&&((A.data.categoryObjs||[]).forEach(D=>{I.push({pr:v,id:D.id??0,name:D.name??"",examHashId:"",examCategoryId:"",type:"cate",shareType:D.shareType,isLeaf:!1})}),(A.data.documentObjs||[]).forEach(D=>{D.exam&&I.push({pr:v,id:D.exam.id??0,name:D.exam.name??"",examHashId:D.exam.hashId??"",examCategoryId:D.exam.categoryId?.toString()??"",type:"test",shareType:void 0,isLeaf:!0})}),this.leechApiCacheMaps.set(g,I)),p(I)})})}getCacheKey(v,c){return v+"_"+(c??"")}}return(_=m).\u0275fac=function(v){return new(v||_)(M.KVO(F.DK))},_.\u0275prov=M.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),m})();class d{get data(){return this.dataChange.value}set data(m){this._treeControl.dataNodes=m,this.dataChange.next(m)}findLastTreeNodeSelected(m,f=[]){let c=this.data.find(k=>k.id==m.id&&k.shareType==m.shareType);return c?(f.push({id:c.id,shareType:c.shareType}),c.prNode?this.findLastTreeNodeSelected(c.prNode,f):f.reverse()):f.reverse()}toggleLastNode(m,f=0,v,c){let k=m[f]?m[f]:void 0;if(!k)return c(v);let p=this.data.find(g=>g.id==k?.id&&g.shareType==k?.shareType);if(!p)return c(void 0);this.toggleNode(p,!0,!0,()=>{this.toggleLastNode(m,f+1,p,c)})}connect(m){return this._treeControl.expansionModel.changed.subscribe(f=>{(f.added||f.removed)&&this.handleTreeControl(f)}),(0,e.h)(m.viewChange,this.dataChange).pipe((0,i.T)(()=>this.data))}disconnect(m){}handleTreeControl(m){m.added&&m.added.forEach(f=>this.toggleNode(f,!0,!1,()=>{})),m.removed&&m.removed.slice().reverse().forEach(f=>this.toggleNode(f,!1,!1,()=>{}))}toggleNode(m,f,v=!1,c){if("cate"!=m.type)return c();const k=this.data.indexOf(m);if(f)m.isLoading=!0,this._database.apiLeechData(m.id,m.shareType,v).then(p=>{const g=p.map(I=>new P.Q(I.id,I.pr,I.type,I.shareType,I.name,I.examHashId,I.examCategoryId,m.level+1,"cate"===I.type,!1,m));this.data.splice(k+1,0,...g),this.dataChange.next(this.data),m.isLoading=!1,c()});else{let p=0;for(let g=k+1;g<this.data.length&&this.data[g].level>m.level;g++,p++);this.data.splice(k+1,p),this.dataChange.next(this.data),c()}}constructor(m,f){this._treeControl=m,this._database=f,this.dataChange=new t.t([])}}},99974:(W,j,n)=>{n.d(j,{Q:()=>e});class e{constructor(i,P,M,F,x,d,_,m=1,f=!1,v=!1,c,k,p,g){this.id=i,this.pr=P,this.type=M,this.shareType=F,this.item=x,this.examHashId=d,this.examCategoryId=_,this.level=m,this.expandable=f,this.isLoading=v,this.prNode=c,this.isLeaf=k,this.childrenNode=p,this.questions=g}}},60531:(W,j,n)=>{n.d(j,{O:()=>P});var e=n(48891),t=n(50589),i=n(62095);let P=(()=>{var M;class F{setMode(d){this.browserStorageService.saveSimpleStorage("__editor:mode_open",d)}getMode(){var d=this.browserStorageService.getSimpleStorage("__editor:mode_open")||"editor";return this.browserStorageService.removeSimpleStorage("__editor:mode_open"),d}setFileProcess(d){this.file=d}getFirstFile(){let d=this.file;return this.file=void 0,d}setOutputData(d){this.data=d}getOutputData(){return this.data}redirectToConfig(d){this.data.homework&&d.showHomework(),(this.data.exam||this.data.examOffline)&&d.showExam()}setMatrixData(d,_){_?this.matrix=d:this.browserStorageService.saveSimpleStorage("__editor:matrix-data",JSON.stringify(d))}getMatrixData(){var d=this.browserStorageService.getSimpleStorage("__editor:matrix-data");return this.browserStorageService.removeSimpleStorage("__editor:matrix-data"),d?this.commonService.castJsonToObj(d):this.matrix}constructor(d,_){this.browserStorageService=d,this.commonService=_,this.data={}}}return(M=F).\u0275fac=function(d){return new(d||M)(e.KVO(t.z),e.KVO(i.R))},M.\u0275prov=e.jDH({token:M,factory:M.\u0275fac,providedIn:"root"}),F})()},85747:(W,j,n)=>{n.d(j,{J:()=>e});class e{get status(){return this.currentStatus}get msg(){return this.currentMessage}setStatus(i){this.currentStatus=!0,this.currentMessage=i}stopStatus(){this.currentStatus=!1,this.currentMessage=void 0}}},54220:(W,j,n)=>{n.d(j,{f:()=>Ie});var e=n(48891),t=n(10936),i=n(25234),P=n(85747),M=n(59640),F=n(15766),x=n(9280),d=n(65162),_=n(61937),m=n(27691),f=n(5382),v=n(64198),c=n(62095),k=n(41426);let p=(()=>{var l;class E{constructor(s,a){this.commonService=s,this.apiUploadService=a,this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new f.n(50,{function:(o,r)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(o,r)}}),this.taskUploadImage=new f.n(10,{function:(o,r)=>{this.callbackUploadImage&&this.callbackUploadImage(o,r)}})}convertQuestions(s,a,o){return new Promise(r=>{this.reset(),s.forEach(u=>{const b=this.commonService.willDeleteParseJson(u.answerConfig||"[]");u.questionContent?.includes("<img ")&&this.replaceImageCdnInContent(u,"questionContent"),u.questionText?.includes("<img ")&&this.replaceImageCdnInContent(u,"questionText"),u.answerMedia?.includes("<img ")&&this.replaceImageCdnInContent(u,"answerMedia"),u.mediaMeta?.includes("<img ")&&this.replaceImageCdnInContent(u,"mediaMeta"),b.forEach(O=>{O.content.includes("<img ")&&this.replaceImageCdnInContent(O,"content")}),this.actionRunAfterConvert.push(()=>{u.answerConfig=JSON.stringify(b)})}),this.imageMaps.forEach(u=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[u])}),this.taskConvertBase64ToCanvas.start().then(u=>{if(u.errs.length>0)o(u.errs,void 0);else{let O=0;const C=[],U=()=>{const w=document.createElement("canvas");w.width=this.sizeDefaultCanvas,w.height=this.sizeDefaultCanvas;const $=w.getContext("2d");$&&($.fillStyle="white",$.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),C.push({cdn:"",cX:0,cY:0,canvas:w,imgs:[]})};U(),u.datas.forEach((w,$)=>{var y=C[C.length-1];y.cX+w.canvas.width+4>this.sizeDefaultCanvas?(y.cX=4,y.cY+=O+4,O=0):y.cX+=4,y.cY+w.canvas.height>this.sizeDefaultCanvas&&(U(),y=C[C.length-1]);var z=y.canvas.getContext("2d");y.imgs.push({x:y.cX,y:y.cY,width:w.canvas.width,height:w.canvas.height,index:$}),z?.drawImage(w.canvas,0,0,w.canvas.width,w.canvas.height,y.cX,y.cY,w.canvas.width,w.canvas.height),y.cX+=w.canvas.width,O=O<w.canvas.height?w.canvas.height:O}),C[0].imgs.length>0&&C.forEach(w=>{this.taskUploadImage.addTask(this,this.startUploadFile,[w])}),this.taskUploadImage.start().then(w=>{if(w.errs.length>0)o(u.errs,void 0);else{let $=!0;w.datas.forEach(y=>{y.imgs.forEach(z=>{const L=u.datas[z.index];if(L){const B={link:y.cdn,data:{x:z.x,y:z.y,width:z.width,height:z.height}};L.objs.forEach(R=>{if(R[L.path])if(this.commonService.isJson(R[L.path])){const Q=this.commonService.willDeleteParseJson(R[L.path]);Object.prototype.hasOwnProperty.call(Q,"renderedStr")?(Q.renderedStr=Q.renderedStr.replace(L.base,`@[]${JSON.stringify(B)}@[]`),R[L.path]=JSON.stringify(Q)):R[L.path]=R[L.path].replace(L.base,`@[]${JSON.stringify(B)}@[]`)}else R[L.path]=R[L.path].replace(L.base,`@[]${JSON.stringify(B)}@[]`);else $=!1})}})}),$?(this.actionRunAfterConvert.forEach(y=>{y()}),s.forEach((y,z)=>{let L=this.commonService.willDeleteParseJson(y.mediaMeta||"{}"),B=a[z];const R={id:0,name:y.name,extension:"text",content:y.questionContent,groupContent:L.renderedStr,metaData:{isFixAns:Number(y.isFixAns),forcedFixAns:!1,groupType:y.groupType?Number(y.groupType):void 0}};B&&(R.vMetaEditor=B.meta),y.questionContent=JSON.stringify([R])}),r()):o(u.errs,void 0,!0)}})}})})}reset(){this.imageMaps=[],this.actionRunAfterConvert=[]}replaceImageCdnInContent(s,a){var o=s[a];if(this.commonService.isJson(s[a])){const b=this.commonService.willDeleteParseJson(s[a]);Object.prototype.hasOwnProperty.call(b,"renderedStr")&&(o=b.renderedStr)}let r=o.matchAll(this.pattern_image);for(;;){let b=r.next();if(b.done)break;let O=b.value[0];var u=this.imageMaps.findIndex(C=>C.base===O&&C.path===a);-1===u?this.imageMaps.push({base:O,cdn:"",data:null,objs:[s],path:a,canvas:document.createElement("canvas")}):this.imageMaps[u].objs.push(s)}}startConvertCanvas(s){return new Promise((a,o)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>{let b=1;if(r.width>this.sizeDefaultCanvas&&(b=this.sizeDefaultCanvas/r.width),r.height>this.sizeDefaultCanvas){let C=this.sizeDefaultCanvas/r.height;C<b&&(b=C)}s.canvas.width=r.width*b,s.canvas.height=r.height*b,s.canvas.getContext("2d")?.drawImage(r,0,0,r.width,r.height,0,0,s.canvas.width,s.canvas.height),a(s)},r.onerror=()=>{s.canvas.width=1,s.canvas.height=1;const b=s.canvas.getContext("2d");b&&(b.fillStyle="white",b.fillRect(0,0,1,1)),a(s)};let u=this.pattern_base64.exec(s.base);null!=u?r.src=u[0]:o(new Error("l\u1ed7i regex"))})}startUploadFile(s){return new Promise((a,o)=>{const r=this.dataURLtoFile(s.canvas.toDataURL("image/png",1));(0,v.w4)(r).then(u=>{this.apiUploadService.uploadToCdnProgressForExamQuestionContent(u).subscribe(b=>{b.type!=m.hv.UploadProgress&&(1==b.success&&b.data?a({...s,cdn:b.data.url||""}):o(new Error(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",b.message??"none"))))})})})}dataURLtoFile(s){let a=this.getFileName(s);for(var o=s.split(","),r=o[0].match(/:(.*?);/),u=atob(o[1]),b=u.length,O=new Uint8Array(b);b--;)O[b]=u.charCodeAt(b);return new File([O],a,{type:r&&r.length>0?r[1]:"png"})}getFileName(s){var a=s.split("").reverse().join(""),o=a.indexOf(";"),r=a.indexOf("/",o);return a.substring(o,r).split("").reverse().join("")}}return(l=E).\u0275fac=function(s){return new(s||l)(e.KVO(c.R),e.KVO(k.T))},l.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),E})();var g=n(60531),I=n(77260),S=n(50589),A=n(84828),T=n(54460),N=n(18718),D=n(81587),G=n(52811),V=n(6989),H=n(1349),Z=n(50282),K=n(30683),q=n(9691),ee=n(39471),te=n(15343),se=n(7919),J=n(76975);const ae=l=>({"font-medium":l});function oe(l,E){1&l&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_auto_vui_long_nhap_ho_va_ten")))}function ne(l,E){1&l&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_auto_vui_long_nhap_so_dien_thoai")))}function ie(l,E){1&l&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_student_utils_reques_phone_ten_number")))}function re(l,E){1&l&&(e.j41(0,"div",38)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_document_please_enter_the_author_workplace")))}function le(l,E){if(1&l&&(e.j41(0,"div",14)(1,"div",30)(2,"div",31),e.nrm(3,"input",32),e.nI1(4,"mytranslate"),e.DNE(5,oe,4,3,"div",33),e.k0s(),e.j41(6,"div",34),e.nrm(7,"input",35),e.nI1(8,"mytranslate"),e.DNE(9,ne,4,3,"div",33)(10,ie,4,3,"div",33),e.k0s(),e.j41(11,"div",36),e.nrm(12,"input",37),e.nI1(13,"mytranslate"),e.DNE(14,re,4,3,"div",33),e.k0s()()()),2&l){const h=e.XpG();e.R7$(3),e.FS9("placeholder",e.bMT(4,7,"lang_auto_nhap_ho_va_ten")),e.R7$(2),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&!h.form.controls.creatorFullName.value),e.R7$(2),e.FS9("placeholder",e.bMT(8,9,"lang_auto_nhap_so_dien_thoai")),e.R7$(2),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&!h.form.controls.creatorPhone.value),e.R7$(),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&h.form.controls.creatorPhone.value&&10!==h.form.controls.creatorPhone.value.length),e.R7$(2),e.FS9("placeholder",e.bMT(13,11,"lang_document_workplace")),e.R7$(2),e.Y8G("ngIf","0"==h.form.controls.creatorId.value&&!h.form.controls.creatorWorkingAddress.value)}}function ce(l,E){if(1&l){const h=e.RV6();e.j41(0,"mat-tree-node",43),e.nrm(1,"button",44),e.j41(2,"div",45)(3,"input",46),e.bIt("change",function(){const a=e.eBV(h).$implicit,o=e.XpG(2);return e.Njj(o.checklistSelection.toggle(a))}),e.k0s(),e.j41(4,"label",47)(5,"span"),e.EFF(6),e.k0s()()()()}if(2&l){const h=E.$implicit,s=e.XpG(2);e.R7$(3),e.FS9("id","knowledge-"+h.id),e.Y8G("checked",s.checklistSelection.isSelected(h)),e.R7$(),e.FS9("for","knowledge-"+h.id),e.R7$(2),e.JRh(h.item)}}function me(l,E){if(1&l){const h=e.RV6();e.j41(0,"mat-tree-node",48)(1,"button",49)(2,"span",50),e.nrm(3,"lucide-icon",51),e.k0s()(),e.j41(4,"div",45)(5,"input",52),e.bIt("change",function(){const a=e.eBV(h).$implicit,o=e.XpG(2);return e.Njj(o.todoItemSelectionToggle(a))}),e.k0s(),e.j41(6,"label",47)(7,"span"),e.EFF(8),e.k0s()()()()}if(2&l){const h=E.$implicit,s=e.XpG(2);e.R7$(),e.BMQ("aria-label","toggle "+h.filename),e.R7$(2),e.FS9("name",s.treeControl.isExpanded(h)?"chevron-down":"chevron-right"),e.R7$(2),e.FS9("id","knowledge-"+h.id),e.Y8G("checked",s.descendantsAllSelected(h))("indeterminate",s.descendantsPartiallySelected(h)),e.R7$(),e.FS9("for","knowledge-"+h.id),e.R7$(2),e.JRh(h.item)}}function he(l,E){if(1&l&&(e.j41(0,"div",14)(1,"div",3)(2,"div",31)(3,"span",17),e.EFF(4),e.nI1(5,"mytranslate"),e.k0s()(),e.j41(6,"div",39)(7,"mat-tree",40),e.DNE(8,ce,7,4,"mat-tree-node",41)(9,me,9,7,"mat-tree-node",42),e.k0s()()()()),2&l){const h=e.XpG();e.R7$(4),e.SpI(" ",e.bMT(5,4,"lang_document_the_knowledge_units_present_in_the_exam")," "),e.R7$(3),e.Y8G("dataSource",h.dataSource)("treeControl",h.treeControl),e.R7$(2),e.Y8G("matTreeNodeDefWhen",h.hasChild)}}function de(l,E){1&l&&(e.j41(0,"span",58),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&l&&(e.R7$(),e.SpI("(",e.bMT(2,1,"lang_document_current"),")"))}function ue(l,E){if(1&l&&(e.j41(0,"div",53)(1,"div",54),e.nrm(2,"input",55),e.j41(3,"label",56)(4,"span"),e.EFF(5),e.nI1(6,"mytranslate"),e.k0s(),e.DNE(7,de,3,3,"span",57),e.k0s()()()),2&l){const h=E.index,s=e.XpG();e.R7$(2),e.FS9("id","week-"+s.listWeek[h]),e.Y8G("formControlName",h),e.R7$(),e.FS9("for","week-"+s.listWeek[h]),e.Y8G("ngClass",e.eq3(8,ae,s.currentSchoolWeeks===s.listWeek[h])),e.R7$(2),e.JRh(e.bMT(6,6,"lang_document_week")+" "+s.listWeek[h]),e.R7$(2),e.Y8G("ngIf",s.currentSchoolWeeks===s.listWeek[h])}}function pe(l,E){1&l&&(e.j41(0,"div",59)(1,"span"),e.EFF(2),e.nI1(3,"mytranslate"),e.k0s()()),2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"lang_document_please_select_the_time_of_use")))}class fe{}class ge{}let _e=(()=>{var l;class E extends M.H{buildFileTree(s,a){const o=[];return s.forEach(r=>{const u=new fe;u.item=r.name,u.id=r.id,r.children&&(u.children=this.buildFileTree(r.children,a+1)),o.push(u)}),o}descendantsAllSelected(s){return this.treeControl.getDescendants(s).every(o=>this.checklistSelection.isSelected(o))}descendantsPartiallySelected(s){return this.treeControl.getDescendants(s).some(r=>this.checklistSelection.isSelected(r))&&!this.descendantsAllSelected(s)}todoItemSelectionToggle(s){this.checklistSelection.toggle(s);const a=this.treeControl.getDescendants(s);this.checklistSelection.isSelected(s)?this.checklistSelection.select(...a):this.checklistSelection.deselect(...a)}toggleAllCheckBox(){this.isCheckSemesterOne.setValue(this.isCheckAllWeeks.value),this.isCheckSemesterTwo.setValue(this.isCheckAllWeeks.value);const s=this.isCheckAllWeeks.value;this.formArrayListWeek.controls.map(a=>a.setValue(s))}toggleSemesterOneCheckBox(){const s=this.isCheckSemesterOne.value;this.formArrayListWeek.controls.map((a,o)=>(o<18&&a.setValue(s),a)),this.calculateIsCheckAll()}toggleSemesterTwoCheckBox(){const s=this.isCheckSemesterTwo.value;this.formArrayListWeek.controls.map((a,o)=>(o>=18&&a.setValue(s),a)),this.calculateIsCheckAll()}initForm(){this.formArrayListWeek=this.form.controls.weeks,this.formArrayListKnowledge=this.form.controls.knowledgeIds}initKnowledgeCheckbox(s){this.formArrayListKnowledge.clear();for(let a=0;a<s.length;a++){const r=new t.MJ(!1,{nonNullable:!0});this.formArrayListKnowledge.push(r)}}initWeedCheckbox(s){this.formArrayListWeek.clear();for(let a=0;a<s.length;a++){const r=new t.MJ(!1,{nonNullable:!0});this.formArrayListWeek.push(r)}}calculateIsCheckAll(){const s=this.formArrayListWeek.controls.every(a=>a.value);this.isCheckAllWeeks.setValue(s)}ngOnChanges(){this.initForm(),this.initKnowledgeCheckbox(this.listKnowledge),this.dataSource.data=this.buildFileTree(this.listKnowledge,0)}ngOnInit(){super.ngOnInit(),this.initWeedCheckbox(this.listWeek),this.currentSchoolWeeks=this.timeService.getSchoolWeeks(),this.checklistSelection.changed.subscribe(s=>{let a=this.checklistSelection.selected.map(o=>o.id??0);this.listKnowledgeId=a.sort((o,r)=>o-r)??[],this.emitChooseKnowledge.emit(this.listKnowledgeId)}),this.form.controls.weeks.valueChanges.subscribe(s=>{this.calculateIsCheckAll(),this.checkChooseWeeks=s.some(a=>a)})}constructor(s){super(),this.timeService=s,this.listKnowledge=[],this.listWeek=[],this.emitChooseKnowledge=new e.bkB,this.formArrayListKnowledge=new t.Yp([]),this.formArrayListWeek=new t.Yp([]),this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.selectedParent=null,this.newItemName="",this.checklistSelection=new H.CB(!0),this.listKnowledgeId=[],this.currentSchoolWeeks=0,this.checkChooseWeeks=!1,this.isCheckAllWeeks=new t.MJ(!1,{nonNullable:!0}),this.isCheckSemesterOne=new t.MJ(!1,{nonNullable:!0}),this.isCheckSemesterTwo=new t.MJ(!1,{nonNullable:!0}),this.getLevel=a=>a.level??0,this.isExpandable=a=>a.expandable??!1,this.getChildren=a=>a.children??[],this.hasChild=(a,o)=>o.expandable??!1,this.hasNoContent=(a,o)=>""===o.item,this.transformer=(a,o)=>{const r=this.nestedNodeMap.get(a),u=r&&r.item===a.item?r:new ge;return u.item=a.item,u.level=o,u.id=a.id,u.expandable=!!a.children,this.flatNodeMap.set(u,a),this.nestedNodeMap.set(a,u),u},this.treeFlattener=new K.yj(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new Z.XW(this.getLevel,this.isExpandable),this.dataSource=new K.zw(this.treeControl,this.treeFlattener)}}return(l=E).\u0275fac=function(s){return new(s||l)(e.rXU(q.F))},l.\u0275cmp=e.VBU({type:l,selectors:[["azt-config-document-market"]],inputs:{form:"form",listKnowledge:"listKnowledge",listWeek:"listWeek"},outputs:{emitChooseKnowledge:"emitChooseKnowledge"},features:[e.Vt3,e.OA$],decls:48,vars:29,consts:[[1,"mt-5"],[3,"formGroup"],[1,"box","p-3"],[1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-5"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["type","radio","id","creator-by-me","formControlName","creatorId","value","1",1,"form-check-input"],["for","creator-by-me",1,"form-check-label"],["type","radio","id","creator-by-user-other","formControlName","creatorId","value","0",1,"form-check-input"],["for","creator-by-user-other",1,"form-check-label"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["formArrayName","weeks",1,"list-week","grid","grid-cols-12"],[1,"col-span-12","flex","items-center"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"list-week","col-span-12","mt-1"],[1,"flex","flex-row","sm:flex-col","sm:items-center"],[1,"azt-form-check","mr-5","mt-3","sm:mt-0"],["type","checkbox","id","selectSemesterOne",1,"form-check-input",3,"change","formControl"],["for","selectSemesterOne",1,"form-check-label"],["type","checkbox","id","selectSemesterTwo",1,"form-check-input",3,"change","formControl"],["for","selectSemesterTwo",1,"form-check-label"],["type","checkbox","id","selectAllWeeks",1,"form-check-input",3,"change","formControl"],["for","selectAllWeeks",1,"form-check-label"],[1,"grid","grid-cols-12","gap-3","mt-3"],["class","col-span-6 md:col-span-3 lg:col-span-2",4,"ngFor","ngForOf"],["class","col-span-12 mt-2 text-danger text-xs",4,"ngIf"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12"],["type","text","name","creatorFullName","formControlName","creatorFullName",1,"form-control",3,"placeholder"],["class","text-danger text-xs mt-2",4,"ngIf"],[1,"col-span-12","md:col-span-4"],["type","text","appOnlyNumber","","name","creatorPhone","formControlName","creatorPhone",1,"form-control",3,"placeholder"],[1,"col-span-12","md:col-span-8"],["type","text","name","creatorWorkingAddress","formControlName","creatorWorkingAddress",1,"form-control",3,"placeholder"],[1,"text-danger","text-xs","mt-2"],[1,"list-knowledge","col-span-12"],[3,"dataSource","treeControl"],["matTreeNodeToggle","","matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle","","matTreeNodePadding",""],["mat-icon-button","","disabled",""],[1,"azt-form-checked"],["type","checkbox",1,"form-check-input",3,"change","checked","id"],[1,"form-check-label",2,"vertical-align","middle",3,"for"],["matTreeNodePadding",""],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror","w-5","h-5","inline-block",2,"vertical-align","bottom"],["size","20",3,"name"],["type","checkbox",1,"form-check-input",3,"change","checked","indeterminate","id"],[1,"col-span-6","md:col-span-3","lg:col-span-2"],[1,"azt-form-check"],["type","checkbox","value","41556",1,"form-check-input",3,"formControlName","id"],[1,"form-check-label",2,"vertical-align","middle",3,"ngClass","for"],["class","inline-block ml-1",4,"ngIf"],[1,"inline-block","ml-1"],[1,"col-span-12","mt-2","text-danger","text-xs"]],template:function(s,a){1&s&&(e.j41(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e.EFF(6),e.nI1(7,"mytranslate"),e.k0s()(),e.j41(8,"div",6)(9,"div",7)(10,"div",8),e.nrm(11,"input",9),e.j41(12,"label",10),e.EFF(13),e.nI1(14,"mytranslate"),e.k0s()(),e.j41(15,"div",8),e.nrm(16,"input",11),e.j41(17,"label",12),e.EFF(18),e.nI1(19,"mytranslate"),e.k0s()()()()(),e.DNE(20,le,15,13,"div",13)(21,he,10,6,"div",13),e.j41(22,"div",14)(23,"div",15)(24,"div",16)(25,"span",17),e.EFF(26),e.nI1(27,"mytranslate"),e.k0s()(),e.j41(28,"div",18)(29,"div",19)(30,"div",20)(31,"input",21),e.bIt("change",function(){return a.toggleSemesterOneCheckBox()}),e.k0s(),e.j41(32,"label",22),e.EFF(33),e.nI1(34,"mytranslate"),e.k0s()(),e.j41(35,"div",20)(36,"input",23),e.bIt("change",function(){return a.toggleSemesterTwoCheckBox()}),e.k0s(),e.j41(37,"label",24),e.EFF(38),e.nI1(39,"mytranslate"),e.k0s()(),e.j41(40,"div",20)(41,"input",25),e.bIt("change",function(){return a.toggleAllCheckBox()}),e.k0s(),e.j41(42,"label",26),e.EFF(43),e.nI1(44,"mytranslate"),e.k0s()()(),e.j41(45,"div",27),e.DNE(46,ue,8,10,"div",28),e.k0s()(),e.DNE(47,pe,4,3,"div",29),e.k0s()()()()()),2&s&&(e.R7$(),e.Y8G("formGroup",a.form),e.R7$(5),e.SpI(" ",e.bMT(7,15,"lang_document_author")," "),e.R7$(7),e.SpI(" ",e.bMT(14,17,"lang_document_me")," "),e.R7$(5),e.SpI(" ",e.bMT(19,19,"lang_document_others")," "),e.R7$(2),e.Y8G("ngIf","0"==a.form.controls.creatorId.value),e.R7$(),e.Y8G("ngIf",a.formArrayListKnowledge.controls.length),e.R7$(5),e.SpI(" ",e.bMT(27,21,"lang_document_time_of_use")," "),e.R7$(5),e.Y8G("formControl",a.isCheckSemesterOne),e.R7$(2),e.SpI(" ",e.bMT(34,23,"lang_config_semester")+" 1"," "),e.R7$(3),e.Y8G("formControl",a.isCheckSemesterTwo),e.R7$(2),e.SpI(" ",e.bMT(39,25,"lang_config_semester")+" 2"," "),e.R7$(3),e.Y8G("formControl",a.isCheckAllWeeks),e.R7$(2),e.SpI(" ",e.bMT(44,27,a.isCheckAllWeeks.value?"lang_student_classroom_list_utils_create_class_new_course_disable":"lang_student_classroom_list_utils_create_class_new_course_choose_all")," "),e.R7$(3),e.Y8G("ngForOf",a.formArrayListWeek.controls),e.R7$(),e.Y8G("ngIf",!a.checkChooseWeeks))},dependencies:[T.YU,T.Sq,T.bT,ee.iY,K.yI,K.yF,K.pO,K.lQ,K.d6,t.qT,t.me,t.Zm,t.Fm,t.BC,t.cb,t.l_,t.j4,t.JD,t.v8,te.WGl,se.Z,D.t,J.wp],encapsulation:2}),E})();var ve=n(51614);function Ce(l,E){if(1&l&&e.nrm(0,"azt-loading-effect",3),2&l){const h=e.XpG();e.Y8G("currentStatusObj",h.statusObj)}}function Se(l,E){1&l&&(e.j41(0,"div",29),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"lang_auto_vui_long_nhap_ten_de_thi")," "))}function be(l,E){1&l&&(e.j41(0,"span",30),e.nrm(1,"azt-loading-ui"),e.k0s())}function xe(l,E){if(1&l){const h=e.RV6();e.j41(0,"div",4)(1,"form",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"div",9)(6,"div",10)(7,"label",11),e.EFF(8),e.nI1(9,"mytranslate"),e.k0s()(),e.j41(10,"div",10)(11,"div",12),e.nrm(12,"input",13),e.nI1(13,"mytranslate"),e.k0s(),e.DNE(14,Se,3,3,"div",14),e.k0s()(),e.j41(15,"div",15),e.nrm(16,"config-level-subject-book",16),e.k0s(),e.j41(17,"div",17),e.nrm(18,"config-purpose-exam",18),e.k0s(),e.j41(19,"div",19)(20,"div",10)(21,"label",20),e.EFF(22),e.nI1(23,"mytranslate"),e.k0s()(),e.j41(24,"div",10)(25,"div",12),e.nrm(26,"textarea",21),e.nI1(27,"mytranslate"),e.k0s()()()(),e.j41(28,"div",22)(29,"azt-config-document-market",23),e.bIt("emitChooseKnowledge",function(a){e.eBV(h);const o=e.XpG();return e.Njj(o.chooseKnowledge(a))}),e.k0s()(),e.j41(30,"div",24)(31,"div",25)(32,"button",26),e.bIt("click",function(){e.eBV(h);const a=e.XpG();return e.Njj(a.cancelSaveDocumentObj())}),e.EFF(33),e.nI1(34,"mytranslate"),e.k0s(),e.j41(35,"button",27),e.bIt("click",function(){e.eBV(h);const a=e.XpG();return e.Njj(a.handleSaveDocument())}),e.DNE(36,be,2,0,"span",28),e.EFF(37),e.nI1(38,"mytranslate"),e.k0s()()()()()()()}if(2&l){const h=e.XpG();e.R7$(),e.Y8G("formGroup",h.form),e.R7$(7),e.SpI(" ",e.bMT(9,17,"lang_auto_ten")," "),e.R7$(4),e.FS9("placeholder",e.bMT(13,19,"lang_auto_nhap_ten")+" ..."),e.R7$(2),e.Y8G("ngIf",h.form.controls.name.errors),e.R7$(2),e.Y8G("form",h.form)("useExamSchoolLogData",!0),e.R7$(2),e.Y8G("purposeList",h.listPurposeObjs)("form",h.form),e.R7$(4),e.SpI(" ",e.bMT(23,21,"lang_auto_mo_ta")," "),e.R7$(4),e.FS9("placeholder",e.bMT(27,23,"lang_core_nhap_mo_ta")+" ..."),e.R7$(3),e.Y8G("form",h.form)("listWeek",h.listWeek)("listKnowledge",h.listKnowledge),e.R7$(4),e.SpI(" ",e.bMT(34,25,"lang_auto_huy")," "),e.R7$(2),e.Y8G("disabled",h.logConfig.status),e.R7$(),e.Y8G("ngIf",h.logConfig.status),e.R7$(),e.SpI(" ",e.bMT(38,27,"lang_auto_luu")," ")}}function ke(l,E){if(1&l&&(e.j41(0,"div",31)(1,"div",32)(2,"div",33)(3,"span",34),e.nrm(4,"azt-loading-ui"),e.k0s(),e.j41(5,"div",35),e.EFF(6),e.k0s()()()()),2&l){const h=e.XpG();e.R7$(6),e.JRh(h.logConfig.msg)}}let Ie=(()=>{var l;class E extends M.H{chooseKnowledge(s){this.knowledgeList=s}cancelSaveDocumentObj(){this.onBack.emit(!0)}handleSaveDocument(){const s=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);if(this.checkErrorValidateSave(s,this.knowledgeList))this.showErrorSnack("lang_cms_utils_folder_name_validate_space");else{if(this.type===i.x.exam&&this.isCreateQuestionToEditor&&this.dataSave.exam&&this.dataSave.exam.questionObj.listQuestions){this.logConfig.setStatus(this.commonService.myTranslateInstant("lang_auto_dang_luu_du_lieu_de_thi")),this.countProcess=0;const a=this.dataSave.exam.questionObj.listQuestions;let o=this.commonService.myTranslateInstant("lang_auto_xay_ra_loi_trong_qua_trinh_xu_ly_hinh_anh_cua_de_thi")??"";this.questionShareSaveService.convertQuestions(a,this.dataSave.exam.rootQuests,(r,u=o,b)=>{this.logConfig.stopStatus(),this.showErrorSnack(u),b&&this.stopStatusObj()}).then(()=>{this.startMainProcessSaveEditor()})}this.type===i.x.exam&&!this.isCreateQuestionToEditor&&this.examObj?.id&&this.saveDocumentMarketQuestionObjs(),this.type!==i.x.exam&&this.attachments.length&&this.saveDocumentMarketQuestionObjs(),console.log(this.attachments,this.type)}}initQuestionShare(){this.questionShareSaveService.callbackBase64ToCanvas=(s,a)=>{let o=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.setStatus(`${o} ${Math.floor(s/a*100*.7)}%`)},this.questionShareSaveService.callbackUploadImage=(s,a)=>{let o=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.setStatus(`${o} ${Math.floor(s/a*100*.3)+70}%`)}}processSaveQuestionsFromEditor(s,a,o){if(this.dataSave.exam?.questionObj&&this.dataSave.exam?.questionObj.listQuestions){var r=this.dataSave.exam?.questionObj.listQuestions.length;let u=s+100>r?r:s+100,b=this.dataSave.exam?.questionObj.listQuestions.slice(s,u)??[],O=[];for(const C of b)O.push({categoryId:C.categoryId,groupId:C.groupId,name:C.name??"none",metadata:C.metadata,isImage:C.isImage,questionContent:C.questionContent,answerMedia:C.answerMedia,questionText:C.questionText,answerType:C.answerType,answerConfig:C.answerConfig,coordinates:C.coordinates,answerResult:C.answerResult,totalQuestion:C.totalQuestion,tags:C.tags??[],mediaId:C.mediaId,mediaMeta:C.mediaMeta,attachments:C.attachments,version:C.version,isFixAns:C.isFixAns,groupType:C.groupType,__path:C.__path});O.length>0?this.sAztSaveProcessService.saveQuestionObjsFromEditor(this.dataSave,O,a).then(C=>{C&&C.listQuestionId.length>0?(o.listQuestionId=o.listQuestionId.concat(C.listQuestionId),this.processSaveQuestionsFromEditor(u,C.indexSaved,o)):(this.countProcess=0,this.logConfig.stopStatus(),this.showErrorSnack("lang_auto_khong_luu_duoc_noi_dung_cau_hoi_trong_de_vui_long_kiem_tra_lai"))}):this.saveDocumentMarketQuestionObjs(o)}}startMainProcessSaveEditor(){this.dataSave.exam&&this.dataSave.exam.questionObj&&this.processSaveQuestionsFromEditor(0,0,{indexSaved:0,listQuestionId:[]})}getListPurposeExam(){this.initStatusObj(),this.waitDestroy(this.commonListService.apiCommonListExamPurposesGet().subscribe(s=>{if(!s.success)return this.errorStatusObj(s.message,!0);this.listPurposeObjs=s.data?.objs??[],this.successStatusObj()}))}getKnowledgeData(){const s=this.form.controls.schoolLevel.value,a=this.form.controls.schoolSubject.value;s&&a&&this.waitDestroy(this.knowledgeService.apiKnowledgeGet(s,a).subscribe(o=>{o.list&&(this.listKnowledge=o.list)}))}checkErrorValidateSave(s,a){return!(!this.form.invalid&&("0"!=this.form.controls.creatorId.value||this.form.controls.creatorFullName.value&&this.form.controls.creatorFullName.value&&this.form.controls.creatorPhone.value&&this.form.controls.creatorWorkingAddress.value)&&("0"!=this.form.controls.creatorId.value||10===this.form.controls.creatorPhone.value.length)&&s.length)}fillConfig(){const s=Number(this.commonService.getMyParam(this.activeRoute,"levelId")),a=Number(this.commonService.getMyParam(this.activeRoute,"subjectId"));if(this.examObj?.id)this.waitDestroy(this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(this.examObj.hashId??"").subscribe(o=>{if(o.success){const r=o.data?.examObj;this.form.controls.name.setValue(r?.name??""),this.form.controls.description.setValue(r?.description??""),this.form.controls.schoolLevel.setValue(r?.schoolLevelId??s),this.form.controls.schoolSubject.setValue(r?.schoolSubjectId??a),this.form.controls.purposeExam.setValue(o.data?.purposeId??0),this.form.controls.purposeNote.setValue(o.data?.purposeNote??"")}else this.errorStatusObj(o.message??"",!0)}));else if(this.isCreateQuestionToEditor){const o=Number(this.browserStorageService.getSimpleStorage("levelId")??0),r=Number(this.browserStorageService.getSimpleStorage("subjectId")??0);this.form.controls.schoolLevel.setValue(o),this.form.controls.schoolSubject.setValue(r)}else this.form.controls.schoolLevel.setValue(s),this.form.controls.schoolSubject.setValue(a),this.form.controls.name.setValue(this.name)}getWeeksChecked(s,a){let o=[];for(let r=0;r<a.length;r++)a[r]&&s[r]&&o.push(s[r]);return o}createListWeek(){for(let a=0;a<35;a++)this.listWeek.push(a+1)}saveDocumentMarketQuestionObjs(s){const a=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);this.logConfig.setStatus("");let o={name:this.form.controls.name.value,type:this.type,schoolLevelId:this.form.controls.schoolLevel.value,schoolSubjectId:this.form.controls.schoolSubject.value,purposeId:this.form.controls.purposeExam.value,purposeNote:this.form.controls.purposeNote.value,description:this.form.controls.description.value,creatorId:Number(this.form.controls.creatorId.value),creatorFullName:this.form.controls.creatorFullName.value,creatorPhone:this.form.controls.creatorPhone.value,creatorWorkingAddress:this.form.controls.creatorWorkingAddress.value,knowledgeIds:this.knowledgeList,weeks:a};switch(this.type){case i.x.exam:if(s&&this.isCreateQuestionToEditor){let r=[];r=s.listQuestionId.map(u=>u??0)??[],o.questionIds=r}this.examObj?.id&&!this.isCreateQuestionToEditor&&(o.examId=this.examObj?.id,o.questionIds=[]);break;case i.x.lecture:case i.x.ref:case i.x.teaching_plan:case i.x.slide:o.attachments=this.attachments}this.waitDestroy(this.documentService.apiDocumentsPost(o).subscribe(r=>{if(r.id){this.successStatusObj("lang_document_successful_sharing",!0);const u="/document-market/list-documents/your-documents/1";this.logConfig.stopStatus(),this.myNavigation(u)}else this.errorStatusObj(""),this.logConfig.stopStatus()}))}ngOnInit(){super.ngOnInit(),this.getListPurposeExam(),this.createListWeek(),this.getKnowledgeData(),this.fillConfig(),this.form.controls.schoolSubject.valueChanges.subscribe(s=>{this.getKnowledgeData()}),this.form.controls.schoolLevel.valueChanges.subscribe(s=>{this.getKnowledgeData()}),this.type===i.x.exam&&this.isCreateQuestionToEditor&&(this.dataSave=this.editorOutputDataService.getOutputData(),this.form.controls.name.setValue(this.dataSave.exam?.examObj.name??this.dataSave.homework?.name??""))}constructor(s,a,o,r,u,b,O,C,U){super(),this.documentConfigService=s,this.activeRoute=a,this.documentService=o,this.knowledgeService=r,this.questionShareSaveService=u,this.editorOutputDataService=b,this.sAztSaveProcessService=O,this.browserStorageService=C,this.commonListService=U,this.type=i.x.exam,this.isCreateQuestionToEditor=!1,this.attachments=[],this.name="",this.onBack=new e.bkB,this.listPurposeObjs=[],this.listKnowledge=[],this.logConfig=new P.J,this.dataSave={},this.saveParts=[],this.countProcess=0,this.knowledgeList=[],this.listWeek=[],this.form=new t.gE({name:new t.MJ("",{nonNullable:!0,validators:[t.k0.required,F.M.noWhiteSpace]}),description:new t.MJ("",{nonNullable:!0}),schoolLevel:new t.MJ(0,{nonNullable:!0,validators:[t.k0.required,t.k0.min(1)]}),schoolSubject:new t.MJ(0,{nonNullable:!0,validators:[t.k0.required,t.k0.min(1)]}),purposeExam:new t.MJ(0,{nonNullable:!0,validators:[t.k0.required,t.k0.min(1)]}),purposeNote:new t.MJ("",{nonNullable:!0}),knowledgeIds:new t.Yp([]),weeks:new t.Yp([]),creatorId:new t.MJ("1",{nonNullable:!0}),creatorFullName:new t.MJ("",{nonNullable:!0}),creatorPhone:new t.MJ("",{nonNullable:!0}),creatorWorkingAddress:new t.MJ("",{nonNullable:!0})}),this.type===i.x.exam&&this.isCreateQuestionToEditor&&this.initQuestionShare()}}return(l=E).\u0275fac=function(s){return new(s||l)(e.rXU(x.x_),e.rXU(d.nX),e.rXU(_.DK),e.rXU(_.Iu),e.rXU(p),e.rXU(g.O),e.rXU(I.G),e.rXU(S.z),e.rXU(A.Nz))},l.\u0275cmp=e.VBU({type:l,selectors:[["azt-config-share-document"]],inputs:{type:"type",isCreateQuestionToEditor:"isCreateQuestionToEditor",attachments:"attachments",name:"name",examObj:"examObj"},outputs:{onBack:"onBack"},features:[e.Vt3],decls:4,vars:3,consts:[["doneLoading",""],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["style","width: 100vw; height: 100vh; position: fixed; z-index: 9999; top: 0; left: 0; display: flex; justify-content: center; align-items: center; background-color: rgba(0, 0, 0, 0.4)",4,"ngIf"],[3,"currentStatusObj"],[1,"intro-y","mt-8","p-3"],[3,"formGroup"],[1,"mx-auto",2,"max-width","1100px"],[1,"setting-block"],[1,"box","mt-2","p-3"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","general-name","formControlName","name","type","text",1,"form-control",3,"placeholder"],["class","mt-2 text-danger text-xs fade",4,"ngIf"],[1,"mt-4"],[3,"form","useExamSchoolLogData"],[1,"mt-2"],[3,"purposeList","form"],["id","azt-config-desc",1,"grid","grid-cols-12","mt-4"],["for","general-desc",1,"form-label","mb-0","font-medium","flex","items-center"],["id","general-desc","formControlName","description",1,"form-control","w-full",2,"height","150px",3,"placeholder"],[1,"config-document-market"],[3,"emitChooseKnowledge","form","listWeek","listKnowledge"],[1,"mt-5"],[1,"flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-24","btn-primary",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"mt-2","text-danger","text-xs","fade"],[1,"w-4","h-4","mr-2"],[2,"width","100vw","height","100vh","position","fixed","z-index","9999","top","0","left","0","display","flex","justify-content","center","align-items","center","background-color","rgba(0, 0, 0, 0.4)"],[2,"text-align","center","color","#000000"],[2,"margin-bottom","10px"],[1,"w-4","h-4","inline-block"],[2,"font-size","20px","margin-top","10px","background-color","#f0f8ffa3","padding","10px","border-radius","5px"]],template:function(s,a){if(1&s&&e.DNE(0,Ce,1,1,"azt-loading-effect",1)(1,xe,39,29,"ng-template",null,0,e.C5r)(3,ke,7,1,"div",2),2&s){const o=e.sdS(2);e.Y8G("ngIf",a.statusObj.loading)("ngIfElse",o),e.R7$(3),e.Y8G("ngIf",a.logConfig.status&&a.isCreateQuestionToEditor)}},dependencies:[T.bT,t.qT,t.me,t.BC,t.cb,t.j4,t.JD,N.K,D.t,G.R,V.b,_e,ve.X,J.wp],encapsulation:2}),E})()},77260:(W,j,n)=>{n.d(j,{G:()=>F});var e=n(48891),t=n(62095),i=n(5382),P=n(97633),M=n(76671);let F=(()=>{var x;class d{convertBase64OfMathJaxToCdnUrlInQuestions(m,f){return new Promise((v,c)=>{const k=null==f?new i.n(10):new i.n(10,{function:f},0);m.forEach(p=>{k.addTask(this.dataAztMathRawHelper,this.dataAztMathRawHelper.convertBase64OfMathJaxToCdnUrl,[p])}),k.start().then(p=>{0===p.errs.length?v(p.datas):c(p.errs[0])})})}saveQuestionObjsFromEditor(m,f,v){return new Promise(c=>{this.convertBase64OfMathJaxToCdnUrlInQuestions(f,void 0).then(k=>{let p=[];for(let g=0;g<k.length;g++){let I=k[g];I.expandInfo=this.commonService.serializeJson(m.exam?.examObj.expandInfoObj),p.push(I)}this.questionService.apiQuestionsPost({listQuestions:p}).subscribe(g=>{c(g.list?{indexSaved:g.list.length+v,listQuestionId:g.list}:{indexSaved:v,listQuestionId:[]})})}).catch(()=>{c({indexSaved:v,listQuestionId:[]})})})}constructor(m,f){this.questionService=m,this.dataAztMathRawHelper=f,this.commonService=(0,e.WQX)(t.R)}}return(x=d).\u0275fac=function(m){return new(m||x)(e.KVO(P.wP),e.KVO(M.c))},x.\u0275prov=e.jDH({token:x,factory:x.\u0275fac,providedIn:"root"}),d})()},6989:(W,j,n)=>{n.d(j,{b:()=>I});var e=n(59640),t=n(48891),i=n(54460),P=n(47426),M=n(95670),F=n(4375),x=n(10936),d=n(44233),_=n(81587),m=n(43166),f=n(76975);function v(S,A){if(1&S&&(t.j41(0,"mat-option",16),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&S){const T=A.$implicit;t.Y8G("value",T.id),t.R7$(),t.SpI(" ",t.bMT(2,2,T.code)," ")}}function c(S,A){if(1&S&&(t.j41(0,"mat-optgroup",14),t.nI1(1,"mytranslate"),t.DNE(2,v,3,4,"mat-option",15),t.k0s()),2&S){const T=A.$implicit;t.XpG();const N=t.sdS(10);t.FS9("label",t.bMT(1,2,T.groupName)),t.R7$(2),t.Y8G("ngForOf",N.filter(T.purposeListInGroup,"code"))}}function k(S,A){1&S&&(t.j41(0,"div",17),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&S&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_testbank_please_choose_purpose_exam")," "))}function p(S,A){1&S&&(t.j41(0,"div",17),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&S&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_testbank_please_enter_purpose_create_exam")," "))}function g(S,A){if(1&S&&(t.j41(0,"div",4)(1,"div",5)(2,"label",18),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",19),t.nrm(6,"input",20),t.nI1(7,"mytranslate"),t.k0s(),t.DNE(8,p,3,3,"div",12),t.k0s()),2&S){const T=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,3,"lang_testbank_enter_create_exam_target")," "),t.R7$(3),t.FS9("placeholder",t.bMT(7,5,"lang_testbank_enter_create_exam_target")+" ..."),t.R7$(2),t.Y8G("ngIf",(4==(null==T.form.controls.purposeExam?null:T.form.controls.purposeExam.value)||8==(null==T.form.controls.purposeExam?null:T.form.controls.purposeExam.value)||12==(null==T.form.controls.purposeExam?null:T.form.controls.purposeExam.value))&&""===(null==T.form.controls.purposeNote||null==T.form.controls.purposeNote.value?null:T.form.controls.purposeNote.value.trim()))}}let I=(()=>{var S;class A extends e.H{convertPurposeList(){this.targetExamGroupObjs=[],this.purposeList.forEach(N=>{const{semester:D}=N;let G=this.targetExamGroupObjs.find(V=>V.semester===D);G||(G={semester:D,groupName:this.getGroupNamePurpose(N.semester??1),purposeListInGroup:[]},this.targetExamGroupObjs.push(G)),G.purposeListInGroup?.push(N)})}getGroupNamePurpose(N){switch(N){case 1:default:return"lang_testbank_semester_one";case 2:return"lang_testbank_semester_two";case 3:return"lang_testbank_another_purpose"}}ngOnInit(){this.convertPurposeList()}constructor(){super(),this.purposeList=[],this.targetExamGroupObjs=[]}}return(S=A).\u0275fac=function(N){return new(N||S)},S.\u0275cmp=t.VBU({type:S,selectors:[["config-purpose-exam"]],inputs:{form:"form",purposeList:"purposeList"},features:[t.Vt3],decls:21,vars:18,consts:[["searchInListPurpose","searchInList"],[1,"config-purpose-exan"],[3,"formGroup"],["id","azt-config-purpose-exam",1,"grid","grid-cols-12","gap-5"],[1,"col-span-12"],[1,"font-medium"],[1,"form-label","flex","items-center"],["appearance","outline"],["searchInList","","formControlName","purposeExam","name","purposeExam"],[3,"formControl","placeholderLabel","noEntriesFoundLabel"],["disabled","",3,"value"],[3,"label",4,"ngFor","ngForOf"],["class","mt-2 text-danger text-xs",4,"ngIf"],["class","col-span-12",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mt-2","text-danger","text-xs"],["for","enter_target_create_exam",1,"form-label","flex","items-center"],[1,"setting-input"],["id","enter_target_create_exam","formControlName","purposeNote","type","text",1,"form-control",3,"placeholder"]],template:function(N,D){if(1&N&&(t.j41(0,"div",1)(1,"form",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"label",6),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.j41(8,"mat-form-field",7)(9,"mat-select",8,0)(11,"mat-option"),t.nrm(12,"ngx-mat-select-search",9),t.nI1(13,"mytranslate"),t.nI1(14,"mytranslate"),t.k0s(),t.j41(15,"mat-option",10),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.DNE(18,c,3,4,"mat-optgroup",11),t.k0s()(),t.DNE(19,k,3,3,"div",12),t.k0s(),t.DNE(20,g,9,7,"div",13),t.k0s()()()),2&N){const G=t.sdS(10);t.R7$(),t.Y8G("formGroup",D.form),t.R7$(5),t.SpI(" ",t.bMT(7,10,"lang_testbank_target_exam")," "),t.R7$(6),t.FS9("placeholderLabel",t.bMT(13,12,"lang_bot_common_search_by_name")),t.FS9("noEntriesFoundLabel",t.bMT(14,14,"lang_bot_common_search_not_found")),t.Y8G("formControl",G.searchControl),t.R7$(3),t.Y8G("value",0),t.R7$(),t.SpI("---",t.bMT(17,16,"lang_testbank_choose_purpose"),"---"),t.R7$(2),t.Y8G("ngForOf",D.targetExamGroupObjs),t.R7$(),t.Y8G("ngIf",0==D.form.controls.purposeExam.value),t.R7$(),t.Y8G("ngIf",4==(null==D.form.controls.purposeExam?null:D.form.controls.purposeExam.value)||8==(null==D.form.controls.purposeExam?null:D.form.controls.purposeExam.value)||12==(null==D.form.controls.purposeExam?null:D.form.controls.purposeExam.value))}},dependencies:[i.Sq,i.bT,P.wT,P.D7,M.rl,F.VO,x.qT,x.me,x.BC,x.cb,x.l_,x.j4,x.JD,d.U9,_.t,m.x,f.wp],encapsulation:2}),A})()},74175:(W,j,n)=>{n.d(j,{W:()=>v});var e=n(47947),t=n(59640),i=n(48891),P=n(10296),M=n(62095),F=n(27691),x=n(54460),d=n(76975);const _=["*","*"];function m(c,k){if(1&c){const p=i.RV6();i.qex(0),i.j41(1,"a",2),i.bIt("click",function(){i.eBV(p);const I=i.XpG();return i.Njj(I.shareFileToFlutter())}),i.j41(2,"span"),i.EFF(3),i.nI1(4,"mytranslate"),i.k0s(),i.SdG(5),i.k0s(),i.bVm()}if(2&c){const p=i.XpG();i.R7$(),i.Aen(p.style),i.HbH(p.classStyle),i.FS9("target",p.target),i.R7$(2),i.JRh(i.bMT(4,7,p.fileDescription))}}function f(c,k){if(1&c&&(i.j41(0,"a",3)(1,"span"),i.EFF(2),i.nI1(3,"mytranslate"),i.k0s(),i.SdG(4,1),i.k0s()),2&c){const p=i.XpG();i.Aen(p.style),i.HbH(p.classStyle),i.FS9("href",p.dataUrl,i.B4B),i.FS9("target",p.target),i.FS9("download",p.fileName),i.R7$(2),i.JRh(i.bMT(3,9,p.fileDescription))}}let v=(()=>{var c;class k extends t.H{downloadFile(){return this.http.get(this.dataUrl,{responseType:"blob"}).pipe((0,e.T)(g=>g))}shareFileToFlutter(){this.downloadFile().subscribe(g=>{this.shareFileFlutterService.shareFileWithBlob(g,this.fileName)})}ngOnInit(){super.ngOnInit()}constructor(g,I,S){super(),this.shareFileFlutterService=g,this.commonService=I,this.http=S,this.dataUrl="",this.target="",this.fileName="",this.fileDescription="",this.classStyle="",this.style=""}}return(c=k).\u0275fac=function(g){return new(g||c)(i.rXU(P.R),i.rXU(M.R),i.rXU(F.Qq))},c.\u0275cmp=i.VBU({type:c,selectors:[["azt-download-link-item"]],inputs:{dataUrl:"dataUrl",target:"target",fileName:"fileName",fileDescription:"fileDescription",classStyle:"classStyle",style:"style"},features:[i.Vt3],ngContentSelectors:_,decls:3,vars:2,consts:[["NormalWeb",""],[4,"ngIf","ngIfElse"],[3,"click","target"],[3,"href","target","download"]],template:function(g,I){if(1&g&&(i.NAR(_),i.DNE(0,m,6,9,"ng-container",1)(1,f,5,11,"ng-template",null,0,i.C5r)),2&g){const S=i.sdS(2);i.Y8G("ngIf",I.isMobileWebView)("ngIfElse",S)}},dependencies:[x.bT,d.wp],encapsulation:2}),k})()}}]);