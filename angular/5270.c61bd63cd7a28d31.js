"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[5270],{54284:(U,I,l)=>{l.d(I,{h:()=>v});var m=l(37734),_=l(61713),C=l(65879);let v=(()=>{class d extends m.Q{constructor(){super(...arguments),this.limitSize=200,this.selectFile=A=>{const f=A.target,S=f.files;if(S){if(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(S).find(x=>(0,_.EO)(x.size)>=this.limitSize))return this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB"));const E=[];Array.from(S).forEach(x=>{E.push(x)}),this.emitUploadToEditorComplete(E)}f.value=""}}}return d.\u0275fac=function(){let z;return function(f){return(z||(z=C.n5z(d)))(f||d)}}(),d.\u0275cmp=C.Xpm({type:d,selectors:[["ng-component"]],inputs:{fileType:"fileType",limitSize:"limitSize"},features:[C.qOj],decls:0,vars:0,template:function(A,f){},encapsulation:2}),d})()},55270:(U,I,l)=>{l.r(I),l.d(I,{AzotaDigitalizeModule:()=>Lt});var m=l(96814),_=l(56223),C=l(12044),v=l(42753),d=l(37722),z=l(60381),A=l(25391),f=l(95545),S=l(56731),w=l(84155),E=l(78217),x=l(24090),Z=l(20553),J=l(82481),t=l(65879),b=l(37734),y=l(49671),R=l(47394),h=l(36727),N=l(46558),L=l(9e4);let Q=(()=>{class i{constructor(){this.subscriptions=new R.w0,this.ocrService=(0,t.f3M)(L.Kx),this.commonService=(0,t.f3M)(N.z)}digitalizeData(e,o,n,a){if(!e.image.url)return a(e);o("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:e.image.url}).subscribe({next:r=>{o("lang_digitalize_load_detect_image_script"),this.loadScriptHandleImage(()=>{o("lang_digitalize_call_detect_image_function"),this.imageUtils.detectImage(e.image.fileBytes).then(c=>{e.image.base64Images=c.images.map(u=>({base64:this.uint8ArrayToBase64(new Uint8Array(u.content)),width:u.width,height:u.height,extension:u.extension}));let p=(new h.$e).transform((new h.h8).transform(r.data));p=this.commonService.convertLatexTagToDollarDollar(p),p=this.commonService.replaceAll(p,"<table>","<table class='table table-bordered'>")??p,e.htmlResult=p,a(e)}).catch(c=>n("lang_digitalize_error_when_call_detect_image"))})},error:r=>n(r.error.message)}))}uint8ArrayToBase64(e){let o="";const n=e.byteLength;for(let a=0;a<n;a++)o+=String.fromCharCode(e[a]);return btoa(o)}waitAnswerSheetInitDone(e){if(window.azotaScanAnswerSheet)return e();setTimeout(()=>{this.waitAnswerSheetInitDone(e)},100)}loadScriptHandleImage(e){var o=this;if(this.imageUtils)return e();this.commonService.loadAnswerSheetJs().then((0,y.Z)(function*(){o.waitAnswerSheetInitDone((0,y.Z)(function*(){o.imageUtils=yield window.azotaScanAnswerSheet.imageUtils(),e()}))})).catch(n=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),e()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var O=function(i){return i[i.NONE=0]="NONE",i[i.PROCESSING=1]="PROCESSING",i[i.PROCESS_ERROR=2]="PROCESS_ERROR",i[i.PROCESSED=3]="PROCESSED",i}(O||{}),T=function(i){return i[i.CHOOSE_IMAGES=0]="CHOOSE_IMAGES",i[i.PROCESS_IMAGES=1]="PROCESS_IMAGES",i}(T||{}),B=l(43389),G=l(98129),H=l(61713),D=l(63120),K=l(77757),Y=l(2459),$=l(9769),q=l(26306),V=l(22096),M=l(37398),W=l(69732),P=l(79360);const tt=(i,s)=>(i.push(s),i);let it=(()=>{class i{processObservables(e,o){return(0,Y.D)(o).pipe((0,$.z)((n,a)=>n.pipe((0,q.K)(r=>(console.error("Error in observable:",r),(0,V.of)(null))),(0,M.U)(r=>({result:r,index:a}))),e),function et(){return(0,P.e)((i,s)=>{(function X(i,s){return(0,P.e)((0,W.U)(i,s,arguments.length>=2,!1,!0))})(tt,[])(i).subscribe(s)})}(),(0,M.U)(n=>n.sort((a,r)=>a.index-r.index).map(a=>a.result)))}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var ot=l(84672),nt=l(54284),at=l(7827);const st=["*"];let rt=(()=>{class i extends nt.h{constructor(){super(...arguments),this.emitFiles=new t.vpe}emitUploadToEditorComplete(e){e.length>0&&this.emitFiles.emit(e)}onDrop(e){try{this.emitFiles.emit(e)}catch(o){alert(o)}}}return i.\u0275fac=function(){let s;return function(o){return(s||(s=t.n5z(i)))(o||i)}}(),i.\u0275cmp=t.Xpm({type:i,selectors:[["azt-upload-multiple-document-to-editor"]],outputs:{emitFiles:"emitFiles"},features:[t.qOj],ngContentSelectors:st,decls:5,vars:2,consts:[[1,"upload-document","h-full",3,"appDropZone","click"],[3,"hidden"],["type","file","multiple","",1,"form-control","file-input",3,"accept","change"],["fileSelect",""]],template:function(e,o){if(1&e){const n=t.EpF();t.F$t(),t.TgZ(0,"div",0),t.NdJ("appDropZone",function(r){return o.onDrop(r)})("click",function(){t.CHM(n);const r=t.MAs(3);return t.KtG(r.click())}),t.TgZ(1,"form",1)(2,"input",2,3),t.NdJ("change",function(r){return o.selectFile(r)}),t.qZA()(),t.Hsn(4),t.qZA()}2&e&&(t.xp6(1),t.Q6J("hidden",!0),t.xp6(1),t.s9C("accept",o.fileType))},dependencies:[_._Y,_.JL,_.F,at.i],encapsulation:2}),i})();function lt(i,s){if(1&i&&t._UZ(0,"azt-loading-effect",2),2&i){const e=t.oxw();t.Q6J("currentStatusObj",e.statusObj)("customText",e.statusObj.errorMessage)}}const ct=function(i,s){return[i,s]};function pt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"azt-upload-multiple-document-to-editor",3),t.NdJ("emitFiles",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.handleUploadComplete(n))}),t.TgZ(1,"a",4),t.O4$(),t.TgZ(2,"svg",5),t._UZ(3,"line",6)(4,"line",7),t.qZA(),t.kcU(),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"mytranslate"),t.qZA()()()}if(2&i){const e=t.oxw();t.Q6J("fileType",t.WLB(4,ct,e.allUploadFileTypes.PDF,e.allUploadFileTypes.IMAGE)),t.xp6(6),t.Oqu(t.lcZ(7,2,"lang_digitalize_book_upload_file"))}}let mt=(()=>{class i extends b.Q{handleUploadComplete(e){this.initStatusObj("lang_digitalize_convert_pdf_to_images"),this.convertAllPdfToImages(e).then(o=>{let n=[];o.forEach(a=>{let r=this.apiUploadService.commonUploadFile(this.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE,a,"");n.push(r)}),this.initStatusObj("lang_digitalize_upload_images_to_cdn"),this.sAztConcurrencyApiService.processObservables(this.uploadThread,n).subscribe(a=>{if(a.find(g=>!g?.success))return this.errorStatusObj("lang_digitalize_book_upload_file_error",!0);let c=[],p=a.map(g=>g?.data).filter(this.commonService.notEmpty),u=o.map(g=>this.convertFileToUint8Array(g));this.initStatusObj("lang_digitalize_convert_file_to_byte_array"),Promise.all(u).then(g=>{p.forEach((k,j)=>{let F=this.commonService.getItemAtIndexOfArray(g,j);if(null==F)throw Error("lang_digitalize_missing_file_byte_array");c.push({...k,fileBytes:F,base64Images:[]})}),this.stopStatusObj(),this.uploadData.emit(c)}).catch(g=>console.error("lang_digitalize_convert_to_uint8_array_error: ",g))})})}convertAllPdfToImages(e){var o=this;let n=[];return e.forEach(a=>{if((0,H.Or)(a.type))return void n.push(new Promise(function(){var c=(0,y.Z)(function*(p,u){p([a])});return function(p,u){return c.apply(this,arguments)}}()));let r=new Promise(function(){var c=(0,y.Z)(function*(p,u){let g=[],j=yield o.withTimeout(o.myPdfService.getImageWithPdf(a),3e5);g.push(...j),p(g)});return function(p,u){return c.apply(this,arguments)}}());n.push(r)}),new Promise(function(){var a=(0,y.Z)(function*(r,c){Promise.all(n).then(p=>{r(o.commonService.concatMultipleArray(p))}).catch(p=>{o.showErrorSnack("lang_azt_pdf_invalid_format"),r([])})});return function(r,c){return a.apply(this,arguments)}}())}withTimeout(e,o){return new Promise((n,a)=>{const r=setTimeout(()=>{a(new Error("Operation timed out"))},o);e.then(c=>{clearTimeout(r),n(c)}).catch(c=>{clearTimeout(r),a(c)})})}convertFileToUint8Array(e){return new Promise((o,n)=>{const a=new FileReader;a.onload=()=>{if(a.result instanceof ArrayBuffer){const r=new Uint8Array(a.result);o(r)}else n(new Error("Error reading file as ArrayBuffer."))},a.onerror=()=>{n(new Error("Error reading file."))},a.readAsArrayBuffer(e)})}ngOnInit(){super.ngOnInit()}constructor(e,o,n){super(),this.myPdfService=e,this.sAztConcurrencyApiService=o,this.apiUploadService=n,this.uploadData=new t.vpe,this.allUploadToCdnMenuTypes=D.j6,this.allUploadFileTypes=D.AZ,this.uploadThread=10}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(K.z),t.Y36(it),t.Y36(ot.W))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-pdf-to-images"]],outputs:{uploadData:"uploadData"},features:[t.qOj],decls:3,vars:2,consts:[[3,"currentStatusObj","customText",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj","customText"],[3,"fileType","emitFiles"],[1,"btn","btn-primary-soft","w-full"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"]],template:function(e,o){if(1&e&&(t.YNc(0,lt,1,2,"azt-loading-effect",0),t.YNc(1,pt,8,7,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",n)}},dependencies:[m.O5,B.l,rt,h.JV],encapsulation:2}),i})();const gt=function(i){return{"mb-2":i}},_t=function(i){return{"border-pending":i}};function ut(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"span",5),t._uU(2),t.qZA(),t.TgZ(3,"img",6),t.NdJ("click",function(){const a=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.chooseImageEvent(a))}),t.qZA()()}if(2&i){const e=s.$implicit,o=s.last,n=t.oxw();t.Q6J("ngClass",t.VKq(4,gt,!o)),t.xp6(2),t.Oqu(e.position),t.xp6(1),t.Q6J("src",e.image.url,t.LSH)("ngClass",t.VKq(6,_t,n.listSelectedPositions.includes(e.position)))}}let dt=(()=>{class i extends b.Q{chooseImageEvent(e){let o=this.objs.find(n=>n.position==e.position);o&&(o.isSelected=!o.isSelected,this.listSelectedPositions=this.objs.filter(n=>n.isSelected).map(n=>n.position),this.chooseImages.emit(this.objs.filter(n=>n.isSelected)))}ngOnInit(){super.ngOnInit(),this.listSelectedPositions=this.objs.filter(e=>e.isSelected).map(e=>e.position)}constructor(){super(),this.chooseImages=new t.vpe,this.listSelectedPositions=[]}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-choose-images"]],inputs:{objs:"objs"},outputs:{chooseImages:"chooseImages"},features:[t.qOj],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"ng-scrollbar",2),t.YNc(5,ut,4,8,"div",3),t.qZA()()),2&e&&(t.xp6(2),t.AsE("",t.lcZ(3,4,"lang_digitalize_book_total_page"),": ",o.objs.length,""),t.xp6(2),t.Q6J("visibility","hover"),t.xp6(1),t.Q6J("ngForOf",o.objs))},dependencies:[m.mk,m.sg,f.KC,h.JV],encapsulation:2}),i})();const ft=function(i){return{"mb-2":i}},ht=function(i){return{"border-pending":i}};function Ot(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"span",5),t._uU(2),t.qZA(),t.TgZ(3,"img",6),t.NdJ("click",function(){const a=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.processImage.emit(a))}),t.qZA()()}if(2&i){const e=s.$implicit,o=s.last,n=t.oxw();t.Q6J("ngClass",t.VKq(4,ft,!o)),t.xp6(2),t.Oqu(e.position),t.xp6(1),t.Q6J("src",e.image.url,t.LSH)("ngClass",t.VKq(6,ht,(null==n.currentObj?null:n.currentObj.position)==e.position))}}let Ct=(()=>{class i extends b.Q{ngOnInit(){super.ngOnInit(),this.viewObjs=this.objs.filter(e=>e.isSelected)}constructor(){super(),this.processImage=new t.vpe,this.viewObjs=[]}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-process-images"]],inputs:{objs:"objs",currentObj:"currentObj"},outputs:{processImage:"processImage"},features:[t.qOj],decls:6,vars:6,consts:[[2,"height","60vh","margin-bottom","30px"],[1,"pb-2"],["track","vertical","pointerEventsMethod","scrollbar",1,"w-full",3,"visibility"],["class","relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"relative",3,"ngClass"],[1,"text-pending","font-medium","absolute","right-0","mr-2","pt-1"],[1,"w-full","clickable","mb-1","border-gray",3,"src","ngClass","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"ng-scrollbar",2),t.YNc(5,Ot,4,8,"div",3),t.qZA()()),2&e&&(t.xp6(2),t.AsE("",t.lcZ(3,4,"lang_digitalize_book_total_page"),": ",o.viewObjs.length,""),t.xp6(2),t.Q6J("visibility","hover"),t.xp6(1),t.Q6J("ngForOf",o.viewObjs))},dependencies:[m.mk,m.sg,f.KC,h.JV],encapsulation:2}),i})();var zt=l(28368);function vt(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"img",9),t.NdJ("click",function(){const a=t.CHM(e).$implicit,r=t.oxw(2);return t.KtG(r.chooseImages(a))}),t.ALo(2,"addBase64Extension"),t.qZA(),t.BQk()}if(2&i){const e=s.$implicit;t.xp6(1),t.s9C("src",t.xi3(2,1,e.base64,e.extension),t.LSH)}}function At(i,s){if(1&i&&(t.TgZ(0,"div",7),t.YNc(1,vt,3,4,"ng-container",8),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.obj.image.base64Images)}}let St=(()=>{class i extends b.Q{constructor(){super(...arguments),this.changeObj=new t.vpe,this.htmlFormControl=new _.NI("",{nonNullable:!0}),this.initDataEditor={},this.tinyEditorKey=Z.N.tinyEditorKey,this.showTinyMceEditor=!1,this.tinyMceService=(0,t.f3M)(zt.y)}chooseImages(e){this.obj.htmlResult=this.obj.htmlResult.replace("<img>",`<img src='${this.commonService.generateBase64Prefix(e.extension)+e.base64}'/>`),this.htmlFormControl.setValue(this.obj.htmlResult)}ngOnInit(){this.htmlFormControl.setValue(this.obj.htmlResult),this.htmlFormControl.valueChanges.subscribe(()=>{this.obj.htmlResult=this.htmlFormControl.getRawValue(),this.changeObj.emit(this.obj)}),this.initDataEditor=this.tinyMceService.initConfigForAdminForDigitalized(D.j6.ADMIN)}}return i.\u0275fac=function(){let s;return function(o){return(s||(s=t.n5z(i)))(o||i)}}(),i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-preview-result"]],inputs:{obj:"obj"},outputs:{changeObj:"changeObj"},features:[t.qOj],decls:10,vars:12,consts:[["class","box p-3 mb-3 list-base640-images",4,"ngIf"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-12"],[1,"box","p-3"],[3,"formControl","apiKey","init"],[1,"mt-8","mb-8"],[3,"innerHTML"],[1,"box","p-3","mb-3","list-base640-images"],[4,"ngFor","ngForOf"],[1,"mr-2","mb-2","box","clickable",3,"src","click"]],template:function(e,o){1&e&&(t.YNc(0,At,2,1,"div",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3),t._UZ(4,"editor",4)(5,"hr",5)(6,"div",6),t.ALo(7,"safeNormalHtmlContent"),t.ALo(8,"async"),t.ALo(9,"mathJaxContent"),t.qZA()()()),2&e&&(t.Q6J("ngIf",o.obj.image.base64Images.length>0),t.xp6(4),t.s9C("apiKey",o.tinyEditorKey),t.Q6J("formControl",o.htmlFormControl)("init",o.initDataEditor),t.uIk("style","width: 100%;min-height:500px;",t.Ckj),t.xp6(2),t.Q6J("innerHTML",t.lcZ(7,6,t.lcZ(8,8,t.lcZ(9,10,o.obj.htmlResult))),t.oJD))},dependencies:[m.sg,m.O5,_.JJ,v.PG,_.oH,m.Ov,h.Pc,h.fF,h.WF],styles:[".list-base640-images[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px}"]}),i})();function xt(i,s){if(1&i&&t._UZ(0,"azt-loading-effect",4),2&i){const e=t.oxw();t.Q6J("currentStatusObj",e.statusObj)}}function bt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-digitalize-pdf-to-images",16),t.NdJ("uploadData",function(n){t.CHM(e);const a=t.oxw(2);return t.KtG(a.uploadData(n))}),t.qZA()}}function yt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",17),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.showChooseLayout())}),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()}2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_digitalize_book_go_back_choose_layout")))}function Tt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-digitalize-choose-images",21),t.NdJ("chooseImages",function(n){t.CHM(e);const a=t.oxw(3);return t.KtG(a.chooseImages(n))}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("objs",e.objs)}}function It(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"app-digitalize-process-images",22),t.NdJ("processImage",function(n){t.CHM(e);const a=t.oxw(3);return t.KtG(a.processImage(n))}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("objs",e.objs)("currentObj",e.currentObj)}}function Et(i,s){if(1&i&&(t.TgZ(0,"div",18),t.YNc(1,Tt,1,1,"app-digitalize-choose-images",19),t.YNc(2,It,1,2,"app-digitalize-process-images",20),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.CHOOSE_IMAGES),t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.PROCESS_IMAGES)}}function Dt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"div",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(3);return t.KtG(n.startProcess())}),t._uU(2),t.ALo(3,"mytranslate"),t.ALo(4,"mytranslate"),t.qZA()()}if(2&i){const e=t.oxw(3);t.xp6(2),t.lnq("",t.lcZ(3,3,"lang_digitalize_book_start_call_orc_api")," (",e.totalSelected," ",t.lcZ(4,5,"lang_digitalize_book_total_images"),")")}}function jt(i,s){1&i&&(t._uU(0),t.ALo(1,"mytranslate")),2&i&&t.hij(" ",t.lcZ(1,1,"lang_digitalize_book_please_choose_image")," ")}function wt(i,s){if(1&i&&(t.ynx(0),t.TgZ(1,"div",18),t.YNc(2,Dt,5,7,"div",23),t.YNc(3,jt,2,3,"ng-template",null,24,t.W1O),t.qZA(),t.BQk()),2&i){const e=t.MAs(4),o=t.oxw(2);t.xp6(2),t.Q6J("ngIf",o.totalSelected>0)("ngIfElse",e)}}function Zt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"span",25),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(4);return t.KtG(n.processAgain(n.currentObj))}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()}2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"lang_digitalize_book_call_ocr_again")))}function Bt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"app-digitalize-preview-result",26),t.NdJ("changeObj",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.changeObj(n))}),t.qZA()()}if(2&i){const e=t.oxw(4);t.xp6(1),t.Q6J("obj",e.currentObj)}}function Mt(i,s){if(1&i&&t._UZ(0,"azt-loading-effect",28),2&i){const e=t.oxw(5);t.Q6J("currentStatusObj",e.processStatusObj)("customText",e.processStatusObj.errorMessage)}}function Pt(i,s){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Mt,1,2,"azt-loading-effect",27),t.qZA()),2&i){const e=t.oxw(4);t.xp6(1),t.Q6J("ngIf",e.processStatusObj.loading)}}function kt(i,s){if(1&i&&(t.ynx(0),t.YNc(1,Zt,4,3,"div",15),t.YNc(2,Bt,2,1,"div",15),t.YNc(3,Pt,2,1,"div",15),t.BQk()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.currentObj.processStatus==e.allProcessStatuses.PROCESS_ERROR),t.xp6(1),t.Q6J("ngIf",e.currentObj.processStatus==e.allProcessStatuses.PROCESSED),t.xp6(1),t.Q6J("ngIf",e.currentObj.processStatus==e.allProcessStatuses.NONE||e.currentObj.processStatus==e.allProcessStatuses.PROCESSING)}}function Ft(i,s){1&i&&(t.ynx(0),t.TgZ(1,"div",18),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.BQk()),2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"lang_digitalize_book_please_choose_image")))}function Ut(i,s){if(1&i&&(t.ynx(0),t.YNc(1,kt,4,3,"ng-container",15),t.YNc(2,Ft,4,3,"ng-container",15),t.BQk()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.currentObj),t.xp6(1),t.Q6J("ngIf",!e.currentObj)}}function Jt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),t.YNc(4,bt,1,0,"app-digitalize-pdf-to-images",9),t.YNc(5,yt,3,3,"div",10),t.qZA(),t.TgZ(6,"div",11)(7,"div",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.downloadData("html"))}),t._uU(8),t.ALo(9,"mytranslate"),t.qZA()(),t.TgZ(10,"div",11)(11,"div",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.downloadData("docx"))}),t._uU(12),t.ALo(13,"mytranslate"),t.qZA()()(),t.YNc(14,Et,3,2,"div",13),t.qZA(),t.TgZ(15,"div",14)(16,"div"),t._uU(17,"Open crop dialog"),t.qZA(),t.YNc(18,wt,5,2,"ng-container",15),t.YNc(19,Ut,3,2,"ng-container",15),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.currentLayout==e.allLayouts.CHOOSE_IMAGES),t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.PROCESS_IMAGES),t.xp6(3),t.Oqu(t.lcZ(9,7,"lang_digitalize_book_download_result_html")),t.xp6(4),t.Oqu(t.lcZ(13,9,"lang_digitalize_book_download_result_docx")),t.xp6(2),t.Q6J("ngIf",e.objs.length>0),t.xp6(4),t.Q6J("ngIf",e.currentLayout==e.allLayouts.CHOOSE_IMAGES),t.xp6(1),t.Q6J("ngIf",e.currentLayout==e.allLayouts.PROCESS_IMAGES)}}const Rt=[{path:"",children:[{path:"digitalize-book",component:(()=>{class i extends b.Q{startProcess(){this.currentLayout=T.PROCESS_IMAGES;let e=this.objs.filter(o=>o.isSelected);this.currentObj=this.commonService.getFirstOfArray(e),this.callOrcApi(e,0)}processAgain(e){this.callOrcApi([e],0)}callOrcApi(e,o=0){let n=this.commonService.getItemAtIndexOfArray(e,o),a=this.objs.find(r=>r.position==n?.position);if(null!=a&&null!=n)return a.processStatus==O.PROCESSING||a.processStatus==O.PROCESSED?this.callOrcApi(e,o+1):(a.processStatus=O.PROCESSING,void this.sAztDigitalizeService.digitalizeData(a,r=>{this.processStatusObj={loading:!0,errorMessage:r,mustShowErrorBox:!1}},r=>{a.processStatus=O.PROCESS_ERROR,this.replaceCurrentObj(a),this.callOrcApi(e,o+1)},r=>{a={...r,processStatus:O.PROCESSED},this.replaceCurrentObj(a),this.callOrcApi(e,o+1)}));this.processStatusObj.loading=!1}replaceCurrentObj(e){let o=this.objs.find(n=>n.position==e.position);null!=o&&(Object.assign(o,e),o.position==this.currentObj?.position&&Object.assign(this.currentObj,e))}chooseImages(e){let o=e.map(n=>n.position);this.objs.forEach(n=>n.isSelected=!!o.includes(n.position)||n.isSelected),this.totalSelected=this.objs.filter(n=>n.isSelected).length}processImage(e){let o=this.objs.find(n=>n.position==e.position);o&&(this.currentObj=o)}showChooseLayout(){this.currentLayout=T.CHOOSE_IMAGES}changeObj(e){let o=this.objs.find(n=>n.position==e.position);o&&(o={...e})}uploadData(e){this.objs=e.map((o,n)=>({image:o,htmlResult:"",position:n+1,isSelected:!1,processStatus:O.NONE}))}downloadData(e){let o=new Date,n="";if(this.objs.forEach(a=>{n+=`<page [page]='${a.position}'/>`+(a.processStatus==O.PROCESSED?a.htmlResult:"")}),n=this.commonService.decodeHtmlEntities(n),"html"!=e)n=this.commonService.convertDollarDollarToLatexTag(n),this.commonService.loadAzotaDocxJs().then(()=>{azotaDocx.textToDocxBinary(n,null).then(a=>{let r=`azota-digitalize-book-${o.getDate()}${o.getMonth()+1}${o.getFullYear()}-${o.getTime()}.docx`;const c=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});c&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(c),r)}).catch(a=>{this.showErrorSnack(a)})}).catch(a=>{this.showErrorSnack(a)});else{let a=`azota-digitalize-book-${o.getDate()}${o.getMonth()+1}${o.getFullYear()}-${o.getTime()}.html`;const r=new Blob([n],{type:"text/plain"});r&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(r),a)}}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_book",description:"lang_cms_admin_common_digitalize_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(){super(),this.sAztDigitalizeService=(0,t.f3M)(Q),this.processStatusObj={loading:!1,errorMessage:"",mustShowErrorBox:!1},this.headerBackTo="",this.objs=[],this.totalSelected=0,this.currentLayout=T.CHOOSE_IMAGES,this.allLayouts=T,this.allProcessStatuses=O}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-digitalize-book"]],features:[t.qOj],decls:5,vars:3,consts:[[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],["doneLoading",""],[3,"currentStatusObj"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-3"],[1,"box","p-3","mb-3","grid","grid-cols-12","gap-2"],[1,"col-span-12"],[3,"uploadData",4,"ngIf"],["class","btn btn-primary-soft w-full",3,"click",4,"ngIf"],[1,"col-span-6"],[1,"btn","btn-primary","w-full",3,"click"],["class","box p-3",4,"ngIf"],[1,"col-span-9"],[4,"ngIf"],[3,"uploadData"],[1,"btn","btn-primary-soft","w-full",3,"click"],[1,"box","p-3"],[3,"objs","chooseImages",4,"ngIf"],[3,"objs","currentObj","processImage",4,"ngIf"],[3,"objs","chooseImages"],[3,"objs","currentObj","processImage"],[4,"ngIf","ngIfElse"],["notSelectAnyObj",""],[1,"mb-3","btn","btn-pending",3,"click"],[3,"obj","changeObj"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"currentStatusObj","customText"]],template:function(e,o){if(1&e&&(t.TgZ(0,"teacher-layout",0)(1,"div",1),t.YNc(2,xt,1,1,"azt-loading-effect",2),t.YNc(3,Jt,20,11,"ng-template",null,3,t.W1O),t.qZA()()),2&e){const n=t.MAs(4);t.Q6J("headerBackToLink",o.headerBackTo),t.xp6(2),t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",n)}},dependencies:[m.O5,B.l,G._,mt,dt,Ct,St,h.JV],encapsulation:2}),i})()}]}];let Nt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[C.Bz.forChild(Rt),C.Bz,J.fQ]}),i})(),Lt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[{provide:v.f8,useValue:Z.N.azt_tiny_mce_script_src}],imports:[C.Bz,m.ez,_.u5,v.Z_,S.j,_.UX,Nt,x.W,w.Z,f.kb,E.d,d.qyJ.pick(d.ciZ),z.l1,A.QG]}),i})()}}]);