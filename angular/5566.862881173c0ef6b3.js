"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[5566],{59702:(yt,Oe,v)=>{v.d(Oe,{Q:()=>Ge});var l=v(89163),d=v(33887),c=v(48891),m=v(85969),w=v(41891),C=v(27842),H=v(54460),y=v(47712),ie=v(18718),U=v(2915),k=v(69135),j=v(52811),$=v(15343),se=v(76975);const Pe=(he,Ke)=>({"bg-info text-white":he,"bg-slate-300":Ke}),Z=()=>({"text-pending":!0});function B(he,Ke){if(1&he&&c.eu8(0,5),2&he){c.XpG();const X=c.sdS(5);c.Y8G("ngTemplateOutlet",X)}}function I(he,Ke){if(1&he&&c.eu8(0,5),2&he){c.XpG();const X=c.sdS(3);c.Y8G("ngTemplateOutlet",X)}}function q(he,Ke){if(1&he&&(c.j41(0,"div",7),c.nrm(1,"azt-loading-effect",8),c.k0s()),2&he){const X=c.XpG(2);c.R7$(),c.Y8G("currentStatusObj",X.statusObj)}}function _e(he,Ke){1&he&&c.nrm(0,"azt-loading-ui",15)}function xe(he,Ke){if(1&he){const X=c.RV6();c.j41(0,"div",9),c.nrm(1,"iframe",10),c.nI1(2,"safe"),c.j41(3,"div",11)(4,"button",12),c.bIt("click",function(){c.eBV(X);const Be=c.XpG(2);return c.Njj(Be.handleCloseDialog())}),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s(),c.j41(7,"button",13),c.bIt("click",function(){c.eBV(X);const Be=c.XpG(2);return c.Njj(Be.orderBuyExam())}),c.DNE(8,_e,1,0,"azt-loading-ui",14),c.j41(9,"span"),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()()}if(2&he){let X;const oe=c.XpG(2);c.R7$(),c.Y8G("src",c.bMT(2,5,null!==(X=oe.showIframeInContent)&&void 0!==X?X:""),c.f$h),c.R7$(4),c.SpI(" ",c.bMT(6,7,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",oe.statusObj.loading),c.R7$(),c.Y8G("ngIf",oe.statusObj.loading),c.R7$(2),c.JRh(c.bMT(11,9,"lang_payment_confirm_payment_button"))}}function Ee(he,Ke){if(1&he&&c.DNE(0,q,2,1,"div",6)(1,xe,12,11,"ng-template",null,2,c.C5r),2&he){const X=c.sdS(2),oe=c.XpG();c.Y8G("ngIf",oe.statusObj.loading)("ngIfElse",X)}}function ue(he,Ke){if(1&he&&c.nrm(0,"azt-loading-effect",8),2&he){const X=c.XpG(2);c.Y8G("currentStatusObj",X.statusObj)}}function De(he,Ke){if(1&he){const X=c.RV6();c.j41(0,"div",40)(1,"div",41),c.bIt("click",function(){const Be=c.eBV(X).$implicit,we=c.XpG(3);return c.Njj(we.chooseCombo(Be))}),c.j41(2,"div",40),c.EFF(3),c.k0s(),c.j41(4,"div",42)(5,"div",43),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s(),c.j41(8,"div",44),c.EFF(9),c.nI1(10,"formatMoney"),c.k0s()()()()}if(2&he){const X=Ke.$implicit,oe=c.XpG(3);c.R7$(),c.Y8G("ngClass",c.l_i(9,Pe,(null==oe.currentComboObj?null:oe.currentComboObj.id)==X.id,(null==oe.currentComboObj?null:oe.currentComboObj.id)!=X.id)),c.R7$(2),c.JRh(X.name),c.R7$(3),c.Lme("",X.items.length," ",c.bMT(7,5,"lang_payment_total_exam_in_combo"),""),c.R7$(3),c.JRh(c.bMT(10,7,X.price)+" VND")}}function Se(he,Ke){if(1&he&&(c.qex(0),c.j41(1,"div",47)(2,"div",48),c.nrm(3,"lucide-icon",49),c.k0s(),c.j41(4,"div",50)(5,"div",51,3),c.EFF(7),c.k0s()()(),c.bVm()),2&he){const X=Ke.$implicit,oe=c.sdS(6);c.R7$(3),c.Y8G("ngClass",c.lJ4(5,Z)),c.R7$(2),c.FS9("matTooltip",X.name),c.Y8G("isDisabledTooltip",!1)("matTooltipDisabled",oe.isDisabled),c.R7$(2),c.SpI(" ",X.name," ")}}function Xe(he,Ke){if(1&he&&(c.j41(0,"div",45),c.DNE(1,Se,8,6,"ng-container",46),c.k0s()),2&he){const X=c.XpG(3);c.R7$(),c.Y8G("ngForOf",X.currentComboObj.items)}}function Ve(he,Ke){1&he&&c.nrm(0,"azt-loading-ui",15)}function mt(he,Ke){if(1&he){const X=c.RV6();c.j41(0,"azt-mat-dialog-content",18)(1,"div",19)(2,"div"),c.DNE(3,De,11,12,"div",20),c.k0s(),c.DNE(4,Xe,2,1,"div",21),c.j41(5,"div",22)(6,"div",23),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.j41(9,"div",24)(10,"div",25)(11,"div",26)(12,"div",27),c.nrm(13,"img",28),c.nI1(14,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(15,"div",26)(16,"div",27),c.nrm(17,"img",29),c.nI1(18,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(19,"div",26)(20,"div",27),c.nrm(21,"img",30),c.nI1(22,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(23,"div",26)(24,"div",27),c.nrm(25,"img",31),c.nI1(26,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(27,"div",26)(28,"div",27),c.nrm(29,"img",32),c.nI1(30,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(31,"div",26)(32,"div",27),c.nrm(33,"img",33),c.nI1(34,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(35,"div",26)(36,"div",27),c.nrm(37,"img",34),c.nI1(38,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(39,"div",26)(40,"div",27),c.nrm(41,"img",35),c.nI1(42,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(43,"div",26)(44,"div",27),c.nrm(45,"img",36),c.nI1(46,"convertCdnLinkOfGitHub"),c.k0s()(),c.j41(47,"div",26)(48,"div",27),c.nrm(49,"img",37),c.nI1(50,"convertCdnLinkOfGitHub"),c.k0s()()()()()()(),c.j41(51,"div",38)(52,"div",39)(53,"button",12),c.bIt("click",function(){c.eBV(X);const Be=c.XpG(2);return c.Njj(Be.handleCloseDialog())}),c.EFF(54),c.nI1(55,"mytranslate"),c.k0s(),c.j41(56,"button",13),c.bIt("click",function(){c.eBV(X);const Be=c.XpG(2);return c.Njj(Be.orderBuyExam())}),c.DNE(57,Ve,1,0,"azt-loading-ui",14),c.j41(58,"span"),c.EFF(59),c.nI1(60,"mytranslate"),c.k0s()()()()}if(2&he){const X=c.XpG(2);c.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 90px)"),c.R7$(3),c.Y8G("ngForOf",X.comboObjs),c.R7$(),c.Y8G("ngIf",X.currentComboObj),c.R7$(3),c.SpI(" ",c.bMT(8,18,"lang_payment_supported_payment_methods")," "),c.R7$(6),c.Y8G("src",c.bMT(14,20,"images/method-payment/vnpay_full.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(18,22,"images/method-payment/vietcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(22,24,"images/method-payment/techcombank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(26,26,"images/method-payment/vietinbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(30,28,"images/method-payment/mbbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(34,30,"images/method-payment/agribank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(38,32,"images/method-payment/bidv.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(42,34,"images/method-payment/acb.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(46,36,"images/method-payment/hdbank.svg"),c.B4B),c.R7$(4),c.Y8G("src",c.bMT(50,38,"images/method-payment/vpbank.svg"),c.B4B),c.R7$(5),c.SpI(" ",c.bMT(55,40,"lang_payment_confirm_payment_buy_later")," "),c.R7$(2),c.Y8G("disabled",X.statusObj.loading),c.R7$(),c.Y8G("ngIf",X.statusObj.loading),c.R7$(2),c.JRh(c.bMT(60,42,"lang_payment_confirm_payment_button"))}}function pe(he,Ke){if(1&he&&(c.j41(0,"div",16),c.DNE(1,ue,1,1,"azt-loading-effect",17)(2,mt,61,44,"ng-template",null,2,c.C5r),c.k0s()),2&he){const X=c.sdS(3),oe=c.XpG();c.R7$(),c.Y8G("ngIf",oe.statusObj.loading)("ngIfElse",X)}}let Ge=(()=>{var he;class Ke extends d._{handleCloseDialog(){this.dialogRef.close(!1)}chooseCombo(oe){this.currentComboObj=oe}orderBuyExam(){if(!this.currentComboObj)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.initStatusObj();let oe="userRole=student&productType=exam&backTo="+encodeURIComponent(this.commonService.getCurrentUrlWithoutLocale());this.waitDestroy(this.productOrderService.apiProductOrderBuyExamByMoneyGet(this.commonService.getCurrentHostName(),this.commonService.getCurrentLang(),this.currentComboObj.id,oe).subscribe(Be=>{if(!Be.success)return this.errorStatusObj(Be.message,!0);window.location.href=Be.data?.value??""}))}initData(){this.initStatusObj(),this.waitDestroy(this.comboPackageService.apiComboPackageListComboPackagesByExamHashIdGet(this.data.examObj.hashId??"").subscribe(oe=>oe.success?oe.data?.objs?.length?(this.comboObjs=oe.data?.objs??[],this.currentComboObj=this.commonService.getFirstOfArray(this.comboObjs),this.showIframeInContent=this.currentComboObj?.description,this.stopStatusObj(),void(this.showIframeInContent&&this.sAztAzotaTrackingService.sendForceCustomEvent("PAYMENT_VIEW_IFRAME_CONTENT",[]))):this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0):this.errorStatusObj(oe.message,!0)))}setViewport(){const oe=document.createElement("meta");oe.name="viewport",oe.setAttribute("id","viewPortIframe");const Be=fe=>{oe.setAttribute("content",fe),document.head.appendChild(oe)},we=window.innerWidth;if(we<768){const lt=420!==we?we/420:1;Be(`width=420, user-scalable=no, initial-scale=${lt}, minimum-scale=${lt}, maximum-scale=${lt}`)}else Be("width=960, user-scalable=no, initial-scale=1.0")}removeViewPort(){document.getElementById("viewPortIframe")?.remove()}ngOnInit(){super.ngOnInit(),this.initData(),this.setViewport()}constructor(oe,Be,we,W,fe){super(Be,oe),this.dialogRef=oe,this.data=Be,this.productOrderService=we,this.comboPackageService=W,this.sAztAzotaTrackingService=fe,this.comboObjs=[],this.showIframeInContent=void 0}ngOnDestroy(){this.removeViewPort()}}return(he=Ke).\u0275fac=function(oe){return new(oe||he)(c.rXU(l.CP,8),c.rXU(l.Vh,8),c.rXU(m.Hg),c.rXU(w.E),c.rXU(C.M))},he.\u0275cmp=c.VBU({type:he,selectors:[["payment-dialog"]],features:[c.Vt3],decls:6,vars:2,consts:[["showIframeContent",""],["showListExamContent",""],["doneLoading",""],["c","isDisabled"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet"],["class","box py-4 px-4",4,"ngIf","ngIfElse"],[1,"box","py-4","px-4"],[3,"currentStatusObj"],[1,"bg-white",2,"height","100%"],["width","100%",2,"height","calc(var(--vh, 1vh) * 100 - 70px)",3,"src"],[1,"text-center","mt-4","text-center","absolute","bottom-2","w-full"],[1,"btn","btn-secondary-soft","w-32","mr-4","btn-lg","text-xl",3,"click"],[1,"btn","btn-primary","btn-lg","text-xl",3,"click","disabled"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"box","py-4","px-4",2,"height","100%"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"minHeight"],[2,"margin-right","-5px"],["class","pb-2",4,"ngFor","ngForOf"],["class","box border border-slate-200 dark:border-darkmode-400 pt-2",4,"ngIf"],[1,"mt-4"],[1,"font-medium"],[1,"mt-2"],[1,"grid","grid-cols-10","gap-4"],[1,"col-span-5","md:col-span-2","flex","justify-center"],[1,"p-1","rounded-lg","border","border-slate-200","dark:border-darkmode-400","w-full","h-full"],["alt","Vnpay",2,"height","100%",3,"src"],["alt","vietcombank",3,"src"],["alt","techcombank",3,"src"],["alt","vietinbank",3,"src"],["alt","mbbank",3,"src"],["alt","agribank",3,"src"],["alt","bidv",3,"src"],["alt","acb",3,"src"],["alt","hdbank",3,"src"],["alt","vpbank",3,"src"],[1,"flex","mt-4"],[1,"ml-auto"],[1,"pb-2"],[1,"clickable","box","pl-2","pr-2","pt-2",3,"click","ngClass"],[1,"pb-2","flex","items-center","font-medium"],[1,"mr-auto"],[1,"text-lg"],[1,"box","border","border-slate-200","dark:border-darkmode-400","pt-2"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-3","border-b","border-slate-200","dark:border-darkmode-400"],[1,"flex-none","image-fit","rounded-md","overflow-hidden"],["name","file-check","size","40",3,"ngClass"],[1,"ml-4","mr-auto"],[2,"line-height","1.2",3,"matTooltip","isDisabledTooltip","matTooltipDisabled"]],template:function(oe,Be){1&oe&&c.DNE(0,B,1,1,"ng-container",4)(1,I,1,1,"ng-container",4)(2,Ee,3,2,"ng-template",null,0,c.C5r)(4,pe,4,2,"ng-template",null,1,c.C5r),2&oe&&(c.Y8G("ngIf",!Be.showIframeInContent),c.R7$(),c.Y8G("ngIf",Be.showIframeInContent))},dependencies:[H.YU,H.Sq,H.bT,H.T3,y.oV,ie.K,U.U,k.f,j.R,$.WGl,se.wp,se.JI,se.gt,se.t0],encapsulation:2}),Ke})()},57081:(yt,Oe,v)=>{v.d(Oe,{w:()=>C});var l=v(48891),d=v(62095),c=v(68774),m=v(50589),w=v(99927);let C=(()=>{var H;class y{_saveSortTypeOfSetting(U){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,U)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(U){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==U}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(U,k){var j=[];return k.forEach($=>{$.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(U,$.results??new Array),j.push($)}),j}_filterExamResultObjsByFilterSettingObjNotInClassroom(U,k){var j=[];if(U.isMarked||U.isNotMarked||U.isOnTest||U.isNotSubmit||U.isNotTested)for(var $ of k){let se=!1,Pe=U.isOnTest||U.isNotSubmit;U.isMarked&&1==$.isMarked&&(!Pe||!(1!=$.status&&($.isMarked||$.isNotMarked)))&&(se=!0),U.isNotMarked&&1==$.isNotMarked&&(!Pe||!(1!=$.status&&($.isMarked||$.isNotMarked)))&&(se=!0),U.isOnTest&&(1==$.isOnTest||0==$.status&&($.isMarked||$.isNotMarked))&&(se=!0),U.isNotTested&&1==$.isNotTested&&(se=!0),U.isNotSubmit&&(1==$.isNotSubmit||-1==$.status&&($.isMarked||$.isNotMarked))&&(se=!0),se&&j.push($)}else j=k;return j}_searchExamResultObjsByFullNameInClassroom(U,k){var j=[];return this.commonService.myClone(U).forEach(se=>{var Pe=this._searchExamResultObjsByFullNameNotInClassroom(se.results??[],k);Pe.length>0&&(se.results=Pe,j.push(se))}),j}_searchExamResultObjsByFullNameNotInClassroom(U,k){k=this.commonService.convertVietnameseToEnglish(k).toLowerCase();var j=[];return U.forEach($=>{-1!=this.commonService.convertVietnameseToEnglish($.fullName??"").toLowerCase().indexOf(k)&&j.push($)}),j}_sortExamResultObjsBySettingObjByClassroom(U,k,j){return"isSortByNameAsc"==j?this.sortService.sortFirstNameStudentsInClass(U):"isSortByTimeDesc"==j?this.sortService.sortTimeStudentsInClass(U,1):"isSortByMarkDesc"==j?this.sortService.sortMarkStudentsInClass(U,1,k):this._sortExamResultObjsBySortTypeOfClassroom(U)}_sortExamResultObjsBySettingObjNotInClassroom(U,k,j){return"isSortByNameAsc"==j?this.sortService.sortFirstNameStudents(U):"isSortByTimeDesc"==j?this.sortService.sortTimeDESC(U):"isSortByMarkDesc"==j?this.sortService.sortMarkDESC(U,k):U}_sortExamResultObjsBySortTypeOfClassroom(U){var k=U.map(j=>({...j}));return k.forEach((j,$)=>{j.results=0==j.classObj?.sortType?this.sortService.sortFirstNameStudents(j.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(j.results??[],"pos","id"),k[$]=j}),k}_changeExamResultStatusForAllClassroom(U,k,j){var $=[];return U.forEach((se,Pe)=>{se.results=this._changeExamResultStatusForOneClassroom(se.results??new Array,k),se={indexCounter:Pe,...se,countSubmitted:j?se.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(se.results??new Array),showOnTab:se.showOnTab},$.push(se)}),$}_changeExamResultStatusForOneClassroom(U,k){var j=[...U];return j.forEach(($,se)=>{$.confirmedAt&&""!=$.confirmedAt&&$.resultId&&$.resultId>0?$.isMarked=!0:$.resultId&&$.resultId>0&&(!$.confirmedAt||""==$.confirmedAt)?$.isNotMarked=!0:$.resultId&&0!=$.resultId||!$.startedTest||""==$.startedTest||0!=$.status?$.resultId&&0!=$.resultId||!$.startedTest||""==$.startedTest||-1!=$.status?null==$.startedTest&&($.isNotTested=!0):$.isNotSubmit=!0:$.isOnTest=!0,j[se]=$}),j.forEach(($,se)=>{$.files&&""!=$.files&&!Array.isArray($.files)&&($.filesParse=this.commonService.myParseJson($.files)),j[se]=$}),j}_countTotalSubmittedOfExamResultObjs(U){var k=0;return U.forEach(j=>{(j.isMarked||j.isNotMarked)&&k++}),k}_counterTotalEssayOfQuestionObjs(U){let k=0;return U.forEach(j=>{this.answerTypeService.isEssayAnswer(j)&&k++}),k}_checkCounterEssayQuestionObjs(U){let k=0;return U.forEach(j=>{j.isEssay&&k++}),k}constructor(U,k,j,$){this.commonService=U,this.sortService=k,this.browserStorageService=j,this.answerTypeService=$,this.sortByStorageKey="exam_list_sort_by"}}return(H=y).\u0275fac=function(U){return new(U||H)(l.KVO(d.R),l.KVO(c.g),l.KVO(m.z),l.KVO(w._))},H.\u0275prov=l.jDH({token:H,factory:H.\u0275fac,providedIn:"root"}),y})()},87515:(yt,Oe,v)=>{v.d(Oe,{h:()=>j});var l=v(10936),d=v(51698),c=v(48891),m=v(62095),w=v(9280),C=v(51913),H=v(41715),y=v(50589),ie=v(79064),U=v(91640),k=v(57081);let j=(()=>{var $;class se{constructor(Z,B,I,q,_e,xe,Ee,ue){this.commonService=Z,this.examPageResultService=B,this.permissionService=I,this.globalService=q,this.browserStorageService=_e,this.gzipHelper=xe,this.homeworkExamService=Ee,this.sAztExamResultListSortService=ue}getTestedUserObjs(Z,B,I){return this.globalService.startIntervalFunc(Z),this.getTestedOfExamResult(Z,B,"default",I)}getTestedLastMark(Z,B,I){return this.globalService.startIntervalFunc(Z),this.getTestedOfExamResult(Z,B,"last",void 0,I)}getTestedHighestMark(Z,B,I){return this.globalService.startIntervalFunc(Z),this.getTestedOfExamResult(Z,B,"highest",void 0,I)}getTestedFirstMark(Z,B,I){return this.globalService.startIntervalFunc(Z),this.getTestedOfExamResult(Z,B,"first",void 0,I)}getTestedAllResult(Z,B,I){return this.globalService.startIntervalFunc(Z),this.getTestedOfExamResult(Z,B,"all",void 0,I)}getTestedOfExamResult(Z,B,I,q,_e){return new d.c(xe=>{let Ee="tested_list_result_v2_"+B,ue=this.browserStorageService.getSimpleSessionStorage(Ee)??"",De=this.gzipHelper.resultContentSupport(ue),Se=De&&this.commonService.willDeleteParseJson(De)?this.commonService.willDeleteParseJson(De):void 0;q&&ue&&Se?(xe.next({status:200,success:1,data:Se,message:"successful"}),xe.complete()):this.examPageResultService.apiExamPageResultGetNewObjV2Post({examId:B,classroomIds:_e}).subscribe(Ve=>{if(1==Ve.success){let pe=Ve.data?.serverSecond??0,Ge=Ve.data?.examObj,he=Ve.data?.classroomWithAvatarAndStudentObjs??new Array,Ke=Ve.data?.totalAttended??0,X=Ve.data?.examQuestionObjs??new Array,oe=Ve.data?.examCreatorObj,Be=Ve.data?.offlineExamObj,we=Ve.data?.hasEssayQuestion,W=Ve.data?.totalQuestion??0,fe=Ve.data?.offlineMixQuestionObjs,lt=Ve.data?.canResetStudentCode,Dt=Ve.data?.hasCreateStudentCode,nt=Ve.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",Ge)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",Ge)?this.getAllExamResultObjs(Z,[],B,"",Et=>{if(Et.hasOwnProperty("success")&&1==Et.success){let Ye=this.mergeStudentWithAvatar(Et.studentWithResultObjs??[]),ft={},Je=[];Ye?.forEach(V=>{let Te=V.parentId??"0";ft.hasOwnProperty(Te)?ft[Te].push(...V.examResultObjs??[]):ft[Te]=V.examResultObjs??[],Je=Je.concat(ft[Te])});let Ne=Ge?this.filterExamResultOnTest(Je,Ge,pe):{},Y=[],ae=[];if(this.homeworkExamService.mustInClassroom(Ge)&&he.length>0)for(let V=0;V<he.length;V++){let Te=he[V].classroomObj;Te.classroomGroup=he[V].classroomGroup;let ve=he[V].studentObjs??[],Ze=[];if(ve.length>0)for(let Re=0;Re<ve.length;Re++){let rt=ve[Re].parentId??"0";this.commonService.isExistInArray(ae,ve[Re].parentId)||ae.push(ve[Re].parentId??"0"),ft.hasOwnProperty(rt)&&(Array.isArray(ve[Re].examResultObjs)||(ve[Re].examResultObjs=[]),ve[Re].examResultObjs=this.findExamResultOfStudent(ft[rt],ve[Re].id??"0"));let st=Ne.hasOwnProperty(ve[Re].parentId??0)?Ne[ve[Re].parentId??0]:0;if("all"==I)if(ve[Re].examResultObjs?.length)ve[Re].examResultObjs?.forEach((ne,We)=>{let Ue=this.commonService.castJsonToObj(JSON.stringify(ne));Ue&&(Ue.resultId=Ue.testStatus&&Ue.testStatus>0?Ue.id:0);let E=this.createStudentWithResult(ve[Re],Ue,st,W,We,ve[Re].examResultObjs?.length??0);Ze.push(E)});else{let ne=this.createStudentWithResult(ve[Re],void 0,st,W,-1,0);Ze.push(ne)}else{let ne=this.filterExamResultByType(ve[Re].examResultObjs??[],I),We=ne.hasOwnProperty(ve[Re].parentId??0)?ne[ve[Re].parentId??0]:void 0,E=this.createStudentWithResult(ve[Re],We,st,W,(We&&null!=We.indexTest&&We.indexTest>=0?We.indexTest:"first"==I?0:(ve[Re].examResultObjs?.length??0)-1)??0,ve[Re].examResultObjs?.length??0);Ze.push(E)}}Y.push({classObj:Te,results:Ze})}let de=[],N=this.commonService.myClone(Ye)??[];for(let V=0;V<N?.length;V++)if(!this.commonService.isExistInArray(ae,N[V].parentId)){let Te=Ne.hasOwnProperty(N[V].parentId??0)?Ne[N[V].parentId??0]:0;if("all"==I)if(N[V].examResultObjs?.length)N[V].examResultObjs?.forEach((ve,Ze)=>{let Re=this.commonService.castJsonToObj(JSON.stringify(ve));Re&&(Re.resultId=Re.testStatus&&Re.testStatus>0?Re.id:0);let rt=this.createStudentWithResult(N[V],Re,Te,W,Ze,N[V].examResultObjs?.length??0);de.push(rt)});else{let ve=this.createStudentWithResult(N[V],void 0,Te,W,-1,0);de.push(ve)}else{let ve=this.filterExamResultByType(N[V].examResultObjs??[],I),Ze=ve.hasOwnProperty(N[V].parentId??0)?ve[N[V].parentId??0]:void 0,rt=this.createStudentWithResult(N[V],Ze,Te,W,(Ze&&null!=Ze?.indexTest&&Ze.indexTest>=0?Ze.indexTest:"first"==I?0:(N[V].examResultObjs?.length??0)-1)??0,N[V].examResultObjs?.length??0);de.push(rt)}}"all"!=I&&de.sort((V,Te)=>this.compareTwoDate(V.createdAt??"",Te.createdAt??""));let S=0;(Y.length||de.length)&&(Y.forEach(V=>{V.results?.forEach(Te=>{let ve=this.getMaxGroupId(Te.groupPoints??[]);S<ve&&(S=ve)})}),de.forEach(V=>{let Te=this.getMaxGroupId(V.groupPoints??[]);S<Te&&(S=Te)})),"export_tool"==Z&&_e?.length&&(Y=Y.filter(V=>this.commonService.isExistInArray(_e,V.classObj?.id)),this.commonService.isExistInArray(_e,-1)||(de=[]));let M={studentsInClassResults:Y.length>0?Y:[],studentsNotInClassResults:de.length>0?de:[],totalAttended:Ke,totalQuestion:W,totalUsers:0,examCreatorObj:oe,offlineMixQuestionObjs:fe,examObj:Ge,hasEssayQuestion:we,offlineExamObj:Be,canResetStudentCode:lt,hasCreateStudentCode:Dt,questionObjs:X,fileTypeStr:nt,errorConfigClassroomPermission:Ve.data?.errorConfigClassroomPermission,errorMessage:Ve.data?.errorMessage,maxGroupId:S};if("export_tool"!=Z){let V=this.gzipHelper.zipBigContent(JSON.stringify(M));this.browserStorageService.saveSimpleSessionStorage(Ee,V)}xe.next({status:200,success:1,data:M,message:"successful"}),xe.complete()}else xe.next({status:Et.code,success:0,data:null,message:Et.message??""}),xe.complete()}):(xe.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:Ke,totalQuestion:W,hasEssayQuestion:we,totalUsers:0,examCreatorObj:oe,offlineMixQuestionObjs:fe,examObj:Ge,offlineExamObj:Be,canResetStudentCode:lt,hasCreateStudentCode:Dt,questionObjs:X,fileTypeStr:Ve.data?.fileTypeStr,errorConfigClassroomPermission:Ve.data?.errorConfigClassroomPermission,errorMessage:Ve.data?.errorMessage,maxGroupId:0},message:"successful"}),xe.complete())}else xe.next({status:Ve.code,success:0,data:null,message:Ve.message??""}),xe.complete()})})}getAllExamResultObjs(Z,B,I,q,_e){this.examPageResultService.apiExamPageResultGetObjsV2Get(I,"test_review"==Z||"export_tool"==Z?"export":"tested_list",q).subscribe(Ee=>{1==Ee.success?(Ee.data?.objs&&B.push(...Ee.data.objs),Ee.data?.nextPage?this.globalService.isStopIntervalFunc(Z)?_e({studentWithResultObjs:B,success:1}):setTimeout(()=>{this.getAllExamResultObjs(Z,B,I,Ee.data?.nextPage??"",_e)},300):_e({studentWithResultObjs:B,success:1})):_e({code:Ee.code,studentWithResultObjs:[],success:0,message:Ee.message??""})})}compareTwoDate(Z,B){var I=new Date(Z).getTime();I=isNaN(I)?0:I;var q=new Date(B).getTime();return I-(q=isNaN(q)?0:q)>0?1:I-q<0?-1:0}filterExamResultOnTest(Z,B,I){var q={};return Z.forEach(_e=>{var xe=this.commonService.myClone(_e)??{};if(xe.testStatus)q[xe.userId??0]=xe.testStatus;else if(xe.startedTest&&I)if(B.endTime){var Ee=Math.floor(new Date(B.endTime).getTime()/1e3);q[xe.userId??0]=I<=Ee+60*(B.minutes??0)+600?0:-1}else{var ue=xe.startedTest?Math.floor(new Date(xe.startedTest).getTime()/1e3):0;q[xe.userId??0]=I<=ue+86400?0:-1}else q[xe.userId??0]=0}),q}filterExamResultByType(Z,B){var I={};if(Z.length>1)Z.forEach((_e,xe)=>{var Ee=this.commonService.myClone(_e);_e.testStatus&&(Ee.resultId=Ee.id,Ee.indexTest=xe,"default"==B&&(I[Ee.userId??0]=Ee),"last"==B&&(I[Ee.userId??0]=Ee),"first"==B&&(I.hasOwnProperty(Ee.userId??0)||(I[Ee.userId??0]=Ee)),"highest"==B)&&(I.hasOwnProperty(Ee.userId??0)?(I[Ee.userId??0].mark??-1)<=(Ee.mark??-1)&&(I[Ee.userId??0]=Ee):I[Ee.userId??0]=Ee)});else{var q=this.commonService.myClone(Z[0]??{});q.resultId=q.testStatus?q.id:0,q.indexTest=0,I[q.userId??0]=q}return I}findExamResultOfStudent(Z,B){var I=[];return Z.forEach(q=>{(q.studentId==B||null==q.studentId)&&I.push(q)}),I}addResultIdToExamResult(Z){var B=[];return Z.forEach(I=>{var q=this.commonService.myClone(I)??{};q.resultId=q.id,q.testStatus&&B.push(q)}),B}compareLengthWithExamQuestion(Z,B){var I=this.commonService.myClone(Z);if(B>0&&Z.length<B)for(var q=0;q<B-Z.length;q++)I.push("");return I}mergeStudentWithAvatar(Z){var B=[];return Z.forEach(I=>{var q=B.filter(xe=>xe.parentId==I.parentId);if(q&&0!=q.length)for(var _e=0;_e<B.length;_e++)B[_e].parentId==I.parentId&&(B[_e].examResultObjs=B[_e].examResultObjs?.concat(I.examResultObjs??[]));else B.push(I)}),B}createStudentWithResult(Z,B,I,q,_e,xe){return{id:Z.id,userId:Z.parentId,studentId:Z.id,identificationNumber:B?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??Z.identificationNumber??0,offlineMixQuestionHashId:B?.offlineMark?.rawOfflineMixquestionId??0,studentCode:B?.offlineMark?.studentCode??0,gender:Z.gender,fullName:Z.fullName,avatar:Z.avatar,birthday:Z.birthday,resultId:B?.hasOwnProperty("resultId")?B.resultId:0,answers:B?.hasOwnProperty("answers")?B.answers:null,rightAnswer:B?.hasOwnProperty("rightAnswer")?B.rightAnswer:0,totalQuestion:B?.hasOwnProperty("totalQuestion")?B.totalQuestion:0,mark:B?.hasOwnProperty("mark")?B?.mark:null,trueFalseMark:B?.hasOwnProperty("trueFalseMark")?B.trueFalseMark:null,essayMark:B?.hasOwnProperty("essayMark")?B.essayMark:null,files:B?.hasOwnProperty("files")?B.files:null,infors:B?.hasOwnProperty("infors")?B?.infors:null,confirmedAt:B?.hasOwnProperty("confirmedAt")?B?.confirmedAt:null,startedTest:B?.hasOwnProperty("startedTest")?B?.startedTest:null,createdAt:B?.hasOwnProperty("createdAt")?B.createdAt:null,totalExamResultObjs:Z.examResultObjs.length,answeredQuestions:B?.hasOwnProperty("answeredQuestions")?B.answeredQuestions:[],groupPoints:this.getGroupPoints(B?.answeredQuestions?B?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:B?.examTrackObj?.exitFullScreen,blurCount:B?.examTrackObj?.blurWindow},status:I,nameImages:Z.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion(B?.answerMixObjs??[],q)??[],testedTime:_e+1,totalTestTime:xe,subjectMarkValues:B?.subjectMarks,isOffline:B?.isOffline??!1,countEssayQuestion:this.sAztExamResultListSortService._checkCounterEssayQuestionObjs(B?.hasOwnProperty("answeredQuestions")&&B?.answeredQuestions?B.answeredQuestions:[]),checkBoxGroupControl:new l.gE({isShow:new l.MJ(!1,{nonNullable:!0}),selectedCheckbox:new l.MJ(!1,{nonNullable:!0})}),questionTypeMarks:B?.questionTypeMarks??[],schoolName:Z.schoolName??"",phone:Z.phone??"",email:Z.email??"",userName:Z?.userName??""}}getGroupPoints(Z){let B=[];return Z.forEach(I=>{let q=!1;for(let _e=0;_e<B.length;_e++)B[_e].id==I.groupId&&(q=!0,B[_e].point+=I.correct&&I.scorePerQuestion?I.scorePerQuestion:0);!q&&I.groupId&&B.push({id:I.groupId,point:I.correct&&I.scorePerQuestion?I.scorePerQuestion:0})}),B.sort((I,q)=>(I.id??0)-(q.id??0)),B}getMaxGroupId(Z){let B=[];return Z.forEach(I=>{I.id&&!this.commonService.isExistInArray(B,I.id)&&B.push(I.id)}),B.length}}return($=se).\u0275fac=function(Z){return new(Z||$)(c.KVO(m.R),c.KVO(w.TE),c.KVO(C.p),c.KVO(H.r),c.KVO(y.z),c.KVO(ie.f),c.KVO(U.Z),c.KVO(k.w))},$.\u0275prov=c.jDH({token:$,factory:$.\u0275fac,providedIn:"root"}),se})()},32835:(yt,Oe,v)=>{v.d(Oe,{i:()=>d});var l=v(48891);let d=(()=>{var c;class m{processData(C){let H=[],y=[];if(C)for(var ie=0;ie<C.length;ie++)if("scroll"!=C[ie][0]){var U={index:C[ie][0],alpha:C[ie][1],key:C[ie][2],questionId:Number(C[ie][3]),second:Number(C[ie][4])};H.push(U)}else{var k={scrollPos:Number(C[ie][1]),second:Number(C[ie][2])};y.push(k)}return[H,y]}}return(c=m).\u0275fac=function(C){return new(C||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),m})()},97099:(yt,Oe,v)=>{v.d(Oe,{B:()=>Pe});var l=v(54460),d=v(10936),c=v(65162),m=v(53220),w=v(81275),C=v(15343),H=v(59055),y=v(44233),ie=v(5502),U=v(21656),k=v(70050),j=v(76407),$=v(91100),se=v(48891);let Pe=(()=>{var Z;class B{}return(Z=B).\u0275fac=function(q){return new(q||Z)},Z.\u0275mod=se.$C({type:Z}),Z.\u0275inj=se.G2t({imports:[l.MD,U.s,$.Q,k.L,d.YN,d.X1,ie.Id,m.h,c.iI,C.flO.pick(C.Ptg),w.rc,H.e,j.n,y.An]}),B})()},54479:(yt,Oe,v)=>{v.d(Oe,{t:()=>Ne});var l=v(73014),d=v(27691),c=v(48891),m=v(10936),w=v(59640),C=v(30657),H=v(64198),y=v(83229),ie=v(40949),U=v(35095),k=v(41426),j=v(51113),$=v(54460),se=v(47712),Pe=v(7919),Z=v(81587),B=v(84278),I=v(34815),q=v(15343),_e=v(58588),xe=v(76975);const Ee=["mnoteContainer"],ue=["aztMarkNote"],De=Y=>({display:Y}),Se=Y=>({border:Y}),Xe=()=>({"mr-1 cursor-pointer":!0}),Ve=Y=>({"is-invalid":Y});function mt(Y,ae){1&Y&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&Y&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function pe(Y,ae){1&Y&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&Y&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Ge(Y,ae){1&Y&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&Y&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function he(Y,ae){if(1&Y&&(c.j41(0,"div",19),c.DNE(1,mt,3,3,"span",10)(2,pe,3,3,"span",10)(3,Ge,3,3,"span",10),c.k0s()),2&Y){const de=c.XpG().index,N=c.XpG();c.R7$(),c.Y8G("ngIf",null==N.form.controls["cau"+de].errors?null:N.form.controls["cau"+de].errors.min),c.R7$(),c.Y8G("ngIf",null==N.form.controls["cau"+de].errors?null:N.form.controls["cau"+de].errors.max),c.R7$(),c.Y8G("ngIf",null==N.form.controls["cau"+de].errors?null:N.form.controls["cau"+de].errors.pattern)}}function Ke(Y,ae){if(1&Y){const de=c.RV6();c.j41(0,"div",12)(1,"div",13)(2,"lucide-icon",14),c.nI1(3,"mytranslate"),c.bIt("click",function(S){const M=c.eBV(de).index,V=c.XpG();return c.Njj(V.toggleVisibility(S,M))}),c.k0s(),c.j41(4,"span",15),c.EFF(5),c.nI1(6,"mytranslate"),c.j41(7,"span",16),c.nI1(8,"mytranslate"),c.EFF(9),c.nI1(10,"mytranslate"),c.k0s()(),c.nrm(11,"input",17),c.nI1(12,"mytranslate"),c.k0s(),c.DNE(13,he,4,3,"div",18),c.k0s()}if(2&Y){let de;const N=ae.$implicit,S=ae.index,M=c.XpG();c.Y8G("ngStyle",c.eq3(25,Se,S==M.questions.length-1?"none":"")),c.R7$(2),c.FS9("matTooltip",c.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),c.Y8G("ngClass",c.lJ4(27,Xe)),c.R7$(3),c.Lme(" ",c.bMT(6,17,"lang_auto_cau")," ",(null!==(de=N.indexLabel)&&void 0!==de?de:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",N.essMaxPoint," ",c.bMT(10,21,"lang_auto_diem_brackets"),""),c.R7$(2),c.FS9("placeholder",c.bMT(12,23,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",S,""),c.Y8G("readonly",!M.showForTeacher)("decimal",!0)("ngClass",c.eq3(28,Ve,M.form.controls["cau"+S]&&M.form.controls["cau"+S].invalid)),c.R7$(2),c.Y8G("ngIf",M.form.controls["cau"+S].errors)}}function X(Y,ae){if(1&Y){const de=c.RV6();c.j41(0,"div",20)(1,"button",21),c.bIt("click",function(){c.eBV(de);const S=c.XpG();return c.Njj(S.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&Y){const de=c.XpG();c.R7$(),c.Y8G("disabled",de.isLoading||de.form.invalid||de.loadingDataCdn&&de.files.length>0),c.R7$(),c.SpI(" ",de.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}function oe(Y,ae){if(1&Y&&c.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Y){let de;const N=c.XpG().$implicit,S=c.XpG();c.Y8G("follower",S.followerRenderQuest)("examObj",S.examObj)("examConfig",S.examConfig)("questionObj",N)("curQuestionIndex",null!==(de=N.indexLabel)&&void 0!==de?de:0)("userAnswersObj",S.userAnswersObj)("currentTab","essay_tab")}}function Be(Y,ae){if(1&Y&&c.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Y){let de;const N=c.XpG().$implicit,S=c.XpG();c.Y8G("follower",S.followerRenderQuest)("examObj",S.examObj)("questionObj",N)("curQuestionIndex",null!==(de=N.indexLabel)&&void 0!==de?de:0)("userAnswersObj",S.userAnswersObj)("orgExamObjs",S.orgExamObjs)("currentTab","essay_tab")}}function we(Y,ae){1&Y&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&Y&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function W(Y,ae){1&Y&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&Y&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function fe(Y,ae){1&Y&&(c.j41(0,"span"),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&Y&&(c.R7$(),c.SpI(" ",c.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function lt(Y,ae){if(1&Y&&(c.j41(0,"div",19),c.DNE(1,we,3,3,"span",10)(2,W,3,3,"span",10)(3,fe,3,3,"span",10),c.k0s()),2&Y){const de=c.XpG(2).index,N=c.XpG();c.R7$(),c.Y8G("ngIf",null==N.form.controls["cau"+de].errors?null:N.form.controls["cau"+de].errors.min),c.R7$(),c.Y8G("ngIf",null==N.form.controls["cau"+de].errors?null:N.form.controls["cau"+de].errors.max),c.R7$(),c.Y8G("ngIf",null==N.form.controls["cau"+de].errors?null:N.form.controls["cau"+de].errors.pattern)}}function Dt(Y,ae){if(1&Y&&(c.j41(0,"div",29)(1,"form",30)(2,"label",31),c.EFF(3),c.nI1(4,"mytranslate"),c.j41(5,"span",16),c.nI1(6,"mytranslate"),c.EFF(7),c.nI1(8,"mytranslate"),c.k0s(),c.EFF(9," : "),c.k0s(),c.nrm(10,"input",32),c.nI1(11,"mytranslate"),c.DNE(12,lt,4,3,"div",18),c.k0s()()),2&Y){let de;const N=c.XpG(),S=N.$implicit,M=N.index,V=c.XpG();c.R7$(),c.Y8G("formGroup",V.form),c.R7$(),c.FS9("for","cau_"+M),c.R7$(),c.Lme(" ",c.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(de=S.indexLabel)&&void 0!==de?de:0)+1," "),c.R7$(2),c.FS9("matTooltip",c.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),c.R7$(2),c.Lme("(",S.essMaxPoint," ",c.bMT(8,19,"lang_auto_diem_brackets"),""),c.R7$(3),c.FS9("placeholder",c.bMT(11,21,"lang_auto_nhap_diem")),c.Mz_("formControlName","cau",M,""),c.Y8G("readonly",!V.showForTeacher)("ngClass",c.eq3(23,Ve,V.form.controls["cau"+M]&&V.form.controls["cau"+M].invalid))("id","cau_"+M)("decimal",!0),c.R7$(2),c.Y8G("ngIf",V.form.controls["cau"+M].errors)}}function nt(Y,ae){if(1&Y&&(c.j41(0,"div",22)(1,"div",23),c.DNE(2,oe,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,Be,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,Dt,13,25,"div",26),c.k0s()()),2&Y){const de=ae.index,N=c.XpG();c.R7$(),c.Mz_("id","q_",de,""),c.R7$(),c.Y8G("ngIf",!N.showForTeacher),c.R7$(),c.Y8G("ngIf",N.showForTeacher),c.R7$(),c.Y8G("ngIf",N.showForTeacher)}}function Et(Y,ae){1&Y&&(c.j41(0,"div",33)(1,"b"),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s(),c.EFF(4),c.nI1(5,"mytranslate"),c.k0s()),2&Y&&(c.R7$(2),c.SpI("",c.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),c.R7$(2),c.SpI(" ",c.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Ye(Y,ae){if(1&Y){const de=c.RV6();c.j41(0,"azt-mark-note",35,1),c.bIt("doneLoadData",function(S){c.eBV(de);const M=c.XpG(2);return c.Njj(M.doneLoadData(S))}),c.k0s()}if(2&Y){const de=c.XpG(2);c.Y8G("dataMarkNote",de.dataMarkNote)("screenType","exam")("modeView",de.showForTeacher?"teacher":"student")}}function ft(Y,ae){if(1&Y&&(c.qex(0),c.DNE(1,Ye,2,3,"azt-mark-note",34),c.bVm()),2&Y){const de=c.XpG();c.R7$(),c.Y8G("ngIf",1===de.curSelectedTab||de.changeSelectedTab)}}function Je(Y,ae){if(1&Y){const de=c.RV6();c.j41(0,"div",36)(1,"button",37),c.bIt("click",function(){c.eBV(de);const S=c.XpG();return c.Njj(S.saveDataMarkExercise())}),c.EFF(2),c.nI1(3,"mytranslate"),c.nI1(4,"mytranslate"),c.k0s()()}if(2&Y){const de=c.XpG();c.R7$(),c.Y8G("disabled",de.isLoading||de.form.invalid||de.loadingDataCdn&&de.files.length>0),c.R7$(),c.SpI(" ",de.isLoading?c.bMT(3,2,"lang_auto_dang_luu_doing"):c.bMT(4,4,"lang_auto_luu_diem")," ")}}let Ne=(()=>{var Y;class ae extends w.H{getMaxPoint(N){var S=0;for(let M=0;M<this.questions.length;M++)if(this.questions[M].id==N){S=this.questions[M].scorePerQuestion??0;break}return S}toggleVisibility(N,S){var M=N.target,V=document.getElementById(`q_${S}`);V&&("block"==V?.style.display?(V.style.display="none",M&&(M.textContent="visibility_off")):(V.style.display="block",M&&(M.textContent="visibility")))}remark(N){for(const V in this.form.value)"string"==typeof this.form.value[V]&&this.form.value[V].includes(",")&&(this.form.value[V]=this.form.value[V].replace(",","."));let S=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var M={id:this.resultID,result:N,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(M,S).subscribe(V=>{1==V.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(V.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}initDataMarkNote(){if(this.examResultObj.result)this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId};else{for(let N=0;N<this.files.length;N++)this.files[N].url=this.cdnService.getMyCdn(this.files[N].url??"");this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)}}}saveDataMarkExercise(){var N=this;return(0,l.A)(function*(){let S=!1;for(const M in N.form.value)""!==N.form.value[M]&&(S=!0);if(S){for(const M in N.form.value)""===N.form.value[M]&&(N.form.value[M]=0,N.form.controls[M].setValue(0));if(N.isLoading=!0,N.files&&N.files.length>0){N.objectResult=N.MarkNote?.exportDataMarkNote();let M=!1;if(!N.objectResult.pages?.length&&N.files.find(V=>(0,H.nL)(V.mimes??"")||(0,H.rl)(V.mimes??"")))return void N.remark("");if(N.objectResult.pages?.length){for(let Re=0;Re<N.objectResult.pages.length;Re++)if(N.objectResult.pages[Re]&&N.objectResult.pages[Re].draws?.length)for(let rt=0;rt<(N.objectResult.pages[Re].draws?.length??0);rt++){let st=N.objectResult.pages[Re].draws?.[rt]??{};st.src&&st.src.includes("base64")&&(M=!0)}M&&(yield N.uploadDrawBase64ToCdn());const V=N.serializeJson(N.objectResult),Te=N.zipDataService.convertContentGzip(V),ve=new Blob([Te],{type:"text/plain"}),Ze=new File([ve],"txt",{type:"text/plain"});N.apiUploadService.uploadToCdnForHomework(Ze).subscribe(Re=>{1==Re.success?N.remark(N.serializeJson({urlDataMark:Re.data?.url??"",version:"0.1"})):N.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai")})}}else N.remark("")}else N.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan")})()}uploadDrawBase64ToCdn(){return new Promise(N=>{let S=[];if(this.objectResult.pages){this.objectResult.pages.forEach(M=>{S.push(!1)});for(let M=0;M<this.objectResult.pages.length;M++)if(this.objectResult.pages[M]&&this.objectResult.pages[M].draws?.length)for(let V=0;V<(this.objectResult.pages[M].draws?.length??0);V++){let Te=this.objectResult.pages[M].draws?.[V]??{};if(Te.src&&Te.src.includes("base64")){S[M]=!0;let ve=(0,y.q)(Te.src);this.apiUploadService.commonUploadForMarkResult(ve,`essay_note_${M}_${V}_${this.resultID}.png`,"image/png").subscribe(Ze=>{Ze.type!=d.hv.UploadProgress&&(Te.src=Ze.data?.url,S[M]=!1),S.includes(!0)||N()})}}}})}doneLoadData(N){this.loadingDataCdn=!1}ngOnInit(){this.initDataMarkNote();var N={};let S;this.examResultObj.confirmedAt&&(S=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(V=>{let Te=this.getMaxPoint(V.id);this.totalMaxPoint+=Te,V.essMaxPoint=Te,this.maxPointPerQuestion.push(V.essMaxPoint)});for(let V=0;V<this.questions.length;V++){var M=`cau${V}`;N[M]=new m.MJ(S?S[M]:"",{validators:[m.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),m.k0.min(0),m.k0.max(this.questions[V].essMaxPoint??0)]})}this.form=new m.gE(N),this.form.valueChanges.subscribe(V=>{let Te=JSON.stringify(V);Te!=this.prevData&&(this.prevData=Te,this.form.patchValue(V))}),super.ngOnInit()}constructor(N,S,M,V){super(),this.cdnService=N,this.examResultService=S,this.apiUploadService=M,this.zipDataService=V,this.orgExamObjs=[],this.questions=[],this.files=[],this.resultID=0,this.userAnswersObj={},this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new c.bkB,this.followerRenderQuest=new C.e,this.form=new m.gE({}),this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.jsonData={},this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return(Y=ae).\u0275fac=function(N){return new(N||Y)(c.rXU(ie.B),c.rXU(U._),c.rXU(k.T),c.rXU(j.j))},Y.\u0275cmp=c.VBU({type:Y,selectors:[["azt-mark-essay-new"]],viewQuery:function(N,S){if(1&N&&(c.GBs(Ee,5),c.GBs(ue,5)),2&N){let M;c.mGM(M=c.lsd())&&(S.mnoteContainer=M.first),c.mGM(M=c.lsd())&&(S.MarkNote=M.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",resultID:"resultID",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},features:[c.Vt3],decls:11,vars:10,consts:[["mnoteContainer",""],["aztMarkNote",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"doneLoadData","dataMarkNote","screenType","modeView"],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(N,S){1&N&&(c.j41(0,"div",2)(1,"form",3),c.DNE(2,Ke,14,30,"div",4),c.k0s(),c.DNE(3,X,5,6,"div",5),c.k0s(),c.j41(4,"div",6),c.DNE(5,nt,5,5,"div",7),c.k0s(),c.DNE(6,Et,6,6,"div",8),c.j41(7,"div",9,0),c.DNE(9,ft,2,1,"ng-container",10),c.k0s(),c.DNE(10,Je,5,6,"div",11)),2&N&&(c.R7$(),c.Y8G("formGroup",S.form),c.R7$(),c.Y8G("ngForOf",S.questions),c.R7$(),c.Y8G("ngIf",S.showForTeacher),c.R7$(2),c.Y8G("ngForOf",S.questions),c.R7$(),c.Y8G("ngIf",S.files&&0==S.files.length),c.R7$(),c.Y8G("ngStyle",c.eq3(8,De,S.files&&0==S.files.length?"none":"block")),c.R7$(2),c.Y8G("ngIf",S.dataMarkNote&&S.dataMarkNote.answer_obj&&S.files&&S.files.length>0),c.R7$(),c.Y8G("ngIf",S.showForTeacher))},dependencies:[$.YU,$.Sq,$.bT,$.B3,se.oV,Pe.Z,Z.t,B.x,I.o,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,q.WGl,_e.i,xe.wp],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:#2361ae2e;border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ae})()},94315:(yt,Oe,v)=>{v.d(Oe,{eX:()=>$});class l{constructor(){this.x=0,this.y=0}toBase64String(){return(new Z).writeCvPoint2u(this).toBase64String()}}class d{constructor(){this.x=0,this.y=0}toBase64String(){return(new Z).writeCvPoint2f(this).toBase64String()}}class c{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new Z).writeCvRect2f(this).toBase64String()}}class m{constructor(){this.center=new d,this.filled=!1}toBase64String(){return(new Z).writeAnswerCircle(this).toBase64String()}}class w{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new Z).writeTableAnswer(this).toBase64String()}}class C{constructor(){this.top=new d,this.left=new d,this.bottom=new d,this.right=new d}toBase64String(){return(new Z).writeResultRect(this).toBase64String()}}class H{constructor(){this.id=0,this.region=new c}toBase64String(){return(new Z).writeCropRegion(this).toBase64String()}}class y{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new C,this.studentId=new w,this.examId=new w,this.answerTable=new w,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new Z).writeResultOutput(this).toBase64String()}}class ie{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new Z).writeAnswerSheetInput(this).toBase64String()}}class U{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new Z).writeSmallAnswerCircle(this).toBase64String()}}class k{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new Z).writeSmallTableAnswer(this).toBase64String()}}class j{constructor(){this.studentId=new k,this.examId=new k,this.answerTable=new k}toBase64String(){return(new Z).writeDrawData(this).toBase64String()}}class ${constructor(I){this.bytes=I,this.cursor=0,this.length=I.byteLength}updateCursor(I){if(this.cursor=this.cursor+I,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let I=this.bytes[this.cursor];return this.updateCursor(1),I}parseInt(){let I=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(I).getInt32(0)}parseDouble(){let I=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(I).getFloat64(0,!0)}parseString(){let I=new TextDecoder("utf-8"),q=this.cursor,_e=this.bytes[this.cursor];for(;0!=_e;)this.updateCursor(1),_e=this.bytes[this.cursor];let xe=this.bytes.slice(q,this.cursor),Ee=I.decode(xe);return this.updateCursor(1),Ee}parseBool(){let I=this.bytes[this.cursor];return this.updateCursor(1),I>0}parseCvPoint2u(){let I=new l;return I.x=this.parseUchar(),I.y=this.parseUchar(),I}parseCvPoint2f(){let I=new d;return I.x=this.parseDouble(),I.y=this.parseDouble(),I}parseCvRect2f(){let I=new c;return I.x=this.parseDouble(),I.y=this.parseDouble(),I.width=this.parseDouble(),I.height=this.parseDouble(),I}parseAnswerCircle(){let I=new m;return I.center=this.parseCvPoint2f(),I.filled=this.parseBool(),I}parseTableAnswer(){let I=new w,q=0;I.rows=this.parseInt(),I.cols=this.parseInt(),I.radius=this.parseInt(),q=this.parseInt();for(let _e=0;_e<q;_e++)I.answers.push(this.parseAnswerCircle());return I}parseResultRect(){let I=new C;return I.top=this.parseCvPoint2f(),I.left=this.parseCvPoint2f(),I.bottom=this.parseCvPoint2f(),I.right=this.parseCvPoint2f(),I}parseCropRegion(){let I=new H;return I.id=this.parseInt(),I.region=this.parseCvRect2f(),I}parseResultOutput(){let I=new y,q=0;I.type=this.parseInt(),I.errorCode=this.parseInt(),I.paperCorner=this.parseResultRect(),I.studentId=this.parseTableAnswer(),I.examId=this.parseTableAnswer(),I.answerTable=this.parseTableAnswer(),I.imageWidth=this.parseInt(),I.imageHeight=this.parseInt(),I.imageSize=this.parseInt(),q=this.parseInt();for(let _e=0;_e<q;_e++)I.cropRegion.push(this.parseCropRegion());return I}parseAnswerSheetInput(){let I=new ie;return I.templateType=this.parseInt(),I.imageWidth=this.parseInt(),I.imageHeight=this.parseInt(),I}parseSmallAnswerCircle(){let I=new U;return I.position=this.parseUchar(),I.x=this.parseUchar(),I.y=this.parseUchar(),I.filledCols=this.parseUchar(),I.rows=this.parseUchar(),I}parseSmallTableAnswer(){let I=new k,q=0;I.rows=this.parseUchar(),I.cols=this.parseUchar(),I.radius=this.parseUchar(),q=this.parseInt();for(let _e=0;_e<q;_e++)I.answers.push(this.parseSmallAnswerCircle());return I}parseDrawData(){let I=new j;return I.studentId=this.parseSmallTableAnswer(),I.examId=this.parseSmallTableAnswer(),I.answerTable=this.parseSmallTableAnswer(),I}}const se=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class Z{constructor(){this.bytes=[]}writeUchar(I){return this.bytes.push(I),this}writeUint8Array(I){for(let q=0;q<I.length;q++)this.bytes.push(I[q]);return this}writeArrayBuffer(I){let q=new Uint8Array(I);return this.writeUint8Array(q),this}writeInt(I){let q=new ArrayBuffer(4);return new DataView(q).setUint32(0,I,!1),this.writeArrayBuffer(q),this}writeDouble(I){let q=new ArrayBuffer(8);return new DataView(q).setFloat64(0,I,!0),this.writeArrayBuffer(q),this}writeString(I){let _e=(new TextEncoder).encode(I);return this.writeUint8Array(_e),this.writeUchar(0),this}writeBool(I){return this.writeUchar(I?1:0),this}toBase64String(){return function Pe(B){let q,I="",_e=B.length;for(q=2;q<_e;q+=3)I+=se[B[q-2]>>2],I+=se[(3&B[q-2])<<4|B[q-1]>>4],I+=se[(15&B[q-1])<<2|B[q]>>6],I+=se[63&B[q]];return q===_e+1&&(I+=se[B[q-2]>>2],I+=se[(3&B[q-2])<<4],I+="=="),q===_e&&(I+=se[B[q-2]>>2],I+=se[(3&B[q-2])<<4|B[q-1]>>4],I+=se[(15&B[q-1])<<2],I+="="),I}(new Uint8Array(this.bytes))}writeCvPoint2u(I){return this.writeUchar(I.x),this.writeUchar(I.y),this}writeCvPoint2f(I){return this.writeDouble(I.x),this.writeDouble(I.y),this}writeCvRect2f(I){return this.writeDouble(I.x),this.writeDouble(I.y),this.writeDouble(I.width),this.writeDouble(I.height),this}writeAnswerCircle(I){return this.writeCvPoint2f(I.center),this.writeBool(I.filled),this}writeTableAnswer(I){this.writeInt(I.rows),this.writeInt(I.cols),this.writeInt(I.radius),this.writeInt(I.answers.length);for(let q of I.answers)this.writeAnswerCircle(q);return this}writeResultRect(I){return this.writeCvPoint2f(I.top),this.writeCvPoint2f(I.left),this.writeCvPoint2f(I.bottom),this.writeCvPoint2f(I.right),this}writeCropRegion(I){return this.writeInt(I.id),this.writeCvRect2f(I.region),this}writeResultOutput(I){this.writeInt(I.type),this.writeInt(I.errorCode),this.writeResultRect(I.paperCorner),this.writeTableAnswer(I.studentId),this.writeTableAnswer(I.examId),this.writeTableAnswer(I.answerTable),this.writeInt(I.imageWidth),this.writeInt(I.imageHeight),this.writeInt(I.imageSize),this.writeInt(I.cropRegion.length);for(let q of I.cropRegion)this.writeCropRegion(q);return this}writeAnswerSheetInput(I){return this.writeInt(I.templateType),this.writeInt(I.imageWidth),this.writeInt(I.imageHeight),this}writeSmallAnswerCircle(I){return this.writeUchar(I.position),this.writeUchar(I.x),this.writeUchar(I.y),this.writeUchar(I.filledCols),this.writeUchar(I.rows),this}writeSmallTableAnswer(I){this.writeUchar(I.rows),this.writeUchar(I.cols),this.writeUchar(I.radius),this.writeInt(I.answers.length);for(let q of I.answers)this.writeSmallAnswerCircle(q);return this}writeDrawData(I){return this.writeSmallTableAnswer(I.studentId),this.writeSmallTableAnswer(I.examId),this.writeSmallTableAnswer(I.answerTable),this}}},72267:(yt,Oe,v)=>{v.d(Oe,{E:()=>w});var l=v(48891),d=v(62095),c=v(51113),m=v(99927);let w=(()=>{var C;class H{addIndexLabelToQuestionObjs(ie){for(let U=0;U<(ie?.length??0);U++)ie?.[U]&&(ie[U].indexLabel=U);return ie}getEssayQuestionObjs(ie){let U=[];for(let k=0;k<(ie?.length??0);k++)this.answerTypeService.isEssayAnswer(ie?.[k])&&ie?.[k]&&U.push(ie[k]);return U}getTrueFalseQuestionObjs(ie){let U=[];for(let k=0;k<(ie?.length??0);k++)(this.answerTypeService.isOneChoiceAnswer(ie?.[k])||this.answerTypeService.isTrueFalseAnswer(ie?.[k])||this.answerTypeService.isFillAnswer(ie?.[k]))&&ie?.[k]&&U.push(ie[k]);return U}convertAnswersArr(ie){let U={};return 0!=ie.length&&ie.forEach(k=>{let j=!!k.AnswerContent?.filter($=>$.Status)?.length;k.AnswerContent&&k.AnswerContent.length&&(U[`id_${k.QuestionId}`]=j?[...k.AnswerContent]:k.AnswerContent[0].Content)}),U}mapStudentObjWithTestedObj(ie,U,k){var j=this.commonService.castObj(ie?.studentObj),$=U?.filter(se=>se.userId==k?.parentId);return j&&$&&$.length>0&&(j={...j,offlineMarkObj:$[0].offlineMarkObj,nameImage:$[0].nameImage??""}),k=j}mapStudentObjWithTestedObjForFrontendStudent(ie,U,k){var j=this.commonService.castObj(ie?.studentObj),$=U?.filter(se=>se.userId==k?.parentId);return j&&$&&$.length>0&&(j={...j,offlineMarkObj:$[0].offlineMarkObj,nameImage:$[0].nameImage??""}),k=j}constructor(ie,U,k){this.commonService=ie,this.zipDataService=U,this.answerTypeService=k}}return(C=H).\u0275fac=function(ie){return new(ie||C)(l.KVO(d.R),l.KVO(c.j),l.KVO(m._))},C.\u0275prov=l.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),H})()},57332:(yt,Oe,v)=>{v.d(Oe,{V:()=>Ee});var l=v(89163),d=v(33887),c=v(48891),m=v(2145),w=v(54460),C=v(68323),H=v(90796),y=v(52811),ie=v(15343),U=v(76975);const k=()=>({"mr-2 text-danger flex-none":!0});function j(ue,De){1&ue&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ue&&(c.R7$(),c.JRh(c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_this_exam_result")))}function $(ue,De){1&ue&&(c.j41(0,"span",11),c.EFF(1),c.nI1(2,"mytranslate"),c.k0s()),2&ue&&(c.R7$(),c.SpI("",c.bMT(2,1,"lang_testbank_are_you_sure_to_delete_multiple_exam_result"),":"))}function se(ue,De){if(1&ue&&(c.j41(0,"div",8),c.nrm(1,"lucide-icon",9),c.j41(2,"div"),c.DNE(3,j,3,3,"span",10)(4,$,3,3,"span",10),c.k0s()()),2&ue){const Se=c.XpG();c.R7$(),c.Y8G("ngClass",c.lJ4(3,k)),c.R7$(2),c.Y8G("ngIf",1==Se.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",Se.data.examResultIds.length>1)}}function Pe(ue,De){if(1&ue&&(c.j41(0,"div",21)(1,"span",22),c.EFF(2),c.k0s()()),2&ue){const Se=c.XpG().$implicit;c.R7$(2),c.JRh(Se.fullName)}}function Z(ue,De){if(1&ue&&c.nrm(0,"img",23),2&ue){const Se=c.XpG().$implicit;c.Y8G("nameImages",Se.nameImages)}}function B(ue,De){if(1&ue&&(c.j41(0,"div",14)(1,"div",15)(2,"div",16),c.nrm(3,"azt-create-avatar",17),c.k0s(),c.j41(4,"div",18),c.DNE(5,Pe,3,1,"div",19)(6,Z,1,1,"img",20),c.k0s()()()),2&ue){let Se;const Xe=De.$implicit,Ve=c.XpG(2);c.R7$(3),c.Y8G("linkAvatar",null!==(Se=Xe.avatar)&&void 0!==Se?Se:"")("nameCreateAvatar",Xe.fullName)("size",32),c.R7$(2),c.Y8G("ngIf",!Xe.nameImages||Ve.commonService.convertStringToNumber(Xe.id)>0),c.R7$(),c.Y8G("ngIf",Xe.nameImages&&Ve.commonService.convertStringToNumber(Xe.studentId)<=0)}}function I(ue,De){if(1&ue&&(c.j41(0,"div",12),c.DNE(1,B,7,5,"div",13),c.k0s()),2&ue){const Se=c.XpG();c.R7$(),c.Y8G("ngForOf",Se.data.examResults)}}function q(ue,De){1&ue&&(c.j41(0,"div",8)(1,"div",24)(2,"button",25)(3,"div",26),c.nrm(4,"lucide-icon",27),c.k0s()(),c.j41(5,"div",28),c.EFF(6),c.nI1(7,"mytranslate"),c.k0s()()()),2&ue&&(c.R7$(6),c.JRh(c.bMT(7,1,"lang_testbank_are_you_sure_to_delete_no_exam_result")))}function _e(ue,De){1&ue&&(c.j41(0,"span",31),c.nrm(1,"azt-loading-ui"),c.k0s())}function xe(ue,De){if(1&ue){const Se=c.RV6();c.j41(0,"button",29),c.bIt("click",function(){c.eBV(Se);const Ve=c.XpG();return c.Njj(Ve.confirmDelete())}),c.DNE(1,_e,2,0,"span",30),c.EFF(2),c.nI1(3,"mytranslate"),c.k0s()}if(2&ue){const Se=c.XpG();c.Y8G("disabled",Se.statusObj.loading),c.R7$(),c.Y8G("ngIf",Se.statusObj.loading),c.R7$(),c.SpI(" ",c.bMT(3,3,"lang_cms_common_confirm_btn")," ")}}let Ee=(()=>{var ue;class De extends d._{confirmDelete(){this.initStatusObj(),this.waitDestroy(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjsPost({examHashId:this.examHashId,examResultIds:this.examResultIds}).subscribe(Xe=>{1==Xe.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(Xe.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(Xe,Ve,mt){super(mt,Ve),this.offlineExamResultService=Xe,this.dialogRef=Ve,this.examHashId="",this.examResultIds=[],this.examHashId=mt.examHashId,this.examResultIds=mt.examResultIds}}return(ue=De).\u0275fac=function(Xe){return new(Xe||ue)(c.rXU(m.Fs),c.rXU(l.CP,8),c.rXU(l.Vh,8))},ue.\u0275cmp=c.VBU({type:ue,selectors:[["coazt-delete-offline-exam-result-dialog"]],features:[c.Vt3],decls:11,vars:7,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],["class","text-md flex",4,"ngIf"],["class","grid grid-cols-12 gap-3","style","overflow-y: auto; max-height: calc(100vh - 150px)",4,"ngIf"],[1,"p-3","flex","justify-end"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor","class","btn w-32 btn-danger",3,"disabled","click",4,"ngIf"],[1,"text-md","flex"],["name","trash-2","size","24",3,"ngClass"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"grid","grid-cols-12","gap-3",2,"overflow-y","auto","max-height","calc(100vh - 150px)"],["class","col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"flex","items-center","p-3","student-exam-result-up","w-full"],[1,"w-8","h-8","image-fit","lg:mr-1"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"ml-2","text-left","mt-0",2,"width","calc(100% - 3.5rem)"],["class","azt-student-name flex items-center","style","flex-wrap: wrap",4,"ngIf"],["appDrawNameImage","","class","mb-1 img-name-fluid",3,"nameImages",4,"ngIf"],[1,"azt-student-name","flex","items-center",2,"flex-wrap","wrap"],[1,"font-medium","mr-2"],["appDrawNameImage","",1,"mb-1","img-name-fluid",3,"nameImages"],[1,"mx-auto","text-center"],[1,"btn","btn-sm","btn-primary-soft","p-1"],[1,"w-6","h-6"],["name","circle-x","size","24"],[1,"mt-4"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"click","disabled"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(Xe,Ve){1&Xe&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2),c.DNE(3,se,5,4,"div",3)(4,I,2,1,"div",4)(5,q,8,3,"div",3),c.k0s()(),c.j41(6,"div",5)(7,"button",6),c.bIt("click",function(){return Ve.btnCloseDialog()}),c.EFF(8),c.nI1(9,"mytranslate"),c.k0s(),c.DNE(10,xe,4,5,"button",7),c.k0s()()),2&Xe&&(c.R7$(3),c.Y8G("ngIf",Ve.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",Ve.data.examResultIds.length),c.R7$(),c.Y8G("ngIf",!Ve.data.examResultIds.length),c.R7$(3),c.SpI(" ",c.bMT(9,5,"lang_cms_common_close_btn")," "),c.R7$(2),c.Y8G("ngIf",Ve.data.examResultIds.length))},dependencies:[w.YU,w.Sq,w.bT,C.p,H.y,y.R,ie.WGl,U.wp],encapsulation:2}),De})()},92801:(yt,Oe,v)=>{v.d(Oe,{$:()=>I});var l=v(89163),d=v(33887),c=v(48891),m=v(54460),w=v(47426),C=v(95670),H=v(43404),y=v(4375),ie=v(47712),U=v(76975);function k(q,_e){if(1&q&&(c.j41(0,"div")(1,"div",10)(2,"div",11),c.EFF(3),c.k0s(),c.nrm(4,"input",12),c.k0s()()),2&q){const xe=c.XpG().$implicit;c.R7$(3),c.SpI(" ",xe.title," "),c.R7$(),c.FS9("value",xe.contents[0]),c.Y8G("disabled",!0)}}function j(q,_e){if(1&q&&(c.j41(0,"div",17)(1,"span",18),c.EFF(2),c.k0s()()),2&q){const xe=_e.$implicit;c.R7$(),c.FS9("matTooltip",xe),c.R7$(),c.JRh(xe)}}function $(q,_e){if(1&q&&(c.j41(0,"div")(1,"div",13)(2,"span",14),c.EFF(3),c.k0s()(),c.j41(4,"div",15),c.DNE(5,j,3,2,"div",16),c.k0s()()),2&q){const xe=c.XpG().$implicit;c.R7$(3),c.JRh(xe.title),c.R7$(2),c.Y8G("ngForOf",xe.contents)}}function se(q,_e){if(1&q&&(c.j41(0,"mat-radio-button",21)(1,"span",18),c.EFF(2),c.k0s()()),2&q){const xe=_e.$implicit;c.Y8G("checked",!0)("disabled",!0),c.R7$(),c.FS9("matTooltip",xe),c.R7$(),c.JRh(xe)}}function Pe(q,_e){if(1&q&&(c.j41(0,"div")(1,"div",13)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"mat-radio-group",15),c.DNE(5,se,3,4,"mat-radio-button",20),c.k0s()()),2&q){const xe=c.XpG().$implicit;c.R7$(3),c.JRh(xe.title),c.R7$(2),c.Y8G("ngForOf",xe.contents)}}function Z(q,_e){if(1&q){const xe=c.RV6();c.j41(0,"div")(1,"div",10)(2,"span",19),c.EFF(3),c.k0s()(),c.j41(4,"div",22)(5,"mat-form-field",23)(6,"mat-select",24),c.mxI("valueChange",function(ue){c.eBV(xe);const De=c.XpG().$implicit;return c.DH7(De.contents[0],ue)||(De.contents[0]=ue),c.Njj(ue)}),c.j41(7,"mat-option",25),c.EFF(8),c.k0s()()()()()}if(2&q){const xe=c.XpG().$implicit;c.R7$(3),c.JRh(xe.title),c.R7$(3),c.R50("value",xe.contents[0]),c.Y8G("disabled",!0),c.R7$(),c.FS9("value",xe.contents[0]),c.R7$(),c.JRh(xe.contents[0])}}function B(q,_e){if(1&q&&(c.qex(0,8),c.DNE(1,k,5,3,"div",9)(2,$,6,2,"div",9)(3,Pe,6,2,"div",9)(4,Z,9,5,"div",9),c.bVm()),2&q){const xe=_e.$implicit;c.R7$(),c.Y8G("ngIf",0==xe.type),c.R7$(),c.Y8G("ngIf",1==xe.type),c.R7$(),c.Y8G("ngIf",2==xe.type),c.R7$(),c.Y8G("ngIf",3==xe.type)}}let I=(()=>{var q;class _e extends d._{constructor(Ee,ue){super(ue,Ee),this.dialogRef=Ee,this.data=ue}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return(q=_e).\u0275fac=function(Ee){return new(Ee||q)(c.rXU(l.CP,8),c.rXU(l.Vh))},q.\u0275cmp=c.VBU({type:q,selectors:[["app-result-info-dialog"]],features:[c.Vt3],decls:12,vars:7,consts:[[1,"box","result-info-dialog"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"valueChange","value","disabled"],[2,"color","#1e293c",3,"value"]],template:function(Ee,ue){1&Ee&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),c.EFF(5),c.nI1(6,"mytranslate"),c.k0s()(),c.DNE(7,B,5,4,"ng-container",5),c.k0s()(),c.j41(8,"div",6)(9,"button",7),c.bIt("click",function(){return ue.btnCloseDialog()}),c.EFF(10),c.nI1(11,"mytranslate"),c.k0s()()()),2&Ee&&(c.R7$(5),c.SpI(" ",c.bMT(6,3,"lang_testbank_test_config_verify_profile_student")," "),c.R7$(2),c.Y8G("ngForOf",ue.data),c.R7$(3),c.SpI(" ",c.bMT(11,5,"lang_auto_dong")," "))},dependencies:[m.Sq,m.bT,w.wT,C.rl,H.VT,H._g,y.VO,ie.oV,U.wp],encapsulation:2}),_e})()},43726:(yt,Oe,v)=>{v.d(Oe,{U:()=>Y});var l=v(59640),d=v(53043),c=v(57332),m=v(73014),w=v(89163),C=v(33887),H=v(43234),y=v(48891),ie=v(36484),U=v(74225),k=v(94315),j=v(62095),$=v(51113),se=v(99927),Pe=v(40949);const B=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let I=(()=>{var ae;class de{constructor(S,M,V,Te){this.commonService=S,this.zipDataService=M,this.sAztAnswerTypeService=V,this.cdnService=Te,this.totalPointExam=0}drawAzotaFileToCanvas(S,M,V,Te){return new Promise((ve,Ze)=>{var Re="",rt=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(S.images??""));rt&&rt.url&&rt.url.includes(".azt")?this.httpGetAsync(this.cdnService.getMyCdn(rt.url)).then(st=>{st&&st.length>0?U.decodeScanOfflineFile(st).then(ne=>{let We=this._arrayBufferToBase64(ne.getWrappedImage()??new Uint8Array),Ue=ne.getWrappedImageExtension(),E=ne.scanOfflineData?.scanResult;if(We){let L=new Image;L.src="data:image/"+Ue+";base64,"+We,L.crossOrigin="anonymous",L.onload=()=>{var z=document.createElement("canvas");z.width=L.width,z.height=L.height;const G=z.getContext("2d");G?.drawImage(L,0,0,z.width,z.height);let me=S.resultsData?.answerObjs??[];if(E?.examCodeRegion?.circles&&E?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.examCodeRegion?.circles,G),E?.studentCodeRegion?.circles&&E?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(E?.studentCodeRegion?.circles,G),E?.answerRegion?.circles&&E?.answerRegion?.circles.length>0&&this.drawCircles(E?.answerRegion?.circles,G,me,1,V?.filter(le=>this.sAztAnswerTypeService.isOneChoiceAnswer(le))),E?.answerRegion?.trueFalseCircles&&E?.answerRegion?.trueFalseCircles.length>0&&this.drawCircles(E?.answerRegion?.trueFalseCircles,G,me,5,V?.filter(le=>this.sAztAnswerTypeService.isTrueFalseAnswer(le))),E?.answerRegion?.fillBlankCircles&&E?.answerRegion?.fillBlankCircles.length>0&&this.drawCircles(E?.answerRegion?.fillBlankCircles,G,me,4,V?.filter(le=>this.sAztAnswerTypeService.isFillAnswer(le))),E?.answerRegion?.essayCircles&&E?.answerRegion?.essayCircles.length>0&&M&&this.drawCommonCircles(E?.answerRegion?.essayCircles,G),E?.answerRegion?.handwrittenAnswers&&E?.answerRegion?.handwrittenAnswers.length>0){let le=E?.answerRegion?.handwrittenAnswers,J="18px";if(G){G.fillStyle="#00ff00",G.font=J+" Comic Sans MS",G.textAlign="center";for(let Ce=0;Ce<le.length;Ce++){let be=le[Ce];this.fillTextAnswerDrawForFileAzt(be.recognizedText??"",G,me[Ce],((be.bottomRight.x??0)+(be.topLeft.x??0))/2-3,((be.bottomRight.y??0)+(be.topLeft.y??0))/2+5)}}}G&&G.fillText((this.commonService.myTranslateInstant("lang_auto_tong")??"T\u1ed5ng")+" = "+this.totalPointExam.toFixed(2),25,125),Re=z.toDataURL("image/jpeg",.9),ve({imgUrl:Re,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}}else ve({imgUrl:Re,studentCode:Number(E?.studentCode),subExamCode:Number(E?.subExamCode)})}):ve({imgUrl:Re,studentCode:0,subExamCode:0})}).catch(st=>{Ze(st)}):ve({imgUrl:Re,studentCode:0,subExamCode:0})})}drawScanFileToCanvas(S){return new Promise(M=>{var V="",Te=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(S.images??""));let ve=Te?this.cdnService.getMyCdn(Te.url):"";if(Te&&ve){let Ze=new Image;Ze.src=ve,Ze.crossOrigin="anonymous",Ze.onload=()=>{var Re=document.createElement("canvas");Re.width=Ze.width,Re.height=Ze.height;const rt=Re.getContext("2d");rt?.drawImage(Ze,0,0,Re.width,Re.height);var st=S.resultsData?.answerObjs??[],ne=this.commonService.willDeleteParseJson(S.resultsData?.pos??"");if("2.0"==ne.version)try{let Ut=Uint8Array.from(atob(ne.resultFilledPos),In=>In.charCodeAt(0)),xt=new k.eX(Ut).parseDrawData(),mn=xt.studentId?.answers??[];for(var We=0;We<mn.length;We++)this.tickStudentIdAndExamId(mn[We],rt,xt.answerTable?.radius??0);let Kt=xt.examId?.answers??[];for(We=0;We<Kt.length;We++)this.tickStudentIdAndExamId(Kt[We],rt,xt.answerTable?.radius??0);let an=xt.answerTable?.answers??[];for(We=0;We<an.length;We++)this.answerPaintedRightOrWrong(an[We],rt,xt.answerTable?.radius??0,st);V=Re.toDataURL("image/jpeg",.9),M(V)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),M("")}else if("3.0"==ne.version)try{let Ut=ne.answersHandwritten??[],xt=(Ut[0].answerRegion.height??0)-20+"px";if(rt){rt.fillStyle="#00ff00",rt.font=xt+" Comic Sans MS",rt.textAlign="center";for(let Kt=0;Kt<Ut.length;Kt++){let an=Ut[Kt],Bt=this.getTextAnswerDraw(B[-1==an.answer?26:an.answer],rt,st[Kt]);rt.fillText(Bt,(an.answerRegion.x??0)+(an.answerRegion.width??0)/2,(an.answerRegion.y??0)+(an.answerRegion.height??0)/2+5)}}V=Re.toDataURL("image/jpeg",.9),M(V)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),M("")}else{var Ue=ne.configurationPos.split("_"),E=ne.resultFilledPos.split("_"),L=ne.tableAnchorPos.split("_"),z=this.checkWrongOrTrueAnswer(st),G=0;for(We=0;We<Ue.length;We++)if(1==We||2==We){var me=Ue[We].split("*");G+=parseInt(me[1],10)}var le=0;for(We=0;We<L.length;We++)if(We>=2){var J={},Ae={},Ce=L[We].split("*"),be=Ce[0].split(":"),Le=Ce[1].split(":"),qe={},Qe=Ue[We].split("*");qe.row=parseInt(Qe[0],10),qe.col=parseInt(Qe[1],10),qe.radius=parseInt(Qe[2],10),J.x=parseInt(be[0],10),J.y=parseInt(be[1],10),Ae.x=parseInt(Le[0],10),Ae.y=parseInt(Le[1],10);for(var P=(Ae.y-J.y)/(qe.row+1),ze=J.y,tt=0;tt<qe.row;tt++)if((ze+=P)>J.y&&ze<Ae.y){var at=le<st.length?this.checkAnswerStudentRight(le,st):0;le++,0!=at&&rt&&(rt.beginPath(),rt.arc(J.x+P*at,ze,qe.radius,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle="#f3c12c",rt.stroke())}}var ct=0;for(tt=0;tt<E.length;tt++)if("empty"!=E[tt]){var it=E[tt].split(":"),ut={x:parseInt(it[0],10),y:parseInt(it[1],10),line:parseInt(it[2],10)};tt<G+z.length&&(tt>=G?(rt&&(rt.beginPath(),rt.arc(ut.x,ut.y,ut.line,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle=z[ct],rt.stroke()),ct++):rt&&(rt.beginPath(),rt.arc(ut.x,ut.y,ut.line,0,2*Math.PI,!1),rt.lineWidth=3,rt.strokeStyle="#00ff00",rt.stroke()))}V=Re.toDataURL("image/jpeg",.9),M(V)}}}else M("")})}_arrayBufferToBase64(S){for(var M="",V=new Uint8Array(S),Te=V.byteLength,ve=0;ve<Te;ve++)M+=String.fromCharCode(V[ve]);return window.btoa(M)}httpGetAsync(S){return new Promise((M,V)=>{try{const Te=new XMLHttpRequest;Te.open("GET",S,!0),Te.responseType="arraybuffer",Te.onload=ve=>{if(200===Te.status||304===Te.status){const Ze=Te.response;if(Ze){const Re=new Uint8Array(Ze);M(Re)}else M(new Uint8Array)}else M(new Uint8Array)},Te.onerror=ve=>{V(new Error("lang_core_cant_loading_url"))},Te.send(null)}catch(Te){V(Te)}})}fillTextAnswerDrawForFileAzt(S,M,V,Te,ve){let Ze="";V&&(S?V.rightAnswer&&"ESSAY"!=V.content&&V.rightAnswer!=S?(M.fillStyle="#f3c12c",M.fillText("["+V.rightAnswer+"]",Te+15,ve),M.fillStyle="red",Ze=S+"-",Te-=10):V.rightAnswer&&"ESSAY"!=V.content?(M.fillStyle="#00ff00",Ze+=S):(M.fillStyle="red",Ze+=S):(M.fillStyle="#f3c12c",Ze+=V.rightAnswer)),M.fillText(Ze,Te,ve)}drawCommonCircles(S,M){S.length>0&&S.forEach(V=>{if(V.filled){let Te=V.center.x,ve=V.center.y;M&&(M.beginPath(),M.arc(Te,ve,V.radius+1,0,2*Math.PI,!1),M.lineWidth=2,M.strokeStyle="#00ff00",M.stroke())}})}drawCircles(S,M,V,Te,ve){let Ze=[],Re=[],rt=["A","B","C","D"],st=0;if(V.length>0){let E=V.filter(G=>1==G.answerType||2==G.answerType).length??0,L=V.filter(G=>5==G.answerType).length??0,z=V.filter(G=>4==G.answerType).length??0;st=1==Te?E:4==Te?z:L;for(let G=0;G<V.length;G++){let me="";if(this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:V[G].answerType})){let le=V[G].rightAnswer?.split("|")??[];for(let J=0;J<rt.length;J++)me=G+1-E+""+rt[J]+"F",le.includes(rt[J])&&(me=G+1-E+""+rt[J]+"T"),this.commonService.isExistInArray(Ze,me)||Ze.push(me)}else this.sAztAnswerTypeService.isFillAnswer({answerType:V[G].answerType})?(me=G+1-E-L+"_"+V[G].rightAnswer,this.commonService.isExistInArray(Ze,me)||Ze.push(me)):this.sAztAnswerTypeService.isOneChoiceAnswer({answerType:V[G].answerType})&&(me=G+1+""+V[G].rightAnswer,this.commonService.isExistInArray(Ze,me)||Ze.push(me));this.sAztAnswerTypeService.isEssayAnswer({answerType:V[G].answerType})&&Re.push(G+1)}}let Ue=1==Te?1:5==Te?2:4==Te?3:1;if(M){M.fillStyle="#ff0024",M.font="25px Comic Sans MS";let E=0,L=0,z=0,G="P"+Ue+": ",me=!1;(ve??[]).forEach(le=>{let J=V.find(Ae=>le.id==Ae.questionId);if((this.sAztAnswerTypeService.isOneChoiceAnswer(le)||this.sAztAnswerTypeService.isFillAnswer(le))&&(E++,J?.isRight&&(L+=le.testedScore??0,z++)),this.sAztAnswerTypeService.isTrueFalseAnswer(le)){L+=le.testedScore??0;let Ae=0,Ce="";for(let be=0;be<4;be++)J?.rightAnswers?.includes(B[be])?Ce+="T":Ce+="F";if(J?.content)for(let be=0;be<4;be++)J.content[be]==Ce[be]&&Ae++;me=!0,G+=" "+Ae+"/4;"}}),this.totalPointExam+=L,G+=me?" = "+L.toFixed(2):z+"/"+E+" = "+L.toFixed(2),M.fillText(G,25,25+25*Ue)}S.forEach(E=>{let L=0;L=this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:Te})?Number(E.label.substring(0,E.label.length-2)):this.sAztAnswerTypeService.isFillAnswer({answerType:Te})?Number(E.label.substring(0,E.label.indexOf("_"))):Number(E.label.substring(0,E.label.length-1));let z="";if(0==Ze.length)z="#00ff00";else if(this.sAztAnswerTypeService.isFillAnswer({answerType:Te})){let G=E.label.substring(0,E.label.indexOf("_")+1),me=Ze.find(le=>le.includes(G));if(me){let le=me?.split("_"),J=E.label.split("_");if(E.filled&&(z="red"),le[0]==J[0])if("-"==J[2]&&le[1].includes("-"))0==Number(J[1])&&(z=E.filled?"#00ff00":"#f3c12c");else if(","==J[2]&&le[1].includes(",")){let Ae=le[1].indexOf(",");Number(J[1])==Ae&&(z=E.filled?"#00ff00":"#f3c12c")}else"-"!=J[2]&&","!=J[2]&&le[1][Number(J[1])]==J[2]&&(z=E.filled?"#00ff00":"#f3c12c")}}else this.commonService.isExistInArray(Ze,E.label)?z=E.filled?"#00ff00":"#f3c12c":E.filled&&(z="red");if(z&&L<=st&&!this.commonService.isExistInArray(Re,L)){let G=E.center.x,me=E.center.y;M&&(M.beginPath(),M.arc(G,me,E.radius+1,0,2*Math.PI,!1),M.lineWidth=2,M.strokeStyle=z,M.stroke())}})}checkAnswerStudentRight(S,M){var V=0;return M[S]&&""!=M[S].rightAnswer&&0==M[S].isRight&&(V="A"==M[S].rightAnswer?1:"B"==M[S].rightAnswer?2:"C"==M[S].rightAnswer?3:"D"==M[S].rightAnswer?4:"E"==M[S].rightAnswer?5:"F"==M[S].rightAnswer?6:"G"==M[S].rightAnswer?7:"H"==M[S].rightAnswer?8:0),V}checkWrongOrTrueAnswer(S){for(var M=[],V=0;V<S.length;V++)""!=S[V].content&&(1==S[V].isRight?M.push("#00ff00"):0==S[V].isRight&&M.push("red"));return M}tickStudentIdAndExamId(S,M,V){var Te=256*Math.floor((S.position??0)/16)+S.x,ve=(S.position??0)%16*256+S.y;(S.filledCols??0)>=128&&M&&(M.beginPath(),M.arc(Te,ve,V,0,2*Math.PI,!1),M.lineWidth=3,M.strokeStyle="#00ff00",M.stroke())}answerPaintedRightOrWrong(S,M,V,Te){var ve=256*Math.floor((S.position??0)/16)+S.x,Ze=(S.position??0)%16*256+S.y,Re=S.rows??0,st="#fff0";Te.length>Re&&((S.filledCols??0)>=128?st=1==Te[Re].isRight?"#00ff00":"red":(S.filledCols??0)%128+1==this.checkAnswerStudentRight(Re,Te)&&(st="#f3c12c"),M&&(M.beginPath(),M.arc(ve,Ze,V,0,2*Math.PI,!1),M.lineWidth=3,M.strokeStyle=st,M.stroke()))}getTextAnswerDraw(S,M,V){let Te="";return V&&(S?V.isRight?(M.fillStyle="#00ff00",Te+=S):(M.fillStyle="red",Te=S+" - ["+V.rightAnswer+"]"):(M.fillStyle="#f3c12c",Te+=V.rightAnswer)),Te}}return(ae=de).\u0275fac=function(S){return new(S||ae)(y.KVO(j.R),y.KVO($.j),y.KVO(se._),y.KVO(Pe.B))},ae.\u0275prov=y.jDH({token:ae,factory:ae.\u0275fac,providedIn:"root"}),de})();var q=v(54460),_e=v(52811),xe=v(15343),Ee=v(76975);const ue=()=>({"flex-none mr-1":!0});function De(ae,de){1&ae&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ae&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function Se(ae,de){1&ae&&(y.j41(0,"span",17),y.nrm(1,"azt-loading-ui"),y.k0s())}function Xe(ae,de){if(1&ae){const N=y.RV6();y.j41(0,"img",18),y.bIt("click",function(M){y.eBV(N);const V=y.XpG(2);return y.Njj(V.clickOnImage(M))}),y.k0s()}if(2&ae){const N=y.XpG(2);y.Aen(N.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",N.fileScanUrl,y.B4B)}}function Ve(ae,de){if(1&ae&&(y.j41(0,"div",14,1),y.DNE(2,Se,2,0,"span",15)(3,Xe,1,3,"img",16),y.k0s()),2&ae){const N=y.XpG();y.R7$(2),y.Y8G("ngIf",N.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!N.loadingScanUrl)}}function mt(ae,de){1&ae&&(y.j41(0,"span",19),y.nrm(1,"azt-loading-ui"),y.k0s())}let Ge=(()=>{var ae;class de extends C._{confirmEdit(){this.initStatusObj(),this.processor.uploadToServer().then(S=>{if(!S.success){let M=S.errorMessage;return"azt_lang_core_code_exam"==M&&(M=this.commonService.myTranslateInstant("lang_core_offline_exam_not_found_offline_mix_question_hash_id")??"M\xe3 \u0111\u1ec1 thi kh\xf4ng t\u1ed3n t\u1ea1i"),this.errorStatusObj(M??"lang_core_invalid_data",!0)}this.successStatusObj("lang_auto_luu_thanh_cong",!0),this.dialogRef.close(!0)})}btnCloseDialog(){this.dialogRef.close(!1)}loadScriptHandleImage(){var S=this;this.commonService.loadAnswerSheetJs().then(()=>{var M=this.userService.getUserObj();window.azotaScanAnswerSheet.examResultProcessor(M.rememberToken,"https://"+H.c.base_embed_link,this.data.resultId,M.id).then(function(){var V=(0,m.A)(function*(Te){S.processor=Te,S.initData()});return function(Te){return V.apply(this,arguments)}}())}).catch(M=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}clickOnImage(S){const M=S.target,V=M.getBoundingClientRect();this.processData.clickToImage(M.naturalWidth/V.width*(S.clientX-V.left),M.naturalHeight/V.height*(S.clientY-V.top)),this.processDrawImage()}drawCircleImg(S,M){S&&S.length>0&&(this.circleRadius=S[0].radius,S.forEach(V=>{if(V.filled&&M){let Te=V.center.x,ve=V.center.y;M.beginPath(),M.arc(Te,ve,V.radius+1,0,2*Math.PI,!1),M.lineWidth=3,M.strokeStyle="red",M.stroke()}}))}processDrawImage(){let S=this.drawScanExamService._arrayBufferToBase64(this.processData.getWrappedImage()??new Uint8Array),M=this.processData.getWrappedImageExtension(),V=this.processData.getFilledCircles();if(this.imgSize=this.processor.getImageSize(),!S)return this.loadingScanUrl=!1,void(this.fileScanUrl="");let Te=new Image;Te.src="data:image/"+M+";base64,"+S,Te.crossOrigin="anonymous";var ve=document.createElement("canvas");ve.width=this.imgSize.width,ve.height=this.imgSize.height;const Ze=ve.getContext("2d");Te.onload=()=>{Ze?.drawImage(Te,0,0,ve.width,ve.height),this.drawCircleImg(V,Ze),this.fileScanUrl=ve.toDataURL("image/jpeg",.9),this.loadingScanUrl=!1}}initData(){this.data.resultId&&(this.loadingScanUrl=!0,this.processData=this.processor.getData(),this.processDrawImage())}ngOnInit(){super.ngOnInit(),this.loadScriptHandleImage()}constructor(S,M,V,Te){super(Te,V),this.userService=S,this.drawScanExamService=M,this.dialogRef=V,this.loadingScanUrl=!0,this.fileScanUrl="",this.circleRadius=0,this.imgSize={width:0,height:0}}}return(ae=de).\u0275fac=function(S){return new(S||ae)(y.rXU(ie.R),y.rXU(I),y.rXU(w.CP,8),y.rXU(w.Vh,8))},ae.\u0275cmp=y.VBU({type:ae,selectors:[["app-edit-scan-file-dialog"]],features:[y.Vt3],decls:20,vars:12,consts:[["showImgScan",""],["imageHolding",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md","font-semibold","flex","text-slate-500","items-center"],["name","info","size","16",3,"ngClass"],[2,"vertical-align","midle"],[1,"text-center","mx-auto","mt-1",2,"height","calc(100vh - 200px)","overflow-y","auto"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-32","btn-primary","items-center",3,"click","disabled"],["class","inline-block mr-2",4,"ngIf"],["id","image-holding"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["id","img-container","alt","img",3,"src","style","click",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["id","img-container","alt","img",3,"click","src"],[1,"inline-block","mr-2"]],template:function(S,M){if(1&S){const V=y.RV6();y.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3",5),y.nrm(4,"lucide-icon",6),y.j41(5,"span",7),y.EFF(6,"Click \u1ea3nh \u0111\u1ec3 \u0111\xe1nh d\u1ea5u v\u1ecb tr\xed c\u1ea7n s\u1eeda"),y.k0s()(),y.j41(7,"div",8),y.DNE(8,De,4,3,"ng-container",9)(9,Ve,4,2,"ng-template",null,0,y.C5r),y.k0s()()(),y.j41(11,"div",10)(12,"button",11),y.bIt("click",function(){return y.eBV(V),y.Njj(M.btnCloseDialog())}),y.EFF(13),y.nI1(14,"mytranslate"),y.k0s(),y.j41(15,"button",12),y.bIt("click",function(){return y.eBV(V),y.Njj(M.confirmEdit())}),y.DNE(16,mt,2,0,"span",13),y.j41(17,"span",7),y.EFF(18),y.nI1(19,"mytranslate"),y.k0s()()()()}if(2&S){const V=y.sdS(10);y.R7$(4),y.Y8G("ngClass",y.lJ4(11,ue)),y.R7$(4),y.Y8G("ngIf",!M.loadingScanUrl&&!M.fileScanUrl)("ngIfElse",V),y.R7$(5),y.SpI(" ",y.bMT(14,7,"lang_cms_common_close_btn")," "),y.R7$(2),y.Y8G("disabled",M.statusObj.loading),y.R7$(),y.Y8G("ngIf",M.statusObj.loading),y.R7$(2),y.JRh(y.bMT(19,9,"lang_auto_luu"))}},dependencies:[q.YU,q.bT,_e.R,xe.WGl,Ee.wp],encapsulation:2}),de})();var he=v(46899),Ke=v(47712);const X=()=>({"text-slate-800":!0}),oe=()=>({"text-danger":!0}),Be=ae=>({"text-success":ae});function we(ae,de){if(1&ae){const N=y.RV6();y.j41(0,"div",20)(1,"a",21),y.nI1(2,"mytranslate"),y.bIt("click",function(){let M;y.eBV(N);const V=y.XpG(2);return y.Njj(V.deleteOfflineExamResultObj(null!==(M=null==V.examObj?null:V.examObj.hashId)&&void 0!==M?M:"",V.examResultIdParam))}),y.nrm(3,"lucide-icon",22),y.k0s()()}2&ae&&(y.R7$(),y.Y8G("matTooltip",y.bMT(2,2,"lang_auto_xoa")),y.R7$(2),y.Y8G("ngClass",y.lJ4(4,oe)))}function W(ae,de){1&ae&&(y.j41(0,"span",23),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ae&&(y.R7$(),y.SpI("",y.bMT(2,1,"lang_auto_anh_cham"),": "))}function fe(ae,de){1&ae&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&ae&&(y.R7$(),y.JRh(y.bMT(2,1,"lang_auto_luu_trong_app_mobile")))}function lt(ae,de){1&ae&&(y.qex(0),y.j41(1,"span"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.bVm()),2&ae&&(y.R7$(2),y.JRh(y.bMT(3,1,"lang_test_review_error_get_url_img")))}function Dt(ae,de){1&ae&&(y.j41(0,"span",29),y.nrm(1,"azt-loading-ui"),y.k0s())}function nt(ae,de){if(1&ae&&y.nrm(0,"img",30),2&ae){const N=y.XpG(4);y.Aen(N.isMobileWebView?"width: 100% !important;":"height: auto !important;"),y.Y8G("src",N.fileScanUrl,y.B4B)}}function Et(ae,de){if(1&ae){const N=y.RV6();y.j41(0,"a",26),y.bIt("click",function(){y.eBV(N);const M=y.XpG(3);return y.Njj(M.onShowFile(M.fileScanUrl))}),y.DNE(1,Dt,2,0,"span",27)(2,nt,1,3,"img",28),y.k0s()}if(2&ae){const N=y.XpG(3);y.R7$(),y.Y8G("ngIf",N.loadingScanUrl),y.R7$(),y.Y8G("ngIf",!N.loadingScanUrl)}}function Ye(ae,de){if(1&ae&&(y.j41(0,"div",24),y.DNE(1,lt,4,3,"ng-container",25)(2,Et,3,2,"ng-template",null,2,y.C5r),y.k0s()),2&ae){const N=y.sdS(3),S=y.XpG(2);y.R7$(),y.Y8G("ngIf",!S.loadingScanUrl&&!S.fileScanUrl)("ngIfElse",N)}}function ft(ae,de){if(1&ae){const N=y.RV6();y.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"h3",7)(4,"span"),y.EFF(5),y.nI1(6,"mytranslate"),y.k0s()(),y.j41(7,"div",8)(8,"a",9),y.nI1(9,"mytranslate"),y.bIt("click",function(){let M;y.eBV(N);const V=y.XpG();return y.Njj(V.openEditScanFile(null!==(M=null==V.examObj?null:V.examObj.hashId)&&void 0!==M?M:"",V.examResultIdParam))}),y.nrm(10,"lucide-icon",10),y.k0s()(),y.DNE(11,we,4,5,"div",11),y.k0s()(),y.j41(12,"div",12)(13,"div",6)(14,"span",13),y.eu8(15,14),y.k0s(),y.j41(16,"span",15),y.nI1(17,"mytranslate"),y.eu8(18,14),y.k0s()(),y.j41(19,"div",16),y.DNE(20,W,3,3,"span",17)(21,fe,3,3,"span",18),y.k0s(),y.DNE(22,Ye,4,2,"div",19),y.k0s()()}if(2&ae){const N=y.XpG(),S=y.sdS(2),M=y.sdS(4);y.R7$(5),y.SpI(" ",y.bMT(6,10,"lang_auto_thi_offline")," "),y.R7$(3),y.Y8G("matTooltip",y.bMT(9,12,"lang_auto_sua")),y.R7$(2),y.Y8G("ngClass",y.lJ4(16,X)),y.R7$(),y.Y8G("ngIf",N.isDeletableExamResultObj),y.R7$(4),y.Y8G("ngTemplateOutlet",S),y.R7$(),y.FS9("matTooltip",y.bMT(17,14,"lang_auto_so_bao_danh")),y.R7$(2),y.Y8G("ngTemplateOutlet",M),y.R7$(2),y.Y8G("ngIf",!N.isMobileWebView),y.R7$(),y.Y8G("ngIf",!N.checkHttpLinkImg),y.R7$(),y.Y8G("ngIf",N.checkHttpLinkImg)}}function Je(ae,de){if(1&ae&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatOfflineExamHashIdToNumber"),y.k0s()),2&ae){let N;const S=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_auto_ma_de_thi"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,Be,!(null!=S.offlineMarkObj&&S.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),y.R7$(),y.JRh(y.i5U(4,5,null!==(N=null==S.offlineMixQuestionObj?null:S.offlineMixQuestionObj.hashId)&&void 0!==N?N:0,3))}}function Ne(ae,de){if(1&ae&&(y.EFF(0),y.nI1(1,"mytranslate"),y.j41(2,"span",31),y.EFF(3),y.nI1(4,"formatStudentCodeToNumber"),y.k0s()),2&ae){let N;const S=y.XpG();y.SpI(" ",y.bMT(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),y.R7$(2),y.Y8G("ngClass",y.eq3(8,Be,!(null!=S.offlineMarkObj&&S.offlineMarkObj.isErrorForStudentCode))),y.R7$(),y.JRh(y.i5U(4,5,(null!==(N=null==S.offlineMarkObj?null:S.offlineMarkObj.studentCode)&&void 0!==N?N:0)<0?0:null==S.offlineMarkObj?null:S.offlineMarkObj.studentCode,6))}}let Y=(()=>{var ae;class de extends l.H{checkAzotaFile(S){return!(!S||!S.includes(".azt"))}checkHttpUrl(S){return!(!S||!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(S))}openEditScanFile(S,M){M&&this.sAztDialogService.open(Ge,{data:{examHashId:S,resultId:M,userId:Number(this.userIdParam)},width:"750px",restoreFocus:!1}).afterClosed().subscribe(Te=>{Te&&window.location.reload()})}deleteOfflineExamResultObj(S,M){M&&this.sAztDialogService.open(c.V,{data:{examHashId:S,examResultIds:[M],examResults:[]},restoreFocus:!1}).afterClosed().subscribe(Te=>{Te&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(S){this.sAztDialogService.open(d.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:S,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let S=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),M=this.castJsonToObj(S);this.checkHttpLinkImg=this.checkHttpUrl(M?.url),this.loadingScanUrl=!0,this.checkAzotaFile(M?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam,this.questionObjs,this.essayMark).then(V=>{V.imgUrl?this.fileScanUrl=V.imgUrl:this.checkHttpLinkImg=!0,this.drawScanExamService.totalPointExam=0,this.loadingScanUrl=!1}).catch(V=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(V=>{V?this.fileScanUrl=V:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(V=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(S,M,V){super(),this.sAztDialogService=S,this.zipDataService=M,this.drawScanExamService=V,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return(ae=de).\u0275fac=function(S){return new(S||ae)(y.rXU(he.i),y.rXU($.j),y.rXU(I))},ae.\u0275cmp=y.VBU({type:ae,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj",questionObjs:"questionObjs",essayMark:"essayMark"},features:[y.Vt3,y.OA$],decls:5,vars:1,consts:[["viewExamCodeTpl",""],["viewStudentCodeTpl",""],["showImgScan",""],["class","info-exam-offline mt-3 mb-3",4,"ngIf"],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],[1,"mx-1","items-center"],[1,"text-slate-800",3,"click","matTooltip"],["name","file-pen-line","size","18",3,"ngClass"],["class","mx-1 items-center mr-0",4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],[4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],[1,"mx-1","items-center","mr-0"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click","matTooltip"],["name","trash-2","size","18",3,"ngClass"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["alt","img",3,"src"],[3,"ngClass"]],template:function(S,M){1&S&&y.DNE(0,ft,23,17,"div",3)(1,Je,5,10,"ng-template",null,0,y.C5r)(3,Ne,5,10,"ng-template",null,1,y.C5r),2&S&&y.Y8G("ngIf",M.offlineMarkObj)},dependencies:[q.YU,q.bT,q.T3,Ke.oV,_e.R,xe.WGl,Ee.wp,Ee.Po,Ee.IX],encapsulation:2}),de})()},37642:(yt,Oe,v)=>{v.d(Oe,{E:()=>d});var l=v(48891);let d=(()=>{var c;class m{getDictionaryByGroupFieldTS(C,H){for(var y={},ie=0;ie<C.length;ie++)C[ie].hasOwnProperty(H)&&("number"==typeof C[ie][H]||"string"==typeof C[ie][H])&&(y.hasOwnProperty(C[ie][H])||(y[C[ie][H]]=[]),y[C[ie][H]].push(C[ie]));return y}getDictionaryByFieldTS(C,H){for(var y={},ie=0;ie<C.length;ie++)C[ie].hasOwnProperty(H)&&("number"==typeof C[ie][H]||"string"==typeof C[ie][H])&&(y[C[ie][H]]=C[ie]);return y}getDictionaryBy2FieldsTS(C,H,y){for(var ie={},U=0;U<C.length;U++)C[U].hasOwnProperty(H)&&("number"==typeof C[U][H]||"string"==typeof C[U][H])&&C[U].hasOwnProperty(y)&&("number"==typeof C[U][y]||"string"==typeof C[U][y])&&(ie[C[U][H]+"_"+C[U][y]]=C[U]);return ie}getListValueByFieldNumberTS(C,H){for(var y=[],ie=0;ie<C.length;ie++)C[ie].hasOwnProperty(H)&&"number"==typeof C[ie][H]&&y.push(C[ie][H]);return y}getListValueByField(C,H){for(var y=[],ie=0;ie<C.length;ie++)if(C[ie].hasOwnProperty(H)){var U=y.filter(k=>k[H]==C[ie][H]);(!U||0==U.length)&&y.push(C[ie])}return y}}return(c=m).\u0275fac=function(C){return new(C||c)},c.\u0275prov=l.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),m})()},99172:(yt,Oe,v)=>{v.d(Oe,{p:()=>C});var l=v(73014),d=v(48891),c=v(62095),m=v(40949),w=v(53393);let C=(()=>{var H;class y{processEssayResultToBase64(U){var k=this;return(0,l.A)(function*(){for(const j of U.pages??[]){if(j.draw){const $=yield k.exportPdfUtilsService.convertAndRetryToBase64(j.draw);j.draw=$}if(j.backgroundImage){const $=yield k.exportPdfUtilsService.convertAndRetryToBase64(j.backgroundImage);j.backgroundImage=$}}if(U.commentEmoji&&U.commentEmoji.length){let j="https://azota889.github.io/storage_public/mnote/",$=U.commentEmoji.length;for(let se=0;se<$;se++){let Pe=j+U.commentEmoji[se];const Z=yield k.exportPdfUtilsService.convertAndRetryToBase64(Pe);U.commentEmoji[se]=Z}}return U})()}convertAnswersArr(U,k){0!=U.length&&U.forEach(j=>{j.QuestionId&&j.AnswerContent&&j.AnswerContent[0]&&j.AnswerContent[0].Content&&(k[`id_${j.QuestionId}`]=j.AnswerContent[0].Content)})}findScaleDirection(U,k){return U/k>=.7070707070707071?"w":"h"}constructor(U,k,j){this.commonService=U,this.cdnService=k,this.exportPdfUtilsService=j}}return(H=y).\u0275fac=function(U){return new(U||H)(d.KVO(c.R),d.KVO(m.B),d.KVO(w.j))},H.\u0275prov=d.jDH({token:H,factory:H.\u0275fac,providedIn:"root"}),y})()},53393:(yt,Oe,v)=>{v.d(Oe,{j:()=>H});var l=v(73014),d=function(y){return y[y.Cdn=0]="Cdn",y[y.CdnTimestamp=1]="CdnTimestamp",y[y.Rawlink=2]="Rawlink",y[y.RawlinkTimestamp=3]="RawlinkTimestamp",y}(d||{}),c=v(48891),m=v(62095),w=v(40949),C=v(99927);let H=(()=>{var y;class ie{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){const k=navigator.userAgent,$=(()=>{let Pe=null;const Z=k.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(Z[1]))return"IE "+((/\brv[ :]+(\d+)/g.exec(k)||[])[1]||"");if("Chrome"===Z[1]){const I=k.match(/\b(OPR|Edge)\/(\d+)/);if(null!==I)return I.slice(1).join(" ").replace("OPR","Opera")}const B=Z[2]?[Z[1],Z[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!==(Pe=k.match(/version\/(\d+)/i))&&B.splice(1,1,Pe[1]),B.join(" ")})().toString();return!(!["chrome"].includes($.split(" ")[0].toLowerCase())||parseInt($.split(" ")[1],10)<80)}getExtensionFile(k){if(!k)return"";const j=k.split(".");return j.length<=1?"":j[j.length-1].toLocaleLowerCase().split("_")[0]}findImageSrcInContent(k){let j="";if(k.includes("img")){const $=k.indexOf("img"),se=k.indexOf("src=",$),Pe=k.indexOf('"',Number(se)+5);j=k.substring(Number(se)+5,Number(Pe))}return j}asyncTimeout(k){return(0,l.A)(function*(){return`Waited ${yield new Promise($=>{setTimeout(()=>$(k),k)})} milliseconds`})()}parseEssayMarkResult(k,j){let $=k.filter(Z=>this.answerTypeService.isEssayAnswer(Z));if(0!=$.length&&j&&j.essayResult){var se=this.commonService.willDeleteParseJson(j.essayResult);if(se){var Pe=Object.entries(se);for(let Z=0;Z<$.length;Z++)$[Z].essayMarkParsed=Pe[Z][1]}}}convertToBase64(k,j){var $=this;return(0,l.A)(function*(){let se=k;switch(j){case d.Cdn:se=$.cdnService.getMyCdn(k);break;case d.CdnTimestamp:se=$.cdnService.getMyCdn(k)+"?t="+Date.now();break;case d.RawlinkTimestamp:se=k+"?t="+Date.now()}const Z=yield(yield fetch(se)).blob(),B=yield new Promise(I=>{const q=new FileReader;q.readAsDataURL(Z),q.onloadend=()=>{I(q.result)}});return B&&"string"==typeof B?B:k})()}convertAndRetryToBase64(k){var j=this;return(0,l.A)(function*(){let $=j.getExtensionFile(k);if(["pdf","jpg","jpeg","png","gif"].includes($)){let se;const Pe=[d.Cdn,d.CdnTimestamp,d.Rawlink,d.RawlinkTimestamp];try{se=yield j.convertToBase64(k,Pe[0])}catch{try{se=yield j.convertToBase64(k,Pe[1])}catch{try{se=yield j.convertToBase64(k,Pe[2])}catch{try{se=yield j.convertToBase64(k,Pe[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+k),se=k}}}}return se}return k})()}eraseCanvas(k){k&&(k.beginPath(),k.rect(0,0,k.canvas.width,k.canvas.height),k.fillStyle="white",k.fill())}addContentToPdf(k,j){k.addImage(j,"JPEG",0,0,k.internal.pageSize.getWidth(),k.internal.pageSize.getHeight())}drawTextWrap(k,j,$,se,Pe){const Z=k.split(" "),B=[];let I=Z[0];if(j){j.font=Pe||`${se}px Arial`;for(let q=1;q<Z.length;q++){const _e=Z[q];j.measureText(I+" "+_e).width<$?I+=" "+_e:(B.push(I),I=_e)}B.push(I)}return B}essayText2LinesArr(k,j,$,se,Pe){const Z=new RegExp("(<br>|<br/>)+","igm"),I=(this.replaceAllByRegExp(k,Z,"<br>")??"").split("<br>"),q=[];for(let _e=0;_e<I.length;_e++)q.push(this.drawTextWrap(I[_e],j,$,se,Pe));return q}replaceAllByRegExp(k,j,$){return $?k?k.toString().replace(j,$):void 0:k}removeTagAssistiveMml(){const k=document.getElementsByTagName("mjx-assistive-mml");for(;k.length>0;)k[0].remove()}constructor(k,j,$){this.commonService=k,this.cdnService=j,this.answerTypeService=$}}return(y=ie).\u0275fac=function(k){return new(k||y)(c.KVO(m.R),c.KVO(w.B),c.KVO(C._))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),ie})()},38566:(yt,Oe,v)=>{v.d(Oe,{s:()=>Up});var U,k,l=v(73014),d=v(92757),c=v(18936),m=v(85980),w=v(64627),C=v(56094),H=v(17791),y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ie={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function s(K,O,F){F||(F=0);var Q=Array(16);if("string"==typeof O)for(var te=0;16>te;++te)Q[te]=O.charCodeAt(F++)|O.charCodeAt(F++)<<8|O.charCodeAt(F++)<<16|O.charCodeAt(F++)<<24;else for(te=0;16>te;++te)Q[te]=O[F++]|O[F++]<<8|O[F++]<<16|O[F++]<<24;var ce=K.g[3],D=(O=K.g[0])+(ce^(F=K.g[1])&((te=K.g[2])^ce))+Q[0]+3614090360&4294967295;D=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=(F=(te=(ce=(O=F+(D<<7&4294967295|D>>>25))+((D=ce+(te^O&(F^te))+Q[1]+3905402710&4294967295)<<12&4294967295|D>>>20))+((D=te+(F^ce&(O^F))+Q[2]+606105819&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^te&(ce^O))+Q[3]+3250441966&4294967295)<<22&4294967295|D>>>10))+((D=O+(ce^F&(te^ce))+Q[4]+4118548399&4294967295)<<7&4294967295|D>>>25))+((D=ce+(te^O&(F^te))+Q[5]+1200080426&4294967295)<<12&4294967295|D>>>20))+((D=te+(F^ce&(O^F))+Q[6]+2821735955&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^te&(ce^O))+Q[7]+4249261313&4294967295)<<22&4294967295|D>>>10))+((D=O+(ce^F&(te^ce))+Q[8]+1770035416&4294967295)<<7&4294967295|D>>>25))+((D=ce+(te^O&(F^te))+Q[9]+2336552879&4294967295)<<12&4294967295|D>>>20))+((D=te+(F^ce&(O^F))+Q[10]+4294925233&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^te&(ce^O))+Q[11]+2304563134&4294967295)<<22&4294967295|D>>>10))+((D=O+(ce^F&(te^ce))+Q[12]+1804603682&4294967295)<<7&4294967295|D>>>25))+((D=ce+(te^O&(F^te))+Q[13]+4254626195&4294967295)<<12&4294967295|D>>>20))+((D=te+(F^ce&(O^F))+Q[14]+2792965006&4294967295)<<17&4294967295|D>>>15))+((D=F+(O^te&(ce^O))+Q[15]+1236535329&4294967295)<<22&4294967295|D>>>10))+((D=O+(te^ce&(F^te))+Q[1]+4129170786&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^te&(O^F))+Q[6]+3225465664&4294967295)<<9&4294967295|D>>>23))+((D=te+(O^F&(ce^O))+Q[11]+643717713&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(te^ce))+Q[0]+3921069994&4294967295)<<20&4294967295|D>>>12))+((D=O+(te^ce&(F^te))+Q[5]+3593408605&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^te&(O^F))+Q[10]+38016083&4294967295)<<9&4294967295|D>>>23))+((D=te+(O^F&(ce^O))+Q[15]+3634488961&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(te^ce))+Q[4]+3889429448&4294967295)<<20&4294967295|D>>>12))+((D=O+(te^ce&(F^te))+Q[9]+568446438&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^te&(O^F))+Q[14]+3275163606&4294967295)<<9&4294967295|D>>>23))+((D=te+(O^F&(ce^O))+Q[3]+4107603335&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(te^ce))+Q[8]+1163531501&4294967295)<<20&4294967295|D>>>12))+((D=O+(te^ce&(F^te))+Q[13]+2850285829&4294967295)<<5&4294967295|D>>>27))+((D=ce+(F^te&(O^F))+Q[2]+4243563512&4294967295)<<9&4294967295|D>>>23))+((D=te+(O^F&(ce^O))+Q[7]+1735328473&4294967295)<<14&4294967295|D>>>18))+((D=F+(ce^O&(te^ce))+Q[12]+2368359562&4294967295)<<20&4294967295|D>>>12))+((D=O+(F^te^ce)+Q[5]+4294588738&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^te)+Q[8]+2272392833&4294967295)<<11&4294967295|D>>>21))+((D=te+(ce^O^F)+Q[11]+1839030562&4294967295)<<16&4294967295|D>>>16))+((D=F+(te^ce^O)+Q[14]+4259657740&4294967295)<<23&4294967295|D>>>9))+((D=O+(F^te^ce)+Q[1]+2763975236&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^te)+Q[4]+1272893353&4294967295)<<11&4294967295|D>>>21))+((D=te+(ce^O^F)+Q[7]+4139469664&4294967295)<<16&4294967295|D>>>16))+((D=F+(te^ce^O)+Q[10]+3200236656&4294967295)<<23&4294967295|D>>>9))+((D=O+(F^te^ce)+Q[13]+681279174&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^te)+Q[0]+3936430074&4294967295)<<11&4294967295|D>>>21))+((D=te+(ce^O^F)+Q[3]+3572445317&4294967295)<<16&4294967295|D>>>16))+((D=F+(te^ce^O)+Q[6]+76029189&4294967295)<<23&4294967295|D>>>9))+((D=O+(F^te^ce)+Q[9]+3654602809&4294967295)<<4&4294967295|D>>>28))+((D=ce+(O^F^te)+Q[12]+3873151461&4294967295)<<11&4294967295|D>>>21))+((D=te+(ce^O^F)+Q[15]+530742520&4294967295)<<16&4294967295|D>>>16))+((D=F+(te^ce^O)+Q[2]+3299628645&4294967295)<<23&4294967295|D>>>9))+((D=O+(te^(F|~ce))+Q[0]+4096336452&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~te))+Q[7]+1126891415&4294967295)<<10&4294967295|D>>>22))+((D=te+(O^(ce|~F))+Q[14]+2878612391&4294967295)<<15&4294967295|D>>>17))+((D=F+(ce^(te|~O))+Q[5]+4237533241&4294967295)<<21&4294967295|D>>>11))+((D=O+(te^(F|~ce))+Q[12]+1700485571&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~te))+Q[3]+2399980690&4294967295)<<10&4294967295|D>>>22))+((D=te+(O^(ce|~F))+Q[10]+4293915773&4294967295)<<15&4294967295|D>>>17))+((D=F+(ce^(te|~O))+Q[1]+2240044497&4294967295)<<21&4294967295|D>>>11))+((D=O+(te^(F|~ce))+Q[8]+1873313359&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~te))+Q[15]+4264355552&4294967295)<<10&4294967295|D>>>22))+((D=te+(O^(ce|~F))+Q[6]+2734768916&4294967295)<<15&4294967295|D>>>17))+((D=F+(ce^(te|~O))+Q[13]+1309151649&4294967295)<<21&4294967295|D>>>11))+((ce=(O=F+((D=O+(te^(F|~ce))+Q[4]+4149444226&4294967295)<<6&4294967295|D>>>26))+((D=ce+(F^(O|~te))+Q[11]+3174756917&4294967295)<<10&4294967295|D>>>22))^((te=ce+((D=te+(O^(ce|~F))+Q[2]+718787259&4294967295)<<15&4294967295|D>>>17))|~O))+Q[9]+3951481745&4294967295,K.g[0]=K.g[0]+O&4294967295,K.g[1]=K.g[1]+(te+(D<<21&4294967295|D>>>11))&4294967295,K.g[2]=K.g[2]+te&4294967295,K.g[3]=K.g[3]+ce&4294967295}function o(K,O){this.h=O;for(var F=[],Q=!0,te=K.length-1;0<=te;te--){var ce=0|K[te];Q&&ce==O||(F[te]=ce,Q=!1)}this.g=F}(function e(K,O){function F(){}F.prototype=O.prototype,K.D=O.prototype,K.prototype=new F,K.prototype.constructor=K,K.C=function(Q,te,ce){for(var D=Array(arguments.length-2),Dn=2;Dn<arguments.length;Dn++)D[Dn-2]=arguments[Dn];return O.prototype[te].apply(Q,D)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(K,O){void 0===O&&(O=K.length);for(var F=O-this.blockSize,Q=this.B,te=this.h,ce=0;ce<O;){if(0==te)for(;ce<=F;)s(this,K,ce),ce+=this.blockSize;if("string"==typeof K){for(;ce<O;)if(Q[te++]=K.charCodeAt(ce++),te==this.blockSize){s(this,Q),te=0;break}}else for(;ce<O;)if(Q[te++]=K[ce++],te==this.blockSize){s(this,Q),te=0;break}}this.h=te,this.o+=O},n.prototype.v=function(){var K=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);K[0]=128;for(var O=1;O<K.length-8;++O)K[O]=0;var F=8*this.o;for(O=K.length-8;O<K.length;++O)K[O]=255&F,F/=256;for(this.u(K),K=Array(16),O=F=0;4>O;++O)for(var Q=0;32>Q;Q+=8)K[F++]=this.g[O]>>>Q&255;return K};var u={};function h(K){return-128<=K&&128>K?function i(K,O){var F=u;return Object.prototype.hasOwnProperty.call(F,K)?F[K]:F[K]=O(K)}(K,function(O){return new o([0|O],0>O?-1:0)}):new o([0|K],0>K?-1:0)}function f(K){if(isNaN(K)||!isFinite(K))return x;if(0>K)return ke(f(-K));for(var O=[],F=1,Q=0;K>=F;Q++)O[Q]=K/F|0,F*=4294967296;return new o(O,0)}var x=h(0),R=h(1),ee=h(16777216);function Ie(K){if(0!=K.h)return!1;for(var O=0;O<K.g.length;O++)if(0!=K.g[O])return!1;return!0}function Fe(K){return-1==K.h}function ke(K){for(var O=K.g.length,F=[],Q=0;Q<O;Q++)F[Q]=~K.g[Q];return new o(F,~K.h).add(R)}function He(K,O){return K.add(ke(O))}function ot(K,O){for(;(65535&K[O])!=K[O];)K[O+1]+=K[O]>>>16,K[O]&=65535,O++}function et(K,O){this.g=K,this.h=O}function ht(K,O){if(Ie(O))throw Error("division by zero");if(Ie(K))return new et(x,x);if(Fe(K))return O=ht(ke(K),O),new et(ke(O.g),ke(O.h));if(Fe(O))return O=ht(K,ke(O)),new et(ke(O.g),O.h);if(30<K.g.length){if(Fe(K)||Fe(O))throw Error("slowDivide_ only works with positive integers.");for(var F=R,Q=O;0>=Q.l(K);)F=Tt(F),Q=Tt(Q);var te=_t(F,1),ce=_t(Q,1);for(Q=_t(Q,2),F=_t(F,2);!Ie(Q);){var D=ce.add(Q);0>=D.l(K)&&(te=te.add(F),ce=D),Q=_t(Q,1),F=_t(F,1)}return O=He(K,te.j(O)),new et(te,O)}for(te=x;0<=K.l(O);){for(F=Math.max(1,Math.floor(K.m()/O.m())),Q=48>=(Q=Math.ceil(Math.log(F)/Math.LN2))?1:Math.pow(2,Q-48),D=(ce=f(F)).j(O);Fe(D)||0<D.l(K);)D=(ce=f(F-=Q)).j(O);Ie(ce)&&(ce=R),te=te.add(ce),K=He(K,D)}return new et(te,K)}function Tt(K){for(var O=K.g.length+1,F=[],Q=0;Q<O;Q++)F[Q]=K.i(Q)<<1|K.i(Q-1)>>>31;return new o(F,K.h)}function _t(K,O){var F=O>>5;O%=32;for(var Q=K.g.length-F,te=[],ce=0;ce<Q;ce++)te[ce]=0<O?K.i(ce+F)>>>O|K.i(ce+F+1)<<32-O:K.i(ce+F);return new o(te,K.h)}(r=o.prototype).m=function(){if(Fe(this))return-ke(this).m();for(var K=0,O=1,F=0;F<this.g.length;F++){var Q=this.i(F);K+=(0<=Q?Q:4294967296+Q)*O,O*=4294967296}return K},r.toString=function(K){if(2>(K=K||10)||36<K)throw Error("radix out of range: "+K);if(Ie(this))return"0";if(Fe(this))return"-"+ke(this).toString(K);for(var O=f(Math.pow(K,6)),F=this,Q="";;){var te=ht(F,O).g,ce=((0<(F=He(F,te.j(O))).g.length?F.g[0]:F.h)>>>0).toString(K);if(Ie(F=te))return ce+Q;for(;6>ce.length;)ce="0"+ce;Q=ce+Q}},r.i=function(K){return 0>K?0:K<this.g.length?this.g[K]:this.h},r.l=function(K){return Fe(K=He(this,K))?-1:Ie(K)?0:1},r.abs=function(){return Fe(this)?ke(this):this},r.add=function(K){for(var O=Math.max(this.g.length,K.g.length),F=[],Q=0,te=0;te<=O;te++){var ce=Q+(65535&this.i(te))+(65535&K.i(te)),D=(ce>>>16)+(this.i(te)>>>16)+(K.i(te)>>>16);Q=D>>>16,F[te]=(D&=65535)<<16|(ce&=65535)}return new o(F,-2147483648&F[F.length-1]?-1:0)},r.j=function(K){if(Ie(this)||Ie(K))return x;if(Fe(this))return Fe(K)?ke(this).j(ke(K)):ke(ke(this).j(K));if(Fe(K))return ke(this.j(ke(K)));if(0>this.l(ee)&&0>K.l(ee))return f(this.m()*K.m());for(var O=this.g.length+K.g.length,F=[],Q=0;Q<2*O;Q++)F[Q]=0;for(Q=0;Q<this.g.length;Q++)for(var te=0;te<K.g.length;te++){var ce=this.i(Q)>>>16,D=65535&this.i(Q),Dn=K.i(te)>>>16,$s=65535&K.i(te);F[2*Q+2*te]+=D*$s,ot(F,2*Q+2*te),F[2*Q+2*te+1]+=ce*$s,ot(F,2*Q+2*te+1),F[2*Q+2*te+1]+=D*Dn,ot(F,2*Q+2*te+1),F[2*Q+2*te+2]+=ce*Dn,ot(F,2*Q+2*te+2)}for(Q=0;Q<O;Q++)F[Q]=F[2*Q+1]<<16|F[2*Q];for(Q=O;Q<2*O;Q++)F[Q]=0;return new o(F,0)},r.A=function(K){return ht(this,K).h},r.and=function(K){for(var O=Math.max(this.g.length,K.g.length),F=[],Q=0;Q<O;Q++)F[Q]=this.i(Q)&K.i(Q);return new o(F,this.h&K.h)},r.or=function(K){for(var O=Math.max(this.g.length,K.g.length),F=[],Q=0;Q<O;Q++)F[Q]=this.i(Q)|K.i(Q);return new o(F,this.h|K.h)},r.xor=function(K){for(var O=Math.max(this.g.length,K.g.length),F=[],Q=0;Q<O;Q++)F[Q]=this.i(Q)^K.i(Q);return new o(F,this.h^K.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,k=ie.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=f,o.fromString=function g(K,O){if(0==K.length)throw Error("number format error: empty string");if(2>(O=O||10)||36<O)throw Error("radix out of range: "+O);if("-"==K.charAt(0))return ke(g(K.substring(1),O));if(0<=K.indexOf("-"))throw Error('number format error: interior "-" character');for(var F=f(Math.pow(O,8)),Q=x,te=0;te<K.length;te+=8){var ce=Math.min(8,K.length-te),D=parseInt(K.substring(te,te+ce),O);8>ce?(ce=f(Math.pow(O,ce)),Q=Q.j(ce).add(f(D))):Q=(Q=Q.j(F)).add(f(D))}return Q},U=ie.Integer=o}).apply(typeof y<"u"?y:typeof self<"u"?self:typeof window<"u"?window:{});var se,Pe,Z,B,I,q,_e,xe,Ee,j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(a,_,p){return a==Array.prototype||a==Object.prototype||(a[_]=p.value),a},n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof j&&j];for(var _=0;_<a.length;++_){var p=a[_];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}(this);!function s(a,_){if(_)e:{var p=n;a=a.split(".");for(var b=0;b<a.length-1;b++){var re=a[b];if(!(re in p))break e;p=p[re]}(_=_(b=p[a=a[a.length-1]]))!=b&&null!=_&&e(p,a,{configurable:!0,writable:!0,value:_})}}("Array.prototype.values",function(a){return a||function(){return function i(a,_){a instanceof String&&(a+="");var p=0,b=!1,re={next:function(){if(!b&&p<a.length){var ge=p++;return{value:_(ge,a[ge]),done:!1}}return b=!0,{done:!0,value:void 0}}};return re[Symbol.iterator]=function(){return re},re}(this,function(_,p){return p})}});var o=o||{},u=this||self;function h(a){var _=typeof a;return"array"==(_="object"!=_?_:a?Array.isArray(a)?"array":_:"null")||"object"==_&&"number"==typeof a.length}function f(a){var _=typeof a;return"object"==_&&null!=a||"function"==_}function g(a,_,p){return a.call.apply(a.bind,arguments)}function x(a,_,p){if(!a)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var re=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(re,b),a.apply(_,re)}}return function(){return a.apply(_,arguments)}}function R(a,_,p){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:x).apply(null,arguments)}function ee(a,_){var p=Array.prototype.slice.call(arguments,1);return function(){var b=p.slice();return b.push.apply(b,arguments),a.apply(this,b)}}function Ie(a,_){function p(){}p.prototype=_.prototype,a.aa=_.prototype,a.prototype=new p,a.prototype.constructor=a,a.Qb=function(b,re,ge){for(var $e=Array(arguments.length-2),St=2;St<arguments.length;St++)$e[St-2]=arguments[St];return _.prototype[re].apply(b,$e)}}function Fe(a){const _=a.length;if(0<_){const p=Array(_);for(let b=0;b<_;b++)p[b]=a[b];return p}return[]}function ke(a,_){for(let p=1;p<arguments.length;p++){const b=arguments[p];if(h(b)){const re=a.length||0,ge=b.length||0;a.length=re+ge;for(let $e=0;$e<ge;$e++)a[re+$e]=b[$e]}else a.push(b)}}function ot(a){return/^[\s\xa0]*$/.test(a)}function et(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function ht(a){return ht[" "](a),a}ht[" "]=function(){};var Tt=!(-1==et().indexOf("Gecko")||-1!=et().toLowerCase().indexOf("webkit")&&-1==et().indexOf("Edge")||-1!=et().indexOf("Trident")||-1!=et().indexOf("MSIE")||-1!=et().indexOf("Edge"));function _t(a,_,p){for(const b in a)_.call(p,a[b],b,a)}function O(a){const _={};for(const p in a)_[p]=a[p];return _}const F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Q(a,_){let p,b;for(let re=1;re<arguments.length;re++){for(p in b=arguments[re],b)a[p]=b[p];for(let ge=0;ge<F.length;ge++)p=F[ge],Object.prototype.hasOwnProperty.call(b,p)&&(a[p]=b[p])}}function te(a){var _=1;a=a.split(":");const p=[];for(;0<_&&a.length;)p.push(a.shift()),_--;return a.length&&p.push(a.join(":")),p}function ce(a){u.setTimeout(()=>{throw a},0)}function D(){var a=ec;let _=null;return a.g&&(_=a.g,a.g=a.g.next,a.g||(a.h=null),_.next=null),_}var $s=new class He{constructor(_,p){this.i=_,this.j=p,this.h=0,this.g=null}get(){let _;return 0<this.h?(this.h--,_=this.g,this.g=_.next,_.next=null):_=this.i(),_}}(()=>new $p,a=>a.reset());class $p{constructor(){this.next=this.g=this.h=null}set(_,p){this.h=_,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let qs,Ws=!1,ec=new class Dn{constructor(){this.h=this.g=null}add(_,p){const b=$s.get();b.set(_,p),this.h?this.h.next=b:this.g=b,this.h=b}},Vd=()=>{const a=u.Promise.resolve(void 0);qs=()=>{a.then(qp)}};var qp=()=>{for(var a;a=D();){try{a.h.call(a.g)}catch(p){ce(p)}var _=$s;_.j(a),100>_.h&&(_.h++,a.next=_.g,_.g=a)}Ws=!1};function Hn(){this.s=this.s,this.C=this.C}function nn(a,_){this.type=a,this.g=this.target=_,this.defaultPrevented=!1}Hn.prototype.s=!1,Hn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Hn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},nn.prototype.h=function(){this.defaultPrevented=!0};var Wp=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,_=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const p=()=>{};u.addEventListener("test",p,_),u.removeEventListener("test",p,_)}catch{}return a}();function Ks(a,_){if(nn.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var p=this.type=a.type,b=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=_,_=a.relatedTarget){if(Tt){e:{try{ht(_.nodeName);var re=!0;break e}catch{}re=!1}re||(_=null)}}else"mouseover"==p?_=a.fromElement:"mouseout"==p&&(_=a.toElement);this.relatedTarget=_,b?(this.clientX=void 0!==b.clientX?b.clientX:b.pageX,this.clientY=void 0!==b.clientY?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Kp[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Ks.aa.h.call(this)}}Ie(Ks,nn);var Kp={2:"touch",3:"pen",4:"mouse"};Ks.prototype.h=function(){Ks.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ys="closure_listenable_"+(1e6*Math.random()|0),Yp=0;function Qp(a,_,p,b,re){this.listener=a,this.proxy=null,this.src=_,this.type=p,this.capture=!!b,this.ha=re,this.key=++Yp,this.da=this.fa=!1}function ho(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function _o(a){this.src=a,this.g={},this.h=0}function tc(a,_){var p=_.type;if(p in a.g){var ge,b=a.g[p],re=Array.prototype.indexOf.call(b,_,void 0);(ge=0<=re)&&Array.prototype.splice.call(b,re,1),ge&&(ho(_),0==a.g[p].length&&(delete a.g[p],a.h--))}}function nc(a,_,p,b){for(var re=0;re<a.length;++re){var ge=a[re];if(!ge.da&&ge.listener==_&&ge.capture==!!p&&ge.ha==b)return re}return-1}_o.prototype.add=function(a,_,p,b,re){var ge=a.toString();(a=this.g[ge])||(a=this.g[ge]=[],this.h++);var $e=nc(a,_,b,re);return-1<$e?(_=a[$e],p||(_.fa=!1)):((_=new Qp(_,this.src,ge,!!b,re)).fa=p,a.push(_)),_};var rc="closure_lm_"+(1e6*Math.random()|0),sc={};function jd(a,_,p,b,re){if(b&&b.once)return zd(a,_,p,b,re);if(Array.isArray(_)){for(var ge=0;ge<_.length;ge++)jd(a,_[ge],p,b,re);return null}return p=lc(p),a&&a[Ys]?a.K(_,p,f(b)?!!b.capture:!!b,re):Nd(a,_,p,!1,b,re)}function Nd(a,_,p,b,re,ge){if(!_)throw Error("Invalid event type");var $e=f(re)?!!re.capture:!!re,St=oc(a);if(St||(a[rc]=St=new _o(a)),(p=St.add(_,p,b,$e,ge)).proxy)return p;if(b=function Xp(){const _=Hp;return function a(p){return _.call(a.src,a.listener,p)}}(),p.proxy=b,b.src=a,b.listener=p,a.addEventListener)Wp||(re=$e),void 0===re&&(re=!1),a.addEventListener(_.toString(),b,re);else if(a.attachEvent)a.attachEvent(Ld(_.toString()),b);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(b)}return p}function zd(a,_,p,b,re){if(Array.isArray(_)){for(var ge=0;ge<_.length;ge++)zd(a,_[ge],p,b,re);return null}return p=lc(p),a&&a[Ys]?a.L(_,p,f(b)?!!b.capture:!!b,re):Nd(a,_,p,!0,b,re)}function Bd(a,_,p,b,re){if(Array.isArray(_))for(var ge=0;ge<_.length;ge++)Bd(a,_[ge],p,b,re);else b=f(b)?!!b.capture:!!b,p=lc(p),a&&a[Ys]?(a=a.i,(_=String(_).toString())in a.g&&-1<(p=nc(ge=a.g[_],p,b,re))&&(ho(ge[p]),Array.prototype.splice.call(ge,p,1),0==ge.length&&(delete a.g[_],a.h--))):a&&(a=oc(a))&&(_=a.g[_.toString()],a=-1,_&&(a=nc(_,p,b,re)),(p=-1<a?_[a]:null)&&ic(p))}function ic(a){if("number"!=typeof a&&a&&!a.da){var _=a.src;if(_&&_[Ys])tc(_.i,a);else{var p=a.type,b=a.proxy;_.removeEventListener?_.removeEventListener(p,b,a.capture):_.detachEvent?_.detachEvent(Ld(p),b):_.addListener&&_.removeListener&&_.removeListener(b),(p=oc(_))?(tc(p,a),0==p.h&&(p.src=null,_[rc]=null)):ho(a)}}}function Ld(a){return a in sc?sc[a]:sc[a]="on"+a}function Hp(a,_){if(a.da)a=!0;else{_=new Ks(_,this);var p=a.listener,b=a.ha||a.src;a.fa&&ic(a),a=p.call(b,_)}return a}function oc(a){return(a=a[rc])instanceof _o?a:null}var ac="__closure_events_fn_"+(1e9*Math.random()>>>0);function lc(a){return"function"==typeof a?a:(a[ac]||(a[ac]=function(_){return a.handleEvent(_)}),a[ac])}function rn(){Hn.call(this),this.i=new _o(this),this.M=this,this.F=null}function ln(a,_){var p,b=a.F;if(b)for(p=[];b;b=b.F)p.push(b);if(a=a.M,b=_.type||_,"string"==typeof _)_=new nn(_,a);else if(_ instanceof nn)_.target=_.target||a;else{var re=_;Q(_=new nn(b,a),re)}if(re=!0,p)for(var ge=p.length-1;0<=ge;ge--){var $e=_.g=p[ge];re=mo($e,b,!0,_)&&re}if(re=mo($e=_.g=a,b,!0,_)&&re,re=mo($e,b,!1,_)&&re,p)for(ge=0;ge<p.length;ge++)re=mo($e=_.g=p[ge],b,!1,_)&&re}function mo(a,_,p,b){if(!(_=a.i.g[String(_)]))return!0;_=_.concat();for(var re=!0,ge=0;ge<_.length;++ge){var $e=_[ge];if($e&&!$e.da&&$e.capture==p){var St=$e.listener,Ht=$e.ha||$e.src;$e.fa&&tc(a.i,$e),re=!1!==St.call(Ht,b)&&re}}return re&&!b.defaultPrevented}function Gd(a,_,p){if("function"==typeof a)p&&(a=R(a,p));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=R(a.handleEvent,a)}return 2147483647<Number(_)?-1:u.setTimeout(a,_||0)}function Ud(a){a.g=Gd(()=>{a.g=null,a.i&&(a.i=!1,Ud(a))},a.l);const _=a.h;a.h=null,a.m.apply(null,_)}Ie(rn,Hn),rn.prototype[Ys]=!0,rn.prototype.removeEventListener=function(a,_,p,b){Bd(this,a,_,p,b)},rn.prototype.N=function(){if(rn.aa.N.call(this),this.i){var _,a=this.i;for(_ in a.g){for(var p=a.g[_],b=0;b<p.length;b++)ho(p[b]);delete a.g[_],a.h--}}this.F=null},rn.prototype.K=function(a,_,p,b){return this.i.add(String(a),_,!1,p,b)},rn.prototype.L=function(a,_,p,b){return this.i.add(String(a),_,!0,p,b)};class Jp extends Hn{constructor(_,p){super(),this.m=_,this.l=p,this.h=null,this.i=!1,this.g=null}j(_){this.h=arguments,this.g?this.i=!0:Ud(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qs(a){Hn.call(this),this.h=a,this.g={}}Ie(Qs,Hn);var $d=[];function qd(a){_t(a.g,function(_,p){this.g.hasOwnProperty(p)&&ic(_)},a),a.g={}}Qs.prototype.N=function(){Qs.aa.N.call(this),qd(this)},Qs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cc=u.JSON.stringify,Zp=u.JSON.parse,eg=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function uc(){}function Kd(){}uc.prototype.h=null;var Xs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function hc(){nn.call(this,"d")}function dc(){nn.call(this,"c")}Ie(hc,nn),Ie(dc,nn);var vr={},Yd=null;function fo(){return Yd=Yd||new rn}function Qd(a){nn.call(this,vr.La,a)}function Hs(a){const _=fo();ln(_,new Qd(_))}function Xd(a,_){nn.call(this,vr.STAT_EVENT,a),this.stat=_}function cn(a){const _=fo();ln(_,new Xd(_,a))}function Hd(a,_){nn.call(this,vr.Ma,a),this.size=_}function Js(a,_){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},_)}function Zs(){this.g=!0}function ss(a,_,p,b){a.info(function(){return"XMLHTTP TEXT ("+_+"): "+function sg(a,_){if(!a.g)return _;if(!_)return null;try{var p=JSON.parse(_);if(p)for(a=0;a<p.length;a++)if(Array.isArray(p[a])){var b=p[a];if(!(2>b.length)){var re=b[1];if(Array.isArray(re)&&!(1>re.length)){var ge=re[0];if("noop"!=ge&&"stop"!=ge&&"close"!=ge)for(var $e=1;$e<re.length;$e++)re[$e]=""}}}return cc(p)}catch{return _}}(a,p)+(b?" "+b:"")})}vr.La="serverreachability",Ie(Qd,nn),vr.STAT_EVENT="statevent",Ie(Xd,nn),vr.Ma="timingevent",Ie(Hd,nn),Zs.prototype.xa=function(){this.g=!1},Zs.prototype.info=function(){};var _c,po={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Jd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function go(){}function Jn(a,_,p,b){this.j=a,this.i=_,this.l=p,this.R=b||1,this.U=new Qs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zd}function Zd(){this.i=null,this.g="",this.h=!1}Ie(go,uc),go.prototype.g=function(){return new XMLHttpRequest},go.prototype.i=function(){return{}},_c=new go;var e_={},mc={};function fc(a,_,p){a.L=1,a.v=xo(Fn(_)),a.m=p,a.P=!0,t_(a,null)}function t_(a,_){a.F=Date.now(),yo(a),a.A=Fn(a.v);var p=a.A,b=a.R;Array.isArray(b)||(b=[String(b)]),f_(p.i,"t",b),a.C=0,p=a.j.J,a.h=new Zd,a.g=M_(a.j,p?_:null,!a.m),0<a.O&&(a.M=new Jp(R(a.Y,a,a.g),a.O)),_=a.U,p=a.g,b=a.ca;var re="readystatechange";Array.isArray(re)||(re&&($d[0]=re.toString()),re=$d);for(var ge=0;ge<re.length;ge++){var $e=jd(p,re[ge],b||_.handleEvent,!1,_.h||_);if(!$e)break;_.g[$e.key]=$e}_=a.H?O(a.H):{},a.m?(a.u||(a.u="POST"),_["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,_)):(a.u="GET",a.g.ea(a.A,a.u,null,_)),Hs(),function tg(a,_,p,b,re,ge){a.info(function(){if(a.g)if(ge)for(var $e="",St=ge.split("&"),Ht=0;Ht<St.length;Ht++){var bt=St[Ht].split("=");if(1<bt.length){var sn=bt[0];bt=bt[1];var on=sn.split("_");$e=2<=on.length&&"type"==on[1]?$e+(sn+"=")+bt+"&":$e+(sn+"=redacted&")}}else $e=null;else $e=ge;return"XMLHTTP REQ ("+b+") [attempt "+re+"]: "+_+"\n"+p+"\n"+$e})}(a.i,a.u,a.A,a.l,a.R,a.m)}function n_(a){return!!a.g&&"GET"==a.u&&2!=a.L&&a.j.Ca}function ig(a,_){var p=a.C,b=_.indexOf("\n",p);return-1==b?mc:(p=Number(_.substring(p,b)),isNaN(p)?e_:(b+=1)+p>_.length?mc:(_=_.slice(b,b+p),a.C=b+p,_))}function yo(a){a.S=Date.now()+a.I,r_(a,a.I)}function r_(a,_){if(null!=a.B)throw Error("WatchDog timer not null");a.B=Js(R(a.ba,a),_)}function pc(a){a.B&&(u.clearTimeout(a.B),a.B=null)}function ei(a){0==a.j.G||a.J||R_(a.j,a)}function wr(a){pc(a);var _=a.M;_&&"function"==typeof _.ma&&_.ma(),a.M=null,qd(a.U),a.g&&(_=a.g,a.g=null,_.abort(),_.ma())}function gc(a,_){try{var p=a.j;if(0!=p.G&&(p.g==a||yc(p.h,a)))if(!a.K&&yc(p.h,a)&&3==p.G){try{var b=p.Da.g.parse(_)}catch{b=null}if(Array.isArray(b)&&3==b.length){var re=b;if(0==re[0]){e:if(!p.u){if(p.g){if(!(p.g.F+3e3<a.F))break e;Ao(p),Io(p)}Tc(p),cn(18)}}else p.za=re[1],0<p.za-p.T&&37500>re[2]&&p.F&&0==p.v&&!p.C&&(p.C=Js(R(p.Za,p),6e3));if(1>=o_(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Tr(p,11)}else if((a.K||p.g==a)&&Ao(p),!ot(_))for(re=p.Da.g.parse(_),_=0;_<re.length;_++){let bt=re[_];if(p.T=bt[0],bt=bt[1],2==p.G)if("c"==bt[0]){p.K=bt[1],p.ia=bt[2];const sn=bt[3];null!=sn&&(p.la=sn,p.j.info("VER="+p.la));const on=bt[4];null!=on&&(p.Aa=on,p.j.info("SVER="+p.Aa));const as=bt[5];null!=as&&"number"==typeof as&&0<as&&(p.L=b=1.5*as,p.j.info("backChannelRequestTimeoutMs_="+b)),b=p;const yn=a.g;if(yn){const So=yn.g?yn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(So){var ge=b.h;ge.g||-1==So.indexOf("spdy")&&-1==So.indexOf("quic")&&-1==So.indexOf("h2")||(ge.j=ge.l,ge.g=new Set,ge.h&&(vc(ge,ge.h),ge.h=null))}if(b.D){const Ic=yn.g?yn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ic&&(b.ya=Ic,Pt(b.I,b.D,Ic))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-a.F,p.j.info("Handshake RTT: "+p.R+"ms"));var $e=a;if((b=p).qa=k_(b,b.J?b.ia:null,b.W),$e.K){a_(b.h,$e);var St=$e,Ht=b.L;Ht&&(St.I=Ht),St.B&&(pc(St),yo(St)),b.g=$e}else C_(b);0<p.i.length&&Eo(p)}else"stop"!=bt[0]&&"close"!=bt[0]||Tr(p,7);else 3==p.G&&("stop"==bt[0]||"close"==bt[0]?"stop"==bt[0]?Tr(p,7):xc(p):"noop"!=bt[0]&&p.l&&p.l.ta(bt),p.v=0)}Hs()}catch{}}Jn.prototype.ca=function(a){a=a.target;const _=this.M;_&&3==Vn(a)?_.j():this.Y(a)},Jn.prototype.Y=function(a){try{if(a==this.g)e:{const on=Vn(this.g);var _=this.g.Ba();if(this.g.Z(),!(3>on)&&(3!=on||this.g&&(this.h.h||this.g.oa()||T_(this.g)))){this.J||4!=on||7==_||Hs(),pc(this);var p=this.g.Z();this.X=p;t:if(n_(this)){var b=T_(this.g);a="";var re=b.length,ge=4==Vn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){wr(this),ei(this);var $e="";break t}this.h.i=new u.TextDecoder}for(_=0;_<re;_++)this.h.h=!0,a+=this.h.i.decode(b[_],{stream:!(ge&&_==re-1)});b.length=0,this.h.g+=a,this.C=0,$e=this.h.g}else $e=this.g.oa();if(this.o=200==p,function ng(a,_,p,b,re,ge,$e){a.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+re+"]: "+_+"\n"+p+"\n"+ge+" "+$e})}(this.i,this.u,this.A,this.l,this.R,on,p),this.o){if(this.T&&!this.K){t:{if(this.g){var St,Ht=this.g;if((St=Ht.g?Ht.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ot(St)){var bt=St;break t}}bt=null}if(!(p=bt)){this.o=!1,this.s=3,cn(12),wr(this),ei(this);break e}ss(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gc(this,p)}if(this.P){let yn;for(p=!0;!this.J&&this.C<$e.length;){if(yn=ig(this,$e),yn==mc){4==on&&(this.s=4,cn(14),p=!1),ss(this.i,this.l,null,"[Incomplete Response]");break}if(yn==e_){this.s=4,cn(15),ss(this.i,this.l,$e,"[Invalid Chunk]"),p=!1;break}ss(this.i,this.l,yn,null),gc(this,yn)}if(n_(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=on||0!=$e.length||this.h.h||(this.s=1,cn(16),p=!1),this.o=this.o&&p,p){if(0<$e.length&&!this.W){this.W=!0;var sn=this.j;sn.g==this&&sn.ba&&!sn.M&&(sn.j.info("Great, no buffering proxy detected. Bytes received: "+$e.length),bc(sn),sn.M=!0,cn(11))}}else ss(this.i,this.l,$e,"[Invalid Chunked Response]"),wr(this),ei(this)}else ss(this.i,this.l,$e,null),gc(this,$e);4==on&&wr(this),this.o&&!this.J&&(4==on?R_(this.j,this):(this.o=!1,yo(this)))}else(function Tg(a){const _={};a=(a.g&&2<=Vn(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let b=0;b<a.length;b++){if(ot(a[b]))continue;var p=te(a[b]);const re=p[0];if("string"!=typeof(p=p[1]))continue;p=p.trim();const ge=_[re]||[];_[re]=ge,ge.push(p)}!function K(a,_){for(const p in a)_.call(void 0,a[p],p,a)}(_,function(b){return b.join(", ")})})(this.g),400==p&&0<$e.indexOf("Unknown SID")?(this.s=3,cn(12)):(this.s=0,cn(13)),wr(this),ei(this)}}}catch{}},Jn.prototype.cancel=function(){this.J=!0,wr(this)},Jn.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(function rg(a,_){a.info(function(){return"TIMEOUT: "+_})}(this.i,this.A),2!=this.L&&(Hs(),cn(17)),wr(this),this.s=2,ei(this)):r_(this,this.S-a)};var og=class{constructor(a,_){this.g=a,this.map=_}};function s_(a){this.l=a||10,a=u.PerformanceNavigationTiming?0<(a=u.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function i_(a){return!!a.h||!!a.g&&a.g.size>=a.j}function o_(a){return a.h?1:a.g?a.g.size:0}function yc(a,_){return a.h?a.h==_:!!a.g&&a.g.has(_)}function vc(a,_){a.g?a.g.add(_):a.h=_}function a_(a,_){a.h&&a.h==_?a.h=null:a.g&&a.g.has(_)&&a.g.delete(_)}function l_(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let _=a.i;for(const p of a.g.values())_=_.concat(p.D);return _}return Fe(a.i)}function c_(a,_){if(a.forEach&&"function"==typeof a.forEach)a.forEach(_,void 0);else if(h(a)||"string"==typeof a)Array.prototype.forEach.call(a,_,void 0);else for(var p=function lg(a){if(a.na&&"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(h(a)||"string"==typeof a){var _=[];a=a.length;for(var p=0;p<a;p++)_.push(p);return _}_=[],p=0;for(const b in a)_[p++]=b;return _}}}(a),b=function ag(a){if(a.V&&"function"==typeof a.V)return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(h(a)){for(var _=[],p=a.length,b=0;b<p;b++)_.push(a[b]);return _}for(b in _=[],p=0,a)_[p++]=a[b];return _}(a),re=b.length,ge=0;ge<re;ge++)_.call(void 0,b[ge],p&&p[ge],a)}s_.prototype.cancel=function(){if(this.i=l_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var u_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof xr){this.h=a.h,vo(this,a.j),this.o=a.o,this.g=a.g,wo(this,a.s),this.l=a.l;var _=a.i,p=new ri;p.i=_.i,_.g&&(p.g=new Map(_.g),p.h=_.h),h_(this,p),this.m=a.m}else a&&(_=String(a).match(u_))?(this.h=!1,vo(this,_[1]||"",!0),this.o=ti(_[2]||""),this.g=ti(_[3]||"",!0),wo(this,_[4]),this.l=ti(_[5]||"",!0),h_(this,_[6]||"",!0),this.m=ti(_[7]||"")):(this.h=!1,this.i=new ri(null,this.h))}function Fn(a){return new xr(a)}function vo(a,_,p){a.j=p?ti(_,!0):_,a.j&&(a.j=a.j.replace(/:$/,""))}function wo(a,_){if(_){if(_=Number(_),isNaN(_)||0>_)throw Error("Bad port number "+_);a.s=_}else a.s=null}function h_(a,_,p){_ instanceof ri?(a.i=_,function fg(a,_){_&&!a.j&&(Zn(a),a.i=null,a.g.forEach(function(p,b){var re=b.toLowerCase();b!=re&&(__(this,b),f_(this,re,p))},a)),a.j=_}(a.i,a.h)):(p||(_=ni(_,_g)),a.i=new ri(_,a.h))}function Pt(a,_,p){a.i.set(_,p)}function xo(a){return Pt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ti(a,_){return a?_?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ni(a,_,p){return"string"==typeof a?(a=encodeURI(a).replace(_,ug),p&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function ug(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}xr.prototype.toString=function(){var a=[],_=this.j;_&&a.push(ni(_,d_,!0),":");var p=this.g;return(p||"file"==_)&&(a.push("//"),(_=this.o)&&a.push(ni(_,d_,!0),"@"),a.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(p=this.s)&&a.push(":",String(p))),(p=this.l)&&(this.g&&"/"!=p.charAt(0)&&a.push("/"),a.push(ni(p,"/"==p.charAt(0)?dg:hg,!0))),(p=this.i.toString())&&a.push("?",p),(p=this.m)&&a.push("#",ni(p,mg)),a.join("")};var d_=/[#\/\?@]/g,hg=/[#\?:]/g,dg=/[#\?]/g,_g=/[#\?@]/g,mg=/#/g;function ri(a,_){this.h=this.g=null,this.i=a||null,this.j=!!_}function Zn(a){a.g||(a.g=new Map,a.h=0,a.i&&function cg(a,_){if(a){a=a.split("&");for(var p=0;p<a.length;p++){var b=a[p].indexOf("="),re=null;if(0<=b){var ge=a[p].substring(0,b);re=a[p].substring(b+1)}else ge=a[p];_(ge,re?decodeURIComponent(re.replace(/\+/g," ")):"")}}}(a.i,function(_,p){a.add(decodeURIComponent(_.replace(/\+/g," ")),p)}))}function __(a,_){Zn(a),_=is(a,_),a.g.has(_)&&(a.i=null,a.h-=a.g.get(_).length,a.g.delete(_))}function m_(a,_){return Zn(a),_=is(a,_),a.g.has(_)}function f_(a,_,p){__(a,_),0<p.length&&(a.i=null,a.g.set(is(a,_),Fe(p)),a.h+=p.length)}function is(a,_){return _=String(_),a.j&&(_=_.toLowerCase()),_}function er(a,_,p,b,re){try{re&&(re.onload=null,re.onerror=null,re.onabort=null,re.ontimeout=null),b(p)}catch{}}function yg(){this.g=new eg}function vg(a,_,p){const b=p||"";try{c_(a,function(re,ge){let $e=re;f(re)&&($e=cc(re)),_.push(b+ge+"="+encodeURIComponent($e))})}catch(re){throw _.push(b+"type="+encodeURIComponent("_badmap")),re}}function si(a){this.l=a.Ub||null,this.j=a.eb||!1}function To(a,_){rn.call(this),this.D=a,this.o=_,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function p_(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function ii(a){a.readyState=4,a.l=null,a.j=null,a.v=null,oi(a)}function oi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function g_(a){let _="";return _t(a,function(p,b){_+=b,_+=":",_+=p,_+="\r\n"}),_}function wc(a,_,p){e:{for(b in p){var b=!1;break e}b=!0}b||(p=g_(p),"string"==typeof a?null!=p&&encodeURIComponent(String(p)):Pt(a,_,p))}function zt(a){rn.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ri.prototype).add=function(a,_){Zn(this),this.i=null,a=is(this,a);var p=this.g.get(a);return p||this.g.set(a,p=[]),p.push(_),this.h+=1,this},r.forEach=function(a,_){Zn(this),this.g.forEach(function(p,b){p.forEach(function(re){a.call(_,re,b,this)},this)},this)},r.na=function(){Zn(this);const a=Array.from(this.g.values()),_=Array.from(this.g.keys()),p=[];for(let b=0;b<_.length;b++){const re=a[b];for(let ge=0;ge<re.length;ge++)p.push(_[b])}return p},r.V=function(a){Zn(this);let _=[];if("string"==typeof a)m_(this,a)&&(_=_.concat(this.g.get(is(this,a))));else{a=Array.from(this.g.values());for(let p=0;p<a.length;p++)_=_.concat(a[p])}return _},r.set=function(a,_){return Zn(this),this.i=null,m_(this,a=is(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[_]),this.h+=1,this},r.get=function(a,_){return a&&0<(a=this.V(a)).length?String(a[0]):_},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],_=Array.from(this.g.keys());for(var p=0;p<_.length;p++){var b=_[p];const ge=encodeURIComponent(String(b)),$e=this.V(b);for(b=0;b<$e.length;b++){var re=ge;""!==$e[b]&&(re+="="+encodeURIComponent(String($e[b]))),a.push(re)}}return this.i=a.join("&")},Ie(si,uc),si.prototype.g=function(){return new To(this.l,this.j)},si.prototype.i=function(a){return function(){return a}}({}),Ie(To,rn),(r=To.prototype).open=function(a,_){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=_,this.readyState=1,oi(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const _={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(_.body=a),(this.D||u).fetch(new Request(this.A,_)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ii(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,oi(this)),this.g&&(this.readyState=3,oi(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;p_(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var _=a.value?a.value:new Uint8Array(0);(_=this.v.decode(_,{stream:!a.done}))&&(this.response=this.responseText+=_)}a.done?ii(this):oi(this),3==this.readyState&&p_(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,ii(this))},r.Qa=function(a){this.g&&(this.response=a,ii(this))},r.ga=function(){this.g&&ii(this)},r.setRequestHeader=function(a,_){this.u.append(a,_)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],_=this.h.entries();for(var p=_.next();!p.done;)a.push((p=p.value)[0]+": "+p[1]),p=_.next();return a.join("\r\n")},Object.defineProperty(To.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),Ie(zt,rn);var wg=/^https?$/i,xg=["POST","PUT"];function y_(a,_){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=_,a.m=5,v_(a),bo(a)}function v_(a){a.A||(a.A=!0,ln(a,"complete"),ln(a,"error"))}function w_(a){if(a.h&&typeof o<"u"&&(!a.v[1]||4!=Vn(a)||2!=a.Z()))if(a.u&&4==Vn(a))Gd(a.Ea,0,a);else if(ln(a,"readystatechange"),4==Vn(a)){a.h=!1;try{const $e=a.Z();e:switch($e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var _=!0;break e;default:_=!1}var p;if(!(p=_)){var b;if(b=0===$e){var re=String(a.D).match(u_)[1]||null;!re&&u.self&&u.self.location&&(re=u.self.location.protocol.slice(0,-1)),b=!wg.test(re?re.toLowerCase():"")}p=b}if(p)ln(a,"complete"),ln(a,"success");else{a.m=6;try{var ge=2<Vn(a)?a.g.statusText:""}catch{ge=""}a.l=ge+" ["+a.Z()+"]",v_(a)}}finally{bo(a)}}}function bo(a,_){if(a.g){x_(a);const p=a.g,b=a.v[0]?()=>{}:null;a.g=null,a.v=null,_||ln(a,"ready");try{p.onreadystatechange=b}catch{}}}function x_(a){a.I&&(u.clearTimeout(a.I),a.I=null)}function Vn(a){return a.g?a.g.readyState:0}function T_(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function ai(a,_,p){return p&&p.internalChannelParams&&p.internalChannelParams[a]||_}function b_(a){this.Aa=0,this.i=[],this.j=new Zs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ai("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ai("baseRetryDelayMs",5e3,a),this.cb=ai("retryDelaySeedMs",1e4,a),this.Wa=ai("forwardChannelMaxRetries",2,a),this.wa=ai("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new s_(a&&a.concurrentRequestLimit),this.Da=new yg,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function xc(a){if(I_(a),3==a.G){var _=a.U++,p=Fn(a.I);if(Pt(p,"SID",a.K),Pt(p,"RID",_),Pt(p,"TYPE","terminate"),li(a,p),(_=new Jn(a,a.j,_)).L=2,_.v=xo(Fn(p)),p=!1,u.navigator&&u.navigator.sendBeacon)try{p=u.navigator.sendBeacon(_.v.toString(),"")}catch{}!p&&u.Image&&((new Image).src=_.v,p=!0),p||(_.g=M_(_.j,null),_.g.ea(_.v)),_.F=Date.now(),yo(_)}P_(a)}function Io(a){a.g&&(bc(a),a.g.cancel(),a.g=null)}function I_(a){Io(a),a.u&&(u.clearTimeout(a.u),a.u=null),Ao(a),a.h.cancel(),a.s&&("number"==typeof a.s&&u.clearTimeout(a.s),a.s=null)}function Eo(a){if(!i_(a.h)&&!a.s){a.s=!0;var _=a.Ga;qs||Vd(),Ws||(qs(),Ws=!0),ec.add(_,a),a.B=0}}function E_(a,_){var p;p=_?_.l:a.U++;const b=Fn(a.I);Pt(b,"SID",a.K),Pt(b,"RID",p),Pt(b,"AID",a.T),li(a,b),a.m&&a.o&&wc(b,a.m,a.o),p=new Jn(a,a.j,p,a.B+1),null===a.m&&(p.H=a.o),_&&(a.i=_.D.concat(a.i)),_=A_(a,p,1e3),p.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),vc(a.h,p),fc(p,b,_)}function li(a,_){a.H&&_t(a.H,function(p,b){Pt(_,b,p)}),a.l&&c_({},function(p,b){Pt(_,b,p)})}function A_(a,_,p){p=Math.min(a.i.length,p);var b=a.l?R(a.l.Na,a.l,a):null;e:{var re=a.i;let ge=-1;for(;;){const $e=["count="+p];-1==ge?0<p?(ge=re[0].g,$e.push("ofs="+ge)):ge=0:$e.push("ofs="+ge);let St=!0;for(let Ht=0;Ht<p;Ht++){let bt=re[Ht].g;const sn=re[Ht].map;if(bt-=ge,0>bt)ge=Math.max(0,re[Ht].g-100),St=!1;else try{vg(sn,$e,"req"+bt+"_")}catch{b&&b(sn)}}if(St){b=$e.join("&");break e}}}return a=a.i.splice(0,p),_.D=a,b}function C_(a){if(!a.g&&!a.u){a.Y=1;var _=a.Fa;qs||Vd(),Ws||(qs(),Ws=!0),ec.add(_,a),a.v=0}}function Tc(a){return!(a.g||a.u||3<=a.v||(a.Y++,a.u=Js(R(a.Fa,a),O_(a,a.v)),a.v++,0))}function bc(a){null!=a.A&&(u.clearTimeout(a.A),a.A=null)}function S_(a){a.g=new Jn(a,a.j,"rpc",a.Y),null===a.m&&(a.g.H=a.o),a.g.O=0;var _=Fn(a.qa);Pt(_,"RID","rpc"),Pt(_,"SID",a.K),Pt(_,"AID",a.T),Pt(_,"CI",a.F?"0":"1"),!a.F&&a.ja&&Pt(_,"TO",a.ja),Pt(_,"TYPE","xmlhttp"),li(a,_),a.m&&a.o&&wc(_,a.m,a.o),a.L&&(a.g.I=a.L);var p=a.g;a=a.ia,p.L=1,p.v=xo(Fn(_)),p.m=null,p.P=!0,t_(p,a)}function Ao(a){null!=a.C&&(u.clearTimeout(a.C),a.C=null)}function R_(a,_){var p=null;if(a.g==_){Ao(a),bc(a),a.g=null;var b=2}else{if(!yc(a.h,_))return;p=_.D,a_(a.h,_),b=1}if(0!=a.G)if(_.o)if(1==b){p=_.m?_.m.length:0,_=Date.now()-_.F;var re=a.B;ln(b=fo(),new Hd(b,p)),Eo(a)}else C_(a);else if(3==(re=_.s)||0==re&&0<_.X||!(1==b&&function bg(a,_){return!(o_(a.h)>=a.h.j-(a.s?1:0)||(a.s?(a.i=_.D.concat(a.i),0):1==a.G||2==a.G||a.B>=(a.Va?0:a.Wa)||(a.s=Js(R(a.Ga,a,_),O_(a,a.B)),a.B++,0)))}(a,_)||2==b&&Tc(a)))switch(p&&0<p.length&&(_=a.h,_.i=_.i.concat(p)),re){case 1:Tr(a,5);break;case 4:Tr(a,10);break;case 3:Tr(a,6);break;default:Tr(a,2)}}function O_(a,_){let p=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(p*=2),p*_}function Tr(a,_){if(a.j.info("Error code "+_),2==_){var p=R(a.fb,a),b=a.Xa;const re=!b;b=new xr(b||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||vo(b,"https"),xo(b),re?function pg(a,_){const p=new Zs;if(u.Image){const b=new Image;b.onload=ee(er,p,"TestLoadImage: loaded",!0,_,b),b.onerror=ee(er,p,"TestLoadImage: error",!1,_,b),b.onabort=ee(er,p,"TestLoadImage: abort",!1,_,b),b.ontimeout=ee(er,p,"TestLoadImage: timeout",!1,_,b),u.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=a}else _(!1)}(b.toString(),p):function gg(a,_){new Zs;const b=new AbortController,re=setTimeout(()=>{b.abort(),er(0,0,!1,_)},1e4);fetch(a,{signal:b.signal}).then(ge=>{clearTimeout(re),er(0,0,!!ge.ok,_)}).catch(()=>{clearTimeout(re),er(0,0,!1,_)})}(b.toString(),p)}else cn(2);a.G=0,a.l&&a.l.sa(_),P_(a),I_(a)}function P_(a){if(a.G=0,a.ka=[],a.l){const _=l_(a.h);(0!=_.length||0!=a.i.length)&&(ke(a.ka,_),ke(a.ka,a.i),a.h.i.length=0,Fe(a.i),a.i.length=0),a.l.ra()}}function k_(a,_,p){var b=p instanceof xr?Fn(p):new xr(p);if(""!=b.g)_&&(b.g=_+"."+b.g),wo(b,b.s);else{var re=u.location;b=re.protocol,_=_?_+"."+re.hostname:re.hostname,re=+re.port;var ge=new xr(null);b&&vo(ge,b),_&&(ge.g=_),re&&wo(ge,re),p&&(ge.l=p),b=ge}return _=a.ya,(p=a.D)&&_&&Pt(b,p,_),Pt(b,"VER",a.la),li(a,b),b}function M_(a,_,p){if(_&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(_=new zt(a.Ca&&!a.pa?new si({eb:p}):a.pa)).Ha(a.J),_}function D_(){}function Co(){}function _n(a,_){rn.call(this),this.g=new b_(_),this.l=a,this.h=_&&_.messageUrlParams||null,a=_&&_.messageHeaders||null,_&&_.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=_&&_.initMessageHeaders||null,_&&_.messageContentType&&(a?a["X-WebChannel-Content-Type"]=_.messageContentType:a={"X-WebChannel-Content-Type":_.messageContentType}),_&&_.va&&(a?a["X-WebChannel-Client-Profile"]=_.va:a={"X-WebChannel-Client-Profile":_.va}),this.g.S=a,(a=_&&_.Sb)&&!ot(a)&&(this.g.m=a),this.v=_&&_.supportsCrossDomainXhr||!1,this.u=_&&_.sendRawJson||!1,(_=_&&_.httpSessionIdParam)&&!ot(_)&&(this.g.D=_,null!==(a=this.h)&&_ in a&&_ in(a=this.h)&&delete a[_]),this.j=new os(this)}function F_(a){hc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var _=a.__sm__;if(_){e:{for(const p in _){a=p;break e}a=void 0}(this.i=a)&&(a=this.i,_=null!==_&&a in _?_[a]:void 0),this.data=_}else this.data=a}function V_(){dc.call(this),this.status=1}function os(a){this.g=a}(r=zt.prototype).Ha=function(a){this.J=a},r.ea=function(a,_,p,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);_=_?_.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():_c.g(),this.v=function Wd(a){return a.h||(a.h=a.i())}(this.o?this.o:_c),this.g.onreadystatechange=R(this.Ea,this);try{this.B=!0,this.g.open(_,String(a),!0),this.B=!1}catch(ge){return void y_(this,ge)}if(a=p||"",p=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var re in b)p.set(re,b[re]);else{if("function"!=typeof b.keys||"function"!=typeof b.get)throw Error("Unknown input type for opt_headers: "+String(b));for(const ge of b.keys())p.set(ge,b.get(ge))}b=Array.from(p.keys()).find(ge=>"content-type"==ge.toLowerCase()),re=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(xg,_,void 0))||b||re||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ge,$e]of p)this.g.setRequestHeader(ge,$e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{x_(this),this.u=!0,this.g.send(a),this.u=!1}catch(ge){y_(this,ge)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ln(this,"complete"),ln(this,"abort"),bo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),bo(this,!0)),zt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?w_(this):this.bb())},r.bb=function(){w_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Vn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var _=this.g.responseText;return a&&0==_.indexOf(a)&&(_=_.substring(a.length)),Zp(_)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=b_.prototype).la=8,r.G=1,r.connect=function(a,_,p,b){cn(0),this.W=a,this.H=_||{},p&&void 0!==b&&(this.H.OSID=p,this.H.OAID=b),this.F=this.X,this.I=k_(this,null,this.W),Eo(this)},r.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const re=new Jn(this,this.j,a);let ge=this.o;if(this.S&&(ge?(ge=O(ge),Q(ge,this.S)):ge=this.S),null!==this.m||this.O||(re.H=ge,ge=null),this.P)e:{for(var _=0,p=0;p<this.i.length;p++){var b=this.i[p];if(void 0===(b="__data__"in b.map&&"string"==typeof(b=b.map.__data__)?b.length:void 0))break;if(4096<(_+=b)){_=p;break e}if(4096===_||p===this.i.length-1){_=p+1;break e}}_=1e3}else _=1e3;_=A_(this,re,_),Pt(p=Fn(this.I),"RID",a),Pt(p,"CVER",22),this.D&&Pt(p,"X-HTTP-Session-Id",this.D),li(this,p),ge&&(this.O?_="headers="+encodeURIComponent(String(g_(ge)))+"&"+_:this.m&&wc(p,this.m,ge)),vc(this.h,re),this.Ua&&Pt(p,"TYPE","init"),this.P?(Pt(p,"$req",_),Pt(p,"SID","null"),re.T=!0,fc(re,p,null)):fc(re,p,_),this.G=2}}else 3==this.G&&(a?E_(this,a):0==this.i.length||i_(this.h)||E_(this))},r.Fa=function(){if(this.u=null,S_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Js(R(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,cn(10),Io(this),S_(this))},r.Za=function(){null!=this.C&&(this.C=null,Io(this),Tc(this),cn(19))},r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=D_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Co.prototype.g=function(a,_){return new _n(a,_)},Ie(_n,rn),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){xc(this.g)},_n.prototype.o=function(a){var _=this.g;if("string"==typeof a){var p={};p.__data__=a,a=p}else this.u&&((p={}).__data__=cc(a),a=p);_.i.push(new og(_.Ya++,a)),3==_.G&&Eo(_)},_n.prototype.N=function(){this.g.l=null,delete this.j,xc(this.g),delete this.g,_n.aa.N.call(this)},Ie(F_,hc),Ie(V_,dc),Ie(os,D_),os.prototype.ua=function(){ln(this.g,"a")},os.prototype.ta=function(a){ln(this.g,new F_(a))},os.prototype.sa=function(a){ln(this.g,new V_)},os.prototype.ra=function(){ln(this.g,"b")},Co.prototype.createWebChannel=Co.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,Ee=$.createWebChannelTransport=function(){return new Co},xe=$.getStatEventTarget=function(){return fo()},_e=$.Event=vr,q=$.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},po.NO_ERROR=0,po.TIMEOUT=8,po.HTTP_ERROR=6,I=$.ErrorCode=po,Jd.COMPLETE="complete",B=$.EventType=Jd,Kd.EventType=Xs,Xs.OPEN="a",Xs.CLOSE="b",Xs.ERROR="c",Xs.MESSAGE="d",rn.prototype.listen=rn.prototype.K,Z=$.WebChannel=Kd,Pe=$.FetchXmlHttpFactory=si,zt.prototype.listenOnce=zt.prototype.L,zt.prototype.getLastError=zt.prototype.Ka,zt.prototype.getLastErrorCode=zt.prototype.Ba,zt.prototype.getStatus=zt.prototype.Z,zt.prototype.getResponseJson=zt.prototype.Oa,zt.prototype.getResponseText=zt.prototype.oa,zt.prototype.send=zt.prototype.ea,zt.prototype.setWithCredentials=zt.prototype.Ha,se=$.XhrIo=zt}).apply(typeof j<"u"?j:typeof self<"u"?self:typeof window<"u"?window:{});const ue="@firebase/firestore";class De{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}De.UNAUTHENTICATED=new De(null),De.GOOGLE_CREDENTIALS=new De("google-credentials-uid"),De.FIRST_PARTY=new De("first-party-uid"),De.MOCK_USER=new De("mock-user");let Se="10.13.2";const Xe=new C.Vy("@firebase/firestore");function Ve(){return Xe.logLevel}function pe(r,...e){if(Xe.logLevel<=C.$b.DEBUG){const t=e.map(Ke);Xe.debug(`Firestore (${Se}): ${r}`,...t)}}function Ge(r,...e){if(Xe.logLevel<=C.$b.ERROR){const t=e.map(Ke);Xe.error(`Firestore (${Se}): ${r}`,...t)}}function he(r,...e){if(Xe.logLevel<=C.$b.WARN){const t=e.map(Ke);Xe.warn(`Firestore (${Se}): ${r}`,...t)}}function Ke(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function X(r="Unexpected state"){const e=`FIRESTORE (${Se}) INTERNAL ASSERTION FAILED: `+r;throw Ge(e),new Error(e)}function oe(r,e){r||X()}function we(r,e){return r}const W={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fe extends H.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Dt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nt{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(De.UNAUTHENTICATED))}shutdown(){}}class Et{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ye{constructor(e){this.t=e,this.currentUser=De.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let s=this.i;const i=f=>this.i!==s?(s=this.i,t(f)):Promise.resolve();let o=new lt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new lt,e.enqueueRetryable(()=>i(this.currentUser))};const u=()=>{const f=o;e.enqueueRetryable((0,l.A)(function*(){yield f.promise,yield i(n.currentUser)}))},h=f=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(f=>h(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new lt)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(oe("string"==typeof n.accessToken),new Dt(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return oe(null===e||"string"==typeof e),new De(e)}}class ft{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=De.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Je{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ft(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(De.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ne{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Y{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=i=>{null!=i.error&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const s=i=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(oe("string"==typeof t.token),this.R=t.token,new Ne(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function de(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class N{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=de(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[i]%62))}return n}}function S(r,e){return r<e?-1:r>e?1:0}function M(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}class Te{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new fe(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new fe(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new fe(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new fe(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Te.fromMillis(Date.now())}static fromDate(e){return Te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Te(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?S(this.nanoseconds,e.nanoseconds):S(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ve{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ve(e)}static min(){return new ve(new Te(0,0))}static max(){return new ve(new Te(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ze{constructor(e,t,n){void 0===t?t=0:t>e.length&&X(),void 0===n?n=e.length-t:n>e.length-t&&X(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ze.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ze?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Re extends Ze{construct(e,t,n){return new Re(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new fe(W.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new Re(t)}static emptyPath(){return new Re([])}}const rt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class st extends Ze{construct(e,t,n){return new st(e,t,n)}static isValidIdentifier(e){return rt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),st.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new st(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new fe(W.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;s<e.length;){const u=e[s];if("\\"===u){if(s+1===e.length)throw new fe(W.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new fe(W.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=h,s+=2}else"`"===u?(o=!o,s++):"."!==u||o?(n+=u,s++):(i(),s++)}if(i(),o)throw new fe(W.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new st(t)}static emptyPath(){return new st([])}}class ne{constructor(e){this.path=e}static fromPath(e){return new ne(Re.fromString(e))}static fromName(e){return new ne(Re.fromString(e).popFirst(5))}static empty(){return new ne(Re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Re.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ne(new Re(e.slice()))}}class Ae{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ae(ve.min(),ne.empty(),-1)}static max(){return new Ae(ve.max(),ne.empty(),-1)}}function Ce(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=ne.comparator(r.documentKey,e.documentKey),0!==t?t:S(r.largestBatchId,e.largestBatchId))}const be="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Le{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function qe(r){return Qe.apply(this,arguments)}function Qe(){return(Qe=(0,l.A)(function*(r){if(r.code!==W.FAILED_PRECONDITION||r.message!==be)throw r;pe("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):P.reject(t)}static resolve(e){return new P((t,n)=>{t(e)})}static reject(e){return new P((t,n)=>{n(e)})}static waitFor(e){return new P((t,n)=>{let s=0,i=0,o=!1;e.forEach(u=>{++s,u.next(()=>{++i,o&&i===s&&t()},h=>n(h))}),o=!0,i===s&&t()})}static or(e){let t=P.resolve(!1);for(const n of e)t=t.next(s=>s?P.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,i)=>{n.push(t.call(this,s,i))}),this.waitFor(n)}static mapArray(e,t){return new P((n,s)=>{const i=e.length,o=new Array(i);let u=0;for(let h=0;h<i;h++){const f=h;t(e[f]).next(g=>{o[f]=g,++u,u===i&&n(o)},g=>s(g))}})}static doWhile(e,t){return new P((n,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):n()};i()})}}function ut(r){return"IndexedDbTransactionError"===r.name}let Bt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function gt(r){return null==r}function dn(r){return 0===r&&1/r==-1/0}function je(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function jt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Ec(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Rt{constructor(e,t){this.comparator=e,this.root=t||Yt.EMPTY}insert(e,t){return new Rt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Yt.BLACK,null,null))}remove(e){return new Rt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _i(this.root,e,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _i(this.root,e,this.comparator,!0)}}class _i{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Yt{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Yt.RED,this.left=s??Yt.EMPTY,this.right=i??Yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Yt(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Yt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw X();const e=this.left.check();if(e!==this.right.check())throw X();return e+(this.isRed()?0:1)}}Yt.EMPTY=null,Yt.RED=!0,Yt.BLACK=!1,Yt.EMPTY=new class{constructor(){this.size=0}get key(){throw X()}get value(){throw X()}get color(){throw X()}get left(){throw X()}get right(){throw X()}copy(e,t,n,s,i){return this}insert(e,t,n){return new Yt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class At{constructor(e){this.comparator=e,this.data=new Rt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ac(this.data.getIterator())}getIteratorFrom(e){return new Ac(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class Ac{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class un{constructor(e){this.fields=e,e.sort(st.comparator)}static empty(){return new un([])}unionWith(e){let t=new At(st.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new un(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return M(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Cc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Nt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Cc("Invalid base64 string: "+i):i}}(e);return new Nt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Nt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return S(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Nt.EMPTY_BYTE_STRING=new Nt("");const j_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cn(r){if(oe(!!r),"string"==typeof r){let e=0;const t=j_.exec(r);if(oe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:kt(r.seconds),nanos:kt(r.nanos)}}function kt(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Sn(r){return"string"==typeof r?Nt.fromBase64String(r):Nt.fromUint8Array(r)}function mi(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function fi(r){const e=r.mapValue.fields.__previous_value__;return mi(e)?fi(e):e}function cs(r){const e=Cn(r.mapValue.fields.__local_write_time__.timestampValue);return new Te(e.seconds,e.nanos)}class N_{constructor(e,t,n,s,i,o,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f}}class nr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new nr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof nr&&e.projectId===this.projectId&&e.database===this.database}}const zn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?mi(r)?4:kc(r)?9007199254740991:vi(r)?10:11:X()}function wn(r,e){if(r===e)return!0;const t=Bn(r);if(t!==Bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return cs(r).isEqual(cs(e));case 3:return function(s,i){if("string"==typeof s.timestampValue&&"string"==typeof i.timestampValue&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Cn(s.timestampValue),u=Cn(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return i=e,Sn(r.bytesValue).isEqual(Sn(i.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,i){return kt(s.geoPointValue.latitude)===kt(i.geoPointValue.latitude)&&kt(s.geoPointValue.longitude)===kt(i.geoPointValue.longitude)}(r,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return kt(s.integerValue)===kt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=kt(s.doubleValue),u=kt(i.doubleValue);return o===u?dn(o)===dn(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return M(r.arrayValue.values||[],e.arrayValue.values||[],wn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},u=i.mapValue.fields||{};if(je(o)!==je(u))return!1;for(const h in o)if(o.hasOwnProperty(h)&&(void 0===u[h]||!wn(o[h],u[h])))return!1;return!0}(r,e);default:return X()}var i}function us(r,e){return void 0!==(r.values||[]).find(t=>wn(t,e))}function Ln(r,e){if(r===e)return 0;const t=Bn(r),n=Bn(e);if(t!==n)return S(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return S(r.booleanValue,e.booleanValue);case 2:return function(i,o){const u=kt(i.integerValue||i.doubleValue),h=kt(o.integerValue||o.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(r,e);case 3:return Sc(r.timestampValue,e.timestampValue);case 4:return Sc(cs(r),cs(e));case 5:return S(r.stringValue,e.stringValue);case 6:return function(i,o){const u=Sn(i),h=Sn(o);return u.compareTo(h)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const u=i.split("/"),h=o.split("/");for(let f=0;f<u.length&&f<h.length;f++){const g=S(u[f],h[f]);if(0!==g)return g}return S(u.length,h.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const u=S(kt(i.latitude),kt(o.latitude));return 0!==u?u:S(kt(i.longitude),kt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Rc(r.arrayValue,e.arrayValue);case 10:return function(i,o){var u,h,f,g;const ee=null===(u=(i.fields||{}).value)||void 0===u?void 0:u.arrayValue,Ie=null===(h=(o.fields||{}).value)||void 0===h?void 0:h.arrayValue,Fe=S((null===(f=ee?.values)||void 0===f?void 0:f.length)||0,(null===(g=Ie?.values)||void 0===g?void 0:g.length)||0);return 0!==Fe?Fe:Rc(ee,Ie)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===zn.mapValue&&o===zn.mapValue)return 0;if(i===zn.mapValue)return 1;if(o===zn.mapValue)return-1;const u=i.fields||{},h=Object.keys(u),f=o.fields||{},g=Object.keys(f);h.sort(),g.sort();for(let x=0;x<h.length&&x<g.length;++x){const R=S(h[x],g[x]);if(0!==R)return R;const ee=Ln(u[h[x]],f[g[x]]);if(0!==ee)return ee}return S(h.length,g.length)}(r.mapValue,e.mapValue);default:throw X()}}function Sc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return S(r,e);const t=Cn(r),n=Cn(e),s=S(t.seconds,n.seconds);return 0!==s?s:S(t.nanos,n.nanos)}function Rc(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=Ln(t[s],n[s]);if(i)return i}return S(t.length,n.length)}function Ir(r){return Go(r)}function Go(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Cn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Sn(r.bytesValue).toBase64():"referenceValue"in r?ne.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=Go(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${Go(t.fields[o])}`;return s+"}"}(r.mapValue):X()}function rr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Uo(r){return!!r&&"integerValue"in r}function hs(r){return!!r&&"arrayValue"in r}function Oc(r){return!!r&&"nullValue"in r}function Pc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function yi(r){return!!r&&"mapValue"in r}function vi(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ds(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return jt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ds(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ds(r.arrayValue.values[t]);return e}return Object.assign({},r)}function kc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class Qt{constructor(e){this.value=e}static empty(){return new Qt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!yi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ds(t)}setAll(e){let t=st.emptyPath(),n={},s=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,n,s),n={},s=[],t=u.popLast()}o?n[u.lastSegment()]=ds(o):s.push(u.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());yi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];yi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){jt(t,(s,i)=>e[s]=i);for(const s of n)delete e[s]}clone(){return new Qt(ds(this.value))}}function Vc(r){const e=[];return jt(r.fields,(t,n)=>{const s=new st([t]);if(yi(n)){const i=Vc(n.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new un(e)}class Ot{constructor(e,t,n,s,i,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=u}static newInvalidDocument(e){return new Ot(e,0,ve.min(),ve.min(),ve.min(),Qt.empty(),0)}static newFoundDocument(e,t,n,s){return new Ot(e,1,t,ve.min(),n,s,0)}static newNoDocument(e,t){return new Ot(e,2,t,ve.min(),ve.min(),Qt.empty(),0)}static newUnknownDocument(e,t){return new Ot(e,3,t,ve.min(),ve.min(),Qt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ve.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ve.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gn{constructor(e,t){this.position=e,this.inclusive=t}}function jc(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],o=r.position[s];if(n=i.field.isKeyField()?ne.comparator(ne.fromName(o.referenceValue),t.key):Ln(o,t.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function Nc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!wn(r.position[t],e.position[t]))return!1;return!0}class _s{constructor(e,t="asc"){this.field=e,this.dir=t}}function L_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class zc{}class vt extends zc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new G_(e,t,n):"array-contains"===t?new q_(e,n):"in"===t?new qc(e,n):"not-in"===t?new W_(e,n):"array-contains-any"===t?new K_(e,n):new vt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new U_(e,n):new $_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ln(t,this.value)):null!==t&&Bn(this.value)===Bn(t)&&this.matchesComparison(Ln(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return X()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class It extends zc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new It(e,t)}matches(e){return Er(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Er(r){return"and"===r.op}function qo(r){return function Bc(r){for(const e of r.filters)if(e instanceof It)return!1;return!0}(r)&&Er(r)}function Wo(r){if(r instanceof vt)return r.field.canonicalString()+r.op.toString()+Ir(r.value);if(qo(r))return r.filters.map(e=>Wo(e)).join(",");{const e=r.filters.map(t=>Wo(t)).join(",");return`${r.op}(${e})`}}function Lc(r,e){return r instanceof vt?(n=r,(s=e)instanceof vt&&n.op===s.op&&n.field.isEqual(s.field)&&wn(n.value,s.value)):r instanceof It?function(n,s){return s instanceof It&&n.op===s.op&&n.filters.length===s.filters.length&&n.filters.reduce((i,o,u)=>i&&Lc(o,s.filters[u]),!0)}(r,e):void X();var n,s}function Uc(r){return r instanceof vt?`${(t=r).field.canonicalString()} ${t.op} ${Ir(t.value)}`:r instanceof It?function(t){return t.op.toString()+" {"+t.getFilters().map(Uc).join(" ,")+"}"}(r):"Filter";var t}class G_ extends vt{constructor(e,t,n){super(e,t,n),this.key=ne.fromName(n.referenceValue)}matches(e){const t=ne.comparator(e.key,this.key);return this.matchesComparison(t)}}class U_ extends vt{constructor(e,t){super(e,"in",t),this.keys=$c(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class $_ extends vt{constructor(e,t){super(e,"not-in",t),this.keys=$c(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $c(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>ne.fromName(n.referenceValue))}class q_ extends vt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hs(t)&&us(t.arrayValue,this.value)}}class qc extends vt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&us(this.value.arrayValue,t)}}class W_ extends vt{constructor(e,t){super(e,"not-in",t)}matches(e){if(us(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!us(this.value.arrayValue,t)}}class K_ extends vt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>us(this.value.arrayValue,n))}}class Y_{constructor(e,t=null,n=[],s=[],i=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=u,this.ue=null}}function Ko(r,e=null,t=[],n=[],s=null,i=null,o=null){return new Y_(r,e,t,n,s,i,o)}function sr(r){const e=we(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Wo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(i=n).field.canonicalString()+i.dir;var i}).join(","),gt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Ir(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Ir(n)).join(",")),e.ue=t}return e.ue}function ms(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!L_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Lc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Nc(r.startAt,e.startAt)&&Nc(r.endAt,e.endAt)}function wi(r){return ne.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class Rn{constructor(e,t=null,n=[],s=[],i=null,o="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=h,this.ce=null,this.le=null,this.he=null}}function Ar(r){return new Rn(r)}function Qc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Yo(r){return null!==r.collectionGroup}function Cr(r){const e=we(r);if(null===e.ce){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new At(st.comparator);return o.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new _s(i,n))}),t.has(st.keyField().canonicalString())||e.ce.push(new _s(st.keyField(),n))}return e.ce}function Zt(r){const e=we(r);return e.le||(e.le=function Hc(r,e){if("F"===r.limitType)return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>new _s(s.field,"desc"===s.dir?"asc":"desc"));const t=r.endAt?new Gn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Gn(r.startAt.position,r.startAt.inclusive):null;return Ko(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Cr(r))),e.le}function Qo(r,e){const t=r.filters.concat([e]);return new Rn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ti(r,e,t){return new Rn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function fs(r,e){return ms(Zt(r),Zt(e))&&r.limitType===e.limitType}function Jc(r){return`${sr(Zt(r))}|lt:${r.limitType}`}function Sr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>Uc(s)).join(", ")}]`),gt(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>{return`${(o=s).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Ir(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Ir(s)).join(",")),`Target(${n})`}(Zt(r))}; limitType=${r.limitType})`}function ps(r,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return null!==n.collectionGroup?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):ne.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,s){for(const i of Cr(n))if(!i.field.isKeyField()&&null===s.data.field(i.field))return!1;return!0}(r,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,e)&&(s=e,!((n=r).startAt&&!function(o,u,h){const f=jc(o,u,h);return o.inclusive?f<=0:f<0}(n.startAt,Cr(n),s)||n.endAt&&!function(o,u,h){const f=jc(o,u,h);return o.inclusive?f>=0:f>0}(n.endAt,Cr(n),s)));var n,s}function eu(r){return(e,t)=>{let n=!1;for(const s of Cr(r)){const i=Q_(s,e,t);if(0!==i)return i;n=n||s.field.isKeyField()}return 0}}function Q_(r,e,t){const n=r.field.isKeyField()?ne.comparator(e.key,t.key):function(i,o,u){const h=o.data.field(i),f=u.data.field(i);return null!==h&&null!==f?Ln(h,f):X()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return X()}}class On{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,i]of n)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){jt(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return Ec(this.inner)}size(){return this.innerSize}}const X_=new Rt(ne.comparator);function hn(){return X_}const tu=new Rt(ne.comparator);function gs(...r){let e=tu;for(const t of r)e=e.insert(t.key,t);return e}function nu(r){let e=tu;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function xn(){return ys()}function ru(){return ys()}function ys(){return new On(r=>r.toString(),(r,e)=>r.isEqual(e))}const H_=new Rt(ne.comparator),J_=new At(ne.comparator);function dt(...r){let e=J_;for(const t of r)e=e.add(t);return e}const Z_=new At(S);function Ho(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dn(e)?"-0":e}}function su(r){return{integerValue:""+r}}function iu(r,e){return function jn(r){return"number"==typeof r&&Number.isInteger(r)&&!dn(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?su(e):Ho(r,e)}class bi{constructor(){this._=void 0}}function em(r,e,t){return r instanceof Rr?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&mi(i)&&(i=fi(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):r instanceof ir?au(r,e):r instanceof or?lu(r,e):function(s,i){const o=ou(s,i),u=cu(o)+cu(s.Pe);return Uo(o)&&Uo(s.Pe)?su(u):Ho(s.serializer,u)}(r,e)}function tm(r,e,t){return r instanceof ir?au(r,e):r instanceof or?lu(r,e):t}function ou(r,e){return r instanceof Or?Uo(n=e)||(i=n)&&"doubleValue"in i?e:{integerValue:0}:null;var n,i}class Rr extends bi{}class ir extends bi{constructor(e){super(),this.elements=e}}function au(r,e){const t=uu(e);for(const n of r.elements)t.some(s=>wn(s,n))||t.push(n);return{arrayValue:{values:t}}}class or extends bi{constructor(e){super(),this.elements=e}}function lu(r,e){let t=uu(e);for(const n of r.elements)t=t.filter(s=>!wn(s,n));return{arrayValue:{values:t}}}class Or extends bi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function cu(r){return kt(r.integerValue||r.doubleValue)}function uu(r){return hs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class rm{constructor(e,t){this.version=e,this.transformResults=t}}class Mt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Mt}static exists(e){return new Mt(void 0,e)}static updateTime(e){return new Mt(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ii(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ei{}function hu(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new kr(r.key,Mt.none()):new Pr(r.key,r.data,Mt.none());{const t=r.data,n=Qt.empty();let s=new At(st.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?n.delete(i):n.set(i,o),s=s.add(i)}return new Pn(r.key,n,new un(s.toArray()),Mt.none())}}function sm(r,e,t){r instanceof Pr?function(s,i,o){const u=s.value.clone(),h=mu(s.fieldTransforms,i,o.transformResults);u.setAll(h),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof Pn?function(s,i,o){if(!Ii(s.precondition,i))return void i.convertToUnknownDocument(o.version);const u=mu(s.fieldTransforms,i,o.transformResults),h=i.data;h.setAll(_u(s)),h.setAll(u),i.convertToFoundDocument(o.version,h).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function ws(r,e,t,n){return r instanceof Pr?function(i,o,u,h){if(!Ii(i.precondition,o))return u;const f=i.value.clone(),g=fu(i.fieldTransforms,h,o);return f.setAll(g),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null}(r,e,t,n):r instanceof Pn?function(i,o,u,h){if(!Ii(i.precondition,o))return u;const f=fu(i.fieldTransforms,h,o),g=o.data;return g.setAll(_u(i)),g.setAll(f),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(x=>x.field))}(r,e,t,n):(u=t,Ii(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function im(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=ou(n.transform,s||null);null!=i&&(null===t&&(t=Qt.empty()),t.set(n.field,i))}return t||null}function du(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===s||n&&s&&M(n,s,(i,o)=>function nm(r,e){return r.field.isEqual(e.field)&&(s=e.transform,(n=r.transform)instanceof ir&&s instanceof ir||n instanceof or&&s instanceof or?M(n.elements,s.elements,wn):n instanceof Or&&s instanceof Or?wn(n.Pe,s.Pe):n instanceof Rr&&s instanceof Rr);var n,s}(i,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,s}class Pr extends Ei{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Pn extends Ei{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function _u(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function mu(r,e,t){const n=new Map;oe(r.length===t.length);for(let s=0;s<t.length;s++){const i=r[s],o=i.transform,u=e.data.field(i.field);n.set(i.field,tm(o,u,t[s]))}return n}function fu(r,e,t){const n=new Map;for(const s of r){const i=s.transform,o=t.data.field(s.field);n.set(s.field,em(i,o,e))}return n}class kr extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Jo extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zo{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&sm(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ws(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ru();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let u=this.applyToLocalView(o,i.mutatedFields);u=t.has(s.key)?null:u;const h=hu(o,u);null!==h&&n.set(s.key,h),o.isValidDocument()||o.convertToNoDocument(ve.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),dt())}isEqual(e){return this.batchId===e.batchId&&M(this.mutations,e.mutations,(t,n)=>du(t,n))&&M(this.baseMutations,e.baseMutations,(t,n)=>du(t,n))}}class ea{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){oe(e.mutations.length===n.length);let s=function(){return H_}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new ea(e,t,n,s)}}class ta{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class om{constructor(e,t){this.count=e,this.unchangedNames=t}}var $t,wt;function yu(r){if(void 0===r)return Ge("GRPC error has no .code"),W.UNKNOWN;switch(r){case $t.OK:return W.OK;case $t.CANCELLED:return W.CANCELLED;case $t.UNKNOWN:return W.UNKNOWN;case $t.DEADLINE_EXCEEDED:return W.DEADLINE_EXCEEDED;case $t.RESOURCE_EXHAUSTED:return W.RESOURCE_EXHAUSTED;case $t.INTERNAL:return W.INTERNAL;case $t.UNAVAILABLE:return W.UNAVAILABLE;case $t.UNAUTHENTICATED:return W.UNAUTHENTICATED;case $t.INVALID_ARGUMENT:return W.INVALID_ARGUMENT;case $t.NOT_FOUND:return W.NOT_FOUND;case $t.ALREADY_EXISTS:return W.ALREADY_EXISTS;case $t.PERMISSION_DENIED:return W.PERMISSION_DENIED;case $t.FAILED_PRECONDITION:return W.FAILED_PRECONDITION;case $t.ABORTED:return W.ABORTED;case $t.OUT_OF_RANGE:return W.OUT_OF_RANGE;case $t.UNIMPLEMENTED:return W.UNIMPLEMENTED;case $t.DATA_LOSS:return W.DATA_LOSS;default:return X()}}(wt=$t||($t={}))[wt.OK=0]="OK",wt[wt.CANCELLED=1]="CANCELLED",wt[wt.UNKNOWN=2]="UNKNOWN",wt[wt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wt[wt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wt[wt.NOT_FOUND=5]="NOT_FOUND",wt[wt.ALREADY_EXISTS=6]="ALREADY_EXISTS",wt[wt.PERMISSION_DENIED=7]="PERMISSION_DENIED",wt[wt.UNAUTHENTICATED=16]="UNAUTHENTICATED",wt[wt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wt[wt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wt[wt.ABORTED=10]="ABORTED",wt[wt.OUT_OF_RANGE=11]="OUT_OF_RANGE",wt[wt.UNIMPLEMENTED=12]="UNIMPLEMENTED",wt[wt.INTERNAL=13]="INTERNAL",wt[wt.UNAVAILABLE=14]="UNAVAILABLE",wt[wt.DATA_LOSS=15]="DATA_LOSS";const am=new U([4294967295,4294967295],0);function wu(r){const e=function vu(){return new TextEncoder}().encode(r),t=new k;return t.update(e),new Uint8Array(t.digest())}function xu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new U([t,n],0),new U([s,i],0)]}class na{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new xs(`Invalid padding: ${t}`);if(n<0)throw new xs(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new xs(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new xs(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=U.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(U.fromNumber(n)));return 1===s.compare(am)&&(s=new U([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=wu(e),[n,s]=xu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new na(i,s,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(0===this.Ie)return;const t=wu(e),[n,s]=xu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class xs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ts{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,bs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ts(ve.min(),s,new Rt(S),hn(),dt())}}class bs{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new bs(n,t,dt(),dt(),dt())}}class Ci{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class Tu{constructor(e,t){this.targetId=e,this.me=t}}class bu{constructor(e,t,n=Nt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Iu{constructor(){this.fe=0,this.ge=Au(),this.pe=Nt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=dt(),t=dt(),n=dt();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:X()}}),new bs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Au()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,oe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class lm{constructor(e){this.Le=e,this.Be=new Map,this.ke=hn(),this.qe=Eu(),this.Qe=new Rt(S)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:X()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const i=s.target;if(wi(i))if(0===n){const o=new ne(i.path);this.Ue(t,o,Ot.newNoDocument(o,ve.min()))}else oe(1===n);else{const o=this.Ye(t);if(o!==n){const u=this.Ze(e),h=u?this.Xe(u,e,o):1;0!==h&&(this.je(t),this.Qe=this.Qe.insert(t,2===h?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let o,u;try{o=Sn(n).toUint8Array()}catch(h){if(h instanceof Cc)return he("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new na(o,s,i)}catch(h){return he(h instanceof xs?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(i=>{const o=this.Le.tt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const u=this.Je(o);if(u){if(i.current&&wi(u.target)){const h=new ne(u.target.path);null!==this.ke.get(h)||this.it(o,h)||this.Ue(o,h,Ot.newNoDocument(h,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=dt();this.qe.forEach((i,o)=>{let u=!0;o.forEachWhile(h=>{const f=this.Je(h);return!f||"TargetPurposeLimboResolution"===f.purpose||(u=!1,!1)}),u&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Ts(e,t,this.Qe,this.ke,n);return this.ke=hn(),this.qe=Eu(),this.Qe=new Rt(S),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Iu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new At(S),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||pe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Iu),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Eu(){return new Rt(ne.comparator)}function Au(){return new Rt(ne.comparator)}const cm={asc:"ASCENDING",desc:"DESCENDING"},um={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hm={and:"AND",or:"OR"};class dm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ra(r,e){return r.useProto3Json||gt(e)?e:{value:e}}function Mr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cu(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function _m(r,e){return Mr(r,e.toTimestamp())}function Lt(r){return oe(!!r),ve.fromTimestamp(function(t){const n=Cn(t);return new Te(n.seconds,n.nanos)}(r))}function sa(r,e){return ia(r,e).canonicalString()}function ia(r,e){const t=(s=r,new Re(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===e?t:t.child(e)}function Su(r){const e=Re.fromString(r);return oe(zu(e)),e}function Is(r,e){return sa(r.databaseId,e.path)}function Tn(r,e){const t=Su(e);if(t.get(1)!==r.databaseId.projectId)throw new fe(W.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new fe(W.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new ne(Pu(t))}function Ru(r,e){return sa(r.databaseId,e)}function oa(r){return new Re(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Pu(r){return oe(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function ku(r,e,t){return{name:Is(r,e),fields:t.value.mapValue.fields}}function Du(r,e){return{documents:[Ru(r,e.path)]}}function Si(r,e){const t={structuredQuery:{}},n=e.path;let s;null!==e.collectionGroup?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Ru(r,s);const i=function(f){if(0!==f.length)return Nu(It.create(f,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(f){if(0!==f.length)return f.map(g=>{return{field:Un((R=g).field),direction:ym(R.dir)};var R})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=ra(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(f=e.startAt).inclusive,values:f.position}),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{_t:t,parent:s};var f}function Vu(r){let e=function Ou(r){const e=Su(r);return 4===e.length?Re.emptyPath():Pu(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){oe(1===n);const g=t.from[0];g.allDescendants?s=g.collectionId:e=e.child(g.collectionId)}let i=[];t.where&&(i=function(x){const R=ju(x);return R instanceof It&&qo(R)?R.getFilters():[R]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(R=>{return new _s(Dr((Ie=R).field),function(ke){switch(ke){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Ie.direction));var Ie}));let u=null;t.limit&&(u=function(x){let R;return R="object"==typeof x?x.value:x,gt(R)?null:R}(t.limit));let h=null;var x;t.startAt&&(h=new Gn((x=t.startAt).values||[],!!x.before));let f=null;return t.endAt&&(f=function(x){return new Gn(x.values||[],!x.before)}(t.endAt)),function Yc(r,e,t,n,s,i,o,u){return new Rn(r,e,t,n,s,i,o,u)}(e,s,o,i,u,"F",h,f)}function ju(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Dr(t.unaryFilter.field);return vt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Dr(t.unaryFilter.field);return vt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Dr(t.unaryFilter.field);return vt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Dr(t.unaryFilter.field);return vt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return X()}}(r):void 0!==r.fieldFilter?vt.create(Dr((t=r).fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return X()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return It.create(t.compositeFilter.filters.map(n=>ju(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return X()}}(t.compositeFilter.op))}(r):X();var t}function ym(r){return cm[r]}function vm(r){return um[r]}function wm(r){return hm[r]}function Un(r){return{fieldPath:r.canonicalString()}}function Dr(r){return st.fromServerFormat(r.fieldPath)}function Nu(r){return r instanceof vt?function(t){if("=="===t.op){if(Pc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Pc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Un(t.field),op:vm(t.op),value:t.value}}}(r):r instanceof It?function(t){const n=t.getFilters().map(s=>Nu(s));return 1===n.length?n[0]:{compositeFilter:{op:wm(t.op),filters:n}}}(r):X()}function xm(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function zu(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class kn{constructor(e,t,n,s,i=ve.min(),o=ve.min(),u=Nt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new kn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Bu{constructor(e){this.ct=e}}function la(r){const e=Vu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Ti(e,e.limit,"L"):e}class ur{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(kt(e.integerValue));else if("doubleValue"in e){const n=kt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),dn(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Cn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Sn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?kc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):vi(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):X()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;const i=e.fields||{};this.dt(t,53);const o="value",u=(null===(s=null===(n=i[o].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.dt(t,15),t.At(kt(u)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),ne.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}ur.vt=new ur;class Om{constructor(){this.un=new ma}addToCollectionParentIndex(e,t){return this.un.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Ae.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Ae.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class ma{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new At(Re.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new At(Re.comparator)).toArray()}}new Uint8Array(0);class en{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new en(e,en.DEFAULT_COLLECTION_PERCENTILE,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}en.DEFAULT_COLLECTION_PERCENTILE=10,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,en.DEFAULT=new en(41943040,en.DEFAULT_COLLECTION_PERCENTILE,en.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),en.DISABLED=new en(-1,0,0);class dr{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new dr(0)}static kn(){return new dr(-1)}}class ch{constructor(){this.changes=new On(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Nm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mh{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==n&&ws(n.mutation,s,un.empty(),Te.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,dt()).next(()=>n))}getLocalViewOfDocuments(e,t,n=dt()){const s=xn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(i=>{let o=gs();return i.forEach((u,h)=>{o=o.insert(u,h.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=xn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,dt()))}populateOverlays(e,t,n){const s=[];return n.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,s){let i=hn();const o=ys(),u=ys();return t.forEach((h,f)=>{const g=n.get(f.key);s.has(f.key)&&(void 0===g||g.mutation instanceof Pn)?i=i.insert(f.key,f):void 0!==g?(o.set(f.key,g.mutation.getFieldMask()),ws(g.mutation,f,g.mutation.getFieldMask(),Te.now())):o.set(f.key,un.empty())}),this.recalculateAndSaveOverlays(e,i).next(h=>(h.forEach((f,g)=>o.set(f,g)),t.forEach((f,g)=>{var x;return u.set(f,new Nm(g,null!==(x=o.get(f))&&void 0!==x?x:null))}),u))}recalculateAndSaveOverlays(e,t){const n=ys();let s=new Rt((o,u)=>o-u),i=dt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(h=>{const f=t.get(h);if(null===f)return;let g=n.get(h)||un.empty();g=u.applyToLocalView(f,g),n.set(h,g);const x=(s.get(u.batchId)||dt()).add(h);s=s.insert(u.batchId,x)})}).next(()=>{const o=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,g=h.value,x=ru();g.forEach(R=>{if(!i.has(R)){const ee=hu(t.get(R),n.get(R));null!==ee&&x.set(R,ee),i=i.add(R)}}),o.push(this.documentOverlayCache.saveOverlays(e,f,x))}return P.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return ne.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Yo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var o}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):P.resolve(xn());let u=-1,h=i;return o.next(f=>P.forEach(f,(g,x)=>(u<x.largestBatchId&&(u=x.largestBatchId),i.get(g)?P.resolve():this.remoteDocumentCache.getEntry(e,g).next(R=>{h=h.insert(g,R)}))).next(()=>this.populateOverlays(e,f,i)).next(()=>this.computeViews(e,h,f,dt())).next(g=>({batchId:u,changes:nu(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ne(t)).next(n=>{let s=gs();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let o=gs();return this.indexManager.getCollectionParents(e,i).next(u=>P.forEach(u,h=>{const f=(x=t,R=h.child(i),new Rn(R,null,x.explicitOrderBy.slice(),x.filters.slice(),x.limit,x.limitType,x.startAt,x.endAt));var x,R;return this.getDocumentsMatchingCollectionQuery(e,f,n,s).next(g=>{g.forEach((x,R)=>{o=o.insert(x,R)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(o=>{i.forEach((h,f)=>{const g=f.getKey();null===o.get(g)&&(o=o.insert(g,Ot.newInvalidDocument(g)))});let u=gs();return o.forEach((h,f)=>{const g=i.get(h);void 0!==g&&ws(g.mutation,f,un.empty(),Te.now()),ps(t,f)&&(u=u.insert(h,f))}),u})}}class zm{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return P.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(s=t).id,version:s.version,createTime:Lt(s.createTime)}),P.resolve();var s}getNamedQuery(e,t){return P.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(s=t).name,query:la(s.bundledQuery),readTime:Lt(s.readTime)}),P.resolve();var s}}class Bm{constructor(){this.overlays=new Rt(ne.comparator),this.Ir=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const n=xn();return P.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,i)=>{this.ht(e,t,i)}),P.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Ir.get(n);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){const s=xn(),i=t.length+1,o=new ne(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===i&&h.largestBatchId>n&&s.set(h.getKey(),h)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new Rt((f,g)=>f-g);const o=this.overlays.getIterator();for(;o.hasNext();){const f=o.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>n){let g=i.get(f.largestBatchId);null===g&&(g=xn(),i=i.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const u=xn(),h=i.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,g)=>u.set(f,g)),!(u.size()>=s)););return P.resolve(u)}ht(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const o=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new ta(t,n));let i=this.Ir.get(t);void 0===i&&(i=dt(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class Lm{constructor(){this.sessionToken=Nt.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class fa{constructor(){this.Tr=new At(Wt.Er),this.dr=new At(Wt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Wt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Wt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new ne(new Re([])),n=new Wt(t,e),s=new Wt(t,e+1),i=[];return this.dr.forEachInRange([n,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ne(new Re([])),n=new Wt(t,e),s=new Wt(t,e+1);let i=dt();return this.dr.forEachInRange([n,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Wt(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Wt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ne.comparator(e.key,t.key)||S(e.wr,t.wr)}static Ar(e,t){return S(e.wr,t.wr)||ne.comparator(e.key,t.key)}}class Gm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new At(Wt.Er)}checkEmpty(e){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.Sr;this.Sr++;const o=new Zo(i,t,n,s);this.mutationQueue.push(o);for(const u of s)this.br=this.br.add(new Wt(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.vr(t+1),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Wt(t,0),s=new Wt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,s],o=>{const u=this.Dr(o.wr);i.push(u)}),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new At(S);return t.forEach(s=>{const i=new Wt(s,0),o=new Wt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],u=>{n=n.add(u.wr)})}),P.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;ne.isDocumentKey(i)||(i=i.child(""));const o=new Wt(new ne(i),0);let u=new At(S);return this.br.forEachWhile(h=>{const f=h.key.path;return!!n.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.wr)),!0)},o),P.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const s=this.Dr(n);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){oe(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return P.forEach(t.mutations,s=>{const i=new Wt(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Wt(t,0),s=this.br.firstAfterOrEqual(n);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return P.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Um{constructor(e){this.Mr=e,this.docs=new Rt(ne.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():Ot.newInvalidDocument(t))}getEntries(e,t){let n=hn();return t.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():Ot.newInvalidDocument(s))}),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=hn();const o=t.path,u=new ne(o.child("")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:g}}=h.getNext();if(!o.isPrefixOf(f.path))break;f.path.length>o.length+1||Ce(new Ae((r=g).readTime,r.key,-1),n)<=0||(s.has(g.key)||ps(t,g))&&(i=i.insert(g.key,g.mutableCopy()))}var r;return P.resolve(i)}getAllFromCollectionGroup(e,t,n,s){X()}Or(e,t){return P.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new $m(this)}getSize(e){return P.resolve(this.size)}}class $m extends ch{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),P.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class qm{constructor(e){this.persistence=e,this.Nr=new On(t=>sr(t),ms),this.lastRemoteSnapshotVersion=ve.min(),this.highestTargetId=0,this.Lr=0,this.Br=new fa,this.targetCount=0,this.kr=dr.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),P.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new dr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Kn(t),P.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Nr.forEach((o,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),P.waitFor(i).next(()=>s)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this.Br.containsKey(t))}}class pa{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Bt(0),this.Kr=!1,this.Kr=!0,this.$r=new Lm,this.referenceDelegate=e(this),this.Ur=new qm(this),this.indexManager=new Om,this.remoteDocumentCache=new Um(n=>this.referenceDelegate.Wr(n)),this.serializer=new Bu(t),this.Gr=new zm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Bm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Gm(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){pe("MemoryPersistence","Starting transaction:",e);const s=new Wm(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return P.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Wm extends Le{constructor(e){super(),this.currentSequenceNumber=e}}class Vi{constructor(e){this.persistence=e,this.Jr=new fa,this.Yr=null}static Zr(e){return new Vi(e)}get Xr(){if(this.Yr)return this.Yr;throw X()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),P.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Xr,n=>{const s=ne.fromPath(n);return this.ei(e,s).next(i=>{i||t.removeEntry(s,ve.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return P.or([()=>P.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class wa{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=dt(),s=dt();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new wa(e,t.fromCache,n,s)}}class Ym{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ph{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,H.nr)()?8:function at(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,H.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Ym;return this.Xi(e,t,o).next(u=>{if(i.result=u,this.zi)return this.es(e,t,o,u.size)})}).next(()=>i.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(Ve()<=C.$b.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",Sr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),P.resolve()):(Ve()<=C.$b.DEBUG&&pe("QueryEngine","Query:",Sr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(Ve()<=C.$b.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",Sr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Zt(t))):P.resolve())}Yi(e,t){if(Qc(t))return P.resolve(null);let n=Zt(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=Ti(t,null,"F"),n=Zt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=dt(...i);return this.Ji.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(h=>{const f=this.ts(t,u);return this.ns(t,f,o,h.readTime)?this.Yi(e,Ti(t,null,"F")):this.rs(e,f,t,h)}))})))}Zi(e,t,n,s){return Qc(t)||s.isEqual(ve.min())?P.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,s)?P.resolve(null):(Ve()<=C.$b.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Sr(t)),this.rs(e,o,t,function le(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=ve.fromTimestamp(1e9===n?new Te(t+1,0):new Te(t,n));return new Ae(s,ne.empty(),e)}(s,-1)).next(u=>u))})}ts(e,t){let n=new At(eu(e));return t.forEach((s,i)=>{ps(e,i)&&(n=n.add(i))}),n}ns(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,n){return Ve()<=C.$b.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",Sr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ae.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class Qm{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Rt(S),this._s=new On(i=>sr(i),ms),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function yh(r,e){return xa.apply(this,arguments)}function xa(){return(xa=(0,l.A)(function*(r,e){const t=we(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],u=[];let h=dt();for(const f of s){o.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}for(const f of i){u.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}return t.localDocuments.getDocuments(n,h).next(f=>({hs:f,removedBatchIds:o,addedBatchIds:u}))})})})).apply(this,arguments)}function vh(r){const e=we(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Jm(r,e){const t=we(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Br(r,e,t){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,l.A)(function*(r,e,t){const n=we(r),s=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!ut(o))throw o;pe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(s.target)})).apply(this,arguments)}function zi(r,e,t){const n=we(r);let s=ve.min(),i=dt();return n.persistence.runTransaction("Execute query","readwrite",o=>function(h,f,g){const x=we(h),R=x._s.get(g);return void 0!==R?P.resolve(x.os.get(R)):x.Ur.getTargetData(f,g)}(n,o,Zt(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,u.targetId).next(h=>{i=h})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?s:ve.min(),t?i:dt())).next(u=>(function bh(r,e,t){let n=r.us.get(e)||ve.min();t.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}(n,function Zc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),u),{documents:u,Ts:i})))}class Ca{constructor(){this.activeTargetIds=function Xo(){return Z_}()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ah{constructor(){this.so=new Ca,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Ca,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class tf{_o(e){}shutdown(){}}class Ch{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){pe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){pe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Gi=null;function Ra(){return null===Gi?Gi=268435456+Math.round(2147483648*Math.random()):Gi++,"0x"+Gi.toString(16)}const nf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class rf{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const tn="WebChannelConnection";class sf extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co="(default)"===this.databaseId.database?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,n,s,i,o){const u=Ra(),h=this.xo(t,n.toUriEncodedString());pe("RestConnection",`Sending RPC '${t}' ${u}:`,h,s);const f={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(f,i,o),this.No(t,h,f,s).then(g=>(pe("RestConnection",`Received RPC '${t}' ${u}: `,g),g),g=>{throw he("RestConnection",`RPC '${t}' ${u} failed with error: `,g,"url: ",h,"request:",s),g})}Lo(t,n,s,i,o,u){return this.Mo(t,n,s,i,o)}Oo(t,n,s){t["X-Goog-Api-Client"]="gl-js/ fire/"+Se,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,n){return`${this.Do}/v1/${n}:${nf[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){const i=Ra();return new Promise((o,u)=>{const h=new se;h.setWithCredentials(!0),h.listenOnce(B.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case I.NO_ERROR:const g=h.getResponseJson();pe(tn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(g)),o(g);break;case I.TIMEOUT:pe(tn,`RPC '${e}' ${i} timed out`),u(new fe(W.DEADLINE_EXCEEDED,"Request time out"));break;case I.HTTP_ERROR:const x=h.getStatus();if(pe(tn,`RPC '${e}' ${i} failed with status:`,x,"response text:",h.getResponseText()),x>0){let R=h.getResponseJson();Array.isArray(R)&&(R=R[0]);const ee=R?.error;if(ee&&ee.status&&ee.message){const Ie=function(ke){const He=ke.toLowerCase().replace(/_/g,"-");return Object.values(W).indexOf(He)>=0?He:W.UNKNOWN}(ee.status);u(new fe(Ie,ee.message))}else u(new fe(W.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new fe(W.UNAVAILABLE,"Connection failed."));break;default:X()}}finally{pe(tn,`RPC '${e}' ${i} completed.`)}});const f=JSON.stringify(s);pe(tn,`RPC '${e}' ${i} sending request:`,s),h.send(t,"POST",f,n,15)})}Bo(e,t,n){const s=Ra(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ee(),u=xe(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.xmlHttpFactory=new Pe({})),this.Oo(h.initMessageHeaders,t,n),h.encodeInitMessageHeaders=!0;const g=i.join("");pe(tn,`Creating RPC '${e}' stream ${s}: ${g}`,h);const x=o.createWebChannel(g,h);let R=!1,ee=!1;const Ie=new rf({Io:ke=>{ee?pe(tn,`Not sending because RPC '${e}' stream ${s} is closed:`,ke):(R||(pe(tn,`Opening RPC '${e}' stream ${s} transport.`),x.open(),R=!0),pe(tn,`RPC '${e}' stream ${s} sending:`,ke),x.send(ke))},To:()=>x.close()}),Fe=(ke,He,ot)=>{ke.listen(He,et=>{try{ot(et)}catch(ht){setTimeout(()=>{throw ht},0)}})};return Fe(x,Z.EventType.OPEN,()=>{ee||(pe(tn,`RPC '${e}' stream ${s} transport opened.`),Ie.yo())}),Fe(x,Z.EventType.CLOSE,()=>{ee||(ee=!0,pe(tn,`RPC '${e}' stream ${s} transport closed`),Ie.So())}),Fe(x,Z.EventType.ERROR,ke=>{ee||(ee=!0,he(tn,`RPC '${e}' stream ${s} transport errored:`,ke),Ie.So(new fe(W.UNAVAILABLE,"The operation could not be completed")))}),Fe(x,Z.EventType.MESSAGE,ke=>{var He;if(!ee){const ot=ke.data[0];oe(!!ot);const ht=ot.error||(null===(He=ot[0])||void 0===He?void 0:He.error);if(ht){pe(tn,`RPC '${e}' stream ${s} received error:`,ht);const Tt=ht.status;let _t=function(F){const Q=$t[F];if(void 0!==Q)return yu(Q)}(Tt),K=ht.message;void 0===_t&&(_t=W.INTERNAL,K="Unknown error status: "+Tt+" with message "+ht.message),ee=!0,Ie.So(new fe(_t,K)),x.close()}else pe(tn,`RPC '${e}' stream ${s} received:`,ot),Ie.bo(ot)}}),Fe(u,_e.STAT_EVENT,ke=>{ke.stat===q.PROXY?pe(tn,`RPC '${e}' stream ${s} detected buffering proxy`):ke.stat===q.NOPROXY&&pe(tn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{Ie.wo()},0),Ie}}function Ui(){return typeof document<"u"?document:null}function Ms(r){return new dm(r,!0)}class Oa{constructor(e,t,n=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&pe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Rh{constructor(e,t,n,s,i,o,u,h){this.ui=e,this.Ho=n,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Oa(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,l.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,l.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,l.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===W.RESOURCE_EXHAUSTED?(Ge(t.toString()),Ge("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===W.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{const s=new fe(W.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>1==++this.e_?this.E_(s):this.onNext(s))})}i_(){var e=this;this.state=5,this.t_.Go((0,l.A)(function*(){e.state=0,e.start()}))}I_(e){return pe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(pe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class of extends Rh{constructor(e,t,n,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function fm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:X(),s=e.targetChange.targetIds||[],i=function(f,g){return f.useProto3Json?(oe(void 0===g||"string"==typeof g),Nt.fromBase64String(g||"")):(oe(void 0===g||g instanceof Buffer||g instanceof Uint8Array),Nt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(f){const g=void 0===f.code?W.UNKNOWN:yu(f.code);return new fe(g,f.message||"")}(o);t=new bu(n,s,i,u||null)}else if("documentChange"in e){const n=e.documentChange,s=Tn(r,n.document.name),i=Lt(n.document.updateTime),o=n.document.createTime?Lt(n.document.createTime):ve.min(),u=new Qt({mapValue:{fields:n.document.fields}}),h=Ot.newFoundDocument(s,i,o,u);t=new Ci(n.targetIds||[],n.removedTargetIds||[],h.key,h)}else if("documentDelete"in e){const n=e.documentDelete,s=Tn(r,n.document),i=n.readTime?Lt(n.readTime):ve.min(),o=Ot.newNoDocument(s,i);t=new Ci([],n.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const n=e.documentRemove,s=Tn(r,n.document);t=new Ci([],n.removedTargetIds||[],s,null)}else{if(!("filter"in e))return X();{const n=e.filter,{count:s=0,unchangedNames:i}=n,o=new om(s,i);t=new Tu(n.targetId,o)}}var f;return t}(this.serializer,e),n=function(i){if(!("targetChange"in i))return ve.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ve.min():o.readTime?Lt(o.readTime):ve.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=oa(this.serializer),t.addTarget=function(i,o){let u;const h=o.target;if(u=wi(h)?{documents:Du(i,h)}:{query:Si(i,h)._t},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=Cu(i,o.resumeToken);const f=ra(i,o.expectedCount);null!==f&&(u.expectedCount=f)}else if(o.snapshotVersion.compareTo(ve.min())>0){u.readTime=Mr(i,o.snapshotVersion.toTimestamp());const f=ra(i,o.expectedCount);null!==f&&(u.expectedCount=f)}return u}(this.serializer,e);const n=function gm(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return X()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=oa(this.serializer),t.removeTarget=e,this.a_(t)}}class af extends Rh{constructor(e,t,n,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return oe(!!e.streamToken),this.lastStreamToken=e.streamToken,oe(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){oe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function pm(r,e){return r&&r.length>0?(oe(void 0!==e),r.map(t=>function(s,i){let o=Lt(s.updateTime?s.updateTime:i);return o.isEqual(ve.min())&&(o=Lt(i)),new rm(o,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Lt(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=oa(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Es(r,e){let t;if(e instanceof Pr)t={update:ku(r,e.key,e.value)};else if(e instanceof kr)t={delete:Is(r,e.key)};else if(e instanceof Pn)t={update:ku(r,e.key,e.data),updateMask:xm(e.fieldMask)};else{if(!(e instanceof Jo))return X();t={verify:Is(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const u=o.transform;if(u instanceof Rr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ir)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof or)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Or)return{fieldPath:o.field.canonicalString(),increment:u.Pe};throw X()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:_m(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:X()),t;var i}(this.serializer,n))};this.a_(t)}}class lf extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new fe(W.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,ia(t,n),s,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new fe(W.UNKNOWN,i.toString())})}Lo(e,t,n,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Lo(e,ia(t,n),s,o,u,i)).catch(o=>{throw"FirebaseError"===o.name?(o.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new fe(W.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class cf{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Ge(t),this.D_=!1):pe("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class uf{constructor(e,t,n,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(u=>{n.enqueueAndForget((0,l.A)(function*(){var h;Kn(o)&&(pe("RemoteStore","Restarting streams for network reachability change."),yield(h=(0,l.A)(function*(g){const x=we(g);x.L_.add(4),yield Lr(x),x.q_.set("Unknown"),x.L_.delete(4),yield Ds(x)}),function f(g){return h.apply(this,arguments)})(o))}))}),this.q_=new cf(n,s)}}function Ds(r){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,l.A)(function*(r){if(Kn(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Lr(r){return ka.apply(this,arguments)}function ka(){return(ka=(0,l.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function $i(r,e){const t=we(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Fa(t)?Da(t):$r(t).r_()&&Ma(t,e))}function Gr(r,e){const t=we(r),n=$r(t);t.N_.delete(e),n.r_()&&Oh(t,e),0===t.N_.size&&(n.r_()?n.o_():Kn(t)&&t.q_.set("Unknown"))}function Ma(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ve.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}$r(r).A_(e)}function Oh(r,e){r.Q_.xe(e),$r(r).R_(e)}function Da(r){r.Q_=new lm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),$r(r).start(),r.q_.v_()}function Fa(r){return Kn(r)&&!$r(r).n_()&&r.N_.size>0}function Kn(r){return 0===we(r).L_.size}function Ph(r){r.Q_=void 0}function hf(r){return Va.apply(this,arguments)}function Va(){return(Va=(0,l.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function df(r){return ja.apply(this,arguments)}function ja(){return(ja=(0,l.A)(function*(r){r.N_.forEach((e,t)=>{Ma(r,e)})})).apply(this,arguments)}function _f(r,e){return Na.apply(this,arguments)}function Na(){return(Na=(0,l.A)(function*(r,e){Ph(r),Fa(r)?(r.q_.M_(e),Da(r)):r.q_.set("Unknown")})).apply(this,arguments)}function mf(r,e,t){return za.apply(this,arguments)}function za(){return za=(0,l.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof bu&&2===e.state&&e.cause)try{yield(n=(0,l.A)(function*(i,o){const u=o.cause;for(const h of o.targetIds)i.N_.has(h)&&(yield i.remoteSyncer.rejectListen(h,u),i.N_.delete(h),i.Q_.removeTarget(h))}),function s(i,o){return n.apply(this,arguments)})(r,e)}catch(n){pe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield qi(r,n)}else if(e instanceof Ci?r.Q_.Ke(e):e instanceof Tu?r.Q_.He(e):r.Q_.We(e),!t.isEqual(ve.min()))try{const n=yield vh(r.localStore);t.compareTo(n)>=0&&(yield function(i,o){const u=i.Q_.rt(o);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const g=i.N_.get(f);g&&i.N_.set(f,g.withResumeToken(h.resumeToken,o))}}),u.targetMismatches.forEach((h,f)=>{const g=i.N_.get(h);if(!g)return;i.N_.set(h,g.withResumeToken(Nt.EMPTY_BYTE_STRING,g.snapshotVersion)),Oh(i,h);const x=new kn(g.target,h,f,g.sequenceNumber);Ma(i,x)}),i.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){pe("RemoteStore","Failed to raise snapshot:",n),yield qi(r,n)}var n}),za.apply(this,arguments)}function qi(r,e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,l.A)(function*(r,e,t){if(!ut(e))throw e;r.L_.add(1),yield Lr(r),r.q_.set("Offline"),t||(t=()=>vh(r.localStore)),r.asyncQueue.enqueueRetryable((0,l.A)(function*(){pe("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Ds(r)}))})).apply(this,arguments)}function kh(r,e){return e().catch(t=>qi(r,t,e))}function Ur(r){return La.apply(this,arguments)}function La(){return(La=(0,l.A)(function*(r){const e=we(r),t=Yn(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;ff(e);)try{const s=yield Jm(e.localStore,n);if(null===s){0===e.O_.length&&t.o_();break}n=s.batchId,pf(e,s)}catch(s){yield qi(e,s)}Mh(e)&&Dh(e)})).apply(this,arguments)}function ff(r){return Kn(r)&&r.O_.length<10}function pf(r,e){r.O_.push(e);const t=Yn(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Mh(r){return Kn(r)&&!Yn(r).n_()&&r.O_.length>0}function Dh(r){Yn(r).start()}function gf(r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,l.A)(function*(r){Yn(r).p_()})).apply(this,arguments)}function yf(r){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,l.A)(function*(r){const e=Yn(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function vf(r,e,t){return $a.apply(this,arguments)}function $a(){return($a=(0,l.A)(function*(r,e,t){const n=r.O_.shift(),s=ea.from(n,e,t);yield kh(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Ur(r)})).apply(this,arguments)}function wf(r,e){return qa.apply(this,arguments)}function qa(){return qa=(0,l.A)(function*(r,e){var t;e&&Yn(r).V_&&(yield(t=(0,l.A)(function*(s,i){if(function gu(r){switch(r){default:return X();case W.CANCELLED:case W.UNKNOWN:case W.DEADLINE_EXCEEDED:case W.RESOURCE_EXHAUSTED:case W.INTERNAL:case W.UNAVAILABLE:case W.UNAUTHENTICATED:return!1;case W.INVALID_ARGUMENT:case W.NOT_FOUND:case W.ALREADY_EXISTS:case W.PERMISSION_DENIED:case W.FAILED_PRECONDITION:case W.ABORTED:case W.OUT_OF_RANGE:case W.UNIMPLEMENTED:case W.DATA_LOSS:return!0}}(u=i.code)&&u!==W.ABORTED){const o=s.O_.shift();Yn(s).s_(),yield kh(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Ur(s)}var u}),function n(s,i){return t.apply(this,arguments)})(r,e)),Mh(r)&&Dh(r)}),qa.apply(this,arguments)}function Fh(r,e){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,l.A)(function*(r,e){const t=we(r);t.asyncQueue.verifyOperationInProgress(),pe("RemoteStore","RemoteStore received new credentials");const n=Kn(t);t.L_.add(3),yield Lr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Ds(t)})).apply(this,arguments)}function Ka(r,e){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,l.A)(function*(r,e){const t=we(r);e?(t.L_.delete(2),yield Ds(t)):e||(t.L_.add(2),yield Lr(t),t.q_.set("Unknown"))})).apply(this,arguments)}function $r(r){return r.K_||(r.K_=function(t,n,s){const i=we(t);return i.w_(),new of(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:hf.bind(null,r),Ro:df.bind(null,r),mo:_f.bind(null,r),d_:mf.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.K_.s_(),Fa(r)?Da(r):r.q_.set("Unknown")):(yield r.K_.stop(),Ph(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Yn(r){return r.U_||(r.U_=function(t,n,s){const i=we(t);return i.w_(),new af(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:gf.bind(null,r),mo:wf.bind(null,r),f_:yf.bind(null,r),g_:vf.bind(null,r)}),r.B_.push(function(){var e=(0,l.A)(function*(t){t?(r.U_.s_(),yield Ur(r)):(yield r.U_.stop(),r.O_.length>0&&(pe("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Qa{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const o=Date.now()+n,u=new Qa(e,t,o,s,i);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new fe(W.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qr(r,e){if(Ge("AsyncQueue",`${e}: ${r}`),ut(r))return new fe(W.UNAVAILABLE,`${e}: ${r}`);throw r}class Wr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ne.comparator(t.key,n.key):(t,n)=>ne.comparator(t.key,n.key),this.keyedMap=gs(),this.sortedSet=new Rt(this.comparator)}static emptySet(e){return new Wr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Wr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Vh{constructor(){this.W_=new Rt(ne.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):X():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Kr{constructor(e,t,n,s,i,o,u,h,f){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,n,s,i){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new Kr(e,t,Wr.emptySet(t),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class xf{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Tf{constructor(){this.queries=jh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const s=we(t),i=s.queries;s.queries=jh(),i.forEach((o,u)=>{for(const h of u.j_)h.onError(n)})}(this,new fe(W.ABORTED,"Firestore shutting down"))}}function jh(){return new On(r=>Jc(r),fs)}function Xa(r,e){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,l.A)(function*(r,e){const t=we(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(n=2):(i=new xf,n=e.J_()?0:1);try{switch(n){case 0:i.z_=yield t.onListen(s,!0);break;case 1:i.z_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){const u=qr(o,`Initialization of query '${Sr(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&el(t)})).apply(this,arguments)}function Ja(r,e){return Za.apply(this,arguments)}function Za(){return(Za=(0,l.A)(function*(r,e){const t=we(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),0===i.j_.length?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function bf(r,e){const t=we(r);let n=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const u of o.j_)u.X_(s)&&(n=!0);o.z_=s}}n&&el(t)}function If(r,e,t){const n=we(r),s=n.queries.get(e);if(s)for(const i of s.j_)i.onError(t);n.queries.delete(e)}function el(r){r.Y_.forEach(e=>{e.next()})}var tl,Nh;(Nh=tl||(tl={})).ea="default",Nh.Cache="cache";class nl{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)3!==s.type&&n.push(s);e=new Kr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=Kr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==tl.Cache}}class Lh{constructor(e){this.key=e}}class Gh{constructor(e){this.key=e}}class Uh{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=dt(),this.mutatedKeys=dt(),this.Aa=eu(e),this.Ra=new Wr(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Vh,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,u=!1;const h="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,f="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((g,x)=>{const R=s.get(g),ee=ps(this.query,x)?x:null,Ie=!!R&&this.mutatedKeys.has(R.key),Fe=!!ee&&(ee.hasLocalMutations||this.mutatedKeys.has(ee.key)&&ee.hasCommittedMutations);let ke=!1;R&&ee?R.data.isEqual(ee.data)?Ie!==Fe&&(n.track({type:3,doc:ee}),ke=!0):this.ga(R,ee)||(n.track({type:2,doc:ee}),ke=!0,(h&&this.Aa(ee,h)>0||f&&this.Aa(ee,f)<0)&&(u=!0)):!R&&ee?(n.track({type:0,doc:ee}),ke=!0):R&&!ee&&(n.track({type:1,doc:R}),ke=!0,(h||f)&&(u=!0)),ke&&(ee?(o=o.add(ee),i=Fe?i.add(g):i.delete(g)):(o=o.delete(g),i=i.delete(g)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const g="F"===this.query.limitType?o.last():o.first();o=o.delete(g.key),i=i.delete(g.key),n.track({type:1,doc:g})}return{Ra:o,fa:n,ns:u,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((g,x)=>function(ee,Ie){const Fe=ke=>{switch(ke){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return X()}};return Fe(ee)-Fe(Ie)}(g.type,x.type)||this.Aa(g.doc,x.doc)),this.pa(n),s=null!=s&&s;const u=t&&!s?this.ya():[],h=0===this.da.size&&this.current&&!s?1:0,f=h!==this.Ea;return this.Ea=h,0!==o.length||f?{snapshot:new Kr(this.query,e.Ra,i,o,e.mutatedKeys,0===h,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Vh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=dt(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Gh(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Lh(n))}),t}ba(e){this.Ta=e.Ts,this.da=dt();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Kr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Cf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Sf{constructor(e){this.key=e,this.va=!1}}class Rf{constructor(e,t,n,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new On(u=>Jc(u),fs),this.Ma=new Map,this.xa=new Set,this.Oa=new Rt(ne.comparator),this.Na=new Map,this.La=new fa,this.Ba={},this.ka=new Map,this.qa=dr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function Of(r,e){return rl.apply(this,arguments)}function rl(){return(rl=(0,l.A)(function*(r,e,t=!0){const n=Wi(r);let s;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=yield $h(n,e,t,!0),s})).apply(this,arguments)}function Pf(r,e){return sl.apply(this,arguments)}function sl(){return(sl=(0,l.A)(function*(r,e){const t=Wi(r);yield $h(t,e,!0,!1)})).apply(this,arguments)}function $h(r,e,t,n){return il.apply(this,arguments)}function il(){return(il=(0,l.A)(function*(r,e,t,n){const s=yield function zr(r,e){const t=we(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(i=>i?(s=i,P.resolve(s)):t.Ur.allocateTargetId(n).next(o=>(s=new kn(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.os.get(n.targetId);return(null===s||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}(r.localStore,Zt(e)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let u;return n&&(u=yield function ol(r,e,t,n,s){return al.apply(this,arguments)}(r,e,i,"current"===o,s.resumeToken)),r.isPrimaryClient&&t&&$i(r.remoteStore,s),u})).apply(this,arguments)}function al(){return al=(0,l.A)(function*(r,e,t,n,s){r.Ka=(x,R,ee)=>{return(Ie=(0,l.A)(function*(ke,He,ot,et){let ht=He.view.ma(ot);ht.ns&&(ht=yield zi(ke.localStore,He.query,!1).then(({documents:O})=>He.view.ma(O,ht)));const Tt=et&&et.targetChanges.get(He.targetId),_t=et&&null!=et.targetMismatches.get(He.targetId),K=He.view.applyChanges(ht,ke.isPrimaryClient,Tt,_t);return yl(ke,He.targetId,K.wa),K.snapshot}),function Fe(ke,He,ot,et){return Ie.apply(this,arguments)})(r,x,R,ee);var Ie};const i=yield zi(r.localStore,e,!0),o=new Uh(e,i.Ts),u=o.ma(i.documents),h=bs.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,s),f=o.applyChanges(u,r.isPrimaryClient,h);yl(r,t,f.wa);const g=new Cf(e,t,o);return r.Fa.set(e,g),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),f.snapshot}),al.apply(this,arguments)}function kf(r,e,t){return ll.apply(this,arguments)}function ll(){return(ll=(0,l.A)(function*(r,e,t){const n=we(r),s=n.Fa.get(e),i=n.Ma.get(s.targetId);if(i.length>1)return n.Ma.set(s.targetId,i.filter(o=>!fs(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Br(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Gr(n.remoteStore,s.targetId),Yr(n,s.targetId)}).catch(qe))):(Yr(n,s.targetId),yield Br(n.localStore,s.targetId,!0))})).apply(this,arguments)}function Mf(r,e){return cl.apply(this,arguments)}function cl(){return(cl=(0,l.A)(function*(r,e){const t=we(r),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&1===s.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Gr(t.remoteStore,n.targetId))})).apply(this,arguments)}function ul(){return(ul=(0,l.A)(function*(r,e,t){const n=function Rl(r){const e=we(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jf.bind(null,e),e}(r);try{const s=yield function(o,u){const h=we(o),f=Te.now(),g=u.reduce((ee,Ie)=>ee.add(Ie.key),dt());let x,R;return h.persistence.runTransaction("Locally write mutations","readwrite",ee=>{let Ie=hn(),Fe=dt();return h.cs.getEntries(ee,g).next(ke=>{Ie=ke,Ie.forEach((He,ot)=>{ot.isValidDocument()||(Fe=Fe.add(He))})}).next(()=>h.localDocuments.getOverlayedDocuments(ee,Ie)).next(ke=>{x=ke;const He=[];for(const ot of u){const et=im(ot,x.get(ot.key).overlayedDocument);null!=et&&He.push(new Pn(ot.key,et,Vc(et.value.mapValue),Mt.exists(!0)))}return h.mutationQueue.addMutationBatch(ee,f,He,u)}).next(ke=>{R=ke;const He=ke.applyToLocalDocumentSet(x,Fe);return h.documentOverlayCache.saveOverlays(ee,ke.batchId,He)})}).then(()=>({batchId:R.batchId,changes:nu(x)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,u,h){let f=o.Ba[o.currentUser.toKey()];f||(f=new Rt(S)),f=f.insert(u,h),o.Ba[o.currentUser.toKey()]=f}(n,s.batchId,t),yield Mn(n,s.changes),yield Ur(n.remoteStore)}catch(s){const i=qr(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function qh(r,e){return hl.apply(this,arguments)}function hl(){return(hl=(0,l.A)(function*(r,e){const t=we(r);try{const n=yield function Hm(r,e){const t=we(r),n=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const u=[];e.targetChanges.forEach((g,x)=>{const R=s.get(x);if(!R)return;u.push(t.Ur.removeMatchingKeys(i,g.removedDocuments,x).next(()=>t.Ur.addMatchingKeys(i,g.addedDocuments,x)));let ee=R.withSequenceNumber(i.currentSequenceNumber);var Fe,ke,He;null!==e.targetMismatches.get(x)?ee=ee.withResumeToken(Nt.EMPTY_BYTE_STRING,ve.min()).withLastLimboFreeSnapshotVersion(ve.min()):g.resumeToken.approximateByteSize()>0&&(ee=ee.withResumeToken(g.resumeToken,n)),s=s.insert(x,ee),ke=ee,He=g,(0===(Fe=R).resumeToken.approximateByteSize()||ke.snapshotVersion.toMicroseconds()-Fe.snapshotVersion.toMicroseconds()>=3e8||He.addedDocuments.size+He.modifiedDocuments.size+He.removedDocuments.size>0)&&u.push(t.Ur.updateTargetData(i,ee))});let h=hn(),f=dt();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(i,g))}),u.push(function wh(r,e,t){let n=dt(),s=dt();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=hn();return t.forEach((u,h)=>{const f=i.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(ve.min())?(e.removeEntry(u,h.readTime),o=o.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||0===h.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(h),o=o.insert(u,h)):pe("LocalStore","Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)}),{Ps:o,Is:s}})}(i,o,e.documentUpdates).next(g=>{h=g.Ps,f=g.Is})),!n.isEqual(ve.min())){const g=t.Ur.getLastRemoteSnapshotVersion(i).next(x=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(g)}return P.waitFor(u).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,h,f)).next(()=>h)}).then(i=>(t.os=s,i))}(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(oe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?oe(o.va):s.removedDocuments.size>0&&(oe(o.va),o.va=!1))}),yield Mn(t,n,e)}catch(n){yield qe(n)}})).apply(this,arguments)}function Wh(r,e,t){const n=we(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const s=[];n.Fa.forEach((i,o)=>{const u=o.view.Z_(e);u.snapshot&&s.push(u.snapshot)}),function(o,u){const h=we(o);h.onlineState=u;let f=!1;h.queries.forEach((g,x)=>{for(const R of x.j_)R.Z_(u)&&(f=!0)}),f&&el(h)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Ff(r,e,t){return dl.apply(this,arguments)}function dl(){return(dl=(0,l.A)(function*(r,e,t){const n=we(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Na.get(e),i=s&&s.key;if(i){let o=new Rt(ne.comparator);o=o.insert(i,Ot.newNoDocument(i,ve.min()));const u=dt().add(i),h=new Ts(ve.min(),new Map,new Rt(S),o,u);yield qh(n,h),n.Oa=n.Oa.remove(i),n.Na.delete(e),vl(n)}else yield Br(n.localStore,e,!1).then(()=>Yr(n,e,t)).catch(qe)})).apply(this,arguments)}function Vf(r,e){return _l.apply(this,arguments)}function _l(){return(_l=(0,l.A)(function*(r,e){const t=we(r),n=e.batch.batchId;try{const s=yield function Xm(r,e){const t=we(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,h,f,g){const x=f.batch,R=x.keys();let ee=P.resolve();return R.forEach(Ie=>{ee=ee.next(()=>g.getEntry(h,Ie)).next(Fe=>{const ke=f.docVersions.get(Ie);oe(null!==ke),Fe.version.compareTo(ke)<0&&(x.applyToRemoteDocument(Fe,f),Fe.isValidDocument()&&(Fe.setReadTime(f.commitVersion),g.addEntry(Fe)))})}),ee.next(()=>u.mutationQueue.removeMutationBatch(h,x))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let h=dt();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}(t.localStore,e);gl(t,n,null),pl(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Mn(t,s)}catch(s){yield qe(s)}})).apply(this,arguments)}function jf(r,e,t){return ml.apply(this,arguments)}function ml(){return(ml=(0,l.A)(function*(r,e,t){const n=we(r);try{const s=yield function(o,u){const h=we(o);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return h.mutationQueue.lookupMutationBatch(f,u).next(x=>(oe(null!==x),g=x.keys(),h.mutationQueue.removeMutationBatch(f,x))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,g,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>h.localDocuments.getDocuments(f,g))})}(n.localStore,e);gl(n,e,t),pl(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Mn(n,s)}catch(s){yield qe(s)}})).apply(this,arguments)}function pl(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function gl(r,e,t){const n=we(r);let s=n.Ba[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function Yr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Kh(r,n)})}function Kh(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Gr(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),vl(r))}function yl(r,e,t){for(const n of t)n instanceof Lh?(r.La.addReference(n.key,e),zf(r,n)):n instanceof Gh?(pe("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Kh(r,n.key)):X()}function zf(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(pe("SyncEngine","New document in limbo: "+t),r.xa.add(n),vl(r))}function vl(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new ne(Re.fromString(e)),n=r.qa.next();r.Na.set(n,new Sf(t)),r.Oa=r.Oa.insert(t,n),$i(r.remoteStore,new kn(Zt(Ar(t.path)),n,"TargetPurposeLimboResolution",Bt.oe))}}function Mn(r,e,t){return wl.apply(this,arguments)}function wl(){return wl=(0,l.A)(function*(r,e,t){const n=we(r),s=[],i=[],o=[];var u;n.Fa.isEmpty()||(n.Fa.forEach((u,h)=>{o.push(n.Ka(h,e,t).then(f=>{var g;if((f||t)&&n.isPrimaryClient){const x=f?!f.fromCache:null===(g=t?.targetChanges.get(h.targetId))||void 0===g?void 0:g.current;n.sharedClientState.updateQueryState(h.targetId,x?"current":"not-current")}if(f){s.push(f);const x=wa.Wi(h.targetId,f);i.push(x)}}))}),yield Promise.all(o),n.Ca.d_(s),yield(u=(0,l.A)(function*(f,g){const x=we(f);try{yield x.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>P.forEach(g,ee=>P.forEach(ee.$i,Ie=>x.persistence.referenceDelegate.addReference(R,ee.targetId,Ie)).next(()=>P.forEach(ee.Ui,Ie=>x.persistence.referenceDelegate.removeReference(R,ee.targetId,Ie)))))}catch(R){if(!ut(R))throw R;pe("LocalStore","Failed to update sequence numbers: "+R)}for(const R of g){const ee=R.targetId;if(!R.fromCache){const Ie=x.os.get(ee),ke=Ie.withLastLimboFreeSnapshotVersion(Ie.snapshotVersion);x.os=x.os.insert(ee,ke)}}}),function h(f,g){return u.apply(this,arguments)})(n.localStore,i))}),wl.apply(this,arguments)}function Bf(r,e){return xl.apply(this,arguments)}function xl(){return(xl=(0,l.A)(function*(r,e){const t=we(r);if(!t.currentUser.isEqual(e)){pe("SyncEngine","User change. New user:",e.toKey());const n=yield yh(t.localStore,e);t.currentUser=e,(i=t).ka.forEach(u=>{u.forEach(h=>{h.reject(new fe(W.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Mn(t,n.hs)}var i})).apply(this,arguments)}function Lf(r,e){const t=we(r),n=t.Na.get(e);if(n&&n.va)return dt().add(n.key);{let s=dt();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const u=t.Fa.get(o);s=s.unionWith(u.view.Va)}return s}}function Wi(r){const e=we(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=qh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Lf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ff.bind(null,e),e.Ca.d_=bf.bind(null,e.eventManager),e.Ca.$a=If.bind(null,e.eventManager),e}class Qr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,l.A)(function*(){t.serializer=Ms(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function gh(r,e,t,n){return new Qm(r,e,t,n)}(this.persistence,new ph,e.initialUser,this.serializer)}createPersistence(e){return new pa(Vi.Zr,this.serializer)}createSharedClientState(e){return new Ah}terminate(){var e=this;return(0,l.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Xr{initialize(e,t){var n=this;return(0,l.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=s=>Wh(n.syncEngine,s,1),n.remoteStore.remoteSyncer.handleCredentialChange=Bf.bind(null,n.syncEngine),yield Ka(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Tf}createDatastore(e){const t=Ms(e.databaseInfo.databaseId),n=new sf(e.databaseInfo);return new lf(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,s=this.datastore,i=e.asyncQueue,o=t=>Wh(this.syncEngine,t,0),u=Ch.D()?new Ch:new tf,new uf(n,s,i,o,u);var n,s,i,o,u}createSyncEngine(e,t){return function(s,i,o,u,h,f,g){const x=new Rf(s,i,o,u,h,f);return g&&(x.Qa=!0),x}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,l.A)(function*(){var t,n,s;yield(s=(0,l.A)(function*(o){const u=we(o);pe("RemoteStore","RemoteStore shutting down."),u.L_.add(5),yield Lr(u),u.k_.shutdown(),u.q_.set("Unknown")}),function i(o){return s.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}class Ki{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Ge("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ep{constructor(e,t,n,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=De.UNAUTHENTICATED,this.clientId=N.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var o=(0,l.A)(function*(u){pe("FirestoreClient","Received user=",u.uid),yield i.authCredentialListener(u),i.user=u});return function(u){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(n,o=>(pe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new fe(W.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,l.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const s=qr(n,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Yi(r,e){return Pl.apply(this,arguments)}function Pl(){return Pl=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),pe("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var s=(0,l.A)(function*(i){n.isEqual(i)||(yield yh(e.localStore,i),n=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Pl.apply(this,arguments)}function kl(r,e){return Ml.apply(this,arguments)}function Ml(){return(Ml=(0,l.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function Dl(r){return Fl.apply(this,arguments)}(r);pe("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Fh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Fh(e.remoteStore,s)),r._onlineComponents=e})).apply(this,arguments)}function Fl(){return(Fl=(0,l.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){pe("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Yi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Jh(r){return"FirebaseError"===r.name?r.code===W.FAILED_PRECONDITION||r.code===W.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}(t))throw t;he("Error using user provided cache. Falling back to memory cache: "+t),yield Yi(r,new Qr)}}else pe("FirestoreClient","Using default OfflineComponentProvider"),yield Yi(r,new Qr);return r._offlineComponents})).apply(this,arguments)}function Qi(r){return Vl.apply(this,arguments)}function Vl(){return(Vl=(0,l.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(pe("FirestoreClient","Using user provided OnlineComponentProvider"),yield kl(r,r._uninitializedComponentsProvider._online)):(pe("FirestoreClient","Using default OnlineComponentProvider"),yield kl(r,new Xr))),r._onlineComponents})).apply(this,arguments)}function Jr(r){return Nl.apply(this,arguments)}function Nl(){return(Nl=(0,l.A)(function*(r){const e=yield Qi(r),t=e.eventManager;return t.onListen=Of.bind(null,e.syncEngine),t.onUnlisten=kf.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Pf.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Mf.bind(null,e.syncEngine),t})).apply(this,arguments)}function sd(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const id=new Map;function zl(r,e,t){if(!t)throw new fe(W.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function od(r){if(!ne.isDocumentKey(r))throw new fe(W.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ad(r){if(ne.isDocumentKey(r))throw new fe(W.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Xi(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":X()}function pt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new fe(W.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xi(r);throw new fe(W.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class cd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new fe(W.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new fe(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function dp(r,e,t,n){if(!0===e&&!0===n)throw new fe(W.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=sd(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new fe(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new fe(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new fe(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Fs{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new fe(W.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new fe(W.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cd(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new nt;switch(n.type){case"firstParty":return new Je(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new fe(W.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=id.get(t);n&&(pe("ComponentProvider","Removing Datastore"),id.delete(t),n.terminate())}(this),Promise.resolve()}}class Xt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Xt(this.firestore,e,this._query)}}class Gt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gt(this.firestore,e,this._key)}}class bn extends Xt{constructor(e,t,n){super(e,t,Ar(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gt(this.firestore,null,new ne(e))}withConverter(e){return new bn(this.firestore,e,this._path)}}function Vs(r,e,...t){if(r=(0,H.Ku)(r),zl("collection","path",e),r instanceof Fs){const n=Re.fromString(e,...t);return ad(n),new bn(r,null,n)}{if(!(r instanceof Gt||r instanceof bn))throw new fe(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Re.fromString(e,...t));return ad(n),new bn(r.firestore,null,n)}}function Zr(r,e,...t){if(r=(0,H.Ku)(r),1===arguments.length&&(e=N.newId()),zl("doc","path",e),r instanceof Fs){const n=Re.fromString(e,...t);return od(n),new Gt(r,null,new ne(n))}{if(!(r instanceof Gt||r instanceof bn))throw new fe(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Re.fromString(e,...t));return od(n),new Gt(r.firestore,r instanceof bn?r.converter:null,new ne(n))}}class mp{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Oa(this,"async_queue_retry"),this.Eu=()=>{const t=Ui();t&&pe("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=Ui();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=Ui();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new lt;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,l.A)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!ut(t))throw t;pe("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,Ge("INTERNAL UNHANDLED ERROR: ",function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),u}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const s=Qa.createAndSchedule(this,e,t,n,i=>this.Vu(i));return this.lu.push(s),s}du(){this.hu&&X()}verifyOperationInProgress(){}mu(){var e=this;return(0,l.A)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function Bl(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const s=t;for(const i of["next","error","complete"])if(i in s&&"function"==typeof s[i])return!0;return!1}(r)}class Ct extends Fs{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new mp,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||hd(this),this._firestoreClient.terminate()}}function Ll(r,e){const t="object"==typeof r?r:(0,m.getApp)(),n="string"==typeof r?r:e||"(default)",s=(0,m._getProvider)(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=(0,H.yU)("firestore");i&&function _p(r,e,t,n={}){var s;const i=(r=pt(r,Fs))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&he("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let u,h;if("string"==typeof n.mockUserToken)u=n.mockUserToken,h=De.MOCK_USER;else{u=(0,H.Fy)(n.mockUserToken,null===(s=r._app)||void 0===s?void 0:s.options.projectId);const f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new fe(W.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new De(f)}r._authCredentials=new Et(new Dt(u,h))}}(s,...i)}return s}function Ft(r){return r._firestoreClient||hd(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function hd(r){var e,t,n;const s=r._freezeSettings(),i=(h=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new N_(r._databaseId,h,r._persistenceKey,(g=s).host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,sd(g.experimentalLongPollingOptions),g.useFetchStreams));var h,g;r._firestoreClient=new ep(r._authCredentials,r._appCheckCredentials,r._queue,i),null!==(t=s.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=s.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class mr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new mr(Nt.fromBase64String(e))}catch(t){throw new fe(W.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new mr(Nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class fr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new fe(W.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class es{constructor(e){this._methodName=e}}class Gl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new fe(W.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new fe(W.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return S(this._lat,e._lat)||S(this._long,e._long)}}class Hi{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,e._values)}}const yp=/^__.*__$/;class vp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Pn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pr(e,this.data,t,this.fieldTransforms)}}function fd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw X()}}class Ji{constructor(e,t,n,s,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.yu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new Ji(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.vu(e),s}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:n,Du:!1});return s.yu(),s}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return to(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if(fd(this.wu)&&yp.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class wp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ms(e)}Nu(e,t,n,s=!1){return new Ji({wu:e,methodName:t,Ou:n,path:st.emptyPath(),Du:!1,xu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pr(r){const e=r._freezeSettings(),t=Ms(r._databaseId);return new wp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Zi(r,e,t,n,s,i={}){const o=r.Nu(i.merge||i.mergeFields?2:0,e,t,s);Ql("Data must be an object, but it was:",o,n);const u=yd(n,o);let h,f;if(i.merge)h=new un(o.fieldMask),f=o.fieldTransforms;else if(i.mergeFields){const g=[];for(const x of i.mergeFields){const R=zs(e,x,t);if(!o.contains(R))throw new fe(W.INVALID_ARGUMENT,`Field '${R}' is specified in your field mask but missing from your input data.`);wd(g,R)||g.push(R)}h=new un(g),f=o.fieldTransforms.filter(x=>h.covers(x.field))}else h=null,f=o.fieldTransforms;return new vp(new Qt(u),h,f)}function gr(r,e){if(vd(r=(0,H.Ku)(r)))return Ql("Unsupported field value:",e,r),yd(r,e);if(r instanceof es)return function(n,s){if(!fd(s.wu))throw s.Mu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Mu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,s){const i=[];let o=0;for(const u of n){let h=gr(u,s.Fu(o));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,s){if(null===(n=(0,H.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return iu(s.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const i=Te.fromDate(n);return{timestampValue:Mr(s.serializer,i)}}if(n instanceof Te){const i=new Te(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Mr(s.serializer,i)}}if(n instanceof Gl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof mr)return{bytesValue:Cu(s.serializer,n._byteString)};if(n instanceof Gt){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:sa(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Hi)return u=s,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(h=>{if("number"!=typeof h)throw u.Mu("VectorValues must only contain numeric values.");return Ho(u.serializer,h)})}}}}};var u;throw s.Mu(`Unsupported field value: ${Xi(n)}`)}(r,e)}function yd(r,e){const t={};return Ec(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jt(r,(n,s)=>{const i=gr(s,e.bu(n));null!=i&&(t[n]=i)}),{mapValue:{fields:t}}}function vd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Te||r instanceof Gl||r instanceof mr||r instanceof Gt||r instanceof es||r instanceof Hi)}function Ql(r,e,t){if(!vd(t)||"object"!=typeof(s=t)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){const n=Xi(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var s}function zs(r,e,t){if((e=(0,H.Ku)(e))instanceof fr)return e._internalPath;if("string"==typeof e)return eo(r,e);throw to("Field path arguments must be of type string or ",r,!1,void 0,t)}const xp=new RegExp("[~\\*/\\[\\]]");function eo(r,e,t){if(e.search(xp)>=0)throw to(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new fr(...e.split("."))._internalPath}catch{throw to(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function to(r,e,t,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${n}`),o&&(h+=` in document ${s}`),h+=")"),new fe(W.INVALID_ARGUMENT,u+r+h)}function wd(r,e){return r.some(t=>t.isEqual(e))}class Bs{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Gt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Tp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Tp extends Bs{data(){return super.data()}}function no(r,e){return"string"==typeof e?eo(r,e):e instanceof fr?e._internalPath:e._delegate._internalPath}function xd(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new fe(W.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xl{}class Ls extends Xl{}function Td(r,e,...t){let n=[];e instanceof Xl&&n.push(e),n=n.concat(t),function(i){const o=i.filter(h=>h instanceof ts).length,u=i.filter(h=>h instanceof Gs).length;if(o>1||o>0&&u>0)throw new fe(W.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class Gs extends Ls{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Gs(e,t,n)}_apply(e){const t=this._parse(e);return Cd(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t))}_parse(e){const t=pr(e.firestore);return function(i,o,u,h,f,g,x){let R;if(f.isKeyField()){if("array-contains"===g||"array-contains-any"===g)throw new fe(W.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if("in"===g||"not-in"===g){Ad(x,g);const ee=[];for(const Ie of x)ee.push(Ed(h,i,Ie));R={arrayValue:{values:ee}}}else R=Ed(h,i,x)}else"in"!==g&&"not-in"!==g&&"array-contains-any"!==g||Ad(x,g),R=function gd(r,e,t,n=!1){return gr(t,r.Nu(n?4:3,e))}(u,"where",x,"in"===g||"not-in"===g);return vt.create(f,g,R)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function bd(r,e,t){const n=e,s=no("where",r);return Gs._create(s,n,t)}class ts extends Xl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ts(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:It.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(s,i){let o=s;const u=i.getFlattenedFilters();for(const h of u)Cd(o,h),o=Qo(o,h)}(e._query,t),new Xt(e.firestore,e.converter,Qo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ed(r,e,t){if("string"==typeof(t=(0,H.Ku)(t))){if(""===t)throw new fe(W.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yo(e)&&-1!==t.indexOf("/"))throw new fe(W.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Re.fromString(t));if(!ne.isDocumentKey(n))throw new fe(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rr(r,new ne(n))}if(t instanceof Gt)return rr(r,t._key);throw new fe(W.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xi(t)}.`)}function Ad(r,e){if(!Array.isArray(r)||0===r.length)throw new fe(W.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Cd(r,e){const t=function(s,i){for(const o of s)for(const u of o.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new fe(W.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Rd{convertValue(e,t="none"){switch(Bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw X()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return jt(e,(s,i)=>{n[s]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,s;const i=null===(s=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map(o=>kt(o.doubleValue));return new Hi(i)}convertGeoPoint(e){return new Gl(kt(e.latitude),kt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=fi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cs(e));default:return null}}convertTimestamp(e){const t=Cn(e);return new Te(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Re.fromString(e);oe(zu(n));const s=new nr(n.get(1),n.get(3)),i=new ne(n.popFirst(5));return s.isEqual(t)||Ge(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class yr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ns extends Bs{constructor(e,t,n,s,i,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ao(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ao extends ns{data(e={}){return super.data(e)}}class rs{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new yr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ao(this._firestore,this._userDataWriter,n.key,n,new yr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new fe(W.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(u=>({type:"added",doc:new ao(s._firestore,s._userDataWriter,u.doc.key,u.doc,new yr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:o++}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const h=new ao(s._firestore,s._userDataWriter,u.doc.key,u.doc,new yr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,g=-1;return 0!==u.type&&(f=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),g=o.indexOf(u.doc.key)),{type:Ep(u.type),doc:h,oldIndex:f,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ep(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return X()}}class Qn extends Rd{constructor(e){super(),this.firestore=e}convertBytes(e){return new mr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Gt(this.firestore,null,t)}}function Od(r){r=pt(r,Xt);const e=pt(r.firestore,Ct),t=Ft(e),n=new Qn(e);return xd(r._query),function rd(r,e,t={}){const n=new lt;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,f){const g=new Ki({next:R=>{o.enqueueAndForget(()=>Ja(i,x)),R.fromCache&&"server"===h.source?f.reject(new fe(W.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(R)},error:R=>f.reject(R)}),x=new nl(u,g,{includeMetadataChanges:!0,_a:!0});return Xa(i,x)}(yield Jr(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(s=>new rs(e,n,r,s))}function Pd(r,e,t){r=pt(r,Gt);const n=pt(r.firestore,Ct),s=function oo(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return Us(n,[Zi(pr(n),"setDoc",r._key,s,null!==r.converter,t).toMutation(r._key,Mt.none())])}function lo(r,...e){var t,n,s;r=(0,H.Ku)(r);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Bl(e[o])||(i=e[o],o++);const u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Bl(e[o])){const x=e[o];e[o]=null===(t=x.next)||void 0===t?void 0:t.bind(x),e[o+1]=null===(n=x.error)||void 0===n?void 0:n.bind(x),e[o+2]=null===(s=x.complete)||void 0===s?void 0:s.bind(x)}let h,f,g;if(r instanceof Gt)f=pt(r.firestore,Ct),g=Ar(r._key.path),h={next:x=>{e[o]&&e[o](Jl(f,r,x))},error:e[o+1],complete:e[o+2]};else{const x=pt(r,Xt);f=pt(x.firestore,Ct),g=x._query;const R=new Qn(f);h={next:ee=>{e[o]&&e[o](new rs(f,R,x,ee))},error:e[o+1],complete:e[o+2]},xd(r._query)}return function(R,ee,Ie,Fe){const ke=new Ki(Fe),He=new nl(ee,ke,Ie);return R.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Xa(yield Jr(R),He)})),()=>{ke.za(),R.asyncQueue.enqueueAndForget((0,l.A)(function*(){return Ja(yield Jr(R),He)}))}}(Ft(f),g,u,h)}function Us(r,e){return function(n,s){const i=new lt;return n.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function Df(r,e,t){return ul.apply(this,arguments)}(yield function jl(r){return Qi(r).then(e=>e.syncEngine)}(n),s,i)})),i.promise}(Ft(r),e)}function Jl(r,e,t){const n=t.docs.get(e._key),s=new Qn(r);return new ns(r,s,e._key,n,new yr(t.hasPendingWrites,t.fromCache),e.converter)}!function(e,t=!0){Se=m.SDK_VERSION,(0,m._registerComponent)(new w.uA("firestore",(n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),u=new Ct(new Ye(n.getProvider("auth-internal")),new Y(n.getProvider("app-check-internal")),function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new fe(W.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nr(f.options.projectId,g)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,m.registerVersion)(ue,"4.7.2",e),(0,m.registerVersion)(ue,"4.7.2","esm2017")}();var qt=v(51698),Fd=v(43234),uo=v(48891),Bp=v(30531),Lp=v(36484),Gp=v(62095);let Up=(()=>{var r;class e{examSessions_read(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=yield s._getDocument(u.data,"exam_sessions/"+n,s.getUserId());i.next({success:1,data:h,message:"successful"}),i.complete()}catch(g){console.log(g),i.next({success:0,data:"",message:""+g}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_write(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_sessions/"+n,i.getUserId(),s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(x){console.log(x),o.next({success:0,data:"",message:""+x}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_writeUserMap(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success&&h.data)try{var f=yield i._saveDocumentMerge(h.data,"exam_sessions/"+n,"user_map",s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(x){console.log(x),o.next({success:0,data:"",message:""+x}),o.complete()}else o.next({success:0,data:"",message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())})}examSessions_delete(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{yield s._removeDocument(u.data,"exam_sessions/"+n,s.getUserId()),i.next({success:1,data:"",message:"successful"}),i.complete()}catch(f){console.log(f),i.next({success:0,data:"",message:""+f}),i.complete()}else i.next({success:0,data:"",message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribeUserMap(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,"user_map",x=>{i.next({success:1,data:x,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(x){console.log(x),i.next({success:0,data:void 0,message:""+x}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_sessions/"+n,s.getUserId(),x=>{i.next({success:1,data:x,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,h)}catch(x){console.log(x),i.next({success:0,data:void 0,message:""+x}),i.complete()}else i.next({success:0,data:void 0,message:u.message}),i.complete()});return function(u){return o.apply(this,arguments)}}())})}examSessions_unsubscribe(n){this.removeAllunsubscribe("exam_sessions_"+n)}examSessions_subscribeWithQuery(n,s){var i=this;return new qt.c(s&&3==s.length?o=>{this.getFirestoreDb(!1).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=i.myOnSnapshotCollectionWithQuery(h.data,"exam_sessions/"+n,s,R=>{o.next({success:1,data:R,message:"successful"}),o.complete()});i.addUnsubscribe("exam_sessions_"+n,f)}catch(R){console.log(R),o.next({success:0,data:void 0,message:""+R}),o.complete()}else o.next({success:0,data:void 0,message:h.message}),o.complete()});return function(h){return u.apply(this,arguments)}}())}:o=>{o.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),o.complete(),o.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshotCollection(u.data,"exam_live_teachers/"+n,f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_teachers_"+n,h)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_teachers_"+n)}examLiveTeachers_teacher_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_live_teachers/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._getDocuments(h.data,"exam_lives/"+n,s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,l.A)(function*(u){if(u&&1==u.success)try{var h=s.myOnSnapshot(u.data,"exam_live_students/"+n,s.getUserId(),f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_students_"+n,h)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(u)});return function(u){return o.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_teacher_subscribe(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=i.myOnSnapshot(h.data,"exam_live_students/"+n,s,g=>{o.next({success:1,data:g})});i.addUnsubscribe("exam_live_students_"+n,f)}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_student_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var u=(0,l.A)(function*(h){if(h&&1==h.success)try{var f=yield i._saveDocument(h.data,"exam_live_students/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(g){console.log(g),o.next({success:0,message:"EXCEPTION",ex:g.toString()})}else o.next(h)});return function(h){return u.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(n,s,i){var o=this;return new qt.c(u=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var h=(0,l.A)(function*(f){if(f&&1==f.success)try{var g=yield o._saveDocumentMerge(f.data,"exam_live_students/"+n,s,i);u.next({success:1,data:g})}catch(x){console.log(x),u.next({success:0,message:"EXCEPTION",ex:x.toString()})}else u.next(f)});return function(f){return h.apply(this,arguments)}}())})}getFirestoreDb(n){return new qt.c(s=>{var i=this.createFirestoreKey("firestore_db"),o=this.getLocalFirestoreDb(i);null!=o&&0==n?(s.next({success:1,data:o,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(h=>{h&&1==h.success?(0,c.p)(this.getAuthApp(),h?.data?.token??"").then(()=>{var g=Ll(this.app);this.setLocalFirestoreDb(i,g),s.next({success:1,data:g,message:"successful"}),s.complete()}).catch(g=>{"auth/invalid-custom-token"===g.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:h.message??""}),s.complete())})})}getFirestoreDbForStudentExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_student_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,c.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var x=Ll(this.app);this.setLocalFirestoreDb(o,x),i.next({success:1,data:x,message:"successful"}),i.complete()}).catch(x=>{"auth/invalid-custom-token"===x.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}getFirestoreDbForTeacherExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_teacher_"+s),u=this.getLocalFirestoreDb(o);null!=u&&0==n?(i.next({success:1,data:u,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,c.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var x=Ll(this.app);this.setLocalFirestoreDb(o,x),i.next({success:1,data:x,message:"successful"}),i.complete()}).catch(x=>{"auth/invalid-custom-token"===x.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}signInUserByToken(n){return new qt.c(s=>{(0,c.p)(this.getAuthApp(),n).then(()=>{s.next({success:1,data:"",message:"successful"}),s.complete()}).catch(i=>{"auth/invalid-custom-token"===i.code?(s.next({success:0,data:"",message:"EXPIRED"}),s.complete()):(s.next({success:0,data:"",message:"AUTH_ERROR"}),s.complete())})})}setLocalFirestoreDb(n,s){this.firestoreDbs[n]=s}getLocalFirestoreDb(n){if(this.firestoreDbs.hasOwnProperty(n))return this.firestoreDbs[n]}removeLocalFirestoreDb(n){this.firestoreDbs.hasOwnProperty(n)&&delete this.firestoreDbs[n]}createFirestoreKey(n){return this.userService.getUserObj().id+"_"+n}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(n,s){n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)||(this.listSubscribers[n]=[]),this.listSubscribers[n].push(s)}removeAllunsubscribe(n){if(n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)){for(var s=0;s<this.listSubscribers[n].length;s++)this.listSubscribers[n][s]();delete this.listSubscribers[n]}}_saveDocument(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield Pd(Zr(n,s,i),u.commonSerivce.myClone(o)),i})()}_saveDocumentMerge(n,s,i,o){var u=this;return(0,l.A)(function*(){return s=u.getBaseFirestore()+"/"+s,yield Pd(Zr(n,s,i),u.commonSerivce.myClone(o),{merge:!0}),i})()}_getCollection(n,s){var i=this;return(0,l.A)(function*(){s=i.getBaseFirestore()+"/"+s;const o=Vs(n,s);return(yield Od(o)).docs.map(f=>f.data())})()}_getDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s;const u=Zr(n,s,i),h=yield function Ap(r){r=pt(r,Gt);const e=pt(r.firestore,Ct);return function nd(r,e,t={}){const n=new lt;return r.asyncQueue.enqueueAndForget((0,l.A)(function*(){return function(i,o,u,h,f){const g=new Ki({next:R=>{o.enqueueAndForget(()=>Ja(i,x));const ee=R.docs.has(u);!ee&&R.fromCache?f.reject(new fe(W.UNAVAILABLE,"Failed to get document because the client is offline.")):ee&&R.fromCache&&h&&"server"===h.source?f.reject(new fe(W.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(R)},error:R=>f.reject(R)}),x=new nl(Ar(u.path),g,{includeMetadataChanges:!0,_a:!0});return Xa(i,x)}(yield Jr(r),r.asyncQueue,e,t,n)})),n.promise}(Ft(e),r._key).then(t=>Jl(e,r,t))}(u);return h.exists()?h.data():null})()}_getDocuments(n,s,i){var o=this;return(0,l.A)(function*(){var u={};s=o.getBaseFirestore()+"/"+s;const h=Td(Vs(n,s),bd(function gp(){return new fr("__name__")}(),"in",i));return(yield Od(h)).forEach(g=>{u[g.id]=g.data()}),u})()}_removeDocument(n,s,i){var o=this;return(0,l.A)(function*(){s=o.getBaseFirestore()+"/"+s,yield function Cp(r){return Us(pt(r.firestore,Ct),[new kr(r._key,Mt.none())])}(Zr(n,s,i))})()}myOnSnapshot(n,s,i,o){return lo(Zr(n,s=this.getBaseFirestore()+"/"+s,i),h=>{o(h.data())})}myOnSnapshotCollection(n,s,i){return lo(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var f=[];h.forEach(g=>{f.push(g.data())}),i(f)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(n,s,i){return lo(Vs(n,s=this.getBaseFirestore()+"/"+s),function(){var u=(0,l.A)(function*(h){var f=[];h.docChanges().forEach(g=>{f.push(g.doc.data())}),i(f)});return function(h){return u.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(n,s,i,o){return lo(Td(Vs(n,s=this.getBaseFirestore()+"/"+s),bd(i[0],i[1],i[2])),function(){var f=(0,l.A)(function*(g){var x=[];g.docChanges().forEach(R=>{x.push(R.doc.data())}),o(x)});return function(g){return f.apply(this,arguments)}}())}getBaseFirestore(){return Fd.c.firestoreBase}getInitApp(){return this.app}getAuthApp(){return(0,c.xI)(this.app)}constructor(n,s,i){this.firestoreServiceApi=n,this.userService=s,this.commonSerivce=i,this.firestoreDbs={},this.listSubscribers={},this.app=(0,d.Wp)(Fd.c.firestoreConfig_app1,"firestoreapp")}}return(r=e).\u0275fac=function(n){return new(n||r)(uo.KVO(Bp.B),uo.KVO(Lp.R),uo.KVO(Gp.R))},r.\u0275prov=uo.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},69666:(yt,Oe,v)=>{function l(){return typeof aztExam<"u"?aztExam:void 0}v.d(Oe,{J:()=>H});var d=v(43234),c=v(48891),m=v(36484),w=v(42802),C=v(38566);let H=(()=>{var y;class ie{monitorAtTeacherDashboard(k){try{let se=l();if(typeof se>"u"||!se||!se.showMonitorTeacher)return;se.ver=this.monitorService.getMNoteVer();var j=this.userService.getUserObj();se.showMonitorTeacher({user:{token:j.rememberToken,userid:j.id,username:j.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live",urlExamResultGetLastExamResultOfStudentId:"ExamLivestream/GetLastExamResultOfStudentId"},roomid:k.roomId,examid:k.examId,userlist:k.userList,examconfig:k.examConfig,firebaseApp:this.fireStoreService,filetypeStr:k.fileTypeStr})}catch(se){console.log(se)}}monitorAtStudentDashboard(k,j){try{let se=l();if(typeof se>"u"||!se)return;se.ver=this.monitorService.getMNoteVer();var $=this.userService.getUserObj();se.loadMonitor(()=>{if(!se.MonitorStudent)return;var Pe={user:{token:$.rememberToken,userid:$.id,username:$.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:k,element:"monitorScreen",examconfig:j,firebaseApp:this.fireStoreService,isStarted:!1};se.MonitorStudent.getInstance().prepairSession(Pe);let B=window.setInterval(()=>{let I=document.getElementById("monitorScreen");if(I){let q=I.getElementsByTagName("div")[0];q&&(q.setAttribute("class","mx-auto"),clearInterval(B))}},50)})}catch(se){console.log(se)}}monitorAtTestPage(k,j,$){let se=l();if(typeof se>"u"||!se)return $(!1);var Pe=this.userService.getUserObj(),Z=j;se.ver=this.monitorService.getMNoteVer(),se.loadMonitor(()=>{if(!se.MonitorStudent)return $(!1);var B={user:{token:Pe.rememberToken,userid:Pe.id,username:Pe.fullName,studentid:Z?Z.id:0,studentname:Z?Z.fullName:null},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:k.roomId,element:"monitorScreenTakeTest",examconfig:k.examConfig,examid:k.examId,firebaseApp:this.fireStoreService,resultid:k.resultId,isStarted:!0,clickFromIframeFunc:()=>{},clickFromIframeFuncCaller:this};se.MonitorStudent.getInstance().startSession(B),$(!0)})}destroyMonitorAtStudentDashboard(){try{let j=l();if(typeof j>"u"||!j||!j.MonitorStudent)return;j.MonitorStudent.getInstance().stopSession()}catch(j){console.log(j)}}constructor(k,j,$){this.userService=k,this.monitorService=j,this.fireStoreService=$}}return(y=ie).\u0275fac=function(k){return new(k||y)(c.KVO(m.R),c.KVO(w.Q),c.KVO(C.s))},y.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),ie})()},42802:(yt,Oe,v)=>{v.d(Oe,{Q:()=>c});var l=v(48891),d=v(55465);let c=(()=>{var m;class w{constructor(H){this.envService=H}getTmpVersionMonitor(){var H=this.envService.getEnvValue("classliveUrl"),y="1.0";if(H){var ie=H.split("=");ie.length>1&&(y=ie[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+y}getMNoteVer(){var H=this.envService.getEnvValue("classliveUrl"),y="1.0";if(H){var ie=H.split("=");ie.length>1&&(y=ie[1])}return y}checkValidForSetUpMonitor(){return!0}}return(m=w).\u0275fac=function(H){return new(H||m)(l.KVO(d.t))},m.\u0275prov=l.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),w})()},51935:(yt,Oe,v)=>{v.d(Oe,{h:()=>st});var l=v(91478),d=v(89163),c=v(33887),m=v(48891),w=v(54460),C=v(2915),H=v(15343),y=v(76975);const ie=()=>({"mr-2":!0});function U(ne,We){if(1&ne&&(m.j41(0,"li"),m.EFF(1),m.k0s()),2&ne){const Ue=We.$implicit;m.R7$(),m.SpI("* ",Ue.message,"")}}function k(ne,We){1&ne&&(m.j41(0,"span",8),m.EFF(1),m.nI1(2,"mytranslate"),m.j41(3,"span",9),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.EFF(6),m.nI1(7,"mytranslate"),m.nI1(8,"mytranslate"),m.k0s()),2&ne&&(m.R7$(),m.SpI(" ",m.bMT(2,4,"lang_auto_click")," "),m.R7$(3),m.SpI('"',m.bMT(5,6,"lang_auto_tai_ve"),'"'),m.R7$(2),m.Lme(" ",m.bMT(7,8,"lang_auto_de_tai_ve")," ",m.bMT(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function j(ne,We){if(1&ne){const Ue=m.RV6();m.j41(0,"button",17),m.bIt("click",function(){m.eBV(Ue);const L=m.XpG();return m.Njj(L.onPressTrue())}),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()}2&ne&&(m.R7$(),m.SpI(" ",m.bMT(2,1,"lang_auto_tai_ve")," "))}let $=(()=>{var ne;class We extends c._{onPressTrue(){this.dialogRef.close(!0)}constructor(E,L){super(E,L),this.data=E,this.dialogRef=L,this.result=E.result}}return(ne=We).\u0275fac=function(E){return new(E||ne)(m.rXU(d.Vh),m.rXU(d.CP,8))},ne.\u0275cmp=m.VBU({type:ne,selectors:[["app-push-error-student-export-docx"]],features:[m.Vt3],decls:30,vars:25,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16",3,"ngClass"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(E,L){1&E&&(m.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.j41(6,"div",4)(7,"a",5),m.nrm(8,"lucide-icon",6),m.k0s()()(),m.j41(9,"div",7)(10,"span",8),m.EFF(11),m.nI1(12,"mytranslate"),m.j41(13,"span",9),m.EFF(14),m.k0s(),m.EFF(15),m.nI1(16,"mytranslate"),m.nI1(17,"lowercase"),m.k0s(),m.j41(18,"span",8),m.EFF(19),m.nI1(20,"mytranslate"),m.k0s(),m.j41(21,"azt-mat-dialog-content",10)(22,"ul",11),m.DNE(23,U,2,1,"li",12),m.k0s()(),m.DNE(24,k,9,12,"span",13),m.k0s(),m.j41(25,"div",14)(26,"a",15),m.EFF(27),m.nI1(28,"mytranslate"),m.k0s(),m.DNE(29,j,3,3,"button",16),m.k0s()()()),2&E&&(m.R7$(4),m.JRh(m.bMT(5,12,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),m.R7$(4),m.Y8G("ngClass",m.lJ4(24,ie)),m.R7$(3),m.SpI(" ",m.bMT(12,14,"lang_auto_he_thong_tao_thanh_cong_cho")," "),m.R7$(3),m.Lme("",L.result.datas.length,"/",L.result.errs.length+L.result.datas.length,""),m.R7$(),m.SpI(" ",m.bMT(17,18,m.bMT(16,16,"lang_auto_hoc_sinh"))," "),m.R7$(4),m.SpI(" ",m.bMT(20,20,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),m.R7$(2),m.Y8G("defaultHeight",60),m.R7$(2),m.Y8G("ngForOf",L.result.errs),m.R7$(),m.Y8G("ngIf",L.result.datas.length>0),m.R7$(3),m.SpI(" ",m.bMT(28,22,"lang_cms_common_close_btn")," "),m.R7$(2),m.Y8G("ngIf",L.result.datas.length>0))},dependencies:[w.YU,w.Sq,w.bT,d.tx,C.U,H.WGl,w.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),We})();var se=v(10936),Pe=v(65080),Z=v(68774),B=v(47712),I=v(5502),q=v(81587),_e=v(90796),xe=v(69135),Ee=v(14987);const ue=(ne,We)=>({"box-classrooms":ne,"box-max-classrooms":We});function De(ne,We){if(1&ne&&(m.j41(0,"span",31),m.EFF(1),m.k0s()),2&ne){let Ue;const E=m.XpG();m.R7$(),m.JRh(null!==(Ue=null==E.studentsInClassResults[0].classObj?null:E.studentsInClassResults[0].classObj.name)&&void 0!==Ue?Ue:"")}}function Se(ne,We){if(1&ne&&(m.j41(0,"div",36)(1,"div",18),m.nrm(2,"input",37),m.j41(3,"label",38,0),m.EFF(5),m.k0s()()()),2&ne){let Ue;const E=We.$implicit,L=m.sdS(4),z=m.XpG(2);m.Y8G("hidden",1===z.studentsInClassResults.length),m.R7$(2),m.Mz_("id","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),m.Y8G("value",null==E.classObj?null:E.classObj.id),m.R7$(),m.Mz_("for","select-classroom-export__",null==E.classObj?null:E.classObj.id,""),m.Y8G("matTooltip",null!==(Ue=null==E.classObj?null:E.classObj.name)&&void 0!==Ue?Ue:"")("isDisabledTooltip",!1)("matTooltipDisabled",L.isDisabled),m.R7$(2),m.JRh(null==E.classObj?null:E.classObj.name)}}function Xe(ne,We){if(1&ne&&(m.j41(0,"div",32)(1,"ng-scrollbar",33)(2,"div",34),m.DNE(3,Se,6,10,"div",35),m.k0s()()()),2&ne){const Ue=m.XpG();m.Y8G("ngClass",m.l_i(3,ue,Ue.form.controls.listStudents.controls.length>21||Ue.studentsInClassResults.length>18,Ue.form.controls.listStudents.controls.length<=21&&Ue.studentsInClassResults.length>18)),m.R7$(),m.Y8G("visibility","hover"),m.R7$(2),m.Y8G("ngForOf",Ue.studentsInClassResults)}}function Ve(ne,We){if(1&ne&&(m.j41(0,"label",38,0),m.EFF(2),m.k0s()),2&ne){const Ue=m.sdS(1),E=m.XpG().$implicit;m.Mz_("for","select-classroom-export__",E.controls.id.value,""),m.Y8G("matTooltip",E.controls.label.value)("isDisabledTooltip",!1)("matTooltipDisabled",Ue.isDisabled),m.R7$(2),m.SpI(" ",E.controls.label.value," ")}}function mt(ne,We){if(1&ne&&(m.j41(0,"label",44),m.nrm(1,"img",45),m.k0s()),2&ne){const Ue=m.XpG().$implicit;m.Mz_("for","select-classroom-export__",Ue.controls.id.value,""),m.R7$(),m.Y8G("nameImages",Ue.controls.nameImages.value)}}function pe(ne,We){if(1&ne){const Ue=m.RV6();m.j41(0,"div",39)(1,"div",40)(2,"input",41),m.bIt("change",function(){m.eBV(Ue);const L=m.XpG();return m.Njj(L.onChangeStudentOption())}),m.k0s(),m.DNE(3,Ve,3,6,"label",42)(4,mt,2,3,"label",43),m.k0s()()}if(2&ne){const Ue=We.$implicit;m.R7$(),m.Y8G("formGroup",Ue),m.R7$(),m.Mz_("id","select-classroom-export__",Ue.controls.id.value,""),m.R7$(),m.Y8G("ngIf",Ue.controls.label.value||!Ue.controls.isImage.value),m.R7$(),m.Y8G("ngIf",!Ue.controls.label.value&&Ue.controls.isImage.value&&Ue.controls.nameImages.value)}}function Ge(ne,We){1&ne&&(m.j41(0,"span",27),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()),2&ne&&(m.R7$(),m.SpI("* ",m.bMT(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function he(ne,We){if(1&ne){const Ue=m.RV6();m.j41(0,"div",49),m.bIt("click",function(){m.eBV(Ue);const L=m.XpG(2);return m.Njj(L.showAskInfo=!0)}),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()}2&ne&&(m.R7$(),m.SpI("+ ",m.bMT(2,1,"lang_testbank_test_config_add_information"),""))}function Ke(ne,We){if(1&ne&&(m.j41(0,"div"),m.nrm(1,"add-info-print",50),m.k0s()),2&ne){const Ue=m.XpG(2);m.R7$(),m.Y8G("form",Ue.form)}}function X(ne,We){1&ne&&(m.j41(0,"span",53),m.EFF(1),m.nI1(2,"mytranslate"),m.k0s()),2&ne&&(m.R7$(),m.SpI("(",m.bMT(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function oe(ne,We){if(1&ne){const Ue=m.RV6();m.j41(0,"div",51),m.bIt("click",function(){m.eBV(Ue);const L=m.XpG(2);return m.Njj(L.showAskInfo=!1)}),m.EFF(1),m.nI1(2,"mytranslate"),m.nI1(3,"mytranslate"),m.nI1(4,"lowercase"),m.DNE(5,X,3,3,"span",52),m.k0s()}if(2&ne){const Ue=m.XpG(2);m.R7$(),m.Lme(" ",m.bMT(2,3,"lang_auto_huy")," ",m.bMT(4,7,m.bMT(3,5,"lang_testbank_test_config_add_information"))," "),m.R7$(4),m.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo)}}function Be(ne,We){if(1&ne&&(m.j41(0,"div")(1,"span",46),m.EFF(2),m.nI1(3,"mytranslate"),m.k0s(),m.DNE(4,he,3,3,"div",47)(5,Ke,2,1,"div",26)(6,oe,6,9,"div",48),m.k0s()),2&ne){const Ue=m.XpG();m.R7$(2),m.Lme("* ",m.bMT(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",Ue.countStudentSelect,""),m.R7$(2),m.Y8G("ngIf",Ue.isAskInfo&&!Ue.showAskInfo),m.R7$(),m.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo),m.R7$(),m.Y8G("ngIf",Ue.isAskInfo&&Ue.showAskInfo)}}function we(ne,We){1&ne&&(m.j41(0,"div")(1,"div",15)(2,"span",27),m.EFF(3),m.nI1(4,"mytranslate"),m.k0s()()()),2&ne&&(m.R7$(3),m.SpI("* ",m.bMT(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let W=(()=>{var ne;class We extends c._{confirmAction(){const E=this.form.value,L=this.studentsInClassResults.find(z=>z.classObj?.id===E.classId);if(L){const z=E.listStudents?.filter(G=>G.choose).map(G=>G.id);L.results=L.results?.filter(G=>z?.includes(G.reId)),L.schoolName=this.showAskInfo?E.schoolName:void 0,L.subjectName=this.showAskInfo?E.subjectName:void 0,this.dialogRef.close(L)}else this.dialogRef.close()}setChangeSelectAll(){const E=this.form.controls.selectAll;if(E){E.setValue(!E.value);const L=this.form.controls.listStudents;L&&L.controls.forEach(z=>{z.controls.choose.setValue(E.value)}),this.countStudentSelect=E.value?L.controls.length:0}}onChangeStudentOption(){const E=this.form.controls.listStudents;let L=!0,z=0;E&&E.controls.forEach(me=>{!1===me.controls.choose.value?L=!1:z++});const G=this.form.controls.selectAll;G&&G.setValue(L),this.countStudentSelect=z}setupArrayStudent(E){this.currNameClass=E.classObj?.name??"";const L=this.form.controls.listStudents;if(L){L.clear();let z=E.results??[];if(void 0!==E.classObj?.sortType){let G=E.classObj?.sortType;z=0==G?this.sortService.sortFirstNameStudents(this.commonService.myClone(z)):99==G?this.sortService.sortTimeDESC(this.commonService.myClone(z)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone(z),"pos","id")}z.forEach(G=>{(G.confirmedAt||!this.data.examHasEssay&&1==G.status)&&L.push(new se.gE({isImage:new se.MJ(!!G.nameImages,{nonNullable:!0}),nameImages:new se.MJ(G.nameImages,{nonNullable:!0}),label:new se.MJ(G.fullName,{nonNullable:!0}),id:new se.MJ(G.reId,{nonNullable:!0}),choose:new se.MJ(!1,{nonNullable:!0})}))})}}classroomChange(E){this.setupArrayStudent(E)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let E=this.studentsInClassResults[0];this.form.controls.classId.setValue(E.classObj?.id),this.setupArrayStudent(E),this.form.controls.classId.valueChanges.subscribe(z=>{const G=this.form.controls.selectAll;G&&G.setValue(!1),this.countStudentSelect=0;const me=this.studentsInClassResults.find(le=>le.classObj?.id===z);me&&this.setupArrayStudent(me)})}}constructor(E,L,z){super(L,z),this.sortService=E,this.data=L,this.dialogRef=z,this.studentsInClassResults=[],this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=L.isAskInfo,this.studentsInClassResults=L.studentsInClassResults.map(G=>({...G,results:G.results?.map(me=>({...me,reId:Pe.P.generateIdRequired(10)}))})),this.form=new se.gE({classId:new se.MJ(0,{nonNullable:!0,validators:[se.k0.required]}),selectAll:new se.MJ(!1,{nonNullable:!0}),listStudents:new se.Yp([]),schoolName:new se.MJ("",{nonNullable:!0}),subjectName:new se.MJ("",{nonNullable:!0})})}}return(ne=We).\u0275fac=function(E){return new(E||ne)(m.rXU(Z.g),m.rXU(d.Vh),m.rXU(d.CP,8))},ne.\u0275cmp=m.VBU({type:ne,selectors:[["app-select-student-to-export-docx"]],features:[m.Vt3],decls:48,vars:35,consts:[["c","isDisabled"],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"change","checked"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"change","id"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(E,L){1&E&&(m.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),m.EFF(4),m.nI1(5,"mytranslate"),m.k0s(),m.j41(6,"div",5)(7,"a",6),m.nrm(8,"lucide-icon",7),m.k0s()()(),m.j41(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11),m.EFF(13),m.nI1(14,"mytranslate"),m.DNE(15,De,2,1,"span",12),m.k0s()(),m.DNE(16,Xe,4,6,"div",13),m.j41(17,"div",14)(18,"div",15)(19,"div",16),m.EFF(20),m.nI1(21,"mytranslate"),m.k0s()(),m.j41(22,"div",17)(23,"div",18)(24,"input",19),m.bIt("change",function(){return L.setChangeSelectAll()}),m.k0s(),m.j41(25,"label",20),m.EFF(26),m.nI1(27,"mytranslate"),m.k0s()()(),m.j41(28,"div",21)(29,"ng-scrollbar",22)(30,"div",23),m.DNE(31,pe,5,5,"div",24),m.k0s()()(),m.j41(32,"div",15),m.DNE(33,Ge,3,3,"span",25)(34,Be,7,7,"div",26),m.k0s()(),m.j41(35,"div",14)(36,"div",15)(37,"span",27),m.EFF(38),m.nI1(39,"mytranslate"),m.k0s()()()(),m.DNE(40,we,5,3,"div",26),m.k0s(),m.j41(41,"div",28)(42,"a",29),m.EFF(43),m.nI1(44,"mytranslate"),m.k0s(),m.j41(45,"button",30),m.bIt("click",function(){return L.confirmAction()}),m.EFF(46),m.nI1(47,"mytranslate"),m.k0s()()()()),2&E&&(m.R7$(4),m.JRh(m.bMT(5,21,"lang_testbank_what_to_export_select_students_export")),m.R7$(6),m.Y8G("formGroup",L.form)("hidden",0===L.studentsInClassResults.length),m.R7$(),m.Y8G("hidden",1===L.studentsInClassResults.length&&null==L.studentsInClassResults[0].classObj),m.R7$(2),m.SpI(" ",m.bMT(14,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),m.R7$(2),m.Y8G("ngIf",1===L.studentsInClassResults.length),m.R7$(),m.Y8G("ngIf",L.studentsInClassResults.length>1),m.R7$(),m.Y8G("hidden",0===L.form.controls.listStudents.controls.length),m.R7$(3),m.SpI("",m.bMT(21,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),m.R7$(4),m.Y8G("checked",L.form.controls.selectAll.value),m.R7$(2),m.JRh(m.bMT(27,27,"lang_auto_chon_tat_ca")),m.R7$(3),m.Y8G("visibility","hover"),m.R7$(2),m.Y8G("ngForOf",L.form.controls.listStudents.controls),m.R7$(2),m.Y8G("ngIf",0===L.countStudentSelect),m.R7$(),m.Y8G("ngIf",L.countStudentSelect>0),m.R7$(),m.Y8G("hidden",L.form.controls.listStudents.controls.length>0),m.R7$(3),m.SpI("* ",m.bMT(39,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),m.R7$(2),m.Y8G("ngIf",0===L.studentsInClassResults.length),m.R7$(3),m.SpI(" ",m.bMT(44,31,"lang_cms_common_close_btn")," "),m.R7$(2),m.Y8G("disabled",0===L.countStudentSelect),m.R7$(),m.SpI(" ",m.bMT(47,33,"lang_cms_common_confirm_btn")," "))},dependencies:[w.YU,w.Sq,w.bT,d.tx,B.oV,I.Yh,se.qT,se.me,se.Zm,se.Fm,se.BC,se.cb,se.j4,se.JD,se.v8,q.t,_e.y,xe.f,Ee.i,H.WGl,w.GH,y.wp],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),We})();var fe=v(5382),lt=v(64198),Dt=v(25539),nt=v(81234),Et=v(92229),Ye=v(50622),ft=v(91640),Je=v(41325),Ne=v(40949),Y=v(51113),ae=v(53393),de=v(99927),N=v(99172),S=v(32639),M=v(62095),V=v(46134),Te=v(9280),ve=v(87515),Ze=v(10296),Re=v(46899),rt=v(32610);let st=(()=>{var ne;class We{processHomeworks(E,L){return new Promise((z,G)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(L).subscribe(me=>{if(1==me.success){this.logger.remove();var le=[];me.data?.studentObjs.forEach(J=>{le.push({id:J.id,fullName:J.fullName,confirmedAt:J.confirmedAt,homeworkAnswerId:J.answer?.id,studentId:void 0,resultId:void 0,userId:void 0,nameImages:void 0,reId:"",status:void 0})}),this.sAztDialogService.open(W,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:me.data?.classroomObj,results:le,schoolName:void 0,subjectName:void 0}],examHasEssay:!1,isAskInfo:!1}}).afterClosed().subscribe(J=>{if(J){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===J.results?.length?"":J.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Ae=new Et.Y(!0);this.logger.pushChild(Ae),this.loadLibAction(Ae).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===J.results?.length?"":J.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Ce=new Et.Y(!0);this.logger.pushChild(Ce);const be=new fe.n(1,{function:(Le,qe,Qe)=>{Ce.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===qe?"":"th\u1ee9 "+(Le+1)} ${Qe?": "+Qe:""}`)}});J.results?.forEach(Le=>{const qe=new Et.Y;Ce.pushChild(qe),be.addTask(this,this.makeFileHomework,[L,Le,qe],Le.fullName??"")}),be.start().then(Le=>{Ce.remove(),0===Le.errs.length?this.finishHomework(J.classObj?.name??"",me.data?.homeworkObj?.name??"",Le,z,G):(this.logger.remove(),this.sAztDialogService.open($,{data:{result:Le},restoreFocus:!1}).afterClosed().subscribe(qe=>{qe&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(J.classObj?.name??"",me.data?.homeworkObj?.name??"",Le,z,G))}))})}).catch(Ce=>{this.logger.remove(),G(Ce)})}})}else this.logger.remove(),G(new Error(this.commonService.myTranslateInstant(me.message)))})})}processClasses(E,L){return new Promise((z,G)=>{let me;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),L){case"highest":me=this.testedListApiService.getTestedHighestMark("export_tool",E);break;case"first":me=this.testedListApiService.getTestedFirstMark("export_tool",E);break;default:me=this.testedListApiService.getTestedLastMark("export_tool",E)}me.subscribe(le=>{if(1==le.success){this.logger.remove();let J=!!le.data?.questionObjs?.filter(Ce=>this.answerTypeService.isEssayAnswer(Ce)).length,Ae=[];if(le.data?.studentsInClassResults?.forEach(Ce=>{let be=[];Ce.results?.forEach(Le=>{be.push({id:Le.id?Number(Le.id):void 0,fullName:Le.fullName??"",confirmedAt:Le.confirmedAt,studentId:Le.studentId?Number(Le.studentCode):void 0,resultId:Le.resultId,userId:Le.userId?.toString(),nameImages:Le.nameImages,reId:"",status:Le.status})}),Ae.push({classObj:Ce.classObj,results:be,schoolName:void 0,subjectName:void 0})}),le.data?.studentsNotInClassResults&&le.data?.studentsNotInClassResults?.length>0){let Ce=[];le.data.studentsNotInClassResults.forEach(be=>{Ce.push({id:be.id?Number(be.id):void 0,fullName:be.fullName??"",confirmedAt:be.confirmedAt,studentId:be.studentId?Number(be.studentCode):void 0,resultId:be.resultId,userId:be.userId?.toString(),nameImages:be.nameImages,reId:"",status:be.status})}),Ae.push({classObj:{id:0,name:this.commonService.myTranslateInstant("lang_auto_tu_do")??""},results:Ce,schoolName:void 0,subjectName:void 0})}this.sAztDialogService.open(W,{data:{studentsInClassResults:Ae,examHasEssay:J,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(Ce=>{Ce?(this.expandInfoParse=this.commonService.castJsonToObj(le.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===Ce.results?.length?"":Ce.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(E,Ce,Ce.classObj?.name??"",le.data?.examObj,Ce.classObj?.id).then(()=>{this.logger.remove(),z()}).catch(Le=>{this.logger.remove(),G(Le)})):(this.logger.remove(),z())})}else this.logger.remove(),G(new Error(this.commonService.myTranslateInstant(le.message)??""))})})}processUser(E,L,z,G,me,le=!0,J,Ae,Ce,be,Le){return new Promise((qe,Qe)=>{this.reset(),me=me||this.logger,me?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const P=new Et.Y(!0);me?.pushChild(P),this.loadLibAction(P).then(()=>{me?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(E,z??"",G??"",L,Le).subscribe(ze=>{if(1==ze.success){this.expandInfoParse=this.commonService.castJsonToObj(ze.data?.examObj?.expandInfo??"{}")??{},me?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let tt=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const at=ze.data?.studentObj;me?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${at?.fullName??""}`);let ct="";ct=ze.data?.classroomObj?ze.data?.classroomObj.name??tt:tt;const it=ze.data?.examTracks,ut=ze.data?.examObj,Ut=ze.data?.examResultObj,xt=this.commonService.castJsonToClassObjs(Dt.I,JSON.stringify(ze.data?.questionObjs))??[];let mn=0,Kt=0;for(let gt=0;gt<xt.length;gt++)xt[gt].correctAnswer=this.commonService.isExistInArray(ze.data?.correctQuestionIds,xt[gt].id),xt[gt].indexLabel=gt+(ut?.startQuestionIndex??1),ut?.resetQuestionIndex&&xt[gt].groupInfo&&xt[gt].groupInfo?.groupId&&(xt[gt].groupInfo&&mn!=xt[gt].groupInfo?.groupId&&(mn=xt[gt].groupInfo?.groupId??0,Kt=0),xt[gt].labelIndex=Kt+(ut?.startQuestionIndex??1),Kt++);const an={};let In=this.commonService.castJsonToObj(ze.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(In??[],an);const Bt=new Et.Y;me?.pushChild(Bt),this.processConvertDataUser(Bt,xt,at,Ut).then(gt=>{if(gt){var dn=0;this.convertDataMarkNote(gt?.resultTeacherDraw).then(jn=>{this.loadTeacherDrawResult(jn,me??new Et.Y,at?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",gt).then(Vt=>{gt=Vt,Bt.remove();const Nn=new Et.Y(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+`...${dn}%`);me?.pushChild(Nn);let gn=[];gn.push({content:this.getLineInfoData(ct,ut,it,Ut,at,xt,gt,J,Ae).join("<br/>")+"<br/><br/><br/>",answers:[]}),gn=gn.concat(this.startGenUserLineFile(Ut,xt,gt,Ce,be));var Jt=0;this.sAztDocxService.exportToDocxBinary((0,nt.Wn)(gn),{isHeadless:!0},(En,fn,vn)=>{new Promise(An=>{setTimeout(()=>{0==En&&(dn=Jt),Jt=En/fn*50+dn;const pn=this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+"..."+Math.floor(Jt)+"%";Nn?.pushMsg(pn)}),An(!0)})}).then(En=>{const fn=new Blob([En],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let vn=this.commonService.createFileNameExportFile([at?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",Ut?.id?Ut.id.toString():""])+"_test_result";if(le)if(gt.mediaAnswerWraps.concat(gt.mediaWraps).length>0){const An=new l;An.file(vn+".docx",fn),gt.mediaAnswerWraps.concat(gt.mediaWraps).forEach(pn=>{const tr=new Blob([pn]);An.file("attachments/"+this.replaceParamFileName(pn.name),tr)}),An.generateAsync({type:"blob"}).then(pn=>{let tr=this.commonService.createFileNameExportFile([ct,vn])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(pn,tr),me?.remove(),qe()},pn=>{me?.remove(),qe(pn)})}else this.shareFileFlutterService.shareFileWithBlob(fn,vn+".docx"),me?.remove(),qe();else me?.remove(),qe({name:vn,blob:fn,medias:gt.mediaAnswerWraps.concat(gt.mediaWraps)})})})})}}).catch(gt=>{me?.remove(),Qe(gt)})}else me?.remove(),Qe(new Error(this.commonService.myTranslateInstant(ze.message)))})}).catch(ze=>{me?.remove(),Qe(ze)})})}finishClassroom(E,L,z,G,me){if(z.length>1){const le=new l;z.forEach(J=>{J.medias.length>0?(le.file(J.name+"/"+J.name+".docx",J.blob),J.medias.forEach(Ae=>{const Ce=new Blob([Ae]);le.file(J.name+"/attachments/"+this.replaceParamFileName(Ae.name),Ce)})):le.file(J.name+".docx",J.blob)}),le.generateAsync({type:"blob"}).then(J=>{let Ae=this.commonService.createFileNameExportFile([E,L])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(J,Ae),G()},J=>{G(J)})}else if(z[0].medias.length>0){const le=new l;le.file(z[0].name+"/"+z[0].name+".docx",z[0].blob),z[0].medias.forEach(J=>{const Ae=new Blob([J]);le.file(z[0].name+"/attachments/"+this.replaceParamFileName(J.name),Ae)}),le.generateAsync({type:"blob"}).then(J=>{let Ae=this.commonService.createFileNameExportFile([E,L])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(J,Ae),G()},J=>{G(J)})}else this.shareFileFlutterService.shareFileWithBlob(z[0].blob,z[0].name+".docx"),G()}finishHomework(E,L,z,G,me){if(1===z.datas.length)if(z.datas[0].medias.length>0){const le=new l;le.file(z.datas[0].name+"/"+z.datas[0].name+".docx",z.datas[0].blob),z.datas[0].medias.forEach(J=>{const Ae=new Blob([J]);le.file(z.datas[0].name+"/attachments/"+this.replaceParamFileName(J.name),Ae)}),le.generateAsync({type:"blob"}).then(J=>{let Ae=this.commonService.createFileNameExportFile([E,z.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(J,Ae),G()},J=>{this.logger.remove(),G(J)})}else this.shareFileFlutterService.shareFileWithBlob(z.datas[0].blob,z.datas[0].name+".docx"),this.logger.remove(),G();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const le=new l;z.datas.forEach(J=>{J.medias.length>0?(le.file("results/"+J.name+"/"+J.name+".docx",J.blob),J.medias.forEach(Ae=>{const Ce=new Blob([Ae]);le.file("results/"+J.name+"/attachments/"+this.replaceParamFileName(Ae.name),Ce)})):le.file("results/"+J.name+".docx",J.blob)}),le.generateAsync({type:"blob"}).then(J=>{let Ae=this.commonService.createFileNameExportFile([E,L])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(J,Ae),this.logger.remove(),G()},J=>{this.logger.remove(),me(J)})}}makeFileHomework(E,L,z){return new Promise((G,me)=>{z.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(E,L.homeworkAnswerId??0).subscribe(le=>{if(z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(le.data?.answerObj),le.data?.answerObj){z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let Ae=this.commonService.castJsonToObj(le.data.answerObj.result??"")??{};this.convertDataMarkNote(Ae).then(Ce=>{this.loadTeacherDrawResult(Ce,z,L.fullName??"").then(be=>{z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let Le=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${le.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${le.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${le.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${le.data?.answerObj?.id} <br/>`].forEach(Qe=>{Le.push({content:Qe,answers:[]})});let qe=this.commonService.castJsonToObj(le.data?.answerObj?.resultNote??"");if(qe){const Qe=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],P=document.createElement("p");P.innerText=this.commonService.myTranslateInstant("lang_point")??"",P.setAttribute("docx-style",nt.$s.get("TB_RESULT_TXT"));const ze=document.createElement("p");let tt=le.data?.answerObj?.point;Qe.forEach(it=>{it.mark===tt&&(tt=this.commonService.myTranslateInstant(it.lang))}),ze.innerText=tt?.toString()??"",ze.setAttribute("docx-style",nt.$s.get("TB_RESULT_POINT"));const at=document.createElement("p");at.setAttribute("docx-style",nt.$s.get("TB_RESULT_TXT")),at.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const ct=document.createElement("span");ct.setAttribute("docx-style",nt.$s.get("TB_RESULT_COMMENT")),0===qe?.IsHideMark&&(ct.innerText=this.getTextContentInTagHTML(qe.Note),be.resultTeacherDraw?.commentEmoji&&(ct.appendChild(document.createElement("br")),be.resultTeacherDraw.commentEmoji.forEach(it=>{if(be.canvasList[it]){const ut=new Image;ut.src=be.canvasList[it].toDataURL(),ut.style.width=be.canvasList[it].width/5+"px",ut.style.height=be.canvasList[it].height/5+"px",ct.appendChild(ut)}}))),Le.push({content:nt.$s.makeHeaderTable([P,ze],[at,ct]),answers:[]})}Le=Le.concat(this.getLineImageAnswer(be)),this.sAztDocxService.exportToDocxBinary((0,nt.Wn)(Le),{isHeadless:!0},(Qe,P,ze)=>{}).then(Qe=>{z.remove();const P=new Blob([Qe],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let ze=`${this.commonService.convertVietnameseToEnglish(L.fullName??"")}_${le.data?.answerObj?.id??0}`;G({name:ze,blob:P,medias:be.mediaAnswerWraps.concat(be.mediaWraps)})})}).catch(be=>{z.remove(),me(be)})})}else z.remove(),me(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(E,L,z,G,me){return new Promise((le,J)=>{const Ae=new fe.n(1,{function:(Le,qe)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===qe?"":` (${Le+1}/${qe})`}`),this.logger.percent=Le/qe}},1e3),Ce=[];let be=this.homeworkExamService.isOfflineExam(G);L.results?.forEach(Le=>{Ae.addTask(this,()=>new Promise((qe,Qe)=>{const P=new Et.Y(!0,"");this.logger.pushChild(P),this.processUser(E,Number(Le.resultId),Le.userId,Le.studentId?.toString(),P,!1,L.schoolName,L.subjectName,be,void 0,me).then(ze=>{ze?(P.remove(),Ce.push(ze),qe()):(P.remove(),Qe(new Error))}).catch(ze=>{P.remove(),Qe(ze)})}))}),Ae.start().then(Le=>{Le.errs.length>0?(this.logger.remove(),Le.datas=Ce,this.sAztDialogService.open($,{data:{result:Le},restoreFocus:!1}).afterClosed().subscribe(qe=>{qe&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom(z,G?.name??"",Ce,le,J))})):this.finishClassroom(z,G?.name??"",Ce,le,J)})})}processConvertDataUser(E,L,z,G){return new Promise((me,le)=>{let J={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Ae=(this.commonService.myParseJson(G?.files??"[]")??[]).filter(ze=>(0,lt.rl)(ze.mimes??"")||(0,lt.nL)(ze.mimes??""));E.start();const P=new fe.n(1,{function:(ze,tt,at)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${ze+1}/${tt}: ${at}`)}});P.addTask(this,()=>new Promise((ze,tt)=>{const at=new Et.Y(!0);E.pushChild(at),this.questionRenderService.parseRenderQuestions(L,ct=>{at.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(ct)}%`)},void 0,50,!0).then(()=>{at.remove(),ze()}).catch(ct=>{const it=ut=>{Object.prototype.hasOwnProperty.call(ut,"type")&&"LOAD_IMAGE"===ut.type?tt(new Error(`${ut.message} ${this.commonService.trimMidLimitLength(ut.data[0],30)}`)):tt(ct)};at.remove(),Array.isArray(ct)?it(ct[0]):it(ct)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),G&&G.result&&P.addTask(this,()=>new Promise((ze,tt)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj(G?.result??"")??{},E,z?.fullName??"").then(at=>{J=at,ze()}).catch(at=>{tt(at)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),P.addTask(this,()=>new Promise((ze,tt)=>{z?this.loadNameImage(z).then(at=>{z=at,ze()}).catch(at=>{tt(at)}):tt(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),J.isExportMedia&&P.addTask(this,()=>new Promise((ze,tt)=>{const at=new Et.Y(!0);E.pushChild(at);const ct=new fe.n(3,{function:(it,ut)=>{at.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${it}/${ut})`)}},100);L.forEach(it=>{it.attachments&&it.attachments.length>0&&it.attachments.forEach(ut=>{ct.addTask(this,this.loadAztFile,[ut,J,"att"])})}),ct.start().then(it=>{0===it.errs.length?(at.remove(),ze()):(at.remove(),tt(it.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),Ae.length&&P.addTask(this,()=>new Promise((ze,tt)=>{const at=new Et.Y(!0);E.pushChild(at);const ct=new fe.n(3,{function:(it,ut)=>{at.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${it}/${ut})`)}},100);Ae.forEach(it=>{ct.addTask(this,this.loadAztFile,[it,J,"ans"])}),ct.start().then(it=>{0===it.errs.length?(at.remove(),ze()):(at.remove(),tt(it.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem_tu_luan")),P.start().then(ze=>{E.remove(),0===ze.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(L,G),me(J)):le(ze.errs[0])})})}hasMultiple(E){let L=!1;for(let z=0;z<E.length;z++)if(this.answerTypeService.isOneChoiceAnswer(E[z])){L=!0;break}return L}hasEssay(E){let L=!1;for(let z=0;z<E.length;z++)if(this.answerTypeService.isEssayAnswer(E[z])){L=!0;break}return L}getLineInfoData(E,L,z,G,me,le,J,Ae,Ce){const be=[];be.push(nt.$s.makeHeaderTable([nt.$s.createLineCenterBold(Ae||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toUpperCase()} }`)],[nt.$s.createLineCenterBold(L?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),nt.$s.createLineCenterBold(Ce||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),nt.$s.createLineCenterBold(L?.minutes&&L?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+L?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const Le=le.filter(qe=>this.answerTypeService.isEssayAnswer(qe)).length;return me&&me.nameImages&&parseInt(me?.id??"0")<=0?be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${me?.nameImages.url}" />`):be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${me?.fullName}`),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${E}`),L?.subjectMarks&&G?.subjectMarkValues&&G.subjectMarkValues.forEach((qe,Qe)=>{be.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${Qe+1} </b>: ${qe}/10`)}),this.hasMultiple(le)&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${G?.trueFalseMark} (${G?.rightAnswer}/${(G?.totalQuestion??0)-Le} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(le)&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${G?.essayMark+" ("+Le+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(le)&&J.resultTeacherDraw&&be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj(G?.files??"")?.length??"0"}`),z&&0!=L?.autoMonitor&&(be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${z.exitFullScreen}`),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${z.blurWindow}`)),be.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${G?.id}`),be}startGenUserLineFile(E,L,z,G,me){let le=[];const J=this.commonService.castJsonToObj(E?.answers??"");return J&&L.forEach(Ae=>{Ae.groupInfo&&Ae.groupInfo.isFirstInGroup&&le.push({content:`<br/><b>${Ae.groupInfo.groupContent}</b><br/>`,answers:[]}),Ae.attachments&&z.isExportMedia&&Ae.attachments.forEach(be=>{le.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(be.name)}]`,answers:[]})}),le=le.concat(this.genLineQuestion(Ae,G));const Ce=this.mapQuestResultObj(Ae,J??[]);switch(Ae.answerType){case 1:le=le.concat(this.genLineAnswerType1(Ae,Ce));break;case 3:le=le.concat(this.genLineAnswerType3(Ae,Ce));break;case 4:le=le.concat(this.genLineAnswerType4(Ae,Ce));break;case 5:le=le.concat(this.genLineAnswerTrueFalseType5(Ae,Ce))}me&&Ae.help&&le.push({content:`<br/><b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b> ${Ae.help}<br/><br/>`,answers:[]})}),this.hasEssay(L)&&(le=le.concat(this.getLineImageAnswer(z))),le}genLineQuestion(E,L){const z=[];let G=this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"),me=this.answerTypeService.isFillAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_fill_blank"):this.answerTypeService.isEssayAnswer(E)?this.commonService.myTranslateInstant("azt_lang_sugg_type_essay"):this.commonService.myTranslateInstant("azt_lang_sugg_type_multiple_choice"),le={content:"<b>"+G+" "+(E.labelIndex??E.indexLabel??1)+". "+(L?`(${me})`:"")+"</b> "+(E.content?.includes("<img")?"<br/>":"")+E.content,answers:L&&(this.answerTypeService.isFillAnswer(E)||this.answerTypeService.isEssayAnswer(E))?[]:this.convertAnswerQuestion(E.answers??[],!!this.answerTypeService.isTrueFalseAnswer(E))};return z.push(le),z}mapQuestResultObj(E,L){return L.find(G=>G.QuestionId===E.id)||{QuestionId:E.id??0,AnswerContent:[]}}convertAnswerQuestion(E,L){let z=[];return E.forEach(G=>{let me=G.alpha?G.alpha:G.key,le="<b>     "+(L?me.toLocaleLowerCase()+")":me)+".</b> "+G.content;z.push(le)}),z}genLineAnswerType1(E,L){const z=document.createElement("table"),G=E.correctAnswer?nt.JP:nt.ep;z.setAttribute("docx-style",nt.$s.get("TABLE"));const me=[],le=document.createElement("tr");z.appendChild(le);const J=document.createElement("td");J.setAttribute("docx-style",nt.$s.get("CORRECT",[{key:nt.Xe,value:G}]));const Ae=document.createElement("span"),Ce=E.answers?E.answers.filter(qe=>E.answerResult?.includes(qe.key)).map(qe=>qe.alpha??qe.key).join(" & "):E.answerResult?.join(" & ");Ae.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+Ce,Ae.setAttribute("color",G),J.appendChild(Ae),le.appendChild(J);const be=document.createElement("span"),Le=document.createElement("span");return be.innerText="\u2713",be.setAttribute("color",nt.JP),Le.innerText="\u2717",Le.setAttribute("color",nt.ep),E.answers?.forEach((qe,Qe)=>{const P=document.createElement("td"),ze=document.createElement("span"),tt=[{key:nt.Xe,value:G}];tt.push({key:nt.n1,value:Qe+1===E.answers?.length?G:"FFFFFF"}),P.setAttribute("docx-style",nt.$s.get("KEY_RESULT",tt)),ze.innerText=qe.alpha??qe.key,L.AnswerContent.filter(ct=>ct.Content===qe.key).length>0&&P.appendChild(E.correctAnswer?be:Le),P.appendChild(ze),le.appendChild(P)}),me.push({content:`<br>${z.outerHTML}<br><br><br>`,answers:[]}),me}genLineAnswerTrueFalseType5(E,L){const z=[],G=E.correctAnswer?nt.JP:nt.ep,me=this.commonService.myTranslateInstant("lang_auto_dung"),le=this.commonService.myTranslateInstant("lang_auto_sai"),J=this.sAztAnswerTrueFalseService.checkLabelKeys([],E?.answers,E?.answerResult),Ae=(tt,at)=>{const ct=document.createElement("span");return ct.innerText=tt,ct.setAttribute("color",at),ct},Le=document.createElement("table");Le.setAttribute("docx-style",nt.$s.get("TABLE"));const qe=document.createElement("tr"),Qe=Ae(this.commonService.myTranslateInstant("lang_auto_dap_an")??"",G),P=document.createElement("td"),ze=[{key:nt.Xe,value:G}];return ze.push({key:nt.n1,value:G}),P.setAttribute("docx-style",nt.$s.get("KEY_RESULT",ze)),E.answers?.forEach(tt=>{const at=this.sAztAnswerTrueFalseService.checkIsTrueType5(tt,J,L.AnswerContent),ct=this.commonService.myTranslateInstant(this.sAztAnswerTrueFalseService.getAnswerChoiceTrueFalseQuestion(tt,L.AnswerContent))??"";P.appendChild(((tt,at,ct)=>{const it=document.createElement("div"),ut=document.createElement("span"),Ut=at?nt.JP:nt.ep;return ut.innerText=(tt.alpha??tt.key).toLowerCase()+"-",it.appendChild(Ae(at?"\u2713":"\u2717",Ut)),it.appendChild(ut),it.appendChild(Ae(ct??"",Ut)),it})(tt,at,ct)),P.appendChild(document.createElement("br"))}),qe.appendChild(((tt,at)=>{const ct=document.createElement("td");return ct.appendChild(tt),E.answers.length&&E.answers.forEach(it=>{const ut=document.createElement("span");ut.setAttribute("color",this.sAztAnswerTrueFalseService.checkIsTrueType5(it,J,L.AnswerContent)?nt.JP:nt.ep),ut.innerText=` ${(it.alpha?it.alpha:it.key?it.key:it).toString().toLowerCase()}-${J.includes((it.alpha?it.alpha:it.key?it.key:"")+"T")?me:le} `,ct.appendChild(ut)}),ct.setAttribute("docx-style",at),ct})(Qe,nt.$s.get("CORRECT",[{key:nt.Xe,value:G}]))),qe.appendChild(P),Le.appendChild(qe),z.push({content:`<br>${Le.outerHTML}<br><br><br><br><br><br>`,answers:[]}),z}genLineAnswerType3(E,L){const z=[];return z.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/><br/>`,answers:[]}),0===L.AnswerContent.length?z.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):L.AnswerContent.forEach(G=>{z.push({content:`<span>${G.Content}</span>`,answers:[]})}),z.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${E.essayMarkParsed} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${E.scorePerQuestion})</b>`,answers:[]}),z}genLineAnswerType4(E,L){const z=document.createElement("table"),G=E.correctAnswer?nt.JP:nt.ep;z.setAttribute("docx-style",nt.$s.get("TABLE"));const me=[],le=document.createElement("tr");le.setAttribute("docx-style",nt.$s.get("TR")),z.appendChild(le);const J=document.createElement("td");J.setAttribute("docx-style",nt.$s.get("CORRECT",[{key:nt.Xe,value:G}]));const Ae=document.createElement("span");Ae.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+E.answerResult?.join(";")+"]",Ae.setAttribute("color",G),J.appendChild(Ae),le.appendChild(J),0===L.AnswerContent.length&&L.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const Ce=document.createElement("td"),be=document.createElement("span");return Ce.setAttribute("docx-style",nt.$s.get("FILL_RESULT",[{key:nt.Xe,value:G}])),be.innerText=L.AnswerContent.map(qe=>qe.Content).join(";"),Ce.appendChild(be),le.appendChild(Ce),me.push({content:`<br>${z.outerHTML}<br><br><br>`,answers:[]}),me}loadNameImage(E){return new Promise((L,z)=>{E&&E.nameImages&&parseInt(E?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(E.nameImages).then(G=>{G&&E.nameImages&&(E.nameImages.url=G),L(E)}).catch(G=>{z(G)}):L(E)})}loadCssFrameAction(){return new Promise(E=>{const L=document.createElement("div"),z=G=>{const me=document.createElement("span");return me.style.fontFamily=G,me.innerText="Aa",me};L.appendChild(z("font_chu_dep")),L.appendChild(z("font_chu_dep_z")),L.appendChild(z("font_chu_in")),L.appendChild(z("font_chu_in_nghieng")),L.appendChild(z("font_chu_in_dam")),L.style.opacity="0",document.body.appendChild(L),setTimeout(()=>{L.remove(),E()},2e3)})}loadLibAction(E){return new Promise((L,z)=>{this.commonService.loadAzotaDocxJs().then(()=>{const G=new fe.n(1,{function:(me,le,J)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${me+1}/${le}: ${J}`)}});G.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),G.start().then(me=>{E.remove(),me.errs.length>0?z(me.errs[0]):L()})}).catch(G=>{z(G)})})}reset(){}checkUrlIsImage(E){return null!=E.match(/\.(jpeg|jpg|png|gif)(\?.*)?$/)}loadAztFile(E,L,z){return new Promise((G,me)=>{fetch(this.cdnService.getMyCdn(E.url??"")).then(le=>{le.ok?le.blob().then(J=>{const Ce=new File([J],E.name??"",{type:E.mimes});"ans"===z?L.isExportAnsMedia&&L.mediaAnswerWraps.push(Ce):L.isExportMedia&&L.mediaWraps.push(Ce),G()}):me(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))}).catch(()=>{me(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${E.name}`))})})}wrapLoadMedia(E,L){return this.checkUrlIsImage(E)?(0,lt.qO)(E,L):new Promise((z,G)=>{z(void 0)})}replaceImageToBase64(E,L,z,G,me,le){return new Promise((J,Ae)=>{Object.prototype.hasOwnProperty.call(E,L)&&"string"==typeof E[L]?this.wrapLoadMedia(E[L],me).then(Ce=>{if(Ce){const be=document.createElement("canvas");be.width=Ce.width,be.height=Ce.height,be.getContext("2d")?.drawImage(Ce,0,0),E[L]=z.canvasList.push(be)-1,J()}else{le=le?le+1:1;let be=E[L].split(".");be=be.length>0?be[be.length-1]:"mp3";const Le=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",le.toString(),G])+"."+be;this.loadAztFile({name:this.commonService.replaceAll(Le,"_"," ")??"",url:E[L],path:"",extension:"",mimes:"",size:"0"},z,"ans").then(()=>{J()}).catch(qe=>{Ae(new Error(this.commonService.myTranslateInstant(qe.message)+(G.length>0?" : "+G:"")))})}}).catch(Ce=>{Ae(new Error(this.commonService.myTranslateInstant(Ce.message)+(G.length>0?" : "+G:"")))}):Ae(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+(G.length>0?" : "+G:"")))})}loadTeacherDrawResult(E,L,z,G){return new Promise((me,le)=>{const J=G??{canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},Ae=new fe.n(3,{function:(Ce,be)=>{L.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${Ce}/${be})`)}});if(J.resultTeacherDraw=E,J.resultTeacherDraw){J.resultTeacherDraw.pages?.forEach((be,Le)=>{Ae.addTask(this,this.replaceImageToBase64,[be,"backgroundImage",J,z,this.cdnService,Le]),be.draw&&Ae.addTask(this,this.replaceImageToBase64,[be,"draw",J,z,this.cdnService,Le])});const Ce=this.commonService.castJsonToObj(J.resultTeacherDraw.staticTextConfig??"");if(J.resultTeacherConfig=Ce,J.resultTeacherConfig&&J.resultTeacherConfig.urlImgCorrect&&J.resultTeacherConfig.urlImgWrong&&(J.resultTeacherConfig.urlImgCorrect=(J.resultTeacherConfig.type?"":"assets/images/classlive/")+J.resultTeacherConfig.urlImgCorrect,J.resultTeacherConfig.urlImgWrong=(J.resultTeacherConfig.type?"":"assets/images/classlive/")+J.resultTeacherConfig.urlImgWrong,Ae.addTask(this,this.replaceImageToBase64,[J.resultTeacherConfig,"urlImgCorrect",J,z]),Ae.addTask(this,this.replaceImageToBase64,[J.resultTeacherConfig,"urlImgWrong",J,z])),J.resultTeacherDraw.commentEmoji&&J.resultTeacherDraw.commentEmoji.length>0)for(let be=0;be<J.resultTeacherDraw.commentEmoji.length;be++)J.resultTeacherDraw.commentEmoji[be]="https://azota889.github.io/storage_public/mnote/"+J.resultTeacherDraw.commentEmoji[be],Ae.addTask(this,this.replaceImageToBase64,[J.resultTeacherDraw.commentEmoji,be,J,z])}Ae.start().then(Ce=>{0===Ce.errs.length?me(J):le(Ce.errs[0])})})}capitalized(E){return E?E.charAt(0).toUpperCase()+E.slice(1):""}wrapText(E,L,z,G,me,le){const J=document.createElement("span");J.innerHTML=this.commonService.removeXssInHtml(L),(L=J.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(Ce=>{for(var be=Ce.split(" "),Le="",qe=0;qe<be.length;qe++){var Qe=Le+be[qe]+" ";E.measureText(Qe).width>me&&qe>0?(E.fillText(Le,z,G),Le=be[qe]+" ",G+=le):Le=Qe}E.fillText(Le,z,G)})}getLineImageAnswer(E){const L=[];return E.mediaAnswerWraps&&E.isExportAnsMedia&&E.mediaAnswerWraps.forEach(z=>{L.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(z.name)}}</span>`,answers:[]})}),E.resultTeacherDraw&&E.resultTeacherDraw.pages?.forEach(z=>{let G=E.canvasList[Number(z.backgroundImage)];if(G){const me=document.createElement("canvas");me.width=z.width??1,me.height=z.height??1;const le=me.getContext("2d");if(le){le.fillStyle="#FFFFFF",le.fillRect(0,0,me.width,me.height);let Ce=document.createElement("canvas"),be=Ce.getContext("2d");0!==z.rotation&&be?(90===Math.abs(z.rotation??0)?(Ce.width=G.height,Ce.height=G.width):(Ce.width=G.width,Ce.height=G.height),be.translate(Ce.width/2,Ce.height/2),be.rotate(((z.rotation??0)>0?1:-1)*(z.rotation??0)*Math.PI/180),be.drawImage(G,-G.width/2,-G.height/2),be.restore()):Ce=G;const Le=me.height/Ce.height*Ce.width;if(le.drawImage(Ce,0,0,Ce.width,Ce.height,(me.width-Le)/2,0,Le,me.height/Ce.height*Ce.height),z.draw){const P=E.canvasList[Number(z.draw)];P&&le.drawImage(P,0,0)}if(z.staticText&&z.staticText.length>0&&z.staticText.forEach(P=>{if(le.font=`${E.resultTeacherConfig?.fontSize}px ${E.resultTeacherConfig?.fontText}`,le.fillStyle=E.resultTeacherConfig?.fontColor??"#000000",E.resultTeacherConfig?.useCorrectText&&"correct"==P.value&&this.wrapText(le,E.resultTeacherConfig?.textCorrect??"",P.x,P.y,me.width-P.x,25),E.resultTeacherConfig?.useCorrectText&&"wrong"==P.value&&this.wrapText(le,E.resultTeacherConfig?.textWrong??"",P.x,P.y,me.width-P.x,25),!E.resultTeacherConfig?.useCorrectText&&"correct"==P.value){const ze=E.canvasList[Number(E.resultTeacherConfig?.urlImgCorrect)];ze&&le.drawImage(ze,0,0,ze.width,ze.height,P.x,P.y,30,30)}if(!E.resultTeacherConfig?.useWrongText&&"wrong"==P.value){const ze=E.canvasList[Number(E.resultTeacherConfig?.urlImgWrong)];ze&&le.drawImage(ze,0,0,ze.width,ze.height,P.x,P.y,30,30)}}),z.objText&&z.objText.length>0){let P=300;z.objText.forEach(ze=>{le.font=`${parseFloat(ze.textStyle.size)}px ${ze.textStyle.font}`,le.fillStyle=ze.textStyle.color,le.textAlign=ze.textStyle.align??"center",le.lineWidth=ze.textStyle.width??P,this.wrapText(le,ze.value,ze.x,ze.y,me.width-ze.x,25)})}}const J=693,Ae=J/me.width;L.push({content:`<img src="${me.toDataURL()}" style="width:${J}px;height:${me.height*Ae}px" /><br/>`,answers:[]})}}),0===L.length?L.push({content:`<br/><br/>${nt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):L.unshift({content:`<br/>${nt.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),L}convertDataMarkNote(E){return new Promise((L,z)=>{E&&E.urlDataMark?this.cdnService.loadTextCdn(this.cdnService.getMyCdn(E.urlDataMark)).subscribe(G=>{const me=this.zipDataService.decodeContentGzip(G),le=this.commonService.castJsonToObj(me);E.pages=[];let J={};le?.pages.forEach((be,Le)=>{let qe={width:be.width,height:be.height,draw:be.draws?.[0]?.src??void 0,backgroundImage:be.backgroundSrc,rotation:be.backgroundRotate,objText:[],staticText:[]};be.childData?.length&&be.childData.forEach((Qe,P)=>{if("UIQuickMark"==Qe.className&&(qe.staticText?.push({x:Qe.x+5,y:Qe.y+(Qe.height+5+Qe.fontSize)/2,value:"type_right"===Qe.type?"correct":"wrong"}),0===P&&(J={txtCommentFont:Qe.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:Qe.width,correctHeight:Qe.height,wrongWidth:Qe.width,wrongHeight:Qe.height,fontText:Qe.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:Qe.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!J.urlImgWrong&&"type_wrong"==Qe.type&&(J.urlImgWrong=Qe.imageSrc),!J.urlImgCorrect&&"type_right"==Qe.type&&(J.urlImgCorrect=Qe.imageSrc),!J.textWrong&&"type_wrong"==Qe.type&&(J.textWrong=Qe.textContent),!J.textCorrect&&"type_right"==Qe.type&&(J.textCorrect=Qe.textContent),J.useCorrectText=!J.urlImgCorrect,J.useWrongText=!J.urlImgWrong,"UIText"===Qe.className){let ze=this.getStyleContent(Qe.textContent);qe.objText?.push({x:Qe.x+15,y:Qe.y+15,value:Qe.textContent,textStyle:{size:Qe.fontSize?Qe.fontSize:ze?.fontSize,align:ze?.textAlign??"left",color:ze?.color,fill:!0,font:ze?.fontFamily}})}}),E.pages?.push(qe)}),E.staticTextConfig=this.commonService.serializeJson(J),L(E)}):L(E??{})})}getStyleContent(E){let L=document.createElement("div");L.innerHTML=this.commonService.removeXssInHtml(E);let z=L.querySelector("p"),G=L.querySelector("span");return G?{fontSize:G.style.fontSize,color:G.style.color,fontFamily:G.style.fontFamily,textAlign:z?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(E){return(new DOMParser).parseFromString(E,"text/html").body.textContent??E}replaceParamFileName(E){return E.replace(/\?.*$/,"")}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}constructor(E,L,z,G,me,le,J,Ae,Ce,be,Le,qe,Qe,P,ze,tt){this.sAztAnswerTrueFalseService=E,this.homeworkExamService=L,this.checkDrawImgNameService=z,this.cdnService=G,this.zipDataService=me,this.exportPdfUtilsService=le,this.answerTypeService=J,this.exportPdfConvertDataService=Ae,this.questionRenderService=Ce,this.commonService=be,this.answerService=Le,this.examResultService=qe,this.testedListApiService=Qe,this.shareFileFlutterService=P,this.sAztDialogService=ze,this.sAztDocxService=tt,this.logger=new Et.Y,this.expandInfoParse={}}}return(ne=We).\u0275fac=function(E){return new(E||ne)(m.KVO(Ye.j),m.KVO(ft.Z),m.KVO(Je.E),m.KVO(Ne.B),m.KVO(Y.j),m.KVO(ae.j),m.KVO(de._),m.KVO(N.p),m.KVO(S.g),m.KVO(M.R),m.KVO(V._t),m.KVO(Te._j),m.KVO(ve.h),m.KVO(Ze.R),m.KVO(Re.i),m.KVO(rt.I))},ne.\u0275prov=m.jDH({token:ne,factory:ne.\u0275fac,providedIn:"root"}),We})()},92229:(yt,Oe,v)=>{v.d(Oe,{Y:()=>l});class l{pushChild(c){this.child.push(c)}pushMsg(c){this.msg=c}start(c){this.run=!0,c&&(this.msg=c)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const c=[];return this.msg&&""!==this.msg&&c.push(this.msg),`<p>${c.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let c=[];return this.child.filter(m=>m.run).forEach(m=>{c=c.concat(m.lines)}),c}constructor(c=!1,m="",w){this.run=c,this.msg=m,this.percent=w,this.child=[]}}},44101:(yt,Oe,v)=>{v.d(Oe,{i:()=>ls});var l=v(48891),d=v(407),c=v(59702),m=v(59640),w=v(50622),C=v(99927),H=v(86622),y=v(46899);let ie=(()=>{var A;class Me extends m.H{showExplain(){this.isTeacherRole||!this.examConfig||"SHOW_EXPLAIN"!==this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction||this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought?this.isShowExplainChange.emit(!this.isShowExplain):this.showDialogBuyExam(this.examObj)}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage(!0)}showDialogBuyExam(ye){this.sAztDialogService.open(c.Q,{data:{examObj:ye},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0})}isKey(ye){return!(!this.questionObj?.answers||!this.questionObj.answerResult)&&(ye.key?ye.key==this.questionObj.answerResult[0]:ye==this.questionObj.answerResult[0])}haveChoose(ye){return!!this.userAnswersObj["id_"+this.questionObj?.id]&&(ye.key?ye.key.toString()==this.userAnswersObj["id_"+this.questionObj?.id]:ye.toString()==this.userAnswersObj["id_"+this.questionObj?.id])}findKey(){this.questionObj?.answerResult&&this.labelArr.every(ye=>!this.questionObj||!this.questionObj.answerResult||this.questionObj.answerResult[0]!=ye.key||(this.key=(this.isShowOriginAnswer?ye.key:ye.alpha??ye.key)??"",!1))}checkShowExplainButton(){this.isShowExplainButton=!!(this.questionObj.help||"lang_core_show_explain_required_payment"==this.questionObj.help&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigObj?.priceForAction)}checkLabelArr(){this.labelArr=this.sAztAnswerTrueFalseService.checkLabelArrOriginOrMix(this.questionAnswers,this.isShowOriginAnswer),this.findKey()}ngOnChanges(ye){ye.isShowOriginAnswer&&this.questionObj&&this.checkLabelArr()}ngOnInit(){if(super.ngOnInit(),this.isFillAnswer=this.questionObj?.correctAnswer??!1,this.answerTypeService.isTrueFalseAnswer(this.questionObj)?(this.keys=this.sAztAnswerTrueFalseService.checkLabelKeys(this.keys,this.questionObj?.answers,this.questionObj?.answerResult),this.isFillAnswer=!0):this.key=this.questionObj?.answerResult.length?this.questionObj.answerResult[0]:"",this.questionAnswers=(0,d.cloneDeep)(this.questionObj.answers??[]),this.checkLabelArr(),this.answerTypeService.isOneChoiceAnswer(this.questionObj))for(let ye=0;ye<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[ye])&&this.haveChoose(this.labelArr[ye]),!0!==this.isFillAnswer);ye++);this.answerTypeService.isFillAnswer(this.questionObj)&&this.questionObj?.answerResult&&this.questionObj.answerResult.length>0&&(this.keys=this.questionObj.answerResult,this.isFillAnswer=this.questionObj?.correctAnswer??!1),this.checkShowExplainButton()}constructor(ye,je,jt,di){super(),this.sAztAnswerTrueFalseService=ye,this.answerTypeService=je,this.answerBoxService=jt,this.sAztDialogService=di,this.isShowExplain=!1,this.isOfflineMark=!1,this.isTeacherRole=!0,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.isShowExplainChange=new l.bkB,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1,this.isShowExplainButton=!1,this.questionAnswers=[]}}return(A=Me).\u0275fac=function(ye){return new(ye||A)(l.rXU(w.j),l.rXU(C._),l.rXU(H.C),l.rXU(y.i))},A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-base"]],inputs:{examObj:"examObj",questionObj:"questionObj",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isTeacherRole:"isTeacherRole",isShowOriginAnswer:"isShowOriginAnswer",examConfig:"examConfig",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab",backToLink:"backToLink"},outputs:{isShowExplainChange:"isShowExplainChange"},features:[l.Vt3,l.OA$],decls:0,vars:0,template:function(ye,je){},encapsulation:2}),Me})();var U=v(54460),k=v(15343),j=v(76975);const $=A=>({width:A,visibility:"visible"}),se=()=>({"ml-1":!0}),Pe=A=>({color:A}),Z=A=>({"border-color":A}),B=()=>({"text-danger wrongIcon mr-1":!0}),I=()=>({"rightIcon text-success mr-1":!0}),q=()=>({"text-danger mr-1":!0}),_e=()=>({"text-success mr-1":!0});function xe(A,Me){if(1&A){const T=l.RV6();l.j41(0,"span",6),l.bIt("click",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",7),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("ngStyle",l.eq3(6,$,T.questionObj.help?"125px":"0px")),l.R7$(),l.SpI(" ",l.bMT(2,4,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",T.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(8,se))}}function Ee(A,Me){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,B))}function ue(A,Me){if(1&A&&l.DNE(0,Ee,1,2,"lucide-icon",16),2&A){const T=l.XpG().$implicit,ye=l.XpG(2);l.Y8G("ngIf",ye.haveChoose(T))}}function De(A,Me){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,I))}function Se(A,Me){if(1&A&&(l.j41(0,"div",12),l.DNE(1,ue,1,1,"ng-template",13)(2,De,1,2,"lucide-icon",14),l.j41(3,"span",15),l.EFF(4),l.k0s()()),2&A){const T=Me.$implicit,ye=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(ye.isKey(T)&&ye.haveChoose(T))),l.R7$(),l.Y8G("ngIf",ye.isKey(T)&&ye.haveChoose(T)),l.R7$(2),l.JRh(T.alpha?T.alpha:T.key?T.key:T)}}function Xe(A,Me){if(1&A&&(l.j41(0,"div",8)(1,"span",9),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",10),l.DNE(5,Se,5,3,"div",11),l.k0s()()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngStyle",l.eq3(7,Pe,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(3,5,"lang_auto_dap_an_dung"),": ",T.key,""),l.R7$(2),l.Y8G("ngStyle",l.eq3(9,Z,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",T.labelArr)}}function Ve(A,Me){if(1&A&&(l.qex(0),l.j41(1,"span",25),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"mytranslate"),l.k0s(),l.bVm()),2&A){const T=Me.$implicit,ye=l.XpG(2);l.R7$(),l.Y8G("ngStyle",l.eq3(9,Pe,l.brH(2,3,T,ye.keys,ye.userAnswersObj["id_"+ye.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T," - ",l.bMT(4,7,ye.keys.includes((T.alpha?T.alpha:T.key?T.key:"")+"T")?"lang_auto_dung":"lang_auto_sai"),"\xa0 ")}}function mt(A,Me){1&A&&l.nrm(0,"lucide-icon",17),2&A&&l.Y8G("ngClass",l.lJ4(1,q))}function pe(A,Me){1&A&&l.nrm(0,"lucide-icon",18),2&A&&l.Y8G("ngClass",l.lJ4(1,_e))}function Ge(A,Me){if(1&A&&(l.j41(0,"div",26),l.DNE(1,mt,1,2,"lucide-icon",16),l.nI1(2,"isTrueAnswerType5"),l.DNE(3,pe,1,2,"lucide-icon",14),l.nI1(4,"isTrueAnswerType5"),l.j41(5,"span",15),l.EFF(6),l.nI1(7,"getAnswerChoiceTrueFalseQuestion"),l.nI1(8,"mytranslate"),l.k0s()()),2&A){const T=Me.$implicit,ye=l.XpG(2);l.R7$(),l.Y8G("ngIf",!l.brH(2,4,T,ye.keys,ye.userAnswersObj["id_"+(null==ye.questionObj?null:ye.questionObj.id)])),l.R7$(2),l.Y8G("ngIf",l.brH(4,8,T,ye.keys,ye.userAnswersObj["id_"+(null==ye.questionObj?null:ye.questionObj.id)])),l.R7$(3),l.Lme("",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T," - ",l.bMT(8,15,l.i5U(7,12,T,ye.userAnswersObj["id_"+ye.questionObj.id])),"")}}function he(A,Me){if(1&A&&(l.j41(0,"div",19)(1,"span",20),l.EFF(2),l.nI1(3,"mytranslate"),l.DNE(4,Ve,5,11,"ng-container",21),l.k0s(),l.j41(5,"div",22)(6,"div",23),l.DNE(7,Ge,9,17,"div",24),l.k0s()()()),2&A){const T=l.XpG();l.R7$(2),l.SpI(" ",l.bMT(3,4,"lang_auto_dap_an_dung"),": "),l.R7$(2),l.Y8G("ngForOf",T.labelArr),l.R7$(),l.Y8G("ngStyle",l.eq3(6,Z,T.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.Y8G("ngForOf",T.labelArr)}}function Ke(A,Me){if(1&A&&(l.j41(0,"span",9),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const T=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,Pe,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",T.keys.join("],["),"]")}}function X(A,Me){if(1&A&&(l.j41(0,"div",8),l.DNE(1,Ke,3,7,"span",27),l.j41(2,"div",28)(3,"div",29),l.EFF(4),l.nI1(5,"trimEndFillAnswer"),l.nI1(6,"mytranslate"),l.k0s()()()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",T.keys),l.R7$(),l.Y8G("ngStyle",l.eq3(8,Z,T.isFillAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==T.userAnswersObj["id_"+T.questionObj.id]?l.i5U(5,3,T.userAnswersObj["id_"+T.questionObj.id],T.isOfflineMark):l.bMT(6,6,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function oe(A,Me){if(1&A){const T=l.RV6();l.j41(0,"div")(1,"span",32),l.bIt("click",function(){l.eBV(T);const je=l.XpG(2);return l.Njj(je.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.JRh(l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function Be(A,Me){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function we(A,Me){if(1&A&&(l.qex(0),l.nrm(1,"div",33),l.bVm()),2&A){const T=l.XpG(3);l.R7$(),l.Y8G("innerText",T.userAnswersObj["id_"+T.questionObj.id])}}function W(A,Me){if(1&A&&(l.qex(0),l.DNE(1,Be,3,3,"div",31)(2,we,2,1,"ng-container",31),l.bVm()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",!T.userAnswersObj["id_"+T.questionObj.id]),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+T.questionObj.id])}}function fe(A,Me){if(1&A&&(l.j41(0,"div",30),l.DNE(1,oe,4,3,"div",31)(2,W,3,2,"ng-container",31),l.k0s()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==T.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=T.currentTab)}}let lt=(()=>{var A;class Me extends ie{ngOnInit(){super.ngOnInit()}}return(A=Me).\u0275fac=(()=>{let T;return function(je){return(T||(T=l.xGo(A)))(je||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-teacher"]],features:[l.Vt3],decls:11,vars:13,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none"],[1,"flex"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k","class","explainTxt text-pending cursor-pointer mt-2",3,"ngStyle","click",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box-type1 mt-2","style","flex-wrap: wrap",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k",1,"explainTxt","text-pending","cursor-pointer","mt-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"answer-box-type1","mt-2"],[1,"keyText","my-1",3,"ngStyle"],["id","type_1",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"answer-box-type1","mt-2",2,"flex-wrap","wrap"],[1,"keyText","my-1"],[4,"ngFor","ngForOf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],[1,"label-item",2,"display","block !important","width","auto !important"],["class","flex w-full mt-1","style","align-items: center",4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"flex","w-full","mt-1",2,"align-items","center"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(ye,je){1&ye&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,xe,4,9,"span",2),l.k0s(),l.DNE(3,Xe,6,11,"div",3),l.nI1(4,"isOneChoiceAnswer"),l.DNE(5,he,8,8,"div",4),l.nI1(6,"isTrueFalseAnswer"),l.DNE(7,X,7,10,"div",3),l.nI1(8,"isFillAnswer"),l.DNE(9,fe,3,2,"div",5),l.nI1(10,"isEssayAnswer"),l.k0s()),2&ye&&(l.R7$(2),l.Y8G("ngIf",je.questionObj.help),l.R7$(),l.Y8G("ngIf",l.bMT(4,5,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(6,7,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(8,9,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(10,11,je.questionObj)))},dependencies:[U.YU,U.Sq,U.bT,U.B3,k.WGl,j.wp,j.V6,j.Zm,j.N3,j.FC,j.jr,j.C0,j.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Me})();var Dt=v(65162);const nt=A=>({"p-2":A}),Et=A=>({"justify-content":A}),Ye=A=>({"mt-3":A}),ft=(A,Me,T)=>({width:A,"margin-right":Me,"margin-left":T}),Je=()=>({"ml-1":!0}),Ne=A=>[A],Y=A=>({backto:A}),ae=()=>({"text-transform":"uppercase"}),de=(A,Me)=>({"flex justify-between w-full items-center":A,"answer-box-type1":Me}),N=A=>({"border-color":A}),S=A=>({color:A}),M=()=>({"text-danger mr-1":!0}),V=()=>({"mr-1":!0}),Te=()=>({"text-success mr-1":!0}),ve=A=>({"w-full":A}),Ze=()=>({color:"#00ac33",width:"53px"}),Re=A=>({color:A,width:"53px"}),rt=()=>({color:"red"});function st(A,Me){if(1&A){const T=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("ngStyle",l.sMw(7,ft,T.isShowExplainButton?"125px":"0px",T.isShowExplainButton?"-40px":"0px",T.isMobileDevice?"":"8px")),l.BMQ("style",T.isShowExplainButton&&!T.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",T.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(11,Je))}}function ne(A,Me){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const T=l.XpG();l.Y8G("routerLink",l.eq3(8,Ne,l.bMT(1,4,"/on-luyen/"+T.questionObj.practiceHashId)))("queryParams",l.eq3(10,Y,T.backToLink))("ngStyle",l.lJ4(12,ae)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function We(A,Me){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const T=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,S,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung"),": ",T.key,"")}}function Ue(A,Me){1&A&&l.nrm(0,"span",17)}function E(A,Me){1&A&&l.nrm(0,"lucide-icon",23),2&A&&l.Y8G("ngClass",l.lJ4(1,M))}function L(A,Me){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,V))}function z(A,Me){if(1&A&&l.DNE(0,E,1,2,"lucide-icon",22)(1,L,1,2,"lucide-icon",20),2&A){const T=l.XpG().$implicit,ye=l.XpG(2);l.Y8G("ngIf",ye.haveChoose(T)&&2!=ye.examObj.whenShowAnswer&&!ye.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",ye.haveChoose(T)&&2!=ye.examObj.whenShowAnswer&&ye.notShowAnswerYet)}}function G(A,Me){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,V))}function me(A,Me){if(1&A&&l.DNE(0,G,1,2,"lucide-icon",20),2&A){const T=l.XpG().$implicit,ye=l.XpG(2);l.Y8G("ngIf",ye.haveChoose(T)&&2==ye.examObj.whenShowAnswer)}}function le(A,Me){1&A&&l.nrm(0,"lucide-icon",24),2&A&&l.Y8G("ngClass",l.lJ4(1,Te))}function J(A,Me){if(1&A&&(l.j41(0,"div",18),l.DNE(1,z,2,2,"ng-template",19)(2,me,1,1,"ng-template",19)(3,le,1,2,"lucide-icon",20),l.j41(4,"span",21),l.EFF(5),l.k0s()()),2&A){const T=Me.$implicit,ye=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(ye.isKey(T)&&ye.haveChoose(T))),l.R7$(),l.Y8G("ngIf",!(ye.isKey(T)&&ye.haveChoose(T))),l.R7$(),l.Y8G("ngIf",ye.isKey(T)&&ye.haveChoose(T)&&2!=ye.examObj.whenShowAnswer),l.R7$(2),l.JRh(T.alpha?T.alpha:T.key?T.key:T)}}function Ae(A,Me){if(1&A&&(l.j41(0,"div",11),l.DNE(1,We,3,7,"span",12)(2,Ue,1,0,"span",13),l.j41(3,"div",14),l.DNE(4,J,6,4,"div",15),l.k0s()()),2&A){const T=l.XpG();l.Y8G("ngClass",l.l_i(5,de,T.isMobileDevice,!T.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",T.keys&&2==T.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(8,N,T.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",T.labelArr)}}function Ce(A,Me){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.bVm()),2&A){const T=Me.$implicit,ye=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.lJ4(5,Ze)),l.R7$(),l.Lme(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T,") ",l.bMT(3,3,ye.keys.includes((T.alpha?T.alpha:T.key?T.key:"")+"T")?"lang_auto_dung":"lang_auto_sai")," ")}}function be(A,Me){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,Ce,4,6,"ng-container",31),l.k0s()()),2&A){const T=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_auto_dap_an_dung"),":"),l.R7$(3),l.Y8G("ngForOf",T.labelArr)}}function Le(A,Me){if(1&A&&(l.qex(0),l.j41(1,"div",32),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"getAnswerChoiceTrueFalseQuestion"),l.nI1(5,"mytranslate"),l.k0s(),l.bVm()),2&A){const T=Me.$implicit,ye=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.eq3(12,Re,l.brH(2,3,T,ye.keys,ye.userAnswersObj["id_"+ye.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T,") ",l.bMT(5,10,l.i5U(4,7,T,ye.userAnswersObj["id_"+ye.questionObj.id]))," ")}}function qe(A,Me){if(1&A&&(l.j41(0,"div",28)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",30),l.DNE(5,Le,6,14,"ng-container",31),l.k0s()()),2&A){const T=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_dap_an_thi_sinh_chon"),":"),l.R7$(3),l.Y8G("ngForOf",T.labelArr)}}function Qe(A,Me){if(1&A&&(l.j41(0,"span",32),l.EFF(1),l.k0s()),2&A){const T=l.XpG().$implicit;l.Y8G("ngStyle",l.lJ4(2,rt)),l.R7$(),l.SpI(" ",T.alpha?T.alpha.toLowerCase():T.key?T.key.toLowerCase():T,") \xa0 ")}}function P(A,Me){if(1&A&&(l.qex(0),l.DNE(1,Qe,2,3,"span",34),l.nI1(2,"isTrueAnswerType5"),l.bVm()),2&A){const T=Me.$implicit,ye=l.XpG(3);l.R7$(),l.Y8G("ngIf",!l.brH(2,1,T,ye.keys,ye.userAnswersObj["id_"+ye.questionObj.id]))}}function ze(A,Me){if(1&A&&(l.j41(0,"div",33)(1,"div",29),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.DNE(4,P,3,5,"ng-container",31),l.k0s()),2&A){const T=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_cau_lam_sai"),":"),l.R7$(2),l.Y8G("ngForOf",T.labelArr)}}function tt(A,Me){if(1&A&&(l.j41(0,"div",25),l.DNE(1,be,6,4,"div",26)(2,qe,6,4,"div",26)(3,ze,5,4,"div",27),l.k0s()),2&A){const T=l.XpG();l.Y8G("ngClass",l.eq3(4,ve,T.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function at(A,Me){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A){const T=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,S,T.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",T.keys.join("],["),"]")}}function ct(A,Me){1&A&&l.nrm(0,"span",17)}function it(A,Me){if(1&A&&(l.j41(0,"div",35),l.DNE(1,at,3,7,"span",12)(2,ct,1,0,"span",13),l.j41(3,"div",36)(4,"div",37),l.EFF(5),l.nI1(6,"trimEndFillAnswer"),l.nI1(7,"mytranslate"),l.k0s()()()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",T.keys&&2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",T.keys&&2==T.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(9,N,T.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==T.userAnswersObj["id_"+T.questionObj.id]?l.i5U(6,4,T.userAnswersObj["id_"+T.questionObj.id],T.isOfflineMark):l.bMT(7,7,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function ut(A,Me){if(1&A){const T=l.RV6();l.j41(0,"div")(1,"span",40),l.bIt("click",function(){l.eBV(T);const je=l.XpG(2);return l.Njj(je.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Ut(A,Me){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function xt(A,Me){if(1&A&&(l.qex(0),l.nrm(1,"div",41),l.bVm()),2&A){const T=l.XpG(3);l.R7$(),l.Y8G("innerText",T.userAnswersObj["id_"+T.questionObj.id])}}function mn(A,Me){if(1&A&&(l.qex(0),l.DNE(1,Ut,3,3,"div",39)(2,xt,2,1,"ng-container",39),l.bVm()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===T.userAnswersObj["id_"+T.questionObj.id]),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+T.questionObj.id])}}function Kt(A,Me){if(1&A&&(l.j41(0,"div",38),l.DNE(1,ut,4,3,"div",39)(2,mn,3,2,"ng-container",39),l.k0s()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==T.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=T.currentTab)}}let an=(()=>{var A;class Me extends ie{}return(A=Me).\u0275fac=(()=>{let T;return function(je){return(T||(T=l.xGo(A)))(je||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-full-answer-for-student"]],features:[l.Vt3],decls:12,vars:23,consts:[[1,"question-standalone-answer-box-for-student","box","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngClass","ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center",3,"ngClass"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","mt-2 font-bold",3,"ngClass",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"mt-2","font-bold",3,"ngClass"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"keyText","my-1",3,"ngStyle"],[1,"keyText","my-1","ml-2"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[3,"ngClass"],["class","keyText my-1 font-medium flex",4,"ngIf"],["class","keyText my-1 font-medium text-red flex",4,"ngIf"],[1,"keyText","my-1","font-medium","flex"],[2,"width","100px"],[1,"flex","justify-between"],[4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"keyText","my-1","font-medium","text-red","flex"],["class","lalala ml-1",3,"ngStyle",4,"ngIf"],[1,"answer-box-type1","mt-2"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(ye,je){1&ye&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,st,4,12,"span",2)(3,ne,4,13,"a",3),l.k0s(),l.DNE(4,Ae,5,10,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,tt,4,6,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,it,8,11,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,Kt,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&ye&&(l.Y8G("ngClass",l.eq3(17,nt,!je.isMobileDevice))("ngStyle",l.eq3(19,Et,2==je.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(),l.Y8G("ngClass",l.eq3(21,Ye,je.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=je.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",je.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,9,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,11,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,13,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,15,je.questionObj)))},dependencies:[U.YU,U.Sq,U.bT,U.B3,Dt.Wk,k.WGl,j.F2,j.wp,j.V6,j.Zm,j.N3,j.FC,j.jr,j.C0,j.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Me})();const In=A=>({"justify-content":A}),Bt=(A,Me)=>({width:A,"margin-right":Me,"margin-left":"8px"}),gt=()=>({"ml-1":!0}),dn=A=>[A],jn=A=>({backto:A}),Vt=()=>({"text-transform":"uppercase"});function Nn(A,Me){if(1&A){const T=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("ngStyle",l.l_i(7,Bt,T.isShowExplainButton?"125px":"0px",T.isShowExplainButton?"-40px":"0px")),l.BMQ("style",T.isShowExplainButton&&!T.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",T.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(10,gt))}}function gn(A,Me){if(1&A&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&A){const T=l.XpG();l.Y8G("routerLink",l.eq3(8,dn,l.bMT(1,4,"/on-luyen/"+T.questionObj.practiceHashId)))("queryParams",l.eq3(10,jn,T.backToLink))("ngStyle",l.lJ4(12,Vt)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function Jt(A,Me){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function En(A,Me){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function fn(A,Me){if(1&A&&(l.j41(0,"span",13),l.DNE(1,Jt,3,3,"span",14)(2,En,3,3,"span",15),l.k0s()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+(null==T.questionObj?null:T.questionObj.id)]===T.key),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+(null==T.questionObj?null:T.questionObj.id)]!==T.key)}}function vn(A,Me){if(1&A){const T=l.RV6();l.j41(0,"div",11),l.bIt("click",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.showExplain())}),l.DNE(1,fn,3,2,"span",12),l.k0s()}if(2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function An(A,Me){if(1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.nI1(3,"mytranslate"),l.k0s()),2&A){const T=l.XpG(3);l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")+" "+T.countCorrectAnswerTrueFalse()+" "+l.bMT(3,3,"lang_azt_answer")," ")}}function pn(A,Me){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_do_not_choose_any_correct_answer")," "))}function tr(A,Me){if(1&A&&(l.j41(0,"span",13),l.DNE(1,An,4,5,"span",14)(2,pn,3,3,"span",15),l.k0s()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",T.countCorrectAnswerTrueFalse()),l.R7$(),l.Y8G("ngIf",!T.countCorrectAnswerTrueFalse())}}function Ro(A,Me){if(1&A){const T=l.RV6();l.j41(0,"div",18),l.bIt("click",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.showExplain())}),l.DNE(1,tr,3,2,"span",12),l.k0s()}if(2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function Oo(A,Me){1&A&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function Po(A,Me){1&A&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function ko(A,Me){if(1&A&&(l.j41(0,"span",13),l.DNE(1,Oo,3,3,"span",14)(2,Po,3,3,"span",15),l.k0s()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",T.isFillAnswer),l.R7$(),l.Y8G("ngIf",!T.isFillAnswer)}}function Mo(A,Me){if(1&A){const T=l.RV6();l.j41(0,"div",19),l.bIt("click",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.showExplain())}),l.DNE(1,ko,3,2,"span",12),l.k0s()}if(2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf",2!=T.examObj.whenShowAnswer&&!T.notShowAnswerYet)}}function Do(A,Me){if(1&A){const T=l.RV6();l.j41(0,"div")(1,"span",22),l.bIt("click",function(){l.eBV(T);const je=l.XpG(2);return l.Njj(je.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&A&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Fo(A,Me){1&A&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&A&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Vo(A,Me){if(1&A&&(l.qex(0),l.nrm(1,"div",23),l.bVm()),2&A){const T=l.XpG(3);l.R7$(),l.Y8G("innerText",T.userAnswersObj["id_"+T.questionObj.id])}}function jo(A,Me){if(1&A&&(l.qex(0),l.DNE(1,Fo,3,3,"div",21)(2,Vo,2,1,"ng-container",21),l.bVm()),2&A){const T=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===T.userAnswersObj["id_"+T.questionObj.id]),l.R7$(),l.Y8G("ngIf",T.userAnswersObj["id_"+T.questionObj.id])}}function No(A,Me){if(1&A&&(l.j41(0,"div",20),l.DNE(1,Do,4,3,"div",21)(2,jo,3,2,"ng-container",21),l.k0s()),2&A){const T=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==T.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=T.currentTab)}}let zo=(()=>{var A;class Me extends ie{countCorrectAnswerTrueFalse(){return this.labelArr.filter(ye=>this.sAztAnswerTrueFalseService.checkIsTrueType5(ye,this.keys,this.userAnswersObj["id_"+this.questionObj?.id])).length}}return(A=Me).\u0275fac=(()=>{let T;return function(je){return(T||(T=l.xGo(A)))(je||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-only-true-or-false-answer-for-student"]],features:[l.Vt3],decls:12,vars:17,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","answer-box-type1 cursor-pointer mt-2",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer","style","flex-wrap: wrap",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer",3,"click",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"answer-box-type1","cursor-pointer","mt-2",3,"click"],["class","font-medium text-base my-1 px-1",4,"ngIf"],[1,"font-medium","text-base","my-1","px-1"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-success"],[1,"text-danger"],[1,"answer-box-type1","mt-2","cursor-pointer",2,"flex-wrap","wrap",3,"click"],[1,"answer-box-type1","mt-2","cursor-pointer",3,"click"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(ye,je){1&ye&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,Nn,4,11,"span",2)(3,gn,4,13,"a",3),l.k0s(),l.DNE(4,vn,2,1,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,Ro,2,1,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,Mo,2,1,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,No,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&ye&&(l.Y8G("ngStyle",l.eq3(15,In,2==je.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(2),l.Y8G("ngIf",2!=je.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",je.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,7,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,9,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,11,je.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,13,je.questionObj)))},dependencies:[U.YU,U.bT,U.B3,Dt.Wk,k.WGl,j.F2,j.wp,j.V6,j.Zm,j.N3,j.FC],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),Me})();function Bo(A,Me){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-full-answer-for-student",2),l.mxI("isShowExplainChange",function(je){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,je)||(jt.isShowExplain=je),l.Njj(je)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.isShowExplainChange.emit(je.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet)("isTeacherRole",T.isTeacherRole)("isShowOriginAnswer",T.isShowOriginAnswer),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}function ci(A,Me){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-only-true-or-false-answer-for-student",3),l.mxI("isShowExplainChange",function(je){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,je)||(jt.isShowExplain=je),l.Njj(je)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.isShowExplainChange.emit(je.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("isTeacherRole",T.isTeacherRole)("isShowOriginAnswer",T.isShowOriginAnswer)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}let Lo=(()=>{var A;class Me extends ie{constructor(){super(...arguments),this.checkShowFullAnswer=!1}ngOnInit(){this.checkShowFullAnswer=!(this.examConfig&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction&&!this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought)}}return(A=Me).\u0275fac=(()=>{let T;return function(je){return(T||(T=l.xGo(A)))(je||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-with-user-answer-for-student"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(ye,je){1&ye&&l.DNE(0,Bo,1,11,"azt-answer-box-with-user-full-answer-for-student",0)(1,ci,1,11,"azt-answer-box-with-user-only-true-or-false-answer-for-student",1),2&ye&&(l.Y8G("ngIf",je.checkShowFullAnswer),l.R7$(),l.Y8G("ngIf",!je.checkShowFullAnswer))},dependencies:[U.bT,an,zo],encapsulation:2}),Me})();function ui(A,Me){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-student",2),l.mxI("isShowExplainChange",function(je){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,je)||(jt.isShowExplain=je),l.Njj(je)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.isShowExplainChange.emit(je.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet)("isTeacherRole",T.isTeacherRole)("isShowOriginAnswer",T.isShowOriginAnswer),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}function hi(A,Me){if(1&A){const T=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-teacher",3),l.mxI("isShowExplainChange",function(je){l.eBV(T);const jt=l.XpG();return l.DH7(jt.isShowExplain,je)||(jt.isShowExplain=je),l.Njj(je)}),l.bIt("isShowExplainChange",function(){l.eBV(T);const je=l.XpG();return l.Njj(je.isShowExplainChange.emit(je.isShowExplain))}),l.k0s()}if(2&A){const T=l.XpG();l.Y8G("examObj",T.examObj)("examConfig",T.examConfig)("questionObj",T.questionObj)("userAnswersObj",T.userAnswersObj)("notShowAnswerYet",T.notShowAnswerYet)("isShowOriginAnswer",T.isShowOriginAnswer)("isTeacherRole",T.isTeacherRole),l.R50("isShowExplain",T.isShowExplain),l.Y8G("backToLink",T.backToLink)("isOfflineMark",T.isOfflineMark)("currentTab",T.currentTab)}}let ls=(()=>{var A;class Me extends ie{ngOnInit(){}}return(A=Me).\u0275fac=(()=>{let T;return function(je){return(T||(T=l.xGo(A)))(je||A)}})(),A.\u0275cmp=l.VBU({type:A,selectors:[["azt-answer-box-view-base"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(ye,je){1&ye&&l.DNE(0,ui,1,11,"azt-answer-box-with-user-answer-for-student",0)(1,hi,1,11,"azt-answer-box-with-user-answer-for-teacher",1),2&ye&&(l.Y8G("ngIf",!je.isTeacherRole),l.R7$(),l.Y8G("ngIf",je.isTeacherRole))},dependencies:[U.bT,lt,Lo],encapsulation:2}),Me})()},84278:(yt,Oe,v)=>{v.d(Oe,{x:()=>xe});var l=v(64486),d=v(66793),c=v(30657),m=v(48891),w=v(54460),C=v(42789),H=v(60780),y=v(58447),ie=v(15423),U=v(52325),k=v(54313),j=v(34660),$=v(97760),se=v(44101);const Pe=Ee=>({"skeleton-box-loading":Ee}),Z=(Ee,ue,De)=>({"pb-2":Ee,"p-0":ue,"p-3":De}),B=()=>[];function I(Ee,ue){if(1&Ee&&m.nrm(0,"div",3),2&Ee){const De=m.XpG();m.Y8G("ngClass",m.eq3(1,Pe,De.renderConfigObj.isFirstRender))}}function q(Ee,ue){if(1&Ee&&m.nrm(0,"azt-test-audio-ui",15),2&Ee){const De=m.XpG(2);m.Y8G("questionObj",De.questionObj)("isShowList",!0)}}function _e(Ee,ue){if(1&Ee){const De=m.RV6();m.j41(0,"div",4)(1,"div",5),m.nrm(2,"azt-question-group-content-box",6),m.j41(3,"div",7),m.DNE(4,q,1,2,"azt-test-audio-ui",8),m.j41(5,"div",9),m.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),m.k0s(),m.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),m.k0s()(),m.j41(10,"azt-answer-box-view-base",13),m.mxI("isShowExplainChange",function(Xe){m.eBV(De);const Ve=m.XpG();return m.DH7(Ve.isShowExplain,Xe)||(Ve.isShowExplain=Xe),m.Njj(Xe)}),m.bIt("isShowExplainChange",function(Xe){m.eBV(De);const Ve=m.XpG();return m.Njj(Ve.isShowExplain=Xe)}),m.k0s(),m.nrm(11,"azt-question-explain-box",14),m.k0s()}if(2&Ee){let De;const Se=m.XpG();m.R7$(),m.xc7("font-size","1em")("line-height","1.7"),m.Y8G("id","question_render_container_"+Se.questionObj.id)("ngClass",m.sMw(42,Z,Se.questionObj.attachments.length>0,Se.isMobileDevice,!Se.isMobileDevice)),m.R7$(),m.Y8G("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj),m.R7$(2),m.Y8G("ngIf",Se.questionObj.attachments.length>0),m.R7$(2),m.Y8G("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj)("curQuestionIndex",Se.curQuestionIndex),m.R7$(),m.Y8G("showForTeacher",!1)("curExamResultId",null!==(De=Se.curExamResultId)&&void 0!==De?De:0)("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj)("curQuestionIndex",Se.curQuestionIndex)("orgExamObjs",m.lJ4(46,B)),m.R7$(),m.Y8G("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj),m.R7$(),m.Y8G("examObj",Se.examObj)("isShowOriginAnswer",Se.isShowOriginAnswer)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj),m.R7$(),m.Y8G("examObj",Se.examObj)("examConfig",Se.examConfig)("isTeacherRole",!1)("isShowOriginAnswer",Se.isShowOriginAnswer)("questionObj",Se.questionObj)("userAnswersObj",Se.userAnswersObj)("notShowAnswerYet",Se.notShowAnswerYet),m.R50("isShowExplain",Se.isShowExplain),m.Y8G("backToLink",Se.backToLink)("isOfflineMark",Se.isOfflineMark)("currentTab",Se.currentTab),m.R7$(),m.Y8G("isShowExplain",Se.isShowExplain)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj)}}let xe=(()=>{var Ee;class ue extends l.I{ngOnInit(){super.ngOnInit();let Se=new d.C(!1,!1,!1);super.initData(Se,this.follower,this.questionObj),this.backToLink=`/test/answer-test/${this.examObj?.tenantId??0}/${this.examObj?.categoryId??0}/${this.examObj?.hashId}/${this.curExamResultId}`}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.isShowExplain=!1,this.isShowOriginAnswer=!1,this.isOfflineMark=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.checkShowFullAnswer=!1}}return(Ee=ue).\u0275fac=function(Se){return new(Se||Ee)},Ee.\u0275cmp=m.VBU({type:Ee,selectors:[["azt-question-standalone-for-student-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId",examConfig:"examConfig",isShowExplain:"isShowExplain",isShowOriginAnswer:"isShowOriginAnswer",isOfflineMark:"isOfflineMark",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[m.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","curExamResultId","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","isShowOriginAnswer","questionObj","renderConfigObj"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Se,Xe){if(1&Se&&(m.j41(0,"div",1),m.DNE(1,I,1,3,"div",2)(2,_e,12,47,"ng-template",null,0,m.C5r),m.k0s()),2&Se){const Ve=m.sdS(3);m.Y8G("id","question_render_element_"+Xe.questionObj.id),m.R7$(),m.Y8G("ngIf",!Xe.renderConfigObj.isRenderElement)("ngIfElse",Ve)}},dependencies:[w.YU,w.bT,C.N,H.c,y.y,ie.N,U.Q,k.$,j.S,$.U,se.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ue})()},34815:(yt,Oe,v)=>{v.d(Oe,{o:()=>_e});var l=v(64486),d=v(66793),c=v(30657),m=v(48891),w=v(54460),C=v(42789),H=v(60780),y=v(58447),ie=v(15423),U=v(52325),k=v(54313),j=v(34660),$=v(97760),se=v(44101);const Pe=xe=>({"skeleton-box-loading":xe}),Z=(xe,Ee)=>({"pb-2":xe,"mob-web-width":Ee});function B(xe,Ee){if(1&xe&&m.nrm(0,"div",3),2&xe){const ue=m.XpG();m.Y8G("ngClass",m.eq3(1,Pe,ue.renderConfigObj.isFirstRender))}}function I(xe,Ee){if(1&xe&&m.nrm(0,"azt-test-audio-ui",15),2&xe){const ue=m.XpG(2);m.Y8G("questionObj",ue.questionObj)("isShowList",!0)}}function q(xe,Ee){if(1&xe){const ue=m.RV6();m.j41(0,"div",4)(1,"div",5),m.nrm(2,"azt-question-group-content-box",6),m.j41(3,"div",7),m.DNE(4,I,1,2,"azt-test-audio-ui",8),m.j41(5,"div",9),m.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),m.k0s(),m.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),m.k0s()(),m.j41(10,"azt-answer-box-view-base",13),m.mxI("isShowExplainChange",function(Se){m.eBV(ue);const Xe=m.XpG();return m.DH7(Xe.isShowExplain,Se)||(Xe.isShowExplain=Se),m.Njj(Se)}),m.bIt("isShowExplainChange",function(Se){m.eBV(ue);const Xe=m.XpG();return m.Njj(Xe.isShowExplain=Se)}),m.k0s(),m.nrm(11,"azt-question-explain-box",14),m.k0s()}if(2&xe){const ue=m.XpG();m.R7$(),m.xc7("font-size","1em")("line-height","1.7"),m.Y8G("id","question_render_container_"+ue.questionObj.id)("ngClass",m.l_i(39,Z,ue.questionObj.attachments.length>0,ue.isMobileWebView)),m.R7$(),m.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj),m.R7$(2),m.Y8G("ngIf",ue.questionObj.attachments.length>0),m.R7$(2),m.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj)("curQuestionIndex",ue.curQuestionIndex),m.R7$(),m.Y8G("showForTeacher",!0)("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj)("curQuestionIndex",ue.curQuestionIndex)("orgExamObjs",ue.orgExamObjs),m.R7$(),m.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj),m.R7$(),m.Y8G("examObj",ue.examObj)("questionObj",ue.questionObj)("isShowOriginAnswer",ue.isShowOriginAnswer)("renderConfigObj",ue.renderConfigObj),m.R7$(),m.Y8G("examObj",ue.examObj)("isTeacherRole",!0)("isShowOriginAnswer",ue.isShowOriginAnswer)("questionObj",ue.questionObj)("userAnswersObj",ue.userAnswersObj)("notShowAnswerYet",ue.notShowAnswerYet)("isOfflineMark",ue.isOfflineMark),m.R50("isShowExplain",ue.isShowExplain),m.Y8G("currentTab",ue.currentTab),m.R7$(),m.Y8G("isShowExplain",ue.isShowExplain)("questionObj",ue.questionObj)("renderConfigObj",ue.renderConfigObj)}}let _e=(()=>{var xe;class Ee extends l.I{ngOnInit(){super.ngOnInit();let De=new d.C(!1,!1,!1);super.initData(De,this.follower,this.questionObj)}constructor(){super(),this.follower=new c.e,this.curQuestionIndex=0,this.orgExamObjs=[],this.isShowExplain=!1,this.isOfflineMark=!1,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab"}}return(xe=Ee).\u0275fac=function(De){return new(De||xe)},xe.\u0275cmp=m.VBU({type:xe,selectors:[["azt-question-standalone-for-teacher-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",orgExamObjs:"orgExamObjs",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isShowOriginAnswer:"isShowOriginAnswer",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[m.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"question-standalone-container","box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","questionObj","isShowOriginAnswer","renderConfigObj"],[3,"isShowExplainChange","examObj","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isOfflineMark","isShowExplain","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(De,Se){if(1&De&&(m.j41(0,"div",1),m.DNE(1,B,1,3,"div",2)(2,q,12,42,"ng-template",null,0,m.C5r),m.k0s()),2&De){const Xe=m.sdS(3);m.Y8G("id","question_render_element_"+Se.questionObj.id),m.R7$(),m.Y8G("ngIf",!Se.renderConfigObj.isRenderElement)("ngIfElse",Xe)}},dependencies:[w.YU,w.bT,C.N,H.c,y.y,ie.N,U.Q,k.$,j.S,$.U,se.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),Ee})()},97760:(yt,Oe,v)=>{v.d(Oe,{U:()=>Xe});var l=v(59640),d=v(95887),c=v(89163),m=v(33887),w=v(25539),C=v(48891),H=v(9280),y=v(54460),ie=v(52654),U=v(2915),k=v(52811),j=v(76975);function $(Ve,mt){1&Ve&&(C.j41(0,"div",10)(1,"span",11),C.nrm(2,"azt-loading-ui"),C.k0s(),C.j41(3,"span",12),C.EFF(4),C.nI1(5,"mytranslate"),C.k0s()()),2&Ve&&(C.R7$(4),C.JRh(C.bMT(5,1,"lang_auto_dang_chuan_bi_tai_lieu_doing")))}function se(Ve,mt){1&Ve&&(C.j41(0,"div",13),C.EFF(1),C.nI1(2,"mytranslate"),C.k0s()),2&Ve&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"lang_azt_cau_hoi_chua_co_lan_sua_nao")," "))}function Pe(Ve,mt){if(1&Ve&&C.nrm(0,"azt-question-standalone-for-preview",17),2&Ve){const pe=C.XpG().$implicit,Ge=C.XpG();C.Y8G("examObj",Ge.data.examObj)("questionObj",pe.questionLog)("follower",Ge.data.follower)("curQuestionIndex",Ge.data.curQuestionIndex)}}function Z(Ve,mt){if(1&Ve&&(C.qex(0),C.j41(1,"div",14),C.EFF(2),C.nI1(3,"mytranslate"),C.nI1(4,"formatFullDateTimeWithoutSecondByUserUnitPipe"),C.k0s(),C.j41(5,"div",15),C.DNE(6,Pe,1,4,"azt-question-standalone-for-preview",16),C.k0s(),C.bVm()),2&Ve){const pe=mt.$implicit;C.R7$(2),C.SpI(" ",C.bMT(3,2,"lang_azota_ui_the_time_of_question_editing")+": "+C.bMT(4,4,pe.createdAt)," "),C.R7$(4),C.Y8G("ngIf",pe.questionLog)}}let B=(()=>{var Ve;class mt extends m._{closeDialog(){this.dialogRef.close()}getLogQuestion(Ge){this.initStatusObj(),this.waitDestroy(this.questionService.apiQuestionsIdLogsGet(Ge,this.data.isTeacher?void 0:this.data.curExamResultId).subscribe(he=>{he.success?((he.data?.objs??[]).forEach(X=>{let oe={createdAt:X.createdAt,questionLog:this.commonService.castJsonToClassObj(w.I,JSON.stringify(X.questionLog))};oe.questionLog&&(oe.questionLog.isLogEditQuestion=!0),this.questionLogCustomList.push(oe)}),this.successStatusObj()):this.errorStatusObj(he.message??"",!0)}))}ngOnInit(){this.getLogQuestion(this.data.questionObj.id)}constructor(Ge,he,Ke){super(Ke,he),this.questionService=Ge,this.dialogRef=he,this.data=Ke,this.questionLogCustomList=[]}}return(Ve=mt).\u0275fac=function(Ge){return new(Ge||Ve)(C.rXU(H.wP),C.rXU(c.CP,8),C.rXU(c.Vh,8))},Ve.\u0275cmp=C.VBU({type:Ve,selectors:[["show-question-edit-history-dialog"]],features:[C.Vt3],decls:15,vars:13,consts:[[1,"box"],[1,"font-medium","p-3","bg-slate-100","dark:bg-darkmode-400"],[3,"defaultHeight"],["class","flex justify-center items-center h-40",4,"ngIf"],["id","boxContentQuestion",1,"p-2"],["class","flex p-5 justify-center items-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","pt-3"],[1,"ml-auto"],[1,"btn","btn-secondary",3,"click"],[1,"flex","justify-center","items-center","h-40"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"flex","p-5","justify-center","items-center"],[1,"p-2","pb-0","text-xs","font-medium",2,"margin-bottom","-10px"],[1,"p-2"],[3,"examObj","questionObj","follower","curQuestionIndex",4,"ngIf"],[3,"examObj","questionObj","follower","curQuestionIndex"]],template:function(Ge,he){1&Ge&&(C.j41(0,"div",0)(1,"div",1),C.EFF(2),C.nI1(3,"mytranslate"),C.nI1(4,"mytranslate"),C.k0s(),C.j41(5,"azt-mat-dialog-content",2),C.DNE(6,$,6,3,"div",3),C.j41(7,"div",4),C.DNE(8,se,3,3,"div",5)(9,Z,7,6,"ng-container",6),C.k0s()(),C.j41(10,"div",7)(11,"div",8)(12,"button",9),C.bIt("click",function(){return he.closeDialog()}),C.EFF(13),C.nI1(14,"mytranslate"),C.k0s()()()()),2&Ge&&(C.R7$(2),C.Lme(" ",C.bMT(3,7,"lang_azota_ui_the_history_of_question_editing")," (",he.questionLogCustomList.length+" "+C.bMT(4,9,"lang_testbank_powerpoint_times"),") "),C.R7$(3),C.Y8G("defaultHeight",60),C.R7$(),C.Y8G("ngIf",he.statusObj.loading),C.R7$(2),C.Y8G("ngIf",!he.questionLogCustomList.length&&!he.statusObj.loading),C.R7$(),C.Y8G("ngForOf",he.questionLogCustomList),C.R7$(4),C.SpI(" ",C.bMT(14,11,"lang_auto_dong")," "))},dependencies:[y.Sq,y.bT,ie.a,U.U,k.R,j.wp,j.bH],encapsulation:2}),mt})();var I=v(30657),q=v(46899),_e=v(65162),xe=v(9691),Ee=v(47712),ue=v(15343);function De(Ve,mt){if(1&Ve){const pe=C.RV6();C.j41(0,"div",3)(1,"button",4),C.nI1(2,"mytranslate"),C.bIt("click",function(){C.eBV(pe);const he=C.XpG();return C.Njj(he.goToEditQuestion())}),C.nrm(3,"lucide-icon",5),C.k0s()()}2&Ve&&(C.R7$(),C.FS9("matTooltip",C.bMT(2,1,"lang_core_chinh_sua_de_thi")))}function Se(Ve,mt){if(1&Ve){const pe=C.RV6();C.j41(0,"div")(1,"button",4),C.nI1(2,"mytranslate"),C.bIt("click",function(){C.eBV(pe);const he=C.XpG();return C.Njj(he.showEditHistoryDialog())}),C.nrm(3,"lucide-icon",6),C.k0s()()}2&Ve&&(C.R7$(),C.FS9("matTooltip",C.bMT(2,1,"lang_azota_ui_the_history_of_question_editing")))}let Xe=(()=>{var Ve;class mt extends l.H{checkEditQuestion(){const Ge=this.questionObj?.createdAt,he=this.questionObj?.updatedAt;let Ke=this.timeService.calculationTimeOnlyMinutes(Ge,he);this.isEditQuestion=Number(Ke)>0}isOrgQuestion(){return null!=this.orgExamObjs.find(Ge=>Ge.questionId==this.questionObj.id)}goToEditQuestion(){var Ge=this.commonService.getMyParam(this.activeRoute,"cat_id")??"0",he=this.activeRoute.snapshot.paramMap.get("result_id")??"0",Ke=this.activeRoute.snapshot.paramMap.get("user_id")??"",X=this.activeRoute.snapshot.paramMap.get("student_id")??"",oe=this.activeRoute.snapshot.paramMap.get("exam_id")??"",Be=Ge,we=oe;let W=this.orgExamObjs.find(Dt=>Dt.questionId==this.questionObj.id);W&&(Be=W.orgCategoryId?.toString()??"0",we=W.orgExamId?.toString()??"0");var fe=this.commonService.getMyQueryParam("backto")??"";let lt=`/admin/testbank/test-review/${oe}/${Ke}/${X}/${he}`+(fe?"?backto="+encodeURIComponent(fe):"");window.location.href=this.commonService.getLocalRouter("/admin/testbank/update-exam/"+Be)+"/"+we+"?backto="+encodeURIComponent(lt)+"&questionId="+this.questionObj.id}showEditHistoryDialog(){let Ge={follower:new I.e,examObj:this.examObj,questionObj:this.questionObj,renderConfigObj:this.renderConfigObj,curQuestionIndex:this.curQuestionIndex,curExamResultId:this.curExamResultId,isTeacher:this.showForTeacher};this.sAztDialogService.open(B,{width:"750px",data:Ge})}showFeedbackQuestionDialog(){this.sAztDialogService.open(d.g,{width:"750px",data:{questionObj:this.questionObj,role:this.showForTeacher?"TEACHER":"STUDENT",applyType:"MATRIX_QUESTION"},restoreFocus:!1,autoFocus:!1})}ngOnChanges(){this.checkEditQuestion()}constructor(Ge,he,Ke){super(),this.sAztDialogService=Ge,this.activeRoute=he,this.timeService=Ke,this.showForTeacher=!1,this.curExamResultId=0,this.isEditQuestion=!1}}return(Ve=mt).\u0275fac=function(Ge){return new(Ge||Ve)(C.rXU(q.i),C.rXU(_e.nX),C.rXU(xe.F))},Ve.\u0275cmp=C.VBU({type:Ve,selectors:[["azt-question-action-box"]],inputs:{examObj:"examObj",questionObj:"questionObj",renderConfigObj:"renderConfigObj",orgExamObjs:"orgExamObjs",showForTeacher:"showForTeacher",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId"},features:[C.Vt3,C.OA$],decls:4,vars:4,consts:[[1,"flex"],["class","mr-1",4,"ngIf"],[4,"ngIf"],[1,"mr-1"],[1,"btn","btn-outline-primary","btn-sm","p-1",3,"click","matTooltip"],["name","file-pen-line","size","18"],["name","history","size","18"]],template:function(Ge,he){1&Ge&&(C.j41(0,"div",0),C.DNE(1,De,4,3,"div",1),C.nI1(2,"isOfflineExam"),C.DNE(3,Se,4,3,"div",2),C.k0s()),2&Ge&&(C.R7$(),C.Y8G("ngIf",he.isOrgQuestion()&&!C.bMT(2,2,he.examObj)),C.R7$(2),C.Y8G("ngIf",he.isEditQuestion&&!he.questionObj.isLogEditQuestion))},dependencies:[y.bT,Ee.oV,ue.WGl,j.wp,j.st],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),mt})()},86622:(yt,Oe,v)=>{v.d(Oe,{C:()=>c});var l=v(71217),d=v(48891);let c=(()=>{var m;class w{constructor(){this.switchEssayTabSource=new l.t(!1),this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(H){this.switchEssayTabSource.next(H)}}return(m=w).\u0275fac=function(H){return new(H||m)},m.\u0275prov=d.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),w})()},95887:(yt,Oe,v)=>{v.d(Oe,{g:()=>Ge});var l=v(10936),d=v(89163),c=v(33887),m=v(15766),w=v(48891),C=v(96699),H=v(54460),y=v(43404),ie=v(15343),U=v(81587),k=v(52811),j=v(9570),$=v(76975);const se=(he,Ke)=>({"btn-primary":he,"btn-secondary":Ke}),Pe=()=>({"mr-2":!0});function Z(he,Ke){if(1&he&&(w.j41(0,"div",22)(1,"b",23),w.EFF(2),w.k0s(),w.j41(3,"div",24),w.nrm(4,"azt-dynamic-hook",17),w.k0s()()),2&he){let X;const oe=Ke.$implicit;w.R7$(2),w.SpI("",null!==(X=oe.alpha)&&void 0!==X?X:oe.key,"."),w.R7$(2),w.Y8G("content",oe.content)}}function B(he,Ke){if(1&he&&(w.j41(0,"div",20),w.DNE(1,Z,5,2,"div",21),w.k0s()),2&he){const X=w.XpG(2);w.R7$(),w.Y8G("ngForOf",X.data.questionObj.answers)}}function I(he,Ke){if(1&he&&(w.j41(0,"h2",25),w.EFF(1),w.nI1(2,"mytranslate"),w.k0s()),2&he){const X=w.XpG(2);w.R7$(),w.Lme(" ",w.bMT(2,2,"lang_auto_dap_an"),": ",X.data.questionObj.answerResult.join(", ")," ")}}function q(he,Ke){if(1&he&&(w.j41(0,"div",8)(1,"h2",10),w.EFF(2),w.nI1(3,"mytranslate"),w.k0s(),w.j41(4,"div",16),w.nrm(5,"azt-dynamic-hook",17),w.k0s(),w.DNE(6,B,2,1,"div",18)(7,I,3,4,"h2",19),w.k0s()),2&he){const X=w.XpG();w.R7$(2),w.SpI(" ",w.bMT(3,4,"lang_auto_noi_dung_cau_hoi")," "),w.R7$(3),w.Y8G("content",X.data.questionObj.content),w.R7$(),w.Y8G("ngIf",1==X.data.questionObj.answerType&&X.data.questionObj.answers&&X.data.questionObj.answers.length>0),w.R7$(),w.Y8G("ngIf",X.data.questionObj.answerResult&&X.data.questionObj.isRoleTeacher)}}function _e(he,Ke){if(1&he&&(w.j41(0,"div",8)(1,"h2",26),w.EFF(2),w.nI1(3,"mytranslate"),w.k0s(),w.j41(4,"div",27),w.nrm(5,"azt-dynamic-hook",17),w.k0s()()),2&he){const X=w.XpG();w.R7$(2),w.SpI(" ",w.bMT(3,2,"lang_auto_loi_giai")," "),w.R7$(3),w.Y8G("content",X.data.questionObj.help)}}function xe(he,Ke){1&he&&(w.qex(0),w.j41(1,"div",28)(2,"span",29),w.nrm(3,"azt-loading-ui"),w.k0s()(),w.bVm())}function Ee(he,Ke){if(1&he&&(w.j41(0,"div",44),w.nrm(1,"input",45),w.j41(2,"label",46),w.EFF(3),w.nI1(4,"mytranslate"),w.k0s()()),2&he){const X=Ke.$implicit,oe=Ke.index;w.R7$(),w.FS9("id","choice_"+oe),w.FS9("formControlName","choice_"+oe),w.R7$(),w.FS9("for","choice_"+oe),w.R7$(),w.SpI(" ",w.bMT(4,4,X)," ")}}function ue(he,Ke){if(1&he&&(w.qex(0),w.j41(1,"div",42),w.DNE(2,Ee,5,6,"div",43),w.k0s(),w.bVm()),2&he){const X=w.XpG().$implicit;w.R7$(),w.FS9("formGroupName","survey_"+X.id),w.R7$(),w.Y8G("ngForOf",X.choices)}}function De(he,Ke){if(1&he&&(w.qex(0),w.j41(1,"mat-radio-button",49),w.EFF(2),w.nI1(3,"mytranslate"),w.k0s(),w.bVm()),2&he){const X=Ke.$implicit,oe=w.XpG(2).$implicit,Be=w.XpG(3);w.R7$(),w.FS9("value",X),w.Y8G("checked",Be.form.controls["survey_"+oe.id].value==X),w.R7$(),w.JRh(w.bMT(3,3,X))}}function Se(he,Ke){if(1&he&&(w.j41(0,"mat-radio-group",47),w.DNE(1,De,4,5,"ng-container",48),w.k0s()),2&he){const X=w.XpG().$implicit;w.FS9("formControlName","survey_"+X.id),w.R7$(),w.Y8G("ngForOf",X.choices)}}function Xe(he,Ke){if(1&he&&(w.j41(0,"div",39)(1,"div",40)(2,"h2",41),w.EFF(3),w.nI1(4,"mytranslate"),w.k0s()(),w.j41(5,"div"),w.DNE(6,ue,3,2,"ng-container",11)(7,Se,2,2,"ng-template",null,1,w.C5r),w.k0s()()),2&he){const X=Ke.$implicit,oe=Ke.index,Be=w.sdS(8);w.R7$(3),w.Lme(" ",oe+1+". ","",w.bMT(4,4,X.content)," "),w.R7$(3),w.Y8G("ngIf",X.multiChoice&&X.choices&&X.choices.length>1)("ngIfElse",Be)}}function Ve(he,Ke){if(1&he&&(w.j41(0,"div"),w.DNE(1,Xe,9,6,"div",38),w.k0s()),2&he){const X=w.XpG(2);w.R7$(),w.Y8G("ngForOf",X.surveyObjs)}}function mt(he,Ke){if(1&he){const X=w.RV6();w.DNE(0,Ve,2,1,"div",30),w.j41(1,"div",31)(2,"button",32),w.bIt("click",function(){w.eBV(X);const Be=w.XpG();return w.Njj(Be.changeFeedBackEmotion(2))}),w.nrm(3,"lucide-icon",33),w.j41(4,"span"),w.EFF(5),w.nI1(6,"mytranslate"),w.k0s()(),w.j41(7,"button",34),w.bIt("click",function(){w.eBV(X);const Be=w.XpG();return w.Njj(Be.changeFeedBackEmotion(1))}),w.nrm(8,"lucide-icon",35),w.j41(9,"span"),w.EFF(10),w.nI1(11,"mytranslate"),w.k0s()()(),w.j41(12,"div",36)(13,"textarea",37),w.nI1(14,"mytranslate"),w.bIt("keyup",function(){w.eBV(X);const Be=w.XpG();return w.Njj(Be.autoResizeFeedBackArea())}),w.k0s()()}if(2&he){const X=w.XpG();w.Y8G("ngIf",X.surveyObjs.length),w.R7$(2),w.Y8G("disabled",X.disableLike)("ngClass",w.l_i(16,se,2==X.feedBackEmotion,2!=X.feedBackEmotion)),w.R7$(),w.Y8G("ngClass",w.lJ4(19,Pe)),w.R7$(2),w.JRh(w.bMT(6,10,"lang_test_market_introduce_rating_like")),w.R7$(2),w.Y8G("disabled",X.disableLike)("ngClass",w.l_i(20,se,1==X.feedBackEmotion,1!=X.feedBackEmotion)),w.R7$(),w.Y8G("ngClass",w.lJ4(23,Pe)),w.R7$(2),w.JRh(w.bMT(11,12,"lang_test_market_introduce_rating_dislike")),w.R7$(3),w.FS9("placeholder",w.bMT(14,14,"lang_global_question_ask_to_feedback_placeholder"))}}function pe(he,Ke){1&he&&(w.j41(0,"span",50),w.nrm(1,"azt-loading-ui"),w.k0s())}let Ge=(()=>{var he;class Ke extends c._{getAnswerSurvey(){let oe=[],Be=this.commonService.getFormObj(this.form);for(let we in Be)if(we.includes("survey_")){let W={surveyId:Number(we.substring(we.indexOf("_")+1)),answers:[]};if(Be[we]instanceof Object){let fe=this.surveyObjs.find(lt=>lt.id==W.surveyId);if(fe)for(let lt in Be[we])if(Be[we][lt]){let Dt=Number(lt.substring(lt.indexOf("_")+1));if(Array.isArray(fe.choices)&&fe.choices[Dt]){let nt=fe.choices[Dt];W.answers?.push(nt)}}}else W.answers=[Be[we]];oe.push(W)}return oe}getFeedbackSurveys(){this.loadingFeedBackSurvey=!0,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksSurveysGet(this.applyType,this.role).subscribe(oe=>{if(1==oe.success){this.surveyObjs=oe.data?.objs??[];let Be={feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,m.M.noWhiteSpace]})};this.surveyObjs.length>0&&this.surveyObjs.forEach(we=>{if(we.multiChoice&&we.choices&&we.choices.length>1){let W={};Be[`survey_${we.id}`]=new l.gE({}),we.choices.forEach((fe,lt)=>{W[`choice_${lt}`]=new l.MJ(!1,{nonNullable:!0})}),Be[`survey_${we.id}`]=this.fb.group(W)}else Be[`survey_${we.id}`]=new l.MJ("",{nonNullable:!0,validators:[l.k0.required]})}),this.form=this.fb.group(Be),this.loadingFeedBackSurvey=!1}else this.errorStatusObj(oe.message??"",!0),this.loadingFeedBackSurvey=!1}))}getInfoFeedback(){this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksGet(this.questionId,this.applyType,this.role).subscribe(oe=>{if(1==oe.success){let Be=oe.data?.objs??[];Be.length&&Be[0].status&&(this.feedBackEmotion=Be[0].status,this.disableLike=!0)}else this.errorStatusObj(oe.message??"",!0),this.disableLike=!1}))}changeFeedBackEmotion(oe){this.disableLike||(this.feedBackEmotion=oe,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost({objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??void 0,content:"",surveyAnswers:[]}).subscribe(we=>{1==we.success?this.getInfoFeedback():this.errorStatusObj(we.message??"",!0)})))}autoResizeFeedBackArea(){const oe=document.getElementById("text-area-feedback");oe&&setTimeout(()=>{oe.style.cssText="height:auto;",oe.style.cssText="height:"+(oe.scrollHeight+30)+"px"},0)}sendFeedBack(){if(this.form.invalid)this.showErrorSnack("lang_auto_vui_long_dien_day_du_thong_tin");else{this.initStatusObj(),this.sendingFeedBack=!0;let oe={objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??0,content:this.form.controls.feedBackContent.value??void 0,surveyAnswers:this.getAnswerSurvey()};this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost(oe).subscribe(Be=>{1==Be.success?(this.sendingFeedBack=!1,this.dialogRef.close(!0),this.successStatusObj("TEACHER"==this.role?"lang_test_market_success_feedback":"lang_test_market_success_feedback_student",!0)):(this.errorStatusObj(Be.message??"",!0),this.sendingFeedBack=!1)}))}}btnCloseDialog(){this.dialogRef.close(!1)}ngOnInit(){this.questionId=this.data.questionObj.id,this.role=this.data.role,this.applyType=this.data.applyType,this.form=this.fb.group({feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,m.M.noWhiteSpace]})}),this.getInfoFeedback(),this.getFeedbackSurveys(),super.ngOnInit()}constructor(oe,Be,we,W){super(W,we),this.fb=oe,this.testMarketFeedbackService=Be,this.dialogRef=we,this.data=W,this.role="",this.applyType="",this.form=new l.gE({}),this.feedBackEmotion=void 0,this.totalLike=0,this.totalDislike=0,this.sendingFeedBack=!1,this.loadingFeedBackSurvey=!1,this.disableLike=!1,this.surveyObjs=[]}}return(he=Ke).\u0275fac=function(oe){return new(oe||he)(w.rXU(l.ok),w.rXU(C.l_),w.rXU(d.CP,8),w.rXU(d.Vh,8))},he.\u0275cmp=w.VBU({type:he,selectors:[["exam-matrix-feedback-dialog"]],features:[w.Vt3],decls:25,vars:19,consts:[["doneLoading",""],["SingleChoice",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-3","border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"intro-y","overflow-auto",2,"max-height","calc(100vh - 150px)"],[1,"text-md","mr-auto","font-bold"],["class","border-t border-slate-200/60 dark:border-darkmode-400 py-2 mt-2",4,"ngIf"],[1,"border-t","border-slate-200/60","dark:border-darkmode-400","py-2","mt-2"],[3,"formGroup"],[1,"font-medium","text-md","text-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"p-3","text-right"],["azt-track-service","exam-matrix-feedback-dialog-qXEblgFcT",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","exam-matrix-feedback-dialog-NGlD5D-IvA",1,"btn","btn-primary","mw-24",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"tex2jax_process","box-content",2,"width","auto"],[3,"content"],["class","grid grid-cols-12 gap-2 answers",4,"ngIf"],["class","font-medium text-md text-left text-success my-2",4,"ngIf"],[1,"grid","grid-cols-12","gap-2","answers"],["class","answer col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"answer","col-span-12","md:col-span-6"],[1,"answer-label"],[1,"answer-content"],[1,"font-medium","text-md","text-left","text-success","my-2"],[1,"font-medium","text-md","text-center"],[1,"help-content","box","px-3","mt-1",2,"display","inherit","border-top-right-radius","0","border-top-left-radius","0","box-shadow","none","overflow","auto","padding-bottom","20px"],[1,"flex","items-center","h-full","w-full"],[1,"w-8","h-8","mx-auto"],[4,"ngIf"],[1,"flex","items-center",2,"flex-wrap","wrap"],["azt-track-service","exam-matrix-feedback-dialog-PoMeFnagK",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-up","size","24",3,"ngClass"],["azt-track-service","exam-matrix-feedback-dialog-iJokCn34oQ",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-down","size","20",3,"ngClass"],[1,"items-center","mt-1"],["id","text-area-feedback","type","text","cols","10","rows","3","formControlName","feedBackContent",1,"form-control","mt-1",3,"keyup","placeholder"],["class","flex flex-wrap mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","mb-2"],[2,"min-width","300px"],[1,"text-md","mb-2"],[1,"block","px-2","ml-2","sm:flex",3,"formGroupName"],["class","mr-5",4,"ngFor","ngForOf"],[1,"mr-5"],["type","checkbox",1,"form-check-input",3,"id","formControlName"],[2,"vertical-align","middle","cursor","pointer","margin-left","3px",3,"for"],["color","primary",1,"px-2",2,"flex-direction","column",3,"formControlName"],[4,"ngFor","ngForOf"],[1,"mr-5",3,"checked","value"],[1,"w-4","h-4","mr-2"]],template:function(oe,Be){if(1&oe){const we=w.RV6();w.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),w.EFF(5),w.nI1(6,"mytranslate"),w.k0s(),w.DNE(7,q,8,6,"div",7)(8,_e,6,4,"div",7),w.j41(9,"div",8)(10,"form",9)(11,"h2",10),w.EFF(12),w.nI1(13,"mytranslate"),w.k0s(),w.DNE(14,xe,4,0,"ng-container",11)(15,mt,15,24,"ng-template",null,0,w.C5r),w.k0s()()()()(),w.j41(17,"div",12)(18,"button",13),w.bIt("click",function(){return w.eBV(we),w.Njj(Be.btnCloseDialog())}),w.EFF(19),w.nI1(20,"mytranslate"),w.k0s(),w.j41(21,"button",14),w.bIt("click",function(){return w.eBV(we),w.Njj(Be.sendFeedBack())}),w.DNE(22,pe,2,0,"span",15),w.EFF(23),w.nI1(24,"mytranslate"),w.k0s()()()}if(2&oe){const we=w.sdS(16);w.R7$(5),w.SpI(" ",w.bMT(6,11,Be.data.questionObj.isRoleTeacher?"lang_global_question_ask_to_feedback":"lang_global_question_ask_to_report")," "),w.R7$(2),w.Y8G("ngIf",Be.data.questionObj.content),w.R7$(),w.Y8G("ngIf",Be.data.questionObj.help&&Be.data.questionObj.isRoleTeacher),w.R7$(2),w.Y8G("formGroup",Be.form),w.R7$(2),w.SpI(" ",w.bMT(13,13,"lang_auto_nhan_xet")," "),w.R7$(2),w.Y8G("ngIf",Be.loadingFeedBackSurvey)("ngIfElse",we),w.R7$(5),w.SpI(" ",w.bMT(20,15,"lang_auto_dong")," "),w.R7$(2),w.Y8G("disabled",Be.sendingFeedBack||Be.form.invalid),w.R7$(),w.Y8G("ngIf",Be.sendingFeedBack),w.R7$(),w.SpI(" ",w.bMT(24,17,"lang_button_send")," ")}},dependencies:[H.YU,H.Sq,H.bT,y.VT,y._g,l.qT,l.me,l.Zm,l.BC,l.cb,l.j4,l.JD,l.$R,ie.WGl,U.t,k.R,j.x,$.wp],styles:[".answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}"]}),Ke})()},14987:(yt,Oe,v)=>{v.d(Oe,{i:()=>y});var l=v(59640),d=v(48891),c=v(54460),m=v(10936),w=v(81587),C=v(76975);function H(ie,U){if(1&ie&&(d.j41(0,"div",1)(1,"form",2),d.nrm(2,"input",3),d.nI1(3,"mytranslate"),d.nrm(4,"input",4),d.nI1(5,"mytranslate"),d.k0s()()),2&ie){const k=d.XpG();d.R7$(),d.Y8G("formGroup",k.form),d.R7$(),d.FS9("placeholder",d.bMT(3,3,"lang_auto_ten_truong")),d.R7$(2),d.FS9("placeholder",d.bMT(5,5,"lang_auto_mon_hoc_form"))}}let y=(()=>{var ie;class U extends l.H{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject})}ngOnInit(){this.initData()}}return(ie=U).\u0275fac=function(j){return new(j||ie)},ie.\u0275cmp=d.VBU({type:ie,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},features:[d.Vt3],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"]],template:function(j,$){1&j&&d.DNE(0,H,6,7,"div",0),2&j&&d.Y8G("ngIf",$.form)},dependencies:[c.bT,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,w.t,C.wp],encapsulation:2}),U})()},30551:(yt,Oe,v)=>{v.d(Oe,{P:()=>q});var l=v(59640),d=v(48891),c=v(37642),m=v(36484),w=v(99927),C=v(54460),H=v(60303),y=v(76975);const ie=_e=>({"font-bold":_e});function U(_e,xe){if(1&_e&&(d.j41(0,"td",11),d.EFF(1),d.k0s()),2&_e){const Ee=d.XpG().$implicit,ue=d.XpG().$implicit,De=d.XpG(2);d.BMQ("rowspan",ue.length),d.R7$(),d.JRh(De.toNumber(Ee.index)+1)}}function k(_e,xe){if(1&_e&&(d.qex(0),d.j41(1,"tr"),d.DNE(2,U,2,2,"td",10),d.j41(3,"td",11),d.EFF(4),d.nI1(5,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(6,"td",12),d.EFF(7),d.k0s()(),d.bVm()),2&_e){const Ee=xe.$implicit,ue=xe.index,De=d.XpG(3);d.R7$(2),d.Y8G("ngIf",0==ue),d.R7$(2),d.JRh(d.bMT(5,4,1e3*Ee.second)),d.R7$(2),d.Y8G("ngClass",d.eq3(6,ie,Ee.isFontBold)),d.R7$(),d.JRh(De.isShowOriginAnswer?Ee.key:Ee.alpha?Ee.alpha:Ee.key)}}function j(_e,xe){if(1&_e&&(d.qex(0),d.DNE(1,k,8,8,"ng-container",9),d.bVm()),2&_e){const Ee=xe.$implicit;d.R7$(),d.Y8G("ngForOf",Ee)}}function $(_e,xe){if(1&_e&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,j,2,1,"ng-container",9),d.k0s()),2&_e){const Ee=d.XpG();d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_cau_hoi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"lang_auto_dap_an")),d.R7$(2),d.Y8G("ngForOf",Ee.groupObjs)}}function se(_e,xe){1&_e&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&_e&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}function Pe(_e,xe){if(1&_e&&(d.qex(0),d.j41(1,"tr")(2,"td",11),d.EFF(3),d.k0s(),d.j41(4,"td",11),d.EFF(5),d.nI1(6,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(7,"td",11),d.EFF(8),d.k0s()(),d.bVm()),2&_e){let Ee;const ue=xe.$implicit;d.R7$(3),d.JRh(ue.userAgent),d.R7$(2),d.JRh(d.bMT(6,3,null!==(Ee=ue.startedAt)&&void 0!==Ee?Ee:"")),d.R7$(3),d.JRh(ue.ip)}}function Z(_e,xe){if(1&_e&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,Pe,9,5,"ng-container",9),d.k0s()),2&_e){const Ee=d.XpG(2);d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_thong_tin_thiet_bi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"IP")),d.R7$(2),d.Y8G("ngForOf",Ee.ipTrackingDataObjs)}}function B(_e,xe){1&_e&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&_e&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu")))}function I(_e,xe){if(1&_e&&(d.j41(0,"mat-tab",1),d.nI1(1,"mytranslate"),d.j41(2,"div",2),d.DNE(3,Z,12,10,"table",3)(4,B,3,3,"ng-template",null,0,d.C5r),d.k0s()()),2&_e){const Ee=d.sdS(5),ue=d.XpG();d.FS9("label",d.bMT(1,3,"lang_auto_thong_tin_thiet_bi_IP")),d.R7$(3),d.Y8G("ngIf",ue.ipTrackingDataObjs.length>0)("ngIfElse",Ee)}}let q=(()=>{var _e;class xe extends l.H{findReTapQuesions(){var ue=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var De in ue)if(ue.hasOwnProperty(De)){var Se=ue[De].map((Xe,Ve)=>{let mt=!1,pe=this.questionObjs.find(Ge=>Ge.id==Xe.questionId);if(this.answerTypeService.isTrueFalseAnswer(pe)){for(let Ge=ue[De].length-1;Ge>=0;Ge--)if(ue[De][Ge].key.includes(Xe.key.split("")[0])){mt=Xe.key==ue[De][Ge].key;break}}else mt=Ve==ue[De].length-1;return{...Xe,isFontBold:mt}});this.groupObjs.push(Se)}}toNumber(ue){return parseInt(ue,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(ue,De,Se){super(),this.dictionaryService=ue,this.userService=De,this.answerTypeService=Se,this.startQuestionIndex=1,this.isShowOriginAnswer=!1,this.ipTrackingDataObjs=[],this.isTeacherRole=this.userService.isTeacherRole(),this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return(_e=xe).\u0275fac=function(ue){return new(ue||_e)(d.rXU(c.E),d.rXU(m.R),d.rXU(w._))},_e.\u0275cmp=d.VBU({type:_e,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",isShowOriginAnswer:"isShowOriginAnswer",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs",ipTrackingDataObjs:"ipTrackingDataObjs",questionObjs:"questionObjs"},features:[d.Vt3],decls:8,vars:6,consts:[["noData",""],[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],[3,"label",4,"ngIf"],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(ue,De){if(1&ue&&(d.j41(0,"mat-tab-group")(1,"mat-tab",1),d.nI1(2,"mytranslate"),d.j41(3,"div",2),d.DNE(4,$,12,10,"table",3)(5,se,3,3,"ng-template",null,0,d.C5r),d.k0s()(),d.DNE(7,I,6,5,"mat-tab",4),d.k0s()),2&ue){const Se=d.sdS(6);d.R7$(),d.FS9("label",d.bMT(2,4,"lang_auto_chi_tiet_chon_dap_an")),d.R7$(3),d.Y8G("ngIf",De.groupObjs.length>0)("ngIfElse",Se),d.R7$(3),d.Y8G("ngIf",De.isTeacherRole)}},dependencies:[C.YU,C.Sq,C.bT,H.mq,H.T8,y.wp,y.Ky],encapsulation:2}),xe})()},78745:(yt,Oe,v)=>{v.d(Oe,{d:()=>se});var l=v(59640),d=v(48891),c=v(54460),m=v(17818),w=v(47712),C=v(15343),H=v(64160),y=v(15437),ie=v(76975);const U=()=>({"mr-2":!0});function k(Pe,Z){if(1&Pe){const B=d.RV6();d.qex(0),d.j41(1,"div",6)(2,"p",7),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"p",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"div",8),d.nrm(9,"input",9),d.j41(10,"button",10),d.bIt("click",function(){d.eBV(B);const q=d.XpG();return d.Njj(q.showCopySuccess())}),d.nrm(11,"lucide-icon",11),d.EFF(12),d.nI1(13,"mytranslate"),d.k0s()()(),d.bVm()}if(2&Pe){const B=d.XpG();d.R7$(3),d.JRh(d.bMT(4,6,"lang_auto_hoac")),d.R7$(3),d.JRh(d.bMT(7,8,"lang_classroom_QR_join_link_copy")),d.R7$(3),d.Y8G("value",B.linkUrl),d.R7$(),d.Y8G("cdkCopyToClipboard",B.copyLinkToClipboard(B.linkUrl)),d.R7$(),d.Y8G("ngClass",d.lJ4(12,U)),d.R7$(),d.SpI(" ",d.bMT(13,10,"lang_auto_sao_chep")," ")}}let j=(()=>{var Pe;class Z extends l.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1,this.qrCodeDownloadLink=""}showCopySuccess(){this.showSuccessSnack("lang_auto_sao_chep_thanh_cong")}copyLinkToClipboard(I){return I}onChangeURL(I){this.qrCodeDownloadLink=I}downloadQrCode(){try{let I=""!=this.fileName?this.commonService.createFileNameExportFile([this.fileName])+".jpg":this.commonService.createFileNameExportFile(["azota-qr-code-"])+".jpg";this.commonService.downloadFileByUrl(this.qrCodeDownloadLink.changingThisBreaksApplicationSecurity,I)}catch{console.log("Download QrCode error")}}}return(Pe=Z).\u0275fac=(()=>{let B;return function(q){return(B||(B=d.xGo(Pe)))(q||Pe)}})(),Pe.\u0275cmp=d.VBU({type:Pe,selectors:[["azt-show-link"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:8,vars:11,consts:[["azt-track-service","download-qr-code-9t-9Wiu2xv",1,"box","p-3","text-center",3,"click"],[2,"background","#fff","padding","5px"],["colorDark","#2361ad","imageSrc","'images/Azota-For-QrCode-01.png' | convertCdnLinkOfGitHub",3,"qrCodeURL","allowEmptyString","qrdata","elementType","width","errorCorrectionLevel"],["azt-track-service","download-qr-code-RqVBz6g1z7",1,"btn","btn-outline-primary","btn-transparent","btn-sm","mx-auto","mt-2",3,"click"],["name","download","size","16",3,"ngClass"],[4,"ngIf"],[1,"text-center"],[1,"h5","mt-2","font-medium"],[1,"azt-copy","relative","mt-2"],["type","text","readonly","",1,"form-control","py-3","px-4","border-transparent","bg-slate-100","pr-10",2,"padding-right","120px",3,"value"],["azt-track-service","download-qr-code-yW-aFu0tO",1,"btn","btn-outline-primary","absolute","my-auto","inset-y-0","right-0",2,"border-top-left-radius","0","border-bottom-left-radius","0",3,"click","cdkCopyToClipboard"],["name","copy","size","16",3,"ngClass"]],template:function(I,q){1&I&&(d.j41(0,"div",0),d.bIt("click",function(xe){return xe.stopPropagation()}),d.j41(1,"div",1)(2,"qrcode",2),d.bIt("qrCodeURL",function(xe){return q.onChangeURL(xe)}),d.k0s()(),d.j41(3,"a",3),d.bIt("click",function(){return q.downloadQrCode()}),d.nrm(4,"lucide-icon",4),d.EFF(5),d.nI1(6,"mytranslate"),d.k0s(),d.DNE(7,k,14,13,"ng-container",5),d.k0s()),2&I&&(d.R7$(2),d.Y8G("allowEmptyString",!0)("qrdata",q.linkUrl)("elementType","url")("width",128)("errorCorrectionLevel","M"),d.R7$(2),d.Y8G("ngClass",d.lJ4(10,U)),d.R7$(),d.SpI(" ",d.bMT(6,8,"lang_auto_tai_ve_may")," "),d.R7$(2),d.Y8G("ngIf",q.showLink))},dependencies:[c.YU,c.bT,H.dF,C.WGl,y.c,ie.wp],encapsulation:2}),Z})();const $=Pe=>({"w-80":Pe});let se=(()=>{var Pe;class Z extends l.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1}}return(Pe=Z).\u0275fac=(()=>{let B;return function(q){return(B||(B=d.xGo(Pe)))(q||Pe)}})(),Pe.\u0275cmp=d.VBU({type:Pe,selectors:[["azt-download-qr-code"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:7,vars:10,consts:[["showQrCode","matMenu"],["azt-track-service","download-qr-code-hiQXy_iTc",1,"btn","btn-outline-primary","btn-transparent","p-1",3,"matMenuTriggerFor","matTooltip"],["name","qr-code","size","24"],["xPosition","before"],[3,"ngClass"],[3,"linkUrl","fileName","showLink"]],template:function(I,q){if(1&I&&(d.j41(0,"button",1),d.nI1(1,"mytranslate"),d.nrm(2,"lucide-icon",2),d.k0s(),d.j41(3,"mat-menu",3,0)(5,"div",4),d.nrm(6,"azt-show-link",5),d.k0s()()),2&I){const _e=d.sdS(4);d.FS9("matTooltip",d.bMT(1,6,"lang_auto_quet_hoac_tai_ma_qr_code")),d.Y8G("matMenuTriggerFor",_e),d.R7$(5),d.Y8G("ngClass",d.eq3(8,$,q.showLink)),d.R7$(),d.Y8G("linkUrl",q.linkUrl)("fileName",q.fileName)("showLink",q.showLink)}},dependencies:[c.YU,m.kk,m.Cp,w.oV,C.WGl,j,ie.wp],encapsulation:2}),Z})()},72802:(yt,Oe,v)=>{v.d(Oe,{f:()=>Et});var l=v(27691),d=v(48891),c=v(10936),m=v(67421),w=v(59640),C=v(30657),H=v(83229),y=v(51913),ie=v(40949),U=v(55465),k=v(35095),j=v(41426),$=v(54460),se=v(47712),Pe=v(15343),Z=v(7919),B=v(81587),I=v(84278),q=v(34815),_e=v(76975);const xe=["mnoteContainer"],Ee=Ye=>({display:Ye}),ue=Ye=>({border:Ye}),De=()=>({"mr-1":!0}),Se=Ye=>({"is-invalid":Ye});function Xe(Ye,ft){1&Ye&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Ye&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Ve(Ye,ft){1&Ye&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Ye&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function mt(Ye,ft){1&Ye&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Ye&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function pe(Ye,ft){if(1&Ye&&(d.j41(0,"div",18),d.DNE(1,Xe,3,3,"span",19)(2,Ve,3,3,"span",19)(3,mt,3,3,"span",19),d.k0s()),2&Ye){const Je=d.XpG().index,Ne=d.XpG();d.R7$(),d.Y8G("ngIf",null==Ne.form.controls["cau"+Je].errors?null:Ne.form.controls["cau"+Je].errors.min),d.R7$(),d.Y8G("ngIf",null==Ne.form.controls["cau"+Je].errors?null:Ne.form.controls["cau"+Je].errors.max),d.R7$(),d.Y8G("ngIf",null==Ne.form.controls["cau"+Je].errors?null:Ne.form.controls["cau"+Je].errors.pattern)}}function Ge(Ye,ft){if(1&Ye){const Je=d.RV6();d.j41(0,"div",11)(1,"div",12)(2,"lucide-icon",13),d.nI1(3,"mytranslate"),d.bIt("click",function(Y){const ae=d.eBV(Je).index,de=d.XpG();return d.Njj(de.toggleVisibility(Y,ae))}),d.k0s(),d.j41(4,"span",14),d.EFF(5),d.nI1(6,"mytranslate"),d.j41(7,"span",15),d.nI1(8,"mytranslate"),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.nrm(11,"input",16),d.nI1(12,"mytranslate"),d.k0s(),d.DNE(13,pe,4,3,"div",17),d.k0s()}if(2&Ye){let Je;const Ne=ft.$implicit,Y=ft.index,ae=d.XpG();d.Y8G("ngStyle",d.eq3(25,ue,Y==ae.questions.length-1?"none":"")),d.R7$(2),d.FS9("matTooltip",d.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),d.Y8G("ngClass",d.lJ4(27,De)),d.R7$(3),d.Lme(" ",d.bMT(6,17,"lang_auto_cau")," ",(null!==(Je=Ne.indexLabel)&&void 0!==Je?Je:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",Ne.essMaxPoint," ",d.bMT(10,21,"lang_auto_diem_brackets"),""),d.R7$(2),d.FS9("placeholder",d.bMT(12,23,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",Y,""),d.Y8G("readonly",!ae.showForTeacher)("decimal",!0)("ngClass",d.eq3(28,Se,ae.form.controls["cau"+Y]&&ae.form.controls["cau"+Y].invalid)),d.R7$(2),d.Y8G("ngIf",ae.form.controls["cau"+Y].errors)}}function he(Ye,ft){if(1&Ye){const Je=d.RV6();d.j41(0,"div",20)(1,"button",21),d.bIt("click",function(){d.eBV(Je);const Y=d.XpG();return d.Njj(Y.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Ye){const Je=d.XpG();d.R7$(),d.Y8G("disabled",Je.isLoading||Je.form.invalid),d.R7$(),d.SpI(" ",Je.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}function Ke(Ye,ft){if(1&Ye&&d.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Ye){let Je;const Ne=d.XpG().$implicit,Y=d.XpG();d.Y8G("follower",Y.followerRenderQuest)("examObj",Y.examObj)("examConfig",Y.examConfig)("questionObj",Ne)("curQuestionIndex",null!==(Je=Ne.indexLabel)&&void 0!==Je?Je:0)("userAnswersObj",Y.userAnswersObj)("currentTab","essay_tab")}}function X(Ye,ft){if(1&Ye&&d.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Ye){let Je;const Ne=d.XpG().$implicit,Y=d.XpG();d.Y8G("follower",Y.followerRenderQuest)("examObj",Y.examObj)("questionObj",Ne)("curQuestionIndex",null!==(Je=Ne.indexLabel)&&void 0!==Je?Je:0)("userAnswersObj",Y.userAnswersObj)("orgExamObjs",Y.orgExamObjs)("currentTab","essay_tab")}}function oe(Ye,ft){1&Ye&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Ye&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Be(Ye,ft){1&Ye&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Ye&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function we(Ye,ft){1&Ye&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Ye&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function W(Ye,ft){if(1&Ye&&(d.j41(0,"div",18),d.DNE(1,oe,3,3,"span",19)(2,Be,3,3,"span",19)(3,we,3,3,"span",19),d.k0s()),2&Ye){const Je=d.XpG(2).index,Ne=d.XpG();d.R7$(),d.Y8G("ngIf",null==Ne.form.controls["cau"+Je].errors?null:Ne.form.controls["cau"+Je].errors.min),d.R7$(),d.Y8G("ngIf",null==Ne.form.controls["cau"+Je].errors?null:Ne.form.controls["cau"+Je].errors.max),d.R7$(),d.Y8G("ngIf",null==Ne.form.controls["cau"+Je].errors?null:Ne.form.controls["cau"+Je].errors.pattern)}}function fe(Ye,ft){if(1&Ye&&(d.j41(0,"div",29)(1,"form",30)(2,"label",31),d.EFF(3),d.nI1(4,"mytranslate"),d.j41(5,"span",15),d.nI1(6,"mytranslate"),d.EFF(7),d.nI1(8,"mytranslate"),d.k0s(),d.EFF(9," : "),d.k0s(),d.nrm(10,"input",32),d.nI1(11,"mytranslate"),d.DNE(12,W,4,3,"div",17),d.k0s()()),2&Ye){let Je;const Ne=d.XpG(),Y=Ne.$implicit,ae=Ne.index,de=d.XpG();d.R7$(),d.Y8G("formGroup",de.form),d.R7$(),d.FS9("for","cau_"+ae),d.R7$(),d.Lme(" ",d.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(Je=Y.indexLabel)&&void 0!==Je?Je:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",Y.essMaxPoint," ",d.bMT(8,19,"lang_auto_diem_brackets"),""),d.R7$(3),d.FS9("placeholder",d.bMT(11,21,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",ae,""),d.Y8G("readonly",!de.showForTeacher)("ngClass",d.eq3(23,Se,de.form.controls["cau"+ae]&&de.form.controls["cau"+ae].invalid))("id","cau_"+ae)("decimal",!0),d.R7$(2),d.Y8G("ngIf",de.form.controls["cau"+ae].errors)}}function lt(Ye,ft){if(1&Ye&&(d.j41(0,"div",22)(1,"div",23),d.DNE(2,Ke,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,X,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,fe,13,25,"div",26),d.k0s()()),2&Ye){const Je=ft.index,Ne=d.XpG();d.R7$(),d.Mz_("id","q_",Je,""),d.R7$(),d.Y8G("ngIf",!Ne.showForTeacher),d.R7$(),d.Y8G("ngIf",Ne.showForTeacher),d.R7$(),d.Y8G("ngIf",Ne.showForTeacher)}}function Dt(Ye,ft){1&Ye&&(d.j41(0,"div",33)(1,"b"),d.EFF(2),d.nI1(3,"mytranslate"),d.k0s(),d.EFF(4),d.nI1(5,"mytranslate"),d.k0s()),2&Ye&&(d.R7$(2),d.SpI("",d.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),d.R7$(2),d.SpI(" ",d.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function nt(Ye,ft){if(1&Ye){const Je=d.RV6();d.j41(0,"div",34)(1,"button",35),d.bIt("click",function(){d.eBV(Je);const Y=d.XpG();return d.Njj(Y.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Ye){const Je=d.XpG();d.R7$(),d.Y8G("disabled",Je.isLoading||Je.form.invalid),d.R7$(),d.SpI(" ",Je.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}let Et=(()=>{var Ye;class ft extends w.H{parseValue(Ne){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[Ne]}getMaxPoint(Ne){var Y=0;for(let ae=0;ae<this.questions.length;ae++)if(this.questions[ae].id==Ne){Y=this.questions[ae].scorePerQuestion??0;break}return Y}toggleVisibility(Ne,Y){var ae=Ne.target,de=document.getElementById(`q_${Y}`);de&&("block"==de?.style.display?(de.style.display="none",ae&&(ae.textContent="visibility_off")):(de.style.display="block",ae&&(ae.textContent="visibility")))}isValidPoint(){let Ne=0;var Y=this.form.value;for(var ae in Y){var de=Number(ae.substring(3));Y[ae]>this.maxPointPerQuestion[de]&&Ne++}return!(Ne>0)}validateForm(Ne,Y,ae,de){let N="";this.form.get("cau"+de)?.valueChanges.pipe((0,m.J)()).subscribe(([S,M])=>{if(N="string"==typeof M&&M.includes(",")?M.replace(",","."):M,isNaN(+N))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+de].setValue(Y);else{let V=parseFloat(N);V>ae&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),V<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(Ne,Y){var ae=(0,H.q)(Ne);this.apiUploadService.commonUploadForMarkResult(ae,`essay_note_${Y}_${this.resultID}.png`,"image/png").subscribe(de=>{de.type!=l.hv.UploadProgress&&(1==de.success?(this.mnoteJsonData.pages[Y].draw=de.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(Ne){this.pagesCount=0;for(let Y=0;Y<Ne.length;Y++)Ne[Y].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let Y=0;Y<Ne.length;Y++)Ne[Y].draw&&this.uploadBase64ToCDN(Ne[Y].draw,Y)}sendDataToIframe(){const Ne=document.getElementById("mNote"),Y=Ne?Ne.contentWindow:null;if(null!==Y)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var ae=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=ae){for(let N=0;N<ae.pages.length;N++)ae.pages[N].backgroundImage&&(ae.pages[N].backgroundImage=this.cdnService.getMyCdn(ae.pages[N].backgroundImage)),ae.pages[N].draw&&(ae.pages[N].draw=this.cdnService.getMyCdn(ae.pages[N].draw));ae=JSON.stringify(ae),this.examResultObj.result=ae}}var de=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(de?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let N=0;N<this.jsonData.pages.length;N++)this.jsonData.pages[N].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[N].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[N].backgroundImage)),this.jsonData.pages[N].hasOwnProperty("draw")&&(this.jsonData.pages[N].draw=this.cdnService.getMyCdn(this.jsonData.pages[N].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),Y.postMessage(this.jsonData,"*")}else{let N=[];this.files.forEach(M=>{var V=this.cdnService.getMyCdn(M.url);V&&N.push({backgroundImage:V})}),Y.postMessage({cmd:"initMNote",pages:N,mode:this.showForTeacher?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:N}}}checkMapBGImageWithFileLength(Ne){var Y=this.commonService.willDeleteParseJson(Ne);let ae=!1;if(0==this.files.length)ae=!0;else if(this.files.length>0&&Y&&Y.pages&&this.files.length==Y.pages.length){let de=0;this.files.forEach((N,S)=>{Y.pages[S]&&Y.pages[S].backgroundImage&&Y.pages[S].backgroundImage.indexOf(N.path)>-1&&de++}),de==this.files.length&&(ae=!0)}return ae}addBGImageByFileUrl(Ne){var Y=this.commonService.willDeleteParseJson(Ne);return this.files.forEach((ae,de)=>{let N=!1;if(Y&&Y.pages){for(var S=0;S<Y.pages.length;S++)if(Y.pages[S]&&Y.pages[S].backgroundImage&&Y.pages[S].backgroundImage.indexOf(ae.path)>-1){N=!0;break}!1===N&&(Y.pages[de]&&Y.pages[de].id==de?Y.pages[de].backgroundImage=this.cdnService.getMyCdn(ae.url??""):Y.pages.splice(de,0,{backgroundImage:this.cdnService.getMyCdn(ae.url??"")}))}}),JSON.stringify(Y)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let Ne=!1;for(const Y in this.form.value)""!==this.form.value[Y]&&(Ne=!0);if(!Ne)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const Y in this.form.value)""===this.form.value[Y]&&(this.form.value[Y]=0,this.form.controls[Y].setValue(0));if(this.files&&this.files.length>0){const Y=document.getElementById("mNote"),ae=Y?Y.contentWindow:null;null!==ae&&ae.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(Ne){if(this.checkMapBGImageWithFileLength(Ne)){for(const N in this.form.value)"string"==typeof this.form.value[N]&&this.form.value[N].includes(",")&&(this.form.value[N]=this.form.value[N].replace(",","."));let de=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var ae={id:this.resultID,result:Ne,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(ae,de).subscribe(N=>{1==N.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(N.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";var Ne={};let Y;this.examResultObj.confirmedAt&&(Y=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(de=>{let N=this.getMaxPoint(de.id);this.totalMaxPoint+=N,de.essMaxPoint=N,this.maxPointPerQuestion.push(de.essMaxPoint)});for(let de=0;de<this.questions.length;de++){var ae=`cau${de}`;Ne[ae]=new c.MJ(Y?Y[ae]:"",{validators:[c.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),c.k0.min(0),c.k0.max(this.questions[de].essMaxPoint??0)]})}this.form=new c.gE(Ne),this.form.valueChanges.subscribe(de=>{let N=JSON.stringify(de);N!=this.prevData&&(this.prevData=N,this.form.patchValue(de))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(Ne,Y,ae,de,N){super(),this.permissionService=Ne,this.cdnService=Y,this.envService=ae,this.examResultService=de,this.apiUploadService=N,this.orgExamObjs=[],this.questions=[],this.files=[],this.userAnswersObj={},this.resultID=0,this.whiteListMNoteIframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new d.bkB,this.followerRenderQuest=new C.e,this.form=new c.gE({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=S=>{"MNoteJson"==S.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=S.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==S.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(Ye=ft).\u0275fac=function(Ne){return new(Ne||Ye)(d.rXU(y.p),d.rXU(ie.B),d.rXU(U.t),d.rXU(k._),d.rXU(j.T))},Ye.\u0275cmp=d.VBU({type:Ye,selectors:[["azt-mark-essay"]],viewQuery:function(Ne,Y){if(1&Ne&&d.GBs(xe,5),2&Ne){let ae;d.mGM(ae=d.lsd())&&(Y.mnoteContainer=ae.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",examResultObj:"examResultObj",userAnswersObj:"userAnswersObj",resultID:"resultID",whiteListMNoteIframeSrc:"whiteListMNoteIframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode"},outputs:{saveResultEvent:"saveResultEvent"},features:[d.Vt3],decls:12,vars:12,consts:[["mnoteContainer",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(Ne,Y){1&Ne&&(d.j41(0,"div",1)(1,"form",2),d.DNE(2,Ge,14,30,"div",3),d.k0s(),d.DNE(3,he,5,6,"div",4),d.k0s(),d.j41(4,"div",5),d.DNE(5,lt,5,5,"div",6),d.k0s(),d.DNE(6,Dt,6,6,"div",7),d.j41(7,"div",8,0),d.nrm(9,"iframe",9),d.nI1(10,"safe"),d.k0s(),d.DNE(11,nt,5,6,"div",10)),2&Ne&&(d.R7$(),d.Y8G("formGroup",Y.form),d.R7$(),d.Y8G("ngForOf",Y.questions),d.R7$(),d.Y8G("ngIf",Y.showForTeacher),d.R7$(2),d.Y8G("ngForOf",Y.questions),d.R7$(),d.Y8G("ngIf",Y.files&&0==Y.files.length),d.R7$(),d.Y8G("ngStyle",d.eq3(10,Ee,Y.files&&0==Y.files.length?"none":"block")),d.R7$(2),d.Y8G("src",d.bMT(10,8,Y.whiteListMNoteIframeSrc),d.f$h),d.R7$(2),d.Y8G("ngIf",Y.showForTeacher))},dependencies:[$.YU,$.Sq,$.bT,$.B3,se.oV,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,Pe.WGl,Z.Z,B.t,I.x,q.o,_e.wp,_e.JI],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ft})()},74225:function(yt,Oe,v){var l=this&&this.__awaiter||function(w,C,H,y){return new(H||(H=Promise))(function(U,k){function j(Pe){try{se(y.next(Pe))}catch(Z){k(Z)}}function $(Pe){try{se(y.throw(Pe))}catch(Z){k(Z)}}function se(Pe){Pe.done?U(Pe.value):function ie(U){return U instanceof H?U:new H(function(k){k(U)})}(Pe.value).then(j,$)}se((y=y.apply(w,C||[])).next())})};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.decodeScanOfflineFile=Oe.decode=void 0;const d=v(6178);Oe.decode=function c(w){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decode(w)})},Oe.decodeScanOfflineFile=function m(w){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decodeScanOfflineFile(w)})}},25028:(yt,Oe,v)=>{Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.AzotaFile=Oe.FileType=void 0;const l=v(56784),d=v(70073);class c{}Oe.FileType=c,c.scanOffline="scanOffline";class m{constructor(){}static fromZipFolder(C){let H=new m;return H.folder=C,H.readAztMain(),H}readAztMain(){let C=this.folder.getUtf8Text("main.json");if(null==C)throw new l.InvalidAztFileException("Couldn't found main.json file");this.aztMain=d.AztMain.fromJsonString(C)}}Oe.AzotaFile=m},6178:function(yt,Oe,v){var l=this&&this.__awaiter||function(C,H,y,ie){return new(y||(y=Promise))(function(k,j){function $(Z){try{Pe(ie.next(Z))}catch(B){j(B)}}function se(Z){try{Pe(ie.throw(Z))}catch(B){j(B)}}function Pe(Z){Z.done?k(Z.value):function U(k){return k instanceof y?k:new y(function(j){j(k)})}(Z.value).then($,se)}Pe((ie=ie.apply(C,H||[])).next())})};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.AzotaFileDecode=void 0;const d=v(59985),c=v(25589),m=v(25028);class w{static decode(H){return l(this,void 0,void 0,function*(){return d.ZipFolder.fromZip(H).then(y=>{let ie=m.AzotaFile.fromZipFolder(y);return ie.aztMain.fileType==m.FileType.scanOffline?c.ScanOfflineFile.fromZipFolder(ie.folder):ie})})}static decodeScanOfflineFile(H){return w.decode(H).then(y=>y)}}Oe.AzotaFileDecode=w},70073:(yt,Oe,v)=>{Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.AztMain=void 0;const l=v(37182);class d{static fromJsonString(m){return d.fromJson(JSON.parse(m))}static fromJson(m){return(0,l.plainToInstance)(d,m)}}Oe.AztMain=d},56784:(yt,Oe)=>{Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.InvalidAztFileException=void 0;class v extends Error{constructor(d){super(d)}}Oe.InvalidAztFileException=v},81163:(yt,Oe,v)=>{Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.Point2d=Oe.DrawingRectangle=Oe.DrawingCircle=Oe.AnswerRegionResult=Oe.StudentCodeRegionResult=Oe.ExamCodeRegionResult=Oe.ScanOfflineResult=Oe.ScanOfflineData=void 0;const l=v(37182);class d{static fromJsonString(k){return d.fromJson(JSON.parse(k))}static fromJson(k){return(0,l.plainToInstance)(d,k)}}Oe.ScanOfflineData=d,Oe.ScanOfflineResult=class c{},Oe.ExamCodeRegionResult=class m{},Oe.StudentCodeRegionResult=class w{},Oe.AnswerRegionResult=class C{},Oe.DrawingCircle=class H{},Oe.DrawingRectangle=class y{},Oe.Point2d=class ie{}},25589:(yt,Oe,v)=>{Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.ScanOfflineFile=void 0;const l=v(25028),d=v(56784),c=v(81163);class m extends l.AzotaFile{constructor(){super()}static fromZipFolder(C){let H=new m;if(H.folder=C,H.readAztMain(),H.aztMain.fileType!=l.FileType.scanOffline)throw new d.InvalidAztFileException(`fileType must be ${l.FileType.scanOffline}`);let ie=C.getUtf8Text(H.aztMain.detailPath);if(null==ie)throw new d.InvalidAztFileException(`Couldn't found ${ie} file`);return H.scanOfflineData=c.ScanOfflineData.fromJsonString(ie),H}getWrappedImage(){var C,H;return null==(null===(H=null===(C=this.scanOfflineData)||void 0===C?void 0:C.scanResult)||void 0===H?void 0:H.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getWrappedImageExtension(){var C,H;let y=null===(H=null===(C=this.scanOfflineData)||void 0===C?void 0:C.scanResult)||void 0===H?void 0:H.wrappedScanFilePath;return null==y?null:y.substring(y.lastIndexOf("."))}}Oe.ScanOfflineFile=m},59985:function(yt,Oe,v){var l=this&&this.__awaiter||function(m,w,C,H){return new(C||(C=Promise))(function(ie,U){function k(se){try{$(H.next(se))}catch(Pe){U(Pe)}}function j(se){try{$(H.throw(se))}catch(Pe){U(Pe)}}function $(se){se.done?ie(se.value):function y(ie){return ie instanceof C?ie:new C(function(U){U(ie)})}(se.value).then(k,j)}$((H=H.apply(m,w||[])).next())})};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.ZipFolder=void 0;const d=v(91478);class c{constructor(w){this.files=new Map,w.forEach((C,H)=>{this.files.set(H,C)})}static fromZip(w){return l(this,void 0,void 0,function*(){let H=yield(new d).loadAsync(w).then(y=>{const ie=[];return y.forEach(function(U){let k=y.file(U);k&&ie.push(k.async("uint8array").then(j=>({path:U,data:j})))}),ie});return Promise.all(H).then(y=>{let ie=new Map;return y.forEach(U=>{ie.set(U.path,U.data)}),new c(ie)})})}setBinary(w,C){this.files.set(w,C)}setUtf8Text(w,C){let H=(new TextEncoder).encode(C);this.files.set(w,H)}getBinary(w){var C;return null!==(C=this.files.get(w))&&void 0!==C?C:null}getUtf8Text(w){let C=this.files.get(w);return null===C?null:(new TextDecoder).decode(C)}toDocx(){return l(this,void 0,void 0,function*(){const w=new d;for(let[C,H]of Array.from(this.files))w.file(C,H,{binary:!0});return w.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return l(this,void 0,void 0,function*(){const w=new d;for(let[C,H]of Array.from(this.files))w.file(C,H,{binary:!0});return w.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}Oe.ZipFolder=c}}]);