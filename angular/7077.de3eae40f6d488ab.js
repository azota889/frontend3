"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[7077],{5955:(z,T,l)=>{l.d(T,{C:()=>g});var D=l(26860);let g=(()=>{var s;class r{constructor(h){this.el=h,this.answerSizeManager=0,this.process()}ngOnChanges(h){h.answerSizeManager&&h.answerSizeManager.currentValue!==h.answerSizeManager.previousValue&&h.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(h=>{const v=this.el.nativeElement,f=v.children,p=[];for(let _=0;_<f.length;_++)p.push(this.getSizeWidthElement(f[_]));let d=1;[2,4].forEach(_=>{this.isLayout(h.width,p,_)&&(d=_)}),v.classList.remove("row");for(let _=0;_<f.length;_++){const i=f[_];i.classList.remove("col-sm-12"),i.classList.remove("col-md-6")}v.classList.add("layout"),v.classList.add("layout-"+d)})}isLayout(h,v,f){const p=Math.floor(h/f);for(const d of v)if(d+r.PADDING_ITEM>p)return!1;return!0}onElementLoaded(){return new Promise((h,v)=>{let f=!1;for(let p=0;p<=10;p++)setTimeout(()=>{if(!f){const d=this.actionGetSizeBox();d.width>0&&d.height&&(f=!0,h(d))}10===p&&!f&&v(new Error)},100*p)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(h){let v=0;for(let f=0;f<h.children.length;f++)v+=h.children[f].getBoundingClientRect().width;return v}}return(s=r).PADDING_ITEM=40,s.\u0275fac=function(h){return new(h||s)(D.rXU(D.aKT))},s.\u0275dir=D.FsC({type:s,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[D.OA$]}),r})()},25539:(z,T,l)=>{l.d(T,{I:()=>D});class D{constructor(){this.answerLabelsMockup={}}}},5382:(z,T,l)=>{l.d(T,{n:()=>D});class D{constructor(s,r,C,h){this.tasks=new Array,this.queues=new Array,this.isRunning=!1,this.allTasks=0,this.wrapCounter=0,this.wrapCounterDone=0,this.countTaskRootDone=0,this.limitOneProcess=s,this.resultCommonTemp={datas:[],errs:[]},this.actionLogItem=r,this.delayTime=C||1e3,this.endWithError=h??!1}addTask(s,r,C,h){if(this.isRunning)return;var v=C||[];const f=this.queues.length;this.allTasks++,this.queues.push({task:()=>new Promise(d=>{this.wrapCounter++,r.call(s,...v).then(_=>{this.wrapCounterDone++,this.callLog(h),d({status:!0,value:_,index:f})}).catch(_=>{this.wrapCounterDone++,this.callLog(h),d({status:!1,error:_,index:f})})}),name:h})}callLog(s){this.actionLogItem&&this.allTasks>0&&this.actionLogItem.function.call({},this.wrapCounterDone,this.allTasks,...this.actionLogItem.params?this.actionLogItem.params:[],s)}start(){return new Promise(s=>{0===this.queues.length&&s({datas:[],errs:[]}),this.resultCommonTemp={datas:[],errs:[]};for(let r=0;r<this.limitOneProcess;r++){const C=this.queues.shift();if(!C)break;this.tasks.push(C)}this.countTaskRootDone=0,this.isRunning=!0,this.runner(s)})}checker(s,r){this.countTaskRootDone++,s.status&&s.value?this.resultCommonTemp.datas.push({index:s.index,value:s.value}):s.error&&this.resultCommonTemp.errs.push({index:s.index,value:s.error}),this.resultCommonTemp.errs.length>0&&this.endWithError&&(this.isRunning=!1,r(this.makeResultObj())),this.countTaskRootDone===this.allTasks&&(this.isRunning=!1,r(this.makeResultObj())),this.nextItem(r)}makeResultObj(){return{datas:this.resultCommonTemp.datas.sort(function(s,r){return s.index-r.index}).map(s=>s.value),errs:this.resultCommonTemp.errs.sort(function(s,r){return s.index-r.index}).map(s=>s.value)}}nextItem(s){const r=this.queues.shift();r&&r.task.call(this).then(C=>this.checker(C,s))}runner(s){this.tasks.length>0?this.tasks.forEach(r=>{r.task.call(this).then(C=>this.checker(C,s))}):(this.isRunning=!1,s(this.makeResultObj()))}}},76671:(z,T,l)=>{l.d(T,{c:()=>p});var D=l(73014),g=l(27691),s=l(5382),r=l(26860),C=l(62095),h=l(40949),v=l(41426);const f=l(4060);let p=(()=>{var d;class _{constructor(t,e,n){this.commonService=t,this.sAztCdnService=e,this.apiUploadService=n,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}convertBase64OfMathJaxToCdnUrl(t){return new Promise(e=>{var n=this.getValueContentQuestion(t.questionContent??""),a=this.getValueContentQuestion(t.answerConfig??""),u=t.answerMedia??"",o=this.removeBase64MathJaxInQuestionContent(t.questionText??"");if(0===n.length||0===a.length)return void e(t);let w=this.encodeContent(n[0].content),E=[];a.forEach((m,M)=>{E.push({i:M,d:this.encodeContent(m.content)})});let c=this.encodeContent(u);var O=0;let R=[];for(let m=0;m<w.raws.length;m++)w.raws[m].i=O,O++,R.push(w.raws[m]);for(let m=0;m<c.raws.length;m++)c.raws[m].i=O,O++,R.push(c.raws[m]);E.forEach(m=>{for(let M=0;M<m.d.raws.length;M++)m.d.raws[M].i=O,O++,R.push(m.d.raws[M])}),R.length>0?this.uploadRawContent(R.map(m=>m.l)).then(m=>{w.raws.forEach(M=>{let P=this.stringFirst+btoa(JSON.stringify({l:m,i:M.i}));n[0].content=this.commonService.replaceAll(n[0].content,M.l,P)??""}),c.raws.forEach(M=>{let P=this.stringFirst+btoa(JSON.stringify({l:m,i:M.i}));u=this.commonService.replaceAll(u,M.l,P)??""}),E.forEach(M=>{M.d.raws.forEach(P=>{let S=this.stringFirst+btoa(JSON.stringify({l:m,i:P.i}));a[M.i].content=this.commonService.replaceAll(a[M.i].content,P.l,S)??""})}),t.questionContent=JSON.stringify(n),t.answerConfig=JSON.stringify(a),t.answerMedia=u,t.questionText=o,e(t)}).catch(()=>{e(t)}):e(t)})}decodeMathJaxCodeToCdnUrl(t){return new Promise(e=>{const n=new s.n(10);if(n.addTask(this,()=>new Promise(a=>{this.decodeContent(t.content??"").then(u=>{t.content=u,a(!0)}).catch(()=>{a(!1)})})),n.addTask(this,()=>new Promise(a=>{this.decodeContent(t.help??"").then(u=>{t.help=u,a(!0)}).catch(()=>{a(!1)})})),t.answers)for(let a=0;a<t.answers.length;a++)n.addTask(this,()=>new Promise(u=>{t.answers&&this.decodeContent(t.answers[a].content??"").then(o=>{t.answers&&(t.answers[a].content=o),u(!0)}).catch(()=>{u(!1)})}));n.start().then(()=>{e()})})}getValueContentQuestion(t){return this.commonService.castJsonToObj(t)??[]}getAllMatchWithContent(t){let n,e=[];for(;null!==(n=_.searchPattern.exec(t));)e.includes(n[0])||e.push(n[0]);return e}getRawContent(t,e){return t=this.sAztCdnService.getMyCdn(t),new Promise((n,a)=>{const u=this.dataRaws.findIndex(o=>o.l===t);-1===u?fetch(t).then(o=>o.blob()).then(o=>o.arrayBuffer()).then(o=>{const w=f.inflate(o),E=this.commonService.castJsonToObj((new TextDecoder).decode(w));this.dataRaws.push({l:t,d:E??[]}),E&&E[e]?n(E[e]):a(new Error("Not found index"))}).catch(()=>{a(new Error("Exception at feed link"))}):this.dataRaws[u].d&&this.dataRaws[u].d[e]?n(this.dataRaws[u].d[e]):a(new Error("Not found index"))})}uploadRawContent(t){return new Promise((e,n)=>{const a=JSON.stringify(t),u=(new TextEncoder).encode(a),o=f.deflate(u),w=new Blob([o],{type:"application/octet-stream"}),E=new File([w],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(E).subscribe(c=>{c.type!=g.hv.UploadProgress&&(1==c.success&&c.data?e(c.data.url??""):n(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+c.message)))})})}removeBase64MathJaxInQuestionContent(t){return this.encodeContent(t).raws.forEach(n=>{t=this.commonService.replaceAll(t,n.l,"")??""}),t}encodeContent(t){let e=this.getAllMatchWithContent(t),n=[];for(let a=0;a<e.length;a++){let o=e[a].replace(_.searchPattern,"$1");o.startsWith(this.stringFirst)||n.push({l:o,i:n.length})}return{content:t,raws:n}}decodeContent(t){var e=this;return(0,D.A)(function*(){let n=e.getAllMatchWithContent(t);for(let a=0;a<n.length;a++){const u=n[a];let o=u.replace(_.searchPattern,"$1");for(let w=0;w<e.stringFirstOld.length;w++)if(o.startsWith(e.stringFirstOld[w])){t=e.commonService.replaceAll(t,u,"")??"";continue}if(o.startsWith(e.stringFirst)){let w=e.commonService.castJsonToObj(atob(o.replace(e.stringFirst,"")));if(w){let E=yield e.getRawContent(w.l,w.i);t=e.commonService.replaceAll(t,o,E)??""}}}return t})()}}return(d=_).searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,d.\u0275fac=function(t){return new(t||d)(r.KVO(C.R),r.KVO(h.B),r.KVO(v.T))},d.\u0275prov=r.jDH({token:d,factory:d.\u0275fac,providedIn:"root"}),_})()},32639:(z,T,l)=>{l.d(T,{g:()=>f});var D=l(65106),g=l(5382),s=l(4744),r=l(26860),C=l(40949),h=l(62095),v=l(76671);let f=(()=>{var p;class d{pushImage(i,t,e){if(e){let n=new RegExp("<div id='"+i+"'[^>]+></div>","g");e.content&&(e.content=e.content.replace(n,t??"")),e.answers&&e.answers.forEach(a=>{a.content=a.content?.replace(n,t??"")}),e.help&&(e.help=e.help.replace(n,t??"")),e.groupInfo&&e.groupInfo.groupContent&&(e.groupInfo.groupContent=e.groupInfo.groupContent.replace(n,t??""))}}parseRenderQuestions(i,t,e,n,a,u){return new Promise((o,w)=>{const c=new g.n(25,{function:(O,R)=>{t&&t(O/R*100)}},n??1e3);i.forEach(O=>{c.addTask(this,this.parseRenderQuestion,[O,e,a,u])}),c.start().then(O=>{if(O.errs.length>0){const R=[];O.errs.forEach(m=>{let M=R.find(P=>P.type===m.type);M||R.push(m),M?.data.concat(m.data)}),w(R)}else o(i)})})}parseRenderQuestion(i,t,e,n){return new Promise((a,u)=>{var o=new s.h(this.cdnService,this.commonService,t||new D.y,c=>{u(c)});o.callbackPushImage=(c,O)=>{this.pushImage(c,O,i)},o.caller=this;const E=new g.n(n?1:20,void 0,0);i.content&&E.addTask(this,()=>new Promise(c=>{i.content=o.render(this.commonService.removeBracket(i.content??""),()=>{c()})})),i.answers&&i.answers.forEach(c=>{E.addTask(this,()=>new Promise(O=>{c.content=o.render(c.content||"",()=>{O()})}))}),i.help&&E.addTask(this,()=>new Promise(c=>{i.help=o.render(i.help,()=>{c()})})),i.groupInfo&&i.groupInfo.groupContent&&E.addTask(this,()=>new Promise(c=>{i.groupInfo&&i.groupInfo.groupContent?i.groupInfo.groupContent=o.render(this.commonService.removeBracket(i.groupInfo.groupContent),()=>{c()}):c()})),e&&E.addTask(this,()=>new Promise(c=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(i).then(()=>{c()})})),E.start().then(c=>{c.errs.length||a()})})}constructor(i,t,e){this.cdnService=i,this.commonService=t,this.dataAztMathRawHelper=e}}return(p=d).\u0275fac=function(i){return new(i||p)(r.KVO(C.B),r.KVO(h.R),r.KVO(v.c))},p.\u0275prov=r.jDH({token:p,factory:p.\u0275fac,providedIn:"root"}),d})()},2915:(z,T,l)=>{l.d(T,{U:()=>p});var D=l(59640),g=l(26860),s=l(54460),r=l(89163),C=l(5502);const h=["aztDialogContentBox"],v=function(d,_){return{"width.px":d,"height.%":100,"--scrollbar-size":_}},f=["*"];let p=(()=>{var d;class _ extends D.H{checkHeightOfElement(){if(!this.aztDialogContentBox)return;var t=this.aztDialogContentBox.nativeElement.querySelector("."+this.contentBoxClassName);if(!t)return;let e=Math.round(window.innerHeight*this.defaultHeight/100),n=t.getBoundingClientRect().height+1,a=!(n<e),u=(n<e?n:e)+"px",o="72vh";a!=this.isScroll&&(this.isScroll=a),this.aztDialogContentBox.nativeElement.style.height!=u&&(this.aztDialogContentBox.nativeElement.style.height=u),this.aztDialogContentBox.nativeElement.style.maxHeight!=o&&(o=u),this.minHeight&&(this.aztDialogContentBox.nativeElement.style.minHeight=this.minHeight)}ngAfterViewChecked(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.checkHeightOfElement()},0)})}constructor(t){super(),this.ngZone=t,this.defaultHeight=72,this.defaultWidth=0,this.minHeight=void 0,this.isScroll=!1,this.contentBoxClassName="azt-mat-dialog-content-box"}}return(d=_).\u0275fac=function(t){return new(t||d)(g.rXU(g.SKi))},d.\u0275cmp=g.VBU({type:d,selectors:[["azt-mat-dialog-content"]],viewQuery:function(t,e){if(1&t&&g.GBs(h,5),2&t){let n;g.mGM(n=g.lsd())&&(e.aztDialogContentBox=n.first)}},inputs:{defaultHeight:"defaultHeight",defaultWidth:"defaultWidth",minHeight:"minHeight"},features:[g.Vt3],ngContentSelectors:f,decls:5,vars:7,consts:[["aztDialogContentBox",""],["scrollViewport","","pointerEventsMethod","scrollbar",3,"visibility","ngStyle"]],template:function(t,e){1&t&&(g.NAR(),g.j41(0,"mat-dialog-content",null,0)(2,"ng-scrollbar",1)(3,"div"),g.SdG(4),g.k0s()()()),2&t&&(g.R7$(2),g.Y8G("visibility","hover")("ngStyle",g.l_i(4,v,e.defaultWidth||"auto",e.isScroll?"5px":"0")),g.R7$(1),g.HbH(e.contentBoxClassName))},dependencies:[s.B3,r.Yi,C.Yh,C.Gl],encapsulation:2}),_})()}}]);