"use strict";(self.webpackChunkSuperadminMod=self.webpackChunkSuperadminMod||[]).push([[313],{72313:(L,F,a)=>{a.d(F,{V:()=>Z});var r=a(14042),m=a(60177),e=a(93953),h=a(89417),v=a(32108);let B=(()=>{var l;class p{constructor(){(0,r.A)(this,"fileDrop",new e.bkB),(0,r.A)(this,"preventBodyDrop",!0),(0,r.A)(this,"active",!1)}onDrop(o){o.preventDefault(),this.active=!1;const{dataTransfer:t}=o;if(t?.items){const i=[];for(let n=0;n<t.items.length;n++)"file"===t.items[n].kind&&t.items[n].getAsFile()&&i.push(t.items[n].getAsFile());t.items.clear(),Array.isArray(i)&&this.fileDrop.emit(this.removeNullFile(i))}else{const i=t?.files;t?.clearData(),i&&this.fileDrop.emit(Array.from(i))}}removeNullFile(o){for(var t=[],i=0;i<o.length;i++)o[i]&&t.push(o[i]);return t}onDragOver(o){o.stopPropagation(),o.preventDefault(),this.active=!0}onDragLeave(o){this.active=!1}onBodyDragOver(o){this.preventBodyDrop&&(o.preventDefault(),o.stopPropagation())}onBodyDrop(o){this.preventBodyDrop&&o.preventDefault()}}return l=p,(0,r.A)(p,"\u0275fac",function(o){return new(o||l)}),(0,r.A)(p,"\u0275dir",e.FsC({type:l,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(o,t){1&o&&e.bIt("drop",function(n){return t.onDrop(n)})("dragover",function(n){return t.onDragOver(n)})("dragleave",function(n){return t.onDragLeave(n)})("dragover",function(n){return t.onBodyDragOver(n)},!1,e.N_X)("drop",function(n){return t.onBodyDrop(n)},!1,e.N_X),2&o&&e.AVh("drop-zone-active",t.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"},standalone:!0})),p})();var C=a(83409),A=a(98697),y=a(18068),S=a(8516),D=a(11782),U=a(46412),T=a(74523),_=a(21626),P=a(51451),g=a(99939),M=a(90355),z=a(64509),O=a(17525),E=a(29758),I=a(93877);let x=(()=>{var l;class p extends P.H{uploadFile(o,t){return new Promise(i=>{this.checkCompressImage(o,n=>{this.fileUploadQueue=[],this.showProgress?this.apiUploadService.commonUploadFileProgress(this.uploadToCdnMenu,n,this.qrUploadHashCode).subscribe(s=>{if(s.type!==_.hv.UploadProgress)if(1===s.success){const u={...s.data};i(u)}else this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_tep_tin_vui_long_thu_lai_sau",s.message??"none")),i(null);else{let u=(s.loaded??0)/(s.total??1)*100,c=this.fileUploadQueue.find(f=>f.uuid==t);c?c.uploadProgress=u:this.fileUploadQueue.push({uuid:t,uploadProgress:0,fileName:o.name})}}):this.apiUploadService.commonUploadFile(this.uploadToCdnMenu,n,this.qrUploadHashCode).subscribe(s=>{if(s.type!==_.hv.UploadProgress)if(1===s.success){const u={...s.data};i(u)}else this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_tep_tin_vui_long_thu_lai_sau",s.message??"none")),i(null)})})})}onOpenFileDictionary(){return this.uploadActionsEvent.emit("SELECT_FILE"),!0}onFileSelected(o){this.uploadActionsEvent.emit("SELECTED");const t=o.target,i=t.files;i&&(this.emitFile(i),t.files=null)}onCancelSelect(o){this.uploadActionsEvent.emit("SELECTED")}onDrop(o){this.emitFile(o)}emitFile(o){return this.isDisabled?(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(o).find(n=>(0,g.hD)(n.size)>=this.limitSize)?this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB")):Array.from(o).find(n=>this.isNotSupportedFile(n))?this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_chua_ho_tro_dinh_dang",this.notSupportedFile)):(this.isUploadFile=!0,this.isUploading.emit(this.isUploadFile),void this.checkConvertPdfToImages(Array.from(o),n=>{const s=n.map(u=>this.uploadFile(u,this.uuidService.getUuid()));Promise.all(s).then(u=>{this.isUploadFile=!1,this.isUploading.emit(this.isUploadFile);let c=u.filter(this.commonService.notEmpty);this.emitUploadComplete(c)})}))):this.showErrorSnack(this.commonService.translateString("lang_auto_ban_khong_co_quyen_thuc_hien_hanh_dong_nay"))}checkConvertPdfToImages(o,t){if(!this.convertPdfToImages)return t(o);this.convertAllPdfToImages(o).then(i=>{t(i)})}convertAllPdfToImages(o){var t=this;return new Promise(function(){var i=(0,T.A)(function*(n,s){let u=[];for(let c of o)if((0,g.Ev)(c.type))try{const f=1e3*t.convertPdfTimeout;let V=yield t.withTimeout(t.myPdfService.getImageWithPdf(c),f);u.push(...V)}catch{t.showErrorSnack("lang_common_convert_pdf_to_image_timeout"),n([])}else u.push(c);n(u)});return function(n,s){return i.apply(this,arguments)}}())}checkCompressImage(o,t){this.allowCompressImage?(0,g.w4)(o).then(i=>{t(i)}):t(o)}isNotSupportedFile(o){const t=[this.notSupportedFile],i=o.name.split(".").pop()?.toLowerCase();return t.includes(`.${i}`)}withTimeout(o,t){return new Promise((i,n)=>{const s=setTimeout(()=>{n(new Error("Operation timed out"))},t);o.then(u=>{clearTimeout(s),i(u)}).catch(u=>{clearTimeout(s),n(u)})})}constructor(o,t,i,n){super(),(0,r.A)(this,"mobileWebviewService",void 0),(0,r.A)(this,"apiUploadService",void 0),(0,r.A)(this,"myPdfService",void 0),(0,r.A)(this,"uuidService",void 0),(0,r.A)(this,"convertPdfTimeout",30),(0,r.A)(this,"fileType",void 0),(0,r.A)(this,"uploadToCdnMenu",void 0),(0,r.A)(this,"isDisabled",!0),(0,r.A)(this,"notSupportedFile",M.Ym.NONE),(0,r.A)(this,"limitSize",200),(0,r.A)(this,"allowCompressImage",!0),(0,r.A)(this,"convertPdfToImages",!1),(0,r.A)(this,"qrUploadHashCode",""),(0,r.A)(this,"showProgress",!1),(0,r.A)(this,"containerClass","flex items-center justify-center h-full"),(0,r.A)(this,"isUploading",new e.bkB),(0,r.A)(this,"uploadActionsEvent",new e.bkB),(0,r.A)(this,"isUploadFile",!1),(0,r.A)(this,"fileUploadQueue",[]),this.mobileWebviewService=o,this.apiUploadService=t,this.myPdfService=i,this.uuidService=n}}return l=p,(0,r.A)(p,"\u0275fac",function(o){return new(o||l)(e.rXU(z.f),e.rXU(O.T),e.rXU(E.C),e.rXU(I.D))}),(0,r.A)(p,"\u0275cmp",e.VBU({type:l,selectors:[["ng-component"]],inputs:{convertPdfTimeout:"convertPdfTimeout",fileType:"fileType",uploadToCdnMenu:"uploadToCdnMenu",isDisabled:"isDisabled",notSupportedFile:"notSupportedFile",limitSize:"limitSize",allowCompressImage:"allowCompressImage",convertPdfToImages:"convertPdfToImages",qrUploadHashCode:"qrUploadHashCode",showProgress:"showProgress",containerClass:"containerClass"},outputs:{isUploading:"isUploading",uploadActionsEvent:"uploadActionsEvent"},standalone:!0,features:[e.Vt3,e.aNF],decls:0,vars:0,template:function(o,t){},dependencies:[m.MD,h.X1,v.iI,h.YN,U.s,S.flO,A.L,D.Id,C.k],encapsulation:2})),p})();const w=["*"];function k(l,p){1&l&&e.SdG(0,0,["*ngIf","!isUploadFile"])}function N(l,p){if(1&l&&(e.j41(0,"div",8)(1,"h5",9),e.EFF(2),e.k0s(),e.j41(3,"div",10),e.nrm(4,"progress",11),e.k0s()()),2&l){const d=p.$implicit;e.R7$(2),e.JRh(d.fileName),e.R7$(2),e.FS9("value",d.uploadProgress)}}function b(l,p){if(1&l&&(e.qex(0),e.j41(1,"span",6),e.nrm(2,"azt-loading-ui"),e.k0s(),e.DNE(3,N,5,2,"div",7),e.bVm()),2&l){const d=e.XpG(2);e.R7$(3),e.Y8G("ngForOf",d.fileUploadQueue)}}function j(l,p){1&l&&(e.j41(0,"span",6),e.nrm(1,"azt-loading-ui"),e.k0s())}function H(l,p){if(1&l&&(e.j41(0,"div"),e.DNE(1,b,4,1,"ng-container",5)(2,j,2,0,"ng-template",null,1,e.C5r),e.k0s()),2&l){const d=e.sdS(3),o=e.XpG();e.R7$(),e.Y8G("ngIf",o.showProgress)("ngIfElse",d)}}let Z=(()=>{var l;class p extends x{constructor(...o){super(...o),(0,r.A)(this,"uploadComplete",new e.bkB),(0,r.A)(this,"files",void 0)}emitUploadComplete(o){this.uploadComplete.emit(o)}ngOnInit(){this.files&&this.files.length>0&&this.emitFile(this.files)}}return l=p,(0,r.A)(p,"\u0275fac",(()=>{let d;return function(t){return(d||(d=e.xGo(l)))(t||l)}})()),(0,r.A)(p,"\u0275cmp",e.VBU({type:l,selectors:[["azt-upload-multiple-box"]],inputs:{files:"files"},outputs:{uploadComplete:"uploadComplete"},standalone:!0,features:[e.Vt3,e.aNF],ngContentSelectors:w,decls:5,vars:4,consts:[["formChoseFile",""],["notShowProgress",""],[3,"appDropZone","click"],["type","file","id","box-left-file-input","multiple","",1,"form-control","file-input",2,"display","none",3,"change","cancel","accept"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"w-4","h-4","inline-block","mr-2"],["class","w-48",4,"ngFor","ngForOf"],[1,"w-48"],[1,"text-md","font-medium","truncate"],[1,"progress-container"],["max","100",2,"width","100%","background-color","#1e40af",3,"value"]],template:function(o,t){if(1&o){const i=e.RV6();e.NAR(),e.j41(0,"div",2),e.bIt("appDropZone",function(s){return e.eBV(i),e.Njj(t.onDrop(s))})("click",function(){e.eBV(i);const s=e.sdS(2);return e.Njj(s.click())}),e.j41(1,"input",3,0),e.bIt("change",function(s){return e.eBV(i),e.Njj(t.onFileSelected(s))})("cancel",function(s){return e.eBV(i),e.Njj(t.onCancelSelect(s))})("cancel",function(s){return e.eBV(i),e.Njj(t.onCancelSelect(s))}),e.k0s(),e.DNE(3,k,1,0,"ng-content",4)(4,H,4,2,"div",4),e.k0s()}2&o&&(e.BMQ("class",t.containerClass),e.R7$(),e.FS9("accept",t.fileType),e.R7$(2),e.Y8G("ngIf",!t.isUploadFile),e.R7$(),e.Y8G("ngIf",t.isUploadFile))},dependencies:[B,y.R,m.MD,m.Sq,m.bT,h.X1,v.iI,h.YN,U.s,S.flO,A.L,D.Id,C.k],styles:['.progress-container[_ngcontent-%COMP%]{position:relative;display:block;background:#eee;height:10px;border-radius:6px;overflow:hidden}.progress-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;height:100%;background:#1e40af}progress[_ngcontent-%COMP%]{accent-color:#1e40af}[_ngcontent-%COMP%]::-webkit-progress-value{background-color:#1e40af}[_ngcontent-%COMP%]::-moz-progress-bar{background-color:#1e40af}']})),p})()}}]);