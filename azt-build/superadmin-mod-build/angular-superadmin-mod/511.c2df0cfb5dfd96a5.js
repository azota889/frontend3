"use strict";(self.webpackChunkSuperadminMod=self.webpackChunkSuperadminMod||[]).push([[511],{29511:(V,F,l)=>{l.d(F,{V:()=>H});var c=l(60177),e=l(93953),m=l(89417),g=l(32108),v=l(8516),C=l(11782),_=l(46412);let B=(()=>{var r;class d{constructor(){this.fileDrop=new e.bkB,this.preventBodyDrop=!0,this.active=!1}onDrop(o){o.preventDefault(),this.active=!1;const{dataTransfer:t}=o;if(t?.items){const i=[];for(let n=0;n<t.items.length;n++)"file"===t.items[n].kind&&t.items[n].getAsFile()&&i.push(t.items[n].getAsFile());t.items.clear(),Array.isArray(i)&&this.fileDrop.emit(this.removeNullFile(i))}else{const i=t?.files;t?.clearData(),i&&this.fileDrop.emit(Array.from(i))}}removeNullFile(o){for(var t=[],i=0;i<o.length;i++)o[i]&&t.push(o[i]);return t}onDragOver(o){o.stopPropagation(),o.preventDefault(),this.active=!0}onDragLeave(o){this.active=!1}onBodyDragOver(o){this.preventBodyDrop&&(o.preventDefault(),o.stopPropagation())}onBodyDrop(o){this.preventBodyDrop&&o.preventDefault()}}return(r=d).\u0275fac=function(o){return new(o||r)},r.\u0275dir=e.FsC({type:r,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(o,t){1&o&&e.bIt("drop",function(n){return t.onDrop(n)})("dragover",function(n){return t.onDragOver(n)})("dragleave",function(n){return t.onDragLeave(n)})("dragover",function(n){return t.onBodyDragOver(n)},!1,e.N_X)("drop",function(n){return t.onBodyDrop(n)},!1,e.N_X),2&o&&e.AVh("drop-zone-active",t.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"},standalone:!0}),d})();var D=l(23424),y=l(30665),T=l(74523),S=l(21626),P=l(1654),f=l(44764),A=l(7766),U=l(9788),z=l(19828),M=l(48766),O=l(44403),E=l(38344);let I=(()=>{var r;class d extends P.H{uploadFile(o,t){return new Promise(i=>{this.checkCompressImage(o,n=>{this.fileUploadQueue=[],this.showProgress?this.apiUploadService.commonUploadFileProgress(this.uploadToCdnMenu,n,this.qrUploadHashCode).subscribe(s=>{if(s.type!==S.hv.UploadProgress)if(1===s.success){const p={...s.data};i(p)}else this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_tep_tin_vui_long_thu_lai_sau",s.message??"none")),i(null);else{let p=(s.loaded??0)/(s.total??1)*100,u=this.fileUploadQueue.find(h=>h.uuid==t);u?u.uploadProgress=p:this.fileUploadQueue.push({uuid:t,uploadProgress:0,fileName:o.name})}}):this.apiUploadService.commonUploadFile(this.uploadToCdnMenu,n,this.qrUploadHashCode).subscribe(s=>{if(s.type!==S.hv.UploadProgress)if(1===s.success){const p={...s.data};i(p)}else this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_tep_tin_vui_long_thu_lai_sau",s.message??"none")),i(null)})})})}onOpenFileDictionary(){return this.uploadActionsEvent.emit("SELECT_FILE"),!0}onFileSelected(o){this.uploadActionsEvent.emit("SELECTED");const t=o.target,i=t.files;i&&(this.emitFile(i),t.files=null)}onCancelSelect(o){this.uploadActionsEvent.emit("SELECTED")}onDrop(o){this.emitFile(o)}emitFile(o){return this.isDisabled?(this.limitSize=this.limitSize>200?200:this.limitSize,Array.from(o).find(n=>(0,f.hD)(n.size)>=this.limitSize)?this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_vui_long_chon_tep_co_kich_thuoc_nho_hon",this.limitSize.toString(),"MB")):Array.from(o).find(n=>this.isNotSupportedFile(n))?this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_chua_ho_tro_dinh_dang",this.notSupportedFile)):(this.isUploadFile=!0,this.isUploading.emit(this.isUploadFile),void this.checkConvertPdfToImages(Array.from(o),n=>{const s=n.map(p=>this.uploadFile(p,this.uuidService.getUuid()));Promise.all(s).then(p=>{this.isUploadFile=!1,this.isUploading.emit(this.isUploadFile);let u=p.filter(this.commonService.notEmpty);this.emitUploadComplete(u)})}))):this.showErrorSnack(this.commonService.translateString("lang_auto_ban_khong_co_quyen_thuc_hien_hanh_dong_nay"))}checkConvertPdfToImages(o,t){if(!this.convertPdfToImages)return t(o);this.convertAllPdfToImages(o).then(i=>{t(i)})}convertAllPdfToImages(o){var t=this;return new Promise(function(){var i=(0,T.A)(function*(n,s){let p=[];for(let u of o)if((0,f.Ev)(u.type))try{const h=1e3*t.convertPdfTimeout;let Z=yield t.withTimeout(t.myPdfService.getImageWithPdf(u),h);p.push(...Z)}catch{t.showErrorSnack("lang_common_convert_pdf_to_image_timeout"),n([])}else p.push(u);n(p)});return function(n,s){return i.apply(this,arguments)}}())}checkCompressImage(o,t){this.allowCompressImage?(0,f.w4)(o).then(i=>{t(i)}):t(o)}isNotSupportedFile(o){const t=[this.notSupportedFile],i=o.name.split(".").pop()?.toLowerCase();return t.includes(`.${i}`)}withTimeout(o,t){return new Promise((i,n)=>{const s=setTimeout(()=>{n(new Error("Operation timed out"))},t);o.then(p=>{clearTimeout(s),i(p)}).catch(p=>{clearTimeout(s),n(p)})})}constructor(o,t,i,n){super(),this.mobileWebviewService=o,this.apiUploadService=t,this.myPdfService=i,this.uuidService=n,this.convertPdfTimeout=30,this.isDisabled=!0,this.notSupportedFile=A.Ym.NONE,this.limitSize=200,this.allowCompressImage=!0,this.convertPdfToImages=!1,this.qrUploadHashCode="",this.showProgress=!1,this.containerClass="flex items-center justify-center h-full",this.isUploading=new e.bkB,this.uploadActionsEvent=new e.bkB,this.isUploadFile=!1,this.fileUploadQueue=[]}}return(r=d).\u0275fac=function(o){return new(o||r)(e.rXU(z.f),e.rXU(M.T),e.rXU(O.C),e.rXU(E.D))},r.\u0275cmp=e.VBU({type:r,selectors:[["ng-component"]],inputs:{convertPdfTimeout:"convertPdfTimeout",fileType:"fileType",uploadToCdnMenu:"uploadToCdnMenu",isDisabled:"isDisabled",notSupportedFile:"notSupportedFile",limitSize:"limitSize",allowCompressImage:"allowCompressImage",convertPdfToImages:"convertPdfToImages",qrUploadHashCode:"qrUploadHashCode",showProgress:"showProgress",containerClass:"containerClass"},outputs:{isUploading:"isUploading",uploadActionsEvent:"uploadActionsEvent"},standalone:!0,features:[e.Vt3,e.aNF],decls:0,vars:0,template:function(o,t){},dependencies:[c.MD,m.X1,g.iI,m.YN,_.s,v.flO,D.L,C.Id,U.k],encapsulation:2}),d})();const x=["*"];function w(r,d){1&r&&e.SdG(0,0,["*ngIf","!isUploadFile"])}function k(r,d){if(1&r&&(e.j41(0,"div",8)(1,"h5",9),e.EFF(2),e.k0s(),e.j41(3,"div",10),e.nrm(4,"progress",11),e.k0s()()),2&r){const a=d.$implicit;e.R7$(2),e.JRh(a.fileName),e.R7$(2),e.FS9("value",a.uploadProgress)}}function N(r,d){if(1&r&&(e.qex(0),e.j41(1,"span",6),e.nrm(2,"azt-loading-ui"),e.k0s(),e.DNE(3,k,5,2,"div",7),e.bVm()),2&r){const a=e.XpG(2);e.R7$(3),e.Y8G("ngForOf",a.fileUploadQueue)}}function b(r,d){1&r&&(e.j41(0,"span",6),e.nrm(1,"azt-loading-ui"),e.k0s())}function j(r,d){if(1&r&&(e.j41(0,"div"),e.DNE(1,N,4,1,"ng-container",5)(2,b,2,0,"ng-template",null,1,e.C5r),e.k0s()),2&r){const a=e.sdS(3),o=e.XpG();e.R7$(),e.Y8G("ngIf",o.showProgress)("ngIfElse",a)}}let H=(()=>{var r;class d extends I{constructor(){super(...arguments),this.uploadComplete=new e.bkB}emitUploadComplete(o){this.uploadComplete.emit(o)}ngOnInit(){this.files&&this.files.length>0&&this.emitFile(this.files)}}return(r=d).\u0275fac=(()=>{let a;return function(t){return(a||(a=e.xGo(r)))(t||r)}})(),r.\u0275cmp=e.VBU({type:r,selectors:[["azt-upload-multiple-box"]],inputs:{files:"files"},outputs:{uploadComplete:"uploadComplete"},standalone:!0,features:[e.Vt3,e.aNF],ngContentSelectors:x,decls:5,vars:4,consts:[["formChoseFile",""],["notShowProgress",""],[3,"appDropZone","click"],["type","file","id","box-left-file-input","multiple","",1,"form-control","file-input",2,"display","none",3,"change","cancel","accept"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"w-4","h-4","inline-block","mr-2"],["class","w-48",4,"ngFor","ngForOf"],[1,"w-48"],[1,"text-md","font-medium","truncate"],[1,"progress-container"],["max","100",2,"width","100%","background-color","#1e40af",3,"value"]],template:function(o,t){if(1&o){const i=e.RV6();e.NAR(),e.j41(0,"div",2),e.bIt("appDropZone",function(s){return e.eBV(i),e.Njj(t.onDrop(s))})("click",function(){e.eBV(i);const s=e.sdS(2);return e.Njj(s.click())}),e.j41(1,"input",3,0),e.bIt("change",function(s){return e.eBV(i),e.Njj(t.onFileSelected(s))})("cancel",function(s){return e.eBV(i),e.Njj(t.onCancelSelect(s))})("cancel",function(s){return e.eBV(i),e.Njj(t.onCancelSelect(s))}),e.k0s(),e.DNE(3,w,1,0,"ng-content",4)(4,j,4,2,"div",4),e.k0s()}2&o&&(e.BMQ("class",t.containerClass),e.R7$(),e.FS9("accept",t.fileType),e.R7$(2),e.Y8G("ngIf",!t.isUploadFile),e.R7$(),e.Y8G("ngIf",t.isUploadFile))},dependencies:[B,y.R,c.MD,c.Sq,c.bT,m.X1,g.iI,m.YN,_.s,v.flO,D.L,C.Id,U.k],styles:['.progress-container[_ngcontent-%COMP%]{position:relative;display:block;background:#eee;height:10px;border-radius:6px;overflow:hidden}.progress-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;height:100%;background:#1e40af}progress[_ngcontent-%COMP%]{accent-color:#1e40af}[_ngcontent-%COMP%]::-webkit-progress-value{background-color:#1e40af}[_ngcontent-%COMP%]::-moz-progress-bar{background-color:#1e40af}']}),d})()}}]);