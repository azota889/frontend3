(self.webpackChunkSuperadminMod=self.webpackChunkSuperadminMod||[]).push([[856],{43856:(Qe,st,_)=>{"use strict";_.r(st),_.d(st,{AzotaDigitalizeRoutingModule:()=>p});var T=_(32108),_e=_(74341),be=_(74603),z=_(60177),b=_(89417),j=_(8516),U=_(11782),V=_(46412),Y=_(9788),Tt=_(45096),O=_(88048),M=_(23424),$=_(22226),W=_(1654),lt=_(91022),y=_(55443),jt=_(25919),ft=_(25244),t=_(93953),St=_(93630),J=_(22439),L=_(74523),ct=_(21626),K=_(57399),Q=_(61906),_t=_(18359),it=_(71985),bt=_(48766),Dt=_(61737),$t=_(97173),R=_(38344),xt=_(7766);let It=(()=>{var e;class d{constructor(){this.subscriptions=new _t.yU,this.sAztBase64Service=(0,t.WQX)(J.D),this.ocrService=(0,t.WQX)(K.so),this.commonService=(0,t.WQX)($t.R),this.sAztUuidService=(0,t.WQX)(R.D),this.digitalizedBookPageService=(0,t.WQX)(Q.gI),this.apiUploadService=(0,t.WQX)(bt.T)}runRemoveBackgroundNoise(o,a,l){return new it.c(h=>{this.removeBackgroundNoise(o.oldImageUrl,a,(m,u)=>{if(null==m||u)return l(u??""),h.next(void 0),void h.complete();this.apiUploadService.commonUploadFile(xt.b8.ADMIN_DIGITALIZE,this.sAztBase64Service.base64ToFile(m,"digitalized-file.png"),"").subscribe(C=>{C.type!=ct.hv.UploadProgress&&(1===C.success&&C.data?.url?(h.next({...o,newImageUrl:C.data.url}),h.complete()):(l(C.message??""),h.next(void 0),h.complete()))})})})}removeBackgroundNoise(o,a,l){this.sAztBase64Service.convertImageUrlToBase64(o,h=>{if(!h)return l(void 0,"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(h),m=>{if(!m)return l(void 0,"Error to get Uint8Array from base64");this.loadScriptHandleImage(()=>{this.imageUtils.removeNoise(m,a).then(u=>l(this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(u.image)),void 0)).catch(u=>l(void 0,"Error when call imageUtils.detectImage"))})})})}callChangeBookPageDataApi(o,a,l,h,m){this.subscriptions.add(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrPost({bookId:o,bookPageId:a,ocrContent:l,originOcrContent:h}).subscribe(C=>{if(!C.success)return m(!1,C.message);m(!0,"")}))}digitalizeOneImage(o,a,l,h){return new it.c(m=>{a("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.commonService.wrapApiResponse(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:o})).subscribe(u=>{if(!u.success||!u.data)return l(u.message),m.next(!1),void m.complete();h(this.replaceOrcData(u.data)),m.next(!0),m.complete()}))})}replaceOrcData(o){let a=o.data,l=this.sAztUuidService.getUuid();return a=this.commonService.convertLatexTagToAztMathTag(a,l),a=(new O.bt).transform((new O.UN).transform(a)),a=this.commonService.replaceAll(a,"<table>","<table class='table table-bordered'>")??a,a=a.replace(new RegExp(l,"g"),"\n"),{htmlResult:a,originOcrData:o.data}}extractImageByOrcUtil(o,a){this.sAztBase64Service.convertImageUrlToBase64(o,l=>{if(!l)return a(void 0,[],"Error to get base64 from url");this.sAztBase64Service.getImageDimensions(l,h=>{this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(l),m=>{if(!m)return a(void 0,[],"Error to get Uint8Array from base64");let u={base64:this.sAztBase64Service.removePrefixOfBase64(l),x:0,y:0,width:h.width,height:h.height,extension:"png"};this.loadScriptHandleImage(()=>{this.imageUtils.detectImage(m).then(C=>a(u,C.images.map(v=>({base64:this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(v.content)),x:v.x,y:v.y,width:v.width,height:v.height,extension:v.extension})),void 0)).catch(C=>a(u,[],"Error when call imageUtils.detectImage"))})})})})}waitAnswerSheetInitDone(o){if(Dt.A.azotaScanAnswerSheet)return o();setTimeout(()=>{this.waitAnswerSheetInitDone(o)},100)}loadScriptHandleImage(o){var a=this;if(this.imageUtils)return o();this.commonService.loadAnswerSheetJs().then((0,L.A)(function*(){a.waitAnswerSheetInitDone((0,L.A)(function*(){a.imageUtils=yield Dt.A.azotaScanAnswerSheet.imageUtils(),o()}))})).catch(l=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),o()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(e=d).\u0275fac=function(o){return new(o||e)},e.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),d})();var dt=_(30665),vt=_(35589),pt=_(34006),Ot=_(1054);const Et=["image"];function Wt(e,d){1&e&&(t.j41(0,"div",6),t.nrm(1,"div",7),t.k0s())}function Jt(e,d){if(1&e&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&e){const s=t.XpG();t.R7$(),t.JRh(s.loadImageErrorText)}}let Rt=(()=>{class e{constructor(){this.cropperOptions={},this.export=new t.bkB,this.ready=new t.bkB,this.isLoading=!0}ngOnInit(){}ngOnDestroy(){this.cropper&&(this.cropper.destroy(),this.cropper=null)}imageLoaded(s){this.loadError=!1;const o=s.target;this.imageElement=o,this.cropperOptions.checkCrossOrigin&&(o.crossOrigin="anonymous"),o.addEventListener("ready",()=>{this.ready.emit(!0),this.isLoading=!1,this.cropbox&&this.cropper.setCropBoxData(this.cropbox)});let a=NaN;if(this.settings){const{width:l,height:h}=this.settings;a=l/h}this.cropperOptions={aspectRatio:a,checkCrossOrigin:!0,...this.cropperOptions},this.cropper&&(this.cropper.destroy(),this.cropper=void 0),this.cropper=new Ot(o,this.cropperOptions)}imageLoadError(s){this.loadError=!0,this.isLoading=!1}exportCanvas(s){const o=this.cropper.getImageData(),a=this.cropper.getCropBoxData(),l=this.cropper.getCroppedCanvas(),h={imageData:o,cropData:a};new Promise(u=>{if(s)return u({dataUrl:l.toDataURL("image/png")});l.toBlob(C=>u({blob:C}))}).then(u=>{this.export.emit({...h,...u})})}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["angular-cropper"]],viewQuery:function(s,o){if(1&s&&t.GBs(Et,7),2&s){let a;t.mGM(a=t.lsd())&&(o.image=a.first)}},inputs:{imageUrl:"imageUrl",settings:"settings",cropbox:"cropbox",loadImageErrorText:"loadImageErrorText",cropperOptions:"cropperOptions"},outputs:{export:"export",ready:"ready"},decls:6,vars:3,consts:[["image",""],[1,"cropper-wrapper"],["class","loading-block",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"cropper"],["alt","image",3,"load","error","src"],[1,"loading-block"],[1,"spinner"],[1,"alert","alert-warning"]],template:function(s,o){if(1&s){const a=t.RV6();t.j41(0,"div",1),t.DNE(1,Wt,2,0,"div",2)(2,Jt,2,1,"div",3),t.j41(3,"div",4)(4,"img",5,0),t.bIt("load",function(h){return t.eBV(a),t.Njj(o.imageLoaded(h))})("error",function(h){return t.eBV(a),t.Njj(o.imageLoadError(h))}),t.k0s()()()}2&s&&(t.R7$(),t.Y8G("ngIf",o.isLoading),t.R7$(),t.Y8G("ngIf",o.loadError),t.R7$(2),t.Y8G("src",o.imageUrl,t.B4B))},dependencies:[z.bT],styles:[':host{display:block}.cropper img{max-width:100%;max-height:100%;height:auto}.cropper-wrapper{position:relative;min-height:80px}.cropper-wrapper .loading-block{position:absolute;top:0;left:0;width:100%;height:100%}.cropper-wrapper .loading-block .spinner{width:31px;height:31px;margin:0 auto;border:2px solid rgba(97,100,193,.98);border-radius:50%;border-left-color:transparent;border-right-color:transparent;-webkit-animation:cssload-spin 425ms infinite linear;position:absolute;top:calc(50% - 15px);left:calc(50% - 15px);animation:cssload-spin 425ms infinite linear}@keyframes cssload-spin{to{transform:rotate(360deg)}}/*!\n * Cropper.js v1.4.1\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2018-07-15T09:54:43.167Z\n */.cropper-container{direction:ltr;font-size:0;line-height:0;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cropper-container img{display:block;height:100%;image-orientation:0deg;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;width:100%}.cropper-wrap-box,.cropper-canvas,.cropper-drag-box,.cropper-crop-box,.cropper-modal{inset:0;position:absolute}.cropper-wrap-box,.cropper-canvas{overflow:hidden}.cropper-drag-box{background-color:#fff;opacity:0}.cropper-modal{background-color:#000;opacity:.5}.cropper-view-box{display:block;height:100%;outline-color:#3399ffbf;outline:1px solid #39f;overflow:hidden;width:100%}.cropper-dashed{border:0 dashed #eee;display:block;opacity:.5;position:absolute}.cropper-dashed.dashed-h{border-bottom-width:1px;border-top-width:1px;height:calc(100% / 3);left:0;top:calc(100% / 3);width:100%}.cropper-dashed.dashed-v{border-left-width:1px;border-right-width:1px;height:100%;left:calc(100% / 3);top:0;width:calc(100% / 3)}.cropper-center{display:block;height:0;left:50%;opacity:.75;position:absolute;top:50%;width:0}.cropper-center:before,.cropper-center:after{background-color:#eee;content:" ";display:block;position:absolute}.cropper-center:before{height:1px;left:-3px;top:0;width:7px}.cropper-center:after{height:7px;left:0;top:-3px;width:1px}.cropper-face,.cropper-line,.cropper-point{display:block;height:100%;opacity:.1;position:absolute;width:100%}.cropper-face{background-color:#fff;left:0;top:0}.cropper-line{background-color:#39f}.cropper-line.line-e{cursor:ew-resize;right:-3px;top:0;width:5px}.cropper-line.line-n{cursor:ns-resize;height:5px;left:0;top:-3px}.cropper-line.line-w{cursor:ew-resize;left:-3px;top:0;width:5px}.cropper-line.line-s{bottom:-3px;cursor:ns-resize;height:5px;left:0}.cropper-point{background-color:#39f;height:5px;opacity:.75;width:5px}.cropper-point.point-e{cursor:ew-resize;margin-top:-3px;right:-3px;top:50%}.cropper-point.point-n{cursor:ns-resize;left:50%;margin-left:-3px;top:-3px}.cropper-point.point-w{cursor:ew-resize;left:-3px;margin-top:-3px;top:50%}.cropper-point.point-s{bottom:-3px;cursor:s-resize;left:50%;margin-left:-3px}.cropper-point.point-ne{cursor:nesw-resize;right:-3px;top:-3px}.cropper-point.point-nw{cursor:nwse-resize;left:-3px;top:-3px}.cropper-point.point-sw{bottom:-3px;cursor:nesw-resize;left:-3px}.cropper-point.point-se{bottom:-3px;cursor:nwse-resize;height:20px;opacity:1;right:-3px;width:20px}@media (min-width: 768px){.cropper-point.point-se{height:15px;width:15px}}@media (min-width: 992px){.cropper-point.point-se{height:10px;width:10px}}@media (min-width: 1200px){.cropper-point.point-se{height:5px;opacity:.75;width:5px}}.cropper-point.point-se:before{background-color:#39f;bottom:-50%;content:" ";display:block;height:200%;opacity:0;position:absolute;right:-50%;width:200%}.cropper-invisible{opacity:0}.cropper-bg{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC)}.cropper-hide{display:block;height:0;position:absolute;width:0}.cropper-hidden{display:none!important}.cropper-move{cursor:move}.cropper-crop{cursor:crosshair}.cropper-disabled .cropper-drag-box,.cropper-disabled .cropper-face,.cropper-disabled .cropper-line,.cropper-disabled .cropper-point{cursor:not-allowed}\n'],encapsulation:2}),e})(),Mt=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[z.MD]}),e})();var Nt=_(85389);const Zt=["angularCropper"];function ve(e,d){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"img",11),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const a=t.eBV(s).$implicit,l=t.XpG(2);return t.Njj(l.chooseImage(a))}),t.k0s(),t.bVm()}if(2&e){const s=d.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,s.base64,"png"),t.B4B)}}function Ce(e,d){if(1&e&&(t.j41(0,"div",9),t.DNE(1,ve,3,4,"ng-container",10),t.k0s()),2&e){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",s.base64Images)}}function ke(e,d){if(1&e&&(t.nrm(0,"angular-cropper",12,0),t.nI1(2,"addBase64Extension")),2&e){const s=t.XpG();t.Y8G("cropperOptions",s.cropperOptions)("imageUrl",t.i5U(2,2,s.currentBase64Image.base64,"png"))}}let Qt=(()=>{var e;class d extends Nt._{chooseImage(o){this.currentBase64Image=o}cropImage(o){var a=this;return(0,L.A)(function*(){a.angularCropper?.cropper.getCroppedCanvas().toBlob(l=>{l&&a.sAztBase64Service.convertBlobToBase64(l,function(){var h=(0,L.A)(function*(m){let u=a.angularCropper?.cropper.getCropBoxData(),C=u?.width,v=u?.height;!C||!v||(a.base64Images.push({base64:m,x:0,y:0,width:C,height:v,extension:"png"}),yield a.sAztBase64Service.copyBase64ToClipBoard(m),a.showSuccessSnack("lang_cms_copy_success"),o&&a.dialogRef.close(a.base64Images))});return function(m){return h.apply(this,arguments)}}())})})()}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(o,a){super(a,o),this.dialogRef=o,this.data=a,this.sAztBase64Service=(0,t.WQX)(J.D),this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=a.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return(e=d).\u0275fac=function(o){return new(o||e)(t.rXU(pt.CP,8),t.rXU(pt.Vh,8))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-coazt-image-editor"]],viewQuery:function(o,a){if(1&o&&t.GBs(Zt,5),2&o){let l;t.mGM(l=t.lsd())&&(a.angularCropper=l.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:14,vars:11,consts:[["angularCropper",""],[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn","btn-info","mr-2",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"],[3,"cropperOptions","imageUrl"]],template:function(o,a){1&o&&(t.j41(0,"div",1),t.DNE(1,Ce,2,1,"div",2),t.j41(2,"div",3)(3,"span",4),t.bIt("click",function(){return a.cropImage(!0)}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",5),t.bIt("click",function(){return a.cropImage(!1)}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"span",6),t.bIt("click",function(){return a.closeDialog()}),t.EFF(10),t.nI1(11,"mytranslate"),t.k0s()(),t.j41(12,"div",7),t.DNE(13,ke,3,5,"angular-cropper",8),t.k0s()()),2&o&&(t.R7$(),t.Y8G("ngIf",a.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,5,"lang_button_crop_and_close")),t.R7$(3),t.JRh(t.bMT(8,7,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(11,9,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",a.currentBase64Image))},dependencies:[Mt,Rt,z.MD,z.Sq,z.bT,b.X1,T.iI,b.YN,O.wp,V.s,j.flO,M.L,O.t4,U.Id,Y.k],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]}),d})();function Kt(e,d){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"img",6),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const a=t.eBV(s).$implicit,l=t.XpG(2);return t.Njj(l.copyImage(a))}),t.k0s(),t.bVm()}if(2&e){const s=d.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,s.base64,s.extension),t.B4B)}}function qt(e,d){if(1&e&&(t.j41(0,"div",4),t.DNE(1,Kt,3,4,"ng-container",5),t.k0s()),2&e){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",s.base64Images)}}let te=(()=>{var e;class d extends W.H{constructor(){super(...arguments),this.replaceImageEvent=new t.bkB,this.sAztDialogService=(0,t.WQX)(vt.i),this.sAztDigitalizeService=(0,t.WQX)(It),this.sAztBase64Service=(0,t.WQX)(J.D),this.base64Images=[]}copyImage(o){var a=this;return(0,L.A)(function*(){yield a.sAztBase64Service.copyBase64ToClipBoard(o.base64),a.showSuccessSnack("lang_cms_copy_and_replace_success"),a.replaceImageEvent.emit(o)})()}cropImageDialog(){this.sAztDialogService.open(Qt,{data:{base64Images:this.base64Images},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(a=>{null!=a&&(this.base64Images=a)})}ngOnChanges(){this.initStatusObj(),this.sAztDigitalizeService.extractImageByOrcUtil(this.imageUrl,(o,a,l)=>{if(l)return this.errorStatusObj(l,!0);let h=[];o&&h.push(o),a.forEach(m=>h.push(m)),this.base64Images=h,this.stopStatusObj()})}}return(e=d).\u0275fac=(()=>{let s;return function(a){return(s||(s=t.xGo(e)))(a||e)}})(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-list-digitalized-images"]],inputs:{imageUrl:"imageUrl"},outputs:{replaceImageEvent:"replaceImageEvent"},standalone:!0,features:[t.Vt3,t.OA$,t.aNF],decls:6,vars:4,consts:[[2,"height","228px","overflow-x","scroll","overflow-y","hidden"],["class","list-base640-images",4,"ngIf"],[1,"mb-3","mt-3"],[1,"text-primary","clickable",3,"click"],[1,"list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"]],template:function(o,a){1&o&&(t.j41(0,"div",0),t.DNE(1,qt,2,1,"div",1),t.k0s(),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return a.cropImageDialog()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()),2&o&&(t.R7$(),t.Y8G("ngIf",a.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,2,"lang_button_crop")))},dependencies:[z.MD,z.Sq,z.bT,b.X1,T.iI,b.YN,O.wp,V.s,j.flO,M.L,O.t4,U.Id,Y.k],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;max-height:200px}"]}),d})();const ee=()=>({"flex-none":!0,"mr-1":!0});function ie(e,d){1&e&&t.nrm(0,"azt-loading-ui",13)}function Pt(e,d){1&e&&t.nrm(0,"azt-loading-ui",13)}let ae=(()=>{var e;class d extends W.H{saveAllObjs(){this.saveAllContentEvent.emit()}saveObj(){this.initStatusObj();let o=this.obj.htmlContentFormControl.value;this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookObj.id,this.obj.id,o,void 0,(a,l)=>{if(!a)return this.errorStatusObj(l,!0);this.obj.ocrContent=o,this.changeBookPageStatusEvent.emit(this.obj),this.successStatusObj("lang_cms_update_success",!0)})}cancelObj(){this.showSuccessSnack("lang_cms_cancel_success"),this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}replaceImage(o){let a=this.obj.htmlContentFormControl.value.replace("<img>",`<img src='${this.sAztBase64Service.generateBase64Prefix(o.extension)+o.base64}'/>`);this.obj.htmlContentFormControl.setValue(a)}ngOnChanges(){this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}ngOnInit(){super.ngOnInit()}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(It),this.sAztBase64Service=(0,t.WQX)(J.D),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB,this.saveAllContentEvent=new t.bkB}}return(e=d).\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-edit-book-page"]],inputs:{bookObj:"bookObj",obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent",saveAllContentEvent:"saveAllContentEvent"},standalone:!0,features:[t.Vt3,t.OA$,t.aNF],decls:26,vars:29,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"p-3"],[3,"replaceImageEvent","imageUrl"],[3,"formControl","apiKey","init"],[1,"flex-none","items-center","text-right","mt-3"],[1,"btn","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","mr-3",3,"click"],["class","mr-1",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"mr-1"]],template:function(o,a){1&o&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"span",3),t.bIt("click",function(){return a.callAgainOcrBookPageEvent.emit(a.obj)}),t.nrm(6,"lucide-icon",4),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()(),t.j41(9,"div",5)(10,"app-digitalized-list-digitalized-images",6),t.bIt("replaceImageEvent",function(h){return a.replaceImage(h)}),t.k0s(),t.nrm(11,"editor",7),t.nI1(12,"getTinyMceKey"),t.nI1(13,"getTinyMceConfig"),t.j41(14,"div",8)(15,"button",9),t.bIt("click",function(){return a.cancelObj()}),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){return a.saveObj()}),t.DNE(19,ie,1,0,"azt-loading-ui",11),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s(),t.j41(22,"button",12),t.bIt("click",function(){return a.saveAllObjs()}),t.DNE(23,Pt,1,0,"azt-loading-ui",11),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()),2&o&&(t.R7$(3),t.Lme("",t.bMT(4,14,"lang_cms_admin_digitalized_page"),": ",a.obj.currentPage,""),t.R7$(3),t.Y8G("ngClass",t.lJ4(28,ee)),t.R7$(),t.SpI(" ",t.bMT(8,16,"lang_cms_admin_digitalized_re_digitalized_again")," "),t.R7$(3),t.Y8G("imageUrl",a.obj.imageLink),t.R7$(),t.FS9("apiKey",t.bMT(12,18,"")),t.Y8G("formControl",a.obj.htmlContentFormControl)("init",t.bMT(13,20,"admin_for_digitalized")),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(5),t.JRh(t.bMT(17,22,"lang_auto_huy")),t.R7$(3),t.Y8G("ngIf",a.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(21,24,"lang_digitalized_save_one")," "),t.R7$(3),t.Y8G("ngIf",a.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(25,26,"lang_digitalized_save_all")," "))},dependencies:[O.Hw,O.yc,St.sv,St.xn,te,dt.R,z.MD,z.YU,z.bT,b.X1,b.BC,b.l_,T.iI,b.YN,O.wp,V.s,j.flO,j.WGl,M.L,U.Id,Y.k],encapsulation:2}),d})();var ze=_(60126);const we=["*"];let At=(()=>{var e;class d extends W.H{constructor(){super(...arguments),this.imageUrl="",this.sAztDialogService=(0,t.WQX)(vt.i)}previewImage(){this.sAztDialogService.open(ze.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{url:this.imageUrl,mimes:"image/jpeg"},viewFullImageWithScroll:!0},restoreFocus:!1})}}return(e=d).\u0275fac=(()=>{let s;return function(a){return(s||(s=t.xGo(e)))(a||e)}})(),e.\u0275cmp=t.VBU({type:e,selectors:[["azt-preview-image-tag"]],inputs:{imageUrl:"imageUrl"},standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:we,decls:2,vars:0,consts:[[3,"click"]],template:function(o,a){1&o&&(t.NAR(),t.j41(0,"span",0),t.bIt("click",function(){return a.previewImage()}),t.SdG(1),t.k0s())},dependencies:[z.MD,b.X1,T.iI,b.YN,V.s,j.flO,M.L,U.Id,Y.k],encapsulation:2}),d})(),ye=(()=>{var e;class d extends W.H{}return(e=d).\u0275fac=(()=>{let s;return function(a){return(s||(s=t.xGo(e)))(a||e)}})(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-processing-book-page"]],inputs:{obj:"obj"},standalone:!0,features:[t.Vt3,t.aNF],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],[1,"flex","items-center"],[1,"mr-1"]],template:function(o,a){if(1&o&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()(),t.j41(5,"div",3)(6,"azt-preview-image-tag",4),t.nrm(7,"img",5),t.k0s(),t.nrm(8,"hr",6),t.j41(9,"div",7),t.nrm(10,"azt-loading-ui",8),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()()),2&o){let l;t.R7$(3),t.Lme("",t.bMT(4,5,"lang_cms_admin_digitalized_page"),": ",a.obj.currentPage,""),t.R7$(3),t.Y8G("imageUrl",a.obj.imageLink),t.R7$(),t.Y8G("src",a.obj.imageLink,t.B4B),t.R7$(4),t.SpI(" ",t.bMT(12,7,null!==(l=a.obj.logMessage)&&void 0!==l?l:"lang_lang_cms_admin_digitalized_is_waiting_to_process")," ")}},dependencies:[At,dt.R,z.MD,b.X1,T.iI,b.YN,O.wp,V.s,j.flO,M.L,U.Id,Y.k],encapsulation:2}),d})();const Gt=()=>({"flex-none":!0,"mr-1":!0});function oe(e,d){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"span",10),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.editBookPage(a.obj))}),t.nrm(2,"lucide-icon",11),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.callAgainOcrBookPageEvent.emit(a.obj))}),t.nrm(7,"lucide-icon",13),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s(),t.bVm()}2&e&&(t.R7$(2),t.Y8G("ngClass",t.lJ4(8,Gt)),t.R7$(),t.SpI(" ",t.bMT(4,4,"lang_cms_admin_digitalized_edit_content")," "),t.R7$(4),t.Y8G("ngClass",t.lJ4(9,Gt)),t.R7$(),t.SpI(" ",t.bMT(9,6,"lang_cms_admin_digitalized_re_digitalized_again")," "))}function ne(e,d){if(1&e&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e){const s=t.XpG();t.R7$(),t.JRh(t.bMT(2,1,s.obj.logMessage))}}function De(e,d){if(1&e&&(t.j41(0,"div"),t.nrm(1,"div",15),t.nI1(2,"mathJaxContent"),t.nI1(3,"async"),t.nI1(4,"safeNormalHtmlContent"),t.k0s()),2&e){let s;const o=t.XpG();t.R7$(),t.Y8G("innerHTML",t.bMT(4,5,t.bMT(3,3,t.bMT(2,1,null!==(s=o.obj.ocrContent)&&void 0!==s?s:""))),t.npT)}}let xe=(()=>{var e;class d extends W.H{constructor(){super(...arguments),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB}editBookPage(o){o.currentStatus="show_edit_form",this.changeBookPageStatusEvent.emit(o)}}return(e=d).\u0275fac=(()=>{let s;return function(a){return(s||(s=t.xGo(e)))(a||e)}})(),e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-view-book-page"]],inputs:{obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},standalone:!0,features:[t.Vt3,t.aNF],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"flex-none","items-center"],[4,"ngIf"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],["class","mb-3 text-pending",4,"ngIf"],[1,"text-primary","clickable","mr-2",3,"click"],["name","pencil","size","16",3,"ngClass"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"mb-3","text-pending"],[3,"innerHTML"]],template:function(o,a){1&o&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,oe,10,10,"ng-container",4),t.k0s()(),t.j41(7,"div",5)(8,"azt-preview-image-tag",6),t.nrm(9,"img",7),t.k0s(),t.nrm(10,"hr",8),t.DNE(11,ne,3,3,"div",9)(12,De,5,7,"div",4),t.k0s()),2&o&&(t.R7$(3),t.Lme("",t.bMT(4,7,"lang_cms_admin_digitalized_page"),": ",a.obj.currentPage,""),t.R7$(3),t.Y8G("ngIf",a.obj.isOrc),t.R7$(2),t.Y8G("imageUrl",a.obj.imageLink),t.R7$(),t.Y8G("src",a.obj.imageLink,t.B4B),t.R7$(2),t.Y8G("ngIf",a.obj.logMessage),t.R7$(),t.Y8G("ngIf",a.obj.isOrc))},dependencies:[At,z.MD,z.YU,z.bT,z.Jj,b.X1,T.iI,b.YN,O.wp,V.s,j.flO,j.WGl,M.L,O.km,O._y,U.Id,Y.k],encapsulation:2}),d})();var k=_(45312),re=_(82179),Ft=_(86648),at=_(73028),Ie=_(99437),gt=_(18810),N=_(7673),se=_(96354),le=_(19852),x=_(39974);const D=(e,d)=>(e.push(d),e);let ot=(()=>{var e;class d{processObservables(o,a,l){return new it.c(h=>{this.processMultipleObservables(o,a,l).subscribe({next:m=>{h.next(m),h.complete()},error:m=>{h.next(a.map(u=>null)),h.complete()}})})}processMultipleObservables(o,a,l){return(0,Ft.H)(a).pipe((0,at.Z)((h,m)=>h.pipe((0,Ie.W)(u=>(console.error("Error in observable:",u),l?(0,gt.$)(()=>u):(0,N.of)(null))),(0,se.T)(u=>({result:u,index:m}))),o),function Oe(){return(0,x.N)((e,d)=>{(0,le.T)(D,[])(e).subscribe(d)})}(),(0,se.T)(h=>h.sort((m,u)=>m.index-u.index).map(m=>m.result)))}}return(e=d).\u0275fac=function(o){return new(o||e)},e.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),d})();var Ae=_(65758);function q(e,d){if(1&e&&t.nrm(0,"azt-loading-effect",3),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function Be(e,d){if(1&e){const s=t.RV6();t.j41(0,"app-digitalized-view-book-page",18),t.bIt("changeBookPageStatusEvent",function(a){t.eBV(s);const l=t.XpG(5);return t.Njj(l.changeBookPageStatus(a))})("callAgainOcrBookPageEvent",function(a){t.eBV(s);const l=t.XpG(5);return t.Njj(l.reDigitalizedOneObj(a))}),t.k0s()}if(2&e){const s=t.XpG(2).$implicit;t.Y8G("obj",s)}}function A(e,d){if(1&e){const s=t.RV6();t.j41(0,"app-digitalized-edit-book-page",19),t.bIt("changeBookPageStatusEvent",function(a){t.eBV(s);const l=t.XpG(5);return t.Njj(l.changeBookPageStatus(a))})("callAgainOcrBookPageEvent",function(a){t.eBV(s);const l=t.XpG(5);return t.Njj(l.reDigitalizedOneObj(a))})("saveAllContentEvent",function(){t.eBV(s);const a=t.XpG(5);return t.Njj(a.saveAllContent())}),t.k0s()}if(2&e){const s=t.XpG(2).$implicit,o=t.XpG(3);t.Y8G("bookObj",o.bookObj)("obj",s)}}function H(e,d){if(1&e&&t.nrm(0,"app-digitalized-processing-book-page",20),2&e){const s=t.XpG(2).$implicit;t.Y8G("obj",s)}}function ht(e,d){if(1&e&&(t.j41(0,"div"),t.DNE(1,Be,1,1,"app-digitalized-view-book-page",15)(2,A,1,2,"app-digitalized-edit-book-page",16)(3,H,1,1,"app-digitalized-processing-book-page",17),t.k0s()),2&e){const s=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf","none"==s.currentStatus),t.R7$(),t.Y8G("ngIf","show_edit_form"==s.currentStatus),t.R7$(),t.Y8G("ngIf","calling_ocr_api"==s.currentStatus)}}function Te(e,d){if(1&e&&(t.qex(0),t.DNE(1,ht,4,3,"div",14),t.bVm()),2&e){const s=d.$implicit;t.R7$(),t.Y8G("ngIf",s.isShow)}}function Ut(e,d){if(1&e){const s=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"button",7),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.digitalizedAll())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"button",7),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.runDigitalizedCurrentPage())}),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.exportData("html"))}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",8),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.exportData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s(),t.j41(14,"button",8),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.exportData("txt"))}),t.EFF(15),t.nI1(16,"mytranslate"),t.k0s()(),t.j41(17,"div",9),t.DNE(18,Te,2,1,"ng-container",10),t.k0s(),t.j41(19,"div",11)(20,"div",12)(21,"azt-paging",13),t.bIt("goToPaginationPage",function(a){t.eBV(s);const l=t.XpG(2);return t.Njj(l.goToPage(a))}),t.k0s()()()()}if(2&e){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,10,"lang_cms_admin_digitalized_digitalized_all")," (",s.bookObj.totalDone," / ",s.bookObj.totalPage,")"),t.R7$(3),t.Lme("",t.bMT(7,12,"lang_cms_admin_digitalized_digitalized_current_page")," (",s.totalCurrentItems,")"),t.R7$(3),t.JRh(t.bMT(10,14,"lang_cms_admin_digitalized_digitalized_export_html")),t.R7$(3),t.JRh(t.bMT(13,16,"lang_cms_admin_digitalized_digitalized_export_docx")),t.R7$(3),t.JRh(t.bMT(16,18,"lang_cms_admin_digitalized_digitalized_export_txt")),t.R7$(3),t.Y8G("ngForOf",s.objs),t.R7$(3),t.Y8G("pageObj",s.pageObj)}}function Vt(e,d){if(1&e&&t.DNE(0,Ut,22,20,"div",4),2&e){const s=t.XpG();t.Y8G("ngIf",s.bookObj)}}let Ct=(()=>{var e;class d extends W.H{digitalizedAll(){this.digitalizedObjs(this.objs.filter(o=>"none"==o.currentStatus&&1!=o.isOrc))}runDigitalizedCurrentPage(){this.digitalizedObjs(this.objs.filter(o=>o.isShow&&"none"==o.currentStatus&&1!=o.isOrc))}reDigitalizedOneObj(o){this.digitalizedObjs([o])}digitalizedObjs(o){this.showSuccessSnack(this.commonService.myTranslateInstant("lang_cms_admin_digitalized_for_total_object")+": "+o.length);let a=o.map(h=>h.id);this.objs.forEach(h=>!!a.includes(h.id)&&Object.assign(h,{...h,currentStatus:"calling_ocr_api"}));let l=[];o.forEach(h=>l.push(this.runDigitalizeOneImage(h))),this.waitDestroy(this.sAztConcurrencyApiService.processObservables(1,l,!1).subscribe(h=>{}))}runDigitalizeOneImage(o){return this.sAztDigitalizeService.digitalizeOneImage(o.imageLink,a=>{console.log(`Digitalized for: Id: ${o.id} | Link: ${o.imageLink}`),this.objs.forEach(l=>l.id==o.id&&Object.assign(l,{...l,logMessage:a}))},a=>{console.log(`Digitalized error: Id: ${o.id} | Link: ${o.imageLink} | message: ${a}`),this.objs.forEach(l=>l.id==o.id&&Object.assign(l,{...l,logMessage:a,currentStatus:"none"}))},a=>{this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookId,o.id,a.htmlResult,a.originOcrData,(l,h)=>{if(!l)return console.log(`Digitalized error: Id: ${o.id} | Link: ${o.imageLink} | message: ${h}`),void this.objs.forEach(m=>m.id==o.id&&Object.assign(m,{...m,logMessage:h,currentStatus:"none"}));this.objs.forEach(m=>m.id==o.id&&Object.assign(m,{...m,logMessage:"",currentStatus:"show_edit_form",ocrContent:a.htmlResult,originOcrContent:a.originOcrData,isOrc:1})),this.bookObj.totalDone=this.objs.filter(m=>m.isOrc).length,console.log(`Digitalized success: Id: ${o.id} | Link: ${o.imageLink}`)})})}saveAllContent(){this.initStatusObj();let o=this.objs.filter(l=>1==l.isOrc).map(l=>({bookPageId:l.id,ocrContent:l.htmlContentFormControl.value}));this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrObjsPost({bookId:this.bookId,objs:o}).subscribe(l=>{if(!l.success)return this.errorStatusObj(l.message,!0);this.objs.forEach(h=>{let m=o.find(u=>u.bookPageId==h.id);m&&(h.ocrContent=m.ocrContent)}),this.successStatusObj("lang_cms_update_success",!0)}))}changeBookPageStatus(o){this.objs.forEach(a=>a.id==o.id&&Object.assign(a,{...o}))}exportData(o){let a=new Date;if("txt"==o){let u="";this.objs.forEach(I=>u+=I.originOcrContent+"\n");let C=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.txt`;const v=new Blob([u],{type:"text/plain"});return void(v&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(v),C))}let l="";if(this.objs.forEach(u=>l+=`<page [page]='${u.currentPage}'/>`+(u.ocrContent??"")),l=this.commonService.decodeHtmlEntities(l),"html"==o){l=this.commonService.convertMathTagToLatex(l),l+=(0,$.A3)("PHNjcmlwdD4KCWZ1bmN0aW9uIGdldFNlbGVjdGlvbkh0bWwoKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCA8PSAwKSByZXR1cm4gJyc7CgoJCXZhciByYW5nZSA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApOwoJCXZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQocmFuZ2UuY2xvbmVDb250ZW50cygpKTsKCQlyZXR1cm4gY29udGFpbmVyLmlubmVySFRNTDsKCX0KCWZ1bmN0aW9uIHNob3dTbmFjayhpc1N1Y2Nlc3MsIG1lc3NhZ2UpIHsKCQkvLyBTdGVwIDE6IENyZWF0ZSB0aGUgc25hY2sgZWxlbWVudAoJCXZhciBzbmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXNuYWNrLnRleHRDb250ZW50ID0gbWVzc2FnZTsKCgkJLy8gU3RlcCAyOiBTdHlsZSB0aGUgc25hY2sgZm9yIHRvcCBsZWZ0IGNlbnRlciBwb3NpdGlvbmluZwoJCXNuYWNrLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQlzbmFjay5zdHlsZS50b3AgPSAnMjBweCc7CgkJc25hY2suc3R5bGUubGVmdCA9ICc1MCUnOwoJCXNuYWNrLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKC01MCUpJzsgLy8gQ2VudGVyIGhvcml6b250YWxseQoJCXNuYWNrLnN0eWxlLndpZHRoID0gJzQwMHB4JzsKCQlzbmFjay5zdHlsZS5wYWRkaW5nID0gJzEwcHggMjBweCc7CgkJc25hY2suc3R5bGUuYmFja2dyb3VuZENvbG9yID0gaXNTdWNjZXNzID8gJyM0Q0FGNTAnIDogJ3JlZCc7IC8vIEdyZWVuIGJhY2tncm91bmQgZm9yIHN1Y2Nlc3MKCQlzbmFjay5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CgkJc25hY2suc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CgkJc25hY2suc3R5bGUuYm94U2hhZG93ID0gJzBweCAwcHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSknOwoJCXNuYWNrLnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gRW5zdXJlIGl0J3Mgb24gdG9wIG9mIG90aGVyIGVsZW1lbnRzCgkJc25hY2suc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7IC8vIENlbnRlciB0ZXh0IGhvcml6b250YWxseQoKCQkvLyBTdGVwIDM6IEFwcGVuZCB0aGUgc25hY2sgdG8gdGhlIGJvZHkKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNuYWNrKTsKCgkJLy8gU3RlcCA0OiBSZW1vdmUgdGhlIHNuYWNrIGFmdGVyIDYgc2Vjb25kcwoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCXNuYWNrLnJlbW92ZSgpOwoJCX0sIDEwMDApOyAvLyAxMDAwIG1pbGxpc2Vjb25kcyA9IDEgc2Vjb25kcwoJfQoJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5yYW5nZUNvdW50IDw9IDApIHJldHVybjsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oKSB7CgkJCXZhciBodG1sU291cmNlID0gZ2V0U2VsZWN0aW9uSHRtbCgpOwoJCQlpZiAoIWh0bWxTb3VyY2UpIHJldHVybjsKCgkJCW5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGh0bWxTb3VyY2UpLnRoZW4oZnVuY3Rpb24oKSB7CgkJCQlzaG93U25hY2sodHJ1ZSwgJ0NvcHkgdGjDoG5oIGPDtG5nIScpOwoJCQl9KS5jYXRjaChmdW5jdGlvbihlcnIpIHsKCQkJCXNob3dTbmFjayhmYWxzZSwgJ0NvcHkgbOG7l2k6ICcgKyBlcnIpOwoJCQl9KTsKCQl9LCB7CgkJCW9uY2U6IHRydWUKCQl9KTsKCX0pOwo8L3NjcmlwdD4=");let C=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.html`;const v=new Blob([l],{type:"text/plain"});return void(v&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(v),C))}let h=this.userService.getUserObj(),m=k.c.azt_ai_base_api;this.commonService.loadAzotaDocxJs().then(()=>{(0,Tt.w)().textToDocxBinary(l,"Bearer "+h.rememberToken,m,null).then(u=>{let C=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.docx`;const v=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});v&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(v),C)}).catch(u=>{this.showErrorSnack(u)})}).catch(u=>{this.showErrorSnack(u)})}goToPage(o){this.myNavigation(`/azota-digitalized/digitalized-one-book/${this.bookId}/${o}`),this.pageObj.setTotalPages(this.objs.length),this.pageObj.setPageNumber(o);let a=this.pageObj.getViewObjsOfCurrentPage(this.objs).map(l=>l.id);this.objs.forEach(l=>l.isShow=!!a.includes(l.id)),this.totalCurrentItems=this.objs.filter(l=>l.isShow).length}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageGetObjsGet(this.bookId).subscribe(o=>{if(!o.success||!o.data)return this.errorStatusObj(o.message,!0);this.bookObj=o.data.bookObj,this.objs=o.data.bookPageObjs.map((a,l)=>({...a,isShow:!1,currentPage:l+1,ocrContent:a.ocrContent?this.sAztZipDataService.decodeContentGzip(a.ocrContent):void 0,originOcrContent:a.originOcrContent?this.sAztZipDataService.decodeContentGzip(a.originOcrContent):void 0,logMessage:a.isOrc?void 0:"lang_cms_admin_digitalized_not_call_ocr_status",currentStatus:a.isOrc?"show_edit_form":"none",base64Images:[],htmlContentFormControl:new b.MJ("",{nonNullable:!0})}))??[],this.goToPage(Number(this.commonService.getMyParam(this.activeRoute,"page")??0)),this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_digitalized_one_book_title",description:"lang_cms_admin_digitalized_one_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.initData()}constructor(o,a,l,h,m,u){super(),this.digitalizedBookPageService=o,this.activeRoute=a,this.sAztZipDataService=l,this.sAztDigitalizeService=h,this.sAztConcurrencyApiService=m,this.userService=u,this.objs=[],this.bookId=0,this.backTo="/azota-digitalized/list-books",this.pageObj=new jt.d(10),this.totalCurrentItems=0}}return(e=d).\u0275fac=function(o){return new(o||e)(t.rXU(Q.gI),t.rXU(T.nX),t.rXU(re.j),t.rXU(It),t.rXU(ot),t.rXU(Ae.R))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-digitalized-one-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:3,consts:[["doneLoading",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],["class","mt-5",4,"ngIf"],[1,"mt-5"],[1,"flex","items-center","mb-3","pb-3",2,"border-bottom","1px solid #ccc"],[1,"btn","btn-primary","mr-3",3,"click"],[1,"btn","btn-success","mr-3",3,"click"],[1,"box"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","flex-wrap","sm:flex-row","sm:flex-nowrap","items-center","mt-3"],[1,"w-full","sm:w-auto","sm:mr-auto"],[3,"goToPaginationPage","pageObj"],[4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent",4,"ngIf"],[3,"obj",4,"ngIf"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","obj"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent","bookObj","obj"],[3,"obj"]],template:function(o,a){if(1&o&&(t.j41(0,"teacher-layout",1),t.DNE(1,q,1,1,"azt-loading-effect",2)(2,Vt,1,1,"ng-template",null,0,t.C5r),t.k0s()),2&o){const l=t.sdS(3);t.Y8G("headerBackToLink",a.backTo),t.R7$(),t.Y8G("ngIf",a.statusObj.loading)("ngIfElse",l)}},dependencies:[lt.Q,ft.K,xe,ae,ye,y.q,z.MD,z.Sq,z.bT,b.X1,T.iI,b.YN,O.wp,V.s,j.flO,M.L,U.Id,Y.k],encapsulation:2}),d})();class je{static validBookPage(d){const s=d;return s.controls.filter(a=>a.controls.isShow.value).length>0?(d.setErrors(null),null):(s.setErrors({validBookPage:!0}),{identityRevealed:!0})}}var ce=_(77932);let Yt=(()=>{var e;class d extends W.H{removeBackgroundNoise(o){this.initStatusObj();let l=this.form.controls.bookPageFormArray.getRawValue().filter(h=>(!!o||h.isSelected)&&h.isShow).map(h=>this.sAztDigitalizeService.runRemoveBackgroundNoise({uuid:h.randomUuid,oldImageUrl:h.imageLink,newImageUrl:""},this.defaultThreshold,m=>console.log("Remove noise error",m)));this.waitDestroy(this.sAztConcurrencyApiService.processObservables(20,l,!1).subscribe(h=>{let m=this.form.controls.bookPageFormArray.getRawValue();m.forEach(u=>{let C=h.find(v=>v?.uuid==v?.uuid)?.newImageUrl;C&&(u.imageLink=C,u.needUpdate=!0)}),this.form.controls.bookPageFormArray.patchValue(m),this.stopStatusObj()}))}selectAll(o){this.form.controls.bookPageFormArray.controls.map(a=>a.controls.isSelected.setValue(o))}deleteAllSelected(){this.form.controls.bookPageFormArray.controls.forEach(o=>{o.controls.isSelected.value&&o.controls.isShow.setValue(!1)})}countSelected(){this.totalPage=this.form.controls.bookPageFormArray.getRawValue().filter(o=>o.isShow).length,this.totalSelectedPage=this.form.controls.bookPageFormArray.getRawValue().filter(o=>o.isShow&&o.isSelected).length}cancel(){this.commonService.myNavigation(this.backTo)}handleUploadComplete(o){o.forEach(a=>{a.url&&this.form.controls.bookPageFormArray.push(new b.gE({id:new b.MJ(0,{nonNullable:!0}),randomUuid:new b.MJ(this.sAztUuidService.getUuid(),{nonNullable:!0}),name:new b.MJ(a.name??"",{nonNullable:!0}),imageLink:new b.MJ(a.url,{nonNullable:!0}),isShow:new b.MJ(!0,{nonNullable:!0}),isSelected:new b.MJ(!1,{nonNullable:!0}),needUpdate:new b.MJ(!1,{nonNullable:!0})}))}),this.form.controls.bookPageFormArray.updateValueAndValidity()}removeBookPageObj(o){let a=this.form.controls.bookPageFormArray.controls.find(l=>l.controls.randomUuid.value==o);a?.controls.isShow.setValue(!1),this.form.controls.bookPageFormArray.updateValueAndValidity()}constructor(){super(),this.sAztUuidService=(0,t.WQX)(R.D),this.sAztDigitalizeService=(0,t.WQX)(It),this.sAztConcurrencyApiService=(0,t.WQX)(ot),this.backTo="",this.allUploadToCdnMenuTypes=xt.b8,this.allUploadFileTypes=xt.PO,this.totalSelectedPage=0,this.totalPage=0,this.defaultThreshold=230,this.form=new b.gE({name:new b.MJ("",{nonNullable:!0,validators:[ce.M.noWhiteSpace]}),bookPageFormArray:new b.Yp([],{validators:[je.validBookPage]})}),this.form.valueChanges.subscribe(o=>this.countSelected())}}return(e=d).\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["app-base-create-or-update-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:0,vars:0,template:function(o,a){},dependencies:[z.MD,b.X1,T.iI,b.YN,V.s,j.flO,M.L,U.Id,Y.k],encapsulation:2}),d})();var P=_(29511),G=_(98209),mt=_(36274);const de=e=>({"error-border":e}),Lt=(e,d)=>[e,d];function Se(e,d){if(1&e&&t.nrm(0,"azt-loading-effect",4),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function pe(e,d){if(1&e){const s=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(a){t.eBV(s);const l=t.XpG(2);return t.Njj(l.handleUploadComplete(a))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&e){const s=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",s.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,Lt,s.allUploadFileTypes.IMAGE,s.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function ge(e,d){if(1&e){const s=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&e){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",s.totalSelectedPage,"/",s.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",s.totalSelectedPage,"/",s.totalPage,")")}}function kt(e,d){1&e&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function Ee(e,d){if(1&e&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&e){const s=d.$implicit,o=d.index;t.R7$(),t.Y8G("hidden",!s.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",s.controls.imageLink.value),t.R7$(),t.Y8G("src",s.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(o+1),t.R7$(),t.Y8G("formControl",s.controls.isSelected)}}function Bt(e,d){if(1&e&&(t.j41(0,"div",31),t.DNE(1,Ee,8,5,"ng-container",32),t.k0s()),2&e){const s=t.XpG(2);t.R7$(),t.Y8G("ngForOf",s.form.controls.bookPageFormArray.controls)}}function Re(e,d){if(1&e){const s=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,pe,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.selectAll(a.totalSelectedPage!=a.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,ge,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,kt,3,3,"div",25)(34,Bt,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&e){const s=t.sdS(35),o=t.XpG();t.R7$(),t.Y8G("formGroup",o.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,o.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",o.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",o.form.controls.name)("ngClass",t.eq3(35,de,o.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!o.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,o.totalSelectedPage!=o.totalPage?"lang_select_all":"lang_remove_all")," (",o.totalSelectedPage,"/",o.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",o.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",o.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",s),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",o.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let tt=(()=>{var e;class d extends Yt{initForm(){}initData(){}saveObj(){this.initStatusObj();let o=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookAddObjPost({name:o.name}).subscribe(l=>{if(!l.success||!l.data?.obj)return this.errorStatusObj(l.message,!0);let h={bookId:l.data.obj.id,bookPageObjs:[]};o.bookPageFormArray.filter(m=>m.isShow).forEach(m=>{h.bookPageObjs.push({name:m.name,imageLink:m.imageLink})}),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageAddObjsPost(h).subscribe(m=>{if(!m.success)return this.errorStatusObj(m.message,!0);this.successStatusObj("lang_cms_add_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_create_book_title",description:"lang_cms_admin_create_book_title",image:"lang_cms_test_image"}),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(o,a){super(),this.digitalizedBookService=o,this.digitalizedBookPageService=a,this.bookId=0}}return(e=d).\u0275fac=function(o){return new(o||e)(t.rXU(G.Z),t.rXU(mt.g))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-create-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(o,a){if(1&o&&(t.j41(0,"teacher-layout",2),t.DNE(1,Se,1,1,"azt-loading-effect",3)(2,Re,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&o){const l=t.sdS(3);t.Y8G("headerBackToLink",a.backTo),t.R7$(),t.Y8G("ngIf",1==a.statusObj.loading)("ngIfElse",l)}},dependencies:[lt.Q,ft.K,P.V,At,z.MD,z.YU,z.Sq,z.bT,b.X1,b.qT,b.me,b.Zm,b.BC,b.cb,b.l_,b.j4,T.iI,b.YN,O.wp,V.s,j.flO,j.WGl,M.L,U.Id,Y.k],encapsulation:2}),d})();const Me=e=>({"error-border":e}),Ne=(e,d)=>[e,d];function he(e,d){if(1&e&&t.nrm(0,"azt-loading-effect",4),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function Pe(e,d){if(1&e){const s=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(a){t.eBV(s);const l=t.XpG(2);return t.Njj(l.handleUploadComplete(a))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&e){const s=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",s.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,Ne,s.allUploadFileTypes.IMAGE,s.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Ge(e,d){if(1&e){const s=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&e){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",s.totalSelectedPage,"/",s.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",s.totalSelectedPage,"/",s.totalPage,")")}}function Fe(e,d){1&e&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function Ue(e,d){if(1&e&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&e){const s=d.$implicit,o=d.index;t.R7$(),t.Y8G("hidden",!s.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",s.controls.imageLink.value),t.R7$(),t.Y8G("src",s.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(o+1),t.R7$(),t.Y8G("formControl",s.controls.isSelected)}}function Ve(e,d){if(1&e&&(t.j41(0,"div",31),t.DNE(1,Ue,8,5,"ng-container",32),t.k0s()),2&e){const s=t.XpG(2);t.R7$(),t.Y8G("ngForOf",s.form.controls.bookPageFormArray.controls)}}function Ye(e,d){if(1&e){const s=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,Pe,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.selectAll(a.totalSelectedPage!=a.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,Ge,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,Fe,3,3,"div",25)(34,Ve,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&e){const s=t.sdS(35),o=t.XpG();t.R7$(),t.Y8G("formGroup",o.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,o.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",o.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",o.form.controls.name)("ngClass",t.eq3(35,Me,o.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!o.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,o.totalSelectedPage!=o.totalPage?"lang_select_all":"lang_remove_all")," (",o.totalSelectedPage,"/",o.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",o.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",o.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",s),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",o.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let Le=(()=>{var e;class d extends Yt{initForm(o){this.form.controls.name.setValue(o.bookObj.name),o.bookPageObjs.forEach(a=>{this.form.controls.bookPageFormArray.push(new b.gE({id:new b.MJ(a.id,{nonNullable:!0}),randomUuid:new b.MJ(a.id.toString(),{nonNullable:!0}),name:new b.MJ(a.name,{nonNullable:!0}),imageLink:new b.MJ(a.imageLink,{nonNullable:!0}),isShow:new b.MJ(!0,{nonNullable:!0}),isSelected:new b.MJ(!1,{nonNullable:!0}),needUpdate:new b.MJ(!1,{nonNullable:!0})}))})}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjGet(this.bookId).subscribe(o=>{if(!o.success||!o.data)return this.errorStatusObj(o.message,!0);this.initForm(o.data),this.stopStatusObj()}))}saveObj(){this.initStatusObj();let o=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookUpdateObjPost({id:this.bookId,name:o.name}).subscribe(l=>{if(!l.success)return this.errorStatusObj(l.message,!0);let h={bookId:this.bookId,objs:o.bookPageFormArray.filter(u=>u.needUpdate&&u.id).map(u=>({bookPageId:u.id,imageLink:u.imageLink}))},m={bookId:this.bookId,ids:o.bookPageFormArray.filter(u=>!u.isShow&&u.id).map(u=>u.id)};if(h.objs.length<=0)return this.processDeleteImages(m);this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateImagesPost(h).subscribe(u=>{this.processDeleteImages(m)}))}))}processDeleteImages(o){o.ids.length>0?this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageDeleteObjPost(o).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);this.successStatusObj("lang_cms_update_success",!0),this.cancel()})):(this.successStatusObj("lang_cms_update_success",!0),this.cancel())}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_edit_book_title",description:"lang_cms_admin_edit_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(o,a,l){super(),this.digitalizedBookService=o,this.digitalizedBookPageService=a,this.activeRoute=l,this.bookId=0}}return(e=d).\u0275fac=function(o){return new(o||e)(t.rXU(Q.ZD),t.rXU(Q.gI),t.rXU(T.nX))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-update-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(o,a){if(1&o&&(t.j41(0,"teacher-layout",2),t.DNE(1,he,1,1,"azt-loading-effect",3)(2,Ye,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&o){const l=t.sdS(3);t.Y8G("headerBackToLink",a.backTo),t.R7$(),t.Y8G("ngIf",1==a.statusObj.loading)("ngIfElse",l)}},dependencies:[lt.Q,ft.K,P.V,At,z.MD,z.YU,z.Sq,z.bT,b.X1,b.qT,b.me,b.Zm,b.BC,b.cb,b.l_,b.j4,T.iI,b.YN,O.wp,V.s,j.flO,j.WGl,M.L,U.Id,Y.k],encapsulation:2}),d})();var Xe=_(57988),me=_(25596);const $e=e=>[e],Xt=()=>({"mr-1":!0});function We(e,d){if(1&e&&t.nrm(0,"azt-loading-effect",5),2&e){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function Je(e,d){1&e&&(t.j41(0,"span",25),t.nrm(1,"azt-loading-ui"),t.k0s())}function ue(e,d){if(1&e){const s=t.RV6();t.qex(0),t.j41(1,"mat-card",13)(2,"mat-card-content",14)(3,"div",15)(4,"div",7)(5,"b"),t.EFF(6),t.k0s(),t.EFF(7),t.k0s(),t.j41(8,"div",16)(9,"button",17),t.nI1(10,"navigationLocalize"),t.nrm(11,"lucide-icon",18),t.j41(12,"span",19),t.EFF(13),t.nI1(14,"mytranslate"),t.k0s()(),t.j41(15,"a",20),t.nI1(16,"navigationLocalize"),t.nrm(17,"lucide-icon",21),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s(),t.j41(20,"button",22),t.bIt("click",function(){const a=t.eBV(s).$implicit,l=t.XpG(3);return t.Njj(l.deleteObj(a))}),t.DNE(21,Je,2,0,"span",23),t.nrm(22,"lucide-icon",24),t.j41(23,"span",19),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()()()(),t.bVm()}if(2&e){const s=d.$implicit,o=d.index,a=t.XpG(3);t.R7$(6),t.SpI("",o+1,"."),t.R7$(),t.E5c(" ",s.name," (",s.totalDone," / ",s.totalPage,") "),t.R7$(2),t.Y8G("routerLink",t.bMT(10,13,"/azota-digitalized/digitalized-one-book/"+s.id+"/1")),t.R7$(2),t.Y8G("ngClass",t.lJ4(23,Xt)),t.R7$(2),t.JRh(t.bMT(14,15,"lang_cms_admin_digitalized_digitalized_btn")),t.R7$(2),t.Y8G("routerLink",t.bMT(16,17,"/azota-digitalized/edit-book/"+s.id)),t.R7$(2),t.Y8G("ngClass",t.lJ4(24,Xt)),t.R7$(),t.SpI(" ",t.bMT(19,19,"lang_auto_sua")," "),t.R7$(3),t.Y8G("ngIf",a.deletingId==s.id),t.R7$(),t.Y8G("ngClass",t.lJ4(25,Xt)),t.R7$(2),t.JRh(t.bMT(25,21,"lang_auto_xoa"))}}function c(e,d){if(1&e&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.DNE(3,ue,26,26,"ng-container",12),t.k0s()(),t.bVm()),2&e){const s=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",s.objs)}}function i(e,d){1&e&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"lang_cms_admin_digitalized_there_is_no_book")))}function r(e,d){if(1&e&&(t.j41(0,"div",6)(1,"span",7),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"a",8),t.nI1(5,"navigationLocalize"),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.DNE(8,c,4,1,"ng-container",9)(9,i,3,3,"ng-template",null,1,t.C5r)),2&e){const s=t.sdS(10),o=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"lang_cms_admin_common_digitalize_list_book")),t.R7$(2),t.Y8G("routerLink",t.eq3(11,$e,t.bMT(5,7,"/azota-digitalized/create-book"))),t.R7$(2),t.JRh(t.bMT(7,9,"lang_common_create")),t.R7$(2),t.Y8G("ngIf",o.objs.length>0)("ngIfElse",s)}}const g=[{path:"",component:be.z,children:[{path:"list-books",component:(()=>{var e;class d extends W.H{deleteObj(o){const a=this.commonService.myTranslateInstant("lang_cms_admin_digitalized_are_your_sure_to_delete_this_book")+`: <b>${o.name}<b/>?`;this.sAztDialogService.open(Xe.u,{data:{content:a},restoreFocus:!1,width:"500px"}).afterClosed().subscribe(l=>{l&&(this.deletingId=o.id,this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookDeleteObjPost({ids:[o.id]}).subscribe(h=>{if(this.deletingId=void 0,!h.success)return this.errorStatusObj(h.message,!0);this.objs=this.objs.filter(m=>m.id!=o.id)})))})}getData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjsGet().subscribe(o=>{if(!o.success)return this.errorStatusObj(o.message,!0);this.objs=o.data?.objs??[],this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.getData(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_list_book",description:"lang_cms_admin_common_digitalize_list_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(o,a){super(),this.digitalizedBookService=o,this.sAztDialogService=a,this.headerBackTo="",this.objs=[]}}return(e=d).\u0275fac=function(o){return new(o||e)(t.rXU(Q.ZD),t.rXU(vt.i))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-digitalized-list-books"]],standalone:!0,features:[t.Vt3,t.aNF],decls:5,vars:3,consts:[["doneLoading",""],["emptyList",""],[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"flex","items-center","mb-3"],[1,"w-full"],[1,"flex-none","btn","btn-primary",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],["appearance","outlined",1,"mb-2",2,"background-color","#fff","border","none"],[1,"form-control",2,"overflow-y","auto"],[1,"flex","align-items-center"],[1,"flex-none","items-center"],[1,"btn","btn-sm","btn-success-soft","mr-2",3,"routerLink"],["name","eye","size","18",3,"ngClass"],[1,"azt-hidden","md:inline-block"],[1,"btn","btn-sm","btn-primary-soft","mr-2",3,"routerLink"],["name","square-pen","size","18",3,"ngClass"],[1,"btn","btn-sm","btn-danger-soft",3,"click"],["class","w-4 h-4 flex mr-1",4,"ngIf"],["name","trash-2","size","18",3,"ngClass"],[1,"w-4","h-4","flex","mr-1"],[1,"text-center"]],template:function(o,a){if(1&o&&(t.j41(0,"teacher-layout",2)(1,"div",3),t.DNE(2,We,1,1,"azt-loading-effect",4)(3,r,11,13,"ng-template",null,0,t.C5r),t.k0s()()),2&o){const l=t.sdS(4);t.Y8G("headerBackToLink",a.headerBackTo),t.R7$(2),t.Y8G("ngIf",a.statusObj.loading)("ngIfElse",l)}},dependencies:[lt.Q,ft.K,dt.R,O.F2,z.MD,z.YU,z.Sq,z.bT,b.X1,T.iI,T.Wk,b.YN,O.wp,V.s,me.RN,me.m2,j.flO,j.WGl,M.L,U.Id,Y.k],encapsulation:2}),d})()},{path:"create-book",component:tt},{path:"edit-book/:bookId",component:Le},{path:"digitalized-one-book/:bookId/:page",component:Ct}]}];let p=(()=>{var e;class d{}return(e=d).\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[T.iI.forChild(g),T.iI,_e.XE]}),d})()},1054:function(Qe){Qe.exports=function(){"use strict";function st(c){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(c)}function T(c,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(c,n.key,n)}}function be(c,i,r){return i in c?Object.defineProperty(c,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):c[i]=r,c}function z(c,i){var r=Object.keys(c);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(c);i&&(n=n.filter(function(g){return Object.getOwnPropertyDescriptor(c,g).enumerable})),r.push.apply(r,n)}return r}function b(c){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?z(Object(r),!0).forEach(function(n){be(c,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach(function(n){Object.defineProperty(c,n,Object.getOwnPropertyDescriptor(r,n))})}return c}function j(c){return function U(c){if(Array.isArray(c))return Tt(c)}(c)||function V(c){if(typeof Symbol<"u"&&Symbol.iterator in Object(c))return Array.from(c)}(c)||function Y(c,i){if(c){if("string"==typeof c)return Tt(c,i);var r=Object.prototype.toString.call(c).slice(8,-1);if("Object"===r&&c.constructor&&(r=c.constructor.name),"Map"===r||"Set"===r)return Array.from(c);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tt(c,i)}}(c)||function O(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tt(c,i){(null==i||i>c.length)&&(i=c.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=c[r];return n}var M=typeof window<"u"&&typeof window.document<"u",$=M?window:{},W=!(!M||!$.document.documentElement)&&"ontouchstart"in $.document.documentElement,lt=!!M&&"PointerEvent"in $,y="cropper",t="move",J="e",L="w",K="n",Q="ne",_t="nw",it="se",bt="sw",Dt="".concat(y,"-crop"),$t="".concat(y,"-disabled"),R="".concat(y,"-hidden"),xt="".concat(y,"-hide"),It="".concat(y,"-invisible"),dt="".concat(y,"-modal"),vt="".concat(y,"-move"),pt="".concat(y,"Action"),Ot="".concat(y,"Preview"),Et="crop",Ht="crop",Rt="cropend",Mt="cropmove",Nt="cropstart",Zt="dblclick",Qt=lt?"pointerdown":W?"touchstart":"mousedown",Kt=lt?"pointermove":W?"touchmove":"mousemove",qt=lt?"pointerup pointercancel":W?"touchend touchcancel":"mouseup",Pt="zoom",ae="image/jpeg",ze=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,we=/^data:/,At=/^data:image\/jpeg;base64,/,ye=/^img|canvas$/i,ne={viewMode:0,dragMode:Et,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},xe=Number.isNaN||$.isNaN;function k(c){return"number"==typeof c&&!xe(c)}var re=function(i){return i>0&&i<1/0};function Ft(c){return typeof c>"u"}function at(c){return"object"===st(c)&&null!==c}var Ie=Object.prototype.hasOwnProperty;function gt(c){if(!at(c))return!1;try{var i=c.constructor,r=i.prototype;return i&&r&&Ie.call(r,"isPrototypeOf")}catch{return!1}}function N(c){return"function"==typeof c}var se=Array.prototype.slice;function le(c){return Array.from?Array.from(c):se.call(c)}function x(c,i){return c&&N(i)&&(Array.isArray(c)||k(c.length)?le(c).forEach(function(r,n){i.call(c,r,n,c)}):at(c)&&Object.keys(c).forEach(function(r){i.call(c,c[r],r,c)})),c}var D=Object.assign||function(i){for(var r=arguments.length,n=new Array(r>1?r-1:0),g=1;g<r;g++)n[g-1]=arguments[g];return at(i)&&n.length>0&&n.forEach(function(p){at(p)&&Object.keys(p).forEach(function(e){i[e]=p[e]})}),i},Oe=/\.\d*(?:0|9){12}\d*$/;function ot(c){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Oe.test(c)?Math.round(c*i)/i:c}var Ae=/^width|height|left|top|marginLeft|marginTop$/;function q(c,i){var r=c.style;x(i,function(n,g){Ae.test(g)&&k(n)&&(n="".concat(n,"px")),r[g]=n})}function A(c,i){if(i){if(k(c.length))return void x(c,function(n){A(n,i)});if(c.classList)return void c.classList.add(i);var r=c.className.trim();r?r.indexOf(i)<0&&(c.className="".concat(r," ").concat(i)):c.className=i}}function H(c,i){if(i){if(k(c.length))return void x(c,function(r){H(r,i)});if(c.classList)return void c.classList.remove(i);c.className.indexOf(i)>=0&&(c.className=c.className.replace(i,""))}}function ht(c,i,r){if(i){if(k(c.length))return void x(c,function(n){ht(n,i,r)});r?A(c,i):H(c,i)}}var Te=/([a-z\d])([A-Z])/g;function Ut(c){return c.replace(Te,"$1-$2").toLowerCase()}function Vt(c,i){return at(c[i])?c[i]:c.dataset?c.dataset[i]:c.getAttribute("data-".concat(Ut(i)))}function Ct(c,i,r){at(r)?c[i]=r:c.dataset?c.dataset[i]=r:c.setAttribute("data-".concat(Ut(i)),r)}var ce=/\s\s*/,Yt=function(){var c=!1;if(M){var i=!1,r=function(){},n=Object.defineProperty({},"once",{get:function(){return c=!0,i},set:function(p){i=p}});$.addEventListener("test",r,n),$.removeEventListener("test",r,n)}return c}();function P(c,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=r;i.trim().split(ce).forEach(function(p){if(!Yt){var e=c.listeners;e&&e[p]&&e[p][r]&&(g=e[p][r],delete e[p][r],0===Object.keys(e[p]).length&&delete e[p],0===Object.keys(e).length&&delete c.listeners)}c.removeEventListener(p,g,n)})}function G(c,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=r;i.trim().split(ce).forEach(function(p){if(n.once&&!Yt){var e=c.listeners,d=void 0===e?{}:e;g=function(){delete d[p][r],c.removeEventListener(p,g,n);for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];r.apply(c,a)},d[p]||(d[p]={}),d[p][r]&&c.removeEventListener(p,d[p][r],n),d[p][r]=g,c.listeners=d}c.addEventListener(p,g,n)})}function mt(c,i,r){var n;return N(Event)&&N(CustomEvent)?n=new CustomEvent(i,{detail:r,bubbles:!0,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(i,!0,!0,r),c.dispatchEvent(n)}function de(c){var i=c.getBoundingClientRect();return{left:i.left+(window.pageXOffset-document.documentElement.clientLeft),top:i.top+(window.pageYOffset-document.documentElement.clientTop)}}var Lt=$.location,Se=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function pe(c){var i=c.match(Se);return null!==i&&(i[1]!==Lt.protocol||i[2]!==Lt.hostname||i[3]!==Lt.port)}function ge(c){var i="timestamp=".concat((new Date).getTime());return c+(-1===c.indexOf("?")?"?":"&")+i}function kt(c){var i=c.rotate,r=c.scaleX,n=c.scaleY,g=c.translateX,p=c.translateY,e=[];k(g)&&0!==g&&e.push("translateX(".concat(g,"px)")),k(p)&&0!==p&&e.push("translateY(".concat(p,"px)")),k(i)&&0!==i&&e.push("rotate(".concat(i,"deg)")),k(r)&&1!==r&&e.push("scaleX(".concat(r,")")),k(n)&&1!==n&&e.push("scaleY(".concat(n,")"));var d=e.length?e.join(" "):"none";return{WebkitTransform:d,msTransform:d,transform:d}}function Bt(c,i){var r=c.pageX,n=c.pageY,g={endX:r,endY:n};return i?g:b({startX:r,startY:n},g)}function tt(c){var i=c.aspectRatio,r=c.height,n=c.width,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",p=re(n),e=re(r);if(p&&e){var d=r*i;"contain"===g&&d>n||"cover"===g&&d<n?r=n/i:n=r*i}else p?r=n/i:e&&(n=r*i);return{width:n,height:r}}var he=String.fromCharCode;var Ge=/^data:.*,/;function Ve(c){var r,i=new DataView(c);try{var n,g,p;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var e=i.byteLength,d=2;d+1<e;){if(255===i.getUint8(d)&&225===i.getUint8(d+1)){g=d;break}d+=1}if(g){var o=g+10;if("Exif"===function Pe(c,i,r){var n="";r+=i;for(var g=i;g<r;g+=1)n+=he(c.getUint8(g));return n}(i,g+4,4)){var a=i.getUint16(o);if(((n=18761===a)||19789===a)&&42===i.getUint16(o+2,n)){var l=i.getUint32(o+4,n);l>=8&&(p=o+l)}}}if(p){var m,u,h=i.getUint16(p,n);for(u=0;u<h;u+=1)if(274===i.getUint16(m=p+12*u+2,n)){r=i.getUint16(m+=8,n),i.setUint16(m,1,n);break}}}catch{r=1}return r}var Le={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var i=this.element,r=this.options,n=this.container,g=this.cropper,p=Number(r.minContainerWidth),e=Number(r.minContainerHeight);A(g,R),H(i,R);var d={width:Math.max(n.offsetWidth,p>=0?p:200),height:Math.max(n.offsetHeight,e>=0?e:100)};this.containerData=d,q(g,{width:d.width,height:d.height}),A(i,R),H(g,R)},initCanvas:function(){var i=this.containerData,r=this.imageData,n=this.options.viewMode,g=Math.abs(r.rotate)%180==90,p=g?r.naturalHeight:r.naturalWidth,e=g?r.naturalWidth:r.naturalHeight,d=p/e,s=i.width,o=i.height;i.height*d>i.width?3===n?s=i.height*d:o=i.width/d:3===n?o=i.width/d:s=i.height*d;var a={aspectRatio:d,naturalWidth:p,naturalHeight:e,width:s,height:o};this.canvasData=a,this.limited=1===n||2===n,this.limitCanvas(!0,!0),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),a.left=(i.width-a.width)/2,a.top=(i.height-a.height)/2,a.oldLeft=a.left,a.oldTop=a.top,this.initialCanvasData=D({},a)},limitCanvas:function(i,r){var n=this.options,g=this.containerData,p=this.canvasData,e=this.cropBoxData,d=n.viewMode,s=p.aspectRatio,o=this.cropped&&e;if(i){var a=Number(n.minCanvasWidth)||0,l=Number(n.minCanvasHeight)||0;d>1?(a=Math.max(a,g.width),l=Math.max(l,g.height),3===d&&(l*s>a?a=l*s:l=a/s)):d>0&&(a?a=Math.max(a,o?e.width:0):l?l=Math.max(l,o?e.height:0):o&&((l=e.height)*s>(a=e.width)?a=l*s:l=a/s));var h=tt({aspectRatio:s,width:a,height:l});l=h.height,p.minWidth=a=h.width,p.minHeight=l,p.maxWidth=1/0,p.maxHeight=1/0}if(r)if(d>(o?0:1)){var m=g.width-p.width,u=g.height-p.height;p.minLeft=Math.min(0,m),p.minTop=Math.min(0,u),p.maxLeft=Math.max(0,m),p.maxTop=Math.max(0,u),o&&this.limited&&(p.minLeft=Math.min(e.left,e.left+(e.width-p.width)),p.minTop=Math.min(e.top,e.top+(e.height-p.height)),p.maxLeft=e.left,p.maxTop=e.top,2===d&&(p.width>=g.width&&(p.minLeft=Math.min(0,m),p.maxLeft=Math.max(0,m)),p.height>=g.height&&(p.minTop=Math.min(0,u),p.maxTop=Math.max(0,u))))}else p.minLeft=-p.width,p.minTop=-p.height,p.maxLeft=g.width,p.maxTop=g.height},renderCanvas:function(i,r){var n=this.canvasData,g=this.imageData;if(r){var p=function Me(c){var i=c.width,r=c.height,n=c.degree;if(90==(n=Math.abs(n)%180))return{width:r,height:i};var g=n%90*Math.PI/180,p=Math.sin(g),e=Math.cos(g),d=i*e+r*p,s=i*p+r*e;return n>90?{width:s,height:d}:{width:d,height:s}}({width:g.naturalWidth*Math.abs(g.scaleX||1),height:g.naturalHeight*Math.abs(g.scaleY||1),degree:g.rotate||0}),e=p.width,d=p.height,s=n.width*(e/n.naturalWidth),o=n.height*(d/n.naturalHeight);n.left-=(s-n.width)/2,n.top-=(o-n.height)/2,n.width=s,n.height=o,n.aspectRatio=e/d,n.naturalWidth=e,n.naturalHeight=d,this.limitCanvas(!0,!1)}(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),this.limitCanvas(!1,!0),n.left=Math.min(Math.max(n.left,n.minLeft),n.maxLeft),n.top=Math.min(Math.max(n.top,n.minTop),n.maxTop),n.oldLeft=n.left,n.oldTop=n.top,q(this.canvas,D({width:n.width,height:n.height},kt({translateX:n.left,translateY:n.top}))),this.renderImage(i),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(i){var r=this.canvasData,n=this.imageData,g=n.naturalWidth*(r.width/r.naturalWidth),p=n.naturalHeight*(r.height/r.naturalHeight);D(n,{width:g,height:p,left:(r.width-g)/2,top:(r.height-p)/2}),q(this.image,D({width:n.width,height:n.height},kt(D({translateX:n.left,translateY:n.top},n)))),i&&this.output()},initCropBox:function(){var i=this.options,r=this.canvasData,n=i.aspectRatio||i.initialAspectRatio,g=Number(i.autoCropArea)||.8,p={width:r.width,height:r.height};n&&(r.height*n>r.width?p.height=p.width/n:p.width=p.height*n),this.cropBoxData=p,this.limitCropBox(!0,!0),p.width=Math.min(Math.max(p.width,p.minWidth),p.maxWidth),p.height=Math.min(Math.max(p.height,p.minHeight),p.maxHeight),p.width=Math.max(p.minWidth,p.width*g),p.height=Math.max(p.minHeight,p.height*g),p.left=r.left+(r.width-p.width)/2,p.top=r.top+(r.height-p.height)/2,p.oldLeft=p.left,p.oldTop=p.top,this.initialCropBoxData=D({},p)},limitCropBox:function(i,r){var n=this.options,g=this.containerData,p=this.canvasData,e=this.cropBoxData,d=this.limited,s=n.aspectRatio;if(i){var o=Number(n.minCropBoxWidth)||0,a=Number(n.minCropBoxHeight)||0,l=d?Math.min(g.width,p.width,p.width+p.left,g.width-p.left):g.width,h=d?Math.min(g.height,p.height,p.height+p.top,g.height-p.top):g.height;o=Math.min(o,g.width),a=Math.min(a,g.height),s&&(o&&a?a*s>o?a=o/s:o=a*s:o?a=o/s:a&&(o=a*s),h*s>l?h=l/s:l=h*s),e.minWidth=Math.min(o,l),e.minHeight=Math.min(a,h),e.maxWidth=l,e.maxHeight=h}r&&(d?(e.minLeft=Math.max(0,p.left),e.minTop=Math.max(0,p.top),e.maxLeft=Math.min(g.width,p.left+p.width)-e.width,e.maxTop=Math.min(g.height,p.top+p.height)-e.height):(e.minLeft=0,e.minTop=0,e.maxLeft=g.width-e.width,e.maxTop=g.height-e.height))},renderCropBox:function(){var i=this.options,r=this.containerData,n=this.cropBoxData;(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),this.limitCropBox(!1,!0),n.left=Math.min(Math.max(n.left,n.minLeft),n.maxLeft),n.top=Math.min(Math.max(n.top,n.minTop),n.maxTop),n.oldLeft=n.left,n.oldTop=n.top,i.movable&&i.cropBoxMovable&&Ct(this.face,pt,n.width>=r.width&&n.height>=r.height?t:"all"),q(this.cropBox,D({width:n.width,height:n.height},kt({translateX:n.left,translateY:n.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),mt(this.element,Ht,this.getData())}},Xe={initPreview:function(){var i=this.element,r=this.crossOrigin,n=this.options.preview,g=r?this.crossOriginUrl:this.url,p=i.alt||"The image to preview",e=document.createElement("img");if(r&&(e.crossOrigin=r),e.src=g,e.alt=p,this.viewBox.appendChild(e),this.viewBoxImage=e,n){var d=n;"string"==typeof n?d=i.ownerDocument.querySelectorAll(n):n.querySelector&&(d=[n]),this.previews=d,x(d,function(s){var o=document.createElement("img");Ct(s,Ot,{width:s.offsetWidth,height:s.offsetHeight,html:s.innerHTML}),r&&(o.crossOrigin=r),o.src=g,o.alt=p,o.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',s.innerHTML="",s.appendChild(o)})}},resetPreview:function(){x(this.previews,function(i){var r=Vt(i,Ot);q(i,{width:r.width,height:r.height}),i.innerHTML=r.html,function je(c,i){if(at(c[i]))try{delete c[i]}catch{c[i]=void 0}else if(c.dataset)try{delete c.dataset[i]}catch{c.dataset[i]=void 0}else c.removeAttribute("data-".concat(Ut(i)))}(i,Ot)})},preview:function(){var i=this.imageData,r=this.canvasData,n=this.cropBoxData,g=n.width,p=n.height,e=i.width,d=i.height,s=n.left-r.left-i.left,o=n.top-r.top-i.top;!this.cropped||this.disabled||(q(this.viewBoxImage,D({width:e,height:d},kt(D({translateX:-s,translateY:-o},i)))),x(this.previews,function(a){var l=Vt(a,Ot),h=l.width,m=l.height,u=h,C=m,v=1;g&&(C=p*(v=h/g)),p&&C>m&&(u=g*(v=m/p),C=m),q(a,{width:u,height:C}),q(a.getElementsByTagName("img")[0],D({width:e*v,height:d*v},kt(D({translateX:-s*v,translateY:-o*v},i))))}))}},me={bind:function(){var i=this.element,r=this.options,n=this.cropper;N(r.cropstart)&&G(i,Nt,r.cropstart),N(r.cropmove)&&G(i,Mt,r.cropmove),N(r.cropend)&&G(i,Rt,r.cropend),N(r.crop)&&G(i,Ht,r.crop),N(r.zoom)&&G(i,Pt,r.zoom),G(n,Qt,this.onCropStart=this.cropStart.bind(this)),r.zoomable&&r.zoomOnWheel&&G(n,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),r.toggleDragModeOnDblclick&&G(n,Zt,this.onDblclick=this.dblclick.bind(this)),G(i.ownerDocument,Kt,this.onCropMove=this.cropMove.bind(this)),G(i.ownerDocument,qt,this.onCropEnd=this.cropEnd.bind(this)),r.responsive&&G(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var i=this.element,r=this.options,n=this.cropper;N(r.cropstart)&&P(i,Nt,r.cropstart),N(r.cropmove)&&P(i,Mt,r.cropmove),N(r.cropend)&&P(i,Rt,r.cropend),N(r.crop)&&P(i,Ht,r.crop),N(r.zoom)&&P(i,Pt,r.zoom),P(n,Qt,this.onCropStart),r.zoomable&&r.zoomOnWheel&&P(n,"wheel",this.onWheel,{passive:!1,capture:!0}),r.toggleDragModeOnDblclick&&P(n,Zt,this.onDblclick),P(i.ownerDocument,Kt,this.onCropMove),P(i.ownerDocument,qt,this.onCropEnd),r.responsive&&P(window,"resize",this.onResize)}},$e={resize:function(){if(!this.disabled){var p,e,i=this.options,r=this.container,n=this.containerData,g=r.offsetWidth/n.width;1===g&&r.offsetHeight===n.height||(i.restore&&(p=this.getCanvasData(),e=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(x(p,function(d,s){p[s]=d*g})),this.setCropBoxData(x(e,function(d,s){e[s]=d*g}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(function Be(c,i){return c.classList?c.classList.contains(i):c.className.indexOf(i)>-1}(this.dragBox,Dt)?"move":Et)},wheel:function(i){var r=this,n=Number(this.options.wheelZoomRatio)||.1,g=1;this.disabled||(i.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){r.wheeling=!1},50),i.deltaY?g=i.deltaY>0?1:-1:i.wheelDelta?g=-i.wheelDelta/120:i.detail&&(g=i.detail>0?1:-1),this.zoom(-g*n,i)))},cropStart:function(i){var r=i.buttons,n=i.button;if(!(this.disabled||("mousedown"===i.type||"pointerdown"===i.type&&"mouse"===i.pointerType)&&(k(r)&&1!==r||k(n)&&0!==n||i.ctrlKey))){var e,g=this.options,p=this.pointers;i.changedTouches?x(i.changedTouches,function(d){p[d.identifier]=Bt(d)}):p[i.pointerId||0]=Bt(i),e=Object.keys(p).length>1&&g.zoomable&&g.zoomOnTouch?"zoom":Vt(i.target,pt),ze.test(e)&&!1!==mt(this.element,Nt,{originalEvent:i,action:e})&&(i.preventDefault(),this.action=e,this.cropping=!1,"crop"===e&&(this.cropping=!0,A(this.dragBox,dt)))}},cropMove:function(i){var r=this.action;if(!this.disabled&&r){var n=this.pointers;i.preventDefault(),!1!==mt(this.element,Mt,{originalEvent:i,action:r})&&(i.changedTouches?x(i.changedTouches,function(g){D(n[g.identifier]||{},Bt(g,!0))}):D(n[i.pointerId||0]||{},Bt(i,!0)),this.change(i))}},cropEnd:function(i){if(!this.disabled){var r=this.action,n=this.pointers;i.changedTouches?x(i.changedTouches,function(g){delete n[g.identifier]}):delete n[i.pointerId||0],r&&(i.preventDefault(),Object.keys(n).length||(this.action=""),this.cropping&&(this.cropping=!1,ht(this.dragBox,dt,this.cropped&&this.options.modal)),mt(this.element,Rt,{originalEvent:i,action:r}))}}},Xt={change:function(i){var nt,n=this.canvasData,g=this.containerData,p=this.cropBoxData,e=this.pointers,d=this.action,s=this.options.aspectRatio,o=p.left,a=p.top,l=p.width,h=p.height,m=o+l,u=a+h,C=0,v=0,I=g.width,E=g.height,B=!0;!s&&i.shiftKey&&(s=l&&h?l/h:1),this.limited&&(v=p.minTop,I=(C=p.minLeft)+Math.min(g.width,n.width,n.left+n.width),E=v+Math.min(g.height,n.height,n.top+n.height));var X=e[Object.keys(e)[0]],f={x:X.endX-X.startX,y:X.endY-X.startY},w=function(Z){switch(Z){case J:m+f.x>I&&(f.x=I-m);break;case L:o+f.x<C&&(f.x=C-o);break;case K:a+f.y<v&&(f.y=v-a);break;case"s":u+f.y>E&&(f.y=E-u)}};switch(d){case"all":o+=f.x,a+=f.y;break;case J:if(f.x>=0&&(m>=I||s&&(a<=v||u>=E))){B=!1;break}w(J),(l+=f.x)<0&&(d=L,o-=l=-l),s&&(a+=(p.height-(h=l/s))/2);break;case K:if(f.y<=0&&(a<=v||s&&(o<=C||m>=I))){B=!1;break}w(K),a+=f.y,(h-=f.y)<0&&(d="s",a-=h=-h),s&&(o+=(p.width-(l=h*s))/2);break;case L:if(f.x<=0&&(o<=C||s&&(a<=v||u>=E))){B=!1;break}w(L),o+=f.x,(l-=f.x)<0&&(d=J,o-=l=-l),s&&(a+=(p.height-(h=l/s))/2);break;case"s":if(f.y>=0&&(u>=E||s&&(o<=C||m>=I))){B=!1;break}w("s"),(h+=f.y)<0&&(d=K,a-=h=-h),s&&(o+=(p.width-(l=h*s))/2);break;case Q:if(s){if(f.y<=0&&(a<=v||m>=I)){B=!1;break}w(K),a+=f.y,l=(h-=f.y)*s}else w(K),w(J),f.x>=0?m<I?l+=f.x:f.y<=0&&a<=v&&(B=!1):l+=f.x,f.y<=0?a>v&&(h-=f.y,a+=f.y):(h-=f.y,a+=f.y);l<0&&h<0?(d=bt,a-=h=-h,o-=l=-l):l<0?(d=_t,o-=l=-l):h<0&&(d=it,a-=h=-h);break;case _t:if(s){if(f.y<=0&&(a<=v||o<=C)){B=!1;break}w(K),a+=f.y,o+=p.width-(l=(h-=f.y)*s)}else w(K),w(L),f.x<=0?o>C?(l-=f.x,o+=f.x):f.y<=0&&a<=v&&(B=!1):(l-=f.x,o+=f.x),f.y<=0?a>v&&(h-=f.y,a+=f.y):(h-=f.y,a+=f.y);l<0&&h<0?(d=it,a-=h=-h,o-=l=-l):l<0?(d=Q,o-=l=-l):h<0&&(d=bt,a-=h=-h);break;case bt:if(s){if(f.x<=0&&(o<=C||u>=E)){B=!1;break}w(L),o+=f.x,h=(l-=f.x)/s}else w("s"),w(L),f.x<=0?o>C?(l-=f.x,o+=f.x):f.y>=0&&u>=E&&(B=!1):(l-=f.x,o+=f.x),f.y>=0?u<E&&(h+=f.y):h+=f.y;l<0&&h<0?(d=Q,a-=h=-h,o-=l=-l):l<0?(d=it,o-=l=-l):h<0&&(d=_t,a-=h=-h);break;case it:if(s){if(f.x>=0&&(m>=I||u>=E)){B=!1;break}w(J),h=(l+=f.x)/s}else w("s"),w(J),f.x>=0?m<I?l+=f.x:f.y>=0&&u>=E&&(B=!1):l+=f.x,f.y>=0?u<E&&(h+=f.y):h+=f.y;l<0&&h<0?(d=_t,a-=h=-h,o-=l=-l):l<0?(d=bt,o-=l=-l):h<0&&(d=Q,a-=h=-h);break;case t:this.move(f.x,f.y),B=!1;break;case"zoom":this.zoom(function Ee(c){var i=b({},c),r=0;return x(c,function(n,g){delete i[g],x(i,function(p){var e=Math.abs(n.startX-p.startX),d=Math.abs(n.startY-p.startY),s=Math.abs(n.endX-p.endX),o=Math.abs(n.endY-p.endY),a=Math.sqrt(e*e+d*d),h=(Math.sqrt(s*s+o*o)-a)/a;Math.abs(h)>Math.abs(r)&&(r=h)})}),r}(e),i),B=!1;break;case"crop":if(!f.x||!f.y){B=!1;break}nt=de(this.cropper),o=X.startX-nt.left,a=X.startY-nt.top,l=p.minWidth,h=p.minHeight,f.x>0?d=f.y>0?it:Q:f.x<0&&(o-=l,d=f.y>0?bt:_t),f.y<0&&(a-=h),this.cropped||(H(this.cropBox,R),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}B&&(p.width=l,p.height=h,p.left=o,p.top=a,this.action=d,this.renderCropBox()),x(e,function(S){S.startX=S.endX,S.startY=S.endY})}},We={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&A(this.dragBox,dt),H(this.cropBox,R),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=D({},this.initialImageData),this.canvasData=D({},this.initialCanvasData),this.cropBoxData=D({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(D(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),H(this.dragBox,dt),A(this.cropBox,R)),this},replace:function(i){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&i&&(this.isImg&&(this.element.src=i),r?(this.url=i,this.image.src=i,this.ready&&(this.viewBoxImage.src=i,x(this.previews,function(n){n.getElementsByTagName("img")[0].src=i}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(i))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,H(this.cropper,$t)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,A(this.cropper,$t)),this},destroy:function(){var i=this.element;return i[y]?(i[y]=void 0,this.isImg&&this.replaced&&(i.src=this.originalUrl),this.uncreate(),this):this},move:function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=this.canvasData,g=n.left,p=n.top;return this.moveTo(Ft(i)?i:g+Number(i),Ft(r)?r:p+Number(r))},moveTo:function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=this.canvasData,g=!1;return i=Number(i),r=Number(r),this.ready&&!this.disabled&&this.options.movable&&(k(i)&&(n.left=i,g=!0),k(r)&&(n.top=r,g=!0),g&&this.renderCanvas(!0)),this},zoom:function(i,r){var n=this.canvasData;return i=Number(i),this.zoomTo(n.width*(i=i<0?1/(1-i):1+i)/n.naturalWidth,null,r)},zoomTo:function(i,r,n){var g=this.options,p=this.canvasData,e=p.width,d=p.height,s=p.naturalWidth,o=p.naturalHeight;if((i=Number(i))>=0&&this.ready&&!this.disabled&&g.zoomable){var a=s*i,l=o*i;if(!1===mt(this.element,Pt,{ratio:i,oldRatio:e/s,originalEvent:n}))return this;if(n){var h=this.pointers,m=de(this.cropper),u=h&&Object.keys(h).length?function Re(c){var i=0,r=0,n=0;return x(c,function(g){i+=g.startX,r+=g.startY,n+=1}),{pageX:i/=n,pageY:r/=n}}(h):{pageX:n.pageX,pageY:n.pageY};p.left-=(u.pageX-m.left-p.left)/e*(a-e),p.top-=(u.pageY-m.top-p.top)/d*(l-d)}else gt(r)&&k(r.x)&&k(r.y)?(p.left-=(r.x-p.left)/e*(a-e),p.top-=(r.y-p.top)/d*(l-d)):(p.left-=(a-e)/2,p.top-=(l-d)/2);p.width=a,p.height=l,this.renderCanvas(!0)}return this},rotate:function(i){return this.rotateTo((this.imageData.rotate||0)+Number(i))},rotateTo:function(i){return k(i=Number(i))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=i%360,this.renderCanvas(!0,!0)),this},scaleX:function(i){var r=this.imageData.scaleY;return this.scale(i,k(r)?r:1)},scaleY:function(i){var r=this.imageData.scaleX;return this.scale(k(r)?r:1,i)},scale:function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=this.imageData,g=!1;return i=Number(i),r=Number(r),this.ready&&!this.disabled&&this.options.scalable&&(k(i)&&(n.scaleX=i,g=!0),k(r)&&(n.scaleY=r,g=!0),g&&this.renderCanvas(!0,!0)),this},getData:function(){var e,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.options,n=this.imageData,g=this.canvasData,p=this.cropBoxData;if(this.ready&&this.cropped){var d=n.width/n.naturalWidth;if(x(e={x:p.left-g.left,y:p.top-g.top,width:p.width,height:p.height},function(a,l){e[l]=a/d}),i){var s=Math.round(e.y+e.height),o=Math.round(e.x+e.width);e.x=Math.round(e.x),e.y=Math.round(e.y),e.width=o-e.x,e.height=s-e.y}}else e={x:0,y:0,width:0,height:0};return r.rotatable&&(e.rotate=n.rotate||0),r.scalable&&(e.scaleX=n.scaleX||1,e.scaleY=n.scaleY||1),e},setData:function(i){var r=this.options,n=this.imageData,g=this.canvasData,p={};if(this.ready&&!this.disabled&&gt(i)){var e=!1;r.rotatable&&k(i.rotate)&&i.rotate!==n.rotate&&(n.rotate=i.rotate,e=!0),r.scalable&&(k(i.scaleX)&&i.scaleX!==n.scaleX&&(n.scaleX=i.scaleX,e=!0),k(i.scaleY)&&i.scaleY!==n.scaleY&&(n.scaleY=i.scaleY,e=!0)),e&&this.renderCanvas(!0,!0);var d=n.width/n.naturalWidth;k(i.x)&&(p.left=i.x*d+g.left),k(i.y)&&(p.top=i.y*d+g.top),k(i.width)&&(p.width=i.width*d),k(i.height)&&(p.height=i.height*d),this.setCropBoxData(p)}return this},getContainerData:function(){return this.ready?D({},this.containerData):{}},getImageData:function(){return this.sized?D({},this.imageData):{}},getCanvasData:function(){var i=this.canvasData,r={};return this.ready&&x(["left","top","width","height","naturalWidth","naturalHeight"],function(n){r[n]=i[n]}),r},setCanvasData:function(i){var r=this.canvasData,n=r.aspectRatio;return this.ready&&!this.disabled&&gt(i)&&(k(i.left)&&(r.left=i.left),k(i.top)&&(r.top=i.top),k(i.width)?(r.width=i.width,r.height=i.width/n):k(i.height)&&(r.height=i.height,r.width=i.height*n),this.renderCanvas(!0)),this},getCropBoxData:function(){var r,i=this.cropBoxData;return this.ready&&this.cropped&&(r={left:i.left,top:i.top,width:i.width,height:i.height}),r||{}},setCropBoxData:function(i){var g,p,r=this.cropBoxData,n=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&gt(i)&&(k(i.left)&&(r.left=i.left),k(i.top)&&(r.top=i.top),k(i.width)&&i.width!==r.width&&(g=!0,r.width=i.width),k(i.height)&&i.height!==r.height&&(p=!0,r.height=i.height),n&&(g?r.height=r.width/n:p&&(r.width=r.height*n)),this.renderCropBox()),this},getCroppedCanvas:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var r=this.canvasData,n=function Ne(c,i,r,n){var g=i.aspectRatio,p=i.naturalWidth,e=i.naturalHeight,d=i.rotate,s=void 0===d?0:d,o=i.scaleX,a=void 0===o?1:o,l=i.scaleY,h=void 0===l?1:l,m=r.aspectRatio,u=r.naturalWidth,C=r.naturalHeight,v=n.fillColor,I=void 0===v?"transparent":v,E=n.imageSmoothingEnabled,B=void 0===E||E,nt=n.imageSmoothingQuality,X=void 0===nt?"low":nt,f=n.maxWidth,w=void 0===f?1/0:f,S=n.maxHeight,Z=void 0===S?1/0:S,rt=n.minWidth,zt=void 0===rt?0:rt,wt=n.minHeight,ut=void 0===wt?0:wt,et=document.createElement("canvas"),F=et.getContext("2d"),yt=tt({aspectRatio:m,width:w,height:Z}),fe=tt({aspectRatio:m,width:zt,height:ut},"cover"),He=Math.min(yt.width,Math.max(fe.width,u)),Ze=Math.min(yt.height,Math.max(fe.height,C)),Ke=tt({aspectRatio:g,width:w,height:Z}),qe=tt({aspectRatio:g,width:zt,height:ut},"cover"),ti=Math.min(Ke.width,Math.max(qe.width,p)),ei=Math.min(Ke.height,Math.max(qe.height,e)),ii=[-ti/2,-ei/2,ti,ei];return et.width=ot(He),et.height=ot(Ze),F.fillStyle=I,F.fillRect(0,0,He,Ze),F.save(),F.translate(He/2,Ze/2),F.rotate(s*Math.PI/180),F.scale(a,h),F.imageSmoothingEnabled=B,F.imageSmoothingQuality=X,F.drawImage.apply(F,[c].concat(j(ii.map(function(ai){return Math.floor(ot(ai))})))),F.restore(),et}(this.image,this.imageData,r,i);if(!this.cropped)return n;var g=this.getData(),p=g.x,e=g.y,d=g.width,s=g.height,o=n.width/Math.floor(r.naturalWidth);1!==o&&(p*=o,e*=o,d*=o,s*=o);var a=d/s,l=tt({aspectRatio:a,width:i.maxWidth||1/0,height:i.maxHeight||1/0}),h=tt({aspectRatio:a,width:i.minWidth||0,height:i.minHeight||0},"cover"),m=tt({aspectRatio:a,width:i.width||(1!==o?n.width:d),height:i.height||(1!==o?n.height:s)}),u=m.width,C=m.height;u=Math.min(l.width,Math.max(h.width,u)),C=Math.min(l.height,Math.max(h.height,C));var v=document.createElement("canvas"),I=v.getContext("2d");v.width=ot(u),v.height=ot(C),I.fillStyle=i.fillColor||"transparent",I.fillRect(0,0,u,C);var E=i.imageSmoothingEnabled,nt=i.imageSmoothingQuality;I.imageSmoothingEnabled=void 0===E||E,nt&&(I.imageSmoothingQuality=nt);var Z,rt,zt,wt,ut,et,X=n.width,f=n.height,w=p,S=e;w<=-d||w>X?(w=0,Z=0,zt=0,ut=0):w<=0?(zt=-w,w=0,ut=Z=Math.min(X,d+w)):w<=X&&(zt=0,ut=Z=Math.min(d,X-w)),Z<=0||S<=-s||S>f?(S=0,rt=0,wt=0,et=0):S<=0?(wt=-S,S=0,et=rt=Math.min(f,s+S)):S<=f&&(wt=0,et=rt=Math.min(s,f-S));var F=[w,S,Z,rt];if(ut>0&&et>0){var yt=u/d;F.push(zt*yt,wt*yt,ut*yt,et*yt)}return I.drawImage.apply(I,[n].concat(j(F.map(function(fe){return Math.floor(ot(fe))})))),v},setAspectRatio:function(i){var r=this.options;return!this.disabled&&!Ft(i)&&(r.aspectRatio=Math.max(0,i)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(i){var r=this.options,n=this.dragBox,g=this.face;if(this.ready&&!this.disabled){var p=i===Et,e=r.movable&&"move"===i;r.dragMode=i=p||e?i:"none",Ct(n,pt,i),ht(n,Dt,p),ht(n,vt,e),r.cropBoxMovable||(Ct(g,pt,i),ht(g,Dt,p),ht(g,vt,e))}return this}},Je=$.Cropper,ue=function(){function c(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function _(c,i){if(!(c instanceof i))throw new TypeError("Cannot call a class as a function")}(this,c),!i||!ye.test(i.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=i,this.options=D({},ne,gt(r)&&r),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return function _e(c,i,r){return i&&T(c.prototype,i),r&&T(c,r),c}(c,[{key:"init",value:function(){var g,r=this.element,n=r.tagName.toLowerCase();if(!r[y]){if(r[y]=this,"img"===n){if(this.isImg=!0,g=r.getAttribute("src")||"",this.originalUrl=g,!g)return;g=r.src}else"canvas"===n&&window.HTMLCanvasElement&&(g=r.toDataURL());this.load(g)}}},{key:"load",value:function(r){var n=this;if(r){this.url=r,this.imageData={};var g=this.element,p=this.options;if(!p.rotatable&&!p.scalable&&(p.checkOrientation=!1),!p.checkOrientation||!window.ArrayBuffer)return void this.clone();if(we.test(r))return void(At.test(r)?this.read(function Fe(c){var i=c.replace(Ge,""),r=atob(i),n=new ArrayBuffer(r.length),g=new Uint8Array(n);return x(g,function(p,e){g[e]=r.charCodeAt(e)}),n}(r)):this.clone());var e=new XMLHttpRequest,d=this.clone.bind(this);this.reloading=!0,this.xhr=e,e.onabort=d,e.onerror=d,e.ontimeout=d,e.onprogress=function(){e.getResponseHeader("content-type")!==ae&&e.abort()},e.onload=function(){n.read(e.response)},e.onloadend=function(){n.reloading=!1,n.xhr=null},p.checkCrossOrigin&&pe(r)&&g.crossOrigin&&(r=ge(r)),e.open("GET",r,!0),e.responseType="arraybuffer",e.withCredentials="use-credentials"===g.crossOrigin,e.send()}}},{key:"read",value:function(r){var n=this.options,g=this.imageData,p=Ve(r),e=0,d=1,s=1;if(p>1){this.url=function Ue(c,i){for(var r=[],g=new Uint8Array(c);g.length>0;)r.push(he.apply(null,le(g.subarray(0,8192)))),g=g.subarray(8192);return"data:".concat(i,";base64,").concat(btoa(r.join("")))}(r,ae);var o=function Ye(c){var i=0,r=1,n=1;switch(c){case 2:r=-1;break;case 3:i=-180;break;case 4:n=-1;break;case 5:i=90,n=-1;break;case 6:i=90;break;case 7:i=90,r=-1;break;case 8:i=-90}return{rotate:i,scaleX:r,scaleY:n}}(p);e=o.rotate,d=o.scaleX,s=o.scaleY}n.rotatable&&(g.rotate=e),n.scalable&&(g.scaleX=d,g.scaleY=s),this.clone()}},{key:"clone",value:function(){var r=this.element,n=this.url,g=r.crossOrigin,p=n;this.options.checkCrossOrigin&&pe(n)&&(g||(g="anonymous"),p=ge(n)),this.crossOrigin=g,this.crossOriginUrl=p;var e=document.createElement("img");g&&(e.crossOrigin=g),e.src=p||n,e.alt=r.alt||"The image to crop",this.image=e,e.onload=this.start.bind(this),e.onerror=this.stop.bind(this),A(e,xt),r.parentNode.insertBefore(e,r.nextSibling)}},{key:"start",value:function(){var r=this,n=this.image;n.onload=null,n.onerror=null,this.sizing=!0;var g=$.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test($.navigator.userAgent),p=function(o,a){D(r.imageData,{naturalWidth:o,naturalHeight:a,aspectRatio:o/a}),r.initialImageData=D({},r.imageData),r.sizing=!1,r.sized=!0,r.build()};if(!n.naturalWidth||g){var e=document.createElement("img"),d=document.body||document.documentElement;this.sizingImage=e,e.onload=function(){p(e.width,e.height),g||d.removeChild(e)},e.src=n.src,g||(e.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",d.appendChild(e))}else p(n.naturalWidth,n.naturalHeight)}},{key:"stop",value:function(){var r=this.image;r.onload=null,r.onerror=null,r.parentNode.removeChild(r),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var r=this.element,n=this.options,g=this.image,p=r.parentNode,e=document.createElement("div");e.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var d=e.querySelector(".".concat(y,"-container")),s=d.querySelector(".".concat(y,"-canvas")),o=d.querySelector(".".concat(y,"-drag-box")),a=d.querySelector(".".concat(y,"-crop-box")),l=a.querySelector(".".concat(y,"-face"));this.container=p,this.cropper=d,this.canvas=s,this.dragBox=o,this.cropBox=a,this.viewBox=d.querySelector(".".concat(y,"-view-box")),this.face=l,s.appendChild(g),A(r,R),p.insertBefore(d,r.nextSibling),this.isImg||H(g,xt),this.initPreview(),this.bind(),n.initialAspectRatio=Math.max(0,n.initialAspectRatio)||NaN,n.aspectRatio=Math.max(0,n.aspectRatio)||NaN,n.viewMode=Math.max(0,Math.min(3,Math.round(n.viewMode)))||0,A(a,R),n.guides||A(a.getElementsByClassName("".concat(y,"-dashed")),R),n.center||A(a.getElementsByClassName("".concat(y,"-center")),R),n.background&&A(d,"".concat(y,"-bg")),n.highlight||A(l,It),n.cropBoxMovable&&(A(l,vt),Ct(l,pt,"all")),n.cropBoxResizable||(A(a.getElementsByClassName("".concat(y,"-line")),R),A(a.getElementsByClassName("".concat(y,"-point")),R)),this.render(),this.ready=!0,this.setDragMode(n.dragMode),n.autoCrop&&this.crop(),this.setData(n.data),N(n.ready)&&G(r,"ready",n.ready,{once:!0}),mt(r,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),H(this.element,R))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Je,c}},{key:"setDefaults",value:function(r){D(ne,gt(r)&&r)}}]),c}();return D(ue.prototype,Le,Xe,me,$e,Xt,We),ue}()}}]);