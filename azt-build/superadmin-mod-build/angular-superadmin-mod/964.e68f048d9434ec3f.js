(self.webpackChunkSuperadminMod=self.webpackChunkSuperadminMod||[]).push([[964],{57964:(Qe,lt,v)=>{"use strict";v.r(lt),v.d(lt,{AzotaDigitalizeRoutingModule:()=>h});var f=v(14042),M=v(32108),fe=v(74341),Lt=v(82242),w=v(60177),k=v(89417),L=v(83409),_e=v(65537),O=v(89819),P=v(98697),be=v(38949),X=v(51451),G=v(25155),It=v(36876),Ot=v(95506),D=v(29097),B=v(8516),U=v(11782),V=v(46412),t=v(93953),K=v(93630),J=v(58770),H=v(74523),q=v(21626),ft=v(17525),ct=v(56510),_t=v(93881),dt=v(93877),bt=v(90355),Xt=v(57399),j=v(61906),$t=v(18359),Bt=v(71985);let at=(()=>{var r;class d{constructor(){(0,f.A)(this,"subscriptions",new $t.yU),(0,f.A)(this,"sAztBase64Service",(0,t.WQX)(J.D)),(0,f.A)(this,"ocrService",(0,t.WQX)(Xt.so)),(0,f.A)(this,"commonService",(0,t.WQX)(_t.R)),(0,f.A)(this,"imageUtils",void 0),(0,f.A)(this,"sAztUuidService",(0,t.WQX)(dt.D)),(0,f.A)(this,"digitalizedBookPageService",(0,t.WQX)(j.gI)),(0,f.A)(this,"apiUploadService",(0,t.WQX)(ft.T))}runRemoveBackgroundNoise(i,a,c){return new Bt.c(m=>{this.removeBackgroundNoise(i.oldImageUrl,a,(u,_)=>{if(null==u||_)return c(_??""),m.next(void 0),void m.complete();this.apiUploadService.commonUploadFile(bt.b8.ADMIN_DIGITALIZE,this.sAztBase64Service.base64ToFile(u,"digitalized-file.png"),"").subscribe(C=>{C.type!=q.hv.UploadProgress&&(1===C.success&&C.data?.url?(m.next({...i,newImageUrl:C.data.url}),m.complete()):(c(C.message??""),m.next(void 0),m.complete()))})})})}removeBackgroundNoise(i,a,c){this.sAztBase64Service.convertImageUrlToBase64(i,m=>{if(!m)return c(void 0,"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(m),u=>{if(!u)return c(void 0,"Error to get Uint8Array from base64");this.loadScriptHandleImage(()=>{this.imageUtils.removeNoise(u,a).then(_=>c(this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(_.image)),void 0)).catch(_=>c(void 0,"Error when call imageUtils.detectImage"))})})})}callChangeBookPageDataApi(i,a,c,m,u){this.subscriptions.add(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrPost({bookId:i,bookPageId:a,ocrContent:c,originOcrContent:m}).subscribe(C=>{if(!C.success)return u(!1,C.message);u(!0,"")}))}digitalizeOneImage(i,a,c,m){return new Bt.c(u=>{a("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.commonService.wrapApiResponse(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:i})).subscribe(_=>{if(!_.success||!_.data)return c(_.message),u.next(!1),void u.complete();m(this.replaceOrcData(_.data)),u.next(!0),u.complete()}))})}replaceOrcData(i){let a=i.data,c=this.sAztUuidService.getUuid();return a=this.commonService.convertLatexTagToAztMathTag(a,c),a=(new O.bt).transform((new O.UN).transform(a)),a=this.commonService.replaceAll(a,"<table>","<table class='table table-bordered'>")??a,a=a.replace(new RegExp(c,"g"),"\n"),{htmlResult:a,originOcrData:i.data}}extractImageByOrcUtil(i,a){this.sAztBase64Service.convertImageUrlToBase64(i,c=>{if(!c)return a(void 0,[],"Error to get base64 from url");this.sAztBase64Service.getImageDimensions(c,m=>{this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(c),u=>{if(!u)return a(void 0,[],"Error to get Uint8Array from base64");let _={base64:this.sAztBase64Service.removePrefixOfBase64(c),x:0,y:0,width:m.width,height:m.height,extension:"png"};this.loadScriptHandleImage(()=>{this.imageUtils.detectImage(u).then(C=>a(_,C.images.map(z=>({base64:this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(z.content)),x:z.x,y:z.y,width:z.width,height:z.height,extension:z.extension})),void 0)).catch(C=>a(_,[],"Error when call imageUtils.detectImage"))})})})})}waitAnswerSheetInitDone(i){if(ct.A.azotaScanAnswerSheet)return i();setTimeout(()=>{this.waitAnswerSheetInitDone(i)},100)}loadScriptHandleImage(i){var a=this;if(this.imageUtils)return i();this.commonService.loadAnswerSheetJs().then((0,H.A)(function*(){a.waitAnswerSheetInitDone((0,H.A)(function*(){a.imageUtils=yield ct.A.azotaScanAnswerSheet.imageUtils(),i()}))})).catch(c=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),i()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)}),(0,f.A)(d,"\u0275prov",t.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})),d})();var vt=v(18068),ot=v(81538),kt=v(34006),jt=v(1054);const Wt=["image"];function Jt(r,d){1&r&&(t.j41(0,"div",6),t.nrm(1,"div",7),t.k0s())}function St(r,d){if(1&r&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&r){const s=t.XpG();t.R7$(),t.JRh(s.loadImageErrorText)}}let Tt=(()=>{class r{constructor(){this.cropperOptions={},this.export=new t.bkB,this.ready=new t.bkB,this.isLoading=!0}ngOnInit(){}ngOnDestroy(){this.cropper&&(this.cropper.destroy(),this.cropper=null)}imageLoaded(s){this.loadError=!1;const i=s.target;this.imageElement=i,this.cropperOptions.checkCrossOrigin&&(i.crossOrigin="anonymous"),i.addEventListener("ready",()=>{this.ready.emit(!0),this.isLoading=!1,this.cropbox&&this.cropper.setCropBoxData(this.cropbox)});let a=NaN;if(this.settings){const{width:c,height:m}=this.settings;a=c/m}this.cropperOptions={aspectRatio:a,checkCrossOrigin:!0,...this.cropperOptions},this.cropper&&(this.cropper.destroy(),this.cropper=void 0),this.cropper=new jt(i,this.cropperOptions)}imageLoadError(s){this.loadError=!0,this.isLoading=!1}exportCanvas(s){const i=this.cropper.getImageData(),a=this.cropper.getCropBoxData(),c=this.cropper.getCroppedCanvas(),m={imageData:i,cropData:a};new Promise(_=>{if(s)return _({dataUrl:c.toDataURL("image/png")});c.toBlob(C=>_({blob:C}))}).then(_=>{this.export.emit({...m,..._})})}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=t.VBU({type:r,selectors:[["angular-cropper"]],viewQuery:function(s,i){if(1&s&&t.GBs(Wt,7),2&s){let a;t.mGM(a=t.lsd())&&(i.image=a.first)}},inputs:{imageUrl:"imageUrl",settings:"settings",cropbox:"cropbox",loadImageErrorText:"loadImageErrorText",cropperOptions:"cropperOptions"},outputs:{export:"export",ready:"ready"},decls:6,vars:3,consts:[["image",""],[1,"cropper-wrapper"],["class","loading-block",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"cropper"],["alt","image",3,"load","error","src"],[1,"loading-block"],[1,"spinner"],[1,"alert","alert-warning"]],template:function(s,i){if(1&s){const a=t.RV6();t.j41(0,"div",1),t.DNE(1,Jt,2,0,"div",2)(2,St,2,1,"div",3),t.j41(3,"div",4)(4,"img",5,0),t.bIt("load",function(m){return t.eBV(a),t.Njj(i.imageLoaded(m))})("error",function(m){return t.eBV(a),t.Njj(i.imageLoadError(m))}),t.k0s()()()}2&s&&(t.R7$(),t.Y8G("ngIf",i.isLoading),t.R7$(),t.Y8G("ngIf",i.loadError),t.R7$(2),t.Y8G("src",i.imageUrl,t.B4B))},dependencies:[w.bT],styles:[':host{display:block}.cropper img{max-width:100%;max-height:100%;height:auto}.cropper-wrapper{position:relative;min-height:80px}.cropper-wrapper .loading-block{position:absolute;top:0;left:0;width:100%;height:100%}.cropper-wrapper .loading-block .spinner{width:31px;height:31px;margin:0 auto;border:2px solid rgba(97,100,193,.98);border-radius:50%;border-left-color:transparent;border-right-color:transparent;-webkit-animation:cssload-spin 425ms infinite linear;position:absolute;top:calc(50% - 15px);left:calc(50% - 15px);animation:cssload-spin 425ms infinite linear}@keyframes cssload-spin{to{transform:rotate(360deg)}}/*!\n * Cropper.js v1.4.1\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2018-07-15T09:54:43.167Z\n */.cropper-container{direction:ltr;font-size:0;line-height:0;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cropper-container img{display:block;height:100%;image-orientation:0deg;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;width:100%}.cropper-wrap-box,.cropper-canvas,.cropper-drag-box,.cropper-crop-box,.cropper-modal{inset:0;position:absolute}.cropper-wrap-box,.cropper-canvas{overflow:hidden}.cropper-drag-box{background-color:#fff;opacity:0}.cropper-modal{background-color:#000;opacity:.5}.cropper-view-box{display:block;height:100%;outline-color:#3399ffbf;outline:1px solid #39f;overflow:hidden;width:100%}.cropper-dashed{border:0 dashed #eee;display:block;opacity:.5;position:absolute}.cropper-dashed.dashed-h{border-bottom-width:1px;border-top-width:1px;height:calc(100% / 3);left:0;top:calc(100% / 3);width:100%}.cropper-dashed.dashed-v{border-left-width:1px;border-right-width:1px;height:100%;left:calc(100% / 3);top:0;width:calc(100% / 3)}.cropper-center{display:block;height:0;left:50%;opacity:.75;position:absolute;top:50%;width:0}.cropper-center:before,.cropper-center:after{background-color:#eee;content:" ";display:block;position:absolute}.cropper-center:before{height:1px;left:-3px;top:0;width:7px}.cropper-center:after{height:7px;left:0;top:-3px;width:1px}.cropper-face,.cropper-line,.cropper-point{display:block;height:100%;opacity:.1;position:absolute;width:100%}.cropper-face{background-color:#fff;left:0;top:0}.cropper-line{background-color:#39f}.cropper-line.line-e{cursor:ew-resize;right:-3px;top:0;width:5px}.cropper-line.line-n{cursor:ns-resize;height:5px;left:0;top:-3px}.cropper-line.line-w{cursor:ew-resize;left:-3px;top:0;width:5px}.cropper-line.line-s{bottom:-3px;cursor:ns-resize;height:5px;left:0}.cropper-point{background-color:#39f;height:5px;opacity:.75;width:5px}.cropper-point.point-e{cursor:ew-resize;margin-top:-3px;right:-3px;top:50%}.cropper-point.point-n{cursor:ns-resize;left:50%;margin-left:-3px;top:-3px}.cropper-point.point-w{cursor:ew-resize;left:-3px;margin-top:-3px;top:50%}.cropper-point.point-s{bottom:-3px;cursor:s-resize;left:50%;margin-left:-3px}.cropper-point.point-ne{cursor:nesw-resize;right:-3px;top:-3px}.cropper-point.point-nw{cursor:nwse-resize;left:-3px;top:-3px}.cropper-point.point-sw{bottom:-3px;cursor:nesw-resize;left:-3px}.cropper-point.point-se{bottom:-3px;cursor:nwse-resize;height:20px;opacity:1;right:-3px;width:20px}@media (min-width: 768px){.cropper-point.point-se{height:15px;width:15px}}@media (min-width: 992px){.cropper-point.point-se{height:10px;width:10px}}@media (min-width: 1200px){.cropper-point.point-se{height:5px;opacity:.75;width:5px}}.cropper-point.point-se:before{background-color:#39f;bottom:-50%;content:" ";display:block;height:200%;opacity:0;position:absolute;right:-50%;width:200%}.cropper-invisible{opacity:0}.cropper-bg{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC)}.cropper-hide{display:block;height:0;position:absolute;width:0}.cropper-hidden{display:none!important}.cropper-move{cursor:move}.cropper-crop{cursor:crosshair}.cropper-disabled .cropper-drag-box,.cropper-disabled .cropper-face,.cropper-disabled .cropper-line,.cropper-disabled .cropper-point{cursor:not-allowed}\n'],encapsulation:2}),r})(),Et=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[w.MD]}),r})();var Zt=v(81174);const ve=["angularCropper"];function ke(r,d){if(1&r){const s=t.RV6();t.qex(0),t.j41(1,"img",11),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const a=t.eBV(s).$implicit,c=t.XpG(2);return t.Njj(c.chooseImage(a))}),t.k0s(),t.bVm()}if(2&r){const s=d.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,s.base64,"png"),t.B4B)}}function Ce(r,d){if(1&r&&(t.j41(0,"div",9),t.DNE(1,ke,3,4,"ng-container",10),t.k0s()),2&r){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",s.base64Images)}}function Qt(r,d){if(1&r&&(t.nrm(0,"angular-cropper",12,0),t.nI1(2,"addBase64Extension")),2&r){const s=t.XpG();t.Y8G("cropperOptions",s.cropperOptions)("imageUrl",t.i5U(2,2,s.currentBase64Image.base64,"png"))}}let Kt=(()=>{var r;class d extends Zt._{chooseImage(i){this.currentBase64Image=i}cropImage(i){var a=this;return(0,H.A)(function*(){a.angularCropper?.cropper.getCroppedCanvas().toBlob(c=>{c&&a.sAztBase64Service.convertBlobToBase64(c,function(){var m=(0,H.A)(function*(u){let _=a.angularCropper?.cropper.getCropBoxData(),C=_?.width,z=_?.height;!C||!z||(a.base64Images.push({base64:u,x:0,y:0,width:C,height:z,extension:"png"}),yield a.sAztBase64Service.copyBase64ToClipBoard(u),a.showSuccessSnack("lang_cms_copy_success"),i&&a.dialogRef.close(a.base64Images))});return function(u){return m.apply(this,arguments)}}())})})()}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(i,a){super(a,i),(0,f.A)(this,"dialogRef",void 0),(0,f.A)(this,"data",void 0),(0,f.A)(this,"sAztBase64Service",(0,t.WQX)(J.D)),(0,f.A)(this,"base64Images",[]),(0,f.A)(this,"currentBase64Image",void 0),(0,f.A)(this,"cropperOptions",{movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}}),(0,f.A)(this,"angularCropper",void 0),this.dialogRef=i,this.data=a,this.base64Images=a.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)(t.rXU(kt.CP,8),t.rXU(kt.Vh,8))}),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-coazt-image-editor"]],viewQuery:function(i,a){if(1&i&&t.GBs(ve,5),2&i){let c;t.mGM(c=t.lsd())&&(a.angularCropper=c.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:14,vars:11,consts:[["angularCropper",""],[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn","btn-info","mr-2",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"],[3,"cropperOptions","imageUrl"]],template:function(i,a){1&i&&(t.j41(0,"div",1),t.DNE(1,Ce,2,1,"div",2),t.j41(2,"div",3)(3,"span",4),t.bIt("click",function(){return a.cropImage(!0)}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",5),t.bIt("click",function(){return a.cropImage(!1)}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"span",6),t.bIt("click",function(){return a.closeDialog()}),t.EFF(10),t.nI1(11,"mytranslate"),t.k0s()(),t.j41(12,"div",7),t.DNE(13,Qt,3,5,"angular-cropper",8),t.k0s()()),2&i&&(t.R7$(),t.Y8G("ngIf",a.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,5,"lang_button_crop_and_close")),t.R7$(3),t.JRh(t.bMT(8,7,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(11,9,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",a.currentBase64Image))},dependencies:[Et,Tt,w.MD,w.Sq,w.bT,k.X1,M.iI,k.YN,O.wp,V.s,B.flO,P.L,O.t4,U.Id,L.k],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]})),d})();function qt(r,d){if(1&r){const s=t.RV6();t.qex(0),t.j41(1,"img",6),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const a=t.eBV(s).$implicit,c=t.XpG(2);return t.Njj(c.copyImage(a))}),t.k0s(),t.bVm()}if(2&r){const s=d.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,s.base64,s.extension),t.B4B)}}function te(r,d){if(1&r&&(t.j41(0,"div",4),t.DNE(1,qt,3,4,"ng-container",5),t.k0s()),2&r){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",s.base64Images)}}let ee=(()=>{var r;class d extends X.H{constructor(...i){super(...i),(0,f.A)(this,"imageUrl",void 0),(0,f.A)(this,"replaceImageEvent",new t.bkB),(0,f.A)(this,"sAztDialogService",(0,t.WQX)(ot.i)),(0,f.A)(this,"sAztDigitalizeService",(0,t.WQX)(at)),(0,f.A)(this,"sAztBase64Service",(0,t.WQX)(J.D)),(0,f.A)(this,"base64Images",[])}copyImage(i){var a=this;return(0,H.A)(function*(){yield a.sAztBase64Service.copyBase64ToClipBoard(i.base64),a.showSuccessSnack("lang_cms_copy_and_replace_success"),a.replaceImageEvent.emit(i)})()}cropImageDialog(){this.sAztDialogService.open(Kt,{data:{base64Images:this.base64Images},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(a=>{null!=a&&(this.base64Images=a)})}ngOnChanges(){this.initStatusObj(),this.sAztDigitalizeService.extractImageByOrcUtil(this.imageUrl,(i,a,c)=>{if(c)return this.errorStatusObj(c,!0);let m=[];i&&m.push(i),a.forEach(u=>m.push(u)),this.base64Images=m,this.stopStatusObj()})}}return r=d,(0,f.A)(d,"\u0275fac",(()=>{let s;return function(a){return(s||(s=t.xGo(r)))(a||r)}})()),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-list-digitalized-images"]],inputs:{imageUrl:"imageUrl"},outputs:{replaceImageEvent:"replaceImageEvent"},standalone:!0,features:[t.Vt3,t.OA$,t.aNF],decls:6,vars:4,consts:[[2,"height","228px","overflow-x","scroll","overflow-y","hidden"],["class","list-base640-images",4,"ngIf"],[1,"mb-3","mt-3"],[1,"text-primary","clickable",3,"click"],[1,"list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"]],template:function(i,a){1&i&&(t.j41(0,"div",0),t.DNE(1,te,2,1,"div",1),t.k0s(),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return a.cropImageDialog()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()),2&i&&(t.R7$(),t.Y8G("ngIf",a.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,2,"lang_button_crop")))},dependencies:[w.MD,w.Sq,w.bT,k.X1,M.iI,k.YN,O.wp,V.s,B.flO,P.L,O.t4,U.Id,L.k],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;max-height:200px}"]})),d})();const ie=()=>({"flex-none":!0,"mr-1":!0});function Rt(r,d){1&r&&t.nrm(0,"azt-loading-ui",13)}function ae(r,d){1&r&&t.nrm(0,"azt-loading-ui",13)}let ze=(()=>{var r;class d extends X.H{saveAllObjs(){this.saveAllContentEvent.emit()}saveObj(){this.initStatusObj();let i=this.obj.htmlContentFormControl.value;this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookObj.id,this.obj.id,i,void 0,(a,c)=>{if(!a)return this.errorStatusObj(c,!0);this.obj.ocrContent=i,this.changeBookPageStatusEvent.emit(this.obj),this.successStatusObj("lang_cms_update_success",!0)})}cancelObj(){this.showSuccessSnack("lang_cms_cancel_success"),this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}replaceImage(i){let a=this.obj.htmlContentFormControl.value.replace("<img>",`<img src='${this.sAztBase64Service.generateBase64Prefix(i.extension)+i.base64}'/>`);this.obj.htmlContentFormControl.setValue(a)}ngOnChanges(){this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}ngOnInit(){super.ngOnInit()}constructor(){super(),(0,f.A)(this,"sAztDigitalizeService",(0,t.WQX)(at)),(0,f.A)(this,"sAztBase64Service",(0,t.WQX)(J.D)),(0,f.A)(this,"bookObj",void 0),(0,f.A)(this,"obj",void 0),(0,f.A)(this,"changeBookPageStatusEvent",new t.bkB),(0,f.A)(this,"callAgainOcrBookPageEvent",new t.bkB),(0,f.A)(this,"saveAllContentEvent",new t.bkB)}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)}),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-edit-book-page"]],inputs:{bookObj:"bookObj",obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent",saveAllContentEvent:"saveAllContentEvent"},standalone:!0,features:[t.Vt3,t.OA$,t.aNF],decls:26,vars:29,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"p-3"],[3,"replaceImageEvent","imageUrl"],[3,"formControl","apiKey","init"],[1,"flex-none","items-center","text-right","mt-3"],[1,"btn","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","mr-3",3,"click"],["class","mr-1",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"mr-1"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"span",3),t.bIt("click",function(){return a.callAgainOcrBookPageEvent.emit(a.obj)}),t.nrm(6,"lucide-icon",4),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()(),t.j41(9,"div",5)(10,"app-digitalized-list-digitalized-images",6),t.bIt("replaceImageEvent",function(m){return a.replaceImage(m)}),t.k0s(),t.nrm(11,"editor",7),t.nI1(12,"getTinyMceKey"),t.nI1(13,"getTinyMceConfig"),t.j41(14,"div",8)(15,"button",9),t.bIt("click",function(){return a.cancelObj()}),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){return a.saveObj()}),t.DNE(19,Rt,1,0,"azt-loading-ui",11),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s(),t.j41(22,"button",12),t.bIt("click",function(){return a.saveAllObjs()}),t.DNE(23,ae,1,0,"azt-loading-ui",11),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()),2&i&&(t.R7$(3),t.Lme("",t.bMT(4,14,"lang_cms_admin_digitalized_page"),": ",a.obj.currentPage,""),t.R7$(3),t.Y8G("ngClass",t.lJ4(28,ie)),t.R7$(),t.SpI(" ",t.bMT(8,16,"lang_cms_admin_digitalized_re_digitalized_again")," "),t.R7$(3),t.Y8G("imageUrl",a.obj.imageLink),t.R7$(),t.FS9("apiKey",t.bMT(12,18,"")),t.Y8G("formControl",a.obj.htmlContentFormControl)("init",t.bMT(13,20,"admin_for_digitalized")),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(5),t.JRh(t.bMT(17,22,"lang_auto_huy")),t.R7$(3),t.Y8G("ngIf",a.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(21,24,"lang_digitalized_save_one")," "),t.R7$(3),t.Y8G("ngIf",a.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(25,26,"lang_digitalized_save_all")," "))},dependencies:[O.Hw,O.yc,K.sv,K.xn,ee,vt.R,w.MD,w.YU,w.bT,k.X1,k.BC,k.l_,M.iI,k.YN,O.wp,V.s,B.flO,B.WGl,P.L,U.Id,L.k],encapsulation:2})),d})();var Ae=v(47817);const we=["*"];let Dt=(()=>{var r;class d extends X.H{constructor(...i){super(...i),(0,f.A)(this,"imageUrl",""),(0,f.A)(this,"sAztDialogService",(0,t.WQX)(ot.i))}previewImage(){this.sAztDialogService.open(Ae.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{url:this.imageUrl,mimes:"image/jpeg"},viewFullImageWithScroll:!0},restoreFocus:!1})}}return r=d,(0,f.A)(d,"\u0275fac",(()=>{let s;return function(a){return(s||(s=t.xGo(r)))(a||r)}})()),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["azt-preview-image-tag"]],inputs:{imageUrl:"imageUrl"},standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:we,decls:2,vars:0,consts:[[3,"click"]],template:function(i,a){1&i&&(t.NAR(),t.j41(0,"span",0),t.bIt("click",function(){return a.previewImage()}),t.SdG(1),t.k0s())},dependencies:[w.MD,k.X1,M.iI,k.YN,V.s,B.flO,P.L,U.Id,L.k],encapsulation:2})),d})(),oe=(()=>{var r;class d extends X.H{constructor(...i){super(...i),(0,f.A)(this,"obj",void 0)}}return r=d,(0,f.A)(d,"\u0275fac",(()=>{let s;return function(a){return(s||(s=t.xGo(r)))(a||r)}})()),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-processing-book-page"]],inputs:{obj:"obj"},standalone:!0,features:[t.Vt3,t.aNF],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],[1,"flex","items-center"],[1,"mr-1"]],template:function(i,a){if(1&i&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()(),t.j41(5,"div",3)(6,"azt-preview-image-tag",4),t.nrm(7,"img",5),t.k0s(),t.nrm(8,"hr",6),t.j41(9,"div",7),t.nrm(10,"azt-loading-ui",8),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()()),2&i){let c;t.R7$(3),t.Lme("",t.bMT(4,5,"lang_cms_admin_digitalized_page"),": ",a.obj.currentPage,""),t.R7$(3),t.Y8G("imageUrl",a.obj.imageLink),t.R7$(),t.Y8G("src",a.obj.imageLink,t.B4B),t.R7$(4),t.SpI(" ",t.bMT(12,7,null!==(c=a.obj.logMessage)&&void 0!==c?c:"lang_lang_cms_admin_digitalized_is_waiting_to_process")," ")}},dependencies:[Dt,vt.R,w.MD,k.X1,M.iI,k.YN,O.wp,V.s,B.flO,P.L,U.Id,L.k],encapsulation:2})),d})();const Mt=()=>({"flex-none":!0,"mr-1":!0});function ne(r,d){if(1&r){const s=t.RV6();t.qex(0),t.j41(1,"span",10),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.editBookPage(a.obj))}),t.nrm(2,"lucide-icon",11),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.callAgainOcrBookPageEvent.emit(a.obj))}),t.nrm(7,"lucide-icon",13),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s(),t.bVm()}2&r&&(t.R7$(2),t.Y8G("ngClass",t.lJ4(8,Mt)),t.R7$(),t.SpI(" ",t.bMT(4,4,"lang_cms_admin_digitalized_edit_content")," "),t.R7$(4),t.Y8G("ngClass",t.lJ4(9,Mt)),t.R7$(),t.SpI(" ",t.bMT(9,6,"lang_cms_admin_digitalized_re_digitalized_again")," "))}function ye(r,d){if(1&r&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&r){const s=t.XpG();t.R7$(),t.JRh(t.bMT(2,1,s.obj.logMessage))}}function De(r,d){if(1&r&&(t.j41(0,"div"),t.nrm(1,"div",15),t.nI1(2,"mathJaxContent"),t.nI1(3,"async"),t.nI1(4,"safeNormalHtmlContent"),t.k0s()),2&r){let s;const i=t.XpG();t.R7$(),t.Y8G("innerHTML",t.bMT(4,5,t.bMT(3,3,t.bMT(2,1,null!==(s=i.obj.ocrContent)&&void 0!==s?s:""))),t.npT)}}let A=(()=>{var r;class d extends X.H{constructor(...i){super(...i),(0,f.A)(this,"obj",void 0),(0,f.A)(this,"changeBookPageStatusEvent",new t.bkB),(0,f.A)(this,"callAgainOcrBookPageEvent",new t.bkB)}editBookPage(i){i.currentStatus="show_edit_form",this.changeBookPageStatusEvent.emit(i)}}return r=d,(0,f.A)(d,"\u0275fac",(()=>{let s;return function(a){return(s||(s=t.xGo(r)))(a||r)}})()),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-view-book-page"]],inputs:{obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},standalone:!0,features:[t.Vt3,t.aNF],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"flex-none","items-center"],[4,"ngIf"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],["class","mb-3 text-pending",4,"ngIf"],[1,"text-primary","clickable","mr-2",3,"click"],["name","pencil","size","16",3,"ngClass"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"mb-3","text-pending"],[3,"innerHTML"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,ne,10,10,"ng-container",4),t.k0s()(),t.j41(7,"div",5)(8,"azt-preview-image-tag",6),t.nrm(9,"img",7),t.k0s(),t.nrm(10,"hr",8),t.DNE(11,ye,3,3,"div",9)(12,De,5,7,"div",4),t.k0s()),2&i&&(t.R7$(3),t.Lme("",t.bMT(4,7,"lang_cms_admin_digitalized_page"),": ",a.obj.currentPage,""),t.R7$(3),t.Y8G("ngIf",a.obj.isOrc),t.R7$(2),t.Y8G("imageUrl",a.obj.imageLink),t.R7$(),t.Y8G("src",a.obj.imageLink,t.B4B),t.R7$(2),t.Y8G("ngIf",a.obj.logMessage),t.R7$(),t.Y8G("ngIf",a.obj.isOrc))},dependencies:[Dt,w.MD,w.YU,w.bT,w.Jj,k.X1,M.iI,k.YN,O.wp,V.s,B.flO,B.WGl,P.L,O.km,O._y,U.Id,L.k],encapsulation:2})),d})();var re=v(45312),Nt=v(72710),nt=v(86648),xe=v(73028),pt=v(99437),N=v(18810),Ie=v(7673),Pt=v(96354),I=v(19852),x=v(39974);const Oe=(r,d)=>(r.push(d),r);let se=(()=>{var r;class d{processObservables(i,a,c){return new Bt.c(m=>{this.processMultipleObservables(i,a,c).subscribe({next:u=>{m.next(u),m.complete()},error:u=>{m.next(a.map(_=>null)),m.complete()}})})}processMultipleObservables(i,a,c){return(0,nt.H)(a).pipe((0,xe.Z)((m,u)=>m.pipe((0,pt.W)(_=>(console.error("Error in observable:",_),c?(0,N.$)(()=>_):(0,Ie.of)(null))),(0,Pt.T)(_=>({result:_,index:u}))),i),function gt(){return(0,x.N)((r,d)=>{(0,I.T)(Oe,[])(r).subscribe(d)})}(),(0,Pt.T)(m=>m.sort((u,_)=>u.index-_.index).map(u=>u.result)))}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)}),(0,f.A)(d,"\u0275prov",t.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})),d})();var tt=v(57507);function Be(r,d){if(1&r&&t.nrm(0,"azt-loading-effect",3),2&r){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function S(r,d){if(1&r){const s=t.RV6();t.j41(0,"app-digitalized-view-book-page",18),t.bIt("changeBookPageStatusEvent",function(a){t.eBV(s);const c=t.XpG(5);return t.Njj(c.changeBookPageStatus(a))})("callAgainOcrBookPageEvent",function(a){t.eBV(s);const c=t.XpG(5);return t.Njj(c.reDigitalizedOneObj(a))}),t.k0s()}if(2&r){const s=t.XpG(2).$implicit;t.Y8G("obj",s)}}function Z(r,d){if(1&r){const s=t.RV6();t.j41(0,"app-digitalized-edit-book-page",19),t.bIt("changeBookPageStatusEvent",function(a){t.eBV(s);const c=t.XpG(5);return t.Njj(c.changeBookPageStatus(a))})("callAgainOcrBookPageEvent",function(a){t.eBV(s);const c=t.XpG(5);return t.Njj(c.reDigitalizedOneObj(a))})("saveAllContentEvent",function(){t.eBV(s);const a=t.XpG(5);return t.Njj(a.saveAllContent())}),t.k0s()}if(2&r){const s=t.XpG(2).$implicit,i=t.XpG(3);t.Y8G("bookObj",i.bookObj)("obj",s)}}function ht(r,d){if(1&r&&t.nrm(0,"app-digitalized-processing-book-page",20),2&r){const s=t.XpG(2).$implicit;t.Y8G("obj",s)}}function je(r,d){if(1&r&&(t.j41(0,"div"),t.DNE(1,S,1,1,"app-digitalized-view-book-page",15)(2,Z,1,2,"app-digitalized-edit-book-page",16)(3,ht,1,1,"app-digitalized-processing-book-page",17),t.k0s()),2&r){const s=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf","none"==s.currentStatus),t.R7$(),t.Y8G("ngIf","show_edit_form"==s.currentStatus),t.R7$(),t.Y8G("ngIf","calling_ocr_api"==s.currentStatus)}}function Gt(r,d){if(1&r&&(t.qex(0),t.DNE(1,je,4,3,"div",14),t.bVm()),2&r){const s=d.$implicit;t.R7$(),t.Y8G("ngIf",s.isShow)}}function Ft(r,d){if(1&r){const s=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"button",7),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.digitalizedAll())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"button",7),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.runDigitalizedCurrentPage())}),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.exportData("html"))}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",8),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.exportData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s(),t.j41(14,"button",8),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.exportData("txt"))}),t.EFF(15),t.nI1(16,"mytranslate"),t.k0s()(),t.j41(17,"div",9),t.DNE(18,Gt,2,1,"ng-container",10),t.k0s(),t.j41(19,"div",11)(20,"div",12)(21,"azt-paging",13),t.bIt("goToPaginationPage",function(a){t.eBV(s);const c=t.XpG(2);return t.Njj(c.goToPage(a))}),t.k0s()()()()}if(2&r){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,10,"lang_cms_admin_digitalized_digitalized_all")," (",s.bookObj.totalDone," / ",s.bookObj.totalPage,")"),t.R7$(3),t.Lme("",t.bMT(7,12,"lang_cms_admin_digitalized_digitalized_current_page")," (",s.totalCurrentItems,")"),t.R7$(3),t.JRh(t.bMT(10,14,"lang_cms_admin_digitalized_digitalized_export_html")),t.R7$(3),t.JRh(t.bMT(13,16,"lang_cms_admin_digitalized_digitalized_export_docx")),t.R7$(3),t.JRh(t.bMT(16,18,"lang_cms_admin_digitalized_digitalized_export_txt")),t.R7$(3),t.Y8G("ngForOf",s.objs),t.R7$(3),t.Y8G("pageObj",s.pageObj)}}function Ct(r,d){if(1&r&&t.DNE(0,Ft,22,20,"div",4),2&r){const s=t.XpG();t.Y8G("ngIf",s.bookObj)}}let Se=(()=>{var r;class d extends X.H{digitalizedAll(){this.digitalizedObjs(this.objs.filter(i=>"none"==i.currentStatus&&1!=i.isOrc))}runDigitalizedCurrentPage(){this.digitalizedObjs(this.objs.filter(i=>i.isShow&&"none"==i.currentStatus&&1!=i.isOrc))}reDigitalizedOneObj(i){this.digitalizedObjs([i])}digitalizedObjs(i){this.showSuccessSnack(this.commonService.myTranslateInstant("lang_cms_admin_digitalized_for_total_object")+": "+i.length);let a=i.map(m=>m.id);this.objs.forEach(m=>!!a.includes(m.id)&&Object.assign(m,{...m,currentStatus:"calling_ocr_api"}));let c=[];i.forEach(m=>c.push(this.runDigitalizeOneImage(m))),this.waitDestroy(this.sAztConcurrencyApiService.processObservables(1,c,!1).subscribe(m=>{}))}runDigitalizeOneImage(i){return this.sAztDigitalizeService.digitalizeOneImage(i.imageLink,a=>{console.log(`Digitalized for: Id: ${i.id} | Link: ${i.imageLink}`),this.objs.forEach(c=>c.id==i.id&&Object.assign(c,{...c,logMessage:a}))},a=>{console.log(`Digitalized error: Id: ${i.id} | Link: ${i.imageLink} | message: ${a}`),this.objs.forEach(c=>c.id==i.id&&Object.assign(c,{...c,logMessage:a,currentStatus:"none"}))},a=>{this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookId,i.id,a.htmlResult,a.originOcrData,(c,m)=>{if(!c)return console.log(`Digitalized error: Id: ${i.id} | Link: ${i.imageLink} | message: ${m}`),void this.objs.forEach(u=>u.id==i.id&&Object.assign(u,{...u,logMessage:m,currentStatus:"none"}));this.objs.forEach(u=>u.id==i.id&&Object.assign(u,{...u,logMessage:"",currentStatus:"show_edit_form",ocrContent:a.htmlResult,originOcrContent:a.originOcrData,isOrc:1})),this.bookObj.totalDone=this.objs.filter(u=>u.isOrc).length,console.log(`Digitalized success: Id: ${i.id} | Link: ${i.imageLink}`)})})}saveAllContent(){this.initStatusObj();let i=this.objs.filter(c=>1==c.isOrc).map(c=>({bookPageId:c.id,ocrContent:c.htmlContentFormControl.value}));this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrObjsPost({bookId:this.bookId,objs:i}).subscribe(c=>{if(!c.success)return this.errorStatusObj(c.message,!0);this.objs.forEach(m=>{let u=i.find(_=>_.bookPageId==m.id);u&&(m.ocrContent=u.ocrContent)}),this.successStatusObj("lang_cms_update_success",!0)}))}changeBookPageStatus(i){this.objs.forEach(a=>a.id==i.id&&Object.assign(a,{...i}))}exportData(i){let a=new Date;if("txt"==i){let _="";this.objs.forEach(T=>_+=T.originOcrContent+"\n");let C=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.txt`;const z=new Blob([_],{type:"text/plain"});return void(z&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(z),C))}let c="";if(this.objs.forEach(_=>c+=`<page [page]='${_.currentPage}'/>`+(_.ocrContent??"")),c=this.commonService.decodeHtmlEntities(c),"html"==i){c=this.commonService.convertMathTagToLatex(c),c+=(0,be.A3)("PHNjcmlwdD4KCWZ1bmN0aW9uIGdldFNlbGVjdGlvbkh0bWwoKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCA8PSAwKSByZXR1cm4gJyc7CgoJCXZhciByYW5nZSA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApOwoJCXZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQocmFuZ2UuY2xvbmVDb250ZW50cygpKTsKCQlyZXR1cm4gY29udGFpbmVyLmlubmVySFRNTDsKCX0KCWZ1bmN0aW9uIHNob3dTbmFjayhpc1N1Y2Nlc3MsIG1lc3NhZ2UpIHsKCQkvLyBTdGVwIDE6IENyZWF0ZSB0aGUgc25hY2sgZWxlbWVudAoJCXZhciBzbmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXNuYWNrLnRleHRDb250ZW50ID0gbWVzc2FnZTsKCgkJLy8gU3RlcCAyOiBTdHlsZSB0aGUgc25hY2sgZm9yIHRvcCBsZWZ0IGNlbnRlciBwb3NpdGlvbmluZwoJCXNuYWNrLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQlzbmFjay5zdHlsZS50b3AgPSAnMjBweCc7CgkJc25hY2suc3R5bGUubGVmdCA9ICc1MCUnOwoJCXNuYWNrLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKC01MCUpJzsgLy8gQ2VudGVyIGhvcml6b250YWxseQoJCXNuYWNrLnN0eWxlLndpZHRoID0gJzQwMHB4JzsKCQlzbmFjay5zdHlsZS5wYWRkaW5nID0gJzEwcHggMjBweCc7CgkJc25hY2suc3R5bGUuYmFja2dyb3VuZENvbG9yID0gaXNTdWNjZXNzID8gJyM0Q0FGNTAnIDogJ3JlZCc7IC8vIEdyZWVuIGJhY2tncm91bmQgZm9yIHN1Y2Nlc3MKCQlzbmFjay5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CgkJc25hY2suc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CgkJc25hY2suc3R5bGUuYm94U2hhZG93ID0gJzBweCAwcHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSknOwoJCXNuYWNrLnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gRW5zdXJlIGl0J3Mgb24gdG9wIG9mIG90aGVyIGVsZW1lbnRzCgkJc25hY2suc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7IC8vIENlbnRlciB0ZXh0IGhvcml6b250YWxseQoKCQkvLyBTdGVwIDM6IEFwcGVuZCB0aGUgc25hY2sgdG8gdGhlIGJvZHkKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNuYWNrKTsKCgkJLy8gU3RlcCA0OiBSZW1vdmUgdGhlIHNuYWNrIGFmdGVyIDYgc2Vjb25kcwoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCXNuYWNrLnJlbW92ZSgpOwoJCX0sIDEwMDApOyAvLyAxMDAwIG1pbGxpc2Vjb25kcyA9IDEgc2Vjb25kcwoJfQoJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5yYW5nZUNvdW50IDw9IDApIHJldHVybjsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oKSB7CgkJCXZhciBodG1sU291cmNlID0gZ2V0U2VsZWN0aW9uSHRtbCgpOwoJCQlpZiAoIWh0bWxTb3VyY2UpIHJldHVybjsKCgkJCW5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGh0bWxTb3VyY2UpLnRoZW4oZnVuY3Rpb24oKSB7CgkJCQlzaG93U25hY2sodHJ1ZSwgJ0NvcHkgdGjDoG5oIGPDtG5nIScpOwoJCQl9KS5jYXRjaChmdW5jdGlvbihlcnIpIHsKCQkJCXNob3dTbmFjayhmYWxzZSwgJ0NvcHkgbOG7l2k6ICcgKyBlcnIpOwoJCQl9KTsKCQl9LCB7CgkJCW9uY2U6IHRydWUKCQl9KTsKCX0pOwo8L3NjcmlwdD4=");let C=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.html`;const z=new Blob([c],{type:"text/plain"});return void(z&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(z),C))}let m=this.userService.getUserObj(),u=re.c.azt_ai_base_api;this.commonService.loadAzotaDocxJs().then(()=>{(0,_e.w)().textToDocxBinary(c,"Bearer "+m.rememberToken,u,null).then(_=>{let C=`azota-digitalize-book-${a.getDate()}${a.getMonth()+1}${a.getFullYear()}-${a.getTime()}.docx`;const z=new Blob([_],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});z&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(z),C)}).catch(_=>{this.showErrorSnack(_)})}).catch(_=>{this.showErrorSnack(_)})}goToPage(i){this.myNavigation(`/azota-digitalized/digitalized-one-book/${this.bookId}/${i}`),this.pageObj.setTotalPages(this.objs.length),this.pageObj.setPageNumber(i);let a=this.pageObj.getViewObjsOfCurrentPage(this.objs).map(c=>c.id);this.objs.forEach(c=>c.isShow=!!a.includes(c.id)),this.totalCurrentItems=this.objs.filter(c=>c.isShow).length}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageGetObjsGet(this.bookId).subscribe(i=>{if(!i.success||!i.data)return this.errorStatusObj(i.message,!0);this.bookObj=i.data.bookObj,this.objs=i.data.bookPageObjs.map((a,c)=>({...a,isShow:!1,currentPage:c+1,ocrContent:a.ocrContent?this.sAztZipDataService.decodeContentGzip(a.ocrContent):void 0,originOcrContent:a.originOcrContent?this.sAztZipDataService.decodeContentGzip(a.originOcrContent):void 0,logMessage:a.isOrc?void 0:"lang_cms_admin_digitalized_not_call_ocr_status",currentStatus:a.isOrc?"show_edit_form":"none",base64Images:[],htmlContentFormControl:new k.MJ("",{nonNullable:!0})}))??[],this.goToPage(Number(this.commonService.getMyParam(this.activeRoute,"page")??0)),this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_digitalized_one_book_title",description:"lang_cms_admin_digitalized_one_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.initData()}constructor(i,a,c,m,u,_){super(),(0,f.A)(this,"digitalizedBookPageService",void 0),(0,f.A)(this,"activeRoute",void 0),(0,f.A)(this,"sAztZipDataService",void 0),(0,f.A)(this,"sAztDigitalizeService",void 0),(0,f.A)(this,"sAztConcurrencyApiService",void 0),(0,f.A)(this,"userService",void 0),(0,f.A)(this,"objs",[]),(0,f.A)(this,"bookId",0),(0,f.A)(this,"backTo","/azota-digitalized/list-books"),(0,f.A)(this,"bookObj",void 0),(0,f.A)(this,"pageObj",new Ot.d(10)),(0,f.A)(this,"totalCurrentItems",0),this.digitalizedBookPageService=i,this.activeRoute=a,this.sAztZipDataService=c,this.sAztDigitalizeService=m,this.sAztConcurrencyApiService=u,this.userService=_}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)(t.rXU(j.gI),t.rXU(M.nX),t.rXU(Nt.j),t.rXU(at),t.rXU(se),t.rXU(tt.R))}),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-digitalized-one-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:3,consts:[["doneLoading",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],["class","mt-5",4,"ngIf"],[1,"mt-5"],[1,"flex","items-center","mb-3","pb-3",2,"border-bottom","1px solid #ccc"],[1,"btn","btn-primary","mr-3",3,"click"],[1,"btn","btn-success","mr-3",3,"click"],[1,"box"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","flex-wrap","sm:flex-row","sm:flex-nowrap","items-center","mt-3"],[1,"w-full","sm:w-auto","sm:mr-auto"],[3,"goToPaginationPage","pageObj"],[4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent",4,"ngIf"],[3,"obj",4,"ngIf"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","obj"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent","bookObj","obj"],[3,"obj"]],template:function(i,a){if(1&i&&(t.j41(0,"teacher-layout",1),t.DNE(1,Be,1,1,"azt-loading-effect",2)(2,Ct,1,1,"ng-template",null,0,t.C5r),t.k0s()),2&i){const c=t.sdS(3);t.Y8G("headerBackToLink",a.backTo),t.R7$(),t.Y8G("ngIf",a.statusObj.loading)("ngIfElse",c)}},dependencies:[G.Q,D.K,A,ze,oe,It.q,w.MD,w.Sq,w.bT,k.X1,M.iI,k.YN,O.wp,V.s,B.flO,P.L,U.Id,L.k],encapsulation:2})),d})();var Ut=v(72313);class le{static validBookPage(d){const s=d;return s.controls.filter(a=>a.controls.isShow.value).length>0?(d.setErrors(null),null):(s.setErrors({validBookPage:!0}),{identityRevealed:!0})}}var $=v(88959);let F=(()=>{var r;class d extends X.H{removeBackgroundNoise(i){this.initStatusObj();let c=this.form.controls.bookPageFormArray.getRawValue().filter(m=>(!!i||m.isSelected)&&m.isShow).map(m=>this.sAztDigitalizeService.runRemoveBackgroundNoise({uuid:m.randomUuid,oldImageUrl:m.imageLink,newImageUrl:""},this.defaultThreshold,u=>console.log("Remove noise error",u)));this.waitDestroy(this.sAztConcurrencyApiService.processObservables(20,c,!1).subscribe(m=>{let u=this.form.controls.bookPageFormArray.getRawValue();u.forEach(_=>{let C=m.find(z=>z?.uuid==z?.uuid)?.newImageUrl;C&&(_.imageLink=C,_.needUpdate=!0)}),this.form.controls.bookPageFormArray.patchValue(u),this.stopStatusObj()}))}selectAll(i){this.form.controls.bookPageFormArray.controls.map(a=>a.controls.isSelected.setValue(i))}deleteAllSelected(){this.form.controls.bookPageFormArray.controls.forEach(i=>{i.controls.isSelected.value&&i.controls.isShow.setValue(!1)})}countSelected(){this.totalPage=this.form.controls.bookPageFormArray.getRawValue().filter(i=>i.isShow).length,this.totalSelectedPage=this.form.controls.bookPageFormArray.getRawValue().filter(i=>i.isShow&&i.isSelected).length}cancel(){this.commonService.myNavigation(this.backTo)}handleUploadComplete(i){i.forEach(a=>{a.url&&this.form.controls.bookPageFormArray.push(new k.gE({id:new k.MJ(0,{nonNullable:!0}),randomUuid:new k.MJ(this.sAztUuidService.getUuid(),{nonNullable:!0}),name:new k.MJ(a.name??"",{nonNullable:!0}),imageLink:new k.MJ(a.url,{nonNullable:!0}),isShow:new k.MJ(!0,{nonNullable:!0}),isSelected:new k.MJ(!1,{nonNullable:!0}),needUpdate:new k.MJ(!1,{nonNullable:!0})}))}),this.form.controls.bookPageFormArray.updateValueAndValidity()}removeBookPageObj(i){let a=this.form.controls.bookPageFormArray.controls.find(c=>c.controls.randomUuid.value==i);a?.controls.isShow.setValue(!1),this.form.controls.bookPageFormArray.updateValueAndValidity()}constructor(){super(),(0,f.A)(this,"sAztUuidService",(0,t.WQX)(dt.D)),(0,f.A)(this,"sAztDigitalizeService",(0,t.WQX)(at)),(0,f.A)(this,"sAztConcurrencyApiService",(0,t.WQX)(se)),(0,f.A)(this,"backTo",""),(0,f.A)(this,"form",void 0),(0,f.A)(this,"allUploadToCdnMenuTypes",bt.b8),(0,f.A)(this,"allUploadFileTypes",bt.PO),(0,f.A)(this,"totalSelectedPage",0),(0,f.A)(this,"totalPage",0),(0,f.A)(this,"defaultThreshold",230),this.form=new k.gE({name:new k.MJ("",{nonNullable:!0,validators:[$.M.noWhiteSpace]}),bookPageFormArray:new k.Yp([],{validators:[le.validBookPage]})}),this.form.valueChanges.subscribe(i=>this.countSelected())}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)}),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-base-create-or-update-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:0,vars:0,template:function(i,a){},dependencies:[w.MD,k.X1,M.iI,k.YN,V.s,B.flO,P.L,U.Id,L.k],encapsulation:2})),d})();var mt=v(98209),ce=v(36274);const Vt=r=>({"error-border":r}),Te=(r,d)=>[r,d];function de(r,d){if(1&r&&t.nrm(0,"azt-loading-effect",4),2&r){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function pe(r,d){if(1&r){const s=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(a){t.eBV(s);const c=t.XpG(2);return t.Njj(c.handleUploadComplete(a))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&r){const s=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",s.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,Te,s.allUploadFileTypes.IMAGE,s.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function zt(r,d){if(1&r){const s=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&r){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",s.totalSelectedPage,"/",s.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",s.totalSelectedPage,"/",s.totalPage,")")}}function Ee(r,d){1&r&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function xt(r,d){if(1&r&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&r){const s=d.$implicit,i=d.index;t.R7$(),t.Y8G("hidden",!s.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",s.controls.imageLink.value),t.R7$(),t.Y8G("src",s.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(i+1),t.R7$(),t.Y8G("formControl",s.controls.isSelected)}}function Re(r,d){if(1&r&&(t.j41(0,"div",31),t.DNE(1,xt,8,5,"ng-container",32),t.k0s()),2&r){const s=t.XpG(2);t.R7$(),t.Y8G("ngForOf",s.form.controls.bookPageFormArray.controls)}}function et(r,d){if(1&r){const s=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,pe,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.selectAll(a.totalSelectedPage!=a.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,zt,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,Ee,3,3,"div",25)(34,Re,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&r){const s=t.sdS(35),i=t.XpG();t.R7$(),t.Y8G("formGroup",i.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,i.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",i.form.controls.name)("ngClass",t.eq3(35,Vt,i.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!i.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,i.totalSelectedPage!=i.totalPage?"lang_select_all":"lang_remove_all")," (",i.totalSelectedPage,"/",i.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",i.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",i.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",s),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let Me=(()=>{var r;class d extends F{initForm(){}initData(){}saveObj(){this.initStatusObj();let i=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookAddObjPost({name:i.name}).subscribe(c=>{if(!c.success||!c.data?.obj)return this.errorStatusObj(c.message,!0);let m={bookId:c.data.obj.id,bookPageObjs:[]};i.bookPageFormArray.filter(u=>u.isShow).forEach(u=>{m.bookPageObjs.push({name:u.name,imageLink:u.imageLink})}),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageAddObjsPost(m).subscribe(u=>{if(!u.success)return this.errorStatusObj(u.message,!0);this.successStatusObj("lang_cms_add_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_create_book_title",description:"lang_cms_admin_create_book_title",image:"lang_cms_test_image"}),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(i,a){super(),(0,f.A)(this,"digitalizedBookService",void 0),(0,f.A)(this,"digitalizedBookPageService",void 0),(0,f.A)(this,"bookId",0),this.digitalizedBookService=i,this.digitalizedBookPageService=a}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)(t.rXU(mt.Z),t.rXU(ce.g))}),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-create-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(i,a){if(1&i&&(t.j41(0,"teacher-layout",2),t.DNE(1,de,1,1,"azt-loading-effect",3)(2,et,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&i){const c=t.sdS(3);t.Y8G("headerBackToLink",a.backTo),t.R7$(),t.Y8G("ngIf",1==a.statusObj.loading)("ngIfElse",c)}},dependencies:[G.Q,D.K,Ut.V,Dt,w.MD,w.YU,w.Sq,w.bT,k.X1,k.qT,k.me,k.Zm,k.BC,k.cb,k.l_,k.j4,M.iI,k.YN,O.wp,V.s,B.flO,B.WGl,P.L,U.Id,L.k],encapsulation:2})),d})();const Ne=r=>({"error-border":r}),ge=(r,d)=>[r,d];function Pe(r,d){if(1&r&&t.nrm(0,"azt-loading-effect",4),2&r){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function Ge(r,d){if(1&r){const s=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(a){t.eBV(s);const c=t.XpG(2);return t.Njj(c.handleUploadComplete(a))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&r){const s=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",s.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,ge,s.allUploadFileTypes.IMAGE,s.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Fe(r,d){if(1&r){const s=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(s);const a=t.XpG(2);return t.Njj(a.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&r){const s=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",s.totalSelectedPage,"/",s.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",s.totalSelectedPage,"/",s.totalPage,")")}}function Ue(r,d){1&r&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function Ve(r,d){if(1&r&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&r){const s=d.$implicit,i=d.index;t.R7$(),t.Y8G("hidden",!s.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",s.controls.imageLink.value),t.R7$(),t.Y8G("src",s.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(i+1),t.R7$(),t.Y8G("formControl",s.controls.isSelected)}}function Ye(r,d){if(1&r&&(t.j41(0,"div",31),t.DNE(1,Ve,8,5,"ng-container",32),t.k0s()),2&r){const s=t.XpG(2);t.R7$(),t.Y8G("ngForOf",s.form.controls.bookPageFormArray.controls)}}function Le(r,d){if(1&r){const s=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,Ge,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.selectAll(a.totalSelectedPage!=a.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,Fe,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,Ue,3,3,"div",25)(34,Ye,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&r){const s=t.sdS(35),i=t.XpG();t.R7$(),t.Y8G("formGroup",i.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,i.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",i.form.controls.name)("ngClass",t.eq3(35,Ne,i.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!i.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,i.totalSelectedPage!=i.totalPage?"lang_select_all":"lang_remove_all")," (",i.totalSelectedPage,"/",i.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",i.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",i.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",s),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",i.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let Xe=(()=>{var r;class d extends F{initForm(i){this.form.controls.name.setValue(i.bookObj.name),i.bookPageObjs.forEach(a=>{this.form.controls.bookPageFormArray.push(new k.gE({id:new k.MJ(a.id,{nonNullable:!0}),randomUuid:new k.MJ(a.id.toString(),{nonNullable:!0}),name:new k.MJ(a.name,{nonNullable:!0}),imageLink:new k.MJ(a.imageLink,{nonNullable:!0}),isShow:new k.MJ(!0,{nonNullable:!0}),isSelected:new k.MJ(!1,{nonNullable:!0}),needUpdate:new k.MJ(!1,{nonNullable:!0})}))})}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjGet(this.bookId).subscribe(i=>{if(!i.success||!i.data)return this.errorStatusObj(i.message,!0);this.initForm(i.data),this.stopStatusObj()}))}saveObj(){this.initStatusObj();let i=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookUpdateObjPost({id:this.bookId,name:i.name}).subscribe(c=>{if(!c.success)return this.errorStatusObj(c.message,!0);let m={bookId:this.bookId,objs:i.bookPageFormArray.filter(_=>_.needUpdate&&_.id).map(_=>({bookPageId:_.id,imageLink:_.imageLink}))},u={bookId:this.bookId,ids:i.bookPageFormArray.filter(_=>!_.isShow&&_.id).map(_=>_.id)};if(m.objs.length<=0)return this.processDeleteImages(u);this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateImagesPost(m).subscribe(_=>{this.processDeleteImages(u)}))}))}processDeleteImages(i){i.ids.length>0?this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageDeleteObjPost(i).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);this.successStatusObj("lang_cms_update_success",!0),this.cancel()})):(this.successStatusObj("lang_cms_update_success",!0),this.cancel())}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_edit_book_title",description:"lang_cms_admin_edit_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(i,a,c){super(),(0,f.A)(this,"digitalizedBookService",void 0),(0,f.A)(this,"digitalizedBookPageService",void 0),(0,f.A)(this,"activeRoute",void 0),(0,f.A)(this,"bookId",0),this.digitalizedBookService=i,this.digitalizedBookPageService=a,this.activeRoute=c}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)(t.rXU(j.ZD),t.rXU(j.gI),t.rXU(M.nX))}),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-update-book"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(i,a){if(1&i&&(t.j41(0,"teacher-layout",2),t.DNE(1,Pe,1,1,"azt-loading-effect",3)(2,Le,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&i){const c=t.sdS(3);t.Y8G("headerBackToLink",a.backTo),t.R7$(),t.Y8G("ngIf",1==a.statusObj.loading)("ngIfElse",c)}},dependencies:[G.Q,D.K,Ut.V,Dt,w.MD,w.YU,w.Sq,w.bT,k.X1,k.qT,k.me,k.Zm,k.BC,k.cb,k.l_,k.j4,M.iI,k.YN,O.wp,V.s,B.flO,B.WGl,P.L,U.Id,L.k],encapsulation:2})),d})();var $e=v(55893),he=v(25596);const We=r=>[r],Yt=()=>({"mr-1":!0});function Je(r,d){if(1&r&&t.nrm(0,"azt-loading-effect",5),2&r){const s=t.XpG();t.Y8G("currentStatusObj",s.statusObj)}}function me(r,d){1&r&&(t.j41(0,"span",25),t.nrm(1,"azt-loading-ui"),t.k0s())}function l(r,d){if(1&r){const s=t.RV6();t.qex(0),t.j41(1,"mat-card",13)(2,"mat-card-content",14)(3,"div",15)(4,"div",7)(5,"b"),t.EFF(6),t.k0s(),t.EFF(7),t.k0s(),t.j41(8,"div",16)(9,"button",17),t.nI1(10,"navigationLocalize"),t.nrm(11,"lucide-icon",18),t.j41(12,"span",19),t.EFF(13),t.nI1(14,"mytranslate"),t.k0s()(),t.j41(15,"a",20),t.nI1(16,"navigationLocalize"),t.nrm(17,"lucide-icon",21),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s(),t.j41(20,"button",22),t.bIt("click",function(){const a=t.eBV(s).$implicit,c=t.XpG(3);return t.Njj(c.deleteObj(a))}),t.DNE(21,me,2,0,"span",23),t.nrm(22,"lucide-icon",24),t.j41(23,"span",19),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()()()(),t.bVm()}if(2&r){const s=d.$implicit,i=d.index,a=t.XpG(3);t.R7$(6),t.SpI("",i+1,"."),t.R7$(),t.E5c(" ",s.name," (",s.totalDone," / ",s.totalPage,") "),t.R7$(2),t.Y8G("routerLink",t.bMT(10,13,"/azota-digitalized/digitalized-one-book/"+s.id+"/1")),t.R7$(2),t.Y8G("ngClass",t.lJ4(23,Yt)),t.R7$(2),t.JRh(t.bMT(14,15,"lang_cms_admin_digitalized_digitalized_btn")),t.R7$(2),t.Y8G("routerLink",t.bMT(16,17,"/azota-digitalized/edit-book/"+s.id)),t.R7$(2),t.Y8G("ngClass",t.lJ4(24,Yt)),t.R7$(),t.SpI(" ",t.bMT(19,19,"lang_auto_sua")," "),t.R7$(3),t.Y8G("ngIf",a.deletingId==s.id),t.R7$(),t.Y8G("ngClass",t.lJ4(25,Yt)),t.R7$(2),t.JRh(t.bMT(25,21,"lang_auto_xoa"))}}function e(r,d){if(1&r&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.DNE(3,l,26,26,"ng-container",12),t.k0s()(),t.bVm()),2&r){const s=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",s.objs)}}function n(r,d){1&r&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"lang_cms_admin_digitalized_there_is_no_book")))}function o(r,d){if(1&r&&(t.j41(0,"div",6)(1,"span",7),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"a",8),t.nI1(5,"navigationLocalize"),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.DNE(8,e,4,1,"ng-container",9)(9,n,3,3,"ng-template",null,1,t.C5r)),2&r){const s=t.sdS(10),i=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"lang_cms_admin_common_digitalize_list_book")),t.R7$(2),t.Y8G("routerLink",t.eq3(11,We,t.bMT(5,7,"/azota-digitalized/create-book"))),t.R7$(2),t.JRh(t.bMT(7,9,"lang_common_create")),t.R7$(2),t.Y8G("ngIf",i.objs.length>0)("ngIfElse",s)}}const p=[{path:"",component:Lt.z,children:[{path:"list-books",component:(()=>{var r;class d extends X.H{deleteObj(i){const a=this.commonService.myTranslateInstant("lang_cms_admin_digitalized_are_your_sure_to_delete_this_book")+`: <b>${i.name}<b/>?`;this.sAztDialogService.open($e.u,{data:{content:a},restoreFocus:!1,width:"500px"}).afterClosed().subscribe(c=>{c&&(this.deletingId=i.id,this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookDeleteObjPost({ids:[i.id]}).subscribe(m=>{if(this.deletingId=void 0,!m.success)return this.errorStatusObj(m.message,!0);this.objs=this.objs.filter(u=>u.id!=i.id)})))})}getData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjsGet().subscribe(i=>{if(!i.success)return this.errorStatusObj(i.message,!0);this.objs=i.data?.objs??[],this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.getData(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_list_book",description:"lang_cms_admin_common_digitalize_list_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(i,a){super(),(0,f.A)(this,"digitalizedBookService",void 0),(0,f.A)(this,"sAztDialogService",void 0),(0,f.A)(this,"headerBackTo",""),(0,f.A)(this,"objs",[]),(0,f.A)(this,"deletingId",void 0),this.digitalizedBookService=i,this.sAztDialogService=a}}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)(t.rXU(j.ZD),t.rXU(ot.i))}),(0,f.A)(d,"\u0275cmp",t.VBU({type:r,selectors:[["app-digitalized-list-books"]],standalone:!0,features:[t.Vt3,t.aNF],decls:5,vars:3,consts:[["doneLoading",""],["emptyList",""],[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"flex","items-center","mb-3"],[1,"w-full"],[1,"flex-none","btn","btn-primary",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],["appearance","outlined",1,"mb-2",2,"background-color","#fff","border","none"],[1,"form-control",2,"overflow-y","auto"],[1,"flex","align-items-center"],[1,"flex-none","items-center"],[1,"btn","btn-sm","btn-success-soft","mr-2",3,"routerLink"],["name","eye","size","18",3,"ngClass"],[1,"azt-hidden","md:inline-block"],[1,"btn","btn-sm","btn-primary-soft","mr-2",3,"routerLink"],["name","square-pen","size","18",3,"ngClass"],[1,"btn","btn-sm","btn-danger-soft",3,"click"],["class","w-4 h-4 flex mr-1",4,"ngIf"],["name","trash-2","size","18",3,"ngClass"],[1,"w-4","h-4","flex","mr-1"],[1,"text-center"]],template:function(i,a){if(1&i&&(t.j41(0,"teacher-layout",2)(1,"div",3),t.DNE(2,Je,1,1,"azt-loading-effect",4)(3,o,11,13,"ng-template",null,0,t.C5r),t.k0s()()),2&i){const c=t.sdS(4);t.Y8G("headerBackToLink",a.headerBackTo),t.R7$(2),t.Y8G("ngIf",a.statusObj.loading)("ngIfElse",c)}},dependencies:[G.Q,D.K,vt.R,O.F2,w.MD,w.YU,w.Sq,w.bT,k.X1,M.iI,M.Wk,k.YN,O.wp,V.s,he.RN,he.m2,B.flO,B.WGl,P.L,U.Id,L.k],encapsulation:2})),d})()},{path:"create-book",component:Me},{path:"edit-book/:bookId",component:Xe},{path:"digitalized-one-book/:bookId/:page",component:Se}]}];let h=(()=>{var r;class d{}return r=d,(0,f.A)(d,"\u0275fac",function(i){return new(i||r)}),(0,f.A)(d,"\u0275mod",t.$C({type:r})),(0,f.A)(d,"\u0275inj",t.G2t({imports:[M.iI.forChild(p),M.iI,fe.XE]})),d})()},1054:function(Qe){Qe.exports=function(){"use strict";function lt(l){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(l)}function f(l,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(l,o.key,o)}}function fe(l,e,n){return e in l?Object.defineProperty(l,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):l[e]=n,l}function Lt(l,e){var n=Object.keys(l);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(l);e&&(o=o.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),n.push.apply(n,o)}return n}function w(l){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lt(Object(n),!0).forEach(function(o){fe(l,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach(function(o){Object.defineProperty(l,o,Object.getOwnPropertyDescriptor(n,o))})}return l}function k(l){return function L(l){if(Array.isArray(l))return P(l)}(l)||function _e(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}(l)||function O(l,e){if(l){if("string"==typeof l)return P(l,e);var n=Object.prototype.toString.call(l).slice(8,-1);if("Object"===n&&l.constructor&&(n=l.constructor.name),"Map"===n||"Set"===n)return Array.from(l);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(l,e)}}(l)||function be(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(l,e){(null==e||e>l.length)&&(e=l.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=l[n];return o}var X=typeof window<"u"&&typeof window.document<"u",G=X?window:{},It=!(!X||!G.document.documentElement)&&"ontouchstart"in G.document.documentElement,Ot=!!X&&"PointerEvent"in G,D="cropper",B="all",U="crop",V="move",t="zoom",K="e",J="w",H="s",q="n",ft="ne",ct="nw",_t="se",dt="sw",bt="".concat(D,"-crop"),Xt="".concat(D,"-disabled"),j="".concat(D,"-hidden"),$t="".concat(D,"-hide"),Bt="".concat(D,"-invisible"),at="".concat(D,"-modal"),vt="".concat(D,"-move"),ot="".concat(D,"Action"),kt="".concat(D,"Preview"),jt="crop",St="crop",Ht="cropend",Tt="cropmove",Et="cropstart",Zt="dblclick",Qt=Ot?"pointerdown":It?"touchstart":"mousedown",Kt=Ot?"pointermove":It?"touchmove":"mousemove",qt=Ot?"pointerup pointercancel":It?"touchend touchcancel":"mouseup",Rt="zoom",ae="image/jpeg",ze=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Ae=/^data:/,we=/^data:image\/jpeg;base64,/,Dt=/^img|canvas$/i,ne={viewMode:0,dragMode:jt,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},De=Number.isNaN||G.isNaN;function A(l){return"number"==typeof l&&!De(l)}var re=function(e){return e>0&&e<1/0};function Nt(l){return typeof l>"u"}function nt(l){return"object"===lt(l)&&null!==l}var xe=Object.prototype.hasOwnProperty;function pt(l){if(!nt(l))return!1;try{var e=l.constructor,n=e.prototype;return e&&n&&xe.call(n,"isPrototypeOf")}catch{return!1}}function N(l){return"function"==typeof l}var Ie=Array.prototype.slice;function Pt(l){return Array.from?Array.from(l):Ie.call(l)}function I(l,e){return l&&N(e)&&(Array.isArray(l)||A(l.length)?Pt(l).forEach(function(n,o){e.call(l,n,o,l)}):nt(l)&&Object.keys(l).forEach(function(n){e.call(l,l[n],n,l)})),l}var x=Object.assign||function(e){for(var n=arguments.length,o=new Array(n>1?n-1:0),g=1;g<n;g++)o[g-1]=arguments[g];return nt(e)&&o.length>0&&o.forEach(function(p){nt(p)&&Object.keys(p).forEach(function(h){e[h]=p[h]})}),e},Oe=/\.\d*(?:0|9){12}\d*$/;function gt(l){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Oe.test(l)?Math.round(l*e)/e:l}var se=/^width|height|left|top|marginLeft|marginTop$/;function tt(l,e){var n=l.style;I(e,function(o,g){se.test(g)&&A(o)&&(o="".concat(o,"px")),n[g]=o})}function S(l,e){if(e){if(A(l.length))return void I(l,function(o){S(o,e)});if(l.classList)return void l.classList.add(e);var n=l.className.trim();n?n.indexOf(e)<0&&(l.className="".concat(n," ").concat(e)):l.className=e}}function Z(l,e){if(e){if(A(l.length))return void I(l,function(n){Z(n,e)});if(l.classList)return void l.classList.remove(e);l.className.indexOf(e)>=0&&(l.className=l.className.replace(e,""))}}function ht(l,e,n){if(e){if(A(l.length))return void I(l,function(o){ht(o,e,n)});n?S(l,e):Z(l,e)}}var je=/([a-z\d])([A-Z])/g;function Gt(l){return l.replace(je,"$1-$2").toLowerCase()}function Ft(l,e){return nt(l[e])?l[e]:l.dataset?l.dataset[e]:l.getAttribute("data-".concat(Gt(e)))}function Ct(l,e,n){nt(n)?l[e]=n:l.dataset?l.dataset[e]=n:l.setAttribute("data-".concat(Gt(e)),n)}var Ut=/\s\s*/,le=function(){var l=!1;if(X){var e=!1,n=function(){},o=Object.defineProperty({},"once",{get:function(){return l=!0,e},set:function(p){e=p}});G.addEventListener("test",n,o),G.removeEventListener("test",n,o)}return l}();function $(l,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=n;e.trim().split(Ut).forEach(function(p){if(!le){var h=l.listeners;h&&h[p]&&h[p][n]&&(g=h[p][n],delete h[p][n],0===Object.keys(h[p]).length&&delete h[p],0===Object.keys(h).length&&delete l.listeners)}l.removeEventListener(p,g,o)})}function F(l,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=n;e.trim().split(Ut).forEach(function(p){if(o.once&&!le){var h=l.listeners,r=void 0===h?{}:h;g=function(){delete r[p][n],l.removeEventListener(p,g,o);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];n.apply(l,i)},r[p]||(r[p]={}),r[p][n]&&l.removeEventListener(p,r[p][n],o),r[p][n]=g,l.listeners=r}l.addEventListener(p,g,o)})}function mt(l,e,n){var o;return N(Event)&&N(CustomEvent)?o=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0}):(o=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,n),l.dispatchEvent(o)}function ce(l){var e=l.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var Vt=G.location,Te=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function de(l){var e=l.match(Te);return null!==e&&(e[1]!==Vt.protocol||e[2]!==Vt.hostname||e[3]!==Vt.port)}function pe(l){var e="timestamp=".concat((new Date).getTime());return l+(-1===l.indexOf("?")?"?":"&")+e}function zt(l){var e=l.rotate,n=l.scaleX,o=l.scaleY,g=l.translateX,p=l.translateY,h=[];A(g)&&0!==g&&h.push("translateX(".concat(g,"px)")),A(p)&&0!==p&&h.push("translateY(".concat(p,"px)")),A(e)&&0!==e&&h.push("rotate(".concat(e,"deg)")),A(n)&&1!==n&&h.push("scaleX(".concat(n,")")),A(o)&&1!==o&&h.push("scaleY(".concat(o,")"));var r=h.length?h.join(" "):"none";return{WebkitTransform:r,msTransform:r,transform:r}}function xt(l,e){var n=l.pageX,o=l.pageY,g={endX:n,endY:o};return e?g:w({startX:n,startY:o},g)}function et(l){var e=l.aspectRatio,n=l.height,o=l.width,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",p=re(o),h=re(n);if(p&&h){var r=n*e;"contain"===g&&r>o||"cover"===g&&r<o?n=o/e:o=n*e}else p?n=o/e:h&&(o=n*e);return{width:o,height:n}}var ge=String.fromCharCode;var Ge=/^data:.*,/;function Ve(l){var n,e=new DataView(l);try{var o,g,p;if(255===e.getUint8(0)&&216===e.getUint8(1))for(var h=e.byteLength,r=2;r+1<h;){if(255===e.getUint8(r)&&225===e.getUint8(r+1)){g=r;break}r+=1}if(g){var s=g+10;if("Exif"===function Pe(l,e,n){var o="";n+=e;for(var g=e;g<n;g+=1)o+=ge(l.getUint8(g));return o}(e,g+4,4)){var i=e.getUint16(s);if(((o=18761===i)||19789===i)&&42===e.getUint16(s+2,o)){var a=e.getUint32(s+4,o);a>=8&&(p=s+a)}}}if(p){var m,u,c=e.getUint16(p,o);for(u=0;u<c;u+=1)if(274===e.getUint16(m=p+12*u+2,o)){n=e.getUint16(m+=8,o),e.setUint16(m,1,o);break}}}catch{n=1}return n}var Le={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,n=this.options,o=this.container,g=this.cropper,p=Number(n.minContainerWidth),h=Number(n.minContainerHeight);S(g,j),Z(e,j);var r={width:Math.max(o.offsetWidth,p>=0?p:200),height:Math.max(o.offsetHeight,h>=0?h:100)};this.containerData=r,tt(g,{width:r.width,height:r.height}),S(e,j),Z(g,j)},initCanvas:function(){var e=this.containerData,n=this.imageData,o=this.options.viewMode,g=Math.abs(n.rotate)%180==90,p=g?n.naturalHeight:n.naturalWidth,h=g?n.naturalWidth:n.naturalHeight,r=p/h,d=e.width,s=e.height;e.height*r>e.width?3===o?d=e.height*r:s=e.width/r:3===o?s=e.width/r:d=e.height*r;var i={aspectRatio:r,naturalWidth:p,naturalHeight:h,width:d,height:s};this.canvasData=i,this.limited=1===o||2===o,this.limitCanvas(!0,!0),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),i.left=(e.width-i.width)/2,i.top=(e.height-i.height)/2,i.oldLeft=i.left,i.oldTop=i.top,this.initialCanvasData=x({},i)},limitCanvas:function(e,n){var o=this.options,g=this.containerData,p=this.canvasData,h=this.cropBoxData,r=o.viewMode,d=p.aspectRatio,s=this.cropped&&h;if(e){var i=Number(o.minCanvasWidth)||0,a=Number(o.minCanvasHeight)||0;r>1?(i=Math.max(i,g.width),a=Math.max(a,g.height),3===r&&(a*d>i?i=a*d:a=i/d)):r>0&&(i?i=Math.max(i,s?h.width:0):a?a=Math.max(a,s?h.height:0):s&&((a=h.height)*d>(i=h.width)?i=a*d:a=i/d));var c=et({aspectRatio:d,width:i,height:a});a=c.height,p.minWidth=i=c.width,p.minHeight=a,p.maxWidth=1/0,p.maxHeight=1/0}if(n)if(r>(s?0:1)){var m=g.width-p.width,u=g.height-p.height;p.minLeft=Math.min(0,m),p.minTop=Math.min(0,u),p.maxLeft=Math.max(0,m),p.maxTop=Math.max(0,u),s&&this.limited&&(p.minLeft=Math.min(h.left,h.left+(h.width-p.width)),p.minTop=Math.min(h.top,h.top+(h.height-p.height)),p.maxLeft=h.left,p.maxTop=h.top,2===r&&(p.width>=g.width&&(p.minLeft=Math.min(0,m),p.maxLeft=Math.max(0,m)),p.height>=g.height&&(p.minTop=Math.min(0,u),p.maxTop=Math.max(0,u))))}else p.minLeft=-p.width,p.minTop=-p.height,p.maxLeft=g.width,p.maxTop=g.height},renderCanvas:function(e,n){var o=this.canvasData,g=this.imageData;if(n){var p=function Me(l){var e=l.width,n=l.height,o=l.degree;if(90==(o=Math.abs(o)%180))return{width:n,height:e};var g=o%90*Math.PI/180,p=Math.sin(g),h=Math.cos(g),r=e*h+n*p,d=e*p+n*h;return o>90?{width:d,height:r}:{width:r,height:d}}({width:g.naturalWidth*Math.abs(g.scaleX||1),height:g.naturalHeight*Math.abs(g.scaleY||1),degree:g.rotate||0}),h=p.width,r=p.height,d=o.width*(h/o.naturalWidth),s=o.height*(r/o.naturalHeight);o.left-=(d-o.width)/2,o.top-=(s-o.height)/2,o.width=d,o.height=s,o.aspectRatio=h/r,o.naturalWidth=h,o.naturalHeight=r,this.limitCanvas(!0,!1)}(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),this.limitCanvas(!1,!0),o.left=Math.min(Math.max(o.left,o.minLeft),o.maxLeft),o.top=Math.min(Math.max(o.top,o.minTop),o.maxTop),o.oldLeft=o.left,o.oldTop=o.top,tt(this.canvas,x({width:o.width,height:o.height},zt({translateX:o.left,translateY:o.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var n=this.canvasData,o=this.imageData,g=o.naturalWidth*(n.width/n.naturalWidth),p=o.naturalHeight*(n.height/n.naturalHeight);x(o,{width:g,height:p,left:(n.width-g)/2,top:(n.height-p)/2}),tt(this.image,x({width:o.width,height:o.height},zt(x({translateX:o.left,translateY:o.top},o)))),e&&this.output()},initCropBox:function(){var e=this.options,n=this.canvasData,o=e.aspectRatio||e.initialAspectRatio,g=Number(e.autoCropArea)||.8,p={width:n.width,height:n.height};o&&(n.height*o>n.width?p.height=p.width/o:p.width=p.height*o),this.cropBoxData=p,this.limitCropBox(!0,!0),p.width=Math.min(Math.max(p.width,p.minWidth),p.maxWidth),p.height=Math.min(Math.max(p.height,p.minHeight),p.maxHeight),p.width=Math.max(p.minWidth,p.width*g),p.height=Math.max(p.minHeight,p.height*g),p.left=n.left+(n.width-p.width)/2,p.top=n.top+(n.height-p.height)/2,p.oldLeft=p.left,p.oldTop=p.top,this.initialCropBoxData=x({},p)},limitCropBox:function(e,n){var o=this.options,g=this.containerData,p=this.canvasData,h=this.cropBoxData,r=this.limited,d=o.aspectRatio;if(e){var s=Number(o.minCropBoxWidth)||0,i=Number(o.minCropBoxHeight)||0,a=r?Math.min(g.width,p.width,p.width+p.left,g.width-p.left):g.width,c=r?Math.min(g.height,p.height,p.height+p.top,g.height-p.top):g.height;s=Math.min(s,g.width),i=Math.min(i,g.height),d&&(s&&i?i*d>s?i=s/d:s=i*d:s?i=s/d:i&&(s=i*d),c*d>a?c=a/d:a=c*d),h.minWidth=Math.min(s,a),h.minHeight=Math.min(i,c),h.maxWidth=a,h.maxHeight=c}n&&(r?(h.minLeft=Math.max(0,p.left),h.minTop=Math.max(0,p.top),h.maxLeft=Math.min(g.width,p.left+p.width)-h.width,h.maxTop=Math.min(g.height,p.top+p.height)-h.height):(h.minLeft=0,h.minTop=0,h.maxLeft=g.width-h.width,h.maxTop=g.height-h.height))},renderCropBox:function(){var e=this.options,n=this.containerData,o=this.cropBoxData;(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),this.limitCropBox(!1,!0),o.left=Math.min(Math.max(o.left,o.minLeft),o.maxLeft),o.top=Math.min(Math.max(o.top,o.minTop),o.maxTop),o.oldLeft=o.left,o.oldTop=o.top,e.movable&&e.cropBoxMovable&&Ct(this.face,ot,o.width>=n.width&&o.height>=n.height?V:B),tt(this.cropBox,x({width:o.width,height:o.height},zt({translateX:o.left,translateY:o.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),mt(this.element,St,this.getData())}},Xe={initPreview:function(){var e=this.element,n=this.crossOrigin,o=this.options.preview,g=n?this.crossOriginUrl:this.url,p=e.alt||"The image to preview",h=document.createElement("img");if(n&&(h.crossOrigin=n),h.src=g,h.alt=p,this.viewBox.appendChild(h),this.viewBoxImage=h,o){var r=o;"string"==typeof o?r=e.ownerDocument.querySelectorAll(o):o.querySelector&&(r=[o]),this.previews=r,I(r,function(d){var s=document.createElement("img");Ct(d,kt,{width:d.offsetWidth,height:d.offsetHeight,html:d.innerHTML}),n&&(s.crossOrigin=n),s.src=g,s.alt=p,s.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',d.innerHTML="",d.appendChild(s)})}},resetPreview:function(){I(this.previews,function(e){var n=Ft(e,kt);tt(e,{width:n.width,height:n.height}),e.innerHTML=n.html,function Se(l,e){if(nt(l[e]))try{delete l[e]}catch{l[e]=void 0}else if(l.dataset)try{delete l.dataset[e]}catch{l.dataset[e]=void 0}else l.removeAttribute("data-".concat(Gt(e)))}(e,kt)})},preview:function(){var e=this.imageData,n=this.canvasData,o=this.cropBoxData,g=o.width,p=o.height,h=e.width,r=e.height,d=o.left-n.left-e.left,s=o.top-n.top-e.top;!this.cropped||this.disabled||(tt(this.viewBoxImage,x({width:h,height:r},zt(x({translateX:-d,translateY:-s},e)))),I(this.previews,function(i){var a=Ft(i,kt),c=a.width,m=a.height,u=c,_=m,C=1;g&&(_=p*(C=c/g)),p&&_>m&&(u=g*(C=m/p),_=m),tt(i,{width:u,height:_}),tt(i.getElementsByTagName("img")[0],x({width:h*C,height:r*C},zt(x({translateX:-d*C,translateY:-s*C},e))))}))}},$e={bind:function(){var e=this.element,n=this.options,o=this.cropper;N(n.cropstart)&&F(e,Et,n.cropstart),N(n.cropmove)&&F(e,Tt,n.cropmove),N(n.cropend)&&F(e,Ht,n.cropend),N(n.crop)&&F(e,St,n.crop),N(n.zoom)&&F(e,Rt,n.zoom),F(o,Qt,this.onCropStart=this.cropStart.bind(this)),n.zoomable&&n.zoomOnWheel&&F(o,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),n.toggleDragModeOnDblclick&&F(o,Zt,this.onDblclick=this.dblclick.bind(this)),F(e.ownerDocument,Kt,this.onCropMove=this.cropMove.bind(this)),F(e.ownerDocument,qt,this.onCropEnd=this.cropEnd.bind(this)),n.responsive&&F(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,n=this.options,o=this.cropper;N(n.cropstart)&&$(e,Et,n.cropstart),N(n.cropmove)&&$(e,Tt,n.cropmove),N(n.cropend)&&$(e,Ht,n.cropend),N(n.crop)&&$(e,St,n.crop),N(n.zoom)&&$(e,Rt,n.zoom),$(o,Qt,this.onCropStart),n.zoomable&&n.zoomOnWheel&&$(o,"wheel",this.onWheel,{passive:!1,capture:!0}),n.toggleDragModeOnDblclick&&$(o,Zt,this.onDblclick),$(e.ownerDocument,Kt,this.onCropMove),$(e.ownerDocument,qt,this.onCropEnd),n.responsive&&$(window,"resize",this.onResize)}},he={resize:function(){if(!this.disabled){var p,h,e=this.options,n=this.container,o=this.containerData,g=n.offsetWidth/o.width;1===g&&n.offsetHeight===o.height||(e.restore&&(p=this.getCanvasData(),h=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(I(p,function(r,d){p[d]=r*g})),this.setCropBoxData(I(h,function(r,d){h[d]=r*g}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(function Be(l,e){return l.classList?l.classList.contains(e):l.className.indexOf(e)>-1}(this.dragBox,bt)?"move":jt)},wheel:function(e){var n=this,o=Number(this.options.wheelZoomRatio)||.1,g=1;this.disabled||(e.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){n.wheeling=!1},50),e.deltaY?g=e.deltaY>0?1:-1:e.wheelDelta?g=-e.wheelDelta/120:e.detail&&(g=e.detail>0?1:-1),this.zoom(-g*o,e)))},cropStart:function(e){var n=e.buttons,o=e.button;if(!(this.disabled||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(A(n)&&1!==n||A(o)&&0!==o||e.ctrlKey))){var h,g=this.options,p=this.pointers;e.changedTouches?I(e.changedTouches,function(r){p[r.identifier]=xt(r)}):p[e.pointerId||0]=xt(e),h=Object.keys(p).length>1&&g.zoomable&&g.zoomOnTouch?t:Ft(e.target,ot),ze.test(h)&&!1!==mt(this.element,Et,{originalEvent:e,action:h})&&(e.preventDefault(),this.action=h,this.cropping=!1,h===U&&(this.cropping=!0,S(this.dragBox,at)))}},cropMove:function(e){var n=this.action;if(!this.disabled&&n){var o=this.pointers;e.preventDefault(),!1!==mt(this.element,Tt,{originalEvent:e,action:n})&&(e.changedTouches?I(e.changedTouches,function(g){x(o[g.identifier]||{},xt(g,!0))}):x(o[e.pointerId||0]||{},xt(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var n=this.action,o=this.pointers;e.changedTouches?I(e.changedTouches,function(g){delete o[g.identifier]}):delete o[e.pointerId||0],n&&(e.preventDefault(),Object.keys(o).length||(this.action=""),this.cropping&&(this.cropping=!1,ht(this.dragBox,at,this.cropped&&this.options.modal)),mt(this.element,Ht,{originalEvent:e,action:n}))}}},We={change:function(e){var rt,o=this.canvasData,g=this.containerData,p=this.cropBoxData,h=this.pointers,r=this.action,d=this.options.aspectRatio,s=p.left,i=p.top,a=p.width,c=p.height,m=s+a,u=i+c,_=0,C=0,z=g.width,T=g.height,E=!0;!d&&e.shiftKey&&(d=a&&c?a/c:1),this.limited&&(C=p.minTop,z=(_=p.minLeft)+Math.min(g.width,o.width,o.left+o.width),T=C+Math.min(g.height,o.height,o.top+o.height));var W=h[Object.keys(h)[0]],b={x:W.endX-W.startX,y:W.endY-W.startY},y=function(Q){switch(Q){case K:m+b.x>z&&(b.x=z-m);break;case J:s+b.x<_&&(b.x=_-s);break;case q:i+b.y<C&&(b.y=C-i);break;case H:u+b.y>T&&(b.y=T-u)}};switch(r){case B:s+=b.x,i+=b.y;break;case K:if(b.x>=0&&(m>=z||d&&(i<=C||u>=T))){E=!1;break}y(K),(a+=b.x)<0&&(r=J,s-=a=-a),d&&(i+=(p.height-(c=a/d))/2);break;case q:if(b.y<=0&&(i<=C||d&&(s<=_||m>=z))){E=!1;break}y(q),i+=b.y,(c-=b.y)<0&&(r=H,i-=c=-c),d&&(s+=(p.width-(a=c*d))/2);break;case J:if(b.x<=0&&(s<=_||d&&(i<=C||u>=T))){E=!1;break}y(J),s+=b.x,(a-=b.x)<0&&(r=K,s-=a=-a),d&&(i+=(p.height-(c=a/d))/2);break;case H:if(b.y>=0&&(u>=T||d&&(s<=_||m>=z))){E=!1;break}y(H),(c+=b.y)<0&&(r=q,i-=c=-c),d&&(s+=(p.width-(a=c*d))/2);break;case ft:if(d){if(b.y<=0&&(i<=C||m>=z)){E=!1;break}y(q),i+=b.y,a=(c-=b.y)*d}else y(q),y(K),b.x>=0?m<z?a+=b.x:b.y<=0&&i<=C&&(E=!1):a+=b.x,b.y<=0?i>C&&(c-=b.y,i+=b.y):(c-=b.y,i+=b.y);a<0&&c<0?(r=dt,i-=c=-c,s-=a=-a):a<0?(r=ct,s-=a=-a):c<0&&(r=_t,i-=c=-c);break;case ct:if(d){if(b.y<=0&&(i<=C||s<=_)){E=!1;break}y(q),i+=b.y,s+=p.width-(a=(c-=b.y)*d)}else y(q),y(J),b.x<=0?s>_?(a-=b.x,s+=b.x):b.y<=0&&i<=C&&(E=!1):(a-=b.x,s+=b.x),b.y<=0?i>C&&(c-=b.y,i+=b.y):(c-=b.y,i+=b.y);a<0&&c<0?(r=_t,i-=c=-c,s-=a=-a):a<0?(r=ft,s-=a=-a):c<0&&(r=dt,i-=c=-c);break;case dt:if(d){if(b.x<=0&&(s<=_||u>=T)){E=!1;break}y(J),s+=b.x,c=(a-=b.x)/d}else y(H),y(J),b.x<=0?s>_?(a-=b.x,s+=b.x):b.y>=0&&u>=T&&(E=!1):(a-=b.x,s+=b.x),b.y>=0?u<T&&(c+=b.y):c+=b.y;a<0&&c<0?(r=ft,i-=c=-c,s-=a=-a):a<0?(r=_t,s-=a=-a):c<0&&(r=ct,i-=c=-c);break;case _t:if(d){if(b.x>=0&&(m>=z||u>=T)){E=!1;break}y(K),c=(a+=b.x)/d}else y(H),y(K),b.x>=0?m<z?a+=b.x:b.y>=0&&u>=T&&(E=!1):a+=b.x,b.y>=0?u<T&&(c+=b.y):c+=b.y;a<0&&c<0?(r=ct,i-=c=-c,s-=a=-a):a<0?(r=dt,s-=a=-a):c<0&&(r=ft,i-=c=-c);break;case V:this.move(b.x,b.y),E=!1;break;case t:this.zoom(function Ee(l){var e=w({},l),n=0;return I(l,function(o,g){delete e[g],I(e,function(p){var h=Math.abs(o.startX-p.startX),r=Math.abs(o.startY-p.startY),d=Math.abs(o.endX-p.endX),s=Math.abs(o.endY-p.endY),i=Math.sqrt(h*h+r*r),c=(Math.sqrt(d*d+s*s)-i)/i;Math.abs(c)>Math.abs(n)&&(n=c)})}),n}(h),e),E=!1;break;case U:if(!b.x||!b.y){E=!1;break}rt=ce(this.cropper),s=W.startX-rt.left,i=W.startY-rt.top,a=p.minWidth,c=p.minHeight,b.x>0?r=b.y>0?_t:ft:b.x<0&&(s-=a,r=b.y>0?dt:ct),b.y<0&&(i-=c),this.cropped||(Z(this.cropBox,j),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}E&&(p.width=a,p.height=c,p.left=s,p.top=i,this.action=r,this.renderCropBox()),I(h,function(R){R.startX=R.endX,R.startY=R.endY})}},Yt={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&S(this.dragBox,at),Z(this.cropBox,j),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=x({},this.initialImageData),this.canvasData=x({},this.initialCanvasData),this.cropBoxData=x({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(x(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),Z(this.dragBox,at),S(this.cropBox,j)),this},replace:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&e&&(this.isImg&&(this.element.src=e),n?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,I(this.previews,function(o){o.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,Z(this.cropper,Xt)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,S(this.cropper,Xt)),this},destroy:function(){var e=this.element;return e[D]?(e[D]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,o=this.canvasData,g=o.left,p=o.top;return this.moveTo(Nt(e)?e:g+Number(e),Nt(n)?n:p+Number(n))},moveTo:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,o=this.canvasData,g=!1;return e=Number(e),n=Number(n),this.ready&&!this.disabled&&this.options.movable&&(A(e)&&(o.left=e,g=!0),A(n)&&(o.top=n,g=!0),g&&this.renderCanvas(!0)),this},zoom:function(e,n){var o=this.canvasData;return e=Number(e),this.zoomTo(o.width*(e=e<0?1/(1-e):1+e)/o.naturalWidth,null,n)},zoomTo:function(e,n,o){var g=this.options,p=this.canvasData,h=p.width,r=p.height,d=p.naturalWidth,s=p.naturalHeight;if((e=Number(e))>=0&&this.ready&&!this.disabled&&g.zoomable){var i=d*e,a=s*e;if(!1===mt(this.element,Rt,{ratio:e,oldRatio:h/d,originalEvent:o}))return this;if(o){var c=this.pointers,m=ce(this.cropper),u=c&&Object.keys(c).length?function Re(l){var e=0,n=0,o=0;return I(l,function(g){e+=g.startX,n+=g.startY,o+=1}),{pageX:e/=o,pageY:n/=o}}(c):{pageX:o.pageX,pageY:o.pageY};p.left-=(u.pageX-m.left-p.left)/h*(i-h),p.top-=(u.pageY-m.top-p.top)/r*(a-r)}else pt(n)&&A(n.x)&&A(n.y)?(p.left-=(n.x-p.left)/h*(i-h),p.top-=(n.y-p.top)/r*(a-r)):(p.left-=(i-h)/2,p.top-=(a-r)/2);p.width=i,p.height=a,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return A(e=Number(e))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var n=this.imageData.scaleY;return this.scale(e,A(n)?n:1)},scaleY:function(e){var n=this.imageData.scaleX;return this.scale(A(n)?n:1,e)},scale:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,o=this.imageData,g=!1;return e=Number(e),n=Number(n),this.ready&&!this.disabled&&this.options.scalable&&(A(e)&&(o.scaleX=e,g=!0),A(n)&&(o.scaleY=n,g=!0),g&&this.renderCanvas(!0,!0)),this},getData:function(){var h,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.options,o=this.imageData,g=this.canvasData,p=this.cropBoxData;if(this.ready&&this.cropped){var r=o.width/o.naturalWidth;if(I(h={x:p.left-g.left,y:p.top-g.top,width:p.width,height:p.height},function(i,a){h[a]=i/r}),e){var d=Math.round(h.y+h.height),s=Math.round(h.x+h.width);h.x=Math.round(h.x),h.y=Math.round(h.y),h.width=s-h.x,h.height=d-h.y}}else h={x:0,y:0,width:0,height:0};return n.rotatable&&(h.rotate=o.rotate||0),n.scalable&&(h.scaleX=o.scaleX||1,h.scaleY=o.scaleY||1),h},setData:function(e){var n=this.options,o=this.imageData,g=this.canvasData,p={};if(this.ready&&!this.disabled&&pt(e)){var h=!1;n.rotatable&&A(e.rotate)&&e.rotate!==o.rotate&&(o.rotate=e.rotate,h=!0),n.scalable&&(A(e.scaleX)&&e.scaleX!==o.scaleX&&(o.scaleX=e.scaleX,h=!0),A(e.scaleY)&&e.scaleY!==o.scaleY&&(o.scaleY=e.scaleY,h=!0)),h&&this.renderCanvas(!0,!0);var r=o.width/o.naturalWidth;A(e.x)&&(p.left=e.x*r+g.left),A(e.y)&&(p.top=e.y*r+g.top),A(e.width)&&(p.width=e.width*r),A(e.height)&&(p.height=e.height*r),this.setCropBoxData(p)}return this},getContainerData:function(){return this.ready?x({},this.containerData):{}},getImageData:function(){return this.sized?x({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,n={};return this.ready&&I(["left","top","width","height","naturalWidth","naturalHeight"],function(o){n[o]=e[o]}),n},setCanvasData:function(e){var n=this.canvasData,o=n.aspectRatio;return this.ready&&!this.disabled&&pt(e)&&(A(e.left)&&(n.left=e.left),A(e.top)&&(n.top=e.top),A(e.width)?(n.width=e.width,n.height=e.width/o):A(e.height)&&(n.height=e.height,n.width=e.height*o),this.renderCanvas(!0)),this},getCropBoxData:function(){var n,e=this.cropBoxData;return this.ready&&this.cropped&&(n={left:e.left,top:e.top,width:e.width,height:e.height}),n||{}},setCropBoxData:function(e){var g,p,n=this.cropBoxData,o=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&pt(e)&&(A(e.left)&&(n.left=e.left),A(e.top)&&(n.top=e.top),A(e.width)&&e.width!==n.width&&(g=!0,n.width=e.width),A(e.height)&&e.height!==n.height&&(p=!0,n.height=e.height),o&&(g?n.height=n.width/o:p&&(n.width=n.height*o)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var n=this.canvasData,o=function Ne(l,e,n,o){var g=e.aspectRatio,p=e.naturalWidth,h=e.naturalHeight,r=e.rotate,d=void 0===r?0:r,s=e.scaleX,i=void 0===s?1:s,a=e.scaleY,c=void 0===a?1:a,m=n.aspectRatio,u=n.naturalWidth,_=n.naturalHeight,C=o.fillColor,z=void 0===C?"transparent":C,T=o.imageSmoothingEnabled,E=void 0===T||T,rt=o.imageSmoothingQuality,W=void 0===rt?"low":rt,b=o.maxWidth,y=void 0===b?1/0:b,R=o.maxHeight,Q=void 0===R?1/0:R,st=o.minWidth,At=void 0===st?0:st,wt=o.minHeight,ut=void 0===wt?0:wt,it=document.createElement("canvas"),Y=it.getContext("2d"),yt=et({aspectRatio:m,width:y,height:Q}),ue=et({aspectRatio:m,width:At,height:ut},"cover"),He=Math.min(yt.width,Math.max(ue.width,u)),Ze=Math.min(yt.height,Math.max(ue.height,_)),Ke=et({aspectRatio:g,width:y,height:Q}),qe=et({aspectRatio:g,width:At,height:ut},"cover"),ti=Math.min(Ke.width,Math.max(qe.width,p)),ei=Math.min(Ke.height,Math.max(qe.height,h)),ii=[-ti/2,-ei/2,ti,ei];return it.width=gt(He),it.height=gt(Ze),Y.fillStyle=z,Y.fillRect(0,0,He,Ze),Y.save(),Y.translate(He/2,Ze/2),Y.rotate(d*Math.PI/180),Y.scale(i,c),Y.imageSmoothingEnabled=E,Y.imageSmoothingQuality=W,Y.drawImage.apply(Y,[l].concat(k(ii.map(function(ai){return Math.floor(gt(ai))})))),Y.restore(),it}(this.image,this.imageData,n,e);if(!this.cropped)return o;var g=this.getData(),p=g.x,h=g.y,r=g.width,d=g.height,s=o.width/Math.floor(n.naturalWidth);1!==s&&(p*=s,h*=s,r*=s,d*=s);var i=r/d,a=et({aspectRatio:i,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),c=et({aspectRatio:i,width:e.minWidth||0,height:e.minHeight||0},"cover"),m=et({aspectRatio:i,width:e.width||(1!==s?o.width:r),height:e.height||(1!==s?o.height:d)}),u=m.width,_=m.height;u=Math.min(a.width,Math.max(c.width,u)),_=Math.min(a.height,Math.max(c.height,_));var C=document.createElement("canvas"),z=C.getContext("2d");C.width=gt(u),C.height=gt(_),z.fillStyle=e.fillColor||"transparent",z.fillRect(0,0,u,_);var T=e.imageSmoothingEnabled,rt=e.imageSmoothingQuality;z.imageSmoothingEnabled=void 0===T||T,rt&&(z.imageSmoothingQuality=rt);var Q,st,At,wt,ut,it,W=o.width,b=o.height,y=p,R=h;y<=-r||y>W?(y=0,Q=0,At=0,ut=0):y<=0?(At=-y,y=0,ut=Q=Math.min(W,r+y)):y<=W&&(At=0,ut=Q=Math.min(r,W-y)),Q<=0||R<=-d||R>b?(R=0,st=0,wt=0,it=0):R<=0?(wt=-R,R=0,it=st=Math.min(b,d+R)):R<=b&&(wt=0,it=st=Math.min(d,b-R));var Y=[y,R,Q,st];if(ut>0&&it>0){var yt=u/r;Y.push(At*yt,wt*yt,ut*yt,it*yt)}return z.drawImage.apply(z,[o].concat(k(Y.map(function(ue){return Math.floor(gt(ue))})))),C},setAspectRatio:function(e){var n=this.options;return!this.disabled&&!Nt(e)&&(n.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var n=this.options,o=this.dragBox,g=this.face;if(this.ready&&!this.disabled){var p=e===jt,h=n.movable&&"move"===e;n.dragMode=e=p||h?e:"none",Ct(o,ot,e),ht(o,bt,p),ht(o,vt,h),n.cropBoxMovable||(Ct(g,ot,e),ht(g,bt,p),ht(g,vt,h))}return this}},Je=G.Cropper,me=function(){function l(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function v(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),!e||!Dt.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=x({},ne,pt(n)&&n),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return function M(l,e,n){return e&&f(l.prototype,e),n&&f(l,n),l}(l,[{key:"init",value:function(){var g,n=this.element,o=n.tagName.toLowerCase();if(!n[D]){if(n[D]=this,"img"===o){if(this.isImg=!0,g=n.getAttribute("src")||"",this.originalUrl=g,!g)return;g=n.src}else"canvas"===o&&window.HTMLCanvasElement&&(g=n.toDataURL());this.load(g)}}},{key:"load",value:function(n){var o=this;if(n){this.url=n,this.imageData={};var g=this.element,p=this.options;if(!p.rotatable&&!p.scalable&&(p.checkOrientation=!1),!p.checkOrientation||!window.ArrayBuffer)return void this.clone();if(Ae.test(n))return void(we.test(n)?this.read(function Fe(l){var e=l.replace(Ge,""),n=atob(e),o=new ArrayBuffer(n.length),g=new Uint8Array(o);return I(g,function(p,h){g[h]=n.charCodeAt(h)}),o}(n)):this.clone());var h=new XMLHttpRequest,r=this.clone.bind(this);this.reloading=!0,this.xhr=h,h.onabort=r,h.onerror=r,h.ontimeout=r,h.onprogress=function(){h.getResponseHeader("content-type")!==ae&&h.abort()},h.onload=function(){o.read(h.response)},h.onloadend=function(){o.reloading=!1,o.xhr=null},p.checkCrossOrigin&&de(n)&&g.crossOrigin&&(n=pe(n)),h.open("GET",n,!0),h.responseType="arraybuffer",h.withCredentials="use-credentials"===g.crossOrigin,h.send()}}},{key:"read",value:function(n){var o=this.options,g=this.imageData,p=Ve(n),h=0,r=1,d=1;if(p>1){this.url=function Ue(l,e){for(var n=[],g=new Uint8Array(l);g.length>0;)n.push(ge.apply(null,Pt(g.subarray(0,8192)))),g=g.subarray(8192);return"data:".concat(e,";base64,").concat(btoa(n.join("")))}(n,ae);var s=function Ye(l){var e=0,n=1,o=1;switch(l){case 2:n=-1;break;case 3:e=-180;break;case 4:o=-1;break;case 5:e=90,o=-1;break;case 6:e=90;break;case 7:e=90,n=-1;break;case 8:e=-90}return{rotate:e,scaleX:n,scaleY:o}}(p);h=s.rotate,r=s.scaleX,d=s.scaleY}o.rotatable&&(g.rotate=h),o.scalable&&(g.scaleX=r,g.scaleY=d),this.clone()}},{key:"clone",value:function(){var n=this.element,o=this.url,g=n.crossOrigin,p=o;this.options.checkCrossOrigin&&de(o)&&(g||(g="anonymous"),p=pe(o)),this.crossOrigin=g,this.crossOriginUrl=p;var h=document.createElement("img");g&&(h.crossOrigin=g),h.src=p||o,h.alt=n.alt||"The image to crop",this.image=h,h.onload=this.start.bind(this),h.onerror=this.stop.bind(this),S(h,$t),n.parentNode.insertBefore(h,n.nextSibling)}},{key:"start",value:function(){var n=this,o=this.image;o.onload=null,o.onerror=null,this.sizing=!0;var g=G.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(G.navigator.userAgent),p=function(s,i){x(n.imageData,{naturalWidth:s,naturalHeight:i,aspectRatio:s/i}),n.initialImageData=x({},n.imageData),n.sizing=!1,n.sized=!0,n.build()};if(!o.naturalWidth||g){var h=document.createElement("img"),r=document.body||document.documentElement;this.sizingImage=h,h.onload=function(){p(h.width,h.height),g||r.removeChild(h)},h.src=o.src,g||(h.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",r.appendChild(h))}else p(o.naturalWidth,o.naturalHeight)}},{key:"stop",value:function(){var n=this.image;n.onload=null,n.onerror=null,n.parentNode.removeChild(n),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var n=this.element,o=this.options,g=this.image,p=n.parentNode,h=document.createElement("div");h.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var r=h.querySelector(".".concat(D,"-container")),d=r.querySelector(".".concat(D,"-canvas")),s=r.querySelector(".".concat(D,"-drag-box")),i=r.querySelector(".".concat(D,"-crop-box")),a=i.querySelector(".".concat(D,"-face"));this.container=p,this.cropper=r,this.canvas=d,this.dragBox=s,this.cropBox=i,this.viewBox=r.querySelector(".".concat(D,"-view-box")),this.face=a,d.appendChild(g),S(n,j),p.insertBefore(r,n.nextSibling),this.isImg||Z(g,$t),this.initPreview(),this.bind(),o.initialAspectRatio=Math.max(0,o.initialAspectRatio)||NaN,o.aspectRatio=Math.max(0,o.aspectRatio)||NaN,o.viewMode=Math.max(0,Math.min(3,Math.round(o.viewMode)))||0,S(i,j),o.guides||S(i.getElementsByClassName("".concat(D,"-dashed")),j),o.center||S(i.getElementsByClassName("".concat(D,"-center")),j),o.background&&S(r,"".concat(D,"-bg")),o.highlight||S(a,Bt),o.cropBoxMovable&&(S(a,vt),Ct(a,ot,B)),o.cropBoxResizable||(S(i.getElementsByClassName("".concat(D,"-line")),j),S(i.getElementsByClassName("".concat(D,"-point")),j)),this.render(),this.ready=!0,this.setDragMode(o.dragMode),o.autoCrop&&this.crop(),this.setData(o.data),N(o.ready)&&F(n,"ready",o.ready,{once:!0}),mt(n,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),Z(this.element,j))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Je,l}},{key:"setDefaults",value:function(n){x(ne,pt(n)&&n)}}]),l}();return x(me.prototype,Le,Xe,$e,he,We,Yt),me}()}}]);