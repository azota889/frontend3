(self.webpackChunkSmobileMod=self.webpackChunkSmobileMod||[]).push([[6088],{59702:(_t,Ee,w)=>{"use strict";w.d(Ee,{Q:()=>q});var l=w(89163),d=w(33887),h=w(48891),_=w(31418),x=w(27988),T=w(56562),re=w(54460),_e=w(76975);function p(V,R){if(1&V){const j=h.RV6();h.j41(0,"div",1)(1,"div",2)(2,"div",3),h.EFF(3),h.nI1(4,"mytranslate"),h.k0s(),h.nrm(5,"div",4),h.j41(6,"button",5),h.bIt("click",function(){h.eBV(j);const Y=h.XpG();return h.Njj(Y.handleCloseDialog())}),h.EFF(7),h.nI1(8,"mytranslate"),h.k0s()()()}2&V&&(h.R7$(3),h.SpI(" ",h.bMT(4,2,"\u0110\u1ec1 thi kh\xf4ng h\u1ed7 tr\u1ee3 thi tr\xean App")," "),h.R7$(4),h.SpI(" ",h.bMT(8,4,"lang_button_close")," "))}let q=(()=>{var V;class R extends d._{handleCloseDialog(){this.dialogRef.close(!1)}chooseCombo(A){this.currentComboObj=A}orderBuyExam(){if(!this.currentComboObj)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.initStatusObj();let A="userRole=student&productType=exam&backTo="+encodeURIComponent(this.commonService.getCurrentUrlWithoutLocale());this.waitDestroy(this.productOrderService.apiProductOrderBuyExamByMoneyGet(this.commonService.getCurrentHostName(),this.commonService.getCurrentLang(),this.currentComboObj.id,A).subscribe(Y=>{if(!Y.success)return this.errorStatusObj(Y.message,!0);window.location.href=Y.data?.value??""}))}initData(){this.initStatusObj(),this.waitDestroy(this.comboPackageService.apiComboPackageListComboPackagesByExamHashIdGet(this.data.examObj.hashId??"").subscribe(A=>A.success?A.data?.objs?.length?(this.comboObjs=A.data?.objs??[],this.currentComboObj=this.commonService.getFirstOfArray(this.comboObjs),this.showIframeInContent=this.currentComboObj?.description,this.stopStatusObj(),void(this.showIframeInContent&&this.sAztAzotaTrackingService.sendForceCustomEvent("PAYMENT_VIEW_IFRAME_CONTENT",[]))):this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0):this.errorStatusObj(A.message,!0)))}setViewport(){const A=document.createElement("meta");A.name="viewport",A.setAttribute("id","viewPortIframe");const Y=v=>{A.setAttribute("content",v),document.head.appendChild(A)},B=window.innerWidth;if(B<768){const F=420!==B?B/420:1;Y(`width=420, user-scalable=no, initial-scale=${F}, minimum-scale=${F}, maximum-scale=${F}`)}else Y("width=960, user-scalable=no, initial-scale=1.0")}removeViewPort(){document.getElementById("viewPortIframe")?.remove()}ngOnInit(){super.ngOnInit(),this.initData(),this.setViewport()}constructor(A,Y,B,L,v){super(Y,A),this.dialogRef=A,this.data=Y,this.productOrderService=B,this.comboPackageService=L,this.sAztAzotaTrackingService=v,this.comboObjs=[],this.showIframeInContent=void 0}ngOnDestroy(){this.removeViewPort()}}return(V=R).\u0275fac=function(A){return new(A||V)(h.rXU(l.CP,8),h.rXU(l.Vh,8),h.rXU(_.Hg),h.rXU(x.E),h.rXU(T.M))},V.\u0275cmp=h.VBU({type:V,selectors:[["payment-dialog"]],features:[h.Vt3],decls:1,vars:1,consts:[["class","grid text-center p-5","style","height: 100%; place-items: center",4,"ngIf"],[1,"grid","text-center","p-5",2,"height","100%","place-items","center"],[1,"box","w-full"],[1,"p-5"],[1,"p-2"],[1,"p-3","w-full","font-medium",2,"border-top","1px solid rgb(211, 211, 211)",3,"click"]],template:function(A,Y){1&A&&h.DNE(0,p,9,6,"div",0),2&A&&h.Y8G("ngIf",Y.isMobileWebView)},dependencies:[re.bT,_e.wp],encapsulation:2}),R})()},57081:(_t,Ee,w)=>{"use strict";w.d(Ee,{w:()=>T});var l=w(48891),d=w(53793),h=w(68774),_=w(50589),x=w(99927);let T=(()=>{var re;class _e{_saveSortTypeOfSetting(q){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,q)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(q){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==q}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(q,V){var R=[];return V.forEach(j=>{j.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(q,j.results??new Array),R.push(j)}),R}_filterExamResultObjsByFilterSettingObjNotInClassroom(q,V){var R=[];if(q.isMarked||q.isNotMarked||q.isOnTest||q.isNotSubmit||q.isNotTested)for(var j of V){let A=!1,Y=q.isOnTest||q.isNotSubmit;q.isMarked&&1==j.isMarked&&(!Y||!(1!=j.status&&(j.isMarked||j.isNotMarked)))&&(A=!0),q.isNotMarked&&1==j.isNotMarked&&(!Y||!(1!=j.status&&(j.isMarked||j.isNotMarked)))&&(A=!0),q.isOnTest&&(1==j.isOnTest||0==j.status&&(j.isMarked||j.isNotMarked))&&(A=!0),q.isNotTested&&1==j.isNotTested&&(A=!0),q.isNotSubmit&&(1==j.isNotSubmit||-1==j.status&&(j.isMarked||j.isNotMarked))&&(A=!0),A&&R.push(j)}else R=V;return R}_searchExamResultObjsByFullNameInClassroom(q,V){var R=[];return this.commonService.myClone(q).forEach(A=>{var Y=this._searchExamResultObjsByFullNameNotInClassroom(A.results??[],V);Y.length>0&&(A.results=Y,R.push(A))}),R}_searchExamResultObjsByFullNameNotInClassroom(q,V){V=this.commonService.convertVietnameseToEnglish(V).toLowerCase();var R=[];return q.forEach(j=>{-1!=this.commonService.convertVietnameseToEnglish(j.fullName??"").toLowerCase().indexOf(V)&&R.push(j)}),R}_sortExamResultObjsBySettingObjByClassroom(q,V,R){return"isSortByNameAsc"==R?this.sortService.sortFirstNameStudentsInClass(q):"isSortByTimeDesc"==R?this.sortService.sortTimeStudentsInClass(q,1):"isSortByMarkDesc"==R?this.sortService.sortMarkStudentsInClass(q,1,V):this._sortExamResultObjsBySortTypeOfClassroom(q)}_sortExamResultObjsBySettingObjNotInClassroom(q,V,R){return"isSortByNameAsc"==R?this.sortService.sortFirstNameStudents(q):"isSortByTimeDesc"==R?this.sortService.sortTimeDESC(q):"isSortByMarkDesc"==R?this.sortService.sortMarkDESC(q,V):q}_sortExamResultObjsBySortTypeOfClassroom(q){var V=q.map(R=>({...R}));return V.forEach((R,j)=>{R.results=0==R.classObj?.sortType?this.sortService.sortFirstNameStudents(R.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(R.results??[],"pos","id"),V[j]=R}),V}_changeExamResultStatusForAllClassroom(q,V,R){var j=[];return q.forEach((A,Y)=>{A.results=this._changeExamResultStatusForOneClassroom(A.results??new Array,V),A={indexCounter:Y,...A,countSubmitted:R?A.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(A.results??new Array),showOnTab:A.showOnTab},j.push(A)}),j}_changeExamResultStatusForOneClassroom(q,V){var R=[...q];return R.forEach((j,A)=>{j.confirmedAt&&""!=j.confirmedAt&&j.resultId&&j.resultId>0?j.isMarked=!0:j.resultId&&j.resultId>0&&(!j.confirmedAt||""==j.confirmedAt)?j.isNotMarked=!0:j.resultId&&0!=j.resultId||!j.startedTest||""==j.startedTest||0!=j.status?j.resultId&&0!=j.resultId||!j.startedTest||""==j.startedTest||-1!=j.status?null==j.startedTest&&(j.isNotTested=!0):j.isNotSubmit=!0:j.isOnTest=!0,R[A]=j}),R.forEach((j,A)=>{j.files&&""!=j.files&&!Array.isArray(j.files)&&(j.filesParse=this.commonService.myParseJson(j.files)),R[A]=j}),R}_countTotalSubmittedOfExamResultObjs(q){var V=0;return q.forEach(R=>{(R.isMarked||R.isNotMarked)&&V++}),V}_counterTotalEssayOfQuestionObjs(q){let V=0;return q.forEach(R=>{this.answerTypeService.isEssayAnswer(R)&&V++}),V}_checkCounterEssayQuestionObjs(q){let V=0;return q.forEach(R=>{R.isEssay&&V++}),V}constructor(q,V,R,j){this.commonService=q,this.sortService=V,this.browserStorageService=R,this.answerTypeService=j,this.sortByStorageKey="exam_list_sort_by"}}return(re=_e).\u0275fac=function(q){return new(q||re)(l.KVO(d.R),l.KVO(h.g),l.KVO(_.z),l.KVO(x._))},re.\u0275prov=l.jDH({token:re,factory:re.\u0275fac,providedIn:"root"}),_e})()},87515:(_t,Ee,w)=>{"use strict";w.d(Ee,{h:()=>R});var l=w(10936),d=w(51698),h=w(48891),_=w(53793),x=w(47290),T=w(51913),re=w(41715),_e=w(50589),p=w(79064),q=w(91640),V=w(57081);let R=(()=>{var j;class A{constructor(B,L,v,F,Q,ee,te,oe){this.commonService=B,this.examPageResultService=L,this.permissionService=v,this.globalService=F,this.browserStorageService=Q,this.gzipHelper=ee,this.homeworkExamService=te,this.sAztExamResultListSortService=oe}getTestedUserObjs(B,L,v){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,L,"default",v)}getTestedLastMark(B,L,v){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,L,"last",void 0,v)}getTestedHighestMark(B,L,v){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,L,"highest",void 0,v)}getTestedFirstMark(B,L,v){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,L,"first",void 0,v)}getTestedAllResult(B,L,v){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,L,"all",void 0,v)}getTestedOfExamResult(B,L,v,F,Q){return new d.c(ee=>{let te="tested_list_result_v2_"+L,oe=this.browserStorageService.getSimpleSessionStorage(te)??"",Ve=this.gzipHelper.resultContentSupport(oe),Se=Ve&&this.commonService.willDeleteParseJson(Ve)?this.commonService.willDeleteParseJson(Ve):void 0;F&&oe&&Se?(ee.next({status:200,success:1,data:Se,message:"successful"}),ee.complete()):this.examPageResultService.apiExamPageResultGetNewObjV2Post({examId:L,classroomIds:Q}).subscribe(be=>{if(1==be.success){let it=be.data?.serverSecond??0,nt=be.data?.examObj,Re=be.data?.classroomWithAvatarAndStudentObjs??new Array,rt=be.data?.totalAttended??0,je=be.data?.examQuestionObjs??new Array,ae=be.data?.examCreatorObj,Qe=be.data?.offlineExamObj,ct=be.data?.hasEssayQuestion,We=be.data?.totalQuestion??0,ze=be.data?.offlineMixQuestionObjs,Ue=be.data?.canResetStudentCode,gt=be.data?.hasCreateStudentCode,Ne=be.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",nt)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",nt)?this.getAllExamResultObjs(B,[],L,"",J=>{if(J.hasOwnProperty("success")&&1==J.success){let Z=this.mergeStudentWithAvatar(J.studentWithResultObjs??[]),ut={},et=[];Z?.forEach(Me=>{let ye=Me.parentId??"0";ut.hasOwnProperty(ye)?ut[ye].push(...Me.examResultObjs??[]):ut[ye]=Me.examResultObjs??[],et=et.concat(ut[ye])});let $e=nt?this.filterExamResultOnTest(et,nt,it):{},Ce=[],Ye=[];if(this.homeworkExamService.mustInClassroom(nt)&&Re.length>0)for(let Me=0;Me<Re.length;Me++){let ye=Re[Me].classroomObj;ye.classroomGroup=Re[Me].classroomGroup;let M=Re[Me].studentObjs??[],P=[];if(M.length>0)for(let H=0;H<M.length;H++){let Be=M[H].parentId??"0";this.commonService.isExistInArray(Ye,M[H].parentId)||Ye.push(M[H].parentId??"0"),ut.hasOwnProperty(Be)&&(Array.isArray(M[H].examResultObjs)||(M[H].examResultObjs=[]),M[H].examResultObjs=this.findExamResultOfStudent(ut[Be],M[H].id??"0"));let Ke=$e.hasOwnProperty(M[H].parentId??0)?$e[M[H].parentId??0]:0;if("all"==v)if(M[H].examResultObjs?.length)M[H].examResultObjs?.forEach((ke,Oe)=>{let xe=this.commonService.castJsonToObj(JSON.stringify(ke));xe&&(xe.resultId=xe.testStatus&&xe.testStatus>0?xe.id:0);let qe=this.createStudentWithResult(M[H],xe,Ke,We,Oe,M[H].examResultObjs?.length??0);P.push(qe)});else{let ke=this.createStudentWithResult(M[H],void 0,Ke,We,-1,0);P.push(ke)}else{let ke=this.filterExamResultByType(M[H].examResultObjs??[],v),Oe=ke.hasOwnProperty(M[H].parentId??0)?ke[M[H].parentId??0]:void 0,qe=this.createStudentWithResult(M[H],Oe,Ke,We,(Oe&&null!=Oe.indexTest&&Oe.indexTest>=0?Oe.indexTest:"first"==v?0:(M[H].examResultObjs?.length??0)-1)??0,M[H].examResultObjs?.length??0);P.push(qe)}}Ce.push({classObj:ye,results:P})}let st=[],Je=this.commonService.myClone(Z)??[];for(let Me=0;Me<Je?.length;Me++)if(!this.commonService.isExistInArray(Ye,Je[Me].parentId)){let ye=$e.hasOwnProperty(Je[Me].parentId??0)?$e[Je[Me].parentId??0]:0;if("all"==v)if(Je[Me].examResultObjs?.length)Je[Me].examResultObjs?.forEach((M,P)=>{let H=this.commonService.castJsonToObj(JSON.stringify(M));H&&(H.resultId=H.testStatus&&H.testStatus>0?H.id:0);let Be=this.createStudentWithResult(Je[Me],H,ye,We,P,Je[Me].examResultObjs?.length??0);st.push(Be)});else{let M=this.createStudentWithResult(Je[Me],void 0,ye,We,-1,0);st.push(M)}else{let M=this.filterExamResultByType(Je[Me].examResultObjs??[],v),P=M.hasOwnProperty(Je[Me].parentId??0)?M[Je[Me].parentId??0]:void 0,Be=this.createStudentWithResult(Je[Me],P,ye,We,(P&&null!=P?.indexTest&&P.indexTest>=0?P.indexTest:"first"==v?0:(Je[Me].examResultObjs?.length??0)-1)??0,Je[Me].examResultObjs?.length??0);st.push(Be)}}"all"!=v&&st.sort((Me,ye)=>this.compareTwoDate(Me.createdAt??"",ye.createdAt??""));let xt=0;(Ce.length||st.length)&&(Ce.forEach(Me=>{Me.results?.forEach(ye=>{let M=this.getMaxGroupId(ye.groupPoints??[]);xt<M&&(xt=M)})}),st.forEach(Me=>{let ye=this.getMaxGroupId(Me.groupPoints??[]);xt<ye&&(xt=ye)})),"export_tool"==B&&Q?.length&&(Ce=Ce.filter(Me=>this.commonService.isExistInArray(Q,Me.classObj?.id)),this.commonService.isExistInArray(Q,-1)||(st=[]));let ce={studentsInClassResults:Ce.length>0?Ce:[],studentsNotInClassResults:st.length>0?st:[],totalAttended:rt,totalQuestion:We,totalUsers:0,examCreatorObj:ae,offlineMixQuestionObjs:ze,examObj:nt,hasEssayQuestion:ct,offlineExamObj:Qe,canResetStudentCode:Ue,hasCreateStudentCode:gt,questionObjs:je,fileTypeStr:Ne,errorConfigClassroomPermission:be.data?.errorConfigClassroomPermission,errorMessage:be.data?.errorMessage,maxGroupId:xt};if("export_tool"!=B){let Me=this.gzipHelper.zipBigContent(JSON.stringify(ce));this.browserStorageService.saveSimpleSessionStorage(te,Me)}ee.next({status:200,success:1,data:ce,message:"successful"}),ee.complete()}else ee.next({status:J.code,success:0,data:null,message:J.message??""}),ee.complete()}):(ee.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:rt,totalQuestion:We,hasEssayQuestion:ct,totalUsers:0,examCreatorObj:ae,offlineMixQuestionObjs:ze,examObj:nt,offlineExamObj:Qe,canResetStudentCode:Ue,hasCreateStudentCode:gt,questionObjs:je,fileTypeStr:be.data?.fileTypeStr,errorConfigClassroomPermission:be.data?.errorConfigClassroomPermission,errorMessage:be.data?.errorMessage,maxGroupId:0},message:"successful"}),ee.complete())}else ee.next({status:be.code,success:0,data:null,message:be.message??""}),ee.complete()})})}getAllExamResultObjs(B,L,v,F,Q){this.examPageResultService.apiExamPageResultGetObjsV2Get(v,"test_review"==B||"export_tool"==B?"export":"tested_list",F).subscribe(te=>{1==te.success?(te.data?.objs&&L.push(...te.data.objs),te.data?.nextPage?this.globalService.isStopIntervalFunc(B)?Q({studentWithResultObjs:L,success:1}):setTimeout(()=>{this.getAllExamResultObjs(B,L,v,te.data?.nextPage??"",Q)},300):Q({studentWithResultObjs:L,success:1})):Q({code:te.code,studentWithResultObjs:[],success:0,message:te.message??""})})}compareTwoDate(B,L){var v=new Date(B).getTime();v=isNaN(v)?0:v;var F=new Date(L).getTime();return v-(F=isNaN(F)?0:F)>0?1:v-F<0?-1:0}filterExamResultOnTest(B,L,v){var F={};return B.forEach(Q=>{var ee=this.commonService.myClone(Q)??{};if(ee.testStatus)F[ee.userId??0]=ee.testStatus;else if(ee.startedTest&&v)if(L.endTime){var te=Math.floor(new Date(L.endTime).getTime()/1e3);F[ee.userId??0]=v<=te+60*(L.minutes??0)+600?0:-1}else{var oe=ee.startedTest?Math.floor(new Date(ee.startedTest).getTime()/1e3):0;F[ee.userId??0]=v<=oe+86400?0:-1}else F[ee.userId??0]=0}),F}filterExamResultByType(B,L){var v={};if(B.length>1)B.forEach((Q,ee)=>{var te=this.commonService.myClone(Q);Q.testStatus&&(te.resultId=te.id,te.indexTest=ee,"default"==L&&(v[te.userId??0]=te),"last"==L&&(v[te.userId??0]=te),"first"==L&&(v.hasOwnProperty(te.userId??0)||(v[te.userId??0]=te)),"highest"==L)&&(v.hasOwnProperty(te.userId??0)?(v[te.userId??0].mark??-1)<=(te.mark??-1)&&(v[te.userId??0]=te):v[te.userId??0]=te)});else{var F=this.commonService.myClone(B[0]??{});F.resultId=F.testStatus?F.id:0,F.indexTest=0,v[F.userId??0]=F}return v}findExamResultOfStudent(B,L){var v=[];return B.forEach(F=>{(F.studentId==L||null==F.studentId)&&v.push(F)}),v}addResultIdToExamResult(B){var L=[];return B.forEach(v=>{var F=this.commonService.myClone(v)??{};F.resultId=F.id,F.testStatus&&L.push(F)}),L}compareLengthWithExamQuestion(B,L){var v=this.commonService.myClone(B);if(L>0&&B.length<L)for(var F=0;F<L-B.length;F++)v.push("");return v}mergeStudentWithAvatar(B){var L=[];return B.forEach(v=>{var F=L.filter(ee=>ee.parentId==v.parentId);if(F&&0!=F.length)for(var Q=0;Q<L.length;Q++)L[Q].parentId==v.parentId&&(L[Q].examResultObjs=L[Q].examResultObjs?.concat(v.examResultObjs??[]));else L.push(v)}),L}createStudentWithResult(B,L,v,F,Q,ee){return{id:B.id,userId:B.parentId,studentId:B.id,identificationNumber:L?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??B.identificationNumber??0,offlineMixQuestionHashId:L?.offlineMark?.rawOfflineMixquestionId??0,studentCode:L?.offlineMark?.studentCode??0,gender:B.gender,fullName:B.fullName,avatar:B.avatar,birthday:B.birthday,resultId:L?.hasOwnProperty("resultId")?L.resultId:0,answers:L?.hasOwnProperty("answers")?L.answers:null,rightAnswer:L?.hasOwnProperty("rightAnswer")?L.rightAnswer:0,totalQuestion:L?.hasOwnProperty("totalQuestion")?L.totalQuestion:0,mark:L?.hasOwnProperty("mark")?L?.mark:null,trueFalseMark:L?.hasOwnProperty("trueFalseMark")?L.trueFalseMark:null,essayMark:L?.hasOwnProperty("essayMark")?L.essayMark:null,files:L?.hasOwnProperty("files")?L.files:null,infors:L?.hasOwnProperty("infors")?L?.infors:null,confirmedAt:L?.hasOwnProperty("confirmedAt")?L?.confirmedAt:null,startedTest:L?.hasOwnProperty("startedTest")?L?.startedTest:null,createdAt:L?.hasOwnProperty("createdAt")?L.createdAt:null,totalExamResultObjs:B.examResultObjs.length,answeredQuestions:L?.hasOwnProperty("answeredQuestions")?L.answeredQuestions:[],groupPoints:this.getGroupPoints(L?.answeredQuestions?L?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:L?.examTrackObj?.exitFullScreen,blurCount:L?.examTrackObj?.blurWindow},status:v,nameImages:B.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion(L?.answerMixObjs??[],F)??[],testedTime:Q+1,totalTestTime:ee,subjectMarkValues:L?.subjectMarks,isOffline:L?.isOffline??!1,countEssayQuestion:this.sAztExamResultListSortService._checkCounterEssayQuestionObjs(L?.hasOwnProperty("answeredQuestions")&&L?.answeredQuestions?L.answeredQuestions:[]),checkBoxGroupControl:new l.gE({isShow:new l.MJ(!1,{nonNullable:!0}),selectedCheckbox:new l.MJ(!1,{nonNullable:!0})}),questionTypeMarks:L?.questionTypeMarks??[],schoolName:B.schoolName??"",phone:B.phone??"",email:B.email??"",userName:B?.userName??""}}getGroupPoints(B){let L=[];return B.forEach(v=>{let F=!1;for(let Q=0;Q<L.length;Q++)L[Q].id==v.groupId&&(F=!0,L[Q].point+=v.correct&&v.scorePerQuestion?v.scorePerQuestion:0);!F&&v.groupId&&L.push({id:v.groupId,point:v.correct&&v.scorePerQuestion?v.scorePerQuestion:0})}),L.sort((v,F)=>(v.id??0)-(F.id??0)),L}getMaxGroupId(B){let L=[];return B.forEach(v=>{v.id&&!this.commonService.isExistInArray(L,v.id)&&L.push(v.id)}),L.length}}return(j=A).\u0275fac=function(B){return new(B||j)(h.KVO(_.R),h.KVO(x.TE),h.KVO(T.p),h.KVO(re.r),h.KVO(_e.z),h.KVO(p.f),h.KVO(q.Z),h.KVO(V.w))},j.\u0275prov=h.jDH({token:j,factory:j.\u0275fac,providedIn:"root"}),A})()},32835:(_t,Ee,w)=>{"use strict";w.d(Ee,{i:()=>d});var l=w(48891);let d=(()=>{var h;class _{processData(T){let re=[],_e=[];if(T)for(var p=0;p<T.length;p++)if("scroll"!=T[p][0]){var q={index:T[p][0],alpha:T[p][1],key:T[p][2],questionId:Number(T[p][3]),second:Number(T[p][4])};re.push(q)}else{var V={scrollPos:Number(T[p][1]),second:Number(T[p][2])};_e.push(V)}return[re,_e]}}return(h=_).\u0275fac=function(T){return new(T||h)},h.\u0275prov=l.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),_})()},97099:(_t,Ee,w)=>{"use strict";w.d(Ee,{B:()=>Y});var l=w(54460),d=w(10936),h=w(65162),_=w(53220),x=w(81275),T=w(15343),re=w(59055),_e=w(44233),p=w(5502),q=w(21656),V=w(70050),R=w(76407),j=w(35143),A=w(48891);let Y=(()=>{var B;class L{}return(B=L).\u0275fac=function(F){return new(F||B)},B.\u0275mod=A.$C({type:B}),B.\u0275inj=A.G2t({imports:[l.MD,q.s,j.Q,V.L,d.YN,d.X1,p.Id,_.h,h.iI,T.flO.pick(T.Ptg),x.rc,re.e,R.n,_e.An]}),L})()},54479:(_t,Ee,w)=>{"use strict";w.d(Ee,{t:()=>xt});var l=w(73014),d=w(27691),h=w(48891),_=w(10936),x=w(59640),T=w(78111),re=w(64198),_e=w(83229),p=w(28023),q=w(58112),V=w(76476),R=w(41426),j=w(51113),A=w(54460),Y=w(47712),B=w(7919),L=w(99965),v=w(84278),F=w(34815),Q=w(15343),ee=w(58588),te=w(76975);const oe=["mnoteContainer"],Ve=["aztMarkNote"],Se=ce=>({display:ce}),He=ce=>({border:ce}),be=ce=>({"is-invalid":ce}),ht=()=>({"mr-1 cursor-pointer":!0});function it(ce,Me){if(1&ce){const ye=h.RV6();h.j41(0,"lucide-icon",20),h.nI1(1,"mytranslate"),h.bIt("click",function(){h.eBV(ye);const P=h.XpG(2).$implicit;return h.Njj(P.showEssayMark=!1)}),h.k0s()}2&ce&&(h.FS9("matTooltip",h.bMT(1,2,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),h.Y8G("ngClass",h.lJ4(4,ht)))}function nt(ce,Me){if(1&ce){const ye=h.RV6();h.j41(0,"lucide-icon",21),h.nI1(1,"mytranslate"),h.bIt("click",function(){h.eBV(ye);const P=h.XpG(2).$implicit;return h.Njj(P.showEssayMark=!0)}),h.k0s()}2&ce&&(h.FS9("matTooltip",h.bMT(1,2,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),h.Y8G("ngClass",h.lJ4(4,ht)))}function Re(ce,Me){1&ce&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&ce&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function rt(ce,Me){1&ce&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&ce&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function je(ce,Me){1&ce&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&ce&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function ae(ce,Me){if(1&ce&&(h.j41(0,"div",22),h.DNE(1,Re,3,3,"span",10)(2,rt,3,3,"span",10)(3,je,3,3,"span",10),h.k0s()),2&ce){const ye=h.XpG(2).$implicit;h.R7$(),h.Y8G("ngIf",ye.essayAnswersFormGroup.controls.mark.errors.min),h.R7$(),h.Y8G("ngIf",ye.essayAnswersFormGroup.controls.mark.errors.max),h.R7$(),h.Y8G("ngIf",ye.essayAnswersFormGroup.controls.mark.errors.pattern)}}function Qe(ce,Me){if(1&ce&&(h.qex(0),h.j41(1,"div",13),h.DNE(2,it,2,5,"lucide-icon",14)(3,nt,2,5,"lucide-icon",15),h.j41(4,"span",16),h.EFF(5),h.nI1(6,"mytranslate"),h.j41(7,"span",17),h.nI1(8,"mytranslate"),h.EFF(9),h.nI1(10,"mytranslate"),h.k0s()(),h.nrm(11,"input",18),h.nI1(12,"mytranslate"),h.k0s(),h.DNE(13,ae,4,3,"div",19),h.bVm()),2&ce){let ye;const M=h.XpG().$implicit,P=h.XpG();h.R7$(2),h.Y8G("ngIf",M.showEssayMark),h.R7$(),h.Y8G("ngIf",!M.showEssayMark),h.R7$(2),h.Lme(" ",h.bMT(6,14,"lang_auto_cau")," ",(null!==(ye=M.indexLabel)&&void 0!==ye?ye:0)+1," "),h.R7$(2),h.FS9("matTooltip",h.bMT(8,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.R7$(2),h.Lme("(",M.essMaxPoint," ",h.bMT(10,18,"lang_auto_diem_brackets"),""),h.R7$(2),h.FS9("placeholder",h.bMT(12,20,"lang_auto_nhap_diem")),h.Y8G("readonly",!P.showForTeacher)("decimal",!0)("ngClass",h.eq3(22,be,M.essayAnswersFormGroup.controls.mark&&M.essayAnswersFormGroup.controls.mark.invalid))("value",M.essayAnswersFormGroup.controls.mark.value)("formControl",M.essayAnswersFormGroup.controls.mark),h.R7$(2),h.Y8G("ngIf",M.essayAnswersFormGroup.controls.mark.errors)}}function ct(ce,Me){if(1&ce&&(h.j41(0,"div",12),h.DNE(1,Qe,14,24,"ng-container",10),h.k0s()),2&ce){const ye=Me.$implicit,M=Me.index,P=h.XpG();h.Y8G("ngStyle",h.eq3(2,He,M==P.questions.length-1?"none":"")),h.R7$(),h.Y8G("ngIf",ye.essayAnswersFormGroup)}}function We(ce,Me){if(1&ce){const ye=h.RV6();h.j41(0,"div",23)(1,"button",24),h.bIt("click",function(){h.eBV(ye);const P=h.XpG();return h.Njj(P.saveDataMarkExercise())}),h.EFF(2),h.nI1(3,"mytranslate"),h.nI1(4,"mytranslate"),h.k0s()()}if(2&ce){const ye=h.XpG();h.R7$(),h.Y8G("disabled",ye.isLoading||ye.findQuestionFormInvalid()||ye.loadingDataCdn&&ye.files.length>0),h.R7$(),h.SpI(" ",ye.isLoading?h.bMT(3,2,"lang_auto_dang_luu_doing"):h.bMT(4,4,"lang_auto_luu_diem")," ")}}function ze(ce,Me){if(1&ce&&h.nrm(0,"azt-question-standalone-for-student-at-review-page",29),2&ce){let ye;const M=h.XpG().$implicit,P=h.XpG();h.Y8G("follower",P.followerRenderQuest)("examObj",P.examObj)("examConfig",P.examConfig)("questionObj",M)("curQuestionIndex",null!==(ye=M.indexLabel)&&void 0!==ye?ye:0)("userAnswersObj",P.userAnswersObj)("currentTab","essay_tab")}}function Ue(ce,Me){if(1&ce&&h.nrm(0,"azt-question-standalone-for-teacher-at-review-page",30),2&ce){let ye;const M=h.XpG().$implicit,P=h.XpG();h.Y8G("follower",P.followerRenderQuest)("examObj",P.examObj)("questionObj",M)("curQuestionIndex",null!==(ye=M.indexLabel)&&void 0!==ye?ye:0)("userAnswersObj",P.userAnswersObj)("orgExamObjs",P.orgExamObjs)("currentTab","essay_tab")}}function gt(ce,Me){1&ce&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&ce&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Ne(ce,Me){1&ce&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&ce&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function J(ce,Me){1&ce&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&ce&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Z(ce,Me){if(1&ce&&(h.j41(0,"div",22),h.DNE(1,gt,3,3,"span",10)(2,Ne,3,3,"span",10)(3,J,3,3,"span",10),h.k0s()),2&ce){const ye=h.XpG(3).$implicit;h.R7$(),h.Y8G("ngIf",null==ye.essayAnswersFormGroup.controls.mark.errors?null:ye.essayAnswersFormGroup.controls.mark.errors.min),h.R7$(),h.Y8G("ngIf",null==ye.essayAnswersFormGroup.controls.mark.errors?null:ye.essayAnswersFormGroup.controls.mark.errors.max),h.R7$(),h.Y8G("ngIf",null==ye.essayAnswersFormGroup.controls.mark.errors?null:ye.essayAnswersFormGroup.controls.mark.errors.pattern)}}function ut(ce,Me){if(1&ce&&(h.qex(0),h.j41(1,"div",34)(2,"label",35),h.EFF(3),h.nI1(4,"mytranslate"),h.j41(5,"span",17),h.nI1(6,"mytranslate"),h.EFF(7),h.nI1(8,"mytranslate"),h.k0s(),h.EFF(9," : "),h.k0s(),h.nrm(10,"input",36),h.nI1(11,"mytranslate"),h.DNE(12,Z,4,3,"div",19),h.k0s(),h.bVm()),2&ce){let ye;const M=h.XpG(2),P=M.$implicit,H=M.index,Be=h.XpG();h.R7$(2),h.FS9("for","cau_"+H),h.R7$(),h.Lme(" ",h.bMT(4,14,"lang_auto_nhap_diem_cau")," ",(null!==(ye=P.indexLabel)&&void 0!==ye?ye:0)+1," "),h.R7$(2),h.FS9("matTooltip",h.bMT(6,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.R7$(2),h.Lme("(",P.essMaxPoint," ",h.bMT(8,18,"lang_auto_diem_brackets"),""),h.R7$(3),h.FS9("placeholder",h.bMT(11,20,"lang_auto_nhap_diem")),h.Y8G("readonly",!Be.showForTeacher)("ngClass",h.eq3(22,be,P.essayAnswersFormGroup.controls.mark&&P.essayAnswersFormGroup.controls.mark.invalid))("id","cau_"+H)("decimal",!0)("value",P.essayAnswersFormGroup.controls.mark.value)("formControl",P.essayAnswersFormGroup.controls.mark),h.R7$(2),h.Y8G("ngIf",P.essayAnswersFormGroup.controls.mark.errors)}}function et(ce,Me){if(1&ce&&(h.j41(0,"div"),h.DNE(1,ut,13,24,"ng-container",10),h.j41(2,"div",31)(3,"label",32),h.EFF(4),h.nI1(5,"mytranslate"),h.k0s(),h.nrm(6,"textarea",33),h.nI1(7,"mytranslate"),h.k0s()()),2&ce){let ye;const M=h.XpG().$implicit,P=h.XpG();h.R7$(),h.Y8G("ngIf",P.showForTeacher),h.R7$(2),h.FS9("for","comment_"+M.id),h.R7$(),h.Lme("",h.bMT(5,8,"lang_mark_essay_add_comment_question")," ",(null!==(ye=M.indexLabel)&&void 0!==ye?ye:0)+1,":"),h.R7$(2),h.FS9("id","comment_"+M.id),h.FS9("placeholder",h.bMT(7,10,"lang_auto_nhap_nhan_xet")),h.Y8G("readonly",!P.showForTeacher)("formControl",M.essayAnswersFormGroup.controls.comment)}}function $e(ce,Me){if(1&ce&&(h.j41(0,"div",25)(1,"div",26),h.DNE(2,ze,1,7,"azt-question-standalone-for-student-at-review-page",27)(3,Ue,1,7,"azt-question-standalone-for-teacher-at-review-page",28)(4,et,8,12,"div",10),h.k0s()()),2&ce){const ye=Me.$implicit,M=Me.index,P=h.XpG();h.R7$(),h.Mz_("id","q_",M,""),h.Y8G("ngStyle",h.eq3(6,Se,ye.showEssayMark?"block":"none")),h.R7$(),h.Y8G("ngIf",!P.showForTeacher),h.R7$(),h.Y8G("ngIf",P.showForTeacher),h.R7$(),h.Y8G("ngIf",ye.essayAnswersFormGroup)}}function Ce(ce,Me){1&ce&&(h.j41(0,"div",37)(1,"b"),h.EFF(2),h.nI1(3,"mytranslate"),h.k0s(),h.EFF(4),h.nI1(5,"mytranslate"),h.k0s()),2&ce&&(h.R7$(2),h.SpI("",h.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),h.R7$(2),h.SpI(" ",h.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Ye(ce,Me){if(1&ce){const ye=h.RV6();h.j41(0,"azt-mark-note",39,1),h.bIt("doneLoadData",function(P){h.eBV(ye);const H=h.XpG(2);return h.Njj(H.doneLoadData(P))}),h.k0s()}if(2&ce){const ye=h.XpG(2);h.Y8G("dataMarkNote",ye.dataMarkNote)("screenType","exam")("modeView",ye.showForTeacher?"teacher":"student")}}function st(ce,Me){if(1&ce&&(h.qex(0),h.DNE(1,Ye,2,3,"azt-mark-note",38),h.bVm()),2&ce){const ye=h.XpG();h.R7$(),h.Y8G("ngIf",1===ye.curSelectedTab||ye.changeSelectedTab)}}function Je(ce,Me){if(1&ce){const ye=h.RV6();h.j41(0,"div",40)(1,"button",41),h.bIt("click",function(){h.eBV(ye);const P=h.XpG();return h.Njj(P.saveDataMarkExercise())}),h.EFF(2),h.nI1(3,"mytranslate"),h.nI1(4,"mytranslate"),h.k0s()()}if(2&ce){const ye=h.XpG();h.R7$(),h.Y8G("disabled",ye.isLoading||ye.findQuestionFormInvalid()||ye.loadingDataCdn&&ye.files.length>0),h.R7$(),h.SpI(" ",ye.isLoading?h.bMT(3,2,"lang_auto_dang_luu_doing"):h.bMT(4,4,"lang_auto_luu_diem")," ")}}let xt=(()=>{var ce;class Me extends x.H{getMaxPoint(M){let P=this.questions.find(H=>H.id==M);return P?P.scorePerQuestion??0:0}remark(M){let P=this.questions.map(Ke=>({questionId:Ke.essayAnswersFormGroup?.controls.questionId.value,comment:Ke.essayAnswersFormGroup?.controls.comment.value,mark:Number(Ke.essayAnswersFormGroup?.controls.mark.value)})),H=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});this.examResultService.apiExamResultSaveResultPost({id:this.resultID,result:M,essayResult:void 0,essayAnswers:P},H).subscribe(Ke=>{this.isLoading=!1,1==Ke.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1)):(this.commonService.snackError(Ke.message),this.saveResultEvent.emit(0))})}initDataMarkNote(){this.examResultObj.result?this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId}:(this.files.forEach(M=>M.url=this.sAztCommonCdnService.getMyCdn(M.url??"")),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)})}saveDataMarkExercise(){var M=this;return(0,l.A)(function*(){if(!M.questions.find(H=>H.essayAnswersFormGroup?.controls.mark.value))return M.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");if(M.questions.forEach(H=>{H.essayAnswersFormGroup?.controls.mark.value||H.essayAnswersFormGroup?.controls.mark.setValue("0")}),M.isLoading=!0,!M.files.length||(M.objectResult=M.MarkNote?.exportDataMarkNote(),!M.objectResult.pages?.length&&M.files.find(H=>(0,re.nL)(H.mimes??"")||(0,re.rl)(H.mimes??"")||!(0,re.N6)(H.mimes??""))))return M.remark("");if(M.objectResult.pages?.length){let H=!1;for(let xe=0;xe<M.objectResult.pages.length;xe++)if(M.objectResult.pages[xe]&&M.objectResult.pages[xe].draws?.length)for(let qe=0;qe<(M.objectResult.pages[xe].draws?.length??0);qe++){let D=M.objectResult.pages[xe].draws?.[qe]??{};D.src&&D.src.includes("base64")&&(H=!0)}H&&(yield M.uploadDrawBase64ToCdn());const Be=M.serializeJson(M.objectResult),Ke=M.zipDataService.convertContentGzip(Be),ke=new Blob([Ke],{type:"text/plain"}),Oe=new File([ke],"txt",{type:"text/plain"});M.apiUploadService.uploadToCdnForHomework(Oe).subscribe(xe=>{if(!xe.success)return M.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");M.remark(M.serializeJson({urlDataMark:xe.data?.url??"",version:"0.1"}))})}})()}uploadDrawBase64ToCdn(){return new Promise(M=>{if(!this.objectResult.pages)return;let P=[];this.objectResult.pages.forEach(H=>P.push(!1)),this.objectResult.pages.forEach((H,Be)=>{H.draws?.length&&H.draws.forEach((Ke,ke)=>{if(Ke.src&&Ke.src.includes("base64")){P[Be]=!0;let Oe=(0,_e.q)(Ke.src);this.apiUploadService.commonUploadForMarkResult(Oe,`essay_note_${Be}_${ke}_${this.resultID}.png`,"image/png").subscribe(xe=>{xe.type!=d.hv.UploadProgress&&(Ke.src=xe.data?.url,P[Be]=!1),P.includes(!0)||M()})}})})})}doneLoadData(M){this.loadingDataCdn=!1}autoResizeFeedBackArea(M){const P=document.getElementById("comment_"+M);P&&setTimeout(()=>{P.style.cssText="height:auto;",P.style.cssText="height:"+(P.scrollHeight+30)+"px"},0)}findQuestionFormInvalid(){return null!=this.questions.find(M=>M.essayAnswersFormGroup?.invalid)}initEssayFormGroupQuestion(){let M=this.examResultObj.confirmedAt?new p.X(this.commonService).parserEssayResult(this.examResultObj.essayResult):[],P=(this.examResultObj.confirmedAt?this.examResultObj.essayAnswerObjs:[])??[];this.questions.forEach((H,Be)=>{let Ke=this.getMaxPoint(H.id);this.totalMaxPoint+=Ke,H.essMaxPoint=Ke,this.maxPointPerQuestion.push(H.essMaxPoint);let ke=M.find(xe=>xe.questionIndex==Be),Oe=P.find(xe=>xe.questionId==H.id)??{questionId:H.id,comment:void 0,mark:ke?.questionMark};H.showEssayMark=!0,H.essayAnswersFormGroup=new _.gE({questionId:new _.MJ(H.id,{nonNullable:!0}),mark:new _.MJ(Oe?.mark?.toString()??"",{nonNullable:!0,validators:[_.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),_.k0.min(0),_.k0.max(H.essMaxPoint??0)]}),comment:new _.MJ(Oe?.comment??"",{nonNullable:!0})})})}ngOnInit(){this.initDataMarkNote(),this.followerRenderQuest.setNumQuest(this.questions.length),this.initEssayFormGroupQuestion(),super.ngOnInit()}constructor(M,P,H,Be){super(),this.sAztCommonCdnService=M,this.examResultService=P,this.apiUploadService=H,this.zipDataService=Be,this.orgExamObjs=[],this.questions=[],this.files=[],this.resultID=0,this.userAnswersObj={},this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new h.bkB,this.followerRenderQuest=new T.e,this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.jsonData={},this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return(ce=Me).\u0275fac=function(M){return new(M||ce)(h.rXU(q.c),h.rXU(V._),h.rXU(R.T),h.rXU(j.j))},ce.\u0275cmp=h.VBU({type:ce,selectors:[["azt-mark-essay-new"]],viewQuery:function(M,P){if(1&M&&(h.GBs(oe,5),h.GBs(Ve,5)),2&M){let H;h.mGM(H=h.lsd())&&(P.mnoteContainer=H.first),h.mGM(H=h.lsd())&&(P.MarkNote=H.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",resultID:"resultID",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},features:[h.Vt3],decls:11,vars:9,consts:[["mnoteContainer",""],["aztMarkNote",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"ngClass","matTooltip","click",4,"ngIf"],["name","eye_off","size","24",3,"ngClass","matTooltip","click",4,"ngIf"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","value","formControl"],["class","mt-2 text-danger text-xs",4,"ngIf"],["name","eye","size","24",3,"click","ngClass","matTooltip"],["name","eye_off","size","24",3,"click","ngClass","matTooltip"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",3,"id","ngStyle"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","20px"],[1,"mb-2","font-medium",3,"for"],["type","text","cols","10","autoResize","",1,"form-control","d-inline-flex","w-full","mt-1",3,"readonly","id","placeholder","formControl"],[1,"block-input",2,"margin-bottom","10px"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","value","formControl"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"doneLoadData","dataMarkNote","screenType","modeView"],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(M,P){1&M&&(h.j41(0,"div",2)(1,"div",3),h.DNE(2,ct,2,4,"div",4),h.k0s(),h.DNE(3,We,5,6,"div",5),h.k0s(),h.j41(4,"div",6),h.DNE(5,$e,5,8,"div",7),h.k0s(),h.DNE(6,Ce,6,6,"div",8),h.j41(7,"div",9,0),h.DNE(9,st,2,1,"ng-container",10),h.k0s(),h.DNE(10,Je,5,6,"div",11)),2&M&&(h.R7$(2),h.Y8G("ngForOf",P.questions),h.R7$(),h.Y8G("ngIf",P.showForTeacher),h.R7$(2),h.Y8G("ngForOf",P.questions),h.R7$(),h.Y8G("ngIf",P.files&&0==P.files.length),h.R7$(),h.Y8G("ngStyle",h.eq3(7,Se,P.files&&0==P.files.length?"none":"block")),h.R7$(2),h.Y8G("ngIf",P.dataMarkNote&&P.dataMarkNote.answer_obj&&P.files&&P.files.length>0),h.R7$(),h.Y8G("ngIf",P.showForTeacher))},dependencies:[A.YU,A.Sq,A.bT,A.B3,Y.oV,B.Z,L.j,v.x,F.o,_.me,_.BC,_.l_,Q.WGl,ee.i,te.wp],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:#2361ae2e;border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%], .maxPoint[_ngcontent-%COMP%]{font-size:12px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),Me})()},28023:(_t,Ee,w)=>{"use strict";w.d(Ee,{X:()=>l});class l{constructor(h){this.commonService=h}parserEssayResult(h){let _=[],x=this.commonService.myParseJson(h??"{}")??{};return Object.entries(x).map(([re,_e])=>({key:re,value:_e})).forEach(re=>{let _e=re.key.replace("cau","");_.push({questionIndex:isNaN(Number(_e))?void 0:Number(_e),questionMark:isNaN(Number(re.value))?void 0:Number(re.value)})}),_}}},94315:(_t,Ee,w)=>{"use strict";w.d(Ee,{eX:()=>j});class l{constructor(){this.x=0,this.y=0}toBase64String(){return(new B).writeCvPoint2u(this).toBase64String()}}class d{constructor(){this.x=0,this.y=0}toBase64String(){return(new B).writeCvPoint2f(this).toBase64String()}}class h{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new B).writeCvRect2f(this).toBase64String()}}class _{constructor(){this.center=new d,this.filled=!1}toBase64String(){return(new B).writeAnswerCircle(this).toBase64String()}}class x{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new B).writeTableAnswer(this).toBase64String()}}class T{constructor(){this.top=new d,this.left=new d,this.bottom=new d,this.right=new d}toBase64String(){return(new B).writeResultRect(this).toBase64String()}}class re{constructor(){this.id=0,this.region=new h}toBase64String(){return(new B).writeCropRegion(this).toBase64String()}}class _e{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new T,this.studentId=new x,this.examId=new x,this.answerTable=new x,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new B).writeResultOutput(this).toBase64String()}}class p{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new B).writeAnswerSheetInput(this).toBase64String()}}class q{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new B).writeSmallAnswerCircle(this).toBase64String()}}class V{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new B).writeSmallTableAnswer(this).toBase64String()}}class R{constructor(){this.studentId=new V,this.examId=new V,this.answerTable=new V}toBase64String(){return(new B).writeDrawData(this).toBase64String()}}class j{constructor(v){this.bytes=v,this.cursor=0,this.length=v.byteLength}updateCursor(v){if(this.cursor=this.cursor+v,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let v=this.bytes[this.cursor];return this.updateCursor(1),v}parseInt(){let v=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(v).getInt32(0)}parseDouble(){let v=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(v).getFloat64(0,!0)}parseString(){let v=new TextDecoder("utf-8"),F=this.cursor,Q=this.bytes[this.cursor];for(;0!=Q;)this.updateCursor(1),Q=this.bytes[this.cursor];let ee=this.bytes.slice(F,this.cursor),te=v.decode(ee);return this.updateCursor(1),te}parseBool(){let v=this.bytes[this.cursor];return this.updateCursor(1),v>0}parseCvPoint2u(){let v=new l;return v.x=this.parseUchar(),v.y=this.parseUchar(),v}parseCvPoint2f(){let v=new d;return v.x=this.parseDouble(),v.y=this.parseDouble(),v}parseCvRect2f(){let v=new h;return v.x=this.parseDouble(),v.y=this.parseDouble(),v.width=this.parseDouble(),v.height=this.parseDouble(),v}parseAnswerCircle(){let v=new _;return v.center=this.parseCvPoint2f(),v.filled=this.parseBool(),v}parseTableAnswer(){let v=new x,F=0;v.rows=this.parseInt(),v.cols=this.parseInt(),v.radius=this.parseInt(),F=this.parseInt();for(let Q=0;Q<F;Q++)v.answers.push(this.parseAnswerCircle());return v}parseResultRect(){let v=new T;return v.top=this.parseCvPoint2f(),v.left=this.parseCvPoint2f(),v.bottom=this.parseCvPoint2f(),v.right=this.parseCvPoint2f(),v}parseCropRegion(){let v=new re;return v.id=this.parseInt(),v.region=this.parseCvRect2f(),v}parseResultOutput(){let v=new _e,F=0;v.type=this.parseInt(),v.errorCode=this.parseInt(),v.paperCorner=this.parseResultRect(),v.studentId=this.parseTableAnswer(),v.examId=this.parseTableAnswer(),v.answerTable=this.parseTableAnswer(),v.imageWidth=this.parseInt(),v.imageHeight=this.parseInt(),v.imageSize=this.parseInt(),F=this.parseInt();for(let Q=0;Q<F;Q++)v.cropRegion.push(this.parseCropRegion());return v}parseAnswerSheetInput(){let v=new p;return v.templateType=this.parseInt(),v.imageWidth=this.parseInt(),v.imageHeight=this.parseInt(),v}parseSmallAnswerCircle(){let v=new q;return v.position=this.parseUchar(),v.x=this.parseUchar(),v.y=this.parseUchar(),v.filledCols=this.parseUchar(),v.rows=this.parseUchar(),v}parseSmallTableAnswer(){let v=new V,F=0;v.rows=this.parseUchar(),v.cols=this.parseUchar(),v.radius=this.parseUchar(),F=this.parseInt();for(let Q=0;Q<F;Q++)v.answers.push(this.parseSmallAnswerCircle());return v}parseDrawData(){let v=new R;return v.studentId=this.parseSmallTableAnswer(),v.examId=this.parseSmallTableAnswer(),v.answerTable=this.parseSmallTableAnswer(),v}}const A=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class B{constructor(){this.bytes=[]}writeUchar(v){return this.bytes.push(v),this}writeUint8Array(v){for(let F=0;F<v.length;F++)this.bytes.push(v[F]);return this}writeArrayBuffer(v){let F=new Uint8Array(v);return this.writeUint8Array(F),this}writeInt(v){let F=new ArrayBuffer(4);return new DataView(F).setUint32(0,v,!1),this.writeArrayBuffer(F),this}writeDouble(v){let F=new ArrayBuffer(8);return new DataView(F).setFloat64(0,v,!0),this.writeArrayBuffer(F),this}writeString(v){let Q=(new TextEncoder).encode(v);return this.writeUint8Array(Q),this.writeUchar(0),this}writeBool(v){return this.writeUchar(v?1:0),this}toBase64String(){return function Y(L){let F,v="",Q=L.length;for(F=2;F<Q;F+=3)v+=A[L[F-2]>>2],v+=A[(3&L[F-2])<<4|L[F-1]>>4],v+=A[(15&L[F-1])<<2|L[F]>>6],v+=A[63&L[F]];return F===Q+1&&(v+=A[L[F-2]>>2],v+=A[(3&L[F-2])<<4],v+="=="),F===Q&&(v+=A[L[F-2]>>2],v+=A[(3&L[F-2])<<4|L[F-1]>>4],v+=A[(15&L[F-1])<<2],v+="="),v}(new Uint8Array(this.bytes))}writeCvPoint2u(v){return this.writeUchar(v.x),this.writeUchar(v.y),this}writeCvPoint2f(v){return this.writeDouble(v.x),this.writeDouble(v.y),this}writeCvRect2f(v){return this.writeDouble(v.x),this.writeDouble(v.y),this.writeDouble(v.width),this.writeDouble(v.height),this}writeAnswerCircle(v){return this.writeCvPoint2f(v.center),this.writeBool(v.filled),this}writeTableAnswer(v){this.writeInt(v.rows),this.writeInt(v.cols),this.writeInt(v.radius),this.writeInt(v.answers.length);for(let F of v.answers)this.writeAnswerCircle(F);return this}writeResultRect(v){return this.writeCvPoint2f(v.top),this.writeCvPoint2f(v.left),this.writeCvPoint2f(v.bottom),this.writeCvPoint2f(v.right),this}writeCropRegion(v){return this.writeInt(v.id),this.writeCvRect2f(v.region),this}writeResultOutput(v){this.writeInt(v.type),this.writeInt(v.errorCode),this.writeResultRect(v.paperCorner),this.writeTableAnswer(v.studentId),this.writeTableAnswer(v.examId),this.writeTableAnswer(v.answerTable),this.writeInt(v.imageWidth),this.writeInt(v.imageHeight),this.writeInt(v.imageSize),this.writeInt(v.cropRegion.length);for(let F of v.cropRegion)this.writeCropRegion(F);return this}writeAnswerSheetInput(v){return this.writeInt(v.templateType),this.writeInt(v.imageWidth),this.writeInt(v.imageHeight),this}writeSmallAnswerCircle(v){return this.writeUchar(v.position),this.writeUchar(v.x),this.writeUchar(v.y),this.writeUchar(v.filledCols),this.writeUchar(v.rows),this}writeSmallTableAnswer(v){this.writeUchar(v.rows),this.writeUchar(v.cols),this.writeUchar(v.radius),this.writeInt(v.answers.length);for(let F of v.answers)this.writeSmallAnswerCircle(F);return this}writeDrawData(v){return this.writeSmallTableAnswer(v.studentId),this.writeSmallTableAnswer(v.examId),this.writeSmallTableAnswer(v.answerTable),this}}},72267:(_t,Ee,w)=>{"use strict";w.d(Ee,{E:()=>x});var l=w(48891),d=w(53793),h=w(51113),_=w(99927);let x=(()=>{var T;class re{addIndexLabelToQuestionObjs(p){for(let q=0;q<(p?.length??0);q++)p?.[q]&&(p[q].indexLabel=q);return p}getEssayQuestionObjs(p){let q=[];for(let V=0;V<(p?.length??0);V++)this.answerTypeService.isEssayAnswer(p?.[V])&&p?.[V]&&q.push(p[V]);return q}getTrueFalseQuestionObjs(p){let q=[];for(let V=0;V<(p?.length??0);V++)(this.answerTypeService.isOneChoiceAnswer(p?.[V])||this.answerTypeService.isTrueFalseAnswer(p?.[V])||this.answerTypeService.isFillAnswer(p?.[V]))&&p?.[V]&&q.push(p[V]);return q}convertAnswersArr(p){let q={};return 0!=p.length&&p.forEach(V=>{let R=!!V.AnswerContent?.filter(j=>j.Status)?.length;V.AnswerContent&&V.AnswerContent.length&&(q[`id_${V.QuestionId}`]=R?[...V.AnswerContent]:V.AnswerContent[0].Content)}),q}mapStudentObjWithTestedObj(p,q,V){var R=this.commonService.castObj(p?.studentObj),j=q?.filter(A=>A.userId==V?.parentId);return R&&j&&j.length>0&&(R={...R,offlineMarkObj:j[0].offlineMarkObj,nameImage:j[0].nameImage??""}),V=R}mapStudentObjWithTestedObjForFrontendStudent(p,q,V){var R=this.commonService.castObj(p?.studentObj),j=q?.filter(A=>A.userId==V?.parentId);return R&&j&&j.length>0&&(R={...R,offlineMarkObj:j[0].offlineMarkObj,nameImage:j[0].nameImage??""}),V=R}constructor(p,q,V){this.commonService=p,this.zipDataService=q,this.answerTypeService=V}}return(T=re).\u0275fac=function(p){return new(p||T)(l.KVO(d.R),l.KVO(h.j),l.KVO(_._))},T.\u0275prov=l.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),re})()},57332:(_t,Ee,w)=>{"use strict";w.d(Ee,{V:()=>te});var l=w(89163),d=w(33887),h=w(48891),_=w(58538),x=w(54460),T=w(68323),re=w(90796),_e=w(52811),p=w(15343),q=w(76975);const V=()=>({"mr-2 text-danger flex-none":!0});function R(oe,Ve){1&oe&&(h.j41(0,"span",11),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&oe&&(h.R7$(),h.JRh(h.bMT(2,1,"lang_testbank_are_you_sure_to_delete_this_exam_result")))}function j(oe,Ve){1&oe&&(h.j41(0,"span",11),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&oe&&(h.R7$(),h.SpI("",h.bMT(2,1,"lang_testbank_are_you_sure_to_delete_multiple_exam_result"),":"))}function A(oe,Ve){if(1&oe&&(h.j41(0,"div",8),h.nrm(1,"lucide-icon",9),h.j41(2,"div"),h.DNE(3,R,3,3,"span",10)(4,j,3,3,"span",10),h.k0s()()),2&oe){const Se=h.XpG();h.R7$(),h.Y8G("ngClass",h.lJ4(3,V)),h.R7$(2),h.Y8G("ngIf",1==Se.data.examResultIds.length),h.R7$(),h.Y8G("ngIf",Se.data.examResultIds.length>1)}}function Y(oe,Ve){if(1&oe&&(h.j41(0,"div",21)(1,"span",22),h.EFF(2),h.k0s()()),2&oe){const Se=h.XpG().$implicit;h.R7$(2),h.JRh(Se.fullName)}}function B(oe,Ve){if(1&oe&&h.nrm(0,"img",23),2&oe){const Se=h.XpG().$implicit;h.Y8G("nameImages",Se.nameImages)}}function L(oe,Ve){if(1&oe&&(h.j41(0,"div",14)(1,"div",15)(2,"div",16),h.nrm(3,"azt-create-avatar",17),h.k0s(),h.j41(4,"div",18),h.DNE(5,Y,3,1,"div",19)(6,B,1,1,"img",20),h.k0s()()()),2&oe){let Se;const He=Ve.$implicit,be=h.XpG(2);h.R7$(3),h.Y8G("linkAvatar",null!==(Se=He.avatar)&&void 0!==Se?Se:"")("nameCreateAvatar",He.fullName)("size",32),h.R7$(2),h.Y8G("ngIf",!He.nameImages||be.commonService.convertStringToNumber(He.id)>0),h.R7$(),h.Y8G("ngIf",He.nameImages&&be.commonService.convertStringToNumber(He.studentId)<=0)}}function v(oe,Ve){if(1&oe&&(h.j41(0,"div",12),h.DNE(1,L,7,5,"div",13),h.k0s()),2&oe){const Se=h.XpG();h.R7$(),h.Y8G("ngForOf",Se.data.examResults)}}function F(oe,Ve){1&oe&&(h.j41(0,"div",8)(1,"div",24)(2,"button",25)(3,"div",26),h.nrm(4,"lucide-icon",27),h.k0s()(),h.j41(5,"div",28),h.EFF(6),h.nI1(7,"mytranslate"),h.k0s()()()),2&oe&&(h.R7$(6),h.JRh(h.bMT(7,1,"lang_testbank_are_you_sure_to_delete_no_exam_result")))}function Q(oe,Ve){1&oe&&(h.j41(0,"span",31),h.nrm(1,"azt-loading-ui"),h.k0s())}function ee(oe,Ve){if(1&oe){const Se=h.RV6();h.j41(0,"button",29),h.bIt("click",function(){h.eBV(Se);const be=h.XpG();return h.Njj(be.confirmDelete())}),h.DNE(1,Q,2,0,"span",30),h.EFF(2),h.nI1(3,"mytranslate"),h.k0s()}if(2&oe){const Se=h.XpG();h.Y8G("disabled",Se.statusObj.loading),h.R7$(),h.Y8G("ngIf",Se.statusObj.loading),h.R7$(),h.SpI(" ",h.bMT(3,3,"lang_cms_common_confirm_btn")," ")}}let te=(()=>{var oe;class Ve extends d._{confirmDelete(){this.initStatusObj(),this.waitDestroy(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjsPost({examHashId:this.examHashId,examResultIds:this.examResultIds}).subscribe(He=>{1==He.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(He.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(He,be,ht){super(ht,be),this.offlineExamResultService=He,this.dialogRef=be,this.examHashId="",this.examResultIds=[],this.examHashId=ht.examHashId,this.examResultIds=ht.examResultIds}}return(oe=Ve).\u0275fac=function(He){return new(He||oe)(h.rXU(_.Fs),h.rXU(l.CP,8),h.rXU(l.Vh,8))},oe.\u0275cmp=h.VBU({type:oe,selectors:[["coazt-delete-offline-exam-result-dialog"]],features:[h.Vt3],decls:11,vars:7,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],["class","text-md flex",4,"ngIf"],["class","grid grid-cols-12 gap-3","style","overflow-y: auto; max-height: calc(100vh - 150px)",4,"ngIf"],[1,"p-3","flex","justify-end"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor","class","btn w-32 btn-danger",3,"disabled","click",4,"ngIf"],[1,"text-md","flex"],["name","trash-2","size","24",3,"ngClass"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"grid","grid-cols-12","gap-3",2,"overflow-y","auto","max-height","calc(100vh - 150px)"],["class","col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"flex","items-center","p-3","student-exam-result-up","w-full"],[1,"w-8","h-8","image-fit","lg:mr-1"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"ml-2","text-left","mt-0",2,"width","calc(100% - 3.5rem)"],["class","azt-student-name flex items-center","style","flex-wrap: wrap",4,"ngIf"],["appDrawNameImage","","class","mb-1 img-name-fluid",3,"nameImages",4,"ngIf"],[1,"azt-student-name","flex","items-center",2,"flex-wrap","wrap"],[1,"font-medium","mr-2"],["appDrawNameImage","",1,"mb-1","img-name-fluid",3,"nameImages"],[1,"mx-auto","text-center"],[1,"btn","btn-sm","btn-primary-soft","p-1"],[1,"w-6","h-6"],["name","circle-x","size","24"],[1,"mt-4"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"click","disabled"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(He,be){1&He&&(h.j41(0,"div",0)(1,"div",1)(2,"div",2),h.DNE(3,A,5,4,"div",3)(4,v,2,1,"div",4)(5,F,8,3,"div",3),h.k0s()(),h.j41(6,"div",5)(7,"button",6),h.bIt("click",function(){return be.btnCloseDialog()}),h.EFF(8),h.nI1(9,"mytranslate"),h.k0s(),h.DNE(10,ee,4,5,"button",7),h.k0s()()),2&He&&(h.R7$(3),h.Y8G("ngIf",be.data.examResultIds.length),h.R7$(),h.Y8G("ngIf",be.data.examResultIds.length),h.R7$(),h.Y8G("ngIf",!be.data.examResultIds.length),h.R7$(3),h.SpI(" ",h.bMT(9,5,"lang_cms_common_close_btn")," "),h.R7$(2),h.Y8G("ngIf",be.data.examResultIds.length))},dependencies:[x.YU,x.Sq,x.bT,T.p,re.y,_e.R,p.WGl,q.wp],encapsulation:2}),Ve})()},92801:(_t,Ee,w)=>{"use strict";w.d(Ee,{$:()=>v});var l=w(89163),d=w(33887),h=w(48891),_=w(54460),x=w(47426),T=w(95670),re=w(43404),_e=w(4375),p=w(47712),q=w(76975);function V(F,Q){if(1&F&&(h.j41(0,"div")(1,"div",10)(2,"div",11),h.EFF(3),h.k0s(),h.nrm(4,"input",12),h.k0s()()),2&F){const ee=h.XpG().$implicit;h.R7$(3),h.SpI(" ",ee.title," "),h.R7$(),h.FS9("value",ee.contents[0]),h.Y8G("disabled",!0)}}function R(F,Q){if(1&F&&(h.j41(0,"div",17)(1,"span",18),h.EFF(2),h.k0s()()),2&F){const ee=Q.$implicit;h.R7$(),h.FS9("matTooltip",ee),h.R7$(),h.JRh(ee)}}function j(F,Q){if(1&F&&(h.j41(0,"div")(1,"div",13)(2,"span",14),h.EFF(3),h.k0s()(),h.j41(4,"div",15),h.DNE(5,R,3,2,"div",16),h.k0s()()),2&F){const ee=h.XpG().$implicit;h.R7$(3),h.JRh(ee.title),h.R7$(2),h.Y8G("ngForOf",ee.contents)}}function A(F,Q){if(1&F&&(h.j41(0,"mat-radio-button",21)(1,"span",18),h.EFF(2),h.k0s()()),2&F){const ee=Q.$implicit;h.Y8G("checked",!0)("disabled",!0),h.R7$(),h.FS9("matTooltip",ee),h.R7$(),h.JRh(ee)}}function Y(F,Q){if(1&F&&(h.j41(0,"div")(1,"div",13)(2,"span",19),h.EFF(3),h.k0s()(),h.j41(4,"mat-radio-group",15),h.DNE(5,A,3,4,"mat-radio-button",20),h.k0s()()),2&F){const ee=h.XpG().$implicit;h.R7$(3),h.JRh(ee.title),h.R7$(2),h.Y8G("ngForOf",ee.contents)}}function B(F,Q){if(1&F){const ee=h.RV6();h.j41(0,"div")(1,"div",10)(2,"span",19),h.EFF(3),h.k0s()(),h.j41(4,"div",22)(5,"mat-form-field",23)(6,"mat-select",24),h.mxI("valueChange",function(oe){h.eBV(ee);const Ve=h.XpG().$implicit;return h.DH7(Ve.contents[0],oe)||(Ve.contents[0]=oe),h.Njj(oe)}),h.j41(7,"mat-option",25),h.EFF(8),h.k0s()()()()()}if(2&F){const ee=h.XpG().$implicit;h.R7$(3),h.JRh(ee.title),h.R7$(3),h.R50("value",ee.contents[0]),h.Y8G("disabled",!0),h.R7$(),h.FS9("value",ee.contents[0]),h.R7$(),h.JRh(ee.contents[0])}}function L(F,Q){if(1&F&&(h.qex(0,8),h.DNE(1,V,5,3,"div",9)(2,j,6,2,"div",9)(3,Y,6,2,"div",9)(4,B,9,5,"div",9),h.bVm()),2&F){const ee=Q.$implicit;h.R7$(),h.Y8G("ngIf",0==ee.type),h.R7$(),h.Y8G("ngIf",1==ee.type),h.R7$(),h.Y8G("ngIf",2==ee.type),h.R7$(),h.Y8G("ngIf",3==ee.type)}}let v=(()=>{var F;class Q extends d._{constructor(te,oe){super(oe,te),this.dialogRef=te,this.data=oe}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return(F=Q).\u0275fac=function(te){return new(te||F)(h.rXU(l.CP,8),h.rXU(l.Vh))},F.\u0275cmp=h.VBU({type:F,selectors:[["app-result-info-dialog"]],features:[h.Vt3],decls:12,vars:7,consts:[[1,"box","result-info-dialog"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"valueChange","value","disabled"],[2,"color","#1e293c",3,"value"]],template:function(te,oe){1&te&&(h.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),h.EFF(5),h.nI1(6,"mytranslate"),h.k0s()(),h.DNE(7,L,5,4,"ng-container",5),h.k0s()(),h.j41(8,"div",6)(9,"button",7),h.bIt("click",function(){return oe.btnCloseDialog()}),h.EFF(10),h.nI1(11,"mytranslate"),h.k0s()()()),2&te&&(h.R7$(5),h.SpI(" ",h.bMT(6,3,"lang_testbank_test_config_verify_profile_student")," "),h.R7$(2),h.Y8G("ngForOf",oe.data),h.R7$(3),h.SpI(" ",h.bMT(11,5,"lang_auto_dong")," "))},dependencies:[_.Sq,_.bT,x.wT,T.rl,re.VT,re._g,_e.VO,p.oV,q.wp],encapsulation:2}),Q})()},32399:(_t,Ee,w)=>{"use strict";w.d(Ee,{B:()=>Y});var l=w(48891),d=w(52909),h=w(59640),_=w(54460),x=w(47426),T=w(95670),re=w(4375),_e=w(94743),p=w(15343);const q=B=>({"padding-left":B}),V=()=>({"text-pending":!0});function R(B,L){if(1&B&&(l.j41(0,"mat-option",6)(1,"i",7),l.nrm(2,"azt-svg-icon",8),l.k0s(),l.j41(3,"span",9),l.EFF(4),l.k0s()()),2&B){const v=l.XpG().$implicit;l.Y8G("ngStyle",l.eq3(5,q,15*(v.level+1)+"px"))("disabled",!v.children.length)("value",v),l.R7$(2),l.Y8G("size",20),l.R7$(2),l.JRh(v.objectName)}}function j(B,L){if(1&B){const v=l.RV6();l.j41(0,"mat-option",10),l.bIt("click",function(){l.eBV(v);const Q=l.XpG().$implicit,ee=l.XpG();return l.Njj(ee.confirmSelected(Q))}),l.nrm(1,"lucide-icon",11),l.j41(2,"span",12),l.EFF(3),l.k0s()()}if(2&B){const v=l.XpG().$implicit;l.Y8G("ngStyle",l.eq3(4,q,15*(v.level+1)+"px"))("value",v),l.R7$(),l.Y8G("ngClass",l.lJ4(6,V)),l.R7$(2),l.JRh(v.objectName)}}function A(B,L){if(1&B&&(l.qex(0),l.DNE(1,R,5,7,"mat-option",4)(2,j,4,7,"mat-option",5),l.bVm()),2&B){const v=L.$implicit;l.R7$(),l.Y8G("ngIf","FOLDER"==v.objectType),l.R7$(),l.Y8G("ngIf","EXAM"==v.objectType)}}let Y=(()=>{var B;class L extends h.H{confirmSelected(F){"FOLDER"!=F.objectType&&(this.combineExamCapacity.forEach(Q=>Q.isSelected=!1),F.isSelected=!0,this.currentSelected=F,this.selectedExamEmitter.emit({examCapacityId:F.examId,examId:F.objectId??0,examHashId:F.exam?.hashId??"",examCapacityTestId:this.currentResultObj?.examCapacityTestId??0}))}asTemplateDataObj(F){return F}convertTreeNodes(F,Q){let ee=[];return F.forEach((te,oe)=>{let Ve="EXAM"==te.objectType&&(te.objectId??te.examId)==(this.examComponentObj?this.examComponentObj.id:this.examObj?.id),Se={...te,level:Q,nodeIndex:oe,isSelected:Ve,randomHashId:this.uuidService.getUuid()};ee.push(Se),Ve&&(this.currentSelected=Se),te.children.length&&ee.push(...this.convertTreeNodes(te.children,Q+1))}),ee}ngOnInit(){super.ngOnInit(),this.combineExamCapacity=this.convertTreeNodes(this.capacityComponents??[],0)}constructor(){super(),this.capacityComponents=[],this.selectedExamEmitter=new l.bkB,this.uuidService=(0,l.WQX)(d.D),this.combineExamCapacity=[],this.errorMessage=""}}return(B=L).\u0275fac=function(F){return new(F||B)},B.\u0275cmp=l.VBU({type:B,selectors:[["app-select-capacity-exam-result"]],inputs:{capacityComponents:"capacityComponents",examObj:"examObj",examComponentObj:"examComponentObj",currentResultObj:"currentResultObj"},outputs:{selectedExamEmitter:"selectedExamEmitter"},features:[l.Vt3],decls:4,vars:2,consts:[[1,"test-select-capacity"],[1,"w-full"],[3,"value"],[4,"ngFor","ngForOf"],[3,"ngStyle","disabled","value",4,"ngIf"],[3,"ngStyle","value","click",4,"ngIf"],[3,"ngStyle","disabled","value"],["aria-hidden","true"],["type","folder",3,"size"],[1,"font-normal","ml-2","select-capacity-span",2,"vertical-align","middle"],[3,"click","ngStyle","value"],["name","file-check","size","20",3,"ngClass"],[1,"select-capacity-span","ml-2",2,"vertical-align","middle","white-space","nowrap"]],template:function(F,Q){1&F&&(l.j41(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),l.DNE(3,A,3,2,"ng-container",3),l.k0s()()()),2&F&&(l.R7$(2),l.Y8G("value",Q.currentSelected),l.R7$(),l.Y8G("ngForOf",Q.combineExamCapacity))},dependencies:[_.YU,_.Sq,_.bT,_.B3,x.wT,T.rl,re.VO,_e.m,p.WGl],encapsulation:2}),L})()},43726:(_t,Ee,w)=>{"use strict";w.d(Ee,{U:()=>xt});var l=w(59640),d=w(53043),h=w(57332),_=w(73014),x=w(10936),T=w(89163),re=w(33887),_e=w(43234),p=w(48891),q=w(36484),V=w(74225),R=w(94315),j=w(53793),A=w(51113),Y=w(99927),B=w(58112);const v=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let F=(()=>{var ce;class Me{constructor(M,P,H,Be){this.commonService=M,this.zipDataService=P,this.sAztAnswerTypeService=H,this.sAztCommonCdnService=Be,this.totalPointExam=0}drawAzotaFileToCanvas(M,P,H,Be){return new Promise((Ke,ke)=>{var Oe="",xe=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(M.images??""));xe&&xe.url&&xe.url.includes(".azt")?this.httpGetAsync(this.sAztCommonCdnService.getMyCdn(xe.url)).then(qe=>{qe&&qe.length>0?V.decodeScanOfflineFile(qe).then(D=>{let k=this._arrayBufferToBase64(D.getWrappedImage()??new Uint8Array),I=D.getWrappedImageExtension(),b=D.scanOfflineData?.scanResult;if(k){let z=new Image;z.src="data:image/"+I+";base64,"+k,z.crossOrigin="anonymous",z.onload=()=>{var U=document.createElement("canvas");U.width=z.width,U.height=z.height;const N=U.getContext("2d");N?.drawImage(z,0,0,U.width,U.height);let ve=M.resultsData?.answerObjs??[];if(b?.examCodeRegion?.circles&&b?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(b?.examCodeRegion?.circles,N),b?.studentCodeRegion?.circles&&b?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(b?.studentCodeRegion?.circles,N),b?.answerRegion?.circles&&b?.answerRegion?.circles.length>0&&this.drawCircles(b?.answerRegion?.circles,N,ve,1,H?.filter(ge=>this.sAztAnswerTypeService.isOneChoiceAnswer(ge))),b?.answerRegion?.trueFalseCircles&&b?.answerRegion?.trueFalseCircles.length>0&&this.drawCircles(b?.answerRegion?.trueFalseCircles,N,ve,5,H?.filter(ge=>this.sAztAnswerTypeService.isTrueFalseAnswer(ge))),b?.answerRegion?.fillBlankCircles&&b?.answerRegion?.fillBlankCircles.length>0&&this.drawCircles(b?.answerRegion?.fillBlankCircles,N,ve,4,H?.filter(ge=>this.sAztAnswerTypeService.isFillAnswer(ge))),b?.answerRegion?.essayCircles&&b?.answerRegion?.essayCircles.length>0&&P&&this.drawCommonCircles(b?.answerRegion?.essayCircles,N),b?.answerRegion?.handwrittenAnswers&&b?.answerRegion?.handwrittenAnswers.length>0){let ge=b?.answerRegion?.handwrittenAnswers,ie="18px";if(N){N.fillStyle="#00ff00",N.font=ie+" Comic Sans MS",N.textAlign="center";for(let me=0;me<ge.length;me++){let pe=ge[me];this.fillTextAnswerDrawForFileAzt(pe.recognizedText??"",N,ve[me],((pe.bottomRight.x??0)+(pe.topLeft.x??0))/2-3,((pe.bottomRight.y??0)+(pe.topLeft.y??0))/2+5)}}}N&&(N.fillText((this.commonService.myTranslateInstant("lang_auto_tong")??"T\u1ed5ng")+" = "+this.totalPointExam.toFixed(2),25,125),N.fillText("Version:"+b?.templateType,25,150)),Oe=U.toDataURL("image/jpeg",.9),Ke({imgUrl:Oe})}}else Ke({imgUrl:Oe})}):Ke({imgUrl:Oe})}).catch(qe=>{ke(qe)}):Ke({imgUrl:Oe})})}drawScanFileToCanvas(M){return new Promise(P=>{var H="",Be=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(M.images??""));let Ke=Be?this.sAztCommonCdnService.getMyCdn(Be.url):"";if(Be&&Ke){let ke=new Image;ke.src=Ke,ke.crossOrigin="anonymous",ke.onload=()=>{var Oe=document.createElement("canvas");Oe.width=ke.width,Oe.height=ke.height;const xe=Oe.getContext("2d");xe?.drawImage(ke,0,0,Oe.width,Oe.height);var qe=M.resultsData?.answerObjs??[],D=this.commonService.willDeleteParseJson(M.resultsData?.pos??"");if("2.0"==D.version)try{let zt=Uint8Array.from(atob(D.resultFilledPos),xn=>xn.charCodeAt(0)),mn=new R.eX(zt).parseDrawData(),nn=mn.studentId?.answers??[];for(var k=0;k<nn.length;k++)this.tickStudentIdAndExamId(nn[k],xe,mn.answerTable?.radius??0);let rn=mn.examId?.answers??[];for(k=0;k<rn.length;k++)this.tickStudentIdAndExamId(rn[k],xe,mn.answerTable?.radius??0);let pt=mn.answerTable?.answers??[];for(k=0;k<pt.length;k++)this.answerPaintedRightOrWrong(pt[k],xe,mn.answerTable?.radius??0,qe);H=Oe.toDataURL("image/jpeg",.9),P(H)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),P("")}else if("3.0"==D.version)try{let zt=D.answersHandwritten??[],mn=(zt[0].answerRegion.height??0)-20+"px";if(xe){xe.fillStyle="#00ff00",xe.font=mn+" Comic Sans MS",xe.textAlign="center";for(let rn=0;rn<zt.length;rn++){let pt=zt[rn],sr=this.getTextAnswerDraw(v[-1==pt.answer?26:pt.answer],xe,qe[rn]);xe.fillText(sr,(pt.answerRegion.x??0)+(pt.answerRegion.width??0)/2,(pt.answerRegion.y??0)+(pt.answerRegion.height??0)/2+5)}}H=Oe.toDataURL("image/jpeg",.9),P(H)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),P("")}else{var I=D.configurationPos.split("_"),b=D.resultFilledPos.split("_"),z=D.tableAnchorPos.split("_"),U=this.checkWrongOrTrueAnswer(qe),N=0;for(k=0;k<I.length;k++)if(1==k||2==k){var ve=I[k].split("*");N+=parseInt(ve[1],10)}var ge=0;for(k=0;k<z.length;k++)if(k>=2){var ie={},de={},me=z[k].split("*"),pe=me[0].split(":"),Ie=me[1].split(":"),Te={},Ze=I[k].split("*");Te.row=parseInt(Ze[0],10),Te.col=parseInt(Ze[1],10),Te.radius=parseInt(Ze[2],10),ie.x=parseInt(pe[0],10),ie.y=parseInt(pe[1],10),de.x=parseInt(Ie[0],10),de.y=parseInt(Ie[1],10);for(var tt=(de.y-ie.y)/(Te.row+1),W=ie.y,ot=0;ot<Te.row;ot++)if((W+=tt)>ie.y&&W<de.y){var mt=ge<qe.length?this.checkAnswerStudentRight(ge,qe):0;ge++,0!=mt&&xe&&(xe.beginPath(),xe.arc(ie.x+tt*mt,W,Te.radius,0,2*Math.PI,!1),xe.lineWidth=3,xe.strokeStyle="#f3c12c",xe.stroke())}}var Kt=0;for(ot=0;ot<b.length;ot++)if("empty"!=b[ot]){var Bt=b[ot].split(":"),Xt={x:parseInt(Bt[0],10),y:parseInt(Bt[1],10),line:parseInt(Bt[2],10)};ot<N+U.length&&(ot>=N?(xe&&(xe.beginPath(),xe.arc(Xt.x,Xt.y,Xt.line,0,2*Math.PI,!1),xe.lineWidth=3,xe.strokeStyle=U[Kt],xe.stroke()),Kt++):xe&&(xe.beginPath(),xe.arc(Xt.x,Xt.y,Xt.line,0,2*Math.PI,!1),xe.lineWidth=3,xe.strokeStyle="#00ff00",xe.stroke()))}H=Oe.toDataURL("image/jpeg",.9),P(H)}}}else P("")})}_arrayBufferToBase64(M){for(var P="",H=new Uint8Array(M),Be=H.byteLength,Ke=0;Ke<Be;Ke++)P+=String.fromCharCode(H[Ke]);return window.btoa(P)}httpGetAsync(M){return new Promise((P,H)=>{try{const Be=new XMLHttpRequest;Be.open("GET",M,!0),Be.responseType="arraybuffer",Be.onload=Ke=>{if(200===Be.status||304===Be.status){const ke=Be.response;if(ke){const Oe=new Uint8Array(ke);P(Oe)}else P(new Uint8Array)}else P(new Uint8Array)},Be.onerror=Ke=>{H(new Error("lang_core_cant_loading_url"))},Be.send(null)}catch(Be){H(Be)}})}fillTextAnswerDrawForFileAzt(M,P,H,Be,Ke){let ke="";H&&(M?H.rightAnswer&&"ESSAY"!=H.content&&H.rightAnswer!=M?(P.fillStyle="#f3c12c",P.fillText("["+H.rightAnswer+"]",Be+15,Ke),P.fillStyle="red",ke=M+"-",Be-=10):H.rightAnswer&&"ESSAY"!=H.content?(P.fillStyle="#00ff00",ke+=M):(P.fillStyle="red",ke+=M):(P.fillStyle="#f3c12c",ke+=H.rightAnswer)),P.fillText(ke,Be,Ke)}drawCommonCircles(M,P){M.length>0&&M.forEach(H=>{if(H.filled){let Be=H.center.x,Ke=H.center.y;P&&(P.beginPath(),P.arc(Be,Ke,H.radius+1,0,2*Math.PI,!1),P.lineWidth=2,P.strokeStyle="#00ff00",P.stroke())}})}drawCircles(M,P,H,Be,Ke){let ke=[],Oe=[],xe=["A","B","C","D"],qe=0;if(H.length>0){let b=H.filter(N=>1==N.answerType||2==N.answerType).length??0,z=H.filter(N=>5==N.answerType).length??0,U=H.filter(N=>4==N.answerType).length??0;qe=1==Be?b:4==Be?U:z;for(let N=0;N<H.length;N++){let ve="";if(this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:H[N].answerType})){let ge=H[N].rightAnswer?.split("|")??[];for(let ie=0;ie<xe.length;ie++)ve=N+1-b+""+xe[ie]+"F",ge.includes(xe[ie])&&(ve=N+1-b+""+xe[ie]+"T"),this.commonService.isExistInArray(ke,ve)||ke.push(ve)}else this.sAztAnswerTypeService.isFillAnswer({answerType:H[N].answerType})?(ve=N+1-b-z+"_"+H[N].rightAnswer,this.commonService.isExistInArray(ke,ve)||ke.push(ve)):this.sAztAnswerTypeService.isOneChoiceAnswer({answerType:H[N].answerType})&&(ve=N+1+""+H[N].rightAnswer,this.commonService.isExistInArray(ke,ve)||ke.push(ve));this.sAztAnswerTypeService.isEssayAnswer({answerType:H[N].answerType})&&Oe.push(N+1)}}let I=1==Be?1:5==Be?2:4==Be?3:1;if(P){P.fillStyle="#ff0024",P.font="25px Comic Sans MS";let b=0,z=0,U=0,N="P"+I+": ",ve=!1;(Ke??[]).forEach(ge=>{let ie=H.find(de=>ge.id==de.questionId);if((this.sAztAnswerTypeService.isOneChoiceAnswer(ge)||this.sAztAnswerTypeService.isFillAnswer(ge))&&(b++,ie?.isRight&&(z+=ge.testedScore??0,U++)),this.sAztAnswerTypeService.isTrueFalseAnswer(ge)){z+=ge.testedScore??0;let de=0,me="";for(let pe=0;pe<4;pe++)ie?.rightAnswers?.includes(v[pe])?me+="T":me+="F";if(ie?.content)for(let pe=0;pe<4;pe++)ie.content[pe]==me[pe]&&de++;ve=!0,N+=" "+de+"/4;"}}),this.totalPointExam+=z,N+=ve?" = "+z.toFixed(2):U+"/"+b+" = "+z.toFixed(2),P.fillText(N,25,25+25*I)}M.forEach(b=>{let z=0;z=this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:Be})?Number(b.label.substring(0,b.label.length-2)):this.sAztAnswerTypeService.isFillAnswer({answerType:Be})?Number(b.label.substring(0,b.label.indexOf("_"))):Number(b.label.substring(0,b.label.length-1));let U="";if(0==ke.length)U="#00ff00";else if(this.sAztAnswerTypeService.isFillAnswer({answerType:Be})){let N=b.label.substring(0,b.label.indexOf("_")+1),ve=ke.find(ge=>ge.includes(N));if(ve){let ge=ve?.split("_"),ie=b.label.split("_");if(b.filled&&(U="red"),ge[0]==ie[0])if("-"==ie[2]&&ge[1].includes("-"))0==Number(ie[1])&&(U=b.filled?"#00ff00":"#f3c12c");else if(","==ie[2]&&ge[1].includes(",")){let de=ge[1].indexOf(",");Number(ie[1])==de&&(U=b.filled?"#00ff00":"#f3c12c")}else"-"!=ie[2]&&","!=ie[2]&&ge[1][Number(ie[1])]==ie[2]&&(U=b.filled?"#00ff00":"#f3c12c")}}else this.commonService.isExistInArray(ke,b.label)?U=b.filled?"#00ff00":"#f3c12c":b.filled&&(U="red");if(U&&z<=qe&&!this.commonService.isExistInArray(Oe,z)){let N=b.center.x,ve=b.center.y;P&&(P.beginPath(),P.arc(N,ve,b.radius+1,0,2*Math.PI,!1),P.lineWidth=2,P.strokeStyle=U,P.stroke())}})}checkAnswerStudentRight(M,P){var H=0;return P[M]&&""!=P[M].rightAnswer&&0==P[M].isRight&&(H="A"==P[M].rightAnswer?1:"B"==P[M].rightAnswer?2:"C"==P[M].rightAnswer?3:"D"==P[M].rightAnswer?4:"E"==P[M].rightAnswer?5:"F"==P[M].rightAnswer?6:"G"==P[M].rightAnswer?7:"H"==P[M].rightAnswer?8:0),H}checkWrongOrTrueAnswer(M){for(var P=[],H=0;H<M.length;H++)""!=M[H].content&&(1==M[H].isRight?P.push("#00ff00"):0==M[H].isRight&&P.push("red"));return P}tickStudentIdAndExamId(M,P,H){var Be=256*Math.floor((M.position??0)/16)+M.x,Ke=(M.position??0)%16*256+M.y;(M.filledCols??0)>=128&&P&&(P.beginPath(),P.arc(Be,Ke,H,0,2*Math.PI,!1),P.lineWidth=3,P.strokeStyle="#00ff00",P.stroke())}answerPaintedRightOrWrong(M,P,H,Be){var Ke=256*Math.floor((M.position??0)/16)+M.x,ke=(M.position??0)%16*256+M.y,Oe=M.rows??0,qe="#fff0";Be.length>Oe&&((M.filledCols??0)>=128?qe=1==Be[Oe].isRight?"#00ff00":"red":(M.filledCols??0)%128+1==this.checkAnswerStudentRight(Oe,Be)&&(qe="#f3c12c"),P&&(P.beginPath(),P.arc(Ke,ke,H,0,2*Math.PI,!1),P.lineWidth=3,P.strokeStyle=qe,P.stroke()))}getTextAnswerDraw(M,P,H){let Be="";return H&&(M?H.isRight?(P.fillStyle="#00ff00",Be+=M):(P.fillStyle="red",Be=M+" - ["+H.rightAnswer+"]"):(P.fillStyle="#f3c12c",Be+=H.rightAnswer)),Be}}return(ce=Me).\u0275fac=function(M){return new(M||ce)(p.KVO(j.R),p.KVO(A.j),p.KVO(Y._),p.KVO(B.c))},ce.\u0275prov=p.jDH({token:ce,factory:ce.\u0275fac,providedIn:"root"}),Me})();var Q=w(54460),ee=w(52811),te=w(15343),oe=w(76975);const Ve=ce=>({flex:ce}),Se=ce=>({"mr-2":ce}),He=()=>({"flex-none mr-1":!0});function be(ce,Me){1&ce&&(p.qex(0),p.j41(1,"span"),p.EFF(2),p.nI1(3,"mytranslate"),p.k0s(),p.bVm()),2&ce&&(p.R7$(2),p.JRh(p.bMT(3,1,"lang_test_review_error_get_url_img")))}function ht(ce,Me){1&ce&&(p.j41(0,"div",14)(1,"span",15),p.nrm(2,"azt-loading-ui"),p.k0s()())}function it(ce,Me){if(1&ce){const ye=p.RV6();p.j41(0,"div",16)(1,"div",17)(2,"div",18)(3,"label",19),p.EFF(4),p.nI1(5,"mytranslate"),p.k0s(),p.j41(6,"input",20,1),p.nI1(8,"mytranslate"),p.bIt("input",function(){p.eBV(ye);const P=p.sdS(7),H=p.XpG(2);return p.Njj(H.setStudentCode(P))}),p.k0s()(),p.j41(9,"div",21)(10,"label",22),p.EFF(11),p.nI1(12,"mytranslate"),p.k0s(),p.j41(13,"input",23,2),p.nI1(15,"mytranslate"),p.bIt("input",function(){p.eBV(ye);const P=p.sdS(14),H=p.XpG(2);return p.Njj(H.setExamCode(P))}),p.k0s()()(),p.j41(16,"h3",24),p.nrm(17,"lucide-icon",25),p.j41(18,"span",26),p.EFF(19,"Click \u1ea3nh \u0111\u1ec3 \u0111\xe1nh d\u1ea5u v\u1ecb tr\xed c\u1ea7n s\u1eeda"),p.k0s()(),p.j41(20,"div",27)(21,"div",28,3)(23,"img",29),p.bIt("click",function(P){p.eBV(ye);const H=p.XpG(2);return p.Njj(H.clickOnImage(P))}),p.k0s()()()()}if(2&ce){const ye=p.XpG(2);p.R7$(),p.Y8G("ngClass",p.eq3(20,Ve,!ye.isMobileDevice)),p.R7$(),p.Y8G("ngClass",p.eq3(22,Se,!ye.isMobileDevice)),p.R7$(2),p.JRh(p.bMT(5,12,"lang_auto_so_bao_danh")),p.R7$(2),p.FS9("placeholder",p.bMT(8,14,"lang_core_nhap_so_ba_danh")),p.Y8G("formControl",ye.studentCode),p.R7$(5),p.JRh(p.bMT(12,16,"lang_auto_ma_de")),p.R7$(2),p.FS9("placeholder",p.bMT(15,18,"lang_core_nhap_ma_de")),p.Y8G("formControl",ye.examCode),p.R7$(4),p.Y8G("ngClass",p.lJ4(24,He)),p.R7$(6),p.Aen(ye.isMobileWebView?"width: 100% !important;":"height: auto !important;"),p.Y8G("src",ye.fileScanUrl,p.B4B)}}function nt(ce,Me){if(1&ce&&p.DNE(0,ht,3,0,"div",12)(1,it,24,25,"div",13),2&ce){const ye=p.XpG();p.Y8G("ngIf",ye.loadingScanUrl),p.R7$(),p.Y8G("ngIf",!ye.loadingScanUrl)}}function Re(ce,Me){1&ce&&(p.j41(0,"span",30),p.nrm(1,"azt-loading-ui"),p.k0s())}let je=(()=>{var ce;class Me extends re._{setStudentCode(M){M.value=M.value.replace(/\D/g,""),M.value.length>6&&(M.value=M.value.slice(0,-1)),this.processData.setStudentCode(M.value),this.processDrawImage()}setExamCode(M){M.value=M.value.replace(/\D/g,""),M.value.length>3&&(M.value=M.value.slice(0,-1)),this.processData.setExamCode(M.value),this.processDrawImage()}confirmEdit(){this.initStatusObj(),this.processor.uploadToServer().then(M=>{if(!M.success){let P=M.errorMessage;return"azt_lang_core_code_exam"==P&&(P=this.commonService.myTranslateInstant("lang_core_offline_exam_not_found_offline_mix_question_hash_id")??"M\xe3 \u0111\u1ec1 thi kh\xf4ng t\u1ed3n t\u1ea1i"),this.errorStatusObj(P??"lang_core_invalid_data",!0)}this.successStatusObj("lang_auto_luu_thanh_cong",!0),this.dialogRef.close(!0)})}btnCloseDialog(){this.dialogRef.close(!1)}loadScriptHandleImage(){var M=this;this.commonService.loadAnswerSheetJs().then(()=>{var P=this.userService.getUserObj();window.azotaScanAnswerSheet.examResultProcessor(P.rememberToken,"https://"+_e.c.base_embed_link,this.data.resultId,P.id).then(function(){var H=(0,_.A)(function*(Be){M.processor=Be,M.initData()});return function(Be){return H.apply(this,arguments)}}()).catch(()=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}).catch(P=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}clickOnImage(M){const P=M.target,H=P.getBoundingClientRect();this.processData.clickToImage(P.naturalWidth/H.width*(M.clientX-H.left),P.naturalHeight/H.height*(M.clientY-H.top)),this.setFormCode(),this.processDrawImage()}drawCircleImg(M,P){M&&M.length>0&&(this.circleRadius=M[0].radius,M.forEach(H=>{if(H.filled&&P){let Be=H.center.x,Ke=H.center.y;P.beginPath(),P.arc(Be,Ke,H.radius+1,0,2*Math.PI,!1),P.lineWidth=3,P.strokeStyle="red",P.stroke()}}))}processDrawImage(){let M=this.drawScanExamService._arrayBufferToBase64(this.processData.getWrappedImage()??new Uint8Array),P=this.processData.getWrappedImageExtension(),H=this.processData.getFilledCircles();if(this.imgSize=this.processor.getImageSize(),!M)return this.loadingScanUrl=!1,void(this.fileScanUrl="");let Be=new Image;Be.src="data:image/"+P+";base64,"+M,Be.crossOrigin="anonymous";var Ke=document.createElement("canvas");Ke.width=this.imgSize.width,Ke.height=this.imgSize.height;const ke=Ke.getContext("2d");Be.onload=()=>{ke?.drawImage(Be,0,0,Ke.width,Ke.height),this.drawCircleImg(H,ke),this.fileScanUrl=Ke.toDataURL("image/jpeg",.9),this.loadingScanUrl=!1}}setFormCode(){this.studentCode.setValue(this.processData.scanOfflineData.scanResult.getStudentCode()??""),this.examCode.setValue(this.processData.scanOfflineData.scanResult.getSubExamCode()??"")}initData(){this.data.resultId&&(this.loadingScanUrl=!0,this.processData=this.processor.getData(),this.setFormCode(),this.processDrawImage())}ngOnInit(){super.ngOnInit(),this.loadScriptHandleImage()}constructor(M,P,H,Be){super(Be,H),this.userService=M,this.drawScanExamService=P,this.dialogRef=H,this.loadingScanUrl=!0,this.fileScanUrl="",this.circleRadius=0,this.imgSize={width:0,height:0},this.studentCode=new x.MJ("",{nonNullable:!0}),this.examCode=new x.MJ("",{nonNullable:!0})}}return(ce=Me).\u0275fac=function(M){return new(M||ce)(p.rXU(q.R),p.rXU(F),p.rXU(T.CP,8),p.rXU(T.Vh,8))},ce.\u0275cmp=p.VBU({type:ce,selectors:[["app-edit-scan-file-dialog"]],features:[p.Vt3],decls:14,vars:10,consts:[["showImgScan",""],["elementStudentCode",""],["elementExamCode",""],["imageHolding",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-32","btn-primary","items-center",3,"click","disabled"],["class","inline-block mr-2",4,"ngIf"],[2,"vertical-align","midle"],["class","p-5 flex justify-center items-center",4,"ngIf"],["class","p-5",4,"ngIf"],[1,"p-5","flex","justify-center","items-center"],[1,"w-5","h-5","inline-block","mr-2"],[1,"p-5"],[3,"ngClass"],[1,"w-full",3,"ngClass"],["for","codeStudent",1,"form-label","text-md","font-semibold","m-0"],["type","text","id","codeStudent",1,"form-control",3,"input","formControl","placeholder"],[1,"w-full"],["for","codeExam",1,"form-label","text-md","font-semibold","m-0"],["type","text","id","codeExam",1,"form-control",3,"input","formControl","placeholder"],[1,"mt-2","text-md","font-semibold","flex","text-slate-500","items-center"],["name","info","size","16",3,"ngClass"],[2,"vertical-align","middle"],[1,"text-center","mx-auto","mt-1",2,"height","calc(var(--vh, 1vh) * 100 - 300px)","overflow-y","auto"],["id","image-holding"],["id","img-container","alt","img",3,"click","src"],[1,"inline-block","mr-2"]],template:function(M,P){if(1&M){const H=p.RV6();p.j41(0,"div",4)(1,"div",5),p.DNE(2,be,4,3,"ng-container",6)(3,nt,2,2,"ng-template",null,0,p.C5r),p.k0s(),p.j41(5,"div",7)(6,"button",8),p.bIt("click",function(){return p.eBV(H),p.Njj(P.btnCloseDialog())}),p.EFF(7),p.nI1(8,"mytranslate"),p.k0s(),p.j41(9,"button",9),p.bIt("click",function(){return p.eBV(H),p.Njj(P.confirmEdit())}),p.DNE(10,Re,2,0,"span",10),p.j41(11,"span",11),p.EFF(12),p.nI1(13,"mytranslate"),p.k0s()()()()}if(2&M){const H=p.sdS(4);p.R7$(2),p.Y8G("ngIf",!P.loadingScanUrl&&!P.fileScanUrl)("ngIfElse",H),p.R7$(5),p.SpI(" ",p.bMT(8,6,"lang_cms_common_close_btn")," "),p.R7$(2),p.Y8G("disabled",P.statusObj.loading),p.R7$(),p.Y8G("ngIf",P.statusObj.loading),p.R7$(2),p.JRh(p.bMT(13,8,"lang_auto_luu"))}},dependencies:[Q.YU,Q.bT,ee.R,x.me,x.BC,x.l_,te.WGl,oe.wp],encapsulation:2}),Me})();var ae=w(46899),Qe=w(47712);const ct=()=>({"text-slate-800":!0}),We=()=>({"text-danger":!0}),ze=ce=>({"text-success":ce});function Ue(ce,Me){if(1&ce){const ye=p.RV6();p.j41(0,"div",18)(1,"a",19),p.nI1(2,"mytranslate"),p.bIt("click",function(){let P;p.eBV(ye);const H=p.XpG(2);return p.Njj(H.openEditScanFile(null!==(P=null==H.examObj?null:H.examObj.hashId)&&void 0!==P?P:"",H.examResultIdParam))}),p.nrm(3,"lucide-icon",20),p.k0s()()}2&ce&&(p.R7$(),p.Y8G("matTooltip",p.bMT(2,2,"lang_auto_sua")),p.R7$(2),p.Y8G("ngClass",p.lJ4(4,ct)))}function gt(ce,Me){if(1&ce){const ye=p.RV6();p.j41(0,"div",21)(1,"a",22),p.nI1(2,"mytranslate"),p.bIt("click",function(){let P;p.eBV(ye);const H=p.XpG(2);return p.Njj(H.deleteOfflineExamResultObj(null!==(P=null==H.examObj?null:H.examObj.hashId)&&void 0!==P?P:"",H.examResultIdParam))}),p.nrm(3,"lucide-icon",23),p.k0s()()}2&ce&&(p.R7$(),p.Y8G("matTooltip",p.bMT(2,2,"lang_auto_xoa")),p.R7$(2),p.Y8G("ngClass",p.lJ4(4,We)))}function Ne(ce,Me){1&ce&&(p.j41(0,"span",24),p.EFF(1),p.nI1(2,"mytranslate"),p.k0s()),2&ce&&(p.R7$(),p.SpI("",p.bMT(2,1,"lang_auto_anh_cham"),":"))}function J(ce,Me){1&ce&&(p.j41(0,"span"),p.EFF(1),p.nI1(2,"mytranslate"),p.k0s()),2&ce&&(p.R7$(),p.JRh(p.bMT(2,1,"lang_auto_luu_trong_app_mobile")))}function Z(ce,Me){1&ce&&(p.qex(0),p.j41(1,"span"),p.EFF(2),p.nI1(3,"mytranslate"),p.k0s(),p.bVm()),2&ce&&(p.R7$(2),p.JRh(p.bMT(3,1,"lang_test_review_error_get_url_img")))}function ut(ce,Me){1&ce&&(p.j41(0,"span",30),p.nrm(1,"azt-loading-ui"),p.k0s())}function et(ce,Me){if(1&ce&&p.nrm(0,"img",31),2&ce){const ye=p.XpG(4);p.Aen(ye.isMobileWebView?"width: 100% !important;":"height: auto !important;"),p.Y8G("src",ye.fileScanUrl,p.B4B)}}function $e(ce,Me){if(1&ce){const ye=p.RV6();p.j41(0,"a",27),p.bIt("click",function(){p.eBV(ye);const P=p.XpG(3);return p.Njj(P.onShowFile(P.fileScanUrl))}),p.DNE(1,ut,2,0,"span",28)(2,et,1,3,"img",29),p.k0s()}if(2&ce){const ye=p.XpG(3);p.R7$(),p.Y8G("ngIf",ye.loadingScanUrl),p.R7$(),p.Y8G("ngIf",!ye.loadingScanUrl)}}function Ce(ce,Me){if(1&ce&&(p.j41(0,"div",25),p.DNE(1,Z,4,3,"ng-container",26)(2,$e,3,2,"ng-template",null,2,p.C5r),p.k0s()),2&ce){const ye=p.sdS(3),M=p.XpG(2);p.R7$(),p.Y8G("ngIf",!M.loadingScanUrl&&!M.fileScanUrl)("ngIfElse",ye)}}function Ye(ce,Me){if(1&ce&&(p.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"h3",7)(4,"span"),p.EFF(5),p.nI1(6,"mytranslate"),p.k0s()(),p.DNE(7,Ue,4,5,"div",8)(8,gt,4,5,"div",9),p.k0s()(),p.j41(9,"div",10)(10,"div",6)(11,"span",11),p.eu8(12,12),p.k0s(),p.j41(13,"span",13),p.nI1(14,"mytranslate"),p.eu8(15,12),p.k0s()(),p.j41(16,"div",14),p.DNE(17,Ne,3,3,"span",15)(18,J,3,3,"span",16),p.k0s(),p.DNE(19,Ce,4,2,"div",17),p.k0s()()),2&ce){const ye=p.XpG(),M=p.sdS(2),P=p.sdS(4);p.R7$(5),p.JRh(p.bMT(6,9,"lang_auto_thi_offline")),p.R7$(2),p.Y8G("ngIf","teacher"==ye.currentScreen),p.R7$(),p.Y8G("ngIf",ye.isDeletableExamResultObj),p.R7$(4),p.Y8G("ngTemplateOutlet",M),p.R7$(),p.FS9("matTooltip",p.bMT(14,11,"lang_auto_so_bao_danh")),p.R7$(2),p.Y8G("ngTemplateOutlet",P),p.R7$(2),p.Y8G("ngIf",!ye.isMobileWebView),p.R7$(),p.Y8G("ngIf",!ye.checkHttpLinkImg),p.R7$(),p.Y8G("ngIf",ye.checkHttpLinkImg)}}function st(ce,Me){if(1&ce&&(p.EFF(0),p.nI1(1,"mytranslate"),p.j41(2,"span",32),p.EFF(3),p.nI1(4,"formatOfflineExamHashIdToNumber"),p.k0s()),2&ce){let ye;const M=p.XpG();p.SpI(" ",p.bMT(1,3,"lang_auto_ma_de_thi"),":\xa0 "),p.R7$(2),p.Y8G("ngClass",p.eq3(8,ze,!(null!=M.offlineMarkObj&&M.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),p.R7$(),p.JRh(p.i5U(4,5,null!==(ye=null==M.offlineMixQuestionObj?null:M.offlineMixQuestionObj.hashId)&&void 0!==ye?ye:0,3))}}function Je(ce,Me){if(1&ce&&(p.EFF(0),p.nI1(1,"mytranslate"),p.j41(2,"span",32),p.EFF(3),p.nI1(4,"formatStudentCodeToNumber"),p.k0s()),2&ce){let ye;const M=p.XpG();p.SpI(" ",p.bMT(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),p.R7$(2),p.Y8G("ngClass",p.eq3(8,ze,!(null!=M.offlineMarkObj&&M.offlineMarkObj.isErrorForStudentCode))),p.R7$(),p.JRh(p.i5U(4,5,(null!==(ye=null==M.offlineMarkObj?null:M.offlineMarkObj.studentCode)&&void 0!==ye?ye:0)<0?0:null==M.offlineMarkObj?null:M.offlineMarkObj.studentCode,6))}}let xt=(()=>{var ce;class Me extends l.H{checkAzotaFile(M){return!(!M||!M.includes(".azt"))}checkHttpUrl(M){return!(!M||!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(M))}openEditScanFile(M,P){P&&this.sAztDialogService.open(je,{data:{examHashId:M,resultId:P,userId:Number(this.userIdParam)},width:"750px",restoreFocus:!1}).afterClosed().subscribe(Be=>{Be&&window.location.reload()})}deleteOfflineExamResultObj(M,P){P&&this.sAztDialogService.open(h.V,{data:{examHashId:M,examResultIds:[P],examResults:[]},restoreFocus:!1}).afterClosed().subscribe(Be=>{Be&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(M){this.sAztDialogService.open(d.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:M,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let M=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),P=this.castJsonToObj(M);this.checkHttpLinkImg=this.checkHttpUrl(P?.url),this.loadingScanUrl=!0,this.checkAzotaFile(P?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam,this.questionObjs,this.essayMark).then(H=>{H.imgUrl?this.fileScanUrl=H.imgUrl:this.checkHttpLinkImg=!0,this.drawScanExamService.totalPointExam=0,this.loadingScanUrl=!1}).catch(H=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(H=>{H?this.fileScanUrl=H:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(H=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(M,P,H){super(),this.sAztDialogService=M,this.zipDataService=P,this.drawScanExamService=H,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return(ce=Me).\u0275fac=function(M){return new(M||ce)(p.rXU(ae.i),p.rXU(A.j),p.rXU(F))},ce.\u0275cmp=p.VBU({type:ce,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",currentScreen:"currentScreen",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj",questionObjs:"questionObjs",essayMark:"essayMark"},features:[p.Vt3,p.OA$],decls:5,vars:1,consts:[["viewExamCodeTpl",""],["viewStudentCodeTpl",""],["showImgScan",""],["class","info-exam-offline mt-3 mb-3",4,"ngIf"],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],["class","mx-1 items-center",4,"ngIf"],["class","mx-1 items-center mr-0",4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],[4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],[1,"mx-1","items-center"],[1,"text-slate-800",3,"click","matTooltip"],["name","file-pen-line","size","18",3,"ngClass"],[1,"mx-1","items-center","mr-0"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click","matTooltip"],["name","trash-2","size","18",3,"ngClass"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["alt","img",3,"src"],[3,"ngClass"]],template:function(M,P){1&M&&p.DNE(0,Ye,20,13,"div",3)(1,st,5,10,"ng-template",null,0,p.C5r)(3,Je,5,10,"ng-template",null,1,p.C5r),2&M&&p.Y8G("ngIf",P.offlineMarkObj)},dependencies:[Q.YU,Q.bT,Q.T3,Qe.oV,ee.R,te.WGl,oe.wp,oe.Po,oe.IX],encapsulation:2}),Me})()},1382:(_t,Ee,w)=>{"use strict";w.d(Ee,{I:()=>T});var l=w(73014),d=w(48891),h=w(53793),_=w(58112),x=w(99927);let T=(()=>{var re;class _e{constructor(q,V,R){this.commonService=q,this.sAztCommonCdnService=V,this.answerTypeService=R}convertUrlToBase64(q){return(0,l.A)(function*(){const R=yield(yield fetch(q+"?t="+(new Date).getTime())).blob();return new Promise(j=>{const A=new FileReader;A.readAsDataURL(R),A.onloadend=()=>{j(A.result)}})})()}convertLinkToBase64(q,V,R){var j=this;return(0,l.A)(function*(){if(!V)return R;for(let Y=0;Y<(q?.length??0);Y++)if(q?.[Y].link===R)return q?.[Y].convert;var A=yield j.convertUrlToBase64(R);return q?.push({convert:A,link:R}),A})()}replaceCanvasBackground(q,V){var R=this;return(0,l.A)(function*(){if(q){var j=[];for(let rt=0;rt<q.length;rt++){var A=q[rt];if(A&&0===A.isImage){var Y=A.questionContentParse?.[0].content;A.questionContentParse&&(A.questionContentParse[0].content="");var B=void 0===Y?[]:Y.split("@[]");for(let je=0;je<B.length;je++){var L=B[je];if(!0===R.commonService.isJson(L)){var v=R.commonService.willDeleteParseJson(L);if(v.hasOwnProperty("link")){var F=document.body.offsetWidth,te=1;v.data.width>(ee=F-30)&&(v.data={x:v.data.x*(te=ee/v.data.width),y:v.data.y*te,width:v.data.width*te,height:v.data.height*te}),v.data={x:Math.floor(v.data.x),y:Math.floor(v.data.y),width:Math.floor(v.data.width),height:Math.floor(v.data.height)},A.questionContentParse&&(A.questionContentParse[0].content+=`<div class="background_question_${rt}_${je}"><img width="${1024*te}" height="${1024*te}" src="${yield R.convertLinkToBase64(j,V,R.sAztCommonCdnService.getMyCdn(v.link))}"></div>`);var oe=document.createElement("style");document.body.appendChild(oe),oe.textContent+=`.background_question_${rt}_${je} {margin: 0 3px; width: ${v.data.width}px; height: ${v.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${rt}_${je} img { margin-top: -${v.data.y}px; margin-left: -${v.data.x}px;}`}else A.questionContentParse&&(A.questionContentParse[0].content+=L)}else A.questionContentParse&&(A.questionContentParse[0].content+=L)}if(R.answerTypeService.isOneChoiceAnswer(A))for(let je=0;je<(A.answerConfigParse?.length??0);je++){var Ve=A.answerConfigParse?.[je].content;A.answerConfigParse&&(A.answerConfigParse[je].content="");var Se=void 0===Ve?[]:Ve.split("@[]");for(let ae=0;ae<Se.length;ae++){var He=Se[ae];if(!0===R.commonService.isJson(He)){var be=R.commonService.willDeleteParseJson(He);be.hasOwnProperty("link")?(F=document.body.offsetWidth,te=1,be.data.width>(ee=F-30)&&(be.data={x:be.data.x*(te=ee/be.data.width),y:be.data.y*te,width:be.data.width*te,height:be.data.height*te}),be.data={x:Math.floor(be.data.x),y:Math.floor(be.data.y),width:Math.floor(be.data.width),height:Math.floor(be.data.height)},A.answerConfigParse&&(A.answerConfigParse[je].content+=`<div class="background_question__ans${rt}_${je}_${ae}"><img width="${1024*te}" height="${1024*te}" src="${yield R.convertLinkToBase64(j,V,R.sAztCommonCdnService.getMyCdn(be.link))}"></div>`),oe=document.createElement("style"),document.body.appendChild(oe),oe.textContent+=`.background_question__ans${rt}_${je}_${ae} {margin: 0 3px; width: ${be.data.width}px; height: ${be.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${rt}_${je}_${ae} img { margin-top: -${be.data.y}px; margin-left: -${be.data.x}px;}`):A.answerConfigParse&&(A.answerConfigParse[je].content+=He)}else A.answerConfigParse&&(A.answerConfigParse[je].content+=He)}}if(A.answerMediaParse&&A.answerMediaParse.length>0){var ht=A.answerMediaParse;A.answerMediaParse="";var it=void 0===ht?[]:ht.split("@[]");for(let je=0;je<it.length;je++){var nt=it[je];if(!0===R.commonService.isJson(nt)){var ee,Re=R.commonService.willDeleteParseJson(nt);if(Re.hasOwnProperty("link"))F=document.body.offsetWidth,te=1,Re.data.width>(ee=F-30)&&(Re.data={x:Re.data.x*(te=ee/Re.data.width),y:Re.data.y*te,width:Re.data.width*te,height:Re.data.height*te}),Re.data={x:Math.floor(Re.data.x),y:Math.floor(Re.data.y),width:Math.floor(Re.data.width),height:Math.floor(Re.data.height)},A.answerMediaParse+=`<div class="background_question__ans_result${rt}_${je}"><img width="${1024*te}" height="${1024*te}" src="${yield R.convertLinkToBase64(j,V,R.sAztCommonCdnService.getMyCdn(Re.link))}"></div>`,oe=document.createElement("style"),document.body.appendChild(oe),oe.textContent+=`.background_question__ans_result${rt}_${je} {margin: 0 3px; width: ${Re.data.width}px; height: ${Re.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${rt}_${je} img { margin-top: -${Re.data.y}px; margin-left: -${Re.data.x}px;}`;else A.answerMediaParse+=nt}else A.answerMediaParse+=nt}}}}}})()}replaceCanvasBackgroundTS(q,V){var R=this;return(0,l.A)(function*(){var j=[];for(let ht=0;ht<q.length;ht++){var A=q[ht];if(0===A.isImage){var Y=A.questionContentParse[0].content;A.questionContentParse[0].content="";var B=void 0===Y?[]:Y.split("@[]");for(let it=0;it<B.length;it++){var L=B[it];if(!0===R.commonService.isJson(L)){var v=R.commonService.willDeleteParseJson(L);if(v.hasOwnProperty("link")){var F=document.body.offsetWidth,te=1;v.data.width>(ee=F-30)&&(v.data={x:v.data.x*(te=ee/v.data.width),y:v.data.y*te,width:v.data.width*te,height:v.data.height*te}),v.data={x:Math.floor(v.data.x),y:Math.floor(v.data.y),width:Math.floor(v.data.width),height:Math.floor(v.data.height)},A.questionContentParse[0].content+=`<div class="background_question_${ht}_${it}"><img width="${1024*te}" height="${1024*te}" src="${yield R.convertLinkToBase64(j,V,R.sAztCommonCdnService.getMyCdn(v.link))}"></div>`;var oe=document.createElement("style");document.body.appendChild(oe),oe.textContent+=`.background_question_${ht}_${it} {margin: 0 3px; width: ${v.data.width}px; height: ${v.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${ht}_${it} img { margin-top: -${v.data.y}px; margin-left: -${v.data.x}px;}`}else A.questionContentParse[0].content+=L}else A.questionContentParse[0].content+=L}if(R.answerTypeService.isOneChoiceAnswer(A)&&(0==A.isImage||1==A.isImage&&A.name.startsWith("[PDFv2]")?R.replaceBackgroundAnswerConfig(A.answerConfigParse,j,ht,V):R.replaceBackgroundAnswerConfig(A.answerConfigParseVer1.answerConfigV2,j,ht,V)),A.answerMedia&&A.answerMedia.length>0){var Ve=A.answerMedia;A.answerMedia="";var Se=void 0===Ve?[]:Ve.split("@[]");for(let it=0;it<Se.length;it++){var He=Se[it];if(!0===R.commonService.isJson(He)){var ee,be=R.commonService.willDeleteParseJson(He);if(be.hasOwnProperty("link"))F=document.body.offsetWidth,te=1,be.data.width>(ee=F-30)&&(be.data={x:be.data.x*(te=ee/be.data.width),y:be.data.y*te,width:be.data.width*te,height:be.data.height*te}),be.data={x:Math.floor(be.data.x),y:Math.floor(be.data.y),width:Math.floor(be.data.width),height:Math.floor(be.data.height)},A.answerMedia+=`<div class="background_question__ans_result${ht}_${it}"><img width="${1024*te}" height="${1024*te}" src="${yield R.convertLinkToBase64(j,V,R.sAztCommonCdnService.getMyCdn(be.link))}"></div>`,oe=document.createElement("style"),document.body.appendChild(oe),oe.textContent+=`.background_question__ans_result${ht}_${it} {margin: 0 3px; width: ${be.data.width}px; height: ${be.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${ht}_${it} img { margin-top: -${be.data.y}px; margin-left: -${be.data.x}px;}`;else A.answerMedia+=He}else A.answerMedia+=He}}}}return!0})()}replaceBackgroundAnswerConfig(q,V,R,j){var A=this;return(0,l.A)(function*(){for(let Ve=0;Ve<q.length;Ve++){var Y=q[Ve].content;q[Ve].content="";var B=void 0===Y?[]:Y.split("@[]");for(let Se=0;Se<B.length;Se++){var L=B[Se];if(!0===A.commonService.isJson(L)){var v=A.commonService.willDeleteParseJson(L);if(v.hasOwnProperty("link")){var ee=document.body.offsetWidth-30,te=1;v.data.width>ee&&(v.data={x:v.data.x*(te=ee/v.data.width),y:v.data.y*te,width:v.data.width*te,height:v.data.height*te}),v.data={x:Math.floor(v.data.x),y:Math.floor(v.data.y),width:Math.floor(v.data.width),height:Math.floor(v.data.height)},q[Ve].content+=`<div class="background_question__ans${R}_${Ve}_${Se}"><img width="${1024*te}" height="${1024*te}" src="${yield A.convertLinkToBase64(V,j,A.sAztCommonCdnService.getMyCdn(v.link))}"></div>`;var oe=document.createElement("style");document.body.appendChild(oe),oe.textContent+=`.background_question__ans${R}_${Ve}_${Se} {margin: 0 3px; width: ${v.data.width}px; height: ${v.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${R}_${Ve}_${Se} img { margin-top: -${v.data.y}px; margin-left: -${v.data.x}px;}`}else q[Ve].content+=L}else q[Ve].content+=L}}})()}}return(re=_e).\u0275fac=function(q){return new(q||re)(d.KVO(h.R),d.KVO(_.c),d.KVO(x._))},re.\u0275prov=d.jDH({token:re,factory:re.\u0275fac,providedIn:"root"}),_e})()},37642:(_t,Ee,w)=>{"use strict";w.d(Ee,{E:()=>d});var l=w(48891);let d=(()=>{var h;class _{getDictionaryByGroupFieldTS(T,re){for(var _e={},p=0;p<T.length;p++)T[p].hasOwnProperty(re)&&("number"==typeof T[p][re]||"string"==typeof T[p][re])&&(_e.hasOwnProperty(T[p][re])||(_e[T[p][re]]=[]),_e[T[p][re]].push(T[p]));return _e}getDictionaryByFieldTS(T,re){for(var _e={},p=0;p<T.length;p++)T[p].hasOwnProperty(re)&&("number"==typeof T[p][re]||"string"==typeof T[p][re])&&(_e[T[p][re]]=T[p]);return _e}getDictionaryBy2FieldsTS(T,re,_e){for(var p={},q=0;q<T.length;q++)T[q].hasOwnProperty(re)&&("number"==typeof T[q][re]||"string"==typeof T[q][re])&&T[q].hasOwnProperty(_e)&&("number"==typeof T[q][_e]||"string"==typeof T[q][_e])&&(p[T[q][re]+"_"+T[q][_e]]=T[q]);return p}getListValueByFieldNumberTS(T,re){for(var _e=[],p=0;p<T.length;p++)T[p].hasOwnProperty(re)&&"number"==typeof T[p][re]&&_e.push(T[p][re]);return _e}getListValueByField(T,re){for(var _e=[],p=0;p<T.length;p++)if(T[p].hasOwnProperty(re)){var q=_e.filter(V=>V[re]==T[p][re]);(!q||0==q.length)&&_e.push(T[p])}return _e}}return(h=_).\u0275fac=function(T){return new(T||h)},h.\u0275prov=l.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),_})()},99172:(_t,Ee,w)=>{"use strict";w.d(Ee,{p:()=>T});var l=w(73014),d=w(48891),h=w(53793),_=w(58112),x=w(53393);let T=(()=>{var re;class _e{processEssayResultToBase64(q){var V=this;return(0,l.A)(function*(){for(const R of q.pages??[]){if(R.draw){const j=yield V.exportPdfUtilsService.convertAndRetryToBase64(R.draw);R.draw=j}if(R.backgroundImage){const j=yield V.exportPdfUtilsService.convertAndRetryToBase64(R.backgroundImage);R.backgroundImage=j}}if(q.commentEmoji&&q.commentEmoji.length){let R="https://azota889.github.io/storage_public/mnote/",j=q.commentEmoji.length;for(let A=0;A<j;A++){let Y=R+q.commentEmoji[A];const B=yield V.exportPdfUtilsService.convertAndRetryToBase64(Y);q.commentEmoji[A]=B}}return q})()}convertAnswersArr(q,V){0!=q.length&&q.forEach(R=>{R.QuestionId&&R.AnswerContent&&R.AnswerContent[0]&&R.AnswerContent[0].Content&&(V[`id_${R.QuestionId}`]=R.AnswerContent[0].Content)})}findScaleDirection(q,V){return q/V>=.7070707070707071?"w":"h"}constructor(q,V,R){this.commonService=q,this.sAztCommonCdnService=V,this.exportPdfUtilsService=R}}return(re=_e).\u0275fac=function(q){return new(q||re)(d.KVO(h.R),d.KVO(_.c),d.KVO(x.j))},re.\u0275prov=d.jDH({token:re,factory:re.\u0275fac,providedIn:"root"}),_e})()},53393:(_t,Ee,w)=>{"use strict";w.d(Ee,{j:()=>re});var l=w(73014),d=function(_e){return _e[_e.Cdn=0]="Cdn",_e[_e.CdnTimestamp=1]="CdnTimestamp",_e[_e.Rawlink=2]="Rawlink",_e[_e.RawlinkTimestamp=3]="RawlinkTimestamp",_e}(d||{}),h=w(48891),_=w(53793),x=w(58112),T=w(99927);let re=(()=>{var _e;class p{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){const V=navigator.userAgent,j=(()=>{let Y=null;const B=V.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(B[1]))return"IE "+((/\brv[ :]+(\d+)/g.exec(V)||[])[1]||"");if("Chrome"===B[1]){const v=V.match(/\b(OPR|Edge)\/(\d+)/);if(null!==v)return v.slice(1).join(" ").replace("OPR","Opera")}const L=B[2]?[B[1],B[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!==(Y=V.match(/version\/(\d+)/i))&&L.splice(1,1,Y[1]),L.join(" ")})().toString();return!(!["chrome"].includes(j.split(" ")[0].toLowerCase())||parseInt(j.split(" ")[1],10)<80)}getExtensionFile(V){if(!V)return"";const R=V.split(".");return R.length<=1?"":R[R.length-1].toLocaleLowerCase().split("_")[0]}findImageSrcInContent(V){let R="";if(V.includes("img")){const j=V.indexOf("img"),A=V.indexOf("src=",j),Y=V.indexOf('"',Number(A)+5);R=V.substring(Number(A)+5,Number(Y))}return R}asyncTimeout(V){return(0,l.A)(function*(){return`Waited ${yield new Promise(j=>{setTimeout(()=>j(V),V)})} milliseconds`})()}parseEssayMarkResult(V,R){let j=V.filter(B=>this.answerTypeService.isEssayAnswer(B));if(0!=j.length&&R&&R.essayResult){var A=this.commonService.willDeleteParseJson(R.essayResult);if(A){var Y=Object.entries(A);for(let B=0;B<j.length;B++)j[B].essayMarkParsed=Y[B][1]}}}convertToBase64(V,R){var j=this;return(0,l.A)(function*(){let A=V;switch(R){case d.Cdn:A=j.sAztCommonCdnService.getMyCdn(V);break;case d.CdnTimestamp:A=j.sAztCommonCdnService.getMyCdn(V)+"?t="+Date.now();break;case d.RawlinkTimestamp:A=V+"?t="+Date.now()}const B=yield(yield fetch(A)).blob(),L=yield new Promise(v=>{const F=new FileReader;F.readAsDataURL(B),F.onloadend=()=>{v(F.result)}});return L&&"string"==typeof L?L:V})()}convertAndRetryToBase64(V){var R=this;return(0,l.A)(function*(){let j=R.getExtensionFile(V);if(["pdf","jpg","jpeg","png","gif"].includes(j)){let A;const Y=[d.Cdn,d.CdnTimestamp,d.Rawlink,d.RawlinkTimestamp];try{A=yield R.convertToBase64(V,Y[0])}catch{try{A=yield R.convertToBase64(V,Y[1])}catch{try{A=yield R.convertToBase64(V,Y[2])}catch{try{A=yield R.convertToBase64(V,Y[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+V),A=V}}}}return A}return V})()}eraseCanvas(V){V&&(V.beginPath(),V.rect(0,0,V.canvas.width,V.canvas.height),V.fillStyle="white",V.fill())}addContentToPdf(V,R){V.addImage(R,"JPEG",0,0,V.internal.pageSize.getWidth(),V.internal.pageSize.getHeight())}drawTextWrap(V,R,j,A,Y){const B=V.split(" "),L=[];let v=B[0];if(R){R.font=Y||`${A}px Arial`;for(let F=1;F<B.length;F++){const Q=B[F];R.measureText(v+" "+Q).width<j?v+=" "+Q:(L.push(v),v=Q)}L.push(v)}return L}essayText2LinesArr(V,R,j,A,Y){const B=new RegExp("(<br>|<br/>)+","igm"),v=(this.replaceAllByRegExp(V,B,"<br>")??"").split("<br>"),F=[];for(let Q=0;Q<v.length;Q++)F.push(this.drawTextWrap(v[Q],R,j,A,Y));return F}replaceAllByRegExp(V,R,j){return j?V?V.toString().replace(R,j):void 0:V}removeTagAssistiveMml(){const V=document.getElementsByTagName("mjx-assistive-mml");for(;V.length>0;)V[0].remove()}constructor(V,R,j){this.commonService=V,this.sAztCommonCdnService=R,this.answerTypeService=j}}return(_e=p).\u0275fac=function(V){return new(V||_e)(h.KVO(_.R),h.KVO(x.c),h.KVO(T._))},_e.\u0275prov=h.jDH({token:_e,factory:_e.\u0275fac,providedIn:"root"}),p})()},39357:(_t,Ee,w)=>{"use strict";function l(){return typeof aztExam<"u"?aztExam:void 0}w.d(Ee,{J:()=>Wp});var Y,B,d=w(43234),h=w(48891),_=w(36484),x=w(42802),T=w(73014),re=w(92757),_e=w(55995),p=w(85980),q=w(64627),V=w(56094),R=w(17791),j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},A={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function s(ne,$,X){X||(X=0);var se=Array(16);if("string"==typeof $)for(var le=0;16>le;++le)se[le]=$.charCodeAt(X++)|$.charCodeAt(X++)<<8|$.charCodeAt(X++)<<16|$.charCodeAt(X++)<<24;else for(le=0;16>le;++le)se[le]=$[X++]|$[X++]<<8|$[X++]<<16|$[X++]<<24;var fe=ne.g[3],K=($=ne.g[0])+(fe^(X=ne.g[1])&((le=ne.g[2])^fe))+se[0]+3614090360&4294967295;K=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=(X=(le=(fe=($=X+(K<<7&4294967295|K>>>25))+((K=fe+(le^$&(X^le))+se[1]+3905402710&4294967295)<<12&4294967295|K>>>20))+((K=le+(X^fe&($^X))+se[2]+606105819&4294967295)<<17&4294967295|K>>>15))+((K=X+($^le&(fe^$))+se[3]+3250441966&4294967295)<<22&4294967295|K>>>10))+((K=$+(fe^X&(le^fe))+se[4]+4118548399&4294967295)<<7&4294967295|K>>>25))+((K=fe+(le^$&(X^le))+se[5]+1200080426&4294967295)<<12&4294967295|K>>>20))+((K=le+(X^fe&($^X))+se[6]+2821735955&4294967295)<<17&4294967295|K>>>15))+((K=X+($^le&(fe^$))+se[7]+4249261313&4294967295)<<22&4294967295|K>>>10))+((K=$+(fe^X&(le^fe))+se[8]+1770035416&4294967295)<<7&4294967295|K>>>25))+((K=fe+(le^$&(X^le))+se[9]+2336552879&4294967295)<<12&4294967295|K>>>20))+((K=le+(X^fe&($^X))+se[10]+4294925233&4294967295)<<17&4294967295|K>>>15))+((K=X+($^le&(fe^$))+se[11]+2304563134&4294967295)<<22&4294967295|K>>>10))+((K=$+(fe^X&(le^fe))+se[12]+1804603682&4294967295)<<7&4294967295|K>>>25))+((K=fe+(le^$&(X^le))+se[13]+4254626195&4294967295)<<12&4294967295|K>>>20))+((K=le+(X^fe&($^X))+se[14]+2792965006&4294967295)<<17&4294967295|K>>>15))+((K=X+($^le&(fe^$))+se[15]+1236535329&4294967295)<<22&4294967295|K>>>10))+((K=$+(le^fe&(X^le))+se[1]+4129170786&4294967295)<<5&4294967295|K>>>27))+((K=fe+(X^le&($^X))+se[6]+3225465664&4294967295)<<9&4294967295|K>>>23))+((K=le+($^X&(fe^$))+se[11]+643717713&4294967295)<<14&4294967295|K>>>18))+((K=X+(fe^$&(le^fe))+se[0]+3921069994&4294967295)<<20&4294967295|K>>>12))+((K=$+(le^fe&(X^le))+se[5]+3593408605&4294967295)<<5&4294967295|K>>>27))+((K=fe+(X^le&($^X))+se[10]+38016083&4294967295)<<9&4294967295|K>>>23))+((K=le+($^X&(fe^$))+se[15]+3634488961&4294967295)<<14&4294967295|K>>>18))+((K=X+(fe^$&(le^fe))+se[4]+3889429448&4294967295)<<20&4294967295|K>>>12))+((K=$+(le^fe&(X^le))+se[9]+568446438&4294967295)<<5&4294967295|K>>>27))+((K=fe+(X^le&($^X))+se[14]+3275163606&4294967295)<<9&4294967295|K>>>23))+((K=le+($^X&(fe^$))+se[3]+4107603335&4294967295)<<14&4294967295|K>>>18))+((K=X+(fe^$&(le^fe))+se[8]+1163531501&4294967295)<<20&4294967295|K>>>12))+((K=$+(le^fe&(X^le))+se[13]+2850285829&4294967295)<<5&4294967295|K>>>27))+((K=fe+(X^le&($^X))+se[2]+4243563512&4294967295)<<9&4294967295|K>>>23))+((K=le+($^X&(fe^$))+se[7]+1735328473&4294967295)<<14&4294967295|K>>>18))+((K=X+(fe^$&(le^fe))+se[12]+2368359562&4294967295)<<20&4294967295|K>>>12))+((K=$+(X^le^fe)+se[5]+4294588738&4294967295)<<4&4294967295|K>>>28))+((K=fe+($^X^le)+se[8]+2272392833&4294967295)<<11&4294967295|K>>>21))+((K=le+(fe^$^X)+se[11]+1839030562&4294967295)<<16&4294967295|K>>>16))+((K=X+(le^fe^$)+se[14]+4259657740&4294967295)<<23&4294967295|K>>>9))+((K=$+(X^le^fe)+se[1]+2763975236&4294967295)<<4&4294967295|K>>>28))+((K=fe+($^X^le)+se[4]+1272893353&4294967295)<<11&4294967295|K>>>21))+((K=le+(fe^$^X)+se[7]+4139469664&4294967295)<<16&4294967295|K>>>16))+((K=X+(le^fe^$)+se[10]+3200236656&4294967295)<<23&4294967295|K>>>9))+((K=$+(X^le^fe)+se[13]+681279174&4294967295)<<4&4294967295|K>>>28))+((K=fe+($^X^le)+se[0]+3936430074&4294967295)<<11&4294967295|K>>>21))+((K=le+(fe^$^X)+se[3]+3572445317&4294967295)<<16&4294967295|K>>>16))+((K=X+(le^fe^$)+se[6]+76029189&4294967295)<<23&4294967295|K>>>9))+((K=$+(X^le^fe)+se[9]+3654602809&4294967295)<<4&4294967295|K>>>28))+((K=fe+($^X^le)+se[12]+3873151461&4294967295)<<11&4294967295|K>>>21))+((K=le+(fe^$^X)+se[15]+530742520&4294967295)<<16&4294967295|K>>>16))+((K=X+(le^fe^$)+se[2]+3299628645&4294967295)<<23&4294967295|K>>>9))+((K=$+(le^(X|~fe))+se[0]+4096336452&4294967295)<<6&4294967295|K>>>26))+((K=fe+(X^($|~le))+se[7]+1126891415&4294967295)<<10&4294967295|K>>>22))+((K=le+($^(fe|~X))+se[14]+2878612391&4294967295)<<15&4294967295|K>>>17))+((K=X+(fe^(le|~$))+se[5]+4237533241&4294967295)<<21&4294967295|K>>>11))+((K=$+(le^(X|~fe))+se[12]+1700485571&4294967295)<<6&4294967295|K>>>26))+((K=fe+(X^($|~le))+se[3]+2399980690&4294967295)<<10&4294967295|K>>>22))+((K=le+($^(fe|~X))+se[10]+4293915773&4294967295)<<15&4294967295|K>>>17))+((K=X+(fe^(le|~$))+se[1]+2240044497&4294967295)<<21&4294967295|K>>>11))+((K=$+(le^(X|~fe))+se[8]+1873313359&4294967295)<<6&4294967295|K>>>26))+((K=fe+(X^($|~le))+se[15]+4264355552&4294967295)<<10&4294967295|K>>>22))+((K=le+($^(fe|~X))+se[6]+2734768916&4294967295)<<15&4294967295|K>>>17))+((K=X+(fe^(le|~$))+se[13]+1309151649&4294967295)<<21&4294967295|K>>>11))+((fe=($=X+((K=$+(le^(X|~fe))+se[4]+4149444226&4294967295)<<6&4294967295|K>>>26))+((K=fe+(X^($|~le))+se[11]+3174756917&4294967295)<<10&4294967295|K>>>22))^((le=fe+((K=le+($^(fe|~X))+se[2]+718787259&4294967295)<<15&4294967295|K>>>17))|~$))+se[9]+3951481745&4294967295,ne.g[0]=ne.g[0]+$&4294967295,ne.g[1]=ne.g[1]+(le+(K<<21&4294967295|K>>>11))&4294967295,ne.g[2]=ne.g[2]+le&4294967295,ne.g[3]=ne.g[3]+fe&4294967295}function o(ne,$){this.h=$;for(var X=[],se=!0,le=ne.length-1;0<=le;le--){var fe=0|ne[le];se&&fe==$||(X[le]=fe,se=!1)}this.g=X}(function e(ne,$){function X(){}X.prototype=$.prototype,ne.D=$.prototype,ne.prototype=new X,ne.prototype.constructor=ne,ne.C=function(se,le,fe){for(var K=Array(arguments.length-2),Nn=2;Nn<arguments.length;Nn++)K[Nn-2]=arguments[Nn];return $.prototype[le].apply(se,K)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(ne,$){void 0===$&&($=ne.length);for(var X=$-this.blockSize,se=this.B,le=this.h,fe=0;fe<$;){if(0==le)for(;fe<=X;)s(this,ne,fe),fe+=this.blockSize;if("string"==typeof ne){for(;fe<$;)if(se[le++]=ne.charCodeAt(fe++),le==this.blockSize){s(this,se),le=0;break}}else for(;fe<$;)if(se[le++]=ne[fe++],le==this.blockSize){s(this,se),le=0;break}}this.h=le,this.o+=$},n.prototype.v=function(){var ne=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ne[0]=128;for(var $=1;$<ne.length-8;++$)ne[$]=0;var X=8*this.o;for($=ne.length-8;$<ne.length;++$)ne[$]=255&X,X/=256;for(this.u(ne),ne=Array(16),$=X=0;4>$;++$)for(var se=0;32>se;se+=8)ne[X++]=this.g[$]>>>se&255;return ne};var c={};function u(ne){return-128<=ne&&128>ne?function i(ne,$){var X=c;return Object.prototype.hasOwnProperty.call(X,ne)?X[ne]:X[ne]=$(ne)}(ne,function($){return new o([0|$],0>$?-1:0)}):new o([0|ne],0>ne?-1:0)}function f(ne){if(isNaN(ne)||!isFinite(ne))return C;if(0>ne)return Fe(f(-ne));for(var $=[],X=1,se=0;ne>=X;se++)$[se]=ne/X|0,X*=4294967296;return new o($,0)}var C=u(0),G=u(1),ue=u(16777216);function Pe(ne){if(0!=ne.h)return!1;for(var $=0;$<ne.g.length;$++)if(0!=ne.g[$])return!1;return!0}function Le(ne){return-1==ne.h}function Fe(ne){for(var $=ne.g.length,X=[],se=0;se<$;se++)X[se]=~ne.g[se];return new o(X,~ne.h).add(G)}function at(ne,$){return ne.add(Fe($))}function dt(ne,$){for(;(65535&ne[$])!=ne[$];)ne[$+1]+=ne[$]>>>16,ne[$]&=65535,$++}function lt(ne,$){this.g=ne,this.h=$}function ft(ne,$){if(Pe($))throw Error("division by zero");if(Pe(ne))return new lt(C,C);if(Le(ne))return $=ft(Fe(ne),$),new lt(Fe($.g),Fe($.h));if(Le($))return $=ft(ne,Fe($)),new lt(Fe($.g),$.h);if(30<ne.g.length){if(Le(ne)||Le($))throw Error("slowDivide_ only works with positive integers.");for(var X=G,se=$;0>=se.l(ne);)X=It(X),se=It(se);var le=vt(X,1),fe=vt(se,1);for(se=vt(se,2),X=vt(X,2);!Pe(se);){var K=fe.add(se);0>=K.l(ne)&&(le=le.add(X),fe=K),se=vt(se,1),X=vt(X,1)}return $=at(ne,le.j($)),new lt(le,$)}for(le=C;0<=ne.l($);){for(X=Math.max(1,Math.floor(ne.m()/$.m())),se=48>=(se=Math.ceil(Math.log(X)/Math.LN2))?1:Math.pow(2,se-48),K=(fe=f(X)).j($);Le(K)||0<K.l(ne);)K=(fe=f(X-=se)).j($);Pe(fe)&&(fe=G),le=le.add(fe),ne=at(ne,K)}return new lt(le,ne)}function It(ne){for(var $=ne.g.length+1,X=[],se=0;se<$;se++)X[se]=ne.i(se)<<1|ne.i(se-1)>>>31;return new o(X,ne.h)}function vt(ne,$){var X=$>>5;$%=32;for(var se=ne.g.length-X,le=[],fe=0;fe<se;fe++)le[fe]=0<$?ne.i(fe+X)>>>$|ne.i(fe+X+1)<<32-$:ne.i(fe+X);return new o(le,ne.h)}(r=o.prototype).m=function(){if(Le(this))return-Fe(this).m();for(var ne=0,$=1,X=0;X<this.g.length;X++){var se=this.i(X);ne+=(0<=se?se:4294967296+se)*$,$*=4294967296}return ne},r.toString=function(ne){if(2>(ne=ne||10)||36<ne)throw Error("radix out of range: "+ne);if(Pe(this))return"0";if(Le(this))return"-"+Fe(this).toString(ne);for(var $=f(Math.pow(ne,6)),X=this,se="";;){var le=ft(X,$).g,fe=((0<(X=at(X,le.j($))).g.length?X.g[0]:X.h)>>>0).toString(ne);if(Pe(X=le))return fe+se;for(;6>fe.length;)fe="0"+fe;se=fe+se}},r.i=function(ne){return 0>ne?0:ne<this.g.length?this.g[ne]:this.h},r.l=function(ne){return Le(ne=at(this,ne))?-1:Pe(ne)?0:1},r.abs=function(){return Le(this)?Fe(this):this},r.add=function(ne){for(var $=Math.max(this.g.length,ne.g.length),X=[],se=0,le=0;le<=$;le++){var fe=se+(65535&this.i(le))+(65535&ne.i(le)),K=(fe>>>16)+(this.i(le)>>>16)+(ne.i(le)>>>16);se=K>>>16,X[le]=(K&=65535)<<16|(fe&=65535)}return new o(X,-2147483648&X[X.length-1]?-1:0)},r.j=function(ne){if(Pe(this)||Pe(ne))return C;if(Le(this))return Le(ne)?Fe(this).j(Fe(ne)):Fe(Fe(this).j(ne));if(Le(ne))return Fe(this.j(Fe(ne)));if(0>this.l(ue)&&0>ne.l(ue))return f(this.m()*ne.m());for(var $=this.g.length+ne.g.length,X=[],se=0;se<2*$;se++)X[se]=0;for(se=0;se<this.g.length;se++)for(var le=0;le<ne.g.length;le++){var fe=this.i(se)>>>16,K=65535&this.i(se),Nn=ne.i(le)>>>16,qs=65535&ne.i(le);X[2*se+2*le]+=K*qs,dt(X,2*se+2*le),X[2*se+2*le+1]+=fe*qs,dt(X,2*se+2*le+1),X[2*se+2*le+1]+=K*Nn,dt(X,2*se+2*le+1),X[2*se+2*le+2]+=fe*Nn,dt(X,2*se+2*le+2)}for(se=0;se<$;se++)X[se]=X[2*se+1]<<16|X[2*se];for(se=$;se<2*$;se++)X[se]=0;return new o(X,0)},r.A=function(ne){return ft(this,ne).h},r.and=function(ne){for(var $=Math.max(this.g.length,ne.g.length),X=[],se=0;se<$;se++)X[se]=this.i(se)&ne.i(se);return new o(X,this.h&ne.h)},r.or=function(ne){for(var $=Math.max(this.g.length,ne.g.length),X=[],se=0;se<$;se++)X[se]=this.i(se)|ne.i(se);return new o(X,this.h|ne.h)},r.xor=function(ne){for(var $=Math.max(this.g.length,ne.g.length),X=[],se=0;se<$;se++)X[se]=this.i(se)^ne.i(se);return new o(X,this.h^ne.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,B=A.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=f,o.fromString=function y(ne,$){if(0==ne.length)throw Error("number format error: empty string");if(2>($=$||10)||36<$)throw Error("radix out of range: "+$);if("-"==ne.charAt(0))return Fe(y(ne.substring(1),$));if(0<=ne.indexOf("-"))throw Error('number format error: interior "-" character');for(var X=f(Math.pow($,8)),se=C,le=0;le<ne.length;le+=8){var fe=Math.min(8,ne.length-le),K=parseInt(ne.substring(le,le+fe),$);8>fe?(fe=f(Math.pow($,fe)),se=se.j(fe).add(f(K))):se=(se=se.j(X)).add(f(K))}return se},Y=A.Integer=o}).apply(typeof j<"u"?j:typeof self<"u"?self:typeof window<"u"?window:{});var F,ee,te,oe,Ve,Se,He,be,L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(a,m,g){return a==Array.prototype||a==Object.prototype||(a[m]=g.value),a},n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof L&&L];for(var m=0;m<a.length;++m){var g=a[m];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}(this);!function s(a,m){if(m)e:{var g=n;a=a.split(".");for(var S=0;S<a.length-1;S++){var he=a[S];if(!(he in g))break e;g=g[he]}(m=m(S=g[a=a[a.length-1]]))!=S&&null!=m&&e(g,a,{configurable:!0,writable:!0,value:m})}}("Array.prototype.values",function(a){return a||function(){return function i(a,m){a instanceof String&&(a+="");var g=0,S=!1,he={next:function(){if(!S&&g<a.length){var we=g++;return{value:m(we,a[we]),done:!1}}return S=!0,{done:!0,value:void 0}}};return he[Symbol.iterator]=function(){return he},he}(this,function(m,g){return g})}});var o=o||{},c=this||self;function u(a){var m=typeof a;return"array"==(m="object"!=m?m:a?Array.isArray(a)?"array":m:"null")||"object"==m&&"number"==typeof a.length}function f(a){var m=typeof a;return"object"==m&&null!=a||"function"==m}function y(a,m,g){return a.call.apply(a.bind,arguments)}function C(a,m,g){if(!a)throw Error();if(2<arguments.length){var S=Array.prototype.slice.call(arguments,2);return function(){var he=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(he,S),a.apply(m,he)}}return function(){return a.apply(m,arguments)}}function G(a,m,g){return(G=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:C).apply(null,arguments)}function ue(a,m){var g=Array.prototype.slice.call(arguments,1);return function(){var S=g.slice();return S.push.apply(S,arguments),a.apply(this,S)}}function Pe(a,m){function g(){}g.prototype=m.prototype,a.aa=m.prototype,a.prototype=new g,a.prototype.constructor=a,a.Qb=function(S,he,we){for(var Xe=Array(arguments.length-2),Rt=2;Rt<arguments.length;Rt++)Xe[Rt-2]=arguments[Rt];return m.prototype[he].apply(S,Xe)}}function Le(a){const m=a.length;if(0<m){const g=Array(m);for(let S=0;S<m;S++)g[S]=a[S];return g}return[]}function Fe(a,m){for(let g=1;g<arguments.length;g++){const S=arguments[g];if(u(S)){const he=a.length||0,we=S.length||0;a.length=he+we;for(let Xe=0;Xe<we;Xe++)a[he+Xe]=S[Xe]}else a.push(S)}}function dt(a){return/^[\s\xa0]*$/.test(a)}function lt(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function ft(a){return ft[" "](a),a}ft[" "]=function(){};var It=!(-1==lt().indexOf("Gecko")||-1!=lt().toLowerCase().indexOf("webkit")&&-1==lt().indexOf("Edge")||-1!=lt().indexOf("Trident")||-1!=lt().indexOf("MSIE")||-1!=lt().indexOf("Edge"));function vt(a,m,g){for(const S in a)m.call(g,a[S],S,a)}function $(a){const m={};for(const g in a)m[g]=a[g];return m}const X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(a,m){let g,S;for(let he=1;he<arguments.length;he++){for(g in S=arguments[he],S)a[g]=S[g];for(let we=0;we<X.length;we++)g=X[we],Object.prototype.hasOwnProperty.call(S,g)&&(a[g]=S[g])}}function le(a){var m=1;a=a.split(":");const g=[];for(;0<m&&a.length;)g.push(a.shift()),m--;return a.length&&g.push(a.join(":")),g}function fe(a){c.setTimeout(()=>{throw a},0)}function K(){var a=sc;let m=null;return a.g&&(m=a.g,a.g=a.g.next,a.g||(a.h=null),m.next=null),m}var qs=new class at{constructor(m,g){this.i=m,this.j=g,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}(()=>new Kp,a=>a.reset());class Kp{constructor(){this.next=this.g=this.h=null}set(m,g){this.h=m,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Ws,Ks=!1,sc=new class Nn{constructor(){this.h=this.g=null}add(m,g){const S=qs.get();S.set(m,g),this.h?this.h.next=S:this.g=S,this.h=S}},Bd=()=>{const a=c.Promise.resolve(void 0);Ws=()=>{a.then(Qp)}};var Qp=()=>{for(var a;a=K();){try{a.h.call(a.g)}catch(g){fe(g)}var m=qs;m.j(a),100>m.h&&(m.h++,a.next=m.g,m.g=a)}Ks=!1};function er(){this.s=this.s,this.C=this.C}function ln(a,m){this.type=a,this.g=this.target=m,this.defaultPrevented=!1}er.prototype.s=!1,er.prototype.ma=function(){this.s||(this.s=!0,this.N())},er.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},ln.prototype.h=function(){this.defaultPrevented=!0};var Yp=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,m=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const g=()=>{};c.addEventListener("test",g,m),c.removeEventListener("test",g,m)}catch{}return a}();function Qs(a,m){if(ln.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var g=this.type=a.type,S=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=m,m=a.relatedTarget){if(It){e:{try{ft(m.nodeName);var he=!0;break e}catch{}he=!1}he||(m=null)}}else"mouseover"==g?m=a.fromElement:"mouseout"==g&&(m=a.toElement);this.relatedTarget=m,S?(this.clientX=void 0!==S.clientX?S.clientX:S.pageX,this.clientY=void 0!==S.clientY?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Xp[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Qs.aa.h.call(this)}}Pe(Qs,ln);var Xp={2:"touch",3:"pen",4:"mouse"};Qs.prototype.h=function(){Qs.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ys="closure_listenable_"+(1e6*Math.random()|0),Jp=0;function Hp(a,m,g,S,he){this.listener=a,this.proxy=null,this.src=m,this.type=g,this.capture=!!S,this.ha=he,this.key=++Jp,this.da=this.fa=!1}function uo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ho(a){this.src=a,this.g={},this.h=0}function ic(a,m){var g=m.type;if(g in a.g){var we,S=a.g[g],he=Array.prototype.indexOf.call(S,m,void 0);(we=0<=he)&&Array.prototype.splice.call(S,he,1),we&&(uo(m),0==a.g[g].length&&(delete a.g[g],a.h--))}}function oc(a,m,g,S){for(var he=0;he<a.length;++he){var we=a[he];if(!we.da&&we.listener==m&&we.capture==!!g&&we.ha==S)return he}return-1}ho.prototype.add=function(a,m,g,S,he){var we=a.toString();(a=this.g[we])||(a=this.g[we]=[],this.h++);var Xe=oc(a,m,S,he);return-1<Xe?(m=a[Xe],g||(m.fa=!1)):((m=new Hp(m,this.src,we,!!S,he)).fa=g,a.push(m)),m};var ac="closure_lm_"+(1e6*Math.random()|0),lc={};function Ld(a,m,g,S,he){if(S&&S.once)return Ud(a,m,g,S,he);if(Array.isArray(m)){for(var we=0;we<m.length;we++)Ld(a,m[we],g,S,he);return null}return g=dc(g),a&&a[Ys]?a.K(m,g,f(S)?!!S.capture:!!S,he):Gd(a,m,g,!1,S,he)}function Gd(a,m,g,S,he,we){if(!m)throw Error("Invalid event type");var Xe=f(he)?!!he.capture:!!he,Rt=uc(a);if(Rt||(a[ac]=Rt=new ho(a)),(g=Rt.add(m,g,S,Xe,we)).proxy)return g;if(S=function Zp(){const m=eg;return function a(g){return m.call(a.src,a.listener,g)}}(),g.proxy=S,S.src=a,S.listener=g,a.addEventListener)Yp||(he=Xe),void 0===he&&(he=!1),a.addEventListener(m.toString(),S,he);else if(a.attachEvent)a.attachEvent(qd(m.toString()),S);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(S)}return g}function Ud(a,m,g,S,he){if(Array.isArray(m)){for(var we=0;we<m.length;we++)Ud(a,m[we],g,S,he);return null}return g=dc(g),a&&a[Ys]?a.L(m,g,f(S)?!!S.capture:!!S,he):Gd(a,m,g,!0,S,he)}function $d(a,m,g,S,he){if(Array.isArray(m))for(var we=0;we<m.length;we++)$d(a,m[we],g,S,he);else S=f(S)?!!S.capture:!!S,g=dc(g),a&&a[Ys]?(a=a.i,(m=String(m).toString())in a.g&&-1<(g=oc(we=a.g[m],g,S,he))&&(uo(we[g]),Array.prototype.splice.call(we,g,1),0==we.length&&(delete a.g[m],a.h--))):a&&(a=uc(a))&&(m=a.g[m.toString()],a=-1,m&&(a=oc(m,g,S,he)),(g=-1<a?m[a]:null)&&cc(g))}function cc(a){if("number"!=typeof a&&a&&!a.da){var m=a.src;if(m&&m[Ys])ic(m.i,a);else{var g=a.type,S=a.proxy;m.removeEventListener?m.removeEventListener(g,S,a.capture):m.detachEvent?m.detachEvent(qd(g),S):m.addListener&&m.removeListener&&m.removeListener(S),(g=uc(m))?(ic(g,a),0==g.h&&(g.src=null,m[ac]=null)):uo(a)}}}function qd(a){return a in lc?lc[a]:lc[a]="on"+a}function eg(a,m){if(a.da)a=!0;else{m=new Qs(m,this);var g=a.listener,S=a.ha||a.src;a.fa&&cc(a),a=g.call(S,m)}return a}function uc(a){return(a=a[ac])instanceof ho?a:null}var hc="__closure_events_fn_"+(1e9*Math.random()>>>0);function dc(a){return"function"==typeof a?a:(a[hc]||(a[hc]=function(m){return a.handleEvent(m)}),a[hc])}function cn(){er.call(this),this.i=new ho(this),this.M=this,this.F=null}function dn(a,m){var g,S=a.F;if(S)for(g=[];S;S=S.F)g.push(S);if(a=a.M,S=m.type||m,"string"==typeof m)m=new ln(m,a);else if(m instanceof ln)m.target=m.target||a;else{var he=m;se(m=new ln(S,a),he)}if(he=!0,g)for(var we=g.length-1;0<=we;we--){var Xe=m.g=g[we];he=_o(Xe,S,!0,m)&&he}if(he=_o(Xe=m.g=a,S,!0,m)&&he,he=_o(Xe,S,!1,m)&&he,g)for(we=0;we<g.length;we++)he=_o(Xe=m.g=g[we],S,!1,m)&&he}function _o(a,m,g,S){if(!(m=a.i.g[String(m)]))return!0;m=m.concat();for(var he=!0,we=0;we<m.length;++we){var Xe=m[we];if(Xe&&!Xe.da&&Xe.capture==g){var Rt=Xe.listener,tn=Xe.ha||Xe.src;Xe.fa&&ic(a.i,Xe),he=!1!==Rt.call(tn,S)&&he}}return he&&!S.defaultPrevented}function Wd(a,m,g){if("function"==typeof a)g&&(a=G(a,g));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=G(a.handleEvent,a)}return 2147483647<Number(m)?-1:c.setTimeout(a,m||0)}function Kd(a){a.g=Wd(()=>{a.g=null,a.i&&(a.i=!1,Kd(a))},a.l);const m=a.h;a.h=null,a.m.apply(null,m)}Pe(cn,er),cn.prototype[Ys]=!0,cn.prototype.removeEventListener=function(a,m,g,S){$d(this,a,m,g,S)},cn.prototype.N=function(){if(cn.aa.N.call(this),this.i){var m,a=this.i;for(m in a.g){for(var g=a.g[m],S=0;S<g.length;S++)uo(g[S]);delete a.g[m],a.h--}}this.F=null},cn.prototype.K=function(a,m,g,S){return this.i.add(String(a),m,!1,g,S)},cn.prototype.L=function(a,m,g,S){return this.i.add(String(a),m,!0,g,S)};class tg extends er{constructor(m,g){super(),this.m=m,this.l=g,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:Kd(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xs(a){er.call(this),this.h=a,this.g={}}Pe(Xs,er);var Qd=[];function Yd(a){vt(a.g,function(m,g){this.g.hasOwnProperty(g)&&cc(m)},a),a.g={}}Xs.prototype.N=function(){Xs.aa.N.call(this),Yd(this)},Xs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var _c=c.JSON.stringify,ng=c.JSON.parse,rg=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function mc(){}function Jd(){}mc.prototype.h=null;var Js={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function fc(){ln.call(this,"d")}function pc(){ln.call(this,"c")}Pe(fc,ln),Pe(pc,ln);var Tr={},Hd=null;function mo(){return Hd=Hd||new cn}function Zd(a){ln.call(this,Tr.La,a)}function Hs(a){const m=mo();dn(m,new Zd(m))}function e_(a,m){ln.call(this,Tr.STAT_EVENT,a),this.stat=m}function _n(a){const m=mo();dn(m,new e_(m,a))}function t_(a,m){ln.call(this,Tr.Ma,a),this.size=m}function Zs(a,m){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},m)}function ei(){this.g=!0}function os(a,m,g,S){a.info(function(){return"XMLHTTP TEXT ("+m+"): "+function ag(a,m){if(!a.g)return m;if(!m)return null;try{var g=JSON.parse(m);if(g)for(a=0;a<g.length;a++)if(Array.isArray(g[a])){var S=g[a];if(!(2>S.length)){var he=S[1];if(Array.isArray(he)&&!(1>he.length)){var we=he[0];if("noop"!=we&&"stop"!=we&&"close"!=we)for(var Xe=1;Xe<he.length;Xe++)he[Xe]=""}}}return _c(g)}catch{return m}}(a,g)+(S?" "+S:"")})}Tr.La="serverreachability",Pe(Zd,ln),Tr.STAT_EVENT="statevent",Pe(e_,ln),Tr.Ma="timingevent",Pe(t_,ln),ei.prototype.xa=function(){this.g=!1},ei.prototype.info=function(){};var gc,fo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},n_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function po(){}function tr(a,m,g,S){this.j=a,this.i=m,this.l=g,this.R=S||1,this.U=new Xs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new r_}function r_(){this.i=null,this.g="",this.h=!1}Pe(po,mc),po.prototype.g=function(){return new XMLHttpRequest},po.prototype.i=function(){return{}},gc=new po;var s_={},yc={};function vc(a,m,g){a.L=1,a.v=wo(jn(m)),a.m=g,a.P=!0,i_(a,null)}function i_(a,m){a.F=Date.now(),go(a),a.A=jn(a.v);var g=a.A,S=a.R;Array.isArray(S)||(S=[String(S)]),v_(g.i,"t",S),a.C=0,g=a.j.J,a.h=new r_,a.g=z_(a.j,g?m:null,!a.m),0<a.O&&(a.M=new tg(G(a.Y,a,a.g),a.O)),m=a.U,g=a.g,S=a.ca;var he="readystatechange";Array.isArray(he)||(he&&(Qd[0]=he.toString()),he=Qd);for(var we=0;we<he.length;we++){var Xe=Ld(g,he[we],S||m.handleEvent,!1,m.h||m);if(!Xe)break;m.g[Xe.key]=Xe}m=a.H?$(a.H):{},a.m?(a.u||(a.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,m)):(a.u="GET",a.g.ea(a.A,a.u,null,m)),Hs(),function sg(a,m,g,S,he,we){a.info(function(){if(a.g)if(we)for(var Xe="",Rt=we.split("&"),tn=0;tn<Rt.length;tn++){var Et=Rt[tn].split("=");if(1<Et.length){var un=Et[0];Et=Et[1];var hn=un.split("_");Xe=2<=hn.length&&"type"==hn[1]?Xe+(un+"=")+Et+"&":Xe+(un+"=redacted&")}}else Xe=null;else Xe=we;return"XMLHTTP REQ ("+S+") [attempt "+he+"]: "+m+"\n"+g+"\n"+Xe})}(a.i,a.u,a.A,a.l,a.R,a.m)}function o_(a){return!!a.g&&"GET"==a.u&&2!=a.L&&a.j.Ca}function lg(a,m){var g=a.C,S=m.indexOf("\n",g);return-1==S?yc:(g=Number(m.substring(g,S)),isNaN(g)?s_:(S+=1)+g>m.length?yc:(m=m.slice(S,S+g),a.C=S+g,m))}function go(a){a.S=Date.now()+a.I,a_(a,a.I)}function a_(a,m){if(null!=a.B)throw Error("WatchDog timer not null");a.B=Zs(G(a.ba,a),m)}function wc(a){a.B&&(c.clearTimeout(a.B),a.B=null)}function ti(a){0==a.j.G||a.J||M_(a.j,a)}function br(a){wc(a);var m=a.M;m&&"function"==typeof m.ma&&m.ma(),a.M=null,Yd(a.U),a.g&&(m=a.g,a.g=null,m.abort(),m.ma())}function xc(a,m){try{var g=a.j;if(0!=g.G&&(g.g==a||Tc(g.h,a)))if(!a.K&&Tc(g.h,a)&&3==g.G){try{var S=g.Da.g.parse(m)}catch{S=null}if(Array.isArray(S)&&3==S.length){var he=S;if(0==he[0]){e:if(!g.u){if(g.g){if(!(g.g.F+3e3<a.F))break e;Eo(g),bo(g)}Ac(g),_n(18)}}else g.za=he[1],0<g.za-g.T&&37500>he[2]&&g.F&&0==g.v&&!g.C&&(g.C=Zs(G(g.Za,g),6e3));if(1>=u_(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Er(g,11)}else if((a.K||g.g==a)&&Eo(g),!dt(m))for(he=g.Da.g.parse(m),m=0;m<he.length;m++){let Et=he[m];if(g.T=Et[0],Et=Et[1],2==g.G)if("c"==Et[0]){g.K=Et[1],g.ia=Et[2];const un=Et[3];null!=un&&(g.la=un,g.j.info("VER="+g.la));const hn=Et[4];null!=hn&&(g.Aa=hn,g.j.info("SVER="+g.Aa));const cs=Et[5];null!=cs&&"number"==typeof cs&&0<cs&&(g.L=S=1.5*cs,g.j.info("backChannelRequestTimeoutMs_="+S)),S=g;const bn=a.g;if(bn){const Co=bn.g?bn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Co){var we=S.h;we.g||-1==Co.indexOf("spdy")&&-1==Co.indexOf("quic")&&-1==Co.indexOf("h2")||(we.j=we.l,we.g=new Set,we.h&&(bc(we,we.h),we.h=null))}if(S.D){const Sc=bn.g?bn.g.getResponseHeader("X-HTTP-Session-Id"):null;Sc&&(S.ya=Sc,Mt(S.I,S.D,Sc))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-a.F,g.j.info("Handshake RTT: "+g.R+"ms"));var Xe=a;if((S=g).qa=V_(S,S.J?S.ia:null,S.W),Xe.K){h_(S.h,Xe);var Rt=Xe,tn=S.L;tn&&(Rt.I=tn),Rt.B&&(wc(Rt),go(Rt)),S.g=Xe}else P_(S);0<g.i.length&&Io(g)}else"stop"!=Et[0]&&"close"!=Et[0]||Er(g,7);else 3==g.G&&("stop"==Et[0]||"close"==Et[0]?"stop"==Et[0]?Er(g,7):Ec(g):"noop"!=Et[0]&&g.l&&g.l.ta(Et),g.v=0)}Hs()}catch{}}tr.prototype.ca=function(a){a=a.target;const m=this.M;m&&3==Bn(a)?m.j():this.Y(a)},tr.prototype.Y=function(a){try{if(a==this.g)e:{const hn=Bn(this.g);var m=this.g.Ba();if(this.g.Z(),!(3>hn)&&(3!=hn||this.g&&(this.h.h||this.g.oa()||A_(this.g)))){this.J||4!=hn||7==m||Hs(),wc(this);var g=this.g.Z();this.X=g;t:if(o_(this)){var S=A_(this.g);a="";var he=S.length,we=4==Bn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){br(this),ti(this);var Xe="";break t}this.h.i=new c.TextDecoder}for(m=0;m<he;m++)this.h.h=!0,a+=this.h.i.decode(S[m],{stream:!(we&&m==he-1)});S.length=0,this.h.g+=a,this.C=0,Xe=this.h.g}else Xe=this.g.oa();if(this.o=200==g,function ig(a,m,g,S,he,we,Xe){a.info(function(){return"XMLHTTP RESP ("+S+") [ attempt "+he+"]: "+m+"\n"+g+"\n"+we+" "+Xe})}(this.i,this.u,this.A,this.l,this.R,hn,g),this.o){if(this.T&&!this.K){t:{if(this.g){var Rt,tn=this.g;if((Rt=tn.g?tn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!dt(Rt)){var Et=Rt;break t}}Et=null}if(!(g=Et)){this.o=!1,this.s=3,_n(12),br(this),ti(this);break e}os(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,xc(this,g)}if(this.P){let bn;for(g=!0;!this.J&&this.C<Xe.length;){if(bn=lg(this,Xe),bn==yc){4==hn&&(this.s=4,_n(14),g=!1),os(this.i,this.l,null,"[Incomplete Response]");break}if(bn==s_){this.s=4,_n(15),os(this.i,this.l,Xe,"[Invalid Chunk]"),g=!1;break}os(this.i,this.l,bn,null),xc(this,bn)}if(o_(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=hn||0!=Xe.length||this.h.h||(this.s=1,_n(16),g=!1),this.o=this.o&&g,g){if(0<Xe.length&&!this.W){this.W=!0;var un=this.j;un.g==this&&un.ba&&!un.M&&(un.j.info("Great, no buffering proxy detected. Bytes received: "+Xe.length),Cc(un),un.M=!0,_n(11))}}else os(this.i,this.l,Xe,"[Invalid Chunked Response]"),br(this),ti(this)}else os(this.i,this.l,Xe,null),xc(this,Xe);4==hn&&br(this),this.o&&!this.J&&(4==hn?M_(this.j,this):(this.o=!1,go(this)))}else(function Eg(a){const m={};a=(a.g&&2<=Bn(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let S=0;S<a.length;S++){if(dt(a[S]))continue;var g=le(a[S]);const he=g[0];if("string"!=typeof(g=g[1]))continue;g=g.trim();const we=m[he]||[];m[he]=we,we.push(g)}!function ne(a,m){for(const g in a)m.call(void 0,a[g],g,a)}(m,function(S){return S.join(", ")})})(this.g),400==g&&0<Xe.indexOf("Unknown SID")?(this.s=3,_n(12)):(this.s=0,_n(13)),br(this),ti(this)}}}catch{}},tr.prototype.cancel=function(){this.J=!0,br(this)},tr.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(function og(a,m){a.info(function(){return"TIMEOUT: "+m})}(this.i,this.A),2!=this.L&&(Hs(),_n(17)),br(this),this.s=2,ti(this)):a_(this,this.S-a)};var cg=class{constructor(a,m){this.g=a,this.map=m}};function l_(a){this.l=a||10,a=c.PerformanceNavigationTiming?0<(a=c.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function c_(a){return!!a.h||!!a.g&&a.g.size>=a.j}function u_(a){return a.h?1:a.g?a.g.size:0}function Tc(a,m){return a.h?a.h==m:!!a.g&&a.g.has(m)}function bc(a,m){a.g?a.g.add(m):a.h=m}function h_(a,m){a.h&&a.h==m?a.h=null:a.g&&a.g.has(m)&&a.g.delete(m)}function d_(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let m=a.i;for(const g of a.g.values())m=m.concat(g.D);return m}return Le(a.i)}function __(a,m){if(a.forEach&&"function"==typeof a.forEach)a.forEach(m,void 0);else if(u(a)||"string"==typeof a)Array.prototype.forEach.call(a,m,void 0);else for(var g=function hg(a){if(a.na&&"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||"string"==typeof a){var m=[];a=a.length;for(var g=0;g<a;g++)m.push(g);return m}m=[],g=0;for(const S in a)m[g++]=S;return m}}}(a),S=function ug(a){if(a.V&&"function"==typeof a.V)return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(u(a)){for(var m=[],g=a.length,S=0;S<g;S++)m.push(a[S]);return m}for(S in m=[],g=0,a)m[g++]=a[S];return m}(a),he=S.length,we=0;we<he;we++)m.call(void 0,S[we],g&&g[we],a)}l_.prototype.cancel=function(){if(this.i=d_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var m_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ir(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Ir){this.h=a.h,yo(this,a.j),this.o=a.o,this.g=a.g,vo(this,a.s),this.l=a.l;var m=a.i,g=new si;g.i=m.i,m.g&&(g.g=new Map(m.g),g.h=m.h),f_(this,g),this.m=a.m}else a&&(m=String(a).match(m_))?(this.h=!1,yo(this,m[1]||"",!0),this.o=ni(m[2]||""),this.g=ni(m[3]||"",!0),vo(this,m[4]),this.l=ni(m[5]||"",!0),f_(this,m[6]||"",!0),this.m=ni(m[7]||"")):(this.h=!1,this.i=new si(null,this.h))}function jn(a){return new Ir(a)}function yo(a,m,g){a.j=g?ni(m,!0):m,a.j&&(a.j=a.j.replace(/:$/,""))}function vo(a,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);a.s=m}else a.s=null}function f_(a,m,g){m instanceof si?(a.i=m,function yg(a,m){m&&!a.j&&(nr(a),a.i=null,a.g.forEach(function(g,S){var he=S.toLowerCase();S!=he&&(g_(this,S),v_(this,he,g))},a)),a.j=m}(a.i,a.h)):(g||(m=ri(m,pg)),a.i=new si(m,a.h))}function Mt(a,m,g){a.i.set(m,g)}function wo(a){return Mt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ni(a,m){return a?m?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ri(a,m,g){return"string"==typeof a?(a=encodeURI(a).replace(m,_g),g&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function _g(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ir.prototype.toString=function(){var a=[],m=this.j;m&&a.push(ri(m,p_,!0),":");var g=this.g;return(g||"file"==m)&&(a.push("//"),(m=this.o)&&a.push(ri(m,p_,!0),"@"),a.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(g=this.s)&&a.push(":",String(g))),(g=this.l)&&(this.g&&"/"!=g.charAt(0)&&a.push("/"),a.push(ri(g,"/"==g.charAt(0)?fg:mg,!0))),(g=this.i.toString())&&a.push("?",g),(g=this.m)&&a.push("#",ri(g,gg)),a.join("")};var p_=/[#\/\?@]/g,mg=/[#\?:]/g,fg=/[#\?]/g,pg=/[#\?@]/g,gg=/#/g;function si(a,m){this.h=this.g=null,this.i=a||null,this.j=!!m}function nr(a){a.g||(a.g=new Map,a.h=0,a.i&&function dg(a,m){if(a){a=a.split("&");for(var g=0;g<a.length;g++){var S=a[g].indexOf("="),he=null;if(0<=S){var we=a[g].substring(0,S);he=a[g].substring(S+1)}else we=a[g];m(we,he?decodeURIComponent(he.replace(/\+/g," ")):"")}}}(a.i,function(m,g){a.add(decodeURIComponent(m.replace(/\+/g," ")),g)}))}function g_(a,m){nr(a),m=as(a,m),a.g.has(m)&&(a.i=null,a.h-=a.g.get(m).length,a.g.delete(m))}function y_(a,m){return nr(a),m=as(a,m),a.g.has(m)}function v_(a,m,g){g_(a,m),0<g.length&&(a.i=null,a.g.set(as(a,m),Le(g)),a.h+=g.length)}function as(a,m){return m=String(m),a.j&&(m=m.toLowerCase()),m}function rr(a,m,g,S,he){try{he&&(he.onload=null,he.onerror=null,he.onabort=null,he.ontimeout=null),S(g)}catch{}}function xg(){this.g=new rg}function Tg(a,m,g){const S=g||"";try{__(a,function(he,we){let Xe=he;f(he)&&(Xe=_c(he)),m.push(S+we+"="+encodeURIComponent(Xe))})}catch(he){throw m.push(S+"type="+encodeURIComponent("_badmap")),he}}function ii(a){this.l=a.Ub||null,this.j=a.eb||!1}function xo(a,m){cn.call(this),this.D=a,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function w_(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function oi(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ai(a)}function ai(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function x_(a){let m="";return vt(a,function(g,S){m+=S,m+=":",m+=g,m+="\r\n"}),m}function Ic(a,m,g){e:{for(S in g){var S=!1;break e}S=!0}S||(g=x_(g),"string"==typeof a?null!=g&&encodeURIComponent(String(g)):Mt(a,m,g))}function jt(a){cn.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=si.prototype).add=function(a,m){nr(this),this.i=null,a=as(this,a);var g=this.g.get(a);return g||this.g.set(a,g=[]),g.push(m),this.h+=1,this},r.forEach=function(a,m){nr(this),this.g.forEach(function(g,S){g.forEach(function(he){a.call(m,he,S,this)},this)},this)},r.na=function(){nr(this);const a=Array.from(this.g.values()),m=Array.from(this.g.keys()),g=[];for(let S=0;S<m.length;S++){const he=a[S];for(let we=0;we<he.length;we++)g.push(m[S])}return g},r.V=function(a){nr(this);let m=[];if("string"==typeof a)y_(this,a)&&(m=m.concat(this.g.get(as(this,a))));else{a=Array.from(this.g.values());for(let g=0;g<a.length;g++)m=m.concat(a[g])}return m},r.set=function(a,m){return nr(this),this.i=null,y_(this,a=as(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[m]),this.h+=1,this},r.get=function(a,m){return a&&0<(a=this.V(a)).length?String(a[0]):m},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],m=Array.from(this.g.keys());for(var g=0;g<m.length;g++){var S=m[g];const we=encodeURIComponent(String(S)),Xe=this.V(S);for(S=0;S<Xe.length;S++){var he=we;""!==Xe[S]&&(he+="="+encodeURIComponent(String(Xe[S]))),a.push(he)}}return this.i=a.join("&")},Pe(ii,mc),ii.prototype.g=function(){return new xo(this.l,this.j)},ii.prototype.i=function(a){return function(){return a}}({}),Pe(xo,cn),(r=xo.prototype).open=function(a,m){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=m,this.readyState=1,ai(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(m.body=a),(this.D||c).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,oi(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ai(this)),this.g&&(this.readyState=3,ai(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;w_(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var m=a.value?a.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!a.done}))&&(this.response=this.responseText+=m)}a.done?oi(this):ai(this),3==this.readyState&&w_(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,oi(this))},r.Qa=function(a){this.g&&(this.response=a,oi(this))},r.ga=function(){this.g&&oi(this)},r.setRequestHeader=function(a,m){this.u.append(a,m)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],m=this.h.entries();for(var g=m.next();!g.done;)a.push((g=g.value)[0]+": "+g[1]),g=m.next();return a.join("\r\n")},Object.defineProperty(xo.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),Pe(jt,cn);var bg=/^https?$/i,Ig=["POST","PUT"];function T_(a,m){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=m,a.m=5,b_(a),To(a)}function b_(a){a.A||(a.A=!0,dn(a,"complete"),dn(a,"error"))}function I_(a){if(a.h&&typeof o<"u"&&(!a.v[1]||4!=Bn(a)||2!=a.Z()))if(a.u&&4==Bn(a))Wd(a.Ea,0,a);else if(dn(a,"readystatechange"),4==Bn(a)){a.h=!1;try{const Xe=a.Z();e:switch(Xe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var g;if(!(g=m)){var S;if(S=0===Xe){var he=String(a.D).match(m_)[1]||null;!he&&c.self&&c.self.location&&(he=c.self.location.protocol.slice(0,-1)),S=!bg.test(he?he.toLowerCase():"")}g=S}if(g)dn(a,"complete"),dn(a,"success");else{a.m=6;try{var we=2<Bn(a)?a.g.statusText:""}catch{we=""}a.l=we+" ["+a.Z()+"]",b_(a)}}finally{To(a)}}}function To(a,m){if(a.g){E_(a);const g=a.g,S=a.v[0]?()=>{}:null;a.g=null,a.v=null,m||dn(a,"ready");try{g.onreadystatechange=S}catch{}}}function E_(a){a.I&&(c.clearTimeout(a.I),a.I=null)}function Bn(a){return a.g?a.g.readyState:0}function A_(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function li(a,m,g){return g&&g.internalChannelParams&&g.internalChannelParams[a]||m}function C_(a){this.Aa=0,this.i=[],this.j=new ei,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=li("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=li("baseRetryDelayMs",5e3,a),this.cb=li("retryDelaySeedMs",1e4,a),this.Wa=li("forwardChannelMaxRetries",2,a),this.wa=li("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new l_(a&&a.concurrentRequestLimit),this.Da=new xg,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Ec(a){if(S_(a),3==a.G){var m=a.U++,g=jn(a.I);if(Mt(g,"SID",a.K),Mt(g,"RID",m),Mt(g,"TYPE","terminate"),ci(a,g),(m=new tr(a,a.j,m)).L=2,m.v=wo(jn(g)),g=!1,c.navigator&&c.navigator.sendBeacon)try{g=c.navigator.sendBeacon(m.v.toString(),"")}catch{}!g&&c.Image&&((new Image).src=m.v,g=!0),g||(m.g=z_(m.j,null),m.g.ea(m.v)),m.F=Date.now(),go(m)}F_(a)}function bo(a){a.g&&(Cc(a),a.g.cancel(),a.g=null)}function S_(a){bo(a),a.u&&(c.clearTimeout(a.u),a.u=null),Eo(a),a.h.cancel(),a.s&&("number"==typeof a.s&&c.clearTimeout(a.s),a.s=null)}function Io(a){if(!c_(a.h)&&!a.s){a.s=!0;var m=a.Ga;Ws||Bd(),Ks||(Ws(),Ks=!0),sc.add(m,a),a.B=0}}function R_(a,m){var g;g=m?m.l:a.U++;const S=jn(a.I);Mt(S,"SID",a.K),Mt(S,"RID",g),Mt(S,"AID",a.T),ci(a,S),a.m&&a.o&&Ic(S,a.m,a.o),g=new tr(a,a.j,g,a.B+1),null===a.m&&(g.H=a.o),m&&(a.i=m.D.concat(a.i)),m=O_(a,g,1e3),g.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),bc(a.h,g),vc(g,S,m)}function ci(a,m){a.H&&vt(a.H,function(g,S){Mt(m,S,g)}),a.l&&__({},function(g,S){Mt(m,S,g)})}function O_(a,m,g){g=Math.min(a.i.length,g);var S=a.l?G(a.l.Na,a.l,a):null;e:{var he=a.i;let we=-1;for(;;){const Xe=["count="+g];-1==we?0<g?(we=he[0].g,Xe.push("ofs="+we)):we=0:Xe.push("ofs="+we);let Rt=!0;for(let tn=0;tn<g;tn++){let Et=he[tn].g;const un=he[tn].map;if(Et-=we,0>Et)we=Math.max(0,he[tn].g-100),Rt=!1;else try{Tg(un,Xe,"req"+Et+"_")}catch{S&&S(un)}}if(Rt){S=Xe.join("&");break e}}}return a=a.i.splice(0,g),m.D=a,S}function P_(a){if(!a.g&&!a.u){a.Y=1;var m=a.Fa;Ws||Bd(),Ks||(Ws(),Ks=!0),sc.add(m,a),a.v=0}}function Ac(a){return!(a.g||a.u||3<=a.v||(a.Y++,a.u=Zs(G(a.Fa,a),D_(a,a.v)),a.v++,0))}function Cc(a){null!=a.A&&(c.clearTimeout(a.A),a.A=null)}function k_(a){a.g=new tr(a,a.j,"rpc",a.Y),null===a.m&&(a.g.H=a.o),a.g.O=0;var m=jn(a.qa);Mt(m,"RID","rpc"),Mt(m,"SID",a.K),Mt(m,"AID",a.T),Mt(m,"CI",a.F?"0":"1"),!a.F&&a.ja&&Mt(m,"TO",a.ja),Mt(m,"TYPE","xmlhttp"),ci(a,m),a.m&&a.o&&Ic(m,a.m,a.o),a.L&&(a.g.I=a.L);var g=a.g;a=a.ia,g.L=1,g.v=wo(jn(m)),g.m=null,g.P=!0,i_(g,a)}function Eo(a){null!=a.C&&(c.clearTimeout(a.C),a.C=null)}function M_(a,m){var g=null;if(a.g==m){Eo(a),Cc(a),a.g=null;var S=2}else{if(!Tc(a.h,m))return;g=m.D,h_(a.h,m),S=1}if(0!=a.G)if(m.o)if(1==S){g=m.m?m.m.length:0,m=Date.now()-m.F;var he=a.B;dn(S=mo(),new t_(S,g)),Io(a)}else P_(a);else if(3==(he=m.s)||0==he&&0<m.X||!(1==S&&function Ag(a,m){return!(u_(a.h)>=a.h.j-(a.s?1:0)||(a.s?(a.i=m.D.concat(a.i),0):1==a.G||2==a.G||a.B>=(a.Va?0:a.Wa)||(a.s=Zs(G(a.Ga,a,m),D_(a,a.B)),a.B++,0)))}(a,m)||2==S&&Ac(a)))switch(g&&0<g.length&&(m=a.h,m.i=m.i.concat(g)),he){case 1:Er(a,5);break;case 4:Er(a,10);break;case 3:Er(a,6);break;default:Er(a,2)}}function D_(a,m){let g=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(g*=2),g*m}function Er(a,m){if(a.j.info("Error code "+m),2==m){var g=G(a.fb,a),S=a.Xa;const he=!S;S=new Ir(S||"//www.google.com/images/cleardot.gif"),c.location&&"http"==c.location.protocol||yo(S,"https"),wo(S),he?function vg(a,m){const g=new ei;if(c.Image){const S=new Image;S.onload=ue(rr,g,"TestLoadImage: loaded",!0,m,S),S.onerror=ue(rr,g,"TestLoadImage: error",!1,m,S),S.onabort=ue(rr,g,"TestLoadImage: abort",!1,m,S),S.ontimeout=ue(rr,g,"TestLoadImage: timeout",!1,m,S),c.setTimeout(function(){S.ontimeout&&S.ontimeout()},1e4),S.src=a}else m(!1)}(S.toString(),g):function wg(a,m){new ei;const S=new AbortController,he=setTimeout(()=>{S.abort(),rr(0,0,!1,m)},1e4);fetch(a,{signal:S.signal}).then(we=>{clearTimeout(he),rr(0,0,!!we.ok,m)}).catch(()=>{clearTimeout(he),rr(0,0,!1,m)})}(S.toString(),g)}else _n(2);a.G=0,a.l&&a.l.sa(m),F_(a),S_(a)}function F_(a){if(a.G=0,a.ka=[],a.l){const m=d_(a.h);(0!=m.length||0!=a.i.length)&&(Fe(a.ka,m),Fe(a.ka,a.i),a.h.i.length=0,Le(a.i),a.i.length=0),a.l.ra()}}function V_(a,m,g){var S=g instanceof Ir?jn(g):new Ir(g);if(""!=S.g)m&&(S.g=m+"."+S.g),vo(S,S.s);else{var he=c.location;S=he.protocol,m=m?m+"."+he.hostname:he.hostname,he=+he.port;var we=new Ir(null);S&&yo(we,S),m&&(we.g=m),he&&vo(we,he),g&&(we.l=g),S=we}return m=a.ya,(g=a.D)&&m&&Mt(S,g,m),Mt(S,"VER",a.la),ci(a,S),S}function z_(a,m,g){if(m&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(m=new jt(a.Ca&&!a.pa?new ii({eb:g}):a.pa)).Ha(a.J),m}function N_(){}function Ao(){}function vn(a,m){cn.call(this),this.g=new C_(m),this.l=a,this.h=m&&m.messageUrlParams||null,a=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(a?a["X-WebChannel-Content-Type"]=m.messageContentType:a={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(a?a["X-WebChannel-Client-Profile"]=m.va:a={"X-WebChannel-Client-Profile":m.va}),this.g.S=a,(a=m&&m.Sb)&&!dt(a)&&(this.g.m=a),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!dt(m)&&(this.g.D=m,null!==(a=this.h)&&m in a&&m in(a=this.h)&&delete a[m]),this.j=new ls(this)}function j_(a){fc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var m=a.__sm__;if(m){e:{for(const g in m){a=g;break e}a=void 0}(this.i=a)&&(a=this.i,m=null!==m&&a in m?m[a]:void 0),this.data=m}else this.data=a}function B_(){pc.call(this),this.status=1}function ls(a){this.g=a}(r=jt.prototype).Ha=function(a){this.J=a},r.ea=function(a,m,g,S){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);m=m?m.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gc.g(),this.v=function Xd(a){return a.h||(a.h=a.i())}(this.o?this.o:gc),this.g.onreadystatechange=G(this.Ea,this);try{this.B=!0,this.g.open(m,String(a),!0),this.B=!1}catch(we){return void T_(this,we)}if(a=g||"",g=new Map(this.headers),S)if(Object.getPrototypeOf(S)===Object.prototype)for(var he in S)g.set(he,S[he]);else{if("function"!=typeof S.keys||"function"!=typeof S.get)throw Error("Unknown input type for opt_headers: "+String(S));for(const we of S.keys())g.set(we,S.get(we))}S=Array.from(g.keys()).find(we=>"content-type"==we.toLowerCase()),he=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Ig,m,void 0))||S||he||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[we,Xe]of g)this.g.setRequestHeader(we,Xe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{E_(this),this.u=!0,this.g.send(a),this.u=!1}catch(we){T_(this,we)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,dn(this,"complete"),dn(this,"abort"),To(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),To(this,!0)),jt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?I_(this):this.bb())},r.bb=function(){I_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Bn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var m=this.g.responseText;return a&&0==m.indexOf(a)&&(m=m.substring(a.length)),ng(m)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=C_.prototype).la=8,r.G=1,r.connect=function(a,m,g,S){_n(0),this.W=a,this.H=m||{},g&&void 0!==S&&(this.H.OSID=g,this.H.OAID=S),this.F=this.X,this.I=V_(this,null,this.W),Io(this)},r.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const he=new tr(this,this.j,a);let we=this.o;if(this.S&&(we?(we=$(we),se(we,this.S)):we=this.S),null!==this.m||this.O||(he.H=we,we=null),this.P)e:{for(var m=0,g=0;g<this.i.length;g++){var S=this.i[g];if(void 0===(S="__data__"in S.map&&"string"==typeof(S=S.map.__data__)?S.length:void 0))break;if(4096<(m+=S)){m=g;break e}if(4096===m||g===this.i.length-1){m=g+1;break e}}m=1e3}else m=1e3;m=O_(this,he,m),Mt(g=jn(this.I),"RID",a),Mt(g,"CVER",22),this.D&&Mt(g,"X-HTTP-Session-Id",this.D),ci(this,g),we&&(this.O?m="headers="+encodeURIComponent(String(x_(we)))+"&"+m:this.m&&Ic(g,this.m,we)),bc(this.h,he),this.Ua&&Mt(g,"TYPE","init"),this.P?(Mt(g,"$req",m),Mt(g,"SID","null"),he.T=!0,vc(he,g,null)):vc(he,g,m),this.G=2}}else 3==this.G&&(a?R_(this,a):0==this.i.length||c_(this.h)||R_(this))},r.Fa=function(){if(this.u=null,k_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Zs(G(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,_n(10),bo(this),k_(this))},r.Za=function(){null!=this.C&&(this.C=null,bo(this),Ac(this),_n(19))},r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),_n(2)):(this.j.info("Failed to ping google.com"),_n(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=N_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Ao.prototype.g=function(a,m){return new vn(a,m)},Pe(vn,cn),vn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},vn.prototype.close=function(){Ec(this.g)},vn.prototype.o=function(a){var m=this.g;if("string"==typeof a){var g={};g.__data__=a,a=g}else this.u&&((g={}).__data__=_c(a),a=g);m.i.push(new cg(m.Ya++,a)),3==m.G&&Io(m)},vn.prototype.N=function(){this.g.l=null,delete this.j,Ec(this.g),delete this.g,vn.aa.N.call(this)},Pe(j_,fc),Pe(B_,pc),Pe(ls,N_),ls.prototype.ua=function(){dn(this.g,"a")},ls.prototype.ta=function(a){dn(this.g,new j_(a))},ls.prototype.sa=function(a){dn(this.g,new B_)},ls.prototype.ra=function(){dn(this.g,"b")},Ao.prototype.createWebChannel=Ao.prototype.g,vn.prototype.send=vn.prototype.o,vn.prototype.open=vn.prototype.m,vn.prototype.close=vn.prototype.close,be=v.createWebChannelTransport=function(){return new Ao},He=v.getStatEventTarget=function(){return mo()},Se=v.Event=Tr,Ve=v.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},fo.NO_ERROR=0,fo.TIMEOUT=8,fo.HTTP_ERROR=6,oe=v.ErrorCode=fo,n_.COMPLETE="complete",te=v.EventType=n_,Jd.EventType=Js,Js.OPEN="a",Js.CLOSE="b",Js.ERROR="c",Js.MESSAGE="d",cn.prototype.listen=cn.prototype.K,ee=v.WebChannel=Jd,v.FetchXmlHttpFactory=ii,jt.prototype.listenOnce=jt.prototype.L,jt.prototype.getLastError=jt.prototype.Ka,jt.prototype.getLastErrorCode=jt.prototype.Ba,jt.prototype.getStatus=jt.prototype.Z,jt.prototype.getResponseJson=jt.prototype.Oa,jt.prototype.getResponseText=jt.prototype.oa,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Ha,F=v.XhrIo=jt}).apply(typeof L<"u"?L:typeof self<"u"?self:typeof window<"u"?window:{});const ht="@firebase/firestore";class it{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}it.UNAUTHENTICATED=new it(null),it.GOOGLE_CREDENTIALS=new it("google-credentials-uid"),it.FIRST_PARTY=new it("first-party-uid"),it.MOCK_USER=new it("mock-user");let nt="11.0.2";const Re=new V.Vy("@firebase/firestore");function rt(){return Re.logLevel}function ae(r,...e){if(Re.logLevel<=V.$b.DEBUG){const t=e.map(We);Re.debug(`Firestore (${nt}): ${r}`,...t)}}function Qe(r,...e){if(Re.logLevel<=V.$b.ERROR){const t=e.map(We);Re.error(`Firestore (${nt}): ${r}`,...t)}}function ct(r,...e){if(Re.logLevel<=V.$b.WARN){const t=e.map(We);Re.warn(`Firestore (${nt}): ${r}`,...t)}}function We(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function ze(r="Unexpected state"){const e=`FIRESTORE (${nt}) INTERNAL ASSERTION FAILED: `+r;throw Qe(e),new Error(e)}function Ue(r,e){r||ze()}function Ne(r,e){return r}const J={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends R.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ut{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class et{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(it.UNAUTHENTICATED))}shutdown(){}}class Ce{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ye{constructor(e){this.t=e,this.currentUser=it.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;Ue(void 0===this.o);let s=this.i;const i=f=>this.i!==s?(s=this.i,t(f)):Promise.resolve();let o=new ut;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ut,e.enqueueRetryable(()=>i(this.currentUser))};const c=()=>{const f=o;e.enqueueRetryable((0,T.A)(function*(){yield f.promise,yield i(n.currentUser)}))},u=f=>{ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(f=>u(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?u(f):(ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ut)}},0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Ue("string"==typeof n.accessToken),new et(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ue(null===e||"string"==typeof e),new it(e)}}class st{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=it.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Je{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new st(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(it.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class xt{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ce{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Ue(void 0===this.o);const n=i=>{null!=i.error&&ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,ae("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const s=i=>{ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ue("string"==typeof t.token),this.R=t.token,new xt(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ye(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class M{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=ye(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[i]%62))}return n}}function P(r,e){return r<e?-1:r>e?1:0}function H(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}class Ke{static now(){return Ke.fromMillis(Date.now())}static fromDate(e){return Ke.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ke(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Z(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Z(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Z(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?P(this.nanoseconds,e.nanoseconds):P(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ke{static fromTimestamp(e){return new ke(e)}static min(){return new ke(new Ke(0,0))}static max(){return new ke(new Ke(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Oe{constructor(e,t,n){void 0===t?t=0:t>e.length&&ze(),void 0===n?n=e.length-t:n>e.length-t&&ze(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Oe.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Oe?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class xe extends Oe{construct(e,t,n){return new xe(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Z(J.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new xe(t)}static emptyPath(){return new xe([])}}const qe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class D extends Oe{construct(e,t,n){return new D(e,t,n)}static isValidIdentifier(e){return qe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),D.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new D(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Z(J.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;s<e.length;){const c=e[s];if("\\"===c){if(s+1===e.length)throw new Z(J.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Z(J.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,s+=2}else"`"===c?(o=!o,s++):"."!==c||o?(n+=c,s++):(i(),s++)}if(i(),o)throw new Z(J.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new D(t)}static emptyPath(){return new D([])}}class k{constructor(e){this.path=e}static fromPath(e){return new k(xe.fromString(e))}static fromName(e){return new k(xe.fromString(e).popFirst(5))}static empty(){return new k(xe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===xe.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return xe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new k(new xe(e.slice()))}}class me{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new me(ke.min(),k.empty(),-1)}static max(){return new me(ke.max(),k.empty(),-1)}}function pe(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=k.comparator(r.documentKey,e.documentKey),0!==t?t:P(r.largestBatchId,e.largestBatchId))}const Ie="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Te{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Ze(r){return tt.apply(this,arguments)}function tt(){return(tt=(0,T.A)(function*(r){if(r.code!==J.FAILED_PRECONDITION||r.message!==Ie)throw r;ae("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class W{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ze(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new W((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof W?t:W.resolve(t)}catch(t){return W.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):W.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):W.reject(t)}static resolve(e){return new W((t,n)=>{t(e)})}static reject(e){return new W((t,n)=>{n(e)})}static waitFor(e){return new W((t,n)=>{let s=0,i=0,o=!1;e.forEach(c=>{++s,c.next(()=>{++i,o&&i===s&&t()},u=>n(u))}),o=!0,i===s&&t()})}static or(e){let t=W.resolve(!1);for(const n of e)t=t.next(s=>s?W.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,i)=>{n.push(t.call(this,s,i))}),this.waitFor(n)}static mapArray(e,t){return new W((n,s)=>{const i=e.length,o=new Array(i);let c=0;for(let u=0;u<i;u++){const f=u;t(e[f]).next(y=>{o[f]=y,++c,c===i&&n(o)},y=>s(y))}})}static doWhile(e,t){return new W((n,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):n()};i()})}}function zt(r){return"IndexedDbTransactionError"===r.name}let Wt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function wn(r){return null==r}function fn(r){return 0===r&&1/r==-1/0}function Tn(r,e){let t=e;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function En(r){return r+"\x01\x01"}function Rc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Ln(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Pc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Ot{constructor(e,t){this.comparator=e,this.root=t||Ht.EMPTY}insert(e,t){return new Ot(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ht.BLACK,null,null))}remove(e){return new Ot(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ht.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new di(this.root,e,this.comparator,!1)}getReverseIterator(){return new di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new di(this.root,e,this.comparator,!0)}}class di{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ht{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Ht.RED,this.left=s??Ht.EMPTY,this.right=i??Ht.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Ht(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ht.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Ht.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ht.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ht.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ze();const e=this.left.check();if(e!==this.right.check())throw ze();return e+(this.isRed()?0:1)}}Ht.EMPTY=null,Ht.RED=!0,Ht.BLACK=!1,Ht.EMPTY=new class{constructor(){this.size=0}get key(){throw ze()}get value(){throw ze()}get color(){throw ze()}get left(){throw ze()}get right(){throw ze()}copy(e,t,n,s,i){return this}insert(e,t,n){return new Ht(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class At{constructor(e){this.comparator=e,this.data=new Ot(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new kc(this.data.getIterator())}getIteratorFrom(e){return new kc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class kc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class pn{constructor(e){this.fields=e,e.sort(D.comparator)}static empty(){return new pn([])}unionWith(e){let t=new At(D.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new pn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return H(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Mc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Nt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Mc("Invalid base64 string: "+i):i}}(e);return new Nt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Nt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return P(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Nt.EMPTY_BYTE_STRING=new Nt("");const L_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pn(r){if(Ue(!!r),"string"==typeof r){let e=0;const t=L_.exec(r);if(Ue(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Dt(r.seconds),nanos:Dt(r.nanos)}}function Dt(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function kn(r){return"string"==typeof r?Nt.fromBase64String(r):Nt.fromUint8Array(r)}function _i(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function mi(r){const e=r.mapValue.fields.__previous_value__;return _i(e)?mi(e):e}function us(r){const e=Pn(r.mapValue.fields.__local_write_time__.timestampValue);return new Ke(e.seconds,e.nanos)}class G_{constructor(e,t,n,s,i,o,c,u,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=f}}class ir{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ir("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ir&&e.projectId===this.projectId&&e.database===this.database}}const Gn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Un(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?_i(r)?4:Nc(r)?9007199254740991:yi(r)?10:11:ze()}function Cn(r,e){if(r===e)return!0;const t=Un(r);if(t!==Un(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return us(r).isEqual(us(e));case 3:return function(s,i){if("string"==typeof s.timestampValue&&"string"==typeof i.timestampValue&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Pn(s.timestampValue),c=Pn(i.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return i=e,kn(r.bytesValue).isEqual(kn(i.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,i){return Dt(s.geoPointValue.latitude)===Dt(i.geoPointValue.latitude)&&Dt(s.geoPointValue.longitude)===Dt(i.geoPointValue.longitude)}(r,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Dt(s.integerValue)===Dt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Dt(s.doubleValue),c=Dt(i.doubleValue);return o===c?fn(o)===fn(c):isNaN(o)&&isNaN(c)}return!1}(r,e);case 9:return H(r.arrayValue.values||[],e.arrayValue.values||[],Cn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},c=i.mapValue.fields||{};if(Rc(o)!==Rc(c))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===c[u]||!Cn(o[u],c[u])))return!1;return!0}(r,e);default:return ze()}var i}function hs(r,e){return void 0!==(r.values||[]).find(t=>Cn(t,e))}function $n(r,e){if(r===e)return 0;const t=Un(r),n=Un(e);if(t!==n)return P(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return P(r.booleanValue,e.booleanValue);case 2:return function(i,o){const c=Dt(i.integerValue||i.doubleValue),u=Dt(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,e);case 3:return Dc(r.timestampValue,e.timestampValue);case 4:return Dc(us(r),us(e));case 5:return P(r.stringValue,e.stringValue);case 6:return function(i,o){const c=kn(i),u=kn(o);return c.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const c=i.split("/"),u=o.split("/");for(let f=0;f<c.length&&f<u.length;f++){const y=P(c[f],u[f]);if(0!==y)return y}return P(c.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const c=P(Dt(i.latitude),Dt(o.latitude));return 0!==c?c:P(Dt(i.longitude),Dt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Fc(r.arrayValue,e.arrayValue);case 10:return function(i,o){var c,u,f,y;const ue=null===(c=(i.fields||{}).value)||void 0===c?void 0:c.arrayValue,Pe=null===(u=(o.fields||{}).value)||void 0===u?void 0:u.arrayValue,Le=P((null===(f=ue?.values)||void 0===f?void 0:f.length)||0,(null===(y=Pe?.values)||void 0===y?void 0:y.length)||0);return 0!==Le?Le:Fc(ue,Pe)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===Gn.mapValue&&o===Gn.mapValue)return 0;if(i===Gn.mapValue)return 1;if(o===Gn.mapValue)return-1;const c=i.fields||{},u=Object.keys(c),f=o.fields||{},y=Object.keys(f);u.sort(),y.sort();for(let C=0;C<u.length&&C<y.length;++C){const G=P(u[C],y[C]);if(0!==G)return G;const ue=$n(c[u[C]],f[y[C]]);if(0!==ue)return ue}return P(u.length,y.length)}(r.mapValue,e.mapValue);default:throw ze()}}function Dc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return P(r,e);const t=Pn(r),n=Pn(e),s=P(t.seconds,n.seconds);return 0!==s?s:P(t.nanos,n.nanos)}function Fc(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=$n(t[s],n[s]);if(i)return i}return P(t.length,n.length)}function Cr(r){return $o(r)}function $o(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Pn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?kn(r.bytesValue).toBase64():"referenceValue"in r?k.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=$o(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of n)i?i=!1:s+=",",s+=`${o}:${$o(t.fields[o])}`;return s+"}"}(r.mapValue):ze()}function pi(r){switch(Un(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=mi(r);return e?16+pi(e):16;case 5:return 2*r.stringValue.length;case 6:return kn(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(r.arrayValue.values||[]).reduce((s,i)=>s+pi(i),0);case 10:case 11:return function(n){let s=0;return Ln(n.fields,(i,o)=>{s+=i.length+pi(o)}),s}(r.mapValue);default:throw ze()}}function or(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function qo(r){return!!r&&"integerValue"in r}function ds(r){return!!r&&"arrayValue"in r}function Vc(r){return!!r&&"nullValue"in r}function zc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function gi(r){return!!r&&"mapValue"in r}function yi(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function _s(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Ln(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=_s(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=_s(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Nc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class Zt{constructor(e){this.value=e}static empty(){return new Zt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!gi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_s(t)}setAll(e){let t=D.emptyPath(),n={},s=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,n,s),n={},s=[],t=c.popLast()}o?n[c.lastSegment()]=_s(o):s.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());gi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Cn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];gi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Ln(t,(s,i)=>e[s]=i);for(const s of n)delete e[s]}clone(){return new Zt(_s(this.value))}}function Gc(r){const e=[];return Ln(r.fields,(t,n)=>{const s=new D([t]);if(gi(n)){const i=Gc(n.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new pn(e)}class kt{constructor(e,t,n,s,i,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=o,this.documentState=c}static newInvalidDocument(e){return new kt(e,0,ke.min(),ke.min(),ke.min(),Zt.empty(),0)}static newFoundDocument(e,t,n,s){return new kt(e,1,t,ke.min(),n,s,0)}static newNoDocument(e,t){return new kt(e,2,t,ke.min(),ke.min(),Zt.empty(),0)}static newUnknownDocument(e,t){return new kt(e,3,t,ke.min(),ke.min(),Zt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ke.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Zt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Zt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof kt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new kt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class qn{constructor(e,t){this.position=e,this.inclusive=t}}function Uc(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],o=r.position[s];if(n=i.field.isKeyField()?k.comparator(k.fromName(o.referenceValue),t.key):$n(o,t.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function $c(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Cn(r.position[t],e.position[t]))return!1;return!0}class ms{constructor(e,t="asc"){this.field=e,this.dir=t}}function q_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class qc{}class Tt extends qc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new W_(e,t,n):"array-contains"===t?new Y_(e,n):"in"===t?new Jc(e,n):"not-in"===t?new X_(e,n):"array-contains-any"===t?new J_(e,n):new Tt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new K_(e,n):new Q_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison($n(t,this.value)):null!==t&&Un(this.value)===Un(t)&&this.matchesComparison($n(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ze()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ct extends qc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ct(e,t)}matches(e){return Sr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Sr(r){return"and"===r.op}function Ko(r){return function Wc(r){for(const e of r.filters)if(e instanceof Ct)return!1;return!0}(r)&&Sr(r)}function Qo(r){if(r instanceof Tt)return r.field.canonicalString()+r.op.toString()+Cr(r.value);if(Ko(r))return r.filters.map(e=>Qo(e)).join(",");{const e=r.filters.map(t=>Qo(t)).join(",");return`${r.op}(${e})`}}function Kc(r,e){return r instanceof Tt?(n=r,(s=e)instanceof Tt&&n.op===s.op&&n.field.isEqual(s.field)&&Cn(n.value,s.value)):r instanceof Ct?function(n,s){return s instanceof Ct&&n.op===s.op&&n.filters.length===s.filters.length&&n.filters.reduce((i,o,c)=>i&&Kc(o,s.filters[c]),!0)}(r,e):void ze();var n,s}function Yc(r){return r instanceof Tt?`${(t=r).field.canonicalString()} ${t.op} ${Cr(t.value)}`:r instanceof Ct?function(t){return t.op.toString()+" {"+t.getFilters().map(Yc).join(" ,")+"}"}(r):"Filter";var t}class W_ extends Tt{constructor(e,t,n){super(e,t,n),this.key=k.fromName(n.referenceValue)}matches(e){const t=k.comparator(e.key,this.key);return this.matchesComparison(t)}}class K_ extends Tt{constructor(e,t){super(e,"in",t),this.keys=Xc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Q_ extends Tt{constructor(e,t){super(e,"not-in",t),this.keys=Xc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Xc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>k.fromName(n.referenceValue))}class Y_ extends Tt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ds(t)&&hs(t.arrayValue,this.value)}}class Jc extends Tt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&hs(this.value.arrayValue,t)}}class X_ extends Tt{constructor(e,t){super(e,"not-in",t)}matches(e){if(hs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!hs(this.value.arrayValue,t)}}class J_ extends Tt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ds(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>hs(this.value.arrayValue,n))}}class H_{constructor(e,t=null,n=[],s=[],i=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=o,this.endAt=c,this.ue=null}}function Yo(r,e=null,t=[],n=[],s=null,i=null,o=null){return new H_(r,e,t,n,s,i,o)}function ar(r){const e=Ne(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Qo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(i=n).field.canonicalString()+i.dir;var i}).join(","),wn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Cr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Cr(n)).join(",")),e.ue=t}return e.ue}function fs(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!q_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Kc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!$c(r.startAt,e.startAt)&&$c(r.endAt,e.endAt)}function vi(r){return k.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class Mn{constructor(e,t=null,n=[],s=[],i=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=o,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null}}function Rr(r){return new Mn(r)}function tu(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Xo(r){return null!==r.collectionGroup}function Or(r){const e=Ne(r);if(null===e.ce){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new At(D.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(f=>{f.isInequality()&&(c=c.add(f.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ms(i,n))}),t.has(D.keyField().canonicalString())||e.ce.push(new ms(D.keyField(),n))}return e.ce}function sn(r){const e=Ne(r);return e.le||(e.le=function ru(r,e){if("F"===r.limitType)return Yo(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>new ms(s.field,"desc"===s.dir?"asc":"desc"));const t=r.endAt?new qn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new qn(r.startAt.position,r.startAt.inclusive):null;return Yo(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Or(r))),e.le}function Jo(r,e){const t=r.filters.concat([e]);return new Mn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function xi(r,e,t){return new Mn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function ps(r,e){return fs(sn(r),sn(e))&&r.limitType===e.limitType}function su(r){return`${ar(sn(r))}|lt:${r.limitType}`}function Pr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>Yc(s)).join(", ")}]`),wn(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>{return`${(o=s).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Cr(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Cr(s)).join(",")),`Target(${n})`}(sn(r))}; limitType=${r.limitType})`}function gs(r,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return null!==n.collectionGroup?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):k.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,s){for(const i of Or(n))if(!i.field.isKeyField()&&null===s.data.field(i.field))return!1;return!0}(r,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,e)&&(s=e,!((n=r).startAt&&!function(o,c,u){const f=Uc(o,c,u);return o.inclusive?f<=0:f<0}(n.startAt,Or(n),s)||n.endAt&&!function(o,c,u){const f=Uc(o,c,u);return o.inclusive?f>=0:f>0}(n.endAt,Or(n),s)));var n,s}function ou(r){return(e,t)=>{let n=!1;for(const s of Or(r)){const i=Z_(s,e,t);if(0!==i)return i;n=n||s.field.isKeyField()}return 0}}function Z_(r,e,t){const n=r.field.isKeyField()?k.comparator(e.key,t.key):function(i,o,c){const u=o.data.field(i),f=c.data.field(i);return null!==u&&null!==f?$n(u,f):ze()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return ze()}}class Dn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,i]of n)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ln(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return Pc(this.inner)}size(){return this.innerSize}}const em=new Ot(k.comparator);function gn(){return em}const au=new Ot(k.comparator);function ys(...r){let e=au;for(const t of r)e=e.insert(t.key,t);return e}function lu(r){let e=au;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Sn(){return vs()}function cu(){return vs()}function vs(){return new Dn(r=>r.toString(),(r,e)=>r.isEqual(e))}const tm=new Ot(k.comparator),nm=new At(k.comparator);function yt(...r){let e=nm;for(const t of r)e=e.add(t);return e}const rm=new At(P);function Zo(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fn(e)?"-0":e}}function uu(r){return{integerValue:""+r}}function hu(r,e){return function In(r){return"number"==typeof r&&Number.isInteger(r)&&!fn(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?uu(e):Zo(r,e)}class Ti{constructor(){this._=void 0}}function sm(r,e,t){return r instanceof kr?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&_i(i)&&(i=mi(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):r instanceof lr?_u(r,e):r instanceof cr?mu(r,e):function(s,i){const o=du(s,i),c=fu(o)+fu(s.Pe);return qo(o)&&qo(s.Pe)?uu(c):Zo(s.serializer,c)}(r,e)}function im(r,e,t){return r instanceof lr?_u(r,e):r instanceof cr?mu(r,e):t}function du(r,e){return r instanceof Mr?qo(n=e)||(i=n)&&"doubleValue"in i?e:{integerValue:0}:null;var n,i}class kr extends Ti{}class lr extends Ti{constructor(e){super(),this.elements=e}}function _u(r,e){const t=pu(e);for(const n of r.elements)t.some(s=>Cn(s,n))||t.push(n);return{arrayValue:{values:t}}}class cr extends Ti{constructor(e){super(),this.elements=e}}function mu(r,e){let t=pu(e);for(const n of r.elements)t=t.filter(s=>!Cn(s,n));return{arrayValue:{values:t}}}class Mr extends Ti{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function fu(r){return Dt(r.integerValue||r.doubleValue)}function pu(r){return ds(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class am{constructor(e,t){this.version=e,this.transformResults=t}}class Ft{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ft}static exists(e){return new Ft(void 0,e)}static updateTime(e){return new Ft(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bi(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ii{}function gu(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Fr(r.key,Ft.none()):new Dr(r.key,r.data,Ft.none());{const t=r.data,n=Zt.empty();let s=new At(D.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?n.delete(i):n.set(i,o),s=s.add(i)}return new Fn(r.key,n,new pn(s.toArray()),Ft.none())}}function lm(r,e,t){r instanceof Dr?function(s,i,o){const c=s.value.clone(),u=wu(s.fieldTransforms,i,o.transformResults);c.setAll(u),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):r instanceof Fn?function(s,i,o){if(!bi(s.precondition,i))return void i.convertToUnknownDocument(o.version);const c=wu(s.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(vu(s)),u.setAll(c),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function xs(r,e,t,n){return r instanceof Dr?function(i,o,c,u){if(!bi(i.precondition,o))return c;const f=i.value.clone(),y=xu(i.fieldTransforms,u,o);return f.setAll(y),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null}(r,e,t,n):r instanceof Fn?function(i,o,c,u){if(!bi(i.precondition,o))return c;const f=xu(i.fieldTransforms,u,o),y=o.data;return y.setAll(vu(i)),y.setAll(f),o.convertToFoundDocument(o.version,y).setHasLocalMutations(),null===c?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(C=>C.field))}(r,e,t,n):(c=t,bi(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c);var o,c}function cm(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=du(n.transform,s||null);null!=i&&(null===t&&(t=Zt.empty()),t.set(n.field,i))}return t||null}function yu(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===s||n&&s&&H(n,s,(i,o)=>function om(r,e){return r.field.isEqual(e.field)&&(s=e.transform,(n=r.transform)instanceof lr&&s instanceof lr||n instanceof cr&&s instanceof cr?H(n.elements,s.elements,Cn):n instanceof Mr&&s instanceof Mr?Cn(n.Pe,s.Pe):n instanceof kr&&s instanceof kr);var n,s}(i,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,s}class Dr extends Ii{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Fn extends Ii{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function vu(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function wu(r,e,t){const n=new Map;Ue(r.length===t.length);for(let s=0;s<t.length;s++){const i=r[s],o=i.transform,c=e.data.field(i.field);n.set(i.field,im(o,c,t[s]))}return n}function xu(r,e,t){const n=new Map;for(const s of r){const i=s.transform,o=t.data.field(s.field);n.set(s.field,sm(i,o,e))}return n}class Fr extends Ii{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ea extends Ii{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ta{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&lm(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=xs(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=xs(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=cu();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let c=this.applyToLocalView(o,i.mutatedFields);c=t.has(s.key)?null:c;const u=gu(o,c);null!==u&&n.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(ke.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),yt())}isEqual(e){return this.batchId===e.batchId&&H(this.mutations,e.mutations,(t,n)=>yu(t,n))&&H(this.baseMutations,e.baseMutations,(t,n)=>yu(t,n))}}class na{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){Ue(e.mutations.length===n.length);let s=function(){return tm}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,n[o].version);return new na(e,t,n,s)}}class ra{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class um{constructor(e,t){this.count=e,this.unchangedNames=t}}var $t,bt;function Iu(r){if(void 0===r)return Qe("GRPC error has no .code"),J.UNKNOWN;switch(r){case $t.OK:return J.OK;case $t.CANCELLED:return J.CANCELLED;case $t.UNKNOWN:return J.UNKNOWN;case $t.DEADLINE_EXCEEDED:return J.DEADLINE_EXCEEDED;case $t.RESOURCE_EXHAUSTED:return J.RESOURCE_EXHAUSTED;case $t.INTERNAL:return J.INTERNAL;case $t.UNAVAILABLE:return J.UNAVAILABLE;case $t.UNAUTHENTICATED:return J.UNAUTHENTICATED;case $t.INVALID_ARGUMENT:return J.INVALID_ARGUMENT;case $t.NOT_FOUND:return J.NOT_FOUND;case $t.ALREADY_EXISTS:return J.ALREADY_EXISTS;case $t.PERMISSION_DENIED:return J.PERMISSION_DENIED;case $t.FAILED_PRECONDITION:return J.FAILED_PRECONDITION;case $t.ABORTED:return J.ABORTED;case $t.OUT_OF_RANGE:return J.OUT_OF_RANGE;case $t.UNIMPLEMENTED:return J.UNIMPLEMENTED;case $t.DATA_LOSS:return J.DATA_LOSS;default:return ze()}}(bt=$t||($t={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";const hm=new Y([4294967295,4294967295],0);function Au(r){const e=function Eu(){return new TextEncoder}().encode(r),t=new B;return t.update(e),new Uint8Array(t.digest())}function Cu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Y([t,n],0),new Y([s,i],0)]}class sa{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ts(`Invalid padding: ${t}`);if(n<0)throw new Ts(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Ts(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Ts(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=Y.fromNumber(this.Te)}Ee(e,t,n){let s=e.add(t.multiply(Y.fromNumber(n)));return 1===s.compare(hm)&&(s=new Y([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ie).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Au(e),[n,s]=Cu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new sa(i,s,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(0===this.Te)return;const t=Au(e),[n,s]=Cu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ts extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class bs{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,Is.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new bs(ke.min(),s,new Ot(P),gn(),yt())}}class Is{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Is(n,t,yt(),yt(),yt())}}class Ai{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class Su{constructor(e,t){this.targetId=e,this.me=t}}class Ru{constructor(e,t,n=Nt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Ou{constructor(){this.fe=0,this.ge=Pu(),this.pe=Nt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=yt(),t=yt(),n=yt();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:ze()}}),new Is(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Pu()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ue(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class dm{constructor(e){this.Le=e,this.Be=new Map,this.ke=gn(),this.qe=Ci(),this.Qe=Ci(),this.Ke=new Ot(P)}$e(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.je(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.De(e.resumeToken));break;default:ze()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.je(s)&&t(s)})}Je(e){const t=e.targetId,n=e.me.count,s=this.Ye(t);if(s){const i=s.target;if(vi(i))if(0===n){const o=new k(i.path);this.We(t,o,kt.newNoDocument(o,ke.min()))}else Ue(1===n);else{const o=this.Ze(t);if(o!==n){const c=this.Xe(e),u=c?this.et(c,e,o):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let o,c;try{o=kn(n).toUint8Array()}catch(u){if(u instanceof Mc)return ct("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new sa(o,s,i)}catch(u){return ct(u instanceof Ts?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===c.Te?null:c}et(e,t,n){return t.me.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(i=>{const o=this.Le.nt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.We(t,i,null),s++)}),s}it(e){const t=new Map;this.Be.forEach((i,o)=>{const c=this.Ye(o);if(c){if(i.current&&vi(c.target)){const u=new k(c.target.path);this.st(u).has(o)||this.ot(o,u)||this.We(o,u,kt.newNoDocument(u,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=yt();this.Qe.forEach((i,o)=>{let c=!0;o.forEachWhile(u=>{const f=this.Ye(u);return!f||"TargetPurposeLimboResolution"===f.purpose||(c=!1,!1)}),c&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new bs(e,t,this.Ke,this.ke,n);return this.ke=gn(),this.qe=Ci(),this.Qe=Ci(),this.Ke=new Ot(P),s}Ue(e,t){if(!this.je(e))return;const n=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const s=this.ze(e);this.ot(e,t)?s.Fe(t,1):s.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Be.get(e);return t||(t=new Ou,this.Be.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new At(P),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new At(P),this.qe=this.qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||ae("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ut(e)}He(e){this.Be.set(e,new Ou),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Ci(){return new Ot(k.comparator)}function Pu(){return new Ot(k.comparator)}const _m={asc:"ASCENDING",desc:"DESCENDING"},mm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fm={and:"AND",or:"OR"};class pm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ia(r,e){return r.useProto3Json||wn(e)?e:{value:e}}function Vr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ku(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function gm(r,e){return Vr(r,e.toTimestamp())}function Gt(r){return Ue(!!r),ke.fromTimestamp(function(t){const n=Pn(t);return new Ke(n.seconds,n.nanos)}(r))}function oa(r,e){return aa(r,e).canonicalString()}function aa(r,e){const t=(s=r,new xe(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===e?t:t.child(e)}function Mu(r){const e=xe.fromString(r);return Ue($u(e)),e}function Es(r,e){return oa(r.databaseId,e.path)}function Rn(r,e){const t=Mu(e);if(t.get(1)!==r.databaseId.projectId)throw new Z(J.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new Z(J.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new k(Vu(t))}function Du(r,e){return oa(r.databaseId,e)}function la(r){return new xe(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Vu(r){return Ue(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function zu(r,e,t){return{name:Es(r,e),fields:t.value.mapValue.fields}}function ju(r,e){return{documents:[Du(r,e.path)]}}function Si(r,e){const t={structuredQuery:{}},n=e.path;let s;null!==e.collectionGroup?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Du(r,s);const i=function(f){if(0!==f.length)return Uu(Ct.create(f,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(f){if(0!==f.length)return f.map(y=>{return{field:Wn((G=y).field),direction:Tm(G.dir)};var G})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=ia(r,e.limit);return null!==c&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt={before:(f=e.startAt).inclusive,values:f.position}),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{ct:t,parent:s};var f}function Lu(r){let e=function Fu(r){const e=Mu(r);return 4===e.length?xe.emptyPath():Vu(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){Ue(1===n);const y=t.from[0];y.allDescendants?s=y.collectionId:e=e.child(y.collectionId)}let i=[];t.where&&(i=function(C){const G=Gu(C);return G instanceof Ct&&Ko(G)?G.getFilters():[G]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(G=>{return new ms(zr((Pe=G).field),function(Fe){switch(Fe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Pe.direction));var Pe}));let c=null;t.limit&&(c=function(C){let G;return G="object"==typeof C?C.value:C,wn(G)?null:G}(t.limit));let u=null;var C;t.startAt&&(u=new qn((C=t.startAt).values||[],!!C.before));let f=null;return t.endAt&&(f=function(C){return new qn(C.values||[],!C.before)}(t.endAt)),function eu(r,e,t,n,s,i,o,c){return new Mn(r,e,t,n,s,i,o,c)}(e,s,o,i,c,"F",u,f)}function Gu(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=zr(t.unaryFilter.field);return Tt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=zr(t.unaryFilter.field);return Tt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=zr(t.unaryFilter.field);return Tt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=zr(t.unaryFilter.field);return Tt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ze()}}(r):void 0!==r.fieldFilter?Tt.create(zr((t=r).fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ze()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return Ct.create(t.compositeFilter.filters.map(n=>Gu(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ze()}}(t.compositeFilter.op))}(r):ze();var t}function Tm(r){return _m[r]}function bm(r){return mm[r]}function Im(r){return fm[r]}function Wn(r){return{fieldPath:r.canonicalString()}}function zr(r){return D.fromServerFormat(r.fieldPath)}function Uu(r){return r instanceof Tt?function(t){if("=="===t.op){if(zc(t.value))return{unaryFilter:{field:Wn(t.field),op:"IS_NAN"}};if(Vc(t.value))return{unaryFilter:{field:Wn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(zc(t.value))return{unaryFilter:{field:Wn(t.field),op:"IS_NOT_NAN"}};if(Vc(t.value))return{unaryFilter:{field:Wn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wn(t.field),op:bm(t.op),value:t.value}}}(r):r instanceof Ct?function(t){const n=t.getFilters().map(s=>Uu(s));return 1===n.length?n[0]:{compositeFilter:{op:Im(t.op),filters:n}}}(r):ze()}function Em(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function $u(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class Vn{constructor(e,t,n,s,i=ke.min(),o=ke.min(),c=Nt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new Vn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Vn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Vn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Vn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class qu{constructor(e){this.ht=e}}function ua(r){const e=Lu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?xi(e,e.limit,"L"):e}class _r{constructor(){}Et(e,t){this.dt(e,t),t.At()}dt(e,t){if("nullValue"in e)this.Rt(t,5);else if("booleanValue"in e)this.Rt(t,10),t.Vt(e.booleanValue?1:0);else if("integerValue"in e)this.Rt(t,15),t.Vt(Dt(e.integerValue));else if("doubleValue"in e){const n=Dt(e.doubleValue);isNaN(n)?this.Rt(t,13):(this.Rt(t,15),fn(n)?t.Vt(0):t.Vt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Rt(t,20),"string"==typeof n&&(n=Pn(n)),t.ft(`${n.seconds||""}`),t.Vt(n.nanos||0)}else if("stringValue"in e)this.gt(e.stringValue,t),this.yt(t);else if("bytesValue"in e)this.Rt(t,30),t.wt(kn(e.bytesValue)),this.yt(t);else if("referenceValue"in e)this.St(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Rt(t,45),t.Vt(n.latitude||0),t.Vt(n.longitude||0)}else"mapValue"in e?Nc(e)?this.Rt(t,Number.MAX_SAFE_INTEGER):yi(e)?this.bt(e.mapValue,t):(this.Dt(e.mapValue,t),this.yt(t)):"arrayValue"in e?(this.vt(e.arrayValue,t),this.yt(t)):ze()}gt(e,t){this.Rt(t,25),this.Ct(e,t)}Ct(e,t){t.ft(e)}Dt(e,t){const n=e.fields||{};this.Rt(t,55);for(const s of Object.keys(n))this.gt(s,t),this.dt(n[s],t)}bt(e,t){var n,s;const i=e.fields||{};this.Rt(t,53);const o="value",c=(null===(s=null===(n=i[o].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.Rt(t,15),t.Vt(Dt(c)),this.gt(o,t),this.dt(i[o],t)}vt(e,t){const n=e.values||[];this.Rt(t,50);for(const s of n)this.dt(s,t)}St(e,t){this.Rt(t,37),k.fromName(e).path.forEach(n=>{this.Rt(t,60),this.Ct(n,t)})}Rt(e,t){e.Vt(t)}yt(e){e.Vt(2)}}_r.Ft=new _r;class Dm{constructor(){this.ln=new pa}addToCollectionParentIndex(e,t){return this.ln.add(t),W.resolve()}getCollectionParents(e,t){return W.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return W.resolve()}deleteFieldIndex(e,t){return W.resolve()}deleteAllFieldIndexes(e){return W.resolve()}createTargetIndexes(e,t){return W.resolve()}getDocumentsMatchingTarget(e,t){return W.resolve(null)}getIndexType(e,t){return W.resolve(0)}getFieldIndexes(e,t){return W.resolve([])}getNextCollectionGroupToUpdate(e){return W.resolve(null)}getMinOffset(e,t){return W.resolve(me.min())}getMinOffsetFromCollectionGroup(e,t){return W.resolve(me.min())}updateCollectionGroup(e,t,n){return W.resolve()}updateIndexEntries(e,t){return W.resolve()}}class pa{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new At(xe.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new At(xe.comparator)).toArray()}}new Uint8Array(0);const oh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class on{static withCacheSize(e){return new on(e,on.DEFAULT_COLLECTION_PERCENTILE,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}on.DEFAULT_COLLECTION_PERCENTILE=10,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,on.DEFAULT=new on(41943040,on.DEFAULT_COLLECTION_PERCENTILE,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),on.DISABLED=new on(-1,0,0);class fr{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new fr(0)}static Qn(){return new fr(-1)}}function hh([r,e],[t,n]){const s=P(r,t);return 0===s?P(e,n):s}class zm{constructor(e){this.Gn=e,this.buffer=new At(hh),this.zn=0}jn(){return++this.zn}Hn(e){const t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();hh(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class dh{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return null!==this.Jn}Yn(e){var t=this;ae("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,T.A)(function*(){t.Jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){zt(n)?ae("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Ze(n)}yield t.Yn(3e5)}))}}class Nm{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return W.resolve(Wt.oe);const n=new zm(t);return this.Zn.forEachTarget(e,s=>n.Hn(s.sequenceNumber)).next(()=>this.Zn.er(e,s=>n.Hn(s))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Zn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ae("LruGarbageCollector","Garbage collection skipped; disabled"),W.resolve(oh)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oh):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let n,s,i,o,c,u,f;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(C=>(C>this.params.maximumSequenceNumbersToCollect?(ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${C}`),s=this.params.maximumSequenceNumbersToCollect):s=C,o=Date.now(),this.nthSequenceNumber(e,s))).next(C=>(n=C,c=Date.now(),this.removeTargets(e,n,t))).next(C=>(i=C,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(C=>(f=Date.now(),rt()<=V.$b.DEBUG&&ae("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-y}ms\n\tDetermined least recently used ${s} in `+(c-o)+`ms\n\tRemoved ${i} targets in `+(u-c)+`ms\n\tRemoved ${C} documents in `+(f-u)+`ms\nTotal Duration: ${f-y}ms`),W.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:C})))}}class mh{constructor(){this.changes=new Dn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,kt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?W.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Gm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class vh{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==n&&xs(n.mutation,s,pn.empty(),Ke.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,yt()).next(()=>n))}getLocalViewOfDocuments(e,t,n=yt()){const s=Sn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(i=>{let o=ys();return i.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=Sn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,yt()))}populateOverlays(e,t,n){const s=[];return n.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,s){let i=gn();const o=vs(),c=vs();return t.forEach((u,f)=>{const y=n.get(f.key);s.has(f.key)&&(void 0===y||y.mutation instanceof Fn)?i=i.insert(f.key,f):void 0!==y?(o.set(f.key,y.mutation.getFieldMask()),xs(y.mutation,f,y.mutation.getFieldMask(),Ke.now())):o.set(f.key,pn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((f,y)=>o.set(f,y)),t.forEach((f,y)=>{var C;return c.set(f,new Gm(y,null!==(C=o.get(f))&&void 0!==C?C:null))}),c))}recalculateAndSaveOverlays(e,t){const n=vs();let s=new Ot((o,c)=>o-c),i=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const c of o)c.keys().forEach(u=>{const f=t.get(u);if(null===f)return;let y=n.get(u)||pn.empty();y=c.applyToLocalView(f,y),n.set(u,y);const C=(s.get(c.batchId)||yt()).add(u);s=s.insert(c.batchId,C)})}).next(()=>{const o=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),f=u.key,y=u.value,C=cu();y.forEach(G=>{if(!i.has(G)){const ue=gu(t.get(G),n.get(G));null!==ue&&C.set(G,ue),i=i.add(G)}}),o.push(this.documentOverlayCache.saveOverlays(e,f,C))}return W.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return k.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Xo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var o}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):W.resolve(Sn());let c=-1,u=i;return o.next(f=>W.forEach(f,(y,C)=>(c<C.largestBatchId&&(c=C.largestBatchId),i.get(y)?W.resolve():this.remoteDocumentCache.getEntry(e,y).next(G=>{u=u.insert(y,G)}))).next(()=>this.populateOverlays(e,f,i)).next(()=>this.computeViews(e,u,f,yt())).next(y=>({batchId:c,changes:lu(y)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new k(t)).next(n=>{let s=ys();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let o=ys();return this.indexManager.getCollectionParents(e,i).next(c=>W.forEach(c,u=>{const f=(C=t,G=u.child(i),new Mn(G,null,C.explicitOrderBy.slice(),C.filters.slice(),C.limit,C.limitType,C.startAt,C.endAt));var C,G;return this.getDocumentsMatchingCollectionQuery(e,f,n,s).next(y=>{y.forEach((C,G)=>{o=o.insert(C,G)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(o=>{i.forEach((u,f)=>{const y=f.getKey();null===o.get(y)&&(o=o.insert(y,kt.newInvalidDocument(y)))});let c=ys();return o.forEach((u,f)=>{const y=i.get(u);void 0!==y&&xs(y.mutation,f,pn.empty(),Ke.now()),gs(t,f)&&(c=c.insert(u,f))}),c})}}class Um{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return W.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,{id:(s=t).id,version:s.version,createTime:Gt(s.createTime)}),W.resolve();var s}getNamedQuery(e,t){return W.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,{name:(s=t).name,query:ua(s.bundledQuery),readTime:Gt(s.readTime)}),W.resolve();var s}}class $m{constructor(){this.overlays=new Ot(k.comparator),this.Er=new Map}getOverlay(e,t){return W.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Sn();return W.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,i)=>{this.Tt(e,t,i)}),W.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Er.get(n);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Er.delete(n)),W.resolve()}getOverlaysForCollection(e,t,n){const s=Sn(),i=t.length+1,o=new k(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const u=c.getNext().value,f=u.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===i&&u.largestBatchId>n&&s.set(u.getKey(),u)}return W.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new Ot((f,y)=>f-y);const o=this.overlays.getIterator();for(;o.hasNext();){const f=o.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>n){let y=i.get(f.largestBatchId);null===y&&(y=Sn(),i=i.insert(f.largestBatchId,y)),y.set(f.getKey(),f)}}const c=Sn(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((f,y)=>c.set(f,y)),!(c.size()>=s)););return W.resolve(c)}Tt(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const o=this.Er.get(s.largestBatchId).delete(n.key);this.Er.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new ra(t,n));let i=this.Er.get(t);void 0===i&&(i=yt(),this.Er.set(t,i)),this.Er.set(t,i.add(n.key))}}class qm{constructor(){this.sessionToken=Nt.EMPTY_BYTE_STRING}getSessionToken(e){return W.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,W.resolve()}}class ga{constructor(){this.dr=new At(Yt.Ar),this.Rr=new At(Yt.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(e,t){const n=new Yt(e,t);this.dr=this.dr.add(n),this.Rr=this.Rr.add(n)}mr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.gr(new Yt(e,t))}pr(e,t){e.forEach(n=>this.removeReference(n,t))}yr(e){const t=new k(new xe([])),n=new Yt(t,e),s=new Yt(t,e+1),i=[];return this.Rr.forEachInRange([n,s],o=>{this.gr(o),i.push(o.key)}),i}wr(){this.dr.forEach(e=>this.gr(e))}gr(e){this.dr=this.dr.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const t=new k(new xe([])),n=new Yt(t,e),s=new Yt(t,e+1);let i=yt();return this.Rr.forEachInRange([n,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Yt(e,0),n=this.dr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Yt{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return k.comparator(e.key,t.key)||P(e.br,t.br)}static Vr(e,t){return P(e.br,t.br)||k.comparator(e.key,t.key)}}class Wm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new At(Yt.Ar)}checkEmpty(e){return W.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.Dr;this.Dr++;const o=new ta(i,t,n,s);this.mutationQueue.push(o);for(const c of s)this.vr=this.vr.add(new Yt(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return W.resolve(o)}lookupMutationBatch(e,t){return W.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.Fr(t+1),i=s<0?0:s;return W.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return W.resolve(0===this.mutationQueue.length?-1:this.Dr-1)}getAllMutationBatches(e){return W.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Yt(t,0),s=new Yt(t,Number.POSITIVE_INFINITY),i=[];return this.vr.forEachInRange([n,s],o=>{const c=this.Cr(o.br);i.push(c)}),W.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new At(P);return t.forEach(s=>{const i=new Yt(s,0),o=new Yt(s,Number.POSITIVE_INFINITY);this.vr.forEachInRange([i,o],c=>{n=n.add(c.br)})}),W.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;k.isDocumentKey(i)||(i=i.child(""));const o=new Yt(new k(i),0);let c=new At(P);return this.vr.forEachWhile(u=>{const f=u.key.path;return!!n.isPrefixOf(f)&&(f.length===s&&(c=c.add(u.br)),!0)},o),W.resolve(this.Mr(c))}Mr(e){const t=[];return e.forEach(n=>{const s=this.Cr(n);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){Ue(0===this.Or(t.batchId,"removed")),this.mutationQueue.shift();let n=this.vr;return W.forEach(t.mutations,s=>{const i=new Yt(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.vr=n})}Ln(e){}containsKey(e,t){const n=new Yt(t,0),s=this.vr.firstAfterOrEqual(n);return W.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return W.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Cr(e){const t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Km{constructor(e){this.Nr=e,this.docs=new Ot(k.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,o=this.Nr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return W.resolve(n?n.document.mutableCopy():kt.newInvalidDocument(t))}getEntries(e,t){let n=gn();return t.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():kt.newInvalidDocument(s))}),W.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=gn();const o=t.path,c=new k(o.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:f,value:{document:y}}=u.getNext();if(!o.isPrefixOf(f.path))break;f.path.length>o.length+1||pe(new me((r=y).readTime,r.key,-1),n)<=0||(s.has(y.key)||gs(t,y))&&(i=i.insert(y.key,y.mutableCopy()))}var r;return W.resolve(i)}getAllFromCollectionGroup(e,t,n,s){ze()}Lr(e,t){return W.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Qm(this)}getSize(e){return W.resolve(this.size)}}class Qm extends mh{constructor(e){super(),this.hr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.hr.addEntry(e,s)):this.hr.removeEntry(n)}),W.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}}class Ym{constructor(e){this.persistence=e,this.Br=new Dn(t=>ar(t),fs),this.lastRemoteSnapshotVersion=ke.min(),this.highestTargetId=0,this.kr=0,this.qr=new ga,this.targetCount=0,this.Qr=fr.qn()}forEachTarget(e,t){return this.Br.forEach((n,s)=>t(s)),W.resolve()}getLastRemoteSnapshotVersion(e){return W.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return W.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),W.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.kr&&(this.kr=t),W.resolve()}Un(e){this.Br.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Qr=new fr(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,W.resolve()}updateTargetData(e,t){return this.Un(t),W.resolve()}removeTargetData(e,t){return this.Br.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,W.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Br.forEach((o,c)=>{c.sequenceNumber<=t&&null===n.get(c.targetId)&&(this.Br.delete(o),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)}),W.waitFor(i).next(()=>s)}getTargetCount(e){return W.resolve(this.targetCount)}getTargetData(e,t){const n=this.Br.get(t)||null;return W.resolve(n)}addMatchingKeys(e,t,n){return this.qr.mr(t,n),W.resolve()}removeMatchingKeys(e,t,n){this.qr.pr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),W.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),W.resolve()}getMatchingKeysForTargetId(e,t){const n=this.qr.Sr(t);return W.resolve(n)}containsKey(e,t){return W.resolve(this.qr.containsKey(t))}}class ya{constructor(e,t){this.Kr={},this.overlays={},this.$r=new Wt(0),this.Ur=!1,this.Ur=!0,this.Wr=new qm,this.referenceDelegate=e(this),this.Gr=new Ym(this),this.indexManager=new Dm,this.remoteDocumentCache=new Km(n=>this.referenceDelegate.zr(n)),this.serializer=new qu(t),this.jr=new Um(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $m,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Kr[e.toKey()];return n||(n=new Wm(t,this.referenceDelegate),this.Kr[e.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,n){ae("MemoryPersistence","Starting transaction:",e);const s=new Xm(this.$r.next());return this.referenceDelegate.Hr(),n(s).next(i=>this.referenceDelegate.Jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Yr(e,t){return W.or(Object.values(this.Kr).map(n=>()=>n.containsKey(e,t)))}}class Xm extends Te{constructor(e){super(),this.currentSequenceNumber=e}}class Vi{constructor(e){this.persistence=e,this.Zr=new ga,this.Xr=null}static ei(e){return new Vi(e)}get ti(){if(this.Xr)return this.Xr;throw ze()}addReference(e,t,n){return this.Zr.addReference(n,t),this.ti.delete(n.toString()),W.resolve()}removeReference(e,t,n){return this.Zr.removeReference(n,t),this.ti.add(n.toString()),W.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),W.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(s=>this.ti.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.ti.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return W.forEach(this.ti,n=>{const s=k.fromPath(n);return this.ni(e,s).next(i=>{i||t.removeEntry(s,ke.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(n=>{n?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return W.or([()=>W.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}}class zi{constructor(e,t){this.persistence=e,this.ri=new Dn(n=>function Pt(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=En(e)),e=Tn(r.get(t),e);return En(e)}(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=function _h(r,e){return new Nm(r,e)}(this,t)}static ei(e,t){return new zi(e,t)}Hr(){}Jr(e){return W.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){const t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(s=>n+s))}nr(e){let t=0;return this.er(e,n=>{t++}).next(()=>t)}er(e,t){return W.forEach(this.ri,(n,s)=>this.ir(e,n,s).next(i=>i?W.resolve():t(s)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Lr(e,o=>this.ir(e,o,t).next(c=>{c||(n++,i.removeEntry(o,ke.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),W.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),W.resolve()}removeReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),W.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),W.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=pi(e.data.value)),t}ir(e,t,n){return W.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ri.get(t);return W.resolve(void 0!==s&&s>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Ta{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Wi=n,this.Gi=s}static zi(e,t){let n=yt(),s=yt();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Ta(e,t.fromCache,n,s)}}class Hm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class xh{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=(0,R.nr)()?8:function Kt(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,R.ZQ)())>0?6:4}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.Xi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.es(e,t,s,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Hm;return this.ts(e,t,o).next(c=>{if(i.result=c,this.Hi)return this.ns(e,t,o,c.size)})}).next(()=>i.result)}ns(e,t,n,s){return n.documentReadCount<this.Ji?(rt()<=V.$b.DEBUG&&ae("QueryEngine","SDK will not create cache indexes for query:",Pr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),W.resolve()):(rt()<=V.$b.DEBUG&&ae("QueryEngine","Query:",Pr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Yi*s?(rt()<=V.$b.DEBUG&&ae("QueryEngine","The SDK decides to create cache indexes for query:",Pr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sn(t))):W.resolve())}Xi(e,t){if(tu(t))return W.resolve(null);let n=sn(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=xi(t,null,"F"),n=sn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=yt(...i);return this.Zi.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{const f=this.rs(t,c);return this.ss(t,f,o,u.readTime)?this.Xi(e,xi(t,null,"F")):this.os(e,f,t,u)}))})))}es(e,t,n,s){return tu(t)||s.isEqual(ke.min())?W.resolve(null):this.Zi.getDocuments(e,n).next(i=>{const o=this.rs(t,i);return this.ss(t,o,n,s)?W.resolve(null):(rt()<=V.$b.DEBUG&&ae("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Pr(t)),this.os(e,o,t,function ie(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=ke.fromTimestamp(1e9===n?new Ke(t+1,0):new Ke(t,n));return new me(s,k.empty(),e)}(s,-1)).next(c=>c))})}rs(e,t){let n=new At(ou(e));return t.forEach((s,i)=>{gs(e,i)&&(n=n.add(i))}),n}ss(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ts(e,t,n){return rt()<=V.$b.DEBUG&&ae("QueryEngine","Using full collection scan to execute query:",Pr(t)),this.Zi.getDocumentsMatchingQuery(e,t,me.min(),n)}os(e,t,n,s){return this.Zi.getDocumentsMatchingQuery(e,n,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class Zm{constructor(e,t,n,s){this.persistence=e,this._s=t,this.serializer=s,this.us=new Ot(P),this.cs=new Dn(i=>ar(i),fs),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(n)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new vh(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}}function bh(r,e){return ba.apply(this,arguments)}function ba(){return(ba=(0,T.A)(function*(r,e){const t=Ne(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,t.Ps(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],c=[];let u=yt();for(const f of s){o.push(f.batchId);for(const y of f.mutations)u=u.add(y.key)}for(const f of i){c.push(f.batchId);for(const y of f.mutations)u=u.add(y.key)}return t.localDocuments.getDocuments(n,u).next(f=>({Ts:f,removedBatchIds:o,addedBatchIds:c}))})})})).apply(this,arguments)}function Ih(r){const e=Ne(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function nf(r,e){const t=Ne(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Ur(r,e,t){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,T.A)(function*(r,e,t){const n=Ne(r),s=n.us.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!zt(o))throw o;ae("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.us=n.us.remove(e),n.cs.delete(s.target)})).apply(this,arguments)}function ji(r,e,t){const n=Ne(r);let s=ke.min(),i=yt();return n.persistence.runTransaction("Execute query","readwrite",o=>function(u,f,y){const C=Ne(u),G=C.cs.get(y);return void 0!==G?W.resolve(C.us.get(G)):C.Gr.getTargetData(f,y)}(n,o,sn(e)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Gr.getMatchingKeysForTargetId(o,c.targetId).next(u=>{i=u})}).next(()=>n._s.getDocumentsMatchingQuery(o,e,t?s:ke.min(),t?i:yt())).next(c=>(function Sh(r,e,t){let n=r.ls.get(e)||ke.min();t.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.ls.set(e,n)}(n,function iu(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),c),{documents:c,ds:i})))}class Ra{constructor(){this.activeTargetIds=function Ho(){return rm}()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ph{constructor(){this._o=new Ra,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,n){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new Ra,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class of{uo(e){}shutdown(){}}class kh{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){ae("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){ae("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Gi=null;function Pa(){return null===Gi?Gi=268435456+Math.round(2147483648*Math.random()):Gi++,"0x"+Gi.toString(16)}const af={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lf{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}const an="WebChannelConnection";class cf extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Fo=n+"://"+t.host,this.Mo=`projects/${s}/databases/${i}`,this.xo="(default)"===this.databaseId.database?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Oo(t,n,s,i,o){const c=Pa(),u=this.No(t,n.toUriEncodedString());ae("RestConnection",`Sending RPC '${t}' ${c}:`,u,s);const f={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(f,i,o),this.Bo(t,u,f,s).then(y=>(ae("RestConnection",`Received RPC '${t}' ${c}: `,y),y),y=>{throw ct("RestConnection",`RPC '${t}' ${c} failed with error: `,y,"url: ",u,"request:",s),y})}ko(t,n,s,i,o,c){return this.Oo(t,n,s,i,o)}Lo(t,n,s){t["X-Goog-Api-Client"]="gl-js/ fire/"+nt,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}No(t,n){return`${this.Fo}/v1/${n}:${af[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Bo(e,t,n,s){const i=Pa();return new Promise((o,c)=>{const u=new F;u.setWithCredentials(!0),u.listenOnce(te.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case oe.NO_ERROR:const y=u.getResponseJson();ae(an,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(y)),o(y);break;case oe.TIMEOUT:ae(an,`RPC '${e}' ${i} timed out`),c(new Z(J.DEADLINE_EXCEEDED,"Request time out"));break;case oe.HTTP_ERROR:const C=u.getStatus();if(ae(an,`RPC '${e}' ${i} failed with status:`,C,"response text:",u.getResponseText()),C>0){let G=u.getResponseJson();Array.isArray(G)&&(G=G[0]);const ue=G?.error;if(ue&&ue.status&&ue.message){const Pe=function(Fe){const at=Fe.toLowerCase().replace(/_/g,"-");return Object.values(J).indexOf(at)>=0?at:J.UNKNOWN}(ue.status);c(new Z(Pe,ue.message))}else c(new Z(J.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new Z(J.UNAVAILABLE,"Connection failed."));break;default:ze()}}finally{ae(an,`RPC '${e}' ${i} completed.`)}});const f=JSON.stringify(s);ae(an,`RPC '${e}' ${i} sending request:`,s),u.send(t,"POST",f,n,15)})}qo(e,t,n){const s=Pa(),i=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=be(),c=He(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(u.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Lo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const y=i.join("");ae(an,`Creating RPC '${e}' stream ${s}: ${y}`,u);const C=o.createWebChannel(y,u);let G=!1,ue=!1;const Pe=new lf({Eo:Fe=>{ue?ae(an,`Not sending because RPC '${e}' stream ${s} is closed:`,Fe):(G||(ae(an,`Opening RPC '${e}' stream ${s} transport.`),C.open(),G=!0),ae(an,`RPC '${e}' stream ${s} sending:`,Fe),C.send(Fe))},Ao:()=>C.close()}),Le=(Fe,at,dt)=>{Fe.listen(at,lt=>{try{dt(lt)}catch(ft){setTimeout(()=>{throw ft},0)}})};return Le(C,ee.EventType.OPEN,()=>{ue||(ae(an,`RPC '${e}' stream ${s} transport opened.`),Pe.So())}),Le(C,ee.EventType.CLOSE,()=>{ue||(ue=!0,ae(an,`RPC '${e}' stream ${s} transport closed`),Pe.Do())}),Le(C,ee.EventType.ERROR,Fe=>{ue||(ue=!0,ct(an,`RPC '${e}' stream ${s} transport errored:`,Fe),Pe.Do(new Z(J.UNAVAILABLE,"The operation could not be completed")))}),Le(C,ee.EventType.MESSAGE,Fe=>{var at;if(!ue){const dt=Fe.data[0];Ue(!!dt);const lt=dt,ft=lt?.error||(null===(at=lt[0])||void 0===at?void 0:at.error);if(ft){ae(an,`RPC '${e}' stream ${s} received error:`,ft);const It=ft.status;let vt=function(X){const se=$t[X];if(void 0!==se)return Iu(se)}(It),ne=ft.message;void 0===vt&&(vt=J.INTERNAL,ne="Unknown error status: "+It+" with message "+ft.message),ue=!0,Pe.Do(new Z(vt,ne)),C.close()}else ae(an,`RPC '${e}' stream ${s} received:`,dt),Pe.vo(dt)}}),Le(c,Se.STAT_EVENT,Fe=>{Fe.stat===Ve.PROXY?ae(an,`RPC '${e}' stream ${s} detected buffering proxy`):Fe.stat===Ve.NOPROXY&&ae(an,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{Pe.bo()},0),Pe}}function Ui(){return typeof document<"u"?document:null}function Ds(r){return new pm(r,!0)}class ka{constructor(e,t,n=1e3,s=1.5,i=6e4){this.li=e,this.timerId=t,this.Qo=n,this.Ko=s,this.$o=i,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const t=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),s=Math.max(0,t-n);s>0&&ae("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,s,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){null!==this.Wo&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){null!==this.Wo&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}class Dh{constructor(e,t,n,s,i,o,c,u){this.li=e,this.Yo=n,this.Zo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new ka(e,t)}i_(){return 1===this.state||5===this.state||this.s_()}s_(){return 2===this.state||3===this.state}start(){this.n_=0,4!==this.state?this.auth():this.o_()}stop(){var e=this;return(0,T.A)(function*(){e.i_()&&(yield e.close(0))})()}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&null===this.e_&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}u_(){var e=this;return(0,T.A)(function*(){if(e.s_())return e.close(0)})()}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(e,t){var n=this;return(0,T.A)(function*(){n.l_(),n.h_(),n.r_.cancel(),n.Xo++,4!==e?n.r_.reset():t&&t.code===J.RESOURCE_EXHAUSTED?(Qe(t.toString()),Qe("Using maximum backoff delay to prevent overloading the backend."),n.r_.zo()):t&&t.code===J.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.P_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.po(t)})()}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Xo===t&&this.I_(n,s)},n=>{e(()=>{const s=new Z(J.UNKNOWN,"Fetching auth token failed: "+n.message);return this.E_(s)})})}I_(e,t){const n=this.T_(this.Xo);this.stream=this.d_(e,t),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(s=>{n(()=>this.E_(s))}),this.stream.onMessage(s=>{n(()=>1==++this.n_?this.A_(s):this.onNext(s))})}o_(){var e=this;this.state=5,this.r_.jo((0,T.A)(function*(){e.state=0,e.start()}))}E_(e){return ae("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(ae("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class uf extends Dh{constructor(e,t,n,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}d_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const t=function vm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:ze(),s=e.targetChange.targetIds||[],i=function(f,y){return f.useProto3Json?(Ue(void 0===y||"string"==typeof y),Nt.fromBase64String(y||"")):(Ue(void 0===y||y instanceof Buffer||y instanceof Uint8Array),Nt.fromUint8Array(y||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(f){const y=void 0===f.code?J.UNKNOWN:Iu(f.code);return new Z(y,f.message||"")}(o);t=new Ru(n,s,i,c||null)}else if("documentChange"in e){const n=e.documentChange,s=Rn(r,n.document.name),i=Gt(n.document.updateTime),o=n.document.createTime?Gt(n.document.createTime):ke.min(),c=new Zt({mapValue:{fields:n.document.fields}}),u=kt.newFoundDocument(s,i,o,c);t=new Ai(n.targetIds||[],n.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const n=e.documentDelete,s=Rn(r,n.document),i=n.readTime?Gt(n.readTime):ke.min(),o=kt.newNoDocument(s,i);t=new Ai([],n.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const n=e.documentRemove,s=Rn(r,n.document);t=new Ai([],n.removedTargetIds||[],s,null)}else{if(!("filter"in e))return ze();{const n=e.filter,{count:s=0,unchangedNames:i}=n,o=new um(s,i);t=new Su(n.targetId,o)}}var f;return t}(this.serializer,e),n=function(i){if(!("targetChange"in i))return ke.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ke.min():o.readTime?Gt(o.readTime):ke.min()}(e);return this.listener.R_(t,n)}V_(e){const t={};t.database=la(this.serializer),t.addTarget=function(i,o){let c;const u=o.target;if(c=vi(u)?{documents:ju(i,u)}:{query:Si(i,u).ct},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=ku(i,o.resumeToken);const f=ia(i,o.expectedCount);null!==f&&(c.expectedCount=f)}else if(o.snapshotVersion.compareTo(ke.min())>0){c.readTime=Vr(i,o.snapshotVersion.toTimestamp());const f=ia(i,o.expectedCount);null!==f&&(c.expectedCount=f)}return c}(this.serializer,e);const n=function xm(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ze()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.c_(t)}m_(e){const t={};t.database=la(this.serializer),t.removeTarget=e,this.c_(t)}}class hf extends Dh{constructor(e,t,n,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=i}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(e,t){return this.connection.qo("Write",e,t)}A_(e){return Ue(!!e.streamToken),this.lastStreamToken=e.streamToken,Ue(!e.writeResults||0===e.writeResults.length),this.listener.p_()}onNext(e){Ue(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const t=function wm(r,e){return r&&r.length>0?(Ue(void 0!==e),r.map(t=>function(s,i){let o=Gt(s.updateTime?s.updateTime:i);return o.isEqual(ke.min())&&(o=Gt(i)),new am(o,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Gt(e.commitTime);return this.listener.y_(n,t)}w_(){const e={};e.database=la(this.serializer),this.c_(e)}g_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function As(r,e){let t;if(e instanceof Dr)t={update:zu(r,e.key,e.value)};else if(e instanceof Fr)t={delete:Es(r,e.key)};else if(e instanceof Fn)t={update:zu(r,e.key,e.data),updateMask:Em(e.fieldMask)};else{if(!(e instanceof ea))return ze();t={verify:Es(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const c=o.transform;if(c instanceof kr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof lr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof cr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Mr)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw ze()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:gm(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:ze()),t;var i}(this.serializer,n))};this.c_(t)}}class df extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.S_=!1}b_(){if(this.S_)throw new Z(J.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,n,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Oo(e,aa(t,n),s,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Z(J.UNKNOWN,i.toString())})}ko(e,t,n,s,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.ko(e,aa(t,n),s,o,c,i)).catch(o=>{throw"FirebaseError"===o.name?(o.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Z(J.UNKNOWN,o.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class _f{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){0===this.D_&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){"Online"===this.state?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,"Online"===e&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(Qe(t),this.C_=!1):ae("OnlineStateTracker",t)}N_(){null!==this.v_&&(this.v_.cancel(),this.v_=null)}}class mf{constructor(e,t,n,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=i,this.Q_.uo(c=>{n.enqueueAndForget((0,T.A)(function*(){var u;Xn(o)&&(ae("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,T.A)(function*(y){const C=Ne(y);C.k_.add(4),yield $r(C),C.K_.set("Unknown"),C.k_.delete(4),yield Fs(C)}),function f(y){return u.apply(this,arguments)})(o))}))}),this.K_=new _f(n,s)}}function Fs(r){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,T.A)(function*(r){if(Xn(r))for(const e of r.q_)yield e(!0)})).apply(this,arguments)}function $r(r){return Da.apply(this,arguments)}function Da(){return(Da=(0,T.A)(function*(r){for(const e of r.q_)yield e(!1)})).apply(this,arguments)}function $i(r,e){const t=Ne(r);t.B_.has(e.targetId)||(t.B_.set(e.targetId,e),za(t)?Va(t):Kr(t).s_()&&Fa(t,e))}function qr(r,e){const t=Ne(r),n=Kr(t);t.B_.delete(e),n.s_()&&Fh(t,e),0===t.B_.size&&(n.s_()?n.a_():Xn(t)&&t.K_.set("Unknown"))}function Fa(r,e){if(r.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ke.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Kr(r).V_(e)}function Fh(r,e){r.U_.xe(e),Kr(r).m_(e)}function Va(r){r.U_=new dm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>r.B_.get(e)||null,nt:()=>r.datastore.serializer.databaseId}),Kr(r).start(),r.K_.F_()}function za(r){return Xn(r)&&!Kr(r).i_()&&r.B_.size>0}function Xn(r){return 0===Ne(r).k_.size}function Vh(r){r.U_=void 0}function ff(r){return Na.apply(this,arguments)}function Na(){return(Na=(0,T.A)(function*(r){r.K_.set("Online")})).apply(this,arguments)}function pf(r){return ja.apply(this,arguments)}function ja(){return(ja=(0,T.A)(function*(r){r.B_.forEach((e,t)=>{Fa(r,e)})})).apply(this,arguments)}function gf(r,e){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,T.A)(function*(r,e){Vh(r),za(r)?(r.K_.O_(e),Va(r)):r.K_.set("Unknown")})).apply(this,arguments)}function yf(r,e,t){return La.apply(this,arguments)}function La(){return La=(0,T.A)(function*(r,e,t){if(r.K_.set("Online"),e instanceof Ru&&2===e.state&&e.cause)try{yield(n=(0,T.A)(function*(i,o){const c=o.cause;for(const u of o.targetIds)i.B_.has(u)&&(yield i.remoteSyncer.rejectListen(u,c),i.B_.delete(u),i.U_.removeTarget(u))}),function s(i,o){return n.apply(this,arguments)})(r,e)}catch(n){ae("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield qi(r,n)}else if(e instanceof Ai?r.U_.$e(e):e instanceof Su?r.U_.Je(e):r.U_.Ge(e),!t.isEqual(ke.min()))try{const n=yield Ih(r.localStore);t.compareTo(n)>=0&&(yield function(i,o){const c=i.U_.it(o);return c.targetChanges.forEach((u,f)=>{if(u.resumeToken.approximateByteSize()>0){const y=i.B_.get(f);y&&i.B_.set(f,y.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,f)=>{const y=i.B_.get(u);if(!y)return;i.B_.set(u,y.withResumeToken(Nt.EMPTY_BYTE_STRING,y.snapshotVersion)),Fh(i,u);const C=new Vn(y.target,u,f,y.sequenceNumber);Fa(i,C)}),i.remoteSyncer.applyRemoteEvent(c)}(r,t))}catch(n){ae("RemoteStore","Failed to raise snapshot:",n),yield qi(r,n)}var n}),La.apply(this,arguments)}function qi(r,e,t){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,T.A)(function*(r,e,t){if(!zt(e))throw e;r.k_.add(1),yield $r(r),r.K_.set("Offline"),t||(t=()=>Ih(r.localStore)),r.asyncQueue.enqueueRetryable((0,T.A)(function*(){ae("RemoteStore","Retrying IndexedDB access"),yield t(),r.k_.delete(1),yield Fs(r)}))})).apply(this,arguments)}function zh(r,e){return e().catch(t=>qi(r,t,e))}function Wr(r){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,T.A)(function*(r){const e=Ne(r),t=Jn(e);let n=e.L_.length>0?e.L_[e.L_.length-1].batchId:-1;for(;vf(e);)try{const s=yield nf(e.localStore,n);if(null===s){0===e.L_.length&&t.a_();break}n=s.batchId,wf(e,s)}catch(s){yield qi(e,s)}Nh(e)&&jh(e)})).apply(this,arguments)}function vf(r){return Xn(r)&&r.L_.length<10}function wf(r,e){r.L_.push(e);const t=Jn(r);t.s_()&&t.f_&&t.g_(e.mutations)}function Nh(r){return Xn(r)&&!Jn(r).i_()&&r.L_.length>0}function jh(r){Jn(r).start()}function xf(r){return $a.apply(this,arguments)}function $a(){return($a=(0,T.A)(function*(r){Jn(r).w_()})).apply(this,arguments)}function Tf(r){return qa.apply(this,arguments)}function qa(){return(qa=(0,T.A)(function*(r){const e=Jn(r);for(const t of r.L_)e.g_(t.mutations)})).apply(this,arguments)}function bf(r,e,t){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,T.A)(function*(r,e,t){const n=r.L_.shift(),s=na.from(n,e,t);yield zh(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Wr(r)})).apply(this,arguments)}function If(r,e){return Ka.apply(this,arguments)}function Ka(){return Ka=(0,T.A)(function*(r,e){var t;e&&Jn(r).f_&&(yield(t=(0,T.A)(function*(s,i){if(function bu(r){switch(r){default:return ze();case J.CANCELLED:case J.UNKNOWN:case J.DEADLINE_EXCEEDED:case J.RESOURCE_EXHAUSTED:case J.INTERNAL:case J.UNAVAILABLE:case J.UNAUTHENTICATED:return!1;case J.INVALID_ARGUMENT:case J.NOT_FOUND:case J.ALREADY_EXISTS:case J.PERMISSION_DENIED:case J.FAILED_PRECONDITION:case J.ABORTED:case J.OUT_OF_RANGE:case J.UNIMPLEMENTED:case J.DATA_LOSS:return!0}}(c=i.code)&&c!==J.ABORTED){const o=s.L_.shift();Jn(s).__(),yield zh(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Wr(s)}var c}),function n(s,i){return t.apply(this,arguments)})(r,e)),Nh(r)&&jh(r)}),Ka.apply(this,arguments)}function Bh(r,e){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,T.A)(function*(r,e){const t=Ne(r);t.asyncQueue.verifyOperationInProgress(),ae("RemoteStore","RemoteStore received new credentials");const n=Xn(t);t.k_.add(3),yield $r(t),n&&t.K_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),yield Fs(t)})).apply(this,arguments)}function Ya(r,e){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,T.A)(function*(r,e){const t=Ne(r);e?(t.k_.delete(2),yield Fs(t)):e||(t.k_.add(2),yield $r(t),t.K_.set("Unknown"))})).apply(this,arguments)}function Kr(r){return r.W_||(r.W_=function(t,n,s){const i=Ne(t);return i.b_(),new uf(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Ro:ff.bind(null,r),mo:pf.bind(null,r),po:gf.bind(null,r),R_:yf.bind(null,r)}),r.q_.push(function(){var e=(0,T.A)(function*(t){t?(r.W_.__(),za(r)?Va(r):r.K_.set("Unknown")):(yield r.W_.stop(),Vh(r))});return function(t){return e.apply(this,arguments)}}())),r.W_}function Jn(r){return r.G_||(r.G_=function(t,n,s){const i=Ne(t);return i.b_(),new hf(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Ro:()=>Promise.resolve(),mo:xf.bind(null,r),po:If.bind(null,r),p_:Tf.bind(null,r),y_:bf.bind(null,r)}),r.q_.push(function(){var e=(0,T.A)(function*(t){t?(r.G_.__(),yield Wr(r)):(yield r.G_.stop(),r.L_.length>0&&(ae("RemoteStore",`Stopping write stream with ${r.L_.length} pending writes`),r.L_=[]))});return function(t){return e.apply(this,arguments)}}())),r.G_}class Ja{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new ut,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const o=Date.now()+n,c=new Ja(e,t,o,s,i);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Z(J.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qr(r,e){if(Qe("AsyncQueue",`${e}: ${r}`),zt(r))return new Z(J.UNAVAILABLE,`${e}: ${r}`);throw r}class Yr{static emptySet(e){return new Yr(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||k.comparator(t.key,n.key):(t,n)=>k.comparator(t.key,n.key),this.keyedMap=ys(),this.sortedSet=new Ot(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Yr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Yr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Lh{constructor(){this.z_=new Ot(k.comparator)}track(e){const t=e.doc.key,n=this.z_.get(t);n?0!==e.type&&3===n.type?this.z_=this.z_.insert(t,e):3===e.type&&1!==n.type?this.z_=this.z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.z_=this.z_.remove(t):1===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):ze():this.z_=this.z_.insert(t,e)}j_(){const e=[];return this.z_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Xr{constructor(e,t,n,s,i,o,c,u,f){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=f}static fromInitialDocuments(e,t,n,s,i){const o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new Xr(e,t,Yr.emptySet(t),o,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ps(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class Ef{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class Af{constructor(){this.queries=Gh(),this.onlineState="Unknown",this.X_=new Set}terminate(){!function(t,n){const s=Ne(t),i=s.queries;s.queries=Gh(),i.forEach((o,c)=>{for(const u of c.J_)u.onError(n)})}(this,new Z(J.ABORTED,"Firestore shutting down"))}}function Gh(){return new Dn(r=>su(r),ps)}function Ha(r,e){return Za.apply(this,arguments)}function Za(){return(Za=(0,T.A)(function*(r,e){const t=Ne(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.Y_()&&e.Z_()&&(n=2):(i=new Ef,n=e.Z_()?0:1);try{switch(n){case 0:i.H_=yield t.onListen(s,!0);break;case 1:i.H_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){const c=Qr(o,`Initialization of query '${Pr(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.J_.push(e),e.ea(t.onlineState),i.H_&&e.ta(i.H_)&&nl(t)})).apply(this,arguments)}function el(r,e){return tl.apply(this,arguments)}function tl(){return(tl=(0,T.A)(function*(r,e){const t=Ne(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const o=i.J_.indexOf(e);o>=0&&(i.J_.splice(o,1),0===i.J_.length?s=e.Z_()?0:1:!i.Y_()&&e.Z_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function Cf(r,e){const t=Ne(r);let n=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const c of o.J_)c.ta(s)&&(n=!0);o.H_=s}}n&&nl(t)}function Sf(r,e,t){const n=Ne(r),s=n.queries.get(e);if(s)for(const i of s.J_)i.onError(t);n.queries.delete(e)}function nl(r){r.X_.forEach(e=>{e.next()})}var rl,Uh;(Uh=rl||(rl={})).na="default",Uh.Cache="cache";class sl{constructor(e,t,n){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)3!==s.type&&n.push(s);e=new Xr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){return!e.fromCache||!this.Z_()||(!this.options.ua||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}oa(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}aa(e){e=Xr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==rl.Cache}}class Wh{constructor(e){this.key=e}}class Kh{constructor(e){this.key=e}}class Qh{constructor(e,t){this.query=e,this.da=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=yt(),this.mutatedKeys=yt(),this.Va=ou(e),this.ma=new Yr(this.Va)}get fa(){return this.da}ga(e,t){const n=t?t.pa:new Lh,s=t?t.ma:this.ma;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,c=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,f="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((y,C)=>{const G=s.get(y),ue=gs(this.query,C)?C:null,Pe=!!G&&this.mutatedKeys.has(G.key),Le=!!ue&&(ue.hasLocalMutations||this.mutatedKeys.has(ue.key)&&ue.hasCommittedMutations);let Fe=!1;G&&ue?G.data.isEqual(ue.data)?Pe!==Le&&(n.track({type:3,doc:ue}),Fe=!0):this.ya(G,ue)||(n.track({type:2,doc:ue}),Fe=!0,(u&&this.Va(ue,u)>0||f&&this.Va(ue,f)<0)&&(c=!0)):!G&&ue?(n.track({type:0,doc:ue}),Fe=!0):G&&!ue&&(n.track({type:1,doc:G}),Fe=!0,(u||f)&&(c=!0)),Fe&&(ue?(o=o.add(ue),i=Le?i.add(y):i.delete(y)):(o=o.delete(y),i=i.delete(y)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const y="F"===this.query.limitType?o.last():o.first();o=o.delete(y.key),i=i.delete(y.key),n.track({type:1,doc:y})}return{ma:o,pa:n,ss:c,mutatedKeys:i}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const o=e.pa.j_();o.sort((y,C)=>function(ue,Pe){const Le=Fe=>{switch(Fe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ze()}};return Le(ue)-Le(Pe)}(y.type,C.type)||this.Va(y.doc,C.doc)),this.wa(n),s=null!=s&&s;const c=t&&!s?this.Sa():[],u=0===this.Ra.size&&this.current&&!s?1:0,f=u!==this.Aa;return this.Aa=u,0!==o.length||f?{snapshot:new Xr(this.query,e.ma,i,o,e.mutatedKeys,0===u,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:c}:{ba:c}}ea(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ma:this.ma,pa:new Lh,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.da.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.da=this.da.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.da=this.da.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=yt(),this.ma.forEach(n=>{this.Da(n.key)&&(this.Ra=this.Ra.add(n.key))});const t=[];return e.forEach(n=>{this.Ra.has(n)||t.push(new Kh(n))}),this.Ra.forEach(n=>{e.has(n)||t.push(new Wh(n))}),t}va(e){this.da=e.ds,this.Ra=yt();const t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return Xr.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,0===this.Aa,this.hasCachedResults)}}class Pf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class kf{constructor(e){this.key=e,this.Fa=!1}}class Mf{constructor(e,t,n,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ma={},this.xa=new Dn(c=>su(c),ps),this.Oa=new Map,this.Na=new Set,this.La=new Ot(k.comparator),this.Ba=new Map,this.ka=new ga,this.qa={},this.Qa=new Map,this.Ka=fr.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return!0===this.$a}}function Df(r,e){return il.apply(this,arguments)}function il(){return(il=(0,T.A)(function*(r,e,t=!0){const n=Wi(r);let s;const i=n.xa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Ca()):s=yield Yh(n,e,t,!0),s})).apply(this,arguments)}function Ff(r,e){return ol.apply(this,arguments)}function ol(){return(ol=(0,T.A)(function*(r,e){const t=Wi(r);yield Yh(t,e,!0,!1)})).apply(this,arguments)}function Yh(r,e,t,n){return al.apply(this,arguments)}function al(){return(al=(0,T.A)(function*(r,e,t,n){const s=yield function Gr(r,e){const t=Ne(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Gr.getTargetData(n,e).next(i=>i?(s=i,W.resolve(s)):t.Gr.allocateTargetId(n).next(o=>(s=new Vn(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Gr.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.us.get(n.targetId);return(null===s||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.us=t.us.insert(n.targetId,n),t.cs.set(e,n.targetId)),n})}(r.localStore,sn(e)),i=s.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=yield function ll(r,e,t,n,s){return cl.apply(this,arguments)}(r,e,i,"current"===o,s.resumeToken)),r.isPrimaryClient&&t&&$i(r.remoteStore,s),c})).apply(this,arguments)}function cl(){return cl=(0,T.A)(function*(r,e,t,n,s){r.Ua=(C,G,ue)=>{return(Pe=(0,T.A)(function*(Fe,at,dt,lt){let ft=at.view.ga(dt);ft.ss&&(ft=yield ji(Fe.localStore,at.query,!1).then(({documents:$})=>at.view.ga($,ft)));const It=lt&&lt.targetChanges.get(at.targetId),vt=lt&&null!=lt.targetMismatches.get(at.targetId),ne=at.view.applyChanges(ft,Fe.isPrimaryClient,It,vt);return wl(Fe,at.targetId,ne.ba),ne.snapshot}),function Le(Fe,at,dt,lt){return Pe.apply(this,arguments)})(r,C,G,ue);var Pe};const i=yield ji(r.localStore,e,!0),o=new Qh(e,i.ds),c=o.ga(i.documents),u=Is.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,s),f=o.applyChanges(c,r.isPrimaryClient,u);wl(r,t,f.ba);const y=new Pf(e,t,o);return r.xa.set(e,y),r.Oa.has(t)?r.Oa.get(t).push(e):r.Oa.set(t,[e]),f.snapshot}),cl.apply(this,arguments)}function Vf(r,e,t){return ul.apply(this,arguments)}function ul(){return(ul=(0,T.A)(function*(r,e,t){const n=Ne(r),s=n.xa.get(e),i=n.Oa.get(s.targetId);if(i.length>1)return n.Oa.set(s.targetId,i.filter(o=>!ps(o,e))),void n.xa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Ur(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&qr(n.remoteStore,s.targetId),Jr(n,s.targetId)}).catch(Ze))):(Jr(n,s.targetId),yield Ur(n.localStore,s.targetId,!0))})).apply(this,arguments)}function zf(r,e){return hl.apply(this,arguments)}function hl(){return(hl=(0,T.A)(function*(r,e){const t=Ne(r),n=t.xa.get(e),s=t.Oa.get(n.targetId);t.isPrimaryClient&&1===s.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),qr(t.remoteStore,n.targetId))})).apply(this,arguments)}function dl(){return(dl=(0,T.A)(function*(r,e,t){const n=function Pl(r){const e=Ne(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Bf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Lf.bind(null,e),e}(r);try{const s=yield function(o,c){const u=Ne(o),f=Ke.now(),y=c.reduce((ue,Pe)=>ue.add(Pe.key),yt());let C,G;return u.persistence.runTransaction("Locally write mutations","readwrite",ue=>{let Pe=gn(),Le=yt();return u.hs.getEntries(ue,y).next(Fe=>{Pe=Fe,Pe.forEach((at,dt)=>{dt.isValidDocument()||(Le=Le.add(at))})}).next(()=>u.localDocuments.getOverlayedDocuments(ue,Pe)).next(Fe=>{C=Fe;const at=[];for(const dt of c){const lt=cm(dt,C.get(dt.key).overlayedDocument);null!=lt&&at.push(new Fn(dt.key,lt,Gc(lt.value.mapValue),Ft.exists(!0)))}return u.mutationQueue.addMutationBatch(ue,f,at,c)}).next(Fe=>{G=Fe;const at=Fe.applyToLocalDocumentSet(C,Le);return u.documentOverlayCache.saveOverlays(ue,Fe.batchId,at)})}).then(()=>({batchId:G.batchId,changes:lu(C)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,c,u){let f=o.qa[o.currentUser.toKey()];f||(f=new Ot(P)),f=f.insert(c,u),o.qa[o.currentUser.toKey()]=f}(n,s.batchId,t),yield zn(n,s.changes),yield Wr(n.remoteStore)}catch(s){const i=Qr(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function Xh(r,e){return _l.apply(this,arguments)}function _l(){return(_l=(0,T.A)(function*(r,e){const t=Ne(r);try{const n=yield function tf(r,e){const t=Ne(r),n=e.snapshotVersion;let s=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.hs.newChangeBuffer({trackRemovals:!0});s=t.us;const c=[];e.targetChanges.forEach((y,C)=>{const G=s.get(C);if(!G)return;c.push(t.Gr.removeMatchingKeys(i,y.removedDocuments,C).next(()=>t.Gr.addMatchingKeys(i,y.addedDocuments,C)));let ue=G.withSequenceNumber(i.currentSequenceNumber);var Le,Fe,at;null!==e.targetMismatches.get(C)?ue=ue.withResumeToken(Nt.EMPTY_BYTE_STRING,ke.min()).withLastLimboFreeSnapshotVersion(ke.min()):y.resumeToken.approximateByteSize()>0&&(ue=ue.withResumeToken(y.resumeToken,n)),s=s.insert(C,ue),Fe=ue,at=y,(0===(Le=G).resumeToken.approximateByteSize()||Fe.snapshotVersion.toMicroseconds()-Le.snapshotVersion.toMicroseconds()>=3e8||at.addedDocuments.size+at.modifiedDocuments.size+at.removedDocuments.size>0)&&c.push(t.Gr.updateTargetData(i,ue))});let u=gn(),f=yt();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,y))}),c.push(function Eh(r,e,t){let n=yt(),s=yt();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=gn();return t.forEach((c,u)=>{const f=i.get(c);u.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(ke.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!f.isValidDocument()||u.version.compareTo(f.version)>0||0===u.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):ae("LocalStore","Ignoring outdated watch update for ",c,". Current version:",f.version," Watch version:",u.version)}),{Is:o,Es:s}})}(i,o,e.documentUpdates).next(y=>{u=y.Is,f=y.Es})),!n.isEqual(ke.min())){const y=t.Gr.getLastRemoteSnapshotVersion(i).next(C=>t.Gr.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(y)}return W.waitFor(c).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,f)).next(()=>u)}).then(i=>(t.us=s,i))}(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Ba.get(i);o&&(Ue(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Fa=!0:s.modifiedDocuments.size>0?Ue(o.Fa):s.removedDocuments.size>0&&(Ue(o.Fa),o.Fa=!1))}),yield zn(t,n,e)}catch(n){yield Ze(n)}})).apply(this,arguments)}function Jh(r,e,t){const n=Ne(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const s=[];n.xa.forEach((i,o)=>{const c=o.view.ea(e);c.snapshot&&s.push(c.snapshot)}),function(o,c){const u=Ne(o);u.onlineState=c;let f=!1;u.queries.forEach((y,C)=>{for(const G of C.J_)G.ea(c)&&(f=!0)}),f&&nl(u)}(n.eventManager,e),s.length&&n.Ma.R_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function jf(r,e,t){return ml.apply(this,arguments)}function ml(){return(ml=(0,T.A)(function*(r,e,t){const n=Ne(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Ba.get(e),i=s&&s.key;if(i){let o=new Ot(k.comparator);o=o.insert(i,kt.newNoDocument(i,ke.min()));const c=yt().add(i),u=new bs(ke.min(),new Map,new Ot(P),o,c);yield Xh(n,u),n.La=n.La.remove(i),n.Ba.delete(e),xl(n)}else yield Ur(n.localStore,e,!1).then(()=>Jr(n,e,t)).catch(Ze)})).apply(this,arguments)}function Bf(r,e){return fl.apply(this,arguments)}function fl(){return(fl=(0,T.A)(function*(r,e){const t=Ne(r),n=e.batch.batchId;try{const s=yield function ef(r,e){const t=Ne(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),i=t.hs.newChangeBuffer({trackRemovals:!0});return function(c,u,f,y){const C=f.batch,G=C.keys();let ue=W.resolve();return G.forEach(Pe=>{ue=ue.next(()=>y.getEntry(u,Pe)).next(Le=>{const Fe=f.docVersions.get(Pe);Ue(null!==Fe),Le.version.compareTo(Fe)<0&&(C.applyToRemoteDocument(Le,f),Le.isValidDocument()&&(Le.setReadTime(f.commitVersion),y.addEntry(Le)))})}),ue.next(()=>c.mutationQueue.removeMutationBatch(u,C))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=yt();for(let f=0;f<c.mutationResults.length;++f)c.mutationResults[f].transformResults.length>0&&(u=u.add(c.batch.mutations[f].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}(t.localStore,e);vl(t,n,null),yl(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield zn(t,s)}catch(s){yield Ze(s)}})).apply(this,arguments)}function Lf(r,e,t){return pl.apply(this,arguments)}function pl(){return(pl=(0,T.A)(function*(r,e,t){const n=Ne(r);try{const s=yield function(o,c){const u=Ne(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let y;return u.mutationQueue.lookupMutationBatch(f,c).next(C=>(Ue(null!==C),y=C.keys(),u.mutationQueue.removeMutationBatch(f,C))).next(()=>u.mutationQueue.performConsistencyCheck(f)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(f,y,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,y)).next(()=>u.localDocuments.getDocuments(f,y))})}(n.localStore,e);vl(n,e,t),yl(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield zn(n,s)}catch(s){yield Ze(s)}})).apply(this,arguments)}function yl(r,e){(r.Qa.get(e)||[]).forEach(t=>{t.resolve()}),r.Qa.delete(e)}function vl(r,e,t){const n=Ne(r);let s=n.qa[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.qa[n.currentUser.toKey()]=s}}function Jr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Oa.get(e))r.xa.delete(n),t&&r.Ma.Wa(n,t);r.Oa.delete(e),r.isPrimaryClient&&r.ka.yr(e).forEach(n=>{r.ka.containsKey(n)||Hh(r,n)})}function Hh(r,e){r.Na.delete(e.path.canonicalString());const t=r.La.get(e);null!==t&&(qr(r.remoteStore,t),r.La=r.La.remove(e),r.Ba.delete(t),xl(r))}function wl(r,e,t){for(const n of t)n instanceof Wh?(r.ka.addReference(n.key,e),Uf(r,n)):n instanceof Kh?(ae("SyncEngine","Document no longer in limbo: "+n.key),r.ka.removeReference(n.key,e),r.ka.containsKey(n.key)||Hh(r,n.key)):ze()}function Uf(r,e){const t=e.key,n=t.path.canonicalString();r.La.get(t)||r.Na.has(n)||(ae("SyncEngine","New document in limbo: "+t),r.Na.add(n),xl(r))}function xl(r){for(;r.Na.size>0&&r.La.size<r.maxConcurrentLimboResolutions;){const e=r.Na.values().next().value;r.Na.delete(e);const t=new k(xe.fromString(e)),n=r.Ka.next();r.Ba.set(n,new kf(t)),r.La=r.La.insert(t,n),$i(r.remoteStore,new Vn(sn(Rr(t.path)),n,"TargetPurposeLimboResolution",Wt.oe))}}function zn(r,e,t){return Tl.apply(this,arguments)}function Tl(){return Tl=(0,T.A)(function*(r,e,t){const n=Ne(r),s=[],i=[],o=[];var c;n.xa.isEmpty()||(n.xa.forEach((c,u)=>{o.push(n.Ua(u,e,t).then(f=>{var y;if((f||t)&&n.isPrimaryClient){const C=f?!f.fromCache:null===(y=t?.targetChanges.get(u.targetId))||void 0===y?void 0:y.current;n.sharedClientState.updateQueryState(u.targetId,C?"current":"not-current")}if(f){s.push(f);const C=Ta.zi(u.targetId,f);i.push(C)}}))}),yield Promise.all(o),n.Ma.R_(s),yield(c=(0,T.A)(function*(f,y){const C=Ne(f);try{yield C.persistence.runTransaction("notifyLocalViewChanges","readwrite",G=>W.forEach(y,ue=>W.forEach(ue.Wi,Pe=>C.persistence.referenceDelegate.addReference(G,ue.targetId,Pe)).next(()=>W.forEach(ue.Gi,Pe=>C.persistence.referenceDelegate.removeReference(G,ue.targetId,Pe)))))}catch(G){if(!zt(G))throw G;ae("LocalStore","Failed to update sequence numbers: "+G)}for(const G of y){const ue=G.targetId;if(!G.fromCache){const Pe=C.us.get(ue),Fe=Pe.withLastLimboFreeSnapshotVersion(Pe.snapshotVersion);C.us=C.us.insert(ue,Fe)}}}),function u(f,y){return c.apply(this,arguments)})(n.localStore,i))}),Tl.apply(this,arguments)}function $f(r,e){return bl.apply(this,arguments)}function bl(){return(bl=(0,T.A)(function*(r,e){const t=Ne(r);if(!t.currentUser.isEqual(e)){ae("SyncEngine","User change. New user:",e.toKey());const n=yield bh(t.localStore,e);t.currentUser=e,(i=t).Qa.forEach(c=>{c.forEach(u=>{u.reject(new Z(J.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.Qa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield zn(t,n.Ts)}var i})).apply(this,arguments)}function qf(r,e){const t=Ne(r),n=t.Ba.get(e);if(n&&n.Fa)return yt().add(n.key);{let s=yt();const i=t.Oa.get(e);if(!i)return s;for(const o of i){const c=t.xa.get(o);s=s.unionWith(c.view.fa)}return s}}function Wi(r){const e=Ne(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jf.bind(null,e),e.Ma.R_=Cf.bind(null,e.eventManager),e.Ma.Wa=Sf.bind(null,e.eventManager),e}let Ki=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,T.A)(function*(){n.serializer=Ds(t.databaseInfo.databaseId),n.sharedClientState=n.za(t),n.persistence=n.ja(t),yield n.persistence.start(),n.localStore=n.Ha(t),n.gcScheduler=n.Ja(t,n.localStore),n.indexBackfillerScheduler=n.Ya(t,n.localStore)})()}Ja(t,n){return null}Ya(t,n){return null}Ha(t){return function Th(r,e,t,n){return new Zm(r,e,t,n)}(this.persistence,new xh,t.initialUser,this.serializer)}ja(t){return new ya(Vi.ei,this.serializer)}za(t){return new Ph}terminate(){var t=this;return(0,T.A)(function*(){var n,s;null===(n=t.gcScheduler)||void 0===n||n.stop(),null===(s=t.indexBackfillerScheduler)||void 0===s||s.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class kl extends Ki{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){return Ue(this.persistence.referenceDelegate instanceof zi),new dh(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}ja(e){const t=void 0!==this.cacheSizeBytes?on.withCacheSize(this.cacheSizeBytes):on.DEFAULT;return new ya(n=>zi.ei(n,t),this.serializer)}}let Hr=(()=>{class r{initialize(t,n){var s=this;return(0,T.A)(function*(){s.localStore||(s.localStore=t.localStore,s.sharedClientState=t.sharedClientState,s.datastore=s.createDatastore(n),s.remoteStore=s.createRemoteStore(n),s.eventManager=s.createEventManager(n),s.syncEngine=s.createSyncEngine(n,!t.synchronizeTabs),s.sharedClientState.onlineStateHandler=i=>Jh(s.syncEngine,i,1),s.remoteStore.remoteSyncer.handleCredentialChange=$f.bind(null,s.syncEngine),yield Ya(s.remoteStore,s.syncEngine.isPrimaryClient))})()}createEventManager(t){return new Af}createDatastore(t){const n=Ds(t.databaseInfo.databaseId),s=new cf(t.databaseInfo);return new df(t.authCredentials,t.appCheckCredentials,s,n)}createRemoteStore(t){return s=this.localStore,i=this.datastore,o=t.asyncQueue,c=n=>Jh(this.syncEngine,n,0),u=kh.p()?new kh:new of,new mf(s,i,o,c,u);var s,i,o,c,u}createSyncEngine(t,n){return function(i,o,c,u,f,y,C){const G=new Mf(i,o,c,u,f,y);return C&&(G.$a=!0),G}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,T.A)(function*(){var n,s,i;yield(i=(0,T.A)(function*(c){const u=Ne(c);ae("RemoteStore","RemoteStore shutting down."),u.k_.add(5),yield $r(u),u.Q_.shutdown(),u.K_.set("Unknown")}),function o(c){return i.apply(this,arguments)})(t.remoteStore),null===(n=t.datastore)||void 0===n||n.terminate(),null===(s=t.eventManager)||void 0===s||s.terminate()})()}}return r.provider={build:()=>new r},r})();class Qi{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):Qe("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class rp{constructor(e,t,n,s,i){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=it.UNAUTHENTICATED,this.clientId=M.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,function(){var c=(0,T.A)(function*(u){ae("FirestoreClient","Received user=",u.uid),yield o.authCredentialListener(u),o.user=u});return function(u){return c.apply(this,arguments)}}()),this.appCheckCredentials.start(n,c=>(ae("FirestoreClient","Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ut;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,T.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const s=Qr(n,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Dl(r,e){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,T.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),ae("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var s=(0,T.A)(function*(i){n.isEqual(i)||(yield bh(e.localStore,i),n=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Fl.apply(this,arguments)}function rd(r,e){return Vl.apply(this,arguments)}function Vl(){return(Vl=(0,T.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function zl(r){return Nl.apply(this,arguments)}(r);ae("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Bh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Bh(e.remoteStore,s)),r._onlineComponents=e})).apply(this,arguments)}function Nl(){return(Nl=(0,T.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){ae("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Dl(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(s=e).name?s.code===J.FAILED_PRECONDITION||s.code===J.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw e;ct("Error using user provided cache. Falling back to memory cache: "+e),yield Dl(r,new Ki)}}else ae("FirestoreClient","Using default OfflineComponentProvider"),yield Dl(r,new kl(void 0));var s;return r._offlineComponents})).apply(this,arguments)}function Yi(r){return jl.apply(this,arguments)}function jl(){return(jl=(0,T.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(ae("FirestoreClient","Using user provided OnlineComponentProvider"),yield rd(r,r._uninitializedComponentsProvider._online)):(ae("FirestoreClient","Using default OnlineComponentProvider"),yield rd(r,new Hr))),r._onlineComponents})).apply(this,arguments)}function es(r){return Ll.apply(this,arguments)}function Ll(){return(Ll=(0,T.A)(function*(r){const e=yield Yi(r),t=e.eventManager;return t.onListen=Df.bind(null,e.syncEngine),t.onUnlisten=Vf.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ff.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=zf.bind(null,e.syncEngine),t})).apply(this,arguments)}function cd(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const ud=new Map;function Gl(r,e,t){if(!t)throw new Z(J.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function hd(r){if(!k.isDocumentKey(r))throw new Z(J.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function dd(r){if(k.isDocumentKey(r))throw new Z(J.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Xi(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":ze()}function wt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new Z(J.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xi(r);throw new Z(J.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class md{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Z(J.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Z(J.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function fp(r,e,t,n){if(!0===e&&!0===n)throw new Z(J.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=cd(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new Z(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Z(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Z(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Vs{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new md({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(J.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Z(J.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new md(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new $e;switch(n.type){case"firstParty":return new Je(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Z(J.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,T.A)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=ud.get(t);n&&(ae("ComponentProvider","Removing Datastore"),ud.delete(t),n.terminate())}(this),Promise.resolve()}}class en{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new en(this.firestore,e,this._query)}}class Ut{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new On(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ut(this.firestore,e,this._key)}}class On extends en{constructor(e,t,n){super(e,t,Rr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ut(this.firestore,null,new k(e))}withConverter(e){return new On(this.firestore,e,this._path)}}function zs(r,e,...t){if(r=(0,R.Ku)(r),Gl("collection","path",e),r instanceof Vs){const n=xe.fromString(e,...t);return dd(n),new On(r,null,n)}{if(!(r instanceof Ut||r instanceof On))throw new Z(J.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(xe.fromString(e,...t));return dd(n),new On(r.firestore,null,n)}}function ts(r,e,...t){if(r=(0,R.Ku)(r),1===arguments.length&&(e=M.newId()),Gl("doc","path",e),r instanceof Vs){const n=xe.fromString(e,...t);return hd(n),new Ut(r,null,new k(n))}{if(!(r instanceof Ut||r instanceof On))throw new Z(J.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(xe.fromString(e,...t));return hd(n),new Ut(r.firestore,r instanceof On?r.converter:null,new k(n))}}class pd{constructor(e=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new ka(this,"async_queue_retry"),this.fu=()=>{const n=Ui();n&&ae("AsyncQueue","Visibility state changed to "+n.visibilityState),this.r_.Jo()},this.gu=e;const t=Ui();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.Eu){this.Eu=!0,this.Vu=e||!1;const t=Ui();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.Eu)return new Promise(()=>{});const t=new ut;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}wu(){var e=this;return(0,T.A)(function*(){if(0!==e.Iu.length){try{yield e.Iu[0](),e.Iu.shift(),e.r_.reset()}catch(t){if(!zt(t))throw t;ae("AsyncQueue","Operation failed with retryable error: "+t)}e.Iu.length>0&&e.r_.jo(()=>e.wu())}})()}yu(e){const t=this.gu.then(()=>(this.Ru=!0,e().catch(n=>{throw this.Au=n,this.Ru=!1,Qe("INTERNAL UNHANDLED ERROR: ",function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),c}(n)),n}).then(n=>(this.Ru=!1,n))));return this.gu=t,t}enqueueAfterDelay(e,t,n){this.pu(),this.mu.indexOf(e)>-1&&(t=0);const s=Ja.createAndSchedule(this,e,t,n,i=>this.Su(i));return this.du.push(s),s}pu(){this.Au&&ze()}verifyOperationInProgress(){}bu(){var e=this;return(0,T.A)(function*(){let t;do{t=e.gu,yield t}while(t!==e.gu)})()}Du(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.du.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.du)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}function Ul(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const s=t;for(const i of["next","error","complete"])if(i in s&&"function"==typeof s[i])return!0;return!1}(r)}class St extends Vs{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new pd,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){var e=this;return(0,T.A)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new pd(t),e._firestoreClient=void 0,yield t}})()}}function $l(r,e){const t="object"==typeof r?r:(0,p.Sx)(),n="string"==typeof r?r:e||"(default)",s=(0,p.j6)(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=(0,R.yU)("firestore");i&&function pp(r,e,t,n={}){var s;const i=(r=wt(r,Vs))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&ct("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let c,u;if("string"==typeof n.mockUserToken)c=n.mockUserToken,u=it.MOCK_USER;else{c=(0,R.Fy)(n.mockUserToken,null===(s=r._app)||void 0===s?void 0:s.options.projectId);const f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new Z(J.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new it(f)}r._authCredentials=new Ce(new et(c,u))}}(s,...i)}return s}function Vt(r){if(r._terminated)throw new Z(J.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||function gd(r){var e,t,n;const s=r._freezeSettings(),i=(u=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new G_(r._databaseId,u,r._persistenceKey,(y=s).host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,cd(y.experimentalLongPollingOptions),y.useFetchStreams));var u,y;r._componentsProvider||!(null===(t=s.localCache)||void 0===t)&&t._offlineComponentProvider&&!(null===(n=s.localCache)||void 0===n)&&n._onlineComponentProvider&&(r._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),r._firestoreClient=new rp(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(c){const u=c?._online.build();return{_offline:c?._offline.build(u),_online:u}}(r._componentsProvider))}(r),r._firestoreClient}class gr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gr(Nt.fromBase64String(e))}catch(t){throw new Z(J.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new gr(Nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class yr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Z(J.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new D(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ns{constructor(e){this._methodName=e}}class Wl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Z(J.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Z(J.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return P(this._lat,e._lat)||P(this._long,e._long)}}class Ji{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,e._values)}}const wp=/^__.*__$/;class xp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Fn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dr(e,this.data,t,this.fieldTransforms)}}function wd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ze()}}class Hi{constructor(e,t,n,s,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Fu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new Hi(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.xu({path:n,Nu:!1});return s.Lu(e),s}Bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.xu({path:n,Nu:!1});return s.Fu(),s}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return to(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lu(this.path.get(e))}Lu(e){if(0===e.length)throw this.qu("Document fields must not be empty");if(wd(this.Mu)&&wp.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class Tp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ds(e)}$u(e,t,n,s=!1){return new Hi({Mu:e,methodName:t,Ku:n,path:D.emptyPath(),Nu:!1,Qu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vr(r){const e=r._freezeSettings(),t=Ds(r._databaseId);return new Tp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Zi(r,e,t,n,s,i={}){const o=r.$u(i.merge||i.mergeFields?2:0,e,t,s);Zl("Data must be an object, but it was:",o,n);const c=bd(n,o);let u,f;if(i.merge)u=new pn(o.fieldMask),f=o.fieldTransforms;else if(i.mergeFields){const y=[];for(const C of i.mergeFields){const G=Bs(e,C,t);if(!o.contains(G))throw new Z(J.INVALID_ARGUMENT,`Field '${G}' is specified in your field mask but missing from your input data.`);Ed(y,G)||y.push(G)}u=new pn(y),f=o.fieldTransforms.filter(C=>u.covers(C.field))}else u=null,f=o.fieldTransforms;return new xp(new Zt(c),u,f)}function wr(r,e){if(Id(r=(0,R.Ku)(r)))return Zl("Unsupported field value:",e,r),bd(r,e);if(r instanceof ns)return function(n,s){if(!wd(s.Mu))throw s.qu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.qu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Nu&&4!==e.Mu)throw e.qu("Nested arrays are not supported");return function(n,s){const i=[];let o=0;for(const c of n){let u=wr(c,s.ku(o));null==u&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,s){if(null===(n=(0,R.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return hu(s.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const i=Ke.fromDate(n);return{timestampValue:Vr(s.serializer,i)}}if(n instanceof Ke){const i=new Ke(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Vr(s.serializer,i)}}if(n instanceof Wl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof gr)return{bytesValue:ku(s.serializer,n._byteString)};if(n instanceof Ut){const i=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw s.qu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:oa(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Ji)return c=s,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(u=>{if("number"!=typeof u)throw c.qu("VectorValues must only contain numeric values.");return Zo(c.serializer,u)})}}}}};var c;throw s.qu(`Unsupported field value: ${Xi(n)}`)}(r,e)}function bd(r,e){const t={};return Pc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ln(r,(n,s)=>{const i=wr(s,e.Ou(n));null!=i&&(t[n]=i)}),{mapValue:{fields:t}}}function Id(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Ke||r instanceof Wl||r instanceof gr||r instanceof Ut||r instanceof ns||r instanceof Ji)}function Zl(r,e,t){if(!Id(t)||"object"!=typeof(s=t)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){const n=Xi(t);throw e.qu("an object"===n?r+" a custom object":r+" "+n)}var s}function Bs(r,e,t){if((e=(0,R.Ku)(e))instanceof yr)return e._internalPath;if("string"==typeof e)return eo(r,e);throw to("Field path arguments must be of type string or ",r,!1,void 0,t)}const bp=new RegExp("[~\\*/\\[\\]]");function eo(r,e,t){if(e.search(bp)>=0)throw to(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new yr(...e.split("."))._internalPath}catch{throw to(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function to(r,e,t,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${n}`),o&&(u+=` in document ${s}`),u+=")"),new Z(J.INVALID_ARGUMENT,c+r+u)}function Ed(r,e){return r.some(t=>t.isEqual(e))}class Ls{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ut(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ip(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ip extends Ls{data(){return super.data()}}function no(r,e){return"string"==typeof e?eo(r,e):e instanceof yr?e._internalPath:e._delegate._internalPath}function Ad(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new Z(J.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ec{}class Gs extends ec{}function Cd(r,e,...t){let n=[];e instanceof ec&&n.push(e),n=n.concat(t),function(i){const o=i.filter(u=>u instanceof rs).length,c=i.filter(u=>u instanceof Us).length;if(o>1||o>0&&c>0)throw new Z(J.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class Us extends Gs{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Us(e,t,n)}_apply(e){const t=this._parse(e);return kd(e._query,t),new en(e.firestore,e.converter,Jo(e._query,t))}_parse(e){const t=vr(e.firestore);return function(i,o,c,u,f,y,C){let G;if(f.isKeyField()){if("array-contains"===y||"array-contains-any"===y)throw new Z(J.INVALID_ARGUMENT,`Invalid Query. You can't perform '${y}' queries on documentId().`);if("in"===y||"not-in"===y){Pd(C,y);const ue=[];for(const Pe of C)ue.push(Od(u,i,Pe));G={arrayValue:{values:ue}}}else G=Od(u,i,C)}else"in"!==y&&"not-in"!==y&&"array-contains-any"!==y||Pd(C,y),G=function Td(r,e,t,n=!1){return wr(t,r.$u(n?4:3,e))}(c,"where",C,"in"===y||"not-in"===y);return Tt.create(f,y,G)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function Sd(r,e,t){const n=e,s=no("where",r);return Us._create(s,n,t)}class rs extends ec{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new rs(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:Ct.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(s,i){let o=s;const c=i.getFlattenedFilters();for(const u of c)kd(o,u),o=Jo(o,u)}(e._query,t),new en(e.firestore,e.converter,Jo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Od(r,e,t){if("string"==typeof(t=(0,R.Ku)(t))){if(""===t)throw new Z(J.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xo(e)&&-1!==t.indexOf("/"))throw new Z(J.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(xe.fromString(t));if(!k.isDocumentKey(n))throw new Z(J.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return or(r,new k(n))}if(t instanceof Ut)return or(r,t._key);throw new Z(J.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xi(t)}.`)}function Pd(r,e){if(!Array.isArray(r)||0===r.length)throw new Z(J.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function kd(r,e){const t=function(s,i){for(const o of s)for(const c of o.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new Z(J.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Dd{convertValue(e,t="none"){switch(Un(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Dt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ze()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ln(e,(s,i)=>{n[s]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,s;const i=null===(s=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map(o=>Dt(o.doubleValue));return new Ji(i)}convertGeoPoint(e){return new Wl(Dt(e.latitude),Dt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=mi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(us(e));default:return null}}convertTimestamp(e){const t=Pn(e);return new Ke(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=xe.fromString(e);Ue($u(n));const s=new ir(n.get(1),n.get(3)),i=new k(n.popFirst(5));return s.isEqual(t)||Qe(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class xr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ss extends Ls{constructor(e,t,n,s,i,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ao(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(no("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ao extends ss{data(e={}){return super.data(e)}}class is{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new xr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ao(this._firestore,this._userDataWriter,n.key,n,new xr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Z(J.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(c=>({type:"added",doc:new ao(s._firestore,s._userDataWriter,c.doc.key,c.doc,new xr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:o++}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>i||3!==c.type).map(c=>{const u=new ao(s._firestore,s._userDataWriter,c.doc.key,c.doc,new xr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,y=-1;return 0!==c.type&&(f=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),1!==c.type&&(o=o.add(c.doc),y=o.indexOf(c.doc.key)),{type:Cp(c.type),doc:u,oldIndex:f,newIndex:y}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Cp(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ze()}}class Hn extends Dd{constructor(e){super(),this.firestore=e}convertBytes(e){return new gr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ut(this.firestore,null,t)}}function Fd(r){r=wt(r,en);const e=wt(r.firestore,St),t=Vt(e),n=new Hn(e);return Ad(r._query),function ld(r,e,t={}){const n=new ut;return r.asyncQueue.enqueueAndForget((0,T.A)(function*(){return function(i,o,c,u,f){const y=new Qi({next:G=>{y.eu(),o.enqueueAndForget(()=>el(i,C)),G.fromCache&&"server"===u.source?f.reject(new Z(J.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(G)},error:G=>f.reject(G)}),C=new sl(c,y,{includeMetadataChanges:!0,ua:!0});return Ha(i,C)}(yield es(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(s=>new is(e,n,r,s))}function Vd(r,e,t){r=wt(r,Ut);const n=wt(r.firestore,St),s=function oo(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return $s(n,[Zi(vr(n),"setDoc",r._key,s,null!==r.converter,t).toMutation(r._key,Ft.none())])}function lo(r,...e){var t,n,s;r=(0,R.Ku)(r);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Ul(e[o])||(i=e[o],o++);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Ul(e[o])){const C=e[o];e[o]=null===(t=C.next)||void 0===t?void 0:t.bind(C),e[o+1]=null===(n=C.error)||void 0===n?void 0:n.bind(C),e[o+2]=null===(s=C.complete)||void 0===s?void 0:s.bind(C)}let u,f,y;if(r instanceof Ut)f=wt(r.firestore,St),y=Rr(r._key.path),u={next:C=>{e[o]&&e[o](nc(f,r,C))},error:e[o+1],complete:e[o+2]};else{const C=wt(r,en);f=wt(C.firestore,St),y=C._query;const G=new Hn(f);u={next:ue=>{e[o]&&e[o](new is(f,G,C,ue))},error:e[o+1],complete:e[o+2]},Ad(r._query)}return function(G,ue,Pe,Le){const Fe=new Qi(Le),at=new sl(ue,Fe,Pe);return G.asyncQueue.enqueueAndForget((0,T.A)(function*(){return Ha(yield es(G),at)})),()=>{Fe.eu(),G.asyncQueue.enqueueAndForget((0,T.A)(function*(){return el(yield es(G),at)}))}}(Vt(f),y,c,u)}function $s(r,e){return function(n,s){const i=new ut;return n.asyncQueue.enqueueAndForget((0,T.A)(function*(){return function Nf(r,e,t){return dl.apply(this,arguments)}(yield function Bl(r){return Yi(r).then(e=>e.syncEngine)}(n),s,i)})),i.promise}(Vt(r),e)}function nc(r,e,t){const n=t.docs.get(e._key),s=new Hn(r);return new ss(r,s,e._key,n,new xr(t.hasPendingWrites,t.fromCache),e.converter)}!function(e,t=!0){nt=p.MF,(0,p.om)(new q.uA("firestore",(n,{instanceIdentifier:s,options:i})=>{const o=n.getProvider("app").getImmediate(),c=new St(new Ye(n.getProvider("auth-internal")),new ce(n.getProvider("app-check-internal")),function(f,y){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Z(J.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ir(f.options.projectId,y)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),(0,p.KO)(ht,"4.7.5",e),(0,p.KO)(ht,"4.7.5","esm2017")}();var qt=w(51698),Gp=w(92834),Up=w(53793),$p=w(97252);let qp=(()=>{var r;class e{examSessions_read(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=yield s._getDocument(c.data,"exam_sessions/"+n,s.getUserId());i.next({success:1,data:u,message:"successful"}),i.complete()}catch(y){console.log(y),i.next({success:0,data:"",message:""+y}),i.complete()}else i.next({success:0,data:"",message:c.message}),i.complete()});return function(c){return o.apply(this,arguments)}}())})}examSessions_write(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield i._saveDocument(u.data,"exam_sessions/"+n,i.getUserId(),s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(C){console.log(C),o.next({success:0,data:"",message:""+C}),o.complete()}else o.next({success:0,data:"",message:u.message}),o.complete()});return function(u){return c.apply(this,arguments)}}())})}examSessions_writeUserMap(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success&&u.data)try{var f=yield i._saveDocumentMerge(u.data,"exam_sessions/"+n,"user_map",s);o.next({success:1,data:f,message:"successful"}),o.complete()}catch(C){console.log(C),o.next({success:0,data:"",message:""+C}),o.complete()}else o.next({success:0,data:"",message:u.message}),o.complete()});return function(u){return c.apply(this,arguments)}}())})}examSessions_delete(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,T.A)(function*(c){if(c&&1==c.success)try{yield s._removeDocument(c.data,"exam_sessions/"+n,s.getUserId()),i.next({success:1,data:"",message:"successful"}),i.complete()}catch(f){console.log(f),i.next({success:0,data:"",message:""+f}),i.complete()}else i.next({success:0,data:"",message:c.message}),i.complete()});return function(c){return o.apply(this,arguments)}}())})}examSessions_subscribeUserMap(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var o=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=s.myOnSnapshot(c.data,"exam_sessions/"+n,"user_map",C=>{i.next({success:1,data:C,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,u)}catch(C){console.log(C),i.next({success:0,data:void 0,message:""+C}),i.complete()}else i.next({success:0,data:void 0,message:c.message}),i.complete()});return function(c){return o.apply(this,arguments)}}())})}examSessions_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=s.myOnSnapshot(c.data,"exam_sessions/"+n,s.getUserId(),C=>{i.next({success:1,data:C,message:"successful"}),i.complete()});s.addUnsubscribe("exam_sessions_"+n,u)}catch(C){console.log(C),i.next({success:0,data:void 0,message:""+C}),i.complete()}else i.next({success:0,data:void 0,message:c.message}),i.complete()});return function(c){return o.apply(this,arguments)}}())})}examSessions_unsubscribe(n){this.removeAllunsubscribe("exam_sessions_"+n)}examSessions_subscribeWithQuery(n,s){var i=this;return new qt.c(s&&3==s.length?o=>{this.getFirestoreDb(!1).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=i.myOnSnapshotCollectionWithQuery(u.data,"exam_sessions/"+n,s,G=>{o.next({success:1,data:G,message:"successful"}),o.complete()});i.addUnsubscribe("exam_sessions_"+n,f)}catch(G){console.log(G),o.next({success:0,data:void 0,message:""+G}),o.complete()}else o.next({success:0,data:void 0,message:u.message}),o.complete()});return function(u){return c.apply(this,arguments)}}())}:o=>{o.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),o.complete(),o.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=s.myOnSnapshotCollection(c.data,"exam_live_teachers/"+n,f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_teachers_"+n,u)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(c)});return function(c){return o.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_teachers_"+n)}examLiveTeachers_teacher_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield i._saveDocument(u.data,"exam_live_teachers/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(y){console.log(y),o.next({success:0,message:"EXCEPTION",ex:y.toString()})}else o.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield i._getDocuments(u.data,"exam_lives/"+n,s);o.next({success:1,data:f})}catch(y){console.log(y),o.next({success:0,message:"EXCEPTION",ex:y.toString()})}else o.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(n){var s=this;return new qt.c(i=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var o=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=s.myOnSnapshot(c.data,"exam_live_students/"+n,s.getUserId(),f=>{i.next({success:1,data:f})});s.addUnsubscribe("exam_live_students_"+n,u)}catch(f){console.log(f),i.next({success:0,message:"EXCEPTION",ex:f.toString()})}else i.next(c)});return function(c){return o.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_teacher_subscribe(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=i.myOnSnapshot(u.data,"exam_live_students/"+n,s,y=>{o.next({success:1,data:y})});i.addUnsubscribe("exam_live_students_"+n,f)}catch(y){console.log(y),o.next({success:0,message:"EXCEPTION",ex:y.toString()})}else o.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_student_saveChange(n,s){var i=this;return new qt.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield i._saveDocument(u.data,"exam_live_students/"+n,i.getUserId(),s);o.next({success:1,data:f})}catch(y){console.log(y),o.next({success:0,message:"EXCEPTION",ex:y.toString()})}else o.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(n,s,i){var o=this;return new qt.c(c=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,T.A)(function*(f){if(f&&1==f.success)try{var y=yield o._saveDocumentMerge(f.data,"exam_live_students/"+n,s,i);c.next({success:1,data:y})}catch(C){console.log(C),c.next({success:0,message:"EXCEPTION",ex:C.toString()})}else c.next(f)});return function(f){return u.apply(this,arguments)}}())})}getFirestoreDb(n){return new qt.c(s=>{var i=this.createFirestoreKey("firestore_db"),o=this.getLocalFirestoreDb(i);null!=o&&0==n?(s.next({success:1,data:o,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(u=>{u&&1==u.success?(0,_e.p)(this.getAuthApp(),u?.data?.token??"").then(()=>{var y=$l(this.app,d.c.firestoreDatabase);this.setLocalFirestoreDb(i,y),s.next({success:1,data:y,message:"successful"}),s.complete()}).catch(y=>{"auth/invalid-custom-token"===y.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:u.message??""}),s.complete())})})}getFirestoreDbForStudentExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_student_"+s),c=this.getLocalFirestoreDb(o);null!=c&&0==n?(i.next({success:1,data:c,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,_e.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var C=$l(this.app,d.c.firestoreDatabase);this.setLocalFirestoreDb(o,C),i.next({success:1,data:C,message:"successful"}),i.complete()}).catch(C=>{"auth/invalid-custom-token"===C.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}getFirestoreDbForTeacherExam(n,s){return new qt.c(i=>{var o=this.createFirestoreKey("firestore_db_teacher_"+s),c=this.getLocalFirestoreDb(o);null!=c&&0==n?(i.next({success:1,data:c,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(s).subscribe(f=>{f&&1==f.success?(0,_e.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var C=$l(this.app,d.c.firestoreDatabase);this.setLocalFirestoreDb(o,C),i.next({success:1,data:C,message:"successful"}),i.complete()}).catch(C=>{"auth/invalid-custom-token"===C.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:f.message??""}),i.complete())})})}signInUserByToken(n){return new qt.c(s=>{(0,_e.p)(this.getAuthApp(),n).then(()=>{s.next({success:1,data:"",message:"successful"}),s.complete()}).catch(i=>{"auth/invalid-custom-token"===i.code?(s.next({success:0,data:"",message:"EXPIRED"}),s.complete()):(s.next({success:0,data:"",message:"AUTH_ERROR"}),s.complete())})})}setLocalFirestoreDb(n,s){this.firestoreDbs[n]=s}getLocalFirestoreDb(n){if(this.firestoreDbs.hasOwnProperty(n))return this.firestoreDbs[n]}removeLocalFirestoreDb(n){this.firestoreDbs.hasOwnProperty(n)&&delete this.firestoreDbs[n]}createFirestoreKey(n){return this.userService.getUserObj().id+"_"+n}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(n,s){n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)||(this.listSubscribers[n]=[]),this.listSubscribers[n].push(s)}removeAllunsubscribe(n){if(n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)){for(var s=0;s<this.listSubscribers[n].length;s++)this.listSubscribers[n][s]();delete this.listSubscribers[n]}}_saveDocument(n,s,i,o){var c=this;return(0,T.A)(function*(){return s=c.getBaseFirestore()+"/"+s,yield Vd(ts(n,s,i),c.commonService.myClone(o)),i})()}_saveDocumentMerge(n,s,i,o){var c=this;return(0,T.A)(function*(){return s=c.getBaseFirestore()+"/"+s,yield Vd(ts(n,s,i),c.commonService.myClone(o),{merge:!0}),i})()}_getCollection(n,s){var i=this;return(0,T.A)(function*(){s=i.getBaseFirestore()+"/"+s;const o=zs(n,s);return(yield Fd(o)).docs.map(f=>f.data())})()}_getDocument(n,s,i){var o=this;return(0,T.A)(function*(){s=o.getBaseFirestore()+"/"+s;const c=ts(n,s,i),u=yield function Sp(r){r=wt(r,Ut);const e=wt(r.firestore,St);return function ad(r,e,t={}){const n=new ut;return r.asyncQueue.enqueueAndForget((0,T.A)(function*(){return function(i,o,c,u,f){const y=new Qi({next:G=>{y.eu(),o.enqueueAndForget(()=>el(i,C));const ue=G.docs.has(c);!ue&&G.fromCache?f.reject(new Z(J.UNAVAILABLE,"Failed to get document because the client is offline.")):ue&&G.fromCache&&u&&"server"===u.source?f.reject(new Z(J.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(G)},error:G=>f.reject(G)}),C=new sl(Rr(c.path),y,{includeMetadataChanges:!0,ua:!0});return Ha(i,C)}(yield es(r),r.asyncQueue,e,t,n)})),n.promise}(Vt(e),r._key).then(t=>nc(e,r,t))}(c);return u.exists()?u.data():null})()}_getDocuments(n,s,i){var o=this;return(0,T.A)(function*(){var c={};s=o.getBaseFirestore()+"/"+s;const u=Cd(zs(n,s),Sd(function vp(){return new yr("__name__")}(),"in",i));return(yield Fd(u)).forEach(y=>{c[y.id]=y.data()}),c})()}_removeDocument(n,s,i){var o=this;return(0,T.A)(function*(){s=o.getBaseFirestore()+"/"+s,yield function Rp(r){return $s(wt(r.firestore,St),[new Fr(r._key,Ft.none())])}(ts(n,s,i))})()}myOnSnapshot(n,s,i,o){return lo(ts(n,s=this.getBaseFirestore()+"/"+s,i),u=>{o(u.data())})}myOnSnapshotCollection(n,s,i){return lo(zs(n,s=this.getBaseFirestore()+"/"+s),function(){var c=(0,T.A)(function*(u){var f=[];u.forEach(y=>{f.push(y.data())}),i(f)});return function(u){return c.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(n,s,i){return lo(zs(n,s=this.getBaseFirestore()+"/"+s),function(){var c=(0,T.A)(function*(u){var f=[];u.docChanges().forEach(y=>{f.push(y.doc.data())}),i(f)});return function(u){return c.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(n,s,i,o){return lo(Cd(zs(n,s=this.getBaseFirestore()+"/"+s),Sd(i[0],i[1],i[2])),function(){var f=(0,T.A)(function*(y){var C=[];y.docChanges().forEach(G=>{C.push(G.doc.data())}),o(C)});return function(y){return f.apply(this,arguments)}}())}getBaseFirestore(){return d.c.firestoreCollection}getInitApp(){return this.app}getAuthApp(){return(0,_e.xI)(this.app)}initFirestoreConfig(){return new qt.c(n=>{this.firestoreSettingService.apiFirestoreSettingGetPublicKeyGet().subscribe(s=>{let i=d.c.firestoreConfig_app1;i.apiKey=s.data?.value??"",this.app=(0,re.Wp)(i,"firestoreapp"),n.next(),n.complete()})})}constructor(n,s,i,o){this.firestoreServiceApi=n,this.userService=s,this.commonService=i,this.firestoreSettingService=o,this.firestoreDbs={},this.listSubscribers={}}}return(r=e).\u0275fac=function(n){return new(n||r)(h.KVO(Gp.B),h.KVO(_.R),h.KVO(Up.R),h.KVO($p.Z))},r.\u0275prov=h.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})(),Wp=(()=>{var r;class e{monitorAtTeacherDashboard(n){try{let s=l();if(typeof s>"u"||!s||!s.showMonitorTeacher)return;this.fireStoreService.initFirestoreConfig().subscribe(()=>{s.ver=this.monitorService.getMNoteVer();var i=this.userService.getUserObj();s.showMonitorTeacher({user:{token:i.rememberToken,userid:i.id,username:i.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live",urlExamResultGetLastExamResultOfStudentId:"ExamLivestream/GetLastExamResultOfStudentId"},roomid:n.roomId,examid:n.examId,userlist:n.userList,examconfig:n.examConfig,firebaseApp:this.fireStoreService,filetypeStr:n.fileTypeStr})})}catch(s){console.log(s)}}monitorAtStudentDashboard(n,s){try{let o=l();if(typeof o>"u"||!o)return;o.ver=this.monitorService.getMNoteVer();var i=this.userService.getUserObj();this.fireStoreService.initFirestoreConfig().subscribe(()=>{o.loadMonitor(()=>{if(!o.MonitorStudent)return;var c={user:{token:i.rememberToken,userid:i.id,username:i.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:n,element:"monitorScreen",examconfig:s,firebaseApp:this.fireStoreService,isStarted:!1};o.MonitorStudent.getInstance().prepairSession(c);let f=window.setInterval(()=>{let y=document.getElementById("monitorScreen");if(y){let C=y.getElementsByTagName("div")[0];C&&(C.setAttribute("class","mx-auto"),clearInterval(f))}},50)})})}catch(o){console.log(o)}}monitorAtTestPage(n,s,i){let o=l();if(typeof o>"u"||!o)return i(!1);var c=this.userService.getUserObj(),u=s;o.ver=this.monitorService.getMNoteVer(),this.fireStoreService.initFirestoreConfig().subscribe(()=>{o.loadMonitor(()=>{if(!o.MonitorStudent)return i(!1);var f={user:{token:c.rememberToken,userid:c.id,username:c.fullName,studentid:u?u.id:0,studentname:u?u.fullName:null},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:n.roomId,element:"monitorScreenTakeTest",examconfig:n.examConfig,examid:n.examId,firebaseApp:this.fireStoreService,resultid:n.resultId,isStarted:!0,clickFromIframeFunc:()=>{},clickFromIframeFuncCaller:this};o.MonitorStudent.getInstance().startSession(f),i(!0)})})}destroyMonitorAtStudentDashboard(){try{let s=l();if(typeof s>"u"||!s||!s.MonitorStudent)return;s.MonitorStudent.getInstance().stopSession()}catch(s){console.log(s)}}constructor(n,s,i){this.userService=n,this.monitorService=s,this.fireStoreService=i}}return(r=e).\u0275fac=function(n){return new(n||r)(h.KVO(_.R),h.KVO(x.Q),h.KVO(qp))},r.\u0275prov=h.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},42802:(_t,Ee,w)=>{"use strict";w.d(Ee,{Q:()=>h});var l=w(48891),d=w(55465);let h=(()=>{var _;class x{constructor(re){this.envService=re}getTmpVersionMonitor(){var re=this.envService.getEnvValue("classliveUrl"),_e="1.0";if(re){var p=re.split("=");p.length>1&&(_e=p[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+_e}getMNoteVer(){var re=this.envService.getEnvValue("classliveUrl"),_e="1.0";if(re){var p=re.split("=");p.length>1&&(_e=p[1])}return _e}checkValidForSetUpMonitor(){return!0}}return(_=x).\u0275fac=function(re){return new(re||_)(l.KVO(d.t))},_.\u0275prov=l.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),x})()},51935:(_t,Ee,w)=>{"use strict";w.d(Ee,{h:()=>ke});var l=w(91478),d=w(89163),h=w(33887),_=w(48891),x=w(54460),T=w(2915),re=w(15343),_e=w(76975);const p=()=>({"mr-2":!0});function q(Oe,xe){if(1&Oe&&(_.j41(0,"li"),_.EFF(1),_.k0s()),2&Oe){const qe=xe.$implicit;_.R7$(),_.SpI("* ",qe.message,"")}}function V(Oe,xe){1&Oe&&(_.j41(0,"span",8),_.EFF(1),_.nI1(2,"mytranslate"),_.j41(3,"span",9),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.EFF(6),_.nI1(7,"mytranslate"),_.nI1(8,"mytranslate"),_.k0s()),2&Oe&&(_.R7$(),_.SpI(" ",_.bMT(2,4,"lang_auto_click")," "),_.R7$(3),_.SpI('"',_.bMT(5,6,"lang_auto_tai_ve"),'"'),_.R7$(2),_.Lme(" ",_.bMT(7,8,"lang_auto_de_tai_ve")," ",_.bMT(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function R(Oe,xe){if(1&Oe){const qe=_.RV6();_.j41(0,"button",17),_.bIt("click",function(){_.eBV(qe);const k=_.XpG();return _.Njj(k.onPressTrue())}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&Oe&&(_.R7$(),_.SpI(" ",_.bMT(2,1,"lang_auto_tai_ve")," "))}let j=(()=>{var Oe;class xe extends h._{onPressTrue(){this.dialogRef.close(!0)}constructor(D,k){super(D,k),this.data=D,this.dialogRef=k,this.result=D.result}}return(Oe=xe).\u0275fac=function(D){return new(D||Oe)(_.rXU(d.Vh),_.rXU(d.CP,8))},Oe.\u0275cmp=_.VBU({type:Oe,selectors:[["app-push-error-student-export-docx"]],features:[_.Vt3],decls:30,vars:25,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16",3,"ngClass"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(D,k){1&D&&(_.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",4)(7,"a",5),_.nrm(8,"lucide-icon",6),_.k0s()()(),_.j41(9,"div",7)(10,"span",8),_.EFF(11),_.nI1(12,"mytranslate"),_.j41(13,"span",9),_.EFF(14),_.k0s(),_.EFF(15),_.nI1(16,"mytranslate"),_.nI1(17,"lowercase"),_.k0s(),_.j41(18,"span",8),_.EFF(19),_.nI1(20,"mytranslate"),_.k0s(),_.j41(21,"azt-mat-dialog-content",10)(22,"ul",11),_.DNE(23,q,2,1,"li",12),_.k0s()(),_.DNE(24,V,9,12,"span",13),_.k0s(),_.j41(25,"div",14)(26,"a",15),_.EFF(27),_.nI1(28,"mytranslate"),_.k0s(),_.DNE(29,R,3,3,"button",16),_.k0s()()()),2&D&&(_.R7$(4),_.JRh(_.bMT(5,12,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),_.R7$(4),_.Y8G("ngClass",_.lJ4(24,p)),_.R7$(3),_.SpI(" ",_.bMT(12,14,"lang_auto_he_thong_tao_thanh_cong_cho")," "),_.R7$(3),_.Lme("",k.result.datas.length,"/",k.result.errs.length+k.result.datas.length,""),_.R7$(),_.SpI(" ",_.bMT(17,18,_.bMT(16,16,"lang_auto_hoc_sinh"))," "),_.R7$(4),_.SpI(" ",_.bMT(20,20,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),_.R7$(2),_.Y8G("defaultHeight",60),_.R7$(2),_.Y8G("ngForOf",k.result.errs),_.R7$(),_.Y8G("ngIf",k.result.datas.length>0),_.R7$(3),_.SpI(" ",_.bMT(28,22,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("ngIf",k.result.datas.length>0))},dependencies:[x.YU,x.Sq,x.bT,d.tx,T.U,re.WGl,x.GH,_e.wp],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),xe})();var A=w(10936),Y=w(65080),B=w(68774),L=w(47712),v=w(5502),F=w(81587),Q=w(90796),ee=w(69135),te=w(14987);const oe=(Oe,xe)=>({"box-classrooms":Oe,"box-max-classrooms":xe});function Ve(Oe,xe){if(1&Oe&&(_.j41(0,"span",31),_.EFF(1),_.k0s()),2&Oe){let qe;const D=_.XpG();_.R7$(),_.JRh(null!==(qe=null==D.studentsInClassResults[0].classObj?null:D.studentsInClassResults[0].classObj.name)&&void 0!==qe?qe:"")}}function Se(Oe,xe){if(1&Oe&&(_.j41(0,"div",36)(1,"div",18),_.nrm(2,"input",37),_.j41(3,"label",38,0),_.EFF(5),_.k0s()()()),2&Oe){let qe;const D=xe.$implicit,k=_.sdS(4),I=_.XpG(2);_.Y8G("hidden",1===I.studentsInClassResults.length),_.R7$(2),_.Mz_("id","select-classroom-export__",null==D.classObj?null:D.classObj.id,""),_.Y8G("value",null==D.classObj?null:D.classObj.id),_.R7$(),_.Mz_("for","select-classroom-export__",null==D.classObj?null:D.classObj.id,""),_.Y8G("matTooltip",null!==(qe=null==D.classObj?null:D.classObj.name)&&void 0!==qe?qe:"")("isDisabledTooltip",!1)("matTooltipDisabled",k.isDisabled),_.R7$(2),_.JRh(null==D.classObj?null:D.classObj.name)}}function He(Oe,xe){if(1&Oe&&(_.j41(0,"div",32)(1,"ng-scrollbar",33)(2,"div",34),_.DNE(3,Se,6,10,"div",35),_.k0s()()()),2&Oe){const qe=_.XpG();_.Y8G("ngClass",_.l_i(3,oe,qe.form.controls.listStudents.controls.length>21||qe.studentsInClassResults.length>18,qe.form.controls.listStudents.controls.length<=21&&qe.studentsInClassResults.length>18)),_.R7$(),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",qe.studentsInClassResults)}}function be(Oe,xe){if(1&Oe&&(_.j41(0,"label",38,0),_.EFF(2),_.k0s()),2&Oe){const qe=_.sdS(1),D=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",D.controls.id.value,""),_.Y8G("matTooltip",D.controls.label.value)("isDisabledTooltip",!1)("matTooltipDisabled",qe.isDisabled),_.R7$(2),_.SpI(" ",D.controls.label.value," ")}}function ht(Oe,xe){if(1&Oe&&(_.j41(0,"label",44),_.nrm(1,"img",45),_.k0s()),2&Oe){const qe=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",qe.controls.id.value,""),_.R7$(),_.Y8G("nameImages",qe.controls.nameImages.value)}}function it(Oe,xe){if(1&Oe){const qe=_.RV6();_.j41(0,"div",39)(1,"div",40)(2,"input",41),_.bIt("change",function(){_.eBV(qe);const k=_.XpG();return _.Njj(k.onChangeStudentOption())}),_.k0s(),_.DNE(3,be,3,6,"label",42)(4,ht,2,3,"label",43),_.k0s()()}if(2&Oe){const qe=xe.$implicit;_.R7$(),_.Y8G("formGroup",qe),_.R7$(),_.Mz_("id","select-classroom-export__",qe.controls.id.value,""),_.R7$(),_.Y8G("ngIf",qe.controls.label.value||!qe.controls.isImage.value),_.R7$(),_.Y8G("ngIf",!qe.controls.label.value&&qe.controls.isImage.value&&qe.controls.nameImages.value)}}function nt(Oe,xe){1&Oe&&(_.j41(0,"span",27),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&Oe&&(_.R7$(),_.SpI("* ",_.bMT(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function Re(Oe,xe){if(1&Oe){const qe=_.RV6();_.j41(0,"div",49),_.bIt("click",function(){_.eBV(qe);const k=_.XpG(2);return _.Njj(k.showAskInfo=!0)}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&Oe&&(_.R7$(),_.SpI("+ ",_.bMT(2,1,"lang_testbank_test_config_add_information"),""))}function rt(Oe,xe){if(1&Oe&&(_.j41(0,"div"),_.nrm(1,"add-info-print",50),_.k0s()),2&Oe){const qe=_.XpG(2);_.R7$(),_.Y8G("form",qe.form)}}function je(Oe,xe){1&Oe&&(_.j41(0,"span",53),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&Oe&&(_.R7$(),_.SpI("(",_.bMT(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function ae(Oe,xe){if(1&Oe){const qe=_.RV6();_.j41(0,"div",51),_.bIt("click",function(){_.eBV(qe);const k=_.XpG(2);return _.Njj(k.showAskInfo=!1)}),_.EFF(1),_.nI1(2,"mytranslate"),_.nI1(3,"mytranslate"),_.nI1(4,"lowercase"),_.DNE(5,je,3,3,"span",52),_.k0s()}if(2&Oe){const qe=_.XpG(2);_.R7$(),_.Lme(" ",_.bMT(2,3,"lang_auto_huy")," ",_.bMT(4,7,_.bMT(3,5,"lang_testbank_test_config_add_information"))," "),_.R7$(4),_.Y8G("ngIf",qe.isAskInfo&&qe.showAskInfo)}}function Qe(Oe,xe){if(1&Oe&&(_.j41(0,"div")(1,"span",46),_.EFF(2),_.nI1(3,"mytranslate"),_.k0s(),_.DNE(4,Re,3,3,"div",47)(5,rt,2,1,"div",26)(6,ae,6,9,"div",48),_.k0s()),2&Oe){const qe=_.XpG();_.R7$(2),_.Lme("* ",_.bMT(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",qe.countStudentSelect,""),_.R7$(2),_.Y8G("ngIf",qe.isAskInfo&&!qe.showAskInfo),_.R7$(),_.Y8G("ngIf",qe.isAskInfo&&qe.showAskInfo),_.R7$(),_.Y8G("ngIf",qe.isAskInfo&&qe.showAskInfo)}}function ct(Oe,xe){1&Oe&&(_.j41(0,"div")(1,"div",15)(2,"span",27),_.EFF(3),_.nI1(4,"mytranslate"),_.k0s()()()),2&Oe&&(_.R7$(3),_.SpI("* ",_.bMT(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let We=(()=>{var Oe;class xe extends h._{confirmAction(){const D=this.form.value,k=this.studentsInClassResults.find(I=>I.classObj?.id===D.classId);if(k){const I=D.listStudents?.filter(b=>b.choose).map(b=>b.id);k.results=k.results?.filter(b=>I?.includes(b.reId)),k.schoolName=this.showAskInfo?D.schoolName:void 0,k.subjectName=this.showAskInfo?D.subjectName:void 0,this.dialogRef.close(k)}else this.dialogRef.close()}setChangeSelectAll(){const D=this.form.controls.selectAll;if(D){D.setValue(!D.value);const k=this.form.controls.listStudents;k&&k.controls.forEach(I=>{I.controls.choose.setValue(D.value)}),this.countStudentSelect=D.value?k.controls.length:0}}onChangeStudentOption(){const D=this.form.controls.listStudents;let k=!0,I=0;D&&D.controls.forEach(z=>{!1===z.controls.choose.value?k=!1:I++});const b=this.form.controls.selectAll;b&&b.setValue(k),this.countStudentSelect=I}setupArrayStudent(D){this.currNameClass=D.classObj?.name??"";const k=this.form.controls.listStudents;if(k){k.clear();let I=D.results??[];if(void 0!==D.classObj?.sortType){let b=D.classObj?.sortType;I=0==b?this.sortService.sortFirstNameStudents(this.commonService.myClone(I)):99==b?this.sortService.sortTimeDESC(this.commonService.myClone(I)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone(I),"pos","id")}I.forEach(b=>{(b.confirmedAt||!this.data.examHasEssay&&1==b.status)&&k.push(new A.gE({isImage:new A.MJ(!!b.nameImages,{nonNullable:!0}),nameImages:new A.MJ(b.nameImages,{nonNullable:!0}),label:new A.MJ(b.fullName,{nonNullable:!0}),id:new A.MJ(b.reId,{nonNullable:!0}),choose:new A.MJ(!1,{nonNullable:!0})}))})}}classroomChange(D){this.setupArrayStudent(D)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let D=this.studentsInClassResults[0];this.form.controls.classId.setValue(D.classObj?.id),this.setupArrayStudent(D),this.form.controls.classId.valueChanges.subscribe(I=>{const b=this.form.controls.selectAll;b&&b.setValue(!1),this.countStudentSelect=0;const z=this.studentsInClassResults.find(U=>U.classObj?.id===I);z&&this.setupArrayStudent(z)})}}constructor(D,k,I){super(k,I),this.sortService=D,this.data=k,this.dialogRef=I,this.studentsInClassResults=[],this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=k.isAskInfo,this.studentsInClassResults=k.studentsInClassResults.map(b=>({...b,results:b.results?.map(z=>({...z,reId:Y.P.generateIdRequired(10)}))})),this.form=new A.gE({classId:new A.MJ(0,{nonNullable:!0,validators:[A.k0.required]}),selectAll:new A.MJ(!1,{nonNullable:!0}),listStudents:new A.Yp([]),schoolName:new A.MJ("",{nonNullable:!0}),subjectName:new A.MJ("",{nonNullable:!0})})}}return(Oe=xe).\u0275fac=function(D){return new(D||Oe)(_.rXU(B.g),_.rXU(d.Vh),_.rXU(d.CP,8))},Oe.\u0275cmp=_.VBU({type:Oe,selectors:[["app-select-student-to-export-docx"]],features:[_.Vt3],decls:48,vars:35,consts:[["c","isDisabled"],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"change","checked"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"change","id"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(D,k){1&D&&(_.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",5)(7,"a",6),_.nrm(8,"lucide-icon",7),_.k0s()()(),_.j41(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11),_.EFF(13),_.nI1(14,"mytranslate"),_.DNE(15,Ve,2,1,"span",12),_.k0s()(),_.DNE(16,He,4,6,"div",13),_.j41(17,"div",14)(18,"div",15)(19,"div",16),_.EFF(20),_.nI1(21,"mytranslate"),_.k0s()(),_.j41(22,"div",17)(23,"div",18)(24,"input",19),_.bIt("change",function(){return k.setChangeSelectAll()}),_.k0s(),_.j41(25,"label",20),_.EFF(26),_.nI1(27,"mytranslate"),_.k0s()()(),_.j41(28,"div",21)(29,"ng-scrollbar",22)(30,"div",23),_.DNE(31,it,5,5,"div",24),_.k0s()()(),_.j41(32,"div",15),_.DNE(33,nt,3,3,"span",25)(34,Qe,7,7,"div",26),_.k0s()(),_.j41(35,"div",14)(36,"div",15)(37,"span",27),_.EFF(38),_.nI1(39,"mytranslate"),_.k0s()()()(),_.DNE(40,ct,5,3,"div",26),_.k0s(),_.j41(41,"div",28)(42,"a",29),_.EFF(43),_.nI1(44,"mytranslate"),_.k0s(),_.j41(45,"button",30),_.bIt("click",function(){return k.confirmAction()}),_.EFF(46),_.nI1(47,"mytranslate"),_.k0s()()()()),2&D&&(_.R7$(4),_.JRh(_.bMT(5,21,"lang_testbank_what_to_export_select_students_export")),_.R7$(6),_.Y8G("formGroup",k.form)("hidden",0===k.studentsInClassResults.length),_.R7$(),_.Y8G("hidden",1===k.studentsInClassResults.length&&null==k.studentsInClassResults[0].classObj),_.R7$(2),_.SpI(" ",_.bMT(14,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),_.R7$(2),_.Y8G("ngIf",1===k.studentsInClassResults.length),_.R7$(),_.Y8G("ngIf",k.studentsInClassResults.length>1),_.R7$(),_.Y8G("hidden",0===k.form.controls.listStudents.controls.length),_.R7$(3),_.SpI("",_.bMT(21,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),_.R7$(4),_.Y8G("checked",k.form.controls.selectAll.value),_.R7$(2),_.JRh(_.bMT(27,27,"lang_auto_chon_tat_ca")),_.R7$(3),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",k.form.controls.listStudents.controls),_.R7$(2),_.Y8G("ngIf",0===k.countStudentSelect),_.R7$(),_.Y8G("ngIf",k.countStudentSelect>0),_.R7$(),_.Y8G("hidden",k.form.controls.listStudents.controls.length>0),_.R7$(3),_.SpI("* ",_.bMT(39,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),_.R7$(2),_.Y8G("ngIf",0===k.studentsInClassResults.length),_.R7$(3),_.SpI(" ",_.bMT(44,31,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("disabled",0===k.countStudentSelect),_.R7$(),_.SpI(" ",_.bMT(47,33,"lang_cms_common_confirm_btn")," "))},dependencies:[x.YU,x.Sq,x.bT,d.tx,L.oV,v.Yh,A.qT,A.me,A.Zm,A.Fm,A.BC,A.cb,A.j4,A.JD,A.v8,F.t,Q.y,ee.f,te.i,re.WGl,x.GH,_e.wp],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),xe})();var ze=w(28023),Ue=w(5382),gt=w(64198),Ne=w(25539),J=w(81234),Z=w(92229),ut=w(50622),et=w(91640),$e=w(41325),Ce=w(58112),Ye=w(51113),st=w(53393),Je=w(99927),xt=w(99172),ce=w(10933),Me=w(53793),ye=w(42801),M=w(47290),P=w(87515),H=w(10296),Be=w(46899),Ke=w(32610);let ke=(()=>{var Oe;class xe{processHomeworks(D,k){return new Promise((I,b)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(k).subscribe(z=>{if(1==z.success){this.logger.remove();var U=[];z.data?.studentObjs.forEach(N=>{U.push({id:N.id,fullName:N.fullName,confirmedAt:N.confirmedAt,homeworkAnswerId:N.answer?.id,studentId:void 0,resultId:void 0,userId:void 0,nameImages:void 0,reId:"",status:void 0})}),this.sAztDialogService.open(We,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:z.data?.classroomObj,results:U,schoolName:void 0,subjectName:void 0}],examHasEssay:!1,isAskInfo:!1}}).afterClosed().subscribe(N=>{if(N){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===N.results?.length?"":N.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const ve=new Z.Y(!0);this.logger.pushChild(ve),this.loadLibAction(ve).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===N.results?.length?"":N.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const ge=new Z.Y(!0);this.logger.pushChild(ge);const ie=new Ue.n(1,{function:(de,me,pe)=>{ge.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===me?"":"th\u1ee9 "+(de+1)} ${pe?": "+pe:""}`)}});N.results?.forEach(de=>{const me=new Z.Y;ge.pushChild(me),ie.addTask(this,this.makeFileHomework,[k,de,me],de.fullName??"")}),ie.start().then(de=>{ge.remove(),0===de.errs.length?this.finishHomework(N.classObj?.name??"",z.data?.homeworkObj?.name??"",de,I,b):(this.logger.remove(),this.sAztDialogService.open(j,{data:{result:de},restoreFocus:!1}).afterClosed().subscribe(me=>{me&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(N.classObj?.name??"",z.data?.homeworkObj?.name??"",de,I,b))}))})}).catch(ge=>{this.logger.remove(),b(ge)})}})}else this.logger.remove(),b(new Error(this.commonService.myTranslateInstant(z.message)))})})}processClasses(D,k){return new Promise((I,b)=>{let z;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),k){case"highest":z=this.testedListApiService.getTestedHighestMark("export_tool",D);break;case"first":z=this.testedListApiService.getTestedFirstMark("export_tool",D);break;default:z=this.testedListApiService.getTestedLastMark("export_tool",D)}z.subscribe(U=>{if(1==U.success){this.logger.remove();let N=!!U.data?.questionObjs?.filter(ge=>this.answerTypeService.isEssayAnswer(ge)).length,ve=[];if(U.data?.studentsInClassResults?.forEach(ge=>{let ie=[];ge.results?.forEach(de=>{ie.push({id:de.id?Number(de.id):void 0,fullName:de.fullName??"",confirmedAt:de.confirmedAt,studentId:de.studentId?Number(de.studentCode):void 0,resultId:de.resultId,userId:de.userId?.toString(),nameImages:de.nameImages,reId:"",status:de.status})}),ve.push({classObj:ge.classObj,results:ie,schoolName:void 0,subjectName:void 0})}),U.data?.studentsNotInClassResults&&U.data?.studentsNotInClassResults?.length>0){let ge=[];U.data.studentsNotInClassResults.forEach(ie=>{ge.push({id:ie.id?Number(ie.id):void 0,fullName:ie.fullName??"",confirmedAt:ie.confirmedAt,studentId:ie.studentId?Number(ie.studentCode):void 0,resultId:ie.resultId,userId:ie.userId?.toString(),nameImages:ie.nameImages,reId:"",status:ie.status})}),ve.push({classObj:{id:0,name:this.commonService.myTranslateInstant("lang_auto_tu_do")??""},results:ge,schoolName:void 0,subjectName:void 0})}this.sAztDialogService.open(We,{data:{studentsInClassResults:ve,examHasEssay:N,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(ge=>{ge?(this.expandInfoParse=this.commonService.castJsonToObj(U.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===ge.results?.length?"":ge.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(D,ge,ge.classObj?.name??"",U.data?.examObj,ge.classObj?.id).then(()=>{this.logger.remove(),I()}).catch(de=>{this.logger.remove(),b(de)})):(this.logger.remove(),I())})}else this.logger.remove(),b(new Error(this.commonService.myTranslateInstant(U.message)??""))})})}processUser(D,k,I,b,z,U=!0,N,ve,ge,ie,de){return new Promise((me,pe)=>{this.reset(),z=z||this.logger,z?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Ie=new Z.Y(!0);z?.pushChild(Ie),this.loadLibAction(Ie).then(()=>{z?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(D,I??"",b??"",k,de).subscribe(Te=>{if(1==Te.success){this.expandInfoParse=this.commonService.castJsonToObj(Te.data?.examObj?.expandInfo??"{}")??{},z?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let Ze=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const tt=Te.data?.studentObj;z?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${tt?.fullName??""}`);let W="";W=Te.data?.classroomObj?Te.data?.classroomObj.name??Ze:Ze;const ot=Te.data?.examTracks,mt=Te.data?.examObj,Kt=Te.data?.examResultObj,Bt=this.commonService.castJsonToClassObjs(Ne.I,JSON.stringify(Te.data?.questionObjs))??[];let Xt=0,zt=0;for(let pt=0;pt<Bt.length;pt++)Bt[pt].correctAnswer=this.commonService.isExistInArray(Te.data?.correctQuestionIds,Bt[pt].id),Bt[pt].indexLabel=pt+(mt?.startQuestionIndex??1),mt?.resetQuestionIndex&&Bt[pt].groupInfo&&Bt[pt].groupInfo?.groupId&&(Bt[pt].groupInfo&&Xt!=Bt[pt].groupInfo?.groupId&&(Xt=Bt[pt].groupInfo?.groupId??0,zt=0),Bt[pt].labelIndex=zt+(mt?.startQuestionIndex??1),zt++);const mn={};let nn=this.commonService.castJsonToObj(Te.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(nn??[],mn);const rn=new Z.Y;z?.pushChild(rn),this.processConvertDataUser(rn,Bt,tt,Kt).then(pt=>{if(pt){var xn=0;this.convertDataMarkNote(pt?.resultTeacherDraw).then(sr=>{this.loadTeacherDrawResult(sr,z??new Z.Y,tt?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",pt).then(Wt=>{pt=Wt,rn.remove();const wn=new Z.Y(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+`...${xn}%`);z?.pushChild(wn);let fn=[];fn.push({content:this.getLineInfoData(W,mt,ot,Kt,tt,Bt,pt,N,ve).join("<br/>")+"<br/><br/><br/>",answers:[]}),fn=fn.concat(this.startGenUserLineFile(Kt,Bt,pt,ge,ie));var In=0;this.sAztDocxService.exportToDocxBinary((0,J.Wn)(fn),{isHeadless:!0},(Pt,Tn,En)=>{new Promise(Qt=>{setTimeout(()=>{0==Pt&&(xn=In),In=Pt/Tn*50+xn;const yn=this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+"..."+Math.floor(In)+"%";wn?.pushMsg(yn)}),Qt(!0)})}).then(Pt=>{const Tn=new Blob([Pt],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let En=this.commonService.createFileNameExportFile([tt?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",Kt?.id?Kt.id.toString():""])+"_test_result";if(U)if(pt.mediaAnswerWraps.concat(pt.mediaWraps).length>0){const Qt=new l;Qt.file(En+".docx",Tn),pt.mediaAnswerWraps.concat(pt.mediaWraps).forEach(yn=>{const An=new Blob([yn]);Qt.file("attachments/"+this.replaceParamFileName(yn.name),An)}),Qt.generateAsync({type:"blob"}).then(yn=>{let An=this.commonService.createFileNameExportFile([W,En])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(yn,An),z?.remove(),me()},yn=>{z?.remove(),me(yn)})}else this.shareFileFlutterService.shareFileWithBlob(Tn,En+".docx"),z?.remove(),me();else z?.remove(),me({name:En,blob:Tn,medias:pt.mediaAnswerWraps.concat(pt.mediaWraps)})})})})}}).catch(pt=>{z?.remove(),pe(pt)})}else z?.remove(),pe(new Error(this.commonService.myTranslateInstant(Te.message)))})}).catch(Te=>{z?.remove(),pe(Te)})})}finishClassroom(D,k,I,b,z){if(I.length>1){const U=new l;I.forEach(N=>{N.medias.length>0?(U.file(N.name+"/"+N.name+".docx",N.blob),N.medias.forEach(ve=>{const ge=new Blob([ve]);U.file(N.name+"/attachments/"+this.replaceParamFileName(ve.name),ge)})):U.file(N.name+".docx",N.blob)}),U.generateAsync({type:"blob"}).then(N=>{let ve=this.commonService.createFileNameExportFile([D,k])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(N,ve),b()},N=>{b(N)})}else if(I[0].medias.length>0){const U=new l;U.file(I[0].name+"/"+I[0].name+".docx",I[0].blob),I[0].medias.forEach(N=>{const ve=new Blob([N]);U.file(I[0].name+"/attachments/"+this.replaceParamFileName(N.name),ve)}),U.generateAsync({type:"blob"}).then(N=>{let ve=this.commonService.createFileNameExportFile([D,k])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(N,ve),b()},N=>{b(N)})}else this.shareFileFlutterService.shareFileWithBlob(I[0].blob,I[0].name+".docx"),b()}finishHomework(D,k,I,b,z){if(1===I.datas.length)if(I.datas[0].medias.length>0){const U=new l;U.file(I.datas[0].name+"/"+I.datas[0].name+".docx",I.datas[0].blob),I.datas[0].medias.forEach(N=>{const ve=new Blob([N]);U.file(I.datas[0].name+"/attachments/"+this.replaceParamFileName(N.name),ve)}),U.generateAsync({type:"blob"}).then(N=>{let ve=this.commonService.createFileNameExportFile([D,I.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(N,ve),b()},N=>{this.logger.remove(),b(N)})}else this.shareFileFlutterService.shareFileWithBlob(I.datas[0].blob,I.datas[0].name+".docx"),this.logger.remove(),b();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const U=new l;I.datas.forEach(N=>{N.medias.length>0?(U.file("results/"+N.name+"/"+N.name+".docx",N.blob),N.medias.forEach(ve=>{const ge=new Blob([ve]);U.file("results/"+N.name+"/attachments/"+this.replaceParamFileName(ve.name),ge)})):U.file("results/"+N.name+".docx",N.blob)}),U.generateAsync({type:"blob"}).then(N=>{let ve=this.commonService.createFileNameExportFile([D,k])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(N,ve),this.logger.remove(),b()},N=>{this.logger.remove(),z(N)})}}makeFileHomework(D,k,I){return new Promise((b,z)=>{I.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(D,k.homeworkAnswerId??0).subscribe(U=>{if(I.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(U.data?.answerObj),U.data?.answerObj){I.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let ve=this.commonService.castJsonToObj(U.data.answerObj.result??"")??{};this.convertDataMarkNote(ve).then(ge=>{this.loadTeacherDrawResult(ge,I,k.fullName??"").then(ie=>{I.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let de=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${U.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${U.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${U.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${U.data?.answerObj?.id} <br/>`].forEach(pe=>{de.push({content:pe,answers:[]})});let me=this.commonService.castJsonToObj(U.data?.answerObj?.resultNote??"");if(me){const pe=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],Ie=document.createElement("p");Ie.innerText=this.commonService.myTranslateInstant("lang_point")??"",Ie.setAttribute("docx-style",J.$s.get("TB_RESULT_TXT"));const Te=document.createElement("p");let Ze=U.data?.answerObj?.point;pe.forEach(ot=>{ot.mark===Ze&&(Ze=this.commonService.myTranslateInstant(ot.lang))}),Te.innerText=Ze?.toString()??"",Te.setAttribute("docx-style",J.$s.get("TB_RESULT_POINT"));const tt=document.createElement("p");tt.setAttribute("docx-style",J.$s.get("TB_RESULT_TXT")),tt.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const W=document.createElement("span");W.setAttribute("docx-style",J.$s.get("TB_RESULT_COMMENT")),0===me?.IsHideMark&&(W.innerText=this.getTextContentInTagHTML(me.Note),ie.resultTeacherDraw?.commentEmoji&&(W.appendChild(document.createElement("br")),ie.resultTeacherDraw.commentEmoji.forEach(ot=>{if(ie.canvasList[ot]){const mt=new Image;mt.src=ie.canvasList[ot].toDataURL(),mt.style.width=ie.canvasList[ot].width/5+"px",mt.style.height=ie.canvasList[ot].height/5+"px",W.appendChild(mt)}}))),de.push({content:J.$s.makeHeaderTable([Ie,Te],[tt,W]),answers:[]})}de=de.concat(this.getLineImageAnswer(ie)),this.sAztDocxService.exportToDocxBinary((0,J.Wn)(de),{isHeadless:!0},(pe,Ie,Te)=>{}).then(pe=>{I.remove();const Ie=new Blob([pe],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let Te=`${this.commonService.convertVietnameseToEnglish(k.fullName??"")}_${U.data?.answerObj?.id??0}`;b({name:Te,blob:Ie,medias:ie.mediaAnswerWraps.concat(ie.mediaWraps)})})}).catch(ie=>{I.remove(),z(ie)})})}else I.remove(),z(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(D,k,I,b,z){return new Promise((U,N)=>{const ve=new Ue.n(1,{function:(de,me)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===me?"":` (${de+1}/${me})`}`),this.logger.percent=de/me}},1e3),ge=[];let ie=this.homeworkExamService.isOfflineExam(b);k.results?.forEach(de=>{ve.addTask(this,()=>new Promise((me,pe)=>{const Ie=new Z.Y(!0,"");this.logger.pushChild(Ie),this.processUser(D,Number(de.resultId),de.userId,de.studentId?.toString(),Ie,!1,k.schoolName,k.subjectName,ie,void 0,z).then(Te=>{Te?(Ie.remove(),ge.push(Te),me()):(Ie.remove(),pe(new Error))}).catch(Te=>{Ie.remove(),pe(Te)})}))}),ve.start().then(de=>{de.errs.length>0?(this.logger.remove(),de.datas=ge,this.sAztDialogService.open(j,{data:{result:de},restoreFocus:!1}).afterClosed().subscribe(me=>{me&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom(I,b?.name??"",ge,U,N))})):this.finishClassroom(I,b?.name??"",ge,U,N)})})}processConvertDataUser(D,k,I,b){return new Promise((z,U)=>{let N={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},ve=(this.commonService.myParseJson(b?.files??"[]")??[]).filter(Te=>(0,gt.rl)(Te.mimes??"")||(0,gt.nL)(Te.mimes??""));D.start();const Ie=new Ue.n(1,{function:(Te,Ze,tt)=>{D.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${Te+1}/${Ze}: ${tt}`)}});Ie.addTask(this,()=>new Promise((Te,Ze)=>{const tt=new Z.Y(!0);D.pushChild(tt),this.questionRenderService.parseRenderQuestions(k,W=>{tt.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(W)}%`)},void 0,50,!0).then(()=>{tt.remove(),Te()}).catch(W=>{const ot=mt=>{Object.prototype.hasOwnProperty.call(mt,"type")&&"LOAD_IMAGE"===mt.type?Ze(new Error(`${mt.message} ${this.commonService.trimMidLimitLength(mt.data[0],30)}`)):Ze(W)};tt.remove(),Array.isArray(W)?ot(W[0]):ot(W)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),b&&b.result&&Ie.addTask(this,()=>new Promise((Te,Ze)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj(b?.result??"")??{},D,I?.fullName??"").then(tt=>{N=tt,Te()}).catch(tt=>{Ze(tt)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),Ie.addTask(this,()=>new Promise((Te,Ze)=>{I?this.loadNameImage(I).then(tt=>{I=tt,Te()}).catch(tt=>{Ze(tt)}):Ze(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),N.isExportMedia&&Ie.addTask(this,()=>new Promise((Te,Ze)=>{const tt=new Z.Y(!0);D.pushChild(tt);const W=new Ue.n(3,{function:(ot,mt)=>{tt.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${ot}/${mt})`)}},100);k.forEach(ot=>{ot.attachments&&ot.attachments.length>0&&ot.attachments.forEach(mt=>{W.addTask(this,this.loadAztFile,[mt,N,"att"])})}),W.start().then(ot=>{0===ot.errs.length?(tt.remove(),Te()):(tt.remove(),Ze(ot.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),ve.length&&Ie.addTask(this,()=>new Promise((Te,Ze)=>{const tt=new Z.Y(!0);D.pushChild(tt);const W=new Ue.n(3,{function:(ot,mt)=>{tt.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${ot}/${mt})`)}},100);ve.forEach(ot=>{W.addTask(this,this.loadAztFile,[ot,N,"ans"])}),W.start().then(ot=>{0===ot.errs.length?(tt.remove(),Te()):(tt.remove(),Ze(ot.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem_tu_luan")),Ie.start().then(Te=>{D.remove(),0===Te.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(k,b),z(N)):U(Te.errs[0])})})}hasMultiple(D){let k=!1;for(let I=0;I<D.length;I++)if(this.answerTypeService.isOneChoiceAnswer(D[I])){k=!0;break}return k}hasEssay(D){let k=!1;for(let I=0;I<D.length;I++)if(this.answerTypeService.isEssayAnswer(D[I])){k=!0;break}return k}getLineInfoData(D,k,I,b,z,U,N,ve,ge){const ie=[];ie.push(J.$s.makeHeaderTable([J.$s.createLineCenterBold(ve||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toUpperCase()} }`)],[J.$s.createLineCenterBold(k?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),J.$s.createLineCenterBold(ge||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),J.$s.createLineCenterBold(k?.minutes&&k?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+k?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const de=U.filter(me=>this.answerTypeService.isEssayAnswer(me)).length;return z&&z.nameImages&&parseInt(z?.id??"0")<=0?ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${z?.nameImages.url}" />`):ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${z?.fullName}`),ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${D}`),k?.subjectMarks&&b?.subjectMarkValues&&b.subjectMarkValues.forEach((me,pe)=>{ie.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${pe+1} </b>: ${me}/10`)}),this.hasMultiple(U)&&ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${b?.trueFalseMark} (${b?.rightAnswer}/${(b?.totalQuestion??0)-de} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(U)&&ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${b?.essayMark+" ("+de+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(U)&&N.resultTeacherDraw&&ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj(b?.files??"")?.length??"0"}`),I&&0!=k?.autoMonitor&&(ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${I.exitFullScreen}`),ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${I.blurWindow}`)),ie.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${b?.id}`),ie}startGenUserLineFile(D,k,I,b,z){let U=[];const N=this.commonService.castJsonToObj(D?.answers??"");return N&&k.forEach((ve,ge)=>{ve.groupInfo&&ve.groupInfo.isFirstInGroup&&U.push({content:`<br/><b>${ve.groupInfo.groupContent}</b><br/>`,answers:[]}),ve.attachments&&I.isExportMedia&&ve.attachments.forEach(de=>{U.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(de.name)}]`,answers:[]})}),U=U.concat(this.genLineQuestion(ve,b));const ie=this.mapQuestResultObj(ve,N??[]);switch(ve.answerType){case 1:U=U.concat(this.genLineAnswerType1(ve,ie));break;case 3:let de=D?.confirmedAt?new ze.X(this.commonService).parserEssayResult(D.essayResult):[],me=(D?.confirmedAt?D?.essayAnswerObjs:[])??[],pe=de.find(Te=>Te.questionIndex==ge),Ie=me.find(Te=>Te.questionId==ve.id)??{questionId:ve.id,comment:void 0,mark:pe?.questionMark};U=U.concat(this.genLineAnswerType3(ve,ie,{questionId:ve.id,comment:Ie?.comment,mark:Ie?.mark??0}));break;case 4:U=U.concat(this.genLineAnswerType4(ve,ie));break;case 5:U=U.concat(this.genLineAnswerTrueFalseType5(ve,ie))}z&&ve.help&&U.push({content:`<br/><b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b> ${ve.help}<br/><br/>`,answers:[]})}),this.hasEssay(k)&&(U=U.concat(this.getLineImageAnswer(I))),U}genLineQuestion(D,k){const I=[];let b=this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"),z=this.answerTypeService.isFillAnswer(D)?this.commonService.myTranslateInstant("azt_lang_sugg_type_fill_blank"):this.answerTypeService.isEssayAnswer(D)?this.commonService.myTranslateInstant("azt_lang_sugg_type_essay"):this.commonService.myTranslateInstant("azt_lang_sugg_type_multiple_choice"),U={content:"<b>"+b+" "+(D.labelIndex??D.indexLabel??1)+". "+(k?`(${z})`:"")+"</b> "+(D.content?.includes("<img")?"<br/>":"")+D.content,answers:k&&(this.answerTypeService.isFillAnswer(D)||this.answerTypeService.isEssayAnswer(D))?[]:this.convertAnswerQuestion(D.answers??[],!!this.answerTypeService.isTrueFalseAnswer(D))};return I.push(U),I}mapQuestResultObj(D,k){return k.find(b=>b.QuestionId===D.id)||{QuestionId:D.id??0,AnswerContent:[]}}convertAnswerQuestion(D,k){let I=[];return D.forEach(b=>{let z=b.alpha?b.alpha:b.key,U="<b>     "+(k?z.toLocaleLowerCase()+")":z)+".</b> "+b.content;I.push(U)}),I}genLineAnswerType1(D,k){const I=document.createElement("table"),b=D.correctAnswer?J.JP:J.ep;I.setAttribute("docx-style",J.$s.get("TABLE"));const z=[],U=document.createElement("tr");I.appendChild(U);const N=document.createElement("td");N.setAttribute("docx-style",J.$s.get("CORRECT",[{key:J.Xe,value:b}]));const ve=document.createElement("span"),ge=D.answers?D.answers.filter(me=>D.answerResult?.includes(me.key)).map(me=>me.alpha??me.key).join(" & "):D.answerResult?.join(" & ");ve.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+ge,ve.setAttribute("color",b),N.appendChild(ve),U.appendChild(N);const ie=document.createElement("span"),de=document.createElement("span");return ie.innerText="\u2713",ie.setAttribute("color",J.JP),de.innerText="\u2717",de.setAttribute("color",J.ep),D.answers?.forEach((me,pe)=>{const Ie=document.createElement("td"),Te=document.createElement("span"),Ze=[{key:J.Xe,value:b}];Ze.push({key:J.n1,value:pe+1===D.answers?.length?b:"FFFFFF"}),Ie.setAttribute("docx-style",J.$s.get("KEY_RESULT",Ze)),Te.innerText=me.alpha??me.key,k.AnswerContent.filter(W=>W.Content===me.key).length>0&&Ie.appendChild(D.correctAnswer?ie:de),Ie.appendChild(Te),U.appendChild(Ie)}),z.push({content:`<br>${I.outerHTML}<br><br><br>`,answers:[]}),z}genLineAnswerTrueFalseType5(D,k){const I=[],b=D.correctAnswer?J.JP:J.ep,z=this.commonService.myTranslateInstant("lang_auto_dung"),U=this.commonService.myTranslateInstant("lang_auto_sai"),N=this.sAztAnswerTrueFalseService.checkLabelKeys([],D?.answers,D?.answerResult),ve=(Ze,tt)=>{const W=document.createElement("span");return W.innerText=Ze,W.setAttribute("color",tt),W},de=document.createElement("table");de.setAttribute("docx-style",J.$s.get("TABLE"));const me=document.createElement("tr"),pe=ve(this.commonService.myTranslateInstant("lang_auto_dap_an")??"",b),Ie=document.createElement("td"),Te=[{key:J.Xe,value:b}];return Te.push({key:J.n1,value:b}),Ie.setAttribute("docx-style",J.$s.get("KEY_RESULT",Te)),D.answers?.forEach(Ze=>{const tt=this.sAztAnswerTrueFalseService.checkIsTrueType5(Ze,N,k.AnswerContent),W=this.commonService.myTranslateInstant(this.sAztAnswerTrueFalseService.getAnswerChoiceTrueFalseQuestion(Ze,k.AnswerContent))??"";Ie.appendChild(((Ze,tt,W)=>{const ot=document.createElement("div"),mt=document.createElement("span"),Kt=tt?J.JP:J.ep;return mt.innerText=(Ze.alpha??Ze.key).toLowerCase()+"-",ot.appendChild(ve(tt?"\u2713":"\u2717",Kt)),ot.appendChild(mt),ot.appendChild(ve(W??"",Kt)),ot})(Ze,tt,W)),Ie.appendChild(document.createElement("br"))}),me.appendChild(((Ze,tt)=>{const W=document.createElement("td");return W.appendChild(Ze),D.answers.length&&D.answers.forEach(ot=>{const mt=document.createElement("span");mt.setAttribute("color",this.sAztAnswerTrueFalseService.checkIsTrueType5(ot,N,k.AnswerContent)?J.JP:J.ep),mt.innerText=` ${(ot.alpha?ot.alpha:ot.key?ot.key:ot).toString().toLowerCase()}-${N.includes((ot.alpha?ot.alpha:ot.key?ot.key:"")+"T")?z:U} `,W.appendChild(mt)}),W.setAttribute("docx-style",tt),W})(pe,J.$s.get("CORRECT",[{key:J.Xe,value:b}]))),me.appendChild(Ie),de.appendChild(me),I.push({content:`<br>${de.outerHTML}<br><br><br><br><br><br>`,answers:[]}),I}genLineAnswerType3(D,k,I){const b=[];return b.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/><br/>`,answers:[]}),0===k.AnswerContent.length?b.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):k.AnswerContent.forEach(z=>{b.push({content:`<span>${z.Content}</span>`,answers:[]})}),b.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${I.mark??0} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${D.scorePerQuestion})</b>`,answers:[]}),b.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_nhan_xet")}:</b> ${I.comment??""}`,answers:[]}),b}genLineAnswerType4(D,k){const I=document.createElement("table"),b=D.correctAnswer?J.JP:J.ep;I.setAttribute("docx-style",J.$s.get("TABLE"));const z=[],U=document.createElement("tr");U.setAttribute("docx-style",J.$s.get("TR")),I.appendChild(U);const N=document.createElement("td");N.setAttribute("docx-style",J.$s.get("CORRECT",[{key:J.Xe,value:b}]));const ve=document.createElement("span");ve.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+D.answerResult?.join(";")+"]",ve.setAttribute("color",b),N.appendChild(ve),U.appendChild(N),0===k.AnswerContent.length&&k.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const ge=document.createElement("td"),ie=document.createElement("span");return ge.setAttribute("docx-style",J.$s.get("FILL_RESULT",[{key:J.Xe,value:b}])),ie.innerText=k.AnswerContent.map(me=>me.Content).join(";"),ge.appendChild(ie),U.appendChild(ge),z.push({content:`<br>${I.outerHTML}<br><br><br>`,answers:[]}),z}loadNameImage(D){return new Promise((k,I)=>{D&&D.nameImages&&parseInt(D?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(D.nameImages).then(b=>{b&&D.nameImages&&(D.nameImages.url=b),k(D)}).catch(b=>{I(b)}):k(D)})}loadCssFrameAction(){return new Promise(D=>{const k=document.createElement("div"),I=b=>{const z=document.createElement("span");return z.style.fontFamily=b,z.innerText="Aa",z};k.appendChild(I("font_chu_dep")),k.appendChild(I("font_chu_dep_z")),k.appendChild(I("font_chu_in")),k.appendChild(I("font_chu_in_nghieng")),k.appendChild(I("font_chu_in_dam")),k.style.opacity="0",document.body.appendChild(k),setTimeout(()=>{k.remove(),D()},2e3)})}loadLibAction(D){return new Promise((k,I)=>{this.commonService.loadAzotaDocxJs().then(()=>{const b=new Ue.n(1,{function:(z,U,N)=>{D.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${z+1}/${U}: ${N}`)}});b.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),b.start().then(z=>{D.remove(),z.errs.length>0?I(z.errs[0]):k()})}).catch(b=>{I(b)})})}reset(){}checkUrlIsImage(D){return null!=D.match(/\.(jpeg|jpg|png|gif)(\?.*)?$/)}loadAztFile(D,k,I){return new Promise((b,z)=>{fetch(this.sAztCommonCdnService.getMyCdn(D.url??"")).then(U=>{U.ok?U.blob().then(N=>{const ge=new File([N],D.name??"",{type:D.mimes});"ans"===I?k.isExportAnsMedia&&k.mediaAnswerWraps.push(ge):k.isExportMedia&&k.mediaWraps.push(ge),b()}):z(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${D.name}`))}).catch(()=>{z(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${D.name}`))})})}wrapLoadMedia(D,k){return this.checkUrlIsImage(D)?(0,gt.qO)(D,k):new Promise((I,b)=>{I(void 0)})}replaceImageToBase64(D,k,I,b,z,U){return new Promise((N,ve)=>{Object.prototype.hasOwnProperty.call(D,k)&&"string"==typeof D[k]?this.wrapLoadMedia(D[k],z).then(ge=>{if(ge){const ie=document.createElement("canvas");ie.width=ge.width,ie.height=ge.height,ie.getContext("2d")?.drawImage(ge,0,0),D[k]=I.canvasList.push(ie)-1,N()}else{U=U?U+1:1;let ie=D[k].split(".");ie=ie.length>0?ie[ie.length-1]:"mp3";const de=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",U.toString(),b])+"."+ie;this.loadAztFile({name:this.commonService.replaceAll(de,"_"," ")??"",url:D[k],path:"",extension:"",mimes:"",size:"0",lastModified:0},I,"ans").then(()=>{N()}).catch(me=>{ve(new Error(this.commonService.myTranslateInstant(me.message)+(b.length>0?" : "+b:"")))})}}).catch(ge=>{ve(new Error(this.commonService.myTranslateInstant(ge.message)+(b.length>0?" : "+b:"")))}):ve(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+(b.length>0?" : "+b:"")))})}loadTeacherDrawResult(D,k,I,b){return new Promise((z,U)=>{const N=b??{canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},ve=new Ue.n(3,{function:(ge,ie)=>{k.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${ge}/${ie})`)}});if(N.resultTeacherDraw=D,N.resultTeacherDraw){N.resultTeacherDraw.pages?.forEach((ie,de)=>{ve.addTask(this,this.replaceImageToBase64,[ie,"backgroundImage",N,I,this.sAztCommonCdnService,de]),ie.draw&&ve.addTask(this,this.replaceImageToBase64,[ie,"draw",N,I,this.sAztCommonCdnService,de])});const ge=this.commonService.castJsonToObj(N.resultTeacherDraw.staticTextConfig??"");if(N.resultTeacherConfig=ge,N.resultTeacherConfig&&N.resultTeacherConfig.urlImgCorrect&&N.resultTeacherConfig.urlImgWrong&&(N.resultTeacherConfig.urlImgCorrect=(N.resultTeacherConfig.type?"":"core-mod-assets/images/classlive/")+N.resultTeacherConfig.urlImgCorrect,N.resultTeacherConfig.urlImgWrong=(N.resultTeacherConfig.type?"":"core-mod-assets/images/classlive/")+N.resultTeacherConfig.urlImgWrong,ve.addTask(this,this.replaceImageToBase64,[N.resultTeacherConfig,"urlImgCorrect",N,I]),ve.addTask(this,this.replaceImageToBase64,[N.resultTeacherConfig,"urlImgWrong",N,I])),N.resultTeacherDraw.commentEmoji&&N.resultTeacherDraw.commentEmoji.length>0)for(let ie=0;ie<N.resultTeacherDraw.commentEmoji.length;ie++)N.resultTeacherDraw.commentEmoji[ie]="https://azota889.github.io/storage_public/mnote/"+N.resultTeacherDraw.commentEmoji[ie],ve.addTask(this,this.replaceImageToBase64,[N.resultTeacherDraw.commentEmoji,ie,N,I])}ve.start().then(ge=>{0===ge.errs.length?z(N):U(ge.errs[0])})})}capitalized(D){return D?D.charAt(0).toUpperCase()+D.slice(1):""}wrapText(D,k,I,b,z,U){const N=document.createElement("span");N.innerHTML=this.commonService.removeXssInHtml(k),(k=N.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(ge=>{for(var ie=ge.split(" "),de="",me=0;me<ie.length;me++){var pe=de+ie[me]+" ";D.measureText(pe).width>z&&me>0?(D.fillText(de,I,b),de=ie[me]+" ",b+=U):de=pe}D.fillText(de,I,b)})}getLineImageAnswer(D){const k=[];return D.mediaAnswerWraps&&D.isExportAnsMedia&&D.mediaAnswerWraps.forEach(I=>{k.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(I.name)}}</span>`,answers:[]})}),D.resultTeacherDraw&&D.resultTeacherDraw.pages?.forEach(I=>{let b=D.canvasList[Number(I.backgroundImage)];if(b){const z=document.createElement("canvas");z.width=I.width??1,z.height=I.height??1;const U=z.getContext("2d");if(U){U.fillStyle="#FFFFFF",U.fillRect(0,0,z.width,z.height);let ge=document.createElement("canvas"),ie=ge.getContext("2d");0!==I.rotation&&ie?(90===Math.abs(I.rotation??0)?(ge.width=b.height,ge.height=b.width):(ge.width=b.width,ge.height=b.height),ie.translate(ge.width/2,ge.height/2),ie.rotate(((I.rotation??0)>0?1:-1)*(I.rotation??0)*Math.PI/180),ie.drawImage(b,-b.width/2,-b.height/2),ie.restore()):ge=b;const de=z.height/ge.height*ge.width;if(U.drawImage(ge,0,0,ge.width,ge.height,(z.width-de)/2,0,de,z.height/ge.height*ge.height),I.draw){const Ie=D.canvasList[Number(I.draw)];Ie&&U.drawImage(Ie,0,0)}if(I.staticText&&I.staticText.length>0&&I.staticText.forEach(Ie=>{if(U.font=`${D.resultTeacherConfig?.fontSize}px ${D.resultTeacherConfig?.fontText}`,U.fillStyle=D.resultTeacherConfig?.fontColor??"#000000",D.resultTeacherConfig?.useCorrectText&&"correct"==Ie.value&&this.wrapText(U,D.resultTeacherConfig?.textCorrect??"",Ie.x,Ie.y,z.width-Ie.x,25),D.resultTeacherConfig?.useCorrectText&&"wrong"==Ie.value&&this.wrapText(U,D.resultTeacherConfig?.textWrong??"",Ie.x,Ie.y,z.width-Ie.x,25),!D.resultTeacherConfig?.useCorrectText&&"correct"==Ie.value){const Te=D.canvasList[Number(D.resultTeacherConfig?.urlImgCorrect)];Te&&U.drawImage(Te,0,0,Te.width,Te.height,Ie.x,Ie.y,30,30)}if(!D.resultTeacherConfig?.useWrongText&&"wrong"==Ie.value){const Te=D.canvasList[Number(D.resultTeacherConfig?.urlImgWrong)];Te&&U.drawImage(Te,0,0,Te.width,Te.height,Ie.x,Ie.y,30,30)}}),I.objText&&I.objText.length>0){let Ie=300;I.objText.forEach(Te=>{U.font=`${parseFloat(Te.textStyle.size)}px ${Te.textStyle.font}`,U.fillStyle=Te.textStyle.color,U.textAlign=Te.textStyle.align??"center",U.lineWidth=Te.textStyle.width??Ie,this.wrapText(U,Te.value,Te.x,Te.y,z.width-Te.x,25)})}}const N=693,ve=N/z.width;k.push({content:`<img src="${z.toDataURL()}" style="width:${N}px;height:${z.height*ve}px" /><br/>`,answers:[]})}}),0===k.length?k.push({content:`<br/><br/>${J.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):k.unshift({content:`<br/>${J.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),k}convertDataMarkNote(D){return new Promise((k,I)=>{D&&D.urlDataMark?this.sAztCommonCdnService.loadTextCdn(this.sAztCommonCdnService.getMyCdn(D.urlDataMark)).subscribe(b=>{const z=this.zipDataService.decodeContentGzip(b),U=this.commonService.castJsonToObj(z);D.pages=[];let N={};U?.pages.forEach((ie,de)=>{let me={width:ie.width,height:ie.height,draw:ie.draws?.[0]?.src??void 0,backgroundImage:ie.backgroundSrc,rotation:ie.backgroundRotate,objText:[],staticText:[]};ie.childData?.length&&ie.childData.forEach((pe,Ie)=>{if("UIQuickMark"==pe.className&&(me.staticText?.push({x:pe.x+5,y:pe.y+(pe.height+5+pe.fontSize)/2,value:"type_right"===pe.type?"correct":"wrong"}),0===Ie&&(N={txtCommentFont:pe.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:pe.width,correctHeight:pe.height,wrongWidth:pe.width,wrongHeight:pe.height,fontText:pe.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:pe.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!N.urlImgWrong&&"type_wrong"==pe.type&&(N.urlImgWrong=pe.imageSrc),!N.urlImgCorrect&&"type_right"==pe.type&&(N.urlImgCorrect=pe.imageSrc),!N.textWrong&&"type_wrong"==pe.type&&(N.textWrong=pe.textContent),!N.textCorrect&&"type_right"==pe.type&&(N.textCorrect=pe.textContent),N.useCorrectText=!N.urlImgCorrect,N.useWrongText=!N.urlImgWrong,"UIText"===pe.className){let Te=this.getStyleContent(pe.textContent);me.objText?.push({x:pe.x+15,y:pe.y+15,value:pe.textContent,textStyle:{size:pe.fontSize?pe.fontSize:Te?.fontSize,align:Te?.textAlign??"left",color:Te?.color,fill:!0,font:Te?.fontFamily}})}}),D.pages?.push(me)}),D.staticTextConfig=this.commonService.serializeJson(N),k(D)}):k(D??{})})}getStyleContent(D){let k=document.createElement("div");k.innerHTML=this.commonService.removeXssInHtml(D);let I=k.querySelector("p"),b=k.querySelector("span");return b?{fontSize:b.style.fontSize,color:b.style.color,fontFamily:b.style.fontFamily,textAlign:I?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(D){return(new DOMParser).parseFromString(D,"text/html").body.textContent??D}replaceParamFileName(D){return D.replace(/\?.*$/,"")}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}constructor(D,k,I,b,z,U,N,ve,ge,ie,de,me,pe,Ie,Te,Ze){this.sAztAnswerTrueFalseService=D,this.homeworkExamService=k,this.checkDrawImgNameService=I,this.sAztCommonCdnService=b,this.zipDataService=z,this.exportPdfUtilsService=U,this.answerTypeService=N,this.exportPdfConvertDataService=ve,this.questionRenderService=ge,this.commonService=ie,this.answerService=de,this.examResultService=me,this.testedListApiService=pe,this.shareFileFlutterService=Ie,this.sAztDialogService=Te,this.sAztDocxService=Ze,this.logger=new Z.Y,this.expandInfoParse={}}}return(Oe=xe).\u0275fac=function(D){return new(D||Oe)(_.KVO(ut.j),_.KVO(et.Z),_.KVO($e.E),_.KVO(Ce.c),_.KVO(Ye.j),_.KVO(st.j),_.KVO(Je._),_.KVO(xt.p),_.KVO(ce.g),_.KVO(Me.R),_.KVO(ye._t),_.KVO(M._j),_.KVO(P.h),_.KVO(H.R),_.KVO(Be.i),_.KVO(Ke.I))},Oe.\u0275prov=_.jDH({token:Oe,factory:Oe.\u0275fac,providedIn:"root"}),xe})()},92229:(_t,Ee,w)=>{"use strict";w.d(Ee,{Y:()=>l});class l{pushChild(h){this.child.push(h)}pushMsg(h){this.msg=h}start(h){this.run=!0,h&&(this.msg=h)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const h=[];return this.msg&&""!==this.msg&&h.push(this.msg),`<p>${h.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let h=[];return this.child.filter(_=>_.run).forEach(_=>{h=h.concat(_.lines)}),h}constructor(h=!1,_="",x){this.run=h,this.msg=_,this.percent=x,this.child=[]}}},44101:(_t,Ee,w)=>{"use strict";w.d(Ee,{i:()=>Uo});var l=w(48891),d=w(407),h=w(59702),_=w(59640),x=w(50622),T=w(99927),re=w(9797),_e=w(46899);let p=(()=>{var O;class De extends _.H{showExplain(){this.isTeacherRole||!this.examConfig||"SHOW_EXPLAIN"!==this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction||this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought?this.isShowExplainChange.emit(!this.isShowExplain):this.showDialogBuyExam(this.examObj)}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage()}showDialogBuyExam(Ae){this.sAztDialogService.open(h.Q,{data:{examObj:Ae},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0})}isKey(Ae){return!(!this.questionObj?.answers||!this.questionObj.answerResult)&&(Ae.key?Ae.key==this.questionObj.answerResult[0]:Ae==this.questionObj.answerResult[0])}haveChoose(Ae){return!!this.userAnswersObj["id_"+this.questionObj?.id]&&(Ae.key?Ae.key.toUpperCase().toString()==this.userAnswersObj["id_"+this.questionObj?.id].toUpperCase():Ae.toString().toUpperCase()==this.userAnswersObj["id_"+this.questionObj?.id].toUpperCase())}findKey(){this.questionObj?.answerResult&&this.labelArr.every(Ae=>!this.questionObj||!this.questionObj.answerResult||this.questionObj.answerResult[0]!=Ae.key||(this.key=(this.isShowOriginAnswer?Ae.key:Ae.alpha??Ae.key)??"",!1))}checkShowExplainButton(){this.isShowExplainButton=!!(this.questionObj.help||"lang_core_show_explain_required_payment"==this.questionObj.help&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigObj?.priceForAction)}checkLabelArr(){this.labelArr=this.sAztAnswerTrueFalseService.checkLabelArrOriginOrMix(this.questionAnswers,this.isShowOriginAnswer),this.findKey()}ngOnChanges(Ae){Ae.isShowOriginAnswer&&this.questionObj&&this.checkLabelArr()}ngOnInit(){if(super.ngOnInit(),this.isFillAnswer=this.questionObj?.correctAnswer??!1,this.answerTypeService.isTrueFalseAnswer(this.questionObj)?(this.keys=this.sAztAnswerTrueFalseService.checkLabelKeys(this.keys,this.questionObj?.answers,this.questionObj?.answerResult),this.isFillAnswer=!0):this.key=this.questionObj?.answerResult.length?this.questionObj.answerResult[0]:"",this.questionAnswers=(0,d.cloneDeep)(this.questionObj.answers??[]),this.checkLabelArr(),this.answerTypeService.isOneChoiceAnswer(this.questionObj))for(let Ae=0;Ae<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[Ae])&&this.haveChoose(this.labelArr[Ae]),!0!==this.isFillAnswer);Ae++);this.answerTypeService.isFillAnswer(this.questionObj)&&this.questionObj?.answerResult&&this.questionObj.answerResult.length>0&&(this.keys=this.questionObj.answerResult,this.isFillAnswer=this.questionObj?.correctAnswer??!1),this.checkShowExplainButton()}constructor(Ae,Ge,Jt,Lt){super(),this.sAztAnswerTrueFalseService=Ae,this.answerTypeService=Ge,this.answerBoxService=Jt,this.sAztDialogService=Lt,this.isShowExplain=!1,this.isOfflineMark=!1,this.isTeacherRole=!0,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.isShowExplainChange=new l.bkB,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1,this.isShowExplainButton=!1,this.questionAnswers=[]}}return(O=De).\u0275fac=function(Ae){return new(Ae||O)(l.rXU(x.j),l.rXU(T._),l.rXU(re.C),l.rXU(_e.i))},O.\u0275cmp=l.VBU({type:O,selectors:[["azt-answer-box-with-user-answer-base"]],inputs:{examObj:"examObj",questionObj:"questionObj",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isTeacherRole:"isTeacherRole",isShowOriginAnswer:"isShowOriginAnswer",examConfig:"examConfig",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab",backToLink:"backToLink"},outputs:{isShowExplainChange:"isShowExplainChange"},features:[l.Vt3,l.OA$],decls:0,vars:0,template:function(Ae,Ge){},encapsulation:2}),De})();var q=w(54460),V=w(15343),R=w(76975);const j=O=>({width:O,visibility:"visible"}),A=()=>({"ml-1":!0}),Y=O=>({color:O}),B=O=>({"border-color":O}),L=()=>({"text-danger wrongIcon mr-1":!0}),v=()=>({"rightIcon text-success mr-1":!0}),F=()=>({"text-danger mr-1":!0}),Q=()=>({"text-success mr-1":!0});function ee(O,De){if(1&O){const E=l.RV6();l.j41(0,"span",7),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",8),l.k0s()}if(2&O){const E=l.XpG();l.Y8G("ngStyle",l.eq3(6,j,E.questionObj.help?"125px":"0px")),l.R7$(),l.SpI(" ",l.bMT(2,4,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",E.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(8,A))}}function te(O,De){1&O&&l.nrm(0,"lucide-icon",18),2&O&&l.Y8G("ngClass",l.lJ4(1,L))}function oe(O,De){if(1&O&&l.DNE(0,te,1,2,"lucide-icon",17),2&O){const E=l.XpG().$implicit,Ae=l.XpG(2);l.Y8G("ngIf",Ae.haveChoose(E))}}function Ve(O,De){1&O&&l.nrm(0,"lucide-icon",19),2&O&&l.Y8G("ngClass",l.lJ4(1,v))}function Se(O,De){if(1&O&&(l.j41(0,"div",13),l.DNE(1,oe,1,1,"ng-template",14)(2,Ve,1,2,"lucide-icon",15),l.j41(3,"span",16),l.EFF(4),l.k0s()()),2&O){const E=De.$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(Ae.isKey(E)&&Ae.haveChoose(E))),l.R7$(),l.Y8G("ngIf",Ae.isKey(E)&&Ae.haveChoose(E)),l.R7$(2),l.JRh(E.alpha?E.alpha:E.key?E.key:E)}}function He(O,De){if(1&O&&(l.j41(0,"div",9)(1,"span",10),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",11),l.DNE(5,Se,5,3,"div",12),l.k0s()()),2&O){const E=l.XpG();l.R7$(),l.Y8G("ngStyle",l.eq3(7,Y,E.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(3,5,"lang_auto_dap_an_dung"),": ",E.key,""),l.R7$(2),l.Y8G("ngStyle",l.eq3(9,B,E.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",E.labelArr)}}function be(O,De){if(1&O&&(l.qex(0),l.j41(1,"span",26),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"mytranslate"),l.k0s(),l.bVm()),2&O){const E=De.$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngStyle",l.eq3(9,Y,l.brH(2,3,E,Ae.keys,Ae.userAnswersObj["id_"+Ae.questionObj.id])?"#00ac33":"red")),l.R7$(2),l.Lme(" ",E.alpha?E.alpha.toLowerCase():E.key?E.key.toLowerCase():E," - ",l.bMT(4,7,Ae.keys.includes((E.alpha?E.alpha:E.key?E.key:"")+"T")?"lang_auto_dung":"lang_auto_sai"),"\xa0 ")}}function ht(O,De){1&O&&l.nrm(0,"lucide-icon",18),2&O&&l.Y8G("ngClass",l.lJ4(1,F))}function it(O,De){1&O&&l.nrm(0,"lucide-icon",19),2&O&&l.Y8G("ngClass",l.lJ4(1,Q))}function nt(O,De){if(1&O&&(l.j41(0,"div",27),l.DNE(1,ht,1,2,"lucide-icon",17),l.nI1(2,"isTrueAnswerType5"),l.DNE(3,it,1,2,"lucide-icon",15),l.nI1(4,"isTrueAnswerType5"),l.j41(5,"span",16),l.EFF(6),l.nI1(7,"getAnswerChoiceTrueFalseQuestion"),l.nI1(8,"mytranslate"),l.k0s()()),2&O){const E=De.$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",!l.brH(2,4,E,Ae.keys,Ae.userAnswersObj["id_"+(null==Ae.questionObj?null:Ae.questionObj.id)])),l.R7$(2),l.Y8G("ngIf",l.brH(4,8,E,Ae.keys,Ae.userAnswersObj["id_"+(null==Ae.questionObj?null:Ae.questionObj.id)])),l.R7$(3),l.Lme("",E.alpha?E.alpha.toLowerCase():E.key?E.key.toLowerCase():E," - ",l.bMT(8,15,l.i5U(7,12,E,Ae.userAnswersObj["id_"+Ae.questionObj.id])),"")}}function Re(O,De){if(1&O&&(l.j41(0,"div",20)(1,"span",21),l.EFF(2),l.nI1(3,"mytranslate"),l.DNE(4,be,5,11,"ng-container",22),l.k0s(),l.j41(5,"div",23)(6,"div",24),l.DNE(7,nt,9,17,"div",25),l.k0s()()()),2&O){const E=l.XpG();l.R7$(2),l.SpI(" ",l.bMT(3,4,"lang_auto_dap_an_dung"),": "),l.R7$(2),l.Y8G("ngForOf",E.labelArr),l.R7$(),l.Y8G("ngStyle",l.eq3(6,B,E.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.Y8G("ngForOf",E.labelArr)}}function rt(O,De){if(1&O&&(l.j41(0,"span",10),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O){const E=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,Y,E.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",E.keys.join("],["),"]")}}function je(O,De){if(1&O&&(l.j41(0,"div",9),l.DNE(1,rt,3,7,"span",28),l.j41(2,"div",29)(3,"div",30),l.EFF(4),l.nI1(5,"trimEndFillAnswer"),l.nI1(6,"mytranslate"),l.k0s()()()),2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf",E.keys),l.R7$(),l.Y8G("ngStyle",l.eq3(8,B,E.isFillAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==E.userAnswersObj["id_"+E.questionObj.id]?l.i5U(5,3,E.userAnswersObj["id_"+E.questionObj.id],E.isOfflineMark):l.bMT(6,6,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function ae(O,De){if(1&O){const E=l.RV6();l.j41(0,"div")(1,"span",33),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG(2);return l.Njj(Ge.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&O&&(l.R7$(2),l.JRh(l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function Qe(O,De){1&O&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function ct(O,De){if(1&O&&(l.qex(0),l.nrm(1,"div",34),l.bVm()),2&O){const E=l.XpG(3);l.R7$(),l.Y8G("innerText",E.userAnswersObj["id_"+E.questionObj.id])}}function We(O,De){if(1&O&&(l.qex(0),l.DNE(1,Qe,3,3,"div",32)(2,ct,2,1,"ng-container",32),l.bVm()),2&O){const E=l.XpG(2);l.R7$(),l.Y8G("ngIf",!E.userAnswersObj["id_"+E.questionObj.id]),l.R7$(),l.Y8G("ngIf",E.userAnswersObj["id_"+E.questionObj.id])}}function ze(O,De){if(1&O&&(l.j41(0,"div",31),l.DNE(1,ae,4,3,"div",32)(2,We,3,2,"ng-container",32),l.k0s()),2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==E.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=E.currentTab)}}function Ue(O,De){if(1&O){const E=l.RV6();l.j41(0,"div",1)(1,"span",7),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.showExplain())}),l.EFF(2),l.nI1(3,"mytranslate"),l.nrm(4,"lucide-icon",8),l.k0s()()}if(2&O){const E=l.XpG();l.R7$(),l.Y8G("ngStyle",l.eq3(6,j,E.questionObj.help?"125px":"0px")),l.R7$(),l.SpI(" ",l.bMT(3,4,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",E.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(8,A))}}let gt=(()=>{var O;class De extends p{ngOnInit(){super.ngOnInit()}}return(O=De).\u0275fac=(()=>{let E;return function(Ge){return(E||(E=l.xGo(O)))(Ge||O)}})(),O.\u0275cmp=l.VBU({type:O,selectors:[["azt-answer-box-with-user-answer-for-teacher"]],features:[l.Vt3],decls:14,vars:18,consts:[[1,"question-standalone-answer-box-for-student","box","shadow-none"],[1,"flex"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k","class","explainTxt text-pending cursor-pointer mt-2",3,"ngStyle","click",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box-type1 mt-2","style","flex-wrap: wrap",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["class","flex",4,"ngIf"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k",1,"explainTxt","text-pending","cursor-pointer","mt-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"answer-box-type1","mt-2"],[1,"keyText","my-1",3,"ngStyle"],["id","type_1",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"answer-box-type1","mt-2",2,"flex-wrap","wrap"],[1,"keyText","my-1"],[4,"ngFor","ngForOf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],[1,"label-item",2,"display","block !important","width","auto !important"],["class","flex w-full mt-1","style","align-items: center",4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"flex","w-full","mt-1",2,"align-items","center"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Ae,Ge){1&Ae&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,ee,4,9,"span",2),l.nI1(3,"isEssayAnswer"),l.k0s(),l.DNE(4,He,6,11,"div",3),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,Re,8,8,"div",4),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,je,7,10,"div",3),l.nI1(9,"isFillAnswer"),l.DNE(10,ze,3,2,"div",5),l.nI1(11,"isEssayAnswer"),l.k0s(),l.DNE(12,Ue,5,9,"div",6),l.nI1(13,"isEssayAnswer")),2&Ae&&(l.R7$(2),l.Y8G("ngIf",Ge.questionObj.help&&!l.bMT(3,6,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(5,8,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,10,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,12,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,14,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",Ge.questionObj.help&&l.bMT(13,16,Ge.questionObj)))},dependencies:[q.YU,q.Sq,q.bT,q.B3,V.WGl,R.wp,R.V6,R.Zm,R.N3,R.FC,R.jr,R.C0,R.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),De})();var Ne=w(65162);const J=O=>({"justify-content":O}),Z=O=>({"mt-3":O}),ut=(O,De)=>({width:O,"margin-right":De}),et=()=>({"ml-1":!0}),$e=O=>[O],Ce=O=>({backto:O}),Ye=()=>({"text-transform":"uppercase"}),st=(O,De)=>({"flex justify-between w-full items-center":O,"answer-box-type1":De}),Je=O=>({"border-color":O}),xt=O=>({color:O}),ce=()=>({"text-danger mr-1":!0}),Me=()=>({"mr-1":!0}),ye=()=>({"text-success mr-1":!0}),M=O=>({"w-full":O}),P=O=>({color:"#00ac33",width:O}),H=(O,De)=>({color:O,width:De}),Be=()=>({color:"red"});function Ke(O,De){if(1&O){const E=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&O){const E=l.XpG();l.Y8G("ngStyle",l.l_i(7,ut,E.isShowExplainButton?"125px":"0px",E.isShowExplainButton?"-40px":"0px")),l.BMQ("style",E.isShowExplainButton&&!E.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",E.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(10,et))}}function ke(O,De){if(1&O&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&O){const E=l.XpG();l.Y8G("routerLink",l.eq3(8,$e,l.bMT(1,4,"/on-luyen/"+E.questionObj.practiceHashId)))("queryParams",l.eq3(10,Ce,E.backToLink))("ngStyle",l.lJ4(12,Ye)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function Oe(O,De){if(1&O&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O){const E=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,xt,E.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung"),": ",E.key,"")}}function xe(O,De){1&O&&l.nrm(0,"span",17)}function qe(O,De){1&O&&l.nrm(0,"lucide-icon",24),2&O&&l.Y8G("ngClass",l.lJ4(1,ce))}function D(O,De){1&O&&l.nrm(0,"lucide-icon",25),2&O&&l.Y8G("ngClass",l.lJ4(1,Me))}function k(O,De){if(1&O&&(l.qex(0),l.DNE(1,qe,1,2,"lucide-icon",23)(2,D,1,2,"lucide-icon",21),l.bVm()),2&O){const E=l.XpG(2).$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",Ae.haveChoose(E)&&2!=Ae.examObj.whenShowAnswer&&!Ae.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",Ae.haveChoose(E)&&2!=Ae.examObj.whenShowAnswer&&Ae.notShowAnswerYet)}}function I(O,De){1&O&&l.nrm(0,"lucide-icon",25),2&O&&l.Y8G("ngClass",l.lJ4(1,Me))}function b(O,De){if(1&O&&(l.qex(0),l.DNE(1,I,1,2,"lucide-icon",21),l.bVm()),2&O){const E=l.XpG(2).$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",Ae.haveChoose(E)&&2==Ae.examObj.whenShowAnswer)}}function z(O,De){1&O&&l.nrm(0,"lucide-icon",25),2&O&&l.Y8G("ngClass",l.lJ4(1,ye))}function U(O,De){if(1&O&&(l.qex(0),l.DNE(1,k,3,2,"ng-container",19)(2,b,2,1,"ng-container",19)(3,z,1,2,"lucide-icon",21),l.j41(4,"span",22),l.EFF(5),l.k0s(),l.bVm()),2&O){const E=l.XpG().$implicit,Ae=l.XpG(2);l.R7$(),l.Y8G("ngIf",!(Ae.isKey(E)&&Ae.haveChoose(E))),l.R7$(),l.Y8G("ngIf",!(Ae.isKey(E)&&Ae.haveChoose(E))),l.R7$(),l.Y8G("ngIf",Ae.isKey(E)&&Ae.haveChoose(E)&&2!=Ae.examObj.whenShowAnswer),l.R7$(2),l.SpI(" ",E.alpha?E.alpha:E.key?E.key:E," ")}}function N(O,De){if(1&O&&(l.j41(0,"span",26),l.EFF(1),l.k0s()),2&O){const E=l.XpG().$implicit,Ae=l.XpG(2);l.Y8G("ngClass",Ae.isKey(E)&&Ae.haveChoose(E)&&2!=Ae.examObj.whenShowAnswer?"b-circle  w-6 h-6 text-success":!Ae.isKey(E)&&Ae.haveChoose(E)&&2!=Ae.examObj.whenShowAnswer?"b-circle  w-6 h-6 text-danger":""),l.R7$(),l.SpI(" ",E.alpha?E.alpha:E.key?E.key:E," ")}}function ve(O,De){if(1&O&&(l.j41(0,"div",18),l.DNE(1,U,6,4,"ng-container",19)(2,N,2,2,"span",20),l.k0s()),2&O){const E=l.XpG(2);l.R7$(),l.Y8G("ngIf",!E.isTqbDomain),l.R7$(),l.Y8G("ngIf",E.isTqbDomain)}}function ge(O,De){if(1&O&&(l.j41(0,"div",11),l.DNE(1,Oe,3,7,"span",12)(2,xe,1,0,"span",13),l.j41(3,"div",14),l.DNE(4,ve,3,2,"div",15),l.k0s()()),2&O){const E=l.XpG();l.Y8G("ngClass",l.l_i(5,st,E.isMobileDevice,!E.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",E.keys&&2==E.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(8,Je,E.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(),l.Y8G("ngForOf",E.labelArr)}}function ie(O,De){if(1&O&&(l.qex(0),l.j41(1,"div",34),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.bVm()),2&O){const E=De.$implicit,Ae=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.eq3(5,P,Ae.isMobileDevice?"50%":"95px")),l.R7$(),l.Lme(" ",E.alpha?E.alpha.toLowerCase():E.key?E.key.toLowerCase():E,") ",l.bMT(3,3,Ae.keys.includes((E.alpha?E.alpha:E.key?E.key:"")+"T")?"lang_auto_dung":"lang_auto_sai")," ")}}function de(O,De){if(1&O&&(l.j41(0,"div",30)(1,"div",31),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",32),l.DNE(5,ie,4,7,"ng-container",33),l.k0s()()),2&O){const E=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_auto_dap_an_dung"),":"),l.R7$(3),l.Y8G("ngForOf",E.labelArr)}}function me(O,De){if(1&O&&(l.qex(0),l.j41(1,"div",34),l.nI1(2,"isTrueAnswerType5"),l.EFF(3),l.nI1(4,"getAnswerChoiceTrueFalseQuestion"),l.nI1(5,"mytranslate"),l.k0s(),l.bVm()),2&O){const E=De.$implicit,Ae=l.XpG(3);l.R7$(),l.Y8G("ngStyle",l.l_i(12,H,l.brH(2,3,E,Ae.keys,Ae.userAnswersObj["id_"+Ae.questionObj.id])?"#00ac33":"red",Ae.isMobileDevice?"50%":"95px")),l.R7$(2),l.Lme(" ",E.alpha?E.alpha.toLowerCase():E.key?E.key.toLowerCase():E,") ",l.bMT(5,10,l.i5U(4,7,E,Ae.userAnswersObj["id_"+Ae.questionObj.id]))," ")}}function pe(O,De){if(1&O&&(l.j41(0,"div",30)(1,"div",31),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.j41(4,"div",32),l.DNE(5,me,6,15,"ng-container",33),l.k0s()()),2&O){const E=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_dap_an_thi_sinh_chon"),":"),l.R7$(3),l.Y8G("ngForOf",E.labelArr)}}function Ie(O,De){if(1&O&&(l.j41(0,"span",34),l.EFF(1),l.k0s()),2&O){const E=l.XpG().$implicit;l.Y8G("ngStyle",l.lJ4(2,Be)),l.R7$(),l.SpI(" ",E.alpha?E.alpha.toLowerCase():E.key?E.key.toLowerCase():E,") \xa0\xa0 ")}}function Te(O,De){if(1&O&&(l.qex(0),l.DNE(1,Ie,2,3,"span",36),l.nI1(2,"isTrueAnswerType5"),l.bVm()),2&O){const E=De.$implicit,Ae=l.XpG(3);l.R7$(),l.Y8G("ngIf",!l.brH(2,1,E,Ae.keys,Ae.userAnswersObj["id_"+Ae.questionObj.id]))}}function Ze(O,De){if(1&O&&(l.j41(0,"div",35)(1,"div",31),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s(),l.DNE(4,Te,3,5,"ng-container",33),l.k0s()),2&O){const E=l.XpG(2);l.R7$(2),l.SpI("",l.bMT(3,2,"lang_core_cau_lam_sai"),":"),l.R7$(2),l.Y8G("ngForOf",E.labelArr)}}function tt(O,De){if(1&O&&(l.j41(0,"div",27),l.DNE(1,de,6,4,"div",28)(2,pe,6,4,"div",28)(3,Ze,5,4,"div",29),l.k0s()),2&O){const E=l.XpG();l.Y8G("ngClass",l.eq3(4,M,E.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet)}}function W(O,De){if(1&O&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O){const E=l.XpG(2);l.Y8G("ngStyle",l.eq3(5,xt,E.isFillAnswer?"#00ac33":"red")),l.R7$(),l.Lme("",l.bMT(2,3,"lang_auto_dap_an_dung_"),"",E.keys.join("],["),"]")}}function ot(O,De){1&O&&l.nrm(0,"span",17)}function mt(O,De){if(1&O&&(l.j41(0,"div",37),l.DNE(1,W,3,7,"span",12)(2,ot,1,0,"span",13),l.j41(3,"div",38)(4,"div",39),l.EFF(5),l.nI1(6,"trimEndFillAnswer"),l.nI1(7,"mytranslate"),l.k0s()()()),2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf",E.keys&&2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet),l.R7$(),l.Y8G("ngIf",E.keys&&2==E.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngStyle",l.eq3(9,Je,E.questionObj.correctAnswer?"#00ac33":"red")),l.R7$(2),l.SpI(" ",void 0!==E.userAnswersObj["id_"+E.questionObj.id]?l.i5U(6,4,E.userAnswersObj["id_"+E.questionObj.id],E.isOfflineMark):l.bMT(7,7,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function Kt(O,De){if(1&O){const E=l.RV6();l.j41(0,"div")(1,"span",41),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG(2);return l.Njj(Ge.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&O&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Bt(O,De){1&O&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Xt(O,De){if(1&O&&(l.qex(0),l.nrm(1,"div",42),l.bVm()),2&O){const E=l.XpG(3);l.R7$(),l.Y8G("innerText",E.userAnswersObj["id_"+E.questionObj.id])}}function zt(O,De){if(1&O&&(l.qex(0),l.DNE(1,Bt,3,3,"div",19)(2,Xt,2,1,"ng-container",19),l.bVm()),2&O){const E=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===E.userAnswersObj["id_"+E.questionObj.id]),l.R7$(),l.Y8G("ngIf",E.userAnswersObj["id_"+E.questionObj.id])}}function mn(O,De){if(1&O&&(l.j41(0,"div",40),l.DNE(1,Kt,4,3,"div",19)(2,zt,3,2,"ng-container",19),l.k0s()),2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==E.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=E.currentTab)}}let nn=(()=>{var O;class De extends p{}return(O=De).\u0275fac=(()=>{let E;return function(Ge){return(E||(E=l.xGo(O)))(Ge||O)}})(),O.\u0275cmp=l.VBU({type:O,selectors:[["azt-answer-box-with-user-full-answer-for-student"]],features:[l.Vt3],decls:12,vars:20,consts:[[1,"question-standalone-answer-box-for-student","box","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center",3,"ngClass"],["class","explainTxt text-pending cursor-pointer","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","mt-2 font-bold",3,"ngClass",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"mt-2","font-bold",3,"ngClass"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"keyText","my-1",3,"ngStyle"],[1,"keyText","my-1","ml-2"],[1,"label-item"],[4,"ngIf"],["class","lalala",3,"ngClass",4,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"lalala",3,"ngClass"],[3,"ngClass"],["class","keyText my-1 font-medium flex flex-wrap",4,"ngIf"],["class","keyText my-1 font-medium text-red flex flex-wrap",4,"ngIf"],[1,"keyText","my-1","font-medium","flex","flex-wrap"],[2,"width","100px"],[1,"flex","justify-between","flex-wrap"],[4,"ngFor","ngForOf"],[1,"lalala",3,"ngStyle"],[1,"keyText","my-1","font-medium","text-red","flex","flex-wrap"],["class","lalala",3,"ngStyle",4,"ngIf"],[1,"answer-box-type1","mt-2"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Ae,Ge){1&Ae&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,Ke,4,11,"span",2)(3,ke,4,13,"a",3),l.k0s(),l.DNE(4,ge,5,10,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,tt,4,6,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,mt,8,11,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,mn,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&Ae&&(l.Y8G("ngStyle",l.eq3(16,J,2==Ge.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(),l.Y8G("ngClass",l.eq3(18,Z,Ge.isMobileDevice)),l.R7$(),l.Y8G("ngIf",2!=Ge.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Ge.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,8,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,10,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,12,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,14,Ge.questionObj)))},dependencies:[q.YU,q.Sq,q.bT,q.B3,Ne.Wk,V.WGl,R.F2,R.wp,R.V6,R.Zm,R.N3,R.FC,R.jr,R.C0,R.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),De})();const rn=O=>({"justify-content":O}),pt=(O,De)=>({width:O,"margin-right":De,"margin-left":"8px"}),xn=()=>({"ml-1":!0}),sr=O=>[O],Wt=O=>({backto:O}),wn=()=>({"text-transform":"uppercase"});function fn(O,De){if(1&O){const E=l.RV6();l.j41(0,"span",8),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.showExplain())}),l.EFF(1),l.nI1(2,"mytranslate"),l.nrm(3,"lucide-icon",9),l.k0s()}if(2&O){const E=l.XpG();l.Y8G("ngStyle",l.l_i(7,pt,E.isShowExplainButton?"125px":"0px",E.isShowExplainButton?"-40px":"0px")),l.BMQ("style",E.isShowExplainButton&&!E.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",l.$dS),l.R7$(),l.SpI(" ",l.bMT(2,5,"lang_auto_giai_thich")," "),l.R7$(2),l.Y8G("name",E.isShowExplain?"chevron-up":"chevron-down")("ngClass",l.lJ4(10,xn))}}function In(O,De){if(1&O&&(l.j41(0,"a",10),l.nI1(1,"navigationLocalize"),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()),2&O){const E=l.XpG();l.Y8G("routerLink",l.eq3(8,sr,l.bMT(1,4,"/on-luyen/"+E.questionObj.practiceHashId)))("queryParams",l.eq3(10,Wt,E.backToLink))("ngStyle",l.lJ4(12,wn)),l.R7$(2),l.SpI(" ",l.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function Pt(O,De){1&O&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function Tn(O,De){1&O&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function En(O,De){if(1&O&&(l.j41(0,"span",13),l.DNE(1,Pt,3,3,"span",14)(2,Tn,3,3,"span",15),l.k0s()),2&O){const E=l.XpG(2);l.R7$(),l.Y8G("ngIf",E.userAnswersObj["id_"+(null==E.questionObj?null:E.questionObj.id)]===E.key),l.R7$(),l.Y8G("ngIf",E.userAnswersObj["id_"+(null==E.questionObj?null:E.questionObj.id)]!==E.key)}}function Qt(O,De){if(1&O){const E=l.RV6();l.j41(0,"div",11),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.showExplain())}),l.DNE(1,En,3,2,"span",12),l.k0s()}if(2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf",2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet)}}function yn(O,De){if(1&O&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.nI1(3,"mytranslate"),l.k0s()),2&O){const E=l.XpG(3);l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")+" "+E.countCorrectAnswerTrueFalse()+" "+l.bMT(3,3,"lang_azt_answer")," ")}}function An(O,De){1&O&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_do_not_choose_any_correct_answer")," "))}function ui(O,De){if(1&O&&(l.j41(0,"span",13),l.DNE(1,yn,4,5,"span",14)(2,An,3,3,"span",15),l.k0s()),2&O){const E=l.XpG(2);l.R7$(),l.Y8G("ngIf",E.countCorrectAnswerTrueFalse()),l.R7$(),l.Y8G("ngIf",!E.countCorrectAnswerTrueFalse())}}function So(O,De){if(1&O){const E=l.RV6();l.j41(0,"div",18),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.showExplain())}),l.DNE(1,ui,3,2,"span",12),l.k0s()}if(2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf",2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet)}}function Ro(O,De){1&O&&(l.j41(0,"span",16),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_have_chosen_correctly")," "))}function Oo(O,De){1&O&&(l.j41(0,"span",17),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_azt_you_chose_wrong")," "))}function Po(O,De){if(1&O&&(l.j41(0,"span",13),l.DNE(1,Ro,3,3,"span",14)(2,Oo,3,3,"span",15),l.k0s()),2&O){const E=l.XpG(2);l.R7$(),l.Y8G("ngIf",E.isFillAnswer),l.R7$(),l.Y8G("ngIf",!E.isFillAnswer)}}function ko(O,De){if(1&O){const E=l.RV6();l.j41(0,"div",19),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.showExplain())}),l.DNE(1,Po,3,2,"span",12),l.k0s()}if(2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf",2!=E.examObj.whenShowAnswer&&!E.notShowAnswerYet)}}function Mo(O,De){if(1&O){const E=l.RV6();l.j41(0,"div")(1,"span",22),l.bIt("click",function(){l.eBV(E);const Ge=l.XpG(2);return l.Njj(Ge.switchToEssayTab())}),l.EFF(2),l.nI1(3,"mytranslate"),l.k0s()()}2&O&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Do(O,De){1&O&&(l.j41(0,"div"),l.EFF(1),l.nI1(2,"mytranslate"),l.k0s()),2&O&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Fo(O,De){if(1&O&&(l.qex(0),l.nrm(1,"div",23),l.bVm()),2&O){const E=l.XpG(3);l.R7$(),l.Y8G("innerText",E.userAnswersObj["id_"+E.questionObj.id])}}function Vo(O,De){if(1&O&&(l.qex(0),l.DNE(1,Do,3,3,"div",21)(2,Fo,2,1,"ng-container",21),l.bVm()),2&O){const E=l.XpG(2);l.R7$(),l.Y8G("ngIf",void 0===E.userAnswersObj["id_"+E.questionObj.id]),l.R7$(),l.Y8G("ngIf",E.userAnswersObj["id_"+E.questionObj.id])}}function zo(O,De){if(1&O&&(l.j41(0,"div",20),l.DNE(1,Mo,4,3,"div",21)(2,Vo,3,2,"ng-container",21),l.k0s()),2&O){const E=l.XpG();l.R7$(),l.Y8G("ngIf","multiple_choice_tab"==E.currentTab),l.R7$(),l.Y8G("ngIf","multiple_choice_tab"!=E.currentTab)}}let No=(()=>{var O;class De extends p{countCorrectAnswerTrueFalse(){return this.labelArr.filter(Ae=>this.sAztAnswerTrueFalseService.checkIsTrueType5(Ae,this.keys,this.userAnswersObj["id_"+this.questionObj?.id])).length}}return(O=De).\u0275fac=(()=>{let E;return function(Ge){return(E||(E=l.xGo(O)))(Ge||O)}})(),O.\u0275cmp=l.VBU({type:O,selectors:[["azt-answer-box-with-user-only-true-or-false-answer-for-student"]],features:[l.Vt3],decls:12,vars:17,consts:[[1,"question-standalone-answer-box-for-student","box","p-2","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center"],["class","explainTxt text-pending cursor-pointer mr-2","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","answer-box-type1 cursor-pointer mt-2",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer","style","flex-wrap: wrap",3,"click",4,"ngIf"],["class","answer-box-type1 mt-2 cursor-pointer",3,"click",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer","mr-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"answer-box-type1","cursor-pointer","mt-2",3,"click"],["class","font-medium text-base my-1 px-1",4,"ngIf"],[1,"font-medium","text-base","my-1","px-1"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-success"],[1,"text-danger"],[1,"answer-box-type1","mt-2","cursor-pointer",2,"flex-wrap","wrap",3,"click"],[1,"answer-box-type1","mt-2","cursor-pointer",3,"click"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Ae,Ge){1&Ae&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,fn,4,11,"span",2)(3,In,4,13,"a",3),l.k0s(),l.DNE(4,Qt,2,1,"div",4),l.nI1(5,"isOneChoiceAnswer"),l.DNE(6,So,2,1,"div",5),l.nI1(7,"isTrueFalseAnswer"),l.DNE(8,ko,2,1,"div",6),l.nI1(9,"isFillAnswer"),l.DNE(10,zo,3,2,"div",7),l.nI1(11,"isEssayAnswer"),l.k0s()),2&Ae&&(l.Y8G("ngStyle",l.eq3(15,rn,2==Ge.examObj.whenShowAnswer?"flex-end":"space-between")),l.R7$(2),l.Y8G("ngIf",2!=Ge.examObj.whenShowAnswer),l.R7$(),l.Y8G("ngIf",Ge.questionObj.practiceHashId),l.R7$(),l.Y8G("ngIf",l.bMT(5,7,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(7,9,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(9,11,Ge.questionObj)),l.R7$(2),l.Y8G("ngIf",l.bMT(11,13,Ge.questionObj)))},dependencies:[q.YU,q.bT,q.B3,Ne.Wk,V.WGl,R.F2,R.wp,R.V6,R.Zm,R.N3,R.FC],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),De})();function jo(O,De){if(1&O){const E=l.RV6();l.j41(0,"azt-answer-box-with-user-full-answer-for-student",2),l.mxI("isShowExplainChange",function(Ge){l.eBV(E);const Jt=l.XpG();return l.DH7(Jt.isShowExplain,Ge)||(Jt.isShowExplain=Ge),l.Njj(Ge)}),l.bIt("isShowExplainChange",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.isShowExplainChange.emit(Ge.isShowExplain))}),l.k0s()}if(2&O){const E=l.XpG();l.Y8G("examObj",E.examObj)("examConfig",E.examConfig)("questionObj",E.questionObj)("userAnswersObj",E.userAnswersObj)("notShowAnswerYet",E.notShowAnswerYet)("isTeacherRole",E.isTeacherRole)("isShowOriginAnswer",E.isShowOriginAnswer),l.R50("isShowExplain",E.isShowExplain),l.Y8G("backToLink",E.backToLink)("isOfflineMark",E.isOfflineMark)("currentTab",E.currentTab)}}function Bo(O,De){if(1&O){const E=l.RV6();l.j41(0,"azt-answer-box-with-user-only-true-or-false-answer-for-student",3),l.mxI("isShowExplainChange",function(Ge){l.eBV(E);const Jt=l.XpG();return l.DH7(Jt.isShowExplain,Ge)||(Jt.isShowExplain=Ge),l.Njj(Ge)}),l.bIt("isShowExplainChange",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.isShowExplainChange.emit(Ge.isShowExplain))}),l.k0s()}if(2&O){const E=l.XpG();l.Y8G("examObj",E.examObj)("examConfig",E.examConfig)("isTeacherRole",E.isTeacherRole)("isShowOriginAnswer",E.isShowOriginAnswer)("questionObj",E.questionObj)("userAnswersObj",E.userAnswersObj)("notShowAnswerYet",E.notShowAnswerYet),l.R50("isShowExplain",E.isShowExplain),l.Y8G("backToLink",E.backToLink)("isOfflineMark",E.isOfflineMark)("currentTab",E.currentTab)}}let Lo=(()=>{var O;class De extends p{constructor(){super(...arguments),this.checkShowFullAnswer=!1}ngOnInit(){this.checkShowFullAnswer=!(this.examConfig&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction&&!this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought)}}return(O=De).\u0275fac=(()=>{let E;return function(Ge){return(E||(E=l.xGo(O)))(Ge||O)}})(),O.\u0275cmp=l.VBU({type:O,selectors:[["azt-answer-box-with-user-answer-for-student"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Ae,Ge){1&Ae&&l.DNE(0,jo,1,11,"azt-answer-box-with-user-full-answer-for-student",0)(1,Bo,1,11,"azt-answer-box-with-user-only-true-or-false-answer-for-student",1),2&Ae&&(l.Y8G("ngIf",Ge.checkShowFullAnswer),l.R7$(),l.Y8G("ngIf",!Ge.checkShowFullAnswer))},dependencies:[q.bT,nn,No],encapsulation:2}),De})();function Go(O,De){if(1&O){const E=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-student",2),l.mxI("isShowExplainChange",function(Ge){l.eBV(E);const Jt=l.XpG();return l.DH7(Jt.isShowExplain,Ge)||(Jt.isShowExplain=Ge),l.Njj(Ge)}),l.bIt("isShowExplainChange",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.isShowExplainChange.emit(Ge.isShowExplain))}),l.k0s()}if(2&O){const E=l.XpG();l.Y8G("examObj",E.examObj)("examConfig",E.examConfig)("questionObj",E.questionObj)("userAnswersObj",E.userAnswersObj)("notShowAnswerYet",E.notShowAnswerYet)("isTeacherRole",E.isTeacherRole)("isShowOriginAnswer",E.isShowOriginAnswer),l.R50("isShowExplain",E.isShowExplain),l.Y8G("backToLink",E.backToLink)("isOfflineMark",E.isOfflineMark)("currentTab",E.currentTab)}}function hi(O,De){if(1&O){const E=l.RV6();l.j41(0,"azt-answer-box-with-user-answer-for-teacher",3),l.mxI("isShowExplainChange",function(Ge){l.eBV(E);const Jt=l.XpG();return l.DH7(Jt.isShowExplain,Ge)||(Jt.isShowExplain=Ge),l.Njj(Ge)}),l.bIt("isShowExplainChange",function(){l.eBV(E);const Ge=l.XpG();return l.Njj(Ge.isShowExplainChange.emit(Ge.isShowExplain))}),l.k0s()}if(2&O){const E=l.XpG();l.Y8G("examObj",E.examObj)("examConfig",E.examConfig)("questionObj",E.questionObj)("userAnswersObj",E.userAnswersObj)("notShowAnswerYet",E.notShowAnswerYet)("isShowOriginAnswer",E.isShowOriginAnswer)("isTeacherRole",E.isTeacherRole),l.R50("isShowExplain",E.isShowExplain),l.Y8G("backToLink",E.backToLink)("isOfflineMark",E.isOfflineMark)("currentTab",E.currentTab)}}let Uo=(()=>{var O;class De extends p{ngOnInit(){}}return(O=De).\u0275fac=(()=>{let E;return function(Ge){return(E||(E=l.xGo(O)))(Ge||O)}})(),O.\u0275cmp=l.VBU({type:O,selectors:[["azt-answer-box-view-base"]],features:[l.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Ae,Ge){1&Ae&&l.DNE(0,Go,1,11,"azt-answer-box-with-user-answer-for-student",0)(1,hi,1,11,"azt-answer-box-with-user-answer-for-teacher",1),2&Ae&&(l.Y8G("ngIf",!Ge.isTeacherRole),l.R7$(),l.Y8G("ngIf",Ge.isTeacherRole))},dependencies:[q.bT,gt,Lo],encapsulation:2}),De})()},84278:(_t,Ee,w)=>{"use strict";w.d(Ee,{x:()=>ee});var l=w(64486),d=w(66793),h=w(78111),_=w(48891),x=w(54460),T=w(42789),re=w(60780),_e=w(58447),p=w(15423),q=w(52325),V=w(54313),R=w(34660),j=w(97760),A=w(44101);const Y=te=>({"skeleton-box-loading":te}),B=te=>({"pb-2":te}),L=()=>[];function v(te,oe){if(1&te&&_.nrm(0,"div",3),2&te){const Ve=_.XpG();_.Y8G("ngClass",_.eq3(1,Y,Ve.renderConfigObj.isFirstRender))}}function F(te,oe){if(1&te&&_.nrm(0,"azt-test-audio-ui",15),2&te){const Ve=_.XpG(2);_.Y8G("questionObj",Ve.questionObj)("isShowList",!0)}}function Q(te,oe){if(1&te){const Ve=_.RV6();_.j41(0,"div",4)(1,"div",5),_.nrm(2,"azt-question-group-content-box",6),_.j41(3,"div",7),_.DNE(4,F,1,2,"azt-test-audio-ui",8),_.j41(5,"div",9),_.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),_.k0s(),_.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),_.k0s()(),_.j41(10,"azt-answer-box-view-base",13),_.mxI("isShowExplainChange",function(He){_.eBV(Ve);const be=_.XpG();return _.DH7(be.isShowExplain,He)||(be.isShowExplain=He),_.Njj(He)}),_.bIt("isShowExplainChange",function(He){_.eBV(Ve);const be=_.XpG();return _.Njj(be.isShowExplain=He)}),_.k0s(),_.nrm(11,"azt-question-explain-box",14),_.k0s()}if(2&te){let Ve;const Se=_.XpG();_.R7$(),_.xc7("font-size","1em")("line-height","1.7"),_.Y8G("id","question_render_container_"+Se.questionObj.id)("ngClass",_.eq3(43,B,Se.questionObj.attachments.length>0)),_.R7$(),_.Y8G("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj),_.R7$(2),_.Y8G("ngIf",Se.questionObj.attachments.length>0),_.R7$(2),_.Y8G("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj)("curQuestionIndex",Se.curQuestionIndex),_.R7$(),_.Y8G("showForTeacher",!1)("curExamResultId",null!==(Ve=Se.curExamResultId)&&void 0!==Ve?Ve:0)("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj)("curQuestionIndex",Se.curQuestionIndex)("orgExamObjs",_.lJ4(45,L)),_.R7$(),_.Y8G("examObj",Se.examObj)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj),_.R7$(),_.Y8G("userAnswersObj",Se.userAnswersObj)("examObj",Se.examObj)("isShowOriginAnswer",Se.isShowOriginAnswer)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj),_.R7$(),_.Y8G("examObj",Se.examObj)("examConfig",Se.examConfig)("isTeacherRole",!1)("isShowOriginAnswer",Se.isShowOriginAnswer)("questionObj",Se.questionObj)("userAnswersObj",Se.userAnswersObj)("notShowAnswerYet",Se.notShowAnswerYet),_.R50("isShowExplain",Se.isShowExplain),_.Y8G("backToLink",Se.backToLink)("isOfflineMark",Se.isOfflineMark)("currentTab",Se.currentTab),_.R7$(),_.Y8G("isShowExplain",Se.isShowExplain)("questionObj",Se.questionObj)("renderConfigObj",Se.renderConfigObj)}}let ee=(()=>{var te;class oe extends l.I{ngOnInit(){super.ngOnInit();let Se=new d.C(!1,!1,!1);super.initData(Se,this.follower,this.questionObj),this.backToLink=`/test/answer-test/${this.examObj?.tenantId??0}/${this.examObj?.categoryId??0}/${this.examObj?.hashId}/${this.curExamResultId}`}constructor(){super(),this.follower=new h.e,this.curQuestionIndex=0,this.isShowExplain=!1,this.isShowOriginAnswer=!1,this.isOfflineMark=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.checkShowFullAnswer=!1}}return(te=oe).\u0275fac=function(Se){return new(Se||te)},te.\u0275cmp=_.VBU({type:te,selectors:[["azt-question-standalone-for-student-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId",examConfig:"examConfig",isShowExplain:"isShowExplain",isShowOriginAnswer:"isShowOriginAnswer",isOfflineMark:"isOfflineMark",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[_.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"box","border-none","pt-2",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","curExamResultId","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"userAnswersObj","examObj","isShowOriginAnswer","questionObj","renderConfigObj"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Se,He){if(1&Se&&(_.j41(0,"div",1),_.DNE(1,v,1,3,"div",2)(2,Q,12,46,"ng-template",null,0,_.C5r),_.k0s()),2&Se){const be=_.sdS(3);_.Y8G("id","question_render_element_"+He.questionObj.id),_.R7$(),_.Y8G("ngIf",!He.renderConfigObj.isRenderElement)("ngIfElse",be)}},dependencies:[x.YU,x.bT,T.N,re.c,_e.y,p.N,q.Q,V.$,R.S,j.U,A.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),oe})()},34815:(_t,Ee,w)=>{"use strict";w.d(Ee,{o:()=>Q});var l=w(64486),d=w(66793),h=w(78111),_=w(48891),x=w(54460),T=w(42789),re=w(60780),_e=w(58447),p=w(15423),q=w(52325),V=w(54313),R=w(34660),j=w(97760),A=w(44101);const Y=ee=>({"skeleton-box-loading":ee}),B=ee=>({"mob-web-width":ee});function L(ee,te){if(1&ee&&_.nrm(0,"div",3),2&ee){const oe=_.XpG();_.Y8G("ngClass",_.eq3(1,Y,oe.renderConfigObj.isFirstRender))}}function v(ee,te){if(1&ee&&_.nrm(0,"azt-test-audio-ui",15),2&ee){const oe=_.XpG(2);_.Y8G("questionObj",oe.questionObj)("isShowList",!0)}}function F(ee,te){if(1&ee){const oe=_.RV6();_.j41(0,"div",4)(1,"div",5),_.nrm(2,"azt-question-group-content-box",6),_.j41(3,"div",7),_.DNE(4,v,1,2,"azt-test-audio-ui",8),_.j41(5,"div",9),_.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),_.k0s(),_.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),_.k0s()(),_.j41(10,"azt-answer-box-view-base",13),_.mxI("isShowExplainChange",function(Se){_.eBV(oe);const He=_.XpG();return _.DH7(He.isShowExplain,Se)||(He.isShowExplain=Se),_.Njj(Se)}),_.bIt("isShowExplainChange",function(Se){_.eBV(oe);const He=_.XpG();return _.Njj(He.isShowExplain=Se)}),_.k0s(),_.nrm(11,"azt-question-explain-box",14),_.k0s()}if(2&ee){const oe=_.XpG();_.R7$(),_.xc7("font-size","1em")("line-height","1.7"),_.Y8G("id","question_render_container_"+oe.questionObj.id)("ngClass",_.eq3(39,B,oe.isMobileWebView)),_.R7$(),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj),_.R7$(2),_.Y8G("ngIf",oe.questionObj.attachments.length>0),_.R7$(2),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj)("curQuestionIndex",oe.curQuestionIndex),_.R7$(),_.Y8G("showForTeacher",!0)("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj)("curQuestionIndex",oe.curQuestionIndex)("orgExamObjs",oe.orgExamObjs),_.R7$(),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj),_.R7$(),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("isShowOriginAnswer",oe.isShowOriginAnswer)("renderConfigObj",oe.renderConfigObj),_.R7$(),_.Y8G("examObj",oe.examObj)("isTeacherRole",!0)("isShowOriginAnswer",oe.isShowOriginAnswer)("questionObj",oe.questionObj)("userAnswersObj",oe.userAnswersObj)("notShowAnswerYet",oe.notShowAnswerYet)("isOfflineMark",oe.isOfflineMark),_.R50("isShowExplain",oe.isShowExplain),_.Y8G("currentTab",oe.currentTab),_.R7$(),_.Y8G("isShowExplain",oe.isShowExplain)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj)}}let Q=(()=>{var ee;class te extends l.I{ngOnInit(){super.ngOnInit();let Ve=new d.C(!1,!1,!1);super.initData(Ve,this.follower,this.questionObj)}constructor(){super(),this.follower=new h.e,this.curQuestionIndex=0,this.orgExamObjs=[],this.isShowExplain=!1,this.isOfflineMark=!1,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab"}}return(ee=te).\u0275fac=function(Ve){return new(Ve||ee)},ee.\u0275cmp=_.VBU({type:ee,selectors:[["azt-question-standalone-for-teacher-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",orgExamObjs:"orgExamObjs",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isShowOriginAnswer:"isShowOriginAnswer",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[_.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"pt-2","pb-3","box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","questionObj","isShowOriginAnswer","renderConfigObj"],[3,"isShowExplainChange","examObj","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isOfflineMark","isShowExplain","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Ve,Se){if(1&Ve&&(_.j41(0,"div",1),_.DNE(1,L,1,3,"div",2)(2,F,12,41,"ng-template",null,0,_.C5r),_.k0s()),2&Ve){const He=_.sdS(3);_.Y8G("id","question_render_element_"+Se.questionObj.id),_.R7$(),_.Y8G("ngIf",!Se.renderConfigObj.isRenderElement)("ngIfElse",He)}},dependencies:[x.YU,x.bT,T.N,re.c,_e.y,p.N,q.Q,V.$,R.S,j.U,A.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),te})()},97760:(_t,Ee,w)=>{"use strict";w.d(Ee,{U:()=>He});var l=w(59640),d=w(95887),h=w(89163),_=w(33887),x=w(25539),T=w(48891),re=w(47290),_e=w(54460),p=w(52654),q=w(2915),V=w(52811),R=w(76975);function j(be,ht){1&be&&(T.j41(0,"div",10)(1,"span",11),T.nrm(2,"azt-loading-ui"),T.k0s(),T.j41(3,"span",12),T.EFF(4),T.nI1(5,"mytranslate"),T.k0s()()),2&be&&(T.R7$(4),T.JRh(T.bMT(5,1,"lang_auto_dang_chuan_bi_tai_lieu_doing")))}function A(be,ht){1&be&&(T.j41(0,"div",13),T.EFF(1),T.nI1(2,"mytranslate"),T.k0s()),2&be&&(T.R7$(),T.SpI(" ",T.bMT(2,1,"lang_azt_cau_hoi_chua_co_lan_sua_nao")," "))}function Y(be,ht){if(1&be&&T.nrm(0,"azt-question-standalone-for-preview",17),2&be){const it=T.XpG().$implicit,nt=T.XpG();T.Y8G("examObj",nt.data.examObj)("questionObj",it.questionLog)("follower",nt.data.follower)("curQuestionIndex",nt.data.curQuestionIndex)}}function B(be,ht){if(1&be&&(T.qex(0),T.j41(1,"div",14),T.EFF(2),T.nI1(3,"mytranslate"),T.nI1(4,"formatFullDateTimeWithoutSecondByUserUnitPipe"),T.k0s(),T.j41(5,"div",15),T.DNE(6,Y,1,4,"azt-question-standalone-for-preview",16),T.k0s(),T.bVm()),2&be){const it=ht.$implicit;T.R7$(2),T.SpI(" ",T.bMT(3,2,"lang_azota_ui_the_time_of_question_editing")+": "+T.bMT(4,4,it.createdAt)," "),T.R7$(4),T.Y8G("ngIf",it.questionLog)}}let L=(()=>{var be;class ht extends _._{closeDialog(){this.dialogRef.close()}getLogQuestion(nt){this.initStatusObj(),this.waitDestroy(this.questionService.apiQuestionsIdLogsGet(nt,this.data.isTeacher?void 0:this.data.curExamResultId).subscribe(Re=>{Re.success?((Re.data?.objs??[]).forEach(je=>{let ae={createdAt:je.createdAt,questionLog:this.commonService.castJsonToClassObj(x.I,JSON.stringify(je.questionLog))};ae.questionLog&&(ae.questionLog.isLogEditQuestion=!0),this.questionLogCustomList.push(ae)}),this.successStatusObj()):this.errorStatusObj(Re.message??"",!0)}))}ngOnInit(){this.getLogQuestion(this.data.questionObj.id)}constructor(nt,Re,rt){super(rt,Re),this.questionService=nt,this.dialogRef=Re,this.data=rt,this.questionLogCustomList=[]}}return(be=ht).\u0275fac=function(nt){return new(nt||be)(T.rXU(re.wP),T.rXU(h.CP,8),T.rXU(h.Vh,8))},be.\u0275cmp=T.VBU({type:be,selectors:[["show-question-edit-history-dialog"]],features:[T.Vt3],decls:15,vars:13,consts:[[1,"box"],[1,"font-medium","p-3","bg-slate-100","dark:bg-darkmode-400"],[3,"defaultHeight"],["class","flex justify-center items-center h-40",4,"ngIf"],["id","boxContentQuestion",1,"p-2"],["class","flex p-5 justify-center items-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","pt-3"],[1,"ml-auto"],[1,"btn","btn-secondary",3,"click"],[1,"flex","justify-center","items-center","h-40"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"flex","p-5","justify-center","items-center"],[1,"p-2","pb-0","text-xs","font-medium",2,"margin-bottom","-10px"],[1,"p-2"],[3,"examObj","questionObj","follower","curQuestionIndex",4,"ngIf"],[3,"examObj","questionObj","follower","curQuestionIndex"]],template:function(nt,Re){1&nt&&(T.j41(0,"div",0)(1,"div",1),T.EFF(2),T.nI1(3,"mytranslate"),T.nI1(4,"mytranslate"),T.k0s(),T.j41(5,"azt-mat-dialog-content",2),T.DNE(6,j,6,3,"div",3),T.j41(7,"div",4),T.DNE(8,A,3,3,"div",5)(9,B,7,6,"ng-container",6),T.k0s()(),T.j41(10,"div",7)(11,"div",8)(12,"button",9),T.bIt("click",function(){return Re.closeDialog()}),T.EFF(13),T.nI1(14,"mytranslate"),T.k0s()()()()),2&nt&&(T.R7$(2),T.Lme(" ",T.bMT(3,7,"lang_azota_ui_the_history_of_question_editing")," (",Re.questionLogCustomList.length+" "+T.bMT(4,9,"lang_testbank_powerpoint_times"),") "),T.R7$(3),T.Y8G("defaultHeight",60),T.R7$(),T.Y8G("ngIf",Re.statusObj.loading),T.R7$(2),T.Y8G("ngIf",!Re.questionLogCustomList.length&&!Re.statusObj.loading),T.R7$(),T.Y8G("ngForOf",Re.questionLogCustomList),T.R7$(4),T.SpI(" ",T.bMT(14,11,"lang_auto_dong")," "))},dependencies:[_e.Sq,_e.bT,p.a,q.U,V.R,R.wp,R.bH],encapsulation:2}),ht})();var v=w(78111),F=w(46899),Q=w(65162),ee=w(9691),te=w(47712),oe=w(15343);function Ve(be,ht){if(1&be){const it=T.RV6();T.j41(0,"div")(1,"button",2),T.nI1(2,"mytranslate"),T.bIt("click",function(){T.eBV(it);const Re=T.XpG();return T.Njj(Re.goToEditQuestion())}),T.nrm(3,"lucide-icon",3),T.k0s()()}2&be&&(T.R7$(),T.FS9("matTooltip",T.bMT(2,1,"lang_core_chinh_sua_de_thi")))}function Se(be,ht){if(1&be){const it=T.RV6();T.j41(0,"div")(1,"button",2),T.nI1(2,"mytranslate"),T.bIt("click",function(){T.eBV(it);const Re=T.XpG();return T.Njj(Re.showEditHistoryDialog())}),T.nrm(3,"lucide-icon",4),T.k0s()()}2&be&&(T.R7$(),T.FS9("matTooltip",T.bMT(2,1,"lang_azota_ui_the_history_of_question_editing")))}let He=(()=>{var be;class ht extends l.H{checkEditQuestion(){const nt=this.questionObj?.createdAt,Re=this.questionObj?.updatedAt;let rt=this.timeService.calculationTimeOnlyMinutes(nt,Re);this.isEditQuestion=Number(rt)>0}isOrgQuestion(){return null!=this.orgExamObjs.find(nt=>nt.questionId==this.questionObj.id)}goToEditQuestion(){var nt=this.commonService.getMyParam(this.activeRoute,"cat_id")??"0",Re=this.activeRoute.snapshot.paramMap.get("result_id")??"0",rt=this.activeRoute.snapshot.paramMap.get("user_id")??"",je=this.activeRoute.snapshot.paramMap.get("student_id")??"",ae=this.activeRoute.snapshot.paramMap.get("exam_id")??"",Qe=nt,ct=ae;let We=this.orgExamObjs.find(gt=>gt.questionId==this.questionObj.id);We&&(Qe=We.orgCategoryId?.toString()??"0",ct=We.orgExamId?.toString()??"0");var ze=this.commonService.getMyQueryParam("backto")??"";let Ue=`/admin/testbank/test-review/${ae}/${rt}/${je}/${Re}`+(ze?"?backto="+encodeURIComponent(ze):"");window.location.href=this.commonService.getLocalRouter("/admin/testbank/update-exam/"+Qe)+"/"+ct+"?backto="+encodeURIComponent(Ue)+"&questionId="+this.questionObj.id}showEditHistoryDialog(){let nt={follower:new v.e,examObj:this.examObj,questionObj:this.questionObj,renderConfigObj:this.renderConfigObj,curQuestionIndex:this.curQuestionIndex,curExamResultId:this.curExamResultId,isTeacher:this.showForTeacher};this.sAztDialogService.open(L,{width:"750px",data:nt})}showFeedbackQuestionDialog(){this.sAztDialogService.open(d.g,{width:"750px",data:{questionObj:this.questionObj,role:this.showForTeacher?"TEACHER":"STUDENT",applyType:"MATRIX_QUESTION"},restoreFocus:!1,autoFocus:!1})}ngOnChanges(){this.checkEditQuestion()}constructor(nt,Re,rt){super(),this.sAztDialogService=nt,this.activeRoute=Re,this.timeService=rt,this.showForTeacher=!1,this.curExamResultId=0,this.isEditQuestion=!1}}return(be=ht).\u0275fac=function(nt){return new(nt||be)(T.rXU(F.i),T.rXU(Q.nX),T.rXU(ee.F))},be.\u0275cmp=T.VBU({type:be,selectors:[["azt-question-action-box"]],inputs:{examObj:"examObj",questionObj:"questionObj",renderConfigObj:"renderConfigObj",orgExamObjs:"orgExamObjs",showForTeacher:"showForTeacher",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId"},features:[T.Vt3,T.OA$],decls:4,vars:4,consts:[[1,"flex"],[4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","p-1",3,"click","matTooltip"],["name","file-pen-line","size","18"],["name","history","size","18"]],template:function(nt,Re){1&nt&&(T.j41(0,"div",0),T.DNE(1,Ve,4,3,"div",1),T.nI1(2,"isOfflineExam"),T.DNE(3,Se,4,3,"div",1),T.k0s()),2&nt&&(T.R7$(),T.Y8G("ngIf",Re.isOrgQuestion()&&!T.bMT(2,2,Re.examObj)),T.R7$(2),T.Y8G("ngIf",Re.isEditQuestion&&!Re.questionObj.isLogEditQuestion))},dependencies:[_e.bT,te.oV,oe.WGl,R.wp,R.st],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ht})()},9797:(_t,Ee,w)=>{"use strict";w.d(Ee,{C:()=>h});var l=w(18447),d=w(48891);let h=(()=>{var _;class x{constructor(){this.switchEssayTabSource=new l.B,this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(){this.switchEssayTabSource.next(!0)}}return(_=x).\u0275fac=function(re){return new(re||_)},_.\u0275prov=d.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),x})()},95887:(_t,Ee,w)=>{"use strict";w.d(Ee,{g:()=>nt});var l=w(10936),d=w(89163),h=w(33887),_=w(15766),x=w(48891),T=w(74978),re=w(54460),_e=w(43404),p=w(15343),q=w(81587),V=w(52811),R=w(9570),j=w(76975);const A=(Re,rt)=>({"btn-primary":Re,"btn-secondary":rt}),Y=()=>({"mr-2":!0});function B(Re,rt){if(1&Re&&(x.j41(0,"div",22)(1,"b",23),x.EFF(2),x.k0s(),x.j41(3,"div",24),x.nrm(4,"azt-dynamic-hook",17),x.k0s()()),2&Re){let je;const ae=rt.$implicit;x.R7$(2),x.SpI("",null!==(je=ae.alpha)&&void 0!==je?je:ae.key,"."),x.R7$(2),x.Y8G("content",ae.content)}}function L(Re,rt){if(1&Re&&(x.j41(0,"div",20),x.DNE(1,B,5,2,"div",21),x.k0s()),2&Re){const je=x.XpG(2);x.R7$(),x.Y8G("ngForOf",je.data.questionObj.answers)}}function v(Re,rt){if(1&Re&&(x.j41(0,"h2",25),x.EFF(1),x.nI1(2,"mytranslate"),x.k0s()),2&Re){const je=x.XpG(2);x.R7$(),x.Lme(" ",x.bMT(2,2,"lang_auto_dap_an"),": ",je.data.questionObj.answerResult.join(", ")," ")}}function F(Re,rt){if(1&Re&&(x.j41(0,"div",8)(1,"h2",10),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",16),x.nrm(5,"azt-dynamic-hook",17),x.k0s(),x.DNE(6,L,2,1,"div",18)(7,v,3,4,"h2",19),x.k0s()),2&Re){const je=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,4,"lang_auto_noi_dung_cau_hoi")," "),x.R7$(3),x.Y8G("content",je.data.questionObj.content),x.R7$(),x.Y8G("ngIf",1==je.data.questionObj.answerType&&je.data.questionObj.answers&&je.data.questionObj.answers.length>0),x.R7$(),x.Y8G("ngIf",je.data.questionObj.answerResult&&je.data.questionObj.isRoleTeacher)}}function Q(Re,rt){if(1&Re&&(x.j41(0,"div",8)(1,"h2",26),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",27),x.nrm(5,"azt-dynamic-hook",17),x.k0s()()),2&Re){const je=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,2,"lang_auto_loi_giai")," "),x.R7$(3),x.Y8G("content",je.data.questionObj.help)}}function ee(Re,rt){1&Re&&(x.qex(0),x.j41(1,"div",28)(2,"span",29),x.nrm(3,"azt-loading-ui"),x.k0s()(),x.bVm())}function te(Re,rt){if(1&Re&&(x.j41(0,"div",44),x.nrm(1,"input",45),x.j41(2,"label",46),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()()),2&Re){const je=rt.$implicit,ae=rt.index;x.R7$(),x.FS9("id","choice_"+ae),x.FS9("formControlName","choice_"+ae),x.R7$(),x.FS9("for","choice_"+ae),x.R7$(),x.SpI(" ",x.bMT(4,4,je)," ")}}function oe(Re,rt){if(1&Re&&(x.qex(0),x.j41(1,"div",42),x.DNE(2,te,5,6,"div",43),x.k0s(),x.bVm()),2&Re){const je=x.XpG().$implicit;x.R7$(),x.FS9("formGroupName","survey_"+je.id),x.R7$(),x.Y8G("ngForOf",je.choices)}}function Ve(Re,rt){if(1&Re&&(x.qex(0),x.j41(1,"mat-radio-button",49),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.bVm()),2&Re){const je=rt.$implicit,ae=x.XpG(2).$implicit,Qe=x.XpG(3);x.R7$(),x.FS9("value",je),x.Y8G("checked",Qe.form.controls["survey_"+ae.id].value==je),x.R7$(),x.JRh(x.bMT(3,3,je))}}function Se(Re,rt){if(1&Re&&(x.j41(0,"mat-radio-group",47),x.DNE(1,Ve,4,5,"ng-container",48),x.k0s()),2&Re){const je=x.XpG().$implicit;x.FS9("formControlName","survey_"+je.id),x.R7$(),x.Y8G("ngForOf",je.choices)}}function He(Re,rt){if(1&Re&&(x.j41(0,"div",39)(1,"div",40)(2,"h2",41),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()(),x.j41(5,"div"),x.DNE(6,oe,3,2,"ng-container",11)(7,Se,2,2,"ng-template",null,1,x.C5r),x.k0s()()),2&Re){const je=rt.$implicit,ae=rt.index,Qe=x.sdS(8);x.R7$(3),x.Lme(" ",ae+1+". ","",x.bMT(4,4,je.content)," "),x.R7$(3),x.Y8G("ngIf",je.multiChoice&&je.choices&&je.choices.length>1)("ngIfElse",Qe)}}function be(Re,rt){if(1&Re&&(x.j41(0,"div"),x.DNE(1,He,9,6,"div",38),x.k0s()),2&Re){const je=x.XpG(2);x.R7$(),x.Y8G("ngForOf",je.surveyObjs)}}function ht(Re,rt){if(1&Re){const je=x.RV6();x.DNE(0,be,2,1,"div",30),x.j41(1,"div",31)(2,"button",32),x.bIt("click",function(){x.eBV(je);const Qe=x.XpG();return x.Njj(Qe.changeFeedBackEmotion(2))}),x.nrm(3,"lucide-icon",33),x.j41(4,"span"),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s()(),x.j41(7,"button",34),x.bIt("click",function(){x.eBV(je);const Qe=x.XpG();return x.Njj(Qe.changeFeedBackEmotion(1))}),x.nrm(8,"lucide-icon",35),x.j41(9,"span"),x.EFF(10),x.nI1(11,"mytranslate"),x.k0s()()(),x.j41(12,"div",36)(13,"textarea",37),x.nI1(14,"mytranslate"),x.bIt("keyup",function(){x.eBV(je);const Qe=x.XpG();return x.Njj(Qe.autoResizeFeedBackArea())}),x.k0s()()}if(2&Re){const je=x.XpG();x.Y8G("ngIf",je.surveyObjs.length),x.R7$(2),x.Y8G("disabled",je.disableLike)("ngClass",x.l_i(16,A,2==je.feedBackEmotion,2!=je.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(19,Y)),x.R7$(2),x.JRh(x.bMT(6,10,"lang_test_market_introduce_rating_like")),x.R7$(2),x.Y8G("disabled",je.disableLike)("ngClass",x.l_i(20,A,1==je.feedBackEmotion,1!=je.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(23,Y)),x.R7$(2),x.JRh(x.bMT(11,12,"lang_test_market_introduce_rating_dislike")),x.R7$(3),x.FS9("placeholder",x.bMT(14,14,"lang_global_question_ask_to_feedback_placeholder"))}}function it(Re,rt){1&Re&&(x.j41(0,"span",50),x.nrm(1,"azt-loading-ui"),x.k0s())}let nt=(()=>{var Re;class rt extends h._{getAnswerSurvey(){let ae=[],Qe=this.commonService.getFormObj(this.form);for(let ct in Qe)if(ct.includes("survey_")){let We={surveyId:Number(ct.substring(ct.indexOf("_")+1)),answers:[]};if(Qe[ct]instanceof Object){let ze=this.surveyObjs.find(Ue=>Ue.id==We.surveyId);if(ze)for(let Ue in Qe[ct])if(Qe[ct][Ue]){let gt=Number(Ue.substring(Ue.indexOf("_")+1));if(Array.isArray(ze.choices)&&ze.choices[gt]){let Ne=ze.choices[gt];We.answers?.push(Ne)}}}else We.answers=[Qe[ct]];ae.push(We)}return ae}getFeedbackSurveys(){this.loadingFeedBackSurvey=!0,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksSurveysGet(this.applyType,this.role).subscribe(ae=>{if(1==ae.success){this.surveyObjs=ae.data?.objs??[];let Qe={feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,_.M.noWhiteSpace]})};this.surveyObjs.length>0&&this.surveyObjs.forEach(ct=>{if(ct.multiChoice&&ct.choices&&ct.choices.length>1){let We={};Qe[`survey_${ct.id}`]=new l.gE({}),ct.choices.forEach((ze,Ue)=>{We[`choice_${Ue}`]=new l.MJ(!1,{nonNullable:!0})}),Qe[`survey_${ct.id}`]=this.fb.group(We)}else Qe[`survey_${ct.id}`]=new l.MJ("",{nonNullable:!0,validators:[l.k0.required]})}),this.form=this.fb.group(Qe),this.loadingFeedBackSurvey=!1}else this.errorStatusObj(ae.message??"",!0),this.loadingFeedBackSurvey=!1}))}getInfoFeedback(){this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksGet(this.questionId,this.applyType,this.role).subscribe(ae=>{if(1==ae.success){let Qe=ae.data?.objs??[];Qe.length&&Qe[0].status&&(this.feedBackEmotion=Qe[0].status,this.disableLike=!0)}else this.errorStatusObj(ae.message??"",!0),this.disableLike=!1}))}changeFeedBackEmotion(ae){this.disableLike||(this.feedBackEmotion=ae,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost({objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??void 0,content:"",surveyAnswers:[]}).subscribe(ct=>{1==ct.success?this.getInfoFeedback():this.errorStatusObj(ct.message??"",!0)})))}autoResizeFeedBackArea(){const ae=document.getElementById("text-area-feedback");ae&&setTimeout(()=>{ae.style.cssText="height:auto;",ae.style.cssText="height:"+(ae.scrollHeight+30)+"px"},0)}sendFeedBack(){if(this.form.invalid)this.showErrorSnack("lang_auto_vui_long_dien_day_du_thong_tin");else{this.initStatusObj(),this.sendingFeedBack=!0;let ae={objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??0,content:this.form.controls.feedBackContent.value??void 0,surveyAnswers:this.getAnswerSurvey()};this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost(ae).subscribe(Qe=>{1==Qe.success?(this.sendingFeedBack=!1,this.dialogRef.close(!0),this.successStatusObj("TEACHER"==this.role?"lang_test_market_success_feedback":"lang_test_market_success_feedback_student",!0)):(this.errorStatusObj(Qe.message??"",!0),this.sendingFeedBack=!1)}))}}btnCloseDialog(){this.dialogRef.close(!1)}ngOnInit(){this.questionId=this.data.questionObj.id,this.role=this.data.role,this.applyType=this.data.applyType,this.form=this.fb.group({feedBackContent:new l.MJ("",{nonNullable:!0,validators:[l.k0.required,_.M.noWhiteSpace]})}),this.getInfoFeedback(),this.getFeedbackSurveys(),super.ngOnInit()}constructor(ae,Qe,ct,We){super(We,ct),this.fb=ae,this.testMarketFeedbackService=Qe,this.dialogRef=ct,this.data=We,this.role="",this.applyType="",this.form=new l.gE({}),this.feedBackEmotion=void 0,this.totalLike=0,this.totalDislike=0,this.sendingFeedBack=!1,this.loadingFeedBackSurvey=!1,this.disableLike=!1,this.surveyObjs=[]}}return(Re=rt).\u0275fac=function(ae){return new(ae||Re)(x.rXU(l.ok),x.rXU(T.l_),x.rXU(d.CP,8),x.rXU(d.Vh,8))},Re.\u0275cmp=x.VBU({type:Re,selectors:[["exam-matrix-feedback-dialog"]],features:[x.Vt3],decls:25,vars:19,consts:[["doneLoading",""],["SingleChoice",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-3","border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"intro-y","overflow-auto",2,"max-height","calc(100vh - 150px)"],[1,"text-md","mr-auto","font-bold"],["class","border-t border-slate-200/60 dark:border-darkmode-400 py-2 mt-2",4,"ngIf"],[1,"border-t","border-slate-200/60","dark:border-darkmode-400","py-2","mt-2"],[3,"formGroup"],[1,"font-medium","text-md","text-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"p-3","text-right"],["azt-track-service","exam-matrix-feedback-dialog-qXEblgFcT",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","exam-matrix-feedback-dialog-NGlD5D-IvA",1,"btn","btn-primary","mw-24",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"tex2jax_process","box-content",2,"width","auto"],[3,"content"],["class","grid grid-cols-12 gap-2 answers",4,"ngIf"],["class","font-medium text-md text-left text-success my-2",4,"ngIf"],[1,"grid","grid-cols-12","gap-2","answers"],["class","answer col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"answer","col-span-12","md:col-span-6"],[1,"answer-label"],[1,"answer-content"],[1,"font-medium","text-md","text-left","text-success","my-2"],[1,"font-medium","text-md","text-center"],[1,"help-content","box","px-3","mt-1",2,"display","inherit","border-top-right-radius","0","border-top-left-radius","0","box-shadow","none","overflow","auto","padding-bottom","20px"],[1,"flex","items-center","h-full","w-full"],[1,"w-8","h-8","mx-auto"],[4,"ngIf"],[1,"flex","items-center",2,"flex-wrap","wrap"],["azt-track-service","exam-matrix-feedback-dialog-PoMeFnagK",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-up","size","24",3,"ngClass"],["azt-track-service","exam-matrix-feedback-dialog-iJokCn34oQ",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-down","size","20",3,"ngClass"],[1,"items-center","mt-1"],["id","text-area-feedback","type","text","cols","10","rows","3","formControlName","feedBackContent",1,"form-control","mt-1",3,"keyup","placeholder"],["class","flex flex-wrap mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","mb-2"],[2,"min-width","300px"],[1,"text-md","mb-2"],[1,"block","px-2","ml-2","sm:flex",3,"formGroupName"],["class","mr-5",4,"ngFor","ngForOf"],[1,"mr-5"],["type","checkbox",1,"form-check-input",3,"id","formControlName"],[2,"vertical-align","middle","cursor","pointer","margin-left","3px",3,"for"],["color","primary",1,"px-2",2,"flex-direction","column",3,"formControlName"],[4,"ngFor","ngForOf"],[1,"mr-5",3,"checked","value"],[1,"w-4","h-4","mr-2"]],template:function(ae,Qe){if(1&ae){const ct=x.RV6();x.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s(),x.DNE(7,F,8,6,"div",7)(8,Q,6,4,"div",7),x.j41(9,"div",8)(10,"form",9)(11,"h2",10),x.EFF(12),x.nI1(13,"mytranslate"),x.k0s(),x.DNE(14,ee,4,0,"ng-container",11)(15,ht,15,24,"ng-template",null,0,x.C5r),x.k0s()()()()(),x.j41(17,"div",12)(18,"button",13),x.bIt("click",function(){return x.eBV(ct),x.Njj(Qe.btnCloseDialog())}),x.EFF(19),x.nI1(20,"mytranslate"),x.k0s(),x.j41(21,"button",14),x.bIt("click",function(){return x.eBV(ct),x.Njj(Qe.sendFeedBack())}),x.DNE(22,it,2,0,"span",15),x.EFF(23),x.nI1(24,"mytranslate"),x.k0s()()()}if(2&ae){const ct=x.sdS(16);x.R7$(5),x.SpI(" ",x.bMT(6,11,Qe.data.questionObj.isRoleTeacher?"lang_global_question_ask_to_feedback":"lang_global_question_ask_to_report")," "),x.R7$(2),x.Y8G("ngIf",Qe.data.questionObj.content),x.R7$(),x.Y8G("ngIf",Qe.data.questionObj.help&&Qe.data.questionObj.isRoleTeacher),x.R7$(2),x.Y8G("formGroup",Qe.form),x.R7$(2),x.SpI(" ",x.bMT(13,13,"lang_auto_nhan_xet")," "),x.R7$(2),x.Y8G("ngIf",Qe.loadingFeedBackSurvey)("ngIfElse",ct),x.R7$(5),x.SpI(" ",x.bMT(20,15,"lang_auto_dong")," "),x.R7$(2),x.Y8G("disabled",Qe.sendingFeedBack||Qe.form.invalid),x.R7$(),x.Y8G("ngIf",Qe.sendingFeedBack),x.R7$(),x.SpI(" ",x.bMT(24,17,"lang_button_send")," ")}},dependencies:[re.YU,re.Sq,re.bT,_e.VT,_e._g,l.qT,l.me,l.Zm,l.BC,l.cb,l.j4,l.JD,l.$R,p.WGl,q.t,V.R,R.x,j.wp],styles:[".answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}"]}),rt})()},14987:(_t,Ee,w)=>{"use strict";w.d(Ee,{i:()=>_e});var l=w(59640),d=w(48891),h=w(54460),_=w(10936),x=w(81587),T=w(76975);function re(p,q){if(1&p&&(d.j41(0,"div",1)(1,"form",2),d.nrm(2,"input",3),d.nI1(3,"mytranslate"),d.nrm(4,"input",4),d.nI1(5,"mytranslate"),d.nrm(6,"input",5),d.nI1(7,"mytranslate"),d.nrm(8,"input",6),d.nI1(9,"mytranslate"),d.nrm(10,"input",7),d.nI1(11,"mytranslate"),d.k0s()()),2&p){const V=d.XpG();d.R7$(),d.Y8G("formGroup",V.form),d.R7$(),d.FS9("placeholder",d.bMT(3,6,"lang_azt_addition_info_exam_department_name")),d.R7$(2),d.FS9("placeholder",d.bMT(5,8,"lang_auto_ten_truong")),d.R7$(2),d.FS9("placeholder",d.bMT(7,10,"lang_azt_addition_info_exam_test_note")),d.R7$(2),d.FS9("placeholder",d.bMT(9,12,"lang_auto_mon_hoc_form")),d.R7$(2),d.FS9("placeholder",d.bMT(11,14,"lang_auto_thoi_gian"))}}let _e=(()=>{var p;class q extends l.H{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject,departmentName:this.examPrintInfoObj.departmentName,indetifyBox:this.examPrintInfoObj.indetifyBox,timeBox:this.examPrintInfoObj.timeBox})}ngOnInit(){this.initData()}}return(p=q).\u0275fac=function(R){return new(R||p)},p.\u0275cmp=d.VBU({type:p,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},features:[d.Vt3],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","department-name","type","text","formControlName","departmentName",1,"form-control","mt-3",3,"placeholder"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","indetify-box","type","text","formControlName","indetifyBox",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"],["id","time-box","type","text","formControlName","timeBox",1,"form-control","mt-3",3,"placeholder"]],template:function(R,j){1&R&&d.DNE(0,re,12,16,"div",0),2&R&&d.Y8G("ngIf",j.form)},dependencies:[h.bT,_.qT,_.me,_.BC,_.cb,_.j4,_.JD,x.t,T.wp],encapsulation:2}),q})()},30551:(_t,Ee,w)=>{"use strict";w.d(Ee,{P:()=>F});var l=w(59640),d=w(48891),h=w(37642),_=w(36484),x=w(99927),T=w(54460),re=w(60303),_e=w(76975);const p=Q=>({"font-bold":Q});function q(Q,ee){if(1&Q&&(d.j41(0,"td",11),d.EFF(1),d.k0s()),2&Q){const te=d.XpG().$implicit,oe=d.XpG().$implicit,Ve=d.XpG(2);d.BMQ("rowspan",oe.length),d.R7$(),d.JRh(Ve.toNumber(te.index)+1)}}function V(Q,ee){if(1&Q&&(d.qex(0),d.j41(1,"tr"),d.DNE(2,q,2,2,"td",10),d.j41(3,"td",11),d.EFF(4),d.nI1(5,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(6,"td",12),d.EFF(7),d.k0s()(),d.bVm()),2&Q){const te=ee.$implicit,oe=ee.index,Ve=d.XpG(3);d.R7$(2),d.Y8G("ngIf",0==oe),d.R7$(2),d.JRh(d.bMT(5,4,1e3*te.second)),d.R7$(2),d.Y8G("ngClass",d.eq3(6,p,te.isFontBold)),d.R7$(),d.JRh(Ve.isShowOriginAnswer?te.key:te.alpha?te.alpha:te.key)}}function R(Q,ee){if(1&Q&&(d.qex(0),d.DNE(1,V,8,8,"ng-container",9),d.bVm()),2&Q){const te=ee.$implicit;d.R7$(),d.Y8G("ngForOf",te)}}function j(Q,ee){if(1&Q&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,R,2,1,"ng-container",9),d.k0s()),2&Q){const te=d.XpG();d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_cau_hoi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"lang_auto_dap_an")),d.R7$(2),d.Y8G("ngForOf",te.groupObjs)}}function A(Q,ee){1&Q&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Q&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}function Y(Q,ee){if(1&Q&&(d.qex(0),d.j41(1,"tr")(2,"td",11),d.EFF(3),d.k0s(),d.j41(4,"td",11),d.EFF(5),d.nI1(6,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(7,"td",11),d.EFF(8),d.k0s()(),d.bVm()),2&Q){let te;const oe=ee.$implicit;d.R7$(3),d.JRh(oe.userAgent),d.R7$(2),d.JRh(d.bMT(6,3,null!==(te=oe.startedAt)&&void 0!==te?te:"")),d.R7$(3),d.JRh(oe.ip)}}function B(Q,ee){if(1&Q&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,Y,9,5,"ng-container",9),d.k0s()),2&Q){const te=d.XpG(2);d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_thong_tin_thiet_bi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"IP")),d.R7$(2),d.Y8G("ngForOf",te.ipTrackingDataObjs)}}function L(Q,ee){1&Q&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Q&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu")))}function v(Q,ee){if(1&Q&&(d.j41(0,"mat-tab",1),d.nI1(1,"mytranslate"),d.j41(2,"div",2),d.DNE(3,B,12,10,"table",3)(4,L,3,3,"ng-template",null,0,d.C5r),d.k0s()()),2&Q){const te=d.sdS(5),oe=d.XpG();d.FS9("label",d.bMT(1,3,"lang_auto_thong_tin_thiet_bi_IP")),d.R7$(3),d.Y8G("ngIf",oe.ipTrackingDataObjs.length>0)("ngIfElse",te)}}let F=(()=>{var Q;class ee extends l.H{findReTapQuesions(){var oe=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var Ve in oe)if(oe.hasOwnProperty(Ve)){var Se=oe[Ve].map((He,be)=>{let ht=!1,it=this.questionObjs.find(nt=>nt.id==He.questionId);if(this.answerTypeService.isTrueFalseAnswer(it)){for(let nt=oe[Ve].length-1;nt>=0;nt--)if(oe[Ve][nt].key.includes(He.key.split("")[0])){ht=He.key==oe[Ve][nt].key;break}}else ht=be==oe[Ve].length-1;return{...He,isFontBold:ht}});this.groupObjs.push(Se)}}toNumber(oe){return parseInt(oe,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(oe,Ve,Se){super(),this.dictionaryService=oe,this.userService=Ve,this.answerTypeService=Se,this.startQuestionIndex=1,this.isShowOriginAnswer=!1,this.ipTrackingDataObjs=[],this.isTeacherRole=this.userService.isTeacherRole(),this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return(Q=ee).\u0275fac=function(oe){return new(oe||Q)(d.rXU(h.E),d.rXU(_.R),d.rXU(x._))},Q.\u0275cmp=d.VBU({type:Q,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",isShowOriginAnswer:"isShowOriginAnswer",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs",ipTrackingDataObjs:"ipTrackingDataObjs",questionObjs:"questionObjs"},features:[d.Vt3],decls:8,vars:6,consts:[["noData",""],[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],[3,"label",4,"ngIf"],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(oe,Ve){if(1&oe&&(d.j41(0,"mat-tab-group")(1,"mat-tab",1),d.nI1(2,"mytranslate"),d.j41(3,"div",2),d.DNE(4,j,12,10,"table",3)(5,A,3,3,"ng-template",null,0,d.C5r),d.k0s()(),d.DNE(7,v,6,5,"mat-tab",4),d.k0s()),2&oe){const Se=d.sdS(6);d.R7$(),d.FS9("label",d.bMT(2,4,"lang_auto_chi_tiet_chon_dap_an")),d.R7$(3),d.Y8G("ngIf",Ve.groupObjs.length>0)("ngIfElse",Se),d.R7$(3),d.Y8G("ngIf",Ve.isTeacherRole)}},dependencies:[T.YU,T.Sq,T.bT,re.mq,re.T8,_e.wp,_e.Ky],encapsulation:2}),ee})()},78745:(_t,Ee,w)=>{"use strict";w.d(Ee,{d:()=>Y});var l=w(59640),d=w(48891),h=w(54460),_=w(17818),x=w(47712),T=w(15343),re=w(52509),_e=w(64160),p=w(15437),q=w(76975);const V=()=>({"mr-2":!0});function R(B,L){if(1&B){const v=d.RV6();d.qex(0),d.j41(1,"div",6)(2,"p",7),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"p",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"div",8),d.nrm(9,"input",9),d.j41(10,"button",10),d.bIt("click",function(){d.eBV(v);const Q=d.XpG();return d.Njj(Q.showCopySuccess())}),d.nrm(11,"lucide-icon",11),d.EFF(12),d.nI1(13,"mytranslate"),d.k0s()()(),d.bVm()}if(2&B){const v=d.XpG();d.R7$(3),d.JRh(d.bMT(4,6,"lang_auto_hoac")),d.R7$(3),d.JRh(d.bMT(7,8,"lang_classroom_QR_join_link_copy")),d.R7$(3),d.Y8G("value",v.linkUrl),d.R7$(),d.Y8G("cdkCopyToClipboard",v.copyLinkToClipboard(v.linkUrl)),d.R7$(),d.Y8G("ngClass",d.lJ4(12,V)),d.R7$(),d.SpI(" ",d.bMT(13,10,"lang_auto_sao_chep")," ")}}let j=(()=>{var B;class L extends l.H{showCopySuccess(){this.showSuccessSnack("lang_auto_sao_chep_thanh_cong")}copyLinkToClipboard(F){return F}onChangeURL(F){this.qrCodeDownloadLink=F}downloadQrCode(){try{let F=""!=this.fileName?this.commonService.createFileNameExportFile([this.fileName])+".jpg":this.commonService.createFileNameExportFile(["azota-qr-code-"])+".jpg";this.commonService.blobToBytes(this.qrCodeDownloadLink.changingThisBreaksApplicationSecurity).then(Q=>{var ee=btoa(String.fromCharCode(...Q));console.log(Q),this.mobileWebviewService.sendDataToApp("DOWNLOAD_QR_CODE",{base64:ee,fileName:F})}).catch(Q=>console.error("L?i:",Q))}catch{console.log("Download QrCode error")}}constructor(F){super(),this.mobileWebviewService=F,this.linkUrl="",this.fileName="",this.showLink=!1,this.qrCodeDownloadLink=""}}return(B=L).\u0275fac=function(F){return new(F||B)(d.rXU(re.f))},B.\u0275cmp=d.VBU({type:B,selectors:[["azt-show-link"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:8,vars:11,consts:[["azt-track-service","download-qr-code-9t-9Wiu2xv",1,"box","p-3","text-center"],[2,"background","#fff","padding","5px"],["colorDark","#2361ad","imageSrc","'images/Azota-For-QrCode-01.png' | coreModConvertCdnLinkOfGitHub",3,"qrCodeURL","allowEmptyString","qrdata","elementType","width","errorCorrectionLevel"],["azt-track-service","download-qr-code-RqVBz6g1z7",1,"btn","btn-outline-primary","btn-transparent","btn-sm","mx-auto","mt-2",3,"click"],["name","download","size","16",3,"ngClass"],[4,"ngIf"],[1,"text-center"],[1,"h5","mt-2","font-medium"],[1,"azt-copy","relative","mt-2"],["type","text","readonly","",1,"form-control","py-3","px-4","border-transparent","bg-slate-100","pr-10",2,"padding-right","120px",3,"value"],["azt-track-service","download-qr-code-yW-aFu0tO",1,"btn","btn-outline-primary","absolute","my-auto","inset-y-0","right-0",2,"border-top-left-radius","0","border-bottom-left-radius","0",3,"click","cdkCopyToClipboard"],["name","copy","size","16",3,"ngClass"]],template:function(F,Q){1&F&&(d.j41(0,"div",0)(1,"div",1)(2,"qrcode",2),d.bIt("qrCodeURL",function(te){return Q.onChangeURL(te)}),d.k0s()(),d.j41(3,"a",3),d.bIt("click",function(){return Q.downloadQrCode()}),d.nrm(4,"lucide-icon",4),d.EFF(5),d.nI1(6,"mytranslate"),d.k0s(),d.DNE(7,R,14,13,"ng-container",5),d.k0s()),2&F&&(d.R7$(2),d.Y8G("allowEmptyString",!0)("qrdata",Q.linkUrl)("elementType","url")("width",128)("errorCorrectionLevel","M"),d.R7$(2),d.Y8G("ngClass",d.lJ4(10,V)),d.R7$(),d.SpI(" ",d.bMT(6,8,"lang_auto_tai_ve_may")," "),d.R7$(2),d.Y8G("ngIf",Q.showLink))},dependencies:[h.YU,h.bT,_e.dF,T.WGl,p.c,q.wp],encapsulation:2}),L})();const A=B=>({"w-80":B});let Y=(()=>{var B;class L extends l.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1}}return(B=L).\u0275fac=(()=>{let v;return function(Q){return(v||(v=d.xGo(B)))(Q||B)}})(),B.\u0275cmp=d.VBU({type:B,selectors:[["azt-download-qr-code"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:7,vars:10,consts:[["showQrCode","matMenu"],["azt-track-service","download-qr-code-hiQXy_iTc",1,"btn","btn-outline-primary","btn-transparent","p-1",3,"matMenuTriggerFor","matTooltip"],["name","qr-code","size","24"],["xPosition","before"],[3,"ngClass"],[3,"linkUrl","fileName","showLink"]],template:function(F,Q){if(1&F&&(d.j41(0,"button",1),d.nI1(1,"mytranslate"),d.nrm(2,"lucide-icon",2),d.k0s(),d.j41(3,"mat-menu",3,0)(5,"div",4),d.nrm(6,"azt-show-link",5),d.k0s()()),2&F){const ee=d.sdS(4);d.FS9("matTooltip",d.bMT(1,6,"lang_auto_quet_hoac_tai_ma_qr_code")),d.Y8G("matMenuTriggerFor",ee),d.R7$(5),d.Y8G("ngClass",d.eq3(8,A,Q.showLink)),d.R7$(),d.Y8G("linkUrl",Q.linkUrl)("fileName",Q.fileName)("showLink",Q.showLink)}},dependencies:[h.YU,_.kk,_.Cp,x.oV,T.WGl,j,q.wp],encapsulation:2}),L})()},72802:(_t,Ee,w)=>{"use strict";w.d(Ee,{f:()=>J});var l=w(27691),d=w(48891),h=w(10936),_=w(67421),x=w(59640),T=w(78111),re=w(83229),_e=w(51913),p=w(58112),q=w(55465),V=w(76476),R=w(41426),j=w(54460),A=w(47712),Y=w(15343),B=w(7919),L=w(81587),v=w(84278),F=w(34815),Q=w(76975);const ee=["mnoteContainer"],te=Z=>({display:Z}),oe=Z=>({border:Z}),Ve=()=>({"mr-1":!0}),Se=Z=>({"is-invalid":Z});function He(Z,ut){1&Z&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function be(Z,ut){1&Z&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function ht(Z,ut){1&Z&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function it(Z,ut){if(1&Z&&(d.j41(0,"div",18),d.DNE(1,He,3,3,"span",19)(2,be,3,3,"span",19)(3,ht,3,3,"span",19),d.k0s()),2&Z){const et=d.XpG().index,$e=d.XpG();d.R7$(),d.Y8G("ngIf",null==$e.form.controls["cau"+et].errors?null:$e.form.controls["cau"+et].errors.min),d.R7$(),d.Y8G("ngIf",null==$e.form.controls["cau"+et].errors?null:$e.form.controls["cau"+et].errors.max),d.R7$(),d.Y8G("ngIf",null==$e.form.controls["cau"+et].errors?null:$e.form.controls["cau"+et].errors.pattern)}}function nt(Z,ut){if(1&Z){const et=d.RV6();d.j41(0,"div",11)(1,"div",12)(2,"lucide-icon",13),d.nI1(3,"mytranslate"),d.bIt("click",function(Ce){const Ye=d.eBV(et).index,st=d.XpG();return d.Njj(st.toggleVisibility(Ce,Ye))}),d.k0s(),d.j41(4,"span",14),d.EFF(5),d.nI1(6,"mytranslate"),d.j41(7,"span",15),d.nI1(8,"mytranslate"),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.nrm(11,"input",16),d.nI1(12,"mytranslate"),d.k0s(),d.DNE(13,it,4,3,"div",17),d.k0s()}if(2&Z){let et;const $e=ut.$implicit,Ce=ut.index,Ye=d.XpG();d.Y8G("ngStyle",d.eq3(25,oe,Ce==Ye.questions.length-1?"none":"")),d.R7$(2),d.FS9("matTooltip",d.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),d.Y8G("ngClass",d.lJ4(27,Ve)),d.R7$(3),d.Lme(" ",d.bMT(6,17,"lang_auto_cau")," ",(null!==(et=$e.indexLabel)&&void 0!==et?et:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",$e.essMaxPoint," ",d.bMT(10,21,"lang_auto_diem_brackets"),""),d.R7$(2),d.FS9("placeholder",d.bMT(12,23,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",Ce,""),d.Y8G("readonly",!Ye.showForTeacher)("decimal",!0)("ngClass",d.eq3(28,Se,Ye.form.controls["cau"+Ce]&&Ye.form.controls["cau"+Ce].invalid)),d.R7$(2),d.Y8G("ngIf",Ye.form.controls["cau"+Ce].errors)}}function Re(Z,ut){if(1&Z){const et=d.RV6();d.j41(0,"div",20)(1,"button",21),d.bIt("click",function(){d.eBV(et);const Ce=d.XpG();return d.Njj(Ce.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Z){const et=d.XpG();d.R7$(),d.Y8G("disabled",et.isLoading||et.form.invalid),d.R7$(),d.SpI(" ",et.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}function rt(Z,ut){if(1&Z&&d.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Z){let et;const $e=d.XpG().$implicit,Ce=d.XpG();d.Y8G("follower",Ce.followerRenderQuest)("examObj",Ce.examObj)("examConfig",Ce.examConfig)("questionObj",$e)("curQuestionIndex",null!==(et=$e.indexLabel)&&void 0!==et?et:0)("userAnswersObj",Ce.userAnswersObj)("currentTab","essay_tab")}}function je(Z,ut){if(1&Z&&d.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Z){let et;const $e=d.XpG().$implicit,Ce=d.XpG();d.Y8G("follower",Ce.followerRenderQuest)("examObj",Ce.examObj)("questionObj",$e)("curQuestionIndex",null!==(et=$e.indexLabel)&&void 0!==et?et:0)("userAnswersObj",Ce.userAnswersObj)("orgExamObjs",Ce.orgExamObjs)("currentTab","essay_tab")}}function ae(Z,ut){1&Z&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Qe(Z,ut){1&Z&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function ct(Z,ut){1&Z&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function We(Z,ut){if(1&Z&&(d.j41(0,"div",18),d.DNE(1,ae,3,3,"span",19)(2,Qe,3,3,"span",19)(3,ct,3,3,"span",19),d.k0s()),2&Z){const et=d.XpG(2).index,$e=d.XpG();d.R7$(),d.Y8G("ngIf",null==$e.form.controls["cau"+et].errors?null:$e.form.controls["cau"+et].errors.min),d.R7$(),d.Y8G("ngIf",null==$e.form.controls["cau"+et].errors?null:$e.form.controls["cau"+et].errors.max),d.R7$(),d.Y8G("ngIf",null==$e.form.controls["cau"+et].errors?null:$e.form.controls["cau"+et].errors.pattern)}}function ze(Z,ut){if(1&Z&&(d.j41(0,"div",29)(1,"form",30)(2,"label",31),d.EFF(3),d.nI1(4,"mytranslate"),d.j41(5,"span",15),d.nI1(6,"mytranslate"),d.EFF(7),d.nI1(8,"mytranslate"),d.k0s(),d.EFF(9," : "),d.k0s(),d.nrm(10,"input",32),d.nI1(11,"mytranslate"),d.DNE(12,We,4,3,"div",17),d.k0s()()),2&Z){let et;const $e=d.XpG(),Ce=$e.$implicit,Ye=$e.index,st=d.XpG();d.R7$(),d.Y8G("formGroup",st.form),d.R7$(),d.FS9("for","cau_"+Ye),d.R7$(),d.Lme(" ",d.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(et=Ce.indexLabel)&&void 0!==et?et:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",Ce.essMaxPoint," ",d.bMT(8,19,"lang_auto_diem_brackets"),""),d.R7$(3),d.FS9("placeholder",d.bMT(11,21,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",Ye,""),d.Y8G("readonly",!st.showForTeacher)("ngClass",d.eq3(23,Se,st.form.controls["cau"+Ye]&&st.form.controls["cau"+Ye].invalid))("id","cau_"+Ye)("decimal",!0),d.R7$(2),d.Y8G("ngIf",st.form.controls["cau"+Ye].errors)}}function Ue(Z,ut){if(1&Z&&(d.j41(0,"div",22)(1,"div",23),d.DNE(2,rt,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,je,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,ze,13,25,"div",26),d.k0s()()),2&Z){const et=ut.index,$e=d.XpG();d.R7$(),d.Mz_("id","q_",et,""),d.R7$(),d.Y8G("ngIf",!$e.showForTeacher),d.R7$(),d.Y8G("ngIf",$e.showForTeacher),d.R7$(),d.Y8G("ngIf",$e.showForTeacher)}}function gt(Z,ut){1&Z&&(d.j41(0,"div",33)(1,"b"),d.EFF(2),d.nI1(3,"mytranslate"),d.k0s(),d.EFF(4),d.nI1(5,"mytranslate"),d.k0s()),2&Z&&(d.R7$(2),d.SpI("",d.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),d.R7$(2),d.SpI(" ",d.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Ne(Z,ut){if(1&Z){const et=d.RV6();d.j41(0,"div",34)(1,"button",35),d.bIt("click",function(){d.eBV(et);const Ce=d.XpG();return d.Njj(Ce.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Z){const et=d.XpG();d.R7$(),d.Y8G("disabled",et.isLoading||et.form.invalid),d.R7$(),d.SpI(" ",et.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}let J=(()=>{var Z;class ut extends x.H{parseValue($e){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[$e]}getMaxPoint($e){var Ce=0;for(let Ye=0;Ye<this.questions.length;Ye++)if(this.questions[Ye].id==$e){Ce=this.questions[Ye].scorePerQuestion??0;break}return Ce}toggleVisibility($e,Ce){var Ye=$e.target,st=document.getElementById(`q_${Ce}`);st&&("block"==st?.style.display?(st.style.display="none",Ye&&(Ye.textContent="visibility_off")):(st.style.display="block",Ye&&(Ye.textContent="visibility")))}isValidPoint(){let $e=0;var Ce=this.form.value;for(var Ye in Ce){var st=Number(Ye.substring(3));Ce[Ye]>this.maxPointPerQuestion[st]&&$e++}return!($e>0)}validateForm($e,Ce,Ye,st){let Je="";this.form.get("cau"+st)?.valueChanges.pipe((0,_.J)()).subscribe(([xt,ce])=>{if(Je="string"==typeof ce&&ce.includes(",")?ce.replace(",","."):ce,isNaN(+Je))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+st].setValue(Ce);else{let Me=parseFloat(Je);Me>Ye&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),Me<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN($e,Ce){var Ye=(0,re.q)($e);this.apiUploadService.commonUploadForMarkResult(Ye,`essay_note_${Ce}_${this.resultID}.png`,"image/png").subscribe(st=>{st.type!=l.hv.UploadProgress&&(1==st.success?(this.mnoteJsonData.pages[Ce].draw=st.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll($e){this.pagesCount=0;for(let Ce=0;Ce<$e.length;Ce++)$e[Ce].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let Ce=0;Ce<$e.length;Ce++)$e[Ce].draw&&this.uploadBase64ToCDN($e[Ce].draw,Ce)}sendDataToIframe(){const $e=document.getElementById("mNote"),Ce=$e?$e.contentWindow:null;if(null!==Ce)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var Ye=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=Ye){for(let Je=0;Je<Ye.pages.length;Je++)Ye.pages[Je].backgroundImage&&(Ye.pages[Je].backgroundImage=this.sAztCommonCdnService.getMyCdn(Ye.pages[Je].backgroundImage)),Ye.pages[Je].draw&&(Ye.pages[Je].draw=this.sAztCommonCdnService.getMyCdn(Ye.pages[Je].draw));Ye=JSON.stringify(Ye),this.examResultObj.result=Ye}}var st=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(st?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let Je=0;Je<this.jsonData.pages.length;Je++)this.jsonData.pages[Je].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[Je].backgroundImage=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[Je].backgroundImage)),this.jsonData.pages[Je].hasOwnProperty("draw")&&(this.jsonData.pages[Je].draw=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[Je].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),Ce.postMessage(this.jsonData,"*")}else{let Je=[];this.files.forEach(ce=>{var Me=this.sAztCommonCdnService.getMyCdn(ce.url);Me&&Je.push({backgroundImage:Me})}),Ce.postMessage({cmd:"initMNote",pages:Je,mode:this.showForTeacher?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:Je}}}checkMapBGImageWithFileLength($e){var Ce=this.commonService.willDeleteParseJson($e);let Ye=!1;if(0==this.files.length)Ye=!0;else if(this.files.length>0&&Ce&&Ce.pages&&this.files.length==Ce.pages.length){let st=0;this.files.forEach((Je,xt)=>{Ce.pages[xt]&&Ce.pages[xt].backgroundImage&&Ce.pages[xt].backgroundImage.indexOf(Je.path)>-1&&st++}),st==this.files.length&&(Ye=!0)}return Ye}addBGImageByFileUrl($e){var Ce=this.commonService.willDeleteParseJson($e);return this.files.forEach((Ye,st)=>{let Je=!1;if(Ce&&Ce.pages){for(var xt=0;xt<Ce.pages.length;xt++)if(Ce.pages[xt]&&Ce.pages[xt].backgroundImage&&Ce.pages[xt].backgroundImage.indexOf(Ye.path)>-1){Je=!0;break}!1===Je&&(Ce.pages[st]&&Ce.pages[st].id==st?Ce.pages[st].backgroundImage=this.sAztCommonCdnService.getMyCdn(Ye.url??""):Ce.pages.splice(st,0,{backgroundImage:this.sAztCommonCdnService.getMyCdn(Ye.url??"")}))}}),JSON.stringify(Ce)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let $e=!1;for(const Ce in this.form.value)""!==this.form.value[Ce]&&($e=!0);if(!$e)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const Ce in this.form.value)""===this.form.value[Ce]&&(this.form.value[Ce]=0,this.form.controls[Ce].setValue(0));if(this.files&&this.files.length>0){const Ce=document.getElementById("mNote"),Ye=Ce?Ce.contentWindow:null;null!==Ye&&Ye.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark($e){if(this.checkMapBGImageWithFileLength($e)){for(const Je in this.form.value)"string"==typeof this.form.value[Je]&&this.form.value[Je].includes(",")&&(this.form.value[Je]=this.form.value[Je].replace(",","."));let st=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var Ye={id:this.resultID,result:$e,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(Ye,st).subscribe(Je=>{1==Je.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(Je.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";var $e={};let Ce;this.examResultObj.confirmedAt&&(Ce=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(st=>{let Je=this.getMaxPoint(st.id);this.totalMaxPoint+=Je,st.essMaxPoint=Je,this.maxPointPerQuestion.push(st.essMaxPoint)});for(let st=0;st<this.questions.length;st++){var Ye=`cau${st}`;$e[Ye]=new h.MJ(Ce?Ce[Ye]:"",{validators:[h.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),h.k0.min(0),h.k0.max(this.questions[st].essMaxPoint??0)]})}this.form=new h.gE($e),this.form.valueChanges.subscribe(st=>{let Je=JSON.stringify(st);Je!=this.prevData&&(this.prevData=Je,this.form.patchValue(st))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor($e,Ce,Ye,st,Je){super(),this.permissionService=$e,this.sAztCommonCdnService=Ce,this.envService=Ye,this.examResultService=st,this.apiUploadService=Je,this.orgExamObjs=[],this.questions=[],this.files=[],this.userAnswersObj={},this.resultID=0,this.whiteListMNoteIframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new d.bkB,this.followerRenderQuest=new T.e,this.form=new h.gE({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=xt=>{"MNoteJson"==xt.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=xt.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==xt.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(Z=ut).\u0275fac=function($e){return new($e||Z)(d.rXU(_e.p),d.rXU(p.c),d.rXU(q.t),d.rXU(V._),d.rXU(R.T))},Z.\u0275cmp=d.VBU({type:Z,selectors:[["azt-mark-essay"]],viewQuery:function($e,Ce){if(1&$e&&d.GBs(ee,5),2&$e){let Ye;d.mGM(Ye=d.lsd())&&(Ce.mnoteContainer=Ye.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",examResultObj:"examResultObj",userAnswersObj:"userAnswersObj",resultID:"resultID",whiteListMNoteIframeSrc:"whiteListMNoteIframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode"},outputs:{saveResultEvent:"saveResultEvent"},features:[d.Vt3],decls:12,vars:12,consts:[["mnoteContainer",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function($e,Ce){1&$e&&(d.j41(0,"div",1)(1,"form",2),d.DNE(2,nt,14,30,"div",3),d.k0s(),d.DNE(3,Re,5,6,"div",4),d.k0s(),d.j41(4,"div",5),d.DNE(5,Ue,5,5,"div",6),d.k0s(),d.DNE(6,gt,6,6,"div",7),d.j41(7,"div",8,0),d.nrm(9,"iframe",9),d.nI1(10,"safe"),d.k0s(),d.DNE(11,Ne,5,6,"div",10)),2&$e&&(d.R7$(),d.Y8G("formGroup",Ce.form),d.R7$(),d.Y8G("ngForOf",Ce.questions),d.R7$(),d.Y8G("ngIf",Ce.showForTeacher),d.R7$(2),d.Y8G("ngForOf",Ce.questions),d.R7$(),d.Y8G("ngIf",Ce.files&&0==Ce.files.length),d.R7$(),d.Y8G("ngStyle",d.eq3(10,te,Ce.files&&0==Ce.files.length?"none":"block")),d.R7$(2),d.Y8G("src",d.bMT(10,8,Ce.whiteListMNoteIframeSrc),d.f$h),d.R7$(2),d.Y8G("ngIf",Ce.showForTeacher))},dependencies:[j.YU,j.Sq,j.bT,j.B3,A.oV,h.qT,h.me,h.BC,h.cb,h.j4,h.JD,Y.WGl,B.Z,L.t,v.x,F.o,Q.wp,Q.JI],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ut})()},74225:function(_t,Ee,w){"use strict";var l=this&&this.__awaiter||function(x,T,re,_e){return new(re||(re=Promise))(function(q,V){function R(Y){try{A(_e.next(Y))}catch(B){V(B)}}function j(Y){try{A(_e.throw(Y))}catch(B){V(B)}}function A(Y){Y.done?q(Y.value):function p(q){return q instanceof re?q:new re(function(V){V(q)})}(Y.value).then(R,j)}A((_e=_e.apply(x,T||[])).next())})};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.decodeScanOfflineFile=Ee.decode=void 0;const d=w(6178);Ee.decode=function h(x){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decode(x)})},Ee.decodeScanOfflineFile=function _(x){return l(this,void 0,void 0,function*(){return d.AzotaFileDecode.decodeScanOfflineFile(x)})}},25028:(_t,Ee,w)=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.AzotaFile=Ee.FileType=void 0;const l=w(56784),d=w(70073);class h{}Ee.FileType=h,h.scanOffline="scanOffline";class _{constructor(){}static fromZipFolder(T){let re=new _;return re.folder=T,re.readAztMain(),re}readAztMain(){let T=this.folder.getUtf8Text("main.json");if(null==T)throw new l.InvalidAztFileException("Couldn't found main.json file");this.aztMain=d.AztMain.fromJsonString(T)}}Ee.AzotaFile=_},6178:function(_t,Ee,w){"use strict";var l=this&&this.__awaiter||function(T,re,_e,p){return new(_e||(_e=Promise))(function(V,R){function j(B){try{Y(p.next(B))}catch(L){R(L)}}function A(B){try{Y(p.throw(B))}catch(L){R(L)}}function Y(B){B.done?V(B.value):function q(V){return V instanceof _e?V:new _e(function(R){R(V)})}(B.value).then(j,A)}Y((p=p.apply(T,re||[])).next())})};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.AzotaFileDecode=void 0;const d=w(59985),h=w(25589),_=w(25028);class x{static decode(re){return l(this,void 0,void 0,function*(){return d.ZipFolder.fromZip(re).then(_e=>{let p=_.AzotaFile.fromZipFolder(_e);return p.aztMain.fileType==_.FileType.scanOffline?h.ScanOfflineFile.fromZipFolder(p.folder):p})})}static decodeScanOfflineFile(re){return x.decode(re).then(_e=>_e)}}Ee.AzotaFileDecode=x},70073:(_t,Ee,w)=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.AztMain=void 0;const l=w(37182);class d{static fromJsonString(_){return d.fromJson(JSON.parse(_))}static fromJson(_){return(0,l.plainToInstance)(d,_)}}Ee.AztMain=d},56784:(_t,Ee)=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.InvalidAztFileException=void 0;class w extends Error{constructor(d){super(d)}}Ee.InvalidAztFileException=w},65057:(_t,Ee)=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.DrawingCircle=void 0;class w{static findCircle(d,h,_){if(d)return d.find(x=>Math.pow(x.center.x-h,2)+Math.pow(x.center.y-_,2)<=Math.pow(x.radius,2))}static processVertical(d,h,_){const x=w.findCircle(d,h,_);if(!x)return;if(x.filled)return void(x.filled=!1);const re=x.label[0];d?.filter(_e=>_e.label[0]==re).forEach(_e=>_e.filled=!1),x.filled=!0}static getValue(d,h=10){if(!d)return"";const _=d?.length/h,x=[];for(let T=0;T<_;T++)x.push("0");return d.forEach(T=>{if(!T.filled)return;const re=T.label,_e=parseInt(re[0])-1;x[_e]=re[1]}),x.join("")}static setValue(d,h,_=10){if(!d)return;for(let re of d)re.filled=!1;let x=d.length/_,T=0;for(;T<x;){const re=h%10;h=(h-re)/10,d[x*re+x-T-1].filled=!0,T++}}}Ee.DrawingCircle=w},81163:function(_t,Ee,w){"use strict";var l=this&&this.__decorate||function(T,re,_e,p){var R,q=arguments.length,V=q<3?re:null===p?p=Object.getOwnPropertyDescriptor(re,_e):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(T,re,_e,p);else for(var j=T.length-1;j>=0;j--)(R=T[j])&&(V=(q<3?R(V):q>3?R(re,_e,V):R(re,_e))||V);return q>3&&V&&Object.defineProperty(re,_e,V),V};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.ScanOfflineData=void 0,w(8280);const d=w(37182),h=w(45726),_=w(14326);class x{static fromJsonString(re){return x.fromJson(JSON.parse(re))}static fromJson(re){return(0,d.plainToInstance)(x,re)}}l([(0,d.Type)(()=>_.ScanOfflineResult)],x.prototype,"scanResult",void 0),l([(0,d.Type)(()=>h.ScanOfflineRequest)],x.prototype,"scanRequest",void 0),Ee.ScanOfflineData=x},25589:function(_t,Ee,w){"use strict";var l=this&&this.__decorate||function(V,R,j,A){var L,Y=arguments.length,B=Y<3?R:null===A?A=Object.getOwnPropertyDescriptor(R,j):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)B=Reflect.decorate(V,R,j,A);else for(var v=V.length-1;v>=0;v--)(L=V[v])&&(B=(Y<3?L(B):Y>3?L(R,j,B):L(R,j))||B);return Y>3&&B&&Object.defineProperty(R,j,B),B},d=this&&this.__awaiter||function(V,R,j,A){return new(j||(j=Promise))(function(B,L){function v(ee){try{Q(A.next(ee))}catch(te){L(te)}}function F(ee){try{Q(A.throw(ee))}catch(te){L(te)}}function Q(ee){ee.done?B(ee.value):function Y(B){return B instanceof j?B:new j(function(L){L(B)})}(ee.value).then(v,F)}Q((A=A.apply(V,R||[])).next())})};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.ScanOfflineFile=void 0;const h=w(25028),_=w(59985),x=w(56784),T=w(70073),re=w(37182),_e=w(81163),p=w(14326);class q extends h.AzotaFile{constructor(){super()}static fromZipFolder(R){let j=new q;if(j.folder=R,j.readAztMain(),j.aztMain.fileType!=h.FileType.scanOffline)throw new x.InvalidAztFileException(`fileType must be ${h.FileType.scanOffline}`);let Y=R.getUtf8Text(j.aztMain.detailPath);if(null==Y)throw new x.InvalidAztFileException(`Couldn't found ${Y} file`);return j.scanOfflineData=_e.ScanOfflineData.fromJsonString(Y),j}getWrappedImage(){var R,j;return null==(null===(j=null===(R=this.scanOfflineData)||void 0===R?void 0:R.scanResult)||void 0===j?void 0:j.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getFilledCircles(){var R,j,A;return null!==(A=null===(j=null===(R=this.scanOfflineData)||void 0===R?void 0:R.scanResult)||void 0===j?void 0:j.getFilledCircles())&&void 0!==A?A:[]}getWrappedImageExtension(){var R,j;let A=null===(j=null===(R=this.scanOfflineData)||void 0===R?void 0:R.scanResult)||void 0===j?void 0:j.wrappedScanFilePath;return null==A?null:A.substring(A.lastIndexOf("."))}static init(R,j,A){const Y=new q;return Y.folder=new _.ZipFolder,Y.aztMain=new T.AztMain,Y.aztMain.fileType=h.FileType.scanOffline,Y.aztMain.detailPath="scan_offline.json",Y.aztMain.createdAt=(new Date).toString(),Y.aztMain.createdBy=j,Y.scanOfflineData=new _e.ScanOfflineData,Y.scanOfflineData.examHashId=R,Y.scanOfflineData.scanResult=new p.ScanOfflineResult,Y.scanOfflineData.scanRequest=A,Y}setOriginalImage(R,j){const A=`media/original_scan_offline.${R}`;this.folder.setBinary(A,j),this.scanOfflineData.originalScanFilePath=A}setWrappedImage(R,j){const A=`media/wrapped_scan_offline.${R}`;this.folder.setBinary(A,j),this.scanOfflineData.scanResult.wrappedScanFilePath=A}setDebugImage(R,j){this.folder.setBinary(`debug_images/${R}`,j)}setScanResult(R){R.wrappedScanFilePath=this.scanOfflineData.scanResult.wrappedScanFilePath,this.scanOfflineData.scanResult=R}clickToImage(R,j){var A,Y;null===(Y=null===(A=this.scanOfflineData)||void 0===A?void 0:A.scanResult)||void 0===Y||Y.clickToImage(R,j)}setExamCode(R){var j,A;null===(A=null===(j=this.scanOfflineData)||void 0===j?void 0:j.scanResult)||void 0===A||A.setExamCode(R)}setStudentCode(R){var j,A;null===(A=null===(j=this.scanOfflineData)||void 0===j?void 0:j.scanResult)||void 0===A||A.setStudentCode(R)}toAztFile(){return d(this,void 0,void 0,function*(){return this.folder.setUtf8Text("main.json",JSON.stringify(this.aztMain)),this.folder.setUtf8Text("scan_offline.json",JSON.stringify(this.scanOfflineData)),this.folder.toZip()})}}l([(0,re.Type)(()=>_e.ScanOfflineData)],q.prototype,"scanOfflineData",void 0),Ee.ScanOfflineFile=q},45726:(_t,Ee,w)=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.ScanOfflineRequest=void 0;const l=w(37182);class d{constructor(){this.templateType=void 0,this.blackRate=void 0,this.corners=[],this.corner2s=[]}static fromJsonString(_){const x=JSON.parse(_);return d.fromJson(x)}static fromJson(_){return(0,l.plainToInstance)(d,_)}}Ee.ScanOfflineRequest=d},14326:function(_t,Ee,w){"use strict";var l=this&&this.__decorate||function(j,A,Y,B){var F,L=arguments.length,v=L<3?A:null===B?B=Object.getOwnPropertyDescriptor(A,Y):B;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(j,A,Y,B);else for(var Q=j.length-1;Q>=0;Q--)(F=j[Q])&&(v=(L<3?F(v):L>3?F(A,Y,v):F(A,Y))||v);return L>3&&v&&Object.defineProperty(A,Y,v),v};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.DrawingRectangle=Ee.AnswerRegionResult=Ee.QuizFillBlank=Ee.Quiz4PartTrueFalse=Ee.Quiz4Option=Ee.StudentCodeRegionResult=Ee.ExamCodeRegionResult=Ee.ScanOfflineResult=void 0,w(8280);const d=w(37182),h=w(65057),_=w(82601);class x{getSubExamCode(){var A,Y;return null!==(Y=null===(A=this.examCodeRegion)||void 0===A?void 0:A.getValue())&&void 0!==Y?Y:""}getStudentCode(){var A,Y;return null!==(Y=null===(A=this.studentCodeRegion)||void 0===A?void 0:A.getValue())&&void 0!==Y?Y:""}getEssayTotalPoint(){var A,Y,B;const L=null!==(B=null===(Y=h.DrawingCircle.getValue(null===(A=this.answerRegion)||void 0===A?void 0:A.essayCircles))||void 0===Y?void 0:Y.trim())&&void 0!==B?B:"";return""!=L?parseInt(L)/100:void 0}getFilledCircles(){var A,Y,B,L,v,F,Q,ee,te,oe,Ve,Se;let He=[];return He.push(...null!==(Y=null===(A=this.studentCodeRegion)||void 0===A?void 0:A.circles)&&void 0!==Y?Y:[]),He.push(...null!==(L=null===(B=this.examCodeRegion)||void 0===B?void 0:B.circles)&&void 0!==L?L:[]),He.push(...null!==(F=null===(v=this.answerRegion)||void 0===v?void 0:v.circles)&&void 0!==F?F:[]),He.push(...null!==(ee=null===(Q=this.answerRegion)||void 0===Q?void 0:Q.essayCircles)&&void 0!==ee?ee:[]),He.push(...null!==(oe=null===(te=this.answerRegion)||void 0===te?void 0:te.trueFalseCircles)&&void 0!==oe?oe:[]),He.push(...null!==(Se=null===(Ve=this.answerRegion)||void 0===Ve?void 0:Ve.fillBlankCircles)&&void 0!==Se?Se:[]),He.filter(be=>be.filled)}getQuiz4OptionAnswers(){var A,Y;const B=null!==(Y=null===(A=this.answerRegion)||void 0===A?void 0:A.circles)&&void 0!==Y?Y:[],L=B.length/4;let v=[];for(let F=0;F<L;F++)v.push("");return B.forEach(F=>{if(!F.filled)return;const Q=new _e(F.label);v[Q.numbers-1]=Q.letter}),v}getQuiz4PartTrueFalseAnswers(){var A,Y;const B=null!==(Y=null===(A=this.answerRegion)||void 0===A?void 0:A.trueFalseCircles)&&void 0!==Y?Y:[],L=B.length/2;let v=[];for(let F=0;F<L;F++)v.push(" ");return B.forEach(F=>{if(!F.filled)return;const Q=new p(F.label),ee=4*(Q.numbers-1)+Q.getPartIndex();v[ee]=Q.letter}),v}getQuizFillBlankAnswers(){var A,Y;const B=null!==(Y=null===(A=this.answerRegion)||void 0===A?void 0:A.fillBlankCircles)&&void 0!==Y?Y:[],L=B.length/48;let v=[];for(let F=0;F<L;F++)v.push([" "," "," "," "]);return B.forEach(F=>{if(!F.filled)return;const Q=new q(F.label);v[Q.numbers-1][Q.cols]=Q.rowLabel}),v.map(F=>F.join(""))}clickToImage(A,Y){var B,L,v;null===(B=this.examCodeRegion)||void 0===B||B.clickToImage(A,Y),null===(L=this.studentCodeRegion)||void 0===L||L.clickToImage(A,Y),null===(v=this.answerRegion)||void 0===v||v.clickToImage(A,Y)}setExamCode(A){var Y;null===(Y=this.examCodeRegion)||void 0===Y||Y.setValue(A)}setStudentCode(A){var Y;null===(Y=this.studentCodeRegion)||void 0===Y||Y.setValue(A)}}l([(0,d.Type)(()=>T)],x.prototype,"examCodeRegion",void 0),l([(0,d.Type)(()=>re)],x.prototype,"studentCodeRegion",void 0),l([(0,d.Type)(()=>V)],x.prototype,"answerRegion",void 0),Ee.ScanOfflineResult=x;class T extends _.VerticalRegion{}Ee.ExamCodeRegionResult=T;class re extends _.VerticalRegion{}Ee.StudentCodeRegionResult=re;class _e{constructor(A){const B=A.match(/(\d+)([A-Z])/);if(!B)throw new Error(`Invalid label: ${A}`);this.numbers=parseInt(B[1]),this.letter=B[2]}}Ee.Quiz4Option=_e;class p{constructor(A){const B=A.match(/(\d+)([A-D])([TF])/);if(!B)throw new Error(`Invalid label: ${A}`);this.numbers=parseInt(B[1]),this.part=B[2],this.letter=B[3]}getPartIndex(){return"ABCD".indexOf(this.part)}}Ee.Quiz4PartTrueFalse=p;class q{constructor(A){const Y=A.split("_");if(3!=Y.length)throw new Error(`Invalid label: ${A}`);this.numbers=parseInt(Y[0]),this.cols=parseInt(Y[1]),this.rowLabel=Y[2]}}Ee.QuizFillBlank=q;class V{clickToImage(A,Y){var B,L,v;h.DrawingCircle.processVertical(this.essayCircles,A,Y);{const F=h.DrawingCircle.findCircle(this.circles,A,Y);if(F){if(F.filled)return void(F.filled=!1);const Q=new _e(F.label);null===(B=this.circles)||void 0===B||B.filter(ee=>new _e(ee.label).numbers==Q.numbers).forEach(ee=>ee.filled=!1),F.filled=!0}}{const F=h.DrawingCircle.findCircle(this.trueFalseCircles,A,Y);if(F){if(F.filled)return void(F.filled=!1);const Q=new p(F.label);null===(L=this.trueFalseCircles)||void 0===L||L.filter(ee=>{const te=new p(ee.label);return te.numbers==Q.numbers&&te.part==Q.part}).forEach(ee=>ee.filled=!1),F.filled=!0}}{const F=h.DrawingCircle.findCircle(this.fillBlankCircles,A,Y);if(F){if(F.filled)return void(F.filled=!1);const Q=new q(F.label);null===(v=this.fillBlankCircles)||void 0===v||v.filter(ee=>{const te=new q(ee.label);return te.numbers==Q.numbers&&te.cols==Q.cols}).forEach(ee=>ee.filled=!1),F.filled=!0}}}}Ee.AnswerRegionResult=V,Ee.DrawingRectangle=class R{}},82601:(_t,Ee,w)=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.VerticalRegion=void 0;const l=w(65057);Ee.VerticalRegion=class d{clickToImage(_,x){l.DrawingCircle.processVertical(this.circles,_,x)}getValue(_=10){return l.DrawingCircle.getValue(this.circles,_)}setValue(_,x=10){l.DrawingCircle.setValue(this.circles,_,x)}}},59985:function(_t,Ee,w){"use strict";var l=this&&this.__awaiter||function(_,x,T,re){return new(T||(T=Promise))(function(p,q){function V(A){try{j(re.next(A))}catch(Y){q(Y)}}function R(A){try{j(re.throw(A))}catch(Y){q(Y)}}function j(A){A.done?p(A.value):function _e(p){return p instanceof T?p:new T(function(q){q(p)})}(A.value).then(V,R)}j((re=re.apply(_,x||[])).next())})};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.ZipFolder=void 0;const d=w(91478);class h{constructor(x){this.files=new Map,x&&x.forEach((T,re)=>{this.files.set(re,T)})}static fromZip(x){return l(this,void 0,void 0,function*(){let re=yield(new d).loadAsync(x).then(_e=>{const p=[];return _e.forEach(function(q){let V=_e.file(q);V&&p.push(V.async("uint8array").then(R=>({path:q,data:R})))}),p});return Promise.all(re).then(_e=>{let p=new Map;return _e.forEach(q=>{p.set(q.path,q.data)}),new h(p)})})}setBinary(x,T){const re=Uint8Array.from(T);this.files.set(x,re)}setUtf8Text(x,T){let re=(new TextEncoder).encode(T);this.files.set(x,re)}getBinary(x){var T;return null!==(T=this.files.get(x))&&void 0!==T?T:null}getUtf8Text(x){let T=this.files.get(x);return null===T?null:(new TextDecoder).decode(T)}toZip(){return l(this,void 0,void 0,function*(){const x=new d;for(let[T,re]of Array.from(this.files))x.file(T,re,{binary:!0});return x.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return l(this,void 0,void 0,function*(){const x=new d;for(let[T,re]of Array.from(this.files))x.file(T,re,{binary:!0});return x.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}Ee.ZipFolder=h},8280:()=>{var _t,Ee;Ee=_t||(_t={}),function(w){var l="object"==typeof globalThis?globalThis:"object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:function T(){return function _(){try{return Function("return this;")()}catch{}}()||function x(){try{return(0,eval)("(function() { return this; })()")}catch{}}()}(),d=h(Ee);function h(re,_e){return function(p,q){Object.defineProperty(re,p,{configurable:!0,writable:!0,value:q}),_e&&_e(p,q)}}typeof l.Reflect<"u"&&(d=h(l.Reflect,d)),function(w,l){var d=Object.prototype.hasOwnProperty,h="function"==typeof Symbol,_=h&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",x=h&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T="function"==typeof Object.create,re={__proto__:[]}instanceof Array,_e=!T&&!re,p={create:T?function(){return k(Object.create(null))}:re?function(){return k({__proto__:null})}:function(){return k({})},has:_e?function(I,b){return d.call(I,b)}:function(I,b){return b in I},get:_e?function(I,b){return d.call(I,b)?I[b]:void 0}:function(I,b){return I[b]}},q=Object.getPrototypeOf(Function),V="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function xe(){var I={},b=[],z=function(){function ie(de,me,pe){this._index=0,this._keys=de,this._values=me,this._selector=pe}return ie.prototype["@@iterator"]=function(){return this},ie.prototype[x]=function(){return this},ie.prototype.next=function(){var de=this._index;if(de>=0&&de<this._keys.length){var me=this._selector(this._keys[de],this._values[de]);return de+1>=this._keys.length?(this._index=-1,this._keys=b,this._values=b):this._index++,{value:me,done:!1}}return{value:void 0,done:!0}},ie.prototype.throw=function(de){throw this._index>=0&&(this._index=-1,this._keys=b,this._values=b),de},ie.prototype.return=function(de){return this._index>=0&&(this._index=-1,this._keys=b,this._values=b),{value:de,done:!0}},ie}();return function(){function ie(){this._keys=[],this._values=[],this._cacheKey=I,this._cacheIndex=-2}return Object.defineProperty(ie.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ie.prototype.has=function(de){return this._find(de,!1)>=0},ie.prototype.get=function(de){var me=this._find(de,!1);return me>=0?this._values[me]:void 0},ie.prototype.set=function(de,me){var pe=this._find(de,!0);return this._values[pe]=me,this},ie.prototype.delete=function(de){var me=this._find(de,!1);if(me>=0){for(var pe=this._keys.length,Ie=me+1;Ie<pe;Ie++)this._keys[Ie-1]=this._keys[Ie],this._values[Ie-1]=this._values[Ie];return this._keys.length--,this._values.length--,Je(de,this._cacheKey)&&(this._cacheKey=I,this._cacheIndex=-2),!0}return!1},ie.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=I,this._cacheIndex=-2},ie.prototype.keys=function(){return new z(this._keys,this._values,N)},ie.prototype.values=function(){return new z(this._keys,this._values,ve)},ie.prototype.entries=function(){return new z(this._keys,this._values,ge)},ie.prototype["@@iterator"]=function(){return this.entries()},ie.prototype[x]=function(){return this.entries()},ie.prototype._find=function(de,me){if(!Je(this._cacheKey,de)){this._cacheIndex=-1;for(var pe=0;pe<this._keys.length;pe++)if(Je(this._keys[pe],de)){this._cacheIndex=pe;break}}return this._cacheIndex<0&&me&&(this._cacheIndex=this._keys.length,this._keys.push(de),this._values.push(void 0)),this._cacheIndex},ie}();function N(ie,de){return ie}function ve(ie,de){return de}function ge(ie,de){return[ie,de]}}(),R="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function qe(){return function(){function b(){this._map=new V}return Object.defineProperty(b.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),b.prototype.has=function(z){return this._map.has(z)},b.prototype.add=function(z){return this._map.set(z,z),this},b.prototype.delete=function(z){return this._map.delete(z)},b.prototype.clear=function(){this._map.clear()},b.prototype.keys=function(){return this._map.keys()},b.prototype.values=function(){return this._map.keys()},b.prototype.entries=function(){return this._map.entries()},b.prototype["@@iterator"]=function(){return this.keys()},b.prototype[x]=function(){return this.keys()},b}()}(),j="function"==typeof WeakMap?WeakMap:function D(){var I=16,b=p.create(),z=U();return function(){function de(){this._key=U()}return de.prototype.has=function(me){var pe=N(me,!1);return void 0!==pe&&p.has(pe,this._key)},de.prototype.get=function(me){var pe=N(me,!1);return void 0!==pe?p.get(pe,this._key):void 0},de.prototype.set=function(me,pe){return N(me,!0)[this._key]=pe,this},de.prototype.delete=function(me){var pe=N(me,!1);return void 0!==pe&&delete pe[this._key]},de.prototype.clear=function(){this._key=U()},de}();function U(){var de;do{de="@@WeakMap@@"+ie()}while(p.has(b,de));return b[de]=!0,de}function N(de,me){if(!d.call(de,z)){if(!me)return;Object.defineProperty(de,z,{value:p.create()})}return de[z]}function ve(de,me){for(var pe=0;pe<me;++pe)de[pe]=255*Math.random()|0;return de}function ie(){var de=function ge(de){if("function"==typeof Uint8Array){var me=new Uint8Array(de);return typeof crypto<"u"?crypto.getRandomValues(me):typeof msCrypto<"u"?msCrypto.getRandomValues(me):ve(me,de),me}return ve(new Array(de),de)}(I);de[6]=79&de[6]|64,de[8]=191&de[8]|128;for(var me="",pe=0;pe<I;++pe){var Ie=de[pe];(4===pe||6===pe||8===pe)&&(me+="-"),Ie<16&&(me+="0"),me+=Ie.toString(16).toLowerCase()}return me}}(),A=h?Symbol.for("@reflect-metadata:registry"):void 0,Y=function Be(){var I;return!We(A)&&gt(l.Reflect)&&Object.isExtensible(l.Reflect)&&(I=l.Reflect[A]),We(I)&&(I=function H(){var I;!We(A)&&typeof l.Reflect<"u"&&!(A in l.Reflect)&&"function"==typeof l.Reflect.defineMetadata&&(I=function ke(I){var b=I.defineMetadata,z=I.hasOwnMetadata,U=I.getOwnMetadata,N=I.getOwnMetadataKeys,ve=I.deleteMetadata,ge=new j;return{isProviderFor:function(de,me){var pe=ge.get(de);return!(We(pe)||!pe.has(me))||!!N(de,me).length&&(We(pe)&&(pe=new R,ge.set(de,pe)),pe.add(me),!0)},OrdinaryDefineOwnMetadata:b,OrdinaryHasOwnMetadata:z,OrdinaryGetOwnMetadata:U,OrdinaryOwnMetadataKeys:N,OrdinaryDeleteMetadata:ve}}(l.Reflect));var b,z,U,N=new j,ve={registerProvider:ge,getProvider:de,setProvider:pe};return ve;function ge(Ie){if(!Object.isExtensible(ve))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case I===Ie:break;case We(b):b=Ie;break;case b===Ie:break;case We(z):z=Ie;break;case z===Ie:break;default:void 0===U&&(U=new R),U.add(Ie)}}function ie(Ie,Te){if(!We(b)){if(b.isProviderFor(Ie,Te))return b;if(!We(z)){if(z.isProviderFor(Ie,Te))return b;if(!We(U))for(var Ze=ce(U);;){var tt=ye(Ze);if(!tt)return;var W=Me(tt);if(W.isProviderFor(Ie,Te))return M(Ze),W}}}if(!We(I)&&I.isProviderFor(Ie,Te))return I}function de(Ie,Te){var tt,Ze=N.get(Ie);return We(Ze)||(tt=Ze.get(Te)),We(tt)&&(We(tt=ie(Ie,Te))||(We(Ze)&&(Ze=new V,N.set(Ie,Ze)),Ze.set(Te,tt))),tt}function me(Ie){if(We(Ie))throw new TypeError;return b===Ie||z===Ie||!We(U)&&U.has(Ie)}function pe(Ie,Te,Ze){if(!me(Ze))throw new Error("Metadata provider not registered.");var tt=de(Ie,Te);if(tt!==Ze){if(!We(tt))return!1;var W=N.get(Ie);We(W)&&(W=new V,N.set(Ie,W)),W.set(Te,Ze)}return!0}}()),!We(A)&&gt(l.Reflect)&&Object.isExtensible(l.Reflect)&&Object.defineProperty(l.Reflect,A,{enumerable:!1,configurable:!1,writable:!1,value:I}),I}(),B=function Ke(I){var b=new j,z={isProviderFor:function(me,pe){var Ie=b.get(me);return!We(Ie)&&Ie.has(pe)},OrdinaryDefineOwnMetadata:function ge(me,pe,Ie,Te){U(Ie,Te,!0).set(me,pe)},OrdinaryHasOwnMetadata:function N(me,pe,Ie){var Te=U(pe,Ie,!1);return!We(Te)&&Z(Te.has(me))},OrdinaryGetOwnMetadata:function ve(me,pe,Ie){var Te=U(pe,Ie,!1);if(!We(Te))return Te.get(me)},OrdinaryOwnMetadataKeys:function ie(me,pe){var Ie=[],Te=U(me,pe,!1);if(We(Te))return Ie;for(var tt=ce(Te.keys()),W=0;;){var ot=ye(tt);if(!ot)return Ie.length=W,Ie;var mt=Me(ot);try{Ie[W]=mt}catch(Kt){try{M(tt)}finally{throw Kt}}W++}},OrdinaryDeleteMetadata:function de(me,pe,Ie){var Te=U(pe,Ie,!1);if(We(Te)||!Te.delete(me))return!1;if(0===Te.size){var Ze=b.get(pe);We(Ze)||(Ze.delete(Ie),0===Ze.size&&b.delete(Ze))}return!0}};return Y.registerProvider(z),z;function U(me,pe,Ie){var Te=b.get(me),Ze=!1;if(We(Te)){if(!Ie)return;Te=new V,b.set(me,Te),Ze=!0}var tt=Te.get(pe);if(We(tt)){if(!Ie)return;if(tt=new V,Te.set(pe,tt),!I.setProvider(me,pe,z))throw Te.delete(pe),Ze&&b.delete(me),new Error("Wrong provider for target.")}return tt}}(Y);function it(I,b,z){if(nt(I,b,z))return!0;var N=P(b);return!ze(N)&&it(I,N,z)}function nt(I,b,z){var U=Oe(b,z,!1);return!We(U)&&Z(U.OrdinaryHasOwnMetadata(I,b,z))}function Re(I,b,z){if(nt(I,b,z))return rt(I,b,z);var N=P(b);return ze(N)?void 0:Re(I,N,z)}function rt(I,b,z){var U=Oe(b,z,!1);if(!We(U))return U.OrdinaryGetOwnMetadata(I,b,z)}function je(I,b,z,U){Oe(z,U,!0).OrdinaryDefineOwnMetadata(I,b,z,U)}function ae(I,b){var z=Qe(I,b),U=P(I);if(null===U)return z;var N=ae(U,b);if(N.length<=0)return z;if(z.length<=0)return N;for(var ve=new R,ge=[],ie=0,de=z;ie<de.length;ie++)ve.has(me=de[ie])||(ve.add(me),ge.push(me));for(var Ie=0,Te=N;Ie<Te.length;Ie++){var me;ve.has(me=Te[Ie])||(ve.add(me),ge.push(me))}return ge}function Qe(I,b){var z=Oe(I,b,!1);return z?z.OrdinaryOwnMetadataKeys(I,b):[]}function ct(I){if(null===I)return 1;switch(typeof I){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===I?1:6;default:return 6}}function We(I){return void 0===I}function ze(I){return null===I}function gt(I){return"object"==typeof I?null!==I:"function"==typeof I}function Ne(I,b){switch(ct(I)){case 0:case 1:case 2:case 3:case 4:case 5:return I}var z=3===b?"string":5===b?"number":"default",U=xt(I,_);if(void 0!==U){var N=U.call(I,z);if(gt(N))throw new TypeError;return N}return function J(I,b){if("string"===b){var z=I.toString;if(Ce(z)&&!gt(U=z.call(I)))return U;if(Ce(N=I.valueOf)&&!gt(U=N.call(I)))return U}else{var N;if(Ce(N=I.valueOf)&&!gt(U=N.call(I)))return U;var U,ve=I.toString;if(Ce(ve)&&!gt(U=ve.call(I)))return U}throw new TypeError}(I,"default"===z?"number":z)}function Z(I){return!!I}function et(I){var b=Ne(I,3);return function Ue(I){return"symbol"==typeof I}(b)?b:function ut(I){return""+I}(b)}function $e(I){return Array.isArray?Array.isArray(I):I instanceof Object?I instanceof Array:"[object Array]"===Object.prototype.toString.call(I)}function Ce(I){return"function"==typeof I}function Ye(I){return"function"==typeof I}function Je(I,b){return I===b||I!=I&&b!=b}function xt(I,b){var z=I[b];if(null!=z){if(!Ce(z))throw new TypeError;return z}}function ce(I){var b=xt(I,x);if(!Ce(b))throw new TypeError;var z=b.call(I);if(!gt(z))throw new TypeError;return z}function Me(I){return I.value}function ye(I){var b=I.next();return!b.done&&b}function M(I){var b=I.return;b&&b.call(I)}function P(I){var b=Object.getPrototypeOf(I);if("function"!=typeof I||I===q||b!==q)return b;var z=I.prototype,U=z&&Object.getPrototypeOf(z);if(null==U||U===Object.prototype)return b;var N=U.constructor;return"function"!=typeof N||N===I?b:N}function Oe(I,b,z){var U=Y.getProvider(I,b);if(!We(U))return U;if(z){if(Y.setProvider(I,b,B))return B;throw new Error("Illegal state.")}}function k(I){return I.__=void 0,delete I.__,I}w("decorate",function L(I,b,z,U){if(We(z)){if(!$e(I))throw new TypeError;if(!Ye(b))throw new TypeError;return function be(I,b){for(var z=I.length-1;z>=0;--z){var N=(0,I[z])(b);if(!We(N)&&!ze(N)){if(!Ye(N))throw new TypeError;b=N}}return b}(I,b)}if(!$e(I))throw new TypeError;if(!gt(b))throw new TypeError;if(!gt(U)&&!We(U)&&!ze(U))throw new TypeError;return ze(U)&&(U=void 0),function ht(I,b,z,U){for(var N=I.length-1;N>=0;--N){var ge=(0,I[N])(b,z,U);if(!We(ge)&&!ze(ge)){if(!gt(ge))throw new TypeError;U=ge}}return U}(I,b,z=et(z),U)}),w("metadata",function v(I,b){return function z(U,N){if(!gt(U))throw new TypeError;if(!We(N)&&!function st(I){switch(ct(I)){case 3:case 4:return!0;default:return!1}}(N))throw new TypeError;je(I,b,U,N)}}),w("defineMetadata",function F(I,b,z,U){if(!gt(z))throw new TypeError;return We(U)||(U=et(U)),je(I,b,z,U)}),w("hasMetadata",function Q(I,b,z){if(!gt(b))throw new TypeError;return We(z)||(z=et(z)),it(I,b,z)}),w("hasOwnMetadata",function ee(I,b,z){if(!gt(b))throw new TypeError;return We(z)||(z=et(z)),nt(I,b,z)}),w("getMetadata",function te(I,b,z){if(!gt(b))throw new TypeError;return We(z)||(z=et(z)),Re(I,b,z)}),w("getOwnMetadata",function oe(I,b,z){if(!gt(b))throw new TypeError;return We(z)||(z=et(z)),rt(I,b,z)}),w("getMetadataKeys",function Ve(I,b){if(!gt(I))throw new TypeError;return We(b)||(b=et(b)),ae(I,b)}),w("getOwnMetadataKeys",function Se(I,b){if(!gt(I))throw new TypeError;return We(b)||(b=et(b)),Qe(I,b)}),w("deleteMetadata",function He(I,b,z){if(!gt(b))throw new TypeError;if(We(z)||(z=et(z)),!gt(b))throw new TypeError;We(z)||(z=et(z));var U=Oe(b,z,!1);return!We(U)&&U.OrdinaryDeleteMetadata(I,b,z)})}(d,l),typeof l.Reflect>"u"&&(l.Reflect=Ee)}()}}]);