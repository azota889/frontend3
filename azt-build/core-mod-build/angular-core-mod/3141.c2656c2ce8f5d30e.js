"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[3141],{37320:(E,T,o)=>{o.d(T,{f:()=>r});var p=o(48891),j=o(14527),e=o(53793),s=o(17838),_=o(82040),O=o(18447),m=o(85710),n=o(27035),d=o(5424);class h{addTask(l,g){if(null!=g&&this.baseResultCache.has(g))return this.baseResultCache.get(g).asObservable();const v=new s.m(1);return null!=g&&this.baseResultCache.set(g,v),this.baseTaskQueue$?.next(l.pipe((0,_.M)({next:b=>{!b.success&&null!=g&&this.baseResultCache.delete(g),v.next(b)},error:()=>{null!=g&&this.baseResultCache.delete(g),v.next({success:0,message:"lang_common_error_at_task_queue",data:void 0})}}))),v.asObservable()}resetQueue(){this.stopQueue(),this.baseDestroy$=new O.B,this.baseSubscription=new m.yU,this.initializeQueue()}resetConcurrency(l){this.baseLimitConcurrency!=l&&this.initializeQueue()}initializeQueue(){this.baseTaskQueue$=new O.B;const l=this.baseTaskQueue$.pipe((0,n.Z)(g=>g.pipe((0,d.Q)(this.baseDestroy$)),this.baseLimitConcurrency)).subscribe({next:g=>{},error:g=>{},complete:()=>{}});this.baseSubscription.add(l)}stopQueue(){this.baseDestroy$.next(),this.baseDestroy$.complete(),this.baseSubscription.unsubscribe(),this.baseTaskQueue$=null,this.baseResultCache.clear()}constructor(l=10){this.baseLimitConcurrency=l,this.baseTaskQueue$=null,this.baseDestroy$=new O.B,this.baseSubscription=new m.yU,this.baseResultCache=new Map,this.initializeQueue()}}var t=o(35810);let r=(()=>{var c;class l extends h{callApiToGuestKnowledge(v,b,A,z){if(""==this.standardQuestionData(b))return A(void 0,void 0,void 0);let y={questionId:v?b.questionId:void 0,text:v?void 0:this.standardQuestionData(b),levelId:b.levelId,subjectId:b.subjectId,ebankId:b.ebankId},Q=this.aiService.apiAiPredictQuestionKnowledgePost(y);this.addTask(Q,this.sAztEncryptService.createMd5(this.commonService.serializeJson(y))).subscribe(w=>w.success?"vip_required"==w.errorCode?z("lang_core_need_vip_upgrade"):!w.data||w.data.score<this.AI_MIN_SCORE?A(void 0,void 0,void 0):void A(w.data.knowledgeId,w.data.objectiveId,w.data.tagId):z(w.message))}standardQuestionData(v){let b=this.commonService.parseQuestionContent(v.questionContent);return b+=" "+this.commonService.parseQuestionContent(v.answerContents.join(" - ")),b.trim()}constructor(){super(2),this.commonService=(0,p.WQX)(e.R),this.aiService=(0,p.WQX)(j.Ee),this.sAztEncryptService=(0,p.WQX)(t.v),this.AI_MIN_SCORE=2.8}}return(c=l).\u0275fac=function(v){return new(v||c)},c.\u0275prov=p.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),l})()},34292:(E,T,o)=>{o.d(T,{c:()=>e});var p=o(18447),j=o(48891);let e=(()=>{var s;class _{constructor(){this.checkQuestion=new p.B}listenSetTagEventOfAllQuestions(){return this.checkQuestion}sendSetTagEvent(m){this.checkQuestion.next(m)}}return(s=_).\u0275fac=function(m){return new(m||s)},s.\u0275prov=j.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),_})()},68106:(E,T,o)=>{o.d(T,{c:()=>O});var p=o(48891),j=o(78472),e=o(51698),s=o(88249),_=o(53793);let O=(()=>{var m;class n{constructor(){this.questionService=(0,p.WQX)(j.wP),this.commonService=(0,p.WQX)(_.R),this.replayCache$=null}callApiSetTagForTrueFalseQuestion(h,t,r){return new e.c(c=>{let l=h.configAnswers.find(v=>v.key==t);this.questionService.apiQuestionUpdateQuestionKnowledgePost({questions:[{questionId:h.id,answers:[{answerKey:t,objectiveId:l?.objectiveId,tag:r?.code??""}]}]}).subscribe(v=>{if(!v)return c.next(!1),c.complete(),this.commonService.snackError("lang_update_question_tag_unsuccessfully");this.commonService.snackSuccess("lang_update_question_tag_successfully"),c.next(!0),c.complete()})})}formatTag(h){return h.map(t=>({...t,showName:this.commonService.getValueOfKeyInObject(t,this.commonService.getCurrentLang()+"Name")??t.enName??"Empty"}))}getQuestionTags(){return this.replayCache$||(this.replayCache$=new e.c(h=>{this.questionService.apiQuestionGetTagsGet().subscribe(t=>{if(!t.success)return this.commonService.snackError(t.message);h.next(t.data?.objs?.filter(r=>"VDC"!=r.code)??[]),h.complete()})}).pipe((0,s.t)(1))),this.replayCache$}findCurrentTag(h,t,r){let c=t.find(g=>this.commonService.compareLowerCase(g.key,r))?.tagId,l=h.find(g=>g.id==c);return l?"azt_lang_tag_"+l.code:""}}return(m=n).\u0275fac=function(h){return new(h||m)},m.\u0275prov=p.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),n})()},99743:(E,T,o)=>{o.d(T,{I:()=>s});var p=o(48891),j=o(53793),e=o(99927);let s=(()=>{var _;class O{constructor(){this.commonService=(0,p.WQX)(j.R),this.sAztAnswerTypeService=(0,p.WQX)(e._)}changeObjectiveForCommonQuestion(n,d){return n.knowledgeId=d.id,n.objectiveId=d.objectiveId,n.ebankFrameId=d.id,n}changeObjectiveForTrueFalseQuestion(n,d,h){return n.configAnswers.find(t=>t.key==h)?(n.configAnswers.forEach(t=>{t.key==h&&(t.objectiveId=d?.objectiveId,t.knowledgeId=d?.id,t.ebankFrameId=d.id)}),n):(n.configAnswers.push({key:h,objectiveId:d.objectiveId,knowledgeId:d.id,ebankFrameId:d.id}),n)}changeTagForCommonQuestion(n,d){return n.tags=d,n}changeTagForTrueFalseQuestion(n,d,h){let t=this.commonService.getFirstOfArray(h);return n.configAnswers.find(r=>r.key==d)?(n.configAnswers.forEach(r=>{r.key==d&&(r.tagId=t?.id,r.tagName=t?.name,r.tagCode=t?.code)}),n):(n.configAnswers.push({key:d,knowledgeId:void 0,objectiveId:void 0,tagCode:t?.code,tagId:t?.id,tagName:t?.name}),n)}changeTagForCommonQuestView(n,d){return n.tag=d,n}changeTagForTrueFalseQuestView(n,d,h){let t=this.commonService.getFirstOfArray(h);return n.configAnswers||(n.configAnswers=[]),n.configAnswers.find(r=>r.key==d)?(n.configAnswers.forEach(r=>{r.key==d&&(r.tagId=t?.id,r.tagName=t?.name,r.tagCode=t?.code)}),n):(n.configAnswers.push({key:d,knowledgeId:void 0,objectiveId:void 0,tagCode:t?.code,tagId:t?.id,tagName:t?.name}),n)}}return(_=O).\u0275fac=function(n){return new(n||_)},_.\u0275prov=p.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),O})()},50334:(E,T,o)=>{o.d(T,{C:()=>j});var p=o(59640);class j extends p.H{constructor(){super(...arguments),this.nodeObjs=[]}searchByText(s){this.nodeObjs=(s=this.standardSearchText(s)).trim()?this.doSearchByText(s,this.nodeObjs,[]):this.showAndExpandAll(this.nodeObjs)}expand(s){s.isExpand=!0}collapse(s){s.isExpand=!1}doSearchByText(s,_,O){for(var m of _){m.isShow=!1;let n=this.standardSearchText(m.text);(s.includes(n)||n.includes(s))&&(m.isShow=!0,m.isExpand=!0,O.forEach(d=>{d.isShow=!0,d.isExpand=!0})),m.children.length&&(m.children=this.doSearchByText(s,m.children,O.concat(m)))}return _}showAndExpandAll(s){for(var _ of s)_.isShow=!0,_.isExpand=!0,_.children=this.showAndExpandAll(_.children);return s}standardSearchText(s){return s=s.toLowerCase(),s=this.commonService.removeSpecialStringInSearch(s),this.commonService.convertVietnameseToEnglish(s)}}},2433:(E,T,o)=>{o.d(T,{h:()=>m});var p=o(48891),j=o(74506),e=o(85710),s=o(51698),_=o(88249),O=o(53793);let m=(()=>{var n;class d{constructor(){this.subscriptions=new e.yU,this.aiElearningService=(0,p.WQX)(j.T5),this.commonService=(0,p.WQX)(O.R),this.mapCacheSubscribers$=new Map}getKnowledgeByApi(t,r,c,l){let g=this.getCacheKey(t,r,c,l),v=this.mapCacheSubscribers$.get(g);return v||(v=new s.c(b=>{this.subscriptions.add(this.commonService.wrapApiResponse(this.aiElearningService.aiApiV1ElearningGetKnowledgeTreeGet(t,r,c,l||void 0)).subscribe(A=>{if(!A.success)return this.mapCacheSubscribers$.set(g,null),b.next({errorMessage:A.message,data:void 0}),void b.complete();b.next({errorMessage:void 0,data:{objs:A.data?.nodes??[]}}),b.complete()}))}).pipe((0,_.t)(1)),this.mapCacheSubscribers$.set(g,v),v)}getObjByObjectiveId(t,r){for(var c of t){if(c.objectiveId==r)return c;let l=this.getObjByObjectiveId(c.children,r);if(null!=l)return l}}getObjById(t,r){for(var c of t){if(c.id==r)return c;let l=this.getObjById(c.children,r);if(null!=l)return l}}getObjByKnowledgeIdOrObjectiveId(t,r,c){for(var l of t){if(l.knowledgeId==r||l.objectiveId==c)return l;let g=this.getObjByKnowledgeIdOrObjectiveId(l.children,r,c);if(null!=g)return g}}getAllObjectiveObjs(t,r){return t.forEach(c=>{c.objectiveId&&r.push({id:c.objectiveId,name:c.title,questionHistories:[]}),c.children.length&&(r=r.concat(this.getAllObjectiveObjs(c.children,[])))}),r}getCacheKey(t,r,c,l){return`${t}_${r}_${c?"true":"false"}_${l??0}`}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(n=d).\u0275fac=function(t){return new(t||n)},n.\u0275prov=p.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),d})()},36318:(E,T,o)=>{o.d(T,{G:()=>k});var p=o(89163),j=o(33887),e=o(48891),s=o(2915),_=o(32099),O=o(50334),m=o(2433),n=o(54460),d=o(15343),h=o(18718),t=o(73437);const r=i=>({nodeObjs:i}),c=(i,C)=>({"text-pending":i," link-color-hover":C});function l(i,C){if(1&i&&e.nrm(0,"azt-loading-effect",3),2&i){const u=e.XpG();e.Y8G("currentStatusObj",u.statusObj)}}function g(i,C){1&i&&e.eu8(0)}function v(i,C){if(1&i&&(e.j41(0,"table")(1,"tbody"),e.DNE(2,g,1,0,"ng-container",4),e.k0s()()),2&i){const u=e.XpG(),a=e.sdS(4);e.R7$(2),e.Y8G("ngTemplateOutlet",a)("ngTemplateOutletContext",e.eq3(2,r,u.nodeObjs))}}function b(i,C){1&i&&e.nrm(0,"lucide-icon",13)}function A(i,C){1&i&&e.nrm(0,"lucide-icon",14)}function z(i,C){if(1&i&&(e.j41(0,"i"),e.DNE(1,b,1,0,"lucide-icon",11)(2,A,1,0,"lucide-icon",12),e.k0s()),2&i){const u=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",u.isExpand),e.R7$(),e.Y8G("ngIf",!u.isExpand)}}function D(i,C){1&i&&(e.j41(0,"i"),e.nrm(1,"lucide-icon",15),e.k0s())}function y(i,C){1&i&&e.eu8(0)}function Q(i,C){if(1&i&&(e.qex(0),e.DNE(1,y,1,0,"ng-container",4),e.bVm()),2&i){const u=e.XpG().$implicit;e.XpG(3);const a=e.sdS(4);e.R7$(),e.Y8G("ngTemplateOutlet",a)("ngTemplateOutletContext",e.eq3(2,r,u.children))}}function w(i,C){if(1&i){const u=e.RV6();e.qex(0),e.j41(1,"tr",7)(2,"td")(3,"div",8),e.bIt("click",function(){const f=e.eBV(u).$implicit,I=e.XpG(3);return e.Njj(I.clickToNode(f))}),e.DNE(4,z,3,2,"i",5)(5,D,2,0,"i",5),e.j41(6,"label",9),e.nrm(7,"span",10),e.nI1(8,"mathJaxContent"),e.nI1(9,"async"),e.nI1(10,"safeContentQuestion"),e.k0s()()()(),e.DNE(11,Q,2,4,"ng-container",5),e.bVm()}if(2&i){const u=C.$implicit;e.R7$(),e.Y8G("hidden",!u.isShow),e.R7$(),e.xc7("padding-left",14*(u.level+1),"px"),e.R7$(),e.Y8G("ngClass",e.l_i(14,c,u.isSelected,!u.isSelected)),e.R7$(),e.Y8G("ngIf",u.children.length),e.R7$(),e.Y8G("ngIf",!u.children.length),e.R7$(2),e.Y8G("innerHTML",e.bMT(10,12,e.bMT(9,10,e.bMT(8,8,"L"+(u.level+1)+". "+u.text))),e.npT),e.R7$(4),e.Y8G("ngIf",u.isExpand)}}function x(i,C){if(1&i&&(e.qex(0),e.DNE(1,w,12,17,"ng-container",6),e.bVm()),2&i){const u=C.$implicit;e.R7$(),e.Y8G("ngForOf",u)}}function M(i,C){if(1&i&&e.DNE(0,x,2,1,"ng-container",5),2&i){const u=C.nodeObjs,a=e.XpG();e.Y8G("ngIf",a.asTemplateDataObj(u))}}let R=(()=>{var i;class C extends O.C{constructor(){super(...arguments),this.allowSelectKnowledgeOrObjective="only_objective",this.selectKnowledgeOrObjectiveEvent=new e.bkB,this.nodeObjs=[],this.sAztKnowledgeObjectiveService=(0,e.WQX)(m.h)}clickToNode(a){return"only_objective"==this.allowSelectKnowledgeOrObjective&&a.data.objectiveId||"knowledge_or_objective"==this.allowSelectKnowledgeOrObjective&&(a.data.knowledgeId||a.data.objectiveId)?this.selectKnowledgeOrObjectiveEvent.emit(a.data):void(a.isExpand?this.collapse(a):this.expand(a))}asTemplateDataObj(a){return a}initData(a,f,I){this.initStatusObj(),this.sAztKnowledgeObjectiveService.getKnowledgeByApi(a,f,!1,I).subscribe(S=>{if(S.errorMessage||!S.data)return this.errorStatusObj(S.errorMessage??"",!0);this.nodeObjs=this.standardTreeNodes(S.data.objs,0),this.stopStatusObj()})}standardTreeNodes(a,f){let I=[];return a.forEach(S=>{let K=!1;this.selectedObj?.knowledgeId&&S.knowledgeId==this.selectedObj.knowledgeId&&(K=!0),this.selectedObj?.objectiveId&&S.objectiveId==this.selectedObj.objectiveId&&(K=!0);let F={level:f,typeNode:S.objectiveId?"objective":"knowledge",isExpand:!0,isShow:!0,isSelected:K,text:S.title,data:{...S,children:[]},children:[]};F.children=this.standardTreeNodes(S.children,f+1),I.push(F)}),I}ngOnChanges(a){a.searchContent&&this.searchByText(this.searchContent??"")}ngOnInit(){super.ngOnInit(),this.initData(this.levelId,this.subjectId,this.bookId)}}return(i=C).\u0275fac=(()=>{let u;return function(f){return(u||(u=e.xGo(i)))(f||i)}})(),i.\u0275cmp=e.VBU({type:i,selectors:[["coazt-knowledge-objective-tree-for-common-question"]],inputs:{levelId:"levelId",subjectId:"subjectId",bookId:"bookId",selectedObj:"selectedObj",searchContent:"searchContent",allowSelectKnowledgeOrObjective:"allowSelectKnowledgeOrObjective"},outputs:{selectKnowledgeOrObjectiveEvent:"selectKnowledgeOrObjectiveEvent"},features:[e.Vt3,e.OA$],decls:5,vars:2,consts:[["doneLoading",""],["recursiveListTmpl",""],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"hidden"],[1,"clickable",3,"click","ngClass"],[1,"form-check-label",2,"line-height","1.5"],[3,"innerHTML"],["name","chevron-down","size","14",4,"ngIf"],["name","chevron-right","size","14",4,"ngIf"],["name","chevron-down","size","14"],["name","chevron-right","size","14"],["name","dot","size","14"]],template:function(a,f){if(1&a&&e.DNE(0,l,1,1,"azt-loading-effect",2)(1,v,3,4,"ng-template",null,0,e.C5r)(3,M,1,1,"ng-template",null,1,e.C5r),2&a){const I=e.sdS(2);e.Y8G("ngIf",f.statusObj.loading)("ngIfElse",I)}},dependencies:[n.YU,n.Sq,n.bT,n.T3,d.WGl,h.K,n.Jj,t.km,t.ep],encapsulation:2}),C})(),k=(()=>{var i;class C extends j._{searchByText(a){this.searchContent=a}selectKnowledgeOrObjective(a){this.dialogRef.close(a)}btnCloseDialog(){this.dialogRef.close(void 0)}constructor(a,f){super(f,a),this.dialogRef=a,this.data=f}}return(i=C).\u0275fac=function(a){return new(a||i)(e.rXU(p.CP,8),e.rXU(p.Vh,8))},i.\u0275cmp=e.VBU({type:i,selectors:[["coazt-knowledge-objective-dialog-for-common-question"]],features:[e.Vt3],decls:12,vars:14,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box","p-3"],[1,"pb-3"],[3,"onSearch","isServerSearch","placeholder"],[3,"minHeight"],[3,"selectKnowledgeOrObjectiveEvent","levelId","subjectId","bookId","selectedObj","searchContent","allowSelectKnowledgeOrObjective"],[1,"text-right","border-t","border-slate-200","dark:border-darkmode-400","p-3"],[1,"btn","btn-secondary","w-24",3,"click"]],template:function(a,f){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"azt-search-box",4),e.nI1(5,"mytranslate"),e.bIt("onSearch",function(S){return f.searchByText(S.searchObj)}),e.k0s()(),e.j41(6,"azt-mat-dialog-content",5)(7,"coazt-knowledge-objective-tree-for-common-question",6),e.bIt("selectKnowledgeOrObjectiveEvent",function(S){return f.selectKnowledgeOrObjective(S)}),e.k0s()()(),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return f.btnCloseDialog()}),e.EFF(10),e.nI1(11,"mytranslate"),e.k0s()()()()),2&a&&(e.R7$(4),e.Y8G("isServerSearch",!1)("placeholder",e.bMT(5,10,"lang_common_search_by_name")),e.R7$(2),e.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 300px)"),e.R7$(),e.Y8G("levelId",f.data.levelId)("subjectId",f.data.subjectId)("bookId",f.data.bookId)("selectedObj",f.data.selectedObj)("searchContent",null==f.searchContent?null:f.searchContent.searchContent)("allowSelectKnowledgeOrObjective",f.data.allowSelectKnowledgeOrObjective),e.R7$(3),e.SpI(" ",e.bMT(11,12,"lang_button_close")," "))},dependencies:[s.U,_.W,R,t.wp],encapsulation:2}),C})()}}]);