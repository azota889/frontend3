"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[2795],{5955:(A,P,l)=>{l.d(P,{C:()=>_});var D=l(48891);let _=(()=>{var s;class r{startProcessLayout(){this.onElementLoaded(o=>{if(!o)return;const p=this.el.nativeElement,C=Array.from(p.children);let M=1,m=C.map(g=>this.getChildrenWidthOfElement(g));[2,4].forEach(g=>{this.isLayout(o.width,m,g)&&(M=g)}),p.classList.remove("row"),C.forEach(g=>{g.classList.remove("col-sm-12"),g.classList.remove("col-md-6")}),p.classList.add("layout"),p.classList.add("layout-"+M)})}isLayout(o,p,C){let M=Math.floor(o/C);for(let m of p)if(m+r.PADDING_ITEM>M)return!1;return!0}onElementLoaded(o,p=0){if(this.haveDestroyComponent||p>=10)return o(void 0);let C=this.getWidthHeightOfElement(this.el.nativeElement);if(C.width>0&&C.height)return o(C);this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.onElementLoaded(o,p+1)},100)})}getWidthHeightOfElement(o){return o.getBoundingClientRect()}getChildrenWidthOfElement(o){let p=0;return Array.from(o.children).forEach(C=>p+=C.getBoundingClientRect().width),p}ngOnDestroy(){this.haveDestroyComponent=!0}ngOnChanges(o){o.answerSizeManager&&o.answerSizeManager.currentValue!==o.answerSizeManager.previousValue&&o.answerSizeManager.currentValue>=1&&this.startProcessLayout()}constructor(o){this.el=o,this.answerSizeManager=0,this.ngZone=(0,D.WQX)(D.SKi),this.haveDestroyComponent=!1,this.startProcessLayout()}}return(s=r).PADDING_ITEM=40,s.\u0275fac=function(o){return new(o||s)(D.rXU(D.aKT))},s.\u0275dir=D.FsC({type:s,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[D.OA$]}),r})()},25539:(A,P,l)=>{l.d(P,{I:()=>D});class D{constructor(){this.answerLabelsMockup={},this.showEssayMark=!0}}},5382:(A,P,l)=>{l.d(P,{n:()=>D});class D{constructor(s,r,f,o){this.tasks=new Array,this.queues=new Array,this.isRunning=!1,this.allTasks=0,this.wrapCounter=0,this.wrapCounterDone=0,this.countTaskRootDone=0,this.limitOneProcess=s,this.resultCommonTemp={datas:[],errs:[]},this.actionLogItem=r,this.delayTime=f||1e3,this.endWithError=o??!1}addTask(s,r,f,o){if(this.isRunning)return;var p=f||[];const C=this.queues.length;this.allTasks++,this.queues.push({task:()=>new Promise(m=>{this.wrapCounter++,r.call(s,...p).then(g=>{this.wrapCounterDone++,this.callLog(o),m({status:!0,value:g,index:C})}).catch(g=>{this.wrapCounterDone++,this.callLog(o),m({status:!1,error:g,index:C})})}),name:o})}callLog(s){this.actionLogItem&&this.allTasks>0&&this.actionLogItem.function.call({},this.wrapCounterDone,this.allTasks,...this.actionLogItem.params?this.actionLogItem.params:[],s)}start(){return new Promise(s=>{0===this.queues.length&&s({datas:[],errs:[]}),this.resultCommonTemp={datas:[],errs:[]};for(let r=0;r<this.limitOneProcess;r++){const f=this.queues.shift();if(!f)break;this.tasks.push(f)}this.countTaskRootDone=0,this.isRunning=!0,this.runner(s)})}checker(s,r){this.countTaskRootDone++,s.status&&s.value?this.resultCommonTemp.datas.push({index:s.index,value:s.value}):s.error&&this.resultCommonTemp.errs.push({index:s.index,value:s.error}),this.resultCommonTemp.errs.length>0&&this.endWithError&&(this.isRunning=!1,r(this.makeResultObj())),this.countTaskRootDone===this.allTasks&&(this.isRunning=!1,r(this.makeResultObj())),this.nextItem(r)}makeResultObj(){return{datas:this.resultCommonTemp.datas.sort(function(s,r){return s.index-r.index}).map(s=>s.value),errs:this.resultCommonTemp.errs.sort(function(s,r){return s.index-r.index}).map(s=>s.value)}}nextItem(s){const r=this.queues.shift();r&&r.task.call(this).then(f=>this.checker(f,s))}runner(s){this.tasks.length>0?this.tasks.forEach(r=>{r.task.call(this).then(f=>this.checker(f,s))}):(this.isRunning=!1,s(this.makeResultObj()))}}},76671:(A,P,l)=>{l.d(P,{c:()=>M});var D=l(73014),_=l(27691),s=l(5382),r=l(48891),f=l(53793),o=l(58112),p=l(48451);const C=l(4060);let M=(()=>{var m;class g{constructor(t,e,n){this.commonService=t,this.sAztCommonCdnService=e,this.apiUploadService=n,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}convertBase64OfMathJaxToCdnUrl(t){return new Promise(e=>{var n=this.getValueContentQuestion(t.questionContent??""),a=this.getValueContentQuestion(t.answerConfig??""),d=t.answerMedia??"",i=this.removeBase64MathJaxInQuestionContent(t.questionText??"");if(0===n.length||0===a.length)return void e(t);let w=this.encodeContent(n[0].content),E=[];a.forEach((u,v)=>{E.push({i:v,d:this.encodeContent(u.content)})});let h=this.encodeContent(d);var O=0;let T=[];for(let u=0;u<w.raws.length;u++)w.raws[u].i=O,O++,T.push(w.raws[u]);for(let u=0;u<h.raws.length;u++)h.raws[u].i=O,O++,T.push(h.raws[u]);E.forEach(u=>{for(let v=0;v<u.d.raws.length;v++)u.d.raws[v].i=O,O++,T.push(u.d.raws[v])}),T.length>0?this.uploadRawContent(T.map(u=>u.l)).then(u=>{w.raws.forEach(v=>{let R=this.stringFirst+btoa(JSON.stringify({l:u,i:v.i}));n[0].content=this.commonService.replaceAll(n[0].content,v.l,R)??""}),h.raws.forEach(v=>{let R=this.stringFirst+btoa(JSON.stringify({l:u,i:v.i}));d=this.commonService.replaceAll(d,v.l,R)??""}),E.forEach(v=>{v.d.raws.forEach(R=>{let S=this.stringFirst+btoa(JSON.stringify({l:u,i:R.i}));a[v.i].content=this.commonService.replaceAll(a[v.i].content,R.l,S)??""})}),t.questionContent=JSON.stringify(n),t.answerConfig=JSON.stringify(a),t.answerMedia=d,t.questionText=i,e(t)}).catch(()=>{e(t)}):e(t)})}decodeMathJaxCodeToCdnUrl(t){return new Promise(e=>{const n=new s.n(10);if(n.addTask(this,()=>new Promise(a=>{this.decodeContent(t.content??"").then(d=>{t.content=d,a(!0)}).catch(()=>{a(!1)})})),n.addTask(this,()=>new Promise(a=>{this.decodeContent(t.help??"").then(d=>{t.help=d,a(!0)}).catch(()=>{a(!1)})})),t.answers)for(let a=0;a<t.answers.length;a++)n.addTask(this,()=>new Promise(d=>{t.answers&&this.decodeContent(t.answers[a].content??"").then(i=>{t.answers&&(t.answers[a].content=i),d(!0)}).catch(()=>{d(!1)})}));n.start().then(()=>{e()})})}getValueContentQuestion(t){return this.commonService.castJsonToObj(t)??[]}getAllMatchWithContent(t){let n,e=[];for(;null!==(n=g.searchPattern.exec(t));)e.includes(n[0])||e.push(n[0]);return e}getRawContent(t,e){return t=this.sAztCommonCdnService.getMyCdn(t),new Promise((n,a)=>{const d=this.dataRaws.findIndex(i=>i.l===t);-1===d?fetch(t).then(i=>i.blob()).then(i=>i.arrayBuffer()).then(i=>{const w=C.inflate(i),E=this.commonService.castJsonToObj((new TextDecoder).decode(w));this.dataRaws.push({l:t,d:E??[]}),E&&E[e]?n(E[e]):a(new Error("Not found index"))}).catch(()=>{a(new Error("Exception at feed link"))}):this.dataRaws[d].d&&this.dataRaws[d].d[e]?n(this.dataRaws[d].d[e]):a(new Error("Not found index"))})}uploadRawContent(t){return new Promise((e,n)=>{const a=JSON.stringify(t),d=(new TextEncoder).encode(a),i=C.deflate(d),w=new Blob([i],{type:"application/octet-stream"}),E=new File([w],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(E).subscribe(h=>{h.type!=_.hv.UploadProgress&&(1==h.success&&h.data?e(h.data.url??""):n(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+h.message)))})})}removeBase64MathJaxInQuestionContent(t){return this.encodeContent(t).raws.forEach(n=>{t=this.commonService.replaceAll(t,n.l,"")??""}),t}encodeContent(t){let e=this.getAllMatchWithContent(t),n=[];for(let a=0;a<e.length;a++){let i=e[a].replace(g.searchPattern,"$1");i.startsWith(this.stringFirst)||n.push({l:i,i:n.length})}return{content:t,raws:n}}decodeContent(t){var e=this;return(0,D.A)(function*(){let n=e.getAllMatchWithContent(t);for(let a=0;a<n.length;a++){const d=n[a];let i=d.replace(g.searchPattern,"$1");for(let w=0;w<e.stringFirstOld.length;w++)if(i.startsWith(e.stringFirstOld[w])){t=e.commonService.replaceAll(t,d,"")??"";continue}if(i.startsWith(e.stringFirst)){let w=e.commonService.castJsonToObj(atob(i.replace(e.stringFirst,"")));if(w){let E=yield e.getRawContent(w.l,w.i);t=e.commonService.replaceAll(t,i,E)??""}}}return t})()}}return(m=g).searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,m.\u0275fac=function(t){return new(t||m)(r.KVO(f.R),r.KVO(o.c),r.KVO(p.T))},m.\u0275prov=r.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),g})()},10933:(A,P,l)=>{l.d(P,{g:()=>C});var D=l(65106),_=l(5382),s=l(94329),r=l(48891),f=l(58112),o=l(53793),p=l(76671);let C=(()=>{var M;class m{parseRenderQuestions(c,t,e,n,a,d){return new Promise((i,w)=>{const h=new _.n(25,{function:(O,T)=>{t&&t(O/T*100)}},n??1e3);c.forEach(O=>{h.addTask(this,this.parseRenderQuestion,[O,e,a,d])}),h.start().then(O=>{if(O.errs.length>0){const T=[];O.errs.forEach(u=>{let v=T.find(R=>R.type===u.type);v||T.push(u),v?.data.concat(u.data)}),w(T)}else i(c)})})}parseRenderQuestion(c,t,e,n){return new Promise((a,d)=>{var i=new s.h(this.sAztCommonCdnService,this.commonService,t||new D.y,h=>{d(h)});i.callbackPushImage=(h,O)=>{this.pushImage(h,O,c)},i.caller=this;const E=new _.n(n?1:20,void 0,0);c.content&&E.addTask(this,()=>new Promise(h=>{c.content=i.render(this.commonService.removeBracket(c.content??""),()=>{h()})})),c.answers&&c.answers.forEach(h=>{E.addTask(this,()=>new Promise(O=>{h.content=i.render(h.content||"",()=>{O()})}))}),c.help&&E.addTask(this,()=>new Promise(h=>{c.help=i.render(c.help,()=>{h()})})),c.groupInfo&&c.groupInfo.groupContent&&E.addTask(this,()=>new Promise(h=>{c.groupInfo&&c.groupInfo.groupContent?c.groupInfo.groupContent=i.render(this.commonService.removeBracket(c.groupInfo.groupContent),()=>{h()}):h()})),e&&E.addTask(this,()=>new Promise(h=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(c).then(()=>{h()})})),E.start().then(h=>{h.errs.length||a()})})}pushImage(c,t,e){if(!e)return;let n=new RegExp("<div id='"+c+"'[^>]+></div>","g");e.content&&(e.content=e.content.replace(n,t??"")),e.answers&&e.answers.forEach(a=>a.content=a.content?.replace(n,t??"")),e.help&&(e.help=e.help.replace(n,t??"")),e.groupInfo&&e.groupInfo.groupContent&&(e.groupInfo.groupContent=e.groupInfo.groupContent.replace(n,t??""))}constructor(c,t,e){this.sAztCommonCdnService=c,this.commonService=t,this.dataAztMathRawHelper=e}}return(M=m).\u0275fac=function(c){return new(c||M)(r.KVO(f.c),r.KVO(o.R),r.KVO(p.c))},M.\u0275prov=r.jDH({token:M,factory:M.\u0275fac,providedIn:"root"}),m})()},2915:(A,P,l)=>{l.d(P,{U:()=>M});var D=l(59640),_=l(48891),s=l(54460),r=l(89163),f=l(5502);const o=["aztDialogContentBox"],p=["*"],C=(m,g)=>({"width.px":m,"height.%":100,"--scrollbar-size":g});let M=(()=>{var m;class g extends D.H{checkHeightOfElement(){if(!this.aztDialogContentBox)return;var t=this.aztDialogContentBox.nativeElement.querySelector("."+this.contentBoxClassName);if(!t)return;let e=Math.round(window.innerHeight*this.defaultHeight/100),n=t.getBoundingClientRect().height+1,a=!(n<e),d=(n<e?n:e)+"px",i="72vh";a!=this.isScroll&&(this.isScroll=a),this.aztDialogContentBox.nativeElement.style.height!=d&&(this.aztDialogContentBox.nativeElement.style.height=d),this.aztDialogContentBox.nativeElement.style.maxHeight!=i&&(i=d),this.minHeight&&(this.aztDialogContentBox.nativeElement.style.minHeight=this.minHeight)}ngAfterViewChecked(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.checkHeightOfElement()},0)})}constructor(t){super(),this.ngZone=t,this.defaultHeight=72,this.defaultWidth=0,this.minHeight=void 0,this.isScroll=!1,this.contentBoxClassName="azt-mat-dialog-content-box"}}return(m=g).\u0275fac=function(t){return new(t||m)(_.rXU(_.SKi))},m.\u0275cmp=_.VBU({type:m,selectors:[["azt-mat-dialog-content"]],viewQuery:function(t,e){if(1&t&&_.GBs(o,5),2&t){let n;_.mGM(n=_.lsd())&&(e.aztDialogContentBox=n.first)}},inputs:{defaultHeight:"defaultHeight",defaultWidth:"defaultWidth",minHeight:"minHeight"},features:[_.Vt3],ngContentSelectors:p,decls:5,vars:7,consts:[["aztDialogContentBox",""],["scrollViewport","","pointerEventsMethod","scrollbar",3,"visibility","ngStyle"]],template:function(t,e){1&t&&(_.NAR(),_.j41(0,"mat-dialog-content",null,0)(2,"ng-scrollbar",1)(3,"div"),_.SdG(4),_.k0s()()()),2&t&&(_.R7$(2),_.Y8G("visibility","hover")("ngStyle",_.l_i(4,C,e.defaultWidth||"auto",e.isScroll?"5px":"0")),_.R7$(),_.HbH(e.contentBoxClassName))},dependencies:[s.B3,r.Yi,f.Yh,f.Gl],encapsulation:2}),g})()}}]);