(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[5853],{59702:(ft,Ae,y)=>{"use strict";y.d(Ae,{Q:()=>De});var s=y(48891),d=y(89163),h=y(33887),_=y(50589),x=y(45269),T=y(27988),ie=y(56562),fe=y(54460),p=y(47712),q=y(18718),N=y(2915),R=y(69135),z=y(52811),S=y(15343),K=y(47348);const B=(he,X)=>({"bg-info text-white":he,"bg-slate-300":X}),M=()=>({"text-pending":!0});function w(he,X){if(1&he&&s.eu8(0,5),2&he){s.XpG();const be=s.sdS(5);s.Y8G("ngTemplateOutlet",be)}}function D(he,X){if(1&he&&s.eu8(0,5),2&he){s.XpG();const be=s.sdS(3);s.Y8G("ngTemplateOutlet",be)}}function Z(he,X){if(1&he&&(s.j41(0,"div",7),s.nrm(1,"azt-loading-effect",8),s.k0s()),2&he){const be=s.XpG(2);s.R7$(),s.Y8G("currentStatusObj",be.statusObj)}}function ne(he,X){1&he&&s.nrm(0,"azt-loading-ui",15)}function re(he,X){if(1&he){const be=s.RV6();s.j41(0,"div",9),s.nrm(1,"iframe",10),s.nI1(2,"safe"),s.j41(3,"div",11)(4,"button",12),s.bIt("click",function(){s.eBV(be);const Pe=s.XpG(2);return s.Njj(Pe.handleCloseDialog())}),s.EFF(5),s.nI1(6,"mytranslate"),s.k0s(),s.j41(7,"button",13),s.bIt("click",function(){s.eBV(be);const Pe=s.XpG(2);return s.Njj(Pe.orderBuyExam())}),s.DNE(8,ne,1,0,"azt-loading-ui",14),s.j41(9,"span"),s.EFF(10),s.nI1(11,"mytranslate"),s.k0s()()()()}if(2&he){let be;const Ge=s.XpG(2);s.R7$(),s.Y8G("src",s.bMT(2,5,null!==(be=Ge.showIframeInContent)&&void 0!==be?be:""),s.f$h),s.R7$(4),s.SpI(" ",s.bMT(6,7,"lang_payment_confirm_payment_buy_later")," "),s.R7$(2),s.Y8G("disabled",Ge.statusObj.loading),s.R7$(),s.Y8G("ngIf",Ge.statusObj.loading),s.R7$(2),s.JRh(s.bMT(11,9,"lang_payment_confirm_payment_button"))}}function oe(he,X){if(1&he&&s.DNE(0,Z,2,1,"div",6)(1,re,12,11,"ng-template",null,2,s.C5r),2&he){const be=s.sdS(2),Ge=s.XpG();s.Y8G("ngIf",Ge.statusObj.loading)("ngIfElse",be)}}function Be(he,X){if(1&he&&s.nrm(0,"azt-loading-effect",8),2&he){const be=s.XpG(2);s.Y8G("currentStatusObj",be.statusObj)}}function Oe(he,X){if(1&he&&(s.nrm(0,"div",46),s.nI1(1,"safeNormalHtmlContent")),2&he){const be=s.XpG().$implicit;s.Y8G("innerHTML",s.bMT(1,1,be.description),s.npT)}}function Ze(he,X){if(1&he){const be=s.RV6();s.j41(0,"div",40)(1,"div",41),s.bIt("click",function(){const Pe=s.eBV(be).$implicit,Ne=s.XpG(3);return s.Njj(Ne.chooseCombo(Pe))}),s.j41(2,"div",40),s.EFF(3),s.k0s(),s.DNE(4,Oe,2,3,"div",42),s.j41(5,"div",43),s.nrm(6,"span",44),s.nI1(7,"translateToKeyParam"),s.j41(8,"span",45),s.EFF(9),s.nI1(10,"formatMoney"),s.k0s()()()()}if(2&he){const be=X.$implicit,Ge=s.XpG(3);s.R7$(),s.Y8G("ngClass",s.l_i(10,B,(null==Ge.currentComboObj?null:Ge.currentComboObj.id)==be.id,(null==Ge.currentComboObj?null:Ge.currentComboObj.id)!=be.id)),s.R7$(2),s.JRh(be.name),s.R7$(),s.Y8G("ngIf",be.description),s.R7$(2),s.Y8G("innerHTML",s.i5U(7,5,"lang_payment_total_exam_in_combo",be.items.length.toString()),s.npT),s.R7$(3),s.JRh(s.bMT(10,8,be.price)+" VND")}}function Ie(he,X){if(1&he&&(s.qex(0),s.j41(1,"div",49)(2,"div",50),s.nrm(3,"lucide-icon",51),s.k0s(),s.j41(4,"div",52)(5,"div",53,3),s.EFF(7),s.k0s()()(),s.bVm()),2&he){const be=X.$implicit,Ge=s.sdS(6);s.R7$(3),s.Y8G("ngClass",s.lJ4(5,M)),s.R7$(2),s.FS9("matTooltip",be.name),s.Y8G("isDisabledTooltip",!1)("matTooltipDisabled",Ge.isDisabled),s.R7$(2),s.SpI(" ",be.name," ")}}function ct(he,X){if(1&he&&(s.j41(0,"div",47),s.DNE(1,Ie,8,6,"ng-container",48),s.k0s()),2&he){const be=s.XpG(3);s.R7$(),s.Y8G("ngForOf",be.currentComboObj.items)}}function it(he,X){1&he&&s.nrm(0,"azt-loading-ui",15)}function Ce(he,X){if(1&he){const be=s.RV6();s.j41(0,"azt-mat-dialog-content",18)(1,"div",19)(2,"div"),s.DNE(3,Ze,11,13,"div",20),s.k0s(),s.DNE(4,ct,2,1,"div",21),s.j41(5,"div",22)(6,"div",23),s.EFF(7),s.nI1(8,"mytranslate"),s.k0s(),s.j41(9,"div",24)(10,"div",25)(11,"div",26)(12,"div",27),s.nrm(13,"img",28),s.nI1(14,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(15,"div",26)(16,"div",27),s.nrm(17,"img",29),s.nI1(18,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(19,"div",26)(20,"div",27),s.nrm(21,"img",30),s.nI1(22,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(23,"div",26)(24,"div",27),s.nrm(25,"img",31),s.nI1(26,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(27,"div",26)(28,"div",27),s.nrm(29,"img",32),s.nI1(30,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(31,"div",26)(32,"div",27),s.nrm(33,"img",33),s.nI1(34,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(35,"div",26)(36,"div",27),s.nrm(37,"img",34),s.nI1(38,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(39,"div",26)(40,"div",27),s.nrm(41,"img",35),s.nI1(42,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(43,"div",26)(44,"div",27),s.nrm(45,"img",36),s.nI1(46,"coreModConvertCdnLinkOfGitHub"),s.k0s()(),s.j41(47,"div",26)(48,"div",27),s.nrm(49,"img",37),s.nI1(50,"coreModConvertCdnLinkOfGitHub"),s.k0s()()()()()()(),s.j41(51,"div",38)(52,"div",39)(53,"button",12),s.bIt("click",function(){s.eBV(be);const Pe=s.XpG(2);return s.Njj(Pe.handleCloseDialog())}),s.EFF(54),s.nI1(55,"mytranslate"),s.k0s(),s.j41(56,"button",13),s.bIt("click",function(){s.eBV(be);const Pe=s.XpG(2);return s.Njj(Pe.orderBuyExam())}),s.DNE(57,it,1,0,"azt-loading-ui",14),s.j41(58,"span"),s.EFF(59),s.nI1(60,"mytranslate"),s.k0s()()()()}if(2&he){const be=s.XpG(2);s.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 90px)"),s.R7$(3),s.Y8G("ngForOf",be.comboObjs),s.R7$(),s.Y8G("ngIf",be.currentComboObj),s.R7$(3),s.SpI(" ",s.bMT(8,18,"lang_payment_supported_payment_methods")," "),s.R7$(6),s.Y8G("src",s.bMT(14,20,"images/method-payment/vnpay_full.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(18,22,"images/method-payment/vietcombank.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(22,24,"images/method-payment/techcombank.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(26,26,"images/method-payment/vietinbank.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(30,28,"images/method-payment/mbbank.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(34,30,"images/method-payment/agribank.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(38,32,"images/method-payment/bidv.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(42,34,"images/method-payment/acb.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(46,36,"images/method-payment/hdbank.svg"),s.B4B),s.R7$(4),s.Y8G("src",s.bMT(50,38,"images/method-payment/vpbank.svg"),s.B4B),s.R7$(5),s.SpI(" ",s.bMT(55,40,"lang_payment_confirm_payment_buy_later")," "),s.R7$(2),s.Y8G("disabled",be.statusObj.loading),s.R7$(),s.Y8G("ngIf",be.statusObj.loading),s.R7$(2),s.JRh(s.bMT(60,42,"lang_payment_confirm_payment_button"))}}function ve(he,X){if(1&he&&(s.j41(0,"div",16),s.DNE(1,Be,1,1,"azt-loading-effect",17)(2,Ce,61,44,"ng-template",null,2,s.C5r),s.k0s()),2&he){const be=s.sdS(3),Ge=s.XpG();s.R7$(),s.Y8G("ngIf",Ge.statusObj.loading)("ngIfElse",be)}}let De=(()=>{var he;class X extends h._{handleCloseDialog(){this.dialogRef.close("close")}chooseCombo(Ge){this.currentComboObj=Ge}orderBuyExam(){if(!this.currentComboObj)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.sAztBrowserStorageService.saveSessionStorage("payment_currentComboObj",this.currentComboObj.id.toString()),this.initStatusObj(),this.callApiToBuy(this.currentComboObj.id)}callApiToBuy(Ge){this.waitDestroy(this.productOrderService.apiProductOrderBuyExamByCoinGet(Ge).subscribe(Pe=>{if(!Pe.success)return"lang_core_payment_not_enough_coin"!=Pe.message?this.errorStatusObj(Pe.message,!0):(this.myNavigationWithQueryString("/auth/vip-packages/studentCoin",`?backto=${encodeURIComponent(this.commonService.getCurrentUrlWithoutLocale()+"?pending=1")}&trackingKey=BUY_EXAM`),void this.dialogRef.close(void 0));window.location.reload()}))}initData(){this.waitDestroy(this.comboPackageService.apiComboPackageListComboPackagesByExamHashIdGet(this.data.examObj.hashId??"").subscribe(Ge=>{if(!Ge.success)return this.errorStatusObj(Ge.message,!0);if(!Ge.data?.objs?.length)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.comboObjs=Ge.data?.objs??[],this.currentComboObj=this.commonService.getFirstOfArray(this.comboObjs);let Pe=Number(this.sAztBrowserStorageService.getSessionStorage("payment_currentComboObj"));if(1==Number(this.commonService.getMyQueryParam("pending"))&&this.currentComboObj?.id==Pe)return this.callApiToBuy(Pe);this.stopStatusObj(),this.showIframeInContent&&this.sAztAzotaTrackingService.sendForceCustomEvent("PAYMENT_VIEW_IFRAME_CONTENT",[])}))}setViewport(){const Ge=document.createElement("meta");Ge.name="viewport",Ge.setAttribute("id","viewPortIframe");const Pe=Se=>{Ge.setAttribute("content",Se),document.head.appendChild(Ge)},Ne=window.innerWidth;if(Ne<768){const xe=420!==Ne?Ne/420:1;Pe(`width=420, user-scalable=no, initial-scale=${xe}, minimum-scale=${xe}, maximum-scale=${xe}`)}else Pe("width=960, user-scalable=no, initial-scale=1.0")}removeViewPort(){document.getElementById("viewPortIframe")?.remove()}ngOnInit(){super.ngOnInit(),this.initStatusObj(),this.initData(),this.setViewport()}constructor(Ge,Pe,Ne,qe,Se){super(Pe,Ge),this.dialogRef=Ge,this.data=Pe,this.productOrderService=Ne,this.comboPackageService=qe,this.sAztAzotaTrackingService=Se,this.comboObjs=[],this.showIframeInContent=void 0,this.sAztBrowserStorageService=(0,s.WQX)(_.z)}ngOnDestroy(){this.removeViewPort()}}return(he=X).\u0275fac=function(Ge){return new(Ge||he)(s.rXU(d.CP,8),s.rXU(d.Vh,8),s.rXU(x.Hg),s.rXU(T.E),s.rXU(ie.M))},he.\u0275cmp=s.VBU({type:he,selectors:[["payment-dialog"]],features:[s.Vt3],decls:6,vars:2,consts:[["showIframeContent",""],["showListExamContent",""],["doneLoading",""],["c","isDisabled"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet"],["class","box py-4 px-4",4,"ngIf","ngIfElse"],[1,"box","py-4","px-4"],[3,"currentStatusObj"],[1,"bg-white",2,"height","100%"],["width","100%",2,"height","calc(var(--vh, 1vh) * 100 - 70px)",3,"src"],[1,"text-center","mt-4","text-center","absolute","bottom-2","w-full"],[1,"btn","btn-secondary-soft","w-32","mr-4","btn-lg","text-xl",3,"click"],[1,"btn","btn-primary","btn-lg","text-xl",3,"click","disabled"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"box","py-4","px-4",2,"height","100%"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"minHeight"],[2,"margin-right","-5px"],["class","pb-2",4,"ngFor","ngForOf"],["class","box border border-slate-200 dark:border-darkmode-400 pt-2",4,"ngIf"],[1,"mt-4"],[1,"font-medium"],[1,"mt-2"],[1,"grid","grid-cols-10","gap-4"],[1,"col-span-5","md:col-span-2","flex","justify-center"],[1,"p-1","rounded-lg","border","border-slate-200","dark:border-darkmode-400","w-full","h-full"],["alt","Vnpay",2,"height","100%",3,"src"],["alt","vietcombank",3,"src"],["alt","techcombank",3,"src"],["alt","vietinbank",3,"src"],["alt","mbbank",3,"src"],["alt","agribank",3,"src"],["alt","bidv",3,"src"],["alt","acb",3,"src"],["alt","hdbank",3,"src"],["alt","vpbank",3,"src"],[1,"flex","mt-4"],[1,"ml-auto"],[1,"pb-2"],[1,"clickable","box","pl-2","pr-2","pt-2",3,"click","ngClass"],["class","pb-2 mt-3 mb-3",3,"innerHTML",4,"ngIf"],[1,"pb-2","flex","items-center","justify-end","font-medium"],[3,"innerHTML"],[1,"ml-1","text-lg","text-warning"],[1,"pb-2","mt-3","mb-3",3,"innerHTML"],[1,"box","border","border-slate-200","dark:border-darkmode-400","pt-2"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-3","border-b","border-slate-200","dark:border-darkmode-400"],[1,"flex-none","image-fit","rounded-md","overflow-hidden"],["name","file-check","size","40",3,"ngClass"],[1,"ml-4","mr-auto"],[2,"line-height","1.2",3,"matTooltip","isDisabledTooltip","matTooltipDisabled"]],template:function(Ge,Pe){1&Ge&&s.DNE(0,w,1,1,"ng-container",4)(1,D,1,1,"ng-container",4)(2,oe,3,2,"ng-template",null,0,s.C5r)(4,ve,4,2,"ng-template",null,1,s.C5r),2&Ge&&(s.Y8G("ngIf",!Pe.showIframeInContent),s.R7$(),s.Y8G("ngIf",Pe.showIframeInContent))},dependencies:[fe.YU,fe.Sq,fe.bT,fe.T3,p.oV,q.K,N.U,R.f,z.R,S.WGl,K.wp,K.$g,K._y,K.JI,K.Vs,K.t0],encapsulation:2}),X})()},57081:(ft,Ae,y)=>{"use strict";y.d(Ae,{w:()=>T});var s=y(48891),d=y(53793),h=y(68774),_=y(50589),x=y(99927);let T=(()=>{var ie;class fe{_saveSortTypeOfSetting(q){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,q)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(q){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==q}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(q,N){var R=[];return N.forEach(z=>{z.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(q,z.results??new Array),R.push(z)}),R}_filterExamResultObjsByFilterSettingObjNotInClassroom(q,N){var R=[];if(q.isMarked||q.isNotMarked||q.isOnTest||q.isNotSubmit||q.isNotTested)for(var z of N){let S=!1,K=q.isOnTest||q.isNotSubmit;q.isMarked&&1==z.isMarked&&(!K||!(1!=z.status&&(z.isMarked||z.isNotMarked)))&&(S=!0),q.isNotMarked&&1==z.isNotMarked&&(!K||!(1!=z.status&&(z.isMarked||z.isNotMarked)))&&(S=!0),q.isOnTest&&(1==z.isOnTest||0==z.status&&(z.isMarked||z.isNotMarked))&&(S=!0),q.isNotTested&&1==z.isNotTested&&(S=!0),q.isNotSubmit&&(1==z.isNotSubmit||-1==z.status&&(z.isMarked||z.isNotMarked))&&(S=!0),S&&R.push(z)}else R=N;return R}_searchExamResultObjsByFullNameInClassroom(q,N){var R=[];return this.commonService.myClone(q).forEach(S=>{var K=this._searchExamResultObjsByFullNameNotInClassroom(S.results??[],N);K.length>0&&(S.results=K,R.push(S))}),R}_searchExamResultObjsByFullNameNotInClassroom(q,N){N=this.commonService.convertVietnameseToEnglish(N).toLowerCase();var R=[];return q.forEach(z=>{-1!=this.commonService.convertVietnameseToEnglish(z.fullName??"").toLowerCase().indexOf(N)&&R.push(z)}),R}_sortExamResultObjsBySettingObjByClassroom(q,N,R){return"isSortByNameAsc"==R?this.sortService.sortFirstNameStudentsInClass(q):"isSortByTimeDesc"==R?this.sortService.sortTimeStudentsInClass(q,1):"isSortByMarkDesc"==R?this.sortService.sortMarkStudentsInClass(q,1,N):this._sortExamResultObjsBySortTypeOfClassroom(q)}_sortExamResultObjsBySettingObjNotInClassroom(q,N,R){return"isSortByNameAsc"==R?this.sortService.sortFirstNameStudents(q):"isSortByTimeDesc"==R?this.sortService.sortTimeDESC(q):"isSortByMarkDesc"==R?this.sortService.sortMarkDESC(q,N):q}_sortExamResultObjsBySortTypeOfClassroom(q){var N=q.map(R=>({...R}));return N.forEach((R,z)=>{R.results=0==R.classObj?.sortType?this.sortService.sortFirstNameStudents(R.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(R.results??[],"pos","id"),N[z]=R}),N}_changeExamResultStatusForAllClassroom(q,N,R){var z=[];return q.forEach((S,K)=>{S.results=this._changeExamResultStatusForOneClassroom(S.results??new Array,N),S={indexCounter:K,...S,countSubmitted:R?S.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(S.results??new Array),showOnTab:S.showOnTab},z.push(S)}),z}_changeExamResultStatusForOneClassroom(q,N){var R=[...q];return R.forEach((z,S)=>{z.confirmedAt&&""!=z.confirmedAt&&z.resultId&&z.resultId>0?z.isMarked=!0:z.resultId&&z.resultId>0&&(!z.confirmedAt||""==z.confirmedAt)?z.isNotMarked=!0:z.resultId&&0!=z.resultId||!z.startedTest||""==z.startedTest||0!=z.status?z.resultId&&0!=z.resultId||!z.startedTest||""==z.startedTest||-1!=z.status?null==z.startedTest&&(z.isNotTested=!0):z.isNotSubmit=!0:z.isOnTest=!0,R[S]=z}),R.forEach((z,S)=>{z.files&&""!=z.files&&!Array.isArray(z.files)&&(z.filesParse=this.commonService.myParseJson(z.files)),R[S]=z}),R}_countTotalSubmittedOfExamResultObjs(q){var N=0;return q.forEach(R=>{(R.isMarked||R.isNotMarked)&&N++}),N}_counterTotalEssayOfQuestionObjs(q){let N=0;return q.forEach(R=>{this.answerTypeService.isEssayAnswer(R)&&N++}),N}_checkCounterEssayQuestionObjs(q){let N=0;return q.forEach(R=>{R.isEssay&&N++}),N}constructor(q,N,R,z){this.commonService=q,this.sortService=N,this.browserStorageService=R,this.answerTypeService=z,this.sortByStorageKey="exam_list_sort_by"}}return(ie=fe).\u0275fac=function(q){return new(q||ie)(s.KVO(d.R),s.KVO(h.g),s.KVO(_.z),s.KVO(x._))},ie.\u0275prov=s.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"}),fe})()},87515:(ft,Ae,y)=>{"use strict";y.d(Ae,{h:()=>R});var s=y(10936),d=y(51698),h=y(48891),_=y(53793),x=y(78472),T=y(51913),ie=y(41715),fe=y(50589),p=y(79064),q=y(91640),N=y(57081);let R=(()=>{var z;class S{constructor(B,M,w,D,Z,ne,re,oe){this.commonService=B,this.examPageResultService=M,this.permissionService=w,this.globalService=D,this.browserStorageService=Z,this.gzipHelper=ne,this.homeworkExamService=re,this.sAztExamResultListSortService=oe}getTestedUserObjs(B,M,w){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,M,"default",w)}getTestedLastMark(B,M,w){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,M,"last",void 0,w)}getTestedHighestMark(B,M,w){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,M,"highest",void 0,w)}getTestedFirstMark(B,M,w){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,M,"first",void 0,w)}getTestedAllResult(B,M,w){return this.globalService.startIntervalFunc(B),this.getTestedOfExamResult(B,M,"all",void 0,w)}getTestedOfExamResult(B,M,w,D,Z){return new d.c(ne=>{let re="tested_list_result_v2_"+M,oe=this.browserStorageService.getSimpleSessionStorage(re)??"",Be=this.gzipHelper.resultContentSupport(oe),Oe=Be&&this.commonService.willDeleteParseJson(Be)?this.commonService.willDeleteParseJson(Be):void 0;D&&oe&&Oe?(ne.next({status:200,success:1,data:Oe,message:"successful"}),ne.complete()):this.examPageResultService.apiExamPageResultGetNewObjV2Post({examId:M,classroomIds:Z}).subscribe(Ie=>{if(1==Ie.success){let it=Ie.data?.serverSecond??0,Ce=Ie.data?.examObj,ve=Ie.data?.classroomWithAvatarAndStudentObjs??new Array,De=Ie.data?.totalAttended??0,he=Ie.data?.examQuestionObjs??new Array,X=Ie.data?.examCreatorObj,be=Ie.data?.offlineExamObj,Ge=Ie.data?.hasEssayQuestion,Pe=Ie.data?.totalQuestion??0,Ne=Ie.data?.offlineMixQuestionObjs,qe=Ie.data?.canResetStudentCode,Se=Ie.data?.hasCreateStudentCode,xe=Ie.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",Ce)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",Ce)?this.getAllExamResultObjs(B,[],M,"",F=>{if(F.hasOwnProperty("success")&&1==F.success){let Y=this.mergeStudentWithAvatar(F.studentWithResultObjs??[]),et={},Xe=[];Y?.forEach($e=>{let Te=$e.parentId??"0";et.hasOwnProperty(Te)?et[Te].push(...$e.examResultObjs??[]):et[Te]=$e.examResultObjs??[],Xe=Xe.concat(et[Te])});let Qe=Ce?this.filterExamResultOnTest(Xe,Ce,it):{},ke=[],tt=[];if(this.homeworkExamService.mustInClassroom(Ce)&&ve.length>0)for(let $e=0;$e<ve.length;$e++){let Te=ve[$e].classroomObj;Te.classroomGroup=ve[$e].classroomGroup;let k=ve[$e].studentObjs??[],P=[];if(k.length>0)for(let H=0;H<k.length;H++){let We=k[H].parentId??"0";this.commonService.isExistInArray(tt,k[H].parentId)||tt.push(k[H].parentId??"0"),et.hasOwnProperty(We)&&(Array.isArray(k[H].examResultObjs)||(k[H].examResultObjs=[]),k[H].examResultObjs=this.findExamResultOfStudent(et[We],k[H].id??"0"));let Je=Qe.hasOwnProperty(k[H].parentId??0)?Qe[k[H].parentId??0]:0;if("all"==w)if(k[H].examResultObjs?.length)k[H].examResultObjs?.forEach((ze,dt)=>{let ae=this.commonService.castJsonToObj(JSON.stringify(ze));ae&&(ae.resultId=ae.testStatus&&ae.testStatus>0?ae.id:0);let at=this.createStudentWithResult(k[H],ae,Je,Pe,dt,k[H].examResultObjs?.length??0);P.push(at)});else{let ze=this.createStudentWithResult(k[H],void 0,Je,Pe,-1,0);P.push(ze)}else{let ze=this.filterExamResultByType(k[H].examResultObjs??[],w),dt=ze.hasOwnProperty(k[H].parentId??0)?ze[k[H].parentId??0]:void 0,at=this.createStudentWithResult(k[H],dt,Je,Pe,(dt&&null!=dt.indexTest&&dt.indexTest>=0?dt.indexTest:"first"==w?0:(k[H].examResultObjs?.length??0)-1)??0,k[H].examResultObjs?.length??0);P.push(at)}}ke.push({classObj:Te,results:P})}let st=[],rt=this.commonService.myClone(Y)??[];for(let $e=0;$e<rt?.length;$e++)if(!this.commonService.isExistInArray(tt,rt[$e].parentId)){let Te=Qe.hasOwnProperty(rt[$e].parentId??0)?Qe[rt[$e].parentId??0]:0;if("all"==w)if(rt[$e].examResultObjs?.length)rt[$e].examResultObjs?.forEach((k,P)=>{let H=this.commonService.castJsonToObj(JSON.stringify(k));H&&(H.resultId=H.testStatus&&H.testStatus>0?H.id:0);let We=this.createStudentWithResult(rt[$e],H,Te,Pe,P,rt[$e].examResultObjs?.length??0);st.push(We)});else{let k=this.createStudentWithResult(rt[$e],void 0,Te,Pe,-1,0);st.push(k)}else{let k=this.filterExamResultByType(rt[$e].examResultObjs??[],w),P=k.hasOwnProperty(rt[$e].parentId??0)?k[rt[$e].parentId??0]:void 0,We=this.createStudentWithResult(rt[$e],P,Te,Pe,(P&&null!=P?.indexTest&&P.indexTest>=0?P.indexTest:"first"==w?0:(rt[$e].examResultObjs?.length??0)-1)??0,rt[$e].examResultObjs?.length??0);st.push(We)}}"all"!=w&&st.sort(($e,Te)=>this.compareTwoDate($e.createdAt??"",Te.createdAt??""));let xt=0;(ke.length||st.length)&&(ke.forEach($e=>{$e.results?.forEach(Te=>{let k=this.getMaxGroupId(Te.groupPoints??[]);xt<k&&(xt=k)})}),st.forEach($e=>{let Te=this.getMaxGroupId($e.groupPoints??[]);xt<Te&&(xt=Te)})),"export_tool"==B&&Z?.length&&(ke=ke.filter($e=>this.commonService.isExistInArray(Z,$e.classObj?.id)),this.commonService.isExistInArray(Z,-1)||(st=[]));let de={studentsInClassResults:ke.length>0?ke:[],studentsNotInClassResults:st.length>0?st:[],totalAttended:De,totalQuestion:Pe,totalUsers:0,examCreatorObj:X,offlineMixQuestionObjs:Ne,examObj:Ce,hasEssayQuestion:Ge,offlineExamObj:be,canResetStudentCode:qe,hasCreateStudentCode:Se,questionObjs:he,fileTypeStr:xe,errorConfigClassroomPermission:Ie.data?.errorConfigClassroomPermission,errorMessage:Ie.data?.errorMessage,maxGroupId:xt};if("export_tool"!=B){let $e=this.gzipHelper.zipBigContent(JSON.stringify(de));this.browserStorageService.saveSimpleSessionStorage(re,$e)}ne.next({status:200,success:1,data:de,message:"successful"}),ne.complete()}else ne.next({status:F.code,success:0,data:null,message:F.message??""}),ne.complete()}):(ne.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:De,totalQuestion:Pe,hasEssayQuestion:Ge,totalUsers:0,examCreatorObj:X,offlineMixQuestionObjs:Ne,examObj:Ce,offlineExamObj:be,canResetStudentCode:qe,hasCreateStudentCode:Se,questionObjs:he,fileTypeStr:Ie.data?.fileTypeStr,errorConfigClassroomPermission:Ie.data?.errorConfigClassroomPermission,errorMessage:Ie.data?.errorMessage,maxGroupId:0},message:"successful"}),ne.complete())}else ne.next({status:Ie.code,success:0,data:null,message:Ie.message??""}),ne.complete()})})}getAllExamResultObjs(B,M,w,D,Z){this.examPageResultService.apiExamPageResultGetObjsV2Get(w,"test_review"==B||"export_tool"==B?"export":"tested_list",D).subscribe(re=>{1==re.success?(re.data?.objs&&M.push(...re.data.objs),re.data?.nextPage?this.globalService.isStopIntervalFunc(B)?Z({studentWithResultObjs:M,success:1}):setTimeout(()=>{this.getAllExamResultObjs(B,M,w,re.data?.nextPage??"",Z)},300):Z({studentWithResultObjs:M,success:1})):Z({code:re.code,studentWithResultObjs:[],success:0,message:re.message??""})})}compareTwoDate(B,M){var w=new Date(B).getTime();w=isNaN(w)?0:w;var D=new Date(M).getTime();return w-(D=isNaN(D)?0:D)>0?1:w-D<0?-1:0}filterExamResultOnTest(B,M,w){var D={};return B.forEach(Z=>{var ne=this.commonService.myClone(Z)??{};if(ne.testStatus)D[ne.userId??0]=ne.testStatus;else if(ne.startedTest&&w)if(M.endTime){var re=Math.floor(new Date(M.endTime).getTime()/1e3);D[ne.userId??0]=w<=re+60*(M.minutes??0)+600?0:-1}else{var oe=ne.startedTest?Math.floor(new Date(ne.startedTest).getTime()/1e3):0;D[ne.userId??0]=w<=oe+86400?0:-1}else D[ne.userId??0]=0}),D}filterExamResultByType(B,M){var w={};if(B.length>1)B.forEach((Z,ne)=>{var re=this.commonService.myClone(Z);Z.testStatus&&(re.resultId=re.id,re.indexTest=ne,"default"==M&&(w[re.userId??0]=re),"last"==M&&(w[re.userId??0]=re),"first"==M&&(w.hasOwnProperty(re.userId??0)||(w[re.userId??0]=re)),"highest"==M)&&(w.hasOwnProperty(re.userId??0)?(w[re.userId??0].mark??-1)<=(re.mark??-1)&&(w[re.userId??0]=re):w[re.userId??0]=re)});else{var D=this.commonService.myClone(B[0]??{});D.resultId=D.testStatus?D.id:0,D.indexTest=0,w[D.userId??0]=D}return w}findExamResultOfStudent(B,M){var w=[];return B.forEach(D=>{(D.studentId==M||null==D.studentId)&&w.push(D)}),w}addResultIdToExamResult(B){var M=[];return B.forEach(w=>{var D=this.commonService.myClone(w)??{};D.resultId=D.id,D.testStatus&&M.push(D)}),M}compareLengthWithExamQuestion(B,M){var w=this.commonService.myClone(B);if(M>0&&B.length<M)for(var D=0;D<M-B.length;D++)w.push("");return w}mergeStudentWithAvatar(B){var M=[];return B.forEach(w=>{var D=M.filter(ne=>ne.parentId==w.parentId);if(D&&0!=D.length)for(var Z=0;Z<M.length;Z++)M[Z].parentId==w.parentId&&(M[Z].examResultObjs=M[Z].examResultObjs?.concat(w.examResultObjs??[]));else M.push(w)}),M}createStudentWithResult(B,M,w,D,Z,ne){return{id:B.id,userId:B.parentId,studentId:B.id,identificationNumber:M?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??B.identificationNumber??0,offlineMixQuestionHashId:M?.offlineMark?.rawOfflineMixquestionId??0,studentCode:M?.offlineMark?.studentCode??0,gender:B.gender,fullName:B.fullName,avatar:B.avatar,birthday:B.birthday,resultId:M?.hasOwnProperty("resultId")?M.resultId:0,answers:M?.hasOwnProperty("answers")?M.answers:null,rightAnswer:M?.hasOwnProperty("rightAnswer")?M.rightAnswer:0,totalQuestion:M?.hasOwnProperty("totalQuestion")?M.totalQuestion:0,mark:M?.hasOwnProperty("mark")?M?.mark:null,trueFalseMark:M?.hasOwnProperty("trueFalseMark")?M.trueFalseMark:null,essayMark:M?.hasOwnProperty("essayMark")?M.essayMark:null,files:M?.hasOwnProperty("files")?M.files:null,infors:M?.hasOwnProperty("infors")?M?.infors:null,confirmedAt:M?.hasOwnProperty("confirmedAt")?M?.confirmedAt:null,startedTest:M?.hasOwnProperty("startedTest")?M?.startedTest:null,createdAt:M?.hasOwnProperty("createdAt")?M.createdAt:null,totalExamResultObjs:B.examResultObjs.length,answeredQuestions:M?.hasOwnProperty("answeredQuestions")?M.answeredQuestions:[],groupPoints:this.getGroupPoints(M?.answeredQuestions?M?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:M?.examTrackObj?.exitFullScreen,blurCount:M?.examTrackObj?.blurWindow},status:w,nameImages:B.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion(M?.answerMixObjs??[],D)??[],testedTime:Z+1,totalTestTime:ne,subjectMarkValues:M?.subjectMarks,isOffline:M?.isOffline??!1,countEssayQuestion:this.sAztExamResultListSortService._checkCounterEssayQuestionObjs(M?.hasOwnProperty("answeredQuestions")&&M?.answeredQuestions?M.answeredQuestions:[]),checkBoxGroupControl:new s.gE({isShow:new s.MJ(!1,{nonNullable:!0}),selectedCheckbox:new s.MJ(!1,{nonNullable:!0})}),questionTypeMarks:M?.questionTypeMarks??[],schoolName:B.schoolName??"",phone:B.phone??"",email:B.email??"",userName:B?.userName??""}}getGroupPoints(B){let M=[];return B.forEach(w=>{let D=!1;for(let Z=0;Z<M.length;Z++)M[Z].id==w.groupId&&(D=!0,M[Z].point+=w.correct&&w.scorePerQuestion?w.scorePerQuestion:0);!D&&w.groupId&&M.push({id:w.groupId,point:w.correct&&w.scorePerQuestion?w.scorePerQuestion:0})}),M.sort((w,D)=>(w.id??0)-(D.id??0)),M}getMaxGroupId(B){let M=[];return B.forEach(w=>{w.id&&!this.commonService.isExistInArray(M,w.id)&&M.push(w.id)}),M.length}}return(z=S).\u0275fac=function(B){return new(B||z)(h.KVO(_.R),h.KVO(x.TE),h.KVO(T.p),h.KVO(ie.r),h.KVO(fe.z),h.KVO(p.f),h.KVO(q.Z),h.KVO(N.w))},z.\u0275prov=h.jDH({token:z,factory:z.\u0275fac,providedIn:"root"}),S})()},32835:(ft,Ae,y)=>{"use strict";y.d(Ae,{i:()=>d});var s=y(48891);let d=(()=>{var h;class _{processData(T){let ie=[],fe=[];if(T)for(var p=0;p<T.length;p++)if("scroll"!=T[p][0]){var q={index:T[p][0],alpha:T[p][1],key:T[p][2],questionId:Number(T[p][3]),second:Number(T[p][4])};ie.push(q)}else{var N={scrollPos:Number(T[p][1]),second:Number(T[p][2])};fe.push(N)}return[ie,fe]}}return(h=_).\u0275fac=function(T){return new(T||h)},h.\u0275prov=s.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),_})()},97099:(ft,Ae,y)=>{"use strict";y.d(Ae,{B:()=>K});var s=y(54460),d=y(10936),h=y(65162),_=y(53220),x=y(81275),T=y(15343),ie=y(59055),fe=y(44233),p=y(5502),q=y(21656),N=y(70050),R=y(76407),z=y(35143),S=y(48891);let K=(()=>{var B;class M{}return(B=M).\u0275fac=function(D){return new(D||B)},B.\u0275mod=S.$C({type:B}),B.\u0275inj=S.G2t({imports:[s.MD,q.s,z.Q,N.L,d.YN,d.X1,p.Id,_.h,h.iI,T.flO.pick(T.Ptg),x.rc,ie.e,R.n,fe.An]}),M})()},54479:(ft,Ae,y)=>{"use strict";y.d(Ae,{t:()=>xt});var s=y(73014),d=y(27691),h=y(48891),_=y(10936),x=y(59640),T=y(78111),ie=y(64198),fe=y(83229),p=y(28023),q=y(58112),N=y(76476),R=y(48451),z=y(51113),S=y(54460),K=y(47712),B=y(7919),M=y(99965),w=y(84278),D=y(34815),Z=y(15343),ne=y(58588),re=y(47348);const oe=["mnoteContainer"],Be=["aztMarkNote"],Oe=de=>({display:de}),Ze=de=>({border:de}),Ie=de=>({"is-invalid":de}),ct=()=>({"mr-1 cursor-pointer":!0});function it(de,$e){if(1&de){const Te=h.RV6();h.j41(0,"lucide-icon",20),h.nI1(1,"mytranslate"),h.bIt("click",function(){h.eBV(Te);const P=h.XpG(2).$implicit;return h.Njj(P.showEssayMark=!1)}),h.k0s()}2&de&&(h.FS9("matTooltip",h.bMT(1,2,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),h.Y8G("ngClass",h.lJ4(4,ct)))}function Ce(de,$e){if(1&de){const Te=h.RV6();h.j41(0,"lucide-icon",21),h.nI1(1,"mytranslate"),h.bIt("click",function(){h.eBV(Te);const P=h.XpG(2).$implicit;return h.Njj(P.showEssayMark=!0)}),h.k0s()}2&de&&(h.FS9("matTooltip",h.bMT(1,2,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),h.Y8G("ngClass",h.lJ4(4,ct)))}function ve(de,$e){1&de&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&de&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function De(de,$e){1&de&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&de&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function he(de,$e){1&de&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&de&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function X(de,$e){if(1&de&&(h.j41(0,"div",22),h.DNE(1,ve,3,3,"span",10)(2,De,3,3,"span",10)(3,he,3,3,"span",10),h.k0s()),2&de){const Te=h.XpG(2).$implicit;h.R7$(),h.Y8G("ngIf",Te.essayAnswersFormGroup.controls.mark.errors.min),h.R7$(),h.Y8G("ngIf",Te.essayAnswersFormGroup.controls.mark.errors.max),h.R7$(),h.Y8G("ngIf",Te.essayAnswersFormGroup.controls.mark.errors.pattern)}}function be(de,$e){if(1&de&&(h.qex(0),h.j41(1,"div",13),h.DNE(2,it,2,5,"lucide-icon",14)(3,Ce,2,5,"lucide-icon",15),h.j41(4,"span",16),h.EFF(5),h.nI1(6,"mytranslate"),h.j41(7,"span",17),h.nI1(8,"mytranslate"),h.EFF(9),h.nI1(10,"mytranslate"),h.k0s()(),h.nrm(11,"input",18),h.nI1(12,"mytranslate"),h.k0s(),h.DNE(13,X,4,3,"div",19),h.bVm()),2&de){let Te;const k=h.XpG().$implicit,P=h.XpG();h.R7$(2),h.Y8G("ngIf",k.showEssayMark),h.R7$(),h.Y8G("ngIf",!k.showEssayMark),h.R7$(2),h.Lme(" ",h.bMT(6,14,"lang_auto_cau")," ",(null!==(Te=k.indexLabel)&&void 0!==Te?Te:0)+1," "),h.R7$(2),h.FS9("matTooltip",h.bMT(8,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.R7$(2),h.Lme("(",k.essMaxPoint," ",h.bMT(10,18,"lang_auto_diem_brackets"),""),h.R7$(2),h.FS9("placeholder",h.bMT(12,20,"lang_auto_nhap_diem")),h.Y8G("readonly",!P.showForTeacher)("decimal",!0)("ngClass",h.eq3(22,Ie,k.essayAnswersFormGroup.controls.mark&&k.essayAnswersFormGroup.controls.mark.invalid))("value",k.essayAnswersFormGroup.controls.mark.value)("formControl",k.essayAnswersFormGroup.controls.mark),h.R7$(2),h.Y8G("ngIf",k.essayAnswersFormGroup.controls.mark.errors)}}function Ge(de,$e){if(1&de&&(h.j41(0,"div",12),h.DNE(1,be,14,24,"ng-container",10),h.k0s()),2&de){const Te=$e.$implicit,k=$e.index,P=h.XpG();h.Y8G("ngStyle",h.eq3(2,Ze,k==P.questions.length-1?"none":"")),h.R7$(),h.Y8G("ngIf",Te.essayAnswersFormGroup)}}function Pe(de,$e){if(1&de){const Te=h.RV6();h.j41(0,"div",23)(1,"button",24),h.bIt("click",function(){h.eBV(Te);const P=h.XpG();return h.Njj(P.saveDataMarkExercise())}),h.EFF(2),h.nI1(3,"mytranslate"),h.nI1(4,"mytranslate"),h.k0s()()}if(2&de){const Te=h.XpG();h.R7$(),h.Y8G("disabled",Te.isLoading||Te.findQuestionFormInvalid()||Te.loadingDataCdn&&Te.files.length>0),h.R7$(),h.SpI(" ",Te.isLoading?h.bMT(3,2,"lang_auto_dang_luu_doing"):h.bMT(4,4,"lang_auto_luu_diem")," ")}}function Ne(de,$e){if(1&de&&h.nrm(0,"azt-question-standalone-for-student-at-review-page",29),2&de){let Te;const k=h.XpG().$implicit,P=h.XpG();h.Y8G("follower",P.followerRenderQuest)("examObj",P.examObj)("examConfig",P.examConfig)("questionObj",k)("curQuestionIndex",null!==(Te=k.indexLabel)&&void 0!==Te?Te:0)("userAnswersObj",P.userAnswersObj)("currentTab","essay_tab")}}function qe(de,$e){if(1&de&&h.nrm(0,"azt-question-standalone-for-teacher-at-review-page",30),2&de){let Te;const k=h.XpG().$implicit,P=h.XpG();h.Y8G("follower",P.followerRenderQuest)("examObj",P.examObj)("questionObj",k)("curQuestionIndex",null!==(Te=k.indexLabel)&&void 0!==Te?Te:0)("userAnswersObj",P.userAnswersObj)("orgExamObjs",P.orgExamObjs)("currentTab","essay_tab")}}function Se(de,$e){1&de&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&de&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function xe(de,$e){1&de&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&de&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function F(de,$e){1&de&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&de&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Y(de,$e){if(1&de&&(h.j41(0,"div",22),h.DNE(1,Se,3,3,"span",10)(2,xe,3,3,"span",10)(3,F,3,3,"span",10),h.k0s()),2&de){const Te=h.XpG(3).$implicit;h.R7$(),h.Y8G("ngIf",null==Te.essayAnswersFormGroup.controls.mark.errors?null:Te.essayAnswersFormGroup.controls.mark.errors.min),h.R7$(),h.Y8G("ngIf",null==Te.essayAnswersFormGroup.controls.mark.errors?null:Te.essayAnswersFormGroup.controls.mark.errors.max),h.R7$(),h.Y8G("ngIf",null==Te.essayAnswersFormGroup.controls.mark.errors?null:Te.essayAnswersFormGroup.controls.mark.errors.pattern)}}function et(de,$e){if(1&de&&(h.qex(0),h.j41(1,"div",34)(2,"label",35),h.EFF(3),h.nI1(4,"mytranslate"),h.j41(5,"span",17),h.nI1(6,"mytranslate"),h.EFF(7),h.nI1(8,"mytranslate"),h.k0s(),h.EFF(9," : "),h.k0s(),h.nrm(10,"input",36),h.nI1(11,"mytranslate"),h.DNE(12,Y,4,3,"div",19),h.k0s(),h.bVm()),2&de){let Te;const k=h.XpG(2),P=k.$implicit,H=k.index,We=h.XpG();h.R7$(2),h.FS9("for","cau_"+H),h.R7$(),h.Lme(" ",h.bMT(4,14,"lang_auto_nhap_diem_cau")," ",(null!==(Te=P.indexLabel)&&void 0!==Te?Te:0)+1," "),h.R7$(2),h.FS9("matTooltip",h.bMT(6,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.R7$(2),h.Lme("(",P.essMaxPoint," ",h.bMT(8,18,"lang_auto_diem_brackets"),""),h.R7$(3),h.FS9("placeholder",h.bMT(11,20,"lang_auto_nhap_diem")),h.Y8G("readonly",!We.showForTeacher)("ngClass",h.eq3(22,Ie,P.essayAnswersFormGroup.controls.mark&&P.essayAnswersFormGroup.controls.mark.invalid))("id","cau_"+H)("decimal",!0)("value",P.essayAnswersFormGroup.controls.mark.value)("formControl",P.essayAnswersFormGroup.controls.mark),h.R7$(2),h.Y8G("ngIf",P.essayAnswersFormGroup.controls.mark.errors)}}function Xe(de,$e){if(1&de&&(h.j41(0,"div"),h.DNE(1,et,13,24,"ng-container",10),h.j41(2,"div",31)(3,"label",32),h.EFF(4),h.nI1(5,"mytranslate"),h.k0s(),h.nrm(6,"textarea",33),h.nI1(7,"mytranslate"),h.k0s()()),2&de){let Te;const k=h.XpG().$implicit,P=h.XpG();h.R7$(),h.Y8G("ngIf",P.showForTeacher),h.R7$(2),h.FS9("for","comment_"+k.id),h.R7$(),h.Lme("",h.bMT(5,8,"lang_mark_essay_add_comment_question")," ",(null!==(Te=k.indexLabel)&&void 0!==Te?Te:0)+1,":"),h.R7$(2),h.FS9("id","comment_"+k.id),h.FS9("placeholder",h.bMT(7,10,"lang_auto_nhap_nhan_xet")),h.Y8G("readonly",!P.showForTeacher)("formControl",k.essayAnswersFormGroup.controls.comment)}}function Qe(de,$e){if(1&de&&(h.j41(0,"div",25)(1,"div",26),h.DNE(2,Ne,1,7,"azt-question-standalone-for-student-at-review-page",27)(3,qe,1,7,"azt-question-standalone-for-teacher-at-review-page",28)(4,Xe,8,12,"div",10),h.k0s()()),2&de){const Te=$e.$implicit,k=$e.index,P=h.XpG();h.R7$(),h.Mz_("id","q_",k,""),h.Y8G("ngStyle",h.eq3(6,Oe,Te.showEssayMark?"block":"none")),h.R7$(),h.Y8G("ngIf",!P.showForTeacher),h.R7$(),h.Y8G("ngIf",P.showForTeacher),h.R7$(),h.Y8G("ngIf",Te.essayAnswersFormGroup)}}function ke(de,$e){1&de&&(h.j41(0,"div",37)(1,"b"),h.EFF(2),h.nI1(3,"mytranslate"),h.k0s(),h.EFF(4),h.nI1(5,"mytranslate"),h.k0s()),2&de&&(h.R7$(2),h.SpI("",h.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),h.R7$(2),h.SpI(" ",h.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function tt(de,$e){if(1&de){const Te=h.RV6();h.j41(0,"azt-mark-note",39,1),h.bIt("doneLoadData",function(P){h.eBV(Te);const H=h.XpG(2);return h.Njj(H.doneLoadData(P))}),h.k0s()}if(2&de){const Te=h.XpG(2);h.Y8G("dataMarkNote",Te.dataMarkNote)("screenType","exam")("modeView",Te.showForTeacher?"teacher":"student")}}function st(de,$e){if(1&de&&(h.qex(0),h.DNE(1,tt,2,3,"azt-mark-note",38),h.bVm()),2&de){const Te=h.XpG();h.R7$(),h.Y8G("ngIf",1===Te.curSelectedTab||Te.changeSelectedTab)}}function rt(de,$e){if(1&de){const Te=h.RV6();h.j41(0,"div",40)(1,"button",41),h.bIt("click",function(){h.eBV(Te);const P=h.XpG();return h.Njj(P.saveDataMarkExercise())}),h.EFF(2),h.nI1(3,"mytranslate"),h.nI1(4,"mytranslate"),h.k0s()()}if(2&de){const Te=h.XpG();h.R7$(),h.Y8G("disabled",Te.isLoading||Te.findQuestionFormInvalid()||Te.loadingDataCdn&&Te.files.length>0),h.R7$(),h.SpI(" ",Te.isLoading?h.bMT(3,2,"lang_auto_dang_luu_doing"):h.bMT(4,4,"lang_auto_luu_diem")," ")}}let xt=(()=>{var de;class $e extends x.H{getMaxPoint(k){let P=this.questions.find(H=>H.id==k);return P?P.scorePerQuestion??0:0}remark(k){let P=this.questions.map(Je=>({questionId:Je.essayAnswersFormGroup?.controls.questionId.value,comment:Je.essayAnswersFormGroup?.controls.comment.value,mark:Number(Je.essayAnswersFormGroup?.controls.mark.value)})),H=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});this.examResultService.apiExamResultSaveResultPost({id:this.resultID,result:k,essayResult:void 0,essayAnswers:P},H).subscribe(Je=>{this.isLoading=!1,1==Je.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1)):(this.commonService.snackError(Je.message),this.saveResultEvent.emit(0))})}initDataMarkNote(){this.examResultObj.result?this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId}:(this.files.forEach(k=>k.url=this.sAztCommonCdnService.getMyCdn(k.url??"")),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)})}saveDataMarkExercise(){var k=this;return(0,s.A)(function*(){if(!k.questions.find(H=>H.essayAnswersFormGroup?.controls.mark.value))return k.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");if(k.questions.forEach(H=>{H.essayAnswersFormGroup?.controls.mark.value||H.essayAnswersFormGroup?.controls.mark.setValue("0")}),k.isLoading=!0,!k.files.length||(k.objectResult=k.MarkNote?.exportDataMarkNote(),!k.objectResult.pages?.length&&k.files.find(H=>(0,ie.nL)(H.mimes??"")||(0,ie.rl)(H.mimes??"")||!(0,ie.N6)(H.mimes??""))))return k.remark("");if(k.objectResult.pages?.length){let H=!1;for(let ae=0;ae<k.objectResult.pages.length;ae++)if(k.objectResult.pages[ae]&&k.objectResult.pages[ae].draws?.length)for(let at=0;at<(k.objectResult.pages[ae].draws?.length??0);at++){let Le=k.objectResult.pages[ae].draws?.[at]??{};Le.src&&Le.src.includes("base64")&&(H=!0)}H&&(yield k.uploadDrawBase64ToCdn());const We=k.serializeJson(k.objectResult),Je=k.zipDataService.convertContentGzip(We),ze=new Blob([Je],{type:"text/plain"}),dt=new File([ze],"txt",{type:"text/plain"});k.apiUploadService.uploadToCdnForHomework(dt).subscribe(ae=>{if(!ae.success)return k.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");k.remark(k.serializeJson({urlDataMark:ae.data?.url??"",version:"0.1"}))})}})()}uploadDrawBase64ToCdn(){return new Promise(k=>{if(!this.objectResult.pages)return;let P=[];this.objectResult.pages.forEach(H=>P.push(!1)),this.objectResult.pages.forEach((H,We)=>{H.draws?.length&&H.draws.forEach((Je,ze)=>{if(Je.src&&Je.src.includes("base64")){P[We]=!0;let dt=(0,fe.q)(Je.src);this.apiUploadService.commonUploadForMarkResult(dt,`essay_note_${We}_${ze}_${this.resultID}.png`,"image/png").subscribe(ae=>{ae.type!=d.hv.UploadProgress&&(Je.src=ae.data?.url,P[We]=!1),P.includes(!0)||k()})}})})})}doneLoadData(k){this.loadingDataCdn=!1}autoResizeFeedBackArea(k){const P=document.getElementById("comment_"+k);P&&setTimeout(()=>{P.style.cssText="height:auto;",P.style.cssText="height:"+(P.scrollHeight+30)+"px"},0)}findQuestionFormInvalid(){return null!=this.questions.find(k=>k.essayAnswersFormGroup?.invalid)}initEssayFormGroupQuestion(){let k=this.examResultObj.confirmedAt?new p.X(this.commonService).parserEssayResult(this.examResultObj.essayResult):[],P=(this.examResultObj.confirmedAt?this.examResultObj.essayAnswerObjs:[])??[];this.questions.forEach((H,We)=>{let Je=this.getMaxPoint(H.id);this.totalMaxPoint+=Je,H.essMaxPoint=Je,this.maxPointPerQuestion.push(H.essMaxPoint);let ze=k.find(ae=>ae.questionIndex==We),dt=P.find(ae=>ae.questionId==H.id)??{questionId:H.id,comment:void 0,mark:ze?.questionMark};H.showEssayMark=!0,H.essayAnswersFormGroup=new _.gE({questionId:new _.MJ(H.id,{nonNullable:!0}),mark:new _.MJ(dt?.mark?.toString()??"",{nonNullable:!0,validators:[_.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),_.k0.min(0),_.k0.max(H.essMaxPoint??0)]}),comment:new _.MJ(dt?.comment??"",{nonNullable:!0})})})}ngOnInit(){this.initDataMarkNote(),this.followerRenderQuest.setNumQuest(this.questions.length),this.initEssayFormGroupQuestion(),super.ngOnInit()}constructor(k,P,H,We){super(),this.sAztCommonCdnService=k,this.examResultService=P,this.apiUploadService=H,this.zipDataService=We,this.orgExamObjs=[],this.questions=[],this.files=[],this.resultID=0,this.userAnswersObj={},this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new h.bkB,this.followerRenderQuest=new T.e,this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.jsonData={},this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return(de=$e).\u0275fac=function(k){return new(k||de)(h.rXU(q.c),h.rXU(N._),h.rXU(R.T),h.rXU(z.j))},de.\u0275cmp=h.VBU({type:de,selectors:[["azt-mark-essay-new"]],viewQuery:function(k,P){if(1&k&&(h.GBs(oe,5),h.GBs(Be,5)),2&k){let H;h.mGM(H=h.lsd())&&(P.mnoteContainer=H.first),h.mGM(H=h.lsd())&&(P.MarkNote=H.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",resultID:"resultID",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},features:[h.Vt3],decls:11,vars:9,consts:[["mnoteContainer",""],["aztMarkNote",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"ngClass","matTooltip","click",4,"ngIf"],["name","eye_off","size","24",3,"ngClass","matTooltip","click",4,"ngIf"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","value","formControl"],["class","mt-2 text-danger text-xs",4,"ngIf"],["name","eye","size","24",3,"click","ngClass","matTooltip"],["name","eye_off","size","24",3,"click","ngClass","matTooltip"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",3,"id","ngStyle"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","20px"],[1,"mb-2","font-medium",3,"for"],["type","text","cols","10","autoResize","",1,"form-control","d-inline-flex","w-full","mt-1",3,"readonly","id","placeholder","formControl"],[1,"block-input",2,"margin-bottom","10px"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","value","formControl"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"doneLoadData","dataMarkNote","screenType","modeView"],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(k,P){1&k&&(h.j41(0,"div",2)(1,"div",3),h.DNE(2,Ge,2,4,"div",4),h.k0s(),h.DNE(3,Pe,5,6,"div",5),h.k0s(),h.j41(4,"div",6),h.DNE(5,Qe,5,8,"div",7),h.k0s(),h.DNE(6,ke,6,6,"div",8),h.j41(7,"div",9,0),h.DNE(9,st,2,1,"ng-container",10),h.k0s(),h.DNE(10,rt,5,6,"div",11)),2&k&&(h.R7$(2),h.Y8G("ngForOf",P.questions),h.R7$(),h.Y8G("ngIf",P.showForTeacher),h.R7$(2),h.Y8G("ngForOf",P.questions),h.R7$(),h.Y8G("ngIf",P.files&&0==P.files.length),h.R7$(),h.Y8G("ngStyle",h.eq3(7,Oe,P.files&&0==P.files.length?"none":"block")),h.R7$(2),h.Y8G("ngIf",P.dataMarkNote&&P.dataMarkNote.answer_obj&&P.files&&P.files.length>0),h.R7$(),h.Y8G("ngIf",P.showForTeacher))},dependencies:[S.YU,S.Sq,S.bT,S.B3,K.oV,B.Z,M.j,w.x,D.o,_.me,_.BC,_.l_,Z.WGl,ne.i,re.wp],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:#2361ae2e;border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%], .maxPoint[_ngcontent-%COMP%]{font-size:12px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),$e})()},28023:(ft,Ae,y)=>{"use strict";y.d(Ae,{X:()=>s});class s{constructor(h){this.commonService=h}parserEssayResult(h){let _=[],x=this.commonService.myParseJson(h??"{}")??{};return Object.entries(x).map(([ie,fe])=>({key:ie,value:fe})).forEach(ie=>{let fe=ie.key.replace("cau","");_.push({questionIndex:isNaN(Number(fe))?void 0:Number(fe),questionMark:isNaN(Number(ie.value))?void 0:Number(ie.value)})}),_}}},94315:(ft,Ae,y)=>{"use strict";y.d(Ae,{eX:()=>z});class s{constructor(){this.x=0,this.y=0}toBase64String(){return(new B).writeCvPoint2u(this).toBase64String()}}class d{constructor(){this.x=0,this.y=0}toBase64String(){return(new B).writeCvPoint2f(this).toBase64String()}}class h{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new B).writeCvRect2f(this).toBase64String()}}class _{constructor(){this.center=new d,this.filled=!1}toBase64String(){return(new B).writeAnswerCircle(this).toBase64String()}}class x{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new B).writeTableAnswer(this).toBase64String()}}class T{constructor(){this.top=new d,this.left=new d,this.bottom=new d,this.right=new d}toBase64String(){return(new B).writeResultRect(this).toBase64String()}}class ie{constructor(){this.id=0,this.region=new h}toBase64String(){return(new B).writeCropRegion(this).toBase64String()}}class fe{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new T,this.studentId=new x,this.examId=new x,this.answerTable=new x,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new B).writeResultOutput(this).toBase64String()}}class p{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new B).writeAnswerSheetInput(this).toBase64String()}}class q{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new B).writeSmallAnswerCircle(this).toBase64String()}}class N{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new B).writeSmallTableAnswer(this).toBase64String()}}class R{constructor(){this.studentId=new N,this.examId=new N,this.answerTable=new N}toBase64String(){return(new B).writeDrawData(this).toBase64String()}}class z{constructor(w){this.bytes=w,this.cursor=0,this.length=w.byteLength}updateCursor(w){if(this.cursor=this.cursor+w,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let w=this.bytes[this.cursor];return this.updateCursor(1),w}parseInt(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(w).getInt32(0)}parseDouble(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(w).getFloat64(0,!0)}parseString(){let w=new TextDecoder("utf-8"),D=this.cursor,Z=this.bytes[this.cursor];for(;0!=Z;)this.updateCursor(1),Z=this.bytes[this.cursor];let ne=this.bytes.slice(D,this.cursor),re=w.decode(ne);return this.updateCursor(1),re}parseBool(){let w=this.bytes[this.cursor];return this.updateCursor(1),w>0}parseCvPoint2u(){let w=new s;return w.x=this.parseUchar(),w.y=this.parseUchar(),w}parseCvPoint2f(){let w=new d;return w.x=this.parseDouble(),w.y=this.parseDouble(),w}parseCvRect2f(){let w=new h;return w.x=this.parseDouble(),w.y=this.parseDouble(),w.width=this.parseDouble(),w.height=this.parseDouble(),w}parseAnswerCircle(){let w=new _;return w.center=this.parseCvPoint2f(),w.filled=this.parseBool(),w}parseTableAnswer(){let w=new x,D=0;w.rows=this.parseInt(),w.cols=this.parseInt(),w.radius=this.parseInt(),D=this.parseInt();for(let Z=0;Z<D;Z++)w.answers.push(this.parseAnswerCircle());return w}parseResultRect(){let w=new T;return w.top=this.parseCvPoint2f(),w.left=this.parseCvPoint2f(),w.bottom=this.parseCvPoint2f(),w.right=this.parseCvPoint2f(),w}parseCropRegion(){let w=new ie;return w.id=this.parseInt(),w.region=this.parseCvRect2f(),w}parseResultOutput(){let w=new fe,D=0;w.type=this.parseInt(),w.errorCode=this.parseInt(),w.paperCorner=this.parseResultRect(),w.studentId=this.parseTableAnswer(),w.examId=this.parseTableAnswer(),w.answerTable=this.parseTableAnswer(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w.imageSize=this.parseInt(),D=this.parseInt();for(let Z=0;Z<D;Z++)w.cropRegion.push(this.parseCropRegion());return w}parseAnswerSheetInput(){let w=new p;return w.templateType=this.parseInt(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w}parseSmallAnswerCircle(){let w=new q;return w.position=this.parseUchar(),w.x=this.parseUchar(),w.y=this.parseUchar(),w.filledCols=this.parseUchar(),w.rows=this.parseUchar(),w}parseSmallTableAnswer(){let w=new N,D=0;w.rows=this.parseUchar(),w.cols=this.parseUchar(),w.radius=this.parseUchar(),D=this.parseInt();for(let Z=0;Z<D;Z++)w.answers.push(this.parseSmallAnswerCircle());return w}parseDrawData(){let w=new R;return w.studentId=this.parseSmallTableAnswer(),w.examId=this.parseSmallTableAnswer(),w.answerTable=this.parseSmallTableAnswer(),w}}const S=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class B{constructor(){this.bytes=[]}writeUchar(w){return this.bytes.push(w),this}writeUint8Array(w){for(let D=0;D<w.length;D++)this.bytes.push(w[D]);return this}writeArrayBuffer(w){let D=new Uint8Array(w);return this.writeUint8Array(D),this}writeInt(w){let D=new ArrayBuffer(4);return new DataView(D).setUint32(0,w,!1),this.writeArrayBuffer(D),this}writeDouble(w){let D=new ArrayBuffer(8);return new DataView(D).setFloat64(0,w,!0),this.writeArrayBuffer(D),this}writeString(w){let Z=(new TextEncoder).encode(w);return this.writeUint8Array(Z),this.writeUchar(0),this}writeBool(w){return this.writeUchar(w?1:0),this}toBase64String(){return function K(M){let D,w="",Z=M.length;for(D=2;D<Z;D+=3)w+=S[M[D-2]>>2],w+=S[(3&M[D-2])<<4|M[D-1]>>4],w+=S[(15&M[D-1])<<2|M[D]>>6],w+=S[63&M[D]];return D===Z+1&&(w+=S[M[D-2]>>2],w+=S[(3&M[D-2])<<4],w+="=="),D===Z&&(w+=S[M[D-2]>>2],w+=S[(3&M[D-2])<<4|M[D-1]>>4],w+=S[(15&M[D-1])<<2],w+="="),w}(new Uint8Array(this.bytes))}writeCvPoint2u(w){return this.writeUchar(w.x),this.writeUchar(w.y),this}writeCvPoint2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this}writeCvRect2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this.writeDouble(w.width),this.writeDouble(w.height),this}writeAnswerCircle(w){return this.writeCvPoint2f(w.center),this.writeBool(w.filled),this}writeTableAnswer(w){this.writeInt(w.rows),this.writeInt(w.cols),this.writeInt(w.radius),this.writeInt(w.answers.length);for(let D of w.answers)this.writeAnswerCircle(D);return this}writeResultRect(w){return this.writeCvPoint2f(w.top),this.writeCvPoint2f(w.left),this.writeCvPoint2f(w.bottom),this.writeCvPoint2f(w.right),this}writeCropRegion(w){return this.writeInt(w.id),this.writeCvRect2f(w.region),this}writeResultOutput(w){this.writeInt(w.type),this.writeInt(w.errorCode),this.writeResultRect(w.paperCorner),this.writeTableAnswer(w.studentId),this.writeTableAnswer(w.examId),this.writeTableAnswer(w.answerTable),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this.writeInt(w.imageSize),this.writeInt(w.cropRegion.length);for(let D of w.cropRegion)this.writeCropRegion(D);return this}writeAnswerSheetInput(w){return this.writeInt(w.templateType),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this}writeSmallAnswerCircle(w){return this.writeUchar(w.position),this.writeUchar(w.x),this.writeUchar(w.y),this.writeUchar(w.filledCols),this.writeUchar(w.rows),this}writeSmallTableAnswer(w){this.writeUchar(w.rows),this.writeUchar(w.cols),this.writeUchar(w.radius),this.writeInt(w.answers.length);for(let D of w.answers)this.writeSmallAnswerCircle(D);return this}writeDrawData(w){return this.writeSmallTableAnswer(w.studentId),this.writeSmallTableAnswer(w.examId),this.writeSmallTableAnswer(w.answerTable),this}}},72267:(ft,Ae,y)=>{"use strict";y.d(Ae,{E:()=>x});var s=y(48891),d=y(53793),h=y(51113),_=y(99927);let x=(()=>{var T;class ie{addIndexLabelToQuestionObjs(p){for(let q=0;q<(p?.length??0);q++)p?.[q]&&(p[q].indexLabel=q);return p}getEssayQuestionObjs(p){let q=[];for(let N=0;N<(p?.length??0);N++)this.answerTypeService.isEssayAnswer(p?.[N])&&p?.[N]&&q.push(p[N]);return q}getTrueFalseQuestionObjs(p){let q=[];for(let N=0;N<(p?.length??0);N++)(this.answerTypeService.isOneChoiceAnswer(p?.[N])||this.answerTypeService.isTrueFalseAnswer(p?.[N])||this.answerTypeService.isFillAnswer(p?.[N]))&&p?.[N]&&q.push(p[N]);return q}convertAnswersArr(p){let q={};return 0!=p.length&&p.forEach(N=>{let R=!!N.AnswerContent?.filter(z=>z.Status)?.length;N.AnswerContent&&N.AnswerContent.length&&(q[`id_${N.QuestionId}`]=R?[...N.AnswerContent]:N.AnswerContent[0].Content)}),q}mapStudentObjWithTestedObj(p,q,N){var R=this.commonService.castObj(p?.studentObj),z=q?.filter(S=>S.userId==N?.parentId);return R&&z&&z.length>0&&(R={...R,offlineMarkObj:z[0].offlineMarkObj,nameImage:z[0].nameImage??""}),N=R}mapStudentObjWithTestedObjForFrontendStudent(p,q,N){var R=this.commonService.castObj(p?.studentObj),z=q?.filter(S=>S.userId==N?.parentId);return R&&z&&z.length>0&&(R={...R,offlineMarkObj:z[0].offlineMarkObj,nameImage:z[0].nameImage??""}),N=R}constructor(p,q,N){this.commonService=p,this.zipDataService=q,this.answerTypeService=N}}return(T=ie).\u0275fac=function(p){return new(p||T)(s.KVO(d.R),s.KVO(h.j),s.KVO(_._))},T.\u0275prov=s.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),ie})()},57332:(ft,Ae,y)=>{"use strict";y.d(Ae,{V:()=>re});var s=y(89163),d=y(33887),h=y(48891),_=y(58538),x=y(54460),T=y(68323),ie=y(90796),fe=y(52811),p=y(15343),q=y(47348);const N=()=>({"mr-2 text-danger flex-none":!0});function R(oe,Be){1&oe&&(h.j41(0,"span",11),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&oe&&(h.R7$(),h.JRh(h.bMT(2,1,"lang_testbank_are_you_sure_to_delete_this_exam_result")))}function z(oe,Be){1&oe&&(h.j41(0,"span",11),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&oe&&(h.R7$(),h.SpI("",h.bMT(2,1,"lang_testbank_are_you_sure_to_delete_multiple_exam_result"),":"))}function S(oe,Be){if(1&oe&&(h.j41(0,"div",8),h.nrm(1,"lucide-icon",9),h.j41(2,"div"),h.DNE(3,R,3,3,"span",10)(4,z,3,3,"span",10),h.k0s()()),2&oe){const Oe=h.XpG();h.R7$(),h.Y8G("ngClass",h.lJ4(3,N)),h.R7$(2),h.Y8G("ngIf",1==Oe.data.examResultIds.length),h.R7$(),h.Y8G("ngIf",Oe.data.examResultIds.length>1)}}function K(oe,Be){if(1&oe&&(h.j41(0,"div",21)(1,"span",22),h.EFF(2),h.k0s()()),2&oe){const Oe=h.XpG().$implicit;h.R7$(2),h.JRh(Oe.fullName)}}function B(oe,Be){if(1&oe&&h.nrm(0,"img",23),2&oe){const Oe=h.XpG().$implicit;h.Y8G("nameImages",Oe.nameImages)}}function M(oe,Be){if(1&oe&&(h.j41(0,"div",14)(1,"div",15)(2,"div",16),h.nrm(3,"azt-create-avatar",17),h.k0s(),h.j41(4,"div",18),h.DNE(5,K,3,1,"div",19)(6,B,1,1,"img",20),h.k0s()()()),2&oe){let Oe;const Ze=Be.$implicit,Ie=h.XpG(2);h.R7$(3),h.Y8G("linkAvatar",null!==(Oe=Ze.avatar)&&void 0!==Oe?Oe:"")("nameCreateAvatar",Ze.fullName)("size",32),h.R7$(2),h.Y8G("ngIf",!Ze.nameImages||Ie.commonService.convertStringToNumber(Ze.id)>0),h.R7$(),h.Y8G("ngIf",Ze.nameImages&&Ie.commonService.convertStringToNumber(Ze.studentId)<=0)}}function w(oe,Be){if(1&oe&&(h.j41(0,"div",12),h.DNE(1,M,7,5,"div",13),h.k0s()),2&oe){const Oe=h.XpG();h.R7$(),h.Y8G("ngForOf",Oe.data.examResults)}}function D(oe,Be){1&oe&&(h.j41(0,"div",8)(1,"div",24)(2,"button",25)(3,"div",26),h.nrm(4,"lucide-icon",27),h.k0s()(),h.j41(5,"div",28),h.EFF(6),h.nI1(7,"mytranslate"),h.k0s()()()),2&oe&&(h.R7$(6),h.JRh(h.bMT(7,1,"lang_testbank_are_you_sure_to_delete_no_exam_result")))}function Z(oe,Be){1&oe&&(h.j41(0,"span",31),h.nrm(1,"azt-loading-ui"),h.k0s())}function ne(oe,Be){if(1&oe){const Oe=h.RV6();h.j41(0,"button",29),h.bIt("click",function(){h.eBV(Oe);const Ie=h.XpG();return h.Njj(Ie.confirmDelete())}),h.DNE(1,Z,2,0,"span",30),h.EFF(2),h.nI1(3,"mytranslate"),h.k0s()}if(2&oe){const Oe=h.XpG();h.Y8G("disabled",Oe.statusObj.loading),h.R7$(),h.Y8G("ngIf",Oe.statusObj.loading),h.R7$(),h.SpI(" ",h.bMT(3,3,"lang_cms_common_confirm_btn")," ")}}let re=(()=>{var oe;class Be extends d._{confirmDelete(){this.initStatusObj(),this.waitDestroy(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjsPost({examHashId:this.examHashId,examResultIds:this.examResultIds}).subscribe(Ze=>{1==Ze.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(Ze.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(Ze,Ie,ct){super(ct,Ie),this.offlineExamResultService=Ze,this.dialogRef=Ie,this.examHashId="",this.examResultIds=[],this.examHashId=ct.examHashId,this.examResultIds=ct.examResultIds}}return(oe=Be).\u0275fac=function(Ze){return new(Ze||oe)(h.rXU(_.Fs),h.rXU(s.CP,8),h.rXU(s.Vh,8))},oe.\u0275cmp=h.VBU({type:oe,selectors:[["coazt-delete-offline-exam-result-dialog"]],features:[h.Vt3],decls:11,vars:7,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],["class","text-md flex",4,"ngIf"],["class","grid grid-cols-12 gap-3","style","overflow-y: auto; max-height: calc(100vh - 150px)",4,"ngIf"],[1,"p-3","flex","justify-end"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor","class","btn w-32 btn-danger",3,"disabled","click",4,"ngIf"],[1,"text-md","flex"],["name","trash-2","size","24",3,"ngClass"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"grid","grid-cols-12","gap-3",2,"overflow-y","auto","max-height","calc(100vh - 150px)"],["class","col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"flex","items-center","p-3","student-exam-result-up","w-full"],[1,"w-8","h-8","image-fit","lg:mr-1"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"ml-2","text-left","mt-0",2,"width","calc(100% - 3.5rem)"],["class","azt-student-name flex items-center","style","flex-wrap: wrap",4,"ngIf"],["appDrawNameImage","","class","mb-1 img-name-fluid",3,"nameImages",4,"ngIf"],[1,"azt-student-name","flex","items-center",2,"flex-wrap","wrap"],[1,"font-medium","mr-2"],["appDrawNameImage","",1,"mb-1","img-name-fluid",3,"nameImages"],[1,"mx-auto","text-center"],[1,"btn","btn-sm","btn-primary-soft","p-1"],[1,"w-6","h-6"],["name","circle-x","size","24"],[1,"mt-4"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"click","disabled"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(Ze,Ie){1&Ze&&(h.j41(0,"div",0)(1,"div",1)(2,"div",2),h.DNE(3,S,5,4,"div",3)(4,w,2,1,"div",4)(5,D,8,3,"div",3),h.k0s()(),h.j41(6,"div",5)(7,"button",6),h.bIt("click",function(){return Ie.btnCloseDialog()}),h.EFF(8),h.nI1(9,"mytranslate"),h.k0s(),h.DNE(10,ne,4,5,"button",7),h.k0s()()),2&Ze&&(h.R7$(3),h.Y8G("ngIf",Ie.data.examResultIds.length),h.R7$(),h.Y8G("ngIf",Ie.data.examResultIds.length),h.R7$(),h.Y8G("ngIf",!Ie.data.examResultIds.length),h.R7$(3),h.SpI(" ",h.bMT(9,5,"lang_cms_common_close_btn")," "),h.R7$(2),h.Y8G("ngIf",Ie.data.examResultIds.length))},dependencies:[x.YU,x.Sq,x.bT,T.p,ie.y,fe.R,p.WGl,q.wp],encapsulation:2}),Be})()},92801:(ft,Ae,y)=>{"use strict";y.d(Ae,{$:()=>w});var s=y(89163),d=y(33887),h=y(48891),_=y(54460),x=y(47426),T=y(95670),ie=y(43404),fe=y(4375),p=y(47712),q=y(47348);function N(D,Z){if(1&D&&(h.j41(0,"div")(1,"div",10)(2,"div",11),h.EFF(3),h.k0s(),h.nrm(4,"input",12),h.k0s()()),2&D){const ne=h.XpG().$implicit;h.R7$(3),h.SpI(" ",ne.title," "),h.R7$(),h.FS9("value",ne.contents[0]),h.Y8G("disabled",!0)}}function R(D,Z){if(1&D&&(h.j41(0,"div",17)(1,"span",18),h.EFF(2),h.k0s()()),2&D){const ne=Z.$implicit;h.R7$(),h.FS9("matTooltip",ne),h.R7$(),h.JRh(ne)}}function z(D,Z){if(1&D&&(h.j41(0,"div")(1,"div",13)(2,"span",14),h.EFF(3),h.k0s()(),h.j41(4,"div",15),h.DNE(5,R,3,2,"div",16),h.k0s()()),2&D){const ne=h.XpG().$implicit;h.R7$(3),h.JRh(ne.title),h.R7$(2),h.Y8G("ngForOf",ne.contents)}}function S(D,Z){if(1&D&&(h.j41(0,"mat-radio-button",21)(1,"span",18),h.EFF(2),h.k0s()()),2&D){const ne=Z.$implicit;h.Y8G("checked",!0)("disabled",!0),h.R7$(),h.FS9("matTooltip",ne),h.R7$(),h.JRh(ne)}}function K(D,Z){if(1&D&&(h.j41(0,"div")(1,"div",13)(2,"span",19),h.EFF(3),h.k0s()(),h.j41(4,"mat-radio-group",15),h.DNE(5,S,3,4,"mat-radio-button",20),h.k0s()()),2&D){const ne=h.XpG().$implicit;h.R7$(3),h.JRh(ne.title),h.R7$(2),h.Y8G("ngForOf",ne.contents)}}function B(D,Z){if(1&D){const ne=h.RV6();h.j41(0,"div")(1,"div",10)(2,"span",19),h.EFF(3),h.k0s()(),h.j41(4,"div",22)(5,"mat-form-field",23)(6,"mat-select",24),h.mxI("valueChange",function(oe){h.eBV(ne);const Be=h.XpG().$implicit;return h.DH7(Be.contents[0],oe)||(Be.contents[0]=oe),h.Njj(oe)}),h.j41(7,"mat-option",25),h.EFF(8),h.k0s()()()()()}if(2&D){const ne=h.XpG().$implicit;h.R7$(3),h.JRh(ne.title),h.R7$(3),h.R50("value",ne.contents[0]),h.Y8G("disabled",!0),h.R7$(),h.FS9("value",ne.contents[0]),h.R7$(),h.JRh(ne.contents[0])}}function M(D,Z){if(1&D&&(h.qex(0,8),h.DNE(1,N,5,3,"div",9)(2,z,6,2,"div",9)(3,K,6,2,"div",9)(4,B,9,5,"div",9),h.bVm()),2&D){const ne=Z.$implicit;h.R7$(),h.Y8G("ngIf",0==ne.type),h.R7$(),h.Y8G("ngIf",1==ne.type),h.R7$(),h.Y8G("ngIf",2==ne.type),h.R7$(),h.Y8G("ngIf",3==ne.type)}}let w=(()=>{var D;class Z extends d._{constructor(re,oe){super(oe,re),this.dialogRef=re,this.data=oe}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return(D=Z).\u0275fac=function(re){return new(re||D)(h.rXU(s.CP,8),h.rXU(s.Vh))},D.\u0275cmp=h.VBU({type:D,selectors:[["app-result-info-dialog"]],features:[h.Vt3],decls:12,vars:7,consts:[[1,"box","result-info-dialog"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"valueChange","value","disabled"],[2,"color","#1e293c",3,"value"]],template:function(re,oe){1&re&&(h.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),h.EFF(5),h.nI1(6,"mytranslate"),h.k0s()(),h.DNE(7,M,5,4,"ng-container",5),h.k0s()(),h.j41(8,"div",6)(9,"button",7),h.bIt("click",function(){return oe.btnCloseDialog()}),h.EFF(10),h.nI1(11,"mytranslate"),h.k0s()()()),2&re&&(h.R7$(5),h.SpI(" ",h.bMT(6,3,"lang_testbank_test_config_verify_profile_student")," "),h.R7$(2),h.Y8G("ngForOf",oe.data),h.R7$(3),h.SpI(" ",h.bMT(11,5,"lang_auto_dong")," "))},dependencies:[_.Sq,_.bT,x.wT,T.rl,ie.VT,ie._g,fe.VO,p.oV,q.wp],encapsulation:2}),Z})()},32399:(ft,Ae,y)=>{"use strict";y.d(Ae,{B:()=>K});var s=y(48891),d=y(52909),h=y(59640),_=y(54460),x=y(47426),T=y(95670),ie=y(4375),fe=y(94743),p=y(15343);const q=B=>({"padding-left":B}),N=()=>({"text-pending":!0});function R(B,M){if(1&B&&(s.j41(0,"mat-option",6)(1,"i",7),s.nrm(2,"azt-svg-icon",8),s.k0s(),s.j41(3,"span",9),s.EFF(4),s.k0s()()),2&B){const w=s.XpG().$implicit;s.Y8G("ngStyle",s.eq3(5,q,15*(w.level+1)+"px"))("disabled",!w.children.length)("value",w),s.R7$(2),s.Y8G("size",20),s.R7$(2),s.JRh(w.objectName)}}function z(B,M){if(1&B){const w=s.RV6();s.j41(0,"mat-option",10),s.bIt("click",function(){s.eBV(w);const Z=s.XpG().$implicit,ne=s.XpG();return s.Njj(ne.confirmSelected(Z))}),s.nrm(1,"lucide-icon",11),s.j41(2,"span",12),s.EFF(3),s.k0s()()}if(2&B){const w=s.XpG().$implicit;s.Y8G("ngStyle",s.eq3(4,q,15*(w.level+1)+"px"))("value",w),s.R7$(),s.Y8G("ngClass",s.lJ4(6,N)),s.R7$(2),s.JRh(w.objectName)}}function S(B,M){if(1&B&&(s.qex(0),s.DNE(1,R,5,7,"mat-option",4)(2,z,4,7,"mat-option",5),s.bVm()),2&B){const w=M.$implicit;s.R7$(),s.Y8G("ngIf","FOLDER"==w.objectType),s.R7$(),s.Y8G("ngIf","EXAM"==w.objectType)}}let K=(()=>{var B;class M extends h.H{confirmSelected(D){"FOLDER"!=D.objectType&&(this.combineExamCapacity.forEach(Z=>Z.isSelected=!1),D.isSelected=!0,this.currentSelected=D,this.selectedExamEmitter.emit({examCapacityId:D.examId,examId:D.objectId??0,examHashId:D.exam?.hashId??"",examCapacityTestId:this.currentResultObj?.examCapacityTestId??0}))}asTemplateDataObj(D){return D}convertTreeNodes(D,Z){let ne=[];return D.forEach((re,oe)=>{let Be="EXAM"==re.objectType&&(re.objectId??re.examId)==(this.examComponentObj?this.examComponentObj.id:this.examObj?.id),Oe={...re,level:Z,nodeIndex:oe,isSelected:Be,randomHashId:this.uuidService.getUuid()};ne.push(Oe),Be&&(this.currentSelected=Oe),re.children.length&&ne.push(...this.convertTreeNodes(re.children,Z+1))}),ne}ngOnInit(){super.ngOnInit(),this.combineExamCapacity=this.convertTreeNodes(this.capacityComponents??[],0)}constructor(){super(),this.capacityComponents=[],this.selectedExamEmitter=new s.bkB,this.uuidService=(0,s.WQX)(d.D),this.combineExamCapacity=[],this.errorMessage=""}}return(B=M).\u0275fac=function(D){return new(D||B)},B.\u0275cmp=s.VBU({type:B,selectors:[["app-select-capacity-exam-result"]],inputs:{capacityComponents:"capacityComponents",examObj:"examObj",examComponentObj:"examComponentObj",currentResultObj:"currentResultObj"},outputs:{selectedExamEmitter:"selectedExamEmitter"},features:[s.Vt3],decls:4,vars:2,consts:[[1,"test-select-capacity"],[1,"w-full"],[3,"value"],[4,"ngFor","ngForOf"],[3,"ngStyle","disabled","value",4,"ngIf"],[3,"ngStyle","value","click",4,"ngIf"],[3,"ngStyle","disabled","value"],["aria-hidden","true"],["type","folder",3,"size"],[1,"font-normal","ml-2","select-capacity-span",2,"vertical-align","middle"],[3,"click","ngStyle","value"],["name","file-check","size","20",3,"ngClass"],[1,"select-capacity-span","ml-2",2,"vertical-align","middle","white-space","nowrap"]],template:function(D,Z){1&D&&(s.j41(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),s.DNE(3,S,3,2,"ng-container",3),s.k0s()()()),2&D&&(s.R7$(2),s.Y8G("value",Z.currentSelected),s.R7$(),s.Y8G("ngForOf",Z.combineExamCapacity))},dependencies:[_.YU,_.Sq,_.bT,_.B3,x.wT,T.rl,ie.VO,fe.m,p.WGl],encapsulation:2}),M})()},43726:(ft,Ae,y)=>{"use strict";y.d(Ae,{U:()=>xt});var s=y(59640),d=y(53043),h=y(57332),_=y(73014),x=y(10936),T=y(89163),ie=y(33887),fe=y(43234),p=y(48891),q=y(36484),N=y(74225),R=y(94315),z=y(53793),S=y(51113),K=y(99927),B=y(58112);const w=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let D=(()=>{var de;class $e{constructor(k,P,H,We){this.commonService=k,this.zipDataService=P,this.sAztAnswerTypeService=H,this.sAztCommonCdnService=We,this.totalPointExam=0}drawAzotaFileToCanvas(k,P,H,We){return new Promise((Je,ze)=>{var dt="",ae=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(k.images??""));ae&&ae.url&&ae.url.includes(".azt")?this.httpGetAsync(this.sAztCommonCdnService.getMyCdn(ae.url)).then(at=>{at&&at.length>0?N.decodeScanOfflineFile(at).then(Le=>{let I=this._arrayBufferToBase64(Le.getWrappedImage()??new Uint8Array),E=Le.getWrappedImageExtension(),b=Le.scanOfflineData?.scanResult;if(I){let O=new Image;O.src="data:image/"+E+";base64,"+I,O.crossOrigin="anonymous",O.onload=()=>{var W=document.createElement("canvas");W.width=O.width,W.height=O.height;const G=W.getContext("2d");G?.drawImage(O,0,0,W.width,W.height);let te=k.resultsData?.answerObjs??[];if(b?.examCodeRegion?.circles&&b?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(b?.examCodeRegion?.circles,G),b?.studentCodeRegion?.circles&&b?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(b?.studentCodeRegion?.circles,G),b?.answerRegion?.circles&&b?.answerRegion?.circles.length>0&&this.drawCircles(b?.answerRegion?.circles,G,te,1,H?.filter(we=>this.sAztAnswerTypeService.isOneChoiceAnswer(we))),b?.answerRegion?.trueFalseCircles&&b?.answerRegion?.trueFalseCircles.length>0&&this.drawCircles(b?.answerRegion?.trueFalseCircles,G,te,5,H?.filter(we=>this.sAztAnswerTypeService.isTrueFalseAnswer(we))),b?.answerRegion?.fillBlankCircles&&b?.answerRegion?.fillBlankCircles.length>0&&this.drawCircles(b?.answerRegion?.fillBlankCircles,G,te,4,H?.filter(we=>this.sAztAnswerTypeService.isFillAnswer(we))),b?.answerRegion?.essayCircles&&b?.answerRegion?.essayCircles.length>0&&P&&this.drawCommonCircles(b?.answerRegion?.essayCircles,G),G&&G.fillText((this.commonService.myTranslateInstant("lang_auto_tong")??"T\u1ed5ng")+" = "+this.totalPointExam.toFixed(2)+" - Version:"+b?.templateType,25,50),b?.answerRegion?.handwrittenAnswers&&b?.answerRegion?.handwrittenAnswers.length>0){let we=b?.answerRegion?.handwrittenAnswers,pe="18px";if(G){G.fillStyle="#00ff00",G.font=pe+" Comic Sans MS",G.textAlign="center";for(let ue=0;ue<we.length;ue++){let ye=we[ue];this.fillTextAnswerDrawForFileAzt(ye.recognizedText??"",G,te[ue],((ye.bottomRight.x??0)+(ye.topLeft.x??0))/2-3,((ye.bottomRight.y??0)+(ye.topLeft.y??0))/2+5)}}}dt=W.toDataURL("image/jpeg",.9),Je({imgUrl:dt})}}else Je({imgUrl:dt})}):Je({imgUrl:dt})}).catch(at=>{ze(at)}):Je({imgUrl:dt})})}drawScanFileToCanvas(k){return new Promise(P=>{var H="",We=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(k.images??""));let Je=We?this.sAztCommonCdnService.getMyCdn(We.url):"";if(We&&Je){let ze=new Image;ze.src=Je,ze.crossOrigin="anonymous",ze.onload=()=>{var dt=document.createElement("canvas");dt.width=ze.width,dt.height=ze.height;const ae=dt.getContext("2d");ae?.drawImage(ze,0,0,dt.width,dt.height);var at=k.resultsData?.answerObjs??[],Le=this.commonService.willDeleteParseJson(k.resultsData?.pos??"");if("2.0"==Le.version)try{let Bt=Uint8Array.from(atob(Le.resultFilledPos),bt=>bt.charCodeAt(0)),en=new R.eX(Bt).parseDrawData(),tn=en.studentId?.answers??[];for(var I=0;I<tn.length;I++)this.tickStudentIdAndExamId(tn[I],ae,en.answerTable?.radius??0);let _n=en.examId?.answers??[];for(I=0;I<_n.length;I++)this.tickStudentIdAndExamId(_n[I],ae,en.answerTable?.radius??0);let qt=en.answerTable?.answers??[];for(I=0;I<qt.length;I++)this.answerPaintedRightOrWrong(qt[I],ae,en.answerTable?.radius??0,at);H=dt.toDataURL("image/jpeg",.9),P(H)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),P("")}else if("3.0"==Le.version)try{let Bt=Le.answersHandwritten??[],en=(Bt[0].answerRegion.height??0)-20+"px";if(ae){ae.fillStyle="#00ff00",ae.font=en+" Comic Sans MS",ae.textAlign="center";for(let _n=0;_n<Bt.length;_n++){let qt=Bt[_n],En=this.getTextAnswerDraw(w[-1==qt.answer?26:qt.answer],ae,at[_n]);ae.fillText(En,(qt.answerRegion.x??0)+(qt.answerRegion.width??0)/2,(qt.answerRegion.y??0)+(qt.answerRegion.height??0)/2+5)}}H=dt.toDataURL("image/jpeg",.9),P(H)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),P("")}else{var E=Le.configurationPos.split("_"),b=Le.resultFilledPos.split("_"),O=Le.tableAnchorPos.split("_"),W=this.checkWrongOrTrueAnswer(at),G=0;for(I=0;I<E.length;I++)if(1==I||2==I){var te=E[I].split("*");G+=parseInt(te[1],10)}var we=0;for(I=0;I<O.length;I++)if(I>=2){var pe={},ee={},ue=O[I].split("*"),ye=ue[0].split(":"),Re=ue[1].split(":"),je={},Me=E[I].split("*");je.row=parseInt(Me[0],10),je.col=parseInt(Me[1],10),je.radius=parseInt(Me[2],10),pe.x=parseInt(ye[0],10),pe.y=parseInt(ye[1],10),ee.x=parseInt(Re[0],10),ee.y=parseInt(Re[1],10);for(var ot=(ee.y-pe.y)/(je.row+1),$=pe.y,_t=0;_t<je.row;_t++)if(($+=ot)>pe.y&&$<ee.y){var ut=we<at.length?this.checkAnswerStudentRight(we,at):0;we++,0!=ut&&ae&&(ae.beginPath(),ae.arc(pe.x+ot*ut,$,je.radius,0,2*Math.PI,!1),ae.lineWidth=3,ae.strokeStyle="#f3c12c",ae.stroke())}}var vt=0;for(_t=0;_t<b.length;_t++)if("empty"!=b[_t]){var Zt=b[_t].split(":"),Rt={x:parseInt(Zt[0],10),y:parseInt(Zt[1],10),line:parseInt(Zt[2],10)};_t<G+W.length&&(_t>=G?(ae&&(ae.beginPath(),ae.arc(Rt.x,Rt.y,Rt.line,0,2*Math.PI,!1),ae.lineWidth=3,ae.strokeStyle=W[vt],ae.stroke()),vt++):ae&&(ae.beginPath(),ae.arc(Rt.x,Rt.y,Rt.line,0,2*Math.PI,!1),ae.lineWidth=3,ae.strokeStyle="#00ff00",ae.stroke()))}H=dt.toDataURL("image/jpeg",.9),P(H)}}}else P("")})}_arrayBufferToBase64(k){for(var P="",H=new Uint8Array(k),We=H.byteLength,Je=0;Je<We;Je++)P+=String.fromCharCode(H[Je]);return window.btoa(P)}httpGetAsync(k){return new Promise((P,H)=>{try{const We=new XMLHttpRequest;We.open("GET",k,!0),We.responseType="arraybuffer",We.onload=Je=>{if(200===We.status||304===We.status){const ze=We.response;if(ze){const dt=new Uint8Array(ze);P(dt)}else P(new Uint8Array)}else P(new Uint8Array)},We.onerror=Je=>{H(new Error("lang_core_cant_loading_url"))},We.send(null)}catch(We){H(We)}})}fillTextAnswerDrawForFileAzt(k,P,H,We,Je){let ze="";H&&(k?H.rightAnswer&&"ESSAY"!=H.content&&H.rightAnswer!=k?(P.fillStyle="#f3c12c",P.fillText("["+H.rightAnswer+"]",We+15,Je),P.fillStyle="red",ze=k+"-",We-=10):H.rightAnswer&&"ESSAY"!=H.content?(P.fillStyle="#00ff00",ze+=k):(P.fillStyle="red",ze+=k):(P.fillStyle="#f3c12c",ze+=H.rightAnswer)),P.fillText(ze,We,Je)}drawCommonCircles(k,P){k.length>0&&k.forEach(H=>{if(H.filled){let We=H.center.x,Je=H.center.y;P&&(P.beginPath(),P.arc(We,Je,H.radius+1,0,2*Math.PI,!1),P.lineWidth=2,P.strokeStyle="#00ff00",P.stroke())}})}drawCircles(k,P,H,We,Je){let ze=[],dt=[],ae=["A","B","C","D"],at=0;if(H.length>0){let b=H.filter(G=>1==G.answerType||2==G.answerType).length??0,O=H.filter(G=>5==G.answerType).length??0,W=H.filter(G=>4==G.answerType).length??0;at=1==We?b:4==We?W:O;for(let G=0;G<H.length;G++){let te="";if(this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:H[G].answerType})){let we=H[G].rightAnswer?.split("|")??[];for(let pe=0;pe<ae.length;pe++)te=G+1-b+""+ae[pe]+"F",we.includes(ae[pe])&&(te=G+1-b+""+ae[pe]+"T"),this.commonService.isExistInArray(ze,te)||ze.push(te)}else this.sAztAnswerTypeService.isFillAnswer({answerType:H[G].answerType})?(te=G+1-b-O+"_"+H[G].rightAnswer,this.commonService.isExistInArray(ze,te)||ze.push(te)):this.sAztAnswerTypeService.isOneChoiceAnswer({answerType:H[G].answerType})&&(te=G+1+""+H[G].rightAnswer,this.commonService.isExistInArray(ze,te)||ze.push(te));this.sAztAnswerTypeService.isEssayAnswer({answerType:H[G].answerType})&&dt.push(G+1)}}let E=1==We?1:5==We?2:4==We?3:1;if(P){P.fillStyle="#ff0024",P.font="25px Comic Sans MS";let b=0,O=0,W=0,G="P-"+(1==E?"TN":2==E?"\u0110/S":"\u0110T")+": ",te=!1;(Je??[]).forEach(we=>{let pe=H.find(ee=>we.id==ee.questionId);if((this.sAztAnswerTypeService.isOneChoiceAnswer(we)||this.sAztAnswerTypeService.isFillAnswer(we))&&(b++,pe?.isRight&&(O+=we.testedScore??0,W++)),this.sAztAnswerTypeService.isTrueFalseAnswer(we)){O+=we.testedScore??0;let ee=0,ue="";for(let ye=0;ye<4;ye++)pe?.rightAnswers?.includes(w[ye])?ue+="T":ue+="F";if(pe?.content)for(let ye=0;ye<4;ye++)pe.content[ye]==ue[ye]&&ee++;te=!0,G+=" "+ee+"/4;"}}),this.totalPointExam+=O,G+=te?" = "+O.toFixed(2):W+"/"+b+" = "+O.toFixed(2),this.drawWrappedText(P,G,25,30+25*((2==E?3:3==E?2:E)+1),600,25)}k.forEach(b=>{let O=0;O=this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:We})?Number(b.label.substring(0,b.label.length-2)):this.sAztAnswerTypeService.isFillAnswer({answerType:We})?Number(b.label.substring(0,b.label.indexOf("_"))):Number(b.label.substring(0,b.label.length-1));let W="";if(0==ze.length)W="#00ff00";else if(this.sAztAnswerTypeService.isFillAnswer({answerType:We})){let G=b.label.substring(0,b.label.indexOf("_")+1),te=ze.find(we=>we.includes(G));if(te){let we=te?.split("_"),pe=b.label.split("_");if(b.filled&&(W="red"),we[0]==pe[0])if("-"==pe[2]&&we[1].includes("-"))0==Number(pe[1])&&(W=b.filled?"#00ff00":"#f3c12c");else if(","==pe[2]&&we[1].includes(",")){let ee=we[1].indexOf(",");Number(pe[1])==ee&&(W=b.filled?"#00ff00":"#f3c12c")}else"-"!=pe[2]&&","!=pe[2]&&we[1][Number(pe[1])]==pe[2]&&(W=b.filled?"#00ff00":"#f3c12c")}}else this.commonService.isExistInArray(ze,b.label)?W=b.filled?"#00ff00":"#f3c12c":b.filled&&(W="red");if(W&&O<=at&&!this.commonService.isExistInArray(dt,O)){let G=b.center.x,te=b.center.y;P&&(P.beginPath(),P.arc(G,te,b.radius+1,0,2*Math.PI,!1),P.lineWidth=2,P.strokeStyle=W,P.stroke())}})}drawWrappedText(k,P,H,We,Je,ze){const dt=P.split(" ");let ae="";dt.forEach(at=>{const Le=ae+at+" ";k.measureText(Le).width>Je&&""!==ae?(k.fillText(ae,H,We),ae=at+" ",We+=ze):ae=Le}),k.fillText(ae,H,We)}checkAnswerStudentRight(k,P){var H=0;return P[k]&&""!=P[k].rightAnswer&&0==P[k].isRight&&(H="A"==P[k].rightAnswer?1:"B"==P[k].rightAnswer?2:"C"==P[k].rightAnswer?3:"D"==P[k].rightAnswer?4:"E"==P[k].rightAnswer?5:"F"==P[k].rightAnswer?6:"G"==P[k].rightAnswer?7:"H"==P[k].rightAnswer?8:0),H}checkWrongOrTrueAnswer(k){for(var P=[],H=0;H<k.length;H++)""!=k[H].content&&(1==k[H].isRight?P.push("#00ff00"):0==k[H].isRight&&P.push("red"));return P}tickStudentIdAndExamId(k,P,H){var We=256*Math.floor((k.position??0)/16)+k.x,Je=(k.position??0)%16*256+k.y;(k.filledCols??0)>=128&&P&&(P.beginPath(),P.arc(We,Je,H,0,2*Math.PI,!1),P.lineWidth=3,P.strokeStyle="#00ff00",P.stroke())}answerPaintedRightOrWrong(k,P,H,We){var Je=256*Math.floor((k.position??0)/16)+k.x,ze=(k.position??0)%16*256+k.y,dt=k.rows??0,at="#fff0";We.length>dt&&((k.filledCols??0)>=128?at=1==We[dt].isRight?"#00ff00":"red":(k.filledCols??0)%128+1==this.checkAnswerStudentRight(dt,We)&&(at="#f3c12c"),P&&(P.beginPath(),P.arc(Je,ze,H,0,2*Math.PI,!1),P.lineWidth=3,P.strokeStyle=at,P.stroke()))}getTextAnswerDraw(k,P,H){let We="";return H&&(k?H.isRight?(P.fillStyle="#00ff00",We+=k):(P.fillStyle="red",We=k+" - ["+H.rightAnswer+"]"):(P.fillStyle="#f3c12c",We+=H.rightAnswer)),We}}return(de=$e).\u0275fac=function(k){return new(k||de)(p.KVO(z.R),p.KVO(S.j),p.KVO(K._),p.KVO(B.c))},de.\u0275prov=p.jDH({token:de,factory:de.\u0275fac,providedIn:"root"}),$e})();var Z=y(54460),ne=y(52811),re=y(15343),oe=y(47348);const Be=de=>({flex:de}),Oe=de=>({"mr-2":de}),Ze=()=>({"flex-none mr-1":!0});function Ie(de,$e){1&de&&(p.qex(0),p.j41(1,"span"),p.EFF(2),p.nI1(3,"mytranslate"),p.k0s(),p.bVm()),2&de&&(p.R7$(2),p.JRh(p.bMT(3,1,"lang_test_review_error_get_url_img")))}function ct(de,$e){1&de&&(p.j41(0,"div",14)(1,"span",15),p.nrm(2,"azt-loading-ui"),p.k0s()())}function it(de,$e){if(1&de){const Te=p.RV6();p.j41(0,"div",16)(1,"div",17)(2,"div",18)(3,"label",19),p.EFF(4),p.nI1(5,"mytranslate"),p.k0s(),p.j41(6,"input",20,1),p.nI1(8,"mytranslate"),p.bIt("input",function(){p.eBV(Te);const P=p.sdS(7),H=p.XpG(2);return p.Njj(H.setStudentCode(P))}),p.k0s()(),p.j41(9,"div",21)(10,"label",22),p.EFF(11),p.nI1(12,"mytranslate"),p.k0s(),p.j41(13,"input",23,2),p.nI1(15,"mytranslate"),p.bIt("input",function(){p.eBV(Te);const P=p.sdS(14),H=p.XpG(2);return p.Njj(H.setExamCode(P))}),p.k0s()()(),p.j41(16,"h3",24),p.nrm(17,"lucide-icon",25),p.j41(18,"span",26),p.EFF(19,"Click \u1ea3nh \u0111\u1ec3 \u0111\xe1nh d\u1ea5u v\u1ecb tr\xed c\u1ea7n s\u1eeda"),p.k0s()(),p.j41(20,"div",27)(21,"div",28,3)(23,"img",29),p.bIt("click",function(P){p.eBV(Te);const H=p.XpG(2);return p.Njj(H.clickOnImage(P))}),p.k0s()()()()}if(2&de){const Te=p.XpG(2);p.R7$(),p.Y8G("ngClass",p.eq3(20,Be,!Te.isMobileDevice)),p.R7$(),p.Y8G("ngClass",p.eq3(22,Oe,!Te.isMobileDevice)),p.R7$(2),p.JRh(p.bMT(5,12,"lang_auto_so_bao_danh")),p.R7$(2),p.FS9("placeholder",p.bMT(8,14,"lang_core_nhap_so_ba_danh")),p.Y8G("formControl",Te.studentCode),p.R7$(5),p.JRh(p.bMT(12,16,"lang_auto_ma_de")),p.R7$(2),p.FS9("placeholder",p.bMT(15,18,"lang_core_nhap_ma_de")),p.Y8G("formControl",Te.examCode),p.R7$(4),p.Y8G("ngClass",p.lJ4(24,Ze)),p.R7$(6),p.Aen(Te.isMobileWebView?"width: 100% !important;":"height: auto !important;"),p.Y8G("src",Te.fileScanUrl,p.B4B)}}function Ce(de,$e){if(1&de&&p.DNE(0,ct,3,0,"div",12)(1,it,24,25,"div",13),2&de){const Te=p.XpG();p.Y8G("ngIf",Te.loadingScanUrl),p.R7$(),p.Y8G("ngIf",!Te.loadingScanUrl)}}function ve(de,$e){1&de&&(p.j41(0,"span",30),p.nrm(1,"azt-loading-ui"),p.k0s())}let he=(()=>{var de;class $e extends ie._{setStudentCode(k){k.value=k.value.replace(/\D/g,""),k.value.length>this.myEnvironment.maxStudentCodeLength&&(k.value=k.value.slice(0,-1)),this.processData.setStudentCode(k.value),this.processDrawImage()}setExamCode(k){k.value=k.value.replace(/\D/g,""),k.value.length>this.myEnvironment.maxExamCodeLength&&(k.value=k.value.slice(0,-1)),this.processData.setExamCode(k.value),this.processDrawImage()}confirmEdit(){this.initStatusObj(),this.processor.uploadToServer().then(k=>{if(!k.success){let P=k.errorMessage;return"azt_lang_core_code_exam"==P&&(P=this.commonService.myTranslateInstant("lang_core_offline_exam_not_found_offline_mix_question_hash_id")??"M\xe3 \u0111\u1ec1 thi kh\xf4ng t\u1ed3n t\u1ea1i"),this.errorStatusObj(P??"lang_core_invalid_data",!0)}this.successStatusObj("lang_auto_luu_thanh_cong",!0),this.dialogRef.close(!0)})}btnCloseDialog(){this.dialogRef.close(!1)}loadScriptHandleImage(){var k=this;this.commonService.loadAnswerSheetJs().then(()=>{var P=this.userService.getUserObj();window.azotaScanAnswerSheet.examResultProcessor(P.rememberToken,"https://"+fe.c.base_embed_link,this.data.resultId,P.id).then(function(){var H=(0,_.A)(function*(We){k.processor=We,k.initData()});return function(We){return H.apply(this,arguments)}}()).catch(()=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}).catch(P=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}clickOnImage(k){const P=k.target,H=P.getBoundingClientRect();this.processData.clickToImage(P.naturalWidth/H.width*(k.clientX-H.left),P.naturalHeight/H.height*(k.clientY-H.top)),this.setFormCode(),this.processDrawImage()}drawCircleImg(k,P){k&&k.length>0&&(this.circleRadius=k[0].radius,k.forEach(H=>{if(H.filled&&P){let We=H.center.x,Je=H.center.y;P.beginPath(),P.arc(We,Je,H.radius+1,0,2*Math.PI,!1),P.lineWidth=3,P.strokeStyle="red",P.stroke()}}))}processDrawImage(){let k=this.drawScanExamService._arrayBufferToBase64(this.processData.getWrappedImage()??new Uint8Array),P=this.processData.getWrappedImageExtension(),H=this.processData.getFilledCircles();if(this.imgSize=this.processor.getImageSize(),!k)return this.loadingScanUrl=!1,void(this.fileScanUrl="");let We=new Image;We.src="data:image/"+P+";base64,"+k,We.crossOrigin="anonymous";var Je=document.createElement("canvas");Je.width=this.imgSize.width,Je.height=this.imgSize.height;const ze=Je.getContext("2d");We.onload=()=>{ze?.drawImage(We,0,0,Je.width,Je.height),this.drawCircleImg(H,ze),this.fileScanUrl=Je.toDataURL("image/jpeg",.9),this.loadingScanUrl=!1}}setFormCode(){this.studentCode.setValue(this.processData.scanOfflineData.scanResult.getStudentCode()??""),this.examCode.setValue(this.processData.scanOfflineData.scanResult.getSubExamCode()??"")}initData(){this.data.resultId&&(this.loadingScanUrl=!0,this.processData=this.processor.getData(),this.setFormCode(),this.processDrawImage())}ngOnInit(){super.ngOnInit(),this.loadScriptHandleImage()}constructor(k,P,H,We){super(We,H),this.userService=k,this.drawScanExamService=P,this.dialogRef=H,this.loadingScanUrl=!0,this.fileScanUrl="",this.circleRadius=0,this.imgSize={width:0,height:0},this.studentCode=new x.MJ("",{nonNullable:!0}),this.examCode=new x.MJ("",{nonNullable:!0})}}return(de=$e).\u0275fac=function(k){return new(k||de)(p.rXU(q.R),p.rXU(D),p.rXU(T.CP,8),p.rXU(T.Vh,8))},de.\u0275cmp=p.VBU({type:de,selectors:[["app-edit-scan-file-dialog"]],features:[p.Vt3],decls:14,vars:10,consts:[["showImgScan",""],["elementStudentCode",""],["elementExamCode",""],["imageHolding",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-32","btn-primary","items-center",3,"click","disabled"],["class","inline-block mr-2",4,"ngIf"],[2,"vertical-align","midle"],["class","p-5 flex justify-center items-center",4,"ngIf"],["class","p-5",4,"ngIf"],[1,"p-5","flex","justify-center","items-center"],[1,"w-5","h-5","inline-block","mr-2"],[1,"p-5"],[3,"ngClass"],[1,"w-full",3,"ngClass"],["for","codeStudent",1,"form-label","text-md","font-semibold","m-0"],["type","text","id","codeStudent",1,"form-control",3,"input","formControl","placeholder"],[1,"w-full"],["for","codeExam",1,"form-label","text-md","font-semibold","m-0"],["type","text","id","codeExam",1,"form-control",3,"input","formControl","placeholder"],[1,"mt-2","text-md","font-semibold","flex","text-slate-500","items-center"],["name","info","size","16",3,"ngClass"],[2,"vertical-align","middle"],[1,"text-center","mx-auto","mt-1",2,"height","calc(var(--vh, 1vh) * 100 - 300px)","overflow-y","auto"],["id","image-holding"],["id","img-container","alt","img",3,"click","src"],[1,"inline-block","mr-2"]],template:function(k,P){if(1&k){const H=p.RV6();p.j41(0,"div",4)(1,"div",5),p.DNE(2,Ie,4,3,"ng-container",6)(3,Ce,2,2,"ng-template",null,0,p.C5r),p.k0s(),p.j41(5,"div",7)(6,"button",8),p.bIt("click",function(){return p.eBV(H),p.Njj(P.btnCloseDialog())}),p.EFF(7),p.nI1(8,"mytranslate"),p.k0s(),p.j41(9,"button",9),p.bIt("click",function(){return p.eBV(H),p.Njj(P.confirmEdit())}),p.DNE(10,ve,2,0,"span",10),p.j41(11,"span",11),p.EFF(12),p.nI1(13,"mytranslate"),p.k0s()()()()}if(2&k){const H=p.sdS(4);p.R7$(2),p.Y8G("ngIf",!P.loadingScanUrl&&!P.fileScanUrl)("ngIfElse",H),p.R7$(5),p.SpI(" ",p.bMT(8,6,"lang_cms_common_close_btn")," "),p.R7$(2),p.Y8G("disabled",P.statusObj.loading),p.R7$(),p.Y8G("ngIf",P.statusObj.loading),p.R7$(2),p.JRh(p.bMT(13,8,"lang_auto_luu"))}},dependencies:[Z.YU,Z.bT,ne.R,x.me,x.BC,x.l_,re.WGl,oe.wp],encapsulation:2}),$e})();var X=y(46899),be=y(47712);const Ge=()=>({"text-slate-800":!0}),Pe=()=>({"text-danger":!0}),Ne=de=>({"text-success":de});function qe(de,$e){if(1&de){const Te=p.RV6();p.j41(0,"div",18)(1,"a",19),p.nI1(2,"mytranslate"),p.bIt("click",function(){let P;p.eBV(Te);const H=p.XpG(2);return p.Njj(H.openEditScanFile(null!==(P=null==H.examObj?null:H.examObj.hashId)&&void 0!==P?P:"",H.examResultIdParam))}),p.nrm(3,"lucide-icon",20),p.k0s()()}2&de&&(p.R7$(),p.Y8G("matTooltip",p.bMT(2,2,"lang_auto_sua")),p.R7$(2),p.Y8G("ngClass",p.lJ4(4,Ge)))}function Se(de,$e){if(1&de){const Te=p.RV6();p.j41(0,"div",21)(1,"a",22),p.nI1(2,"mytranslate"),p.bIt("click",function(){let P;p.eBV(Te);const H=p.XpG(2);return p.Njj(H.deleteOfflineExamResultObj(null!==(P=null==H.examObj?null:H.examObj.hashId)&&void 0!==P?P:"",H.examResultIdParam))}),p.nrm(3,"lucide-icon",23),p.k0s()()}2&de&&(p.R7$(),p.Y8G("matTooltip",p.bMT(2,2,"lang_auto_xoa")),p.R7$(2),p.Y8G("ngClass",p.lJ4(4,Pe)))}function xe(de,$e){1&de&&(p.j41(0,"span",24),p.EFF(1),p.nI1(2,"mytranslate"),p.k0s()),2&de&&(p.R7$(),p.SpI("",p.bMT(2,1,"lang_auto_anh_cham"),":"))}function F(de,$e){1&de&&(p.j41(0,"span"),p.EFF(1),p.nI1(2,"mytranslate"),p.k0s()),2&de&&(p.R7$(),p.JRh(p.bMT(2,1,"lang_auto_luu_trong_app_mobile")))}function Y(de,$e){1&de&&(p.qex(0),p.j41(1,"span"),p.EFF(2),p.nI1(3,"mytranslate"),p.k0s(),p.bVm()),2&de&&(p.R7$(2),p.JRh(p.bMT(3,1,"lang_test_review_error_get_url_img")))}function et(de,$e){1&de&&(p.j41(0,"span",30),p.nrm(1,"azt-loading-ui"),p.k0s())}function Xe(de,$e){if(1&de&&p.nrm(0,"img",31),2&de){const Te=p.XpG(4);p.Aen(Te.isMobileWebView?"width: 100% !important;":"height: auto !important;"),p.Y8G("src",Te.fileScanUrl,p.B4B)}}function Qe(de,$e){if(1&de){const Te=p.RV6();p.j41(0,"a",27),p.bIt("click",function(){p.eBV(Te);const P=p.XpG(3);return p.Njj(P.onShowFile(P.fileScanUrl))}),p.DNE(1,et,2,0,"span",28)(2,Xe,1,3,"img",29),p.k0s()}if(2&de){const Te=p.XpG(3);p.R7$(),p.Y8G("ngIf",Te.loadingScanUrl),p.R7$(),p.Y8G("ngIf",!Te.loadingScanUrl)}}function ke(de,$e){if(1&de&&(p.j41(0,"div",25),p.DNE(1,Y,4,3,"ng-container",26)(2,Qe,3,2,"ng-template",null,2,p.C5r),p.k0s()),2&de){const Te=p.sdS(3),k=p.XpG(2);p.R7$(),p.Y8G("ngIf",!k.loadingScanUrl&&!k.fileScanUrl)("ngIfElse",Te)}}function tt(de,$e){if(1&de&&(p.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"h3",7)(4,"span"),p.EFF(5),p.nI1(6,"mytranslate"),p.k0s()(),p.DNE(7,qe,4,5,"div",8)(8,Se,4,5,"div",9),p.k0s()(),p.j41(9,"div",10)(10,"div",6)(11,"span",11),p.eu8(12,12),p.k0s(),p.j41(13,"span",13),p.nI1(14,"mytranslate"),p.eu8(15,12),p.k0s()(),p.j41(16,"div",14),p.DNE(17,xe,3,3,"span",15)(18,F,3,3,"span",16),p.k0s(),p.DNE(19,ke,4,2,"div",17),p.k0s()()),2&de){const Te=p.XpG(),k=p.sdS(2),P=p.sdS(4);p.R7$(5),p.JRh(p.bMT(6,9,"lang_auto_thi_offline")),p.R7$(2),p.Y8G("ngIf","teacher"==Te.currentScreen),p.R7$(),p.Y8G("ngIf",Te.isDeletableExamResultObj),p.R7$(4),p.Y8G("ngTemplateOutlet",k),p.R7$(),p.FS9("matTooltip",p.bMT(14,11,"lang_auto_so_bao_danh")),p.R7$(2),p.Y8G("ngTemplateOutlet",P),p.R7$(2),p.Y8G("ngIf",!Te.isMobileWebView),p.R7$(),p.Y8G("ngIf",!Te.checkHttpLinkImg),p.R7$(),p.Y8G("ngIf",Te.checkHttpLinkImg)}}function st(de,$e){if(1&de&&(p.EFF(0),p.nI1(1,"mytranslate"),p.j41(2,"span",32),p.EFF(3),p.nI1(4,"checkFormatOfflineExamHashIdToNumber"),p.k0s()),2&de){let Te;const k=p.XpG();p.SpI(" ",p.bMT(1,3,"lang_auto_ma_de_thi"),":\xa0 "),p.R7$(2),p.Y8G("ngClass",p.eq3(8,Ne,!(null!=k.offlineMarkObj&&k.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),p.R7$(),p.JRh(p.i5U(4,5,null!==(Te=null==k.offlineMixQuestionObj?null:k.offlineMixQuestionObj.hashId)&&void 0!==Te?Te:0,null==k.offlineMarkObj?null:k.offlineMarkObj.templateType))}}function rt(de,$e){if(1&de&&(p.EFF(0),p.nI1(1,"mytranslate"),p.j41(2,"span",32),p.EFF(3),p.nI1(4,"checkFormatStudentCodeToNumber"),p.k0s()),2&de){let Te;const k=p.XpG();p.SpI(" ",p.bMT(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),p.R7$(2),p.Y8G("ngClass",p.eq3(8,Ne,!(null!=k.offlineMarkObj&&k.offlineMarkObj.isErrorForStudentCode))),p.R7$(),p.JRh(p.i5U(4,5,(null!==(Te=null==k.offlineMarkObj?null:k.offlineMarkObj.studentCode)&&void 0!==Te?Te:0)<0?0:null==k.offlineMarkObj?null:k.offlineMarkObj.studentCode,null==k.offlineMarkObj?null:k.offlineMarkObj.templateType))}}let xt=(()=>{var de;class $e extends s.H{checkAzotaFile(k){return!(!k||!k.includes(".azt"))}checkHttpUrl(k){return!(!k||!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(k))}openEditScanFile(k,P){P&&this.sAztDialogService.open(he,{data:{examHashId:k,resultId:P,userId:Number(this.userIdParam)},width:"750px",restoreFocus:!1}).afterClosed().subscribe(We=>{We&&window.location.reload()})}deleteOfflineExamResultObj(k,P){P&&this.sAztDialogService.open(h.V,{data:{examHashId:k,examResultIds:[P],examResults:[]},restoreFocus:!1}).afterClosed().subscribe(We=>{We&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(k){this.sAztDialogService.open(d.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:k,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let k=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),P=this.castJsonToObj(k);this.checkHttpLinkImg=this.checkHttpUrl(P?.url),this.loadingScanUrl=!0,this.checkAzotaFile(P?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam,this.questionObjs,this.essayMark).then(H=>{H.imgUrl?this.fileScanUrl=H.imgUrl:this.checkHttpLinkImg=!0,this.drawScanExamService.totalPointExam=0,this.loadingScanUrl=!1}).catch(H=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(H=>{H?this.fileScanUrl=H:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(H=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(k,P,H){super(),this.sAztDialogService=k,this.zipDataService=P,this.drawScanExamService=H,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return(de=$e).\u0275fac=function(k){return new(k||de)(p.rXU(X.i),p.rXU(S.j),p.rXU(D))},de.\u0275cmp=p.VBU({type:de,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",currentScreen:"currentScreen",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj",questionObjs:"questionObjs",essayMark:"essayMark"},features:[p.Vt3,p.OA$],decls:5,vars:1,consts:[["viewExamCodeTpl",""],["viewStudentCodeTpl",""],["showImgScan",""],["class","info-exam-offline mt-3 mb-3",4,"ngIf"],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],["class","mx-1 items-center",4,"ngIf"],["class","mx-1 items-center mr-0",4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],[4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],[1,"mx-1","items-center"],[1,"text-slate-800",3,"click","matTooltip"],["name","file-pen-line","size","18",3,"ngClass"],[1,"mx-1","items-center","mr-0"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click","matTooltip"],["name","trash-2","size","18",3,"ngClass"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["alt","img",3,"src"],[3,"ngClass"]],template:function(k,P){1&k&&p.DNE(0,tt,20,13,"div",3)(1,st,5,10,"ng-template",null,0,p.C5r)(3,rt,5,10,"ng-template",null,1,p.C5r),2&k&&p.Y8G("ngIf",P.offlineMarkObj)},dependencies:[Z.YU,Z.bT,Z.T3,be.oV,ne.R,re.WGl,oe.wp,oe.Ps,oe.OK],encapsulation:2}),$e})()},1382:(ft,Ae,y)=>{"use strict";y.d(Ae,{I:()=>T});var s=y(73014),d=y(48891),h=y(53793),_=y(58112),x=y(99927);let T=(()=>{var ie;class fe{constructor(q,N,R){this.commonService=q,this.sAztCommonCdnService=N,this.answerTypeService=R}convertUrlToBase64(q){return(0,s.A)(function*(){const R=yield(yield fetch(q+"?t="+(new Date).getTime())).blob();return new Promise(z=>{const S=new FileReader;S.readAsDataURL(R),S.onloadend=()=>{z(S.result)}})})()}convertLinkToBase64(q,N,R){var z=this;return(0,s.A)(function*(){if(!N)return R;for(let K=0;K<(q?.length??0);K++)if(q?.[K].link===R)return q?.[K].convert;var S=yield z.convertUrlToBase64(R);return q?.push({convert:S,link:R}),S})()}replaceCanvasBackground(q,N){var R=this;return(0,s.A)(function*(){if(q){var z=[];for(let De=0;De<q.length;De++){var S=q[De];if(S&&0===S.isImage){var K=S.questionContentParse?.[0].content;S.questionContentParse&&(S.questionContentParse[0].content="");var B=void 0===K?[]:K.split("@[]");for(let he=0;he<B.length;he++){var M=B[he];if(!0===R.commonService.isJson(M)){var w=R.commonService.willDeleteParseJson(M);if(w.hasOwnProperty("link")){var D=document.body.offsetWidth,re=1;w.data.width>(ne=D-30)&&(w.data={x:w.data.x*(re=ne/w.data.width),y:w.data.y*re,width:w.data.width*re,height:w.data.height*re}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},S.questionContentParse&&(S.questionContentParse[0].content+=`<div class="background_question_${De}_${he}"><img width="${1024*re}" height="${1024*re}" src="${yield R.convertLinkToBase64(z,N,R.sAztCommonCdnService.getMyCdn(w.link))}"></div>`);var oe=document.createElement("style");document.body.appendChild(oe),oe.textContent+=`.background_question_${De}_${he} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${De}_${he} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else S.questionContentParse&&(S.questionContentParse[0].content+=M)}else S.questionContentParse&&(S.questionContentParse[0].content+=M)}if(R.answerTypeService.isOneChoiceAnswer(S))for(let he=0;he<(S.answerConfigParse?.length??0);he++){var Be=S.answerConfigParse?.[he].content;S.answerConfigParse&&(S.answerConfigParse[he].content="");var Oe=void 0===Be?[]:Be.split("@[]");for(let X=0;X<Oe.length;X++){var Ze=Oe[X];if(!0===R.commonService.isJson(Ze)){var Ie=R.commonService.willDeleteParseJson(Ze);Ie.hasOwnProperty("link")?(D=document.body.offsetWidth,re=1,Ie.data.width>(ne=D-30)&&(Ie.data={x:Ie.data.x*(re=ne/Ie.data.width),y:Ie.data.y*re,width:Ie.data.width*re,height:Ie.data.height*re}),Ie.data={x:Math.floor(Ie.data.x),y:Math.floor(Ie.data.y),width:Math.floor(Ie.data.width),height:Math.floor(Ie.data.height)},S.answerConfigParse&&(S.answerConfigParse[he].content+=`<div class="background_question__ans${De}_${he}_${X}"><img width="${1024*re}" height="${1024*re}" src="${yield R.convertLinkToBase64(z,N,R.sAztCommonCdnService.getMyCdn(Ie.link))}"></div>`),oe=document.createElement("style"),document.body.appendChild(oe),oe.textContent+=`.background_question__ans${De}_${he}_${X} {margin: 0 3px; width: ${Ie.data.width}px; height: ${Ie.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${De}_${he}_${X} img { margin-top: -${Ie.data.y}px; margin-left: -${Ie.data.x}px;}`):S.answerConfigParse&&(S.answerConfigParse[he].content+=Ze)}else S.answerConfigParse&&(S.answerConfigParse[he].content+=Ze)}}if(S.answerMediaParse&&S.answerMediaParse.length>0){var ct=S.answerMediaParse;S.answerMediaParse="";var it=void 0===ct?[]:ct.split("@[]");for(let he=0;he<it.length;he++){var Ce=it[he];if(!0===R.commonService.isJson(Ce)){var ne,ve=R.commonService.willDeleteParseJson(Ce);if(ve.hasOwnProperty("link"))D=document.body.offsetWidth,re=1,ve.data.width>(ne=D-30)&&(ve.data={x:ve.data.x*(re=ne/ve.data.width),y:ve.data.y*re,width:ve.data.width*re,height:ve.data.height*re}),ve.data={x:Math.floor(ve.data.x),y:Math.floor(ve.data.y),width:Math.floor(ve.data.width),height:Math.floor(ve.data.height)},S.answerMediaParse+=`<div class="background_question__ans_result${De}_${he}"><img width="${1024*re}" height="${1024*re}" src="${yield R.convertLinkToBase64(z,N,R.sAztCommonCdnService.getMyCdn(ve.link))}"></div>`,oe=document.createElement("style"),document.body.appendChild(oe),oe.textContent+=`.background_question__ans_result${De}_${he} {margin: 0 3px; width: ${ve.data.width}px; height: ${ve.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${De}_${he} img { margin-top: -${ve.data.y}px; margin-left: -${ve.data.x}px;}`;else S.answerMediaParse+=Ce}else S.answerMediaParse+=Ce}}}}}})()}replaceCanvasBackgroundTS(q,N){var R=this;return(0,s.A)(function*(){var z=[];for(let ct=0;ct<q.length;ct++){var S=q[ct];if(0===S.isImage){var K=S.questionContentParse[0].content;S.questionContentParse[0].content="";var B=void 0===K?[]:K.split("@[]");for(let it=0;it<B.length;it++){var M=B[it];if(!0===R.commonService.isJson(M)){var w=R.commonService.willDeleteParseJson(M);if(w.hasOwnProperty("link")){var D=document.body.offsetWidth,re=1;w.data.width>(ne=D-30)&&(w.data={x:w.data.x*(re=ne/w.data.width),y:w.data.y*re,width:w.data.width*re,height:w.data.height*re}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},S.questionContentParse[0].content+=`<div class="background_question_${ct}_${it}"><img width="${1024*re}" height="${1024*re}" src="${yield R.convertLinkToBase64(z,N,R.sAztCommonCdnService.getMyCdn(w.link))}"></div>`;var oe=document.createElement("style");document.body.appendChild(oe),oe.textContent+=`.background_question_${ct}_${it} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${ct}_${it} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else S.questionContentParse[0].content+=M}else S.questionContentParse[0].content+=M}if(R.answerTypeService.isOneChoiceAnswer(S)&&(0==S.isImage||1==S.isImage&&S.name.startsWith("[PDFv2]")?R.replaceBackgroundAnswerConfig(S.answerConfigParse,z,ct,N):R.replaceBackgroundAnswerConfig(S.answerConfigParseVer1.answerConfigV2,z,ct,N)),S.answerMedia&&S.answerMedia.length>0){var Be=S.answerMedia;S.answerMedia="";var Oe=void 0===Be?[]:Be.split("@[]");for(let it=0;it<Oe.length;it++){var Ze=Oe[it];if(!0===R.commonService.isJson(Ze)){var ne,Ie=R.commonService.willDeleteParseJson(Ze);if(Ie.hasOwnProperty("link"))D=document.body.offsetWidth,re=1,Ie.data.width>(ne=D-30)&&(Ie.data={x:Ie.data.x*(re=ne/Ie.data.width),y:Ie.data.y*re,width:Ie.data.width*re,height:Ie.data.height*re}),Ie.data={x:Math.floor(Ie.data.x),y:Math.floor(Ie.data.y),width:Math.floor(Ie.data.width),height:Math.floor(Ie.data.height)},S.answerMedia+=`<div class="background_question__ans_result${ct}_${it}"><img width="${1024*re}" height="${1024*re}" src="${yield R.convertLinkToBase64(z,N,R.sAztCommonCdnService.getMyCdn(Ie.link))}"></div>`,oe=document.createElement("style"),document.body.appendChild(oe),oe.textContent+=`.background_question__ans_result${ct}_${it} {margin: 0 3px; width: ${Ie.data.width}px; height: ${Ie.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${ct}_${it} img { margin-top: -${Ie.data.y}px; margin-left: -${Ie.data.x}px;}`;else S.answerMedia+=Ze}else S.answerMedia+=Ze}}}}return!0})()}replaceBackgroundAnswerConfig(q,N,R,z){var S=this;return(0,s.A)(function*(){for(let Be=0;Be<q.length;Be++){var K=q[Be].content;q[Be].content="";var B=void 0===K?[]:K.split("@[]");for(let Oe=0;Oe<B.length;Oe++){var M=B[Oe];if(!0===S.commonService.isJson(M)){var w=S.commonService.willDeleteParseJson(M);if(w.hasOwnProperty("link")){var ne=document.body.offsetWidth-30,re=1;w.data.width>ne&&(w.data={x:w.data.x*(re=ne/w.data.width),y:w.data.y*re,width:w.data.width*re,height:w.data.height*re}),w.data={x:Math.floor(w.data.x),y:Math.floor(w.data.y),width:Math.floor(w.data.width),height:Math.floor(w.data.height)},q[Be].content+=`<div class="background_question__ans${R}_${Be}_${Oe}"><img width="${1024*re}" height="${1024*re}" src="${yield S.convertLinkToBase64(N,z,S.sAztCommonCdnService.getMyCdn(w.link))}"></div>`;var oe=document.createElement("style");document.body.appendChild(oe),oe.textContent+=`.background_question__ans${R}_${Be}_${Oe} {margin: 0 3px; width: ${w.data.width}px; height: ${w.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${R}_${Be}_${Oe} img { margin-top: -${w.data.y}px; margin-left: -${w.data.x}px;}`}else q[Be].content+=M}else q[Be].content+=M}}})()}}return(ie=fe).\u0275fac=function(q){return new(q||ie)(d.KVO(h.R),d.KVO(_.c),d.KVO(x._))},ie.\u0275prov=d.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"}),fe})()},37642:(ft,Ae,y)=>{"use strict";y.d(Ae,{E:()=>d});var s=y(48891);let d=(()=>{var h;class _{getDictionaryByGroupFieldTS(T,ie){for(var fe={},p=0;p<T.length;p++)T[p].hasOwnProperty(ie)&&("number"==typeof T[p][ie]||"string"==typeof T[p][ie])&&(fe.hasOwnProperty(T[p][ie])||(fe[T[p][ie]]=[]),fe[T[p][ie]].push(T[p]));return fe}getDictionaryByFieldTS(T,ie){for(var fe={},p=0;p<T.length;p++)T[p].hasOwnProperty(ie)&&("number"==typeof T[p][ie]||"string"==typeof T[p][ie])&&(fe[T[p][ie]]=T[p]);return fe}getDictionaryBy2FieldsTS(T,ie,fe){for(var p={},q=0;q<T.length;q++)T[q].hasOwnProperty(ie)&&("number"==typeof T[q][ie]||"string"==typeof T[q][ie])&&T[q].hasOwnProperty(fe)&&("number"==typeof T[q][fe]||"string"==typeof T[q][fe])&&(p[T[q][ie]+"_"+T[q][fe]]=T[q]);return p}getListValueByFieldNumberTS(T,ie){for(var fe=[],p=0;p<T.length;p++)T[p].hasOwnProperty(ie)&&"number"==typeof T[p][ie]&&fe.push(T[p][ie]);return fe}getListValueByField(T,ie){for(var fe=[],p=0;p<T.length;p++)if(T[p].hasOwnProperty(ie)){var q=fe.filter(N=>N[ie]==T[p][ie]);(!q||0==q.length)&&fe.push(T[p])}return fe}}return(h=_).\u0275fac=function(T){return new(T||h)},h.\u0275prov=s.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),_})()},99172:(ft,Ae,y)=>{"use strict";y.d(Ae,{p:()=>T});var s=y(73014),d=y(48891),h=y(53793),_=y(58112),x=y(53393);let T=(()=>{var ie;class fe{processEssayResultToBase64(q){var N=this;return(0,s.A)(function*(){for(const R of q.pages??[]){if(R.draw){const z=yield N.exportPdfUtilsService.convertAndRetryToBase64(R.draw);R.draw=z}if(R.backgroundImage){const z=yield N.exportPdfUtilsService.convertAndRetryToBase64(R.backgroundImage);R.backgroundImage=z}}if(q.commentEmoji&&q.commentEmoji.length){let R="https://azota889.github.io/storage_public/mnote/",z=q.commentEmoji.length;for(let S=0;S<z;S++){let K=R+q.commentEmoji[S];const B=yield N.exportPdfUtilsService.convertAndRetryToBase64(K);q.commentEmoji[S]=B}}return q})()}convertAnswersArr(q,N){0!=q.length&&q.forEach(R=>{R.QuestionId&&R.AnswerContent&&R.AnswerContent[0]&&R.AnswerContent[0].Content&&(N[`id_${R.QuestionId}`]=R.AnswerContent[0].Content)})}findScaleDirection(q,N){return q/N>=.7070707070707071?"w":"h"}constructor(q,N,R){this.commonService=q,this.sAztCommonCdnService=N,this.exportPdfUtilsService=R}}return(ie=fe).\u0275fac=function(q){return new(q||ie)(d.KVO(h.R),d.KVO(_.c),d.KVO(x.j))},ie.\u0275prov=d.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"}),fe})()},53393:(ft,Ae,y)=>{"use strict";y.d(Ae,{j:()=>ie});var s=y(73014),d=function(fe){return fe[fe.Cdn=0]="Cdn",fe[fe.CdnTimestamp=1]="CdnTimestamp",fe[fe.Rawlink=2]="Rawlink",fe[fe.RawlinkTimestamp=3]="RawlinkTimestamp",fe}(d||{}),h=y(48891),_=y(53793),x=y(58112),T=y(99927);let ie=(()=>{var fe;class p{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){const N=navigator.userAgent,z=(()=>{let K=null;const B=N.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(B[1]))return"IE "+((/\brv[ :]+(\d+)/g.exec(N)||[])[1]||"");if("Chrome"===B[1]){const w=N.match(/\b(OPR|Edge)\/(\d+)/);if(null!==w)return w.slice(1).join(" ").replace("OPR","Opera")}const M=B[2]?[B[1],B[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!==(K=N.match(/version\/(\d+)/i))&&M.splice(1,1,K[1]),M.join(" ")})().toString();return!(!["chrome"].includes(z.split(" ")[0].toLowerCase())||parseInt(z.split(" ")[1],10)<80)}getExtensionFile(N){if(!N)return"";const R=N.split(".");return R.length<=1?"":R[R.length-1].toLocaleLowerCase().split("_")[0]}findImageSrcInContent(N){let R="";if(N.includes("img")){const z=N.indexOf("img"),S=N.indexOf("src=",z),K=N.indexOf('"',Number(S)+5);R=N.substring(Number(S)+5,Number(K))}return R}asyncTimeout(N){return(0,s.A)(function*(){return`Waited ${yield new Promise(z=>{setTimeout(()=>z(N),N)})} milliseconds`})()}parseEssayMarkResult(N,R){let z=N.filter(B=>this.answerTypeService.isEssayAnswer(B));if(0!=z.length&&R&&R.essayResult){var S=this.commonService.willDeleteParseJson(R.essayResult);if(S){var K=Object.entries(S);for(let B=0;B<z.length;B++)z[B].essayMarkParsed=K[B][1]}}}convertToBase64(N,R){var z=this;return(0,s.A)(function*(){let S=N;switch(R){case d.Cdn:S=z.sAztCommonCdnService.getMyCdn(N);break;case d.CdnTimestamp:S=z.sAztCommonCdnService.getMyCdn(N)+"?t="+Date.now();break;case d.RawlinkTimestamp:S=N+"?t="+Date.now()}const B=yield(yield fetch(S)).blob(),M=yield new Promise(w=>{const D=new FileReader;D.readAsDataURL(B),D.onloadend=()=>{w(D.result)}});return M&&"string"==typeof M?M:N})()}convertAndRetryToBase64(N){var R=this;return(0,s.A)(function*(){let z=R.getExtensionFile(N);if(["pdf","jpg","jpeg","png","gif"].includes(z)){let S;const K=[d.Cdn,d.CdnTimestamp,d.Rawlink,d.RawlinkTimestamp];try{S=yield R.convertToBase64(N,K[0])}catch{try{S=yield R.convertToBase64(N,K[1])}catch{try{S=yield R.convertToBase64(N,K[2])}catch{try{S=yield R.convertToBase64(N,K[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+N),S=N}}}}return S}return N})()}eraseCanvas(N){N&&(N.beginPath(),N.rect(0,0,N.canvas.width,N.canvas.height),N.fillStyle="white",N.fill())}addContentToPdf(N,R){N.addImage(R,"JPEG",0,0,N.internal.pageSize.getWidth(),N.internal.pageSize.getHeight())}drawTextWrap(N,R,z,S,K){const B=N.split(" "),M=[];let w=B[0];if(R){R.font=K||`${S}px Arial`;for(let D=1;D<B.length;D++){const Z=B[D];R.measureText(w+" "+Z).width<z?w+=" "+Z:(M.push(w),w=Z)}M.push(w)}return M}essayText2LinesArr(N,R,z,S,K){const B=new RegExp("(<br>|<br/>)+","igm"),w=(this.replaceAllByRegExp(N,B,"<br>")??"").split("<br>"),D=[];for(let Z=0;Z<w.length;Z++)D.push(this.drawTextWrap(w[Z],R,z,S,K));return D}replaceAllByRegExp(N,R,z){return z?N?N.toString().replace(R,z):void 0:N}removeTagAssistiveMml(){const N=document.getElementsByTagName("mjx-assistive-mml");for(;N.length>0;)N[0].remove()}constructor(N,R,z){this.commonService=N,this.sAztCommonCdnService=R,this.answerTypeService=z}}return(fe=p).\u0275fac=function(N){return new(N||fe)(h.KVO(_.R),h.KVO(x.c),h.KVO(T._))},fe.\u0275prov=h.jDH({token:fe,factory:fe.\u0275fac,providedIn:"root"}),p})()},57998:(ft,Ae,y)=>{"use strict";function s(){return typeof aztExam<"u"?aztExam:void 0}y.d(Ae,{J:()=>Wp});var K,B,d=y(43234),h=y(48891),_=y(36484),x=y(42802),T=y(73014),ie=y(92757),fe=y(73990),p=y(85980),q=y(64627),N=y(56094),R=y(17791),z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},S={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(se,L,J){J||(J=0);var le=Array(16);if("string"==typeof L)for(var ce=0;16>ce;++ce)le[ce]=L.charCodeAt(J++)|L.charCodeAt(J++)<<8|L.charCodeAt(J++)<<16|L.charCodeAt(J++)<<24;else for(ce=0;16>ce;++ce)le[ce]=L[J++]|L[J++]<<8|L[J++]<<16|L[J++]<<24;var ge=se.g[3],Q=(L=se.g[0])+(ge^(J=se.g[1])&((ce=se.g[2])^ge))+le[0]+3614090360&4294967295;Q=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=(J=(ce=(ge=(L=J+(Q<<7&4294967295|Q>>>25))+((Q=ge+(ce^L&(J^ce))+le[1]+3905402710&4294967295)<<12&4294967295|Q>>>20))+((Q=ce+(J^ge&(L^J))+le[2]+606105819&4294967295)<<17&4294967295|Q>>>15))+((Q=J+(L^ce&(ge^L))+le[3]+3250441966&4294967295)<<22&4294967295|Q>>>10))+((Q=L+(ge^J&(ce^ge))+le[4]+4118548399&4294967295)<<7&4294967295|Q>>>25))+((Q=ge+(ce^L&(J^ce))+le[5]+1200080426&4294967295)<<12&4294967295|Q>>>20))+((Q=ce+(J^ge&(L^J))+le[6]+2821735955&4294967295)<<17&4294967295|Q>>>15))+((Q=J+(L^ce&(ge^L))+le[7]+4249261313&4294967295)<<22&4294967295|Q>>>10))+((Q=L+(ge^J&(ce^ge))+le[8]+1770035416&4294967295)<<7&4294967295|Q>>>25))+((Q=ge+(ce^L&(J^ce))+le[9]+2336552879&4294967295)<<12&4294967295|Q>>>20))+((Q=ce+(J^ge&(L^J))+le[10]+4294925233&4294967295)<<17&4294967295|Q>>>15))+((Q=J+(L^ce&(ge^L))+le[11]+2304563134&4294967295)<<22&4294967295|Q>>>10))+((Q=L+(ge^J&(ce^ge))+le[12]+1804603682&4294967295)<<7&4294967295|Q>>>25))+((Q=ge+(ce^L&(J^ce))+le[13]+4254626195&4294967295)<<12&4294967295|Q>>>20))+((Q=ce+(J^ge&(L^J))+le[14]+2792965006&4294967295)<<17&4294967295|Q>>>15))+((Q=J+(L^ce&(ge^L))+le[15]+1236535329&4294967295)<<22&4294967295|Q>>>10))+((Q=L+(ce^ge&(J^ce))+le[1]+4129170786&4294967295)<<5&4294967295|Q>>>27))+((Q=ge+(J^ce&(L^J))+le[6]+3225465664&4294967295)<<9&4294967295|Q>>>23))+((Q=ce+(L^J&(ge^L))+le[11]+643717713&4294967295)<<14&4294967295|Q>>>18))+((Q=J+(ge^L&(ce^ge))+le[0]+3921069994&4294967295)<<20&4294967295|Q>>>12))+((Q=L+(ce^ge&(J^ce))+le[5]+3593408605&4294967295)<<5&4294967295|Q>>>27))+((Q=ge+(J^ce&(L^J))+le[10]+38016083&4294967295)<<9&4294967295|Q>>>23))+((Q=ce+(L^J&(ge^L))+le[15]+3634488961&4294967295)<<14&4294967295|Q>>>18))+((Q=J+(ge^L&(ce^ge))+le[4]+3889429448&4294967295)<<20&4294967295|Q>>>12))+((Q=L+(ce^ge&(J^ce))+le[9]+568446438&4294967295)<<5&4294967295|Q>>>27))+((Q=ge+(J^ce&(L^J))+le[14]+3275163606&4294967295)<<9&4294967295|Q>>>23))+((Q=ce+(L^J&(ge^L))+le[3]+4107603335&4294967295)<<14&4294967295|Q>>>18))+((Q=J+(ge^L&(ce^ge))+le[8]+1163531501&4294967295)<<20&4294967295|Q>>>12))+((Q=L+(ce^ge&(J^ce))+le[13]+2850285829&4294967295)<<5&4294967295|Q>>>27))+((Q=ge+(J^ce&(L^J))+le[2]+4243563512&4294967295)<<9&4294967295|Q>>>23))+((Q=ce+(L^J&(ge^L))+le[7]+1735328473&4294967295)<<14&4294967295|Q>>>18))+((Q=J+(ge^L&(ce^ge))+le[12]+2368359562&4294967295)<<20&4294967295|Q>>>12))+((Q=L+(J^ce^ge)+le[5]+4294588738&4294967295)<<4&4294967295|Q>>>28))+((Q=ge+(L^J^ce)+le[8]+2272392833&4294967295)<<11&4294967295|Q>>>21))+((Q=ce+(ge^L^J)+le[11]+1839030562&4294967295)<<16&4294967295|Q>>>16))+((Q=J+(ce^ge^L)+le[14]+4259657740&4294967295)<<23&4294967295|Q>>>9))+((Q=L+(J^ce^ge)+le[1]+2763975236&4294967295)<<4&4294967295|Q>>>28))+((Q=ge+(L^J^ce)+le[4]+1272893353&4294967295)<<11&4294967295|Q>>>21))+((Q=ce+(ge^L^J)+le[7]+4139469664&4294967295)<<16&4294967295|Q>>>16))+((Q=J+(ce^ge^L)+le[10]+3200236656&4294967295)<<23&4294967295|Q>>>9))+((Q=L+(J^ce^ge)+le[13]+681279174&4294967295)<<4&4294967295|Q>>>28))+((Q=ge+(L^J^ce)+le[0]+3936430074&4294967295)<<11&4294967295|Q>>>21))+((Q=ce+(ge^L^J)+le[3]+3572445317&4294967295)<<16&4294967295|Q>>>16))+((Q=J+(ce^ge^L)+le[6]+76029189&4294967295)<<23&4294967295|Q>>>9))+((Q=L+(J^ce^ge)+le[9]+3654602809&4294967295)<<4&4294967295|Q>>>28))+((Q=ge+(L^J^ce)+le[12]+3873151461&4294967295)<<11&4294967295|Q>>>21))+((Q=ce+(ge^L^J)+le[15]+530742520&4294967295)<<16&4294967295|Q>>>16))+((Q=J+(ce^ge^L)+le[2]+3299628645&4294967295)<<23&4294967295|Q>>>9))+((Q=L+(ce^(J|~ge))+le[0]+4096336452&4294967295)<<6&4294967295|Q>>>26))+((Q=ge+(J^(L|~ce))+le[7]+1126891415&4294967295)<<10&4294967295|Q>>>22))+((Q=ce+(L^(ge|~J))+le[14]+2878612391&4294967295)<<15&4294967295|Q>>>17))+((Q=J+(ge^(ce|~L))+le[5]+4237533241&4294967295)<<21&4294967295|Q>>>11))+((Q=L+(ce^(J|~ge))+le[12]+1700485571&4294967295)<<6&4294967295|Q>>>26))+((Q=ge+(J^(L|~ce))+le[3]+2399980690&4294967295)<<10&4294967295|Q>>>22))+((Q=ce+(L^(ge|~J))+le[10]+4293915773&4294967295)<<15&4294967295|Q>>>17))+((Q=J+(ge^(ce|~L))+le[1]+2240044497&4294967295)<<21&4294967295|Q>>>11))+((Q=L+(ce^(J|~ge))+le[8]+1873313359&4294967295)<<6&4294967295|Q>>>26))+((Q=ge+(J^(L|~ce))+le[15]+4264355552&4294967295)<<10&4294967295|Q>>>22))+((Q=ce+(L^(ge|~J))+le[6]+2734768916&4294967295)<<15&4294967295|Q>>>17))+((Q=J+(ge^(ce|~L))+le[13]+1309151649&4294967295)<<21&4294967295|Q>>>11))+((ge=(L=J+((Q=L+(ce^(J|~ge))+le[4]+4149444226&4294967295)<<6&4294967295|Q>>>26))+((Q=ge+(J^(L|~ce))+le[11]+3174756917&4294967295)<<10&4294967295|Q>>>22))^((ce=ge+((Q=ce+(L^(ge|~J))+le[2]+718787259&4294967295)<<15&4294967295|Q>>>17))|~L))+le[9]+3951481745&4294967295,se.g[0]=se.g[0]+L&4294967295,se.g[1]=se.g[1]+(ce+(Q<<21&4294967295|Q>>>11))&4294967295,se.g[2]=se.g[2]+ce&4294967295,se.g[3]=se.g[3]+ge&4294967295}function a(se,L){this.h=L;for(var J=[],le=!0,ce=se.length-1;0<=ce;ce--){var ge=0|se[ce];le&&ge==L||(J[ce]=ge,le=!1)}this.g=J}(function e(se,L){function J(){}J.prototype=L.prototype,se.D=L.prototype,se.prototype=new J,se.prototype.constructor=se,se.C=function(le,ce,ge){for(var Q=Array(arguments.length-2),kn=2;kn<arguments.length;kn++)Q[kn-2]=arguments[kn];return L.prototype[ce].apply(le,Q)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(se,L){void 0===L&&(L=se.length);for(var J=L-this.blockSize,le=this.B,ce=this.h,ge=0;ge<L;){if(0==ce)for(;ge<=J;)i(this,se,ge),ge+=this.blockSize;if("string"==typeof se){for(;ge<L;)if(le[ce++]=se.charCodeAt(ge++),ce==this.blockSize){i(this,le),ce=0;break}}else for(;ge<L;)if(le[ce++]=se[ge++],ce==this.blockSize){i(this,le),ce=0;break}}this.h=ce,this.o+=L},n.prototype.v=function(){var se=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);se[0]=128;for(var L=1;L<se.length-8;++L)se[L]=0;var J=8*this.o;for(L=se.length-8;L<se.length;++L)se[L]=255&J,J/=256;for(this.u(se),se=Array(16),L=J=0;4>L;++L)for(var le=0;32>le;le+=8)se[J++]=this.g[L]>>>le&255;return se};var c={};function u(se){return-128<=se&&128>se?function o(se,L){var J=c;return Object.prototype.hasOwnProperty.call(J,se)?J[se]:J[se]=L(se)}(se,function(L){return new a([0|L],0>L?-1:0)}):new a([0|se],0>se?-1:0)}function f(se){if(isNaN(se)||!isFinite(se))return C;if(0>se)return Ue(f(-se));for(var L=[],J=1,le=0;se>=J;le++)L[le]=se/J|0,J*=4294967296;return new a(L,0)}var C=u(0),j=u(1),_e=u(16777216);function Ve(se){if(0!=se.h)return!1;for(var L=0;L<se.g.length;L++)if(0!=se.g[L])return!1;return!0}function Ke(se){return-1==se.h}function Ue(se){for(var L=se.g.length,J=[],le=0;le<L;le++)J[le]=~se.g[le];return new a(J,~se.h).add(j)}function lt(se,L){return se.add(Ue(L))}function mt(se,L){for(;(65535&se[L])!=se[L];)se[L+1]+=se[L]>>>16,se[L]&=65535,L++}function ht(se,L){this.g=se,this.h=L}function pt(se,L){if(Ve(L))throw Error("division by zero");if(Ve(se))return new ht(C,C);if(Ke(se))return L=pt(Ue(se),L),new ht(Ue(L.g),Ue(L.h));if(Ke(L))return L=pt(se,Ue(L)),new ht(Ue(L.g),L.h);if(30<se.g.length){if(Ke(se)||Ke(L))throw Error("slowDivide_ only works with positive integers.");for(var J=j,le=L;0>=le.l(se);)J=It(J),le=It(le);var ce=yt(J,1),ge=yt(le,1);for(le=yt(le,2),J=yt(J,2);!Ve(le);){var Q=ge.add(le);0>=Q.l(se)&&(ce=ce.add(J),ge=Q),le=yt(le,1),J=yt(J,1)}return L=lt(se,ce.j(L)),new ht(ce,L)}for(ce=C;0<=se.l(L);){for(J=Math.max(1,Math.floor(se.m()/L.m())),le=48>=(le=Math.ceil(Math.log(J)/Math.LN2))?1:Math.pow(2,le-48),Q=(ge=f(J)).j(L);Ke(Q)||0<Q.l(se);)Q=(ge=f(J-=le)).j(L);Ve(ge)&&(ge=j),ce=ce.add(ge),se=lt(se,Q)}return new ht(ce,se)}function It(se){for(var L=se.g.length+1,J=[],le=0;le<L;le++)J[le]=se.i(le)<<1|se.i(le-1)>>>31;return new a(J,se.h)}function yt(se,L){var J=L>>5;L%=32;for(var le=se.g.length-J,ce=[],ge=0;ge<le;ge++)ce[ge]=0<L?se.i(ge+J)>>>L|se.i(ge+J+1)<<32-L:se.i(ge+J);return new a(ce,se.h)}(r=a.prototype).m=function(){if(Ke(this))return-Ue(this).m();for(var se=0,L=1,J=0;J<this.g.length;J++){var le=this.i(J);se+=(0<=le?le:4294967296+le)*L,L*=4294967296}return se},r.toString=function(se){if(2>(se=se||10)||36<se)throw Error("radix out of range: "+se);if(Ve(this))return"0";if(Ke(this))return"-"+Ue(this).toString(se);for(var L=f(Math.pow(se,6)),J=this,le="";;){var ce=pt(J,L).g,ge=((0<(J=lt(J,ce.j(L))).g.length?J.g[0]:J.h)>>>0).toString(se);if(Ve(J=ce))return ge+le;for(;6>ge.length;)ge="0"+ge;le=ge+le}},r.i=function(se){return 0>se?0:se<this.g.length?this.g[se]:this.h},r.l=function(se){return Ke(se=lt(this,se))?-1:Ve(se)?0:1},r.abs=function(){return Ke(this)?Ue(this):this},r.add=function(se){for(var L=Math.max(this.g.length,se.g.length),J=[],le=0,ce=0;ce<=L;ce++){var ge=le+(65535&this.i(ce))+(65535&se.i(ce)),Q=(ge>>>16)+(this.i(ce)>>>16)+(se.i(ce)>>>16);le=Q>>>16,J[ce]=(Q&=65535)<<16|(ge&=65535)}return new a(J,-2147483648&J[J.length-1]?-1:0)},r.j=function(se){if(Ve(this)||Ve(se))return C;if(Ke(this))return Ke(se)?Ue(this).j(Ue(se)):Ue(Ue(this).j(se));if(Ke(se))return Ue(this.j(Ue(se)));if(0>this.l(_e)&&0>se.l(_e))return f(this.m()*se.m());for(var L=this.g.length+se.g.length,J=[],le=0;le<2*L;le++)J[le]=0;for(le=0;le<this.g.length;le++)for(var ce=0;ce<se.g.length;ce++){var ge=this.i(le)>>>16,Q=65535&this.i(le),kn=se.i(ce)>>>16,Bi=65535&se.i(ce);J[2*le+2*ce]+=Q*Bi,mt(J,2*le+2*ce),J[2*le+2*ce+1]+=ge*Bi,mt(J,2*le+2*ce+1),J[2*le+2*ce+1]+=Q*kn,mt(J,2*le+2*ce+1),J[2*le+2*ce+2]+=ge*kn,mt(J,2*le+2*ce+2)}for(le=0;le<L;le++)J[le]=J[2*le+1]<<16|J[2*le];for(le=L;le<2*L;le++)J[le]=0;return new a(J,0)},r.A=function(se){return pt(this,se).h},r.and=function(se){for(var L=Math.max(this.g.length,se.g.length),J=[],le=0;le<L;le++)J[le]=this.i(le)&se.i(le);return new a(J,this.h&se.h)},r.or=function(se){for(var L=Math.max(this.g.length,se.g.length),J=[],le=0;le<L;le++)J[le]=this.i(le)|se.i(le);return new a(J,this.h|se.h)},r.xor=function(se){for(var L=Math.max(this.g.length,se.g.length),J=[],le=0;le<L;le++)J[le]=this.i(le)^se.i(le);return new a(J,this.h^se.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,B=S.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=function v(se,L){if(0==se.length)throw Error("number format error: empty string");if(2>(L=L||10)||36<L)throw Error("radix out of range: "+L);if("-"==se.charAt(0))return Ue(v(se.substring(1),L));if(0<=se.indexOf("-"))throw Error('number format error: interior "-" character');for(var J=f(Math.pow(L,8)),le=C,ce=0;ce<se.length;ce+=8){var ge=Math.min(8,se.length-ce),Q=parseInt(se.substring(ce,ce+ge),L);8>ge?(ge=f(Math.pow(L,ge)),le=le.j(ge).add(f(Q))):le=(le=le.j(J)).add(f(Q))}return le},K=S.Integer=a}).apply(typeof z<"u"?z:typeof self<"u"?self:typeof window<"u"?window:{});var D,ne,re,oe,Be,Oe,Ze,Ie,M=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},w={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(l,m,g){return l==Array.prototype||l==Object.prototype||(l[m]=g.value),l},n=function t(l){l=["object"==typeof globalThis&&globalThis,l,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof M&&M];for(var m=0;m<l.length;++m){var g=l[m];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}(this);!function i(l,m){if(m)e:{var g=n;l=l.split(".");for(var A=0;A<l.length-1;A++){var me=l[A];if(!(me in g))break e;g=g[me]}(m=m(A=g[l=l[l.length-1]]))!=A&&null!=m&&e(g,l,{configurable:!0,writable:!0,value:m})}}("Array.prototype.values",function(l){return l||function(){return function o(l,m){l instanceof String&&(l+="");var g=0,A=!1,me={next:function(){if(!A&&g<l.length){var Ee=g++;return{value:m(Ee,l[Ee]),done:!1}}return A=!0,{done:!0,value:void 0}}};return me[Symbol.iterator]=function(){return me},me}(this,function(m,g){return g})}});var a=a||{},c=this||self;function u(l){var m=typeof l;return"array"==(m="object"!=m?m:l?Array.isArray(l)?"array":m:"null")||"object"==m&&"number"==typeof l.length}function f(l){var m=typeof l;return"object"==m&&null!=l||"function"==m}function v(l,m,g){return l.call.apply(l.bind,arguments)}function C(l,m,g){if(!l)throw Error();if(2<arguments.length){var A=Array.prototype.slice.call(arguments,2);return function(){var me=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(me,A),l.apply(m,me)}}return function(){return l.apply(m,arguments)}}function j(l,m,g){return(j=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:C).apply(null,arguments)}function _e(l,m){var g=Array.prototype.slice.call(arguments,1);return function(){var A=g.slice();return A.push.apply(A,arguments),l.apply(this,A)}}function Ve(l,m){function g(){}g.prototype=m.prototype,l.aa=m.prototype,l.prototype=new g,l.prototype.constructor=l,l.Qb=function(A,me,Ee){for(var nt=Array(arguments.length-2),Pt=2;Pt<arguments.length;Pt++)nt[Pt-2]=arguments[Pt];return m.prototype[me].apply(A,nt)}}function Ke(l){const m=l.length;if(0<m){const g=Array(m);for(let A=0;A<m;A++)g[A]=l[A];return g}return[]}function Ue(l,m){for(let g=1;g<arguments.length;g++){const A=arguments[g];if(u(A)){const me=l.length||0,Ee=A.length||0;l.length=me+Ee;for(let nt=0;nt<Ee;nt++)l[me+nt]=A[nt]}else l.push(A)}}function mt(l){return/^[\s\xa0]*$/.test(l)}function ht(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function pt(l){return pt[" "](l),l}pt[" "]=function(){};var It=!(-1==ht().indexOf("Gecko")||-1!=ht().toLowerCase().indexOf("webkit")&&-1==ht().indexOf("Edge")||-1!=ht().indexOf("Trident")||-1!=ht().indexOf("MSIE")||-1!=ht().indexOf("Edge"));function yt(l,m,g){for(const A in l)m.call(g,l[A],A,l)}function L(l){const m={};for(const g in l)m[g]=l[g];return m}const J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function le(l,m){let g,A;for(let me=1;me<arguments.length;me++){for(g in A=arguments[me],A)l[g]=A[g];for(let Ee=0;Ee<J.length;Ee++)g=J[Ee],Object.prototype.hasOwnProperty.call(A,g)&&(l[g]=A[g])}}function ce(l){var m=1;l=l.split(":");const g=[];for(;0<m&&l.length;)g.push(l.shift()),m--;return l.length&&g.push(l.join(":")),g}function ge(l){c.setTimeout(()=>{throw l},0)}function Q(){var l=zl;let m=null;return l.g&&(m=l.g,l.g=l.g.next,l.g||(l.h=null),m.next=null),m}var Bi=new class lt{constructor(m,g){this.i=m,this.j=g,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}(()=>new Kp,l=>l.reset());class Kp{constructor(){this.next=this.g=this.h=null}set(m,g){this.h=m,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Li,Gi=!1,zl=new class kn{constructor(){this.h=this.g=null}add(m,g){const A=Bi.get();A.set(m,g),this.h?this.h.next=A:this.g=A,this.h=A}},Td=()=>{const l=c.Promise.resolve(void 0);Li=()=>{l.then(Yp)}};var Yp=()=>{for(var l;l=Q();){try{l.h.call(l.g)}catch(g){ge(g)}var m=Bi;m.j(l),100>m.h&&(m.h++,l.next=m.g,m.g=l)}Gi=!1};function Qn(){this.s=this.s,this.C=this.C}function an(l,m){this.type=l,this.g=this.target=m,this.defaultPrevented=!1}Qn.prototype.s=!1,Qn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Qn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},an.prototype.h=function(){this.defaultPrevented=!0};var Qp=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,m=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const g=()=>{};c.addEventListener("test",g,m),c.removeEventListener("test",g,m)}catch{}return l}();function $i(l,m){if(an.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var g=this.type=l.type,A=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=m,m=l.relatedTarget){if(It){e:{try{pt(m.nodeName);var me=!0;break e}catch{}me=!1}me||(m=null)}}else"mouseover"==g?m=l.fromElement:"mouseout"==g&&(m=l.toElement);this.relatedTarget=m,A?(this.clientX=void 0!==A.clientX?A.clientX:A.pageX,this.clientY=void 0!==A.clientY?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=void 0!==l.clientX?l.clientX:l.pageX,this.clientY=void 0!==l.clientY?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType="string"==typeof l.pointerType?l.pointerType:Xp[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&$i.aa.h.call(this)}}Ve($i,an);var Xp={2:"touch",3:"pen",4:"mouse"};$i.prototype.h=function(){$i.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Ui="closure_listenable_"+(1e6*Math.random()|0),Jp=0;function Hp(l,m,g,A,me){this.listener=l,this.proxy=null,this.src=m,this.type=g,this.capture=!!A,this.ha=me,this.key=++Jp,this.da=this.fa=!1}function ro(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function io(l){this.src=l,this.g={},this.h=0}function Nl(l,m){var g=m.type;if(g in l.g){var Ee,A=l.g[g],me=Array.prototype.indexOf.call(A,m,void 0);(Ee=0<=me)&&Array.prototype.splice.call(A,me,1),Ee&&(ro(m),0==l.g[g].length&&(delete l.g[g],l.h--))}}function jl(l,m,g,A){for(var me=0;me<l.length;++me){var Ee=l[me];if(!Ee.da&&Ee.listener==m&&Ee.capture==!!g&&Ee.ha==A)return me}return-1}io.prototype.add=function(l,m,g,A,me){var Ee=l.toString();(l=this.g[Ee])||(l=this.g[Ee]=[],this.h++);var nt=jl(l,m,A,me);return-1<nt?(m=l[nt],g||(m.fa=!1)):((m=new Hp(m,this.src,Ee,!!A,me)).fa=g,l.push(m)),m};var Bl="closure_lm_"+(1e6*Math.random()|0),Ll={};function bd(l,m,g,A,me){if(A&&A.once)return Id(l,m,g,A,me);if(Array.isArray(m)){for(var Ee=0;Ee<m.length;Ee++)bd(l,m[Ee],g,A,me);return null}return g=ql(g),l&&l[Ui]?l.K(m,g,f(A)?!!A.capture:!!A,me):Ed(l,m,g,!1,A,me)}function Ed(l,m,g,A,me,Ee){if(!m)throw Error("Invalid event type");var nt=f(me)?!!me.capture:!!me,Pt=$l(l);if(Pt||(l[Bl]=Pt=new io(l)),(g=Pt.add(m,g,A,nt,Ee)).proxy)return g;if(A=function Zp(){const m=eg;return function l(g){return m.call(l.src,l.listener,g)}}(),g.proxy=A,A.src=l,A.listener=g,l.addEventListener)Qp||(me=nt),void 0===me&&(me=!1),l.addEventListener(m.toString(),A,me);else if(l.attachEvent)l.attachEvent(Ad(m.toString()),A);else{if(!l.addListener||!l.removeListener)throw Error("addEventListener and attachEvent are unavailable.");l.addListener(A)}return g}function Id(l,m,g,A,me){if(Array.isArray(m)){for(var Ee=0;Ee<m.length;Ee++)Id(l,m[Ee],g,A,me);return null}return g=ql(g),l&&l[Ui]?l.L(m,g,f(A)?!!A.capture:!!A,me):Ed(l,m,g,!0,A,me)}function Cd(l,m,g,A,me){if(Array.isArray(m))for(var Ee=0;Ee<m.length;Ee++)Cd(l,m[Ee],g,A,me);else A=f(A)?!!A.capture:!!A,g=ql(g),l&&l[Ui]?(l=l.i,(m=String(m).toString())in l.g&&-1<(g=jl(Ee=l.g[m],g,A,me))&&(ro(Ee[g]),Array.prototype.splice.call(Ee,g,1),0==Ee.length&&(delete l.g[m],l.h--))):l&&(l=$l(l))&&(m=l.g[m.toString()],l=-1,m&&(l=jl(m,g,A,me)),(g=-1<l?m[l]:null)&&Gl(g))}function Gl(l){if("number"!=typeof l&&l&&!l.da){var m=l.src;if(m&&m[Ui])Nl(m.i,l);else{var g=l.type,A=l.proxy;m.removeEventListener?m.removeEventListener(g,A,l.capture):m.detachEvent?m.detachEvent(Ad(g),A):m.addListener&&m.removeListener&&m.removeListener(A),(g=$l(m))?(Nl(g,l),0==g.h&&(g.src=null,m[Bl]=null)):ro(l)}}}function Ad(l){return l in Ll?Ll[l]:Ll[l]="on"+l}function eg(l,m){if(l.da)l=!0;else{m=new $i(m,this);var g=l.listener,A=l.ha||l.src;l.fa&&Gl(l),l=g.call(A,m)}return l}function $l(l){return(l=l[Bl])instanceof io?l:null}var Ul="__closure_events_fn_"+(1e9*Math.random()>>>0);function ql(l){return"function"==typeof l?l:(l[Ul]||(l[Ul]=function(m){return l.handleEvent(m)}),l[Ul])}function ln(){Qn.call(this),this.i=new io(this),this.M=this,this.F=null}function hn(l,m){var g,A=l.F;if(A)for(g=[];A;A=A.F)g.push(A);if(l=l.M,A=m.type||m,"string"==typeof m)m=new an(m,l);else if(m instanceof an)m.target=m.target||l;else{var me=m;le(m=new an(A,l),me)}if(me=!0,g)for(var Ee=g.length-1;0<=Ee;Ee--){var nt=m.g=g[Ee];me=so(nt,A,!0,m)&&me}if(me=so(nt=m.g=l,A,!0,m)&&me,me=so(nt,A,!1,m)&&me,g)for(Ee=0;Ee<g.length;Ee++)me=so(nt=m.g=g[Ee],A,!1,m)&&me}function so(l,m,g,A){if(!(m=l.i.g[String(m)]))return!0;m=m.concat();for(var me=!0,Ee=0;Ee<m.length;++Ee){var nt=m[Ee];if(nt&&!nt.da&&nt.capture==g){var Pt=nt.listener,Ht=nt.ha||nt.src;nt.fa&&Nl(l.i,nt),me=!1!==Pt.call(Ht,A)&&me}}return me&&!A.defaultPrevented}function Sd(l,m,g){if("function"==typeof l)g&&(l=j(l,g));else{if(!l||"function"!=typeof l.handleEvent)throw Error("Invalid listener argument");l=j(l.handleEvent,l)}return 2147483647<Number(m)?-1:c.setTimeout(l,m||0)}function Rd(l){l.g=Sd(()=>{l.g=null,l.i&&(l.i=!1,Rd(l))},l.l);const m=l.h;l.h=null,l.m.apply(null,m)}Ve(ln,Qn),ln.prototype[Ui]=!0,ln.prototype.removeEventListener=function(l,m,g,A){Cd(this,l,m,g,A)},ln.prototype.N=function(){if(ln.aa.N.call(this),this.i){var m,l=this.i;for(m in l.g){for(var g=l.g[m],A=0;A<g.length;A++)ro(g[A]);delete l.g[m],l.h--}}this.F=null},ln.prototype.K=function(l,m,g,A){return this.i.add(String(l),m,!1,g,A)},ln.prototype.L=function(l,m,g,A){return this.i.add(String(l),m,!0,g,A)};class tg extends Qn{constructor(m,g){super(),this.m=m,this.l=g,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:Rd(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qi(l){Qn.call(this),this.h=l,this.g={}}Ve(qi,Qn);var Od=[];function Pd(l){yt(l.g,function(m,g){this.g.hasOwnProperty(g)&&Gl(m)},l),l.g={}}qi.prototype.N=function(){qi.aa.N.call(this),Pd(this)},qi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wl=c.JSON.stringify,ng=c.JSON.parse,rg=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function Kl(){}function Md(){}Kl.prototype.h=null;var Wi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Yl(){an.call(this,"d")}function Ql(){an.call(this,"c")}Ve(Yl,an),Ve(Ql,an);var pr={},Dd=null;function oo(){return Dd=Dd||new ln}function Fd(l){an.call(this,pr.La,l)}function Ki(l){const m=oo();hn(m,new Fd(m))}function Vd(l,m){an.call(this,pr.STAT_EVENT,l),this.stat=m}function dn(l){const m=oo();hn(m,new Vd(m,l))}function zd(l,m){an.call(this,pr.Ma,l),this.size=m}function Yi(l,m){if("function"!=typeof l)throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},m)}function Qi(){this.g=!0}function ti(l,m,g,A){l.info(function(){return"XMLHTTP TEXT ("+m+"): "+function ag(l,m){if(!l.g)return m;if(!m)return null;try{var g=JSON.parse(m);if(g)for(l=0;l<g.length;l++)if(Array.isArray(g[l])){var A=g[l];if(!(2>A.length)){var me=A[1];if(Array.isArray(me)&&!(1>me.length)){var Ee=me[0];if("noop"!=Ee&&"stop"!=Ee&&"close"!=Ee)for(var nt=1;nt<me.length;nt++)me[nt]=""}}}return Wl(g)}catch{return m}}(l,g)+(A?" "+A:"")})}pr.La="serverreachability",Ve(Fd,an),pr.STAT_EVENT="statevent",Ve(Vd,an),pr.Ma="timingevent",Ve(zd,an),Qi.prototype.xa=function(){this.g=!1},Qi.prototype.info=function(){};var Xl,ao={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Nd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function lo(){}function Xn(l,m,g,A){this.j=l,this.i=m,this.l=g,this.R=A||1,this.U=new qi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new jd}function jd(){this.i=null,this.g="",this.h=!1}Ve(lo,Kl),lo.prototype.g=function(){return new XMLHttpRequest},lo.prototype.i=function(){return{}},Xl=new lo;var Bd={},Jl={};function Hl(l,m,g){l.L=1,l.v=_o(Mn(m)),l.m=g,l.P=!0,Ld(l,null)}function Ld(l,m){l.F=Date.now(),co(l),l.A=Mn(l.v);var g=l.A,A=l.R;Array.isArray(A)||(A=[String(A)]),t_(g.i,"t",A),l.C=0,g=l.j.J,l.h=new jd,l.g=v_(l.j,g?m:null,!l.m),0<l.O&&(l.M=new tg(j(l.Y,l,l.g),l.O)),m=l.U,g=l.g,A=l.ca;var me="readystatechange";Array.isArray(me)||(me&&(Od[0]=me.toString()),me=Od);for(var Ee=0;Ee<me.length;Ee++){var nt=bd(g,me[Ee],A||m.handleEvent,!1,m.h||m);if(!nt)break;m.g[nt.key]=nt}m=l.H?L(l.H):{},l.m?(l.u||(l.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,m)):(l.u="GET",l.g.ea(l.A,l.u,null,m)),Ki(),function ig(l,m,g,A,me,Ee){l.info(function(){if(l.g)if(Ee)for(var nt="",Pt=Ee.split("&"),Ht=0;Ht<Pt.length;Ht++){var Ct=Pt[Ht].split("=");if(1<Ct.length){var cn=Ct[0];Ct=Ct[1];var un=cn.split("_");nt=2<=un.length&&"type"==un[1]?nt+(cn+"=")+Ct+"&":nt+(cn+"=redacted&")}}else nt=null;else nt=Ee;return"XMLHTTP REQ ("+A+") [attempt "+me+"]: "+m+"\n"+g+"\n"+nt})}(l.i,l.u,l.A,l.l,l.R,l.m)}function Gd(l){return!!l.g&&"GET"==l.u&&2!=l.L&&l.j.Ca}function lg(l,m){var g=l.C,A=m.indexOf("\n",g);return-1==A?Jl:(g=Number(m.substring(g,A)),isNaN(g)?Bd:(A+=1)+g>m.length?Jl:(m=m.slice(A,A+g),l.C=A+g,m))}function co(l){l.S=Date.now()+l.I,$d(l,l.I)}function $d(l,m){if(null!=l.B)throw Error("WatchDog timer not null");l.B=Yi(j(l.ba,l),m)}function Zl(l){l.B&&(c.clearTimeout(l.B),l.B=null)}function Xi(l){0==l.j.G||l.J||f_(l.j,l)}function gr(l){Zl(l);var m=l.M;m&&"function"==typeof m.ma&&m.ma(),l.M=null,Pd(l.U),l.g&&(m=l.g,l.g=null,m.abort(),m.ma())}function ec(l,m){try{var g=l.j;if(0!=g.G&&(g.g==l||tc(g.h,l)))if(!l.K&&tc(g.h,l)&&3==g.G){try{var A=g.Da.g.parse(m)}catch{A=null}if(Array.isArray(A)&&3==A.length){var me=A;if(0==me[0]){e:if(!g.u){if(g.g){if(!(g.g.F+3e3<l.F))break e;yo(g),po(g)}sc(g),dn(18)}}else g.za=me[1],0<g.za-g.T&&37500>me[2]&&g.F&&0==g.v&&!g.C&&(g.C=Yi(j(g.Za,g),6e3));if(1>=Wd(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else vr(g,11)}else if((l.K||g.g==l)&&yo(g),!mt(m))for(me=g.Da.g.parse(m),m=0;m<me.length;m++){let Ct=me[m];if(g.T=Ct[0],Ct=Ct[1],2==g.G)if("c"==Ct[0]){g.K=Ct[1],g.ia=Ct[2];const cn=Ct[3];null!=cn&&(g.la=cn,g.j.info("VER="+g.la));const un=Ct[4];null!=un&&(g.Aa=un,g.j.info("SVER="+g.Aa));const ii=Ct[5];null!=ii&&"number"==typeof ii&&0<ii&&(g.L=A=1.5*ii,g.j.info("backChannelRequestTimeoutMs_="+A)),A=g;const vn=l.g;if(vn){const wo=vn.g?vn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wo){var Ee=A.h;Ee.g||-1==wo.indexOf("spdy")&&-1==wo.indexOf("quic")&&-1==wo.indexOf("h2")||(Ee.j=Ee.l,Ee.g=new Set,Ee.h&&(nc(Ee,Ee.h),Ee.h=null))}if(A.D){const ac=vn.g?vn.g.getResponseHeader("X-HTTP-Session-Id"):null;ac&&(A.ya=ac,Dt(A.I,A.D,ac))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-l.F,g.j.info("Handshake RTT: "+g.R+"ms"));var nt=l;if((A=g).qa=y_(A,A.J?A.ia:null,A.W),nt.K){Kd(A.h,nt);var Pt=nt,Ht=A.L;Ht&&(Pt.I=Ht),Pt.B&&(Zl(Pt),co(Pt)),A.g=nt}else __(A);0<g.i.length&&go(g)}else"stop"!=Ct[0]&&"close"!=Ct[0]||vr(g,7);else 3==g.G&&("stop"==Ct[0]||"close"==Ct[0]?"stop"==Ct[0]?vr(g,7):ic(g):"noop"!=Ct[0]&&g.l&&g.l.ta(Ct),g.v=0)}Ki()}catch{}}Xn.prototype.ca=function(l){l=l.target;const m=this.M;m&&3==Dn(l)?m.j():this.Y(l)},Xn.prototype.Y=function(l){try{if(l==this.g)e:{const un=Dn(this.g);var m=this.g.Ba();if(this.g.Z(),!(3>un)&&(3!=un||this.g&&(this.h.h||this.g.oa()||l_(this.g)))){this.J||4!=un||7==m||Ki(),Zl(this);var g=this.g.Z();this.X=g;t:if(Gd(this)){var A=l_(this.g);l="";var me=A.length,Ee=4==Dn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){gr(this),Xi(this);var nt="";break t}this.h.i=new c.TextDecoder}for(m=0;m<me;m++)this.h.h=!0,l+=this.h.i.decode(A[m],{stream:!(Ee&&m==me-1)});A.length=0,this.h.g+=l,this.C=0,nt=this.h.g}else nt=this.g.oa();if(this.o=200==g,function sg(l,m,g,A,me,Ee,nt){l.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+me+"]: "+m+"\n"+g+"\n"+Ee+" "+nt})}(this.i,this.u,this.A,this.l,this.R,un,g),this.o){if(this.T&&!this.K){t:{if(this.g){var Pt,Ht=this.g;if((Pt=Ht.g?Ht.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!mt(Pt)){var Ct=Pt;break t}}Ct=null}if(!(g=Ct)){this.o=!1,this.s=3,dn(12),gr(this),Xi(this);break e}ti(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ec(this,g)}if(this.P){let vn;for(g=!0;!this.J&&this.C<nt.length;){if(vn=lg(this,nt),vn==Jl){4==un&&(this.s=4,dn(14),g=!1),ti(this.i,this.l,null,"[Incomplete Response]");break}if(vn==Bd){this.s=4,dn(15),ti(this.i,this.l,nt,"[Invalid Chunk]"),g=!1;break}ti(this.i,this.l,vn,null),ec(this,vn)}if(Gd(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=un||0!=nt.length||this.h.h||(this.s=1,dn(16),g=!1),this.o=this.o&&g,g){if(0<nt.length&&!this.W){this.W=!0;var cn=this.j;cn.g==this&&cn.ba&&!cn.M&&(cn.j.info("Great, no buffering proxy detected. Bytes received: "+nt.length),oc(cn),cn.M=!0,dn(11))}}else ti(this.i,this.l,nt,"[Invalid Chunked Response]"),gr(this),Xi(this)}else ti(this.i,this.l,nt,null),ec(this,nt);4==un&&gr(this),this.o&&!this.J&&(4==un?f_(this.j,this):(this.o=!1,co(this)))}else(function Ig(l){const m={};l=(l.g&&2<=Dn(l)&&l.g.getAllResponseHeaders()||"").split("\r\n");for(let A=0;A<l.length;A++){if(mt(l[A]))continue;var g=ce(l[A]);const me=g[0];if("string"!=typeof(g=g[1]))continue;g=g.trim();const Ee=m[me]||[];m[me]=Ee,Ee.push(g)}!function se(l,m){for(const g in l)m.call(void 0,l[g],g,l)}(m,function(A){return A.join(", ")})})(this.g),400==g&&0<nt.indexOf("Unknown SID")?(this.s=3,dn(12)):(this.s=0,dn(13)),gr(this),Xi(this)}}}catch{}},Xn.prototype.cancel=function(){this.J=!0,gr(this)},Xn.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(function og(l,m){l.info(function(){return"TIMEOUT: "+m})}(this.i,this.A),2!=this.L&&(Ki(),dn(17)),gr(this),this.s=2,Xi(this)):$d(this,this.S-l)};var cg=class{constructor(l,m){this.g=l,this.map=m}};function Ud(l){this.l=l||10,l=c.PerformanceNavigationTiming?0<(l=c.performance.getEntriesByType("navigation")).length&&("hq"==l[0].nextHopProtocol||"h2"==l[0].nextHopProtocol):!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function qd(l){return!!l.h||!!l.g&&l.g.size>=l.j}function Wd(l){return l.h?1:l.g?l.g.size:0}function tc(l,m){return l.h?l.h==m:!!l.g&&l.g.has(m)}function nc(l,m){l.g?l.g.add(m):l.h=m}function Kd(l,m){l.h&&l.h==m?l.h=null:l.g&&l.g.has(m)&&l.g.delete(m)}function Yd(l){if(null!=l.h)return l.i.concat(l.h.D);if(null!=l.g&&0!==l.g.size){let m=l.i;for(const g of l.g.values())m=m.concat(g.D);return m}return Ke(l.i)}function Qd(l,m){if(l.forEach&&"function"==typeof l.forEach)l.forEach(m,void 0);else if(u(l)||"string"==typeof l)Array.prototype.forEach.call(l,m,void 0);else for(var g=function hg(l){if(l.na&&"function"==typeof l.na)return l.na();if(!l.V||"function"!=typeof l.V){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||"string"==typeof l){var m=[];l=l.length;for(var g=0;g<l;g++)m.push(g);return m}m=[],g=0;for(const A in l)m[g++]=A;return m}}}(l),A=function ug(l){if(l.V&&"function"==typeof l.V)return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if("string"==typeof l)return l.split("");if(u(l)){for(var m=[],g=l.length,A=0;A<g;A++)m.push(l[A]);return m}for(A in m=[],g=0,l)m[g++]=l[A];return m}(l),me=A.length,Ee=0;Ee<me;Ee++)m.call(void 0,A[Ee],g&&g[Ee],l)}Ud.prototype.cancel=function(){if(this.i=Yd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const l of this.g.values())l.cancel();this.g.clear()}};var Xd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yr(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof yr){this.h=l.h,uo(this,l.j),this.o=l.o,this.g=l.g,ho(this,l.s),this.l=l.l;var m=l.i,g=new Zi;g.i=m.i,m.g&&(g.g=new Map(m.g),g.h=m.h),Jd(this,g),this.m=l.m}else l&&(m=String(l).match(Xd))?(this.h=!1,uo(this,m[1]||"",!0),this.o=Ji(m[2]||""),this.g=Ji(m[3]||"",!0),ho(this,m[4]),this.l=Ji(m[5]||"",!0),Jd(this,m[6]||"",!0),this.m=Ji(m[7]||"")):(this.h=!1,this.i=new Zi(null,this.h))}function Mn(l){return new yr(l)}function uo(l,m,g){l.j=g?Ji(m,!0):m,l.j&&(l.j=l.j.replace(/:$/,""))}function ho(l,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);l.s=m}else l.s=null}function Jd(l,m,g){m instanceof Zi?(l.i=m,function yg(l,m){m&&!l.j&&(Jn(l),l.i=null,l.g.forEach(function(g,A){var me=A.toLowerCase();A!=me&&(Zd(this,A),t_(this,me,g))},l)),l.j=m}(l.i,l.h)):(g||(m=Hi(m,pg)),l.i=new Zi(m,l.h))}function Dt(l,m,g){l.i.set(m,g)}function _o(l){return Dt(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Ji(l,m){return l?m?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Hi(l,m,g){return"string"==typeof l?(l=encodeURI(l).replace(m,_g),g&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function _g(l){return"%"+((l=l.charCodeAt(0))>>4&15).toString(16)+(15&l).toString(16)}yr.prototype.toString=function(){var l=[],m=this.j;m&&l.push(Hi(m,Hd,!0),":");var g=this.g;return(g||"file"==m)&&(l.push("//"),(m=this.o)&&l.push(Hi(m,Hd,!0),"@"),l.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(g=this.s)&&l.push(":",String(g))),(g=this.l)&&(this.g&&"/"!=g.charAt(0)&&l.push("/"),l.push(Hi(g,"/"==g.charAt(0)?fg:mg,!0))),(g=this.i.toString())&&l.push("?",g),(g=this.m)&&l.push("#",Hi(g,gg)),l.join("")};var Hd=/[#\/\?@]/g,mg=/[#\?:]/g,fg=/[#\?]/g,pg=/[#\?@]/g,gg=/#/g;function Zi(l,m){this.h=this.g=null,this.i=l||null,this.j=!!m}function Jn(l){l.g||(l.g=new Map,l.h=0,l.i&&function dg(l,m){if(l){l=l.split("&");for(var g=0;g<l.length;g++){var A=l[g].indexOf("="),me=null;if(0<=A){var Ee=l[g].substring(0,A);me=l[g].substring(A+1)}else Ee=l[g];m(Ee,me?decodeURIComponent(me.replace(/\+/g," ")):"")}}}(l.i,function(m,g){l.add(decodeURIComponent(m.replace(/\+/g," ")),g)}))}function Zd(l,m){Jn(l),m=ni(l,m),l.g.has(m)&&(l.i=null,l.h-=l.g.get(m).length,l.g.delete(m))}function e_(l,m){return Jn(l),m=ni(l,m),l.g.has(m)}function t_(l,m,g){Zd(l,m),0<g.length&&(l.i=null,l.g.set(ni(l,m),Ke(g)),l.h+=g.length)}function ni(l,m){return m=String(m),l.j&&(m=m.toLowerCase()),m}function Hn(l,m,g,A,me){try{me&&(me.onload=null,me.onerror=null,me.onabort=null,me.ontimeout=null),A(g)}catch{}}function xg(){this.g=new rg}function Tg(l,m,g){const A=g||"";try{Qd(l,function(me,Ee){let nt=me;f(me)&&(nt=Wl(me)),m.push(A+Ee+"="+encodeURIComponent(nt))})}catch(me){throw m.push(A+"type="+encodeURIComponent("_badmap")),me}}function es(l){this.l=l.Ub||null,this.j=l.eb||!1}function mo(l,m){ln.call(this),this.D=l,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function n_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}function ts(l){l.readyState=4,l.l=null,l.j=null,l.v=null,ns(l)}function ns(l){l.onreadystatechange&&l.onreadystatechange.call(l)}function r_(l){let m="";return yt(l,function(g,A){m+=A,m+=":",m+=g,m+="\r\n"}),m}function rc(l,m,g){e:{for(A in g){var A=!1;break e}A=!0}A||(g=r_(g),"string"==typeof l?null!=g&&encodeURIComponent(String(g)):Dt(l,m,g))}function jt(l){ln.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=Zi.prototype).add=function(l,m){Jn(this),this.i=null,l=ni(this,l);var g=this.g.get(l);return g||this.g.set(l,g=[]),g.push(m),this.h+=1,this},r.forEach=function(l,m){Jn(this),this.g.forEach(function(g,A){g.forEach(function(me){l.call(m,me,A,this)},this)},this)},r.na=function(){Jn(this);const l=Array.from(this.g.values()),m=Array.from(this.g.keys()),g=[];for(let A=0;A<m.length;A++){const me=l[A];for(let Ee=0;Ee<me.length;Ee++)g.push(m[A])}return g},r.V=function(l){Jn(this);let m=[];if("string"==typeof l)e_(this,l)&&(m=m.concat(this.g.get(ni(this,l))));else{l=Array.from(this.g.values());for(let g=0;g<l.length;g++)m=m.concat(l[g])}return m},r.set=function(l,m){return Jn(this),this.i=null,e_(this,l=ni(this,l))&&(this.h-=this.g.get(l).length),this.g.set(l,[m]),this.h+=1,this},r.get=function(l,m){return l&&0<(l=this.V(l)).length?String(l[0]):m},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],m=Array.from(this.g.keys());for(var g=0;g<m.length;g++){var A=m[g];const Ee=encodeURIComponent(String(A)),nt=this.V(A);for(A=0;A<nt.length;A++){var me=Ee;""!==nt[A]&&(me+="="+encodeURIComponent(String(nt[A]))),l.push(me)}}return this.i=l.join("&")},Ve(es,Kl),es.prototype.g=function(){return new mo(this.l,this.j)},es.prototype.i=function(l){return function(){return l}}({}),Ve(mo,ln),(r=mo.prototype).open=function(l,m){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=m,this.readyState=1,ns(this)},r.send=function(l){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(m.body=l),(this.D||c).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ts(this)),this.readyState=0},r.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,ns(this)),this.g&&(this.readyState=3,ns(this),this.g)))if("arraybuffer"===this.responseType)l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;n_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var m=l.value?l.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!l.done}))&&(this.response=this.responseText+=m)}l.done?ts(this):ns(this),3==this.readyState&&n_(this)}},r.Ra=function(l){this.g&&(this.response=this.responseText=l,ts(this))},r.Qa=function(l){this.g&&(this.response=l,ts(this))},r.ga=function(){this.g&&ts(this)},r.setRequestHeader=function(l,m){this.u.append(l,m)},r.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],m=this.h.entries();for(var g=m.next();!g.done;)l.push((g=g.value)[0]+": "+g[1]),g=m.next();return l.join("\r\n")},Object.defineProperty(mo.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(l){this.m=l?"include":"same-origin"}}),Ve(jt,ln);var bg=/^https?$/i,Eg=["POST","PUT"];function i_(l,m){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=m,l.m=5,s_(l),fo(l)}function s_(l){l.A||(l.A=!0,hn(l,"complete"),hn(l,"error"))}function o_(l){if(l.h&&typeof a<"u"&&(!l.v[1]||4!=Dn(l)||2!=l.Z()))if(l.u&&4==Dn(l))Sd(l.Ea,0,l);else if(hn(l,"readystatechange"),4==Dn(l)){l.h=!1;try{const nt=l.Z();e:switch(nt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var g;if(!(g=m)){var A;if(A=0===nt){var me=String(l.D).match(Xd)[1]||null;!me&&c.self&&c.self.location&&(me=c.self.location.protocol.slice(0,-1)),A=!bg.test(me?me.toLowerCase():"")}g=A}if(g)hn(l,"complete"),hn(l,"success");else{l.m=6;try{var Ee=2<Dn(l)?l.g.statusText:""}catch{Ee=""}l.l=Ee+" ["+l.Z()+"]",s_(l)}}finally{fo(l)}}}function fo(l,m){if(l.g){a_(l);const g=l.g,A=l.v[0]?()=>{}:null;l.g=null,l.v=null,m||hn(l,"ready");try{g.onreadystatechange=A}catch{}}}function a_(l){l.I&&(c.clearTimeout(l.I),l.I=null)}function Dn(l){return l.g?l.g.readyState:0}function l_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function rs(l,m,g){return g&&g.internalChannelParams&&g.internalChannelParams[l]||m}function c_(l){this.Aa=0,this.i=[],this.j=new Qi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rs("baseRetryDelayMs",5e3,l),this.cb=rs("retryDelaySeedMs",1e4,l),this.Wa=rs("forwardChannelMaxRetries",2,l),this.wa=rs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Ud(l&&l.concurrentRequestLimit),this.Da=new xg,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function ic(l){if(u_(l),3==l.G){var m=l.U++,g=Mn(l.I);if(Dt(g,"SID",l.K),Dt(g,"RID",m),Dt(g,"TYPE","terminate"),is(l,g),(m=new Xn(l,l.j,m)).L=2,m.v=_o(Mn(g)),g=!1,c.navigator&&c.navigator.sendBeacon)try{g=c.navigator.sendBeacon(m.v.toString(),"")}catch{}!g&&c.Image&&((new Image).src=m.v,g=!0),g||(m.g=v_(m.j,null),m.g.ea(m.v)),m.F=Date.now(),co(m)}g_(l)}function po(l){l.g&&(oc(l),l.g.cancel(),l.g=null)}function u_(l){po(l),l.u&&(c.clearTimeout(l.u),l.u=null),yo(l),l.h.cancel(),l.s&&("number"==typeof l.s&&c.clearTimeout(l.s),l.s=null)}function go(l){if(!qd(l.h)&&!l.s){l.s=!0;var m=l.Ga;Li||Td(),Gi||(Li(),Gi=!0),zl.add(m,l),l.B=0}}function h_(l,m){var g;g=m?m.l:l.U++;const A=Mn(l.I);Dt(A,"SID",l.K),Dt(A,"RID",g),Dt(A,"AID",l.T),is(l,A),l.m&&l.o&&rc(A,l.m,l.o),g=new Xn(l,l.j,g,l.B+1),null===l.m&&(g.H=l.o),m&&(l.i=m.D.concat(l.i)),m=d_(l,g,1e3),g.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),nc(l.h,g),Hl(g,A,m)}function is(l,m){l.H&&yt(l.H,function(g,A){Dt(m,A,g)}),l.l&&Qd({},function(g,A){Dt(m,A,g)})}function d_(l,m,g){g=Math.min(l.i.length,g);var A=l.l?j(l.l.Na,l.l,l):null;e:{var me=l.i;let Ee=-1;for(;;){const nt=["count="+g];-1==Ee?0<g?(Ee=me[0].g,nt.push("ofs="+Ee)):Ee=0:nt.push("ofs="+Ee);let Pt=!0;for(let Ht=0;Ht<g;Ht++){let Ct=me[Ht].g;const cn=me[Ht].map;if(Ct-=Ee,0>Ct)Ee=Math.max(0,me[Ht].g-100),Pt=!1;else try{Tg(cn,nt,"req"+Ct+"_")}catch{A&&A(cn)}}if(Pt){A=nt.join("&");break e}}}return l=l.i.splice(0,g),m.D=l,A}function __(l){if(!l.g&&!l.u){l.Y=1;var m=l.Fa;Li||Td(),Gi||(Li(),Gi=!0),zl.add(m,l),l.v=0}}function sc(l){return!(l.g||l.u||3<=l.v||(l.Y++,l.u=Yi(j(l.Fa,l),p_(l,l.v)),l.v++,0))}function oc(l){null!=l.A&&(c.clearTimeout(l.A),l.A=null)}function m_(l){l.g=new Xn(l,l.j,"rpc",l.Y),null===l.m&&(l.g.H=l.o),l.g.O=0;var m=Mn(l.qa);Dt(m,"RID","rpc"),Dt(m,"SID",l.K),Dt(m,"AID",l.T),Dt(m,"CI",l.F?"0":"1"),!l.F&&l.ja&&Dt(m,"TO",l.ja),Dt(m,"TYPE","xmlhttp"),is(l,m),l.m&&l.o&&rc(m,l.m,l.o),l.L&&(l.g.I=l.L);var g=l.g;l=l.ia,g.L=1,g.v=_o(Mn(m)),g.m=null,g.P=!0,Ld(g,l)}function yo(l){null!=l.C&&(c.clearTimeout(l.C),l.C=null)}function f_(l,m){var g=null;if(l.g==m){yo(l),oc(l),l.g=null;var A=2}else{if(!tc(l.h,m))return;g=m.D,Kd(l.h,m),A=1}if(0!=l.G)if(m.o)if(1==A){g=m.m?m.m.length:0,m=Date.now()-m.F;var me=l.B;hn(A=oo(),new zd(A,g)),go(l)}else __(l);else if(3==(me=m.s)||0==me&&0<m.X||!(1==A&&function Cg(l,m){return!(Wd(l.h)>=l.h.j-(l.s?1:0)||(l.s?(l.i=m.D.concat(l.i),0):1==l.G||2==l.G||l.B>=(l.Va?0:l.Wa)||(l.s=Yi(j(l.Ga,l,m),p_(l,l.B)),l.B++,0)))}(l,m)||2==A&&sc(l)))switch(g&&0<g.length&&(m=l.h,m.i=m.i.concat(g)),me){case 1:vr(l,5);break;case 4:vr(l,10);break;case 3:vr(l,6);break;default:vr(l,2)}}function p_(l,m){let g=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(g*=2),g*m}function vr(l,m){if(l.j.info("Error code "+m),2==m){var g=j(l.fb,l),A=l.Xa;const me=!A;A=new yr(A||"//www.google.com/images/cleardot.gif"),c.location&&"http"==c.location.protocol||uo(A,"https"),_o(A),me?function vg(l,m){const g=new Qi;if(c.Image){const A=new Image;A.onload=_e(Hn,g,"TestLoadImage: loaded",!0,m,A),A.onerror=_e(Hn,g,"TestLoadImage: error",!1,m,A),A.onabort=_e(Hn,g,"TestLoadImage: abort",!1,m,A),A.ontimeout=_e(Hn,g,"TestLoadImage: timeout",!1,m,A),c.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=l}else m(!1)}(A.toString(),g):function wg(l,m){new Qi;const A=new AbortController,me=setTimeout(()=>{A.abort(),Hn(0,0,!1,m)},1e4);fetch(l,{signal:A.signal}).then(Ee=>{clearTimeout(me),Hn(0,0,!!Ee.ok,m)}).catch(()=>{clearTimeout(me),Hn(0,0,!1,m)})}(A.toString(),g)}else dn(2);l.G=0,l.l&&l.l.sa(m),g_(l),u_(l)}function g_(l){if(l.G=0,l.ka=[],l.l){const m=Yd(l.h);(0!=m.length||0!=l.i.length)&&(Ue(l.ka,m),Ue(l.ka,l.i),l.h.i.length=0,Ke(l.i),l.i.length=0),l.l.ra()}}function y_(l,m,g){var A=g instanceof yr?Mn(g):new yr(g);if(""!=A.g)m&&(A.g=m+"."+A.g),ho(A,A.s);else{var me=c.location;A=me.protocol,m=m?m+"."+me.hostname:me.hostname,me=+me.port;var Ee=new yr(null);A&&uo(Ee,A),m&&(Ee.g=m),me&&ho(Ee,me),g&&(Ee.l=g),A=Ee}return m=l.ya,(g=l.D)&&m&&Dt(A,g,m),Dt(A,"VER",l.la),is(l,A),A}function v_(l,m,g){if(m&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return(m=new jt(l.Ca&&!l.pa?new es({eb:g}):l.pa)).Ha(l.J),m}function w_(){}function vo(){}function yn(l,m){ln.call(this),this.g=new c_(m),this.l=l,this.h=m&&m.messageUrlParams||null,l=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(l?l["X-WebChannel-Content-Type"]=m.messageContentType:l={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(l?l["X-WebChannel-Client-Profile"]=m.va:l={"X-WebChannel-Client-Profile":m.va}),this.g.S=l,(l=m&&m.Sb)&&!mt(l)&&(this.g.m=l),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!mt(m)&&(this.g.D=m,null!==(l=this.h)&&m in l&&m in(l=this.h)&&delete l[m]),this.j=new ri(this)}function x_(l){Yl.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var m=l.__sm__;if(m){e:{for(const g in m){l=g;break e}l=void 0}(this.i=l)&&(l=this.i,m=null!==m&&l in m?m[l]:void 0),this.data=m}else this.data=l}function T_(){Ql.call(this),this.status=1}function ri(l){this.g=l}(r=jt.prototype).Ha=function(l){this.J=l},r.ea=function(l,m,g,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);m=m?m.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Xl.g(),this.v=function kd(l){return l.h||(l.h=l.i())}(this.o?this.o:Xl),this.g.onreadystatechange=j(this.Ea,this);try{this.B=!0,this.g.open(m,String(l),!0),this.B=!1}catch(Ee){return void i_(this,Ee)}if(l=g||"",g=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var me in A)g.set(me,A[me]);else{if("function"!=typeof A.keys||"function"!=typeof A.get)throw Error("Unknown input type for opt_headers: "+String(A));for(const Ee of A.keys())g.set(Ee,A.get(Ee))}A=Array.from(g.keys()).find(Ee=>"content-type"==Ee.toLowerCase()),me=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Eg,m,void 0))||A||me||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ee,nt]of g)this.g.setRequestHeader(Ee,nt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{a_(this),this.u=!0,this.g.send(l),this.u=!1}catch(Ee){i_(this,Ee)}},r.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,hn(this,"complete"),hn(this,"abort"),fo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fo(this,!0)),jt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?o_(this):this.bb())},r.bb=function(){o_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Dn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(l){if(this.g){var m=this.g.responseText;return l&&0==m.indexOf(l)&&(m=m.substring(l.length)),ng(m)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=c_.prototype).la=8,r.G=1,r.connect=function(l,m,g,A){dn(0),this.W=l,this.H=m||{},g&&void 0!==A&&(this.H.OSID=g,this.H.OAID=A),this.F=this.X,this.I=y_(this,null,this.W),go(this)},r.Ga=function(l){if(this.s)if(this.s=null,1==this.G){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const me=new Xn(this,this.j,l);let Ee=this.o;if(this.S&&(Ee?(Ee=L(Ee),le(Ee,this.S)):Ee=this.S),null!==this.m||this.O||(me.H=Ee,Ee=null),this.P)e:{for(var m=0,g=0;g<this.i.length;g++){var A=this.i[g];if(void 0===(A="__data__"in A.map&&"string"==typeof(A=A.map.__data__)?A.length:void 0))break;if(4096<(m+=A)){m=g;break e}if(4096===m||g===this.i.length-1){m=g+1;break e}}m=1e3}else m=1e3;m=d_(this,me,m),Dt(g=Mn(this.I),"RID",l),Dt(g,"CVER",22),this.D&&Dt(g,"X-HTTP-Session-Id",this.D),is(this,g),Ee&&(this.O?m="headers="+encodeURIComponent(String(r_(Ee)))+"&"+m:this.m&&rc(g,this.m,Ee)),nc(this.h,me),this.Ua&&Dt(g,"TYPE","init"),this.P?(Dt(g,"$req",m),Dt(g,"SID","null"),me.T=!0,Hl(me,g,null)):Hl(me,g,m),this.G=2}}else 3==this.G&&(l?h_(this,l):0==this.i.length||qd(this.h)||h_(this))},r.Fa=function(){if(this.u=null,m_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Yi(j(this.ab,this),l)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,dn(10),po(this),m_(this))},r.Za=function(){null!=this.C&&(this.C=null,po(this),sc(this),dn(19))},r.fb=function(l){l?(this.j.info("Successfully pinged google.com"),dn(2)):(this.j.info("Failed to ping google.com"),dn(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=w_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},vo.prototype.g=function(l,m){return new yn(l,m)},Ve(yn,ln),yn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},yn.prototype.close=function(){ic(this.g)},yn.prototype.o=function(l){var m=this.g;if("string"==typeof l){var g={};g.__data__=l,l=g}else this.u&&((g={}).__data__=Wl(l),l=g);m.i.push(new cg(m.Ya++,l)),3==m.G&&go(m)},yn.prototype.N=function(){this.g.l=null,delete this.j,ic(this.g),delete this.g,yn.aa.N.call(this)},Ve(x_,Yl),Ve(T_,Ql),Ve(ri,w_),ri.prototype.ua=function(){hn(this.g,"a")},ri.prototype.ta=function(l){hn(this.g,new x_(l))},ri.prototype.sa=function(l){hn(this.g,new T_)},ri.prototype.ra=function(){hn(this.g,"b")},vo.prototype.createWebChannel=vo.prototype.g,yn.prototype.send=yn.prototype.o,yn.prototype.open=yn.prototype.m,yn.prototype.close=yn.prototype.close,Ie=w.createWebChannelTransport=function(){return new vo},Ze=w.getStatEventTarget=function(){return oo()},Oe=w.Event=pr,Be=w.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ao.NO_ERROR=0,ao.TIMEOUT=8,ao.HTTP_ERROR=6,oe=w.ErrorCode=ao,Nd.COMPLETE="complete",re=w.EventType=Nd,Md.EventType=Wi,Wi.OPEN="a",Wi.CLOSE="b",Wi.ERROR="c",Wi.MESSAGE="d",ln.prototype.listen=ln.prototype.K,ne=w.WebChannel=Md,w.FetchXmlHttpFactory=es,jt.prototype.listenOnce=jt.prototype.L,jt.prototype.getLastError=jt.prototype.Ka,jt.prototype.getLastErrorCode=jt.prototype.Ba,jt.prototype.getStatus=jt.prototype.Z,jt.prototype.getResponseJson=jt.prototype.Oa,jt.prototype.getResponseText=jt.prototype.oa,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Ha,D=w.XhrIo=jt}).apply(typeof M<"u"?M:typeof self<"u"?self:typeof window<"u"?window:{});const ct="@firebase/firestore";class it{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}it.UNAUTHENTICATED=new it(null),it.GOOGLE_CREDENTIALS=new it("google-credentials-uid"),it.FIRST_PARTY=new it("first-party-uid"),it.MOCK_USER=new it("mock-user");let Ce="11.0.2";const ve=new N.Vy("@firebase/firestore");function De(){return ve.logLevel}function X(r,...e){if(ve.logLevel<=N.$b.DEBUG){const t=e.map(Pe);ve.debug(`Firestore (${Ce}): ${r}`,...t)}}function be(r,...e){if(ve.logLevel<=N.$b.ERROR){const t=e.map(Pe);ve.error(`Firestore (${Ce}): ${r}`,...t)}}function Ge(r,...e){if(ve.logLevel<=N.$b.WARN){const t=e.map(Pe);ve.warn(`Firestore (${Ce}): ${r}`,...t)}}function Pe(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function Ne(r="Unexpected state"){const e=`FIRESTORE (${Ce}) INTERNAL ASSERTION FAILED: `+r;throw be(e),new Error(e)}function qe(r,e){r||Ne()}function xe(r,e){return r}const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Y extends R.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class et{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Xe{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Qe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(it.UNAUTHENTICATED))}shutdown(){}}class ke{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tt{constructor(e){this.t=e,this.currentUser=it.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;qe(void 0===this.o);let i=this.i;const o=f=>this.i!==i?(i=this.i,t(f)):Promise.resolve();let a=new et;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new et,e.enqueueRetryable(()=>o(this.currentUser))};const c=()=>{const f=a;e.enqueueRetryable((0,T.A)(function*(){yield f.promise,yield o(n.currentUser)}))},u=f=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(f=>u(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?u(f):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new et)}},0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(qe("string"==typeof n.accessToken),new Xe(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return qe(null===e||"string"==typeof e),new it(e)}}class st{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=it.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class rt{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new st(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(it.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class xt{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class de{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){qe(void 0===this.o);const n=o=>{null!=o.error&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.R;return this.R=o.token,X("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>n(o))};const i=o=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?i(o):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(qe("string"==typeof t.token),this.R=t.token,new xt(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Te(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class k{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Te(40);for(let o=0;o<i.length;++o)n.length<20&&i[o]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[o]%62))}return n}}function P(r,e){return r<e?-1:r>e?1:0}function H(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}class Je{static now(){return Je.fromMillis(Date.now())}static fromDate(e){return Je.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Je(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?P(this.nanoseconds,e.nanoseconds):P(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ze{static fromTimestamp(e){return new ze(e)}static min(){return new ze(new Je(0,0))}static max(){return new ze(new Je(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class dt{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ne(),void 0===n?n=e.length-t:n>e.length-t&&Ne(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===dt.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof dt?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const o=e.get(i),a=t.get(i);if(o<a)return-1;if(o>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ae extends dt{construct(e,t,n){return new ae(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Y(F.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new ae(t)}static emptyPath(){return new ae([])}}const at=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Le extends dt{construct(e,t,n){return new Le(e,t,n)}static isValidIdentifier(e){return at.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Le.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Le(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const o=()=>{if(0===n.length)throw new Y(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const c=e[i];if("\\"===c){if(i+1===e.length)throw new Y(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Y(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else"`"===c?(a=!a,i++):"."!==c||a?(n+=c,i++):(o(),i++)}if(o(),a)throw new Y(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Le(t)}static emptyPath(){return new Le([])}}class I{constructor(e){this.path=e}static fromPath(e){return new I(ae.fromString(e))}static fromName(e){return new I(ae.fromString(e).popFirst(5))}static empty(){return new I(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ae.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new I(new ae(e.slice()))}}class ue{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ue(ze.min(),I.empty(),-1)}static max(){return new ue(ze.max(),I.empty(),-1)}}function ye(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=I.comparator(r.documentKey,e.documentKey),0!==t?t:P(r.largestBatchId,e.largestBatchId))}const Re="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class je{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Me(r){return ot.apply(this,arguments)}function ot(){return(ot=(0,T.A)(function*(r){if(r.code!==F.FAILED_PRECONDITION||r.message!==Re)throw r;X("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class ${constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ne(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new $((n,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(n,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof $?t:$.resolve(t)}catch(t){return $.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):$.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):$.reject(t)}static resolve(e){return new $((t,n)=>{t(e)})}static reject(e){return new $((t,n)=>{n(e)})}static waitFor(e){return new $((t,n)=>{let i=0,o=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++o,a&&o===i&&t()},u=>n(u))}),a=!0,o===i&&t()})}static or(e){let t=$.resolve(!1);for(const n of e)t=t.next(i=>i?$.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,o)=>{n.push(t.call(this,i,o))}),this.waitFor(n)}static mapArray(e,t){return new $((n,i)=>{const o=e.length,a=new Array(o);let c=0;for(let u=0;u<o;u++){const f=u;t(e[f]).next(v=>{a[f]=v,++c,c===o&&n(a)},v=>i(v))}})}static doWhile(e,t){return new $((n,i)=>{const o=()=>{!0===e()?t().next(()=>{o()},i):n()};o()})}}function Bt(r){return"IndexedDbTransactionError"===r.name}let U=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function He(r){return null==r}function V(r){return 0===r&&1/r==-1/0}function Kt(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const o=r.charAt(i);switch(o){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=o}}return t}function mn(r){return r+"\x01\x01"}function hc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Vn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function _c(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class kt{constructor(e,t){this.comparator=e,this.root=t||Qt.EMPTY}insert(e,t){return new kt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qt.BLACK,null,null))}remove(e){return new kt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ss(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ss(this.root,e,this.comparator,!1)}getReverseIterator(){return new ss(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ss(this.root,e,this.comparator,!0)}}class ss{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(0===o){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Qt{constructor(e,t,n,i,o){this.key=e,this.value=t,this.color=n??Qt.RED,this.left=i??Qt.EMPTY,this.right=o??Qt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,o){return new Qt(e??this.key,t??this.value,n??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const o=n(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===o?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Qt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Qt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Qt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Qt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ne();const e=this.left.check();if(e!==this.right.check())throw Ne();return e+(this.isRed()?0:1)}}Qt.EMPTY=null,Qt.RED=!0,Qt.BLACK=!1,Qt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ne()}get value(){throw Ne()}get color(){throw Ne()}get left(){throw Ne()}get right(){throw Ne()}copy(e,t,n,i,o){return this}insert(e,t,n){return new Qt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class At{constructor(e){this.comparator=e,this.data=new kt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mc(this.data.getIterator())}getIteratorFrom(e){return new mc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=n.getNext().key;if(0!==this.comparator(i,o))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new At(this.comparator);return t.data=e,t}}class mc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class fn{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new fn([])}unionWith(e){let t=new At(Le.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new fn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return H(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class fc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Nt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new fc("Invalid base64 string: "+o):o}}(e);return new Nt(t)}static fromUint8Array(e){const t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new Nt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return P(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Nt.EMPTY_BYTE_STRING=new Nt("");const L_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function In(r){if(qe(!!r),"string"==typeof r){let e=0;const t=L_.exec(r);if(qe(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ft(r.seconds),nanos:Ft(r.nanos)}}function Ft(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Cn(r){return"string"==typeof r?Nt.fromBase64String(r):Nt.fromUint8Array(r)}function os(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function as(r){const e=r.mapValue.fields.__previous_value__;return os(e)?as(e):e}function si(r){const e=In(r.mapValue.fields.__local_write_time__.timestampValue);return new Je(e.seconds,e.nanos)}class G_{constructor(e,t,n,i,o,a,c,u,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=f}}class Zn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Zn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Zn&&e.projectId===this.projectId&&e.database===this.database}}const zn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Nn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?os(r)?4:wc(r)?9007199254740991:hs(r)?10:11:Ne()}function wn(r,e){if(r===e)return!0;const t=Nn(r);if(t!==Nn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return si(r).isEqual(si(e));case 3:return function(i,o){if("string"==typeof i.timestampValue&&"string"==typeof o.timestampValue&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const a=In(i.timestampValue),c=In(o.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return o=e,Cn(r.bytesValue).isEqual(Cn(o.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,o){return Ft(i.geoPointValue.latitude)===Ft(o.geoPointValue.latitude)&&Ft(i.geoPointValue.longitude)===Ft(o.geoPointValue.longitude)}(r,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return Ft(i.integerValue)===Ft(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const a=Ft(i.doubleValue),c=Ft(o.doubleValue);return a===c?V(a)===V(c):isNaN(a)&&isNaN(c)}return!1}(r,e);case 9:return H(r.arrayValue.values||[],e.arrayValue.values||[],wn);case 10:case 11:return function(i,o){const a=i.mapValue.fields||{},c=o.mapValue.fields||{};if(hc(a)!==hc(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(void 0===c[u]||!wn(a[u],c[u])))return!1;return!0}(r,e);default:return Ne()}var o}function oi(r,e){return void 0!==(r.values||[]).find(t=>wn(t,e))}function jn(r,e){if(r===e)return 0;const t=Nn(r),n=Nn(e);if(t!==n)return P(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return P(r.booleanValue,e.booleanValue);case 2:return function(o,a){const c=Ft(o.integerValue||o.doubleValue),u=Ft(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,e);case 3:return pc(r.timestampValue,e.timestampValue);case 4:return pc(si(r),si(e));case 5:return P(r.stringValue,e.stringValue);case 6:return function(o,a){const c=Cn(o),u=Cn(a);return c.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(o,a){const c=o.split("/"),u=a.split("/");for(let f=0;f<c.length&&f<u.length;f++){const v=P(c[f],u[f]);if(0!==v)return v}return P(c.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(o,a){const c=P(Ft(o.latitude),Ft(a.latitude));return 0!==c?c:P(Ft(o.longitude),Ft(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return gc(r.arrayValue,e.arrayValue);case 10:return function(o,a){var c,u,f,v;const _e=null===(c=(o.fields||{}).value)||void 0===c?void 0:c.arrayValue,Ve=null===(u=(a.fields||{}).value)||void 0===u?void 0:u.arrayValue,Ke=P((null===(f=_e?.values)||void 0===f?void 0:f.length)||0,(null===(v=Ve?.values)||void 0===v?void 0:v.length)||0);return 0!==Ke?Ke:gc(_e,Ve)}(r.mapValue,e.mapValue);case 11:return function(o,a){if(o===zn.mapValue&&a===zn.mapValue)return 0;if(o===zn.mapValue)return 1;if(a===zn.mapValue)return-1;const c=o.fields||{},u=Object.keys(c),f=a.fields||{},v=Object.keys(f);u.sort(),v.sort();for(let C=0;C<u.length&&C<v.length;++C){const j=P(u[C],v[C]);if(0!==j)return j;const _e=jn(c[u[C]],f[v[C]]);if(0!==_e)return _e}return P(u.length,v.length)}(r.mapValue,e.mapValue);default:throw Ne()}}function pc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return P(r,e);const t=In(r),n=In(e),i=P(t.seconds,n.seconds);return 0!==i?i:P(t.nanos,n.nanos)}function gc(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const o=jn(t[i],n[i]);if(o)return o}return P(t.length,n.length)}function Tr(r){return bo(r)}function bo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=In(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Cn(r.bytesValue).toBase64():"referenceValue"in r?I.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const o of t.values||[])i?i=!1:n+=",",n+=bo(o);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",o=!0;for(const a of n)o?o=!1:i+=",",i+=`${a}:${bo(t.fields[a])}`;return i+"}"}(r.mapValue):Ne()}function cs(r){switch(Nn(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=as(r);return e?16+cs(e):16;case 5:return 2*r.stringValue.length;case 6:return Cn(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(r.arrayValue.values||[]).reduce((i,o)=>i+cs(o),0);case 10:case 11:return function(n){let i=0;return Vn(n.fields,(o,a)=>{i+=o.length+cs(a)}),i}(r.mapValue);default:throw Ne()}}function er(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Eo(r){return!!r&&"integerValue"in r}function ai(r){return!!r&&"arrayValue"in r}function yc(r){return!!r&&"nullValue"in r}function vc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function us(r){return!!r&&"mapValue"in r}function hs(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function li(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Vn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=li(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=li(r.arrayValue.values[t]);return e}return Object.assign({},r)}function wc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class Xt{constructor(e){this.value=e}static empty(){return new Xt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!us(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=li(t)}setAll(e){let t=Le.emptyPath(),n={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=c.popLast()}a?n[c.lastSegment()]=li(a):i.push(c.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,n,i)}delete(e){const t=this.field(e.popLast());us(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];us(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Vn(t,(i,o)=>e[i]=o);for(const i of n)delete e[i]}clone(){return new Xt(li(this.value))}}function Ec(r){const e=[];return Vn(r.fields,(t,n)=>{const i=new Le([t]);if(us(n)){const o=Ec(n.mapValue).fields;if(0===o.length)e.push(i);else for(const a of o)e.push(i.child(a))}else e.push(i)}),new fn(e)}class Mt{constructor(e,t,n,i,o,a,c){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=o,this.data=a,this.documentState=c}static newInvalidDocument(e){return new Mt(e,0,ze.min(),ze.min(),ze.min(),Xt.empty(),0)}static newFoundDocument(e,t,n,i){return new Mt(e,1,t,ze.min(),n,i,0)}static newNoDocument(e,t){return new Mt(e,2,t,ze.min(),ze.min(),Xt.empty(),0)}static newUnknownDocument(e,t){return new Mt(e,3,t,ze.min(),ze.min(),Xt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ze.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ze.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bn{constructor(e,t){this.position=e,this.inclusive=t}}function Ic(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const o=e[i],a=r.position[i];if(n=o.field.isKeyField()?I.comparator(I.fromName(a.referenceValue),t.key):jn(a,t.data.field(o.field)),"desc"===o.dir&&(n*=-1),0!==n)break}return n}function Cc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!wn(r.position[t],e.position[t]))return!1;return!0}class ci{constructor(e,t="asc"){this.field=e,this.dir=t}}function q_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Ac{}class Tt extends Ac{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new W_(e,t,n):"array-contains"===t?new Q_(e,n):"in"===t?new Mc(e,n):"not-in"===t?new X_(e,n):"array-contains-any"===t?new J_(e,n):new Tt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new K_(e,n):new Y_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(jn(t,this.value)):null!==t&&Nn(this.value)===Nn(t)&&this.matchesComparison(jn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ne()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class St extends Ac{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new St(e,t)}matches(e){return br(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function br(r){return"and"===r.op}function Co(r){return function Sc(r){for(const e of r.filters)if(e instanceof St)return!1;return!0}(r)&&br(r)}function Ao(r){if(r instanceof Tt)return r.field.canonicalString()+r.op.toString()+Tr(r.value);if(Co(r))return r.filters.map(e=>Ao(e)).join(",");{const e=r.filters.map(t=>Ao(t)).join(",");return`${r.op}(${e})`}}function Rc(r,e){return r instanceof Tt?(n=r,(i=e)instanceof Tt&&n.op===i.op&&n.field.isEqual(i.field)&&wn(n.value,i.value)):r instanceof St?function(n,i){return i instanceof St&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((o,a,c)=>o&&Rc(a,i.filters[c]),!0)}(r,e):void Ne();var n,i}function Pc(r){return r instanceof Tt?`${(t=r).field.canonicalString()} ${t.op} ${Tr(t.value)}`:r instanceof St?function(t){return t.op.toString()+" {"+t.getFilters().map(Pc).join(" ,")+"}"}(r):"Filter";var t}class W_ extends Tt{constructor(e,t,n){super(e,t,n),this.key=I.fromName(n.referenceValue)}matches(e){const t=I.comparator(e.key,this.key);return this.matchesComparison(t)}}class K_ extends Tt{constructor(e,t){super(e,"in",t),this.keys=kc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Y_ extends Tt{constructor(e,t){super(e,"not-in",t),this.keys=kc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function kc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>I.fromName(n.referenceValue))}class Q_ extends Tt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ai(t)&&oi(t.arrayValue,this.value)}}class Mc extends Tt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&oi(this.value.arrayValue,t)}}class X_ extends Tt{constructor(e,t){super(e,"not-in",t)}matches(e){if(oi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!oi(this.value.arrayValue,t)}}class J_ extends Tt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ai(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>oi(this.value.arrayValue,n))}}class H_{constructor(e,t=null,n=[],i=[],o=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=o,this.startAt=a,this.endAt=c,this.ue=null}}function So(r,e=null,t=[],n=[],i=null,o=null,a=null){return new H_(r,e,t,n,i,o,a)}function tr(r){const e=xe(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Ao(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(o=n).field.canonicalString()+o.dir;var o}).join(","),He(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Tr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Tr(n)).join(",")),e.ue=t}return e.ue}function ui(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!q_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Rc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Cc(r.startAt,e.startAt)&&Cc(r.endAt,e.endAt)}function ds(r){return I.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class An{constructor(e,t=null,n=[],i=[],o=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=o,this.limitType=a,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null}}function Er(r){return new An(r)}function zc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Ro(r){return null!==r.collectionGroup}function Ir(r){const e=xe(r);if(null===e.ce){e.ce=[];const t=new Set;for(const o of e.explicitOrderBy)e.ce.push(o),t.add(o.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new At(Le.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(f=>{f.isInequality()&&(c=c.add(f.field))})}),c})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.ce.push(new ci(o,n))}),t.has(Le.keyField().canonicalString())||e.ce.push(new ci(Le.keyField(),n))}return e.ce}function rn(r){const e=xe(r);return e.le||(e.le=function jc(r,e){if("F"===r.limitType)return So(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new ci(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Bn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Bn(r.startAt.position,r.startAt.inclusive):null;return So(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Ir(r))),e.le}function Oo(r,e){const t=r.filters.concat([e]);return new An(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function ms(r,e,t){return new An(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function hi(r,e){return ui(rn(r),rn(e))&&r.limitType===e.limitType}function Bc(r){return`${tr(rn(r))}|lt:${r.limitType}`}function Cr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Pc(i)).join(", ")}]`),He(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Tr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Tr(i)).join(",")),`Target(${n})`}(rn(r))}; limitType=${r.limitType})`}function di(r,e){return e.isFoundDocument()&&function(n,i){const o=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):I.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(r,e)&&function(n,i){for(const o of Ir(n))if(!o.field.isKeyField()&&null===i.data.field(o.field))return!1;return!0}(r,e)&&function(n,i){for(const o of n.filters)if(!o.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,c,u){const f=Ic(a,c,u);return a.inclusive?f<=0:f<0}(n.startAt,Ir(n),i)||n.endAt&&!function(a,c,u){const f=Ic(a,c,u);return a.inclusive?f>=0:f>0}(n.endAt,Ir(n),i)));var n,i}function Gc(r){return(e,t)=>{let n=!1;for(const i of Ir(r)){const o=Z_(i,e,t);if(0!==o)return o;n=n||i.field.isKeyField()}return 0}}function Z_(r,e,t){const n=r.field.isKeyField()?I.comparator(e.key,t.key):function(o,a,c){const u=a.data.field(o),f=c.data.field(o);return null!==u&&null!==f?jn(u,f):Ne()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Ne()}}class Sn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,o]of n)if(this.equalsFn(i,e))return o}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Vn(this.inner,(t,n)=>{for(const[i,o]of n)e(i,o)})}isEmpty(){return _c(this.inner)}size(){return this.innerSize}}const em=new kt(I.comparator);function pn(){return em}const $c=new kt(I.comparator);function _i(...r){let e=$c;for(const t of r)e=e.insert(t.key,t);return e}function Uc(r){let e=$c;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function xn(){return mi()}function qc(){return mi()}function mi(){return new Sn(r=>r.toString(),(r,e)=>r.isEqual(e))}const tm=new kt(I.comparator),nm=new At(I.comparator);function gt(...r){let e=nm;for(const t of r)e=e.add(t);return e}const rm=new At(P);function ko(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:V(e)?"-0":e}}function Wc(r){return{integerValue:""+r}}function Kc(r,e){return function Fe(r){return"number"==typeof r&&Number.isInteger(r)&&!V(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?Wc(e):ko(r,e)}class fs{constructor(){this._=void 0}}function im(r,e,t){return r instanceof Ar?function(i,o){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&os(o)&&(o=as(o)),o&&(a.fields.__previous_value__=o),{mapValue:a}}(t,e):r instanceof nr?Qc(r,e):r instanceof rr?Xc(r,e):function(i,o){const a=Yc(i,o),c=Jc(a)+Jc(i.Pe);return Eo(a)&&Eo(i.Pe)?Wc(c):ko(i.serializer,c)}(r,e)}function sm(r,e,t){return r instanceof nr?Qc(r,e):r instanceof rr?Xc(r,e):t}function Yc(r,e){return r instanceof Sr?Eo(n=e)||(o=n)&&"doubleValue"in o?e:{integerValue:0}:null;var n,o}class Ar extends fs{}class nr extends fs{constructor(e){super(),this.elements=e}}function Qc(r,e){const t=Hc(e);for(const n of r.elements)t.some(i=>wn(i,n))||t.push(n);return{arrayValue:{values:t}}}class rr extends fs{constructor(e){super(),this.elements=e}}function Xc(r,e){let t=Hc(e);for(const n of r.elements)t=t.filter(i=>!wn(i,n));return{arrayValue:{values:t}}}class Sr extends fs{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Jc(r){return Ft(r.integerValue||r.doubleValue)}function Hc(r){return ai(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class am{constructor(e,t){this.version=e,this.transformResults=t}}class Vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Vt}static exists(e){return new Vt(void 0,e)}static updateTime(e){return new Vt(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ps(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class gs{}function Zc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Or(r.key,Vt.none()):new Rr(r.key,r.data,Vt.none());{const t=r.data,n=Xt.empty();let i=new At(Le.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);null===a&&o.length>1&&(o=o.popLast(),a=t.field(o)),null===a?n.delete(o):n.set(o,a),i=i.add(o)}return new Rn(r.key,n,new fn(i.toArray()),Vt.none())}}function lm(r,e,t){r instanceof Rr?function(i,o,a){const c=i.value.clone(),u=nu(i.fieldTransforms,o,a.transformResults);c.setAll(u),o.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):r instanceof Rn?function(i,o,a){if(!ps(i.precondition,o))return void o.convertToUnknownDocument(a.version);const c=nu(i.fieldTransforms,o,a.transformResults),u=o.data;u.setAll(tu(i)),u.setAll(c),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function pi(r,e,t,n){return r instanceof Rr?function(o,a,c,u){if(!ps(o.precondition,a))return c;const f=o.value.clone(),v=ru(o.fieldTransforms,u,a);return f.setAll(v),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(r,e,t,n):r instanceof Rn?function(o,a,c,u){if(!ps(o.precondition,a))return c;const f=ru(o.fieldTransforms,u,a),v=a.data;return v.setAll(tu(o)),v.setAll(f),a.convertToFoundDocument(a.version,v).setHasLocalMutations(),null===c?null:c.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(C=>C.field))}(r,e,t,n):(c=t,ps(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c);var a,c}function cm(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),o=Yc(n.transform,i||null);null!=o&&(null===t&&(t=Xt.empty()),t.set(n.field,o))}return t||null}function eu(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&H(n,i,(o,a)=>function om(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof nr&&i instanceof nr||n instanceof rr&&i instanceof rr?H(n.elements,i.elements,wn):n instanceof Sr&&i instanceof Sr?wn(n.Pe,i.Pe):n instanceof Ar&&i instanceof Ar);var n,i}(o,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Rr extends gs{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Rn extends gs{constructor(e,t,n,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function tu(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function nu(r,e,t){const n=new Map;qe(r.length===t.length);for(let i=0;i<t.length;i++){const o=r[i],a=o.transform,c=e.data.field(o.field);n.set(o.field,sm(a,c,t[i]))}return n}function ru(r,e,t){const n=new Map;for(const i of r){const o=i.transform,a=t.data.field(i.field);n.set(i.field,im(o,a,e))}return n}class Or extends gs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mo extends gs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Do{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&lm(o,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=pi(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=pi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=qc();return this.mutations.forEach(i=>{const o=e.get(i.key),a=o.overlayedDocument;let c=this.applyToLocalView(a,o.mutatedFields);c=t.has(i.key)?null:c;const u=Zc(a,c);null!==u&&n.set(i.key,u),a.isValidDocument()||a.convertToNoDocument(ze.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),gt())}isEqual(e){return this.batchId===e.batchId&&H(this.mutations,e.mutations,(t,n)=>eu(t,n))&&H(this.baseMutations,e.baseMutations,(t,n)=>eu(t,n))}}class Fo{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){qe(e.mutations.length===n.length);let i=function(){return tm}();const o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Fo(e,t,n,i)}}class Vo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class um{constructor(e,t){this.count=e,this.unchangedNames=t}}var $t,Et;function ou(r){if(void 0===r)return be("GRPC error has no .code"),F.UNKNOWN;switch(r){case $t.OK:return F.OK;case $t.CANCELLED:return F.CANCELLED;case $t.UNKNOWN:return F.UNKNOWN;case $t.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case $t.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case $t.INTERNAL:return F.INTERNAL;case $t.UNAVAILABLE:return F.UNAVAILABLE;case $t.UNAUTHENTICATED:return F.UNAUTHENTICATED;case $t.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case $t.NOT_FOUND:return F.NOT_FOUND;case $t.ALREADY_EXISTS:return F.ALREADY_EXISTS;case $t.PERMISSION_DENIED:return F.PERMISSION_DENIED;case $t.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case $t.ABORTED:return F.ABORTED;case $t.OUT_OF_RANGE:return F.OUT_OF_RANGE;case $t.UNIMPLEMENTED:return F.UNIMPLEMENTED;case $t.DATA_LOSS:return F.DATA_LOSS;default:return Ne()}}(Et=$t||($t={}))[Et.OK=0]="OK",Et[Et.CANCELLED=1]="CANCELLED",Et[Et.UNKNOWN=2]="UNKNOWN",Et[Et.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Et[Et.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Et[Et.NOT_FOUND=5]="NOT_FOUND",Et[Et.ALREADY_EXISTS=6]="ALREADY_EXISTS",Et[Et.PERMISSION_DENIED=7]="PERMISSION_DENIED",Et[Et.UNAUTHENTICATED=16]="UNAUTHENTICATED",Et[Et.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Et[Et.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Et[Et.ABORTED=10]="ABORTED",Et[Et.OUT_OF_RANGE=11]="OUT_OF_RANGE",Et[Et.UNIMPLEMENTED=12]="UNIMPLEMENTED",Et[Et.INTERNAL=13]="INTERNAL",Et[Et.UNAVAILABLE=14]="UNAVAILABLE",Et[Et.DATA_LOSS=15]="DATA_LOSS";const hm=new K([4294967295,4294967295],0);function lu(r){const e=function au(){return new TextEncoder}().encode(r),t=new B;return t.update(e),new Uint8Array(t.digest())}function cu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new K([t,n],0),new K([i,o],0)]}class zo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new gi(`Invalid padding: ${t}`);if(n<0)throw new gi(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new gi(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new gi(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=K.fromNumber(this.Te)}Ee(e,t,n){let i=e.add(t.multiply(K.fromNumber(n)));return 1===i.compare(hm)&&(i=new K([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=lu(e),[n,i]=cu(t);for(let o=0;o<this.hashCount;o++){const a=this.Ee(n,i,o);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new zo(o,i,t);return n.forEach(c=>a.insert(c)),a}insert(e){if(0===this.Te)return;const t=lu(e),[n,i]=cu(t);for(let o=0;o<this.hashCount;o++){const a=this.Ee(n,i,o);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class gi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class yi{constructor(e,t,n,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,vi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new yi(ze.min(),i,new kt(P),pn(),gt())}}class vi{constructor(e,t,n,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new vi(n,t,gt(),gt(),gt())}}class vs{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class uu{constructor(e,t){this.targetId=e,this.me=t}}class hu{constructor(e,t,n=Nt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class du{constructor(){this.fe=0,this.ge=_u(),this.pe=Nt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=gt(),t=gt(),n=gt();return this.ge.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Ne()}}),new vi(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=_u()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,qe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class dm{constructor(e){this.Le=e,this.Be=new Map,this.ke=pn(),this.qe=ws(),this.Qe=ws(),this.Ke=new kt(P)}$e(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.je(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.De(e.resumeToken));break;default:Ne()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,n=e.me.count,i=this.Ye(t);if(i){const o=i.target;if(ds(o))if(0===n){const a=new I(o.path);this.We(t,a,Mt.newNoDocument(a,ze.min()))}else qe(1===n);else{const a=this.Ze(t);if(a!==n){const c=this.Xe(e),u=c?this.et(c,e,a):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:o=0}=t;let a,c;try{a=Cn(n).toUint8Array()}catch(u){if(u instanceof fc)return Ge("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new zo(a,i,o)}catch(u){return Ge(u instanceof gi?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===c.Te?null:c}et(e,t,n){return t.me.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(o=>{const a=this.Le.nt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(c)||(this.We(t,o,null),i++)}),i}it(e){const t=new Map;this.Be.forEach((o,a)=>{const c=this.Ye(a);if(c){if(o.current&&ds(c.target)){const u=new I(c.target.path);this.st(u).has(a)||this.ot(a,u)||this.We(a,u,Mt.newNoDocument(u,e))}o.be&&(t.set(a,o.ve()),o.Ce())}});let n=gt();this.Qe.forEach((o,a)=>{let c=!0;a.forEachWhile(u=>{const f=this.Ye(u);return!f||"TargetPurposeLimboResolution"===f.purpose||(c=!1,!1)}),c&&(n=n.add(o))}),this.ke.forEach((o,a)=>a.setReadTime(e));const i=new yi(e,t,this.Ke,this.ke,n);return this.ke=pn(),this.qe=ws(),this.Qe=ws(),this.Ke=new kt(P),i}Ue(e,t){if(!this.je(e))return;const n=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const i=this.ze(e);this.ot(e,t)?i.Fe(t,1):i.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Be.get(e);return t||(t=new du,this.Be.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new At(P),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new At(P),this.qe=this.qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||X("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ut(e)}He(e){this.Be.set(e,new du),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ws(){return new kt(I.comparator)}function _u(){return new kt(I.comparator)}const _m={asc:"ASCENDING",desc:"DESCENDING"},mm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fm={and:"AND",or:"OR"};class pm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function No(r,e){return r.useProto3Json||He(e)?e:{value:e}}function Pr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mu(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function gm(r,e){return Pr(r,e.toTimestamp())}function Lt(r){return qe(!!r),ze.fromTimestamp(function(t){const n=In(t);return new Je(n.seconds,n.nanos)}(r))}function jo(r,e){return Bo(r,e).canonicalString()}function Bo(r,e){const t=(i=r,new ae(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function fu(r){const e=ae.fromString(r);return qe(Cu(e)),e}function wi(r,e){return jo(r.databaseId,e.path)}function Tn(r,e){const t=fu(e);if(t.get(1)!==r.databaseId.projectId)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new I(yu(t))}function pu(r,e){return jo(r.databaseId,e)}function Lo(r){return new ae(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function yu(r){return qe(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function vu(r,e,t){return{name:wi(r,e),fields:t.value.mapValue.fields}}function xu(r,e){return{documents:[pu(r,e.path)]}}function xs(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=pu(r,i);const o=function(f){if(0!==f.length)return Iu(St.create(f,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const a=function(f){if(0!==f.length)return f.map(v=>{return{field:Ln((j=v).field),direction:Tm(j.dir)};var j})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=No(r,e.limit);return null!==c&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt={before:(f=e.startAt).inclusive,values:f.position}),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{ct:t,parent:i};var f}function bu(r){let e=function gu(r){const e=fu(r);return 4===e.length?ae.emptyPath():yu(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){qe(1===n);const v=t.from[0];v.allDescendants?i=v.collectionId:e=e.child(v.collectionId)}let o=[];t.where&&(o=function(C){const j=Eu(C);return j instanceof St&&Co(j)?j.getFilters():[j]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(j=>{return new ci(kr((Ve=j).field),function(Ue){switch(Ue){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Ve.direction));var Ve}));let c=null;t.limit&&(c=function(C){let j;return j="object"==typeof C?C.value:C,He(j)?null:j}(t.limit));let u=null;var C;t.startAt&&(u=new Bn((C=t.startAt).values||[],!!C.before));let f=null;return t.endAt&&(f=function(C){return new Bn(C.values||[],!C.before)}(t.endAt)),function Vc(r,e,t,n,i,o,a,c){return new An(r,e,t,n,i,o,a,c)}(e,i,a,o,c,"F",u,f)}function Eu(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=kr(t.unaryFilter.field);return Tt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=kr(t.unaryFilter.field);return Tt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=kr(t.unaryFilter.field);return Tt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=kr(t.unaryFilter.field);return Tt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return Ne()}}(r):void 0!==r.fieldFilter?Tt.create(kr((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ne()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return St.create(t.compositeFilter.filters.map(n=>Eu(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ne()}}(t.compositeFilter.op))}(r):Ne();var t}function Tm(r){return _m[r]}function bm(r){return mm[r]}function Em(r){return fm[r]}function Ln(r){return{fieldPath:r.canonicalString()}}function kr(r){return Le.fromServerFormat(r.fieldPath)}function Iu(r){return r instanceof Tt?function(t){if("=="===t.op){if(vc(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NAN"}};if(yc(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(vc(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NAN"}};if(yc(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ln(t.field),op:bm(t.op),value:t.value}}}(r):r instanceof St?function(t){const n=t.getFilters().map(i=>Iu(i));return 1===n.length?n[0]:{compositeFilter:{op:Em(t.op),filters:n}}}(r):Ne()}function Im(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Cu(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class On{constructor(e,t,n,i,o=ze.min(),a=ze.min(),c=Nt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new On(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new On(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new On(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new On(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Au{constructor(e){this.ht=e}}function $o(r){const e=bu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?ms(e,e.limit,"L"):e}class ar{constructor(){}Et(e,t){this.dt(e,t),t.At()}dt(e,t){if("nullValue"in e)this.Rt(t,5);else if("booleanValue"in e)this.Rt(t,10),t.Vt(e.booleanValue?1:0);else if("integerValue"in e)this.Rt(t,15),t.Vt(Ft(e.integerValue));else if("doubleValue"in e){const n=Ft(e.doubleValue);isNaN(n)?this.Rt(t,13):(this.Rt(t,15),V(n)?t.Vt(0):t.Vt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Rt(t,20),"string"==typeof n&&(n=In(n)),t.ft(`${n.seconds||""}`),t.Vt(n.nanos||0)}else if("stringValue"in e)this.gt(e.stringValue,t),this.yt(t);else if("bytesValue"in e)this.Rt(t,30),t.wt(Cn(e.bytesValue)),this.yt(t);else if("referenceValue"in e)this.St(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Rt(t,45),t.Vt(n.latitude||0),t.Vt(n.longitude||0)}else"mapValue"in e?wc(e)?this.Rt(t,Number.MAX_SAFE_INTEGER):hs(e)?this.bt(e.mapValue,t):(this.Dt(e.mapValue,t),this.yt(t)):"arrayValue"in e?(this.vt(e.arrayValue,t),this.yt(t)):Ne()}gt(e,t){this.Rt(t,25),this.Ct(e,t)}Ct(e,t){t.ft(e)}Dt(e,t){const n=e.fields||{};this.Rt(t,55);for(const i of Object.keys(n))this.gt(i,t),this.dt(n[i],t)}bt(e,t){var n,i;const o=e.fields||{};this.Rt(t,53);const a="value",c=(null===(i=null===(n=o[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.Rt(t,15),t.Vt(Ft(c)),this.gt(a,t),this.dt(o[a],t)}vt(e,t){const n=e.values||[];this.Rt(t,50);for(const i of n)this.dt(i,t)}St(e,t){this.Rt(t,37),I.fromName(e).path.forEach(n=>{this.Rt(t,60),this.Ct(n,t)})}Rt(e,t){e.Vt(t)}yt(e){e.Vt(2)}}ar.Ft=new ar;class Dm{constructor(){this.ln=new Qo}addToCollectionParentIndex(e,t){return this.ln.add(t),$.resolve()}getCollectionParents(e,t){return $.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return $.resolve()}deleteFieldIndex(e,t){return $.resolve()}deleteAllFieldIndexes(e){return $.resolve()}createTargetIndexes(e,t){return $.resolve()}getDocumentsMatchingTarget(e,t){return $.resolve(null)}getIndexType(e,t){return $.resolve(0)}getFieldIndexes(e,t){return $.resolve([])}getNextCollectionGroupToUpdate(e){return $.resolve(null)}getMinOffset(e,t){return $.resolve(ue.min())}getMinOffsetFromCollectionGroup(e,t){return $.resolve(ue.min())}updateCollectionGroup(e,t,n){return $.resolve()}updateIndexEntries(e,t){return $.resolve()}}class Qo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new At(ae.comparator),o=!i.has(n);return this.index[t]=i.add(n),o}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new At(ae.comparator)).toArray()}}new Uint8Array(0);const Gu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sn{static withCacheSize(e){return new sn(e,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}sn.DEFAULT_COLLECTION_PERCENTILE=10,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sn.DEFAULT=new sn(41943040,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sn.DISABLED=new sn(-1,0,0);class cr{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new cr(0)}static Qn(){return new cr(-1)}}function Ku([r,e],[t,n]){const i=P(r,t);return 0===i?P(e,n):i}class zm{constructor(e){this.Gn=e,this.buffer=new At(Ku),this.zn=0}jn(){return++this.zn}Hn(e){const t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Ku(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Yu{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return null!==this.Jn}Yn(e){var t=this;X("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,T.A)(function*(){t.Jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){Bt(n)?X("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Me(n)}yield t.Yn(3e5)}))}}class Nm{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return $.resolve(U.oe);const n=new zm(t);return this.Zn.forEachTarget(e,i=>n.Hn(i.sequenceNumber)).next(()=>this.Zn.er(e,i=>n.Hn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Zn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector","Garbage collection skipped; disabled"),$.resolve(Gu)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Gu):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let n,i,o,a,c,u,f;const v=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(C=>(C>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${C}`),i=this.params.maximumSequenceNumbersToCollect):i=C,a=Date.now(),this.nthSequenceNumber(e,i))).next(C=>(n=C,c=Date.now(),this.removeTargets(e,n,t))).next(C=>(o=C,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(C=>(f=Date.now(),De()<=N.$b.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-v}ms\n\tDetermined least recently used ${i} in `+(c-a)+`ms\n\tRemoved ${o} targets in `+(u-c)+`ms\n\tRemoved ${C} documents in `+(f-u)+`ms\nTotal Duration: ${f-v}ms`),$.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:C})))}}class Xu{constructor(){this.changes=new Sn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Mt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?$.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Gm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class th{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&pi(n.mutation,i,fn.empty(),Je.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,gt()).next(()=>n))}getLocalViewOfDocuments(e,t,n=gt()){const i=xn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(o=>{let a=_i();return o.forEach((c,u)=>{a=a.insert(c,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=xn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,gt()))}populateOverlays(e,t,n){const i=[];return n.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,n,i){let o=pn();const a=mi(),c=mi();return t.forEach((u,f)=>{const v=n.get(f.key);i.has(f.key)&&(void 0===v||v.mutation instanceof Rn)?o=o.insert(f.key,f):void 0!==v?(a.set(f.key,v.mutation.getFieldMask()),pi(v.mutation,f,v.mutation.getFieldMask(),Je.now())):a.set(f.key,fn.empty())}),this.recalculateAndSaveOverlays(e,o).next(u=>(u.forEach((f,v)=>a.set(f,v)),t.forEach((f,v)=>{var C;return c.set(f,new Gm(v,null!==(C=a.get(f))&&void 0!==C?C:null))}),c))}recalculateAndSaveOverlays(e,t){const n=mi();let i=new kt((a,c)=>a-c),o=gt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const c of a)c.keys().forEach(u=>{const f=t.get(u);if(null===f)return;let v=n.get(u)||fn.empty();v=c.applyToLocalView(f,v),n.set(u,v);const C=(i.get(c.batchId)||gt()).add(u);i=i.insert(c.batchId,C)})}).next(()=>{const a=[],c=i.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),f=u.key,v=u.value,C=qc();v.forEach(j=>{if(!o.has(j)){const _e=Zc(t.get(j),n.get(j));null!==_e&&C.set(j,_e),o=o.add(j)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,C))}return $.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return I.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ro(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(o=>{const a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-o.size):$.resolve(xn());let c=-1,u=o;return a.next(f=>$.forEach(f,(v,C)=>(c<C.largestBatchId&&(c=C.largestBatchId),o.get(v)?$.resolve():this.remoteDocumentCache.getEntry(e,v).next(j=>{u=u.insert(v,j)}))).next(()=>this.populateOverlays(e,f,o)).next(()=>this.computeViews(e,u,f,gt())).next(v=>({batchId:c,changes:Uc(v)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new I(t)).next(n=>{let i=_i();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const o=t.collectionGroup;let a=_i();return this.indexManager.getCollectionParents(e,o).next(c=>$.forEach(c,u=>{const f=(C=t,j=u.child(o),new An(j,null,C.explicitOrderBy.slice(),C.filters.slice(),C.limit,C.limitType,C.startAt,C.endAt));var C,j;return this.getDocumentsMatchingCollectionQuery(e,f,n,i).next(v=>{v.forEach((C,j)=>{a=a.insert(C,j)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,o,i))).next(a=>{o.forEach((u,f)=>{const v=f.getKey();null===a.get(v)&&(a=a.insert(v,Mt.newInvalidDocument(v)))});let c=_i();return a.forEach((u,f)=>{const v=o.get(u);void 0!==v&&pi(v.mutation,f,fn.empty(),Je.now()),di(t,f)&&(c=c.insert(u,f))}),c})}}class $m{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return $.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,{id:(i=t).id,version:i.version,createTime:Lt(i.createTime)}),$.resolve();var i}getNamedQuery(e,t){return $.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,{name:(i=t).name,query:$o(i.bundledQuery),readTime:Lt(i.readTime)}),$.resolve();var i}}class Um{constructor(){this.overlays=new kt(I.comparator),this.Er=new Map}getOverlay(e,t){return $.resolve(this.overlays.get(t))}getOverlays(e,t){const n=xn();return $.forEach(t,i=>this.getOverlay(e,i).next(o=>{null!==o&&n.set(i,o)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,o)=>{this.Tt(e,t,o)}),$.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Er.get(n);return void 0!==i&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Er.delete(n)),$.resolve()}getOverlaysForCollection(e,t,n){const i=xn(),o=t.length+1,a=new I(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,f=u.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&u.largestBatchId>n&&i.set(u.getKey(),u)}return $.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let o=new kt((f,v)=>f-v);const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>n){let v=o.get(f.largestBatchId);null===v&&(v=xn(),o=o.insert(f.largestBatchId,v)),v.set(f.getKey(),f)}}const c=xn(),u=o.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((f,v)=>c.set(f,v)),!(c.size()>=i)););return $.resolve(c)}Tt(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.Er.get(i.largestBatchId).delete(n.key);this.Er.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Vo(t,n));let o=this.Er.get(t);void 0===o&&(o=gt(),this.Er.set(t,o)),this.Er.set(t,o.add(n.key))}}class qm{constructor(){this.sessionToken=Nt.EMPTY_BYTE_STRING}getSessionToken(e){return $.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,$.resolve()}}class Xo{constructor(){this.dr=new At(Yt.Ar),this.Rr=new At(Yt.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(e,t){const n=new Yt(e,t);this.dr=this.dr.add(n),this.Rr=this.Rr.add(n)}mr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.gr(new Yt(e,t))}pr(e,t){e.forEach(n=>this.removeReference(n,t))}yr(e){const t=new I(new ae([])),n=new Yt(t,e),i=new Yt(t,e+1),o=[];return this.Rr.forEachInRange([n,i],a=>{this.gr(a),o.push(a.key)}),o}wr(){this.dr.forEach(e=>this.gr(e))}gr(e){this.dr=this.dr.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const t=new I(new ae([])),n=new Yt(t,e),i=new Yt(t,e+1);let o=gt();return this.Rr.forEachInRange([n,i],a=>{o=o.add(a.key)}),o}containsKey(e){const t=new Yt(e,0),n=this.dr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Yt{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return I.comparator(e.key,t.key)||P(e.br,t.br)}static Vr(e,t){return P(e.br,t.br)||I.comparator(e.key,t.key)}}class Wm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new At(Yt.Ar)}checkEmpty(e){return $.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const o=this.Dr;this.Dr++;const a=new Do(o,t,n,i);this.mutationQueue.push(a);for(const c of i)this.vr=this.vr.add(new Yt(c.key,o)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return $.resolve(a)}lookupMutationBatch(e,t){return $.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Fr(t+1),o=i<0?0:i;return $.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return $.resolve(0===this.mutationQueue.length?-1:this.Dr-1)}getAllMutationBatches(e){return $.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Yt(t,0),i=new Yt(t,Number.POSITIVE_INFINITY),o=[];return this.vr.forEachInRange([n,i],a=>{const c=this.Cr(a.br);o.push(c)}),$.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new At(P);return t.forEach(i=>{const o=new Yt(i,0),a=new Yt(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([o,a],c=>{n=n.add(c.br)})}),$.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let o=n;I.isDocumentKey(o)||(o=o.child(""));const a=new Yt(new I(o),0);let c=new At(P);return this.vr.forEachWhile(u=>{const f=u.key.path;return!!n.isPrefixOf(f)&&(f.length===i&&(c=c.add(u.br)),!0)},a),$.resolve(this.Mr(c))}Mr(e){const t=[];return e.forEach(n=>{const i=this.Cr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){qe(0===this.Or(t.batchId,"removed")),this.mutationQueue.shift();let n=this.vr;return $.forEach(t.mutations,i=>{const o=new Yt(i.key,t.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.vr=n})}Ln(e){}containsKey(e,t){const n=new Yt(t,0),i=this.vr.firstAfterOrEqual(n);return $.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return $.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Cr(e){const t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Km{constructor(e){this.Nr=e,this.docs=new kt(I.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),o=i?i.size:0,a=this.Nr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return $.resolve(n?n.document.mutableCopy():Mt.newInvalidDocument(t))}getEntries(e,t){let n=pn();return t.forEach(i=>{const o=this.docs.get(i);n=n.insert(i,o?o.document.mutableCopy():Mt.newInvalidDocument(i))}),$.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let o=pn();const a=t.path,c=new I(a.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:f,value:{document:v}}=u.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||ye(new ue((r=v).readTime,r.key,-1),n)<=0||(i.has(v.key)||di(t,v))&&(o=o.insert(v.key,v.mutableCopy()))}var r;return $.resolve(o)}getAllFromCollectionGroup(e,t,n,i){Ne()}Lr(e,t){return $.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Ym(this)}getSize(e){return $.resolve(this.size)}}class Ym extends Xu{constructor(e){super(),this.hr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.hr.addEntry(e,i)):this.hr.removeEntry(n)}),$.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}}class Qm{constructor(e){this.persistence=e,this.Br=new Sn(t=>tr(t),ui),this.lastRemoteSnapshotVersion=ze.min(),this.highestTargetId=0,this.kr=0,this.qr=new Xo,this.targetCount=0,this.Qr=cr.qn()}forEachTarget(e,t){return this.Br.forEach((n,i)=>t(i)),$.resolve()}getLastRemoteSnapshotVersion(e){return $.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),$.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.kr&&(this.kr=t),$.resolve()}Un(e){this.Br.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Qr=new cr(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,$.resolve()}updateTargetData(e,t){return this.Un(t),$.resolve()}removeTargetData(e,t){return this.Br.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,$.resolve()}removeTargets(e,t,n){let i=0;const o=[];return this.Br.forEach((a,c)=>{c.sequenceNumber<=t&&null===n.get(c.targetId)&&(this.Br.delete(a),o.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),$.waitFor(o).next(()=>i)}getTargetCount(e){return $.resolve(this.targetCount)}getTargetData(e,t){const n=this.Br.get(t)||null;return $.resolve(n)}addMatchingKeys(e,t,n){return this.qr.mr(t,n),$.resolve()}removeMatchingKeys(e,t,n){this.qr.pr(t,n);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),$.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),$.resolve()}getMatchingKeysForTargetId(e,t){const n=this.qr.Sr(t);return $.resolve(n)}containsKey(e,t){return $.resolve(this.qr.containsKey(t))}}class Jo{constructor(e,t){this.Kr={},this.overlays={},this.$r=new U(0),this.Ur=!1,this.Ur=!0,this.Wr=new qm,this.referenceDelegate=e(this),this.Gr=new Qm(this),this.indexManager=new Dm,this.remoteDocumentCache=new Km(n=>this.referenceDelegate.zr(n)),this.serializer=new Au(t),this.jr=new $m(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Um,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Kr[e.toKey()];return n||(n=new Wm(t,this.referenceDelegate),this.Kr[e.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,n){X("MemoryPersistence","Starting transaction:",e);const i=new Xm(this.$r.next());return this.referenceDelegate.Hr(),n(i).next(o=>this.referenceDelegate.Jr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Yr(e,t){return $.or(Object.values(this.Kr).map(n=>()=>n.containsKey(e,t)))}}class Xm extends je{constructor(e){super(),this.currentSequenceNumber=e}}class Rs{constructor(e){this.persistence=e,this.Zr=new Xo,this.Xr=null}static ei(e){return new Rs(e)}get ti(){if(this.Xr)return this.Xr;throw Ne()}addReference(e,t,n){return this.Zr.addReference(n,t),this.ti.delete(n.toString()),$.resolve()}removeReference(e,t,n){return this.Zr.removeReference(n,t),this.ti.add(n.toString()),$.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),$.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(i=>this.ti.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.ti.add(o.toString()))}).next(()=>n.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $.forEach(this.ti,n=>{const i=I.fromPath(n);return this.ni(e,i).next(o=>{o||t.removeEntry(i,ze.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(n=>{n?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return $.or([()=>$.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}}class Os{constructor(e,t){this.persistence=e,this.ri=new Sn(n=>function Ye(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=mn(e)),e=Kt(r.get(t),e);return mn(e)}(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=function Qu(r,e){return new Nm(r,e)}(this,t)}static ei(e,t){return new Os(e,t)}Hr(){}Jr(e){return $.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){const t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}nr(e){let t=0;return this.er(e,n=>{t++}).next(()=>t)}er(e,t){return $.forEach(this.ri,(n,i)=>this.ir(e,n,i).next(o=>o?$.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.Lr(e,a=>this.ir(e,a,t).next(c=>{c||(n++,o.removeEntry(a,ze.min()))})).next(()=>o.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),$.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),$.resolve()}removeReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),$.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),$.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=cs(e.data.value)),t}ir(e,t,n){return $.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.ri.get(t);return $.resolve(void 0!==i&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ta{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Wi=n,this.Gi=i}static zi(e,t){let n=gt(),i=gt();for(const o of t.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new ta(e,t.fromCache,n,i)}}class Hm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class rh{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=(0,R.nr)()?8:function vt(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,R.ZQ)())>0?6:4}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,n,i){const o={result:null};return this.Xi(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.es(e,t,i,n).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new Hm;return this.ts(e,t,a).next(c=>{if(o.result=c,this.Hi)return this.ns(e,t,a,c.size)})}).next(()=>o.result)}ns(e,t,n,i){return n.documentReadCount<this.Ji?(De()<=N.$b.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",Cr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),$.resolve()):(De()<=N.$b.DEBUG&&X("QueryEngine","Query:",Cr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Yi*i?(De()<=N.$b.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",Cr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rn(t))):$.resolve())}Xi(e,t){if(zc(t))return $.resolve(null);let n=rn(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=ms(t,null,"F"),n=rn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(o=>{const a=gt(...o);return this.Zi.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{const f=this.rs(t,c);return this.ss(t,f,a,u.readTime)?this.Xi(e,ms(t,null,"F")):this.os(e,f,t,u)}))})))}es(e,t,n,i){return zc(t)||i.isEqual(ze.min())?$.resolve(null):this.Zi.getDocuments(e,n).next(o=>{const a=this.rs(t,o);return this.ss(t,a,n,i)?$.resolve(null):(De()<=N.$b.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Cr(t)),this.os(e,a,t,function pe(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=ze.fromTimestamp(1e9===n?new Je(t+1,0):new Je(t,n));return new ue(i,I.empty(),e)}(i,-1)).next(c=>c))})}rs(e,t){let n=new At(Gc(e));return t.forEach((i,o)=>{di(e,o)&&(n=n.add(o))}),n}ss(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const o="F"===e.limitType?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ts(e,t,n){return De()<=N.$b.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",Cr(t)),this.Zi.getDocumentsMatchingQuery(e,t,ue.min(),n)}os(e,t,n,i){return this.Zi.getDocumentsMatchingQuery(e,n,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}}class Zm{constructor(e,t,n,i){this.persistence=e,this._s=t,this.serializer=i,this.us=new kt(P),this.cs=new Sn(o=>tr(o),ui),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(n)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new th(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}}function sh(r,e){return na.apply(this,arguments)}function na(){return(na=(0,T.A)(function*(r,e){const t=xe(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(o=>(i=o,t.Ps(e),t.mutationQueue.getAllMutationBatches(n))).next(o=>{const a=[],c=[];let u=gt();for(const f of i){a.push(f.batchId);for(const v of f.mutations)u=u.add(v.key)}for(const f of o){c.push(f.batchId);for(const v of f.mutations)u=u.add(v.key)}return t.localDocuments.getDocuments(n,u).next(f=>({Ts:f,removedBatchIds:a,addedBatchIds:c}))})})})).apply(this,arguments)}function oh(r){const e=xe(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function nf(r,e){const t=xe(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Nr(r,e,t){return ra.apply(this,arguments)}function ra(){return(ra=(0,T.A)(function*(r,e,t){const n=xe(r),i=n.us.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",o,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Bt(a))throw a;X("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.us=n.us.remove(e),n.cs.delete(i.target)})).apply(this,arguments)}function ks(r,e,t){const n=xe(r);let i=ze.min(),o=gt();return n.persistence.runTransaction("Execute query","readwrite",a=>function(u,f,v){const C=xe(u),j=C.cs.get(v);return void 0!==j?$.resolve(C.us.get(j)):C.Gr.getTargetData(f,v)}(n,a,rn(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,n.Gr.getMatchingKeysForTargetId(a,c.targetId).next(u=>{o=u})}).next(()=>n._s.getDocumentsMatchingQuery(a,e,t?i:ze.min(),t?o:gt())).next(c=>(function uh(r,e,t){let n=r.ls.get(e)||ze.min();t.forEach((i,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),r.ls.set(e,n)}(n,function Lc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),c),{documents:c,ds:o})))}class la{constructor(){this.activeTargetIds=function Po(){return rm}()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _h{constructor(){this._o=new la,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,n){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new la,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class of{uo(e){}shutdown(){}}class mh{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){X("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){X("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Fs=null;function ua(){return null===Fs?Fs=268435456+Math.round(2147483648*Math.random()):Fs++,"0x"+Fs.toString(16)}const af={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lf{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}const on="WebChannelConnection";class cf extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Fo=n+"://"+t.host,this.Mo=`projects/${i}/databases/${o}`,this.xo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${o}`}Oo(t,n,i,o,a){const c=ua(),u=this.No(t,n.toUriEncodedString());X("RestConnection",`Sending RPC '${t}' ${c}:`,u,i);const f={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(f,o,a),this.Bo(t,u,f,i).then(v=>(X("RestConnection",`Received RPC '${t}' ${c}: `,v),v),v=>{throw Ge("RestConnection",`RPC '${t}' ${c} failed with error: `,v,"url: ",u,"request:",i),v})}ko(t,n,i,o,a,c){return this.Oo(t,n,i,o,a)}Lo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ce,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((o,a)=>t[a]=o),i&&i.headers.forEach((o,a)=>t[a]=o)}No(t,n){return`${this.Fo}/v1/${n}:${af[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Bo(e,t,n,i){const o=ua();return new Promise((a,c)=>{const u=new D;u.setWithCredentials(!0),u.listenOnce(re.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case oe.NO_ERROR:const v=u.getResponseJson();X(on,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(v)),a(v);break;case oe.TIMEOUT:X(on,`RPC '${e}' ${o} timed out`),c(new Y(F.DEADLINE_EXCEEDED,"Request time out"));break;case oe.HTTP_ERROR:const C=u.getStatus();if(X(on,`RPC '${e}' ${o} failed with status:`,C,"response text:",u.getResponseText()),C>0){let j=u.getResponseJson();Array.isArray(j)&&(j=j[0]);const _e=j?.error;if(_e&&_e.status&&_e.message){const Ve=function(Ue){const lt=Ue.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(lt)>=0?lt:F.UNKNOWN}(_e.status);c(new Y(Ve,_e.message))}else c(new Y(F.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new Y(F.UNAVAILABLE,"Connection failed."));break;default:Ne()}}finally{X(on,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(i);X(on,`RPC '${e}' ${o} sending request:`,i),u.send(t,"POST",f,n,15)})}qo(e,t,n){const i=ua(),o=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ie(),c=Ze(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(u.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Lo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const v=o.join("");X(on,`Creating RPC '${e}' stream ${i}: ${v}`,u);const C=a.createWebChannel(v,u);let j=!1,_e=!1;const Ve=new lf({Eo:Ue=>{_e?X(on,`Not sending because RPC '${e}' stream ${i} is closed:`,Ue):(j||(X(on,`Opening RPC '${e}' stream ${i} transport.`),C.open(),j=!0),X(on,`RPC '${e}' stream ${i} sending:`,Ue),C.send(Ue))},Ao:()=>C.close()}),Ke=(Ue,lt,mt)=>{Ue.listen(lt,ht=>{try{mt(ht)}catch(pt){setTimeout(()=>{throw pt},0)}})};return Ke(C,ne.EventType.OPEN,()=>{_e||(X(on,`RPC '${e}' stream ${i} transport opened.`),Ve.So())}),Ke(C,ne.EventType.CLOSE,()=>{_e||(_e=!0,X(on,`RPC '${e}' stream ${i} transport closed`),Ve.Do())}),Ke(C,ne.EventType.ERROR,Ue=>{_e||(_e=!0,Ge(on,`RPC '${e}' stream ${i} transport errored:`,Ue),Ve.Do(new Y(F.UNAVAILABLE,"The operation could not be completed")))}),Ke(C,ne.EventType.MESSAGE,Ue=>{var lt;if(!_e){const mt=Ue.data[0];qe(!!mt);const ht=mt,pt=ht?.error||(null===(lt=ht[0])||void 0===lt?void 0:lt.error);if(pt){X(on,`RPC '${e}' stream ${i} received error:`,pt);const It=pt.status;let yt=function(J){const le=$t[J];if(void 0!==le)return ou(le)}(It),se=pt.message;void 0===yt&&(yt=F.INTERNAL,se="Unknown error status: "+It+" with message "+pt.message),_e=!0,Ve.Do(new Y(yt,se)),C.close()}else X(on,`RPC '${e}' stream ${i} received:`,mt),Ve.vo(mt)}}),Ke(c,Oe.STAT_EVENT,Ue=>{Ue.stat===Be.PROXY?X(on,`RPC '${e}' stream ${i} detected buffering proxy`):Ue.stat===Be.NOPROXY&&X(on,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{Ve.bo()},0),Ve}}function Vs(){return typeof document<"u"?document:null}function Ri(r){return new pm(r,!0)}class ha{constructor(e,t,n=1e3,i=1.5,o=6e4){this.li=e,this.timerId=t,this.Qo=n,this.Ko=i,this.$o=o,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const t=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),i=Math.max(0,t-n);i>0&&X("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){null!==this.Wo&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){null!==this.Wo&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}class ph{constructor(e,t,n,i,o,a,c,u){this.li=e,this.Yo=n,this.Zo=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new ha(e,t)}i_(){return 1===this.state||5===this.state||this.s_()}s_(){return 2===this.state||3===this.state}start(){this.n_=0,4!==this.state?this.auth():this.o_()}stop(){var e=this;return(0,T.A)(function*(){e.i_()&&(yield e.close(0))})()}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&null===this.e_&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}u_(){var e=this;return(0,T.A)(function*(){if(e.s_())return e.close(0)})()}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(e,t){var n=this;return(0,T.A)(function*(){n.l_(),n.h_(),n.r_.cancel(),n.Xo++,4!==e?n.r_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(be(t.toString()),be("Using maximum backoff delay to prevent overloading the backend."),n.r_.zo()):t&&t.code===F.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.P_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.po(t)})()}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Xo===t&&this.I_(n,i)},n=>{e(()=>{const i=new Y(F.UNKNOWN,"Fetching auth token failed: "+n.message);return this.E_(i)})})}I_(e,t){const n=this.T_(this.Xo);this.stream=this.d_(e,t),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{n(()=>this.E_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.n_?this.A_(i):this.onNext(i))})}o_(){var e=this;this.state=5,this.r_.jo((0,T.A)(function*(){e.state=0,e.start()}))}E_(e){return X("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(X("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class uf extends ph{constructor(e,t,n,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=o}d_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const t=function vm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:Ne(),i=e.targetChange.targetIds||[],o=function(f,v){return f.useProto3Json?(qe(void 0===v||"string"==typeof v),Nt.fromBase64String(v||"")):(qe(void 0===v||v instanceof Buffer||v instanceof Uint8Array),Nt.fromUint8Array(v||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(f){const v=void 0===f.code?F.UNKNOWN:ou(f.code);return new Y(v,f.message||"")}(a);t=new hu(n,i,o,c||null)}else if("documentChange"in e){const n=e.documentChange,i=Tn(r,n.document.name),o=Lt(n.document.updateTime),a=n.document.createTime?Lt(n.document.createTime):ze.min(),c=new Xt({mapValue:{fields:n.document.fields}}),u=Mt.newFoundDocument(i,o,a,c);t=new vs(n.targetIds||[],n.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const n=e.documentDelete,i=Tn(r,n.document),o=n.readTime?Lt(n.readTime):ze.min(),a=Mt.newNoDocument(i,o);t=new vs([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=Tn(r,n.document);t=new vs([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return Ne();{const n=e.filter,{count:i=0,unchangedNames:o}=n,a=new um(i,o);t=new uu(n.targetId,a)}}var f;return t}(this.serializer,e),n=function(o){if(!("targetChange"in o))return ze.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?ze.min():a.readTime?Lt(a.readTime):ze.min()}(e);return this.listener.R_(t,n)}V_(e){const t={};t.database=Lo(this.serializer),t.addTarget=function(o,a){let c;const u=a.target;if(c=ds(u)?{documents:xu(o,u)}:{query:xs(o,u).ct},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=mu(o,a.resumeToken);const f=No(o,a.expectedCount);null!==f&&(c.expectedCount=f)}else if(a.snapshotVersion.compareTo(ze.min())>0){c.readTime=Pr(o,a.snapshotVersion.toTimestamp());const f=No(o,a.expectedCount);null!==f&&(c.expectedCount=f)}return c}(this.serializer,e);const n=function xm(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ne()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.c_(t)}m_(e){const t={};t.database=Lo(this.serializer),t.removeTarget=e,this.c_(t)}}class hf extends ph{constructor(e,t,n,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=o}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(e,t){return this.connection.qo("Write",e,t)}A_(e){return qe(!!e.streamToken),this.lastStreamToken=e.streamToken,qe(!e.writeResults||0===e.writeResults.length),this.listener.p_()}onNext(e){qe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const t=function wm(r,e){return r&&r.length>0?(qe(void 0!==e),r.map(t=>function(i,o){let a=Lt(i.updateTime?i.updateTime:o);return a.isEqual(ze.min())&&(a=Lt(o)),new am(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Lt(e.commitTime);return this.listener.y_(n,t)}w_(){const e={};e.database=Lo(this.serializer),this.c_(e)}g_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function xi(r,e){let t;if(e instanceof Rr)t={update:vu(r,e.key,e.value)};else if(e instanceof Or)t={delete:wi(r,e.key)};else if(e instanceof Rn)t={update:vu(r,e.key,e.data),updateMask:Im(e.fieldMask)};else{if(!(e instanceof Mo))return Ne();t={verify:wi(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(o,a){const c=a.transform;if(c instanceof Ar)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof nr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof rr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Sr)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw Ne()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(o=e.precondition).updateTime?{updateTime:gm(r,o.updateTime)}:void 0!==o.exists?{exists:o.exists}:Ne()),t;var o}(this.serializer,n))};this.c_(t)}}class df extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,n,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Oo(e,Bo(t,n),i,o,a)).catch(o=>{throw"FirebaseError"===o.name?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Y(F.UNKNOWN,o.toString())})}ko(e,t,n,i,o){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.ko(e,Bo(t,n),i,a,c,o)).catch(a=>{throw"FirebaseError"===a.name?(a.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Y(F.UNKNOWN,a.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class _f{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){0===this.D_&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){"Online"===this.state?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,"Online"===e&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(be(t),this.C_=!1):X("OnlineStateTracker",t)}N_(){null!==this.v_&&(this.v_.cancel(),this.v_=null)}}class mf{constructor(e,t,n,i,o){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=o,this.Q_.uo(c=>{n.enqueueAndForget((0,T.A)(function*(){var u;qn(a)&&(X("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,T.A)(function*(v){const C=xe(v);C.k_.add(4),yield jr(C),C.K_.set("Unknown"),C.k_.delete(4),yield Oi(C)}),function f(v){return u.apply(this,arguments)})(a))}))}),this.K_=new _f(n,i)}}function Oi(r){return da.apply(this,arguments)}function da(){return(da=(0,T.A)(function*(r){if(qn(r))for(const e of r.q_)yield e(!0)})).apply(this,arguments)}function jr(r){return _a.apply(this,arguments)}function _a(){return(_a=(0,T.A)(function*(r){for(const e of r.q_)yield e(!1)})).apply(this,arguments)}function zs(r,e){const t=xe(r);t.B_.has(e.targetId)||(t.B_.set(e.targetId,e),pa(t)?fa(t):Gr(t).s_()&&ma(t,e))}function Br(r,e){const t=xe(r),n=Gr(t);t.B_.delete(e),n.s_()&&gh(t,e),0===t.B_.size&&(n.s_()?n.a_():qn(t)&&t.K_.set("Unknown"))}function ma(r,e){if(r.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ze.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Gr(r).V_(e)}function gh(r,e){r.U_.xe(e),Gr(r).m_(e)}function fa(r){r.U_=new dm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>r.B_.get(e)||null,nt:()=>r.datastore.serializer.databaseId}),Gr(r).start(),r.K_.F_()}function pa(r){return qn(r)&&!Gr(r).i_()&&r.B_.size>0}function qn(r){return 0===xe(r).k_.size}function yh(r){r.U_=void 0}function ff(r){return ga.apply(this,arguments)}function ga(){return(ga=(0,T.A)(function*(r){r.K_.set("Online")})).apply(this,arguments)}function pf(r){return ya.apply(this,arguments)}function ya(){return(ya=(0,T.A)(function*(r){r.B_.forEach((e,t)=>{ma(r,e)})})).apply(this,arguments)}function gf(r,e){return va.apply(this,arguments)}function va(){return(va=(0,T.A)(function*(r,e){yh(r),pa(r)?(r.K_.O_(e),fa(r)):r.K_.set("Unknown")})).apply(this,arguments)}function yf(r,e,t){return wa.apply(this,arguments)}function wa(){return wa=(0,T.A)(function*(r,e,t){if(r.K_.set("Online"),e instanceof hu&&2===e.state&&e.cause)try{yield(n=(0,T.A)(function*(o,a){const c=a.cause;for(const u of a.targetIds)o.B_.has(u)&&(yield o.remoteSyncer.rejectListen(u,c),o.B_.delete(u),o.U_.removeTarget(u))}),function i(o,a){return n.apply(this,arguments)})(r,e)}catch(n){X("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Ns(r,n)}else if(e instanceof vs?r.U_.$e(e):e instanceof uu?r.U_.Je(e):r.U_.Ge(e),!t.isEqual(ze.min()))try{const n=yield oh(r.localStore);t.compareTo(n)>=0&&(yield function(o,a){const c=o.U_.it(a);return c.targetChanges.forEach((u,f)=>{if(u.resumeToken.approximateByteSize()>0){const v=o.B_.get(f);v&&o.B_.set(f,v.withResumeToken(u.resumeToken,a))}}),c.targetMismatches.forEach((u,f)=>{const v=o.B_.get(u);if(!v)return;o.B_.set(u,v.withResumeToken(Nt.EMPTY_BYTE_STRING,v.snapshotVersion)),gh(o,u);const C=new On(v.target,u,f,v.sequenceNumber);ma(o,C)}),o.remoteSyncer.applyRemoteEvent(c)}(r,t))}catch(n){X("RemoteStore","Failed to raise snapshot:",n),yield Ns(r,n)}var n}),wa.apply(this,arguments)}function Ns(r,e,t){return xa.apply(this,arguments)}function xa(){return(xa=(0,T.A)(function*(r,e,t){if(!Bt(e))throw e;r.k_.add(1),yield jr(r),r.K_.set("Offline"),t||(t=()=>oh(r.localStore)),r.asyncQueue.enqueueRetryable((0,T.A)(function*(){X("RemoteStore","Retrying IndexedDB access"),yield t(),r.k_.delete(1),yield Oi(r)}))})).apply(this,arguments)}function vh(r,e){return e().catch(t=>Ns(r,t,e))}function Lr(r){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,T.A)(function*(r){const e=xe(r),t=Wn(e);let n=e.L_.length>0?e.L_[e.L_.length-1].batchId:-1;for(;vf(e);)try{const i=yield nf(e.localStore,n);if(null===i){0===e.L_.length&&t.a_();break}n=i.batchId,wf(e,i)}catch(i){yield Ns(e,i)}wh(e)&&xh(e)})).apply(this,arguments)}function vf(r){return qn(r)&&r.L_.length<10}function wf(r,e){r.L_.push(e);const t=Wn(r);t.s_()&&t.f_&&t.g_(e.mutations)}function wh(r){return qn(r)&&!Wn(r).i_()&&r.L_.length>0}function xh(r){Wn(r).start()}function xf(r){return ba.apply(this,arguments)}function ba(){return(ba=(0,T.A)(function*(r){Wn(r).w_()})).apply(this,arguments)}function Tf(r){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,T.A)(function*(r){const e=Wn(r);for(const t of r.L_)e.g_(t.mutations)})).apply(this,arguments)}function bf(r,e,t){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,T.A)(function*(r,e,t){const n=r.L_.shift(),i=Fo.from(n,e,t);yield vh(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Lr(r)})).apply(this,arguments)}function Ef(r,e){return Ca.apply(this,arguments)}function Ca(){return Ca=(0,T.A)(function*(r,e){var t;e&&Wn(r).f_&&(yield(t=(0,T.A)(function*(i,o){if(function su(r){switch(r){default:return Ne();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}(c=o.code)&&c!==F.ABORTED){const a=i.L_.shift();Wn(i).__(),yield vh(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,o)),yield Lr(i)}var c}),function n(i,o){return t.apply(this,arguments)})(r,e)),wh(r)&&xh(r)}),Ca.apply(this,arguments)}function Th(r,e){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,T.A)(function*(r,e){const t=xe(r);t.asyncQueue.verifyOperationInProgress(),X("RemoteStore","RemoteStore received new credentials");const n=qn(t);t.k_.add(3),yield jr(t),n&&t.K_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),yield Oi(t)})).apply(this,arguments)}function Sa(r,e){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,T.A)(function*(r,e){const t=xe(r);e?(t.k_.delete(2),yield Oi(t)):e||(t.k_.add(2),yield jr(t),t.K_.set("Unknown"))})).apply(this,arguments)}function Gr(r){return r.W_||(r.W_=function(t,n,i){const o=xe(t);return o.b_(),new uf(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Ro:ff.bind(null,r),mo:pf.bind(null,r),po:gf.bind(null,r),R_:yf.bind(null,r)}),r.q_.push(function(){var e=(0,T.A)(function*(t){t?(r.W_.__(),pa(r)?fa(r):r.K_.set("Unknown")):(yield r.W_.stop(),yh(r))});return function(t){return e.apply(this,arguments)}}())),r.W_}function Wn(r){return r.G_||(r.G_=function(t,n,i){const o=xe(t);return o.b_(),new hf(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Ro:()=>Promise.resolve(),mo:xf.bind(null,r),po:Ef.bind(null,r),p_:Tf.bind(null,r),y_:bf.bind(null,r)}),r.q_.push(function(){var e=(0,T.A)(function*(t){t?(r.G_.__(),yield Lr(r)):(yield r.G_.stop(),r.L_.length>0&&(X("RemoteStore",`Stopping write stream with ${r.L_.length} pending writes`),r.L_=[]))});return function(t){return e.apply(this,arguments)}}())),r.G_}class Oa{constructor(e,t,n,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=o,this.deferred=new et,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,o){const a=Date.now()+n,c=new Oa(e,t,a,i,o);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Y(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function $r(r,e){if(be("AsyncQueue",`${e}: ${r}`),Bt(r))return new Y(F.UNAVAILABLE,`${e}: ${r}`);throw r}class Ur{static emptySet(e){return new Ur(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||I.comparator(t.key,n.key):(t,n)=>I.comparator(t.key,n.key),this.keyedMap=_i(),this.sortedSet=new kt(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ur)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=n.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ur;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class bh{constructor(){this.z_=new kt(I.comparator)}track(e){const t=e.doc.key,n=this.z_.get(t);n?0!==e.type&&3===n.type?this.z_=this.z_.insert(t,e):3===e.type&&1!==n.type?this.z_=this.z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.z_=this.z_.remove(t):1===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):Ne():this.z_=this.z_.insert(t,e)}j_(){const e=[];return this.z_.inorderTraversal((t,n)=>{e.push(n)}),e}}class qr{constructor(e,t,n,i,o,a,c,u,f){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=f}static fromInitialDocuments(e,t,n,i,o){const a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new qr(e,t,Ur.emptySet(t),a,n,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class If{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class Cf{constructor(){this.queries=Eh(),this.onlineState="Unknown",this.X_=new Set}terminate(){!function(t,n){const i=xe(t),o=i.queries;i.queries=Eh(),o.forEach((a,c)=>{for(const u of c.J_)u.onError(n)})}(this,new Y(F.ABORTED,"Firestore shutting down"))}}function Eh(){return new Sn(r=>Bc(r),hi)}function Pa(r,e){return ka.apply(this,arguments)}function ka(){return(ka=(0,T.A)(function*(r,e){const t=xe(r);let n=3;const i=e.query;let o=t.queries.get(i);o?!o.Y_()&&e.Z_()&&(n=2):(o=new If,n=e.Z_()?0:1);try{switch(n){case 0:o.H_=yield t.onListen(i,!0);break;case 1:o.H_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const c=$r(a,`Initialization of query '${Cr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,o),o.J_.push(e),e.ea(t.onlineState),o.H_&&e.ta(o.H_)&&Fa(t)})).apply(this,arguments)}function Ma(r,e){return Da.apply(this,arguments)}function Da(){return(Da=(0,T.A)(function*(r,e){const t=xe(r),n=e.query;let i=3;const o=t.queries.get(n);if(o){const a=o.J_.indexOf(e);a>=0&&(o.J_.splice(a,1),0===o.J_.length?i=e.Z_()?0:1:!o.Y_()&&e.Z_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function Af(r,e){const t=xe(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const c of a.J_)c.ta(i)&&(n=!0);a.H_=i}}n&&Fa(t)}function Sf(r,e,t){const n=xe(r),i=n.queries.get(e);if(i)for(const o of i.J_)o.onError(t);n.queries.delete(e)}function Fa(r){r.X_.forEach(e=>{e.next()})}var Va,Ih;(Ih=Va||(Va={})).na="default",Ih.Cache="cache";class za{constructor(e,t,n){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new qr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){return!e.fromCache||!this.Z_()||(!this.options.ua||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}oa(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}aa(e){e=qr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==Va.Cache}}class Sh{constructor(e){this.key=e}}class Rh{constructor(e){this.key=e}}class Oh{constructor(e,t){this.query=e,this.da=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=gt(),this.mutatedKeys=gt(),this.Va=Gc(e),this.ma=new Ur(this.Va)}get fa(){return this.da}ga(e,t){const n=t?t.pa:new bh,i=t?t.ma:this.ma;let o=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,f="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((v,C)=>{const j=i.get(v),_e=di(this.query,C)?C:null,Ve=!!j&&this.mutatedKeys.has(j.key),Ke=!!_e&&(_e.hasLocalMutations||this.mutatedKeys.has(_e.key)&&_e.hasCommittedMutations);let Ue=!1;j&&_e?j.data.isEqual(_e.data)?Ve!==Ke&&(n.track({type:3,doc:_e}),Ue=!0):this.ya(j,_e)||(n.track({type:2,doc:_e}),Ue=!0,(u&&this.Va(_e,u)>0||f&&this.Va(_e,f)<0)&&(c=!0)):!j&&_e?(n.track({type:0,doc:_e}),Ue=!0):j&&!_e&&(n.track({type:1,doc:j}),Ue=!0,(u||f)&&(c=!0)),Ue&&(_e?(a=a.add(_e),o=Ke?o.add(v):o.delete(v)):(a=a.delete(v),o=o.delete(v)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const v="F"===this.query.limitType?a.last():a.first();a=a.delete(v.key),o=o.delete(v.key),n.track({type:1,doc:v})}return{ma:a,pa:n,ss:c,mutatedKeys:o}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const o=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const a=e.pa.j_();a.sort((v,C)=>function(_e,Ve){const Ke=Ue=>{switch(Ue){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ne()}};return Ke(_e)-Ke(Ve)}(v.type,C.type)||this.Va(v.doc,C.doc)),this.wa(n),i=null!=i&&i;const c=t&&!i?this.Sa():[],u=0===this.Ra.size&&this.current&&!i?1:0,f=u!==this.Aa;return this.Aa=u,0!==a.length||f?{snapshot:new qr(this.query,e.ma,o,a,e.mutatedKeys,0===u,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:c}:{ba:c}}ea(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ma:this.ma,pa:new bh,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.da.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.da=this.da.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.da=this.da.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=gt(),this.ma.forEach(n=>{this.Da(n.key)&&(this.Ra=this.Ra.add(n.key))});const t=[];return e.forEach(n=>{this.Ra.has(n)||t.push(new Rh(n))}),this.Ra.forEach(n=>{e.has(n)||t.push(new Sh(n))}),t}va(e){this.da=e.ds,this.Ra=gt();const t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return qr.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,0===this.Aa,this.hasCachedResults)}}class Pf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class kf{constructor(e){this.key=e,this.Fa=!1}}class Mf{constructor(e,t,n,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Ma={},this.xa=new Sn(c=>Bc(c),hi),this.Oa=new Map,this.Na=new Set,this.La=new kt(I.comparator),this.Ba=new Map,this.ka=new Xo,this.qa={},this.Qa=new Map,this.Ka=cr.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return!0===this.$a}}function Df(r,e){return Na.apply(this,arguments)}function Na(){return(Na=(0,T.A)(function*(r,e,t=!0){const n=js(r);let i;const o=n.xa.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Ca()):i=yield Ph(n,e,t,!0),i})).apply(this,arguments)}function Ff(r,e){return ja.apply(this,arguments)}function ja(){return(ja=(0,T.A)(function*(r,e){const t=js(r);yield Ph(t,e,!0,!1)})).apply(this,arguments)}function Ph(r,e,t,n){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,T.A)(function*(r,e,t,n){const i=yield function zr(r,e){const t=xe(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Gr.getTargetData(n,e).next(o=>o?(i=o,$.resolve(i)):t.Gr.allocateTargetId(n).next(a=>(i=new On(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Gr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.us.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.us=t.us.insert(n.targetId,n),t.cs.set(e,n.targetId)),n})}(r.localStore,rn(e)),o=i.targetId,a=r.sharedClientState.addLocalQueryTarget(o,t);let c;return n&&(c=yield function La(r,e,t,n,i){return Ga.apply(this,arguments)}(r,e,o,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&zs(r.remoteStore,i),c})).apply(this,arguments)}function Ga(){return Ga=(0,T.A)(function*(r,e,t,n,i){r.Ua=(C,j,_e)=>{return(Ve=(0,T.A)(function*(Ue,lt,mt,ht){let pt=lt.view.ga(mt);pt.ss&&(pt=yield ks(Ue.localStore,lt.query,!1).then(({documents:L})=>lt.view.ga(L,pt)));const It=ht&&ht.targetChanges.get(lt.targetId),yt=ht&&null!=ht.targetMismatches.get(lt.targetId),se=lt.view.applyChanges(pt,Ue.isPrimaryClient,It,yt);return Za(Ue,lt.targetId,se.ba),se.snapshot}),function Ke(Ue,lt,mt,ht){return Ve.apply(this,arguments)})(r,C,j,_e);var Ve};const o=yield ks(r.localStore,e,!0),a=new Oh(e,o.ds),c=a.ga(o.documents),u=vi.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),f=a.applyChanges(c,r.isPrimaryClient,u);Za(r,t,f.ba);const v=new Pf(e,t,a);return r.xa.set(e,v),r.Oa.has(t)?r.Oa.get(t).push(e):r.Oa.set(t,[e]),f.snapshot}),Ga.apply(this,arguments)}function Vf(r,e,t){return $a.apply(this,arguments)}function $a(){return($a=(0,T.A)(function*(r,e,t){const n=xe(r),i=n.xa.get(e),o=n.Oa.get(i.targetId);if(o.length>1)return n.Oa.set(i.targetId,o.filter(a=>!hi(a,e))),void n.xa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Nr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Br(n.remoteStore,i.targetId),Wr(n,i.targetId)}).catch(Me))):(Wr(n,i.targetId),yield Nr(n.localStore,i.targetId,!0))})).apply(this,arguments)}function zf(r,e){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,T.A)(function*(r,e){const t=xe(r),n=t.xa.get(e),i=t.Oa.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Br(t.remoteStore,n.targetId))})).apply(this,arguments)}function qa(){return(qa=(0,T.A)(function*(r,e,t){const n=function ul(r){const e=xe(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Bf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Lf.bind(null,e),e}(r);try{const i=yield function(a,c){const u=xe(a),f=Je.now(),v=c.reduce((_e,Ve)=>_e.add(Ve.key),gt());let C,j;return u.persistence.runTransaction("Locally write mutations","readwrite",_e=>{let Ve=pn(),Ke=gt();return u.hs.getEntries(_e,v).next(Ue=>{Ve=Ue,Ve.forEach((lt,mt)=>{mt.isValidDocument()||(Ke=Ke.add(lt))})}).next(()=>u.localDocuments.getOverlayedDocuments(_e,Ve)).next(Ue=>{C=Ue;const lt=[];for(const mt of c){const ht=cm(mt,C.get(mt.key).overlayedDocument);null!=ht&&lt.push(new Rn(mt.key,ht,Ec(ht.value.mapValue),Vt.exists(!0)))}return u.mutationQueue.addMutationBatch(_e,f,lt,c)}).next(Ue=>{j=Ue;const lt=Ue.applyToLocalDocumentSet(C,Ke);return u.documentOverlayCache.saveOverlays(_e,Ue.batchId,lt)})}).then(()=>({batchId:j.batchId,changes:Uc(C)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,c,u){let f=a.qa[a.currentUser.toKey()];f||(f=new kt(P)),f=f.insert(c,u),a.qa[a.currentUser.toKey()]=f}(n,i.batchId,t),yield Pn(n,i.changes),yield Lr(n.remoteStore)}catch(i){const o=$r(i,"Failed to persist write");t.reject(o)}})).apply(this,arguments)}function kh(r,e){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,T.A)(function*(r,e){const t=xe(r);try{const n=yield function tf(r,e){const t=xe(r),n=e.snapshotVersion;let i=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=t.hs.newChangeBuffer({trackRemovals:!0});i=t.us;const c=[];e.targetChanges.forEach((v,C)=>{const j=i.get(C);if(!j)return;c.push(t.Gr.removeMatchingKeys(o,v.removedDocuments,C).next(()=>t.Gr.addMatchingKeys(o,v.addedDocuments,C)));let _e=j.withSequenceNumber(o.currentSequenceNumber);var Ke,Ue,lt;null!==e.targetMismatches.get(C)?_e=_e.withResumeToken(Nt.EMPTY_BYTE_STRING,ze.min()).withLastLimboFreeSnapshotVersion(ze.min()):v.resumeToken.approximateByteSize()>0&&(_e=_e.withResumeToken(v.resumeToken,n)),i=i.insert(C,_e),Ue=_e,lt=v,(0===(Ke=j).resumeToken.approximateByteSize()||Ue.snapshotVersion.toMicroseconds()-Ke.snapshotVersion.toMicroseconds()>=3e8||lt.addedDocuments.size+lt.modifiedDocuments.size+lt.removedDocuments.size>0)&&c.push(t.Gr.updateTargetData(o,_e))});let u=pn(),f=gt();if(e.documentUpdates.forEach(v=>{e.resolvedLimboDocuments.has(v)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(o,v))}),c.push(function ah(r,e,t){let n=gt(),i=gt();return t.forEach(o=>n=n.add(o)),e.getEntries(r,n).next(o=>{let a=pn();return t.forEach((c,u)=>{const f=o.get(c);u.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(ze.min())?(e.removeEntry(c,u.readTime),a=a.insert(c,u)):!f.isValidDocument()||u.version.compareTo(f.version)>0||0===u.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(u),a=a.insert(c,u)):X("LocalStore","Ignoring outdated watch update for ",c,". Current version:",f.version," Watch version:",u.version)}),{Is:a,Es:i}})}(o,a,e.documentUpdates).next(v=>{u=v.Is,f=v.Es})),!n.isEqual(ze.min())){const v=t.Gr.getLastRemoteSnapshotVersion(o).next(C=>t.Gr.setTargetsMetadata(o,o.currentSequenceNumber,n));c.push(v)}return $.waitFor(c).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,u,f)).next(()=>u)}).then(o=>(t.us=i,o))}(t.localStore,e);e.targetChanges.forEach((i,o)=>{const a=t.Ba.get(o);a&&(qe(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Fa=!0:i.modifiedDocuments.size>0?qe(a.Fa):i.removedDocuments.size>0&&(qe(a.Fa),a.Fa=!1))}),yield Pn(t,n,e)}catch(n){yield Me(n)}})).apply(this,arguments)}function Mh(r,e,t){const n=xe(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.xa.forEach((o,a)=>{const c=a.view.ea(e);c.snapshot&&i.push(c.snapshot)}),function(a,c){const u=xe(a);u.onlineState=c;let f=!1;u.queries.forEach((v,C)=>{for(const j of C.J_)j.ea(c)&&(f=!0)}),f&&Fa(u)}(n.eventManager,e),i.length&&n.Ma.R_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function jf(r,e,t){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,T.A)(function*(r,e,t){const n=xe(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Ba.get(e),o=i&&i.key;if(o){let a=new kt(I.comparator);a=a.insert(o,Mt.newNoDocument(o,ze.min()));const c=gt().add(o),u=new yi(ze.min(),new Map,new kt(P),a,c);yield kh(n,u),n.La=n.La.remove(o),n.Ba.delete(e),el(n)}else yield Nr(n.localStore,e,!1).then(()=>Wr(n,e,t)).catch(Me)})).apply(this,arguments)}function Bf(r,e){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,T.A)(function*(r,e){const t=xe(r),n=e.batch.batchId;try{const i=yield function ef(r,e){const t=xe(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),o=t.hs.newChangeBuffer({trackRemovals:!0});return function(c,u,f,v){const C=f.batch,j=C.keys();let _e=$.resolve();return j.forEach(Ve=>{_e=_e.next(()=>v.getEntry(u,Ve)).next(Ke=>{const Ue=f.docVersions.get(Ve);qe(null!==Ue),Ke.version.compareTo(Ue)<0&&(C.applyToRemoteDocument(Ke,f),Ke.isValidDocument()&&(Ke.setReadTime(f.commitVersion),v.addEntry(Ke)))})}),_e.next(()=>c.mutationQueue.removeMutationBatch(u,C))}(t,n,e,o).next(()=>o.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=gt();for(let f=0;f<c.mutationResults.length;++f)c.mutationResults[f].transformResults.length>0&&(u=u.add(c.batch.mutations[f].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);Ha(t,n,null),Ja(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Pn(t,i)}catch(i){yield Me(i)}})).apply(this,arguments)}function Lf(r,e,t){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,T.A)(function*(r,e,t){const n=xe(r);try{const i=yield function(a,c){const u=xe(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let v;return u.mutationQueue.lookupMutationBatch(f,c).next(C=>(qe(null!==C),v=C.keys(),u.mutationQueue.removeMutationBatch(f,C))).next(()=>u.mutationQueue.performConsistencyCheck(f)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(f,v,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,v)).next(()=>u.localDocuments.getDocuments(f,v))})}(n.localStore,e);Ha(n,e,t),Ja(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Pn(n,i)}catch(i){yield Me(i)}})).apply(this,arguments)}function Ja(r,e){(r.Qa.get(e)||[]).forEach(t=>{t.resolve()}),r.Qa.delete(e)}function Ha(r,e,t){const n=xe(r);let i=n.qa[n.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),n.qa[n.currentUser.toKey()]=i}}function Wr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Oa.get(e))r.xa.delete(n),t&&r.Ma.Wa(n,t);r.Oa.delete(e),r.isPrimaryClient&&r.ka.yr(e).forEach(n=>{r.ka.containsKey(n)||Dh(r,n)})}function Dh(r,e){r.Na.delete(e.path.canonicalString());const t=r.La.get(e);null!==t&&(Br(r.remoteStore,t),r.La=r.La.remove(e),r.Ba.delete(t),el(r))}function Za(r,e,t){for(const n of t)n instanceof Sh?(r.ka.addReference(n.key,e),$f(r,n)):n instanceof Rh?(X("SyncEngine","Document no longer in limbo: "+n.key),r.ka.removeReference(n.key,e),r.ka.containsKey(n.key)||Dh(r,n.key)):Ne()}function $f(r,e){const t=e.key,n=t.path.canonicalString();r.La.get(t)||r.Na.has(n)||(X("SyncEngine","New document in limbo: "+t),r.Na.add(n),el(r))}function el(r){for(;r.Na.size>0&&r.La.size<r.maxConcurrentLimboResolutions;){const e=r.Na.values().next().value;r.Na.delete(e);const t=new I(ae.fromString(e)),n=r.Ka.next();r.Ba.set(n,new kf(t)),r.La=r.La.insert(t,n),zs(r.remoteStore,new On(rn(Er(t.path)),n,"TargetPurposeLimboResolution",U.oe))}}function Pn(r,e,t){return tl.apply(this,arguments)}function tl(){return tl=(0,T.A)(function*(r,e,t){const n=xe(r),i=[],o=[],a=[];var c;n.xa.isEmpty()||(n.xa.forEach((c,u)=>{a.push(n.Ua(u,e,t).then(f=>{var v;if((f||t)&&n.isPrimaryClient){const C=f?!f.fromCache:null===(v=t?.targetChanges.get(u.targetId))||void 0===v?void 0:v.current;n.sharedClientState.updateQueryState(u.targetId,C?"current":"not-current")}if(f){i.push(f);const C=ta.zi(u.targetId,f);o.push(C)}}))}),yield Promise.all(a),n.Ma.R_(i),yield(c=(0,T.A)(function*(f,v){const C=xe(f);try{yield C.persistence.runTransaction("notifyLocalViewChanges","readwrite",j=>$.forEach(v,_e=>$.forEach(_e.Wi,Ve=>C.persistence.referenceDelegate.addReference(j,_e.targetId,Ve)).next(()=>$.forEach(_e.Gi,Ve=>C.persistence.referenceDelegate.removeReference(j,_e.targetId,Ve)))))}catch(j){if(!Bt(j))throw j;X("LocalStore","Failed to update sequence numbers: "+j)}for(const j of v){const _e=j.targetId;if(!j.fromCache){const Ve=C.us.get(_e),Ue=Ve.withLastLimboFreeSnapshotVersion(Ve.snapshotVersion);C.us=C.us.insert(_e,Ue)}}}),function u(f,v){return c.apply(this,arguments)})(n.localStore,o))}),tl.apply(this,arguments)}function Uf(r,e){return nl.apply(this,arguments)}function nl(){return(nl=(0,T.A)(function*(r,e){const t=xe(r);if(!t.currentUser.isEqual(e)){X("SyncEngine","User change. New user:",e.toKey());const n=yield sh(t.localStore,e);t.currentUser=e,(o=t).Qa.forEach(c=>{c.forEach(u=>{u.reject(new Y(F.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.Qa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Pn(t,n.Ts)}var o})).apply(this,arguments)}function qf(r,e){const t=xe(r),n=t.Ba.get(e);if(n&&n.Fa)return gt().add(n.key);{let i=gt();const o=t.Oa.get(e);if(!o)return i;for(const a of o){const c=t.xa.get(a);i=i.unionWith(c.view.fa)}return i}}function js(r){const e=xe(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=kh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jf.bind(null,e),e.Ma.R_=Af.bind(null,e.eventManager),e.Ma.Wa=Sf.bind(null,e.eventManager),e}let Bs=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,T.A)(function*(){n.serializer=Ri(t.databaseInfo.databaseId),n.sharedClientState=n.za(t),n.persistence=n.ja(t),yield n.persistence.start(),n.localStore=n.Ha(t),n.gcScheduler=n.Ja(t,n.localStore),n.indexBackfillerScheduler=n.Ya(t,n.localStore)})()}Ja(t,n){return null}Ya(t,n){return null}Ha(t){return function ih(r,e,t,n){return new Zm(r,e,t,n)}(this.persistence,new rh,t.initialUser,this.serializer)}ja(t){return new Jo(Rs.ei,this.serializer)}za(t){return new _h}terminate(){var t=this;return(0,T.A)(function*(){var n,i;null===(n=t.gcScheduler)||void 0===n||n.stop(),null===(i=t.indexBackfillerScheduler)||void 0===i||i.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class hl extends Bs{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){return qe(this.persistence.referenceDelegate instanceof Os),new Yu(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}ja(e){const t=void 0!==this.cacheSizeBytes?sn.withCacheSize(this.cacheSizeBytes):sn.DEFAULT;return new Jo(n=>Os.ei(n,t),this.serializer)}}let Kr=(()=>{class r{initialize(t,n){var i=this;return(0,T.A)(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(n),i.remoteStore=i.createRemoteStore(n),i.eventManager=i.createEventManager(n),i.syncEngine=i.createSyncEngine(n,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=o=>Mh(i.syncEngine,o,1),i.remoteStore.remoteSyncer.handleCredentialChange=Uf.bind(null,i.syncEngine),yield Sa(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new Cf}createDatastore(t){const n=Ri(t.databaseInfo.databaseId),i=new cf(t.databaseInfo);return new df(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return i=this.localStore,o=this.datastore,a=t.asyncQueue,c=n=>Mh(this.syncEngine,n,0),u=mh.p()?new mh:new of,new mf(i,o,a,c,u);var i,o,a,c,u}createSyncEngine(t,n){return function(o,a,c,u,f,v,C){const j=new Mf(o,a,c,u,f,v);return C&&(j.$a=!0),j}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,T.A)(function*(){var n,i,o;yield(o=(0,T.A)(function*(c){const u=xe(c);X("RemoteStore","RemoteStore shutting down."),u.k_.add(5),yield jr(u),u.Q_.shutdown(),u.K_.set("Unknown")}),function a(c){return o.apply(this,arguments)})(t.remoteStore),null===(n=t.datastore)||void 0===n||n.terminate(),null===(i=t.eventManager)||void 0===i||i.terminate()})()}}return r.provider={build:()=>new r},r})();class Ls{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):be("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class rp{constructor(e,t,n,i,o){var a=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=it.UNAUTHENTICATED,this.clientId=k.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,function(){var c=(0,T.A)(function*(u){X("FirestoreClient","Received user=",u.uid),yield a.authCredentialListener(u),a.user=u});return function(u){return c.apply(this,arguments)}}()),this.appCheckCredentials.start(n,c=>(X("FirestoreClient","Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new et;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,T.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=$r(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function _l(r,e){return ml.apply(this,arguments)}function ml(){return ml=(0,T.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),X("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,T.A)(function*(o){n.isEqual(o)||(yield sh(e.localStore,o),n=o)});return function(o){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),ml.apply(this,arguments)}function jh(r,e){return fl.apply(this,arguments)}function fl(){return(fl=(0,T.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function pl(r){return gl.apply(this,arguments)}(r);X("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Th(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Th(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function gl(){return(gl=(0,T.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){X("FirestoreClient","Using user provided OfflineComponentProvider");try{yield _l(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(i=e).name?i.code===F.FAILED_PRECONDITION||i.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw e;Ge("Error using user provided cache. Falling back to memory cache: "+e),yield _l(r,new Bs)}}else X("FirestoreClient","Using default OfflineComponentProvider"),yield _l(r,new hl(void 0));var i;return r._offlineComponents})).apply(this,arguments)}function Gs(r){return yl.apply(this,arguments)}function yl(){return(yl=(0,T.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(X("FirestoreClient","Using user provided OnlineComponentProvider"),yield jh(r,r._uninitializedComponentsProvider._online)):(X("FirestoreClient","Using default OnlineComponentProvider"),yield jh(r,new Kr))),r._onlineComponents})).apply(this,arguments)}function Qr(r){return wl.apply(this,arguments)}function wl(){return(wl=(0,T.A)(function*(r){const e=yield Gs(r),t=e.eventManager;return t.onListen=Df.bind(null,e.syncEngine),t.onUnlisten=Vf.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ff.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=zf.bind(null,e.syncEngine),t})).apply(this,arguments)}function qh(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Wh=new Map;function xl(r,e,t){if(!t)throw new Y(F.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Kh(r){if(!I.isDocumentKey(r))throw new Y(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Yh(r){if(I.isDocumentKey(r))throw new Y(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function $s(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":Ne()}function wt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new Y(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=$s(r);throw new Y(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class Xh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Y(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Y(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function fp(r,e,t,n){if(!0===e&&!0===n)throw new Y(F.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=qh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(o){if(void 0!==o.timeoutSeconds){if(isNaN(o.timeoutSeconds))throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Pi{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xh({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Y(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Y(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xh(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Qe;switch(n.type){case"firstParty":return new rt(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Y(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,T.A)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Wh.get(t);n&&(X("ComponentProvider","Removing Datastore"),Wh.delete(t),n.terminate())}(this),Promise.resolve()}}class Jt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Jt(this.firestore,e,this._query)}}class Gt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gt(this.firestore,e,this._key)}}class bn extends Jt{constructor(e,t,n){super(e,t,Er(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gt(this.firestore,null,new I(e))}withConverter(e){return new bn(this.firestore,e,this._path)}}function ki(r,e,...t){if(r=(0,R.Ku)(r),xl("collection","path",e),r instanceof Pi){const n=ae.fromString(e,...t);return Yh(n),new bn(r,null,n)}{if(!(r instanceof Gt||r instanceof bn))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ae.fromString(e,...t));return Yh(n),new bn(r.firestore,null,n)}}function Xr(r,e,...t){if(r=(0,R.Ku)(r),1===arguments.length&&(e=k.newId()),xl("doc","path",e),r instanceof Pi){const n=ae.fromString(e,...t);return Kh(n),new Gt(r,null,new I(n))}{if(!(r instanceof Gt||r instanceof bn))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ae.fromString(e,...t));return Kh(n),new Gt(r.firestore,r instanceof bn?r.converter:null,new I(n))}}class Hh{constructor(e=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new ha(this,"async_queue_retry"),this.fu=()=>{const n=Vs();n&&X("AsyncQueue","Visibility state changed to "+n.visibilityState),this.r_.Jo()},this.gu=e;const t=Vs();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.Eu){this.Eu=!0,this.Vu=e||!1;const t=Vs();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.Eu)return new Promise(()=>{});const t=new et;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}wu(){var e=this;return(0,T.A)(function*(){if(0!==e.Iu.length){try{yield e.Iu[0](),e.Iu.shift(),e.r_.reset()}catch(t){if(!Bt(t))throw t;X("AsyncQueue","Operation failed with retryable error: "+t)}e.Iu.length>0&&e.r_.jo(()=>e.wu())}})()}yu(e){const t=this.gu.then(()=>(this.Ru=!0,e().catch(n=>{throw this.Au=n,this.Ru=!1,be("INTERNAL UNHANDLED ERROR: ",function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),c}(n)),n}).then(n=>(this.Ru=!1,n))));return this.gu=t,t}enqueueAfterDelay(e,t,n){this.pu(),this.mu.indexOf(e)>-1&&(t=0);const i=Oa.createAndSchedule(this,e,t,n,o=>this.Su(o));return this.du.push(i),i}pu(){this.Au&&Ne()}verifyOperationInProgress(){}bu(){var e=this;return(0,T.A)(function*(){let t;do{t=e.gu,yield t}while(t!==e.gu)})()}Du(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.du.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.du)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}function Tl(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const o of["next","error","complete"])if(o in i&&"function"==typeof i[o])return!0;return!1}(r)}class Ot extends Pi{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Hh,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){var e=this;return(0,T.A)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new Hh(t),e._firestoreClient=void 0,yield t}})()}}function bl(r,e){const t="object"==typeof r?r:(0,p.Sx)(),n="string"==typeof r?r:e||"(default)",i=(0,p.j6)(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const o=(0,R.yU)("firestore");o&&function pp(r,e,t,n={}){var i;const o=(r=wt(r,Pi))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Ge("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),n.mockUserToken){let c,u;if("string"==typeof n.mockUserToken)c=n.mockUserToken,u=it.MOCK_USER;else{c=(0,R.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new Y(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new it(f)}r._authCredentials=new ke(new Xe(c,u))}}(i,...o)}return i}function zt(r){if(r._terminated)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||function Zh(r){var e,t,n;const i=r._freezeSettings(),o=(u=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new G_(r._databaseId,u,r._persistenceKey,(v=i).host,v.ssl,v.experimentalForceLongPolling,v.experimentalAutoDetectLongPolling,qh(v.experimentalLongPollingOptions),v.useFetchStreams));var u,v;r._componentsProvider||!(null===(t=i.localCache)||void 0===t)&&t._offlineComponentProvider&&!(null===(n=i.localCache)||void 0===n)&&n._onlineComponentProvider&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new rp(r._authCredentials,r._appCheckCredentials,r._queue,o,r._componentsProvider&&function(c){const u=c?._online.build();return{_offline:c?._offline.build(u),_online:u}}(r._componentsProvider))}(r),r._firestoreClient}class hr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hr(Nt.fromBase64String(e))}catch(t){throw new Y(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new hr(Nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class dr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Y(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Jr{constructor(e){this._methodName=e}}class Il{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Y(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Y(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return P(this._lat,e._lat)||P(this._long,e._long)}}class Us{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}(this._values,e._values)}}const wp=/^__.*__$/;class xp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Rn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rr(e,this.data,t,this.fieldTransforms)}}function nd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ne()}}class qs{constructor(e,t,n,i,o,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===o&&this.Fu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new qs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.xu({path:n,Nu:!1});return i.Lu(e),i}Bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.xu({path:n,Nu:!1});return i.Fu(),i}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return Ys(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lu(this.path.get(e))}Lu(e){if(0===e.length)throw this.qu("Document fields must not be empty");if(nd(this.Mu)&&wp.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class Tp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ri(e)}$u(e,t,n,i=!1){return new qs({Mu:e,methodName:t,Ku:n,path:Le.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _r(r){const e=r._freezeSettings(),t=Ri(r._databaseId);return new Tp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Ws(r,e,t,n,i,o={}){const a=r.$u(o.merge||o.mergeFields?2:0,e,t,i);kl("Data must be an object, but it was:",a,n);const c=sd(n,a);let u,f;if(o.merge)u=new fn(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){const v=[];for(const C of o.mergeFields){const j=Fi(e,C,t);if(!a.contains(j))throw new Y(F.INVALID_ARGUMENT,`Field '${j}' is specified in your field mask but missing from your input data.`);ad(v,j)||v.push(j)}u=new fn(v),f=a.fieldTransforms.filter(C=>u.covers(C.field))}else u=null,f=a.fieldTransforms;return new xp(new Xt(c),u,f)}function mr(r,e){if(od(r=(0,R.Ku)(r)))return kl("Unsupported field value:",e,r),sd(r,e);if(r instanceof Jr)return function(n,i){if(!nd(i.Mu))throw i.qu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Nu&&4!==e.Mu)throw e.qu("Nested arrays are not supported");return function(n,i){const o=[];let a=0;for(const c of n){let u=mr(c,i.ku(a));null==u&&(u={nullValue:"NULL_VALUE"}),o.push(u),a++}return{arrayValue:{values:o}}}(r,e)}return function(n,i){if(null===(n=(0,R.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Kc(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const o=Je.fromDate(n);return{timestampValue:Pr(i.serializer,o)}}if(n instanceof Je){const o=new Je(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Pr(i.serializer,o)}}if(n instanceof Il)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof hr)return{bytesValue:mu(i.serializer,n._byteString)};if(n instanceof Gt){const o=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(o))throw i.qu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:jo(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Us)return c=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(u=>{if("number"!=typeof u)throw c.qu("VectorValues must only contain numeric values.");return ko(c.serializer,u)})}}}}};var c;throw i.qu(`Unsupported field value: ${$s(n)}`)}(r,e)}function sd(r,e){const t={};return _c(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vn(r,(n,i)=>{const o=mr(i,e.Ou(n));null!=o&&(t[n]=o)}),{mapValue:{fields:t}}}function od(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Je||r instanceof Il||r instanceof hr||r instanceof Gt||r instanceof Jr||r instanceof Us)}function kl(r,e,t){if(!od(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=$s(t);throw e.qu("an object"===n?r+" a custom object":r+" "+n)}var i}function Fi(r,e,t){if((e=(0,R.Ku)(e))instanceof dr)return e._internalPath;if("string"==typeof e)return Ks(r,e);throw Ys("Field path arguments must be of type string or ",r,!1,void 0,t)}const bp=new RegExp("[~\\*/\\[\\]]");function Ks(r,e,t){if(e.search(bp)>=0)throw Ys(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new dr(...e.split("."))._internalPath}catch{throw Ys(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Ys(r,e,t,n,i){const o=n&&!n.isEmpty(),a=void 0!==i;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(o||a)&&(u+=" (found",o&&(u+=` in field ${n}`),a&&(u+=` in document ${i}`),u+=")"),new Y(F.INVALID_ARGUMENT,c+r+u)}function ad(r,e){return r.some(t=>t.isEqual(e))}class Vi{constructor(e,t,n,i,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Gt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ep(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Qs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ep extends Vi{data(){return super.data()}}function Qs(r,e){return"string"==typeof e?Ks(r,e):e instanceof dr?e._internalPath:e._delegate._internalPath}function ld(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new Y(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ml{}class zi extends Ml{}function cd(r,e,...t){let n=[];e instanceof Ml&&n.push(e),n=n.concat(t),function(o){const a=o.filter(u=>u instanceof Hr).length,c=o.filter(u=>u instanceof Ni).length;if(a>1||a>0&&c>0)throw new Y(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Ni extends zi{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ni(e,t,n)}_apply(e){const t=this._parse(e);return md(e._query,t),new Jt(e.firestore,e.converter,Oo(e._query,t))}_parse(e){const t=_r(e.firestore);return function(o,a,c,u,f,v,C){let j;if(f.isKeyField()){if("array-contains"===v||"array-contains-any"===v)throw new Y(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${v}' queries on documentId().`);if("in"===v||"not-in"===v){_d(C,v);const _e=[];for(const Ve of C)_e.push(dd(u,o,Ve));j={arrayValue:{values:_e}}}else j=dd(u,o,C)}else"in"!==v&&"not-in"!==v&&"array-contains-any"!==v||_d(C,v),j=function id(r,e,t,n=!1){return mr(t,r.$u(n?4:3,e))}(c,"where",C,"in"===v||"not-in"===v);return Tt.create(f,v,j)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function ud(r,e,t){const n=e,i=Qs("where",r);return Ni._create(i,n,t)}class Hr extends Ml{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Hr(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:St.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,o){let a=i;const c=o.getFlattenedFilters();for(const u of c)md(a,u),a=Oo(a,u)}(e._query,t),new Jt(e.firestore,e.converter,Oo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function dd(r,e,t){if("string"==typeof(t=(0,R.Ku)(t))){if(""===t)throw new Y(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ro(e)&&-1!==t.indexOf("/"))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(ae.fromString(t));if(!I.isDocumentKey(n))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return er(r,new I(n))}if(t instanceof Gt)return er(r,t._key);throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$s(t)}.`)}function _d(r,e){if(!Array.isArray(r)||0===r.length)throw new Y(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function md(r,e){const t=function(i,o){for(const a of i)for(const c of a.getFlattenedFilters())if(o.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new Y(F.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class pd{convertValue(e,t="none"){switch(Nn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ft(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Cn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ne()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Vn(e,(i,o)=>{n[i]=this.convertValue(o,t)}),n}convertVectorValue(e){var t,n,i;const o=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(a=>Ft(a.doubleValue));return new Us(o)}convertGeoPoint(e){return new Il(Ft(e.latitude),Ft(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=as(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(si(e));default:return null}}convertTimestamp(e){const t=In(e);return new Je(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ae.fromString(e);qe(Cu(n));const i=new Zn(n.get(1),n.get(3)),o=new I(n.popFirst(5));return i.isEqual(t)||be(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}class fr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zr extends Vi{constructor(e,t,n,i,o,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new eo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Qs("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class eo extends Zr{data(e={}){return super.data(e)}}class ei{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new fr(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new eo(this._firestore,this._userDataWriter,n.key,n,new fr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Y(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>({type:"added",doc:new eo(i._firestore,i._userDataWriter,c.doc.key,c.doc,new fr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>o||3!==c.type).map(c=>{const u=new eo(i._firestore,i._userDataWriter,c.doc.key,c.doc,new fr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,v=-1;return 0!==c.type&&(f=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),1!==c.type&&(a=a.add(c.doc),v=a.indexOf(c.doc.key)),{type:Ap(c.type),doc:u,oldIndex:f,newIndex:v}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ap(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ne()}}class Kn extends pd{constructor(e){super(),this.firestore=e}convertBytes(e){return new hr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Gt(this.firestore,null,t)}}function gd(r){r=wt(r,Jt);const e=wt(r.firestore,Ot),t=zt(e),n=new Kn(e);return ld(r._query),function Uh(r,e,t={}){const n=new et;return r.asyncQueue.enqueueAndForget((0,T.A)(function*(){return function(o,a,c,u,f){const v=new Ls({next:j=>{v.eu(),a.enqueueAndForget(()=>Ma(o,C)),j.fromCache&&"server"===u.source?f.reject(new Y(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(j)},error:j=>f.reject(j)}),C=new za(c,v,{includeMetadataChanges:!0,ua:!0});return Pa(o,C)}(yield Qr(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(i=>new ei(e,n,r,i))}function yd(r,e,t){r=wt(r,Gt);const n=wt(r.firestore,Ot),i=function Zs(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return ji(n,[Ws(_r(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,Vt.none())])}function to(r,...e){var t,n,i;r=(0,R.Ku)(r);let o={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||Tl(e[a])||(o=e[a],a++);const c={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Tl(e[a])){const C=e[a];e[a]=null===(t=C.next)||void 0===t?void 0:t.bind(C),e[a+1]=null===(n=C.error)||void 0===n?void 0:n.bind(C),e[a+2]=null===(i=C.complete)||void 0===i?void 0:i.bind(C)}let u,f,v;if(r instanceof Gt)f=wt(r.firestore,Ot),v=Er(r._key.path),u={next:C=>{e[a]&&e[a](Fl(f,r,C))},error:e[a+1],complete:e[a+2]};else{const C=wt(r,Jt);f=wt(C.firestore,Ot),v=C._query;const j=new Kn(f);u={next:_e=>{e[a]&&e[a](new ei(f,j,C,_e))},error:e[a+1],complete:e[a+2]},ld(r._query)}return function(j,_e,Ve,Ke){const Ue=new Ls(Ke),lt=new za(_e,Ue,Ve);return j.asyncQueue.enqueueAndForget((0,T.A)(function*(){return Pa(yield Qr(j),lt)})),()=>{Ue.eu(),j.asyncQueue.enqueueAndForget((0,T.A)(function*(){return Ma(yield Qr(j),lt)}))}}(zt(f),v,c,u)}function ji(r,e){return function(n,i){const o=new et;return n.asyncQueue.enqueueAndForget((0,T.A)(function*(){return function Nf(r,e,t){return qa.apply(this,arguments)}(yield function vl(r){return Gs(r).then(e=>e.syncEngine)}(n),i,o)})),o.promise}(zt(r),e)}function Fl(r,e,t){const n=t.docs.get(e._key),i=new Kn(r);return new Zr(r,i,e._key,n,new fr(t.hasPendingWrites,t.fromCache),e.converter)}!function(e,t=!0){Ce=p.MF,(0,p.om)(new q.uA("firestore",(n,{instanceIdentifier:i,options:o})=>{const a=n.getProvider("app").getImmediate(),c=new Ot(new tt(n.getProvider("auth-internal")),new de(n.getProvider("app-check-internal")),function(f,v){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Y(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zn(f.options.projectId,v)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),c._setSettings(o),c},"PUBLIC").setMultipleInstances(!0)),(0,p.KO)(ct,"4.7.5",e),(0,p.KO)(ct,"4.7.5","esm2017")}();var Ut=y(51698),Gp=y(92834),$p=y(53793),Up=y(97252);let qp=(()=>{var r;class e{examSessions_read(n){var i=this;return new Ut.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var a=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=yield i._getDocument(c.data,"exam_sessions/"+n,i.getUserId());o.next({success:1,data:u,message:"successful"}),o.complete()}catch(v){console.log(v),o.next({success:0,data:"",message:""+v}),o.complete()}else o.next({success:0,data:"",message:c.message}),o.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_write(n,i){var o=this;return new Ut.c(a=>{this.getFirestoreDb(!1).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield o._saveDocument(u.data,"exam_sessions/"+n,o.getUserId(),i);a.next({success:1,data:f,message:"successful"}),a.complete()}catch(C){console.log(C),a.next({success:0,data:"",message:""+C}),a.complete()}else a.next({success:0,data:"",message:u.message}),a.complete()});return function(u){return c.apply(this,arguments)}}())})}examSessions_writeUserMap(n,i){var o=this;return new Ut.c(a=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success&&u.data)try{var f=yield o._saveDocumentMerge(u.data,"exam_sessions/"+n,"user_map",i);a.next({success:1,data:f,message:"successful"}),a.complete()}catch(C){console.log(C),a.next({success:0,data:"",message:""+C}),a.complete()}else a.next({success:0,data:"",message:u.message}),a.complete()});return function(u){return c.apply(this,arguments)}}())})}examSessions_delete(n){var i=this;return new Ut.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var a=(0,T.A)(function*(c){if(c&&1==c.success)try{yield i._removeDocument(c.data,"exam_sessions/"+n,i.getUserId()),o.next({success:1,data:"",message:"successful"}),o.complete()}catch(f){console.log(f),o.next({success:0,data:"",message:""+f}),o.complete()}else o.next({success:0,data:"",message:c.message}),o.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_subscribeUserMap(n){var i=this;return new Ut.c(o=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var a=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshot(c.data,"exam_sessions/"+n,"user_map",C=>{o.next({success:1,data:C,message:"successful"}),o.complete()});i.addUnsubscribe("exam_sessions_"+n,u)}catch(C){console.log(C),o.next({success:0,data:void 0,message:""+C}),o.complete()}else o.next({success:0,data:void 0,message:c.message}),o.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_subscribe(n){var i=this;return new Ut.c(o=>{this.getFirestoreDb(!1).subscribe(function(){var a=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshot(c.data,"exam_sessions/"+n,i.getUserId(),C=>{o.next({success:1,data:C,message:"successful"}),o.complete()});i.addUnsubscribe("exam_sessions_"+n,u)}catch(C){console.log(C),o.next({success:0,data:void 0,message:""+C}),o.complete()}else o.next({success:0,data:void 0,message:c.message}),o.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_unsubscribe(n){this.removeAllunsubscribe("exam_sessions_"+n)}examSessions_subscribeWithQuery(n,i){var o=this;return new Ut.c(i&&3==i.length?a=>{this.getFirestoreDb(!1).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=o.myOnSnapshotCollectionWithQuery(u.data,"exam_sessions/"+n,i,j=>{a.next({success:1,data:j,message:"successful"}),a.complete()});o.addUnsubscribe("exam_sessions_"+n,f)}catch(j){console.log(j),a.next({success:0,data:void 0,message:""+j}),a.complete()}else a.next({success:0,data:void 0,message:u.message}),a.complete()});return function(u){return c.apply(this,arguments)}}())}:a=>{a.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),a.complete(),a.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(n){var i=this;return new Ut.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var a=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshotCollection(c.data,"exam_live_teachers/"+n,f=>{o.next({success:1,data:f})});i.addUnsubscribe("exam_live_teachers_"+n,u)}catch(f){console.log(f),o.next({success:0,message:"EXCEPTION",ex:f.toString()})}else o.next(c)});return function(c){return a.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_teachers_"+n)}examLiveTeachers_teacher_saveChange(n,i){var o=this;return new Ut.c(a=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield o._saveDocument(u.data,"exam_live_teachers/"+n,o.getUserId(),i);a.next({success:1,data:f})}catch(v){console.log(v),a.next({success:0,message:"EXCEPTION",ex:v.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(n,i){var o=this;return new Ut.c(a=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield o._getDocuments(u.data,"exam_lives/"+n,i);a.next({success:1,data:f})}catch(v){console.log(v),a.next({success:0,message:"EXCEPTION",ex:v.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(n){var i=this;return new Ut.c(o=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var a=(0,T.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshot(c.data,"exam_live_students/"+n,i.getUserId(),f=>{o.next({success:1,data:f})});i.addUnsubscribe("exam_live_students_"+n,u)}catch(f){console.log(f),o.next({success:0,message:"EXCEPTION",ex:f.toString()})}else o.next(c)});return function(c){return a.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_teacher_subscribe(n,i){var o=this;return new Ut.c(a=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=o.myOnSnapshot(u.data,"exam_live_students/"+n,i,v=>{a.next({success:1,data:v})});o.addUnsubscribe("exam_live_students_"+n,f)}catch(v){console.log(v),a.next({success:0,message:"EXCEPTION",ex:v.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_student_saveChange(n,i){var o=this;return new Ut.c(a=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var c=(0,T.A)(function*(u){if(u&&1==u.success)try{var f=yield o._saveDocument(u.data,"exam_live_students/"+n,o.getUserId(),i);a.next({success:1,data:f})}catch(v){console.log(v),a.next({success:0,message:"EXCEPTION",ex:v.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(n,i,o){var a=this;return new Ut.c(c=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,T.A)(function*(f){if(f&&1==f.success)try{var v=yield a._saveDocumentMerge(f.data,"exam_live_students/"+n,i,o);c.next({success:1,data:v})}catch(C){console.log(C),c.next({success:0,message:"EXCEPTION",ex:C.toString()})}else c.next(f)});return function(f){return u.apply(this,arguments)}}())})}getFirestoreDb(n){return new Ut.c(i=>{var o=this.createFirestoreKey("firestore_db"),a=this.getLocalFirestoreDb(o);null!=a&&0==n?(i.next({success:1,data:a,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(u=>{u&&1==u.success?(0,fe.p)(this.getAuthApp(),u?.data?.token??"").then(()=>{var v=bl(this.app,d.c.firestoreDatabase);this.setLocalFirestoreDb(o,v),i.next({success:1,data:v,message:"successful"}),i.complete()}).catch(v=>{"auth/invalid-custom-token"===v.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:u.message??""}),i.complete())})})}getFirestoreDbForStudentExam(n,i){return new Ut.c(o=>{var a=this.createFirestoreKey("firestore_db_student_"+i),c=this.getLocalFirestoreDb(a);null!=c&&0==n?(o.next({success:1,data:c,message:"successful"}),o.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(i).subscribe(f=>{f&&1==f.success?(0,fe.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var C=bl(this.app,d.c.firestoreDatabase);this.setLocalFirestoreDb(a,C),o.next({success:1,data:C,message:"successful"}),o.complete()}).catch(C=>{"auth/invalid-custom-token"===C.code?(o.next({success:0,data:void 0,message:"EXPIRED"}),o.complete()):(o.next({success:0,data:void 0,message:"AUTH_ERROR"}),o.complete())}):(o.next({success:0,data:void 0,message:f.message??""}),o.complete())})})}getFirestoreDbForTeacherExam(n,i){return new Ut.c(o=>{var a=this.createFirestoreKey("firestore_db_teacher_"+i),c=this.getLocalFirestoreDb(a);null!=c&&0==n?(o.next({success:1,data:c,message:"successful"}),o.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(i).subscribe(f=>{f&&1==f.success?(0,fe.p)(this.getAuthApp(),f?.data?.token??"").then(()=>{var C=bl(this.app,d.c.firestoreDatabase);this.setLocalFirestoreDb(a,C),o.next({success:1,data:C,message:"successful"}),o.complete()}).catch(C=>{"auth/invalid-custom-token"===C.code?(o.next({success:0,data:void 0,message:"EXPIRED"}),o.complete()):(o.next({success:0,data:void 0,message:"AUTH_ERROR"}),o.complete())}):(o.next({success:0,data:void 0,message:f.message??""}),o.complete())})})}signInUserByToken(n){return new Ut.c(i=>{(0,fe.p)(this.getAuthApp(),n).then(()=>{i.next({success:1,data:"",message:"successful"}),i.complete()}).catch(o=>{"auth/invalid-custom-token"===o.code?(i.next({success:0,data:"",message:"EXPIRED"}),i.complete()):(i.next({success:0,data:"",message:"AUTH_ERROR"}),i.complete())})})}setLocalFirestoreDb(n,i){this.firestoreDbs[n]=i}getLocalFirestoreDb(n){if(this.firestoreDbs.hasOwnProperty(n))return this.firestoreDbs[n]}removeLocalFirestoreDb(n){this.firestoreDbs.hasOwnProperty(n)&&delete this.firestoreDbs[n]}createFirestoreKey(n){return this.userService.getUserObj().id+"_"+n}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(n,i){n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)||(this.listSubscribers[n]=[]),this.listSubscribers[n].push(i)}removeAllunsubscribe(n){if(n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)){for(var i=0;i<this.listSubscribers[n].length;i++)this.listSubscribers[n][i]();delete this.listSubscribers[n]}}_saveDocument(n,i,o,a){var c=this;return(0,T.A)(function*(){return i=c.getBaseFirestore()+"/"+i,yield yd(Xr(n,i,o),c.commonService.myClone(a)),o})()}_saveDocumentMerge(n,i,o,a){var c=this;return(0,T.A)(function*(){return i=c.getBaseFirestore()+"/"+i,yield yd(Xr(n,i,o),c.commonService.myClone(a),{merge:!0}),o})()}_getCollection(n,i){var o=this;return(0,T.A)(function*(){i=o.getBaseFirestore()+"/"+i;const a=ki(n,i);return(yield gd(a)).docs.map(f=>f.data())})()}_getDocument(n,i,o){var a=this;return(0,T.A)(function*(){i=a.getBaseFirestore()+"/"+i;const c=Xr(n,i,o),u=yield function Sp(r){r=wt(r,Gt);const e=wt(r.firestore,Ot);return function $h(r,e,t={}){const n=new et;return r.asyncQueue.enqueueAndForget((0,T.A)(function*(){return function(o,a,c,u,f){const v=new Ls({next:j=>{v.eu(),a.enqueueAndForget(()=>Ma(o,C));const _e=j.docs.has(c);!_e&&j.fromCache?f.reject(new Y(F.UNAVAILABLE,"Failed to get document because the client is offline.")):_e&&j.fromCache&&u&&"server"===u.source?f.reject(new Y(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(j)},error:j=>f.reject(j)}),C=new za(Er(c.path),v,{includeMetadataChanges:!0,ua:!0});return Pa(o,C)}(yield Qr(r),r.asyncQueue,e,t,n)})),n.promise}(zt(e),r._key).then(t=>Fl(e,r,t))}(c);return u.exists()?u.data():null})()}_getDocuments(n,i,o){var a=this;return(0,T.A)(function*(){var c={};i=a.getBaseFirestore()+"/"+i;const u=cd(ki(n,i),ud(function vp(){return new dr("__name__")}(),"in",o));return(yield gd(u)).forEach(v=>{c[v.id]=v.data()}),c})()}_removeDocument(n,i,o){var a=this;return(0,T.A)(function*(){i=a.getBaseFirestore()+"/"+i,yield function Rp(r){return ji(wt(r.firestore,Ot),[new Or(r._key,Vt.none())])}(Xr(n,i,o))})()}myOnSnapshot(n,i,o,a){return to(Xr(n,i=this.getBaseFirestore()+"/"+i,o),u=>{a(u.data())})}myOnSnapshotCollection(n,i,o){return to(ki(n,i=this.getBaseFirestore()+"/"+i),function(){var c=(0,T.A)(function*(u){var f=[];u.forEach(v=>{f.push(v.data())}),o(f)});return function(u){return c.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(n,i,o){return to(ki(n,i=this.getBaseFirestore()+"/"+i),function(){var c=(0,T.A)(function*(u){var f=[];u.docChanges().forEach(v=>{f.push(v.doc.data())}),o(f)});return function(u){return c.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(n,i,o,a){return to(cd(ki(n,i=this.getBaseFirestore()+"/"+i),ud(o[0],o[1],o[2])),function(){var f=(0,T.A)(function*(v){var C=[];v.docChanges().forEach(j=>{C.push(j.doc.data())}),a(C)});return function(v){return f.apply(this,arguments)}}())}getBaseFirestore(){return d.c.firestoreCollection}getInitApp(){return this.app}getAuthApp(){return(0,fe.xI)(this.app)}initFirestoreConfig(){return new Ut.c(n=>{this.firestoreSettingService.apiFirestoreSettingGetPublicKeyGet().subscribe(i=>{let o=d.c.firestoreConfig_app1;o.apiKey=i.data?.value??"",this.app=(0,ie.Wp)(o,"firestoreapp"),n.next(),n.complete()})})}constructor(n,i,o,a){this.firestoreServiceApi=n,this.userService=i,this.commonService=o,this.firestoreSettingService=a,this.firestoreDbs={},this.listSubscribers={}}}return(r=e).\u0275fac=function(n){return new(n||r)(h.KVO(Gp.B),h.KVO(_.R),h.KVO($p.R),h.KVO(Up.Z))},r.\u0275prov=h.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})(),Wp=(()=>{var r;class e{monitorAtTeacherDashboard(n){try{let i=s();if(typeof i>"u"||!i||!i.showMonitorTeacher)return;this.fireStoreService.initFirestoreConfig().subscribe(()=>{i.ver=this.monitorService.getMNoteVer();var o=this.userService.getUserObj();i.showMonitorTeacher({user:{token:o.rememberToken,userid:o.id,username:o.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live",urlExamResultGetLastExamResultOfStudentId:"ExamLivestream/GetLastExamResultOfStudentId"},roomid:n.roomId,examid:n.examId,userlist:n.userList,examconfig:n.examConfig,firebaseApp:this.fireStoreService,filetypeStr:n.fileTypeStr})})}catch(i){console.log(i)}}monitorAtStudentDashboard(n,i){try{let a=s();if(typeof a>"u"||!a)return;a.ver=this.monitorService.getMNoteVer();var o=this.userService.getUserObj();this.fireStoreService.initFirestoreConfig().subscribe(()=>{a.loadMonitor(()=>{if(!a.MonitorStudent)return;var c={user:{token:o.rememberToken,userid:o.id,username:o.fullName},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:n,element:"monitorScreen",examconfig:i,firebaseApp:this.fireStoreService,isStarted:!1};a.MonitorStudent.getInstance().prepairSession(c);let f=window.setInterval(()=>{let v=document.getElementById("monitorScreen");if(v){let C=v.getElementsByTagName("div")[0];C&&(C.setAttribute("class","mx-auto"),clearInterval(f))}},50)})})}catch(a){console.log(a)}}monitorAtTestPage(n,i,o){let a=s();if(typeof a>"u"||!a)return o(!1);var c=this.userService.getUserObj(),u=i;a.ver=this.monitorService.getMNoteVer(),this.fireStoreService.initFirestoreConfig().subscribe(()=>{a.loadMonitor(()=>{if(!a.MonitorStudent)return o(!1);var f={user:{token:c.rememberToken,userid:c.id,username:c.fullName,studentid:u?u.id:0,studentname:u?u.fullName:null},config:{domainApi:d.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:n.roomId,element:"monitorScreenTakeTest",examconfig:n.examConfig,examid:n.examId,firebaseApp:this.fireStoreService,resultid:n.resultId,isStarted:!0,clickFromIframeFunc:()=>{},clickFromIframeFuncCaller:this};a.MonitorStudent.getInstance().startSession(f),o(!0)})})}destroyMonitorAtStudentDashboard(){try{let i=s();if(typeof i>"u"||!i||!i.MonitorStudent)return;i.MonitorStudent.getInstance().stopSession()}catch(i){console.log(i)}}constructor(n,i,o){this.userService=n,this.monitorService=i,this.fireStoreService=o}}return(r=e).\u0275fac=function(n){return new(n||r)(h.KVO(_.R),h.KVO(x.Q),h.KVO(qp))},r.\u0275prov=h.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},42802:(ft,Ae,y)=>{"use strict";y.d(Ae,{Q:()=>h});var s=y(48891),d=y(55465);let h=(()=>{var _;class x{constructor(ie){this.envService=ie}getTmpVersionMonitor(){var ie=this.envService.getEnvValue("classliveUrl"),fe="1.0";if(ie){var p=ie.split("=");p.length>1&&(fe=p[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+fe}getMNoteVer(){var ie=this.envService.getEnvValue("classliveUrl"),fe="1.0";if(ie){var p=ie.split("=");p.length>1&&(fe=p[1])}return fe}checkValidForSetUpMonitor(){return!0}}return(_=x).\u0275fac=function(ie){return new(ie||_)(s.KVO(d.t))},_.\u0275prov=s.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),x})()},51935:(ft,Ae,y)=>{"use strict";y.d(Ae,{h:()=>dt});var s=y(91478),d=y(89163),h=y(33887),_=y(48891),x=y(54460),T=y(2915),ie=y(15343),fe=y(47348);const p=()=>({"mr-2":!0});function q(ae,at){if(1&ae&&(_.j41(0,"li"),_.EFF(1),_.k0s()),2&ae){const Le=at.$implicit;_.R7$(),_.SpI("* ",Le.message,"")}}function N(ae,at){1&ae&&(_.j41(0,"span",8),_.EFF(1),_.nI1(2,"mytranslate"),_.j41(3,"span",9),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.EFF(6),_.nI1(7,"mytranslate"),_.nI1(8,"mytranslate"),_.k0s()),2&ae&&(_.R7$(),_.SpI(" ",_.bMT(2,4,"lang_auto_click")," "),_.R7$(3),_.SpI('"',_.bMT(5,6,"lang_auto_tai_ve"),'"'),_.R7$(2),_.Lme(" ",_.bMT(7,8,"lang_auto_de_tai_ve")," ",_.bMT(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function R(ae,at){if(1&ae){const Le=_.RV6();_.j41(0,"button",17),_.bIt("click",function(){_.eBV(Le);const E=_.XpG();return _.Njj(E.onPressTrue())}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&ae&&(_.R7$(),_.SpI(" ",_.bMT(2,1,"lang_auto_tai_ve")," "))}let z=(()=>{var ae;class at extends h._{onPressTrue(){this.dialogRef.close(!0)}constructor(I,E){super(I,E),this.data=I,this.dialogRef=E,this.result=I.result}}return(ae=at).\u0275fac=function(I){return new(I||ae)(_.rXU(d.Vh),_.rXU(d.CP,8))},ae.\u0275cmp=_.VBU({type:ae,selectors:[["app-push-error-student-export-docx"]],features:[_.Vt3],decls:30,vars:25,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16",3,"ngClass"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(I,E){1&I&&(_.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",4)(7,"a",5),_.nrm(8,"lucide-icon",6),_.k0s()()(),_.j41(9,"div",7)(10,"span",8),_.EFF(11),_.nI1(12,"mytranslate"),_.j41(13,"span",9),_.EFF(14),_.k0s(),_.EFF(15),_.nI1(16,"mytranslate"),_.nI1(17,"lowercase"),_.k0s(),_.j41(18,"span",8),_.EFF(19),_.nI1(20,"mytranslate"),_.k0s(),_.j41(21,"azt-mat-dialog-content",10)(22,"ul",11),_.DNE(23,q,2,1,"li",12),_.k0s()(),_.DNE(24,N,9,12,"span",13),_.k0s(),_.j41(25,"div",14)(26,"a",15),_.EFF(27),_.nI1(28,"mytranslate"),_.k0s(),_.DNE(29,R,3,3,"button",16),_.k0s()()()),2&I&&(_.R7$(4),_.JRh(_.bMT(5,12,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),_.R7$(4),_.Y8G("ngClass",_.lJ4(24,p)),_.R7$(3),_.SpI(" ",_.bMT(12,14,"lang_auto_he_thong_tao_thanh_cong_cho")," "),_.R7$(3),_.Lme("",E.result.datas.length,"/",E.result.errs.length+E.result.datas.length,""),_.R7$(),_.SpI(" ",_.bMT(17,18,_.bMT(16,16,"lang_auto_hoc_sinh"))," "),_.R7$(4),_.SpI(" ",_.bMT(20,20,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),_.R7$(2),_.Y8G("defaultHeight",60),_.R7$(2),_.Y8G("ngForOf",E.result.errs),_.R7$(),_.Y8G("ngIf",E.result.datas.length>0),_.R7$(3),_.SpI(" ",_.bMT(28,22,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("ngIf",E.result.datas.length>0))},dependencies:[x.YU,x.Sq,x.bT,d.tx,T.U,ie.WGl,x.GH,fe.wp],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),at})();var S=y(10936),K=y(65080),B=y(68774),M=y(47712),w=y(5502),D=y(81587),Z=y(90796),ne=y(69135),re=y(14987);const oe=(ae,at)=>({"box-classrooms":ae,"box-max-classrooms":at});function Be(ae,at){if(1&ae&&(_.j41(0,"span",31),_.EFF(1),_.k0s()),2&ae){let Le;const I=_.XpG();_.R7$(),_.JRh(null!==(Le=null==I.studentsInClassResults[0].classObj?null:I.studentsInClassResults[0].classObj.name)&&void 0!==Le?Le:"")}}function Oe(ae,at){if(1&ae&&(_.j41(0,"div",36)(1,"div",18),_.nrm(2,"input",37),_.j41(3,"label",38,0),_.EFF(5),_.k0s()()()),2&ae){let Le;const I=at.$implicit,E=_.sdS(4),b=_.XpG(2);_.Y8G("hidden",1===b.studentsInClassResults.length),_.R7$(2),_.Mz_("id","select-classroom-export__",null==I.classObj?null:I.classObj.id,""),_.Y8G("value",null==I.classObj?null:I.classObj.id),_.R7$(),_.Mz_("for","select-classroom-export__",null==I.classObj?null:I.classObj.id,""),_.Y8G("matTooltip",null!==(Le=null==I.classObj?null:I.classObj.name)&&void 0!==Le?Le:"")("isDisabledTooltip",!1)("matTooltipDisabled",E.isDisabled),_.R7$(2),_.JRh(null==I.classObj?null:I.classObj.name)}}function Ze(ae,at){if(1&ae&&(_.j41(0,"div",32)(1,"ng-scrollbar",33)(2,"div",34),_.DNE(3,Oe,6,10,"div",35),_.k0s()()()),2&ae){const Le=_.XpG();_.Y8G("ngClass",_.l_i(3,oe,Le.form.controls.listStudents.controls.length>21||Le.studentsInClassResults.length>18,Le.form.controls.listStudents.controls.length<=21&&Le.studentsInClassResults.length>18)),_.R7$(),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",Le.studentsInClassResults)}}function Ie(ae,at){if(1&ae&&(_.j41(0,"label",38,0),_.EFF(2),_.k0s()),2&ae){const Le=_.sdS(1),I=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",I.controls.id.value,""),_.Y8G("matTooltip",I.controls.label.value)("isDisabledTooltip",!1)("matTooltipDisabled",Le.isDisabled),_.R7$(2),_.SpI(" ",I.controls.label.value," ")}}function ct(ae,at){if(1&ae&&(_.j41(0,"label",44),_.nrm(1,"img",45),_.k0s()),2&ae){const Le=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",Le.controls.id.value,""),_.R7$(),_.Y8G("nameImages",Le.controls.nameImages.value)}}function it(ae,at){if(1&ae){const Le=_.RV6();_.j41(0,"div",39)(1,"div",40)(2,"input",41),_.bIt("change",function(){_.eBV(Le);const E=_.XpG();return _.Njj(E.onChangeStudentOption())}),_.k0s(),_.DNE(3,Ie,3,6,"label",42)(4,ct,2,3,"label",43),_.k0s()()}if(2&ae){const Le=at.$implicit;_.R7$(),_.Y8G("formGroup",Le),_.R7$(),_.Mz_("id","select-classroom-export__",Le.controls.id.value,""),_.R7$(),_.Y8G("ngIf",Le.controls.label.value||!Le.controls.isImage.value),_.R7$(),_.Y8G("ngIf",!Le.controls.label.value&&Le.controls.isImage.value&&Le.controls.nameImages.value)}}function Ce(ae,at){1&ae&&(_.j41(0,"span",27),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&ae&&(_.R7$(),_.SpI("* ",_.bMT(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function ve(ae,at){if(1&ae){const Le=_.RV6();_.j41(0,"div",49),_.bIt("click",function(){_.eBV(Le);const E=_.XpG(2);return _.Njj(E.showAskInfo=!0)}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&ae&&(_.R7$(),_.SpI("+ ",_.bMT(2,1,"lang_testbank_test_config_add_information"),""))}function De(ae,at){if(1&ae&&(_.j41(0,"div"),_.nrm(1,"add-info-print",50),_.k0s()),2&ae){const Le=_.XpG(2);_.R7$(),_.Y8G("form",Le.form)}}function he(ae,at){1&ae&&(_.j41(0,"span",53),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&ae&&(_.R7$(),_.SpI("(",_.bMT(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function X(ae,at){if(1&ae){const Le=_.RV6();_.j41(0,"div",51),_.bIt("click",function(){_.eBV(Le);const E=_.XpG(2);return _.Njj(E.showAskInfo=!1)}),_.EFF(1),_.nI1(2,"mytranslate"),_.nI1(3,"mytranslate"),_.nI1(4,"lowercase"),_.DNE(5,he,3,3,"span",52),_.k0s()}if(2&ae){const Le=_.XpG(2);_.R7$(),_.Lme(" ",_.bMT(2,3,"lang_auto_huy")," ",_.bMT(4,7,_.bMT(3,5,"lang_testbank_test_config_add_information"))," "),_.R7$(4),_.Y8G("ngIf",Le.isAskInfo&&Le.showAskInfo)}}function be(ae,at){if(1&ae&&(_.j41(0,"div")(1,"span",46),_.EFF(2),_.nI1(3,"mytranslate"),_.k0s(),_.DNE(4,ve,3,3,"div",47)(5,De,2,1,"div",26)(6,X,6,9,"div",48),_.k0s()),2&ae){const Le=_.XpG();_.R7$(2),_.Lme("* ",_.bMT(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",Le.countStudentSelect,""),_.R7$(2),_.Y8G("ngIf",Le.isAskInfo&&!Le.showAskInfo),_.R7$(),_.Y8G("ngIf",Le.isAskInfo&&Le.showAskInfo),_.R7$(),_.Y8G("ngIf",Le.isAskInfo&&Le.showAskInfo)}}function Ge(ae,at){1&ae&&(_.j41(0,"div")(1,"div",15)(2,"span",27),_.EFF(3),_.nI1(4,"mytranslate"),_.k0s()()()),2&ae&&(_.R7$(3),_.SpI("* ",_.bMT(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let Pe=(()=>{var ae;class at extends h._{confirmAction(){const I=this.form.value,E=this.studentsInClassResults.find(b=>b.classObj?.id===I.classId);if(E){const b=I.listStudents?.filter(O=>O.choose).map(O=>O.id);E.results=E.results?.filter(O=>b?.includes(O.reId)),E.schoolName=this.showAskInfo?I.schoolName:void 0,E.subjectName=this.showAskInfo?I.subjectName:void 0,this.dialogRef.close(E)}else this.dialogRef.close()}setChangeSelectAll(){const I=this.form.controls.selectAll;if(I){I.setValue(!I.value);const E=this.form.controls.listStudents;E&&E.controls.forEach(b=>{b.controls.choose.setValue(I.value)}),this.countStudentSelect=I.value?E.controls.length:0}}onChangeStudentOption(){const I=this.form.controls.listStudents;let E=!0,b=0;I&&I.controls.forEach(W=>{!1===W.controls.choose.value?E=!1:b++});const O=this.form.controls.selectAll;O&&O.setValue(E),this.countStudentSelect=b}setupArrayStudent(I){this.currNameClass=I.classObj?.name??"";const E=this.form.controls.listStudents;if(E){E.clear();let b=I.results??[];if(void 0!==I.classObj?.sortType){let O=I.classObj?.sortType;b=0==O?this.sortService.sortFirstNameStudents(this.commonService.myClone(b)):99==O?this.sortService.sortTimeDESC(this.commonService.myClone(b)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone(b),"pos","id")}b.forEach(O=>{(O.confirmedAt||!this.data.examHasEssay&&1==O.status)&&E.push(new S.gE({isImage:new S.MJ(!!O.nameImages,{nonNullable:!0}),nameImages:new S.MJ(O.nameImages,{nonNullable:!0}),label:new S.MJ(O.fullName,{nonNullable:!0}),id:new S.MJ(O.reId,{nonNullable:!0}),choose:new S.MJ(!1,{nonNullable:!0})}))})}}classroomChange(I){this.setupArrayStudent(I)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let I=this.studentsInClassResults[0];this.form.controls.classId.setValue(I.classObj?.id),this.setupArrayStudent(I),this.form.controls.classId.valueChanges.subscribe(b=>{const O=this.form.controls.selectAll;O&&O.setValue(!1),this.countStudentSelect=0;const W=this.studentsInClassResults.find(G=>G.classObj?.id===b);W&&this.setupArrayStudent(W)})}}constructor(I,E,b){super(E,b),this.sortService=I,this.data=E,this.dialogRef=b,this.studentsInClassResults=[],this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=E.isAskInfo,this.studentsInClassResults=E.studentsInClassResults.map(O=>({...O,results:O.results?.map(W=>({...W,reId:K.P.generateIdRequired(10)}))})),this.form=new S.gE({classId:new S.MJ(0,{nonNullable:!0,validators:[S.k0.required]}),selectAll:new S.MJ(!1,{nonNullable:!0}),listStudents:new S.Yp([]),schoolName:new S.MJ("",{nonNullable:!0}),subjectName:new S.MJ("",{nonNullable:!0})})}}return(ae=at).\u0275fac=function(I){return new(I||ae)(_.rXU(B.g),_.rXU(d.Vh),_.rXU(d.CP,8))},ae.\u0275cmp=_.VBU({type:ae,selectors:[["app-select-student-to-export-docx"]],features:[_.Vt3],decls:48,vars:35,consts:[["c","isDisabled"],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"change","checked"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"change","id"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(I,E){1&I&&(_.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",5)(7,"a",6),_.nrm(8,"lucide-icon",7),_.k0s()()(),_.j41(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11),_.EFF(13),_.nI1(14,"mytranslate"),_.DNE(15,Be,2,1,"span",12),_.k0s()(),_.DNE(16,Ze,4,6,"div",13),_.j41(17,"div",14)(18,"div",15)(19,"div",16),_.EFF(20),_.nI1(21,"mytranslate"),_.k0s()(),_.j41(22,"div",17)(23,"div",18)(24,"input",19),_.bIt("change",function(){return E.setChangeSelectAll()}),_.k0s(),_.j41(25,"label",20),_.EFF(26),_.nI1(27,"mytranslate"),_.k0s()()(),_.j41(28,"div",21)(29,"ng-scrollbar",22)(30,"div",23),_.DNE(31,it,5,5,"div",24),_.k0s()()(),_.j41(32,"div",15),_.DNE(33,Ce,3,3,"span",25)(34,be,7,7,"div",26),_.k0s()(),_.j41(35,"div",14)(36,"div",15)(37,"span",27),_.EFF(38),_.nI1(39,"mytranslate"),_.k0s()()()(),_.DNE(40,Ge,5,3,"div",26),_.k0s(),_.j41(41,"div",28)(42,"a",29),_.EFF(43),_.nI1(44,"mytranslate"),_.k0s(),_.j41(45,"button",30),_.bIt("click",function(){return E.confirmAction()}),_.EFF(46),_.nI1(47,"mytranslate"),_.k0s()()()()),2&I&&(_.R7$(4),_.JRh(_.bMT(5,21,"lang_testbank_what_to_export_select_students_export")),_.R7$(6),_.Y8G("formGroup",E.form)("hidden",0===E.studentsInClassResults.length),_.R7$(),_.Y8G("hidden",1===E.studentsInClassResults.length&&null==E.studentsInClassResults[0].classObj),_.R7$(2),_.SpI(" ",_.bMT(14,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),_.R7$(2),_.Y8G("ngIf",1===E.studentsInClassResults.length),_.R7$(),_.Y8G("ngIf",E.studentsInClassResults.length>1),_.R7$(),_.Y8G("hidden",0===E.form.controls.listStudents.controls.length),_.R7$(3),_.SpI("",_.bMT(21,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),_.R7$(4),_.Y8G("checked",E.form.controls.selectAll.value),_.R7$(2),_.JRh(_.bMT(27,27,"lang_auto_chon_tat_ca")),_.R7$(3),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",E.form.controls.listStudents.controls),_.R7$(2),_.Y8G("ngIf",0===E.countStudentSelect),_.R7$(),_.Y8G("ngIf",E.countStudentSelect>0),_.R7$(),_.Y8G("hidden",E.form.controls.listStudents.controls.length>0),_.R7$(3),_.SpI("* ",_.bMT(39,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),_.R7$(2),_.Y8G("ngIf",0===E.studentsInClassResults.length),_.R7$(3),_.SpI(" ",_.bMT(44,31,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("disabled",0===E.countStudentSelect),_.R7$(),_.SpI(" ",_.bMT(47,33,"lang_cms_common_confirm_btn")," "))},dependencies:[x.YU,x.Sq,x.bT,d.tx,M.oV,w.Yh,S.qT,S.me,S.Zm,S.Fm,S.BC,S.cb,S.j4,S.JD,S.v8,D.t,Z.y,ne.f,re.i,ie.WGl,x.GH,fe.wp],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),at})();var Ne=y(28023),qe=y(5382),Se=y(64198),xe=y(25539),F=y(81234),Y=y(92229),et=y(14490),Xe=y(50622),Qe=y(91640),ke=y(41325),tt=y(58112),st=y(51113),rt=y(53393),xt=y(99927),de=y(99172),$e=y(10933),Te=y(53793),k=y(42801),P=y(78472),H=y(87515),We=y(10296),Je=y(46899),ze=y(32610);let dt=(()=>{var ae;class at{processHomeworks(I,E){return new Promise((b,O)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(E).subscribe(W=>{if(1==W.success){this.logger.remove();var G=[];W.data?.studentObjs.forEach(te=>{G.push({id:te.id,fullName:te.fullName,confirmedAt:te.confirmedAt,homeworkAnswerId:te.answer?.id,studentId:void 0,resultId:void 0,userId:void 0,nameImages:void 0,reId:"",status:void 0})}),this.sAztDialogService.open(Pe,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:W.data?.classroomObj,results:G,schoolName:void 0,subjectName:void 0}],examHasEssay:!1,isAskInfo:!1}}).afterClosed().subscribe(te=>{if(te){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===te.results?.length?"":te.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const we=new Y.Y(!0);this.logger.pushChild(we),this.loadLibAction(we).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===te.results?.length?"":te.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const pe=new Y.Y(!0);this.logger.pushChild(pe);const ee=new qe.n(1,{function:(ue,ye,Re)=>{pe.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===ye?"":"th\u1ee9 "+(ue+1)} ${Re?": "+Re:""}`)}});te.results?.forEach(ue=>{const ye=new Y.Y;pe.pushChild(ye),ee.addTask(this,this.makeFileHomework,[E,ue,ye],ue.fullName??"")}),ee.start().then(ue=>{pe.remove(),0===ue.errs.length?this.finishHomework(te.classObj?.name??"",W.data?.homeworkObj?.name??"",ue,b,O):(this.logger.remove(),this.sAztDialogService.open(z,{data:{result:ue},restoreFocus:!1}).afterClosed().subscribe(ye=>{ye&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(te.classObj?.name??"",W.data?.homeworkObj?.name??"",ue,b,O))}))})}).catch(pe=>{this.logger.remove(),O(pe)})}})}else this.logger.remove(),O(new Error(this.commonService.myTranslateInstant(W.message)))})})}processClasses(I,E){return new Promise((b,O)=>{let W;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),E){case"highest":W=this.testedListApiService.getTestedHighestMark("export_tool",I);break;case"first":W=this.testedListApiService.getTestedFirstMark("export_tool",I);break;default:W=this.testedListApiService.getTestedLastMark("export_tool",I)}W.subscribe(G=>{if(1==G.success){this.logger.remove();let te=!!G.data?.questionObjs?.filter(pe=>this.answerTypeService.isEssayAnswer(pe)).length,we=[];if(G.data?.studentsInClassResults?.forEach(pe=>{let ee=[];pe.results?.forEach(ue=>{ee.push({id:ue.id?Number(ue.id):void 0,fullName:ue.fullName??"",confirmedAt:ue.confirmedAt,studentId:ue.studentId?Number(ue.studentCode):void 0,resultId:ue.resultId,userId:ue.userId?.toString(),nameImages:ue.nameImages,reId:"",status:ue.status})}),we.push({classObj:pe.classObj,results:ee,schoolName:void 0,subjectName:void 0})}),G.data?.studentsNotInClassResults&&G.data?.studentsNotInClassResults?.length>0){let pe=[];G.data.studentsNotInClassResults.forEach(ee=>{pe.push({id:ee.id?Number(ee.id):void 0,fullName:ee.fullName??"",confirmedAt:ee.confirmedAt,studentId:ee.studentId?Number(ee.studentCode):void 0,resultId:ee.resultId,userId:ee.userId?.toString(),nameImages:ee.nameImages,reId:"",status:ee.status})}),we.push({classObj:{id:0,name:this.commonService.myTranslateInstant("lang_auto_tu_do")??""},results:pe,schoolName:void 0,subjectName:void 0})}this.sAztDialogService.open(Pe,{data:{studentsInClassResults:we,examHasEssay:te,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(pe=>{pe?this.sAztDialogService.open(et.T,{data:{transactionType:"export-docx",times:pe.results?.length,returnUrl:this.commonService.getCurrentUrlWithoutLocale()},hasBackdrop:!1}).afterClosed().subscribe(ee=>{if("cancel"==ee||"upgrade"==ee)return this.logger.remove(),void b();this.expandInfoParse=this.commonService.castJsonToObj(G.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===pe.results?.length?"":pe.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(I,pe,pe.classObj?.name??"",G.data?.examObj,pe.classObj?.id).then(()=>{this.logger.remove(),b()}).catch(ye=>{this.logger.remove(),O(ye)})}):(this.logger.remove(),b())})}else this.logger.remove(),O(new Error(this.commonService.myTranslateInstant(G.message)??""))})})}processUser(I,E,b,O,W,G=!0,te,we,pe,ee,ue){return new Promise((ye,Re)=>{this.reset(),W=W||this.logger,W?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const je=new Y.Y(!0);W?.pushChild(je),this.loadLibAction(je).then(()=>{W?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(I,b??"",O??"",E,ue).subscribe(Me=>{if(1==Me.success){this.expandInfoParse=this.commonService.castJsonToObj(Me.data?.examObj?.expandInfo??"{}")??{},W?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let ot=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const $=Me.data?.studentObj;W?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${$?.fullName??""}`);let _t="";_t=Me.data?.classroomObj?Me.data?.classroomObj.name??ot:ot;const ut=Me.data?.examTracks,vt=Me.data?.examObj,Zt=Me.data?.examResultObj,Rt=this.commonService.castJsonToClassObjs(xe.I,JSON.stringify(Me.data?.questionObjs))??[];let Bt=0,en=0;for(let bt=0;bt<Rt.length;bt++)Rt[bt].correctAnswer=this.commonService.isExistInArray(Me.data?.correctQuestionIds,Rt[bt].id),Rt[bt].indexLabel=bt+(vt?.startQuestionIndex??1),vt?.resetQuestionIndex&&Rt[bt].groupInfo&&Rt[bt].groupInfo?.groupId&&(Rt[bt].groupInfo&&Bt!=Rt[bt].groupInfo?.groupId&&(Bt=Rt[bt].groupInfo?.groupId??0,en=0),Rt[bt].labelIndex=en+(vt?.startQuestionIndex??1),en++);const tn={};let _n=this.commonService.castJsonToObj(Me.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(_n??[],tn);const qt=new Y.Y;W?.pushChild(qt),this.processConvertDataUser(qt,Rt,$,Zt).then(bt=>{if(bt){var En=0;this.convertDataMarkNote(bt?.resultTeacherDraw).then(U=>{this.loadTeacherDrawResult(U,W??new Y.Y,$?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",bt).then(He=>{bt=He,qt.remove();const V=new Y.Y(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+`...${En}%`);W?.pushChild(V);let Fe=[];Fe.push({content:this.getLineInfoData(_t,vt,ut,Zt,$,Rt,bt,te,we).join("<br/>")+"<br/><br/><br/>",answers:[]}),Fe=Fe.concat(this.startGenUserLineFile(Zt,Rt,bt,pe,ee));var Ye=0;this.sAztDocxService.exportToDocxBinary((0,F.Wn)(Fe),{isHeadless:!0},(Kt,mn,nn)=>{new Promise(Fn=>{setTimeout(()=>{0==Kt&&(En=Ye),Ye=Kt/mn*50+En;const gn=this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+"..."+Math.floor(Ye)+"%";V?.pushMsg(gn)}),Fn(!0)})}).then(Kt=>{const mn=new Blob([Kt],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let nn=this.commonService.createFileNameExportFile([$?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",Zt?.id?Zt.id.toString():""])+"_test_result";if(G)if(bt.mediaAnswerWraps.concat(bt.mediaWraps).length>0){const Fn=new s;Fn.file(nn+".docx",mn),bt.mediaAnswerWraps.concat(bt.mediaWraps).forEach(gn=>{const wr=new Blob([gn]);Fn.file("attachments/"+this.replaceParamFileName(gn.name),wr)}),Fn.generateAsync({type:"blob"}).then(gn=>{let wr=this.commonService.createFileNameExportFile([_t,nn])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(gn,wr),W?.remove(),ye()},gn=>{W?.remove(),ye(gn)})}else this.shareFileFlutterService.shareFileWithBlob(mn,nn+".docx"),W?.remove(),ye();else W?.remove(),ye({name:nn,blob:mn,medias:bt.mediaAnswerWraps.concat(bt.mediaWraps)})})})})}}).catch(bt=>{W?.remove(),Re(bt)})}else W?.remove(),Re(new Error(this.commonService.myTranslateInstant(Me.message)))})}).catch(Me=>{W?.remove(),Re(Me)})})}finishClassroom(I,E,b,O,W){if(b.length>1){const G=new s;b.forEach(te=>{te.medias.length>0?(G.file(te.name+"/"+te.name+".docx",te.blob),te.medias.forEach(we=>{const pe=new Blob([we]);G.file(te.name+"/attachments/"+this.replaceParamFileName(we.name),pe)})):G.file(te.name+".docx",te.blob)}),G.generateAsync({type:"blob"}).then(te=>{let we=this.commonService.createFileNameExportFile([I,E])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(te,we),O()},te=>{O(te)})}else if(b[0].medias.length>0){const G=new s;G.file(b[0].name+"/"+b[0].name+".docx",b[0].blob),b[0].medias.forEach(te=>{const we=new Blob([te]);G.file(b[0].name+"/attachments/"+this.replaceParamFileName(te.name),we)}),G.generateAsync({type:"blob"}).then(te=>{let we=this.commonService.createFileNameExportFile([I,E])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(te,we),O()},te=>{O(te)})}else this.shareFileFlutterService.shareFileWithBlob(b[0].blob,b[0].name+".docx"),O()}finishHomework(I,E,b,O,W){if(1===b.datas.length)if(b.datas[0].medias.length>0){const G=new s;G.file(b.datas[0].name+"/"+b.datas[0].name+".docx",b.datas[0].blob),b.datas[0].medias.forEach(te=>{const we=new Blob([te]);G.file(b.datas[0].name+"/attachments/"+this.replaceParamFileName(te.name),we)}),G.generateAsync({type:"blob"}).then(te=>{let we=this.commonService.createFileNameExportFile([I,b.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(te,we),O()},te=>{this.logger.remove(),O(te)})}else this.shareFileFlutterService.shareFileWithBlob(b.datas[0].blob,b.datas[0].name+".docx"),this.logger.remove(),O();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const G=new s;b.datas.forEach(te=>{te.medias.length>0?(G.file("results/"+te.name+"/"+te.name+".docx",te.blob),te.medias.forEach(we=>{const pe=new Blob([we]);G.file("results/"+te.name+"/attachments/"+this.replaceParamFileName(we.name),pe)})):G.file("results/"+te.name+".docx",te.blob)}),G.generateAsync({type:"blob"}).then(te=>{let we=this.commonService.createFileNameExportFile([I,E])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(te,we),this.logger.remove(),O()},te=>{this.logger.remove(),W(te)})}}makeFileHomework(I,E,b){return new Promise((O,W)=>{b.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(I,E.homeworkAnswerId??0).subscribe(G=>{if(b.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(G.data?.answerObj),G.data?.answerObj){b.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let we=this.commonService.castJsonToObj(G.data.answerObj.result??"")??{};this.convertDataMarkNote(we).then(pe=>{this.loadTeacherDrawResult(pe,b,E.fullName??"").then(ee=>{b.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let ue=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${G.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${G.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${G.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${G.data?.answerObj?.id} <br/>`].forEach(Re=>{ue.push({content:Re,answers:[]})});let ye=this.commonService.castJsonToObj(G.data?.answerObj?.resultNote??"");if(ye){const Re=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],je=document.createElement("p");je.innerText=this.commonService.myTranslateInstant("lang_point")??"",je.setAttribute("docx-style",F.$s.get("TB_RESULT_TXT"));const Me=document.createElement("p");let ot=G.data?.answerObj?.point;Re.forEach(ut=>{ut.mark===ot&&(ot=this.commonService.myTranslateInstant(ut.lang))}),Me.innerText=ot?.toString()??"",Me.setAttribute("docx-style",F.$s.get("TB_RESULT_POINT"));const $=document.createElement("p");$.setAttribute("docx-style",F.$s.get("TB_RESULT_TXT")),$.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const _t=document.createElement("span");_t.setAttribute("docx-style",F.$s.get("TB_RESULT_COMMENT")),0===ye?.IsHideMark&&(_t.innerText=this.getTextContentInTagHTML(ye.Note),ee.resultTeacherDraw?.commentEmoji&&(_t.appendChild(document.createElement("br")),ee.resultTeacherDraw.commentEmoji.forEach(ut=>{if(ee.canvasList[ut]){const vt=new Image;vt.src=ee.canvasList[ut].toDataURL(),vt.style.width=ee.canvasList[ut].width/5+"px",vt.style.height=ee.canvasList[ut].height/5+"px",_t.appendChild(vt)}}))),ue.push({content:F.$s.makeHeaderTable([je,Me],[$,_t]),answers:[]})}ue=ue.concat(this.getLineImageAnswer(ee)),this.sAztDocxService.exportToDocxBinary((0,F.Wn)(ue),{isHeadless:!0},(Re,je,Me)=>{}).then(Re=>{b.remove();const je=new Blob([Re],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let Me=`${this.commonService.convertVietnameseToEnglish(E.fullName??"")}_${G.data?.answerObj?.id??0}`;O({name:Me,blob:je,medias:ee.mediaAnswerWraps.concat(ee.mediaWraps)})})}).catch(ee=>{b.remove(),W(ee)})})}else b.remove(),W(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(I,E,b,O,W){return new Promise((G,te)=>{const we=new qe.n(1,{function:(ue,ye)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===ye?"":` (${ue+1}/${ye})`}`),this.logger.percent=ue/ye}},1e3),pe=[];let ee=this.homeworkExamService.isOfflineExam(O);E.results?.forEach(ue=>{we.addTask(this,()=>new Promise((ye,Re)=>{const je=new Y.Y(!0,"");this.logger.pushChild(je),this.processUser(I,Number(ue.resultId),ue.userId,ue.studentId?.toString(),je,!1,E.schoolName,E.subjectName,ee,void 0,W).then(Me=>{Me?(je.remove(),pe.push(Me),ye()):(je.remove(),Re(new Error))}).catch(Me=>{je.remove(),Re(Me)})}))}),we.start().then(ue=>{ue.errs.length>0?(this.logger.remove(),ue.datas=pe,this.sAztDialogService.open(z,{data:{result:ue},restoreFocus:!1}).afterClosed().subscribe(ye=>{ye&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom(b,O?.name??"",pe,G,te))})):this.finishClassroom(b,O?.name??"",pe,G,te)})})}processConvertDataUser(I,E,b,O){return new Promise((W,G)=>{let te={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},we=(this.commonService.myParseJson(O?.files??"[]")??[]).filter(Me=>(0,Se.rl)(Me.mimes??"")||(0,Se.nL)(Me.mimes??""));I.start();const je=new qe.n(1,{function:(Me,ot,$)=>{I.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${Me+1}/${ot}: ${$}`)}});je.addTask(this,()=>new Promise((Me,ot)=>{const $=new Y.Y(!0);I.pushChild($),this.questionRenderService.parseRenderQuestions(E,_t=>{$.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(_t)}%`)},void 0,50,!0).then(()=>{$.remove(),Me()}).catch(_t=>{const ut=vt=>{Object.prototype.hasOwnProperty.call(vt,"type")&&"LOAD_IMAGE"===vt.type?ot(new Error(`${vt.message} ${this.commonService.trimMidLimitLength(vt.data[0],30)}`)):ot(_t)};$.remove(),Array.isArray(_t)?ut(_t[0]):ut(_t)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),O&&O.result&&je.addTask(this,()=>new Promise((Me,ot)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj(O?.result??"")??{},I,b?.fullName??"").then($=>{te=$,Me()}).catch($=>{ot($)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),je.addTask(this,()=>new Promise((Me,ot)=>{b?this.loadNameImage(b).then($=>{b=$,Me()}).catch($=>{ot($)}):ot(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),te.isExportMedia&&je.addTask(this,()=>new Promise((Me,ot)=>{const $=new Y.Y(!0);I.pushChild($);const _t=new qe.n(3,{function:(ut,vt)=>{$.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${ut}/${vt})`)}},100);E.forEach(ut=>{ut.attachments&&ut.attachments.length>0&&ut.attachments.forEach(vt=>{_t.addTask(this,this.loadAztFile,[vt,te,"att"])})}),_t.start().then(ut=>{0===ut.errs.length?($.remove(),Me()):($.remove(),ot(ut.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),we.length&&je.addTask(this,()=>new Promise((Me,ot)=>{const $=new Y.Y(!0);I.pushChild($);const _t=new qe.n(3,{function:(ut,vt)=>{$.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${ut}/${vt})`)}},100);we.forEach(ut=>{_t.addTask(this,this.loadAztFile,[ut,te,"ans"])}),_t.start().then(ut=>{0===ut.errs.length?($.remove(),Me()):($.remove(),ot(ut.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem_tu_luan")),je.start().then(Me=>{I.remove(),0===Me.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(E,O),W(te)):G(Me.errs[0])})})}hasMultiple(I){let E=!1;for(let b=0;b<I.length;b++)if(this.answerTypeService.isOneChoiceAnswer(I[b])){E=!0;break}return E}hasEssay(I){let E=!1;for(let b=0;b<I.length;b++)if(this.answerTypeService.isEssayAnswer(I[b])){E=!0;break}return E}getLineInfoData(I,E,b,O,W,G,te,we,pe){const ee=[];ee.push(F.$s.makeHeaderTable([F.$s.createLineCenterBold(we||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toUpperCase()} }`)],[F.$s.createLineCenterBold(E?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),F.$s.createLineCenterBold(pe||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),F.$s.createLineCenterBold(E?.minutes&&E?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+E?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const ue=G.filter(ye=>this.answerTypeService.isEssayAnswer(ye)).length;return W&&W.nameImages&&parseInt(W?.id??"0")<=0?ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${W?.nameImages.url}" />`):ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${W?.fullName}`),ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${I}`),E?.subjectMarks&&O?.subjectMarkValues&&O.subjectMarkValues.forEach((ye,Re)=>{ee.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${Re+1} </b>: ${ye}/10`)}),this.hasMultiple(G)&&ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${O?.trueFalseMark} (${O?.rightAnswer}/${(O?.totalQuestion??0)-ue} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(G)&&ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${O?.essayMark+" ("+ue+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(G)&&te.resultTeacherDraw&&ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj(O?.files??"")?.length??"0"}`),b&&0!=E?.autoMonitor&&(ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${b.exitFullScreen}`),ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${b.blurWindow}`)),ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${O?.id}`),ee}startGenUserLineFile(I,E,b,O,W){let G=[];const te=this.commonService.castJsonToObj(I?.answers??"");return te&&E.forEach((we,pe)=>{we.groupInfo&&we.groupInfo.isFirstInGroup&&G.push({content:`<br/><b>${we.groupInfo.groupContent}</b><br/>`,answers:[]}),we.attachments&&b.isExportMedia&&we.attachments.forEach(ue=>{G.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(ue.name)}]`,answers:[]})}),G=G.concat(this.genLineQuestion(we,O));const ee=this.mapQuestResultObj(we,te??[]);switch(we.answerType){case 1:G=G.concat(this.genLineAnswerType1(we,ee));break;case 3:let ue=I?.confirmedAt?new Ne.X(this.commonService).parserEssayResult(I.essayResult):[],ye=(I?.confirmedAt?I?.essayAnswerObjs:[])??[],Re=ue.find(Me=>Me.questionIndex==pe),je=ye.find(Me=>Me.questionId==we.id)??{questionId:we.id,comment:void 0,mark:Re?.questionMark};G=G.concat(this.genLineAnswerType3(we,ee,{questionId:we.id,comment:je?.comment,mark:je?.mark??0}));break;case 4:G=G.concat(this.genLineAnswerType4(we,ee));break;case 5:G=G.concat(this.genLineAnswerTrueFalseType5(we,ee))}W&&we.help&&G.push({content:`<br/><b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b> ${we.help}<br/><br/>`,answers:[]})}),this.hasEssay(E)&&(G=G.concat(this.getLineImageAnswer(b))),G}genLineQuestion(I,E){const b=[];let O=this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"),W=this.answerTypeService.isFillAnswer(I)?this.commonService.myTranslateInstant("azt_lang_sugg_type_fill_blank"):this.answerTypeService.isEssayAnswer(I)?this.commonService.myTranslateInstant("azt_lang_sugg_type_essay"):this.commonService.myTranslateInstant("azt_lang_sugg_type_multiple_choice"),G={content:"<b>"+O+" "+(I.labelIndex??I.indexLabel??1)+". "+(E?`(${W})`:"")+"</b> "+(I.content?.includes("<img")?"<br/>":"")+I.content,answers:E&&(this.answerTypeService.isFillAnswer(I)||this.answerTypeService.isEssayAnswer(I))?[]:this.convertAnswerQuestion(I.answers??[],!!this.answerTypeService.isTrueFalseAnswer(I))};return b.push(G),b}mapQuestResultObj(I,E){return E.find(O=>O.QuestionId===I.id)||{QuestionId:I.id??0,AnswerContent:[]}}convertAnswerQuestion(I,E){let b=[];return I.forEach(O=>{let W=O.alpha?O.alpha:O.key,G="<b>     "+(E?W.toLocaleLowerCase()+")":W)+".</b> "+O.content;b.push(G)}),b}genLineAnswerType1(I,E){const b=document.createElement("table"),O=I.correctAnswer?F.JP:F.ep;b.setAttribute("docx-style",F.$s.get("TABLE"));const W=[],G=document.createElement("tr");b.appendChild(G);const te=document.createElement("td");te.setAttribute("docx-style",F.$s.get("CORRECT",[{key:F.Xe,value:O}]));const we=document.createElement("span"),pe=I.answers?I.answers.filter(ye=>I.answerResult?.includes(ye.key)).map(ye=>ye.alpha??ye.key).join(" & "):I.answerResult?.join(" & ");we.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+pe,we.setAttribute("color",O),te.appendChild(we),G.appendChild(te);const ee=document.createElement("span"),ue=document.createElement("span");return ee.innerText="\u2713",ee.setAttribute("color",F.JP),ue.innerText="\u2717",ue.setAttribute("color",F.ep),I.answers?.forEach((ye,Re)=>{const je=document.createElement("td"),Me=document.createElement("span"),ot=[{key:F.Xe,value:O}];ot.push({key:F.n1,value:Re+1===I.answers?.length?O:"FFFFFF"}),je.setAttribute("docx-style",F.$s.get("KEY_RESULT",ot)),Me.innerText=ye.alpha??ye.key,E.AnswerContent.filter(_t=>_t.Content===ye.key).length>0&&je.appendChild(I.correctAnswer?ee:ue),je.appendChild(Me),G.appendChild(je)}),W.push({content:`<br>${b.outerHTML}<br><br><br>`,answers:[]}),W}genLineAnswerTrueFalseType5(I,E){const b=[],O=I.correctAnswer?F.JP:F.ep,W=this.commonService.myTranslateInstant("lang_auto_dung"),G=this.commonService.myTranslateInstant("lang_auto_sai"),te=this.sAztAnswerTrueFalseService.checkLabelKeys([],I?.answers,I?.answerResult),we=(ot,$)=>{const _t=document.createElement("span");return _t.innerText=ot,_t.setAttribute("color",$),_t},ue=document.createElement("table");ue.setAttribute("docx-style",F.$s.get("TABLE"));const ye=document.createElement("tr"),Re=we(this.commonService.myTranslateInstant("lang_auto_dap_an")??"",O),je=document.createElement("td"),Me=[{key:F.Xe,value:O}];return Me.push({key:F.n1,value:O}),je.setAttribute("docx-style",F.$s.get("KEY_RESULT",Me)),I.answers?.forEach(ot=>{const $=this.sAztAnswerTrueFalseService.checkIsTrueType5(ot,te,E.AnswerContent),_t=this.commonService.myTranslateInstant(this.sAztAnswerTrueFalseService.getAnswerChoiceTrueFalseQuestion(ot,E.AnswerContent))??"";je.appendChild(((ot,$,_t)=>{const ut=document.createElement("div"),vt=document.createElement("span"),Zt=$?F.JP:F.ep;return vt.innerText=(ot.alpha??ot.key).toLowerCase()+"-",ut.appendChild(we($?"\u2713":"\u2717",Zt)),ut.appendChild(vt),ut.appendChild(we(_t??"",Zt)),ut})(ot,$,_t)),je.appendChild(document.createElement("br"))}),ye.appendChild(((ot,$)=>{const _t=document.createElement("td");return _t.appendChild(ot),I.answers.length&&I.answers.forEach(ut=>{const vt=document.createElement("span");vt.setAttribute("color",this.sAztAnswerTrueFalseService.checkIsTrueType5(ut,te,E.AnswerContent)?F.JP:F.ep),vt.innerText=` ${(ut.alpha?ut.alpha:ut.key?ut.key:ut).toString().toLowerCase()}-${te.includes((ut.alpha?ut.alpha:ut.key?ut.key:"")+"T")?W:G} `,_t.appendChild(vt)}),_t.setAttribute("docx-style",$),_t})(Re,F.$s.get("CORRECT",[{key:F.Xe,value:O}]))),ye.appendChild(je),ue.appendChild(ye),b.push({content:`<br>${ue.outerHTML}<br><br><br><br><br><br>`,answers:[]}),b}genLineAnswerType3(I,E,b){const O=[];return O.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/><br/>`,answers:[]}),0===E.AnswerContent.length?O.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):E.AnswerContent.forEach(W=>{O.push({content:`<span>${W.Content}</span>`,answers:[]})}),O.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${b.mark??0} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${I.scorePerQuestion})</b>`,answers:[]}),O.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_nhan_xet")}:</b> ${b.comment??""}`,answers:[]}),O}genLineAnswerType4(I,E){const b=document.createElement("table"),O=I.correctAnswer?F.JP:F.ep;b.setAttribute("docx-style",F.$s.get("TABLE"));const W=[],G=document.createElement("tr");G.setAttribute("docx-style",F.$s.get("TR")),b.appendChild(G);const te=document.createElement("td");te.setAttribute("docx-style",F.$s.get("CORRECT",[{key:F.Xe,value:O}]));const we=document.createElement("span");we.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+I.answerResult?.join(";")+"]",we.setAttribute("color",O),te.appendChild(we),G.appendChild(te),0===E.AnswerContent.length&&E.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const pe=document.createElement("td"),ee=document.createElement("span");return pe.setAttribute("docx-style",F.$s.get("FILL_RESULT",[{key:F.Xe,value:O}])),ee.innerText=E.AnswerContent.map(ye=>ye.Content).join(";"),pe.appendChild(ee),G.appendChild(pe),W.push({content:`<br>${b.outerHTML}<br><br><br>`,answers:[]}),W}loadNameImage(I){return new Promise((E,b)=>{I&&I.nameImages&&parseInt(I?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(I.nameImages).then(O=>{O&&I.nameImages&&(I.nameImages.url=O),E(I)}).catch(O=>{b(O)}):E(I)})}loadCssFrameAction(){return new Promise(I=>{const E=document.createElement("div"),b=O=>{const W=document.createElement("span");return W.style.fontFamily=O,W.innerText="Aa",W};E.appendChild(b("font_chu_dep")),E.appendChild(b("font_chu_dep_z")),E.appendChild(b("font_chu_in")),E.appendChild(b("font_chu_in_nghieng")),E.appendChild(b("font_chu_in_dam")),E.style.opacity="0",document.body.appendChild(E),setTimeout(()=>{E.remove(),I()},2e3)})}loadLibAction(I){return new Promise((E,b)=>{this.commonService.loadAzotaDocxJs().then(()=>{const O=new qe.n(1,{function:(W,G,te)=>{I.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${W+1}/${G}: ${te}`)}});O.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),O.start().then(W=>{I.remove(),W.errs.length>0?b(W.errs[0]):E()})}).catch(O=>{b(O)})})}reset(){}checkUrlIsImage(I){return null!=I.match(/\.(jpeg|jpg|png|gif)(\?.*)?$/)}loadAztFile(I,E,b){return new Promise((O,W)=>{fetch(this.sAztCommonCdnService.getMyCdn(I.url??"")).then(G=>{G.ok?G.blob().then(te=>{const pe=new File([te],I.name??"",{type:I.mimes});"ans"===b?E.isExportAnsMedia&&E.mediaAnswerWraps.push(pe):E.isExportMedia&&E.mediaWraps.push(pe),O()}):W(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${I.name}`))}).catch(()=>{W(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${I.name}`))})})}wrapLoadMedia(I,E){return this.checkUrlIsImage(I)?(0,Se.qO)(I,E):new Promise((b,O)=>{b(void 0)})}replaceImageToBase64(I,E,b,O,W,G){return new Promise((te,we)=>{Object.prototype.hasOwnProperty.call(I,E)&&"string"==typeof I[E]?this.wrapLoadMedia(I[E],W).then(pe=>{if(pe){const ee=document.createElement("canvas");ee.width=pe.width,ee.height=pe.height,ee.getContext("2d")?.drawImage(pe,0,0),I[E]=b.canvasList.push(ee)-1,te()}else{G=G?G+1:1;let ee=I[E].split(".");ee=ee.length>0?ee[ee.length-1]:"mp3";const ue=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",G.toString(),O])+"."+ee;this.loadAztFile({name:this.commonService.replaceAll(ue,"_"," ")??"",url:I[E],path:"",extension:"",mimes:"",size:"0",lastModified:0},b,"ans").then(()=>{te()}).catch(ye=>{we(new Error(this.commonService.myTranslateInstant(ye.message)+(O.length>0?" : "+O:"")))})}}).catch(pe=>{we(new Error(this.commonService.myTranslateInstant(pe.message)+(O.length>0?" : "+O:"")))}):we(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+(O.length>0?" : "+O:"")))})}loadTeacherDrawResult(I,E,b,O){return new Promise((W,G)=>{const te=O??{canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},we=new qe.n(3,{function:(pe,ee)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${pe}/${ee})`)}});if(te.resultTeacherDraw=I,te.resultTeacherDraw){te.resultTeacherDraw.pages?.forEach((ee,ue)=>{we.addTask(this,this.replaceImageToBase64,[ee,"backgroundImage",te,b,this.sAztCommonCdnService,ue]),ee.draw&&we.addTask(this,this.replaceImageToBase64,[ee,"draw",te,b,this.sAztCommonCdnService,ue])});const pe=this.commonService.castJsonToObj(te.resultTeacherDraw.staticTextConfig??"");if(te.resultTeacherConfig=pe,te.resultTeacherConfig&&te.resultTeacherConfig.urlImgCorrect&&te.resultTeacherConfig.urlImgWrong&&(te.resultTeacherConfig.urlImgCorrect=(te.resultTeacherConfig.type?"":"core-mod-assets/images/classlive/")+te.resultTeacherConfig.urlImgCorrect,te.resultTeacherConfig.urlImgWrong=(te.resultTeacherConfig.type?"":"core-mod-assets/images/classlive/")+te.resultTeacherConfig.urlImgWrong,we.addTask(this,this.replaceImageToBase64,[te.resultTeacherConfig,"urlImgCorrect",te,b]),we.addTask(this,this.replaceImageToBase64,[te.resultTeacherConfig,"urlImgWrong",te,b])),te.resultTeacherDraw.commentEmoji&&te.resultTeacherDraw.commentEmoji.length>0)for(let ee=0;ee<te.resultTeacherDraw.commentEmoji.length;ee++)te.resultTeacherDraw.commentEmoji[ee]="https://azota889.github.io/storage_public/mnote/"+te.resultTeacherDraw.commentEmoji[ee],we.addTask(this,this.replaceImageToBase64,[te.resultTeacherDraw.commentEmoji,ee,te,b])}we.start().then(pe=>{0===pe.errs.length?W(te):G(pe.errs[0])})})}capitalized(I){return I?I.charAt(0).toUpperCase()+I.slice(1):""}wrapText(I,E,b,O,W,G){const te=document.createElement("span");te.innerHTML=this.commonService.removeXssInHtml(E),(E=te.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(pe=>{for(var ee=pe.split(" "),ue="",ye=0;ye<ee.length;ye++){var Re=ue+ee[ye]+" ";I.measureText(Re).width>W&&ye>0?(I.fillText(ue,b,O),ue=ee[ye]+" ",O+=G):ue=Re}I.fillText(ue,b,O)})}getLineImageAnswer(I){const E=[];return I.mediaAnswerWraps&&I.isExportAnsMedia&&I.mediaAnswerWraps.forEach(b=>{E.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(b.name)}}</span>`,answers:[]})}),I.resultTeacherDraw&&I.resultTeacherDraw.pages?.forEach(b=>{let O=I.canvasList[Number(b.backgroundImage)];if(O){const W=document.createElement("canvas");W.width=b.width??1,W.height=b.height??1;const G=W.getContext("2d");if(G){G.fillStyle="#FFFFFF",G.fillRect(0,0,W.width,W.height);let pe=document.createElement("canvas"),ee=pe.getContext("2d");0!==b.rotation&&ee?(90===Math.abs(b.rotation??0)?(pe.width=O.height,pe.height=O.width):(pe.width=O.width,pe.height=O.height),ee.translate(pe.width/2,pe.height/2),ee.rotate(((b.rotation??0)>0?1:-1)*(b.rotation??0)*Math.PI/180),ee.drawImage(O,-O.width/2,-O.height/2),ee.restore()):pe=O;const ue=W.height/pe.height*pe.width;if(G.drawImage(pe,0,0,pe.width,pe.height,(W.width-ue)/2,0,ue,W.height/pe.height*pe.height),b.draw){const je=I.canvasList[Number(b.draw)];je&&G.drawImage(je,0,0)}if(b.staticText&&b.staticText.length>0&&b.staticText.forEach(je=>{if(G.font=`${I.resultTeacherConfig?.fontSize}px ${I.resultTeacherConfig?.fontText}`,G.fillStyle=I.resultTeacherConfig?.fontColor??"#000000",I.resultTeacherConfig?.useCorrectText&&"correct"==je.value&&this.wrapText(G,I.resultTeacherConfig?.textCorrect??"",je.x,je.y,W.width-je.x,25),I.resultTeacherConfig?.useCorrectText&&"wrong"==je.value&&this.wrapText(G,I.resultTeacherConfig?.textWrong??"",je.x,je.y,W.width-je.x,25),!I.resultTeacherConfig?.useCorrectText&&"correct"==je.value){const Me=I.canvasList[Number(I.resultTeacherConfig?.urlImgCorrect)];Me&&G.drawImage(Me,0,0,Me.width,Me.height,je.x,je.y,30,30)}if(!I.resultTeacherConfig?.useWrongText&&"wrong"==je.value){const Me=I.canvasList[Number(I.resultTeacherConfig?.urlImgWrong)];Me&&G.drawImage(Me,0,0,Me.width,Me.height,je.x,je.y,30,30)}}),b.objText&&b.objText.length>0){let je=300;b.objText.forEach(Me=>{G.font=`${parseFloat(Me.textStyle.size)}px ${Me.textStyle.font}`,G.fillStyle=Me.textStyle.color,G.textAlign=Me.textStyle.align??"center",G.lineWidth=Me.textStyle.width??je,this.wrapText(G,Me.value,Me.x,Me.y,W.width-Me.x,25)})}}const te=693,we=te/W.width;E.push({content:`<img src="${W.toDataURL()}" style="width:${te}px;height:${W.height*we}px" /><br/>`,answers:[]})}}),0===E.length?E.push({content:`<br/><br/>${F.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):E.unshift({content:`<br/>${F.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),E}convertDataMarkNote(I){return new Promise((E,b)=>{I&&I.urlDataMark?this.sAztCommonCdnService.loadTextCdn(this.sAztCommonCdnService.getMyCdn(I.urlDataMark)).subscribe(O=>{const W=this.zipDataService.decodeContentGzip(O),G=this.commonService.castJsonToObj(W);I.pages=[];let te={};G?.pages.forEach((ee,ue)=>{let ye={width:ee.width,height:ee.height,draw:ee.draws?.[0]?.src??void 0,backgroundImage:ee.backgroundSrc,rotation:ee.backgroundRotate,objText:[],staticText:[]};ee.childData?.length&&ee.childData.forEach((Re,je)=>{if("UIQuickMark"==Re.className&&(ye.staticText?.push({x:Re.x+5,y:Re.y+(Re.height+5+Re.fontSize)/2,value:"type_right"===Re.type?"correct":"wrong"}),0===je&&(te={txtCommentFont:Re.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:Re.width,correctHeight:Re.height,wrongWidth:Re.width,wrongHeight:Re.height,fontText:Re.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:Re.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!te.urlImgWrong&&"type_wrong"==Re.type&&(te.urlImgWrong=Re.imageSrc),!te.urlImgCorrect&&"type_right"==Re.type&&(te.urlImgCorrect=Re.imageSrc),!te.textWrong&&"type_wrong"==Re.type&&(te.textWrong=Re.textContent),!te.textCorrect&&"type_right"==Re.type&&(te.textCorrect=Re.textContent),te.useCorrectText=!te.urlImgCorrect,te.useWrongText=!te.urlImgWrong,"UIText"===Re.className){let Me=this.getStyleContent(Re.textContent);ye.objText?.push({x:Re.x+15,y:Re.y+15,value:Re.textContent,textStyle:{size:Re.fontSize?Re.fontSize:Me?.fontSize,align:Me?.textAlign??"left",color:Me?.color,fill:!0,font:Me?.fontFamily}})}}),I.pages?.push(ye)}),I.staticTextConfig=this.commonService.serializeJson(te),E(I)}):E(I??{})})}getStyleContent(I){let E=document.createElement("div");E.innerHTML=this.commonService.removeXssInHtml(I);let b=E.querySelector("p"),O=E.querySelector("span");return O?{fontSize:O.style.fontSize,color:O.style.color,fontFamily:O.style.fontFamily,textAlign:b?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(I){return(new DOMParser).parseFromString(I,"text/html").body.textContent??I}replaceParamFileName(I){return I.replace(/\?.*$/,"")}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}constructor(I,E,b,O,W,G,te,we,pe,ee,ue,ye,Re,je,Me,ot){this.sAztAnswerTrueFalseService=I,this.homeworkExamService=E,this.checkDrawImgNameService=b,this.sAztCommonCdnService=O,this.zipDataService=W,this.exportPdfUtilsService=G,this.answerTypeService=te,this.exportPdfConvertDataService=we,this.questionRenderService=pe,this.commonService=ee,this.answerService=ue,this.examResultService=ye,this.testedListApiService=Re,this.shareFileFlutterService=je,this.sAztDialogService=Me,this.sAztDocxService=ot,this.logger=new Y.Y,this.expandInfoParse={}}}return(ae=at).\u0275fac=function(I){return new(I||ae)(_.KVO(Xe.j),_.KVO(Qe.Z),_.KVO(ke.E),_.KVO(tt.c),_.KVO(st.j),_.KVO(rt.j),_.KVO(xt._),_.KVO(de.p),_.KVO($e.g),_.KVO(Te.R),_.KVO(k._t),_.KVO(P._j),_.KVO(H.h),_.KVO(We.R),_.KVO(Je.i),_.KVO(ze.I))},ae.\u0275prov=_.jDH({token:ae,factory:ae.\u0275fac,providedIn:"root"}),at})()},92229:(ft,Ae,y)=>{"use strict";y.d(Ae,{Y:()=>s});class s{pushChild(h){this.child.push(h)}pushMsg(h){this.msg=h}start(h){this.run=!0,h&&(this.msg=h)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const h=[];return this.msg&&""!==this.msg&&h.push(this.msg),`<p>${h.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let h=[];return this.child.filter(_=>_.run).forEach(_=>{h=h.concat(_.lines)}),h}constructor(h=!1,_="",x){this.run=h,this.msg=_,this.percent=x,this.child=[]}}},49786:(ft,Ae,y)=>{"use strict";y.d(Ae,{i:()=>En});var s=y(48891),d=y(407),h=y(59702),_=y(59640),x=y(50622),T=y(99927),ie=y(9797),fe=y(46899);let p=(()=>{var U;class He extends _.H{showExplain(){this.isTeacherRole||!this.examConfig||"SHOW_EXPLAIN"!==this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction||this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought?this.isShowExplainChange.emit(!this.isShowExplain):this.showDialogBuyExam(this.examObj)}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage()}showDialogBuyExam(Fe){this.sAztDialogService.open(h.Q,{data:{examObj:Fe},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0})}isKey(Fe){return!(!this.questionObj?.answers||!this.questionObj.answerResult)&&(Fe.key?Fe.key==this.questionObj.answerResult[0]:Fe==this.questionObj.answerResult[0])}haveChoose(Fe){return!!this.userAnswersObj["id_"+this.questionObj?.id]&&(Fe.key?Fe.key.toUpperCase().toString()==this.userAnswersObj["id_"+this.questionObj?.id].toUpperCase():Fe.toString().toUpperCase()==this.userAnswersObj["id_"+this.questionObj?.id].toUpperCase())}findKey(){this.questionObj?.answerResult&&this.labelArr.every(Fe=>!this.questionObj||!this.questionObj.answerResult||this.questionObj.answerResult[0]!=Fe.key||(this.key=(this.isShowOriginAnswer?Fe.key:Fe.alpha??Fe.key)??"",!1))}checkShowExplainButton(){this.isShowExplainButton=!!(this.questionObj.help||"lang_core_show_explain_required_payment"==this.questionObj.help&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigObj?.priceForAction)}checkLabelArr(){this.labelArr=this.sAztAnswerTrueFalseService.checkLabelArrOriginOrMix(this.questionAnswers,this.isShowOriginAnswer),this.findKey()}ngOnChanges(Fe){Fe.isShowOriginAnswer&&this.questionObj&&this.checkLabelArr()}ngOnInit(){if(super.ngOnInit(),this.isFillAnswer=this.questionObj?.correctAnswer??!1,this.answerTypeService.isTrueFalseAnswer(this.questionObj)?(this.keys=this.sAztAnswerTrueFalseService.checkLabelKeys(this.keys,this.questionObj?.answers,this.questionObj?.answerResult),this.isFillAnswer=!0):this.key=this.questionObj?.answerResult.length?this.questionObj.answerResult[0]:"",this.questionAnswers=(0,d.cloneDeep)(this.questionObj.answers??[]),this.checkLabelArr(),this.answerTypeService.isOneChoiceAnswer(this.questionObj))for(let Fe=0;Fe<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[Fe])&&this.haveChoose(this.labelArr[Fe]),!0!==this.isFillAnswer);Fe++);this.answerTypeService.isFillAnswer(this.questionObj)&&this.questionObj?.answerResult&&this.questionObj.answerResult.length>0&&(this.keys=this.questionObj.answerResult,this.isFillAnswer=this.questionObj?.correctAnswer??!1),this.checkShowExplainButton()}constructor(Fe,Ye,Kt,mn){super(),this.sAztAnswerTrueFalseService=Fe,this.answerTypeService=Ye,this.answerBoxService=Kt,this.sAztDialogService=mn,this.isShowExplain=!1,this.isOfflineMark=!1,this.isTeacherRole=!0,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.isShowExplainChange=new s.bkB,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1,this.isShowExplainButton=!1,this.questionAnswers=[]}}return(U=He).\u0275fac=function(Fe){return new(Fe||U)(s.rXU(x.j),s.rXU(T._),s.rXU(ie.C),s.rXU(fe.i))},U.\u0275cmp=s.VBU({type:U,selectors:[["azt-answer-box-with-user-answer-base"]],inputs:{examObj:"examObj",questionObj:"questionObj",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isTeacherRole:"isTeacherRole",isShowOriginAnswer:"isShowOriginAnswer",examConfig:"examConfig",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab",backToLink:"backToLink"},outputs:{isShowExplainChange:"isShowExplainChange"},features:[s.Vt3,s.OA$],decls:0,vars:0,template:function(Fe,Ye){},encapsulation:2}),He})();var q=y(54460),N=y(15343),R=y(47348);const z=U=>({width:U,visibility:"visible"}),S=()=>({"ml-1":!0}),K=U=>({color:U}),B=U=>({"border-color":U}),M=()=>({"text-danger wrongIcon mr-1":!0}),w=()=>({"rightIcon text-success mr-1":!0}),D=()=>({"text-danger mr-1":!0}),Z=()=>({"text-success mr-1":!0});function ne(U,He){if(1&U){const V=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(V);const Ye=s.XpG();return s.Njj(Ye.showExplain())}),s.EFF(1),s.nI1(2,"mytranslate"),s.nrm(3,"lucide-icon",8),s.k0s()}if(2&U){const V=s.XpG();s.Y8G("ngStyle",s.eq3(6,z,V.questionObj.help?"125px":"0px")),s.R7$(),s.SpI(" ",s.bMT(2,4,"lang_auto_giai_thich")," "),s.R7$(2),s.Y8G("name",V.isShowExplain?"chevron-up":"chevron-down")("ngClass",s.lJ4(8,S))}}function re(U,He){1&U&&s.nrm(0,"lucide-icon",18),2&U&&s.Y8G("ngClass",s.lJ4(1,M))}function oe(U,He){if(1&U&&s.DNE(0,re,1,2,"lucide-icon",17),2&U){const V=s.XpG().$implicit,Fe=s.XpG(2);s.Y8G("ngIf",Fe.haveChoose(V))}}function Be(U,He){1&U&&s.nrm(0,"lucide-icon",19),2&U&&s.Y8G("ngClass",s.lJ4(1,w))}function Oe(U,He){if(1&U&&(s.j41(0,"div",13),s.DNE(1,oe,1,1,"ng-template",14)(2,Be,1,2,"lucide-icon",15),s.j41(3,"span",16),s.EFF(4),s.k0s()()),2&U){const V=He.$implicit,Fe=s.XpG(2);s.R7$(),s.Y8G("ngIf",!(Fe.isKey(V)&&Fe.haveChoose(V))),s.R7$(),s.Y8G("ngIf",Fe.isKey(V)&&Fe.haveChoose(V)),s.R7$(2),s.JRh(V.alpha?V.alpha:V.key?V.key:V)}}function Ze(U,He){if(1&U&&(s.j41(0,"div",9)(1,"span",10),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s(),s.j41(4,"div",11),s.DNE(5,Oe,5,3,"div",12),s.k0s()()),2&U){const V=s.XpG();s.R7$(),s.Y8G("ngStyle",s.eq3(7,K,V.isFillAnswer?"#00ac33":"red")),s.R7$(),s.Lme("",s.bMT(3,5,"lang_auto_dap_an_dung"),": ",V.key,""),s.R7$(2),s.Y8G("ngStyle",s.eq3(9,B,V.isFillAnswer?"#00ac33":"red")),s.R7$(),s.Y8G("ngForOf",V.labelArr)}}function Ie(U,He){if(1&U&&(s.qex(0),s.j41(1,"span",26),s.nI1(2,"isTrueAnswerType5"),s.EFF(3),s.nI1(4,"mytranslate"),s.k0s(),s.bVm()),2&U){const V=He.$implicit,Fe=s.XpG(2);s.R7$(),s.Y8G("ngStyle",s.eq3(9,K,s.brH(2,3,V,Fe.keys,Fe.userAnswersObj["id_"+Fe.questionObj.id])?"#00ac33":"red")),s.R7$(2),s.Lme(" ",V.alpha?V.alpha.toLowerCase():V.key?V.key.toLowerCase():V," - ",s.bMT(4,7,Fe.keys.includes((V.alpha?V.alpha:V.key?V.key:"")+"T")?"lang_auto_dung":"lang_auto_sai"),"\xa0 ")}}function ct(U,He){1&U&&s.nrm(0,"lucide-icon",18),2&U&&s.Y8G("ngClass",s.lJ4(1,D))}function it(U,He){1&U&&s.nrm(0,"lucide-icon",19),2&U&&s.Y8G("ngClass",s.lJ4(1,Z))}function Ce(U,He){if(1&U&&(s.j41(0,"div",27),s.DNE(1,ct,1,2,"lucide-icon",17),s.nI1(2,"isTrueAnswerType5"),s.DNE(3,it,1,2,"lucide-icon",15),s.nI1(4,"isTrueAnswerType5"),s.j41(5,"span",16),s.EFF(6),s.nI1(7,"getAnswerChoiceTrueFalseQuestion"),s.nI1(8,"mytranslate"),s.k0s()()),2&U){const V=He.$implicit,Fe=s.XpG(2);s.R7$(),s.Y8G("ngIf",!s.brH(2,4,V,Fe.keys,Fe.userAnswersObj["id_"+(null==Fe.questionObj?null:Fe.questionObj.id)])),s.R7$(2),s.Y8G("ngIf",s.brH(4,8,V,Fe.keys,Fe.userAnswersObj["id_"+(null==Fe.questionObj?null:Fe.questionObj.id)])),s.R7$(3),s.Lme("",V.alpha?V.alpha.toLowerCase():V.key?V.key.toLowerCase():V," - ",s.bMT(8,15,s.i5U(7,12,V,Fe.userAnswersObj["id_"+Fe.questionObj.id])),"")}}function ve(U,He){if(1&U&&(s.j41(0,"div",20)(1,"span",21),s.EFF(2),s.nI1(3,"mytranslate"),s.DNE(4,Ie,5,11,"ng-container",22),s.k0s(),s.j41(5,"div",23)(6,"div",24),s.DNE(7,Ce,9,17,"div",25),s.k0s()()()),2&U){const V=s.XpG();s.R7$(2),s.SpI(" ",s.bMT(3,4,"lang_auto_dap_an_dung"),": "),s.R7$(2),s.Y8G("ngForOf",V.labelArr),s.R7$(),s.Y8G("ngStyle",s.eq3(6,B,V.questionObj.correctAnswer?"#00ac33":"red")),s.R7$(2),s.Y8G("ngForOf",V.labelArr)}}function De(U,He){if(1&U&&(s.j41(0,"span",10),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&U){const V=s.XpG(2);s.Y8G("ngStyle",s.eq3(5,K,V.isFillAnswer?"#00ac33":"red")),s.R7$(),s.Lme("",s.bMT(2,3,"lang_auto_dap_an_dung_"),"",V.keys.join("],["),"]")}}function he(U,He){if(1&U&&(s.j41(0,"div",9),s.DNE(1,De,3,7,"span",28),s.j41(2,"div",29)(3,"div",30),s.EFF(4),s.nI1(5,"trimEndFillAnswer"),s.nI1(6,"mytranslate"),s.k0s()()()),2&U){const V=s.XpG();s.R7$(),s.Y8G("ngIf",V.keys),s.R7$(),s.Y8G("ngStyle",s.eq3(8,B,V.isFillAnswer?"#00ac33":"red")),s.R7$(2),s.SpI(" ",void 0!==V.userAnswersObj["id_"+V.questionObj.id]?s.i5U(5,3,V.userAnswersObj["id_"+V.questionObj.id],V.isOfflineMark):s.bMT(6,6,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function X(U,He){if(1&U){const V=s.RV6();s.j41(0,"div")(1,"span",33),s.bIt("click",function(){s.eBV(V);const Ye=s.XpG(2);return s.Njj(Ye.switchToEssayTab())}),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s()()}2&U&&(s.R7$(2),s.JRh(s.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function be(U,He){1&U&&(s.j41(0,"div"),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&U&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Ge(U,He){if(1&U&&(s.qex(0),s.nrm(1,"div",34),s.bVm()),2&U){const V=s.XpG(3);s.R7$(),s.Y8G("innerText",V.userAnswersObj["id_"+V.questionObj.id])}}function Pe(U,He){if(1&U&&(s.qex(0),s.DNE(1,be,3,3,"div",32)(2,Ge,2,1,"ng-container",32),s.bVm()),2&U){const V=s.XpG(2);s.R7$(),s.Y8G("ngIf",!V.userAnswersObj["id_"+V.questionObj.id]),s.R7$(),s.Y8G("ngIf",V.userAnswersObj["id_"+V.questionObj.id])}}function Ne(U,He){if(1&U&&(s.j41(0,"div",31),s.DNE(1,X,4,3,"div",32)(2,Pe,3,2,"ng-container",32),s.k0s()),2&U){const V=s.XpG();s.R7$(),s.Y8G("ngIf","multiple_choice_tab"==V.currentTab),s.R7$(),s.Y8G("ngIf","multiple_choice_tab"!=V.currentTab)}}function qe(U,He){if(1&U){const V=s.RV6();s.j41(0,"div",1)(1,"span",7),s.bIt("click",function(){s.eBV(V);const Ye=s.XpG();return s.Njj(Ye.showExplain())}),s.EFF(2),s.nI1(3,"mytranslate"),s.nrm(4,"lucide-icon",8),s.k0s()()}if(2&U){const V=s.XpG();s.R7$(),s.Y8G("ngStyle",s.eq3(6,z,V.questionObj.help?"125px":"0px")),s.R7$(),s.SpI(" ",s.bMT(3,4,"lang_auto_giai_thich")," "),s.R7$(2),s.Y8G("name",V.isShowExplain?"chevron-up":"chevron-down")("ngClass",s.lJ4(8,S))}}let Se=(()=>{var U;class He extends p{ngOnInit(){super.ngOnInit()}}return(U=He).\u0275fac=(()=>{let V;return function(Ye){return(V||(V=s.xGo(U)))(Ye||U)}})(),U.\u0275cmp=s.VBU({type:U,selectors:[["azt-answer-box-with-user-answer-for-teacher"]],features:[s.Vt3],decls:14,vars:18,consts:[[1,"question-standalone-answer-box-for-student","box","shadow-none"],[1,"flex"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k","class","explainTxt text-pending cursor-pointer mt-2",3,"ngStyle","click",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box-type1 mt-2","style","flex-wrap: wrap",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["class","flex",4,"ngIf"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k",1,"explainTxt","text-pending","cursor-pointer","mt-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"answer-box-type1","mt-2"],[1,"keyText","my-1",3,"ngStyle"],["id","type_1",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"answer-box-type1","mt-2",2,"flex-wrap","wrap"],[1,"keyText","my-1"],[4,"ngFor","ngForOf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],[1,"label-item",2,"display","block !important","width","auto !important"],["class","flex w-full mt-1","style","align-items: center",4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"flex","w-full","mt-1",2,"align-items","center"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Fe,Ye){1&Fe&&(s.j41(0,"div",0)(1,"div",1),s.DNE(2,ne,4,9,"span",2),s.nI1(3,"isEssayAnswer"),s.k0s(),s.DNE(4,Ze,6,11,"div",3),s.nI1(5,"isOneChoiceAnswer"),s.DNE(6,ve,8,8,"div",4),s.nI1(7,"isTrueFalseAnswer"),s.DNE(8,he,7,10,"div",3),s.nI1(9,"isFillAnswer"),s.DNE(10,Ne,3,2,"div",5),s.nI1(11,"isEssayAnswer"),s.k0s(),s.DNE(12,qe,5,9,"div",6),s.nI1(13,"isEssayAnswer")),2&Fe&&(s.R7$(2),s.Y8G("ngIf",Ye.questionObj.help&&!s.bMT(3,6,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",s.bMT(5,8,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",s.bMT(7,10,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",s.bMT(9,12,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",s.bMT(11,14,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",Ye.questionObj.help&&s.bMT(13,16,Ye.questionObj)))},dependencies:[q.YU,q.Sq,q.bT,q.B3,N.WGl,R.wp,R.V6,R.Zm,R.N3,R.FC,R.jr,R.C0,R.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),He})();var xe=y(65162);const F=U=>({"justify-content":U}),Y=U=>({"mt-3":U}),et=(U,He)=>({width:U,"margin-right":He}),Xe=()=>({"ml-1":!0}),Qe=U=>[U],ke=U=>({backto:U}),tt=()=>({"text-transform":"uppercase"}),st=(U,He)=>({"flex justify-between w-full items-center":U,"answer-box-type1":He}),rt=U=>({"border-color":U}),xt=U=>({color:U}),de=()=>({"text-danger mr-1":!0}),$e=()=>({"mr-1":!0}),Te=()=>({"text-success mr-1":!0}),k=U=>({"w-full":U}),P=U=>({color:"#00ac33",width:U}),H=(U,He)=>({color:U,width:He}),We=()=>({color:"red"});function Je(U,He){if(1&U){const V=s.RV6();s.j41(0,"span",8),s.bIt("click",function(){s.eBV(V);const Ye=s.XpG();return s.Njj(Ye.showExplain())}),s.EFF(1),s.nI1(2,"mytranslate"),s.nrm(3,"lucide-icon",9),s.k0s()}if(2&U){const V=s.XpG();s.Y8G("ngStyle",s.l_i(7,et,V.isShowExplainButton?"125px":"0px",V.isShowExplainButton?"-40px":"0px")),s.BMQ("style",V.isShowExplainButton&&!V.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",s.$dS),s.R7$(),s.SpI(" ",s.bMT(2,5,"lang_auto_giai_thich")," "),s.R7$(2),s.Y8G("name",V.isShowExplain?"chevron-up":"chevron-down")("ngClass",s.lJ4(10,Xe))}}function ze(U,He){if(1&U&&(s.j41(0,"a",10),s.nI1(1,"navigationLocalize"),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s()),2&U){const V=s.XpG();s.Y8G("routerLink",s.eq3(8,Qe,s.bMT(1,4,"/on-luyen/"+V.questionObj.practiceHashId)))("queryParams",s.eq3(10,ke,V.backToLink))("ngStyle",s.lJ4(12,tt)),s.R7$(2),s.SpI(" ",s.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function dt(U,He){if(1&U&&(s.j41(0,"span",16),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&U){const V=s.XpG(2);s.Y8G("ngStyle",s.eq3(5,xt,V.isFillAnswer?"#00ac33":"red")),s.R7$(),s.Lme("",s.bMT(2,3,"lang_auto_dap_an_dung"),": ",V.key,"")}}function ae(U,He){1&U&&s.nrm(0,"span",17)}function at(U,He){1&U&&s.nrm(0,"lucide-icon",24),2&U&&s.Y8G("ngClass",s.lJ4(1,de))}function Le(U,He){1&U&&s.nrm(0,"lucide-icon",25),2&U&&s.Y8G("ngClass",s.lJ4(1,$e))}function I(U,He){if(1&U&&(s.qex(0),s.DNE(1,at,1,2,"lucide-icon",23)(2,Le,1,2,"lucide-icon",21),s.bVm()),2&U){const V=s.XpG(2).$implicit,Fe=s.XpG(2);s.R7$(),s.Y8G("ngIf",Fe.haveChoose(V)&&2!=Fe.examObj.whenShowAnswer&&!Fe.notShowAnswerYet),s.R7$(),s.Y8G("ngIf",Fe.haveChoose(V)&&2!=Fe.examObj.whenShowAnswer&&Fe.notShowAnswerYet)}}function E(U,He){1&U&&s.nrm(0,"lucide-icon",25),2&U&&s.Y8G("ngClass",s.lJ4(1,$e))}function b(U,He){if(1&U&&(s.qex(0),s.DNE(1,E,1,2,"lucide-icon",21),s.bVm()),2&U){const V=s.XpG(2).$implicit,Fe=s.XpG(2);s.R7$(),s.Y8G("ngIf",Fe.haveChoose(V)&&2==Fe.examObj.whenShowAnswer)}}function O(U,He){1&U&&s.nrm(0,"lucide-icon",25),2&U&&s.Y8G("ngClass",s.lJ4(1,Te))}function W(U,He){if(1&U&&(s.qex(0),s.DNE(1,I,3,2,"ng-container",19)(2,b,2,1,"ng-container",19)(3,O,1,2,"lucide-icon",21),s.j41(4,"span",22),s.EFF(5),s.k0s(),s.bVm()),2&U){const V=s.XpG().$implicit,Fe=s.XpG(2);s.R7$(),s.Y8G("ngIf",!(Fe.isKey(V)&&Fe.haveChoose(V))),s.R7$(),s.Y8G("ngIf",!(Fe.isKey(V)&&Fe.haveChoose(V))),s.R7$(),s.Y8G("ngIf",Fe.isKey(V)&&Fe.haveChoose(V)&&2!=Fe.examObj.whenShowAnswer),s.R7$(2),s.SpI(" ",V.alpha?V.alpha:V.key?V.key:V," ")}}function G(U,He){if(1&U&&(s.j41(0,"span",26),s.EFF(1),s.k0s()),2&U){const V=s.XpG().$implicit,Fe=s.XpG(2);s.Y8G("ngClass",Fe.isKey(V)&&Fe.haveChoose(V)&&2!=Fe.examObj.whenShowAnswer?"b-circle  w-6 h-6 text-success":!Fe.isKey(V)&&Fe.haveChoose(V)&&2!=Fe.examObj.whenShowAnswer?"b-circle  w-6 h-6 text-danger":""),s.R7$(),s.SpI(" ",V.alpha?V.alpha:V.key?V.key:V," ")}}function te(U,He){if(1&U&&(s.j41(0,"div",18),s.DNE(1,W,6,4,"ng-container",19)(2,G,2,2,"span",20),s.k0s()),2&U){const V=s.XpG(2);s.R7$(),s.Y8G("ngIf",!V.isTqbDomain),s.R7$(),s.Y8G("ngIf",V.isTqbDomain)}}function we(U,He){if(1&U&&(s.j41(0,"div",11),s.DNE(1,dt,3,7,"span",12)(2,ae,1,0,"span",13),s.j41(3,"div",14),s.DNE(4,te,3,2,"div",15),s.k0s()()),2&U){const V=s.XpG();s.Y8G("ngClass",s.l_i(5,st,V.isMobileDevice,!V.isMobileDevice)),s.R7$(),s.Y8G("ngIf",2!=V.examObj.whenShowAnswer&&!V.notShowAnswerYet),s.R7$(),s.Y8G("ngIf",V.keys&&2==V.examObj.whenShowAnswer),s.R7$(),s.Y8G("ngStyle",s.eq3(8,rt,V.questionObj.correctAnswer?"#00ac33":"red")),s.R7$(),s.Y8G("ngForOf",V.labelArr)}}function pe(U,He){if(1&U&&(s.qex(0),s.j41(1,"div",34),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s(),s.bVm()),2&U){const V=He.$implicit,Fe=s.XpG(3);s.R7$(),s.Y8G("ngStyle",s.eq3(5,P,Fe.isMobileDevice?"50%":"95px")),s.R7$(),s.Lme(" ",V.alpha?V.alpha.toLowerCase():V.key?V.key.toLowerCase():V,") ",s.bMT(3,3,Fe.keys.includes((V.alpha?V.alpha:V.key?V.key:"")+"T")?"lang_auto_dung":"lang_auto_sai")," ")}}function ee(U,He){if(1&U&&(s.j41(0,"div",30)(1,"div",31),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s(),s.j41(4,"div",32),s.DNE(5,pe,4,7,"ng-container",33),s.k0s()()),2&U){const V=s.XpG(2);s.R7$(2),s.SpI("",s.bMT(3,2,"lang_auto_dap_an_dung"),":"),s.R7$(3),s.Y8G("ngForOf",V.labelArr)}}function ue(U,He){if(1&U&&(s.qex(0),s.j41(1,"div",34),s.nI1(2,"isTrueAnswerType5"),s.EFF(3),s.nI1(4,"getAnswerChoiceTrueFalseQuestion"),s.nI1(5,"mytranslate"),s.k0s(),s.bVm()),2&U){const V=He.$implicit,Fe=s.XpG(3);s.R7$(),s.Y8G("ngStyle",s.l_i(12,H,s.brH(2,3,V,Fe.keys,Fe.userAnswersObj["id_"+Fe.questionObj.id])?"#00ac33":"red",Fe.isMobileDevice?"50%":"95px")),s.R7$(2),s.Lme(" ",V.alpha?V.alpha.toLowerCase():V.key?V.key.toLowerCase():V,") ",s.bMT(5,10,s.i5U(4,7,V,Fe.userAnswersObj["id_"+Fe.questionObj.id]))," ")}}function ye(U,He){if(1&U&&(s.j41(0,"div",30)(1,"div",31),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s(),s.j41(4,"div",32),s.DNE(5,ue,6,15,"ng-container",33),s.k0s()()),2&U){const V=s.XpG(2);s.R7$(2),s.SpI("",s.bMT(3,2,"lang_core_dap_an_thi_sinh_chon"),":"),s.R7$(3),s.Y8G("ngForOf",V.labelArr)}}function Re(U,He){if(1&U&&(s.j41(0,"span",34),s.EFF(1),s.k0s()),2&U){const V=s.XpG().$implicit;s.Y8G("ngStyle",s.lJ4(2,We)),s.R7$(),s.SpI(" ",V.alpha?V.alpha.toLowerCase():V.key?V.key.toLowerCase():V,") \xa0\xa0 ")}}function je(U,He){if(1&U&&(s.qex(0),s.DNE(1,Re,2,3,"span",36),s.nI1(2,"isTrueAnswerType5"),s.bVm()),2&U){const V=He.$implicit,Fe=s.XpG(3);s.R7$(),s.Y8G("ngIf",!s.brH(2,1,V,Fe.keys,Fe.userAnswersObj["id_"+Fe.questionObj.id]))}}function Me(U,He){if(1&U&&(s.j41(0,"div",35)(1,"div",31),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s(),s.DNE(4,je,3,5,"ng-container",33),s.k0s()),2&U){const V=s.XpG(2);s.R7$(2),s.SpI("",s.bMT(3,2,"lang_core_cau_lam_sai"),":"),s.R7$(2),s.Y8G("ngForOf",V.labelArr)}}function ot(U,He){if(1&U&&(s.j41(0,"div",27),s.DNE(1,ee,6,4,"div",28)(2,ye,6,4,"div",28)(3,Me,5,4,"div",29),s.k0s()),2&U){const V=s.XpG();s.Y8G("ngClass",s.eq3(4,k,V.isMobileDevice)),s.R7$(),s.Y8G("ngIf",2!=V.examObj.whenShowAnswer&&!V.notShowAnswerYet),s.R7$(),s.Y8G("ngIf",2!=V.examObj.whenShowAnswer&&!V.notShowAnswerYet),s.R7$(),s.Y8G("ngIf",2!=V.examObj.whenShowAnswer&&!V.notShowAnswerYet)}}function $(U,He){if(1&U&&(s.j41(0,"span",16),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&U){const V=s.XpG(2);s.Y8G("ngStyle",s.eq3(5,xt,V.isFillAnswer?"#00ac33":"red")),s.R7$(),s.Lme("",s.bMT(2,3,"lang_auto_dap_an_dung_"),"",V.keys.join("],["),"]")}}function _t(U,He){1&U&&s.nrm(0,"span",17)}function ut(U,He){if(1&U&&(s.j41(0,"div",37),s.DNE(1,$,3,7,"span",12)(2,_t,1,0,"span",13),s.j41(3,"div",38)(4,"div",39),s.EFF(5),s.nI1(6,"trimEndFillAnswer"),s.nI1(7,"mytranslate"),s.k0s()()()),2&U){const V=s.XpG();s.R7$(),s.Y8G("ngIf",V.keys&&2!=V.examObj.whenShowAnswer&&!V.notShowAnswerYet),s.R7$(),s.Y8G("ngIf",V.keys&&2==V.examObj.whenShowAnswer),s.R7$(),s.Y8G("ngStyle",s.eq3(9,rt,V.questionObj.correctAnswer?"#00ac33":"red")),s.R7$(2),s.SpI(" ",void 0!==V.userAnswersObj["id_"+V.questionObj.id]?s.i5U(6,4,V.userAnswersObj["id_"+V.questionObj.id],V.isOfflineMark):s.bMT(7,7,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function vt(U,He){if(1&U){const V=s.RV6();s.j41(0,"div")(1,"span",41),s.bIt("click",function(){s.eBV(V);const Ye=s.XpG(2);return s.Njj(Ye.switchToEssayTab())}),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s()()}2&U&&(s.R7$(2),s.SpI(" ",s.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Zt(U,He){1&U&&(s.j41(0,"div"),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&U&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Rt(U,He){if(1&U&&(s.qex(0),s.nrm(1,"div",42),s.bVm()),2&U){const V=s.XpG(3);s.R7$(),s.Y8G("innerText",V.userAnswersObj["id_"+V.questionObj.id])}}function Bt(U,He){if(1&U&&(s.qex(0),s.DNE(1,Zt,3,3,"div",19)(2,Rt,2,1,"ng-container",19),s.bVm()),2&U){const V=s.XpG(2);s.R7$(),s.Y8G("ngIf",void 0===V.userAnswersObj["id_"+V.questionObj.id]),s.R7$(),s.Y8G("ngIf",V.userAnswersObj["id_"+V.questionObj.id])}}function en(U,He){if(1&U&&(s.j41(0,"div",40),s.DNE(1,vt,4,3,"div",19)(2,Bt,3,2,"ng-container",19),s.k0s()),2&U){const V=s.XpG();s.R7$(),s.Y8G("ngIf","multiple_choice_tab"==V.currentTab),s.R7$(),s.Y8G("ngIf","multiple_choice_tab"!=V.currentTab)}}let tn=(()=>{var U;class He extends p{}return(U=He).\u0275fac=(()=>{let V;return function(Ye){return(V||(V=s.xGo(U)))(Ye||U)}})(),U.\u0275cmp=s.VBU({type:U,selectors:[["azt-answer-box-with-user-full-answer-for-student"]],features:[s.Vt3],decls:12,vars:20,consts:[[1,"question-standalone-answer-box-for-student","box","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center",3,"ngClass"],["class","explainTxt text-pending cursor-pointer","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","mt-2 font-bold",3,"ngClass",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"mt-2","font-bold",3,"ngClass"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"keyText","my-1",3,"ngStyle"],[1,"keyText","my-1","ml-2"],[1,"label-item"],[4,"ngIf"],["class","lalala",3,"ngClass",4,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"lalala",3,"ngClass"],[3,"ngClass"],["class","keyText my-1 font-medium flex flex-wrap",4,"ngIf"],["class","keyText my-1 font-medium text-red flex flex-wrap",4,"ngIf"],[1,"keyText","my-1","font-medium","flex","flex-wrap"],[2,"width","100px"],[1,"flex","justify-between","flex-wrap"],[4,"ngFor","ngForOf"],[1,"lalala",3,"ngStyle"],[1,"keyText","my-1","font-medium","text-red","flex","flex-wrap"],["class","lalala",3,"ngStyle",4,"ngIf"],[1,"answer-box-type1","mt-2"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Fe,Ye){1&Fe&&(s.j41(0,"div",0)(1,"div",1),s.DNE(2,Je,4,11,"span",2)(3,ze,4,13,"a",3),s.k0s(),s.DNE(4,we,5,10,"div",4),s.nI1(5,"isOneChoiceAnswer"),s.DNE(6,ot,4,6,"div",5),s.nI1(7,"isTrueFalseAnswer"),s.DNE(8,ut,8,11,"div",6),s.nI1(9,"isFillAnswer"),s.DNE(10,en,3,2,"div",7),s.nI1(11,"isEssayAnswer"),s.k0s()),2&Fe&&(s.Y8G("ngStyle",s.eq3(16,F,2==Ye.examObj.whenShowAnswer?"flex-end":"space-between")),s.R7$(),s.Y8G("ngClass",s.eq3(18,Y,Ye.isMobileDevice)),s.R7$(),s.Y8G("ngIf",2!=Ye.examObj.whenShowAnswer),s.R7$(),s.Y8G("ngIf",Ye.questionObj.practiceHashId),s.R7$(),s.Y8G("ngIf",s.bMT(5,8,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",s.bMT(7,10,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",s.bMT(9,12,Ye.questionObj)),s.R7$(2),s.Y8G("ngIf",s.bMT(11,14,Ye.questionObj)))},dependencies:[q.YU,q.Sq,q.bT,q.B3,xe.Wk,N.WGl,R.F2,R.wp,R.V6,R.Zm,R.N3,R.FC,R.jr,R.C0,R.M_],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),He})(),_n=(()=>{var U;class He extends p{constructor(){super(...arguments),this.checkShowFullAnswer=!1}ngOnInit(){this.checkShowFullAnswer=!(this.examConfig&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction&&!this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought)}}return(U=He).\u0275fac=(()=>{let V;return function(Ye){return(V||(V=s.xGo(U)))(Ye||U)}})(),U.\u0275cmp=s.VBU({type:U,selectors:[["azt-answer-box-with-user-answer-for-student"]],features:[s.Vt3],decls:1,vars:11,consts:[[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Fe,Ye){1&Fe&&(s.j41(0,"azt-answer-box-with-user-full-answer-for-student",0),s.mxI("isShowExplainChange",function(mn){return s.DH7(Ye.isShowExplain,mn)||(Ye.isShowExplain=mn),mn}),s.bIt("isShowExplainChange",function(){return Ye.isShowExplainChange.emit(Ye.isShowExplain)}),s.k0s()),2&Fe&&(s.Y8G("examObj",Ye.examObj)("examConfig",Ye.examConfig)("questionObj",Ye.questionObj)("userAnswersObj",Ye.userAnswersObj)("notShowAnswerYet",Ye.notShowAnswerYet)("isTeacherRole",Ye.isTeacherRole)("isShowOriginAnswer",Ye.isShowOriginAnswer),s.R50("isShowExplain",Ye.isShowExplain),s.Y8G("backToLink",Ye.backToLink)("isOfflineMark",Ye.isOfflineMark)("currentTab",Ye.currentTab))},dependencies:[tn],encapsulation:2}),He})();function qt(U,He){if(1&U){const V=s.RV6();s.j41(0,"azt-answer-box-with-user-answer-for-student",2),s.mxI("isShowExplainChange",function(Ye){s.eBV(V);const Kt=s.XpG();return s.DH7(Kt.isShowExplain,Ye)||(Kt.isShowExplain=Ye),s.Njj(Ye)}),s.bIt("isShowExplainChange",function(){s.eBV(V);const Ye=s.XpG();return s.Njj(Ye.isShowExplainChange.emit(Ye.isShowExplain))}),s.k0s()}if(2&U){const V=s.XpG();s.Y8G("examObj",V.examObj)("examConfig",V.examConfig)("questionObj",V.questionObj)("userAnswersObj",V.userAnswersObj)("notShowAnswerYet",V.notShowAnswerYet)("isTeacherRole",V.isTeacherRole)("isShowOriginAnswer",V.isShowOriginAnswer),s.R50("isShowExplain",V.isShowExplain),s.Y8G("backToLink",V.backToLink)("isOfflineMark",V.isOfflineMark)("currentTab",V.currentTab)}}function bt(U,He){if(1&U){const V=s.RV6();s.j41(0,"azt-answer-box-with-user-answer-for-teacher",3),s.mxI("isShowExplainChange",function(Ye){s.eBV(V);const Kt=s.XpG();return s.DH7(Kt.isShowExplain,Ye)||(Kt.isShowExplain=Ye),s.Njj(Ye)}),s.bIt("isShowExplainChange",function(){s.eBV(V);const Ye=s.XpG();return s.Njj(Ye.isShowExplainChange.emit(Ye.isShowExplain))}),s.k0s()}if(2&U){const V=s.XpG();s.Y8G("examObj",V.examObj)("examConfig",V.examConfig)("questionObj",V.questionObj)("userAnswersObj",V.userAnswersObj)("notShowAnswerYet",V.notShowAnswerYet)("isShowOriginAnswer",V.isShowOriginAnswer)("isTeacherRole",V.isTeacherRole),s.R50("isShowExplain",V.isShowExplain),s.Y8G("backToLink",V.backToLink)("isOfflineMark",V.isOfflineMark)("currentTab",V.currentTab)}}let En=(()=>{var U;class He extends p{ngOnInit(){}}return(U=He).\u0275fac=(()=>{let V;return function(Ye){return(V||(V=s.xGo(U)))(Ye||U)}})(),U.\u0275cmp=s.VBU({type:U,selectors:[["azt-answer-box-view-base"]],features:[s.Vt3],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Fe,Ye){1&Fe&&s.DNE(0,qt,1,11,"azt-answer-box-with-user-answer-for-student",0)(1,bt,1,11,"azt-answer-box-with-user-answer-for-teacher",1),2&Fe&&(s.Y8G("ngIf",!Ye.isTeacherRole),s.R7$(),s.Y8G("ngIf",Ye.isTeacherRole))},dependencies:[q.bT,Se,_n],encapsulation:2}),He})()},84278:(ft,Ae,y)=>{"use strict";y.d(Ae,{x:()=>ne});var s=y(64486),d=y(66793),h=y(78111),_=y(48891),x=y(54460),T=y(42789),ie=y(60780),fe=y(58447),p=y(15423),q=y(52325),N=y(54313),R=y(34660),z=y(97760),S=y(49786);const K=re=>({"skeleton-box-loading":re}),B=re=>({"pb-2":re}),M=()=>[];function w(re,oe){if(1&re&&_.nrm(0,"div",3),2&re){const Be=_.XpG();_.Y8G("ngClass",_.eq3(1,K,Be.renderConfigObj.isFirstRender))}}function D(re,oe){if(1&re&&_.nrm(0,"azt-test-audio-ui",15),2&re){const Be=_.XpG(2);_.Y8G("questionObj",Be.questionObj)("isShowList",!0)}}function Z(re,oe){if(1&re){const Be=_.RV6();_.j41(0,"div",4)(1,"div",5),_.nrm(2,"azt-question-group-content-box",6),_.j41(3,"div",7),_.DNE(4,D,1,2,"azt-test-audio-ui",8),_.j41(5,"div",9),_.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),_.k0s(),_.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),_.k0s()(),_.j41(10,"azt-answer-box-view-base",13),_.mxI("isShowExplainChange",function(Ze){_.eBV(Be);const Ie=_.XpG();return _.DH7(Ie.isShowExplain,Ze)||(Ie.isShowExplain=Ze),_.Njj(Ze)}),_.bIt("isShowExplainChange",function(Ze){_.eBV(Be);const Ie=_.XpG();return _.Njj(Ie.isShowExplain=Ze)}),_.k0s(),_.nrm(11,"azt-question-explain-box",14),_.k0s()}if(2&re){let Be;const Oe=_.XpG();_.R7$(),_.xc7("font-size","1em")("line-height","1.7"),_.Y8G("id","question_render_container_"+Oe.questionObj.id)("ngClass",_.eq3(43,B,Oe.questionObj.attachments.length>0)),_.R7$(),_.Y8G("examObj",Oe.examObj)("questionObj",Oe.questionObj)("renderConfigObj",Oe.renderConfigObj),_.R7$(2),_.Y8G("ngIf",Oe.questionObj.attachments.length>0),_.R7$(2),_.Y8G("examObj",Oe.examObj)("questionObj",Oe.questionObj)("renderConfigObj",Oe.renderConfigObj)("curQuestionIndex",Oe.curQuestionIndex),_.R7$(),_.Y8G("showForTeacher",!1)("curExamResultId",null!==(Be=Oe.curExamResultId)&&void 0!==Be?Be:0)("examObj",Oe.examObj)("questionObj",Oe.questionObj)("renderConfigObj",Oe.renderConfigObj)("curQuestionIndex",Oe.curQuestionIndex)("orgExamObjs",_.lJ4(45,M)),_.R7$(),_.Y8G("examObj",Oe.examObj)("questionObj",Oe.questionObj)("renderConfigObj",Oe.renderConfigObj),_.R7$(),_.Y8G("userAnswersObj",Oe.userAnswersObj)("examObj",Oe.examObj)("isShowOriginAnswer",Oe.isShowOriginAnswer)("questionObj",Oe.questionObj)("renderConfigObj",Oe.renderConfigObj),_.R7$(),_.Y8G("examObj",Oe.examObj)("examConfig",Oe.examConfig)("isTeacherRole",!1)("isShowOriginAnswer",Oe.isShowOriginAnswer)("questionObj",Oe.questionObj)("userAnswersObj",Oe.userAnswersObj)("notShowAnswerYet",Oe.notShowAnswerYet),_.R50("isShowExplain",Oe.isShowExplain),_.Y8G("backToLink",Oe.backToLink)("isOfflineMark",Oe.isOfflineMark)("currentTab",Oe.currentTab),_.R7$(),_.Y8G("isShowExplain",Oe.isShowExplain)("questionObj",Oe.questionObj)("renderConfigObj",Oe.renderConfigObj)}}let ne=(()=>{var re;class oe extends s.I{ngOnInit(){super.ngOnInit();let Oe=new d.C(!1,!1,!1);super.initData(Oe,this.follower,this.questionObj),this.backToLink=`/test/answer-test/${this.examObj?.tenantId??0}/${this.examObj?.categoryId??0}/${this.examObj?.hashId}/${this.curExamResultId}`}constructor(){super(),this.follower=new h.e,this.curQuestionIndex=0,this.isShowExplain=!1,this.isShowOriginAnswer=!1,this.isOfflineMark=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.checkShowFullAnswer=!1}}return(re=oe).\u0275fac=function(Oe){return new(Oe||re)},re.\u0275cmp=_.VBU({type:re,selectors:[["azt-question-standalone-for-student-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId",examConfig:"examConfig",isShowExplain:"isShowExplain",isShowOriginAnswer:"isShowOriginAnswer",isOfflineMark:"isOfflineMark",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[_.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"box","border-none","pt-2",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","curExamResultId","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"userAnswersObj","examObj","isShowOriginAnswer","questionObj","renderConfigObj"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Oe,Ze){if(1&Oe&&(_.j41(0,"div",1),_.DNE(1,w,1,3,"div",2)(2,Z,12,46,"ng-template",null,0,_.C5r),_.k0s()),2&Oe){const Ie=_.sdS(3);_.Y8G("id","question_render_element_"+Ze.questionObj.id),_.R7$(),_.Y8G("ngIf",!Ze.renderConfigObj.isRenderElement)("ngIfElse",Ie)}},dependencies:[x.YU,x.bT,T.N,ie.c,fe.y,p.N,q.Q,N.$,R.S,z.U,S.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),oe})()},34815:(ft,Ae,y)=>{"use strict";y.d(Ae,{o:()=>Z});var s=y(64486),d=y(66793),h=y(78111),_=y(48891),x=y(54460),T=y(42789),ie=y(60780),fe=y(58447),p=y(15423),q=y(52325),N=y(54313),R=y(34660),z=y(97760),S=y(49786);const K=ne=>({"skeleton-box-loading":ne}),B=ne=>({"mob-web-width":ne});function M(ne,re){if(1&ne&&_.nrm(0,"div",3),2&ne){const oe=_.XpG();_.Y8G("ngClass",_.eq3(1,K,oe.renderConfigObj.isFirstRender))}}function w(ne,re){if(1&ne&&_.nrm(0,"azt-test-audio-ui",15),2&ne){const oe=_.XpG(2);_.Y8G("questionObj",oe.questionObj)("isShowList",!0)}}function D(ne,re){if(1&ne){const oe=_.RV6();_.j41(0,"div",4)(1,"div",5),_.nrm(2,"azt-question-group-content-box",6),_.j41(3,"div",7),_.DNE(4,w,1,2,"azt-test-audio-ui",8),_.j41(5,"div",9),_.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),_.k0s(),_.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),_.k0s()(),_.j41(10,"azt-answer-box-view-base",13),_.mxI("isShowExplainChange",function(Oe){_.eBV(oe);const Ze=_.XpG();return _.DH7(Ze.isShowExplain,Oe)||(Ze.isShowExplain=Oe),_.Njj(Oe)}),_.bIt("isShowExplainChange",function(Oe){_.eBV(oe);const Ze=_.XpG();return _.Njj(Ze.isShowExplain=Oe)}),_.k0s(),_.nrm(11,"azt-question-explain-box",14),_.k0s()}if(2&ne){const oe=_.XpG();_.R7$(),_.xc7("font-size","1em")("line-height","1.7"),_.Y8G("id","question_render_container_"+oe.questionObj.id)("ngClass",_.eq3(39,B,oe.isMobileWebView)),_.R7$(),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj),_.R7$(2),_.Y8G("ngIf",oe.questionObj.attachments.length>0),_.R7$(2),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj)("curQuestionIndex",oe.curQuestionIndex),_.R7$(),_.Y8G("showForTeacher",!0)("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj)("curQuestionIndex",oe.curQuestionIndex)("orgExamObjs",oe.orgExamObjs),_.R7$(),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj),_.R7$(),_.Y8G("examObj",oe.examObj)("questionObj",oe.questionObj)("isShowOriginAnswer",oe.isShowOriginAnswer)("renderConfigObj",oe.renderConfigObj),_.R7$(),_.Y8G("examObj",oe.examObj)("isTeacherRole",!0)("isShowOriginAnswer",oe.isShowOriginAnswer)("questionObj",oe.questionObj)("userAnswersObj",oe.userAnswersObj)("notShowAnswerYet",oe.notShowAnswerYet)("isOfflineMark",oe.isOfflineMark),_.R50("isShowExplain",oe.isShowExplain),_.Y8G("currentTab",oe.currentTab),_.R7$(),_.Y8G("isShowExplain",oe.isShowExplain)("questionObj",oe.questionObj)("renderConfigObj",oe.renderConfigObj)}}let Z=(()=>{var ne;class re extends s.I{ngOnInit(){super.ngOnInit();let Be=new d.C(!1,!1,!1);super.initData(Be,this.follower,this.questionObj)}constructor(){super(),this.follower=new h.e,this.curQuestionIndex=0,this.orgExamObjs=[],this.isShowExplain=!1,this.isOfflineMark=!1,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab"}}return(ne=re).\u0275fac=function(Be){return new(Be||ne)},ne.\u0275cmp=_.VBU({type:ne,selectors:[["azt-question-standalone-for-teacher-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",orgExamObjs:"orgExamObjs",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isShowOriginAnswer:"isShowOriginAnswer",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},features:[_.Vt3],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"pt-2","pb-3","box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","questionObj","isShowOriginAnswer","renderConfigObj"],[3,"isShowExplainChange","examObj","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isOfflineMark","isShowExplain","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Be,Oe){if(1&Be&&(_.j41(0,"div",1),_.DNE(1,M,1,3,"div",2)(2,D,12,41,"ng-template",null,0,_.C5r),_.k0s()),2&Be){const Ze=_.sdS(3);_.Y8G("id","question_render_element_"+Oe.questionObj.id),_.R7$(),_.Y8G("ngIf",!Oe.renderConfigObj.isRenderElement)("ngIfElse",Ze)}},dependencies:[x.YU,x.bT,T.N,ie.c,fe.y,p.N,q.Q,N.$,R.S,z.U,S.i],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),re})()},97760:(ft,Ae,y)=>{"use strict";y.d(Ae,{U:()=>Ze});var s=y(59640),d=y(95887),h=y(89163),_=y(33887),x=y(25539),T=y(48891),ie=y(78472),fe=y(54460),p=y(52654),q=y(2915),N=y(52811),R=y(47348);function z(Ie,ct){1&Ie&&(T.j41(0,"div",10)(1,"span",11),T.nrm(2,"azt-loading-ui"),T.k0s(),T.j41(3,"span",12),T.EFF(4),T.nI1(5,"mytranslate"),T.k0s()()),2&Ie&&(T.R7$(4),T.JRh(T.bMT(5,1,"lang_auto_dang_chuan_bi_tai_lieu_doing")))}function S(Ie,ct){1&Ie&&(T.j41(0,"div",13),T.EFF(1),T.nI1(2,"mytranslate"),T.k0s()),2&Ie&&(T.R7$(),T.SpI(" ",T.bMT(2,1,"lang_azt_cau_hoi_chua_co_lan_sua_nao")," "))}function K(Ie,ct){if(1&Ie&&T.nrm(0,"azt-question-standalone-for-preview",17),2&Ie){const it=T.XpG().$implicit,Ce=T.XpG();T.Y8G("examObj",Ce.data.examObj)("questionObj",it.questionLog)("follower",Ce.data.follower)("curQuestionIndex",Ce.data.curQuestionIndex)}}function B(Ie,ct){if(1&Ie&&(T.qex(0),T.j41(1,"div",14),T.EFF(2),T.nI1(3,"mytranslate"),T.nI1(4,"formatFullDateTimeWithoutSecondByUserUnitPipe"),T.k0s(),T.j41(5,"div",15),T.DNE(6,K,1,4,"azt-question-standalone-for-preview",16),T.k0s(),T.bVm()),2&Ie){const it=ct.$implicit;T.R7$(2),T.SpI(" ",T.bMT(3,2,"lang_azota_ui_the_time_of_question_editing")+": "+T.bMT(4,4,it.createdAt)," "),T.R7$(4),T.Y8G("ngIf",it.questionLog)}}let M=(()=>{var Ie;class ct extends _._{closeDialog(){this.dialogRef.close()}getLogQuestion(Ce){this.initStatusObj(),this.waitDestroy(this.questionService.apiQuestionsIdLogsGet(Ce,this.data.isTeacher?void 0:this.data.curExamResultId).subscribe(ve=>{ve.success?((ve.data?.objs??[]).forEach(he=>{let X={createdAt:he.createdAt,questionLog:this.commonService.castJsonToClassObj(x.I,JSON.stringify(he.questionLog))};X.questionLog&&(X.questionLog.isLogEditQuestion=!0),this.questionLogCustomList.push(X)}),this.successStatusObj()):this.errorStatusObj(ve.message??"",!0)}))}ngOnInit(){this.getLogQuestion(this.data.questionObj.id)}constructor(Ce,ve,De){super(De,ve),this.questionService=Ce,this.dialogRef=ve,this.data=De,this.questionLogCustomList=[]}}return(Ie=ct).\u0275fac=function(Ce){return new(Ce||Ie)(T.rXU(ie.wP),T.rXU(h.CP,8),T.rXU(h.Vh,8))},Ie.\u0275cmp=T.VBU({type:Ie,selectors:[["show-question-edit-history-dialog"]],features:[T.Vt3],decls:15,vars:13,consts:[[1,"box"],[1,"font-medium","p-3","bg-slate-100","dark:bg-darkmode-400"],[3,"defaultHeight"],["class","flex justify-center items-center h-40",4,"ngIf"],["id","boxContentQuestion",1,"p-2"],["class","flex p-5 justify-center items-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","pt-3"],[1,"ml-auto"],[1,"btn","btn-secondary",3,"click"],[1,"flex","justify-center","items-center","h-40"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"flex","p-5","justify-center","items-center"],[1,"p-2","pb-0","text-xs","font-medium",2,"margin-bottom","-10px"],[1,"p-2"],[3,"examObj","questionObj","follower","curQuestionIndex",4,"ngIf"],[3,"examObj","questionObj","follower","curQuestionIndex"]],template:function(Ce,ve){1&Ce&&(T.j41(0,"div",0)(1,"div",1),T.EFF(2),T.nI1(3,"mytranslate"),T.nI1(4,"mytranslate"),T.k0s(),T.j41(5,"azt-mat-dialog-content",2),T.DNE(6,z,6,3,"div",3),T.j41(7,"div",4),T.DNE(8,S,3,3,"div",5)(9,B,7,6,"ng-container",6),T.k0s()(),T.j41(10,"div",7)(11,"div",8)(12,"button",9),T.bIt("click",function(){return ve.closeDialog()}),T.EFF(13),T.nI1(14,"mytranslate"),T.k0s()()()()),2&Ce&&(T.R7$(2),T.Lme(" ",T.bMT(3,7,"lang_azota_ui_the_history_of_question_editing")," (",ve.questionLogCustomList.length+" "+T.bMT(4,9,"lang_testbank_powerpoint_times"),") "),T.R7$(3),T.Y8G("defaultHeight",60),T.R7$(),T.Y8G("ngIf",ve.statusObj.loading),T.R7$(2),T.Y8G("ngIf",!ve.questionLogCustomList.length&&!ve.statusObj.loading),T.R7$(),T.Y8G("ngForOf",ve.questionLogCustomList),T.R7$(4),T.SpI(" ",T.bMT(14,11,"lang_auto_dong")," "))},dependencies:[fe.Sq,fe.bT,p.a,q.U,N.R,R.wp,R.bH],encapsulation:2}),ct})();var w=y(78111),D=y(46899),Z=y(65162),ne=y(9691),re=y(47712),oe=y(15343);function Be(Ie,ct){if(1&Ie){const it=T.RV6();T.j41(0,"div")(1,"button",2),T.nI1(2,"mytranslate"),T.bIt("click",function(){T.eBV(it);const ve=T.XpG();return T.Njj(ve.goToEditQuestion())}),T.nrm(3,"lucide-icon",3),T.k0s()()}2&Ie&&(T.R7$(),T.FS9("matTooltip",T.bMT(2,1,"lang_core_chinh_sua_de_thi")))}function Oe(Ie,ct){if(1&Ie){const it=T.RV6();T.j41(0,"div")(1,"button",2),T.nI1(2,"mytranslate"),T.bIt("click",function(){T.eBV(it);const ve=T.XpG();return T.Njj(ve.showEditHistoryDialog())}),T.nrm(3,"lucide-icon",4),T.k0s()()}2&Ie&&(T.R7$(),T.FS9("matTooltip",T.bMT(2,1,"lang_azota_ui_the_history_of_question_editing")))}let Ze=(()=>{var Ie;class ct extends s.H{checkEditQuestion(){const Ce=this.questionObj?.createdAt,ve=this.questionObj?.updatedAt;let De=this.timeService.calculationTimeOnlyMinutes(Ce,ve);this.isEditQuestion=Number(De)>0}isOrgQuestion(){return null!=this.orgExamObjs.find(Ce=>Ce.questionId==this.questionObj.id)}goToEditQuestion(){var Ce=this.commonService.getMyParam(this.activeRoute,"cat_id")??"0",ve=this.activeRoute.snapshot.paramMap.get("result_id")??"0",De=this.activeRoute.snapshot.paramMap.get("user_id")??"",he=this.activeRoute.snapshot.paramMap.get("student_id")??"",X=this.activeRoute.snapshot.paramMap.get("exam_id")??"",be=Ce,Ge=X;let Pe=this.orgExamObjs.find(Se=>Se.questionId==this.questionObj.id);Pe&&(be=Pe.orgCategoryId?.toString()??"0",Ge=Pe.orgExamId?.toString()??"0");var Ne=this.commonService.getMyQueryParam("backto")??"";let qe=`/admin/testbank/test-review/${X}/${De}/${he}/${ve}`+(Ne?"?backto="+encodeURIComponent(Ne):"");window.location.href=this.commonService.getLocalRouter("/admin/testbank/update-exam/"+be)+"/"+Ge+"?backto="+encodeURIComponent(qe)+"&questionId="+this.questionObj.id}showEditHistoryDialog(){let Ce={follower:new w.e,examObj:this.examObj,questionObj:this.questionObj,renderConfigObj:this.renderConfigObj,curQuestionIndex:this.curQuestionIndex,curExamResultId:this.curExamResultId,isTeacher:this.showForTeacher};this.sAztDialogService.open(M,{width:"750px",data:Ce})}showFeedbackQuestionDialog(){this.sAztDialogService.open(d.g,{width:"750px",data:{questionObj:this.questionObj,role:this.showForTeacher?"TEACHER":"STUDENT",applyType:"MATRIX_QUESTION"},restoreFocus:!1,autoFocus:!1})}ngOnChanges(){this.checkEditQuestion()}constructor(Ce,ve,De){super(),this.sAztDialogService=Ce,this.activeRoute=ve,this.timeService=De,this.showForTeacher=!1,this.curExamResultId=0,this.isEditQuestion=!1}}return(Ie=ct).\u0275fac=function(Ce){return new(Ce||Ie)(T.rXU(D.i),T.rXU(Z.nX),T.rXU(ne.F))},Ie.\u0275cmp=T.VBU({type:Ie,selectors:[["azt-question-action-box"]],inputs:{examObj:"examObj",questionObj:"questionObj",renderConfigObj:"renderConfigObj",orgExamObjs:"orgExamObjs",showForTeacher:"showForTeacher",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId"},features:[T.Vt3,T.OA$],decls:4,vars:4,consts:[[1,"flex"],[4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","p-1",3,"click","matTooltip"],["name","file-pen-line","size","18"],["name","history","size","18"]],template:function(Ce,ve){1&Ce&&(T.j41(0,"div",0),T.DNE(1,Be,4,3,"div",1),T.nI1(2,"isOfflineExam"),T.DNE(3,Oe,4,3,"div",1),T.k0s()),2&Ce&&(T.R7$(),T.Y8G("ngIf",ve.isOrgQuestion()&&!T.bMT(2,2,ve.examObj)),T.R7$(2),T.Y8G("ngIf",ve.isEditQuestion&&!ve.questionObj.isLogEditQuestion))},dependencies:[fe.bT,re.oV,oe.WGl,R.wp,R.st],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ct})()},9797:(ft,Ae,y)=>{"use strict";y.d(Ae,{C:()=>h});var s=y(18447),d=y(48891);let h=(()=>{var _;class x{constructor(){this.switchEssayTabSource=new s.B,this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(){this.switchEssayTabSource.next(!0)}}return(_=x).\u0275fac=function(ie){return new(ie||_)},_.\u0275prov=d.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),x})()},95887:(ft,Ae,y)=>{"use strict";y.d(Ae,{g:()=>Ce});var s=y(10936),d=y(89163),h=y(33887),_=y(15766),x=y(48891),T=y(74978),ie=y(54460),fe=y(43404),p=y(15343),q=y(81587),N=y(52811),R=y(9570),z=y(47348);const S=(ve,De)=>({"btn-primary":ve,"btn-secondary":De}),K=()=>({"mr-2":!0});function B(ve,De){if(1&ve&&(x.j41(0,"div",22)(1,"b",23),x.EFF(2),x.k0s(),x.j41(3,"div",24),x.nrm(4,"azt-dynamic-hook",17),x.k0s()()),2&ve){let he;const X=De.$implicit;x.R7$(2),x.SpI("",null!==(he=X.alpha)&&void 0!==he?he:X.key,"."),x.R7$(2),x.Y8G("content",X.content)}}function M(ve,De){if(1&ve&&(x.j41(0,"div",20),x.DNE(1,B,5,2,"div",21),x.k0s()),2&ve){const he=x.XpG(2);x.R7$(),x.Y8G("ngForOf",he.data.questionObj.answers)}}function w(ve,De){if(1&ve&&(x.j41(0,"h2",25),x.EFF(1),x.nI1(2,"mytranslate"),x.k0s()),2&ve){const he=x.XpG(2);x.R7$(),x.Lme(" ",x.bMT(2,2,"lang_auto_dap_an"),": ",he.data.questionObj.answerResult.join(", ")," ")}}function D(ve,De){if(1&ve&&(x.j41(0,"div",8)(1,"h2",10),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",16),x.nrm(5,"azt-dynamic-hook",17),x.k0s(),x.DNE(6,M,2,1,"div",18)(7,w,3,4,"h2",19),x.k0s()),2&ve){const he=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,4,"lang_auto_noi_dung_cau_hoi")," "),x.R7$(3),x.Y8G("content",he.data.questionObj.content),x.R7$(),x.Y8G("ngIf",1==he.data.questionObj.answerType&&he.data.questionObj.answers&&he.data.questionObj.answers.length>0),x.R7$(),x.Y8G("ngIf",he.data.questionObj.answerResult&&he.data.questionObj.isRoleTeacher)}}function Z(ve,De){if(1&ve&&(x.j41(0,"div",8)(1,"h2",26),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.j41(4,"div",27),x.nrm(5,"azt-dynamic-hook",17),x.k0s()()),2&ve){const he=x.XpG();x.R7$(2),x.SpI(" ",x.bMT(3,2,"lang_auto_loi_giai")," "),x.R7$(3),x.Y8G("content",he.data.questionObj.help)}}function ne(ve,De){1&ve&&(x.qex(0),x.j41(1,"div",28)(2,"span",29),x.nrm(3,"azt-loading-ui"),x.k0s()(),x.bVm())}function re(ve,De){if(1&ve&&(x.j41(0,"div",44),x.nrm(1,"input",45),x.j41(2,"label",46),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()()),2&ve){const he=De.$implicit,X=De.index;x.R7$(),x.FS9("id","choice_"+X),x.FS9("formControlName","choice_"+X),x.R7$(),x.FS9("for","choice_"+X),x.R7$(),x.SpI(" ",x.bMT(4,4,he)," ")}}function oe(ve,De){if(1&ve&&(x.qex(0),x.j41(1,"div",42),x.DNE(2,re,5,6,"div",43),x.k0s(),x.bVm()),2&ve){const he=x.XpG().$implicit;x.R7$(),x.FS9("formGroupName","survey_"+he.id),x.R7$(),x.Y8G("ngForOf",he.choices)}}function Be(ve,De){if(1&ve&&(x.qex(0),x.j41(1,"mat-radio-button",49),x.EFF(2),x.nI1(3,"mytranslate"),x.k0s(),x.bVm()),2&ve){const he=De.$implicit,X=x.XpG(2).$implicit,be=x.XpG(3);x.R7$(),x.FS9("value",he),x.Y8G("checked",be.form.controls["survey_"+X.id].value==he),x.R7$(),x.JRh(x.bMT(3,3,he))}}function Oe(ve,De){if(1&ve&&(x.j41(0,"mat-radio-group",47),x.DNE(1,Be,4,5,"ng-container",48),x.k0s()),2&ve){const he=x.XpG().$implicit;x.FS9("formControlName","survey_"+he.id),x.R7$(),x.Y8G("ngForOf",he.choices)}}function Ze(ve,De){if(1&ve&&(x.j41(0,"div",39)(1,"div",40)(2,"h2",41),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s()(),x.j41(5,"div"),x.DNE(6,oe,3,2,"ng-container",11)(7,Oe,2,2,"ng-template",null,1,x.C5r),x.k0s()()),2&ve){const he=De.$implicit,X=De.index,be=x.sdS(8);x.R7$(3),x.Lme(" ",X+1+". ","",x.bMT(4,4,he.content)," "),x.R7$(3),x.Y8G("ngIf",he.multiChoice&&he.choices&&he.choices.length>1)("ngIfElse",be)}}function Ie(ve,De){if(1&ve&&(x.j41(0,"div"),x.DNE(1,Ze,9,6,"div",38),x.k0s()),2&ve){const he=x.XpG(2);x.R7$(),x.Y8G("ngForOf",he.surveyObjs)}}function ct(ve,De){if(1&ve){const he=x.RV6();x.DNE(0,Ie,2,1,"div",30),x.j41(1,"div",31)(2,"button",32),x.bIt("click",function(){x.eBV(he);const be=x.XpG();return x.Njj(be.changeFeedBackEmotion(2))}),x.nrm(3,"lucide-icon",33),x.j41(4,"span"),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s()(),x.j41(7,"button",34),x.bIt("click",function(){x.eBV(he);const be=x.XpG();return x.Njj(be.changeFeedBackEmotion(1))}),x.nrm(8,"lucide-icon",35),x.j41(9,"span"),x.EFF(10),x.nI1(11,"mytranslate"),x.k0s()()(),x.j41(12,"div",36)(13,"textarea",37),x.nI1(14,"mytranslate"),x.bIt("keyup",function(){x.eBV(he);const be=x.XpG();return x.Njj(be.autoResizeFeedBackArea())}),x.k0s()()}if(2&ve){const he=x.XpG();x.Y8G("ngIf",he.surveyObjs.length),x.R7$(2),x.Y8G("disabled",he.disableLike)("ngClass",x.l_i(16,S,2==he.feedBackEmotion,2!=he.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(19,K)),x.R7$(2),x.JRh(x.bMT(6,10,"lang_test_market_introduce_rating_like")),x.R7$(2),x.Y8G("disabled",he.disableLike)("ngClass",x.l_i(20,S,1==he.feedBackEmotion,1!=he.feedBackEmotion)),x.R7$(),x.Y8G("ngClass",x.lJ4(23,K)),x.R7$(2),x.JRh(x.bMT(11,12,"lang_test_market_introduce_rating_dislike")),x.R7$(3),x.FS9("placeholder",x.bMT(14,14,"lang_global_question_ask_to_feedback_placeholder"))}}function it(ve,De){1&ve&&(x.j41(0,"span",50),x.nrm(1,"azt-loading-ui"),x.k0s())}let Ce=(()=>{var ve;class De extends h._{getAnswerSurvey(){let X=[],be=this.commonService.getFormObj(this.form);for(let Ge in be)if(Ge.includes("survey_")){let Pe={surveyId:Number(Ge.substring(Ge.indexOf("_")+1)),answers:[]};if(be[Ge]instanceof Object){let Ne=this.surveyObjs.find(qe=>qe.id==Pe.surveyId);if(Ne)for(let qe in be[Ge])if(be[Ge][qe]){let Se=Number(qe.substring(qe.indexOf("_")+1));if(Array.isArray(Ne.choices)&&Ne.choices[Se]){let xe=Ne.choices[Se];Pe.answers?.push(xe)}}}else Pe.answers=[be[Ge]];X.push(Pe)}return X}getFeedbackSurveys(){this.loadingFeedBackSurvey=!0,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksSurveysGet(this.applyType,this.role).subscribe(X=>{if(1==X.success){this.surveyObjs=X.data?.objs??[];let be={feedBackContent:new s.MJ("",{nonNullable:!0,validators:[s.k0.required,_.M.noWhiteSpace]})};this.surveyObjs.length>0&&this.surveyObjs.forEach(Ge=>{if(Ge.multiChoice&&Ge.choices&&Ge.choices.length>1){let Pe={};be[`survey_${Ge.id}`]=new s.gE({}),Ge.choices.forEach((Ne,qe)=>{Pe[`choice_${qe}`]=new s.MJ(!1,{nonNullable:!0})}),be[`survey_${Ge.id}`]=this.fb.group(Pe)}else be[`survey_${Ge.id}`]=new s.MJ("",{nonNullable:!0,validators:[s.k0.required]})}),this.form=this.fb.group(be),this.loadingFeedBackSurvey=!1}else this.errorStatusObj(X.message??"",!0),this.loadingFeedBackSurvey=!1}))}getInfoFeedback(){this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksGet(this.questionId,this.applyType,this.role).subscribe(X=>{if(1==X.success){let be=X.data?.objs??[];be.length&&be[0].status&&(this.feedBackEmotion=be[0].status,this.disableLike=!0)}else this.errorStatusObj(X.message??"",!0),this.disableLike=!1}))}changeFeedBackEmotion(X){this.disableLike||(this.feedBackEmotion=X,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost({objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??void 0,content:"",surveyAnswers:[]}).subscribe(Ge=>{1==Ge.success?this.getInfoFeedback():this.errorStatusObj(Ge.message??"",!0)})))}autoResizeFeedBackArea(){const X=document.getElementById("text-area-feedback");X&&setTimeout(()=>{X.style.cssText="height:auto;",X.style.cssText="height:"+(X.scrollHeight+30)+"px"},0)}sendFeedBack(){if(this.form.invalid)this.showErrorSnack("lang_auto_vui_long_dien_day_du_thong_tin");else{this.initStatusObj(),this.sendingFeedBack=!0;let X={objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??0,content:this.form.controls.feedBackContent.value??void 0,surveyAnswers:this.getAnswerSurvey()};this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost(X).subscribe(be=>{1==be.success?(this.sendingFeedBack=!1,this.dialogRef.close(!0),this.successStatusObj("TEACHER"==this.role?"lang_test_market_success_feedback":"lang_test_market_success_feedback_student",!0)):(this.errorStatusObj(be.message??"",!0),this.sendingFeedBack=!1)}))}}btnCloseDialog(){this.dialogRef.close(!1)}ngOnInit(){this.questionId=this.data.questionObj.id,this.role=this.data.role,this.applyType=this.data.applyType,this.form=this.fb.group({feedBackContent:new s.MJ("",{nonNullable:!0,validators:[s.k0.required,_.M.noWhiteSpace]})}),this.getInfoFeedback(),this.getFeedbackSurveys(),super.ngOnInit()}constructor(X,be,Ge,Pe){super(Pe,Ge),this.fb=X,this.testMarketFeedbackService=be,this.dialogRef=Ge,this.data=Pe,this.role="",this.applyType="",this.form=new s.gE({}),this.feedBackEmotion=void 0,this.totalLike=0,this.totalDislike=0,this.sendingFeedBack=!1,this.loadingFeedBackSurvey=!1,this.disableLike=!1,this.surveyObjs=[]}}return(ve=De).\u0275fac=function(X){return new(X||ve)(x.rXU(s.ok),x.rXU(T.l_),x.rXU(d.CP,8),x.rXU(d.Vh,8))},ve.\u0275cmp=x.VBU({type:ve,selectors:[["exam-matrix-feedback-dialog"]],features:[x.Vt3],decls:25,vars:19,consts:[["doneLoading",""],["SingleChoice",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-3","border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"intro-y","overflow-auto",2,"max-height","calc(100vh - 150px)"],[1,"text-md","mr-auto","font-bold"],["class","border-t border-slate-200/60 dark:border-darkmode-400 py-2 mt-2",4,"ngIf"],[1,"border-t","border-slate-200/60","dark:border-darkmode-400","py-2","mt-2"],[3,"formGroup"],[1,"font-medium","text-md","text-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"p-3","text-right"],["azt-track-service","exam-matrix-feedback-dialog-qXEblgFcT",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","exam-matrix-feedback-dialog-NGlD5D-IvA",1,"btn","btn-primary","mw-24",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"tex2jax_process","box-content",2,"width","auto"],[3,"content"],["class","grid grid-cols-12 gap-2 answers",4,"ngIf"],["class","font-medium text-md text-left text-success my-2",4,"ngIf"],[1,"grid","grid-cols-12","gap-2","answers"],["class","answer col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"answer","col-span-12","md:col-span-6"],[1,"answer-label"],[1,"answer-content"],[1,"font-medium","text-md","text-left","text-success","my-2"],[1,"font-medium","text-md","text-center"],[1,"help-content","box","px-3","mt-1",2,"display","inherit","border-top-right-radius","0","border-top-left-radius","0","box-shadow","none","overflow","auto","padding-bottom","20px"],[1,"flex","items-center","h-full","w-full"],[1,"w-8","h-8","mx-auto"],[4,"ngIf"],[1,"flex","items-center",2,"flex-wrap","wrap"],["azt-track-service","exam-matrix-feedback-dialog-PoMeFnagK",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-up","size","24",3,"ngClass"],["azt-track-service","exam-matrix-feedback-dialog-iJokCn34oQ",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-down","size","20",3,"ngClass"],[1,"items-center","mt-1"],["id","text-area-feedback","type","text","cols","10","rows","3","formControlName","feedBackContent",1,"form-control","mt-1",3,"keyup","placeholder"],["class","flex flex-wrap mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","mb-2"],[2,"min-width","300px"],[1,"text-md","mb-2"],[1,"block","px-2","ml-2","sm:flex",3,"formGroupName"],["class","mr-5",4,"ngFor","ngForOf"],[1,"mr-5"],["type","checkbox",1,"form-check-input",3,"id","formControlName"],[2,"vertical-align","middle","cursor","pointer","margin-left","3px",3,"for"],["color","primary",1,"px-2",2,"flex-direction","column",3,"formControlName"],[4,"ngFor","ngForOf"],[1,"mr-5",3,"checked","value"],[1,"w-4","h-4","mr-2"]],template:function(X,be){if(1&X){const Ge=x.RV6();x.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),x.EFF(5),x.nI1(6,"mytranslate"),x.k0s(),x.DNE(7,D,8,6,"div",7)(8,Z,6,4,"div",7),x.j41(9,"div",8)(10,"form",9)(11,"h2",10),x.EFF(12),x.nI1(13,"mytranslate"),x.k0s(),x.DNE(14,ne,4,0,"ng-container",11)(15,ct,15,24,"ng-template",null,0,x.C5r),x.k0s()()()()(),x.j41(17,"div",12)(18,"button",13),x.bIt("click",function(){return x.eBV(Ge),x.Njj(be.btnCloseDialog())}),x.EFF(19),x.nI1(20,"mytranslate"),x.k0s(),x.j41(21,"button",14),x.bIt("click",function(){return x.eBV(Ge),x.Njj(be.sendFeedBack())}),x.DNE(22,it,2,0,"span",15),x.EFF(23),x.nI1(24,"mytranslate"),x.k0s()()()}if(2&X){const Ge=x.sdS(16);x.R7$(5),x.SpI(" ",x.bMT(6,11,be.data.questionObj.isRoleTeacher?"lang_global_question_ask_to_feedback":"lang_global_question_ask_to_report")," "),x.R7$(2),x.Y8G("ngIf",be.data.questionObj.content),x.R7$(),x.Y8G("ngIf",be.data.questionObj.help&&be.data.questionObj.isRoleTeacher),x.R7$(2),x.Y8G("formGroup",be.form),x.R7$(2),x.SpI(" ",x.bMT(13,13,"lang_auto_nhan_xet")," "),x.R7$(2),x.Y8G("ngIf",be.loadingFeedBackSurvey)("ngIfElse",Ge),x.R7$(5),x.SpI(" ",x.bMT(20,15,"lang_auto_dong")," "),x.R7$(2),x.Y8G("disabled",be.sendingFeedBack||be.form.invalid),x.R7$(),x.Y8G("ngIf",be.sendingFeedBack),x.R7$(),x.SpI(" ",x.bMT(24,17,"lang_button_send")," ")}},dependencies:[ie.YU,ie.Sq,ie.bT,fe.VT,fe._g,s.qT,s.me,s.Zm,s.BC,s.cb,s.j4,s.JD,s.$R,p.WGl,q.t,N.R,R.x,z.wp],styles:[".answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}"]}),De})()},14987:(ft,Ae,y)=>{"use strict";y.d(Ae,{i:()=>fe});var s=y(59640),d=y(48891),h=y(54460),_=y(10936),x=y(81587),T=y(47348);function ie(p,q){if(1&p&&(d.j41(0,"div",1)(1,"form",2),d.nrm(2,"input",3),d.nI1(3,"mytranslate"),d.nrm(4,"input",4),d.nI1(5,"mytranslate"),d.nrm(6,"input",5),d.nI1(7,"mytranslate"),d.nrm(8,"input",6),d.nI1(9,"mytranslate"),d.nrm(10,"input",7),d.nI1(11,"mytranslate"),d.k0s()()),2&p){const N=d.XpG();d.R7$(),d.Y8G("formGroup",N.form),d.R7$(),d.FS9("placeholder",d.bMT(3,6,"lang_azt_addition_info_exam_department_name")),d.R7$(2),d.FS9("placeholder",d.bMT(5,8,"lang_auto_ten_truong")),d.R7$(2),d.FS9("placeholder",d.bMT(7,10,"lang_azt_addition_info_exam_test_note")),d.R7$(2),d.FS9("placeholder",d.bMT(9,12,"lang_auto_mon_hoc_form")),d.R7$(2),d.FS9("placeholder",d.bMT(11,14,"lang_auto_thoi_gian"))}}let fe=(()=>{var p;class q extends s.H{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject,departmentName:this.examPrintInfoObj.departmentName,indetifyBox:this.examPrintInfoObj.indetifyBox,timeBox:this.examPrintInfoObj.timeBox})}ngOnInit(){this.initData()}}return(p=q).\u0275fac=function(R){return new(R||p)},p.\u0275cmp=d.VBU({type:p,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},features:[d.Vt3],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","department-name","type","text","formControlName","departmentName",1,"form-control","mt-3",3,"placeholder"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","indetify-box","type","text","formControlName","indetifyBox",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"],["id","time-box","type","text","formControlName","timeBox",1,"form-control","mt-3",3,"placeholder"]],template:function(R,z){1&R&&d.DNE(0,ie,12,16,"div",0),2&R&&d.Y8G("ngIf",z.form)},dependencies:[h.bT,_.qT,_.me,_.BC,_.cb,_.j4,_.JD,x.t,T.wp],encapsulation:2}),q})()},30551:(ft,Ae,y)=>{"use strict";y.d(Ae,{P:()=>D});var s=y(59640),d=y(48891),h=y(37642),_=y(36484),x=y(99927),T=y(54460),ie=y(60303),fe=y(47348);const p=Z=>({"font-bold":Z});function q(Z,ne){if(1&Z&&(d.j41(0,"td",11),d.EFF(1),d.k0s()),2&Z){const re=d.XpG().$implicit,oe=d.XpG().$implicit,Be=d.XpG(2);d.BMQ("rowspan",oe.length),d.R7$(),d.JRh(Be.toNumber(re.index)+1)}}function N(Z,ne){if(1&Z&&(d.qex(0),d.j41(1,"tr"),d.DNE(2,q,2,2,"td",10),d.j41(3,"td",11),d.EFF(4),d.nI1(5,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(6,"td",12),d.EFF(7),d.k0s()(),d.bVm()),2&Z){const re=ne.$implicit,oe=ne.index,Be=d.XpG(3);d.R7$(2),d.Y8G("ngIf",0==oe),d.R7$(2),d.JRh(d.bMT(5,4,1e3*re.second)),d.R7$(2),d.Y8G("ngClass",d.eq3(6,p,re.isFontBold)),d.R7$(),d.JRh(Be.isShowOriginAnswer?re.key:re.alpha?re.alpha:re.key)}}function R(Z,ne){if(1&Z&&(d.qex(0),d.DNE(1,N,8,8,"ng-container",9),d.bVm()),2&Z){const re=ne.$implicit;d.R7$(),d.Y8G("ngForOf",re)}}function z(Z,ne){if(1&Z&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,R,2,1,"ng-container",9),d.k0s()),2&Z){const re=d.XpG();d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_cau_hoi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"lang_auto_dap_an")),d.R7$(2),d.Y8G("ngForOf",re.groupObjs)}}function S(Z,ne){1&Z&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}function K(Z,ne){if(1&Z&&(d.qex(0),d.j41(1,"tr")(2,"td",11),d.EFF(3),d.k0s(),d.j41(4,"td",11),d.EFF(5),d.nI1(6,"formatFullDateTimeTimezoneByUserUnitPipe"),d.k0s(),d.j41(7,"td",11),d.EFF(8),d.k0s()(),d.bVm()),2&Z){let re;const oe=ne.$implicit;d.R7$(3),d.JRh(oe.userAgent),d.R7$(2),d.JRh(d.bMT(6,3,null!==(re=oe.startedAt)&&void 0!==re?re:"")),d.R7$(3),d.JRh(oe.ip)}}function B(Z,ne){if(1&Z&&(d.j41(0,"table",5)(1,"tr")(2,"th",6),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"th",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"th",8),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.DNE(11,K,9,5,"ng-container",9),d.k0s()),2&Z){const re=d.XpG(2);d.R7$(3),d.JRh(d.bMT(4,4,"lang_auto_thong_tin_thiet_bi")),d.R7$(3),d.JRh(d.bMT(7,6,"lang_auto_thoi_gian")),d.R7$(3),d.JRh(d.bMT(10,8,"IP")),d.R7$(2),d.Y8G("ngForOf",re.ipTrackingDataObjs)}}function M(Z,ne){1&Z&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Z&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_khong_co_du_lieu")))}function w(Z,ne){if(1&Z&&(d.j41(0,"mat-tab",1),d.nI1(1,"mytranslate"),d.j41(2,"div",2),d.DNE(3,B,12,10,"table",3)(4,M,3,3,"ng-template",null,0,d.C5r),d.k0s()()),2&Z){const re=d.sdS(5),oe=d.XpG();d.FS9("label",d.bMT(1,3,"lang_auto_thong_tin_thiet_bi_IP")),d.R7$(3),d.Y8G("ngIf",oe.ipTrackingDataObjs.length>0)("ngIfElse",re)}}let D=(()=>{var Z;class ne extends s.H{findReTapQuesions(){var oe=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var Be in oe)if(oe.hasOwnProperty(Be)){var Oe=oe[Be].map((Ze,Ie)=>{let ct=!1,it=this.questionObjs.find(Ce=>Ce.id==Ze.questionId);if(this.answerTypeService.isTrueFalseAnswer(it)){for(let Ce=oe[Be].length-1;Ce>=0;Ce--)if(oe[Be][Ce].key.includes(Ze.key.split("")[0])){ct=Ze.key==oe[Be][Ce].key;break}}else ct=Ie==oe[Be].length-1;return{...Ze,isFontBold:ct}});this.groupObjs.push(Oe)}}toNumber(oe){return parseInt(oe,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(oe,Be,Oe){super(),this.dictionaryService=oe,this.userService=Be,this.answerTypeService=Oe,this.startQuestionIndex=1,this.isShowOriginAnswer=!1,this.ipTrackingDataObjs=[],this.isTeacherRole=this.userService.isTeacherRole(),this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return(Z=ne).\u0275fac=function(oe){return new(oe||Z)(d.rXU(h.E),d.rXU(_.R),d.rXU(x._))},Z.\u0275cmp=d.VBU({type:Z,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",isShowOriginAnswer:"isShowOriginAnswer",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs",ipTrackingDataObjs:"ipTrackingDataObjs",questionObjs:"questionObjs"},features:[d.Vt3],decls:8,vars:6,consts:[["noData",""],[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],[3,"label",4,"ngIf"],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(oe,Be){if(1&oe&&(d.j41(0,"mat-tab-group")(1,"mat-tab",1),d.nI1(2,"mytranslate"),d.j41(3,"div",2),d.DNE(4,z,12,10,"table",3)(5,S,3,3,"ng-template",null,0,d.C5r),d.k0s()(),d.DNE(7,w,6,5,"mat-tab",4),d.k0s()),2&oe){const Oe=d.sdS(6);d.R7$(),d.FS9("label",d.bMT(2,4,"lang_auto_chi_tiet_chon_dap_an")),d.R7$(3),d.Y8G("ngIf",Be.groupObjs.length>0)("ngIfElse",Oe),d.R7$(3),d.Y8G("ngIf",Be.isTeacherRole)}},dependencies:[T.YU,T.Sq,T.bT,ie.mq,ie.T8,fe.wp,fe.Ky],encapsulation:2}),ne})()},59174:(ft,Ae,y)=>{"use strict";y.d(Ae,{g:()=>qe});var s=y(48891),d=y(38945),h=y(59640),_=y(54460),x=y(5502),T=y(15343),ie=y(18718),fe=y(68323),p=y(94743),q=y(47348);const N=(Se,xe)=>({$implicit:Se,index:xe}),R=(Se,xe,F)=>[Se,xe,F],z=(Se,xe,F)=>({second:Se,first:xe,third:F}),S=Se=>({height:Se}),K=(Se,xe,F)=>({"border-primary btn-gradient-primary":Se,"border-primary":xe,"mt-4":F}),B=Se=>({"text-white":Se});function M(Se,xe){if(1&Se&&s.nrm(0,"azt-loading-effect",4),2&Se){const F=s.XpG();s.Y8G("currentStatusObj",F.statusObj)}}function w(Se,xe){1&Se&&s.eu8(0)}function D(Se,xe){if(1&Se&&(s.qex(0),s.DNE(1,w,1,0,"ng-container",15),s.bVm()),2&Se){const F=xe.$implicit,Y=xe.index;s.XpG(4);const et=s.sdS(4);s.R7$(),s.Y8G("ngTemplateOutlet",et)("ngTemplateOutletContext",s.l_i(2,N,F,Y))}}function Z(Se,xe){if(1&Se){const F=s.RV6();s.j41(0,"div",10),s.DNE(1,D,2,5,"ng-container",11),s.j41(2,"div",12)(3,"button",13),s.bIt("click",function(){s.eBV(F);const et=s.XpG(3);return s.Njj(et.redirectToLeaderboard())}),s.EFF(4),s.nI1(5,"mytranslate"),s.nrm(6,"lucide-icon",14),s.k0s()()()}if(2&Se){const F=s.XpG(3);s.R7$(),s.Y8G("ngForOf",F.rankingResultList),s.R7$(3),s.SpI(" ",s.bMT(5,2,"lang_auto_xem_them")," ")}}function ne(Se,xe){if(1&Se&&(s.j41(0,"div",31),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&Se){const F=s.XpG().$implicit;s.R7$(),s.JRh(F.mark+" "+s.bMT(2,1,"lang_auto_diem"))}}function re(Se,xe){1&Se&&(s.j41(0,"div",32),s.nrm(1,"azt-svg-icon",33),s.k0s()),2&Se&&(s.R7$(),s.Y8G("size",40))}function oe(Se,xe){1&Se&&(s.j41(0,"div",34),s.nrm(1,"azt-svg-icon",35),s.k0s()),2&Se&&(s.R7$(),s.Y8G("size",120))}function Be(Se,xe){1&Se&&(s.j41(0,"div",36),s.nrm(1,"azt-svg-icon",37),s.k0s()),2&Se&&(s.R7$(),s.Y8G("size",120))}function Oe(Se,xe){1&Se&&(s.j41(0,"div"),s.nrm(1,"azt-svg-icon",38),s.k0s()),2&Se&&(s.R7$(),s.Y8G("size",120))}function Ze(Se,xe){if(1&Se&&(s.qex(0),s.j41(1,"div",21)(2,"div",22),s.nrm(3,"azt-create-avatar",23),s.j41(4,"div",24),s.EFF(5),s.k0s(),s.DNE(6,ne,3,3,"div",25)(7,re,2,1,"div",26),s.k0s(),s.j41(8,"div",27),s.DNE(9,oe,2,1,"div",28)(10,Be,2,1,"div",29)(11,Oe,2,1,"div",30),s.k0s()(),s.bVm()),2&Se){let F,Y;const et=xe.$implicit,Xe=xe.index;s.R7$(3),s.Y8G("linkAvatar",null==et?null:et.avatar)("nameCreateAvatar",null!==(F=null==et?null:et.fullName)&&void 0!==F?F:"???")("size",60),s.R7$(2),s.JRh(null!==(Y=null==et?null:et.fullName)&&void 0!==Y?Y:"???"),s.R7$(),s.Y8G("ngIf",null==et?null:et.mark),s.R7$(),s.Y8G("ngIf",1===Xe),s.R7$(),s.Y8G("ngClass",s.sMw(10,z,0===Xe,1===Xe,2===Xe)),s.R7$(),s.Y8G("ngIf",0===Xe),s.R7$(),s.Y8G("ngIf",1===Xe),s.R7$(),s.Y8G("ngIf",2===Xe)}}function Ie(Se,xe){1&Se&&s.eu8(0)}function ct(Se,xe){if(1&Se&&(s.qex(0),s.DNE(1,Ie,1,0,"ng-container",15),s.bVm()),2&Se){const F=xe.$implicit,Y=xe.index;s.XpG(4);const et=s.sdS(4);s.R7$(),s.Y8G("ngTemplateOutlet",et)("ngTemplateOutletContext",s.l_i(2,N,F,Y))}}function it(Se,xe){if(1&Se&&(s.j41(0,"div",16)(1,"div",17)(2,"div",18),s.DNE(3,Ze,12,14,"ng-container",11),s.k0s()(),s.j41(4,"div",19)(5,"ng-scrollbar",20),s.DNE(6,ct,2,5,"ng-container",11),s.k0s()()()),2&Se){const F=s.XpG(3);s.R7$(3),s.Y8G("ngForOf",s.sMw(2,R,F.rankingSecond,F.rankingFirst,F.rankingThird)),s.R7$(3),s.Y8G("ngForOf",F.rankingResultList)}}function Ce(Se,xe){if(1&Se&&(s.j41(0,"div",6)(1,"div",7),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s(),s.DNE(4,Z,7,4,"div",8)(5,it,7,6,"div",9),s.k0s()),2&Se){const F=s.XpG(2);s.R7$(2),s.SpI(" ",s.bMT(3,3,"lang_azt_leaderboard")," "),s.R7$(2),s.Y8G("ngIf","part"===F.view),s.R7$(),s.Y8G("ngIf","full"===F.view)}}function ve(Se,xe){if(1&Se&&(s.j41(0,"div",39)(1,"div",7),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s(),s.j41(4,"div",40)(5,"div",41),s.nrm(6,"azt-svg-icon",42),s.j41(7,"p",43),s.EFF(8),s.nI1(9,"mytranslate"),s.k0s()()()()),2&Se){const F=s.XpG(2);s.R7$(2),s.SpI(" ",s.bMT(3,4,"lang_azt_leaderboard")," "),s.R7$(2),s.Y8G("ngStyle",s.eq3(8,S,"full"===F.view?"70vh":"260px")),s.R7$(2),s.Y8G("size",82),s.R7$(2),s.JRh(s.bMT(9,6,"lang_not_data")+"!")}}function De(Se,xe){if(1&Se&&s.DNE(0,Ce,6,5,"div",5)(1,ve,10,10,"ng-template",null,2,s.C5r),2&Se){const F=s.sdS(2),Y=s.XpG();s.Y8G("ngIf",Y.rankingResultList.length)("ngIfElse",F)}}function he(Se,xe){if(1&Se&&(s.j41(0,"div",57),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&Se){const F=s.XpG(),Y=F.$implicit;s.Y8G("ngClass",s.eq3(4,B,0===F.index&&Y.mark)),s.R7$(),s.SpI(" ",Y.mark+" "+s.bMT(2,2,"lang_auto_diem")," ")}}function X(Se,xe){1&Se&&(s.j41(0,"div",58),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&Se&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"lang_not_data")," "))}function be(Se,xe){1&Se&&s.nrm(0,"azt-svg-icon",59),2&Se&&s.Y8G("size",40)}function Ge(Se,xe){1&Se&&s.nrm(0,"azt-svg-icon",60),2&Se&&s.Y8G("size",40)}function Pe(Se,xe){1&Se&&s.nrm(0,"azt-svg-icon",61),2&Se&&s.Y8G("size",40)}function Ne(Se,xe){if(1&Se&&(s.j41(0,"div",44)(1,"div",45)(2,"span",46),s.EFF(3),s.k0s()(),s.j41(4,"div",47)(5,"div",48),s.nrm(6,"azt-create-avatar",23),s.k0s(),s.j41(7,"div",49)(8,"div",50),s.EFF(9),s.k0s(),s.DNE(10,he,3,6,"div",51)(11,X,3,3,"div",52),s.k0s()(),s.j41(12,"div",53),s.DNE(13,be,1,1,"azt-svg-icon",54)(14,Ge,1,1,"azt-svg-icon",55)(15,Pe,1,1,"azt-svg-icon",56),s.k0s()()),2&Se){const F=xe.$implicit,Y=xe.index;s.Y8G("ngClass",s.sMw(11,K,0===Y&&F.mark,(1===Y||2===Y)&&F.mark,0!==Y)),s.R7$(3),s.JRh(Y+1),s.R7$(3),s.Y8G("linkAvatar",F.avatar)("nameCreateAvatar",F.fullName)("size",44),s.R7$(3),s.JRh(F.fullName),s.R7$(),s.Y8G("ngIf",F.mark),s.R7$(),s.Y8G("ngIf",!F.mark),s.R7$(2),s.Y8G("ngIf",0===Y&&F.mark),s.R7$(),s.Y8G("ngIf",1===Y&&F.mark),s.R7$(),s.Y8G("ngIf",2===Y&&F.mark)}}let qe=(()=>{var Se;class xe extends h.H{constructor(){super(...arguments),this.view="part",this.frontExamResultService=(0,s.WQX)(d.Ry),this.rankingResultList=[]}ngOnInit(){super.ngOnInit(),this.getRankingResultList()}getRankingResultList(){this.initStatusObj(),this.waitDestroy(this.frontExamResultService.apiFrontExamResultListRankingResultsGet(this.hashId,"part"===this.view?1:0,"part"===this.view?3:0).subscribe(Xe=>{if(!Xe.success)return this.errorStatusObj(Xe.message);this.rankingResultList=Xe.data?.objs??[],this.rankingFirst=this.rankingResultList?.[0],this.rankingSecond=this.rankingResultList?.[1],this.rankingThird=this.rankingResultList?.[2],this.successStatusObj()}))}redirectToLeaderboard(){const Y=this.commonService.getMyQueryParam("capacity")??"0",et=this.commonService.getCurrentUrlWithoutLocale()+`?capacity=${Y}`;this.myNavigationWithQueryString(`/test/leaderboard/${this.hashId}`,`?backto=${encodeURIComponent(et)}`)}}return(Se=xe).\u0275fac=(()=>{let F;return function(et){return(F||(F=s.xGo(Se)))(et||Se)}})(),Se.\u0275cmp=s.VBU({type:Se,selectors:[["azt-leaderboard"]],inputs:{hashId:"hashId",view:"view"},features:[s.Vt3],decls:5,vars:2,consts:[["doneLoading",""],["rankingResultItem",""],["emptyData",""],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],["class","p-4 leaderboard box",4,"ngIf","ngIfElse"],[1,"p-4","leaderboard","box"],[1,"text-lg","text-center","font-bold"],["class","mt-4",4,"ngIf"],["class","grid grid-cols-12 gap-6 mt-4",4,"ngIf"],[1,"mt-4"],[4,"ngFor","ngForOf"],[1,"mt-3","text-center"],[1,"btn","btn-outline-primary","btn-transparent",3,"click"],["name","chevron-right","size","16"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"grid","grid-cols-12","gap-6","mt-4"],[1,"col-span-12","md:col-span-6","flex","flex-col","h-full"],[1,"flex","items-end","mt-auto"],[1,"col-span-12","md:col-span-6","p-4","border","border-white","rounded-lg",2,"height","70vh"],["visibility","hover","track","vertical","pointerEventsMethod","scrollbar"],[1,"ranking"],[1,"user-ranking"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"mt-1","font-medium","text-base"],["class","mt-1 font-medium",4,"ngIf"],["class","crown-top1",4,"ngIf"],[1,"tower","box","shadow-lg",3,"ngClass"],["style","padding-bottom: 15px",4,"ngIf"],["style","padding-bottom: 30px",4,"ngIf"],[4,"ngIf"],[1,"mt-1","font-medium"],[1,"crown-top1"],["type","crown-top1",3,"size"],[2,"padding-bottom","15px"],["type","cup-silver",3,"size"],[2,"padding-bottom","30px"],["type","cup-gold",3,"size"],["type","cup-copper",3,"size"],[1,"box","p-4"],[1,"mt-4","flex","items-center","justify-center",3,"ngStyle"],[1,"text-center","mx-auto"],["type","inbox-empty",3,"size"],[1,"font-medium","mt-5"],[1,"flex","items-center","box","intro-x","zoom-in","p-3","border","border-w-2",3,"ngClass"],[1,"w-5","h-5","rounded-full","border","border-slate-200","dark:border-slate-400","flex","items-center","justify-center"],[1,"text-xs","font-medium"],[1,"mx-3","flex","items-center"],[1,"image-fit","zoom-in"],[1,"ml-4"],[1,"font-medium","text-base"],["class","text-slate-600 mt-0.5 text-xs font-medium",3,"ngClass",4,"ngIf"],["class","text-slate-600 mt-0.5 text-xs font-medium",4,"ngIf"],[1,"ml-auto"],["type","crown-gold",3,"size",4,"ngIf"],["type","crown-silver",3,"size",4,"ngIf"],["type","crown-copper",3,"size",4,"ngIf"],[1,"text-slate-600","mt-0.5","text-xs","font-medium",3,"ngClass"],[1,"text-slate-600","mt-0.5","text-xs","font-medium"],["type","crown-gold",3,"size"],["type","crown-silver",3,"size"],["type","crown-copper",3,"size"]],template:function(Y,et){if(1&Y&&s.DNE(0,M,1,1,"azt-loading-effect",3)(1,De,3,2,"ng-template",null,0,s.C5r)(3,Ne,16,15,"ng-template",null,1,s.C5r),2&Y){const Xe=s.sdS(2);s.Y8G("ngIf",et.statusObj.loading)("ngIfElse",Xe)}},dependencies:[_.YU,_.Sq,_.bT,_.T3,_.B3,x.Yh,T.WGl,ie.K,fe.p,p.m,q.wp],styles:[".leaderboard[_ngcontent-%COMP%]{background:#dae3fe}.mt-auto[_ngcontent-%COMP%]{margin-top:auto}.ranking[_ngcontent-%COMP%]{width:33.3333333333%}.user-ranking[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative}.crown-top1[_ngcontent-%COMP%]{position:absolute;top:-26px;left:50%;transform:rotate(30deg)}.tower[_ngcontent-%COMP%]{margin-top:15px;border-radius:25px 25px 0 0;display:flex;justify-content:center;align-items:flex-end}.first[_ngcontent-%COMP%]{height:200px}.second[_ngcontent-%COMP%]{height:160px}.third[_ngcontent-%COMP%]{height:120px}"]}),xe})()},78745:(ft,Ae,y)=>{"use strict";y.d(Ae,{d:()=>S});var s=y(59640),d=y(48891),h=y(54460),_=y(17818),x=y(47712),T=y(15343),ie=y(64160),fe=y(15437),p=y(47348);const q=()=>({"mr-2":!0});function N(K,B){if(1&K){const M=d.RV6();d.qex(0),d.j41(1,"div",6)(2,"p",7),d.EFF(3),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"p",7),d.EFF(6),d.nI1(7,"mytranslate"),d.k0s(),d.j41(8,"div",8),d.nrm(9,"input",9),d.j41(10,"button",10),d.bIt("click",function(){d.eBV(M);const D=d.XpG();return d.Njj(D.showCopySuccess())}),d.nrm(11,"lucide-icon",11),d.EFF(12),d.nI1(13,"mytranslate"),d.k0s()()(),d.bVm()}if(2&K){const M=d.XpG();d.R7$(3),d.JRh(d.bMT(4,6,"lang_auto_hoac")),d.R7$(3),d.JRh(d.bMT(7,8,"lang_classroom_QR_join_link_copy")),d.R7$(3),d.Y8G("value",M.linkUrl),d.R7$(),d.Y8G("cdkCopyToClipboard",M.copyLinkToClipboard(M.linkUrl)),d.R7$(),d.Y8G("ngClass",d.lJ4(12,q)),d.R7$(),d.SpI(" ",d.bMT(13,10,"lang_auto_sao_chep")," ")}}let R=(()=>{var K;class B extends s.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1,this.qrCodeDownloadLink=""}showCopySuccess(){this.showSuccessSnack("lang_auto_sao_chep_thanh_cong")}copyLinkToClipboard(w){return w}onChangeURL(w){this.qrCodeDownloadLink=w}downloadQrCode(){try{let w=""!=this.fileName?this.commonService.createFileNameExportFile([this.fileName])+".jpg":this.commonService.createFileNameExportFile(["azota-qr-code-"])+".jpg";this.commonService.downloadFileByUrl(this.qrCodeDownloadLink.changingThisBreaksApplicationSecurity,w)}catch{console.log("Download QrCode error")}}}return(K=B).\u0275fac=(()=>{let M;return function(D){return(M||(M=d.xGo(K)))(D||K)}})(),K.\u0275cmp=d.VBU({type:K,selectors:[["azt-show-link"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:8,vars:11,consts:[["azt-track-service","download-qr-code-9t-9Wiu2xv",1,"box","p-3","text-center",3,"click"],[2,"background","#fff","padding","5px"],["colorDark","#2361ad","imageSrc","'images/Azota-For-QrCode-01.png' | coreModConvertCdnLinkOfGitHub",3,"qrCodeURL","allowEmptyString","qrdata","elementType","width","errorCorrectionLevel"],["azt-track-service","download-qr-code-RqVBz6g1z7",1,"btn","btn-outline-primary","btn-transparent","btn-sm","mx-auto","mt-2",3,"click"],["name","download","size","16",3,"ngClass"],[4,"ngIf"],[1,"text-center"],[1,"h5","mt-2","font-medium"],[1,"azt-copy","relative","mt-2"],["type","text","readonly","",1,"form-control","py-3","px-4","border-transparent","bg-slate-100","pr-10",2,"padding-right","120px",3,"value"],["azt-track-service","download-qr-code-yW-aFu0tO",1,"btn","btn-outline-primary","absolute","my-auto","inset-y-0","right-0",2,"border-top-left-radius","0","border-bottom-left-radius","0",3,"click","cdkCopyToClipboard"],["name","copy","size","16",3,"ngClass"]],template:function(w,D){1&w&&(d.j41(0,"div",0),d.bIt("click",function(ne){return ne.stopPropagation()}),d.j41(1,"div",1)(2,"qrcode",2),d.bIt("qrCodeURL",function(ne){return D.onChangeURL(ne)}),d.k0s()(),d.j41(3,"a",3),d.bIt("click",function(){return D.downloadQrCode()}),d.nrm(4,"lucide-icon",4),d.EFF(5),d.nI1(6,"mytranslate"),d.k0s(),d.DNE(7,N,14,13,"ng-container",5),d.k0s()),2&w&&(d.R7$(2),d.Y8G("allowEmptyString",!0)("qrdata",D.linkUrl)("elementType","url")("width",128)("errorCorrectionLevel","M"),d.R7$(2),d.Y8G("ngClass",d.lJ4(10,q)),d.R7$(),d.SpI(" ",d.bMT(6,8,"lang_auto_tai_ve_may")," "),d.R7$(2),d.Y8G("ngIf",D.showLink))},dependencies:[h.YU,h.bT,ie.dF,T.WGl,fe.c,p.wp],encapsulation:2}),B})();const z=K=>({"w-80":K});let S=(()=>{var K;class B extends s.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1}}return(K=B).\u0275fac=(()=>{let M;return function(D){return(M||(M=d.xGo(K)))(D||K)}})(),K.\u0275cmp=d.VBU({type:K,selectors:[["azt-download-qr-code"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},features:[d.Vt3],decls:7,vars:10,consts:[["showQrCode","matMenu"],["azt-track-service","download-qr-code-hiQXy_iTc",1,"btn","btn-outline-primary","btn-transparent","p-1",3,"matMenuTriggerFor","matTooltip"],["name","qr-code","size","24"],["xPosition","before"],[3,"ngClass"],[3,"linkUrl","fileName","showLink"]],template:function(w,D){if(1&w&&(d.j41(0,"button",1),d.nI1(1,"mytranslate"),d.nrm(2,"lucide-icon",2),d.k0s(),d.j41(3,"mat-menu",3,0)(5,"div",4),d.nrm(6,"azt-show-link",5),d.k0s()()),2&w){const Z=d.sdS(4);d.FS9("matTooltip",d.bMT(1,6,"lang_auto_quet_hoac_tai_ma_qr_code")),d.Y8G("matMenuTriggerFor",Z),d.R7$(5),d.Y8G("ngClass",d.eq3(8,z,D.showLink)),d.R7$(),d.Y8G("linkUrl",D.linkUrl)("fileName",D.fileName)("showLink",D.showLink)}},dependencies:[h.YU,_.kk,_.Cp,x.oV,T.WGl,R,p.wp],encapsulation:2}),B})()},8022:(ft,Ae,y)=>{"use strict";y.d(Ae,{n:()=>it});var s=y(48891),d=y(52909),h=y(50334),_=y(54460),x=y(15343),T=y(47348);const ie=Ce=>({nodeObjs:Ce}),fe=Ce=>({"padding-left":Ce}),p=()=>({"rotate-90deg":!0}),q=()=>({"transition-3s":!0}),N=()=>({"ml-1":!0});function R(Ce,ve){1&Ce&&s.eu8(0)}function z(Ce,ve){1&Ce&&(s.j41(0,"label",6)(1,"span",7),s.EFF(2),s.nI1(3,"mytranslate"),s.k0s()()),2&Ce&&(s.R7$(2),s.JRh(s.bMT(3,1,"lang_azt_structure_of_the_capacity_exam")))}function S(Ce,ve){1&Ce&&s.eu8(0)}function K(Ce,ve){if(1&Ce&&(s.qex(0),s.DNE(1,S,1,0,"ng-container",8),s.bVm()),2&Ce){const De=s.XpG(2),he=s.sdS(4);s.R7$(),s.Y8G("ngTemplateOutlet",he)("ngTemplateOutletContext",s.eq3(2,ie,De.nodeObjs))}}function B(Ce,ve){if(1&Ce&&(s.DNE(0,z,4,3,"label",3),s.j41(1,"div",4),s.DNE(2,K,2,4,"ng-container",5),s.k0s()),2&Ce){const De=s.XpG();s.Y8G("ngIf",De.isShowLabel),s.R7$(2),s.Y8G("ngIf",De.nodeObjs.length)}}function M(Ce,ve){1&Ce&&s.nrm(0,"lucide-icon",20),2&Ce&&s.Y8G("ngClass",s.lJ4(1,p))}function w(Ce,ve){1&Ce&&s.nrm(0,"lucide-icon",21),2&Ce&&s.Y8G("ngClass",s.lJ4(1,q))}function D(Ce,ve){if(1&Ce&&(s.j41(0,"span",22),s.EFF(1),s.nI1(2,"mytranslate"),s.nI1(3,"mytranslate"),s.nI1(4,"mytranslate"),s.k0s()),2&Ce){const De=s.XpG(2).$implicit;s.R7$(),s.SpI(" ","("+s.bMT(2,1,"lang_auto_chon")+" "+De.data.folderData.totalPart+" "+s.bMT(3,3,"lang_azt_in")+" "+De.children.length+" "+s.bMT(4,5,"lang_azt_hereafter")+")"," ")}}function Z(Ce,ve){if(1&Ce){const De=s.RV6();s.qex(0),s.j41(1,"div",13),s.bIt("click",function(){s.eBV(De);const X=s.XpG().$implicit,be=s.XpG(3);return s.Njj(be.clickToNode(X))}),s.j41(2,"div",14),s.DNE(3,M,1,2,"lucide-icon",15)(4,w,1,2,"lucide-icon",16),s.nrm(5,"lucide-icon",17),s.j41(6,"span",18),s.EFF(7),s.k0s(),s.DNE(8,D,5,7,"span",19),s.k0s()(),s.bVm()}if(2&Ce){const De=s.XpG().$implicit;s.R7$(3),s.Y8G("ngIf",!De.isExpand),s.R7$(),s.Y8G("ngIf",De.isExpand),s.R7$(3),s.JRh(De.data.folderData.name),s.R7$(),s.Y8G("ngIf",De.children.length&&De.data.folderData.totalPart&&De.children.length!=De.data.folderData.totalPart)}}function ne(Ce,ve){if(1&Ce&&(s.j41(0,"span"),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&Ce){const De=s.XpG(2).$implicit;s.R7$(),s.Lme("\xa0(",De.data.examData.minutes," ",s.bMT(2,2,"lang_auto_minute"),")")}}function re(Ce,ve){1&Ce&&(s.j41(0,"span"),s.EFF(1),s.nI1(2,"mytranslate"),s.k0s()),2&Ce&&(s.R7$(),s.SpI("\xa0(",s.bMT(2,1,"lang_auto_khong_gioi_han"),")"))}function oe(Ce,ve){if(1&Ce){const De=s.RV6();s.qex(0),s.j41(1,"div",23),s.bIt("click",function(){s.eBV(De);const X=s.XpG().$implicit,be=s.XpG(3);return s.Njj(be.selectExam(X.data.examData))}),s.nrm(2,"lucide-icon",24),s.j41(3,"span",18),s.EFF(4),s.DNE(5,ne,3,4,"span",5)(6,re,3,3,"span",5),s.k0s()(),s.bVm()}if(2&Ce){const De=s.XpG().$implicit;s.R7$(2),s.Y8G("name",De.data.examData.isPublished?"file-check":"file")("ngClass",s.lJ4(5,N)),s.R7$(2),s.SpI(" ",De.data.examData.name," "),s.R7$(),s.Y8G("ngIf",De.data.examData.minutes),s.R7$(),s.Y8G("ngIf",!De.data.examData.minutes)}}function Be(Ce,ve){1&Ce&&s.eu8(0)}function Oe(Ce,ve){if(1&Ce&&(s.qex(0),s.j41(1,"div",25),s.DNE(2,Be,1,0,"ng-container",8),s.k0s(),s.bVm()),2&Ce){const De=s.XpG().$implicit;s.XpG(3);const he=s.sdS(4);s.R7$(2),s.Y8G("ngTemplateOutlet",he)("ngTemplateOutletContext",s.eq3(2,ie,De.children))}}function Ze(Ce,ve){if(1&Ce&&(s.qex(0),s.j41(1,"div",10)(2,"div",11)(3,"div",12),s.DNE(4,Z,9,4,"ng-container",5)(5,oe,7,6,"ng-container",5),s.k0s(),s.DNE(6,Oe,3,4,"ng-container",5),s.k0s()(),s.bVm()),2&Ce){const De=ve.$implicit;s.R7$(),s.Y8G("hidden",!De.isShow),s.R7$(),s.Y8G("ngStyle",s.eq3(9,fe,De.level>0?"20px":"")),s.R7$(),s.yjJ("id","node-",De.randomHashId,"-",De.level,"-",De.nodeIndex,""),s.R7$(),s.Y8G("ngIf",De.data.folderData),s.R7$(),s.Y8G("ngIf",De.data.examData),s.R7$(),s.Y8G("ngIf",De.isExpand)}}function Ie(Ce,ve){if(1&Ce&&(s.qex(0),s.DNE(1,Ze,7,11,"ng-container",9),s.bVm()),2&Ce){const De=ve.$implicit;s.R7$(),s.Y8G("ngForOf",De)}}function ct(Ce,ve){if(1&Ce&&s.DNE(0,Ie,2,1,"ng-container",5),2&Ce){const De=ve.nodeObjs,he=s.XpG();s.Y8G("ngIf",he.asTemplateDataObj(De))}}let it=(()=>{var Ce;class ve extends h.C{constructor(){super(...arguments),this.isShowLabel=!0,this.isExpand=!0,this.showCountInfo=!1,this.getExamData=new s.bkB,this.nodeObjs=[],this.uuidService=(0,s.WQX)(d.D)}selectExam(he){this.getExamData.emit(he)}clickToNode(he){he.isExpand?this.collapse(he):this.expand(he)}asTemplateDataObj(he){return he}standardTreeNodes(he,X,be){let Ge=[];return he.forEach((Pe,Ne)=>{let qe=Pe.exam?void 0:{name:Pe.objectName??"Empty",totalPart:Pe.totalPart},Se=Pe.exam?{id:Pe.exam.id,hashId:Pe.exam.hashId??"",categoryId:Pe.exam.categoryId??0,name:Pe.exam.name,minutes:Pe.exam.minutes??0,totalQuestion:Pe.exam.countQuestion,isPublished:!!Pe.exam.isPublished}:void 0,xe={level:X,isExpand:this.isExpand,isShow:!0,nodeIndex:Ne,selected:!1,randomHashId:this.uuidService.getUuid(),data:{nodeId:Pe.objectId??0,isEdited:!1,folderData:qe,examData:Se,parentNodeId:be,children:Pe.children},children:[],text:"Not use"};xe.children=this.standardTreeNodes(Pe.children,X+1,xe.data.nodeId),Ge.push(xe)}),Ge}ngOnChanges(he){he.rawNodes&&(this.nodeObjs=this.standardTreeNodes(this.rawNodes,0,0))}}return(Ce=ve).\u0275fac=(()=>{let De;return function(X){return(De||(De=s.xGo(Ce)))(X||Ce)}})(),Ce.\u0275cmp=s.VBU({type:Ce,selectors:[["app-capacity-exam-tree-in-view-mode-component"]],inputs:{rawNodes:"rawNodes",isShowLabel:"isShowLabel",isExpand:"isExpand",showCountInfo:"showCountInfo"},outputs:{getExamData:"getExamData"},features:[s.Vt3,s.OA$],decls:5,vars:1,consts:[["mainContent",""],["recursiveListTmpl",""],[4,"ngTemplateOutlet"],["class","flex items-center",4,"ngIf"],["id","list-category-arr",1,"grid","grid-cols-12","gap-1"],[4,"ngIf"],[1,"flex","items-center"],[1,"font-medium","text-lg"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngFor","ngForOf"],[1,"col-span-12",3,"hidden"],[3,"ngStyle"],[1,"flex","items-center","mb-1","w-full","hover:bg-slate-100","dark:hover:bg-darkmode-400","rounded",3,"id"],[1,"flex","items-center","clickable","w-full",3,"click"],[1,"pt-2","pb-2"],["name","chevron-right","size","18",3,"ngClass",4,"ngIf"],["name","chevron-down","size","18",3,"ngClass",4,"ngIf"],["name","folder","size","18",2,"padding-left","5px"],[1,"ml-2"],["class","ml-1 text-slate-500 text-xs",4,"ngIf"],["name","chevron-right","size","18",3,"ngClass"],["name","chevron-down","size","18",3,"ngClass"],[1,"ml-1","text-slate-500","text-xs"],[1,"flex","items-center","pb-2","pt-2","clickable",3,"click"],["size","18",1,"text-pending",3,"name","ngClass"],[1,"grid","grid-cols-12","gap-1","w-full","children-tmp"]],template:function(he,X){if(1&he&&s.DNE(0,R,1,0,"ng-container",2)(1,B,3,2,"ng-template",null,0,s.C5r)(3,ct,1,1,"ng-template",null,1,s.C5r),2&he){const be=s.sdS(2);s.Y8G("ngTemplateOutlet",be)}},dependencies:[_.YU,_.Sq,_.bT,_.T3,_.B3,x.WGl,T.wp],encapsulation:2}),ve})()},72802:(ft,Ae,y)=>{"use strict";y.d(Ae,{f:()=>F});var s=y(27691),d=y(48891),h=y(10936),_=y(67421),x=y(59640),T=y(78111),ie=y(83229),fe=y(51913),p=y(58112),q=y(55465),N=y(76476),R=y(48451),z=y(54460),S=y(47712),K=y(15343),B=y(7919),M=y(81587),w=y(84278),D=y(34815),Z=y(47348);const ne=["mnoteContainer"],re=Y=>({display:Y}),oe=Y=>({border:Y}),Be=()=>({"mr-1":!0}),Oe=Y=>({"is-invalid":Y});function Ze(Y,et){1&Y&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Y&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Ie(Y,et){1&Y&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Y&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function ct(Y,et){1&Y&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Y&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function it(Y,et){if(1&Y&&(d.j41(0,"div",18),d.DNE(1,Ze,3,3,"span",19)(2,Ie,3,3,"span",19)(3,ct,3,3,"span",19),d.k0s()),2&Y){const Xe=d.XpG().index,Qe=d.XpG();d.R7$(),d.Y8G("ngIf",null==Qe.form.controls["cau"+Xe].errors?null:Qe.form.controls["cau"+Xe].errors.min),d.R7$(),d.Y8G("ngIf",null==Qe.form.controls["cau"+Xe].errors?null:Qe.form.controls["cau"+Xe].errors.max),d.R7$(),d.Y8G("ngIf",null==Qe.form.controls["cau"+Xe].errors?null:Qe.form.controls["cau"+Xe].errors.pattern)}}function Ce(Y,et){if(1&Y){const Xe=d.RV6();d.j41(0,"div",11)(1,"div",12)(2,"lucide-icon",13),d.nI1(3,"mytranslate"),d.bIt("click",function(ke){const tt=d.eBV(Xe).index,st=d.XpG();return d.Njj(st.toggleVisibility(ke,tt))}),d.k0s(),d.j41(4,"span",14),d.EFF(5),d.nI1(6,"mytranslate"),d.j41(7,"span",15),d.nI1(8,"mytranslate"),d.EFF(9),d.nI1(10,"mytranslate"),d.k0s()(),d.nrm(11,"input",16),d.nI1(12,"mytranslate"),d.k0s(),d.DNE(13,it,4,3,"div",17),d.k0s()}if(2&Y){let Xe;const Qe=et.$implicit,ke=et.index,tt=d.XpG();d.Y8G("ngStyle",d.eq3(25,oe,ke==tt.questions.length-1?"none":"")),d.R7$(2),d.FS9("matTooltip",d.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),d.Y8G("ngClass",d.lJ4(27,Be)),d.R7$(3),d.Lme(" ",d.bMT(6,17,"lang_auto_cau")," ",(null!==(Xe=Qe.indexLabel)&&void 0!==Xe?Xe:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",Qe.essMaxPoint," ",d.bMT(10,21,"lang_auto_diem_brackets"),""),d.R7$(2),d.FS9("placeholder",d.bMT(12,23,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",ke,""),d.Y8G("readonly",!tt.showForTeacher)("decimal",!0)("ngClass",d.eq3(28,Oe,tt.form.controls["cau"+ke]&&tt.form.controls["cau"+ke].invalid)),d.R7$(2),d.Y8G("ngIf",tt.form.controls["cau"+ke].errors)}}function ve(Y,et){if(1&Y){const Xe=d.RV6();d.j41(0,"div",20)(1,"button",21),d.bIt("click",function(){d.eBV(Xe);const ke=d.XpG();return d.Njj(ke.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Y){const Xe=d.XpG();d.R7$(),d.Y8G("disabled",Xe.isLoading||Xe.form.invalid),d.R7$(),d.SpI(" ",Xe.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}function De(Y,et){if(1&Y&&d.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Y){let Xe;const Qe=d.XpG().$implicit,ke=d.XpG();d.Y8G("follower",ke.followerRenderQuest)("examObj",ke.examObj)("examConfig",ke.examConfig)("questionObj",Qe)("curQuestionIndex",null!==(Xe=Qe.indexLabel)&&void 0!==Xe?Xe:0)("userAnswersObj",ke.userAnswersObj)("currentTab","essay_tab")}}function he(Y,et){if(1&Y&&d.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Y){let Xe;const Qe=d.XpG().$implicit,ke=d.XpG();d.Y8G("follower",ke.followerRenderQuest)("examObj",ke.examObj)("questionObj",Qe)("curQuestionIndex",null!==(Xe=Qe.indexLabel)&&void 0!==Xe?Xe:0)("userAnswersObj",ke.userAnswersObj)("orgExamObjs",ke.orgExamObjs)("currentTab","essay_tab")}}function X(Y,et){1&Y&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Y&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function be(Y,et){1&Y&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Y&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Ge(Y,et){1&Y&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&Y&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Pe(Y,et){if(1&Y&&(d.j41(0,"div",18),d.DNE(1,X,3,3,"span",19)(2,be,3,3,"span",19)(3,Ge,3,3,"span",19),d.k0s()),2&Y){const Xe=d.XpG(2).index,Qe=d.XpG();d.R7$(),d.Y8G("ngIf",null==Qe.form.controls["cau"+Xe].errors?null:Qe.form.controls["cau"+Xe].errors.min),d.R7$(),d.Y8G("ngIf",null==Qe.form.controls["cau"+Xe].errors?null:Qe.form.controls["cau"+Xe].errors.max),d.R7$(),d.Y8G("ngIf",null==Qe.form.controls["cau"+Xe].errors?null:Qe.form.controls["cau"+Xe].errors.pattern)}}function Ne(Y,et){if(1&Y&&(d.j41(0,"div",29)(1,"form",30)(2,"label",31),d.EFF(3),d.nI1(4,"mytranslate"),d.j41(5,"span",15),d.nI1(6,"mytranslate"),d.EFF(7),d.nI1(8,"mytranslate"),d.k0s(),d.EFF(9," : "),d.k0s(),d.nrm(10,"input",32),d.nI1(11,"mytranslate"),d.DNE(12,Pe,4,3,"div",17),d.k0s()()),2&Y){let Xe;const Qe=d.XpG(),ke=Qe.$implicit,tt=Qe.index,st=d.XpG();d.R7$(),d.Y8G("formGroup",st.form),d.R7$(),d.FS9("for","cau_"+tt),d.R7$(),d.Lme(" ",d.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(Xe=ke.indexLabel)&&void 0!==Xe?Xe:0)+1," "),d.R7$(2),d.FS9("matTooltip",d.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),d.R7$(2),d.Lme("(",ke.essMaxPoint," ",d.bMT(8,19,"lang_auto_diem_brackets"),""),d.R7$(3),d.FS9("placeholder",d.bMT(11,21,"lang_auto_nhap_diem")),d.Mz_("formControlName","cau",tt,""),d.Y8G("readonly",!st.showForTeacher)("ngClass",d.eq3(23,Oe,st.form.controls["cau"+tt]&&st.form.controls["cau"+tt].invalid))("id","cau_"+tt)("decimal",!0),d.R7$(2),d.Y8G("ngIf",st.form.controls["cau"+tt].errors)}}function qe(Y,et){if(1&Y&&(d.j41(0,"div",22)(1,"div",23),d.DNE(2,De,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,he,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,Ne,13,25,"div",26),d.k0s()()),2&Y){const Xe=et.index,Qe=d.XpG();d.R7$(),d.Mz_("id","q_",Xe,""),d.R7$(),d.Y8G("ngIf",!Qe.showForTeacher),d.R7$(),d.Y8G("ngIf",Qe.showForTeacher),d.R7$(),d.Y8G("ngIf",Qe.showForTeacher)}}function Se(Y,et){1&Y&&(d.j41(0,"div",33)(1,"b"),d.EFF(2),d.nI1(3,"mytranslate"),d.k0s(),d.EFF(4),d.nI1(5,"mytranslate"),d.k0s()),2&Y&&(d.R7$(2),d.SpI("",d.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),d.R7$(2),d.SpI(" ",d.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function xe(Y,et){if(1&Y){const Xe=d.RV6();d.j41(0,"div",34)(1,"button",35),d.bIt("click",function(){d.eBV(Xe);const ke=d.XpG();return d.Njj(ke.getMnoteJsonData())}),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s()()}if(2&Y){const Xe=d.XpG();d.R7$(),d.Y8G("disabled",Xe.isLoading||Xe.form.invalid),d.R7$(),d.SpI(" ",Xe.isLoading?d.bMT(3,2,"lang_auto_dang_luu_doing"):d.bMT(4,4,"lang_auto_luu_diem")," ")}}let F=(()=>{var Y;class et extends x.H{parseValue(Qe){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[Qe]}getMaxPoint(Qe){var ke=0;for(let tt=0;tt<this.questions.length;tt++)if(this.questions[tt].id==Qe){ke=this.questions[tt].scorePerQuestion??0;break}return ke}toggleVisibility(Qe,ke){var tt=Qe.target,st=document.getElementById(`q_${ke}`);st&&("block"==st?.style.display?(st.style.display="none",tt&&(tt.textContent="visibility_off")):(st.style.display="block",tt&&(tt.textContent="visibility")))}isValidPoint(){let Qe=0;var ke=this.form.value;for(var tt in ke){var st=Number(tt.substring(3));ke[tt]>this.maxPointPerQuestion[st]&&Qe++}return!(Qe>0)}validateForm(Qe,ke,tt,st){let rt="";this.form.get("cau"+st)?.valueChanges.pipe((0,_.J)()).subscribe(([xt,de])=>{if(rt="string"==typeof de&&de.includes(",")?de.replace(",","."):de,isNaN(+rt))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+st].setValue(ke);else{let $e=parseFloat(rt);$e>tt&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),$e<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(Qe,ke){var tt=(0,ie.q)(Qe);this.apiUploadService.commonUploadForMarkResult(tt,`essay_note_${ke}_${this.resultID}.png`,"image/png").subscribe(st=>{st.type!=s.hv.UploadProgress&&(1==st.success?(this.mnoteJsonData.pages[ke].draw=st.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(Qe){this.pagesCount=0;for(let ke=0;ke<Qe.length;ke++)Qe[ke].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let ke=0;ke<Qe.length;ke++)Qe[ke].draw&&this.uploadBase64ToCDN(Qe[ke].draw,ke)}sendDataToIframe(){const Qe=document.getElementById("mNote"),ke=Qe?Qe.contentWindow:null;if(null!==ke)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var tt=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=tt){for(let rt=0;rt<tt.pages.length;rt++)tt.pages[rt].backgroundImage&&(tt.pages[rt].backgroundImage=this.sAztCommonCdnService.getMyCdn(tt.pages[rt].backgroundImage)),tt.pages[rt].draw&&(tt.pages[rt].draw=this.sAztCommonCdnService.getMyCdn(tt.pages[rt].draw));tt=JSON.stringify(tt),this.examResultObj.result=tt}}var st=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(st?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let rt=0;rt<this.jsonData.pages.length;rt++)this.jsonData.pages[rt].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[rt].backgroundImage=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[rt].backgroundImage)),this.jsonData.pages[rt].hasOwnProperty("draw")&&(this.jsonData.pages[rt].draw=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[rt].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),ke.postMessage(this.jsonData,"*")}else{let rt=[];this.files.forEach(de=>{var $e=this.sAztCommonCdnService.getMyCdn(de.url);$e&&rt.push({backgroundImage:$e})}),ke.postMessage({cmd:"initMNote",pages:rt,mode:this.showForTeacher?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:rt}}}checkMapBGImageWithFileLength(Qe){var ke=this.commonService.willDeleteParseJson(Qe);let tt=!1;if(0==this.files.length)tt=!0;else if(this.files.length>0&&ke&&ke.pages&&this.files.length==ke.pages.length){let st=0;this.files.forEach((rt,xt)=>{ke.pages[xt]&&ke.pages[xt].backgroundImage&&ke.pages[xt].backgroundImage.indexOf(rt.path)>-1&&st++}),st==this.files.length&&(tt=!0)}return tt}addBGImageByFileUrl(Qe){var ke=this.commonService.willDeleteParseJson(Qe);return this.files.forEach((tt,st)=>{let rt=!1;if(ke&&ke.pages){for(var xt=0;xt<ke.pages.length;xt++)if(ke.pages[xt]&&ke.pages[xt].backgroundImage&&ke.pages[xt].backgroundImage.indexOf(tt.path)>-1){rt=!0;break}!1===rt&&(ke.pages[st]&&ke.pages[st].id==st?ke.pages[st].backgroundImage=this.sAztCommonCdnService.getMyCdn(tt.url??""):ke.pages.splice(st,0,{backgroundImage:this.sAztCommonCdnService.getMyCdn(tt.url??"")}))}}),JSON.stringify(ke)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let Qe=!1;for(const ke in this.form.value)""!==this.form.value[ke]&&(Qe=!0);if(!Qe)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const ke in this.form.value)""===this.form.value[ke]&&(this.form.value[ke]=0,this.form.controls[ke].setValue(0));if(this.files&&this.files.length>0){const ke=document.getElementById("mNote"),tt=ke?ke.contentWindow:null;null!==tt&&tt.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(Qe){if(this.checkMapBGImageWithFileLength(Qe)){for(const rt in this.form.value)"string"==typeof this.form.value[rt]&&this.form.value[rt].includes(",")&&(this.form.value[rt]=this.form.value[rt].replace(",","."));let st=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var tt={id:this.resultID,result:Qe,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(tt,st).subscribe(rt=>{1==rt.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(rt.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";var Qe={};let ke;this.examResultObj.confirmedAt&&(ke=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(st=>{let rt=this.getMaxPoint(st.id);this.totalMaxPoint+=rt,st.essMaxPoint=rt,this.maxPointPerQuestion.push(st.essMaxPoint)});for(let st=0;st<this.questions.length;st++){var tt=`cau${st}`;Qe[tt]=new h.MJ(ke?ke[tt]:"",{validators:[h.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),h.k0.min(0),h.k0.max(this.questions[st].essMaxPoint??0)]})}this.form=new h.gE(Qe),this.form.valueChanges.subscribe(st=>{let rt=JSON.stringify(st);rt!=this.prevData&&(this.prevData=rt,this.form.patchValue(st))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(Qe,ke,tt,st,rt){super(),this.permissionService=Qe,this.sAztCommonCdnService=ke,this.envService=tt,this.examResultService=st,this.apiUploadService=rt,this.orgExamObjs=[],this.questions=[],this.files=[],this.userAnswersObj={},this.resultID=0,this.whiteListMNoteIframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new d.bkB,this.followerRenderQuest=new T.e,this.form=new h.gE({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=xt=>{"MNoteJson"==xt.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=xt.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==xt.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(Y=et).\u0275fac=function(Qe){return new(Qe||Y)(d.rXU(fe.p),d.rXU(p.c),d.rXU(q.t),d.rXU(N._),d.rXU(R.T))},Y.\u0275cmp=d.VBU({type:Y,selectors:[["azt-mark-essay"]],viewQuery:function(Qe,ke){if(1&Qe&&d.GBs(ne,5),2&Qe){let tt;d.mGM(tt=d.lsd())&&(ke.mnoteContainer=tt.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",examResultObj:"examResultObj",userAnswersObj:"userAnswersObj",resultID:"resultID",whiteListMNoteIframeSrc:"whiteListMNoteIframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode"},outputs:{saveResultEvent:"saveResultEvent"},features:[d.Vt3],decls:12,vars:12,consts:[["mnoteContainer",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(Qe,ke){1&Qe&&(d.j41(0,"div",1)(1,"form",2),d.DNE(2,Ce,14,30,"div",3),d.k0s(),d.DNE(3,ve,5,6,"div",4),d.k0s(),d.j41(4,"div",5),d.DNE(5,qe,5,5,"div",6),d.k0s(),d.DNE(6,Se,6,6,"div",7),d.j41(7,"div",8,0),d.nrm(9,"iframe",9),d.nI1(10,"safe"),d.k0s(),d.DNE(11,xe,5,6,"div",10)),2&Qe&&(d.R7$(),d.Y8G("formGroup",ke.form),d.R7$(),d.Y8G("ngForOf",ke.questions),d.R7$(),d.Y8G("ngIf",ke.showForTeacher),d.R7$(2),d.Y8G("ngForOf",ke.questions),d.R7$(),d.Y8G("ngIf",ke.files&&0==ke.files.length),d.R7$(),d.Y8G("ngStyle",d.eq3(10,re,ke.files&&0==ke.files.length?"none":"block")),d.R7$(2),d.Y8G("src",d.bMT(10,8,ke.whiteListMNoteIframeSrc),d.f$h),d.R7$(2),d.Y8G("ngIf",ke.showForTeacher))},dependencies:[z.YU,z.Sq,z.bT,z.B3,S.oV,h.qT,h.me,h.BC,h.cb,h.j4,h.JD,K.WGl,B.Z,M.t,w.x,D.o,Z.wp,Z.JI],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),et})()},74225:function(ft,Ae,y){"use strict";var s=this&&this.__awaiter||function(x,T,ie,fe){return new(ie||(ie=Promise))(function(q,N){function R(K){try{S(fe.next(K))}catch(B){N(B)}}function z(K){try{S(fe.throw(K))}catch(B){N(B)}}function S(K){K.done?q(K.value):function p(q){return q instanceof ie?q:new ie(function(N){N(q)})}(K.value).then(R,z)}S((fe=fe.apply(x,T||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.decodeScanOfflineFile=Ae.decode=void 0;const d=y(6178);Ae.decode=function h(x){return s(this,void 0,void 0,function*(){return d.AzotaFileDecode.decode(x)})},Ae.decodeScanOfflineFile=function _(x){return s(this,void 0,void 0,function*(){return d.AzotaFileDecode.decodeScanOfflineFile(x)})}},25028:(ft,Ae,y)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AzotaFile=Ae.FileType=void 0;const s=y(56784),d=y(70073);class h{}Ae.FileType=h,h.scanOffline="scanOffline";class _{constructor(){}static fromZipFolder(T){let ie=new _;return ie.folder=T,ie.readAztMain(),ie}readAztMain(){let T=this.folder.getUtf8Text("main.json");if(null==T)throw new s.InvalidAztFileException("Couldn't found main.json file");this.aztMain=d.AztMain.fromJsonString(T)}}Ae.AzotaFile=_},6178:function(ft,Ae,y){"use strict";var s=this&&this.__awaiter||function(T,ie,fe,p){return new(fe||(fe=Promise))(function(N,R){function z(B){try{K(p.next(B))}catch(M){R(M)}}function S(B){try{K(p.throw(B))}catch(M){R(M)}}function K(B){B.done?N(B.value):function q(N){return N instanceof fe?N:new fe(function(R){R(N)})}(B.value).then(z,S)}K((p=p.apply(T,ie||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AzotaFileDecode=void 0;const d=y(59985),h=y(25589),_=y(25028);class x{static decode(ie){return s(this,void 0,void 0,function*(){return d.ZipFolder.fromZip(ie).then(fe=>{let p=_.AzotaFile.fromZipFolder(fe);return p.aztMain.fileType==_.FileType.scanOffline?h.ScanOfflineFile.fromZipFolder(p.folder):p})})}static decodeScanOfflineFile(ie){return x.decode(ie).then(fe=>fe)}}Ae.AzotaFileDecode=x},70073:(ft,Ae,y)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AztMain=void 0;const s=y(37182);class d{static fromJsonString(_){return d.fromJson(JSON.parse(_))}static fromJson(_){return(0,s.plainToInstance)(d,_)}}Ae.AztMain=d},56784:(ft,Ae)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.InvalidAztFileException=void 0;class y extends Error{constructor(d){super(d)}}Ae.InvalidAztFileException=y},65057:(ft,Ae)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.DrawingCircle=void 0;class y{static findCircle(d,h,_){if(d)return d.find(x=>Math.pow(x.center.x-h,2)+Math.pow(x.center.y-_,2)<=Math.pow(x.radius,2))}static processVertical(d,h,_){const x=y.findCircle(d,h,_);if(!x)return;if(x.filled)return void(x.filled=!1);const ie=x.label[0];d?.filter(fe=>fe.label[0]==ie).forEach(fe=>fe.filled=!1),x.filled=!0}static getValue(d,h=10){if(!d)return"";const _=d?.length/h,x=[];for(let T=0;T<_;T++)x.push("0");return d.forEach(T=>{if(!T.filled)return;const ie=T.label,fe=parseInt(ie[0])-1;x[fe]=ie[1]}),x.join("")}static setValue(d,h,_=10){if(!d)return;for(let ie of d)ie.filled=!1;let x=d.length/_,T=0;for(;T<x;){const ie=h%10;h=(h-ie)/10,d[x*ie+x-T-1].filled=!0,T++}}}Ae.DrawingCircle=y},81163:function(ft,Ae,y){"use strict";var s=this&&this.__decorate||function(T,ie,fe,p){var R,q=arguments.length,N=q<3?ie:null===p?p=Object.getOwnPropertyDescriptor(ie,fe):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)N=Reflect.decorate(T,ie,fe,p);else for(var z=T.length-1;z>=0;z--)(R=T[z])&&(N=(q<3?R(N):q>3?R(ie,fe,N):R(ie,fe))||N);return q>3&&N&&Object.defineProperty(ie,fe,N),N};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ScanOfflineData=void 0,y(8280);const d=y(37182),h=y(45726),_=y(14326);class x{static fromJsonString(ie){return x.fromJson(JSON.parse(ie))}static fromJson(ie){return(0,d.plainToInstance)(x,ie)}}s([(0,d.Type)(()=>_.ScanOfflineResult)],x.prototype,"scanResult",void 0),s([(0,d.Type)(()=>h.ScanOfflineRequest)],x.prototype,"scanRequest",void 0),Ae.ScanOfflineData=x},25589:function(ft,Ae,y){"use strict";var s=this&&this.__decorate||function(N,R,z,S){var M,K=arguments.length,B=K<3?R:null===S?S=Object.getOwnPropertyDescriptor(R,z):S;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)B=Reflect.decorate(N,R,z,S);else for(var w=N.length-1;w>=0;w--)(M=N[w])&&(B=(K<3?M(B):K>3?M(R,z,B):M(R,z))||B);return K>3&&B&&Object.defineProperty(R,z,B),B},d=this&&this.__awaiter||function(N,R,z,S){return new(z||(z=Promise))(function(B,M){function w(ne){try{Z(S.next(ne))}catch(re){M(re)}}function D(ne){try{Z(S.throw(ne))}catch(re){M(re)}}function Z(ne){ne.done?B(ne.value):function K(B){return B instanceof z?B:new z(function(M){M(B)})}(ne.value).then(w,D)}Z((S=S.apply(N,R||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ScanOfflineFile=void 0;const h=y(25028),_=y(59985),x=y(56784),T=y(70073),ie=y(37182),fe=y(81163),p=y(14326);class q extends h.AzotaFile{constructor(){super()}static fromZipFolder(R){let z=new q;if(z.folder=R,z.readAztMain(),z.aztMain.fileType!=h.FileType.scanOffline)throw new x.InvalidAztFileException(`fileType must be ${h.FileType.scanOffline}`);let K=R.getUtf8Text(z.aztMain.detailPath);if(null==K)throw new x.InvalidAztFileException(`Couldn't found ${K} file`);return z.scanOfflineData=fe.ScanOfflineData.fromJsonString(K),z}getWrappedImage(){var R,z;return null==(null===(z=null===(R=this.scanOfflineData)||void 0===R?void 0:R.scanResult)||void 0===z?void 0:z.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getFilledCircles(){var R,z,S;return null!==(S=null===(z=null===(R=this.scanOfflineData)||void 0===R?void 0:R.scanResult)||void 0===z?void 0:z.getFilledCircles())&&void 0!==S?S:[]}getWrappedImageExtension(){var R,z;let S=null===(z=null===(R=this.scanOfflineData)||void 0===R?void 0:R.scanResult)||void 0===z?void 0:z.wrappedScanFilePath;return null==S?null:S.substring(S.lastIndexOf("."))}static init(R,z,S){const K=new q;return K.folder=new _.ZipFolder,K.aztMain=new T.AztMain,K.aztMain.fileType=h.FileType.scanOffline,K.aztMain.detailPath="scan_offline.json",K.aztMain.createdAt=(new Date).toString(),K.aztMain.createdBy=z,K.scanOfflineData=new fe.ScanOfflineData,K.scanOfflineData.examHashId=R,K.scanOfflineData.scanResult=new p.ScanOfflineResult,K.scanOfflineData.scanRequest=S,K}setOriginalImage(R,z){const S=`media/original_scan_offline.${R}`;this.folder.setBinary(S,z),this.scanOfflineData.originalScanFilePath=S}setWrappedImage(R,z){const S=`media/wrapped_scan_offline.${R}`;this.folder.setBinary(S,z),this.scanOfflineData.scanResult.wrappedScanFilePath=S}setDebugImage(R,z){this.folder.setBinary(`debug_images/${R}`,z)}setScanResult(R){R.wrappedScanFilePath=this.scanOfflineData.scanResult.wrappedScanFilePath,this.scanOfflineData.scanResult=R}clickToImage(R,z){var S,K;null===(K=null===(S=this.scanOfflineData)||void 0===S?void 0:S.scanResult)||void 0===K||K.clickToImage(R,z)}setExamCode(R){var z,S;null===(S=null===(z=this.scanOfflineData)||void 0===z?void 0:z.scanResult)||void 0===S||S.setExamCode(R)}setStudentCode(R){var z,S;null===(S=null===(z=this.scanOfflineData)||void 0===z?void 0:z.scanResult)||void 0===S||S.setStudentCode(R)}toAztFile(){return d(this,void 0,void 0,function*(){return this.folder.setUtf8Text("main.json",JSON.stringify(this.aztMain)),this.folder.setUtf8Text("scan_offline.json",JSON.stringify(this.scanOfflineData)),this.folder.toZip()})}}s([(0,ie.Type)(()=>fe.ScanOfflineData)],q.prototype,"scanOfflineData",void 0),Ae.ScanOfflineFile=q},45726:(ft,Ae,y)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ScanOfflineRequest=void 0;const s=y(37182);class d{constructor(){this.templateType=void 0,this.blackRate=void 0,this.corners=[],this.corner2s=[]}static fromJsonString(_){const x=JSON.parse(_);return d.fromJson(x)}static fromJson(_){return(0,s.plainToInstance)(d,_)}}Ae.ScanOfflineRequest=d},14326:function(ft,Ae,y){"use strict";var s=this&&this.__decorate||function(z,S,K,B){var D,M=arguments.length,w=M<3?S:null===B?B=Object.getOwnPropertyDescriptor(S,K):B;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(z,S,K,B);else for(var Z=z.length-1;Z>=0;Z--)(D=z[Z])&&(w=(M<3?D(w):M>3?D(S,K,w):D(S,K))||w);return M>3&&w&&Object.defineProperty(S,K,w),w};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.DrawingRectangle=Ae.AnswerRegionResult=Ae.QuizFillBlank=Ae.Quiz4PartTrueFalse=Ae.Quiz4Option=Ae.StudentCodeRegionResult=Ae.ExamCodeRegionResult=Ae.ScanOfflineResult=void 0,y(8280);const d=y(37182),h=y(65057),_=y(82601);class x{getSubExamCode(){var S,K;return null!==(K=null===(S=this.examCodeRegion)||void 0===S?void 0:S.getValue())&&void 0!==K?K:""}getStudentCode(){var S,K;return null!==(K=null===(S=this.studentCodeRegion)||void 0===S?void 0:S.getValue())&&void 0!==K?K:""}getEssayTotalPoint(){var S,K,B;const M=null!==(B=null===(K=h.DrawingCircle.getValue(null===(S=this.answerRegion)||void 0===S?void 0:S.essayCircles))||void 0===K?void 0:K.trim())&&void 0!==B?B:"";return""!=M?parseInt(M)/100:void 0}getFilledCircles(){var S,K,B,M,w,D,Z,ne,re,oe,Be,Oe;let Ze=[];return Ze.push(...null!==(K=null===(S=this.studentCodeRegion)||void 0===S?void 0:S.circles)&&void 0!==K?K:[]),Ze.push(...null!==(M=null===(B=this.examCodeRegion)||void 0===B?void 0:B.circles)&&void 0!==M?M:[]),Ze.push(...null!==(D=null===(w=this.answerRegion)||void 0===w?void 0:w.circles)&&void 0!==D?D:[]),Ze.push(...null!==(ne=null===(Z=this.answerRegion)||void 0===Z?void 0:Z.essayCircles)&&void 0!==ne?ne:[]),Ze.push(...null!==(oe=null===(re=this.answerRegion)||void 0===re?void 0:re.trueFalseCircles)&&void 0!==oe?oe:[]),Ze.push(...null!==(Oe=null===(Be=this.answerRegion)||void 0===Be?void 0:Be.fillBlankCircles)&&void 0!==Oe?Oe:[]),Ze.filter(Ie=>Ie.filled)}getQuiz4OptionAnswers(){var S,K;const B=null!==(K=null===(S=this.answerRegion)||void 0===S?void 0:S.circles)&&void 0!==K?K:[],M=B.length/4;let w=[];for(let D=0;D<M;D++)w.push("");return B.forEach(D=>{if(!D.filled)return;const Z=new fe(D.label);w[Z.numbers-1]=Z.letter}),w}getQuiz4PartTrueFalseAnswers(){var S,K;const B=null!==(K=null===(S=this.answerRegion)||void 0===S?void 0:S.trueFalseCircles)&&void 0!==K?K:[],M=B.length/2;let w=[];for(let D=0;D<M;D++)w.push(" ");return B.forEach(D=>{if(!D.filled)return;const Z=new p(D.label),ne=4*(Z.numbers-1)+Z.getPartIndex();w[ne]=Z.letter}),w}getQuizFillBlankAnswers(){var S,K;const B=null!==(K=null===(S=this.answerRegion)||void 0===S?void 0:S.fillBlankCircles)&&void 0!==K?K:[],M=B.length/48;let w=[];for(let D=0;D<M;D++)w.push([" "," "," "," "]);return B.forEach(D=>{if(!D.filled)return;const Z=new q(D.label);w[Z.numbers-1][Z.cols]=Z.rowLabel}),w.map(D=>D.join(""))}clickToImage(S,K){var B,M,w;null===(B=this.examCodeRegion)||void 0===B||B.clickToImage(S,K),null===(M=this.studentCodeRegion)||void 0===M||M.clickToImage(S,K),null===(w=this.answerRegion)||void 0===w||w.clickToImage(S,K)}setExamCode(S){var K;null===(K=this.examCodeRegion)||void 0===K||K.setValue(S)}setStudentCode(S){var K;null===(K=this.studentCodeRegion)||void 0===K||K.setValue(S)}}s([(0,d.Type)(()=>T)],x.prototype,"examCodeRegion",void 0),s([(0,d.Type)(()=>ie)],x.prototype,"studentCodeRegion",void 0),s([(0,d.Type)(()=>N)],x.prototype,"answerRegion",void 0),Ae.ScanOfflineResult=x;class T extends _.VerticalRegion{}Ae.ExamCodeRegionResult=T;class ie extends _.VerticalRegion{}Ae.StudentCodeRegionResult=ie;class fe{constructor(S){const B=S.match(/(\d+)([A-Z])/);if(!B)throw new Error(`Invalid label: ${S}`);this.numbers=parseInt(B[1]),this.letter=B[2]}}Ae.Quiz4Option=fe;class p{constructor(S){const B=S.match(/(\d+)([A-D])([TF])/);if(!B)throw new Error(`Invalid label: ${S}`);this.numbers=parseInt(B[1]),this.part=B[2],this.letter=B[3]}getPartIndex(){return"ABCD".indexOf(this.part)}}Ae.Quiz4PartTrueFalse=p;class q{constructor(S){const K=S.split("_");if(3!=K.length)throw new Error(`Invalid label: ${S}`);this.numbers=parseInt(K[0]),this.cols=parseInt(K[1]),this.rowLabel=K[2]}}Ae.QuizFillBlank=q;class N{clickToImage(S,K){var B,M,w;h.DrawingCircle.processVertical(this.essayCircles,S,K);{const D=h.DrawingCircle.findCircle(this.circles,S,K);if(D){if(D.filled)return void(D.filled=!1);const Z=new fe(D.label);null===(B=this.circles)||void 0===B||B.filter(ne=>new fe(ne.label).numbers==Z.numbers).forEach(ne=>ne.filled=!1),D.filled=!0}}{const D=h.DrawingCircle.findCircle(this.trueFalseCircles,S,K);if(D){if(D.filled)return void(D.filled=!1);const Z=new p(D.label);null===(M=this.trueFalseCircles)||void 0===M||M.filter(ne=>{const re=new p(ne.label);return re.numbers==Z.numbers&&re.part==Z.part}).forEach(ne=>ne.filled=!1),D.filled=!0}}{const D=h.DrawingCircle.findCircle(this.fillBlankCircles,S,K);if(D){if(D.filled)return void(D.filled=!1);const Z=new q(D.label);null===(w=this.fillBlankCircles)||void 0===w||w.filter(ne=>{const re=new q(ne.label);return re.numbers==Z.numbers&&re.cols==Z.cols}).forEach(ne=>ne.filled=!1),D.filled=!0}}}}Ae.AnswerRegionResult=N,Ae.DrawingRectangle=class R{}},82601:(ft,Ae,y)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.VerticalRegion=void 0;const s=y(65057);Ae.VerticalRegion=class d{clickToImage(_,x){s.DrawingCircle.processVertical(this.circles,_,x)}getValue(_=10){return s.DrawingCircle.getValue(this.circles,_)}setValue(_,x=10){s.DrawingCircle.setValue(this.circles,_,x)}}},59985:function(ft,Ae,y){"use strict";var s=this&&this.__awaiter||function(_,x,T,ie){return new(T||(T=Promise))(function(p,q){function N(S){try{z(ie.next(S))}catch(K){q(K)}}function R(S){try{z(ie.throw(S))}catch(K){q(K)}}function z(S){S.done?p(S.value):function fe(p){return p instanceof T?p:new T(function(q){q(p)})}(S.value).then(N,R)}z((ie=ie.apply(_,x||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ZipFolder=void 0;const d=y(91478);class h{constructor(x){this.files=new Map,x&&x.forEach((T,ie)=>{this.files.set(ie,T)})}static fromZip(x){return s(this,void 0,void 0,function*(){let ie=yield(new d).loadAsync(x).then(fe=>{const p=[];return fe.forEach(function(q){let N=fe.file(q);N&&p.push(N.async("uint8array").then(R=>({path:q,data:R})))}),p});return Promise.all(ie).then(fe=>{let p=new Map;return fe.forEach(q=>{p.set(q.path,q.data)}),new h(p)})})}setBinary(x,T){const ie=Uint8Array.from(T);this.files.set(x,ie)}setUtf8Text(x,T){let ie=(new TextEncoder).encode(T);this.files.set(x,ie)}getBinary(x){var T;return null!==(T=this.files.get(x))&&void 0!==T?T:null}getUtf8Text(x){let T=this.files.get(x);return null===T?null:(new TextDecoder).decode(T)}toZip(){return s(this,void 0,void 0,function*(){const x=new d;for(let[T,ie]of Array.from(this.files))x.file(T,ie,{binary:!0});return x.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return s(this,void 0,void 0,function*(){const x=new d;for(let[T,ie]of Array.from(this.files))x.file(T,ie,{binary:!0});return x.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}Ae.ZipFolder=h},8280:()=>{var ft,Ae;Ae=ft||(ft={}),function(y){var s="object"==typeof globalThis?globalThis:"object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:function T(){return function _(){try{return Function("return this;")()}catch{}}()||function x(){try{return(0,eval)("(function() { return this; })()")}catch{}}()}(),d=h(Ae);function h(ie,fe){return function(p,q){Object.defineProperty(ie,p,{configurable:!0,writable:!0,value:q}),fe&&fe(p,q)}}typeof s.Reflect<"u"&&(d=h(s.Reflect,d)),function(y,s){var d=Object.prototype.hasOwnProperty,h="function"==typeof Symbol,_=h&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",x=h&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T="function"==typeof Object.create,ie={__proto__:[]}instanceof Array,fe=!T&&!ie,p={create:T?function(){return I(Object.create(null))}:ie?function(){return I({__proto__:null})}:function(){return I({})},has:fe?function(E,b){return d.call(E,b)}:function(E,b){return b in E},get:fe?function(E,b){return d.call(E,b)?E[b]:void 0}:function(E,b){return E[b]}},q=Object.getPrototypeOf(Function),N="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function ae(){var E={},b=[],O=function(){function pe(ee,ue,ye){this._index=0,this._keys=ee,this._values=ue,this._selector=ye}return pe.prototype["@@iterator"]=function(){return this},pe.prototype[x]=function(){return this},pe.prototype.next=function(){var ee=this._index;if(ee>=0&&ee<this._keys.length){var ue=this._selector(this._keys[ee],this._values[ee]);return ee+1>=this._keys.length?(this._index=-1,this._keys=b,this._values=b):this._index++,{value:ue,done:!1}}return{value:void 0,done:!0}},pe.prototype.throw=function(ee){throw this._index>=0&&(this._index=-1,this._keys=b,this._values=b),ee},pe.prototype.return=function(ee){return this._index>=0&&(this._index=-1,this._keys=b,this._values=b),{value:ee,done:!0}},pe}();return function(){function pe(){this._keys=[],this._values=[],this._cacheKey=E,this._cacheIndex=-2}return Object.defineProperty(pe.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),pe.prototype.has=function(ee){return this._find(ee,!1)>=0},pe.prototype.get=function(ee){var ue=this._find(ee,!1);return ue>=0?this._values[ue]:void 0},pe.prototype.set=function(ee,ue){var ye=this._find(ee,!0);return this._values[ye]=ue,this},pe.prototype.delete=function(ee){var ue=this._find(ee,!1);if(ue>=0){for(var ye=this._keys.length,Re=ue+1;Re<ye;Re++)this._keys[Re-1]=this._keys[Re],this._values[Re-1]=this._values[Re];return this._keys.length--,this._values.length--,rt(ee,this._cacheKey)&&(this._cacheKey=E,this._cacheIndex=-2),!0}return!1},pe.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=E,this._cacheIndex=-2},pe.prototype.keys=function(){return new O(this._keys,this._values,G)},pe.prototype.values=function(){return new O(this._keys,this._values,te)},pe.prototype.entries=function(){return new O(this._keys,this._values,we)},pe.prototype["@@iterator"]=function(){return this.entries()},pe.prototype[x]=function(){return this.entries()},pe.prototype._find=function(ee,ue){if(!rt(this._cacheKey,ee)){this._cacheIndex=-1;for(var ye=0;ye<this._keys.length;ye++)if(rt(this._keys[ye],ee)){this._cacheIndex=ye;break}}return this._cacheIndex<0&&ue&&(this._cacheIndex=this._keys.length,this._keys.push(ee),this._values.push(void 0)),this._cacheIndex},pe}();function G(pe,ee){return pe}function te(pe,ee){return ee}function we(pe,ee){return[pe,ee]}}(),R="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function at(){return function(){function b(){this._map=new N}return Object.defineProperty(b.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),b.prototype.has=function(O){return this._map.has(O)},b.prototype.add=function(O){return this._map.set(O,O),this},b.prototype.delete=function(O){return this._map.delete(O)},b.prototype.clear=function(){this._map.clear()},b.prototype.keys=function(){return this._map.keys()},b.prototype.values=function(){return this._map.keys()},b.prototype.entries=function(){return this._map.entries()},b.prototype["@@iterator"]=function(){return this.keys()},b.prototype[x]=function(){return this.keys()},b}()}(),z="function"==typeof WeakMap?WeakMap:function Le(){var E=16,b=p.create(),O=W();return function(){function ee(){this._key=W()}return ee.prototype.has=function(ue){var ye=G(ue,!1);return void 0!==ye&&p.has(ye,this._key)},ee.prototype.get=function(ue){var ye=G(ue,!1);return void 0!==ye?p.get(ye,this._key):void 0},ee.prototype.set=function(ue,ye){return G(ue,!0)[this._key]=ye,this},ee.prototype.delete=function(ue){var ye=G(ue,!1);return void 0!==ye&&delete ye[this._key]},ee.prototype.clear=function(){this._key=W()},ee}();function W(){var ee;do{ee="@@WeakMap@@"+pe()}while(p.has(b,ee));return b[ee]=!0,ee}function G(ee,ue){if(!d.call(ee,O)){if(!ue)return;Object.defineProperty(ee,O,{value:p.create()})}return ee[O]}function te(ee,ue){for(var ye=0;ye<ue;++ye)ee[ye]=255*Math.random()|0;return ee}function pe(){var ee=function we(ee){if("function"==typeof Uint8Array){var ue=new Uint8Array(ee);return typeof crypto<"u"?crypto.getRandomValues(ue):typeof msCrypto<"u"?msCrypto.getRandomValues(ue):te(ue,ee),ue}return te(new Array(ee),ee)}(E);ee[6]=79&ee[6]|64,ee[8]=191&ee[8]|128;for(var ue="",ye=0;ye<E;++ye){var Re=ee[ye];(4===ye||6===ye||8===ye)&&(ue+="-"),Re<16&&(ue+="0"),ue+=Re.toString(16).toLowerCase()}return ue}}(),S=h?Symbol.for("@reflect-metadata:registry"):void 0,K=function We(){var E;return!Pe(S)&&Se(s.Reflect)&&Object.isExtensible(s.Reflect)&&(E=s.Reflect[S]),Pe(E)&&(E=function H(){var E;!Pe(S)&&typeof s.Reflect<"u"&&!(S in s.Reflect)&&"function"==typeof s.Reflect.defineMetadata&&(E=function ze(E){var b=E.defineMetadata,O=E.hasOwnMetadata,W=E.getOwnMetadata,G=E.getOwnMetadataKeys,te=E.deleteMetadata,we=new z;return{isProviderFor:function(ee,ue){var ye=we.get(ee);return!(Pe(ye)||!ye.has(ue))||!!G(ee,ue).length&&(Pe(ye)&&(ye=new R,we.set(ee,ye)),ye.add(ue),!0)},OrdinaryDefineOwnMetadata:b,OrdinaryHasOwnMetadata:O,OrdinaryGetOwnMetadata:W,OrdinaryOwnMetadataKeys:G,OrdinaryDeleteMetadata:te}}(s.Reflect));var b,O,W,G=new z,te={registerProvider:we,getProvider:ee,setProvider:ye};return te;function we(Re){if(!Object.isExtensible(te))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case E===Re:break;case Pe(b):b=Re;break;case b===Re:break;case Pe(O):O=Re;break;case O===Re:break;default:void 0===W&&(W=new R),W.add(Re)}}function pe(Re,je){if(!Pe(b)){if(b.isProviderFor(Re,je))return b;if(!Pe(O)){if(O.isProviderFor(Re,je))return b;if(!Pe(W))for(var Me=de(W);;){var ot=Te(Me);if(!ot)return;var $=$e(ot);if($.isProviderFor(Re,je))return k(Me),$}}}if(!Pe(E)&&E.isProviderFor(Re,je))return E}function ee(Re,je){var ot,Me=G.get(Re);return Pe(Me)||(ot=Me.get(je)),Pe(ot)&&(Pe(ot=pe(Re,je))||(Pe(Me)&&(Me=new N,G.set(Re,Me)),Me.set(je,ot))),ot}function ue(Re){if(Pe(Re))throw new TypeError;return b===Re||O===Re||!Pe(W)&&W.has(Re)}function ye(Re,je,Me){if(!ue(Me))throw new Error("Metadata provider not registered.");var ot=ee(Re,je);if(ot!==Me){if(!Pe(ot))return!1;var $=G.get(Re);Pe($)&&($=new N,G.set(Re,$)),$.set(je,Me)}return!0}}()),!Pe(S)&&Se(s.Reflect)&&Object.isExtensible(s.Reflect)&&Object.defineProperty(s.Reflect,S,{enumerable:!1,configurable:!1,writable:!1,value:E}),E}(),B=function Je(E){var b=new z,O={isProviderFor:function(ue,ye){var Re=b.get(ue);return!Pe(Re)&&Re.has(ye)},OrdinaryDefineOwnMetadata:function we(ue,ye,Re,je){W(Re,je,!0).set(ue,ye)},OrdinaryHasOwnMetadata:function G(ue,ye,Re){var je=W(ye,Re,!1);return!Pe(je)&&Y(je.has(ue))},OrdinaryGetOwnMetadata:function te(ue,ye,Re){var je=W(ye,Re,!1);if(!Pe(je))return je.get(ue)},OrdinaryOwnMetadataKeys:function pe(ue,ye){var Re=[],je=W(ue,ye,!1);if(Pe(je))return Re;for(var ot=de(je.keys()),$=0;;){var _t=Te(ot);if(!_t)return Re.length=$,Re;var ut=$e(_t);try{Re[$]=ut}catch(vt){try{k(ot)}finally{throw vt}}$++}},OrdinaryDeleteMetadata:function ee(ue,ye,Re){var je=W(ye,Re,!1);if(Pe(je)||!je.delete(ue))return!1;if(0===je.size){var Me=b.get(ye);Pe(Me)||(Me.delete(Re),0===Me.size&&b.delete(Me))}return!0}};return K.registerProvider(O),O;function W(ue,ye,Re){var je=b.get(ue),Me=!1;if(Pe(je)){if(!Re)return;je=new N,b.set(ue,je),Me=!0}var ot=je.get(ye);if(Pe(ot)){if(!Re)return;if(ot=new N,je.set(ye,ot),!E.setProvider(ue,ye,O))throw je.delete(ye),Me&&b.delete(ue),new Error("Wrong provider for target.")}return ot}}(K);function it(E,b,O){if(Ce(E,b,O))return!0;var G=P(b);return!Ne(G)&&it(E,G,O)}function Ce(E,b,O){var W=dt(b,O,!1);return!Pe(W)&&Y(W.OrdinaryHasOwnMetadata(E,b,O))}function ve(E,b,O){if(Ce(E,b,O))return De(E,b,O);var G=P(b);return Ne(G)?void 0:ve(E,G,O)}function De(E,b,O){var W=dt(b,O,!1);if(!Pe(W))return W.OrdinaryGetOwnMetadata(E,b,O)}function he(E,b,O,W){dt(O,W,!0).OrdinaryDefineOwnMetadata(E,b,O,W)}function X(E,b){var O=be(E,b),W=P(E);if(null===W)return O;var G=X(W,b);if(G.length<=0)return O;if(O.length<=0)return G;for(var te=new R,we=[],pe=0,ee=O;pe<ee.length;pe++)te.has(ue=ee[pe])||(te.add(ue),we.push(ue));for(var Re=0,je=G;Re<je.length;Re++){var ue;te.has(ue=je[Re])||(te.add(ue),we.push(ue))}return we}function be(E,b){var O=dt(E,b,!1);return O?O.OrdinaryOwnMetadataKeys(E,b):[]}function Ge(E){if(null===E)return 1;switch(typeof E){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===E?1:6;default:return 6}}function Pe(E){return void 0===E}function Ne(E){return null===E}function Se(E){return"object"==typeof E?null!==E:"function"==typeof E}function xe(E,b){switch(Ge(E)){case 0:case 1:case 2:case 3:case 4:case 5:return E}var O=3===b?"string":5===b?"number":"default",W=xt(E,_);if(void 0!==W){var G=W.call(E,O);if(Se(G))throw new TypeError;return G}return function F(E,b){if("string"===b){var O=E.toString;if(ke(O)&&!Se(W=O.call(E)))return W;if(ke(G=E.valueOf)&&!Se(W=G.call(E)))return W}else{var G;if(ke(G=E.valueOf)&&!Se(W=G.call(E)))return W;var W,te=E.toString;if(ke(te)&&!Se(W=te.call(E)))return W}throw new TypeError}(E,"default"===O?"number":O)}function Y(E){return!!E}function Xe(E){var b=xe(E,3);return function qe(E){return"symbol"==typeof E}(b)?b:function et(E){return""+E}(b)}function Qe(E){return Array.isArray?Array.isArray(E):E instanceof Object?E instanceof Array:"[object Array]"===Object.prototype.toString.call(E)}function ke(E){return"function"==typeof E}function tt(E){return"function"==typeof E}function rt(E,b){return E===b||E!=E&&b!=b}function xt(E,b){var O=E[b];if(null!=O){if(!ke(O))throw new TypeError;return O}}function de(E){var b=xt(E,x);if(!ke(b))throw new TypeError;var O=b.call(E);if(!Se(O))throw new TypeError;return O}function $e(E){return E.value}function Te(E){var b=E.next();return!b.done&&b}function k(E){var b=E.return;b&&b.call(E)}function P(E){var b=Object.getPrototypeOf(E);if("function"!=typeof E||E===q||b!==q)return b;var O=E.prototype,W=O&&Object.getPrototypeOf(O);if(null==W||W===Object.prototype)return b;var G=W.constructor;return"function"!=typeof G||G===E?b:G}function dt(E,b,O){var W=K.getProvider(E,b);if(!Pe(W))return W;if(O){if(K.setProvider(E,b,B))return B;throw new Error("Illegal state.")}}function I(E){return E.__=void 0,delete E.__,E}y("decorate",function M(E,b,O,W){if(Pe(O)){if(!Qe(E))throw new TypeError;if(!tt(b))throw new TypeError;return function Ie(E,b){for(var O=E.length-1;O>=0;--O){var G=(0,E[O])(b);if(!Pe(G)&&!Ne(G)){if(!tt(G))throw new TypeError;b=G}}return b}(E,b)}if(!Qe(E))throw new TypeError;if(!Se(b))throw new TypeError;if(!Se(W)&&!Pe(W)&&!Ne(W))throw new TypeError;return Ne(W)&&(W=void 0),function ct(E,b,O,W){for(var G=E.length-1;G>=0;--G){var we=(0,E[G])(b,O,W);if(!Pe(we)&&!Ne(we)){if(!Se(we))throw new TypeError;W=we}}return W}(E,b,O=Xe(O),W)}),y("metadata",function w(E,b){return function O(W,G){if(!Se(W))throw new TypeError;if(!Pe(G)&&!function st(E){switch(Ge(E)){case 3:case 4:return!0;default:return!1}}(G))throw new TypeError;he(E,b,W,G)}}),y("defineMetadata",function D(E,b,O,W){if(!Se(O))throw new TypeError;return Pe(W)||(W=Xe(W)),he(E,b,O,W)}),y("hasMetadata",function Z(E,b,O){if(!Se(b))throw new TypeError;return Pe(O)||(O=Xe(O)),it(E,b,O)}),y("hasOwnMetadata",function ne(E,b,O){if(!Se(b))throw new TypeError;return Pe(O)||(O=Xe(O)),Ce(E,b,O)}),y("getMetadata",function re(E,b,O){if(!Se(b))throw new TypeError;return Pe(O)||(O=Xe(O)),ve(E,b,O)}),y("getOwnMetadata",function oe(E,b,O){if(!Se(b))throw new TypeError;return Pe(O)||(O=Xe(O)),De(E,b,O)}),y("getMetadataKeys",function Be(E,b){if(!Se(E))throw new TypeError;return Pe(b)||(b=Xe(b)),X(E,b)}),y("getOwnMetadataKeys",function Oe(E,b){if(!Se(E))throw new TypeError;return Pe(b)||(b=Xe(b)),be(E,b)}),y("deleteMetadata",function Ze(E,b,O){if(!Se(b))throw new TypeError;if(Pe(O)||(O=Xe(O)),!Se(b))throw new TypeError;Pe(O)||(O=Xe(O));var W=dt(b,O,!1);return!Pe(W)&&W.OrdinaryDeleteMetadata(E,b,O)})}(d,s),typeof s.Reflect>"u"&&(s.Reflect=Ae)}()}}]);