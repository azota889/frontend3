"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[1513],{7743:(V,W,n)=>{n.d(W,{c:()=>N});var N=function(e){return e[e.templateOriginalA4=20]="templateOriginalA4",e[e.templateA5Full50=22]="templateA5Full50",e[e.templateA4Essay=21]="templateA4Essay",e[e.templateA6Full20=23]="templateA6Full20",e[e.templateTrueFalseFullA4=24]="templateTrueFalseFullA4",e[e.templateHSGA4=25]="templateHSGA4",e[e.templateTrueFalseA4With12Fill=26]="templateTrueFalseA4With12Fill",e[e.templateA4With96MultipleAndEssay=27]="templateA4With96MultipleAndEssay",e[e.templateA4Full66WithFax=28]="templateA4Full66WithFax",e[e.templateA4EssayWith4Fill2018=29]="templateA4EssayWith4Fill2018",e[e.templateA4NoEssay2025=31]="templateA4NoEssay2025",e[e.templateMinistryA4TF=2025]="templateMinistryA4TF",e[e.templateSGDQN=30]="templateSGDQN",e[e.templateTrueFalseA4=15]="templateTrueFalseA4",e[e.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",e[e.templateTrueFalseA5=17]="templateTrueFalseA5",e[e.templateTrueFalseA6=18]="templateTrueFalseA6",e[e.templateA4WithFax=19]="templateA4WithFax",e[e.templateA4WithFaxV2=190]="templateA4WithFaxV2",e[e.templateTrueFalseA4WithColor=150]="templateTrueFalseA4WithColor",e[e.templateA4WithColorNew=200]="templateA4WithColorNew",e}(N||{})},42032:(V,W,n)=>{n.d(W,{Q:()=>Q});var N=n(7743),y=n(43234),b=n(48891),e=n(53793),R=n(10296),O=n(35810),K=n(84708),U=n(67638);let Q=(()=>{var m;class F{constructor(s,a,v,l,D){this.commonService=s,this.shareFileFlutterService=a,this.encryptService=v,this.formatAnswerSheetService=l,this.exportExcelService=D,this.allAnswerSheet=N.c}exportFileNameOfStudentCode(s,a,v){return 100==s&&(a=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(a?"_"+a:"")+"_"+this.encryptService.createMd5(v).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(s,a,v,l,D,P){return a==this.allAnswerSheet.templateA5Full50?s.createA5AnswerSheetFullA4_50(P??50):a==this.allAnswerSheet.templateA4Essay?s.createA4AnswerSheet_35hh(P??50):a==this.allAnswerSheet.templateA6Full20?s.createA6AnswerSheetFullA4_20(P??20):a==this.allAnswerSheet.templateTrueFalseA4||a==this.allAnswerSheet.templateHSGA4||a==this.allAnswerSheet.templateTrueFalseA4With12Fill||a==this.allAnswerSheet.templateTrueFalseFullA4||a==this.allAnswerSheet.templateTrueFalseA4WithColor||a==this.allAnswerSheet.templateTrueFalseEssayA4||a==this.allAnswerSheet.templateTrueFalseA5||a==this.allAnswerSheet.templateTrueFalseA6||a==this.allAnswerSheet.templateA4WithFax||a==this.allAnswerSheet.templateA4WithFaxV2||a==this.allAnswerSheet.templateA4EssayWith4Fill2018||a==this.allAnswerSheet.templateA4NoEssay2025||a==this.allAnswerSheet.templateA4With96MultipleAndEssay?s.createTrueFalseAnswerSheet():a==this.allAnswerSheet.templateMinistryA4TF?s.createAzotaAnswerSheetMinistry_A4():s.createAzotaAnswerSheet_A4(P??120)}exportFileNameOfAnswerSheet(s,a,v){var l="";return 100==s&&(a=""),(0==s||100==s)&&(l=this.commonService.createFileNameExportFile(["PhieuTL_"+v+(a?"_"+a:"")])),l}exportFileNameOfAnswerExcelOffline(s,a,v){var l="";return 100==s&&(a=""),(0==s||100==s)&&(l=this.commonService.createFileNameExportFile(["DapAn_"+(a?"_"+a:"")])),l}exportFileNameOfRawExam(s,a,v){var l="";return 100==s&&(a=""),(0==s||100==s)&&(l=this.commonService.createFileNameExportFile([(a?"_"+a:"")+"_"+this.encryptService.createMd5(v).substring(0,6)])),l}exportFileNameOfExamOffline(s,a,v,l){var D="";return 100==s&&(a=""),(0==s||100==s)&&(D=this.commonService.createFileNameExportFile([(l?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(l,y.c.maxExamCodeLength)+"_":"")+v+(a?"_"+a:"")])),D}printStudentCode(s,a){var v=[];let l=this.commonService.myClone(a);for(let D=0;D<l.length;D++)v.push({code:l[D].code??0,fullName:l[D]?.fullName??"",birthday:l[D]?.birthday??"",phone:l[D]?.phone,className:l[D].classroomName??""});this._exportExcelForCodeNumber(s,v)}_exportExcelForCodeNumber(s,a){let v=this.exportFileNameOfStudentCode(0,s?.name??"",s?.hashId??"");const l=this.exportExcelService.exportExcelForCodeNumber(a);this.shareFileFlutterService.shareFileWithBlob(l,v)}}return(m=F).\u0275fac=function(s){return new(s||m)(b.KVO(e.R),b.KVO(R.R),b.KVO(O.v),b.KVO(K.e),b.KVO(U.x))},m.\u0275prov=b.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),F})()},91513:(V,W,n)=>{n.d(W,{c:()=>H});var N=n(73014),y=n(91478),e=n(65106),R=n(37714),O=n(18148),K=n(5382),U=n(43234),Q=n(25539),m=n(81234),F=n(48891),$=n(32610),s=n(53793),a=n(36484),v=n(10933),l=n(42032),D=n(84708),P=n(10296),G=n(99927),w=n(78472);let H=(()=>{var T;class k{constructor(r,t,h,o,_,E,i,d,p){this.docxService=r,this.commonService=t,this.userService=h,this.questionRenderService=o,this.printAnswersheetService=_,this.formatAnswerSheetService=E,this.shareFileFlutterService=i,this.sAztAnswerTypeService=d,this.documentConfigService=p,this.configRenderService=new e.y,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new y,this.countRetryLoadJS=0}convertAnswerQuestion(r,t){let h=[],o=[];return r.answerResult&&this.isAnsDetail&&r.answerResult.forEach(_=>{let E=_;const i=r.answers?.find(d=>d.key===_);i&&(E=i.alpha??E),o.push(E)}),r.answers.forEach(_=>{let E="<b>     "+(o.includes(_.alpha??_.key)?"*":"")+(t?(_.alpha?_.alpha:_.key).toLowerCase()+")":(_.alpha?_.alpha:_.key)+".")+"</b> "+(0,m.t5)(_.content);h.push(E)}),h}getDataForExportDocxApi(r,t,h){let o=[],_=0;if(h){let i=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");o.push({content:`<b> ${i} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(h,U.c.maxExamCodeLength)+".</b>",answers:[]})}let E=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return t.forEach(i=>{1!==r.hideGroupQuestion&&i.groupInfo?.isFirstInGroup&&i.groupInfo.groupContent&&o.push({content:`<b>${i.groupInfo.groupContent}<b>`,answers:[]}),this.isEnableDebug&&o.push({content:` <br/><br/><br/>*** <b>Question ID: ${i.id}</b> ***`,answers:[]});let d={content:`<b>${E} `+((i.labelIndex??_)+(r.startQuestionIndex??1))+".</b> "+(this.checkImgAtStart(i.content??"")?"<br/>":"")+(0,m.t5)(i.content),answers:this.convertAnswerQuestion(i??[],this.sAztAnswerTypeService.isTrueFalseAnswer(i))};if(_++,o.push(d),this.isAnsDetail&&((i.help||this.sAztAnswerTypeService.isFillAnswer(i))&&o.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b><br/> ${i.help}`,answers:[]}),i.answerResult&&this.isAnsDetail)){let p=[];i.answerResult.forEach(M=>{let u=M;const x=i.answers?.find(A=>A.key===M);x&&(u=x.alpha??u),p.push(u)}),this.sAztAnswerTypeService.isFillAnswer(i)&&o.push({content:`${this.commonService.myTranslateInstant("lang_auto_dap_an")}: ${p.join(" | ")}`,answers:[]})}this.isEnableDebug&&o.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),o}makeDefaultStrValue(r,t){return r&&0!==r.trim().length?r??"":t??""}itemConverterCaller(r,t,h,o,_){var E=this;return new Promise((i,d)=>{var p=0;this.questionRenderService.parseRenderQuestions(r.listQuestion,M=>{if(!this.saveLoadingMsg.includes(")")){p=M/2;var u=(this.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(p)+"%";this.changeMsg?this.changeMsg(u):O.L.changeMsgLoadingEffect(u)}},this.configRenderService,void 0,!0,_).then(M=>{let u=[];const x=[],A=[];if((t.indetifyBox||t.examName)&&x.push(m.$s.createLineCenterBold(this.makeDefaultStrValue(t.indetifyBox,t.examName))),t.subject&&x.push(m.$s.createLineCenterBold(t.subject)),(t.timeBox||t.examMinutes)&&x.push(m.$s.createLineCenterItalicized(this.makeDefaultStrValue(t.timeBox,t.examMinutes))),x.push(m.$s.createLineCenterItalicized("-------------------------")),t.departmentName&&A.push(m.$s.createLineCenterBold(t.departmentName)),t.schoolName&&A.push(m.$s.createLineCenterBold(t.schoolName)),u.push({content:m.$s.makeHeaderTable(A,x,!1),answers:[]}),u.push({content:m.$s.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),u.push({content:m.$s.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),u=u.concat(this.getDataForExportDocxApi(o,M,r.offlineExamMixQuestionObj?r.offlineExamMixQuestionObj.hashId??0:void 0)),(0,R.w)()){var S=0;let C=r.offlineExamMixQuestionObj?.hashId?r.offlineExamMixQuestionObj.hashId.toString().padStart(3,"0"):void 0,L=C?this.commonService.myTranslateInstant("lang_auto_ma_de")+" "+C:"";this.docxService.exportToDocxBinary(u,{isHeadless:!0,footerLeft:L},function(){var g=(0,N.A)(function*(f,c,I){new Promise(B=>{setTimeout(()=>{0==f&&(S=p),p=f/c*25+S;var J=(E.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(p)+"%";O.L.changeMsgLoadingEffect(J)}),B(!0)})});return function(f,c,I){return g.apply(this,arguments)}}()).then(g=>{i({userObj:h,data:g,input:u,additionParams:t,offlineExamMixQuestionObj:r.offlineExamMixQuestionObj})})}else d(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(M=>{d(new Error(M[0].message))})})}masterConverterCaller(r,t,h,o,_,E){return new Promise((i,d)=>{const p=this.userService.getUserObj();let M=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),u=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),x=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),A=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),S=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),C=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),L=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const g=new K.n(1,{function:(f,c)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${c<=1?"":`(${f}/${c}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):O.L.changeMsgLoadingEffect(this.saveLoadingMsg)}});r.forEach(f=>{let c={schoolName:this.makeDefaultStrValue(o?.nameSchool,`{${M}}`),subject:this.makeDefaultStrValue(o?.nameSubject,`{${u}}`),examName:this.makeDefaultStrValue(t.name,`{${x}}`),examMinutes:t.minutes&&t.minutes>0?`${A}: `+t.minutes+` ${C} (${S})`:` ${A}: ${L}`,templateType:_??0,numberOfQuestion:f.listQuestion.length,examId:f.offlineExamMixQuestionObj?.hashId??0,departmentName:o?.departmentName,indetifyBox:o?.indetifyBox,timeBox:o?.timeBox};g.addTask(this,this.itemConverterCaller,[f,c,p,t,E])}),g.start().then(f=>{if(f.errs.length>0)d(f.errs[0]);else if(1===f.datas.length){const c=f.datas[0],I=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let B=this.createNameExam(t,h,c.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(I,B),i()}else f.datas.forEach(c=>{let I=this.createNameExam(t,h,c.offlineExamMixQuestionObj);I=this.replaceAllString(I,"/","_"),this.zipper.file("DOCS/"+I,c.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(c=>{let I=this.commonService.createFileNameExportFile([t.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(c,I),i()},c=>{d(c)})},200)})})}replaceAllString(r,t,h){for(;r.includes(t);)r=r.replace(t,h);return r}createNameExam(r,t,h){return t?this.printAnswersheetService.exportFileNameOfExamOffline(0,r.name??"",t?.hashId??"",h?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,r.name??"",r.hashId??"")+".docx"}downloadExam(r,t,h,o,_,E,i,d,p,M,u){return new Promise((x,A)=>{this.isAnsDetail=r,this.isEnableDebug=!!M,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=p,this.commonService.loadAzotaDocxJs().then(()=>{this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(S=>{if(1==S.success){let C=0,L=0;_.forEach((g,f)=>{g.labelIndex=f,S.data?.resetQuestionIndex&&g.groupInfo&&g.groupInfo.groupId&&(C!=g.groupInfo.groupId&&(C=g.groupInfo.groupId,L=0),g.labelIndex=L,L++)})}this.masterConverterCaller([{listQuestion:_,offlineExamMixQuestionObj:o}],t,h,E,i,u).then(()=>{this.zipper=new y,d?d(10):O.L.closeLoadingEffect(10),x()}).catch(C=>{O.L.closeLoadingEffect(10),A(C)})})}).catch(()=>{d?d(10):O.L.closeLoadingEffect(10),A(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(r,t,h,o,_,E,i,d,p,M){return new Promise((u,x)=>{this.isAnsDetail=r,this.isEnableDebug=!!p,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=d,this.commonService.loadAzotaDocxJs().then(()=>{let A=!0;const S=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(C=>{o.forEach(L=>{let g=this.commonService.castJsonToClassObjs(Q.I,JSON.stringify(L.mixQuestions??[]))??[];if(g.length>0){if(1==C.success){let f=0,c=0;g.forEach((I,B)=>{I.labelIndex=B,C.data?.resetQuestionIndex&&I.groupInfo&&I.groupInfo.groupId&&(f!=I.groupInfo.groupId&&(f=I.groupInfo.groupId,c=0),I.labelIndex=c,c++)})}S.push({listQuestion:g,offlineExamMixQuestionObj:L})}else A=!1}),A?this.masterConverterCaller(S,t,h,_,E,M).then(()=>{this.zipper=new y,i?i(10):O.L.closeLoadingEffect(10),u()}).catch(L=>{i?i(10):O.L.closeLoadingEffect(10),x(L)}):(i?i(10):O.L.closeLoadingEffect(10),x(new Error("lang_testbank_exam_is_invalid_condition")))})}).catch(()=>{i?i(10):O.L.closeLoadingEffect(10),x(new Error("lang_core_lib_not_load"))})})}checkImgAtStart(r){return/^\s*<img/.test(r)}}return(T=k).\u0275fac=function(r){return new(r||T)(F.KVO($.I),F.KVO(s.R),F.KVO(a.R),F.KVO(v.g),F.KVO(l.Q),F.KVO(D.e),F.KVO(P.R),F.KVO(G._),F.KVO(w.x_))},T.\u0275prov=F.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),k})()}}]);