(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[1233],{86066:(A,R,n)=>{"use strict";n.r(R),n.d(R,{HomeworkModule:()=>mt});var I=n(54460),p=n(10936),M=n(89163),S=n(65162),O=n(69223),j=n(15343),y=n(13763),C=n(5502),T=n(21656),_=n(70050),h=n(7050),v=n(76407),b=n(35143),o=n(43234),k=n(1133),x=n(50866),D=n(81519),H=n(34514),z=n(47426),P=n(76627),de=n(99503),he=n(79347),ue=n(38009),W=n(9691),L=n(59640),ge=n(80037),pe=n(25777),fe=n(15766),ke=n(53043),$=n(39712),e=n(48891),G=n(46899),F=n(46134),B=n(51113),be=n(36484),_e=n(3780),we=n(88089),ve=n(21263),X=n(39471),je=n(97839),Y=n(95670),K=n(18718),Q=n(81587),ye=n(27985),Me=n(63349),Se=n(96451),N=n(76975);const Oe=["startTime"],Ie=["endTime"],Z=()=>({"mr-2":!0}),De=a=>[a],xe=()=>({standalone:!0});function Ce(a,f){if(1&a&&e.nrm(0,"azt-loading-effect",5),2&a){const r=e.XpG();e.Y8G("currentStatusObj",r.statusObj)}}function Te(a,f){1&a&&(e.j41(0,"div",73),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"lang_auto_vui_long_nhap_ten_bai_tap")," "))}function Ee(a,f){1&a&&(e.j41(0,"div",74),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&a&&(e.R7$(),e.SpI("",e.bMT(2,1,"lang_testbank_test_config_end_time_bigger_time_star"),"."))}function Re(a,f){if(1&a){const r=e.RV6();e.j41(0,"div",75)(1,"button",76),e.bIt("click",function(){const t=e.eBV(r).index,i=e.XpG(2);return e.Njj(!!i.formHomework.files&&i.formHomework.files.splice(t,1))}),e.nrm(2,"lucide-icon",77),e.k0s(),e.j41(3,"a",78),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG(2);return e.Njj(i.onShowFile(t,-1))}),e.j41(4,"span",79),e.EFF(5),e.k0s()()()}if(2&a){const r=f.$implicit;e.R7$(4),e.Y8G("title",r.name),e.R7$(),e.JRh(r.name)}}function Ne(a,f){if(1&a){const r=e.RV6();e.j41(0,"div",6)(1,"form",7)(2,"div",8)(3,"div",9)(4,"h3",10),e.EFF(5),e.nI1(6,"mytranslate"),e.k0s(),e.j41(7,"div",11)(8,"div",12)(9,"div",13)(10,"label",14),e.EFF(11),e.nI1(12,"mytranslate"),e.k0s()(),e.j41(13,"div",13)(14,"div",15),e.nrm(15,"input",16),e.nI1(16,"mytranslate"),e.k0s(),e.DNE(17,Te,3,3,"div",17),e.k0s()(),e.j41(18,"div",18)(19,"div",19)(20,"label",20),e.EFF(21),e.nI1(22,"mytranslate"),e.k0s()(),e.j41(23,"div",19)(24,"div",21)(25,"div",22)(26,"mat-form-field",23)(27,"input",24),e.nI1(28,"mytranslate"),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.openDateTimePicker(1))}),e.k0s(),e.j41(29,"button",25),e.bIt("click",function(t){return e.eBV(r),e.XpG().openDateTimePicker(1),e.Njj(t.stopPropagation())}),e.nrm(30,"lucide-icon",26),e.k0s(),e.j41(31,"ngx-mat-datetime-picker",27,1)(33,"ngx-mat-datepicker-actions")(34,"button",28),e.EFF(35),e.nI1(36,"mytranslate"),e.k0s(),e.j41(37,"button",29),e.EFF(38,"OK"),e.k0s()()()()(),e.j41(39,"div",22)(40,"mat-form-field",23)(41,"input",30),e.nI1(42,"mytranslate"),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.openDateTimePicker(0))}),e.k0s(),e.j41(43,"button",31),e.bIt("click",function(t){return e.eBV(r),e.XpG().openDateTimePicker(0),e.Njj(t.stopPropagation())}),e.nrm(44,"lucide-icon",26),e.k0s(),e.j41(45,"ngx-mat-datetime-picker",27,2)(47,"ngx-mat-datepicker-actions")(48,"button",28),e.EFF(49),e.nI1(50,"mytranslate"),e.k0s(),e.j41(51,"button",29),e.EFF(52,"OK"),e.k0s()()()()(),e.j41(53,"div",32)(54,"button",33),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.clearTime())}),e.nrm(55,"lucide-icon",34),e.EFF(56),e.nI1(57,"mytranslate"),e.k0s()()(),e.j41(58,"div",35)(59,"div",36),e.EFF(60),e.nI1(61,"mytranslate"),e.k0s(),e.DNE(62,Ee,3,3,"div",37),e.k0s()()(),e.j41(63,"div",38)(64,"div",13)(65,"h3",39),e.EFF(66),e.nI1(67,"mytranslate"),e.k0s()(),e.j41(68,"div",40)(69,"azt-upload-multiple-box",41),e.bIt("uploadComplete",function(t){e.eBV(r);const i=e.XpG();return e.Njj(i.handleUploadComplete(t))}),e.j41(70,"a",42),e.nrm(71,"lucide-icon",43),e.j41(72,"span"),e.EFF(73),e.nI1(74,"mytranslate"),e.k0s()()(),e.j41(75,"div",44),e.EFF(76),e.nI1(77,"mytranslate"),e.k0s(),e.DNE(78,Re,6,2,"div",45),e.j41(79,"editor",46),e.nI1(80,"getTinyMceKey"),e.nI1(81,"getTinyMceConfig"),e.mxI("ngModelChange",function(t){e.eBV(r);const i=e.XpG();return e.DH7(i.formHomework.content,t)||(i.formHomework.content=t),e.Njj(t)}),e.k0s()()(),e.j41(82,"div",47)(83,"div",48)(84,"label",49),e.EFF(85),e.nI1(86,"mytranslate"),e.k0s()(),e.j41(87,"div",50)(88,"div",51)(89,"div",52),e.nrm(90,"input",53),e.j41(91,"label",54),e.EFF(92),e.nI1(93,"mytranslate"),e.k0s()(),e.j41(94,"div",55),e.nrm(95,"input",56),e.j41(96,"label",57),e.EFF(97),e.nI1(98,"mytranslate"),e.k0s()()()()(),e.j41(99,"div",58)(100,"div",48)(101,"label",49),e.EFF(102),e.nI1(103,"mytranslate"),e.k0s()(),e.j41(104,"div",50)(105,"div",51)(106,"div",52),e.nrm(107,"input",59),e.j41(108,"label",60),e.EFF(109),e.nI1(110,"mytranslate"),e.k0s()(),e.j41(111,"div",55),e.nrm(112,"input",61),e.j41(113,"label",62),e.EFF(114),e.nI1(115,"mytranslate"),e.k0s()()()()(),e.j41(116,"div",63)(117,"div",64)(118,"div",65),e.EFF(119),e.nI1(120,"mytranslate"),e.k0s()(),e.j41(121,"div",66)(122,"div",67),e.nrm(123,"azt-list-classroom-checkbox",68),e.k0s()()()(),e.j41(124,"div",69)(125,"div",70)(126,"button",71),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.saveHomework(0))}),e.EFF(127),e.nI1(128,"mytranslate"),e.k0s(),e.j41(129,"button",72),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.saveHomework(1))}),e.EFF(130),e.nI1(131,"mytranslate"),e.k0s()()()()()()()}if(2&a){const r=e.sdS(32),s=e.sdS(46),t=e.XpG();e.R7$(),e.Y8G("formGroup",t.form),e.R7$(4),e.SpI(" ",e.bMT(6,48,"lang_auto_tao_bai_tap_moi")," "),e.R7$(6),e.SpI(" ",e.bMT(12,50,"lang_auto_ten")," "),e.R7$(4),e.FS9("placeholder",e.bMT(16,52,"lang_auto_nhap_ten")+" ..."),e.R7$(2),e.Y8G("ngIf",t.form.controls.homeworkName.errors),e.R7$(4),e.SpI(" ",e.bMT(22,54,"lang_testbank_test_config_time_assigne_homework")," "),e.R7$(6),e.FS9("placeholder",e.bMT(28,56,"lang_auto_tu")),e.Y8G("max",t.maxDate)("ngxMatDatetimePicker",r)("formControl",t.form.controls.startTime),e.R7$(4),e.Y8G("touchUi",!0),e.R7$(4),e.JRh(e.bMT(36,58,"lang_auto_dong")),e.R7$(6),e.FS9("placeholder",e.bMT(42,60,"lang_auto_den")),e.Y8G("max",t.maxDate)("ngxMatDatetimePicker",s)("formControl",t.form.controls.endTime),e.R7$(4),e.Y8G("touchUi",!0),e.R7$(4),e.JRh(e.bMT(50,62,"lang_auto_dong")),e.R7$(6),e.Y8G("ngClass",e.lJ4(96,Z)),e.R7$(),e.SpI(" ",e.bMT(57,64,"lang_auto_dat_lai")," "),e.R7$(4),e.SpI("",e.bMT(61,66,"lang_auto_bo_trong_neu_khong_muon_gioi_han_thoi_gian"),"."),e.R7$(2),e.Y8G("ngIf",t.form.controls.endTime.invalid),e.R7$(4),e.SpI(" ",e.bMT(67,68,"lang_auto_noi_dung")," "),e.R7$(3),e.Y8G("uploadToCdnMenu",t.allUploadToCdnMenuTypes.HOMEWORK)("fileType",e.eq3(97,De,t.allUploadFileTypes.SYNTHETIC))("notSupportedFile",t.notSupportedFile.WMV),e.R7$(2),e.Y8G("ngClass",e.lJ4(99,Z)),e.R7$(2),e.JRh(e.bMT(74,70,"lang_homework_add_home_work_add_file_homework")),e.R7$(3),e.JRh(e.bMT(77,72,"lang_cms_add_homework_input_file")),e.R7$(2),e.Y8G("ngForOf",t.formHomework.files),e.R7$(),e.FS9("apiKey",e.bMT(80,74,"")),e.R50("ngModel",t.formHomework.content),e.Y8G("ngModelOptions",e.lJ4(100,xe))("init",e.bMT(81,76,"teacher")),e.R7$(6),e.SpI(" ",e.bMT(86,78,"lang_auto_cho_xem_ket_qua")," "),e.R7$(7),e.SpI(" ",e.bMT(93,80,"lang_auto_khong")," "),e.R7$(5),e.SpI(" ",e.bMT(98,82,"lang_auto_co")," "),e.R7$(5),e.SpI(" ",e.bMT(103,84,"lang_auto_dang_nhap_de_nop_bai")," "),e.R7$(7),e.SpI(" ",e.bMT(110,86,"lang_auto_khong")," "),e.R7$(5),e.SpI(" ",e.bMT(115,88,"lang_auto_co")," "),e.R7$(5),e.SpI(" ",e.bMT(120,90,"lang_auto_giao_cho_lop")," "),e.R7$(4),e.Y8G("form",t.form)("classroomGroupData",t.classroomWithGroup)("permissionName",t.permissionTypes.homework),e.R7$(3),e.Y8G("disabled",t.form.invalid),e.R7$(),e.SpI(" ",e.bMT(128,92,"lang_auto_luu_nhap")," "),e.R7$(2),e.Y8G("disabled",t.form.invalid),e.R7$(),e.SpI(" ",e.bMT(131,94,"lang_auto_xuat_ban")," ")}}let Ae=(()=>{var a;class f extends L.H{clearTime(){this.form.controls.endTime.setValue(""),this.form.controls.startTime.setValue("")}handleUploadComplete(s){this.formHomework.files?.push(...s)}onShowFile(s,t){let i={...s,index:t};this.sAztDialogService.open(ke.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:i},restoreFocus:!1})}openDateTimePicker(s){return 1==s&&this.startTime?this.startTime.open():1!=s&&this.endTime?this.endTime.open():void 0}saveHomework(s){this.initStatusObj(),this.homeWorkContent=this.formHomework.content??"",this.uploadImageOfHomeworkService.replaceImageInContent(this.homeWorkContent).subscribe(t=>{null==t.errorMessage?(this.homeWorkContent=t.content,this.callApiToSaveHomework(s)):(this.showErrorSnack(t.errorMessage),this.stopStatusObj())})}callApiToSaveHomework(s){let t=this.form.getRawValue(),i=t.startTime?this.timeService.formatDateTimeToPostToServer(t.startTime):void 0,l=t.endTime?this.timeService.formatDateTimeToPostToServer(t.endTime):void 0,u="1"!=t.mustVerified?0:1,m="1"!=t.whenShowAnswer?0:1;this.homeWorkContent=this.zipDataService.convertContentGzip(this.homeWorkContent);let g=this.userService.getUserObj(),c=JSON.stringify({type:"homework",id:0,user:g.id});const d=this.sAztClassroomCheckboxService.getClassroomIdsCheckedInGroup(this.form.controls.classroomFormArray);let w={name:t.homeworkName,content:this.homeWorkContent,startDate:i,deadline:l,files:JSON.stringify(this.formHomework.files),mustVerified:u,whenShowAnswer:m,isPublished:s,categoryId:this.cateId?Number(this.cateId):void 0,classroomIds:d};this.waitDestroy(this.homeworkService.apiHomeworkSaveObjPost(c,w).subscribe(E=>{if(1==E.success){if(s){this.successStatusObj("lang_auto_xuat_ban_thanh_cong",!0);let me=[];if(E.data?.objs)for(let J=0;J<E.data.objs.length;J++)me.push(E.data?.objs[J].hashId);this.listIds=JSON.stringify(me),this.commonService.myNavigationWithQueryString("/admin/testbank/publish-document/1/"+(this.cateId??0)+"/"+this.listIds,"?backto="+encodeURIComponent(`/admin/homework/add-new-homework/${this.cateId??0}?backto=`+this.backToLink))}else this.commonService.myNavigation(this.backToLink?this.backToLink:"/admin/testbank/document-management/1/0/1"),this.successStatusObj("lang_auto_luu_thanh_cong_chua_xuat_ban",!0);this.successStatusObj()}else this.errorStatusObj(E.message??"",!0)}))}getHomework(){this.waitDestroy(this.documentConfigService.apiDocumentConfigGetHomeworkConfigDataV2Post("add_new",[]).subscribe(s=>{1==s.success?(this.classroomWithGroup=s.data?.classroomGroupObjs??[],this.successStatusObj()):this.errorStatusObj(s.message??"",!0)}))}ngOnInit(){this.initStatusObj(),this.waitDestroy((0,P.z)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([])=>{this.backToLink=this.commonService.getMyQueryParam("backto")??"",this.cateId=this.commonService.getMyParam(this.activeRoute,"cat_id")??"",this.getHomework()})),this.commonService.translateMetaData({title:"lang_cms_homework_add_exercise_title",description:"lang_cms_homework_add_exercise_description",image:"lang_cms_test_image"})}constructor(s,t,i,l,u,m,g,c,d,w){super(),this.sAztDialogService=s,this.activeRoute=t,this.homeworkService=i,this.classroomService=l,this.zipDataService=u,this.timeService=m,this.userService=g,this.sAztClassroomCheckboxService=c,this.uploadImageOfHomeworkService=d,this.documentConfigService=w,this.permissionTypes=ue.t,this.formHomework={files:[],content:""},this.prevData="",this.cateId="",this.listIds="",this.backToLink="",this.homeWorkContent="",this.maxDate=o.c.maxDateTimePicker,this.allUploadToCdnMenuTypes=$.b8,this.allUploadFileTypes=$.PO,this.notSupportedFile=$.Ym,this.classroomWithGroup=[],this.form=new p.gE({homeworkName:new p.MJ("",{nonNullable:!0,validators:[p.k0.required,p.k0.maxLength(180),fe.M.noWhiteSpace]}),startTime:new p.MJ("",{nonNullable:!0}),endTime:new p.MJ("",{nonNullable:!0}),mustVerified:new p.MJ("0",{nonNullable:!0}),whenShowAnswer:new p.MJ("0",{nonNullable:!0}),classroomFormArray:new p.Yp([]),whoAllow:new p.MJ(2,{nonNullable:!0})},{validators:[pe.Z.customDateTimeValidator,ge.j.classroomInGroupCheckBoxValidator]})}}return(a=f).\u0275fac=function(s){return new(s||a)(e.rXU(G.i),e.rXU(S.nX),e.rXU(F.MY),e.rXU(F.zS),e.rXU(B.j),e.rXU(W.F),e.rXU(be.R),e.rXU(_e.Q),e.rXU(we.J),e.rXU(ve.x_))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-add-home-work"]],viewQuery:function(s,t){if(1&s&&(e.GBs(Oe,5),e.GBs(Ie,5)),2&s){let i;e.mGM(i=e.lsd())&&(t.startTime=i.first),e.mGM(i=e.lsd())&&(t.endTime=i.first)}},features:[e.Jv_([{provide:D.$O,useClass:de.fb,deps:[z.Ju,H.ij]},{provide:D.vq,useFactory:he.Yw,deps:[W.F]}]),e.Vt3],decls:4,vars:3,consts:[["doneLoading",""],["startTime",""],["endTime",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document","mx-auto",2,"max-width","1000px"],[1,"setting-basic"],[1,"text-md","uppercase","font-medium"],[1,"box","mt-2","p-5"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","homework-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","homework-name","formControlName","homeworkName","type","text",1,"form-control",3,"placeholder"],["class","text-xs text-danger mt-2",4,"ngIf"],["id","azt-config-time-assignment",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12"],["for","regular-form-1",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-5"],["appearance","outline"],["azt-track-service","add-home-work-2lcHTxnwVmR","matInput","","readonly","",3,"click","placeholder","max","ngxMatDatetimePicker","formControl"],["azt-track-service","add-home-work-6MNUM1lV8t1","matSuffix","",2,"font-size","18px",3,"click"],["name","calendar-clock","size","16"],[3,"touchUi"],["mat-raised-button","","color","secondary","ngxMatDatepickerCancel",""],["mat-raised-button","","color","primary","ngxMatDatepickerApply",""],["azt-track-service","add-home-work-ShSJ8gIBpK8","matInput","","readonly","",3,"click","placeholder","max","ngxMatDatetimePicker","formControl"],["azt-track-service","add-home-work--BjU84v-g28","matSuffix","",2,"font-size","18px",3,"click"],[1,"col-span-6","md:col-span-2"],["azt-track-service","add-home-work-NEdqGTKJIVb",1,"btn","btn-outline-secondary","w-full",3,"click"],["name","timer-reset","size","18",3,"ngClass"],[1,"text-xs","mt-2"],[1,"text-slate-500","mt-1"],["class","text-danger mt-1",4,"ngIf"],[1,"grid","grid-cols-12","mt-4"],[1,"text-md","font-medium"],[1,"col-span-12","lg:col-span-12","mt-3"],[2,"display","inline-block",3,"uploadComplete","uploadToCdnMenu","fileType","notSupportedFile"],["azt-track-service","add-home-work-4ML9tUkucGY",1,"btn","btn-sm","btn-primary-soft","mr-2"],["name","plus","size","16",3,"ngClass"],[1,"text-slate-600","text-xs","mt-2","mb-2"],["class","flex items-center mt-3 mb-3",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel","ngModelOptions","apiKey","init"],["id","azt-config-when-result",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["id","whenShowAnswer-off","type","radio","formControlName","whenShowAnswer","value","1",1,"form-check-input"],["for","whenShowAnswer-off",1,"form-check-label"],[1,"form-check","mr-8","mt-2","sm:mt-0"],["id","whenShowAnswer-tested","type","radio","formControlName","whenShowAnswer","value","0",1,"form-check-input"],["for","whenShowAnswer-tested",1,"form-check-label","flex","items-center"],["id","azt-config-login-require",1,"grid","grid-cols-12","mt-4"],["id","mustVerified-off","type","radio","formControlName","mustVerified","value","0",1,"form-check-input"],["for","mustVerified-off",1,"form-check-label"],["id","mustVerified-tested","type","radio","formControlName","mustVerified","value","1",1,"form-check-input"],["for","mustVerified-tested",1,"form-check-label","flex","items-center"],["id","azt-config-who-allow",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5","pr-5"],[1,"mb-0","font-medium","flex","items-center"],[1,"col-span-12","mt-4"],[1,"azt-list-classroom"],[3,"form","classroomGroupData","permissionName"],[1,"my-5"],[1,"text-right"],["azt-track-service","add-home-work-ZxDqD0KF4NR",1,"btn","btn-pending","w-24","mr-2",3,"click","disabled"],["azt-track-service","add-home-work-JgG_cpuccgD",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-xs","text-danger","mt-2"],[1,"text-danger","mt-1"],[1,"flex","items-center","mt-3","mb-3"],["azt-track-service","add-home-work-HeEXhrbob3P",1,"text-slate-600","mr-2",3,"click"],["name","x","size","16"],["azt-track-service","add-home-work-QFtSJlUphLG",3,"click"],[1,"text-slate-600",3,"title"]],template:function(s,t){if(1&s&&(e.j41(0,"teacher-layout",3),e.DNE(1,Ce,1,1,"azt-loading-effect",4)(2,Ne,132,101,"ng-template",null,0,e.C5r),e.k0s()),2&s){const i=e.sdS(3);e.Y8G("headerBackToLink",t.backToLink),e.R7$(),e.Y8G("ngIf",1==t.statusObj.loading)("ngIfElse",i)}},dependencies:[I.YU,I.Sq,I.bT,X.$z,je.fg,Y.rl,Y.yw,D.m7,D.yF,D.HF,D.gx,D.Uq,O.xn,p.qT,p.me,p.Fm,p.BC,p.cb,p.vS,p.l_,p.j4,p.JD,K.K,Q.t,ye.D,Me.V,Se.Q,j.WGl,N.wp,N.Hw,N.yc],encapsulation:2}),f})();var Pe=n(73014),U=n(27691),q=n(64198),V=n(83229),ee=n(33887),te=n(52811);let se=(()=>{var a;class f extends ee._{getData(){this.initStatusObj(),this.data.status?this.successStatusObj():this.stopStatusObj()}cleanResult(){var s=this.getFormValue(),t={homeworkHashId:this.data.itemHomework.hashId??"",id:this.data.ans_id,resendNote:s.reason};this.initStatusObj(),this.waitDestroy(this.answerService.apiAnswerResendAnswerPost(t).subscribe(i=>{1==i.success?(this.showSuccessSnack(this.commonService.myTranslateInstant("lang_send_request_must_resubmit_homework_with_reason")+": "+s.reason),this.result=!0,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.successStatusObj()):(this.showErrorSnack("lang_cms_send_request_error"),this.result=!1,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.errorStatusObj(i.message??""))}))}getFormValue(){return this.form.getRawValue()}ngOnInit(){this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"",this.getData(),super.ngOnInit()}constructor(s,t,i,l){super(l,s),this.dialogRef=s,this.answerService=t,this.activeRoute=i,this.data=l,this.result=!1,this.homeworkHashId="",this.form=new p.gE({reason:new p.MJ("",{nonNullable:!0,validators:[p.k0.required]})})}onNoClick(){this.dialogRef.close()}onSubmit(s){this.dialogRef.close(s)}}return(a=f).\u0275fac=function(s){return new(s||a)(e.rXU(M.CP,8),e.rXU(F._t),e.rXU(S.nX),e.rXU(M.Vh,8))},a.\u0275cmp=e.VBU({type:a,selectors:[["clean-result-dialog"]],features:[e.Vt3],decls:43,vars:31,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto","text-center"],[3,"hidden"],[1,"d-flex","justify-content-center"],[1,"sr-only","ml-2"],[1,"intro",3,"hidden"],["enctype","multipart/form-data",1,"form-horizontal","text-center",3,"formGroup"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger","text-center"],[1,"h5","mb-1"],[1,"text-danger"],[1,"h5","text-danger","mt-1","mb-1"],["type","text","id","reason","formControlName","reason",1,"form-control","mt-2"],[1,"text-right","mt-3"],["azt-track-service","clean-result-dialog-_f7PVI4E-S_",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","clean-result-dialog-xDCHUvnl-fJ",1,"btn","w-24","btn-primary",3,"click"]],template:function(s,t){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.EFF(5),e.nI1(6,"mytranslate"),e.k0s()(),e.nrm(7,"br"),e.j41(8,"div",5)(9,"div",6),e.nrm(10,"azt-loading-ui"),e.j41(11,"span",7),e.EFF(12,"..."),e.k0s()()(),e.j41(13,"div",8)(14,"form",9)(15,"div",10)(16,"p",11),e.EFF(17),e.nI1(18,"mytranslate"),e.k0s(),e.j41(19,"p",12),e.EFF(20),e.nI1(21,"mytranslate"),e.j41(22,"span",13),e.EFF(23),e.k0s(),e.EFF(24),e.nI1(25,"mytranslate"),e.j41(26,"span",13),e.EFF(27),e.nI1(28,"formatOnlyDateByUserUnitPipe"),e.k0s(),e.EFF(29),e.nI1(30,"mytranslate"),e.k0s(),e.nrm(31,"hr"),e.j41(32,"p",14),e.EFF(33),e.nI1(34,"mytranslate"),e.k0s(),e.nrm(35,"input",15),e.k0s()()(),e.j41(36,"div",16)(37,"button",17),e.bIt("click",function(){return t.onNoClick()}),e.EFF(38),e.nI1(39,"mytranslate"),e.k0s(),e.j41(40,"button",18),e.bIt("click",function(){return t.cleanResult()}),e.EFF(41),e.nI1(42,"mytranslate"),e.k0s()()()()()),2&s&&(e.R7$(5),e.JRh(e.bMT(6,13,"lang_homework_mark_exercise_utils_request_resubmit")),e.R7$(3),e.Y8G("hidden",!t.statusObj.loading),e.R7$(5),e.Y8G("hidden",t.statusObj.loading),e.R7$(),e.Y8G("formGroup",t.form),e.R7$(3),e.SpI("(*) ",e.bMT(18,15,"lang_homework_mark_exercise_utils_note"),":"),e.R7$(3),e.SpI(" ",e.bMT(21,17,"lang_homework_mark_exercise_utils_request")," "),e.R7$(3),e.SpI(" ",t.data.name," "),e.R7$(),e.SpI(" ",e.bMT(25,19,"lang_homework_mark_exercise_utils_in_homework"),"\xa0"),e.R7$(3),e.JRh(e.bMT(28,21,t.data.deadline?t.data.deadline:t.data.itemHomework.createdAt)),e.R7$(2),e.SpI("\xa0",e.bMT(30,23,"lang_homework_mark_exercise_utils_will_be_deleted"),"! "),e.R7$(4),e.JRh(e.bMT(34,25,"lang_homework_mark_exercise_utils_coment_request_resubmit")),e.R7$(5),e.SpI(" ",e.bMT(39,27,"lang_button_cancel")," "),e.R7$(3),e.SpI(" ",e.bMT(42,29,"lang_button_confirm")," "))},dependencies:[p.qT,p.me,p.BC,p.cb,p.j4,p.JD,Q.t,te.R,N.wp,N.vv],encapsulation:2}),f})();var Fe=n(66729);const He=()=>({"mr-1 text-success":!0});let ie=(()=>{var a;class f extends ee._{ngOnInit(){this.success=this.data.status}constructor(s,t,i){super(i,s),this.dialogRef=s,this.answerService=t,this.data=i,this.success=!1}checkNextAns(){this.dialogRef.close(),this.answerService.apiAnswerGetNextObjByHomeworkGet(this.data.homeworkHashId).subscribe(s=>{if(1==s.success)return this.commonService.myNavigationWithQueryString("/admin/homework/switch-mark-exercise/"+s.data?.obj?.id+"/"+this.data.homeworkHashId+"/0","?backto="+encodeURIComponent(this.data.backToLink)),void(window.location.href=this.commonService.getLocalRouter("/admin/homework/switch-mark-exercise/"+s.data?.obj?.id+"/"+this.data.homeworkHashId+"/0?backto="+encodeURIComponent(this.data.backToLink)));window.location.href=this.commonService.getLocalRouter("/admin/testbank/homework-results-list/"+this.data.classID+"/"+this.data.homeWorkID+"/"+this.data.homeworkHashId)})}onNoClick(){this.dialogRef.close()}}return(a=f).\u0275fac=function(s){return new(s||a)(e.rXU(M.CP,8),e.rXU(F._t),e.rXU(M.Vh,8))},a.\u0275cmp=e.VBU({type:a,selectors:[["notice-dialog"]],features:[e.Vt3],decls:21,vars:12,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto"],["name","circle-check","size","24",3,"ngClass"],[2,"color","red","font-size","120%","font-weight","500"],[3,"mark"],[1,"text-right","mt-3"],["azt-track-service","notice-dialog-YnLBVlTjw",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","notice-dialog-D6RUmpOZKX",1,"btn","w-24","btn-primary",3,"click"]],template:function(s,t){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.nrm(5,"lucide-icon",5),e.EFF(6),e.nI1(7,"mytranslate"),e.k0s()(),e.nrm(8,"br"),e.j41(9,"div",3),e.EFF(10),e.nI1(11,"mytranslate"),e.j41(12,"span",6),e.nrm(13,"azt-check-mark",7),e.k0s()(),e.nrm(14,"br"),e.j41(15,"div",8)(16,"button",9),e.bIt("click",function(){return t.onNoClick()}),e.EFF(17,"Ok"),e.k0s(),e.j41(18,"button",10),e.bIt("click",function(){return t.checkNextAns()}),e.EFF(19),e.nI1(20,"mytranslate"),e.k0s()()()()()),2&s&&(e.R7$(5),e.Y8G("ngClass",e.lJ4(11,He)),e.R7$(),e.SpI(" ",e.bMT(7,5,"lang_homework_mark_exercise_utils_mark_success"),""),e.R7$(4),e.SpI(" ",e.bMT(11,7,"lang_homework_mark_exercise_utils_assignment_marking")," "),e.R7$(3),e.Y8G("mark",t.data.score),e.R7$(6),e.JRh(e.bMT(20,9,"lang_homework_mark_exercise_utils_mark_continue")))},dependencies:[I.YU,Fe.D,j.WGl,N.wp],styles:["#ok[_ngcontent-%COMP%]:hover{background-color:#e7e7e7}#next[_ngcontent-%COMP%]:hover{background-color:#1e579d!important}"]}),f})();var ae=n(51913),oe=n(58112),ne=n(48451),re=n(68323),ze=n(7919),Le=n(94743),Be=n(58588);const $e=["aztMarkNote"],Ge=a=>({height:a});function Ue(a,f){if(1&a){const r=e.RV6();e.qex(0),e.j41(1,"azt-mark-note",39,1),e.bIt("handleBackLink",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.goBack())})("doneLoadData",function(t){e.eBV(r);const i=e.XpG();return e.Njj(i.doneLoadData(t))})("markData",function(t){e.eBV(r);const i=e.XpG();return e.Njj(i.getMarkData(t))})("getIdHistory",function(t){e.eBV(r);const i=e.XpG();return e.Njj(i.getDataHistory(t))}),e.k0s(),e.bVm()}if(2&a){const r=e.XpG();e.R7$(),e.Y8G("dataMarkNote",r.dataMarkNote)("showBackLink",!0)("markedByObj",r.markedByObj)("historyAnswerObjs",r.historyAnswerObjs)}}function Ve(a,f){if(1&a){const r=e.RV6();e.j41(0,"div",40)(1,"button",41),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.goBack())}),e.nrm(2,"lucide-icon",42),e.j41(3,"span",43),e.EFF(4),e.nI1(5,"mytranslate"),e.k0s()(),e.j41(6,"div",44),e.nrm(7,"azt-svg-icon",45),e.j41(8,"p",46),e.EFF(9),e.nI1(10,"mytranslate"),e.k0s()()()}2&a&&(e.R7$(4),e.JRh(e.bMT(5,3,"lang_auto_quay_lai")),e.R7$(3),e.Y8G("size",102),e.R7$(2),e.JRh(e.bMT(10,5,"lang_auto_chua_nop_bai")+"..."))}function Je(a,f){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"mytranslate"),e.nI1(3,"mytranslate"),e.k0s()),2&a){const r=e.XpG();e.R7$(),e.LHq(" ",e.bMT(2,4,"lang_testbank_tested_list_number_success")+" "," ",r.markData.totalRight+", "," ",e.bMT(3,6,"lang_testbank_tested_list_error")+" "," ",r.markData.totalWrong," ")}}function We(a,f){1&a&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"mytranslate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"lang_core_chua_co_so_cau_dung_cau_sai")))}function Xe(a,f){if(1&a){const r=e.RV6();e.j41(0,"div",47)(1,"button",48),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.setPoint(t))}),e.EFF(2),e.k0s()()}if(2&a){const r=f.$implicit;e.R7$(2),e.SpI(" ",r.name," ")}}function Ye(a,f){1&a&&e.nrm(0,"azt-loading-ui",49)}let Ke=(()=>{var a;class f extends L.H{onResize(s){this.changeSizeMarkGeneral()}doneLoadData(s){this.loadingDataCdn=!1}uploadDrawBase64ToCDN(s,t,i){let l=(0,V.q)(s),u=Date.now();this.apiUploadService.commonUploadForMarkResult(l,`essay_note_${t}_${this.answerId}_${u}.png`,"image/png").subscribe(m=>{m.type!=U.hv.UploadProgress&&(1==m.success?(this.mnoteJsonData.pages?.[t]&&(this.mnoteJsonData.pages[t].draw=m.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,i,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(s,t){this.pagesCount=0;for(let i=0;i<s.length;i++)s[i].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,t,this.mnoteJsonData);else for(let i=0;i<s.length;i++)s[i].draw&&this.uploadDrawBase64ToCDN(s[i].draw,i,t)}sendDataToMarkNote(){let s=this.castObj(this.result.answerObj);if(s){let m=this.commonService.willDeleteParseJson(s.result??"");if(null!=m){let c=m.pages?.length??0;for(let d=0;d<c;d++)m?.pages?.[d].backgroundImage&&(m.pages[d].backgroundImage=this.sAztCommonCdnService.getMyCdn(m.pages[d].backgroundImage??"")),m.pages?.[d].draw&&(m.pages[d].draw=this.sAztCommonCdnService.getMyCdn(m.pages[d].draw));m=JSON.stringify(m),s.result=JSON.stringify(m)}let g=this.commonService.willDeleteParseJson(s.files??"");if(null!=g){for(let c=0;c<g.length;c++)g[c].url&&(g[c].url=this.sAztCommonCdnService.getMyCdn(g[c].url)),g[c].thumb&&(g[c].thumb=this.sAztCommonCdnService.getMyCdn(g[c].thumb));g=JSON.stringify(g),s.files=g}}let t=this.result.studentObj,i=this.result.classroomObj,l=this.result.homeworkObj,u=this.commonService.myParseJson(s?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let m=0;m<(this.jsonData.pages?.length??0);m++)this.jsonData.pages?.[m].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[m].backgroundImage=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[m].backgroundImage??"")),this.jsonData.pages?.[m].hasOwnProperty("draw")&&(this.jsonData.pages[m].draw=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[m].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=s,this.jsonData.student_obj=t,this.jsonData.classroom_obj=i,this.jsonData.homework_obj=l,u&&u.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=u.hideMark),this.dataMarkNote=this.jsonData;else{let m=[];this.files.forEach(c=>{m.push({backgroundImage:c.url})});let g={cmd:"initMNote",mode:"edit",pages:m,answer_obj:s,student_obj:t,classroom_obj:i,homework_obj:l};u&&u.hasOwnProperty("hideMark")&&(g.hideMark=u.hideMark),this.dataMarkNote=g}}getHistoryObjs(s){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,s).subscribe(t=>{1==t.success?this.historyAnswerObjs=t.data?.objs??new Array:this.errorMessage=t.message??"",this.stopStatusObj()})}getDataHistory(s){this.historyId=s,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(s,10)).subscribe(t=>{if(1==t.success){if(this.zipDataService.convertSubmittedAnswersObj(t.data?.answerObj),t.data){this.result=t.data,this.markedByObj=t.data.markedByObj,this.score=t.data?.answerObj?.point??0,this.pointExercise.value=t.data?.answerObj?.point??"",Number(this.pointExercise.value)<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(l=>{l.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(l))}),"0"==this.pointExercise.name&&(this.pointExercise.name="");let i=this.castJsonToObj(t.data.answerObj?.resultNote??"");if(this.commentExercise=i?.Note??"",this.showPoint=!i?.IsHideMark,this.files=this.commonService.myParseJson(t.data.answerObj?.files??"")??[],null!=this.files)for(let l=0;l<this.files.length;l++)this.files[l].url=this.sAztCommonCdnService.getMyCdn(this.files?.[l].url??""),this.files[l].thumb=this.sAztCommonCdnService.getMyCdn(this.files?.[l].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,this.sendDataToMarkNote(),this.successStatusObj()}}else this.errorMessage=t.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var s=this.commonService.myParseJson(this.result.answerObj?.result??"");s&&(this.jsonData=s,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(s){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,s).subscribe(t=>{1==t.success&&t.data?(this.studentObj=t.data.studentObj,this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(s){this.initStatusObj(),this.errorMessage="",this.answerId=s,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,s).subscribe(t=>{if(1==t.success)if(this.zipDataService.convertSubmittedAnswersObj(t.data?.answerObj),t.data?.hasOwnProperty("studentObj")&&null!=t.data?.studentObj){this.result=t.data,this.markedByObj=t.data.markedByObj,this.score=t.data?.answerObj?.point??0,this.pointExercise.value=t.data?.answerObj?.point??0,this.checkInputActive=!0,this.pointExercise.value<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(l=>{l.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(l))}),"0"==this.pointExercise.name&&(this.pointExercise.name="",this.checkInputActive=!1);let i=this.castJsonToObj(t.data.answerObj?.resultNote??"");if(this.commentExercise=i?.Note??"",this.showPoint=!i?.IsHideMark,this.homeworkID=t.data.homeworkObj?.id??0,this.classID=t.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(t.data.answerObj?.files??"")??[],this.studentObj=t.data.studentObj,this.classroomObj=t.data.classroomObj??{},null!=this.files)for(let l=0;l<this.files.length;l++)this.files[l].url=this.sAztCommonCdnService.getMyCdn(this.files?.[l].url??""),this.files[l].thumb=this.sAztCommonCdnService.getMyCdn(this.files?.[l].thumb??""),((0,q.rl)(this.files[l].mimes??"")||(0,q.nL)(this.files[l].mimes??""))&&(this.hasAttachmentFile=!0);this.homeworkObj=t.data.homeworkObj??{},this.studentName=t.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToMarkNote()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=t.message??"",this.stopStatusObj()})}openDialog(s,t){this.sAztDialogService.open(ie,{width:"280px",autoFocus:!1,data:{score:t,status:s,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(l=>{})}handleOpenReSubmit(){this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline??void 0,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(s,t,i,l,u){let m={status:s,deadline:t,itemHomework:i,ans_id:l,name:u,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(se,{width:"380px",panelClass:"cleanResultDialogBox",data:m,restoreFocus:!1}).afterClosed().subscribe(c=>{if(c&&c.result&&c.isRedirect){let d="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+m.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+m.classID+"/"+m.itemHomework.id+"/"+this.homeworkHashId,d)}})}remark(s,t,i){let l=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let u={id:s,comment:i.comment,hideMark:i.hideMark?1:0,point:t?parseFloat(t.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(i)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(l,u).subscribe(m=>{1==m.success?(this.openDialog(!0,m.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId)}checkModeUiEditor(){let s=document.getElementById("mark-general-box")?.offsetHeight;this.heightEditor=(s??0)-80-40-140-40-30}setPoint(s){this.pointExercise=this.commonService.myClone(s),this.checkInputActive=!0}setPointInput(s){if(s.target){this.checkInputActive=!0;let t=s.target.value;this.pointExercise.value=t,this.pointExercise.name=t}}getListPointDefault(){this.listPointAzt=[{value:1e3,name:"\u0110"},{value:1001,name:"C\u0110"},{value:2e3,name:"HT"},{value:2001,name:"CHT"},{value:3e3,name:"HTT"}]}getMarkData(s){s.checkChangeMark&&(this.markData=s,this.checkInputActive||(this.pointExercise.value=isNaN(this.markData.pointRaw??0)?"":this.markData.pointRaw,this.pointExercise.name=this.pointExercise.value?.toString()))}ngOnInit(){this.isMobileDevice||(document.body.style.overflowY="hidden"),this.getListPointDefault();const s=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),t=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),i=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let l=this.commonService.getMyQueryParam("backto");this.backToLink=l?l.includes("shareType")?decodeURIComponent(l):l:"",s?(this.getData(s),this.getHistoryObjs(s)):this.getStudentObj(t),i&&this.getDataHistory(i),this.checkModeUiEditor(),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}getSizeMarkEditor(s){this.sizeMarkEditor=s}changeSizeMarkGeneral(){let s=document.getElementById("mark-general"),t=document.getElementById("mark-general-box");t&&s&&(t.style.width=s.offsetWidth.toString()+"px")}uploadDrawBase64ToCdn(){return new Promise(s=>{let t=[];if(this.objectResult.pages){this.objectResult.pages.forEach(i=>{t.push(!1)});for(let i=0;i<this.objectResult.pages.length;i++)if(this.objectResult.pages[i]&&this.objectResult.pages[i].draws?.length)for(let l=0;l<(this.objectResult.pages[i].draws?.length??0);l++){let u=this.objectResult.pages[i].draws?.[l]??{};if(u.src&&u.src.includes("base64")){t[i]=!0;let m=(0,V.q)(u.src);this.apiUploadService.commonUploadForMarkResult(m,`essay_note_${i}_${l}_${this.answerId}.png`,"image/png").subscribe(g=>{g.type!=U.hv.UploadProgress&&(u.src=g.data?.url,t[i]=!1),t.includes(!0)||s()})}}}})}saveDataMarkExercise(){var s=this;return(0,Pe.A)(function*(){if(s.loadingSaveData=!0,""==s.historyId)if(1==s.permissionService.hasMarkPointPermission("homework",s.homeworkObj)){if(!s.MarkNote)return;s.objectResult=s.MarkNote?.exportDataMarkNote();let t=!1;if(!s.objectResult.pages?.length&&!s.hasAttachmentFile)return s.loadingSaveData=!1,void s.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_vui_long_thu_lai");if(s.hasAttachmentFile&&!s.objectResult.pages?.length){let i={point:s.pointExercise.value?.toString(),urlDataMark:"",version:"0.1",comment:s.commentExercise,hideMark:!s.showPoint};s.remark(s.answerId,i.point??"0",i)}if(s.objectResult.pages?.length){for(let g=0;g<s.objectResult.pages.length;g++)if(s.objectResult.pages[g]&&s.objectResult.pages[g].draws?.length)for(let c=0;c<(s.objectResult.pages[g].draws?.length??0);c++){let d=s.objectResult.pages[g].draws?.[c]??{};d.src&&d.src.includes("base64")&&(t=!0)}t&&(yield s.uploadDrawBase64ToCdn());const i=s.serializeJson(s.objectResult),l=s.zipDataService.convertContentGzip(i),u=new Blob([l],{type:"text/plain"}),m=new File([u],"txt",{type:"text/plain"});s.apiUploadService.uploadToCdnForHomework(m).subscribe(g=>{if(1==g.success){let c=g.data?.url??"",d={point:s.pointExercise.value?.toString(),urlDataMark:c,version:"0.1",comment:s.commentExercise,hideMark:!s.showPoint};s.remark(s.answerId,d.point??"0",d)}else s.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");s.loadingSaveData=!1})}}else s.showErrorSnack("lang_cms_no_permission_on_homework"),s.stopStatusObj();else s.stopStatusObj(),s.showErrorSnack("lang_cms_cannot_remark_student_history_result")})()}ngAfterViewInit(){this.changeSizeMarkGeneral()}constructor(s,t,i,l,u,m,g,c){super(),this.activeRoute=s,this.answerService=t,this.permissionService=i,this.sAztDialogService=l,this.sAztCommonCdnService=u,this.zipDataService=m,this.apiUploadService=g,this.vcRef=c,this.answerId=0,this.homeworkID="",this.historyId="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.color="#000",this.dataMarkNote={},this.loadingSaveData=!1,this.loadingDataCdn=!0,this.listPointAzt=[],this.pointExercise={value:0,name:""},this.markData={},this.commentExercise="",this.showPoint=!0,this.sizeMarkEditor={width:200,height:800},this.checkInputActive=!1,this.objectResult={},this.hasAttachmentFile=!1,this.heightEditor=300,this.handleIframe=d=>{"MNoteJson"==d.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=d.data.data,this.uploadAll(this.mnoteJsonData.pages??[],d.data.data.point)),"MNoteReSubmit"==d.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==d.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId&&this.sendDataToMarkNote()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){document.body.style.overflowY="auto",window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(a=f).\u0275fac=function(s){return new(s||a)(e.rXU(S.nX),e.rXU(F._t),e.rXU(ae.p),e.rXU(G.i),e.rXU(oe.c),e.rXU(B.j),e.rXU(ne.T),e.rXU(e.c1b))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-mark-exercise-new"]],viewQuery:function(s,t){if(1&s&&e.GBs($e,5),2&s){let i;e.mGM(i=e.lsd())&&(t.MarkNote=i.first)}},hostBindings:function(s,t){1&s&&e.bIt("resize",function(l){return t.onResize(l)},!1,e.tSv)},features:[e.Vt3],decls:55,vars:45,consts:[["notMark",""],["aztMarkNote",""],[1,"content",2,"padding","0 12px"],[1,"grid","grid-cols-12","gap-3","mt-3"],[1,"col-span-12","md:col-span-8","mark-editor",3,"ngStyle"],[4,"ngIf"],["class","w-full",4,"ngIf"],["id","mark-general",1,"col-span-12","md:col-span-4","mark-general"],["id","mark-general-box",1,"box"],[1,"p-2"],[1,"box-head"],[1,"font-medium"],[1,"flex","items-center","mt-2"],[1,"info-student","flex","items-center"],[3,"nameCreateAvatar","size"],[1,"info","ml-2"],[1,"text-md"],[1,"text-xs"],[1,"score","ml-auto","flex","items-center"],["appOnlyNumber","","type","text","id","azt-score",1,"form-control","text-danger","font-medium",3,"input","decimal","max","value","placeholder"],[1,"bg-slate-200","dark:bg-darkmode-400","p-2","text-center","rounded","mt-3"],[4,"ngIf","ngIfElse"],[1,"choose-score","mt-3"],[1,"score-list-one","grid","grid-cols-10","gap-3"],["class","score-item col-span-2",4,"ngFor","ngForOf"],[1,"comment","mt-3"],[1,"font-medium","text-md"],[1,"comment-editor","mt-2"],[3,"ngModelChange","apiKey","ngModel","init"],[1,"flex","items-center","mt-3"],[1,"form-check","form-switch"],["id","show-score","type","checkbox",1,"form-check-input","mr-2",3,"ngModelChange","ngModel"],["for","show-score",1,"form-check-label","ml-0"],[1,"ml-auto"],["azt-track-service","mark-exercise-new-yWLPF_cK9E",1,"btn","btn-pending",3,"click","disabled"],[1,"grid","grid-cols-2","gap-3","mt-3"],["azt-track-service","mark-exercise-new-xgpK5bMM5y",1,"btn","btn-secondary",3,"click"],["azt-track-service","mark-exercise-new-lNij5J4UCD",1,"btn","btn-primary",3,"click","disabled"],["class","mr-1",4,"ngIf"],[3,"handleBackLink","doneLoadData","markData","getIdHistory","dataMarkNote","showBackLink","markedByObj","historyAnswerObjs"],[1,"w-full"],["azt-track-service","mark-exercise-new-KdZ2FWuCn",1,"btn","btn-transparent",3,"click"],["name","chevron-left","size","20"],[1,"azt-hidden","sm:block"],[1,"text-center","mx-auto"],["type","book",3,"size"],[1,"font-medium","mt-5"],[1,"score-item","col-span-2"],["azt-track-service","mark-exercise-new-YBVZ7xc_A",1,"border","border-slate-200","dark:border-darkmode-400","btn-score","btn",3,"click"],[1,"mr-1"]],template:function(s,t){if(1&s){const i=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4),e.DNE(3,Ue,3,4,"ng-container",5)(4,Ve,11,7,"div",6),e.k0s(),e.j41(5,"div",7)(6,"div",8)(7,"div",9)(8,"div",10)(9,"h3",11),e.EFF(10),e.k0s(),e.j41(11,"div",12)(12,"div",13),e.nrm(13,"azt-create-avatar",14),e.j41(14,"div",15)(15,"p",16),e.EFF(16),e.k0s(),e.j41(17,"p",17),e.EFF(18),e.k0s()()(),e.j41(19,"div",18)(20,"input",19),e.nI1(21,"mytranslate"),e.bIt("input",function(u){return e.eBV(i),e.Njj(t.setPointInput(u))}),e.k0s()()()(),e.j41(22,"div",20),e.DNE(23,Je,4,8,"span",21)(24,We,3,3,"ng-template",null,0,e.C5r),e.k0s(),e.j41(26,"div",22)(27,"div",23),e.DNE(28,Xe,3,1,"div",24),e.k0s()(),e.j41(29,"div",25)(30,"p",26),e.EFF(31),e.nI1(32,"mytranslate"),e.k0s(),e.j41(33,"div",27)(34,"editor",28),e.nI1(35,"getTinyMceKey"),e.nI1(36,"getTinyMceConfigForTeacherHomework"),e.mxI("ngModelChange",function(u){return e.eBV(i),e.DH7(t.commentExercise,u)||(t.commentExercise=u),e.Njj(u)}),e.k0s()()(),e.j41(37,"div",29)(38,"div",30)(39,"input",31),e.mxI("ngModelChange",function(u){return e.eBV(i),e.DH7(t.showPoint,u)||(t.showPoint=u),e.Njj(u)}),e.k0s(),e.j41(40,"label",32),e.EFF(41),e.nI1(42,"mytranslate"),e.k0s()(),e.j41(43,"div",33)(44,"button",34),e.bIt("click",function(){return e.eBV(i),e.Njj(t.handleOpenReSubmit())}),e.EFF(45),e.nI1(46,"mytranslate"),e.k0s()()(),e.j41(47,"div",35)(48,"button",36),e.bIt("click",function(){return e.eBV(i),e.Njj(t.goBack())}),e.EFF(49),e.nI1(50,"mytranslate"),e.k0s(),e.j41(51,"button",37),e.bIt("click",function(){return e.eBV(i),e.Njj(t.saveDataMarkExercise())}),e.DNE(52,Ye,1,0,"azt-loading-ui",38),e.EFF(53),e.nI1(54,"mytranslate"),e.k0s()()()()()()()}if(2&s){const i=e.sdS(25);e.R7$(2),e.Y8G("ngStyle",e.eq3(43,Ge,t.sizeMarkEditor.height+"px")),e.R7$(),e.Y8G("ngIf",t.dataMarkNote.answer_obj),e.R7$(),e.Y8G("ngIf",!t.dataMarkNote||!t.dataMarkNote.answer_obj),e.R7$(6),e.SpI(" ",null==t.homeworkObj?null:t.homeworkObj.name," "),e.R7$(3),e.Y8G("nameCreateAvatar",null==t.studentObj?null:t.studentObj.fullName)("size",35),e.R7$(3),e.SpI(" ",null==t.studentObj?null:t.studentObj.fullName," "),e.R7$(2),e.SpI(" ",null==t.classroomObj?null:t.classroomObj.name," "),e.R7$(2),e.FS9("placeholder",e.bMT(21,27,"lang_auto_nhap_diem")),e.Y8G("decimal",!0)("max",999)("value",t.pointExercise.name),e.R7$(3),e.Y8G("ngIf",t.markData.totalRight||t.markData.totalWrong)("ngIfElse",i),e.R7$(5),e.Y8G("ngForOf",t.listPointAzt),e.R7$(3),e.SpI(" ",e.bMT(32,29,"lang_auto_nhan_xet")," "),e.R7$(3),e.FS9("apiKey",e.bMT(35,31,"")),e.R50("ngModel",t.commentExercise),e.Y8G("init",e.bMT(36,33,t.heightEditor)),e.R7$(5),e.R50("ngModel",t.showPoint),e.R7$(2),e.SpI(" ",e.bMT(42,35,"lang_auto_hien_thi_diem")," "),e.R7$(3),e.Y8G("disabled",""!==t.historyId),e.R7$(),e.SpI(" ",e.bMT(46,37,"lang_auto_yeu_cau_nop_lai")," "),e.R7$(4),e.SpI(" ",e.bMT(50,39,"lang_auto_quay_lai")," "),e.R7$(2),e.Y8G("disabled",t.loadingSaveData||""!==t.historyId||""==t.pointExercise.name||t.loadingDataCdn),e.R7$(),e.Y8G("ngIf",t.loadingSaveData),e.R7$(),e.SpI(" ",e.bMT(54,41,"lang_auto_luu_du_lieu")," ")}},dependencies:[I.Sq,I.bT,I.B3,O.xn,p.Zm,p.BC,p.vS,re.p,ze.Z,te.R,Le.m,Be.i,j.WGl,N.wp,N.uL,N.yc],styles:[".btn-score[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.btn-score[_ngcontent-%COMP%]:hover{background:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}.choose-score[_ngcontent-%COMP%]{max-width:80%;margin-left:auto;margin-right:auto}.toolbar-list[_ngcontent-%COMP%]{width:100%;padding:5px;position:absolute;top:0;left:0;display:flex;align-items:center;border-bottom-left-radius:0;border-bottom-right-radius:0}.btn-icon[_ngcontent-%COMP%]{padding:10px;min-width:auto;line-height:initial}.toolbar-item[_ngcontent-%COMP%]{margin:0 3px}.toolbar-item[_ngcontent-%COMP%]:first-child{margin-left:0}.btn-icon-child[_ngcontent-%COMP%]{padding:5px}.azt-toolbar-active[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}  .dark .azt-toolbar-active{--tw-bg-opacity: 1;background-color:rgb(var(--color-darkmode-200)/var(--tw-bg-opacity))}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}@media screen and (max-width: 768px){.choose-score[_ngcontent-%COMP%]{max-width:80%}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}.content[_ngcontent-%COMP%]{margin-bottom:100px}}#mark-general-box[_ngcontent-%COMP%]{height:calc(100vh - 24px);overflow:auto}@media screen and (max-width: 768px){#mark-general-box[_ngcontent-%COMP%]{position:relative;min-height:100vh;height:auto;overflow:hidden}}"]}),f})();var le=n(55465),ce=n(17818),Qe=n(47712);function Ze(a,f){if(1&a&&(e.j41(0,"button",16),e.nI1(1,"mytranslate"),e.nrm(2,"lucide-icon",17),e.k0s()),2&a){e.XpG();const r=e.sdS(8);e.FS9("matTooltip",e.bMT(1,2,"lang_homework_mark_exercise_history_submit")),e.Y8G("matMenuTriggerFor",r)}}function qe(a,f){if(1&a){const r=e.RV6();e.j41(0,"li")(1,"button",18),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.getDataHistory(t.id?t.id.toString():""))}),e.j41(2,"span"),e.EFF(3),e.nI1(4,"mytranslate"),e.nI1(5,"formatFullDateTimeWithoutSecondByUserUnitPipe"),e.k0s()()()}if(2&a){const r=f.$implicit,s=f.index;e.R7$(3),e.E5c("",e.bMT(4,3,"lang_homework_mark_exercise_times")," ",s+1," - ",e.bMT(5,5,r.createdAt),"")}}function et(a,f){if(1&a&&(e.j41(0,"span"),e.nrm(1,"azt-create-avatar",20),e.nI1(2,"mytranslate"),e.k0s()),2&a){const r=e.XpG(2);e.R7$(),e.Y8G("customTooltip",e.bMT(2,4,"lang_homework_mark_exercise_teacher_mark")+": "+(null==r.markedByObj?null:r.markedByObj.fullName))("nameCreateAvatar",null==r.markedByObj?null:r.markedByObj.fullName)("size",25)("linkAvatar",null==r.markedByObj?null:r.markedByObj.avatar)}}function tt(a,f){if(1&a&&(e.j41(0,"h4",19),e.DNE(1,et,3,6,"span",14),e.EFF(2),e.k0s()),2&a){const r=e.XpG();e.R7$(),e.Y8G("ngIf",r.isMarked),e.R7$(),e.Lme(" ",null==r.studentObj?null:r.studentObj.fullName,", ",r.classroomObj.name," ")}}function st(a,f){if(1&a&&(e.nrm(0,"azt-loading-effect",21),e.nI1(1,"mytranslate")),2&a){const r=e.XpG();e.Y8G("currentStatusObj",r.statusObj)("customText",e.bMT(1,2,"lang_homework_mark_exercise_loading_data_mark"))}}function it(a,f){if(1&a&&(e.j41(0,"div")(1,"div",22)(2,"div",23)(3,"div",24),e.EFF(4),e.nI1(5,"mytranslate"),e.k0s()()()()),2&a){const r=e.XpG();e.R7$(4),e.JRh(e.bMT(5,1,r.errorMessage))}}function at(a,f){if(1&a&&(e.j41(0,"div",25),e.nrm(1,"iframe",26),e.nI1(2,"safe"),e.k0s()),2&a){const r=e.XpG();e.R7$(),e.Y8G("src",e.bMT(2,1,r.whiteListMNoteIframeSrc),e.f$h)}}let ot=(()=>{var a;class f extends L.H{onPopState(s){this.goBack()}uploadDrawBase64ToCDN(s,t,i){let l=(0,V.q)(s);this.apiUploadService.commonUploadForMarkResult(l,`essay_note_${t}_${this.answerId}.png`,"image/png").subscribe(u=>{u.type!=U.hv.UploadProgress&&(1==u.success?(this.mnoteJsonData.pages?.[t]&&(this.mnoteJsonData.pages[t].draw=u.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,i,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(s,t){this.pagesCount=0;for(let i=0;i<s.length;i++)s[i].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,t,this.mnoteJsonData);else for(let i=0;i<s.length;i++)s[i].draw&&this.uploadDrawBase64ToCDN(s[i].draw,i,t)}reloadPage(){location.reload()}sendDataToIframe(){const s=document.getElementById("mNote"),t=s?s.contentWindow:null;if(null!==t){let i=this.castObj(this.result.answerObj);if(null!=i){let c=this.commonService.willDeleteParseJson(i.result??"");if(null!=c){let w=c.pages?.length??0;for(let E=0;E<w;E++)c?.pages?.[E].backgroundImage&&(c.pages[E].backgroundImage=this.sAztCommonCdnService.getMyCdn(c.pages[E].backgroundImage??"")),c.pages?.[E].draw&&(c.pages[E].draw=this.sAztCommonCdnService.getMyCdn(c.pages[E].draw));c=JSON.stringify(c),i.result=c}let d=this.commonService.willDeleteParseJson(i.files??"");if(null!=d){for(let w=0;w<d.length;w++)d[w].url&&(d[w].url=this.sAztCommonCdnService.getMyCdn(d[w].url)),d[w].thumb&&(d[w].thumb=this.sAztCommonCdnService.getMyCdn(d[w].thumb));d=JSON.stringify(d),i.files=d}}let l=this.result.studentObj,u=this.result.classroomObj,m=this.result.homeworkObj,g=this.commonService.myParseJson(i?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let c=0;c<(this.jsonData.pages?.length??0);c++)this.jsonData.pages?.[c].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[c].backgroundImage=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[c].backgroundImage??"")),this.jsonData.pages?.[c].hasOwnProperty("draw")&&(this.jsonData.pages[c].draw=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[c].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=i,this.jsonData.student_obj=l,this.jsonData.classroom_obj=u,this.jsonData.homework_obj=m,g&&g.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=g.hideMark),t.postMessage(this.jsonData,"*");else{let c=[];this.files.forEach(w=>{c.push({backgroundImage:w.url})});let d={cmd:"initMNote",mode:"edit",pages:c,answer_obj:i,student_obj:l,classroom_obj:u,homework_obj:m};g&&g.hasOwnProperty("hideMark")&&(d.hideMark=g.hideMark),t.postMessage(d,"*")}}}sendDataToIframeHistory(){const s=document.getElementById("mNote");s&&1==this.countLoad&&(s.src+="");const t=s?s.contentWindow:null;if(null!==t){let i=this.castObj(this.result.answerObj);if(null!=i){let c=this.commonService.willDeleteParseJson(i?.result??"");if(null!=c){for(let w=0;w<c.pages.length;w++)c.pages[w].backgroundImage&&(c.pages[w].backgroundImage=this.sAztCommonCdnService.getMyCdn(c.pages[w].backgroundImage)),c.pages[w].draw&&(c.pages[w].draw=this.sAztCommonCdnService.getMyCdn(c.pages[w].draw));c=JSON.stringify(c),i.result=c}let d=this.commonService.willDeleteParseJson(i.files??"");if(null!=d){for(let w=0;w<d.length;w++)d[w].url&&(d[w].url=this.sAztCommonCdnService.getMyCdn(d[w].url)),d[w].thumb&&(d[w].thumb=this.sAztCommonCdnService.getMyCdn(d[w].thumb));d=JSON.stringify(d),i.files=d}}let l=this.studentObj,u=this.classroomObj,m=this.homeworkObj,g=this.commonService.willDeleteParseJson(i?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let c=0;c<(this.jsonData.pages?.length??0);c++)this.jsonData.pages?.[c].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[c].backgroundImage=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[c].backgroundImage??"")),this.jsonData.pages?.[c].hasOwnProperty("draw")&&(this.jsonData.pages[c].draw=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[c].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="view",this.jsonData.answer_obj=i,this.jsonData.student_obj=l,this.jsonData.classroom_obj=u,this.jsonData.homework_obj=m,g&&g.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=g.hideMark),t.postMessage(this.jsonData,"*");else{let c=[];this.files.forEach(w=>{c.push({backgroundImage:w.url})});let d={cmd:"initMNote",mode:"view",pages:c,answer_obj:i,student_obj:l,classroom_obj:u,homework_obj:m};g&&g.hasOwnProperty("hideMark")&&(d.hideMark=g.hideMark),t.postMessage(d,"*")}}}getHistoryObjs(s){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,s).subscribe(t=>{1==t.success?this.historyAnswerObjs=t.data?.objs??new Array:this.errorMessage=t.message??"",this.stopStatusObj()})}getDataHistory(s){this.historyId=s,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(s,10)).subscribe(t=>{if(1==t.success){if(t.data){if(this.zipDataService.convertSubmittedAnswersHistoryObj(t.data?.answerObj),this.result=t.data,this.markedByObj=t.data?.markedByObj,this.score=t.data?.answerObj?.point??0,this.files=this.commonService.myParseJson(t.data?.answerObj?.files??"")??[],null!=this.files)for(let i=0;i<this.files.length;i++)this.files[i].url=this.sAztCommonCdnService.getMyCdn(this.files?.[i].url??""),this.files[i].thumb=this.sAztCommonCdnService.getMyCdn(this.files?.[i].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,1==this.countLoad&&(this.hasSendDataToIframe=!1),0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframeHistory())}this.successStatusObj(),this.countLoad++}else this.errorMessage=t.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var s=this.commonService.myParseJson(this.result.answerObj?.result??"");s&&(this.jsonData=s,null==this.jsonData&&(this.isMarked=!1))}}getStudentObj(s){this.initStatusObj(),this.errorMessage="",this.answerService.apiAnswerGetStudentInfoObjGet(this.homeworkHashId,s).subscribe(t=>{1==t.success&&t.data?(this.studentObj=t.data.studentObj,this.errorMessage="lang_auto_chua_nop_bai",this.successStatusObj()):(this.errorMessage="lang_core_not_found_student",this.stopStatusObj())})}getData(s){this.initStatusObj(),this.errorMessage="",this.answerId=s,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,s).subscribe(t=>{if(1==t.success)if(this.zipDataService.convertSubmittedAnswersObj(t.data?.answerObj),t.data?.hasOwnProperty("studentObj")&&null!=t.data?.studentObj){if(this.result=t.data,this.markedByObj=t.data.markedByObj,this.score=t.data?.answerObj?.point??0,this.homeworkID=t.data.homeworkObj?.id??0,this.classID=t.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(t.data.answerObj?.files??"")??[],this.studentObj=t.data.studentObj,this.classroomObj=t.data.classroomObj??{},null!=this.files)for(let i=0;i<this.files.length;i++)this.files[i].url=this.sAztCommonCdnService.getMyCdn(this.files?.[i].url??""),this.files[i].thumb=this.sAztCommonCdnService.getMyCdn(this.files?.[i].thumb??"");this.homeworkObj=t.data.homeworkObj??{},this.studentName=t.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframe()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=t.message??"",this.stopStatusObj()})}openDialog(s,t){this.sAztDialogService.open(ie,{width:"280px",autoFocus:!1,data:{score:t,status:s,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(l=>{})}handleOpenReSubmit(){null!=this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(s,t,i,l,u){let m={status:s,deadline:t,itemHomework:i,ans_id:l,name:u,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.sAztDialogService.open(se,{width:"380px",panelClass:"cleanResultDialogBox",data:m,restoreFocus:!1}).afterClosed().subscribe(c=>{if(c&&c.result&&c.isRedirect){let d="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+m.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+m.classID+"/"+m.itemHomework.id+"/"+this.homeworkHashId,d)}})}remark(s,t,i){let l=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj)){let u={id:s,comment:i.comment,hideMark:i.hideMark?1:0,point:t?parseFloat(t.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(i)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(l,u).subscribe(m=>{1==m.success?(this.openDialog(!0,m.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId);let s=document.body,t=document.getElementById("azota-app-html");t?.classList.remove("overflow-hidden"),t?.classList.remove("height-100"),s.classList.remove("overflow-hidden"),s.classList.remove("height-100")}ngOnInit(){let s=document.body,t=document.getElementById("azota-app-html");t?.classList.add("overflow-hidden"),t?.classList.add("height-100"),s.classList.add("overflow-hidden"),s.classList.add("height-100"),this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";const i=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),l=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0),u=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let m=this.commonService.getMyQueryParam("backto");this.backToLink=m?m.includes("shareType")?decodeURIComponent(m):m:"",i?(this.getData(i),this.getHistoryObjs(i)):this.getStudentObj(l),u&&this.getDataHistory(u),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(s,t,i,l,u,m,g,c){super(),this.activeRoute=s,this.answerService=t,this.permissionService=i,this.sAztDialogService=l,this.sAztCommonCdnService=u,this.zipDataService=m,this.envService=g,this.apiUploadService=c,this.answerId=0,this.homeworkID="",this.historyId="",this.whiteListMNoteIframeSrc="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.handleIframe=d=>{"MNoteJson"==d.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=d.data.data,this.uploadAll(this.mnoteJsonData.pages??[],d.data.data.point)),"MNoteReSubmit"==d.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==d.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId?this.sendDataToIframe():this.sendDataToIframeHistory()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(a=f).\u0275fac=function(s){return new(s||a)(e.rXU(S.nX),e.rXU(F._t),e.rXU(ae.p),e.rXU(G.i),e.rXU(oe.c),e.rXU(B.j),e.rXU(le.t),e.rXU(ne.T))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-mark-exericse"]],hostBindings:function(s,t){1&s&&e.bIt("popstate",function(l){return t.onPopState(l)},!1,e.tSv)},features:[e.Vt3],decls:22,vars:13,consts:[["menu","matMenu"],["id","markContainer",1,"maxW1000"],["id","titleRow"],[1,"block-left"],[1,"btn","btn-sm","btn-outline-secondary","border-none","border-0",3,"click","matTooltip"],["name","chevron-left","size","24"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],[1,"dropdown-menu","w-56","show","relative"],[1,"dropdown-content"],["azt-track-service","mark-exercise-7krhNQm3da",1,"dropdown-item","w-full",3,"click"],[4,"ngFor","ngForOf"],["class","studentInfo","style","padding-right: 10px; color: #fff",4,"ngIf"],[3,"currentStatusObj","customText",4,"ngIf"],[3,"hidden"],[4,"ngIf"],["class","card-box listPhotos",4,"ngIf"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor"],["name","history","size","24"],["azt-track-service","mark-exercise-5mJpoIUV_A",1,"dropdown-item","w-full",3,"click"],[1,"studentInfo",2,"padding-right","10px","color","#fff"],[2,"cursor","pointer",3,"customTooltip","nameCreateAvatar","size","linkAvatar"],[3,"currentStatusObj","customText"],[1,"row","justify-content-center","py-5"],[1,"col-12","text-center"],[1,"alert","alert-danger"],[1,"card-box","listPhotos"],["id","mNote","frameborder","0",2,"width","100%","height","100%",3,"src"]],template:function(s,t){if(1&s){const i=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),e.nI1(4,"mytranslate"),e.bIt("click",function(){return e.eBV(i),e.Njj(t.goBack())}),e.nrm(5,"lucide-icon",5),e.k0s(),e.DNE(6,Ze,3,4,"button",6),e.j41(7,"mat-menu",null,0)(9,"div",7)(10,"ul",8)(11,"li")(12,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(t.reloadPage())}),e.j41(13,"span"),e.EFF(14),e.nI1(15,"mytranslate"),e.k0s()()(),e.DNE(16,qe,6,7,"li",10),e.k0s()()()(),e.DNE(17,tt,3,3,"h4",11),e.k0s(),e.DNE(18,st,2,4,"azt-loading-effect",12),e.j41(19,"div",13),e.DNE(20,it,6,3,"div",14)(21,at,3,3,"div",15),e.k0s()()}2&s&&(e.R7$(3),e.FS9("matTooltip",e.bMT(4,9,"lang_button_back")),e.R7$(3),e.Y8G("ngIf",null!=t.historyAnswerObjs&&t.historyAnswerObjs.length>0),e.R7$(8),e.JRh(e.bMT(15,11,"lang_homework_mark_exercise_last")),e.R7$(2),e.Y8G("ngForOf",t.historyAnswerObjs),e.R7$(),e.Y8G("ngIf",t.classroomObj),e.R7$(),e.Y8G("ngIf",t.statusObj.loading),e.R7$(),e.Y8G("hidden",t.statusObj.loading),e.R7$(),e.Y8G("ngIf",""!=t.errorMessage),e.R7$(),e.Y8G("ngIf",""==t.errorMessage))},dependencies:[I.Sq,I.bT,X.iY,ce.kk,ce.Cp,Qe.oV,K.K,re.p,j.WGl,N.wp,N.JI,N.bH],styles:["#markContainer[_ngcontent-%COMP%]{position:relative}  .studentInfo img{display:inline-flex!important}#titleRow[_ngcontent-%COMP%]{background-color:#00a7d0;height:40px;position:relative;align-items:center;display:flex;justify-content:space-between;color:#fff}#titleRow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}#titleRow[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:0;font-weight:500;font-size:16px;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;display:-webkit-box}#titleRow[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]{margin-right:5px}.block-left[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{border:none}.listPhotos[_ngcontent-%COMP%]{width:100%;position:fixed;top:40px;bottom:0}.file[_ngcontent-%COMP%]{border-width:0px;background:inherit;background-color:#f2f2f2;box-sizing:border-box;border-width:1px;border-style:solid;border-color:#e5e5e5;border-left:0px;border-right:0px;border-radius:0;box-shadow:none}.file[_ngcontent-%COMP%]:first-child{margin-top:52px}.file[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.back[_ngcontent-%COMP%]{padding:15px 10px}.back-to[_ngcontent-%COMP%]{color:#fff;display:flex}.back-to[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:10px}.block[_ngcontent-%COMP%]{padding-top:2px}.mat-expansion-indicator[_ngcontent-%COMP%]:after{color:#fff!important}.add-click[_ngcontent-%COMP%]{display:flex}.add-icon[_ngcontent-%COMP%]{margin-top:5px}.file-custom[_ngcontent-%COMP%]{margin-top:6px}.description__share[_ngcontent-%COMP%]{margin-top:10px}.description__share[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff;color:#666;margin-right:15px;padding:5px 10px 0}.row-check[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:10px 0}.col-check[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:5px}.exercise[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:25px 0 15px;border-bottom:1px solid #eee}.btn-custom[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff;border-radius:5px;padding:10px 25px}.files-custom[_ngcontent-%COMP%]{margin:0}.btn-share[_ngcontent-%COMP%]{border:1px solid #eee}.score-exercise[_ngcontent-%COMP%]{background-color:#ea3d19;border-radius:50%;padding:3px 5px 3px 7px;color:#fff;font-weight:600;margin:0 10px}#listNumber[_ngcontent-%COMP%]{display:contents}#markNumber[_ngcontent-%COMP%]{position:absolute;top:40px;right:50%;z-index:9;margin-right:-60px;color:#fff;text-transform:uppercase;width:120px}@media (min-width: 1000px){.mark-edit[_ngcontent-%COMP%]{width:250px}.file[_ngcontent-%COMP%]:first-child{margin-top:0}.listPhotos[_ngcontent-%COMP%]{width:1000px}}"]}),f})();const lt=[{path:"",component:(()=>{var a;class f extends L.H{}return(a=f).\u0275fac=(()=>{let r;return function(t){return(r||(r=e.xGo(a)))(t||a)}})(),a.\u0275cmp=e.VBU({type:a,selectors:[["homework-master-page"]],features:[e.Vt3],decls:2,vars:0,consts:[["id","homework-layout"]],template:function(s,t){1&s&&(e.j41(0,"div",0),e.nrm(1,"router-outlet"),e.k0s())},dependencies:[S.n3],encapsulation:2}),f})(),canActivate:[x.t],children:[{path:"add-new-homework/:cat_id",component:Ae},{path:"mark-exercise/:id/:hash_id/:studentId",component:ot},{path:"switch-mark-exercise/:id/:hash_id/:studentId",component:(()=>{var a;class f extends L.H{getData(s){this.initStatusObj(),this.answerService.apiAnswerGetObjGet(this.homeworkHashId,s).subscribe(t=>{if(1==t.success)if(this.zipDataService.convertSubmittedAnswersObj(t.data?.answerObj),null!=t.data?.studentObj){const i=t.data,l=this.envService.getVersionMarkNote(this.classliveUrl);i.answerObj?.result?(i.answerObj?.result??"").includes("urlDataMark")?this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/${i.answerObj?.id??0}/${this.homeworkHashId}/${t.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise/${i.answerObj?.id??0}/${this.homeworkHashId}/${t.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(l>1e6?`/admin/homework/mark-exercise-new/${i.answerObj?.id??0}/${this.homeworkHashId}/${t.data?.studentObj.id??0}`:`/admin/homework/mark-exercise/${i.answerObj?.id??0}/${this.homeworkHashId}/${t.data?.studentObj.id??0}`,`?backto=${encodeURIComponent(this.backToLink)}`),this.successStatusObj()}else this.stopStatusObj();else this.stopStatusObj()})}ngOnInit(){this.classliveUrl=this.envService.getEnvValue("classliveUrl")??"",this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";const s=Number(this.commonService.getMyParam(this.activeRoute,"id")??0),t=Number(this.commonService.getMyParam(this.activeRoute,"studentId")??0);let i=this.commonService.getMyQueryParam("backto");this.backToLink=i?i.includes("shareType")?decodeURIComponent(i):i:"",s?this.getData(s):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/0/${this.homeworkHashId}/${t}`,`?backto=${encodeURIComponent(this.backToLink)}`),super.ngOnInit()}constructor(s,t,i,l){super(),this.activeRoute=s,this.answerService=t,this.zipDataService=i,this.envService=l,this.homeworkHashId="",this.backToLink="",this.classliveUrl=""}}return(a=f).\u0275fac=function(s){return new(s||a)(e.rXU(S.nX),e.rXU(F._t),e.rXU(B.j),e.rXU(le.t))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-mark-exercise-new"]],features:[e.Vt3],decls:0,vars:0,template:function(s,t){},encapsulation:2}),f})()},{path:"mark-exercise-new/:id/:hash_id/:studentId",component:Ke}]}];let ct=(()=>{var a;class f{}return(a=f).\u0275fac=function(s){return new(s||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[S.iI.forChild(lt),S.iI,k.XE]}),f})(),mt=(()=>{var a;class f{}return(a=f).\u0275fac=function(s){return new(s||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({providers:[{provide:O.vn,useValue:o.c.azt_tiny_mce_script_src}],imports:[C.Id,S.iI,I.MD,T.s,O.sv,ct,p.YN,p.X1,M.hM,_.L,y.Lk,b.Q,h.b,v.n,j.flO.pick(j.Ptg)]}),f})()},99503:(A,R,n)=>{"use strict";n.d(R,{fb:()=>_,ij:()=>y});var I=n(81519),p=n(48891),M=n(20381),S=n.n(M),O=n(53793);const j=S()||M,y=new p.nKC("MAT_MOMENT_DATE_ADAPTER_OPTIONS",{providedIn:"root",factory:function C(){return{useUtc:!1}}});function T(h,v){const b=Array(h);for(let o=0;o<h;o++)b[o]=v(o);return b}let _=(()=>{var h;class v extends I.$O{constructor(o){super(),this._options=o,this.commonService=(0,p.WQX)(O.R),this._localeData={firstDayOfWeek:0,longMonths:"",shortMonths:"",dates:"",longDaysOfWeek:"",shortDaysOfWeek:"",narrowDaysOfWeek:""},j.locale(),this.setLocale(this.commonService.getCurrentLang()||j.locale())}setLocale(o){super.setLocale(o);const k=j.localeData(o);this._localeData={firstDayOfWeek:k.firstDayOfWeek(),longMonths:k.months(),shortMonths:k.monthsShort(),dates:T(31,x=>this.createDate(2017,0,x+1).format("D")),longDaysOfWeek:k.weekdays(),shortDaysOfWeek:k.weekdaysShort(),narrowDaysOfWeek:k.weekdaysMin()}}getYear(o){return this.clone(o).year()}getMonth(o){return this.clone(o).month()}getDate(o){return this.clone(o).date()}getDayOfWeek(o){return this.clone(o).day()}getMonthNames(o){return"long"===o?this._localeData.longMonths:this._localeData.shortMonths}getDateNames(){return this._localeData.dates}getDayOfWeekNames(o){return"long"===o?this._localeData.longDaysOfWeek:"short"===o?this._localeData.shortDaysOfWeek:this._localeData.narrowDaysOfWeek}getYearName(o){return this.clone(o).format("YYYY")}getFirstDayOfWeek(){return this._localeData.firstDayOfWeek}getNumDaysInMonth(o){return this.clone(o).daysInMonth()}clone(o){return o.clone().locale(this.locale)}createDate(o,k,x){if(k<0||k>11)throw Error(`Invalid month index "${k}". Month index has to be between 0 and 11.`);if(x<1)throw Error(`Invalid date "${x}". Date has to be greater than 0.`);const D=this._createMoment({year:o,month:k,date:x}).locale(this.locale);if(!D.isValid())throw Error(`Invalid date "${x}" for month with index "${k}".`);return D}today(){return this._createMoment().locale(this.locale)}parse(o,k){return o&&"string"==typeof o?this._createMoment(o,k,this.locale):o?this._createMoment(o).locale(this.locale):null}format(o,k){if(o=this.clone(o),!this.isValid(o))throw Error("MomentDateAdapter: Cannot format invalid date.");return o.format(k)}addCalendarYears(o,k){return this.clone(o).add({years:k})}addCalendarMonths(o,k){return this.clone(o).add({months:k})}addCalendarDays(o,k){return this.clone(o).add({days:k})}toIso8601(o){return this.clone(o).format()}deserialize(o){let k;if(o instanceof Date)k=this._createMoment(o).locale(this.locale);else if(this.isDateInstance(o))return this.clone(o);if("string"==typeof o){if(!o)return null;k=this._createMoment(o,j.ISO_8601).locale(this.locale)}return k&&this.isValid(k)?this._createMoment(k).locale(this.locale):super.deserialize(o)}isDateInstance(o){return j.isMoment(o)}isValid(o){return this.clone(o).isValid()}invalid(){return j.invalid()}getHour(o){return o.hours()}getMinute(o){return o.minutes()}getSecond(o){return o.seconds()}setHour(o,k){o.hours(k)}setMinute(o,k){o.minutes(k)}setSecond(o,k){o.seconds(k)}_createMoment(o,k,x){const{strict:D,useUtc:H}=this._options||{};return H?j.utc(o,k,x,D):j(o,k,x,D)}}return(h=v).\u0275fac=function(o){return new(o||h)(p.KVO(y,8))},h.\u0275prov=p.jDH({token:h,factory:h.\u0275fac}),v})()},10296:(A,R,n)=>{"use strict";n.d(R,{R:()=>y});var I=n(43277),M=n(18148),S=n(48891),O=n(52509),j=n(53793);let y=(()=>{var C;class T{constructor(h,v){this.mobileWebviewService=h,this.commonService=v}shareFileWithBlob(h,v){if(this.commonService.businessIdCanvasLMSCloudView(void 0)>0)return I.saveAs(h,v);if(this.commonService.isMobileWebview(void 0)){M.L.openLoadingEffect(this.commonService.myTranslateInstant("lang_auto_dang_lay_du_lieu_tu_he_thong")??"");let b=new FileReader;b.readAsDataURL(h),b.onloadend=()=>{let o=b.result;"string"==typeof o&&(this.mobileWebviewService.sendShareFileBase64(v,String(o)),M.L.closeLoadingEffect(100))}}else I.saveAs(h,v)}shareFileWithBase64(h,v){if(this.commonService.businessIdCanvasLMSCloudView(void 0)>0)return I.saveAs(h,v);this.commonService.isMobileWebview(void 0)?this.mobileWebviewService.sendShareFileBase64(v,h):I.saveAs(h,v)}}return(C=T).\u0275fac=function(h){return new(h||C)(S.KVO(O.f),S.KVO(j.R))},C.\u0275prov=S.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),T})()},74151:(A,R,n)=>{"use strict";n.d(R,{n:()=>M});var I=n(48891),p=n(53793);let M=(()=>{var S;class O{resizeDrawerHeight(y,C){if(this.autoResizeHeight=y,this.drawer=C,this.drawer&&this.autoResizeHeight){let T=()=>{let v=document.querySelector(".azt-drawer-content"),b=document.querySelector(".azt-draw-left");if(b&&b instanceof HTMLElement&&v&&v instanceof HTMLElement){let o=v;o.style.minHeight=this.isOpenSideNav?b.clientHeight+10+"px":"auto"}},_=new ResizeObserver(v=>{T()}),h=document.querySelector(".azt-draw-left");h&&_.observe(h),T()}}openDrawer(){this.drawer?.open(),this.isOpenSideNav=!0}closeDrawer(){this.drawer?.close(),this.isOpenSideNav=!1}toggleDrawer(){this.drawer?.toggle(),this.isOpenSideNav=!this.isOpenSideNav}openedChange(y){this.isOpenSideNav=y,this.resizeDrawerHeight(this.autoResizeHeight)}changeToMobileMode(y){y?(this.mode="over",this.hasBackdrop=!0):(this.mode="side",this.hasBackdrop=!1)}constructor(y){this.commonService=y,this.hasBackdrop=!!this.commonService.isMobileOrTable(),this.mode=this.commonService.isMobileOrTable()?"over":"side",this.isShowActions=(this.commonService.isMobileOrTable(),!0),this.isOpenSideNav=!this.commonService.isMobileOrTable(),this.autoResizeHeight=!1}}return(S=O).\u0275fac=function(y){return new(y||S)(I.KVO(p.R))},S.\u0275prov=I.jDH({token:S,factory:S.\u0275fac,providedIn:null}),O})()},18148:(A,R,n)=>{"use strict";n.d(R,{L:()=>I});let I=(()=>{var p;class M{static openLoadingEffect(O){M.getDomElement().style.display="flex",setTimeout(()=>{M.changeMsgLoadingEffect(O)},50)}static closeLoadingEffect(O){return new Promise(j=>{setTimeout(()=>{const y=M.getDomElement();y&&(y.style.display="none"),j(!0)},O)})}static changeMsgLoadingEffect(O){M.getDomContent().innerText=O}static getDomContent(){return document.getElementById(M.idStatusContent)??document.createElement("span")}static getDomElement(){return document.getElementById(M.idComponent)??this.createDomElement()}static createDomElement(){const O=document.createElement("div");return O.id=M.idComponent,O.setAttribute("style","position: fixed;display: flex;width: 100vw;height: 100%;background: #000000c7;color: #ffffff;font-size: 20px;font-weight: lighter;justify-content: center;align-items: center;cursor: progress;z-index: 9999;top: 0;left: 0;"),O.style.display="none",O.innerHTML=`\n        <div class="text-center" style="height: 85%; overflow-x: auto;">\n            <div class="flex justify-center mt-5">\n                <svg width="20" viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">\n                    <g fill="none" fill-rule="evenodd">\n                        <g transform="translate(2 1)" stroke="currentColor" stroke-width="1.5">\n                            <circle cx="42.601" cy="11.462" r="5" fill-opacity="1" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="1;0;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="49.063" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;1;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="42.601" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;1;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="49.125" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;1;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;1;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="4.938" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;1;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="11.462" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;1;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="5" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;0;1" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                        </g>\n                    </g>\n                </svg>\n            </div>\n            <div style="margin-top: 10px;position: relative;">\n                <span id="${M.idStatusContent}"></span>\n            </div>\n        </div>`,document.body.appendChild(O),O}}return(p=M).idComponent="azt-status-loading-effect",p.idStatusContent="azt-status-loading-effect-content",M})()},43277:function(A,R){var n,p;void 0!==(p="function"==typeof(n=function(){"use strict";function S(_,h,v){var b=new XMLHttpRequest;b.open("GET",_),b.responseType="blob",b.onload=function(){T(b.response,h,v)},b.onerror=function(){console.error("could not download file")},b.send()}function O(_){var h=new XMLHttpRequest;h.open("HEAD",_,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function j(_){try{_.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),_.dispatchEvent(h)}}var y="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,C=y.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),T=y.saveAs||("object"!=typeof window||window!==y?function(){}:"download"in HTMLAnchorElement.prototype&&!C?function(_,h,v){var b=y.URL||y.webkitURL,o=document.createElement("a");o.download=h=h||_.name||"download",o.rel="noopener","string"==typeof _?(o.href=_,o.origin===location.origin?j(o):O(o.href)?S(_,h,v):j(o,o.target="_blank")):(o.href=b.createObjectURL(_),setTimeout(function(){b.revokeObjectURL(o.href)},4e4),setTimeout(function(){j(o)},0))}:"msSaveOrOpenBlob"in navigator?function(_,h,v){if(h=h||_.name||"download","string"!=typeof _)navigator.msSaveOrOpenBlob(function M(_,h){return typeof h>"u"?h={autoBom:!1}:"object"!=typeof h&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(_.type)?new Blob(["\ufeff",_],{type:_.type}):_}(_,v),h);else if(O(_))S(_,h,v);else{var b=document.createElement("a");b.href=_,b.target="_blank",setTimeout(function(){j(b)})}}:function(_,h,v,b){if((b=b||open("","_blank"))&&(b.document.title=b.document.body.innerText="downloading..."),"string"==typeof _)return S(_,h,v);var o="application/octet-stream"===_.type,k=/constructor/i.test(y.HTMLElement)||y.safari,x=/CriOS\/[\d]+/.test(navigator.userAgent);if((x||o&&k||C)&&typeof FileReader<"u"){var D=new FileReader;D.onloadend=function(){var P=D.result;P=x?P:P.replace(/^data:[^;]*;/,"data:attachment/file;"),b?b.location.href=P:location=P,b=null},D.readAsDataURL(_)}else{var H=y.URL||y.webkitURL,z=H.createObjectURL(_);b?b.location=z:location.href=z,b=null,setTimeout(function(){H.revokeObjectURL(z)},4e4)}});y.saveAs=T.saveAs=T,A.exports=T})?n.apply(R,[]):n)&&(A.exports=p)}}]);