"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[7987],{25539:(A,R,d)=>{d.d(R,{I:()=>P});class P{constructor(){this.answerLabelsMockup={},this.showEssayMark=!0}}},5382:(A,R,d)=>{d.d(R,{n:()=>P});class P{constructor(r,i,f,E){this.tasks=new Array,this.queues=new Array,this.isRunning=!1,this.allTasks=0,this.wrapCounter=0,this.wrapCounterDone=0,this.countTaskRootDone=0,this.limitOneProcess=r,this.resultCommonTemp={datas:[],errs:[]},this.actionLogItem=i,this.delayTime=f||1e3,this.endWithError=E??!1}addTask(r,i,f,E){if(this.isRunning)return;var k=f||[];const M=this.queues.length;this.allTasks++,this.queues.push({task:()=>new Promise(g=>{this.wrapCounter++,i.call(r,...k).then(C=>{this.wrapCounterDone++,this.callLog(E),g({status:!0,value:C,index:M})}).catch(C=>{this.wrapCounterDone++,this.callLog(E),g({status:!1,error:C,index:M})})}),name:E})}callLog(r){this.actionLogItem&&this.allTasks>0&&this.actionLogItem.function.call({},this.wrapCounterDone,this.allTasks,...this.actionLogItem.params?this.actionLogItem.params:[],r)}start(){return new Promise(r=>{0===this.queues.length&&r({datas:[],errs:[]}),this.resultCommonTemp={datas:[],errs:[]};for(let i=0;i<this.limitOneProcess;i++){const f=this.queues.shift();if(!f)break;this.tasks.push(f)}this.countTaskRootDone=0,this.isRunning=!0,this.runner(r)})}checker(r,i){this.countTaskRootDone++,r.status&&r.value?this.resultCommonTemp.datas.push({index:r.index,value:r.value}):r.error&&this.resultCommonTemp.errs.push({index:r.index,value:r.error}),this.resultCommonTemp.errs.length>0&&this.endWithError&&(this.isRunning=!1,i(this.makeResultObj())),this.countTaskRootDone===this.allTasks&&(this.isRunning=!1,i(this.makeResultObj())),this.nextItem(i)}makeResultObj(){return{datas:this.resultCommonTemp.datas.sort(function(r,i){return r.index-i.index}).map(r=>r.value),errs:this.resultCommonTemp.errs.sort(function(r,i){return r.index-i.index}).map(r=>r.value)}}nextItem(r){const i=this.queues.shift();i&&i.task.call(this).then(f=>this.checker(f,r))}runner(r){this.tasks.length>0?this.tasks.forEach(i=>{i.task.call(this).then(f=>this.checker(f,r))}):(this.isRunning=!1,r(this.makeResultObj()))}}},76671:(A,R,d)=>{d.d(R,{c:()=>v});var P=d(73014),O=d(27691),r=d(5382),i=d(48891),f=d(543),E=d(58112),k=d(48451);const M=d(4060);let v=(()=>{var g;class C{constructor(t,e,n){this.commonService=t,this.sAztCommonCdnService=e,this.apiUploadService=n,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}convertBase64OfMathJaxToCdnUrl(t){return new Promise(e=>{var n=this.getValueContentQuestion(t.questionContent??""),s=this.getValueContentQuestion(t.answerConfig??""),l=t.answerMedia??"",o=this.removeBase64MathJaxInQuestionContent(t.questionText??"");if(0===n.length||0===s.length)return void e(t);let _=this.encodeContent(n[0].content),u=[];s.forEach((c,p)=>{u.push({i:p,d:this.encodeContent(c.content)})});let a=this.encodeContent(l);var m=0;let w=[];for(let c=0;c<_.raws.length;c++)_.raws[c].i=m,m++,w.push(_.raws[c]);for(let c=0;c<a.raws.length;c++)a.raws[c].i=m,m++,w.push(a.raws[c]);u.forEach(c=>{for(let p=0;p<c.d.raws.length;p++)c.d.raws[p].i=m,m++,w.push(c.d.raws[p])}),w.length>0?this.uploadRawContent(w.map(c=>c.l)).then(c=>{_.raws.forEach(p=>{let T=this.stringFirst+btoa(JSON.stringify({l:c,i:p.i}));n[0].content=this.commonService.replaceAll(n[0].content,p.l,T)??""}),a.raws.forEach(p=>{let T=this.stringFirst+btoa(JSON.stringify({l:c,i:p.i}));l=this.commonService.replaceAll(l,p.l,T)??""}),u.forEach(p=>{p.d.raws.forEach(T=>{let D=this.stringFirst+btoa(JSON.stringify({l:c,i:T.i}));s[p.i].content=this.commonService.replaceAll(s[p.i].content,T.l,D)??""})}),t.questionContent=JSON.stringify(n),t.answerConfig=JSON.stringify(s),t.answerMedia=l,t.questionText=o,e(t)}).catch(()=>{e(t)}):e(t)})}decodeMathJaxCodeToCdnUrl(t){return new Promise(e=>{const n=new r.n(10);if(n.addTask(this,()=>new Promise(s=>{this.decodeContent(t.content??"").then(l=>{t.content=l,s(!0)}).catch(()=>{s(!1)})})),n.addTask(this,()=>new Promise(s=>{this.decodeContent(t.help??"").then(l=>{t.help=l,s(!0)}).catch(()=>{s(!1)})})),t.answers)for(let s=0;s<t.answers.length;s++)n.addTask(this,()=>new Promise(l=>{t.answers&&this.decodeContent(t.answers[s].content??"").then(o=>{t.answers&&(t.answers[s].content=o),l(!0)}).catch(()=>{l(!1)})}));n.start().then(()=>{e()})})}getValueContentQuestion(t){return this.commonService.castJsonToObj(t)??[]}getAllMatchWithContent(t){let n,e=[];for(;null!==(n=C.searchPattern.exec(t));)e.includes(n[0])||e.push(n[0]);return e}getRawContent(t,e){return t=this.sAztCommonCdnService.getMyCdn(t),new Promise((n,s)=>{const l=this.dataRaws.findIndex(o=>o.l===t);-1===l?fetch(t).then(o=>o.blob()).then(o=>o.arrayBuffer()).then(o=>{const _=M.inflate(o),u=this.commonService.castJsonToObj((new TextDecoder).decode(_));this.dataRaws.push({l:t,d:u??[]}),u&&u[e]?n(u[e]):s(new Error("Not found index"))}).catch(()=>{s(new Error("Exception at feed link"))}):this.dataRaws[l].d&&this.dataRaws[l].d[e]?n(this.dataRaws[l].d[e]):s(new Error("Not found index"))})}uploadRawContent(t){return new Promise((e,n)=>{const s=JSON.stringify(t),l=(new TextEncoder).encode(s),o=M.deflate(l),_=new Blob([o],{type:"application/octet-stream"}),u=new File([_],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(u).subscribe(a=>{a.type!=O.hv.UploadProgress&&(1==a.success&&a.data?e(a.data.url??""):n(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_PARAM]"+a.message)))})})}removeBase64MathJaxInQuestionContent(t){return this.encodeContent(t).raws.forEach(n=>{t=this.commonService.replaceAll(t,n.l,"")??""}),t}encodeContent(t){let e=this.getAllMatchWithContent(t),n=[];for(let s=0;s<e.length;s++){let o=e[s].replace(C.searchPattern,"$1");o.startsWith(this.stringFirst)||n.push({l:o,i:n.length})}return{content:t,raws:n}}decodeContent(t){var e=this;return(0,P.A)(function*(){let n=e.getAllMatchWithContent(t);for(let s=0;s<n.length;s++){const l=n[s];let o=l.replace(C.searchPattern,"$1");for(let _=0;_<e.stringFirstOld.length;_++)if(o.startsWith(e.stringFirstOld[_])){t=e.commonService.replaceAll(t,l,"")??"";continue}if(o.startsWith(e.stringFirst)){let _=e.commonService.castJsonToObj(atob(o.replace(e.stringFirst,"")));if(_){let u=yield e.getRawContent(_.l,_.i);t=e.commonService.replaceAll(t,o,u)??""}}}return t})()}}return(g=C).searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,g.\u0275fac=function(t){return new(t||g)(i.KVO(f.R),i.KVO(E.c),i.KVO(k.T))},g.\u0275prov=i.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),C})()},10933:(A,R,d)=>{d.d(R,{g:()=>M});var P=d(65106),O=d(5382),r=d(94329),i=d(48891),f=d(58112),E=d(543),k=d(76671);let M=(()=>{var v;class g{parseRenderQuestions(h,t,e,n,s,l){return new Promise((o,_)=>{const a=new O.n(25,{function:(m,w)=>{t&&t(m/w*100)}},n??1e3);h.forEach(m=>{a.addTask(this,this.parseRenderQuestion,[m,e,s,l])}),a.start().then(m=>{if(m.errs.length>0){const w=[];m.errs.forEach(c=>{let p=w.find(T=>T.type===c.type);p||w.push(c),p?.data.concat(c.data)}),_(w)}else o(h)})})}parseRenderQuestion(h,t,e,n){return new Promise((s,l)=>{var o=new r.h(this.sAztCommonCdnService,this.commonService,t||new P.y,a=>{l(a)});o.callbackPushImage=(a,m)=>{this.pushImage(a,m,h)},o.caller=this;const u=new O.n(n?1:20,void 0,0);h.content&&u.addTask(this,()=>new Promise(a=>{h.content=o.render(this.commonService.removeBracket(h.content??""),()=>{a()})})),h.answers&&h.answers.forEach(a=>{u.addTask(this,()=>new Promise(m=>{a.content=o.render(a.content||"",()=>{m()})}))}),h.help&&u.addTask(this,()=>new Promise(a=>{h.help=o.render(h.help,()=>{a()})})),h.groupInfo&&h.groupInfo.groupContent&&u.addTask(this,()=>new Promise(a=>{h.groupInfo&&h.groupInfo.groupContent?h.groupInfo.groupContent=o.render(this.commonService.removeBracket(h.groupInfo.groupContent),()=>{a()}):a()})),e&&u.addTask(this,()=>new Promise(a=>{this.dataAztMathRawHelper.decodeMathJaxCodeToCdnUrl(h).then(()=>{a()})})),u.start().then(a=>{a.errs.length||s()})})}pushImage(h,t,e){if(!e)return;let n=new RegExp("<div id='"+h+"'[^>]+></div>","g");e.content&&(e.content=e.content.replace(n,t??"")),e.answers&&e.answers.forEach(s=>s.content=s.content?.replace(n,t??"")),e.help&&(e.help=e.help.replace(n,t??"")),e.groupInfo&&e.groupInfo.groupContent&&(e.groupInfo.groupContent=e.groupInfo.groupContent.replace(n,t??""))}constructor(h,t,e){this.sAztCommonCdnService=h,this.commonService=t,this.dataAztMathRawHelper=e}}return(v=g).\u0275fac=function(h){return new(h||v)(i.KVO(f.c),i.KVO(E.R),i.KVO(k.c))},v.\u0275prov=i.jDH({token:v,factory:v.\u0275fac,providedIn:"root"}),g})()}}]);