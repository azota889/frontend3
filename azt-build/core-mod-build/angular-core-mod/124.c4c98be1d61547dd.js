"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[124],{99124:(_,d,h)=>{h.d(d,{J:()=>r,h:()=>e});var p=h(49255),s=h(5916),l=h(44764);class a{constructor(){this.isCropImage=!0,this.loadingManager=new Map,this.ratioImage=.65}setCallback(t){}setApiCache(t){}setLoadingManager(t){this.loadingManager=t}loadImage(t,i){return new Promise((o,c)=>{let u=p.P.generateIdRequired(10);this.loadingManager.set(u,t),(0,l.qO)(t,i).then(v=>{o(v),this.loadingManager.delete(u)}).catch(()=>{this.loadingManager.delete(u),c(new Error)})})}loadImageToBase64(t,i){return new Promise((o,c)=>{const u=new Image;u.crossOrigin="anonymous",u.setAttribute("count","1");let v=p.P.generateIdRequired(10);this.loadingManager.set(v,t),u.onload=()=>{const m=document.createElement("canvas");m.width=u.width,m.height=u.height,m.getContext("2d")?.drawImage(u,0,0,u.width,u.height,0,0,m.width,m.height);const C=this.isCropImage?s.Iz.cropCanvas(m):m;let I=`<img id='${v}' class='img-docx' alt='error...' src='${C.toDataURL()}' style='width: ${C.width*this.ratioImage}px;height: auto'>`;o(I),this.loadingManager.delete(v)},u.onerror=()=>{this.loadingManager.delete(v);const m=u.getAttribute("count");m&&1==Number(m)?(u.src=i.getMyCdn(t),u.setAttribute("count","2")):m&&Number(m)<5?(u.setAttribute("count",m+1),u.src=i.getMyCdn(t)+"?t="+(new Date).getTime()):c(new Error)},u.src=i.getMyCdn(t)})}}class g extends a{constructor(t,i,o,c){super(),this.sAztCommonCdnService=t,this.commonService=i,this.callBack=o,this.callbackFall=c}render(t,i,o,c){if(t.indexOf("@[]")<0)return c&&c(),t;let f,u=/@\[\]\{[^@]+\}@\[\]/g,v=t,m=new Map;for(;null!==(f=u.exec(t));){let C=f[0],I=C.split("@[]")[1],b=this.commonService.willDeleteParseJson(I);if(null==b)continue;let E=b.link,w=p.P.generateIdRequired(10);v=v.replace(C,`<div id='${w}' class='img-docx skeleton-box-loading' style='width: ${b.data.width*this.ratioImage}px;height: ${b.data.height*this.ratioImage}px'></div>`),m.has(E)?m.get(E)?.push({id:w,data:b.data}):m.set(E,[{id:w,data:b.data}])}return this.startLoadImage(m).then(()=>{c&&c()}).catch(C=>{this.callbackFall&&this.callbackFall(C)}),v}startLoadImage(t){return new Promise((i,o)=>{var c=0;t.size>0?t.forEach((u,v)=>{this.loadImage(v,this.sAztCommonCdnService).then(m=>{if(this.processImageQuestion(m,u,o),this.loadingManager.delete(m.id),this.callBack)for(let f of u)this.callBack(f.id,f.renderStr);++c===t.size&&i()}).catch(()=>{const m=v.split("/");var f=this.commonService.myTranslateInstant("lang_testbank_render_cant_download_the_image")??"";o(new r("LOAD_IMAGE",[m[m.length-1]],f))})}):i()})}processImageQuestion(t,i,o){i.forEach(c=>{try{const u=document.createElement("canvas");c.data.width=-1===c.data.width?t.width:c.data.width,c.data.height=-1===c.data.height?t.height:c.data.height,u.width=c.data.width,u.height=c.data.height,u.getContext("2d")?.drawImage(t,c.data.x,c.data.y,c.data.width,c.data.height,0,0,u.width,u.height);let m=this.isCropImage?s.Iz.cropCanvas(u):u;m=this.isCanvasEmpty(m)?u:m,c.renderStr=c.data.heightPt&&c.data.widthPt?`<img id='${c.id}' class='img-docx' alt='error...' src='${m.toDataURL()}' style='width: ${c.data.widthPt}pt;height: ${c.data.heightPt}pt'>`:`<img id='${c.id}' class='img-docx' alt='error...' src='${m.toDataURL()}' style='width: ${m.width*this.ratioImage}px;height: auto'>`}catch{const v=t.src;return void o(new r("CROP_IMAGE",[v[v.length-1]],"Kh\xf4ng c\u1eaft \u0111\u01b0\u1ee3c n\u1ed9i dung trong h\xecnh \u1ea3nh"))}})}isCanvasEmpty(t){const i=document.createElement("canvas");return i.width=t.width,i.height=t.height,t.toDataURL()===i.toDataURL()}}class e{initService(){const t=new g(this.sAztCommonCdnService,this.commonService,(i,o)=>{this.callbackPushImage&&this.caller&&this.callbackPushImage.call(this.caller,i,o)},i=>{this.callbackFall&&this.caller&&this.callbackFall.call(this.caller,i)});t.isCropImage=this.configRenderService.getIsCropImage(),this.services.push(t)}render(t,i){return this.services.forEach(o=>{t=o.render(t??"",[],void 0,i)}),t??""}constructor(t,i,o,c){this.sAztCommonCdnService=t,this.commonService=i,this.configRenderService=o,this.callbackFall=c,this.services=[],this.initService()}}class r{constructor(t,i,o,c){this.type=t,this.data=i,this.message=o,this.questionNumber=c}}},49255:(_,d)=>{d.P=void 0,d.P=class p{static generateIdRequired(l){let a="";for(let r=0;r<l;r++)a+="abcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(36*Math.random()));return Math.floor(Date.now()/1e3)+a}}},39769:(_,d,h)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.PartsParser=void 0;const p=h(48473),s=h(81594),l=h(11678),a=h(84867),g=h(7749),e=h(21556);class r{constructor(t){this.__idCssElement="qv_style_element",this.baseConfigEventListener=[],this.imgMaps=[],this.services=new Array;const i=this.__pushServices([new s.FirstPartService(this.baseConfigEventListener),new p.ImagePartService(this.baseConfigEventListener),new g.DocxImagePartService(this.baseConfigEventListener),new a.LibrariesPartService(this.baseConfigEventListener,t),new l.FindAnsPartService(this.baseConfigEventListener),new e.LatexPartService(this.baseConfigEventListener)]);this.__pushCss(i)}__pushCss(t){if(!document.getElementById(this.__idCssElement)&&document.head){const o=document.createElement("style");o.id=this.__idCssElement,o.innerHTML=t.replace(/  /g," ").replace(/\n/g," ").replace(/\t/g," "),document.head.appendChild(o)}}__pushServices(t){let i="";return t.forEach(o=>{o.outCss().forEach(u=>{i+=`.${u.className} { ${u.content} } \n`}),this.services.push(o)}),i}start(t){const i=document.createElement("div");return t.forEach(o=>{const c=document.createElement("p");c.classList.add("qv_line"),this.services.forEach(u=>{u.pushImages(this.imgMaps),o=u.parse(o)}),c.innerHTML=o.text||"",i.appendChild(c)}),0===i.innerText.indexOf(r.IgnoreChar)?i.innerText.replace(r.IgnoreChar,""):i.outerHTML}register(t){this.imgMaps=t}configEventListener(t){t.forEach(i=>{-1===this.baseConfigEventListener.findIndex(o=>o.eventName===i.eventName)&&this.baseConfigEventListener.push(i)})}doneRenderQuestions(){this.services.forEach(t=>{t.onEndAll()})}}d.PartsParser=r,r.IgnoreChar="{!ignore}"},50598:(_,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BaseCaller=void 0,d.BaseCaller=class h{getQuestion(s,l,a,g,e,r){return new Promise(n=>{n([])})}}},21873:(_,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BeautyImageCrop=void 0;class h{static getRGB(s,l,a,g){return{red:g[4*(a.width*l+s)],green:g[4*(a.width*l+s)+1],blue:g[4*(a.width*l+s)+2],opacity:g[4*(a.width*l+s)+3]}}static isEmpty(s){return 255==s.red&&255==s.green&&255==s.blue||0===s.opacity}static scanX(s,l,a){for(var g=s?1:-1,e=s?0:l.width-1;s?e<l.width:e>-1;e+=g)for(var r=0;r<l.height;r++)if(!h.isEmpty(h.getRGB(e,r,l,a.data)))return e;return 0}static scanY(s,l,a){for(var g=s?1:-1,e=s?0:l.height-1;s?e<l.height:e>-1;e+=g)for(var r=0;r<l.width;r++)if(!h.isEmpty(h.getRGB(r,e,l,a.data)))return e;return 0}static cropImage(s,l,a){const e=s.canvas,r=document.createElement("canvas"),n=r.getContext("2d");var t=h.scanY(!0,e,l)-5,i=h.scanY(!1,e,l)+5,o=h.scanX(!0,e,l)-5,c=h.scanX(!1,e,l)+5;a&&(a.top||(i=0),a.bottom||(i=e.height),a.left||a.right?(a.left||(i=0),a.right||(i=e.width)):c=e.width+o);var u=c-o,v=i-t;return r.width=u,r.height=v,n?.drawImage(e,o,t,u,v,0,0,u,v),r}static removeBg(s){const l=document.createElement("canvas"),a=l.getContext("2d");if(a){l.width=s.width,l.height=s.height,a.drawImage(s,0,0);for(var g=a.getImageData(0,0,l.width,l.height),e=g.data,r=0;r<e.length;r+=4)e[r]>=185&&e[r+1]>=185&&e[r+2]>=185&&(e[r+3]=0);a.putImageData(g,0,0)}return l}static cropCanvas(s,l){const a=s.getContext("2d");if(a){var g=a.getImageData(0,0,s.width,s.height);return h.cropImage(a,g,l)}return s}}d.BeautyImageCrop=h},5916:(_,d,h)=>{d.Iz=void 0;h(50598);const l=h(21873);Object.defineProperty(d,"Iz",{enumerable:!0,get:function(){return l.BeautyImageCrop}});h(39769)},7749:(_,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.DocxImagePartService=void 0;class h{constructor(s){this.pattern_check=/@\[\]{"link":"[^"]+","data":{[^}]+}}@\[\]/i,this.images=[],this.indexImageLink=[],this.style=document.createElement("style"),this.baseConfigEventListener=s,document.head.appendChild(this.style)}parse(s){let g,l=0,a=s.text||"";for(;null!==(g=this.pattern_check.exec(a));){try{var e=JSON.parse(g[0].split("@[]")[1]);e.data={x:Math.floor(e.data.x),y:Math.floor(e.data.y),width:Math.floor(e.data.width),height:Math.floor(e.data.height)},this.indexImageLink.push(e.link),a=a.replace(this.pattern_check,`<div class="background_question_${this.indexImageLink.length-1}"><img width="1024" height="1024" src="${e.link}"></div>`),this.style.textContent+=`.background_question_${this.indexImageLink.length-1} {margin: 0 3px; width: ${e.data.width}px; height: ${e.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${this.indexImageLink.length-1} img { margin-top: -${e.data.y}px; margin-left: -${e.data.x}px;}`}catch{a=a.replace(this.pattern_check,"")}l++>1e4&&(a="")}return Object.assign(Object.assign({},s),{text:a})}outCss(){return[]}pushImages(s){this.images=s}onEndAll(){}}d.DocxImagePartService=h,h.NAME_SERVICE="image_part:"},11678:(_,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.FindAnsPartService=void 0,d.FindAnsPartService=class h{constructor(s){this.pattern_check=/\[[ABCDEFGHI]:[^\]]+\]/i,this.images=[],this.baseConfigEventListener=s}parse(s){let g,l=0,a=s.text||"";for(;null!==(g=this.pattern_check.exec(a));){const e=g[0].replace("[","").replace("]",""),r=e.substring(0,1),n=document.createElement("span");n.classList.add("qv_string_eng_ans"),n.innerHTML=r;const t=e.substring(2),i=document.createElement("span");i.classList.add("qv_string_eng"),i.innerHTML=t,i.appendChild(n),a=a.replace(this.pattern_check,i.outerHTML),l++>1e4&&(a="")}return Object.assign(Object.assign({},s),{text:a})}outCss(){return[{className:"qv_string_eng",content:"\n                    cursor: pointer;\n                    padding: 0 5px;\n                    font-weight: bold;\n                    text-decoration: underline;\n                    position: relative;\n                    height: 40px;\n                    display: inline-block;\n                "},{className:"qv_string_eng_ans",content:"\n                    position: absolute;\n                    top: 20px;\n                    left: 45%;\n                "}]}pushImages(s){this.images=s}onEndAll(){}}},81594:(_,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.FirstPartService=void 0,d.FirstPartService=class h{constructor(s){this.images=[],this.baseConfigEventListener=s}parse(s){return Object.assign({},s)}outCss(){return[{className:"qv_line",content:"\n                    margin: 0 !important;\n                "},{className:"qv_qts_image",content:"\n                    width: 100%;\n                "},{className:"qv_ats_image",content:"\n                    width: 60%;\n                "}]}pushImages(s){this.images=s}onEndAll(){}}},48473:(_,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.ImagePartService=void 0;class h{constructor(s){this.pattern_check=/\[!img:[afhci]+[\dABCDEFGHI]+\]/i,this.images=[],this.baseConfigEventListener=s}parse(s){let g,l=0,a=s.text||"";for(;null!==(g=this.pattern_check.exec(a));){const e=g[0].replace("[!img:","").replace("]",""),r=this.images.find(n=>n.id===e);if(r){const n=document.createElement("img");n.crossOrigin="anonymous",n.classList.add(0===e.indexOf("af")?"qv_full_a_img":0===e.indexOf("f")?"qv_full_img":"qv_img"),n.src=r.link,a=a.replace(this.pattern_check,n.outerHTML)}else{const n=document.createElement("span");n.innerHTML="(Th\xeam h\xecnh \u1ea3nh)",n.classList.add("qv_none_image"),a=a.replace(this.pattern_check,n.outerHTML)}l++>1e4&&(a="")}return Object.assign(Object.assign({},s),{text:a})}outCss(){return[{className:"qv_full_a_img",content:"\n                    cursor: pointer;\n                    width: 60%\n                "},{className:"qv_full_img",content:"\n                    cursor: pointer;\n                    width: 100%\n                "},{className:"qv_img",content:"\n                    cursor: pointer;\n                    height: 25px;\n                "},{className:"qv_none_image",content:"\n                    display: inline-block;\n                    color: #2262ae;\n                    cursor: pointer;\n                "}]}pushImages(s){this.images=s}onEndAll(){}}d.ImagePartService=h,h.NAME_SERVICE="image_part:"},21556:(_,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.LatexPartService=void 0;class h{constructor(s){this.images=[],this.baseConfigEventListener=s}parse(s){let l=s.text||"";return Object.assign(Object.assign({},s),{text:l})}outCss(){return[]}pushImages(s){this.images=s}onEndAll(){}}d.LatexPartService=h,h.NAME_SERVICE="latex:"},84867:(_,d,h)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.LibrariesHelper=d.LibrariesPartService=void 0;const p=h(39769);class s{constructor(e,r){this.pattern_check=/^(\[@[CTG]\d+:[^\]]+\]\.)+((\[@Q\d+:[^\]]+\])|(\[[^@:]+\]))$/i,this.pattern_content=/\[(.*?)\]/i,this.images=[],this.baseConfigEventListener=[],this.baseConfigEventListener=e,this.cacheProcess=new a(r,this.baseConfigEventListener)}parse(e){let r=0,n=e.text||"";if(this.pattern_check.test(n)){let t=[];for(;null!==this.pattern_content.exec(n);){const c=this.pattern_content.exec(n);if(!c)break;t.push(c[1]),n=n.substring(0,c.index)+n.substring(c.index+c[0].length)}const i=l.convertStringToTypeObject(t),o={numberQuestion:1,path:i[0],useCache:!0};"Random"===i[0].type?("G"===i[1].type?(o.groupId=i[1].id,o.examId=i[2].id):(o.catId="C"===i[1].type?i[1].id:void 0,o.examId="T"===i[1].type?i[1].id:void 0,o.questionId="Q"===i[1].type?i[1].id:void 0),o.numberQuestion=i[0].id):o.questionId=i[0].id,n=p.PartsParser.IgnoreChar+this.cacheProcess.pushCaller(o),r++>1e4&&(n="")}return Object.assign(Object.assign({},e),{text:n})}outCss(){return[]}pushImages(e){this.images=e}onEndAll(){this.cacheProcess.startCaller()}}d.LibrariesPartService=s,s.NAME_SERVICE="libraries_part:";class l{static convertStringToTypeObject(e){const r=[];return e.forEach(n=>{let t=n.substring(1,2),i=Number(l.pattern_number.exec(n)),o="";if(l.char_types.includes(t)){let c=n.indexOf(":");-1!==c&&(o=n.substring(c))}else t="Random";r.push({name:o,id:i,type:t,content:n})}),r.reverse()}}d.LibrariesHelper=l,l.pattern_number=/\d+/i,l.char_types="CTGQH";class a{constructor(e,r){this.eventDoneKey=s.NAME_SERVICE+"done",this.cacheObjs=[],this.baseCaller=e,this.baseConfigEventListener=r}pushEventValue(){const e=this.baseConfigEventListener.filter(n=>0===n.eventName.indexOf(this.eventDoneKey));let r=[];e.forEach(n=>{const t=this.cacheObjs.filter(o=>"done"===o.step);n.func.call(n.caller,t)&&r.push(n.eventName)}),r.forEach(n=>{const t=this.baseConfigEventListener.findIndex(i=>i.eventName===n);-1!==t&&this.baseConfigEventListener.splice(t,1)})}pushCaller(e){const r=e.catId+"_"+e.examId+"_"+e.groupId+"_"+e.questionId+"_"+e.numberQuestion;var n=this.cacheObjs.find(t=>t.key===r);return n||this.cacheObjs.push(n={key:r,value:[],step:"init",pars:e,count:0}),n.count++,r+"_"+n?.count}startCaller(){this.cacheObjs.forEach(e=>{e.count=0,"init"===e.step?(e.step="call",this.baseCaller.getQuestion(e.pars.numberQuestion,e.pars.useCache,e.pars.catId,e.pars.examId,e.pars.questionId,e.pars.groupId).then(r=>{e.step="done",e.value=r,this.pushEventValue()})):"done"===e.step&&this.pushEventValue()})}}}}]);