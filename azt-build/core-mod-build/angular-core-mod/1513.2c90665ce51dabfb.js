"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[1513],{42032:(V,W,n)=>{n.d(W,{Q:()=>Q});var N=n(61611),e=n(43234),y=n(48891),R=n(543),K=n(10296),O=n(35810),T=n(84708),U=n(67638);let Q=(()=>{var v;class F{constructor(s,a,p,l,M){this.commonService=s,this.shareFileFlutterService=a,this.encryptService=p,this.formatAnswerSheetService=l,this.exportExcelService=M,this.allAnswerSheet=N.c}exportFileNameOfStudentCode(s,a,p){return 100==s&&(a=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(a?"_"+a:"")+"_"+this.encryptService.createMd5(p).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(s,a,p,l,M,S){return a==this.allAnswerSheet.templateA5Full50?s.createA5AnswerSheetFullA4_50(S??50):a==this.allAnswerSheet.templateA4Essay?s.createA4AnswerSheet_35hh(S??50):a==this.allAnswerSheet.templateA6Full20?s.createA6AnswerSheetFullA4_20(S??20):a==this.allAnswerSheet.templateTrueFalseA4||a==this.allAnswerSheet.templateHSGA4||a==this.allAnswerSheet.templateTrueFalseA4With12Fill||a==this.allAnswerSheet.templateTrueFalseFullA4||a==this.allAnswerSheet.templateTrueFalseA4WithColor||a==this.allAnswerSheet.templateTrueFalseEssayA4||a==this.allAnswerSheet.templateTrueFalseA5||a==this.allAnswerSheet.templateTrueFalseA6||a==this.allAnswerSheet.templateA4WithFax||a==this.allAnswerSheet.templateA4WithFaxV2||a==this.allAnswerSheet.templateA4EssayWith4Fill2018||a==this.allAnswerSheet.templateA4NoEssay2025||a==this.allAnswerSheet.templateA4With96MultipleAndEssay?s.createTrueFalseAnswerSheet():a==this.allAnswerSheet.templateMinistryA4TF?s.createAzotaAnswerSheetMinistry_A4():a==this.allAnswerSheet.templateMinistry4DigitsExamCode?s.createAzotaAnswerSheetMinistry_A4_4DigitsExamCode():s.createAzotaAnswerSheet_A4(S??120)}exportFileNameOfAnswerSheet(s,a,p){var l="";return 100==s&&(a=""),(0==s||100==s)&&(l=this.commonService.createFileNameExportFile(["PhieuTL_"+p+(a?"_"+a:"")])),l}exportFileNameOfAnswerExcelOffline(s,a,p){var l="";return 100==s&&(a=""),(0==s||100==s)&&(l=this.commonService.createFileNameExportFile(["DapAn_"+(a?"_"+a:"")])),l}exportFileNameOfRawExam(s,a,p){var l="";return 100==s&&(a=""),(0==s||100==s)&&(l=this.commonService.createFileNameExportFile([(a?"_"+a:"")+"_"+this.encryptService.createMd5(p).substring(0,6)])),l}exportFileNameOfExamOffline(s,a,p,l){var M="";return 100==s&&(a=""),(0==s||100==s)&&(M=this.commonService.createFileNameExportFile([(l?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(l,e.c.maxExamCodeLength)+"_":"")+p+(a?"_"+a:"")])),M}printStudentCode(s,a){var p=[];let l=this.commonService.myClone(a);for(let M=0;M<l.length;M++)p.push({code:l[M].code??0,fullName:l[M]?.fullName??"",birthday:l[M]?.birthday??"",phone:l[M]?.phone,className:l[M].classroomName??""});this._exportExcelForCodeNumber(s,p)}_exportExcelForCodeNumber(s,a){let p=this.exportFileNameOfStudentCode(0,s?.name??"",s?.hashId??"");const l=this.exportExcelService.exportExcelForCodeNumber(a);this.shareFileFlutterService.shareFileWithBlob(l,p)}}return(v=F).\u0275fac=function(s){return new(s||v)(y.KVO(R.R),y.KVO(K.R),y.KVO(O.v),y.KVO(T.e),y.KVO(U.x))},v.\u0275prov=y.jDH({token:v,factory:v.\u0275fac,providedIn:"root"}),F})()},91513:(V,W,n)=>{n.d(W,{c:()=>j});var N=n(73014),e=n(91478),R=n(65106),K=n(37714),O=n(18148),T=n(5382),U=n(43234),Q=n(25539),v=n(81234),F=n(48891),$=n(32610),s=n(543),a=n(36484),p=n(10933),l=n(42032),M=n(84708),S=n(10296),G=n(99927),k=n(78472);let j=(()=>{var P;class w{constructor(i,t,u,o,_,x,r,g,E){this.docxService=i,this.commonService=t,this.userService=u,this.questionRenderService=o,this.printAnswersheetService=_,this.formatAnswerSheetService=x,this.shareFileFlutterService=r,this.sAztAnswerTypeService=g,this.documentConfigService=E,this.configRenderService=new R.y,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new e,this.countRetryLoadJS=0}convertAnswerQuestion(i,t){let u=[],o=[];return i.answerResult&&this.isAnsDetail&&i.answerResult.forEach(_=>{let x=_;const r=i.answers?.find(g=>g.key===_);r&&(x=r.alpha??x),o.push(x)}),i.answers.forEach(_=>{let x="<b>     "+(o.includes(_.alpha??_.key)?"*":"")+(t?(_.alpha?_.alpha:_.key).toLowerCase()+")":(_.alpha?_.alpha:_.key)+".")+"</b> "+(0,v.t5)(_.content);u.push(x)}),u}getDataForExportDocxApi(i,t,u){let o=[],_=0;if(u){let r=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");o.push({content:`<b> ${r} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(u,U.c.maxExamCodeLength)+".</b>",answers:[]})}let x=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return t.forEach(r=>{1!==i.hideGroupQuestion&&r.groupInfo?.isFirstInGroup&&r.groupInfo.groupContent&&o.push({content:`<b>${r.groupInfo.groupContent}<b>`,answers:[]}),this.isEnableDebug&&o.push({content:` <br/><br/><br/>*** <b>Question ID: ${r.id}</b> ***`,answers:[]});let g={content:`<b>${x} `+((r.labelIndex??_)+(i.startQuestionIndex??1))+".</b> "+(this.checkImgAtStart(r.content??"")?"<br/>":"")+(0,v.t5)(r.content),answers:this.convertAnswerQuestion(r??[],this.sAztAnswerTypeService.isTrueFalseAnswer(r))};if(_++,o.push(g),this.isAnsDetail&&((r.help||this.sAztAnswerTypeService.isFillAnswer(r))&&o.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b><br/> ${r.help}`,answers:[]}),r.answerResult&&this.isAnsDetail)){let E=[];r.answerResult.forEach(D=>{let f=D;const I=r.answers?.find(A=>A.key===D);I&&(f=I.alpha??f),E.push(f)}),this.sAztAnswerTypeService.isFillAnswer(r)&&o.push({content:`${this.commonService.myTranslateInstant("lang_auto_dap_an")}: ${E.join(" | ")}`,answers:[]})}this.isEnableDebug&&o.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),o}makeDefaultStrValue(i,t){return i&&0!==i.trim().length?i??"":t??""}itemConverterCaller(i,t,u,o,_){var x=this;return new Promise((r,g)=>{var E=0;this.questionRenderService.parseRenderQuestions(i.listQuestion,D=>{if(!this.saveLoadingMsg.includes(")")){E=D/2;var f=(this.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(E)+"%";this.changeMsg?this.changeMsg(f):O.L.changeMsgLoadingEffect(f)}},this.configRenderService,void 0,!0,_).then(D=>{let f=[];const I=[],A=[];if((t.indetifyBox||t.examName)&&I.push(v.$s.createLineCenterBold(this.makeDefaultStrValue(t.indetifyBox,t.examName))),t.subject&&I.push(v.$s.createLineCenterBold(t.subject)),(t.timeBox||t.examMinutes)&&I.push(v.$s.createLineCenterItalicized(this.makeDefaultStrValue(t.timeBox,t.examMinutes))),I.push(v.$s.createLineCenterItalicized("-------------------------")),t.departmentName&&A.push(v.$s.createLineCenterBold(t.departmentName)),t.schoolName&&A.push(v.$s.createLineCenterBold(t.schoolName)),f.push({content:v.$s.makeHeaderTable(A,I,!1),answers:[]}),f.push({content:v.$s.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),f.push({content:v.$s.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),f=f.concat(this.getDataForExportDocxApi(o,D,i.offlineExamMixQuestionObj?i.offlineExamMixQuestionObj.hashId??0:void 0)),(0,K.w)()){var b=0;let C=i.offlineExamMixQuestionObj?.hashId?i.offlineExamMixQuestionObj.hashId.toString().padStart(3,"0"):void 0,L=C?this.commonService.myTranslateInstant("lang_auto_ma_de")+" "+C:"";this.docxService.exportToDocxBinary(f,{isHeadless:!0,footerLeft:L},function(){var c=(0,N.A)(function*(m,h,d){new Promise(B=>{setTimeout(()=>{0==m&&(b=E),E=m/h*25+b;var z=(x.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(E)+"%";O.L.changeMsgLoadingEffect(z)}),B(!0)})});return function(m,h,d){return c.apply(this,arguments)}}()).then(c=>{r({userObj:u,data:c,input:f,additionParams:t,offlineExamMixQuestionObj:i.offlineExamMixQuestionObj})})}else g(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(D=>{g(new Error(D[0].message))})})}masterConverterCaller(i,t,u,o,_,x){return new Promise((r,g)=>{const E=this.userService.getUserObj();let D=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),f=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),I=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),A=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),b=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),C=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),L=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const c=new T.n(1,{function:(m,h)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${h<=1?"":`(${m}/${h}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):O.L.changeMsgLoadingEffect(this.saveLoadingMsg)}});i.forEach(m=>{let h={schoolName:this.makeDefaultStrValue(o?.nameSchool,`{${D}}`),subject:this.makeDefaultStrValue(o?.nameSubject,`{${f}}`),examName:this.makeDefaultStrValue(t.name,`{${I}}`),examMinutes:t.minutes&&t.minutes>0?`${A}: `+t.minutes+` ${C} (${b})`:` ${A}: ${L}`,templateType:_??0,numberOfQuestion:m.listQuestion.length,examId:m.offlineExamMixQuestionObj?.hashId??0,departmentName:o?.departmentName,indetifyBox:o?.indetifyBox,timeBox:o?.timeBox};c.addTask(this,this.itemConverterCaller,[m,h,E,t,x])}),c.start().then(m=>{if(m.errs.length>0)g(m.errs[0]);else if(1===m.datas.length){const h=m.datas[0],d=new Blob([h.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let B=this.createNameExam(t,u,h.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(d,B),r()}else m.datas.forEach(h=>{let d=this.createNameExam(t,u,h.offlineExamMixQuestionObj);d=this.replaceAllString(d,"/","_"),this.zipper.file("DOCS/"+d,h.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(h=>{let d=this.commonService.createFileNameExportFile([t.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(h,d),r()},h=>{g(h)})},200)})})}replaceAllString(i,t,u){for(;i.includes(t);)i=i.replace(t,u);return i}createNameExam(i,t,u){return t?this.printAnswersheetService.exportFileNameOfExamOffline(0,i.name??"",t?.hashId??"",u?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,i.name??"",i.hashId??"")+".docx"}downloadExam(i,t,u,o,_,x,r,g,E,D,f){return new Promise((I,A)=>{this.isAnsDetail=i,this.isEnableDebug=!!D,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=E,this.commonService.loadAzotaDocxJs().then(()=>{this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(b=>{if(1==b.success){let C=0,L=0;_.forEach((c,m)=>{c.labelIndex=c.originalLabel?Number(c.originalLabel)-1:m,b.data?.resetQuestionIndex&&c.groupInfo&&c.groupInfo.groupId&&(C!=c.groupInfo.groupId&&(C=c.groupInfo.groupId,L=0),c.labelIndex=c.originalLabel?Number(c.originalLabel)-1:L,L++)})}this.masterConverterCaller([{listQuestion:_,offlineExamMixQuestionObj:o}],t,u,x,r,f).then(()=>{this.zipper=new e,g?g(10):O.L.closeLoadingEffect(10),I()}).catch(C=>{O.L.closeLoadingEffect(10),A(C)})})}).catch(()=>{g?g(10):O.L.closeLoadingEffect(10),A(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(i,t,u,o,_,x,r,g,E,D){return new Promise((f,I)=>{this.isAnsDetail=i,this.isEnableDebug=!!E,this.expandInfoParse=this.commonService.castJsonToObj(t.expandInfo??"{}"),this.changeMsg=g,this.commonService.loadAzotaDocxJs().then(()=>{let A=!0;const b=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(t.hashId??"").subscribe(C=>{o.forEach(L=>{let c=this.commonService.castJsonToClassObjs(Q.I,JSON.stringify(L.mixQuestions??[]))??[];if(c.length>0){if(1==C.success){let m=0,h=0;c.forEach((d,B)=>{d.labelIndex=d.originalLabel?Number(d.originalLabel)-1:B,C.data?.resetQuestionIndex&&d.groupInfo&&d.groupInfo.groupId&&(m!=d.groupInfo.groupId&&(m=d.groupInfo.groupId,h=0),d.labelIndex=d.originalLabel?Number(d.originalLabel)-1:h,h++)})}b.push({listQuestion:c,offlineExamMixQuestionObj:L})}else A=!1}),A?this.masterConverterCaller(b,t,u,_,x,D).then(()=>{this.zipper=new e,r?r(10):O.L.closeLoadingEffect(10),f()}).catch(L=>{r?r(10):O.L.closeLoadingEffect(10),I(L)}):(r?r(10):O.L.closeLoadingEffect(10),I(new Error("lang_testbank_exam_is_invalid_condition")))})}).catch(()=>{r?r(10):O.L.closeLoadingEffect(10),I(new Error("lang_core_lib_not_load"))})})}checkImgAtStart(i){return/^\s*<img/.test(i)}}return(P=w).\u0275fac=function(i){return new(i||P)(F.KVO($.I),F.KVO(s.R),F.KVO(a.R),F.KVO(p.g),F.KVO(l.Q),F.KVO(M.e),F.KVO(S.R),F.KVO(G._),F.KVO(k.x_))},P.\u0275prov=F.jDH({token:P,factory:P.\u0275fac,providedIn:"root"}),w})()},61611:(V,W,n)=>{n.d(W,{c:()=>N});var N=function(e){return e[e.templateOriginalA4=20]="templateOriginalA4",e[e.templateA5Full50=22]="templateA5Full50",e[e.templateA4Essay=21]="templateA4Essay",e[e.templateA6Full20=23]="templateA6Full20",e[e.templateTrueFalseFullA4=24]="templateTrueFalseFullA4",e[e.templateHSGA4=25]="templateHSGA4",e[e.templateTrueFalseA4With12Fill=26]="templateTrueFalseA4With12Fill",e[e.templateA4With96MultipleAndEssay=27]="templateA4With96MultipleAndEssay",e[e.templateA4Full66WithFax=28]="templateA4Full66WithFax",e[e.templateA4EssayWith4Fill2018=29]="templateA4EssayWith4Fill2018",e[e.templateA4NoEssay2025=31]="templateA4NoEssay2025",e[e.templateMinistryA4TF=2025]="templateMinistryA4TF",e[e.templateMinistry4DigitsExamCode=20254]="templateMinistry4DigitsExamCode",e[e.templateSGDQN=30]="templateSGDQN",e[e.templateTrueFalseA4=15]="templateTrueFalseA4",e[e.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",e[e.templateTrueFalseA5=17]="templateTrueFalseA5",e[e.templateTrueFalseA6=18]="templateTrueFalseA6",e[e.templateA4WithFax=19]="templateA4WithFax",e[e.templateA4WithFaxV2=190]="templateA4WithFaxV2",e[e.templateTrueFalseA4WithColor=150]="templateTrueFalseA4WithColor",e[e.templateA4WithColorNew=200]="templateA4WithColorNew",e}(N||{})}}]);