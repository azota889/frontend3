"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[5933],{37157:(et,A,s)=>{s.d(A,{Z:()=>U});var m=s(51698),d=s(11787),v=s(27035),j=s(17178),D=s(48915),k=s(63016),S=s(47947),R=s(81215),E=s(15351);const P=(b,C)=>(b.push(C),b);var V=s(48891);let U=(()=>{var b;class C{processObservables(I,O,z){return new m.c(f=>{this.processMultipleObservables(I,O,z).subscribe({next:t=>{f.next(t),f.complete()},error:t=>{f.next(O.map(h=>null)),f.complete()}})})}processMultipleObservables(I,O,z){return(0,d.H)(O).pipe((0,v.Z)((f,t)=>f.pipe((0,j.W)(h=>(console.error("Error in observable:",h),z?(0,D.$)(()=>h):(0,k.of)(null))),(0,S.T)(h=>({result:h,index:t}))),I),function w(){return(0,E.N)((b,C)=>{(0,R.T)(P,[])(b).subscribe(C)})}(),(0,S.T)(f=>f.sort((t,h)=>t.index-h.index).map(t=>t.result)))}}return(b=C).\u0275fac=function(I){return new(I||b)},b.\u0275prov=V.jDH({token:b,factory:b.\u0275fac,providedIn:"root"}),C})()},45933:(et,A,s)=>{s.r(A),s.d(A,{AzotaDigitalizeModule:()=>ke});var m=s(54460),d=s(10936),v=s(65162),j=s(69223),D=s(62067),k=s(15343),S=s(10123),R=s(44233),E=s(5502),P=s(21656),w=s(70050),V=s(7050),U=s(35143),b=s(43234),C=s(1133),N=s(89121),I=s(37714),O=s(72888),z=s(59640),f=s(37497),t=s(48891),h=s(86425),it=s(51113),B=s(73014),ot=s(27691),nt=s(74506),at=s(85710),L=s(51698),lt=s(48451),J=s(79767),u=s(47348),y=s(21973),st=s(53793),W=s(52909),$=s(39712);let T=(()=>{var o;class l{constructor(){this.subscriptions=new at.yU,this.sAztBase64Service=(0,t.WQX)(y.D),this.ocrService=(0,t.WQX)(nt.so),this.commonService=(0,t.WQX)(st.R),this.sAztUuidService=(0,t.WQX)(W.D),this.digitalizedBookPageService=(0,t.WQX)(h.gI),this.apiUploadService=(0,t.WQX)(lt.T)}runRemoveBackgroundNoise(e,i,a){return new L.c(r=>{this.removeBackgroundNoise(e.oldImageUrl,i,(c,g)=>{if(null==c||g)return a(g??""),r.next(void 0),void r.complete();this.apiUploadService.commonUploadFile($.b8.ADMIN_DIGITALIZE,this.sAztBase64Service.base64ToFile(c,"digitalized-file.png"),"").subscribe(p=>{p.type!=ot.hv.UploadProgress&&(1===p.success&&p.data?.url?(r.next({...e,newImageUrl:p.data.url}),r.complete()):(a(p.message??""),r.next(void 0),r.complete()))})})})}removeBackgroundNoise(e,i,a){this.sAztBase64Service.convertImageUrlToBase64(e,r=>{if(!r)return a(void 0,"Error to get base64 from url");this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(r),c=>{if(!c)return a(void 0,"Error to get Uint8Array from base64");this.loadScriptHandleImage(()=>{this.imageUtils.removeNoise(c,i).then(g=>a(this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(g.image)),void 0)).catch(g=>a(void 0,"Error when call imageUtils.detectImage"))})})})}callChangeBookPageDataApi(e,i,a,r,c){this.subscriptions.add(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrPost({bookId:e,bookPageId:i,ocrContent:a,originOcrContent:r}).subscribe(p=>{if(!p.success)return c(!1,p.message);c(!0,"")}))}digitalizeOneImage(e,i,a,r){return new L.c(c=>{i("lang_digitalize_call_ocr_api"),this.subscriptions.add(this.commonService.wrapApiResponse(this.ocrService.aiApiV1OcrImageToTextPost({imageUrl:e})).subscribe(g=>{if(!g.success||!g.data)return a(g.message),c.next(!1),void c.complete();r(this.replaceOrcData(g.data)),c.next(!0),c.complete()}))})}replaceOrcData(e){let i=e.data,a=this.sAztUuidService.getUuid();return i=this.commonService.convertLatexTagToAztMathTag(i,a),i=(new u.bt).transform((new u.UN).transform(i)),i=this.commonService.replaceAll(i,"<table>","<table class='table table-bordered'>")??i,i=i.replace(new RegExp(a,"g"),"\n"),{htmlResult:i,originOcrData:e.data}}extractImageByOrcUtil(e,i){this.sAztBase64Service.convertImageUrlToBase64(e,a=>{if(!a)return i(void 0,[],"Error to get base64 from url");this.sAztBase64Service.getImageDimensions(a,r=>{this.sAztBase64Service.convertFileToUint8Array(this.sAztBase64Service.base64ToFile(a),c=>{if(!c)return i(void 0,[],"Error to get Uint8Array from base64");let g={base64:this.sAztBase64Service.removePrefixOfBase64(a),x:0,y:0,width:r.width,height:r.height,extension:"png"};this.loadScriptHandleImage(()=>{this.imageUtils.detectImage(c).then(p=>i(g,p.images.map(_=>({base64:this.sAztBase64Service.uint8ArrayToBase64(new Uint8Array(_.content)),x:_.x,y:_.y,width:_.width,height:_.height,extension:_.extension})),void 0)).catch(p=>i(g,[],"Error when call imageUtils.detectImage"))})})})})}waitAnswerSheetInitDone(e){if(J.A.azotaScanAnswerSheet)return e();setTimeout(()=>{this.waitAnswerSheetInitDone(e)},100)}loadScriptHandleImage(e){var i=this;if(this.imageUtils)return e();this.commonService.loadAnswerSheetJs().then((0,B.A)(function*(){i.waitAnswerSheetInitDone((0,B.A)(function*(){i.imageUtils=yield J.A.azotaScanAnswerSheet.imageUtils(),e()}))})).catch(a=>{this.commonService.snackError("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"),e()})}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),l})();var Z=s(37157),rt=s(36484),x=s(18718),ct=s(22613),G=s(96451),M=s(46899),gt=s(53043);const dt=["*"];let F=(()=>{var o;class l extends z.H{constructor(){super(...arguments),this.imageUrl="",this.sAztDialogService=(0,t.WQX)(M.i)}previewImage(){this.sAztDialogService.open(gt.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{url:this.imageUrl,mimes:"image/jpeg"},viewFullImageWithScroll:!0},restoreFocus:!1})}}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["azt-preview-image-tag"]],inputs:{imageUrl:"imageUrl"},features:[t.Vt3],ngContentSelectors:dt,decls:2,vars:0,consts:[[3,"click"]],template:function(e,i){1&e&&(t.NAR(),t.j41(0,"span",0),t.bIt("click",function(){return i.previewImage()}),t.SdG(1),t.k0s())},encapsulation:2}),l})();const H=()=>({"flex-none":!0,"mr-1":!0});function mt(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"span",10),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.editBookPage(i.obj))}),t.nrm(2,"lucide-icon",11),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.callAgainOcrBookPageEvent.emit(i.obj))}),t.nrm(7,"lucide-icon",13),t.EFF(8),t.nI1(9,"mytranslate"),t.k0s(),t.bVm()}2&o&&(t.R7$(2),t.Y8G("ngClass",t.lJ4(8,H)),t.R7$(),t.SpI(" ",t.bMT(4,4,"lang_cms_admin_digitalized_edit_content")," "),t.R7$(4),t.Y8G("ngClass",t.lJ4(9,H)),t.R7$(),t.SpI(" ",t.bMT(9,6,"lang_cms_admin_digitalized_re_digitalized_again")," "))}function pt(o,l){if(1&o&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(t.bMT(2,1,n.obj.logMessage))}}function _t(o,l){if(1&o&&(t.j41(0,"div"),t.nrm(1,"div",15),t.nI1(2,"mathJaxContent"),t.nI1(3,"async"),t.nI1(4,"safeNormalHtmlContent"),t.k0s()),2&o){let n;const e=t.XpG();t.R7$(),t.Y8G("innerHTML",t.bMT(4,5,t.bMT(3,3,t.bMT(2,1,null!==(n=e.obj.ocrContent)&&void 0!==n?n:""))),t.npT)}}let ut=(()=>{var o;class l extends z.H{constructor(){super(...arguments),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB}editBookPage(e){e.currentStatus="show_edit_form",this.changeBookPageStatusEvent.emit(e)}}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-view-book-page"]],inputs:{obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"flex-none","items-center"],[4,"ngIf"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],["class","mb-3 text-pending",4,"ngIf"],[1,"text-primary","clickable","mr-2",3,"click"],["name","pencil","size","16",3,"ngClass"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"mb-3","text-pending"],[3,"innerHTML"]],template:function(e,i){1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,mt,10,10,"ng-container",4),t.k0s()(),t.j41(7,"div",5)(8,"azt-preview-image-tag",6),t.nrm(9,"img",7),t.k0s(),t.nrm(10,"hr",8),t.DNE(11,pt,3,3,"div",9)(12,_t,5,7,"div",4),t.k0s()),2&e&&(t.R7$(3),t.Lme("",t.bMT(4,7,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("ngIf",i.obj.isOrc),t.R7$(2),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.Y8G("src",i.obj.imageLink,t.B4B),t.R7$(2),t.Y8G("ngIf",i.obj.logMessage),t.R7$(),t.Y8G("ngIf",i.obj.isOrc))},dependencies:[m.YU,m.bT,F,k.WGl,m.Jj,u.wp,u.km,u._y],encapsulation:2}),l})();var Y=s(52811);let bt=(()=>{var o;class l extends z.H{}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-processing-book-page"]],inputs:{obj:"obj"},features:[t.Vt3],decls:13,vars:9,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"p-3"],[1,"clickable",3,"imageUrl"],["width","50px","height","50px",3,"src"],[1,"mb-3","mt-3"],[1,"flex","items-center"],[1,"mr-1"]],template:function(e,i){if(1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s()()(),t.j41(5,"div",3)(6,"azt-preview-image-tag",4),t.nrm(7,"img",5),t.k0s(),t.nrm(8,"hr",6),t.j41(9,"div",7),t.nrm(10,"azt-loading-ui",8),t.EFF(11),t.nI1(12,"mytranslate"),t.k0s()()),2&e){let a;t.R7$(3),t.Lme("",t.bMT(4,5,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.Y8G("src",i.obj.imageLink,t.B4B),t.R7$(4),t.SpI(" ",t.bMT(12,7,null!==(a=i.obj.logMessage)&&void 0!==a?a:"lang_lang_cms_admin_digitalized_is_waiting_to_process")," ")}},dependencies:[Y.R,F,u.wp],encapsulation:2}),l})();var Q=s(89163),ht=s(33887);const zt=["angularCropper"];function ft(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"img",11),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const i=t.eBV(n).$implicit,a=t.XpG(2);return t.Njj(a.chooseImage(i))}),t.k0s(),t.bVm()}if(2&o){const n=l.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,n.base64,"png"),t.B4B)}}function kt(o,l){if(1&o&&(t.j41(0,"div",9),t.DNE(1,ft,3,4,"ng-container",10),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.Y8G("ngForOf",n.base64Images)}}function vt(o,l){if(1&o&&(t.nrm(0,"angular-cropper",12,0),t.nI1(2,"addBase64Extension")),2&o){const n=t.XpG();t.Y8G("cropperOptions",n.cropperOptions)("imageUrl",t.i5U(2,2,n.currentBase64Image.base64,"png"))}}let Ct=(()=>{var o;class l extends ht._{chooseImage(e){this.currentBase64Image=e}cropImage(e){var i=this;return(0,B.A)(function*(){i.angularCropper?.cropper.getCroppedCanvas().toBlob(a=>{a&&i.sAztBase64Service.convertBlobToBase64(a,function(){var r=(0,B.A)(function*(c){let g=i.angularCropper?.cropper.getCropBoxData(),p=g?.width,_=g?.height;!p||!_||(i.base64Images.push({base64:c,x:0,y:0,width:p,height:_,extension:"png"}),yield i.sAztBase64Service.copyBase64ToClipBoard(c),i.showSuccessSnack("lang_cms_copy_success"),e&&i.dialogRef.close(i.base64Images))});return function(c){return r.apply(this,arguments)}}())})})()}closeDialog(){this.dialogRef.close(this.base64Images)}constructor(e,i){super(i,e),this.dialogRef=e,this.data=i,this.sAztBase64Service=(0,t.WQX)(y.D),this.base64Images=[],this.cropperOptions={movable:!0,scalable:!1,zoomable:!1,data:{width:240,height:90}},this.base64Images=i.base64Images,this.currentBase64Image=this.commonService.getFirstOfArray(this.base64Images)}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(Q.CP,8),t.rXU(Q.Vh,8))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-coazt-image-editor"]],viewQuery:function(e,i){if(1&e&&t.GBs(zt,5),2&e){let a;t.mGM(a=t.lsd())&&(i.angularCropper=a.first)}},features:[t.Vt3],decls:14,vars:11,consts:[["angularCropper",""],[1,"box","p-3"],["class","list-base640-images mb-3",4,"ngIf"],[1,"text-center","mb-3"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn","btn-info","mr-2",3,"click"],[1,"btn","btn-secondary","mr-2","w-32",3,"click"],[2,"height","calc(100vh - 120px)","overflow-x","hidden","overflow-y","scroll"],[3,"cropperOptions","imageUrl",4,"ngIf"],[1,"list-base640-images","mb-3"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"],[3,"cropperOptions","imageUrl"]],template:function(e,i){1&e&&(t.j41(0,"div",1),t.DNE(1,kt,2,1,"div",2),t.j41(2,"div",3)(3,"span",4),t.bIt("click",function(){return i.cropImage(!0)}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s(),t.j41(6,"span",5),t.bIt("click",function(){return i.cropImage(!1)}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s(),t.j41(9,"span",6),t.bIt("click",function(){return i.closeDialog()}),t.EFF(10),t.nI1(11,"mytranslate"),t.k0s()(),t.j41(12,"div",7),t.DNE(13,vt,3,5,"angular-cropper",8),t.k0s()()),2&e&&(t.R7$(),t.Y8G("ngIf",i.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,5,"lang_button_crop_and_close")),t.R7$(3),t.JRh(t.bMT(8,7,"lang_button_crop")),t.R7$(3),t.JRh(t.bMT(11,9,"lang_button_close")),t.R7$(3),t.Y8G("ngIf",i.currentBase64Image))},dependencies:[m.Sq,m.bT,D.TJ,u.wp,u.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;height:50px;width:50px}"]}),l})();function It(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"img",6),t.nI1(2,"addBase64Extension"),t.bIt("click",function(){const i=t.eBV(n).$implicit,a=t.XpG(2);return t.Njj(a.copyImage(i))}),t.k0s(),t.bVm()}if(2&o){const n=l.$implicit;t.R7$(),t.FS9("src",t.i5U(2,1,n.base64,n.extension),t.B4B)}}function Ot(o,l){if(1&o&&(t.j41(0,"div",4),t.DNE(1,It,3,4,"ng-container",5),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.Y8G("ngForOf",n.base64Images)}}let jt=(()=>{var o;class l extends z.H{constructor(){super(...arguments),this.replaceImageEvent=new t.bkB,this.sAztDialogService=(0,t.WQX)(M.i),this.sAztDigitalizeService=(0,t.WQX)(T),this.sAztBase64Service=(0,t.WQX)(y.D),this.base64Images=[]}copyImage(e){var i=this;return(0,B.A)(function*(){yield i.sAztBase64Service.copyBase64ToClipBoard(e.base64),i.showSuccessSnack("lang_cms_copy_and_replace_success"),i.replaceImageEvent.emit(e)})()}cropImageDialog(){this.sAztDialogService.open(Ct,{data:{base64Images:this.base64Images},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0}).afterClosed().subscribe(i=>{null!=i&&(this.base64Images=i)})}ngOnChanges(){this.initStatusObj(),this.sAztDigitalizeService.extractImageByOrcUtil(this.imageUrl,(e,i,a)=>{if(a)return this.errorStatusObj(a,!0);let r=[];e&&r.push(e),i.forEach(c=>r.push(c)),this.base64Images=r,this.stopStatusObj()})}}return(o=l).\u0275fac=(()=>{let n;return function(i){return(n||(n=t.xGo(o)))(i||o)}})(),o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-list-digitalized-images"]],inputs:{imageUrl:"imageUrl"},outputs:{replaceImageEvent:"replaceImageEvent"},features:[t.Vt3,t.OA$],decls:6,vars:4,consts:[[2,"height","228px","overflow-x","scroll","overflow-y","hidden"],["class","list-base640-images",4,"ngIf"],[1,"mb-3","mt-3"],[1,"text-primary","clickable",3,"click"],[1,"list-base640-images"],[4,"ngFor","ngForOf"],[1,"box","mr-2","mb-2","clickable",3,"click","src"]],template:function(e,i){1&e&&(t.j41(0,"div",0),t.DNE(1,Ot,2,1,"div",1),t.k0s(),t.j41(2,"div",2)(3,"span",3),t.bIt("click",function(){return i.cropImageDialog()}),t.EFF(4),t.nI1(5,"mytranslate"),t.k0s()()),2&e&&(t.R7$(),t.Y8G("ngIf",i.base64Images.length>0),t.R7$(3),t.JRh(t.bMT(5,2,"lang_button_crop")))},dependencies:[m.Sq,m.bT,u.wp,u.t4],styles:[".list-base640-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;max-height:200px}"]}),l})();const Bt=()=>({"flex-none":!0,"mr-1":!0});function At(o,l){1&o&&t.nrm(0,"azt-loading-ui",13)}function Dt(o,l){1&o&&t.nrm(0,"azt-loading-ui",13)}let St=(()=>{var o;class l extends z.H{saveAllObjs(){this.saveAllContentEvent.emit()}saveObj(){this.initStatusObj();let e=this.obj.htmlContentFormControl.value;this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookObj.id,this.obj.id,e,void 0,(i,a)=>{if(!i)return this.errorStatusObj(a,!0);this.obj.ocrContent=e,this.changeBookPageStatusEvent.emit(this.obj),this.successStatusObj("lang_cms_update_success",!0)})}cancelObj(){this.showSuccessSnack("lang_cms_cancel_success"),this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}replaceImage(e){let i=this.obj.htmlContentFormControl.value.replace("<img>",`<img src='${this.sAztBase64Service.generateBase64Prefix(e.extension)+e.base64}'/>`);this.obj.htmlContentFormControl.setValue(i)}ngOnChanges(){this.obj.htmlContentFormControl.setValue(this.obj.ocrContent??"")}ngOnInit(){super.ngOnInit()}constructor(){super(),this.sAztDigitalizeService=(0,t.WQX)(T),this.sAztBase64Service=(0,t.WQX)(y.D),this.changeBookPageStatusEvent=new t.bkB,this.callAgainOcrBookPageEvent=new t.bkB,this.saveAllContentEvent=new t.bkB}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-edit-book-page"]],inputs:{bookObj:"bookObj",obj:"obj"},outputs:{changeBookPageStatusEvent:"changeBookPageStatusEvent",callAgainOcrBookPageEvent:"callAgainOcrBookPageEvent",saveAllContentEvent:"saveAllContentEvent"},features:[t.Vt3,t.OA$],decls:26,vars:29,consts:[[1,"p-3","bg-slate-100","flex","items-center"],[1,"mr-3","w-full"],[1,"mr-2"],[1,"text-primary","clickable","ml-2",3,"click"],["name","refresh-cw","size","16",3,"ngClass"],[1,"p-3"],[3,"replaceImageEvent","imageUrl"],[3,"formControl","apiKey","init"],[1,"flex-none","items-center","text-right","mt-3"],[1,"btn","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","mr-3",3,"click"],["class","mr-1",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"mr-1"]],template:function(e,i){1&e&&(t.j41(0,"div",0)(1,"span",1)(2,"b",2),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"span",3),t.bIt("click",function(){return i.callAgainOcrBookPageEvent.emit(i.obj)}),t.nrm(6,"lucide-icon",4),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()(),t.j41(9,"div",5)(10,"app-digitalized-list-digitalized-images",6),t.bIt("replaceImageEvent",function(r){return i.replaceImage(r)}),t.k0s(),t.nrm(11,"editor",7),t.nI1(12,"getTinyMceKey"),t.nI1(13,"getTinyMceConfig"),t.j41(14,"div",8)(15,"button",9),t.bIt("click",function(){return i.cancelObj()}),t.EFF(16),t.nI1(17,"mytranslate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){return i.saveObj()}),t.DNE(19,At,1,0,"azt-loading-ui",11),t.EFF(20),t.nI1(21,"mytranslate"),t.k0s(),t.j41(22,"button",12),t.bIt("click",function(){return i.saveAllObjs()}),t.DNE(23,Dt,1,0,"azt-loading-ui",11),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()),2&e&&(t.R7$(3),t.Lme("",t.bMT(4,14,"lang_cms_admin_digitalized_page"),": ",i.obj.currentPage,""),t.R7$(3),t.Y8G("ngClass",t.lJ4(28,Bt)),t.R7$(),t.SpI(" ",t.bMT(8,16,"lang_cms_admin_digitalized_re_digitalized_again")," "),t.R7$(3),t.Y8G("imageUrl",i.obj.imageLink),t.R7$(),t.FS9("apiKey",t.bMT(12,18,"")),t.Y8G("formControl",i.obj.htmlContentFormControl)("init",t.bMT(13,20,"admin_for_digitalized")),t.BMQ("style","width: 100%;min-height:500px;",t.$dS),t.R7$(5),t.JRh(t.bMT(17,22,"lang_auto_huy")),t.R7$(3),t.Y8G("ngIf",i.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(21,24,"lang_digitalized_save_one")," "),t.R7$(3),t.Y8G("ngIf",i.statusObj.loading),t.R7$(),t.SpI(" ",t.bMT(25,26,"lang_digitalized_save_all")," "))},dependencies:[m.YU,m.bT,d.BC,j.xn,d.l_,Y.R,k.WGl,jt,u.wp,u.Hw,u.yc],encapsulation:2}),l})();function yt(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",3),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function Tt(o,l){if(1&o){const n=t.RV6();t.j41(0,"app-digitalized-view-book-page",18),t.bIt("changeBookPageStatusEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.changeBookPageStatus(i))})("callAgainOcrBookPageEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.reDigitalizedOneObj(i))}),t.k0s()}if(2&o){const n=t.XpG(2).$implicit;t.Y8G("obj",n)}}function xt(o,l){if(1&o){const n=t.RV6();t.j41(0,"app-digitalized-edit-book-page",19),t.bIt("changeBookPageStatusEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.changeBookPageStatus(i))})("callAgainOcrBookPageEvent",function(i){t.eBV(n);const a=t.XpG(5);return t.Njj(a.reDigitalizedOneObj(i))})("saveAllContentEvent",function(){t.eBV(n);const i=t.XpG(5);return t.Njj(i.saveAllContent())}),t.k0s()}if(2&o){const n=t.XpG(2).$implicit,e=t.XpG(3);t.Y8G("bookObj",e.bookObj)("obj",n)}}function Gt(o,l){if(1&o&&t.nrm(0,"app-digitalized-processing-book-page",20),2&o){const n=t.XpG(2).$implicit;t.Y8G("obj",n)}}function Ft(o,l){if(1&o&&(t.j41(0,"div"),t.DNE(1,Tt,1,1,"app-digitalized-view-book-page",15)(2,xt,1,2,"app-digitalized-edit-book-page",16)(3,Gt,1,1,"app-digitalized-processing-book-page",17),t.k0s()),2&o){const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf","none"==n.currentStatus),t.R7$(),t.Y8G("ngIf","show_edit_form"==n.currentStatus),t.R7$(),t.Y8G("ngIf","calling_ocr_api"==n.currentStatus)}}function Rt(o,l){if(1&o&&(t.qex(0),t.DNE(1,Ft,4,3,"div",14),t.bVm()),2&o){const n=l.$implicit;t.R7$(),t.Y8G("ngIf",n.isShow)}}function Et(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"button",7),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.digitalizedAll())}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.j41(5,"button",7),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.runDigitalizedCurrentPage())}),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.exportData("html"))}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",8),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.exportData("docx"))}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s(),t.j41(14,"button",8),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.exportData("txt"))}),t.EFF(15),t.nI1(16,"mytranslate"),t.k0s()(),t.j41(17,"div",9),t.DNE(18,Rt,2,1,"ng-container",10),t.k0s(),t.j41(19,"div",11)(20,"div",12)(21,"azt-paging",13),t.bIt("goToPaginationPage",function(i){t.eBV(n);const a=t.XpG(2);return t.Njj(a.goToPage(i))}),t.k0s()()()()}if(2&o){const n=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,10,"lang_cms_admin_digitalized_digitalized_all")," (",n.bookObj.totalDone," / ",n.bookObj.totalPage,")"),t.R7$(3),t.Lme("",t.bMT(7,12,"lang_cms_admin_digitalized_digitalized_current_page")," (",n.totalCurrentItems,")"),t.R7$(3),t.JRh(t.bMT(10,14,"lang_cms_admin_digitalized_digitalized_export_html")),t.R7$(3),t.JRh(t.bMT(13,16,"lang_cms_admin_digitalized_digitalized_export_docx")),t.R7$(3),t.JRh(t.bMT(16,18,"lang_cms_admin_digitalized_digitalized_export_txt")),t.R7$(3),t.Y8G("ngForOf",n.objs),t.R7$(3),t.Y8G("pageObj",n.pageObj)}}function Pt(o,l){if(1&o&&t.DNE(0,Et,22,20,"div",4),2&o){const n=t.XpG();t.Y8G("ngIf",n.bookObj)}}let wt=(()=>{var o;class l extends z.H{digitalizedAll(){this.digitalizedObjs(this.objs.filter(e=>"none"==e.currentStatus&&1!=e.isOrc))}runDigitalizedCurrentPage(){this.digitalizedObjs(this.objs.filter(e=>e.isShow&&"none"==e.currentStatus&&1!=e.isOrc))}reDigitalizedOneObj(e){this.digitalizedObjs([e])}digitalizedObjs(e){this.showSuccessSnack(this.commonService.myTranslateInstant("lang_cms_admin_digitalized_for_total_object")+": "+e.length);let i=e.map(r=>r.id);this.objs.forEach(r=>!!i.includes(r.id)&&Object.assign(r,{...r,currentStatus:"calling_ocr_api"}));let a=[];e.forEach(r=>a.push(this.runDigitalizeOneImage(r))),this.waitDestroy(this.sAztConcurrencyApiService.processObservables(1,a,!1).subscribe(r=>{}))}runDigitalizeOneImage(e){return this.sAztDigitalizeService.digitalizeOneImage(e.imageLink,i=>{console.log(`Digitalized for: Id: ${e.id} | Link: ${e.imageLink}`),this.objs.forEach(a=>a.id==e.id&&Object.assign(a,{...a,logMessage:i}))},i=>{console.log(`Digitalized error: Id: ${e.id} | Link: ${e.imageLink} | message: ${i}`),this.objs.forEach(a=>a.id==e.id&&Object.assign(a,{...a,logMessage:i,currentStatus:"none"}))},i=>{this.sAztDigitalizeService.callChangeBookPageDataApi(this.bookId,e.id,i.htmlResult,i.originOcrData,(a,r)=>{if(!a)return console.log(`Digitalized error: Id: ${e.id} | Link: ${e.imageLink} | message: ${r}`),void this.objs.forEach(c=>c.id==e.id&&Object.assign(c,{...c,logMessage:r,currentStatus:"none"}));this.objs.forEach(c=>c.id==e.id&&Object.assign(c,{...c,logMessage:"",currentStatus:"show_edit_form",ocrContent:i.htmlResult,originOcrContent:i.originOcrData,isOrc:1})),this.bookObj.totalDone=this.objs.filter(c=>c.isOrc).length,console.log(`Digitalized success: Id: ${e.id} | Link: ${e.imageLink}`)})})}saveAllContent(){this.initStatusObj();let e=this.objs.filter(a=>1==a.isOrc).map(a=>({bookPageId:a.id,ocrContent:a.htmlContentFormControl.value}));this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateOcrObjsPost({bookId:this.bookId,objs:e}).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);this.objs.forEach(r=>{let c=e.find(g=>g.bookPageId==r.id);c&&(r.ocrContent=c.ocrContent)}),this.successStatusObj("lang_cms_update_success",!0)}))}changeBookPageStatus(e){this.objs.forEach(i=>i.id==e.id&&Object.assign(i,{...e}))}exportData(e){let i=new Date;if("txt"==e){let g="";this.objs.forEach(ve=>g+=ve.originOcrContent+"\n");let p=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.txt`;const _=new Blob([g],{type:"text/plain"});return void(_&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(_),p))}let a="";if(this.objs.forEach(g=>a+=`<page [page]='${g.currentPage}'/>`+(g.ocrContent??"")),a=this.commonService.decodeHtmlEntities(a),"html"==e){a=this.commonService.convertMathTagToLatex(a),a+=(0,O.A3)("PHNjcmlwdD4KCWZ1bmN0aW9uIGdldFNlbGVjdGlvbkh0bWwoKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCA8PSAwKSByZXR1cm4gJyc7CgoJCXZhciByYW5nZSA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApOwoJCXZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQocmFuZ2UuY2xvbmVDb250ZW50cygpKTsKCQlyZXR1cm4gY29udGFpbmVyLmlubmVySFRNTDsKCX0KCWZ1bmN0aW9uIHNob3dTbmFjayhpc1N1Y2Nlc3MsIG1lc3NhZ2UpIHsKCQkvLyBTdGVwIDE6IENyZWF0ZSB0aGUgc25hY2sgZWxlbWVudAoJCXZhciBzbmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXNuYWNrLnRleHRDb250ZW50ID0gbWVzc2FnZTsKCgkJLy8gU3RlcCAyOiBTdHlsZSB0aGUgc25hY2sgZm9yIHRvcCBsZWZ0IGNlbnRlciBwb3NpdGlvbmluZwoJCXNuYWNrLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQlzbmFjay5zdHlsZS50b3AgPSAnMjBweCc7CgkJc25hY2suc3R5bGUubGVmdCA9ICc1MCUnOwoJCXNuYWNrLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKC01MCUpJzsgLy8gQ2VudGVyIGhvcml6b250YWxseQoJCXNuYWNrLnN0eWxlLndpZHRoID0gJzQwMHB4JzsKCQlzbmFjay5zdHlsZS5wYWRkaW5nID0gJzEwcHggMjBweCc7CgkJc25hY2suc3R5bGUuYmFja2dyb3VuZENvbG9yID0gaXNTdWNjZXNzID8gJyM0Q0FGNTAnIDogJ3JlZCc7IC8vIEdyZWVuIGJhY2tncm91bmQgZm9yIHN1Y2Nlc3MKCQlzbmFjay5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CgkJc25hY2suc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CgkJc25hY2suc3R5bGUuYm94U2hhZG93ID0gJzBweCAwcHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSknOwoJCXNuYWNrLnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gRW5zdXJlIGl0J3Mgb24gdG9wIG9mIG90aGVyIGVsZW1lbnRzCgkJc25hY2suc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7IC8vIENlbnRlciB0ZXh0IGhvcml6b250YWxseQoKCQkvLyBTdGVwIDM6IEFwcGVuZCB0aGUgc25hY2sgdG8gdGhlIGJvZHkKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNuYWNrKTsKCgkJLy8gU3RlcCA0OiBSZW1vdmUgdGhlIHNuYWNrIGFmdGVyIDYgc2Vjb25kcwoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCXNuYWNrLnJlbW92ZSgpOwoJCX0sIDEwMDApOyAvLyAxMDAwIG1pbGxpc2Vjb25kcyA9IDEgc2Vjb25kcwoJfQoJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7CgkJdmFyIHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwoJCWlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5yYW5nZUNvdW50IDw9IDApIHJldHVybjsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oKSB7CgkJCXZhciBodG1sU291cmNlID0gZ2V0U2VsZWN0aW9uSHRtbCgpOwoJCQlpZiAoIWh0bWxTb3VyY2UpIHJldHVybjsKCgkJCW5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGh0bWxTb3VyY2UpLnRoZW4oZnVuY3Rpb24oKSB7CgkJCQlzaG93U25hY2sodHJ1ZSwgJ0NvcHkgdGjDoG5oIGPDtG5nIScpOwoJCQl9KS5jYXRjaChmdW5jdGlvbihlcnIpIHsKCQkJCXNob3dTbmFjayhmYWxzZSwgJ0NvcHkgbOG7l2k6ICcgKyBlcnIpOwoJCQl9KTsKCQl9LCB7CgkJCW9uY2U6IHRydWUKCQl9KTsKCX0pOwo8L3NjcmlwdD4=");let p=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.html`;const _=new Blob([a],{type:"text/plain"});return void(_&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(_),p))}let r=this.userService.getUserObj(),c=b.c.azt_ai_base_api;this.commonService.loadAzotaDocxJs().then(()=>{(0,I.w)().textToDocxBinary(a,"Bearer "+r.rememberToken,c,null).then(g=>{let p=`azota-digitalize-book-${i.getDate()}${i.getMonth()+1}${i.getFullYear()}-${i.getTime()}.docx`;const _=new Blob([g],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});_&&this.commonService.downloadFileByUrl(window.URL.createObjectURL(_),p)}).catch(g=>{this.showErrorSnack(g)})}).catch(g=>{this.showErrorSnack(g)})}goToPage(e){this.myNavigation(`/azota-digitalized/digitalized-one-book/${this.bookId}/${e}`),this.pageObj.setTotalPages(this.objs.length),this.pageObj.setPageNumber(e);let i=this.pageObj.getViewObjsOfCurrentPage(this.objs).map(a=>a.id);this.objs.forEach(a=>a.isShow=!!i.includes(a.id)),this.totalCurrentItems=this.objs.filter(a=>a.isShow).length}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageGetObjsGet(this.bookId).subscribe(e=>{if(!e.success||!e.data)return this.errorStatusObj(e.message,!0);this.bookObj=e.data.bookObj,this.objs=e.data.bookPageObjs.map((i,a)=>({...i,isShow:!1,currentPage:a+1,ocrContent:i.ocrContent?this.sAztZipDataService.decodeContentGzip(i.ocrContent):void 0,originOcrContent:i.originOcrContent?this.sAztZipDataService.decodeContentGzip(i.originOcrContent):void 0,logMessage:i.isOrc?void 0:"lang_cms_admin_digitalized_not_call_ocr_status",currentStatus:i.isOrc?"show_edit_form":"none",base64Images:[],htmlContentFormControl:new d.MJ("",{nonNullable:!0})}))??[],this.goToPage(Number(this.commonService.getMyParam(this.activeRoute,"page")??0)),this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_digitalized_one_book_title",description:"lang_cms_admin_digitalized_one_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.initData()}constructor(e,i,a,r,c,g){super(),this.digitalizedBookPageService=e,this.activeRoute=i,this.sAztZipDataService=a,this.sAztDigitalizeService=r,this.sAztConcurrencyApiService=c,this.userService=g,this.objs=[],this.bookId=0,this.backTo="/azota-digitalized/list-books",this.pageObj=new f.d(10),this.totalCurrentItems=0}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(h.gI),t.rXU(v.nX),t.rXU(it.j),t.rXU(T),t.rXU(Z.Z),t.rXU(rt.R))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-digitalized-one-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],["class","mt-5",4,"ngIf"],[1,"mt-5"],[1,"flex","items-center","mb-3","pb-3",2,"border-bottom","1px solid #ccc"],[1,"btn","btn-primary","mr-3",3,"click"],[1,"btn","btn-success","mr-3",3,"click"],[1,"box"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","flex-wrap","sm:flex-row","sm:flex-nowrap","items-center","mt-3"],[1,"w-full","sm:w-auto","sm:mr-auto"],[3,"goToPaginationPage","pageObj"],[4,"ngIf"],[3,"obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent",4,"ngIf"],[3,"bookObj","obj","changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent",4,"ngIf"],[3,"obj",4,"ngIf"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","obj"],[3,"changeBookPageStatusEvent","callAgainOcrBookPageEvent","saveAllContentEvent","bookObj","obj"],[3,"obj"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",1),t.DNE(1,yt,1,1,"azt-loading-effect",2)(2,Pt,1,1,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",i.statusObj.loading)("ngIfElse",a)}},dependencies:[m.Sq,m.bT,x.K,ct.q,G.Q,ut,bt,St,u.wp],encapsulation:2}),l})();class Vt{static validBookPage(l){const n=l;return n.controls.filter(i=>i.controls.isShow.value).length>0?(l.setErrors(null),null):(n.setErrors({validBookPage:!0}),{identityRevealed:!0})}}var Ut=s(15766);let K=(()=>{var o;class l extends z.H{removeBackgroundNoise(e){this.initStatusObj();let a=this.form.controls.bookPageFormArray.getRawValue().filter(r=>(!!e||r.isSelected)&&r.isShow).map(r=>this.sAztDigitalizeService.runRemoveBackgroundNoise({uuid:r.randomUuid,oldImageUrl:r.imageLink,newImageUrl:""},this.defaultThreshold,c=>console.log("Remove noise error",c)));this.waitDestroy(this.sAztConcurrencyApiService.processObservables(20,a,!1).subscribe(r=>{let c=this.form.controls.bookPageFormArray.getRawValue();c.forEach(g=>{let p=r.find(_=>_?.uuid==_?.uuid)?.newImageUrl;p&&(g.imageLink=p,g.needUpdate=!0)}),this.form.controls.bookPageFormArray.patchValue(c),this.stopStatusObj()}))}selectAll(e){this.form.controls.bookPageFormArray.controls.map(i=>i.controls.isSelected.setValue(e))}deleteAllSelected(){this.form.controls.bookPageFormArray.controls.forEach(e=>{e.controls.isSelected.value&&e.controls.isShow.setValue(!1)})}countSelected(){this.totalPage=this.form.controls.bookPageFormArray.getRawValue().filter(e=>e.isShow).length,this.totalSelectedPage=this.form.controls.bookPageFormArray.getRawValue().filter(e=>e.isShow&&e.isSelected).length}cancel(){this.commonService.myNavigation(this.backTo)}handleUploadComplete(e){e.forEach(i=>{i.url&&this.form.controls.bookPageFormArray.push(new d.gE({id:new d.MJ(0,{nonNullable:!0}),randomUuid:new d.MJ(this.sAztUuidService.getUuid(),{nonNullable:!0}),name:new d.MJ(i.name??"",{nonNullable:!0}),imageLink:new d.MJ(i.url,{nonNullable:!0}),isShow:new d.MJ(!0,{nonNullable:!0}),isSelected:new d.MJ(!1,{nonNullable:!0}),needUpdate:new d.MJ(!1,{nonNullable:!0})}))}),this.form.controls.bookPageFormArray.updateValueAndValidity()}removeBookPageObj(e){let i=this.form.controls.bookPageFormArray.controls.find(a=>a.controls.randomUuid.value==e);i?.controls.isShow.setValue(!1),this.form.controls.bookPageFormArray.updateValueAndValidity()}constructor(){super(),this.sAztUuidService=(0,t.WQX)(W.D),this.sAztDigitalizeService=(0,t.WQX)(T),this.sAztConcurrencyApiService=(0,t.WQX)(Z.Z),this.backTo="",this.allUploadToCdnMenuTypes=$.b8,this.allUploadFileTypes=$.PO,this.totalSelectedPage=0,this.totalPage=0,this.defaultThreshold=230,this.form=new d.gE({name:new d.MJ("",{nonNullable:!0,validators:[Ut.M.noWhiteSpace]}),bookPageFormArray:new d.Yp([],{validators:[Vt.validBookPage]})}),this.form.valueChanges.subscribe(e=>this.countSelected())}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-base-create-or-update-book"]],features:[t.Vt3],decls:0,vars:0,template:function(e,i){},encapsulation:2}),l})();var Nt=s(92091),$t=s(64168),q=s(63349);const Mt=o=>({"error-border":o}),Yt=(o,l)=>[o,l];function Xt(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",4),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function Lt(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(i){t.eBV(n);const a=t.XpG(2);return t.Njj(a.handleUploadComplete(i))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&o){const n=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",n.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,Yt,n.allUploadFileTypes.IMAGE,n.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function Jt(o,l){if(1&o){const n=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&o){const n=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",n.totalSelectedPage,"/",n.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",n.totalSelectedPage,"/",n.totalPage,")")}}function Wt(o,l){1&o&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function Zt(o,l){if(1&o&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&o){const n=l.$implicit,e=l.index;t.R7$(),t.Y8G("hidden",!n.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",n.controls.imageLink.value),t.R7$(),t.Y8G("src",n.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(e+1),t.R7$(),t.Y8G("formControl",n.controls.isSelected)}}function Ht(o,l){if(1&o&&(t.j41(0,"div",31),t.DNE(1,Zt,8,5,"ng-container",32),t.k0s()),2&o){const n=t.XpG(2);t.R7$(),t.Y8G("ngForOf",n.form.controls.bookPageFormArray.controls)}}function Qt(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,Lt,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.selectAll(i.totalSelectedPage!=i.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,Jt,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,Wt,3,3,"div",25)(34,Ht,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&o){const n=t.sdS(35),e=t.XpG();t.R7$(),t.Y8G("formGroup",e.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,e.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",e.form.controls.name)("ngClass",t.eq3(35,Mt,e.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!e.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,e.totalSelectedPage!=e.totalPage?"lang_select_all":"lang_remove_all")," (",e.totalSelectedPage,"/",e.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",e.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",e.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",n),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let Kt=(()=>{var o;class l extends K{initForm(){}initData(){}saveObj(){this.initStatusObj();let e=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookAddObjPost({name:e.name}).subscribe(a=>{if(!a.success||!a.data?.obj)return this.errorStatusObj(a.message,!0);let r={bookId:a.data.obj.id,bookPageObjs:[]};e.bookPageFormArray.filter(c=>c.isShow).forEach(c=>{r.bookPageObjs.push({name:c.name,imageLink:c.imageLink})}),this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageAddObjsPost(r).subscribe(c=>{if(!c.success)return this.errorStatusObj(c.message,!0);this.successStatusObj("lang_cms_add_success",!0),this.cancel()}))}))}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_create_book_title",description:"lang_cms_admin_create_book_title",image:"lang_cms_test_image"}),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(e,i){super(),this.digitalizedBookService=e,this.digitalizedBookPageService=i,this.bookId=0}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(Nt.Z),t.rXU($t.g))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-create-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2),t.DNE(1,Xt,1,1,"azt-loading-effect",3)(2,Qt,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",1==i.statusObj.loading)("ngIfElse",a)}},dependencies:[m.YU,m.Sq,m.bT,d.qT,d.me,d.Zm,d.BC,d.cb,d.l_,d.j4,x.K,q.V,F,G.Q,k.WGl,u.wp],encapsulation:2}),l})();const qt=o=>({"error-border":o}),te=(o,l)=>[o,l];function ee(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",4),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function ie(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",14)(1,"div",15)(2,"azt-upload-multiple-box",27),t.bIt("uploadComplete",function(i){t.eBV(n);const a=t.XpG(2);return t.Njj(a.handleUploadComplete(i))}),t.j41(3,"div",28),t.nrm(4,"lucide-icon",29),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s()()()()}if(2&o){const n=t.XpG(2);t.R7$(2),t.Y8G("uploadToCdnMenu",n.allUploadToCdnMenuTypes.ADMIN_DIGITALIZE)("fileType",t.l_i(8,te,n.allUploadFileTypes.IMAGE,n.allUploadFileTypes.PDF))("convertPdfTimeout",600)("convertPdfToImages",!0)("showProgress",!0),t.R7$(3),t.SpI(" ",t.bMT(6,6,"lang_cms_admin_digitalized_upload_pdf_or_image_files")," ")}}function oe(o,l){if(1&o){const n=t.RV6();t.j41(0,"span"),t.EFF(1," | "),t.j41(2,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.removeBackgroundNoise(!1))}),t.EFF(3),t.nI1(4,"mytranslate"),t.k0s(),t.EFF(5," | "),t.j41(6,"span",30),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.deleteAllSelected())}),t.EFF(7),t.nI1(8,"mytranslate"),t.k0s()()}if(2&o){const n=t.XpG(2);t.R7$(3),t.E5c("",t.bMT(4,6,"lang_digitalized_remove_background_noise_of_selections")," (",n.totalSelectedPage,"/",n.totalPage,")"),t.R7$(4),t.E5c("",t.bMT(8,8,"lang_auto_xoa")," (",n.totalSelectedPage,"/",n.totalPage,")")}}function ne(o,l){1&o&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"lang_cms_admin_digitalized_upload_image_to_create_book")," "))}function ae(o,l){if(1&o&&(t.qex(0),t.j41(1,"div",33)(2,"azt-preview-image-tag",34),t.nrm(3,"img",35),t.k0s(),t.j41(4,"div",8)(5,"span",36),t.EFF(6),t.k0s(),t.nrm(7,"input",37),t.k0s()(),t.bVm()),2&o){const n=l.$implicit,e=l.index;t.R7$(),t.Y8G("hidden",!n.controls.isShow.value),t.R7$(),t.Y8G("imageUrl",n.controls.imageLink.value),t.R7$(),t.Y8G("src",n.controls.imageLink.value,t.B4B),t.R7$(3),t.JRh(e+1),t.R7$(),t.Y8G("formControl",n.controls.isSelected)}}function le(o,l){if(1&o&&(t.j41(0,"div",31),t.DNE(1,ae,8,5,"ng-container",32),t.k0s()),2&o){const n=t.XpG(2);t.R7$(),t.Y8G("ngForOf",n.form.controls.bookPageFormArray.controls)}}function se(o,l){if(1&o){const n=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"h3",9),t.EFF(5),t.nI1(6,"mytranslate"),t.k0s(),t.j41(7,"div",10)(8,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(9),t.nI1(10,"mytranslate"),t.k0s(),t.j41(11,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(12),t.nI1(13,"mytranslate"),t.k0s()()(),t.j41(14,"div",13)(15,"div",14)(16,"div",15)(17,"label",16),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s()(),t.j41(20,"div",15)(21,"div",17),t.nrm(22,"input",18),t.k0s()()(),t.DNE(23,ie,7,11,"div",19),t.nrm(24,"hr",20),t.j41(25,"span",21),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.selectAll(i.totalSelectedPage!=i.totalPage))}),t.EFF(26),t.nI1(27,"mytranslate"),t.j41(28,"span",22),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.removeBackgroundNoise(!0))}),t.EFF(29),t.nI1(30,"mytranslate"),t.k0s()(),t.DNE(31,oe,9,10,"span",23),t.j41(32,"div",24),t.DNE(33,ne,3,3,"div",25)(34,le,2,1,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(36,"div",26)(37,"button",11),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cancel())}),t.EFF(38),t.nI1(39,"mytranslate"),t.k0s(),t.j41(40,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.saveObj())}),t.EFF(41),t.nI1(42,"mytranslate"),t.k0s()()()()()}if(2&o){const n=t.sdS(35),e=t.XpG();t.R7$(),t.Y8G("formGroup",e.form),t.R7$(4),t.SpI(" ",t.bMT(6,19,e.bookId?"lang_cms_admin_edit_book_title":"lang_cms_admin_create_book_title")," "),t.R7$(4),t.JRh(t.bMT(10,21,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(13,23,"lang_auto_luu")),t.R7$(6),t.SpI(" ",t.bMT(19,25,"lang_cms_admin_create_book_name")," "),t.R7$(4),t.Y8G("formControl",e.form.controls.name)("ngClass",t.eq3(35,qt,e.form.controls.name.invalid)),t.R7$(),t.Y8G("ngIf",!e.bookId),t.R7$(3),t.E5c(" ",t.bMT(27,27,e.totalSelectedPage!=e.totalPage?"lang_select_all":"lang_remove_all")," (",e.totalSelectedPage,"/",e.totalPage,") | "),t.R7$(3),t.JRh(t.bMT(30,29,"lang_digitalized_remove_background_noise_of_all")),t.R7$(2),t.Y8G("ngIf",e.totalSelectedPage>0),t.R7$(2),t.Y8G("ngIf",e.form.controls.bookPageFormArray.controls.length<=0)("ngIfElse",n),t.R7$(5),t.JRh(t.bMT(39,31,"lang_auto_huy")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(),t.JRh(t.bMT(42,33,"lang_auto_luu"))}}let re=(()=>{var o;class l extends K{initForm(e){this.form.controls.name.setValue(e.bookObj.name),e.bookPageObjs.forEach(i=>{this.form.controls.bookPageFormArray.push(new d.gE({id:new d.MJ(i.id,{nonNullable:!0}),randomUuid:new d.MJ(i.id.toString(),{nonNullable:!0}),name:new d.MJ(i.name,{nonNullable:!0}),imageLink:new d.MJ(i.imageLink,{nonNullable:!0}),isShow:new d.MJ(!0,{nonNullable:!0}),isSelected:new d.MJ(!1,{nonNullable:!0}),needUpdate:new d.MJ(!1,{nonNullable:!0})}))})}initData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjGet(this.bookId).subscribe(e=>{if(!e.success||!e.data)return this.errorStatusObj(e.message,!0);this.initForm(e.data),this.stopStatusObj()}))}saveObj(){this.initStatusObj();let e=this.form.getRawValue();this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookUpdateObjPost({id:this.bookId,name:e.name}).subscribe(a=>{if(!a.success)return this.errorStatusObj(a.message,!0);let r={bookId:this.bookId,objs:e.bookPageFormArray.filter(g=>g.needUpdate&&g.id).map(g=>({bookPageId:g.id,imageLink:g.imageLink}))},c={bookId:this.bookId,ids:e.bookPageFormArray.filter(g=>!g.isShow&&g.id).map(g=>g.id)};if(r.objs.length<=0)return this.processDeleteImages(c);this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageUpdateImagesPost(r).subscribe(g=>{this.processDeleteImages(c)}))}))}processDeleteImages(e){e.ids.length>0?this.waitDestroy(this.digitalizedBookPageService.apiDigitalizedBookPageDeleteObjPost(e).subscribe(i=>{if(!i.success)return this.errorStatusObj(i.message,!0);this.successStatusObj("lang_cms_update_success",!0),this.cancel()})):(this.successStatusObj("lang_cms_update_success",!0),this.cancel())}ngOnInit(){super.ngOnInit(),this.commonService.translateMetaData({title:"lang_cms_admin_edit_book_title",description:"lang_cms_admin_edit_book_title",image:"lang_cms_test_image"}),this.bookId=Number(this.commonService.getMyParam(this.activeRoute,"bookId")??0),this.backTo="/azota-digitalized/list-books",this.initData()}constructor(e,i,a){super(),this.digitalizedBookService=e,this.digitalizedBookPageService=i,this.activeRoute=a,this.bookId=0}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(h.ZD),t.rXU(h.gI),t.rXU(v.nX))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-update-book"]],features:[t.Vt3],decls:4,vars:3,consts:[["doneLoading",""],["viewBookPageTpl",""],[3,"headerBackToLink"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"mt-5"],[3,"formGroup"],[1,"azt-config-document"],[1,"flex","items-center"],[1,"text-md","uppercase","font-medium","w-full"],[1,"flex-none","items-center"],[1,"btn","w-24","btn-secondary","mr-3",3,"click"],[1,"btn","btn-primary-soft","w-24",3,"click","disabled"],[1,"box","mt-4","p-5"],[1,"grid","grid-cols-12","mb-3"],[1,"col-span-12","lg:col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["type","text",1,"form-control",3,"formControl","ngClass"],["class","grid grid-cols-12 mb-3",4,"ngIf"],[1,"mb-3"],[1,"clickable","link-color","mr-2",3,"click"],[1,"clickable","text-primary","mr-2","ml-2",3,"click"],[4,"ngIf"],[1,"mt-3","mb-3"],[4,"ngIf","ngIfElse"],[1,"text-right","mt-5"],[3,"uploadComplete","uploadToCdnMenu","fileType","convertPdfTimeout","convertPdfToImages","showProgress"],[1,"h-full","w-full","cursor-pointer","text-primary"],["name","cloud-upload","size","24"],[1,"clickable","text-danger","mr-2","ml-2",3,"click"],[1,"sml-3","smr-3"],[4,"ngFor","ngForOf"],[1,"ml-3","mr-3","mb-3","p-3","bg-slate-100","box","inline-block",3,"hidden"],[1,"clickable",3,"imageUrl"],[1,"clickable",2,"width","250px","height","120px",3,"src"],[1,"w-full","text-pending","font-medium"],["type","checkbox",1,"form-check-input","mt-1",3,"formControl"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2),t.DNE(1,ee,1,1,"azt-loading-effect",3)(2,se,43,37,"ng-template",null,0,t.C5r),t.k0s()),2&e){const a=t.sdS(3);t.Y8G("headerBackToLink",i.backTo),t.R7$(),t.Y8G("ngIf",1==i.statusObj.loading)("ngIfElse",a)}},dependencies:[m.YU,m.Sq,m.bT,d.qT,d.me,d.Zm,d.BC,d.cb,d.l_,d.j4,x.K,q.V,F,G.Q,k.WGl,u.wp],encapsulation:2}),l})();var ce=s(75421),tt=s(25329);const ge=o=>[o],X=()=>({"mr-1":!0});function de(o,l){if(1&o&&t.nrm(0,"azt-loading-effect",5),2&o){const n=t.XpG();t.Y8G("currentStatusObj",n.statusObj)}}function me(o,l){1&o&&(t.j41(0,"span",25),t.nrm(1,"azt-loading-ui"),t.k0s())}function pe(o,l){if(1&o){const n=t.RV6();t.qex(0),t.j41(1,"mat-card",13)(2,"mat-card-content",14)(3,"div",15)(4,"div",7)(5,"b"),t.EFF(6),t.k0s(),t.EFF(7),t.k0s(),t.j41(8,"div",16)(9,"button",17),t.nI1(10,"navigationLocalize"),t.nrm(11,"lucide-icon",18),t.j41(12,"span",19),t.EFF(13),t.nI1(14,"mytranslate"),t.k0s()(),t.j41(15,"a",20),t.nI1(16,"navigationLocalize"),t.nrm(17,"lucide-icon",21),t.EFF(18),t.nI1(19,"mytranslate"),t.k0s(),t.j41(20,"button",22),t.bIt("click",function(){const i=t.eBV(n).$implicit,a=t.XpG(3);return t.Njj(a.deleteObj(i))}),t.DNE(21,me,2,0,"span",23),t.nrm(22,"lucide-icon",24),t.j41(23,"span",19),t.EFF(24),t.nI1(25,"mytranslate"),t.k0s()()()()()(),t.bVm()}if(2&o){const n=l.$implicit,e=l.index,i=t.XpG(3);t.R7$(6),t.SpI("",e+1,"."),t.R7$(),t.E5c(" ",n.name," (",n.totalDone," / ",n.totalPage,") "),t.R7$(2),t.Y8G("routerLink",t.bMT(10,13,"/azota-digitalized/digitalized-one-book/"+n.id+"/1")),t.R7$(2),t.Y8G("ngClass",t.lJ4(23,X)),t.R7$(2),t.JRh(t.bMT(14,15,"lang_cms_admin_digitalized_digitalized_btn")),t.R7$(2),t.Y8G("routerLink",t.bMT(16,17,"/azota-digitalized/edit-book/"+n.id)),t.R7$(2),t.Y8G("ngClass",t.lJ4(24,X)),t.R7$(),t.SpI(" ",t.bMT(19,19,"lang_auto_sua")," "),t.R7$(3),t.Y8G("ngIf",i.deletingId==n.id),t.R7$(),t.Y8G("ngClass",t.lJ4(25,X)),t.R7$(2),t.JRh(t.bMT(25,21,"lang_auto_xoa"))}}function _e(o,l){if(1&o&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.DNE(3,pe,26,26,"ng-container",12),t.k0s()(),t.bVm()),2&o){const n=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",n.objs)}}function ue(o,l){1&o&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"mytranslate"),t.k0s()),2&o&&(t.R7$(),t.JRh(t.bMT(2,1,"lang_cms_admin_digitalized_there_is_no_book")))}function be(o,l){if(1&o&&(t.j41(0,"div",6)(1,"span",7),t.EFF(2),t.nI1(3,"mytranslate"),t.k0s(),t.j41(4,"a",8),t.nI1(5,"navigationLocalize"),t.EFF(6),t.nI1(7,"mytranslate"),t.k0s()(),t.DNE(8,_e,4,1,"ng-container",9)(9,ue,3,3,"ng-template",null,1,t.C5r)),2&o){const n=t.sdS(10),e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"lang_cms_admin_common_digitalize_list_book")),t.R7$(2),t.Y8G("routerLink",t.eq3(11,ge,t.bMT(5,7,"/azota-digitalized/create-book"))),t.R7$(2),t.JRh(t.bMT(7,9,"lang_common_create")),t.R7$(2),t.Y8G("ngIf",e.objs.length>0)("ngIfElse",n)}}const ze=[{path:"",component:N.z,children:[{path:"list-books",component:(()=>{var o;class l extends z.H{deleteObj(e){const i=this.commonService.myTranslateInstant("lang_cms_admin_digitalized_are_your_sure_to_delete_this_book")+`: <b>${e.name}<b/>?`;this.sAztDialogService.open(ce.u,{data:{content:i},restoreFocus:!1,width:"500px"}).afterClosed().subscribe(a=>{a&&(this.deletingId=e.id,this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookDeleteObjPost({ids:[e.id]}).subscribe(r=>{if(this.deletingId=void 0,!r.success)return this.errorStatusObj(r.message,!0);this.objs=this.objs.filter(c=>c.id!=e.id)})))})}getData(){this.initStatusObj(),this.waitDestroy(this.digitalizedBookService.apiDigitalizedBookGetObjsGet().subscribe(e=>{if(!e.success)return this.errorStatusObj(e.message,!0);this.objs=e.data?.objs??[],this.stopStatusObj()}))}ngOnInit(){super.ngOnInit(),this.getData(),this.commonService.translateMetaData({title:"lang_cms_admin_common_digitalize_list_book",description:"lang_cms_admin_common_digitalize_list_book",image:"lang_cms_test_image"}),this.headerBackTo=this.commonService.getMyQueryParam("backTo")??"/super-role/admin-tool"}constructor(e,i){super(),this.digitalizedBookService=e,this.sAztDialogService=i,this.headerBackTo="",this.objs=[]}}return(o=l).\u0275fac=function(e){return new(e||o)(t.rXU(h.ZD),t.rXU(M.i))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-digitalized-list-books"]],features:[t.Vt3],decls:5,vars:3,consts:[["doneLoading",""],["emptyList",""],[3,"headerBackToLink"],[1,"container-fluid","component-wrap","centerBoth","hasBg","mt-3"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[1,"flex","items-center","mb-3"],[1,"w-full"],[1,"flex-none","btn","btn-primary",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],["appearance","outlined",1,"mb-2",2,"background-color","#fff","border","none"],[1,"form-control",2,"overflow-y","auto"],[1,"flex","align-items-center"],[1,"flex-none","items-center"],[1,"btn","btn-sm","btn-success-soft","mr-2",3,"routerLink"],["name","eye","size","18",3,"ngClass"],[1,"azt-hidden","md:inline-block"],[1,"btn","btn-sm","btn-primary-soft","mr-2",3,"routerLink"],["name","square-pen","size","18",3,"ngClass"],[1,"btn","btn-sm","btn-danger-soft",3,"click"],["class","w-4 h-4 flex mr-1",4,"ngIf"],["name","trash-2","size","18",3,"ngClass"],[1,"w-4","h-4","flex","mr-1"],[1,"text-center"]],template:function(e,i){if(1&e&&(t.j41(0,"teacher-layout",2)(1,"div",3),t.DNE(2,de,1,1,"azt-loading-effect",4)(3,be,11,13,"ng-template",null,0,t.C5r),t.k0s()()),2&e){const a=t.sdS(4);t.Y8G("headerBackToLink",i.headerBackTo),t.R7$(2),t.Y8G("ngIf",i.statusObj.loading)("ngIfElse",a)}},dependencies:[v.Wk,m.YU,m.Sq,m.bT,tt.RN,tt.m2,x.K,Y.R,G.Q,k.WGl,u.F2,u.wp],encapsulation:2}),l})()},{path:"create-book",component:Kt},{path:"edit-book/:bookId",component:re},{path:"digitalized-one-book/:bookId/:page",component:wt}]}];let fe=(()=>{var o;class l{}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[v.iI.forChild(ze),v.iI,C.XE]}),l})(),ke=(()=>{var o;class l{}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({providers:[{provide:j.vn,useValue:b.c.azt_tiny_mce_script_src}],imports:[v.iI,m.MD,d.YN,j.sv,P.s,d.X1,fe,U.Q,w.L,E.Id,V.b,k.flO.pick(k.Ptg),S.AC,D.DL,R.An]}),l})()}}]);