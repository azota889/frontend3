"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[4847],{88089:(R,M,a)=>{a.d(M,{J:()=>b});var e=a(27691),y=a(51698),m=a(64198),c=a(48891),E=a(543),p=a(48451),v=a(63709);let b=(()=>{var w;class P{replaceImageInContent(n){return new y.c(o=>{if(n.includes("<img ")){var s=this.findAllSubString(n,"<img"),r=[],d=[];s.forEach(u=>{var l=n.indexOf("src=",u),_=n.indexOf('"',Number(l)+5),g=n.substring(Number(l)+5,Number(_)+1);g.includes(";base64")?r.push({oldUrl:g}):g.includes("blob:")&&d.push({oldUrl:g})}),r.length>0?this.reUploadBase64File(r,(u,l)=>{null==l?d&&d.length>0?this.reUploadBlobFile(d,(_,g)=>{null!=g?(n=this.replaceHomeworkContent(n,u),n=this.replaceHomeworkContent(n,_),o.next({errorMessage:void 0,content:n}),o.complete()):(o.next({errorMessage:g,content:n}),o.complete())}):(n=this.replaceHomeworkContent(n,u),o.next({errorMessage:void 0,content:n}),o.complete()):(o.next({errorMessage:l,content:n}),o.complete())}):d.length>0?this.reUploadBlobFile(d,(u,l)=>{null==l?(n=this.replaceHomeworkContent(n,u),o.next({errorMessage:void 0,content:n}),o.complete()):(o.next({errorMessage:l,content:n}),o.complete())}):(n=this.replaceHomeworkContent(n,[]),o.next({errorMessage:void 0,content:n}),o.complete())}else o.next({errorMessage:void 0,content:n}),o.complete()})}replaceHomeworkContent(n,o){return o.length>0&&o.forEach(s=>{n=n.replace(s.oldUrl??"  ",s.newUrl+'" class="w-100 img-fluid"')}),n}findAllSubString(n,o){for(var s=0,r=0,d=[];n.indexOf(o,s)>-1;)r=n.indexOf(o,s),d.push(r),s=r+o.length;return d}getTypeFile(n){var o=n.indexOf(";");return n.substring(5,o)}getFileName(n){var o=n.split("").reverse().join(""),s=o.indexOf(";"),r=o.indexOf("/",s);return o.substring(s,r).split("").reverse().join("")}convertBlobToBase64(n){return new Promise(o=>{var s=new Image;s.crossOrigin="Anonymous",s.addEventListener("load",function(){var r=document.createElement("canvas"),d=r.getContext("2d");r.width=s.width,r.height=s.height,d?.drawImage(s,0,0);var u=r.toDataURL("image/png");o(u)},!1),s.src=n})}reUploadBase64File(n,o){if(n&&n.length>0){let u,d=n.length;for(var s=[],r=0;r<n.length;r++){const l=n[r],_=l.oldUrl?.substring(0,l.oldUrl.length-1);this.startUploadBlobFile(l,_??"",[],(g,B)=>{null==B?s=s.concat(g):u=B,d-=1,0==d&&o(s,u)})}}else o([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(n,o){if(n&&n.length>0){let u,d=n.length;for(var s=[],r=0;r<n.length;r++){const l=n[r],_=l?.oldUrl?.substring(0,l.oldUrl.length-1);this.convertBlobToBase64(_??"").then(g=>{this.startUploadBlobFile(l,g,[],(B,S)=>{null==S?s=s.concat(B):u=S,d-=1,0==d&&o(s,u)})})}}else o([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(n,o,s,r){if(o&&""!=o){var d=this.getTypeFile(o),u=this.myPdfService.b64toFile(o,this.getFileName(d),d);(0,m.w4)(u).then(l=>{this.apiUploadService.uploadToCdnForHomework(l).subscribe(_=>{if(_.type!=e.hv.UploadProgress)if(1==_.success){var g={...n,newUrl:_.data?.url??""};s.push(g),r(s,void 0)}else r(s,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",_.message??"none"))})})}else r(s,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(n,o,s){this.commonService=n,this.apiUploadService=o,this.myPdfService=s}}return(w=P).\u0275fac=function(n){return new(n||w)(c.KVO(E.R),c.KVO(p.T),c.KVO(v.C))},w.\u0275prov=c.jDH({token:w,factory:w.\u0275fac,providedIn:"root"}),P})()},25777:(R,M,a)=>{a.d(M,{Z:()=>e});class e{static customDateTimeValidator(m){const p=m.controls.endTime;let v=m.controls.startTime.value,b=p.value;return v&&b&&!e.isValidStartTimeEndTime(v,b)?(p?.setErrors({customDateTimeValidator:!0}),{identityRevealed:!0}):(p?.setErrors(null),null)}static isValidStartTimeEndTime(m,c){let E=new Date(m),p=new Date(1e3*e.getSecondOfDateWithZeroSecond(E)),v=c?new Date(c):new Date;return new Date(1e3*e.getSecondOfDateWithZeroSecond(v)).getTime()-p.getTime()>0}static getSecondOfDateWithZeroSecond(m){var c=m.getSeconds();return Math.floor(m.getTime()/1e3)-c}}},69223:(R,M,a)=>{a.d(M,{sv:()=>N,xn:()=>U});var e=a(48891),y=a(54460),m=a(10936),c=a(909),E=a(56381),p=a(18447),v=a(5424),b=a(37610),w=a(66590),P=a(88249);function k(t,h){}const n=()=>{const t=typeof window<"u"?window:void 0;return t&&t.tinymce?t.tinymce:null};let o=(()=>{class t{constructor(){this.onBeforePaste=new e.bkB,this.onBlur=new e.bkB,this.onClick=new e.bkB,this.onContextMenu=new e.bkB,this.onCopy=new e.bkB,this.onCut=new e.bkB,this.onDblclick=new e.bkB,this.onDrag=new e.bkB,this.onDragDrop=new e.bkB,this.onDragEnd=new e.bkB,this.onDragGesture=new e.bkB,this.onDragOver=new e.bkB,this.onDrop=new e.bkB,this.onFocus=new e.bkB,this.onFocusIn=new e.bkB,this.onFocusOut=new e.bkB,this.onKeyDown=new e.bkB,this.onKeyPress=new e.bkB,this.onKeyUp=new e.bkB,this.onMouseDown=new e.bkB,this.onMouseEnter=new e.bkB,this.onMouseLeave=new e.bkB,this.onMouseMove=new e.bkB,this.onMouseOut=new e.bkB,this.onMouseOver=new e.bkB,this.onMouseUp=new e.bkB,this.onPaste=new e.bkB,this.onSelectionChange=new e.bkB,this.onActivate=new e.bkB,this.onAddUndo=new e.bkB,this.onBeforeAddUndo=new e.bkB,this.onBeforeExecCommand=new e.bkB,this.onBeforeGetContent=new e.bkB,this.onBeforeRenderUI=new e.bkB,this.onBeforeSetContent=new e.bkB,this.onChange=new e.bkB,this.onClearUndos=new e.bkB,this.onDeactivate=new e.bkB,this.onDirty=new e.bkB,this.onExecCommand=new e.bkB,this.onGetContent=new e.bkB,this.onHide=new e.bkB,this.onInit=new e.bkB,this.onInitNgModel=new e.bkB,this.onLoadContent=new e.bkB,this.onNodeChange=new e.bkB,this.onPostProcess=new e.bkB,this.onPostRender=new e.bkB,this.onPreInit=new e.bkB,this.onPreProcess=new e.bkB,this.onProgressState=new e.bkB,this.onRedo=new e.bkB,this.onRemove=new e.bkB,this.onReset=new e.bkB,this.onResizeEditor=new e.bkB,this.onSaveContent=new e.bkB,this.onSetAttrib=new e.bkB,this.onObjectResizeStart=new e.bkB,this.onObjectResized=new e.bkB,this.onObjectSelected=new e.bkB,this.onSetContent=new e.bkB,this.onShow=new e.bkB,this.onSubmit=new e.bkB,this.onUndo=new e.bkB,this.onVisualAid=new e.bkB}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275dir=e.FsC({type:t,outputs:{onBeforePaste:"onBeforePaste",onBlur:"onBlur",onClick:"onClick",onContextMenu:"onContextMenu",onCopy:"onCopy",onCut:"onCut",onDblclick:"onDblclick",onDrag:"onDrag",onDragDrop:"onDragDrop",onDragEnd:"onDragEnd",onDragGesture:"onDragGesture",onDragOver:"onDragOver",onDrop:"onDrop",onFocus:"onFocus",onFocusIn:"onFocusIn",onFocusOut:"onFocusOut",onKeyDown:"onKeyDown",onKeyPress:"onKeyPress",onKeyUp:"onKeyUp",onMouseDown:"onMouseDown",onMouseEnter:"onMouseEnter",onMouseLeave:"onMouseLeave",onMouseMove:"onMouseMove",onMouseOut:"onMouseOut",onMouseOver:"onMouseOver",onMouseUp:"onMouseUp",onPaste:"onPaste",onSelectionChange:"onSelectionChange",onActivate:"onActivate",onAddUndo:"onAddUndo",onBeforeAddUndo:"onBeforeAddUndo",onBeforeExecCommand:"onBeforeExecCommand",onBeforeGetContent:"onBeforeGetContent",onBeforeRenderUI:"onBeforeRenderUI",onBeforeSetContent:"onBeforeSetContent",onChange:"onChange",onClearUndos:"onClearUndos",onDeactivate:"onDeactivate",onDirty:"onDirty",onExecCommand:"onExecCommand",onGetContent:"onGetContent",onHide:"onHide",onInit:"onInit",onInitNgModel:"onInitNgModel",onLoadContent:"onLoadContent",onNodeChange:"onNodeChange",onPostProcess:"onPostProcess",onPostRender:"onPostRender",onPreInit:"onPreInit",onPreProcess:"onPreProcess",onProgressState:"onProgressState",onRedo:"onRedo",onRemove:"onRemove",onReset:"onReset",onResizeEditor:"onResizeEditor",onSaveContent:"onSaveContent",onSetAttrib:"onSetAttrib",onObjectResizeStart:"onObjectResizeStart",onObjectResized:"onObjectResized",onObjectSelected:"onObjectSelected",onSetContent:"onSetContent",onShow:"onShow",onSubmit:"onSubmit",onUndo:"onUndo",onVisualAid:"onVisualAid"}}),t})();const s=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onResizeEditor","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],r=(t,h,i)=>(0,c.R)(t,h).pipe((0,v.Q)(i)),l=(t,h)=>"string"==typeof t?t.split(",").map(i=>i.trim()):Array.isArray(t)?t:h;let _=0;const B=t=>typeof t<"u"&&"textarea"===t.tagName.toLowerCase(),S=t=>typeof t>"u"||""===t?[]:Array.isArray(t)?t:t.split(" "),x=(t,h)=>S(t).concat(S(h)),K=()=>{},T=t=>null==t,F=(()=>{let t={script$:null};return{load:(f,D)=>t.script$||(t.script$=(0,E.v)(()=>{const C=f.createElement("script");return C.referrerPolicy="origin",C.type="application/javascript",C.src=D,f.head.appendChild(C),(0,c.R)(C,"load").pipe((0,b.s)(1),(0,w.u)(void 0))}).pipe((0,P.t)({bufferSize:1,refCount:!0}))),reinitialize:()=>{t={script$:null}}}})(),z=new e.nKC("TINYMCE_SCRIPT_SRC"),j={provide:m.kq,useExisting:(0,e.Rfq)(()=>U),multi:!0};let U=(()=>{class t extends o{constructor(i,f,D,C){super(),this.platformId=D,this.tinymceScriptSrc=C,this.cloudChannel="6",this.apiKey="no-api-key",this.id="",this.modelEvents="change input undo redo",this.onTouchedCallback=K,this.destroy$=new p.B,this.initialise=()=>{const I={...this.init,selector:void 0,target:this._element,inline:this.inline,readonly:this.disabled,plugins:x(this.init&&this.init.plugins,this.plugins),toolbar:this.toolbar||this.init&&this.init.toolbar,setup:O=>{this._editor=O,r(O,"init",this.destroy$).subscribe(()=>{this.initEditor(O)}),((t,h,i)=>{(t=>{const h=l(t.ignoreEvents,[]);return l(t.allowedEvents,s).filter(f=>s.includes(f)&&!h.includes(f))})(t).forEach(D=>{const C=t[D];r(h,D.substring(2),i).subscribe(I=>{C.observers.length>0&&t.ngZone.run(()=>C.emit({event:I,editor:h}))})})})(this,O,this.destroy$),this.init&&"function"==typeof this.init.setup&&this.init.setup(O)}};B(this._element)&&(this._element.style.visibility=""),this.ngZone.runOutsideAngular(()=>{n().init(I)})},this._elementRef=i,this.ngZone=f}set disabled(i){this._disabled=i,this._editor&&this._editor.initialized&&("function"==typeof this._editor.mode?.set?this._editor.mode.set(i?"readonly":"design"):this._editor.setMode(i?"readonly":"design"))}get disabled(){return this._disabled}get editor(){return this._editor}writeValue(i){this._editor&&this._editor.initialized?this._editor.setContent(T(i)?"":i):this.initialValue=null===i?void 0:i}registerOnChange(i){this.onChangeCallback=i}registerOnTouched(i){this.onTouchedCallback=i}setDisabledState(i){this.disabled=i}ngAfterViewInit(){(0,y.UE)(this.platformId)&&(this.id=this.id||(t=>{const i=(new Date).getTime(),f=Math.floor(1e9*Math.random());return _++,"tiny-angular_"+f+_+String(i)})(),this.inline=void 0!==this.inline?!1!==this.inline:!!this.init?.inline,this.createElement(),null!==n()?this.initialise():this._element&&this._element.ownerDocument&&F.load(this._element.ownerDocument,this.getScriptSrc()).pipe((0,v.Q)(this.destroy$)).subscribe(this.initialise))}ngOnDestroy(){this.destroy$.next(),null!==n()&&n().remove(this._editor)}createElement(){this._element=document.createElement(this.inline?"string"==typeof this.tagName?this.tagName:"div":"textarea"),this._element&&(document.getElementById(this.id)&&console.warn(`TinyMCE-Angular: an element with id [${this.id}] already exists. Editors with duplicate Id will not be able to mount`),this._element.id=this.id,B(this._element)&&(this._element.style.visibility="hidden"),this._elementRef.nativeElement.appendChild(this._element))}getScriptSrc(){return T(this.tinymceScriptSrc)?`https://cdn.tiny.cloud/1/${this.apiKey}/tinymce/${this.cloudChannel}/tinymce.min.js`:this.tinymceScriptSrc}initEditor(i){r(i,"blur",this.destroy$).subscribe(()=>{this.ngZone.run(()=>this.onTouchedCallback())}),r(i,this.modelEvents,this.destroy$).subscribe(()=>{this.ngZone.run(()=>this.emitOnChange(i))}),"string"==typeof this.initialValue&&this.ngZone.run(()=>{i.setContent(this.initialValue),i.getContent()!==this.initialValue&&this.emitOnChange(i),void 0!==this.onInitNgModel&&this.onInitNgModel.emit(i)})}emitOnChange(i){this.onChangeCallback&&this.onChangeCallback(i.getContent({format:this.outputFormat}))}}return t.\u0275fac=function(i){return new(i||t)(e.rXU(e.aKT),e.rXU(e.SKi),e.rXU(e.Agw),e.rXU(z,8))},t.\u0275cmp=e.VBU({type:t,selectors:[["editor"]],inputs:{cloudChannel:"cloudChannel",apiKey:"apiKey",init:"init",id:"id",initialValue:"initialValue",outputFormat:"outputFormat",inline:"inline",tagName:"tagName",plugins:"plugins",toolbar:"toolbar",modelEvents:"modelEvents",allowedEvents:"allowedEvents",ignoreEvents:"ignoreEvents",disabled:"disabled"},standalone:!0,features:[e.Jv_([j]),e.Vt3,e.aNF],decls:1,vars:0,template:function(i,f){1&i&&e.DNE(0,k,0,0,"ng-template")},dependencies:[y.MD,m.YN],styles:["[_nghost-%COMP%]{display:block}"]}),t})(),N=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[U]}),t})()}}]);