"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[7638],{67638:($e,me,w)=>{w.d(me,{x:()=>Te});var ee=w(43234),t=w(66114),M=w(48891),ue=w(543),fe=w(9691),ve=w(84708),ye=w(10296),pe=w(68774),ge=w(51113);let Te=(()=>{var R;class te{exportExcelForCodeNumber(n){let m=this.commonService.myTranslateInstant("lang_auto_stt")??"",l=this.commonService.myTranslateInstant("lang_auto_ho_va_ten")??"",i=this.commonService.myTranslateInstant("lang_auto_ngay_sinh")??"",s=this.commonService.myTranslateInstant("lang_auto_lop")??"",o=this.commonService.myTranslateInstant("lang_auto_so_bao_danh_6_so")??"",v=this.commonService.myTranslateInstant("lang_number_phone")??"",f="*"+this.commonService.myTranslateInstant("lang_auto_export_sbg_comment_one"),p="*"+this.commonService.myTranslateInstant("lang_auto_export_sbg_comment_two"),S=[m,l,i,o,v,s],g=[];for(let u=0;u<n.length;u++){let d=n[u],h="";h=0===u?f:h,g.push({[m]:u+1,[l]:d.fullName,[o]:this.formatAnswerSheetService.formatStudentCodeToNumber(d.code,ee.c.maxStudentCodeLength),[v]:d.phone,[i]:d.birthday?this.timeService.getFormatDate(d.birthday):"",[s]:d.className," ":"","":h})}if(n.length<3)for(let u=n.length;u<3;u++){let d="";d=0===u?f:d,d=1===u?p:d,g.push({[m]:"",[l]:"",[o]:"",[v]:"",[i]:"",[s]:""," ":"","":d})}let y=t.utils.aoa_to_sheet([S]);const r=t.utils.book_new();t.utils.book_append_sheet(r,y,"Sheet1"),t.utils.sheet_add_json(y,g,{origin:-1,header:S,skipHeader:!0});const I=t.write(r,{bookType:"xlsx",type:"array"});return new Blob([I],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"})}exportExcelForPayment(n){var m=[];let l=this.commonService.myTranslateInstant("lang_auto_stt")??"",i=this.commonService.myTranslateInstant("lang_auto_so_tien_azo")??"",s=this.commonService.myTranslateInstant("lang_auto_noi_dung")??"",o=this.commonService.myTranslateInstant("lang_auto_nap_tien_vao_vi_azo")??"",v=this.commonService.myTranslateInstant("lang_auto_mua_de_thi")??"",f=this.commonService.myTranslateInstant("lang_auto_rut_azo_khoi_vi")??"",p=this.commonService.myTranslateInstant("lang_auto_chuyen_azo_cho_tai_khoan")??"",S=this.commonService.myTranslateInstant("lang_auto_he_thong_tang_azo")??"",g=this.commonService.myTranslateInstant("lang_auto_nhan_azo_tu_file_da_ban")??"",y=this.commonService.myTranslateInstant("lang_auto_nhan_azo_tu_tai_khoan")??"";for(let h=1;h<(n?.length??0);h++){var r=0===n?.[h].type?o:"";r=1===n?.[h].type?v+" "+n[h].examName:r,r=2===n?.[h].type?f:r,r=3===n?.[h].type?p+" "+n[h].relativeName:r,r=4===n?.[h].type?S:r,r=5===n?.[h].type?g:r,m.push({[l]:h,[i]:0,[s]:r=6===n?.[h].type?y+" "+n[h].relativeName:r,content9Trans:this.timeService.formatFullDateTimeByUserUnit(n?.[h].createdAt)})}const T={Sheets:{data:t.utils.json_to_sheet(m)},SheetNames:["data"]},x=t.write(T,{bookType:"xlsx",type:"array"});return new Blob([x],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"})}exportExcelForScoreHomeworkOfClassroom(n,m,l,i){let s=this.commonService.myTranslateInstant("lang_auto_stt")??"",o=this.commonService.myTranslateInstant("lang_auto_ho_va_ten")??"",v=this.commonService.myTranslateInstant("lang_auto_gioi_tinh")??"",f=this.commonService.myTranslateInstant("lang_auto_so_bao_danh")??"",p=this.commonService.myTranslateInstant("lang_auto_ngay_sinh")??"",S=this.commonService.myTranslateInstant("lang_auto_dat")??"",g=this.commonService.myTranslateInstant("lang_auto_chua_dat")??"",y=this.commonService.myTranslateInstant("lang_auto_hoan_thanh"),r=this.commonService.myTranslateInstant("lang_auto_chua_hoan_thanh")??"",I=this.commonService.myTranslateInstant("lang_auto_hoan_thanh_tot")??"",T=this.commonService.myTranslateInstant("lang_export_classroom_score_homework_result")??"",x=this.commonService.myTranslateInstant("lang_export_classroom_score_homework_comment")??"",u=this.commonService.myTranslateInstant("lang_export_classroom_score_first_result")??"",d=this.commonService.myTranslateInstant("lang_export_classroom_score_last_result")??"",h=this.commonService.myTranslateInstant("lang_export_classroom_score_highest_result")??"",k=this.commonService.myTranslateInstant("lang_auto_chua_thi")??"",be=this.commonService.myTranslateInstant("lang_auto_chua_nop")??"",j=this.commonService.myTranslateInstant("lang_auto_chua_cham")??"",Se=this.commonService.myTranslateInstant("lang_auto_da_yeu_cau_nop_lai")??"",X=this.commonService.myTranslateInstant("lang_auto_truong")??"",K=this.commonService.myTranslateInstant("lang_auto_lop")??"",U=this.commonService.myTranslateInstant("lang_auto_so_dien_thoai")??"",H=this.commonService.myTranslateInstant("lang_auto_email")??"",Q="Username";m=this.sortService.sortFirstNameStudents(m);let E=this.commonService.isBusinessDomain(),V=this.commonService.isTqbDomain(),B=V?[s,o,v,p,U,H,f,K]:[s,o,Q,v,p,U,H,f,K],b=V?[s,o,v,p,U,H,f,K]:[s,o,Q,v,p,U,H,f,K],ae=[],ne=[],se=[],oe=[],le=[],re=0,L=9,N=9,ie=1;E&&(B.push(X),b.push(X),L=10,N=10),m.forEach(e=>{re+=1,ie++;let a={},ce={},G={},Y={},Z={};if(e.dataHomework&&L<=(E?10:9)+e.dataHomework.length&&(L=(E?10:9)+e.dataHomework?.length),e.dataExam&&N<=(E?10:9)+e.dataExam.length&&(N=(E?10:9)+e.dataExam?.length),e.dataHomework?.forEach(c=>{let _=this.timeService.getFormatDate(c.createdAt??"")+` (${c.name})`,$=1;for(;a[`${_}`];)$++,_=`${this.timeService.getFormatDate(c.createdAt??"")} (${c.name}) (${$})`;switch(c.point){case 1e3:a[`${_}`]=S;break;case 1001:a[`${_}`]=g;break;case 2e3:a[`${_}`]=y;break;case 2001:a[`${_}`]=r;break;case 3e3:a[`${_}`]=I;break;default:a[`${_}`]=`${c.point}`}c.answerId||(a[`${_}`]=`${c.answerHistories?.length?Se:be}`),c.answerId&&!c.confirmedAt&&(a[`${_}`]=`${j}`);let de=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(c.result??""));var q=document.createElement("div");q.innerHTML=this.commonService.removeXssInHtml(null==de?"":de.comment),ce[`${_}`]=q.textContent||q.innerText,this.commonService.isExistInArray(B,_)||B.push(_)}),l&&l.length){let c=0;l.forEach(_=>{let $=`${_.name}`;for(;G[`${$}`];)c++,$=`${_.name} (${c})`;G[`${$}`]=k,Y[`${$}`]=k,Z[`${$}`]=k,this.commonService.isExistInArray(b,$)||b.push($)})}let _e={},he=0;e.dataExam?.forEach(c=>{let _=`${c.name}`;for(;_e[`${_}`];)he++,_=`${c.name} (${he})`;_e[`${_}`]=_,G[`${_}`]=null!=c.firstPoint?-1!=c.firstPoint?c.firstPoint:j:k,Y[`${_}`]=null!=c.lastPoint?-1!=c.lastPoint?c.lastPoint:j:k,Z[`${_}`]=null!=c.highestPoint?-1!=c.highestPoint?c.highestPoint:j:k,this.commonService.isExistInArray(b,_)||b.push(_)}),N<b.length&&(N=b.length);let O={[s]:re,[o]:e.fullname,[V?"":Q]:V?"":e.userName,[v]:e.gender,[p]:null!=e.birthday?this.timeService.getFormatDate(e.birthday):"",[U]:e.phone??"",[H]:e.email??"",[K]:n.name??"",[f]:e.identificationNumber?this.formatAnswerSheetService.formatStudentCodeToNumber(e.identificationNumber,ee.c.maxStudentCodeLength):""};E&&(O={...O,[X]:e.schoolName??""}),ae.push({...O,...a}),ne.push({...O,...ce}),se.push({...O,...G}),oe.push({...O,...Y}),le.push({...O,...Z})});var J=[{width:10},{width:30},{width:30},{width:15},{width:15},{width:20},{width:30},{width:15},{width:30}];E&&J.push({width:30});for(let e=0;e<L;e++)e>(E?9:8)&&J.push({width:40});var W=[{width:10},{width:30},{width:30},{width:15},{width:15},{width:20},{width:30},{width:15},{width:30}];E&&W.push({width:30});for(let e=0;e<N;e++)e>(E?9:8)&&W.push({width:40});var A=t.utils.aoa_to_sheet([[`${T} - ${n.name}`],B]);t.utils.sheet_add_json(A,ae,{origin:-1,header:B,skipHeader:!0}),A["!cols"]=J;var P=t.utils.aoa_to_sheet([[`${x} - ${n.name}`],B]);t.utils.sheet_add_json(P,ne,{origin:-1,header:B,skipHeader:!0}),P["!cols"]=J;var D=t.utils.aoa_to_sheet([[`${u} - ${n.name}`],b]);t.utils.sheet_add_json(D,se,{origin:-1,header:b,skipHeader:!0}),D["!cols"]=W;var z=t.utils.aoa_to_sheet([[`${d} - ${n.name}`],b]);t.utils.sheet_add_json(z,oe,{origin:-1,header:b,skipHeader:!0}),z["!cols"]=W;var F=t.utils.aoa_to_sheet([[`${h} - ${n.name}`],b]);t.utils.sheet_add_json(F,le,{origin:-1,header:b,skipHeader:!0}),F["!cols"]=W;let C=[1,6,8];E&&C.push(9);for(let e=1;e<=ie;e++){for(let a=0;a<L;a++)A[t.utils.encode_cell({c:a,r:e})]&&(A[t.utils.encode_cell({c:a,r:e})].s=0!=e&&1==e?this.style_header:C.includes(a)?this.style_body_left:this.style_body,7==a&&(A[t.utils.encode_cell({c:a,r:e})].t="s",A[t.utils.encode_cell({c:a,r:e})].z="@")),P[t.utils.encode_cell({c:a,r:e})]&&(P[t.utils.encode_cell({c:a,r:e})].s=0!=e&&1==e?this.style_header:C.includes(a)?this.style_body_left:this.style_body,7==a&&(P[t.utils.encode_cell({c:a,r:e})].t="s",P[t.utils.encode_cell({c:a,r:e})].z="@"));for(let a=0;a<N;a++)D[t.utils.encode_cell({c:a,r:e})]&&(D[t.utils.encode_cell({c:a,r:e})].s=0!=e&&1==e?this.style_header:C.includes(a)?this.style_body_left:this.style_body,7==a&&(D[t.utils.encode_cell({c:a,r:e})].t="s",D[t.utils.encode_cell({c:a,r:e})].z="@")),z[t.utils.encode_cell({c:a,r:e})]&&(z[t.utils.encode_cell({c:a,r:e})].s=0!=e&&1==e?this.style_header:C.includes(a)?this.style_body_left:this.style_body,7==a&&(z[t.utils.encode_cell({c:a,r:e})].t="s",z[t.utils.encode_cell({c:a,r:e})].z="@")),F[t.utils.encode_cell({c:a,r:e})]&&(F[t.utils.encode_cell({c:a,r:e})].s=0!=e&&1==e?this.style_header:C.includes(a)?this.style_body_left:this.style_body,7==a&&(F[t.utils.encode_cell({c:a,r:e})].t="s",F[t.utils.encode_cell({c:a,r:e})].z="@"))}if(i&&i>0){const e=`${this.commonService.myTranslateInstant("lang_azt_still")} ${i} ${this.commonService.myTranslateInstant("lang_azt_line_is_not_displayed_yet_please_register_as_VIP_to_be_able_to_display_all_content")}`;this.addStyledRowAndMerge(A,e),this.addStyledRowAndMerge(P,e),this.addStyledRowAndMerge(D,e),this.addStyledRowAndMerge(z,e),this.addStyledRowAndMerge(F,e)}const Ee=t.write({Sheets:{[T]:A,[x]:P,[u]:D,[d]:z,[h]:F},SheetNames:[T,x,u,d,h]},{bookType:"xlsx",type:"array"});return new Blob([Ee],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"})}exportHtmlTableToExcel(n,m,l){const i=t.utils.table_to_sheet(n?.nativeElement,{raw:m}),s=t.utils.book_new();t.utils.book_append_sheet(s,i,"Sheet1"),t.writeFile(s,l);var o=t.write(s,{bookType:"xlsx",bookSST:!0,type:"base64"});this.shareFileFlutterService.shareFileWithBase64(o,l)}exportHtmlTableToExcelStyleOnlyHeaderRow(n,m,l,i){var s=t.utils.table_to_sheet(n?.nativeElement,{raw:m}),o=n?.nativeElement?.getElementsByClassName("azt-excel-cell");if(o&&o.length>0){for(var v=[],f=0;f<o.length;f++){var p=o[f].getAttribute("excelColumn")??void 0,S=o[f].getAttribute("excelStyle")?.toString()??void 0,g=null!=p?Number(p):void 0,y=null!=S?this.commonService.castJsonToObj(S):void 0;if(null!=i&&null!=g&&null!=y)try{var r=t.utils.encode_cell({c:g,r:i});s.hasOwnProperty(r)&&(s[r].s=y,y.hasOwnProperty("isText")&&1==y.isText&&(s[r].t="s",s[r].z="@"))}catch(d){console.log(d)}var I=o[f].getAttribute("excelWidth")??void 0,T=null!=I?Number(I):void 0;T&&v.push({width:T})}v.length>0&&(s["!cols"]=v)}const x=t.utils.book_new();if(t.utils.book_append_sheet(x,s,"Sheet1"),this.commonService.isMobileWebview(void 0)){var u=t.write(x,{bookType:"xlsx",bookSST:!0,type:"array"});const h=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});this.shareFileFlutterService.shareFileWithBlob(h,l)}else t.writeFile(x,l)}exportHtmlTableToExcelBlob(n,m){var l=t.utils.table_to_sheet(n?.nativeElement,{raw:m}),i=n?.nativeElement?.getElementsByClassName("azt-excel-cell");if(i&&i.length>0){for(var s=[],o=0;o<i.length;o++){var v=i[o].getAttribute("excelRow")??void 0,f=i[o].getAttribute("excelColumn")??void 0,p=i[o].getAttribute("excelStyle")?.toString()??void 0,S=null!=v?Number(v):void 0,g=null!=f?Number(f):void 0,y=null!=p?this.commonService.castJsonToObj(p):void 0;if(null!=S&&null!=g&&null!=y)try{var r=t.utils.encode_cell({c:g,r:S});l.hasOwnProperty(r)&&(l[r].s=y,y.hasOwnProperty("isText")&&1==y.isText&&(l[r].t="s",l[r].z="@"))}catch(k){console.log(k)}var I=i[o].getAttribute("excelWidth")??void 0,T=null!=I?Number(I):void 0;T&&s.push({width:T})}s.length>0&&(l["!cols"]=s)}const x=t.utils.book_new();t.utils.book_append_sheet(x,l,"Sheet1");const u=t.write(x,{bookType:"xlsx",type:"array"});return new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"})}addStyledRowAndMerge(n,m){t.utils.sheet_add_json(n,[{A:m,B:"",C:"",D:"",E:"",F:"",G:""}],{skipHeader:!0,origin:-1});const l=n["!ref"]?.split(":")[1].replace(/\D/g,""),s=n[`A${l}`];s&&(s.s={font:{bold:!0,color:{rgb:"FF0000"},sz:14}}),n["!merges"]||(n["!merges"]=[]),n["!merges"].push({s:{r:Number(l)-1,c:0},e:{r:Number(l)-1,c:6}})}constructor(n,m,l,i,s,o){this.commonService=n,this.timeService=m,this.formatAnswerSheetService=l,this.shareFileFlutterService=i,this.sortService=s,this.zipDataService=o,this.style_header={width:35,alignment:{vertical:"center",horizontal:"center",wrapText:!0},font:{sz:11,bold:!0,color:{rgb:"ffffffff"}},fill:{patternType:"solid",fgColor:{rgb:"2361ae"}}},this.style_body={alignment:{vertical:"center",horizontal:"center",font:{bold:!1,color:{rgb:"000000"}}}},this.style_body_left={alignment:{vertical:"center",font:{bold:!1,color:{rgb:"000000"}}}}}}return(R=te).\u0275fac=function(n){return new(n||R)(M.KVO(ue.R),M.KVO(fe.F),M.KVO(ve.e),M.KVO(ye.R),M.KVO(pe.g),M.KVO(ge.j))},R.\u0275prov=M.jDH({token:R,factory:R.\u0275fac,providedIn:"root"}),te})()}}]);