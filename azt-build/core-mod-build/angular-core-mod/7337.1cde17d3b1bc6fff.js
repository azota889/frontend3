(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[7337],{59702:(Tt,Ae,g)=>{"use strict";g.d(Ae,{Q:()=>Ee});var o=g(54460),h=g(48891),y=g(10936),ce=g(89163),te=g(65162),b=g(45269),Y=g(15343),le=g(5502),J=g(21656),G=g(33887),x=g(69135),v=g(36894),F=g(47348),_=g(70050),f=g(50589),q=g(2915),$=g(52811),d=g(18718),de=g(27988),z=g(56562),Ie=g(47712);const me=L=>({"ml-auto":L}),nt=(L,se)=>({"bg-info text-white":L,"bg-slate-300":se}),tt=()=>({"text-pending":!0});function rt(L,se){if(1&L&&h.eu8(0,5),2&L){h.XpG();const je=h.sdS(5);h.Y8G("ngTemplateOutlet",je)}}function He(L,se){if(1&L&&h.eu8(0,5),2&L){h.XpG();const je=h.sdS(3);h.Y8G("ngTemplateOutlet",je)}}function ve(L,se){if(1&L&&(h.j41(0,"div",7),h.nrm(1,"azt-loading-effect",8),h.k0s()),2&L){const je=h.XpG(2);h.R7$(),h.Y8G("currentStatusObj",je.statusObj)}}function ze(L,se){1&L&&h.nrm(0,"azt-loading-ui",15)}function ye(L,se){if(1&L){const je=h.RV6();h.j41(0,"div",9),h.nrm(1,"iframe",10),h.nI1(2,"safe"),h.j41(3,"div",11)(4,"button",12),h.bIt("click",function(){h.eBV(je);const Se=h.XpG(2);return h.Njj(Se.handleCloseDialog())}),h.EFF(5),h.nI1(6,"mytranslate"),h.k0s(),h.j41(7,"button",13),h.bIt("click",function(){h.eBV(je);const Se=h.XpG(2);return h.Njj(Se.orderBuyExam())}),h.DNE(8,ze,1,0,"azt-loading-ui",14),h.j41(9,"span"),h.EFF(10),h.nI1(11,"mytranslate"),h.k0s()()()()}if(2&L){let je;const _e=h.XpG(2);h.R7$(),h.Y8G("src",h.bMT(2,5,null!==(je=_e.showIframeInContent)&&void 0!==je?je:""),h.f$h),h.R7$(4),h.SpI(" ",h.bMT(6,7,"lang_payment_confirm_payment_buy_later")," "),h.R7$(2),h.Y8G("disabled",_e.statusObj.loading),h.R7$(),h.Y8G("ngIf",_e.statusObj.loading),h.R7$(2),h.JRh(h.bMT(11,9,"lang_payment_confirm_payment_button"))}}function Te(L,se){if(1&L&&h.DNE(0,ve,2,1,"div",6)(1,ye,12,11,"ng-template",null,2,h.C5r),2&L){const je=h.sdS(2),_e=h.XpG();h.Y8G("ngIf",_e.statusObj.loading)("ngIfElse",je)}}function Me(L,se){if(1&L&&h.nrm(0,"azt-loading-effect",8),2&L){const je=h.XpG(2);h.Y8G("currentStatusObj",je.statusObj)}}function we(L,se){if(1&L&&(h.nrm(0,"div",47),h.nI1(1,"safeNormalHtmlContent")),2&L){const je=h.XpG().$implicit;h.Y8G("innerHTML",h.bMT(1,1,je.description),h.npT)}}function Ke(L,se){if(1&L){const je=h.RV6();h.j41(0,"div",41)(1,"div",42),h.bIt("click",function(){const Se=h.eBV(je).$implicit,$e=h.XpG(3);return h.Njj($e.chooseCombo(Se))}),h.j41(2,"div",41),h.EFF(3),h.k0s(),h.DNE(4,we,2,3,"div",43),h.j41(5,"div",44),h.nrm(6,"span",45),h.nI1(7,"translateToKeyParam"),h.j41(8,"span",46),h.EFF(9),h.nI1(10,"formatMoney"),h.k0s()()()()}if(2&L){const je=se.$implicit,_e=h.XpG(3);h.R7$(),h.Y8G("ngClass",h.l_i(10,nt,(null==_e.currentComboObj?null:_e.currentComboObj.id)==je.id,(null==_e.currentComboObj?null:_e.currentComboObj.id)!=je.id)),h.R7$(2),h.JRh(je.name),h.R7$(),h.Y8G("ngIf",je.description),h.R7$(2),h.Y8G("innerHTML",h.i5U(7,5,"lang_payment_total_exam_in_combo",je.items.length.toString()),h.npT),h.R7$(3),h.JRh(h.bMT(10,8,je.price)+" VND")}}function oe(L,se){if(1&L&&(h.qex(0),h.j41(1,"div",50)(2,"div",51),h.nrm(3,"lucide-icon",52),h.k0s(),h.j41(4,"div",53)(5,"div",54,3),h.EFF(7),h.k0s()()(),h.bVm()),2&L){const je=se.$implicit,_e=h.sdS(6);h.R7$(3),h.Y8G("ngClass",h.lJ4(5,tt)),h.R7$(2),h.FS9("matTooltip",je.name),h.Y8G("isDisabledTooltip",!1)("matTooltipDisabled",_e.isDisabled),h.R7$(2),h.SpI(" ",je.name," ")}}function at(L,se){if(1&L&&(h.j41(0,"div",48),h.DNE(1,oe,8,6,"ng-container",49),h.k0s()),2&L){const je=h.XpG(3);h.R7$(),h.Y8G("ngForOf",je.currentComboObj.items)}}function ie(L,se){1&L&&(h.j41(0,"p",57),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&L&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_payment_dialog_coin_current_not_enough"),""))}function be(L,se){if(1&L&&(h.j41(0,"span",55),h.EFF(1),h.nI1(2,"mytranslate"),h.j41(3,"b"),h.EFF(4),h.nI1(5,"number"),h.k0s(),h.DNE(6,ie,3,3,"p",56),h.k0s()),2&L){const je=h.XpG(3);h.R7$(),h.SpI(" ",h.bMT(2,3,"lang_payment_dialog_coin_current"),": "),h.R7$(3),h.JRh(h.bMT(5,5,je.totalCoin)),h.R7$(2),h.Y8G("ngIf",je.currentComboObj&&je.currentComboObj.price&&je.totalCoin<je.currentComboObj.price)}}function H(L,se){1&L&&h.nrm(0,"azt-loading-ui",15)}function pe(L,se){if(1&L){const je=h.RV6();h.j41(0,"azt-mat-dialog-content",18)(1,"div",19)(2,"div"),h.DNE(3,Ke,11,13,"div",20),h.k0s(),h.DNE(4,at,2,1,"div",21),h.j41(5,"div",22)(6,"div",23),h.EFF(7),h.nI1(8,"mytranslate"),h.k0s(),h.j41(9,"div",24)(10,"div",25)(11,"div",26)(12,"div",27),h.nrm(13,"img",28),h.nI1(14,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(15,"div",26)(16,"div",27),h.nrm(17,"img",29),h.nI1(18,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(19,"div",26)(20,"div",27),h.nrm(21,"img",30),h.nI1(22,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(23,"div",26)(24,"div",27),h.nrm(25,"img",31),h.nI1(26,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(27,"div",26)(28,"div",27),h.nrm(29,"img",32),h.nI1(30,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(31,"div",26)(32,"div",27),h.nrm(33,"img",33),h.nI1(34,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(35,"div",26)(36,"div",27),h.nrm(37,"img",34),h.nI1(38,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(39,"div",26)(40,"div",27),h.nrm(41,"img",35),h.nI1(42,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(43,"div",26)(44,"div",27),h.nrm(45,"img",36),h.nI1(46,"coreModConvertCdnLinkOfGitHub"),h.k0s()(),h.j41(47,"div",26)(48,"div",27),h.nrm(49,"img",37),h.nI1(50,"coreModConvertCdnLinkOfGitHub"),h.k0s()()()()()()(),h.j41(51,"div",38),h.DNE(52,be,7,7,"span",39),h.j41(53,"div",40)(54,"button",12),h.bIt("click",function(){h.eBV(je);const Se=h.XpG(2);return h.Njj(Se.handleCloseDialog())}),h.EFF(55),h.nI1(56,"mytranslate"),h.k0s(),h.j41(57,"button",13),h.bIt("click",function(){h.eBV(je);const Se=h.XpG(2);return h.Njj(Se.orderBuyExam())}),h.DNE(58,H,1,0,"azt-loading-ui",14),h.j41(59,"span"),h.EFF(60),h.nI1(61,"mytranslate"),h.k0s()()()()}if(2&L){const je=h.XpG(2);h.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 130px)"),h.R7$(3),h.Y8G("ngForOf",je.comboObjs),h.R7$(),h.Y8G("ngIf",je.currentComboObj),h.R7$(3),h.SpI(" ",h.bMT(8,20,"lang_payment_supported_payment_methods")," "),h.R7$(6),h.Y8G("src",h.bMT(14,22,"images/method-payment/vnpay_full.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(18,24,"images/method-payment/vietcombank.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(22,26,"images/method-payment/techcombank.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(26,28,"images/method-payment/vietinbank.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(30,30,"images/method-payment/mbbank.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(34,32,"images/method-payment/agribank.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(38,34,"images/method-payment/bidv.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(42,36,"images/method-payment/acb.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(46,38,"images/method-payment/hdbank.svg"),h.B4B),h.R7$(4),h.Y8G("src",h.bMT(50,40,"images/method-payment/vpbank.svg"),h.B4B),h.R7$(3),h.Y8G("ngIf",je.totalCoin>0),h.R7$(),h.Y8G("ngClass",h.eq3(46,me,je.isMobileDevice||je.isMobileWebView)),h.R7$(2),h.SpI(" ",h.bMT(56,42,"lang_payment_confirm_payment_buy_later")," "),h.R7$(2),h.Y8G("disabled",je.statusObj.loading),h.R7$(),h.Y8G("ngIf",je.statusObj.loading),h.R7$(2),h.JRh(h.bMT(61,44,"lang_payment_confirm_payment_button"))}}function Xe(L,se){if(1&L&&(h.j41(0,"div",16),h.DNE(1,Me,1,1,"azt-loading-effect",17)(2,pe,62,48,"ng-template",null,2,h.C5r),h.k0s()),2&L){const je=h.sdS(3),_e=h.XpG();h.R7$(),h.Y8G("ngIf",_e.statusObj.loading)("ngIfElse",je)}}let Ee=(()=>{var L;class se extends G._{handleCloseDialog(){this.dialogRef.close("close")}chooseCombo(_e){this.currentComboObj=_e}orderBuyExam(){if(!this.currentComboObj)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.sAztBrowserStorageService.saveSessionStorage("payment_currentComboObj",this.currentComboObj.id.toString()),this.initStatusObj(),this.callApiToBuy(this.currentComboObj.id)}callApiToBuy(_e){this.waitDestroy(this.productOrderService.apiProductOrderBuyExamByCoinGet(_e).subscribe(Se=>{if(!Se.success)return"lang_core_payment_not_enough_coin"!=Se.message?this.errorStatusObj(Se.message,!0):(this.myNavigationWithQueryString("/auth/vip-packages/studentCoin",`?backto=${encodeURIComponent(this.commonService.getCurrentUrlWithoutLocale()+"?pending=1")}&trackingKey=BUY_EXAM`),void this.dialogRef.close(void 0));window.location.reload()}))}getCoinBalance(){this.waitDestroy(this.coinPaymentService.apiCoinPaymentGetCurrentCoinGet().subscribe(_e=>{this.totalCoin=_e.data?.obj?.totalCoin??0,this.initData()}))}initData(){this.waitDestroy(this.comboPackageService.apiComboPackageListComboPackagesByExamHashIdGet(this.data.examObj.hashId??"").subscribe(_e=>{if(!_e.success)return this.errorStatusObj(_e.message,!0);if(!_e.data?.objs?.length)return this.errorStatusObj("lang_payment_not_found_any_exam_combo",!0);this.comboObjs=_e.data?.objs??[],this.currentComboObj=this.commonService.getFirstOfArray(this.comboObjs);let Se=Number(this.sAztBrowserStorageService.getSessionStorage("payment_currentComboObj"));if(1==Number(this.commonService.getMyQueryParam("pending"))&&this.currentComboObj?.id==Se&&this.currentComboObj.price&&this.totalCoin>=this.currentComboObj.price)return this.callApiToBuy(Se);this.stopStatusObj(),this.showIframeInContent&&this.sAztAzotaTrackingService.sendForceCustomEvent("PAYMENT_VIEW_IFRAME_CONTENT",[])}))}setViewport(){const _e=document.createElement("meta");_e.name="viewport",_e.setAttribute("id","viewPortIframe");const Se=ht=>{_e.setAttribute("content",ht),document.head.appendChild(_e)},$e=window.innerWidth;if($e<768){const Ye=420!==$e?$e/420:1;Se(`width=420, user-scalable=no, initial-scale=${Ye}, minimum-scale=${Ye}, maximum-scale=${Ye}`)}else Se("width=960, user-scalable=no, initial-scale=1.0")}removeViewPort(){document.getElementById("viewPortIframe")?.remove()}ngOnInit(){super.ngOnInit(),this.initStatusObj(),this.getCoinBalance(),this.setViewport()}constructor(_e,Se,$e,Le,ht){super(Se,_e),this.dialogRef=_e,this.data=Se,this.productOrderService=$e,this.comboPackageService=Le,this.sAztAzotaTrackingService=ht,this.comboObjs=[],this.showIframeInContent=void 0,this.totalCoin=0,this.sAztBrowserStorageService=(0,h.WQX)(f.z),this.coinPaymentService=(0,h.WQX)(b.dC)}ngOnDestroy(){this.removeViewPort()}}return(L=se).\u0275fac=function(_e){return new(_e||L)(h.rXU(ce.CP,8),h.rXU(ce.Vh,8),h.rXU(b.Hg),h.rXU(de.E),h.rXU(z.M))},L.\u0275cmp=h.VBU({type:L,selectors:[["payment-dialog"]],standalone:!0,features:[h.Vt3,h.aNF],decls:6,vars:2,consts:[["showIframeContent",""],["showListExamContent",""],["doneLoading",""],["c","isDisabled"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet"],["class","box py-4 px-4",4,"ngIf","ngIfElse"],[1,"box","py-4","px-4"],[3,"currentStatusObj"],[1,"bg-white",2,"height","100%"],["width","100%",2,"height","calc(var(--vh, 1vh) * 100 - 70px)",3,"src"],[1,"text-center","mt-4","text-center","absolute","bottom-2","w-full"],[1,"btn","btn-secondary-soft","w-32","mr-4","btn-lg","text-xl",3,"click"],[1,"btn","btn-primary","btn-lg","text-xl",3,"click","disabled"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"box","py-4","px-4",2,"height","100%"],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"minHeight"],[2,"margin-right","-5px"],["class","pb-2",4,"ngFor","ngForOf"],["class","box border border-slate-200 dark:border-darkmode-400 pt-2",4,"ngIf"],[1,"mt-4"],[1,"font-medium"],[1,"mt-2"],[1,"grid","grid-cols-10","gap-4"],[1,"col-span-5","md:col-span-2","flex","justify-center"],[1,"p-1","rounded-lg","border","border-slate-200","dark:border-darkmode-400","w-full","h-full"],["alt","Vnpay",2,"height","100%",3,"src"],["alt","vietcombank",3,"src"],["alt","techcombank",3,"src"],["alt","vietinbank",3,"src"],["alt","mbbank",3,"src"],["alt","agribank",3,"src"],["alt","bidv",3,"src"],["alt","acb",3,"src"],["alt","hdbank",3,"src"],["alt","vpbank",3,"src"],[1,"flex","mt-4","flex-wrap",2,"align-items","center"],["class","mr-3 ml-auto",4,"ngIf"],[3,"ngClass"],[1,"pb-2"],[1,"clickable","box","pl-2","pr-2","pt-2",3,"click","ngClass"],["class","pb-2 mt-3 mb-3",3,"innerHTML",4,"ngIf"],[1,"pb-2","flex","items-center","justify-end","font-medium"],[3,"innerHTML"],[1,"ml-1","text-lg","text-warning"],[1,"pb-2","mt-3","mb-3",3,"innerHTML"],[1,"box","border","border-slate-200","dark:border-darkmode-400","pt-2"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-3","border-b","border-slate-200","dark:border-darkmode-400"],[1,"flex-none","image-fit","rounded-md","overflow-hidden"],["name","file-check","size","40",3,"ngClass"],[1,"ml-4","mr-auto"],[2,"line-height","1.2",3,"matTooltip","isDisabledTooltip","matTooltipDisabled"],[1,"mr-3","ml-auto"],["class","mb-1 mt-1 text-danger text-sm",4,"ngIf"],[1,"mb-1","mt-1","text-danger","text-sm"]],template:function(_e,Se){1&_e&&h.DNE(0,rt,1,1,"ng-container",4)(1,He,1,1,"ng-container",4)(2,Te,3,2,"ng-template",null,0,h.C5r)(4,Xe,4,2,"ng-template",null,1,h.C5r),2&_e&&(h.Y8G("ngIf",!Se.showIframeInContent),h.R7$(),h.Y8G("ngIf",Se.showIframeInContent))},dependencies:[x.f,d.K,$.R,q.U,o.MD,o.YU,o.Sq,o.bT,o.T3,o.QX,y.X1,te.iI,y.YN,F.wp,F.$g,F.Vs,J.s,Ie.oV,Y.flO,Y.WGl,_.L,F._y,F.JI,F.t0,le.Id,v.k],encapsulation:2}),se})()},57081:(Tt,Ae,g)=>{"use strict";g.d(Ae,{w:()=>b});var o=g(48891),h=g(543),y=g(68774),ce=g(50589),te=g(99927);let b=(()=>{var Y;class le{_saveSortTypeOfSetting(G){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,G)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(G){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==G}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(G,x){var v=[];return x.forEach(F=>{F.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(G,F.results??new Array),v.push(F)}),v}_filterExamResultObjsByFilterSettingObjNotInClassroom(G,x){var v=[];if(G.isMarked||G.isNotMarked||G.isOnTest||G.isNotSubmit||G.isNotTested)for(var F of x){let _=!1,f=G.isOnTest||G.isNotSubmit;G.isMarked&&1==F.isMarked&&(!f||!(1!=F.status&&(F.isMarked||F.isNotMarked)))&&(_=!0),G.isNotMarked&&1==F.isNotMarked&&(!f||!(1!=F.status&&(F.isMarked||F.isNotMarked)))&&(_=!0),G.isOnTest&&(1==F.isOnTest||0==F.status&&(F.isMarked||F.isNotMarked))&&(_=!0),G.isNotTested&&1==F.isNotTested&&(_=!0),G.isNotSubmit&&(1==F.isNotSubmit||-1==F.status&&(F.isMarked||F.isNotMarked))&&(_=!0),_&&v.push(F)}else v=x;return v}_searchExamResultObjsByFullNameInClassroom(G,x){var v=[];return this.commonService.myClone(G).forEach(_=>{var f=this._searchExamResultObjsByFullNameNotInClassroom(_.results??[],x);f.length>0&&(_.results=f,v.push(_))}),v}_searchExamResultObjsByFullNameNotInClassroom(G,x){x=this.commonService.convertVietnameseToEnglish(x).toLowerCase();var v=[];return G.forEach(F=>{-1!=this.commonService.convertVietnameseToEnglish(F.fullName??"").toLowerCase().indexOf(x)&&v.push(F)}),v}_sortExamResultObjsBySettingObjByClassroom(G,x,v){return"isSortByNameAsc"==v?this.sortService.sortFirstNameStudentsInClass(G):"isSortByTimeDesc"==v?this.sortService.sortTimeStudentsInClass(G,1):"isSortByMarkDesc"==v?this.sortService.sortMarkStudentsInClass(G,1,x):this._sortExamResultObjsBySortTypeOfClassroom(G)}_sortExamResultObjsBySettingObjNotInClassroom(G,x,v){return"isSortByNameAsc"==v?this.sortService.sortFirstNameStudents(G):"isSortByTimeDesc"==v?this.sortService.sortTimeDESC(G):"isSortByMarkDesc"==v?this.sortService.sortMarkDESC(G,x):G}_sortExamResultObjsBySortTypeOfClassroom(G){var x=G.map(v=>({...v}));return x.forEach((v,F)=>{v.results=0==v.classObj?.sortType?this.sortService.sortFirstNameStudents(v.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(v.results??[],"pos","id"),x[F]=v}),x}_changeExamResultStatusForAllClassroom(G,x,v){var F=[];return G.forEach((_,f)=>{_.results=this._changeExamResultStatusForOneClassroom(_.results??new Array,x),_={indexCounter:f,..._,countSubmitted:v?_.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(_.results??new Array),showOnTab:_.showOnTab},F.push(_)}),F}_changeExamResultStatusForOneClassroom(G,x){var v=[...G];return v.forEach((F,_)=>{F.confirmedAt&&""!=F.confirmedAt&&F.resultId&&F.resultId>0?F.isMarked=!0:F.resultId&&F.resultId>0&&(!F.confirmedAt||""==F.confirmedAt)?F.isNotMarked=!0:F.resultId&&0!=F.resultId||!F.startedTest||""==F.startedTest||0!=F.status?F.resultId&&0!=F.resultId||!F.startedTest||""==F.startedTest||-1!=F.status?null==F.startedTest&&(F.isNotTested=!0):F.isNotSubmit=!0:F.isOnTest=!0,v[_]=F}),v.forEach((F,_)=>{F.files&&""!=F.files&&!Array.isArray(F.files)&&(F.filesParse=this.commonService.myParseJson(F.files)),v[_]=F}),v}_countTotalSubmittedOfExamResultObjs(G){var x=0;return G.forEach(v=>{(v.isMarked||v.isNotMarked)&&x++}),x}_counterTotalEssayOfQuestionObjs(G){let x=0;return G.forEach(v=>{this.answerTypeService.isEssayAnswer(v)&&x++}),x}_checkCounterEssayQuestionObjs(G){let x=0;return G.forEach(v=>{v.isEssay&&x++}),x}constructor(G,x,v,F){this.commonService=G,this.sortService=x,this.browserStorageService=v,this.answerTypeService=F,this.sortByStorageKey="exam_list_sort_by"}}return(Y=le).\u0275fac=function(G){return new(G||Y)(o.KVO(h.R),o.KVO(y.g),o.KVO(ce.z),o.KVO(te._))},Y.\u0275prov=o.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),le})()},87515:(Tt,Ae,g)=>{"use strict";g.d(Ae,{h:()=>v});var o=g(10936),h=g(51698),y=g(48891),ce=g(543),te=g(78472),b=g(51913),Y=g(41715),le=g(50589),J=g(79064),G=g(91640),x=g(57081);let v=(()=>{var F;class _{constructor(q,$,d,de,z,Ie,me,nt){this.commonService=q,this.examPageResultService=$,this.permissionService=d,this.globalService=de,this.browserStorageService=z,this.gzipHelper=Ie,this.homeworkExamService=me,this.sAztExamResultListSortService=nt}getTestedUserObjs(q,$,d){return this.globalService.startIntervalFunc(q),this.getTestedOfExamResult(q,$,"default",d)}getTestedLastMark(q,$,d){return this.globalService.startIntervalFunc(q),this.getTestedOfExamResult(q,$,"last",void 0,d)}getTestedHighestMark(q,$,d){return this.globalService.startIntervalFunc(q),this.getTestedOfExamResult(q,$,"highest",void 0,d)}getTestedFirstMark(q,$,d){return this.globalService.startIntervalFunc(q),this.getTestedOfExamResult(q,$,"first",void 0,d)}getTestedAllResult(q,$,d){return this.globalService.startIntervalFunc(q),this.getTestedOfExamResult(q,$,"all",void 0,d)}getTestedOfExamResult(q,$,d,de,z){return new h.c(Ie=>{let me="tested_list_result_v2_"+$,nt=this.browserStorageService.getSimpleSessionStorage(me)??"",tt=this.gzipHelper.resultContentSupport(nt),rt=tt&&this.commonService.willDeleteParseJson(tt)?this.commonService.willDeleteParseJson(tt):void 0;de&&nt&&rt?(Ie.next({status:200,success:1,data:rt,message:"successful"}),Ie.complete()):this.examPageResultService.apiExamPageResultGetNewObjV2Post({examId:$,classroomIds:z,getQuestion:1}).subscribe(ve=>{if(1==ve.success){let ye=ve.data?.serverSecond??0,Te=ve.data?.examObj,Me=ve.data?.classroomWithAvatarAndStudentObjs??new Array,we=ve.data?.totalAttended??0,Ke=ve.data?.examQuestionObjs??new Array,oe=ve.data?.examCreatorObj,at=ve.data?.offlineExamObj,ie=ve.data?.hasEssayQuestion,be=ve.data?.totalQuestion??0,H=ve.data?.offlineMixQuestionObjs,pe=ve.data?.canResetStudentCode,Xe=ve.data?.hasCreateStudentCode,Ee=ve.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",Te)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",Te)?this.getAllExamResultObjs(q,[],$,"",L=>{if(L.hasOwnProperty("success")&&1==L.success){let se=this.mergeStudentWithAvatar(L.studentWithResultObjs??[]),je={},_e=[];se?.forEach(Ne=>{let ct=Ne.parentId??"0";je.hasOwnProperty(ct)?je[ct].push(...Ne.examResultObjs??[]):je[ct]=Ne.examResultObjs??[],_e=_e.concat(je[ct])});let Se=Te?this.filterExamResultOnTest(_e,Te,ye):{},$e=[],Le=[];if(this.homeworkExamService.mustInClassroom(Te)&&Me.length>0)for(let Ne=0;Ne<Me.length;Ne++){let ct=Me[Ne].classroomObj;ct.classroomGroup=Me[Ne].classroomGroup;let Ze=Me[Ne].studentObjs??[],it=[];if(Ze.length>0)for(let Re=0;Re<Ze.length;Re++){let vt=Ze[Re].parentId??"0";this.commonService.isExistInArray(Le,Ze[Re].parentId)||Le.push(Ze[Re].parentId??"0"),je.hasOwnProperty(vt)&&(Array.isArray(Ze[Re].examResultObjs)||(Ze[Re].examResultObjs=[]),Ze[Re].examResultObjs=this.findExamResultOfStudent(je[vt],Ze[Re].id??"0"));let Ue=Se.hasOwnProperty(Ze[Re].parentId??0)?Se[Ze[Re].parentId??0]:0;if("all"==d)if(Ze[Re].examResultObjs?.length)Ze[Re].examResultObjs?.forEach((fe,We)=>{let Je=this.commonService.castJsonToObj(JSON.stringify(fe));Je&&(Je.resultId=Je.testStatus&&Je.testStatus>0?Je.id:0);let Lt=this.createStudentWithResult(Ze[Re],Je,Ue,be,We,Ze[Re].examResultObjs?.length??0);it.push(Lt)});else{let fe=this.createStudentWithResult(Ze[Re],void 0,Ue,be,-1,0);it.push(fe)}else{let fe=this.filterExamResultByType(Ze[Re].examResultObjs??[],d),We=fe.hasOwnProperty(Ze[Re].parentId??0)?fe[Ze[Re].parentId??0]:void 0,Lt=this.createStudentWithResult(Ze[Re],We,Ue,be,(We&&null!=We.indexTest&&We.indexTest>=0?We.indexTest:"first"==d?0:(Ze[Re].examResultObjs?.length??0)-1)??0,Ze[Re].examResultObjs?.length??0);it.push(Lt)}}$e.push({classObj:ct,results:it})}let ht=[],Ye=this.commonService.myClone(se)??[];for(let Ne=0;Ne<Ye?.length;Ne++)if(!this.commonService.isExistInArray(Le,Ye[Ne].parentId)){let ct=Se.hasOwnProperty(Ye[Ne].parentId??0)?Se[Ye[Ne].parentId??0]:0;if("all"==d)if(Ye[Ne].examResultObjs?.length)Ye[Ne].examResultObjs?.forEach((Ze,it)=>{let Re=this.commonService.castJsonToObj(JSON.stringify(Ze));Re&&(Re.resultId=Re.testStatus&&Re.testStatus>0?Re.id:0);let vt=this.createStudentWithResult(Ye[Ne],Re,ct,be,it,Ye[Ne].examResultObjs?.length??0);ht.push(vt)});else{let Ze=this.createStudentWithResult(Ye[Ne],void 0,ct,be,-1,0);ht.push(Ze)}else{let Ze=this.filterExamResultByType(Ye[Ne].examResultObjs??[],d),it=Ze.hasOwnProperty(Ye[Ne].parentId??0)?Ze[Ye[Ne].parentId??0]:void 0,vt=this.createStudentWithResult(Ye[Ne],it,ct,be,(it&&null!=it?.indexTest&&it.indexTest>=0?it.indexTest:"first"==d?0:(Ye[Ne].examResultObjs?.length??0)-1)??0,Ye[Ne].examResultObjs?.length??0);ht.push(vt)}}"all"!=d&&ht.sort((Ne,ct)=>this.compareTwoDate(Ne.createdAt??"",ct.createdAt??""));let qe=0;($e.length||ht.length)&&($e.forEach(Ne=>{Ne.results?.forEach(ct=>{let Ze=this.getMaxGroupId(ct.groupPoints??[]);qe<Ze&&(qe=Ze)})}),ht.forEach(Ne=>{let ct=this.getMaxGroupId(Ne.groupPoints??[]);qe<ct&&(qe=ct)})),"export_tool"==q&&z?.length&&($e=$e.filter(Ne=>this.commonService.isExistInArray(z,Ne.classObj?.id)),this.commonService.isExistInArray(z,-1)||(ht=[]));let Fe={studentsInClassResults:$e.length>0?$e:[],studentsNotInClassResults:ht.length>0?ht:[],totalAttended:we,totalQuestion:be,totalUsers:0,examCreatorObj:oe,offlineMixQuestionObjs:H,examObj:Te,hasEssayQuestion:ie,offlineExamObj:at,canResetStudentCode:pe,hasCreateStudentCode:Xe,questionObjs:Ke,fileTypeStr:Ee,errorConfigClassroomPermission:ve.data?.errorConfigClassroomPermission,errorMessage:ve.data?.errorMessage,maxGroupId:qe,rawQuestionObjs:ve.data?.questionObjs};if("export_tool"!=q){let Ne=this.gzipHelper.zipBigContent(JSON.stringify(Fe));this.browserStorageService.saveSimpleSessionStorage(me,Ne)}Ie.next({status:200,success:1,data:Fe,message:"successful"}),Ie.complete()}else Ie.next({status:L.code,success:0,data:null,message:L.message??""}),Ie.complete()}):(Ie.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:we,totalQuestion:be,hasEssayQuestion:ie,totalUsers:0,examCreatorObj:oe,offlineMixQuestionObjs:H,examObj:Te,offlineExamObj:at,canResetStudentCode:pe,hasCreateStudentCode:Xe,questionObjs:Ke,fileTypeStr:ve.data?.fileTypeStr,errorConfigClassroomPermission:ve.data?.errorConfigClassroomPermission,errorMessage:ve.data?.errorMessage,maxGroupId:0,rawQuestionObjs:ve.data?.questionObjs},message:"successful"}),Ie.complete())}else Ie.next({status:ve.code,success:0,data:null,message:ve.message??""}),Ie.complete()})})}getAllExamResultObjs(q,$,d,de,z){this.examPageResultService.apiExamPageResultGetObjsV2Get(d,"test_review"==q||"export_tool"==q?"export":"tested_list",de).subscribe(me=>{1==me.success?(me.data?.objs&&$.push(...me.data.objs),me.data?.nextPage?this.globalService.isStopIntervalFunc(q)?z({studentWithResultObjs:$,success:1}):setTimeout(()=>{this.getAllExamResultObjs(q,$,d,me.data?.nextPage??"",z)},300):z({studentWithResultObjs:$,success:1})):z({code:me.code,studentWithResultObjs:[],success:0,message:me.message??""})})}compareTwoDate(q,$){var d=new Date(q).getTime();d=isNaN(d)?0:d;var de=new Date($).getTime();return d-(de=isNaN(de)?0:de)>0?1:d-de<0?-1:0}filterExamResultOnTest(q,$,d){var de={};return q.forEach(z=>{var Ie=this.commonService.myClone(z)??{};if(Ie.testStatus)de[Ie.userId??0]=Ie.testStatus;else if(Ie.startedTest&&d)if($.endTime){var me=Math.floor(new Date($.endTime).getTime()/1e3);de[Ie.userId??0]=d<=me+60*($.minutes??0)+600?0:-1}else{var nt=Ie.startedTest?Math.floor(new Date(Ie.startedTest).getTime()/1e3):0;de[Ie.userId??0]=d<=nt+86400?0:-1}else de[Ie.userId??0]=0}),de}filterExamResultByType(q,$){var d={};if(q.length>1)q.forEach((z,Ie)=>{var me=this.commonService.myClone(z);z.testStatus&&(me.resultId=me.id,me.indexTest=Ie,"default"==$&&(d[me.userId??0]=me),"last"==$&&(d[me.userId??0]=me),"first"==$&&(d.hasOwnProperty(me.userId??0)||(d[me.userId??0]=me)),"highest"==$)&&(d.hasOwnProperty(me.userId??0)?(d[me.userId??0].mark??-1)<=(me.mark??-1)&&(d[me.userId??0]=me):d[me.userId??0]=me)});else{var de=this.commonService.myClone(q[0]??{});de.resultId=de.testStatus?de.id:0,de.indexTest=0,d[de.userId??0]=de}return d}findExamResultOfStudent(q,$){var d=[];return q.forEach(de=>{(de.studentId==$||null==de.studentId)&&d.push(de)}),d}addResultIdToExamResult(q){var $=[];return q.forEach(d=>{var de=this.commonService.myClone(d)??{};de.resultId=de.id,de.testStatus&&$.push(de)}),$}compareLengthWithExamQuestion(q,$){var d=this.commonService.myClone(q);if($>0&&q.length<$)for(var de=0;de<$-q.length;de++)d.push("");return d}mergeStudentWithAvatar(q){var $=[];return q.forEach(d=>{var de=$.filter(Ie=>Ie.parentId==d.parentId);if(de&&0!=de.length)for(var z=0;z<$.length;z++)$[z].parentId==d.parentId&&($[z].examResultObjs=$[z].examResultObjs?.concat(d.examResultObjs??[]));else $.push(d)}),$}createStudentWithResult(q,$,d,de,z,Ie){return{id:q.id,userId:q.parentId,studentId:q.id,identificationNumber:$?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??q.identificationNumber??0,offlineMixQuestionHashId:$?.offlineMark?.rawOfflineMixquestionId??0,studentCode:$?.offlineMark?.studentCode??0,gender:q.gender,fullName:q.fullName,avatar:q.avatar,birthday:q.birthday,resultId:$?.hasOwnProperty("resultId")?$.resultId:0,answers:$?.hasOwnProperty("answers")?$.answers:null,rightAnswer:$?.hasOwnProperty("rightAnswer")?$.rightAnswer:0,totalQuestion:$?.hasOwnProperty("totalQuestion")?$.totalQuestion:0,mark:$?.hasOwnProperty("mark")?$?.mark:null,trueFalseMark:$?.hasOwnProperty("trueFalseMark")?$.trueFalseMark:null,essayMark:$?.hasOwnProperty("essayMark")?$.essayMark:null,files:$?.hasOwnProperty("files")?$.files:null,infors:$?.hasOwnProperty("infors")?$?.infors:null,confirmedAt:$?.hasOwnProperty("confirmedAt")?$?.confirmedAt:null,startedTest:$?.hasOwnProperty("startedTest")?$?.startedTest:null,createdAt:$?.hasOwnProperty("createdAt")?$.createdAt:null,totalExamResultObjs:q.examResultObjs.length,answeredQuestions:$?.hasOwnProperty("answeredQuestions")?$.answeredQuestions:[],groupPoints:this.getGroupPoints($?.answeredQuestions?$?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:$?.examTrackObj?.exitFullScreen,blurCount:$?.examTrackObj?.blurWindow},status:d,nameImages:q.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion($?.answerMixObjs??[],de)??[],testedTime:z+1,totalTestTime:Ie,subjectMarkValues:$?.subjectMarks,isOffline:$?.isOffline??!1,countEssayQuestion:this.sAztExamResultListSortService._checkCounterEssayQuestionObjs($?.hasOwnProperty("answeredQuestions")&&$?.answeredQuestions?$.answeredQuestions:[]),checkBoxGroupControl:new o.gE({isShow:new o.MJ(!1,{nonNullable:!0}),selectedCheckbox:new o.MJ(!1,{nonNullable:!0})}),questionTypeMarks:$?.questionTypeMarks??[],schoolName:q.schoolName??"",phone:q.phone??"",email:q.email??"",userName:q?.userName??""}}getGroupPoints(q){let $=[];return q.forEach(d=>{let de=!1;for(let z=0;z<$.length;z++)$[z].id==d.groupId&&(de=!0,$[z].point+=d.correct&&d.scorePerQuestion?d.scorePerQuestion:0);!de&&d.groupId&&$.push({id:d.groupId,point:d.correct&&d.scorePerQuestion?d.scorePerQuestion:0})}),$.sort((d,de)=>(d.id??0)-(de.id??0)),$}getMaxGroupId(q){let $=[];return q.forEach(d=>{d.id&&!this.commonService.isExistInArray($,d.id)&&$.push(d.id)}),$.length}}return(F=_).\u0275fac=function(q){return new(q||F)(y.KVO(ce.R),y.KVO(te.TE),y.KVO(b.p),y.KVO(Y.r),y.KVO(le.z),y.KVO(J.f),y.KVO(G.Z),y.KVO(x.w))},F.\u0275prov=y.jDH({token:F,factory:F.\u0275fac,providedIn:"root"}),_})()},32835:(Tt,Ae,g)=>{"use strict";g.d(Ae,{i:()=>h});var o=g(48891);let h=(()=>{var y;class ce{processData(b){let Y=[],le=[];if(b)for(var J=0;J<b.length;J++)if("scroll"!=b[J][0]){var G={index:b[J][0],alpha:b[J][1],key:b[J][2],questionId:Number(b[J][3]),second:Number(b[J][4])};Y.push(G)}else{var x={scrollPos:Number(b[J][1]),second:Number(b[J][2])};le.push(x)}return[Y,le]}}return(y=ce).\u0275fac=function(b){return new(b||y)},y.\u0275prov=o.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),ce})()},54479:(Tt,Ae,g)=>{"use strict";g.d(Ae,{t:()=>it});var o=g(73014),h=g(27691),y=g(48891),ce=g(10936),te=g(59640),b=g(14558),Y=g(78111),le=g(64198),J=g(83229),G=g(28023),x=g(84278),v=g(34815),F=g(54460),_=g(65162),f=g(47348),q=g(21656),$=g(15343),d=g(70050),de=g(5502),z=g(7919),Ie=g(36894),me=g(58112),nt=g(76476),tt=g(48451),rt=g(51113),He=g(47712),ve=g(99965);const ze=["mnoteContainer"],ye=["aztMarkNote"],Te=Re=>({display:Re}),Me=Re=>({border:Re}),we=Re=>({"is-invalid":Re}),Ke=()=>({"mr-1 cursor-pointer":!0});function oe(Re,vt){if(1&Re){const Ue=y.RV6();y.j41(0,"lucide-icon",20),y.nI1(1,"mytranslate"),y.bIt("click",function(){y.eBV(Ue);const We=y.XpG(2).$implicit;return y.Njj(We.showEssayMark=!1)}),y.k0s()}2&Re&&(y.FS9("matTooltip",y.bMT(1,2,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),y.Y8G("ngClass",y.lJ4(4,Ke)))}function at(Re,vt){if(1&Re){const Ue=y.RV6();y.j41(0,"lucide-icon",21),y.nI1(1,"mytranslate"),y.bIt("click",function(){y.eBV(Ue);const We=y.XpG(2).$implicit;return y.Njj(We.showEssayMark=!0)}),y.k0s()}2&Re&&(y.FS9("matTooltip",y.bMT(1,2,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),y.Y8G("ngClass",y.lJ4(4,Ke)))}function ie(Re,vt){1&Re&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&Re&&(y.R7$(),y.SpI(" ",y.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function be(Re,vt){1&Re&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&Re&&(y.R7$(),y.SpI(" ",y.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function H(Re,vt){1&Re&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&Re&&(y.R7$(),y.SpI(" ",y.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function pe(Re,vt){if(1&Re&&(y.j41(0,"div",22),y.DNE(1,ie,3,3,"span",10)(2,be,3,3,"span",10)(3,H,3,3,"span",10),y.k0s()),2&Re){const Ue=y.XpG(2).$implicit;y.R7$(),y.Y8G("ngIf",Ue.essayAnswersFormGroup.controls.mark.errors.min),y.R7$(),y.Y8G("ngIf",Ue.essayAnswersFormGroup.controls.mark.errors.max),y.R7$(),y.Y8G("ngIf",Ue.essayAnswersFormGroup.controls.mark.errors.pattern)}}function Xe(Re,vt){if(1&Re&&(y.qex(0),y.j41(1,"div",13),y.DNE(2,oe,2,5,"lucide-icon",14)(3,at,2,5,"lucide-icon",15),y.j41(4,"span",16),y.EFF(5),y.nI1(6,"mytranslate"),y.j41(7,"span",17),y.nI1(8,"mytranslate"),y.EFF(9),y.nI1(10,"mytranslate"),y.k0s()(),y.nrm(11,"input",18),y.nI1(12,"mytranslate"),y.k0s(),y.DNE(13,pe,4,3,"div",19),y.bVm()),2&Re){let Ue;const fe=y.XpG().$implicit,We=y.XpG();y.R7$(2),y.Y8G("ngIf",fe.showEssayMark),y.R7$(),y.Y8G("ngIf",!fe.showEssayMark),y.R7$(2),y.Lme(" ",y.bMT(6,14,"lang_auto_cau")," ",(null!==(Ue=fe.indexLabel)&&void 0!==Ue?Ue:0)+1," "),y.R7$(2),y.FS9("matTooltip",y.bMT(8,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),y.R7$(2),y.Lme("(",fe.essMaxPoint," ",y.bMT(10,18,"lang_auto_diem_brackets"),""),y.R7$(2),y.FS9("placeholder",y.bMT(12,20,"lang_auto_nhap_diem")),y.Y8G("readonly",!We.showForTeacher)("decimal",!0)("ngClass",y.eq3(22,we,fe.essayAnswersFormGroup.controls.mark&&fe.essayAnswersFormGroup.controls.mark.invalid))("value",fe.essayAnswersFormGroup.controls.mark.value)("formControl",fe.essayAnswersFormGroup.controls.mark),y.R7$(2),y.Y8G("ngIf",fe.essayAnswersFormGroup.controls.mark.errors)}}function Ee(Re,vt){if(1&Re&&(y.j41(0,"div",12),y.DNE(1,Xe,14,24,"ng-container",10),y.k0s()),2&Re){const Ue=vt.$implicit,fe=vt.index,We=y.XpG();y.Y8G("ngStyle",y.eq3(2,Me,fe==We.questions.length-1?"none":"")),y.R7$(),y.Y8G("ngIf",Ue.essayAnswersFormGroup)}}function L(Re,vt){if(1&Re){const Ue=y.RV6();y.j41(0,"div",23)(1,"button",24),y.bIt("click",function(){y.eBV(Ue);const We=y.XpG();return y.Njj(We.saveDataMarkExercise())}),y.EFF(2),y.nI1(3,"mytranslate"),y.nI1(4,"mytranslate"),y.k0s()()}if(2&Re){const Ue=y.XpG();y.R7$(),y.Y8G("disabled",Ue.isLoading||Ue.findQuestionFormInvalid()||Ue.loadingDataCdn&&Ue.files.length>0),y.R7$(),y.SpI(" ",Ue.isLoading?y.bMT(3,2,"lang_auto_dang_luu_doing"):y.bMT(4,4,"lang_auto_luu_diem")," ")}}function se(Re,vt){if(1&Re&&y.nrm(0,"azt-question-standalone-for-student-at-review-page",29),2&Re){let Ue;const fe=y.XpG().$implicit,We=y.XpG();y.Y8G("follower",We.followerRenderQuest)("examObj",We.examObj)("examConfig",We.examConfig)("questionObj",fe)("curQuestionIndex",null!==(Ue=fe.indexLabel)&&void 0!==Ue?Ue:0)("userAnswersObj",We.userAnswersObj)("currentTab","essay_tab")}}function je(Re,vt){if(1&Re&&y.nrm(0,"azt-question-standalone-for-teacher-at-review-page",30),2&Re){let Ue;const fe=y.XpG().$implicit,We=y.XpG();y.Y8G("follower",We.followerRenderQuest)("examObj",We.examObj)("questionObj",fe)("curQuestionIndex",null!==(Ue=fe.indexLabel)&&void 0!==Ue?Ue:0)("userAnswersObj",We.userAnswersObj)("orgExamObjs",We.orgExamObjs)("currentTab","essay_tab")}}function _e(Re,vt){1&Re&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&Re&&(y.R7$(),y.SpI(" ",y.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Se(Re,vt){1&Re&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&Re&&(y.R7$(),y.SpI(" ",y.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function $e(Re,vt){1&Re&&(y.j41(0,"span"),y.EFF(1),y.nI1(2,"mytranslate"),y.k0s()),2&Re&&(y.R7$(),y.SpI(" ",y.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Le(Re,vt){if(1&Re&&(y.j41(0,"div",22),y.DNE(1,_e,3,3,"span",10)(2,Se,3,3,"span",10)(3,$e,3,3,"span",10),y.k0s()),2&Re){const Ue=y.XpG(3).$implicit;y.R7$(),y.Y8G("ngIf",null==Ue.essayAnswersFormGroup.controls.mark.errors?null:Ue.essayAnswersFormGroup.controls.mark.errors.min),y.R7$(),y.Y8G("ngIf",null==Ue.essayAnswersFormGroup.controls.mark.errors?null:Ue.essayAnswersFormGroup.controls.mark.errors.max),y.R7$(),y.Y8G("ngIf",null==Ue.essayAnswersFormGroup.controls.mark.errors?null:Ue.essayAnswersFormGroup.controls.mark.errors.pattern)}}function ht(Re,vt){if(1&Re&&(y.qex(0),y.j41(1,"div",34)(2,"label",35),y.EFF(3),y.nI1(4,"mytranslate"),y.j41(5,"span",17),y.nI1(6,"mytranslate"),y.EFF(7),y.nI1(8,"mytranslate"),y.k0s(),y.EFF(9," : "),y.k0s(),y.nrm(10,"input",36),y.nI1(11,"mytranslate"),y.DNE(12,Le,4,3,"div",19),y.k0s(),y.bVm()),2&Re){let Ue;const fe=y.XpG(2),We=fe.$implicit,Je=fe.index,Lt=y.XpG();y.R7$(2),y.FS9("for","cau_"+Je),y.R7$(),y.Lme(" ",y.bMT(4,14,"lang_auto_nhap_diem_cau")," ",(null!==(Ue=We.indexLabel)&&void 0!==Ue?Ue:0)+1," "),y.R7$(2),y.FS9("matTooltip",y.bMT(6,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),y.R7$(2),y.Lme("(",We.essMaxPoint," ",y.bMT(8,18,"lang_auto_diem_brackets"),""),y.R7$(3),y.FS9("placeholder",y.bMT(11,20,"lang_auto_nhap_diem")),y.Y8G("readonly",!Lt.showForTeacher)("ngClass",y.eq3(22,we,We.essayAnswersFormGroup.controls.mark&&We.essayAnswersFormGroup.controls.mark.invalid))("id","cau_"+Je)("decimal",!0)("value",We.essayAnswersFormGroup.controls.mark.value)("formControl",We.essayAnswersFormGroup.controls.mark),y.R7$(2),y.Y8G("ngIf",We.essayAnswersFormGroup.controls.mark.errors)}}function Ye(Re,vt){if(1&Re&&(y.j41(0,"div"),y.DNE(1,ht,13,24,"ng-container",10),y.j41(2,"div",31)(3,"label",32),y.EFF(4),y.nI1(5,"mytranslate"),y.k0s(),y.nrm(6,"textarea",33),y.nI1(7,"mytranslate"),y.k0s()()),2&Re){let Ue;const fe=y.XpG().$implicit,We=y.XpG();y.R7$(),y.Y8G("ngIf",We.showForTeacher),y.R7$(2),y.FS9("for","comment_"+fe.id),y.R7$(),y.Lme("",y.bMT(5,8,"lang_mark_essay_add_comment_question")," ",(null!==(Ue=fe.indexLabel)&&void 0!==Ue?Ue:0)+1,":"),y.R7$(2),y.FS9("id","comment_"+fe.id),y.FS9("placeholder",y.bMT(7,10,"lang_auto_nhap_nhan_xet")),y.Y8G("readonly",!We.showForTeacher)("formControl",fe.essayAnswersFormGroup.controls.comment)}}function qe(Re,vt){if(1&Re&&(y.j41(0,"div",25)(1,"div",26),y.DNE(2,se,1,7,"azt-question-standalone-for-student-at-review-page",27)(3,je,1,7,"azt-question-standalone-for-teacher-at-review-page",28)(4,Ye,8,12,"div",10),y.k0s()()),2&Re){const Ue=vt.$implicit,fe=vt.index,We=y.XpG();y.R7$(),y.Mz_("id","q_",fe,""),y.Y8G("ngStyle",y.eq3(6,Te,Ue.showEssayMark?"block":"none")),y.R7$(),y.Y8G("ngIf",!We.showForTeacher),y.R7$(),y.Y8G("ngIf",We.showForTeacher),y.R7$(),y.Y8G("ngIf",Ue.essayAnswersFormGroup)}}function Fe(Re,vt){1&Re&&(y.j41(0,"div",37)(1,"b"),y.EFF(2),y.nI1(3,"mytranslate"),y.k0s(),y.EFF(4),y.nI1(5,"mytranslate"),y.k0s()),2&Re&&(y.R7$(2),y.SpI("",y.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),y.R7$(2),y.SpI(" ",y.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Ne(Re,vt){if(1&Re){const Ue=y.RV6();y.j41(0,"azt-mark-note",39,1),y.bIt("doneLoadData",function(We){y.eBV(Ue);const Je=y.XpG(2);return y.Njj(Je.doneLoadData(We))}),y.k0s()}if(2&Re){const Ue=y.XpG(2);y.Y8G("dataMarkNote",Ue.dataMarkNote)("screenType","exam")("modeView",Ue.showForTeacher?"teacher":"student")}}function ct(Re,vt){if(1&Re&&(y.qex(0),y.DNE(1,Ne,2,3,"azt-mark-note",38),y.bVm()),2&Re){const Ue=y.XpG();y.R7$(),y.Y8G("ngIf",1===Ue.curSelectedTab||Ue.changeSelectedTab)}}function Ze(Re,vt){if(1&Re){const Ue=y.RV6();y.j41(0,"div",40)(1,"button",41),y.bIt("click",function(){y.eBV(Ue);const We=y.XpG();return y.Njj(We.saveDataMarkExercise())}),y.EFF(2),y.nI1(3,"mytranslate"),y.nI1(4,"mytranslate"),y.k0s()()}if(2&Re){const Ue=y.XpG();y.R7$(),y.Y8G("disabled",Ue.isLoading||Ue.findQuestionFormInvalid()||Ue.loadingDataCdn&&Ue.files.length>0),y.R7$(),y.SpI(" ",Ue.isLoading?y.bMT(3,2,"lang_auto_dang_luu_doing"):y.bMT(4,4,"lang_auto_luu_diem")," ")}}let it=(()=>{var Re;class vt extends te.H{getMaxPoint(fe){let We=this.questions.find(Je=>Je.id==fe);return We?We.scorePerQuestion??0:0}remark(fe){let We=this.questions.map(xt=>({questionId:xt.essayAnswersFormGroup?.controls.questionId.value,comment:xt.essayAnswersFormGroup?.controls.comment.value,mark:Number(xt.essayAnswersFormGroup?.controls.mark.value)})),Je=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});this.examResultService.apiExamResultSaveResultPost({id:this.resultID,result:fe,essayResult:void 0,essayAnswers:We},Je).subscribe(xt=>{this.isLoading=!1,1==xt.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1)):(this.commonService.snackError(xt.message),this.saveResultEvent.emit(0))})}initDataMarkNote(){this.examResultObj.result?this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId}:(this.files.forEach(fe=>fe.url=this.sAztCommonCdnService.getMyCdn(fe.url??"")),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)})}saveDataMarkExercise(){var fe=this;return(0,o.A)(function*(){if(!fe.questions.find(Je=>Je.essayAnswersFormGroup?.controls.mark.value))return fe.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");if(fe.questions.forEach(Je=>{Je.essayAnswersFormGroup?.controls.mark.value||Je.essayAnswersFormGroup?.controls.mark.setValue("0")}),fe.isLoading=!0,!fe.files.length||(fe.objectResult=fe.MarkNote?.exportDataMarkNote(),!fe.objectResult.pages?.length&&fe.files.find(Je=>(0,le.nL)(Je.mimes??"")||(0,le.rl)(Je.mimes??"")||!(0,le.N6)(Je.mimes??""))))return fe.remark("");if(fe.objectResult.pages?.length){let Je=!1;for(let X=0;X<fe.objectResult.pages.length;X++)if(fe.objectResult.pages[X]&&fe.objectResult.pages[X].draws?.length)for(let ee=0;ee<(fe.objectResult.pages[X].draws?.length??0);ee++){let S=fe.objectResult.pages[X].draws?.[ee]??{};S.src&&S.src.includes("base64")&&(Je=!0)}Je&&(yield fe.uploadDrawBase64ToCdn());const Lt=fe.serializeJson(fe.objectResult),xt=fe.zipDataService.convertContentGzip(Lt),et=new Blob([xt],{type:"text/plain"}),V=new File([et],"txt",{type:"text/plain"});fe.apiUploadService.uploadToCdnForHomework(V).subscribe(X=>{if(!X.success)return fe.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");fe.remark(fe.serializeJson({urlDataMark:X.data?.url??"",version:"0.1"}))})}})()}uploadDrawBase64ToCdn(){return new Promise(fe=>{if(!this.objectResult.pages)return;let We=[];this.objectResult.pages.forEach(Je=>We.push(!1)),this.objectResult.pages.forEach((Je,Lt)=>{Je.draws?.length&&Je.draws.forEach((xt,et)=>{if(xt.src&&xt.src.includes("base64")){We[Lt]=!0;let V=(0,J.q)(xt.src);this.apiUploadService.commonUploadForMarkResult(V,`essay_note_${Lt}_${et}_${this.resultID}.png`,"image/png").subscribe(X=>{X.type!=h.hv.UploadProgress&&(xt.src=X.data?.url,We[Lt]=!1),We.includes(!0)||fe()})}})})})}doneLoadData(fe){this.loadingDataCdn=!1}autoResizeFeedBackArea(fe){const We=document.getElementById("comment_"+fe);We&&setTimeout(()=>{We.style.cssText="height:auto;",We.style.cssText="height:"+(We.scrollHeight+30)+"px"},0)}findQuestionFormInvalid(){return null!=this.questions.find(fe=>fe.essayAnswersFormGroup?.invalid)}initEssayFormGroupQuestion(){let fe=this.examResultObj.confirmedAt?new G.X(this.commonService).parserEssayResult(this.examResultObj.essayResult):[],We=(this.examResultObj.confirmedAt?this.examResultObj.essayAnswerObjs:[])??[];this.questions.forEach((Je,Lt)=>{let xt=this.getMaxPoint(Je.id);this.totalMaxPoint+=xt,Je.essMaxPoint=xt,this.maxPointPerQuestion.push(Je.essMaxPoint);let et=fe.find(X=>X.questionIndex==Lt),V=We.find(X=>X.questionId==Je.id)??{questionId:Je.id,comment:void 0,mark:et?.questionMark};Je.showEssayMark=!0,Je.essayAnswersFormGroup=new ce.gE({questionId:new ce.MJ(Je.id,{nonNullable:!0}),mark:new ce.MJ(V?.mark?.toString()??"",{nonNullable:!0,validators:[ce.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),ce.k0.min(0),ce.k0.max(Je.essMaxPoint??0)]}),comment:new ce.MJ(V?.comment??"",{nonNullable:!0})})})}ngOnInit(){this.initDataMarkNote(),this.followerRenderQuest.setNumQuest(this.questions.length),this.initEssayFormGroupQuestion(),super.ngOnInit()}constructor(fe,We,Je,Lt){super(),this.sAztCommonCdnService=fe,this.examResultService=We,this.apiUploadService=Je,this.zipDataService=Lt,this.orgExamObjs=[],this.questions=[],this.files=[],this.resultID=0,this.userAnswersObj={},this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new y.bkB,this.followerRenderQuest=new Y.e,this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.jsonData={},this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return(Re=vt).\u0275fac=function(fe){return new(fe||Re)(y.rXU(me.c),y.rXU(nt._),y.rXU(tt.T),y.rXU(rt.j))},Re.\u0275cmp=y.VBU({type:Re,selectors:[["azt-mark-essay-new"]],viewQuery:function(fe,We){if(1&fe&&(y.GBs(ze,5),y.GBs(ye,5)),2&fe){let Je;y.mGM(Je=y.lsd())&&(We.mnoteContainer=Je.first),y.mGM(Je=y.lsd())&&(We.MarkNote=Je.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",resultID:"resultID",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},standalone:!0,features:[y.Vt3,y.aNF],decls:11,vars:9,consts:[["mnoteContainer",""],["aztMarkNote",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"ngClass","matTooltip","click",4,"ngIf"],["name","eye_off","size","24",3,"ngClass","matTooltip","click",4,"ngIf"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","value","formControl"],["class","mt-2 text-danger text-xs",4,"ngIf"],["name","eye","size","24",3,"click","ngClass","matTooltip"],["name","eye_off","size","24",3,"click","ngClass","matTooltip"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",3,"id","ngStyle"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","20px"],[1,"mb-2","font-medium",3,"for"],["type","text","cols","10","autoResize","",1,"form-control","d-inline-flex","w-full","mt-1",3,"readonly","id","placeholder","formControl"],[1,"block-input",2,"margin-bottom","10px"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","value","formControl"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"doneLoadData","dataMarkNote","screenType","modeView"],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(fe,We){1&fe&&(y.j41(0,"div",2)(1,"div",3),y.DNE(2,Ee,2,4,"div",4),y.k0s(),y.DNE(3,L,5,6,"div",5),y.k0s(),y.j41(4,"div",6),y.DNE(5,qe,5,8,"div",7),y.k0s(),y.DNE(6,Fe,6,6,"div",8),y.j41(7,"div",9,0),y.DNE(9,ct,2,1,"ng-container",10),y.k0s(),y.DNE(10,Ze,5,6,"div",11)),2&fe&&(y.R7$(2),y.Y8G("ngForOf",We.questions),y.R7$(),y.Y8G("ngIf",We.showForTeacher),y.R7$(2),y.Y8G("ngForOf",We.questions),y.R7$(),y.Y8G("ngIf",We.files&&0==We.files.length),y.R7$(),y.Y8G("ngStyle",y.eq3(7,Te,We.files&&0==We.files.length?"none":"block")),y.R7$(2),y.Y8G("ngIf",We.dataMarkNote&&We.dataMarkNote.answer_obj&&We.files&&We.files.length>0),y.R7$(),y.Y8G("ngIf",We.showForTeacher))},dependencies:[x.x,v.o,b.i,F.MD,F.YU,F.Sq,F.bT,F.B3,ce.X1,ce.me,ce.BC,ce.l_,_.iI,ce.YN,f.wp,q.s,He.oV,$.flO,$.WGl,d.L,de.Id,z.Z,Ie.k,ve.j],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:#2361ae2e;border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%], .maxPoint[_ngcontent-%COMP%]{font-size:12px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),vt})()},28023:(Tt,Ae,g)=>{"use strict";g.d(Ae,{X:()=>o});class o{constructor(y){this.commonService=y}parserEssayResult(y){let ce=[],te=this.commonService.myParseJson(y??"{}")??{};return Object.entries(te).map(([Y,le])=>({key:Y,value:le})).forEach(Y=>{let le=Y.key.replace("cau","");ce.push({questionIndex:isNaN(Number(le))?void 0:Number(le),questionMark:isNaN(Number(Y.value))?void 0:Number(Y.value)})}),ce}}},72267:(Tt,Ae,g)=>{"use strict";g.d(Ae,{E:()=>te});var o=g(48891),h=g(543),y=g(51113),ce=g(99927);let te=(()=>{var b;class Y{addIndexLabelToQuestionObjs(J){for(let G=0;G<(J?.length??0);G++)J?.[G]&&(J[G].indexLabel=G);return J}getEssayQuestionObjs(J){let G=[];for(let x=0;x<(J?.length??0);x++)this.answerTypeService.isEssayAnswer(J?.[x])&&J?.[x]&&G.push(J[x]);return G}getTrueFalseQuestionObjs(J){let G=[];for(let x=0;x<(J?.length??0);x++)(this.answerTypeService.isOneChoiceAnswer(J?.[x])||this.answerTypeService.isTrueFalseAnswer(J?.[x])||this.answerTypeService.isFillAnswer(J?.[x]))&&J?.[x]&&G.push(J[x]);return G}convertAnswersArr(J){let G={};return 0!=J.length&&J.forEach(x=>{let v=!!x.AnswerContent?.filter(F=>F.Status)?.length;x.AnswerContent&&x.AnswerContent.length&&(G[`id_${x.QuestionId}`]=v?[...x.AnswerContent]:x.AnswerContent[0].Content)}),G}mapStudentObjWithTestedObj(J,G,x){var v=this.commonService.castObj(J?.studentObj),F=G?.filter(_=>_.userId==x?.parentId);return v&&F&&F.length>0&&(v={...v,offlineMarkObj:F[0].offlineMarkObj,nameImage:F[0].nameImage??""}),x=v}mapStudentObjWithTestedObjForFrontendStudent(J,G,x){var v=this.commonService.castObj(J?.studentObj),F=G?.filter(_=>_.userId==x?.parentId);return v&&F&&F.length>0&&(v={...v,offlineMarkObj:F[0].offlineMarkObj,nameImage:F[0].nameImage??""}),x=v}constructor(J,G,x){this.commonService=J,this.zipDataService=G,this.answerTypeService=x}}return(b=Y).\u0275fac=function(J){return new(J||b)(o.KVO(h.R),o.KVO(y.j),o.KVO(ce._))},b.\u0275prov=o.jDH({token:b,factory:b.\u0275fac,providedIn:"root"}),Y})()},57332:(Tt,Ae,g)=>{"use strict";g.d(Ae,{V:()=>ze});var o=g(54460),h=g(10936),y=g(89163),ce=g(65162),te=g(15343),b=g(5502),Y=g(21656),le=g(33887),J=g(90796),G=g(47348),x=g(70050),v=g(68323),F=g(52811),_=g(36894),f=g(48891),q=g(58538);const $=()=>({"mr-2 text-danger flex-none":!0});function d(ye,Te){1&ye&&(f.j41(0,"span",11),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&ye&&(f.R7$(),f.JRh(f.bMT(2,1,"lang_testbank_are_you_sure_to_delete_this_exam_result")))}function de(ye,Te){1&ye&&(f.j41(0,"span",11),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&ye&&(f.R7$(),f.SpI("",f.bMT(2,1,"lang_testbank_are_you_sure_to_delete_multiple_exam_result"),":"))}function z(ye,Te){if(1&ye&&(f.j41(0,"div",8),f.nrm(1,"lucide-icon",9),f.j41(2,"div"),f.DNE(3,d,3,3,"span",10)(4,de,3,3,"span",10),f.k0s()()),2&ye){const Me=f.XpG();f.R7$(),f.Y8G("ngClass",f.lJ4(3,$)),f.R7$(2),f.Y8G("ngIf",1==Me.data.examResultIds.length),f.R7$(),f.Y8G("ngIf",Me.data.examResultIds.length>1)}}function Ie(ye,Te){if(1&ye&&(f.j41(0,"div",21)(1,"span",22),f.EFF(2),f.k0s()()),2&ye){const Me=f.XpG().$implicit;f.R7$(2),f.JRh(Me.fullName)}}function me(ye,Te){if(1&ye&&f.nrm(0,"img",23),2&ye){const Me=f.XpG().$implicit;f.Y8G("nameImages",Me.nameImages)}}function nt(ye,Te){if(1&ye&&(f.j41(0,"div",14)(1,"div",15)(2,"div",16),f.nrm(3,"azt-create-avatar",17),f.k0s(),f.j41(4,"div",18),f.DNE(5,Ie,3,1,"div",19)(6,me,1,1,"img",20),f.k0s()()()),2&ye){let Me;const we=Te.$implicit,Ke=f.XpG(2);f.R7$(3),f.Y8G("linkAvatar",null!==(Me=we.avatar)&&void 0!==Me?Me:"")("nameCreateAvatar",we.fullName)("size",32),f.R7$(2),f.Y8G("ngIf",!we.nameImages||Ke.commonService.convertStringToNumber(we.id)>0),f.R7$(),f.Y8G("ngIf",we.nameImages&&Ke.commonService.convertStringToNumber(we.studentId)<=0)}}function tt(ye,Te){if(1&ye&&(f.j41(0,"div",12),f.DNE(1,nt,7,5,"div",13),f.k0s()),2&ye){const Me=f.XpG();f.R7$(),f.Y8G("ngForOf",Me.data.examResults)}}function rt(ye,Te){1&ye&&(f.j41(0,"div",8)(1,"div",24)(2,"button",25)(3,"div",26),f.nrm(4,"lucide-icon",27),f.k0s()(),f.j41(5,"div",28),f.EFF(6),f.nI1(7,"mytranslate"),f.k0s()()()),2&ye&&(f.R7$(6),f.JRh(f.bMT(7,1,"lang_testbank_are_you_sure_to_delete_no_exam_result")))}function He(ye,Te){1&ye&&(f.j41(0,"span",31),f.nrm(1,"azt-loading-ui"),f.k0s())}function ve(ye,Te){if(1&ye){const Me=f.RV6();f.j41(0,"button",29),f.bIt("click",function(){f.eBV(Me);const Ke=f.XpG();return f.Njj(Ke.confirmDelete())}),f.DNE(1,He,2,0,"span",30),f.EFF(2),f.nI1(3,"mytranslate"),f.k0s()}if(2&ye){const Me=f.XpG();f.Y8G("disabled",Me.statusObj.loading),f.R7$(),f.Y8G("ngIf",Me.statusObj.loading),f.R7$(),f.SpI(" ",f.bMT(3,3,"lang_cms_common_confirm_btn")," ")}}let ze=(()=>{var ye;class Te extends le._{confirmDelete(){this.initStatusObj(),this.waitDestroy(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjsPost({examHashId:this.examHashId,examResultIds:this.examResultIds}).subscribe(we=>{1==we.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(we.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(we,Ke,oe){super(oe,Ke),this.offlineExamResultService=we,this.dialogRef=Ke,this.examHashId="",this.examResultIds=[],this.examHashId=oe.examHashId,this.examResultIds=oe.examResultIds}}return(ye=Te).\u0275fac=function(we){return new(we||ye)(f.rXU(q.Fs),f.rXU(y.CP,8),f.rXU(y.Vh,8))},ye.\u0275cmp=f.VBU({type:ye,selectors:[["coazt-delete-offline-exam-result-dialog"]],standalone:!0,features:[f.Vt3,f.aNF],decls:11,vars:7,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],["class","text-md flex",4,"ngIf"],["class","grid grid-cols-12 gap-3","style","overflow-y: auto; max-height: calc(100vh - 150px)",4,"ngIf"],[1,"p-3","flex","justify-end"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor","class","btn w-32 btn-danger",3,"disabled","click",4,"ngIf"],[1,"text-md","flex"],["name","trash-2","size","24",3,"ngClass"],["class","mr-1",4,"ngIf"],[1,"mr-1"],[1,"grid","grid-cols-12","gap-3",2,"overflow-y","auto","max-height","calc(100vh - 150px)"],["class","col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"flex","items-center","p-3","student-exam-result-up","w-full"],[1,"w-8","h-8","image-fit","lg:mr-1"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"ml-2","text-left","mt-0",2,"width","calc(100% - 3.5rem)"],["class","azt-student-name flex items-center","style","flex-wrap: wrap",4,"ngIf"],["appDrawNameImage","","class","mb-1 img-name-fluid",3,"nameImages",4,"ngIf"],[1,"azt-student-name","flex","items-center",2,"flex-wrap","wrap"],[1,"font-medium","mr-2"],["appDrawNameImage","",1,"mb-1","img-name-fluid",3,"nameImages"],[1,"mx-auto","text-center"],[1,"btn","btn-sm","btn-primary-soft","p-1"],[1,"w-6","h-6"],["name","circle-x","size","24"],[1,"mt-4"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"click","disabled"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[1,"w-4","h-4","inline-block","mr-2"]],template:function(we,Ke){1&we&&(f.j41(0,"div",0)(1,"div",1)(2,"div",2),f.DNE(3,z,5,4,"div",3)(4,tt,2,1,"div",4)(5,rt,8,3,"div",3),f.k0s()(),f.j41(6,"div",5)(7,"button",6),f.bIt("click",function(){return Ke.btnCloseDialog()}),f.EFF(8),f.nI1(9,"mytranslate"),f.k0s(),f.DNE(10,ve,4,5,"button",7),f.k0s()()),2&we&&(f.R7$(3),f.Y8G("ngIf",Ke.data.examResultIds.length),f.R7$(),f.Y8G("ngIf",Ke.data.examResultIds.length),f.R7$(),f.Y8G("ngIf",!Ke.data.examResultIds.length),f.R7$(3),f.SpI(" ",f.bMT(9,5,"lang_cms_common_close_btn")," "),f.R7$(2),f.Y8G("ngIf",Ke.data.examResultIds.length))},dependencies:[J.y,v.p,F.R,o.MD,o.YU,o.Sq,o.bT,h.X1,ce.iI,h.YN,G.wp,Y.s,te.flO,te.WGl,x.L,b.Id,_.k],encapsulation:2}),Te})()},92801:(Tt,Ae,g)=>{"use strict";g.d(Ae,{$:()=>rt});var o=g(89163),h=g(33887),y=g(54460),ce=g(10936),te=g(65162),b=g(47348),Y=g(21656),le=g(15343),J=g(70050),G=g(5502),x=g(36894),v=g(48891),F=g(47426),_=g(95670),f=g(43404),q=g(4375),$=g(47712);function d(He,ve){if(1&He&&(v.j41(0,"div")(1,"div",10)(2,"div",11),v.EFF(3),v.k0s(),v.nrm(4,"input",12),v.k0s()()),2&He){const ze=v.XpG().$implicit;v.R7$(3),v.SpI(" ",ze.title," "),v.R7$(),v.FS9("value",ze.contents[0]),v.Y8G("disabled",!0)}}function de(He,ve){if(1&He&&(v.j41(0,"div",17)(1,"span",18),v.EFF(2),v.k0s()()),2&He){const ze=ve.$implicit;v.R7$(),v.FS9("matTooltip",ze),v.R7$(),v.JRh(ze)}}function z(He,ve){if(1&He&&(v.j41(0,"div")(1,"div",13)(2,"span",14),v.EFF(3),v.k0s()(),v.j41(4,"div",15),v.DNE(5,de,3,2,"div",16),v.k0s()()),2&He){const ze=v.XpG().$implicit;v.R7$(3),v.JRh(ze.title),v.R7$(2),v.Y8G("ngForOf",ze.contents)}}function Ie(He,ve){if(1&He&&(v.j41(0,"mat-radio-button",21)(1,"span",18),v.EFF(2),v.k0s()()),2&He){const ze=ve.$implicit;v.Y8G("checked",!0)("disabled",!0),v.R7$(),v.FS9("matTooltip",ze),v.R7$(),v.JRh(ze)}}function me(He,ve){if(1&He&&(v.j41(0,"div")(1,"div",13)(2,"span",19),v.EFF(3),v.k0s()(),v.j41(4,"mat-radio-group",15),v.DNE(5,Ie,3,4,"mat-radio-button",20),v.k0s()()),2&He){const ze=v.XpG().$implicit;v.R7$(3),v.JRh(ze.title),v.R7$(2),v.Y8G("ngForOf",ze.contents)}}function nt(He,ve){if(1&He){const ze=v.RV6();v.j41(0,"div")(1,"div",10)(2,"span",19),v.EFF(3),v.k0s()(),v.j41(4,"div",22)(5,"mat-form-field",23)(6,"mat-select",24),v.mxI("valueChange",function(Te){v.eBV(ze);const Me=v.XpG().$implicit;return v.DH7(Me.contents[0],Te)||(Me.contents[0]=Te),v.Njj(Te)}),v.j41(7,"mat-option",25),v.EFF(8),v.k0s()()()()()}if(2&He){const ze=v.XpG().$implicit;v.R7$(3),v.JRh(ze.title),v.R7$(3),v.R50("value",ze.contents[0]),v.Y8G("disabled",!0),v.R7$(),v.FS9("value",ze.contents[0]),v.R7$(),v.JRh(ze.contents[0])}}function tt(He,ve){if(1&He&&(v.qex(0,8),v.DNE(1,d,5,3,"div",9)(2,z,6,2,"div",9)(3,me,6,2,"div",9)(4,nt,9,5,"div",9),v.bVm()),2&He){const ze=ve.$implicit;v.R7$(),v.Y8G("ngIf",0==ze.type),v.R7$(),v.Y8G("ngIf",1==ze.type),v.R7$(),v.Y8G("ngIf",2==ze.type),v.R7$(),v.Y8G("ngIf",3==ze.type)}}let rt=(()=>{var He;class ve extends h._{constructor(ye,Te){super(Te,ye),this.dialogRef=ye,this.data=Te}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return(He=ve).\u0275fac=function(ye){return new(ye||He)(v.rXU(o.CP,8),v.rXU(o.Vh))},He.\u0275cmp=v.VBU({type:He,selectors:[["app-result-info-dialog"]],standalone:!0,features:[v.Vt3,v.aNF],decls:12,vars:7,consts:[[1,"box","result-info-dialog"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"valueChange","value","disabled"],[2,"color","#1e293c",3,"value"]],template:function(ye,Te){1&ye&&(v.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),v.EFF(5),v.nI1(6,"mytranslate"),v.k0s()(),v.DNE(7,tt,5,4,"ng-container",5),v.k0s()(),v.j41(8,"div",6)(9,"button",7),v.bIt("click",function(){return Te.btnCloseDialog()}),v.EFF(10),v.nI1(11,"mytranslate"),v.k0s()()()),2&ye&&(v.R7$(5),v.SpI(" ",v.bMT(6,3,"lang_testbank_test_config_verify_profile_student")," "),v.R7$(2),v.Y8G("ngForOf",Te.data),v.R7$(3),v.SpI(" ",v.bMT(11,5,"lang_auto_dong")," "))},dependencies:[y.MD,y.Sq,y.bT,ce.X1,te.iI,ce.YN,b.wp,Y.s,F.wT,_.rl,f.VT,f._g,q.VO,$.oV,le.flO,J.L,G.Id,x.k],encapsulation:2}),ve})()},32399:(Tt,Ae,g)=>{"use strict";g.d(Ae,{B:()=>Ie});var o=g(48891),h=g(52909),y=g(59640),ce=g(94743),te=g(54460),b=g(10936),Y=g(65162),le=g(21656),J=g(15343),G=g(70050),x=g(5502),v=g(36894),F=g(47426),_=g(95670),f=g(4375);const q=me=>({"padding-left":me}),$=()=>({"text-pending":!0});function d(me,nt){if(1&me&&(o.j41(0,"mat-option",6)(1,"i",7),o.nrm(2,"azt-svg-icon",8),o.k0s(),o.j41(3,"span",9),o.EFF(4),o.k0s()()),2&me){const tt=o.XpG().$implicit;o.Y8G("ngStyle",o.eq3(5,q,15*(tt.level+1)+"px"))("disabled",!tt.children.length)("value",tt),o.R7$(2),o.Y8G("size",20),o.R7$(2),o.JRh(tt.objectName)}}function de(me,nt){if(1&me){const tt=o.RV6();o.j41(0,"mat-option",10),o.bIt("click",function(){o.eBV(tt);const He=o.XpG().$implicit,ve=o.XpG();return o.Njj(ve.confirmSelected(He))}),o.nrm(1,"lucide-icon",11),o.j41(2,"span",12),o.EFF(3),o.k0s()()}if(2&me){const tt=o.XpG().$implicit;o.Y8G("ngStyle",o.eq3(4,q,15*(tt.level+1)+"px"))("value",tt),o.R7$(),o.Y8G("ngClass",o.lJ4(6,$)),o.R7$(2),o.JRh(tt.objectName)}}function z(me,nt){if(1&me&&(o.qex(0),o.DNE(1,d,5,7,"mat-option",4)(2,de,4,7,"mat-option",5),o.bVm()),2&me){const tt=nt.$implicit;o.R7$(),o.Y8G("ngIf","FOLDER"==tt.objectType),o.R7$(),o.Y8G("ngIf","EXAM"==tt.objectType)}}let Ie=(()=>{var me;class nt extends y.H{confirmSelected(rt){"FOLDER"!=rt.objectType&&(this.combineExamCapacity.forEach(He=>He.isSelected=!1),rt.isSelected=!0,this.currentSelected=rt,this.selectedExamEmitter.emit({examCapacityId:rt.examId,examId:rt.objectId??0,examHashId:rt.exam?.hashId??"",examCapacityTestId:this.currentResultObj?.examCapacityTestId??0}))}asTemplateDataObj(rt){return rt}convertTreeNodes(rt,He){let ve=[];return rt.forEach((ze,ye)=>{let Te="EXAM"==ze.objectType&&(ze.objectId??ze.examId)==(this.examComponentObj?this.examComponentObj.id:this.examObj?.id),Me={...ze,level:He,nodeIndex:ye,isSelected:Te,randomHashId:this.uuidService.getUuid()};ve.push(Me),Te&&(this.currentSelected=Me),ze.children.length&&ve.push(...this.convertTreeNodes(ze.children,He+1))}),ve}ngOnInit(){super.ngOnInit(),this.combineExamCapacity=this.convertTreeNodes(this.capacityComponents??[],0)}constructor(){super(),this.capacityComponents=[],this.selectedExamEmitter=new o.bkB,this.uuidService=(0,o.WQX)(h.D),this.combineExamCapacity=[],this.errorMessage=""}}return(me=nt).\u0275fac=function(rt){return new(rt||me)},me.\u0275cmp=o.VBU({type:me,selectors:[["app-select-capacity-exam-result"]],inputs:{capacityComponents:"capacityComponents",examObj:"examObj",examComponentObj:"examComponentObj",currentResultObj:"currentResultObj"},outputs:{selectedExamEmitter:"selectedExamEmitter"},standalone:!0,features:[o.Vt3,o.aNF],decls:4,vars:2,consts:[[1,"test-select-capacity"],[1,"w-full"],[3,"value"],[4,"ngFor","ngForOf"],[3,"ngStyle","disabled","value",4,"ngIf"],[3,"ngStyle","value","click",4,"ngIf"],[3,"ngStyle","disabled","value"],["aria-hidden","true"],["type","folder",3,"size"],[1,"font-normal","ml-2","select-capacity-span",2,"vertical-align","middle"],[3,"click","ngStyle","value"],["name","file-check","size","20",3,"ngClass"],[1,"select-capacity-span","ml-2",2,"vertical-align","middle","white-space","nowrap"]],template:function(rt,He){1&rt&&(o.j41(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),o.DNE(3,z,3,2,"ng-container",3),o.k0s()()()),2&rt&&(o.R7$(2),o.Y8G("value",He.currentSelected),o.R7$(),o.Y8G("ngForOf",He.combineExamCapacity))},dependencies:[ce.m,te.MD,te.YU,te.Sq,te.bT,te.B3,b.X1,Y.iI,b.YN,le.s,F.wT,_.rl,f.VO,J.flO,J.WGl,G.L,x.Id,v.k],encapsulation:2}),nt})()},74104:(Tt,Ae,g)=>{"use strict";g.d(Ae,{U:()=>Z});var o=g(59640),h=g(53043),y=g(57332),ce=g(73014),te=g(10936),b=g(89163),Y=g(33887),le=g(43234),J=g(52811),G=g(54460),x=g(65162),v=g(47348),F=g(21656),_=g(15343),f=g(70050),q=g(5502),$=g(36894),d=g(48891),de=g(36484),z=g(74225);class Ie{constructor(){this.x=0,this.y=0}toBase64String(){return(new ie).writeCvPoint2u(this).toBase64String()}}class me{constructor(){this.x=0,this.y=0}toBase64String(){return(new ie).writeCvPoint2f(this).toBase64String()}}class nt{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new ie).writeCvRect2f(this).toBase64String()}}class tt{constructor(){this.center=new me,this.filled=!1}toBase64String(){return(new ie).writeAnswerCircle(this).toBase64String()}}class rt{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new ie).writeTableAnswer(this).toBase64String()}}class He{constructor(){this.top=new me,this.left=new me,this.bottom=new me,this.right=new me}toBase64String(){return(new ie).writeResultRect(this).toBase64String()}}class ve{constructor(){this.id=0,this.region=new nt}toBase64String(){return(new ie).writeCropRegion(this).toBase64String()}}class ze{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new He,this.studentId=new rt,this.examId=new rt,this.answerTable=new rt,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new ie).writeResultOutput(this).toBase64String()}}class ye{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new ie).writeAnswerSheetInput(this).toBase64String()}}class Te{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new ie).writeSmallAnswerCircle(this).toBase64String()}}class Me{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new ie).writeSmallTableAnswer(this).toBase64String()}}class we{constructor(){this.studentId=new Me,this.examId=new Me,this.answerTable=new Me}toBase64String(){return(new ie).writeDrawData(this).toBase64String()}}class Ke{constructor(I){this.bytes=I,this.cursor=0,this.length=I.byteLength}updateCursor(I){if(this.cursor=this.cursor+I,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let I=this.bytes[this.cursor];return this.updateCursor(1),I}parseInt(){let I=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(I).getInt32(0)}parseDouble(){let I=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(I).getFloat64(0,!0)}parseString(){let I=new TextDecoder("utf-8"),O=this.cursor,E=this.bytes[this.cursor];for(;0!=E;)this.updateCursor(1),E=this.bytes[this.cursor];let R=this.bytes.slice(O,this.cursor),M=I.decode(R);return this.updateCursor(1),M}parseBool(){let I=this.bytes[this.cursor];return this.updateCursor(1),I>0}parseCvPoint2u(){let I=new Ie;return I.x=this.parseUchar(),I.y=this.parseUchar(),I}parseCvPoint2f(){let I=new me;return I.x=this.parseDouble(),I.y=this.parseDouble(),I}parseCvRect2f(){let I=new nt;return I.x=this.parseDouble(),I.y=this.parseDouble(),I.width=this.parseDouble(),I.height=this.parseDouble(),I}parseAnswerCircle(){let I=new tt;return I.center=this.parseCvPoint2f(),I.filled=this.parseBool(),I}parseTableAnswer(){let I=new rt,O=0;I.rows=this.parseInt(),I.cols=this.parseInt(),I.radius=this.parseInt(),O=this.parseInt();for(let E=0;E<O;E++)I.answers.push(this.parseAnswerCircle());return I}parseResultRect(){let I=new He;return I.top=this.parseCvPoint2f(),I.left=this.parseCvPoint2f(),I.bottom=this.parseCvPoint2f(),I.right=this.parseCvPoint2f(),I}parseCropRegion(){let I=new ve;return I.id=this.parseInt(),I.region=this.parseCvRect2f(),I}parseResultOutput(){let I=new ze,O=0;I.type=this.parseInt(),I.errorCode=this.parseInt(),I.paperCorner=this.parseResultRect(),I.studentId=this.parseTableAnswer(),I.examId=this.parseTableAnswer(),I.answerTable=this.parseTableAnswer(),I.imageWidth=this.parseInt(),I.imageHeight=this.parseInt(),I.imageSize=this.parseInt(),O=this.parseInt();for(let E=0;E<O;E++)I.cropRegion.push(this.parseCropRegion());return I}parseAnswerSheetInput(){let I=new ye;return I.templateType=this.parseInt(),I.imageWidth=this.parseInt(),I.imageHeight=this.parseInt(),I}parseSmallAnswerCircle(){let I=new Te;return I.position=this.parseUchar(),I.x=this.parseUchar(),I.y=this.parseUchar(),I.filledCols=this.parseUchar(),I.rows=this.parseUchar(),I}parseSmallTableAnswer(){let I=new Me,O=0;I.rows=this.parseUchar(),I.cols=this.parseUchar(),I.radius=this.parseUchar(),O=this.parseInt();for(let E=0;E<O;E++)I.answers.push(this.parseSmallAnswerCircle());return I}parseDrawData(){let I=new we;return I.studentId=this.parseSmallTableAnswer(),I.examId=this.parseSmallTableAnswer(),I.answerTable=this.parseSmallTableAnswer(),I}}const oe=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class ie{constructor(){this.bytes=[]}writeUchar(I){return this.bytes.push(I),this}writeUint8Array(I){for(let O=0;O<I.length;O++)this.bytes.push(I[O]);return this}writeArrayBuffer(I){let O=new Uint8Array(I);return this.writeUint8Array(O),this}writeInt(I){let O=new ArrayBuffer(4);return new DataView(O).setUint32(0,I,!1),this.writeArrayBuffer(O),this}writeDouble(I){let O=new ArrayBuffer(8);return new DataView(O).setFloat64(0,I,!0),this.writeArrayBuffer(O),this}writeString(I){let E=(new TextEncoder).encode(I);return this.writeUint8Array(E),this.writeUchar(0),this}writeBool(I){return this.writeUchar(I?1:0),this}toBase64String(){return function at(P){let O,I="",E=P.length;for(O=2;O<E;O+=3)I+=oe[P[O-2]>>2],I+=oe[(3&P[O-2])<<4|P[O-1]>>4],I+=oe[(15&P[O-1])<<2|P[O]>>6],I+=oe[63&P[O]];return O===E+1&&(I+=oe[P[O-2]>>2],I+=oe[(3&P[O-2])<<4],I+="=="),O===E&&(I+=oe[P[O-2]>>2],I+=oe[(3&P[O-2])<<4|P[O-1]>>4],I+=oe[(15&P[O-1])<<2],I+="="),I}(new Uint8Array(this.bytes))}writeCvPoint2u(I){return this.writeUchar(I.x),this.writeUchar(I.y),this}writeCvPoint2f(I){return this.writeDouble(I.x),this.writeDouble(I.y),this}writeCvRect2f(I){return this.writeDouble(I.x),this.writeDouble(I.y),this.writeDouble(I.width),this.writeDouble(I.height),this}writeAnswerCircle(I){return this.writeCvPoint2f(I.center),this.writeBool(I.filled),this}writeTableAnswer(I){this.writeInt(I.rows),this.writeInt(I.cols),this.writeInt(I.radius),this.writeInt(I.answers.length);for(let O of I.answers)this.writeAnswerCircle(O);return this}writeResultRect(I){return this.writeCvPoint2f(I.top),this.writeCvPoint2f(I.left),this.writeCvPoint2f(I.bottom),this.writeCvPoint2f(I.right),this}writeCropRegion(I){return this.writeInt(I.id),this.writeCvRect2f(I.region),this}writeResultOutput(I){this.writeInt(I.type),this.writeInt(I.errorCode),this.writeResultRect(I.paperCorner),this.writeTableAnswer(I.studentId),this.writeTableAnswer(I.examId),this.writeTableAnswer(I.answerTable),this.writeInt(I.imageWidth),this.writeInt(I.imageHeight),this.writeInt(I.imageSize),this.writeInt(I.cropRegion.length);for(let O of I.cropRegion)this.writeCropRegion(O);return this}writeAnswerSheetInput(I){return this.writeInt(I.templateType),this.writeInt(I.imageWidth),this.writeInt(I.imageHeight),this}writeSmallAnswerCircle(I){return this.writeUchar(I.position),this.writeUchar(I.x),this.writeUchar(I.y),this.writeUchar(I.filledCols),this.writeUchar(I.rows),this}writeSmallTableAnswer(I){this.writeUchar(I.rows),this.writeUchar(I.cols),this.writeUchar(I.radius),this.writeInt(I.answers.length);for(let O of I.answers)this.writeSmallAnswerCircle(O);return this}writeDrawData(I){return this.writeSmallTableAnswer(I.studentId),this.writeSmallTableAnswer(I.examId),this.writeSmallTableAnswer(I.answerTable),this}}var be=g(543),H=g(51113),pe=g(99927),Xe=g(58112);const L=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let se=(()=>{var P;class I{constructor(E,R,M,U){this.commonService=E,this.zipDataService=R,this.sAztAnswerTypeService=M,this.sAztCommonCdnService=U,this.totalPointExam=0}drawAzotaFileToCanvas(E,R,M,U){return new Promise((xe,Pe)=>{var D="",Ve=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(E.images??""));Ve&&Ve.url&&Ve.url.includes(".azt")?this.httpGetAsync(this.sAztCommonCdnService.getMyCdn(Ve.url)).then(De=>{De&&De.length>0?z.decodeScanOfflineFile(De).then(mt=>{let ut=this._arrayBufferToBase64(mt.getWrappedImage()??new Uint8Array),pt=mt.getWrappedImageExtension(),Be=mt.scanOfflineData?.scanResult;if(ut){let gt=new Image;gt.src="data:image/"+pt+";base64,"+ut,gt.crossOrigin="anonymous",gt.onload=()=>{var Et=document.createElement("canvas");Et.width=gt.width,Et.height=gt.height;const dt=Et.getContext("2d");dt?.drawImage(gt,0,0,Et.width,Et.height);let Pt=E.resultsData?.answerObjs??[];if(Be?.examCodeRegion?.circles&&Be?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(Be?.examCodeRegion?.circles,dt),Be?.studentCodeRegion?.circles&&Be?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(Be?.studentCodeRegion?.circles,dt),Be?.answerRegion?.circles&&Be?.answerRegion?.circles.length>0&&this.drawCircles(Be?.answerRegion?.circles,dt,Pt,1,M?.filter(At=>this.sAztAnswerTypeService.isOneChoiceAnswer(At))),Be?.answerRegion?.trueFalseCircles&&Be?.answerRegion?.trueFalseCircles.length>0&&this.drawCircles(Be?.answerRegion?.trueFalseCircles,dt,Pt,5,M?.filter(At=>this.sAztAnswerTypeService.isTrueFalseAnswer(At))),Be?.answerRegion?.fillBlankCircles&&Be?.answerRegion?.fillBlankCircles.length>0&&this.drawCircles(Be?.answerRegion?.fillBlankCircles,dt,Pt,4,M?.filter(At=>this.sAztAnswerTypeService.isFillAnswer(At))),Be?.answerRegion?.essayCircles&&Be?.answerRegion?.essayCircles.length>0&&R&&this.drawCommonCircles(Be?.answerRegion?.essayCircles,dt),dt&&dt.fillText((this.commonService.myTranslateInstant("lang_auto_tong")??"T\u1ed5ng")+" = "+this.totalPointExam.toFixed(2)+" - Version:"+Be?.templateType,25,50),Be?.answerRegion?.handwrittenAnswers&&Be?.answerRegion?.handwrittenAnswers.length>0){let At=Be?.answerRegion?.handwrittenAnswers,Ot="18px";if(dt){dt.fillStyle="#00ff00",dt.font=Ot+" Comic Sans MS",dt.textAlign="center";for(let qt=0;qt<At.length;qt++){let wt=At[qt];this.fillTextAnswerDrawForFileAzt(wt.recognizedText??"",dt,Pt[qt],((wt.bottomRight.x??0)+(wt.topLeft.x??0))/2-3,((wt.bottomRight.y??0)+(wt.topLeft.y??0))/2+5)}}}D=Et.toDataURL("image/jpeg",.9),xe({imgUrl:D})}}else xe({imgUrl:D})}):xe({imgUrl:D})}).catch(De=>{Pe(De)}):xe({imgUrl:D})})}drawScanFileToCanvas(E){return new Promise(R=>{var M="",U=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(E.images??""));let xe=U?this.sAztCommonCdnService.getMyCdn(U.url):"";if(U&&xe){let Pe=new Image;Pe.src=xe,Pe.crossOrigin="anonymous",Pe.onload=()=>{var D=document.createElement("canvas");D.width=Pe.width,D.height=Pe.height;const Ve=D.getContext("2d");Ve?.drawImage(Pe,0,0,D.width,D.height);var De=E.resultsData?.answerObjs??[],mt=this.commonService.willDeleteParseJson(E.resultsData?.pos??"");if("2.0"==mt.version)try{let rn=Uint8Array.from(atob(mt.resultFilledPos),di=>di.charCodeAt(0)),xn=new Ke(rn).parseDrawData(),Ar=xn.studentId?.answers??[];for(var ut=0;ut<Ar.length;ut++)this.tickStudentIdAndExamId(Ar[ut],Ve,xn.answerTable?.radius??0);let Mn=xn.examId?.answers??[];for(ut=0;ut<Mn.length;ut++)this.tickStudentIdAndExamId(Mn[ut],Ve,xn.answerTable?.radius??0);let Cn=xn.answerTable?.answers??[];for(ut=0;ut<Cn.length;ut++)this.answerPaintedRightOrWrong(Cn[ut],Ve,xn.answerTable?.radius??0,De);M=D.toDataURL("image/jpeg",.9),R(M)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),R("")}else if("3.0"==mt.version)try{let rn=mt.answersHandwritten??[],xn=(rn[0].answerRegion.height??0)-20+"px";if(Ve){Ve.fillStyle="#00ff00",Ve.font=xn+" Comic Sans MS",Ve.textAlign="center";for(let Mn=0;Mn<rn.length;Mn++){let Cn=rn[Mn],Ro=this.getTextAnswerDraw(L[-1==Cn.answer?26:Cn.answer],Ve,De[Mn]);Ve.fillText(Ro,(Cn.answerRegion.x??0)+(Cn.answerRegion.width??0)/2,(Cn.answerRegion.y??0)+(Cn.answerRegion.height??0)/2+5)}}M=D.toDataURL("image/jpeg",.9),R(M)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),R("")}else{var pt=mt.configurationPos.split("_"),Be=mt.resultFilledPos.split("_"),gt=mt.tableAnchorPos.split("_"),Et=this.checkWrongOrTrueAnswer(De),dt=0;for(ut=0;ut<pt.length;ut++)if(1==ut||2==ut){var Pt=pt[ut].split("*");dt+=parseInt(Pt[1],10)}var At=0;for(ut=0;ut<gt.length;ut++)if(ut>=2){var Ot={},Ft={},qt=gt[ut].split("*"),wt=qt[0].split(":"),In=qt[1].split(":"),Vt={},W=pt[ut].split("*");Vt.row=parseInt(W[0],10),Vt.col=parseInt(W[1],10),Vt.radius=parseInt(W[2],10),Ot.x=parseInt(wt[0],10),Ot.y=parseInt(wt[1],10),Ft.x=parseInt(In[0],10),Ft.y=parseInt(In[1],10);for(var st=(Ft.y-Ot.y)/(Vt.row+1),k=Ot.y,Oe=0;Oe<Vt.row;Oe++)if((k+=st)>Ot.y&&k<Ft.y){var ot=At<De.length?this.checkAnswerStudentRight(At,De):0;At++,0!=ot&&Ve&&(Ve.beginPath(),Ve.arc(Ot.x+st*ot,k,Vt.radius,0,2*Math.PI,!1),Ve.lineWidth=3,Ve.strokeStyle="#f3c12c",Ve.stroke())}}var Ht=0;for(Oe=0;Oe<Be.length;Oe++)if("empty"!=Be[Oe]){var on=Be[Oe].split(":"),wn={x:parseInt(on[0],10),y:parseInt(on[1],10),line:parseInt(on[2],10)};Oe<dt+Et.length&&(Oe>=dt?(Ve&&(Ve.beginPath(),Ve.arc(wn.x,wn.y,wn.line,0,2*Math.PI,!1),Ve.lineWidth=3,Ve.strokeStyle=Et[Ht],Ve.stroke()),Ht++):Ve&&(Ve.beginPath(),Ve.arc(wn.x,wn.y,wn.line,0,2*Math.PI,!1),Ve.lineWidth=3,Ve.strokeStyle="#00ff00",Ve.stroke()))}M=D.toDataURL("image/jpeg",.9),R(M)}}}else R("")})}_arrayBufferToBase64(E){for(var R="",M=new Uint8Array(E),U=M.byteLength,xe=0;xe<U;xe++)R+=String.fromCharCode(M[xe]);return window.btoa(R)}httpGetAsync(E){return new Promise((R,M)=>{try{const U=new XMLHttpRequest;U.open("GET",E,!0),U.responseType="arraybuffer",U.onload=xe=>{if(200===U.status||304===U.status){const Pe=U.response;if(Pe){const D=new Uint8Array(Pe);R(D)}else R(new Uint8Array)}else R(new Uint8Array)},U.onerror=xe=>{M(new Error("lang_core_cant_loading_url"))},U.send(null)}catch(U){M(U)}})}fillTextAnswerDrawForFileAzt(E,R,M,U,xe){let Pe="";M&&(E?M.rightAnswer&&"ESSAY"!=M.content&&M.rightAnswer!=E?(R.fillStyle="#f3c12c",R.fillText("["+M.rightAnswer+"]",U+15,xe),R.fillStyle="red",Pe=E+"-",U-=10):M.rightAnswer&&"ESSAY"!=M.content?(R.fillStyle="#00ff00",Pe+=E):(R.fillStyle="red",Pe+=E):(R.fillStyle="#f3c12c",Pe+=M.rightAnswer)),R.fillText(Pe,U,xe)}drawCommonCircles(E,R){E.length>0&&E.forEach(M=>{if(M.filled){let U=M.center.x,xe=M.center.y;R&&(R.beginPath(),R.arc(U,xe,M.radius+1,0,2*Math.PI,!1),R.lineWidth=2,R.strokeStyle="#00ff00",R.stroke())}})}drawCircles(E,R,M,U,xe){let Pe=[],D=[],Ve=["A","B","C","D"],De=0;if(M.length>0){let Be=M.filter(dt=>1==dt.answerType||2==dt.answerType).length??0,gt=M.filter(dt=>5==dt.answerType).length??0,Et=M.filter(dt=>4==dt.answerType).length??0;De=1==U?Be:4==U?Et:gt;for(let dt=0;dt<M.length;dt++){let Pt="";if(this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:M[dt].answerType})){let At=M[dt].rightAnswer?.split("|")??[];for(let Ot=0;Ot<Ve.length;Ot++)Pt=dt+1-Be+""+Ve[Ot]+"F",At.includes(Ve[Ot])&&(Pt=dt+1-Be+""+Ve[Ot]+"T"),this.commonService.isExistInArray(Pe,Pt)||Pe.push(Pt)}else this.sAztAnswerTypeService.isFillAnswer({answerType:M[dt].answerType})?(Pt=dt+1-Be-gt+"_"+M[dt].rightAnswer,this.commonService.isExistInArray(Pe,Pt)||Pe.push(Pt)):this.sAztAnswerTypeService.isOneChoiceAnswer({answerType:M[dt].answerType})&&(Pt=dt+1+""+M[dt].rightAnswer,this.commonService.isExistInArray(Pe,Pt)||Pe.push(Pt));this.sAztAnswerTypeService.isEssayAnswer({answerType:M[dt].answerType})&&D.push(dt+1)}}let pt=1==U?1:5==U?2:4==U?3:1;if(R){R.fillStyle="#ff0024",R.font="25px Comic Sans MS";let Be=0,gt=0,Et=0,dt="P-"+(1==pt?"TN":2==pt?"\u0110/S":"\u0110T")+": ",Pt=!1;(xe??[]).forEach(At=>{let Ot=M.find(Ft=>At.id==Ft.questionId);if((this.sAztAnswerTypeService.isOneChoiceAnswer(At)||this.sAztAnswerTypeService.isFillAnswer(At))&&(Be++,Ot?.isRight&&(gt+=At.testedScore??0,Et++)),this.sAztAnswerTypeService.isTrueFalseAnswer(At)){gt+=At.testedScore??0;let Ft=0,qt="";for(let wt=0;wt<4;wt++)Ot?.rightAnswers?.includes(L[wt])?qt+="T":qt+="F";if(Ot?.content)for(let wt=0;wt<4;wt++)Ot.content[wt]==qt[wt]&&Ft++;Pt=!0,dt+=" "+Ft+"/4;"}}),this.totalPointExam+=gt,dt+=Pt?" = "+gt.toFixed(2):Et+"/"+Be+" = "+gt.toFixed(2),this.drawWrappedText(R,dt,25,30+25*((2==pt?3:3==pt?2:pt)+1),600,25)}E.forEach(Be=>{let gt=0;gt=this.sAztAnswerTypeService.isTrueFalseAnswer({answerType:U})?Number(Be.label.substring(0,Be.label.length-2)):this.sAztAnswerTypeService.isFillAnswer({answerType:U})?Number(Be.label.substring(0,Be.label.indexOf("_"))):Number(Be.label.substring(0,Be.label.length-1));let Et="";if(0==Pe.length)Et="#00ff00";else if(this.sAztAnswerTypeService.isFillAnswer({answerType:U})){let dt=Be.label.substring(0,Be.label.indexOf("_")+1),Pt=Pe.find(At=>At.includes(dt));if(Pt){let At=Pt?.split("_"),Ot=Be.label.split("_");if(Be.filled&&(Et="red"),At[0]==Ot[0])if("-"==Ot[2]&&At[1].includes("-"))0==Number(Ot[1])&&(Et=Be.filled?"#00ff00":"#f3c12c");else if(","==Ot[2]&&At[1].includes(",")){let Ft=At[1].indexOf(",");Number(Ot[1])==Ft&&(Et=Be.filled?"#00ff00":"#f3c12c")}else"-"!=Ot[2]&&","!=Ot[2]&&At[1][Number(Ot[1])]==Ot[2]&&(Et=Be.filled?"#00ff00":"#f3c12c")}}else this.commonService.isExistInArray(Pe,Be.label)?Et=Be.filled?"#00ff00":"#f3c12c":Be.filled&&(Et="red");if(Et&&gt<=De&&!this.commonService.isExistInArray(D,gt)){let dt=Be.center.x,Pt=Be.center.y;R&&(R.beginPath(),R.arc(dt,Pt,Be.radius+1,0,2*Math.PI,!1),R.lineWidth=2,R.strokeStyle=Et,R.stroke())}})}drawWrappedText(E,R,M,U,xe,Pe){const D=R.split(" ");let Ve="";D.forEach(De=>{const mt=Ve+De+" ";E.measureText(mt).width>xe&&""!==Ve?(E.fillText(Ve,M,U),Ve=De+" ",U+=Pe):Ve=mt}),E.fillText(Ve,M,U)}checkAnswerStudentRight(E,R){var M=0;return R[E]&&""!=R[E].rightAnswer&&0==R[E].isRight&&(M="A"==R[E].rightAnswer?1:"B"==R[E].rightAnswer?2:"C"==R[E].rightAnswer?3:"D"==R[E].rightAnswer?4:"E"==R[E].rightAnswer?5:"F"==R[E].rightAnswer?6:"G"==R[E].rightAnswer?7:"H"==R[E].rightAnswer?8:0),M}checkWrongOrTrueAnswer(E){for(var R=[],M=0;M<E.length;M++)""!=E[M].content&&(1==E[M].isRight?R.push("#00ff00"):0==E[M].isRight&&R.push("red"));return R}tickStudentIdAndExamId(E,R,M){var U=256*Math.floor((E.position??0)/16)+E.x,xe=(E.position??0)%16*256+E.y;(E.filledCols??0)>=128&&R&&(R.beginPath(),R.arc(U,xe,M,0,2*Math.PI,!1),R.lineWidth=3,R.strokeStyle="#00ff00",R.stroke())}answerPaintedRightOrWrong(E,R,M,U){var xe=256*Math.floor((E.position??0)/16)+E.x,Pe=(E.position??0)%16*256+E.y,D=E.rows??0,De="#fff0";U.length>D&&((E.filledCols??0)>=128?De=1==U[D].isRight?"#00ff00":"red":(E.filledCols??0)%128+1==this.checkAnswerStudentRight(D,U)&&(De="#f3c12c"),R&&(R.beginPath(),R.arc(xe,Pe,M,0,2*Math.PI,!1),R.lineWidth=3,R.strokeStyle=De,R.stroke()))}getTextAnswerDraw(E,R,M){let U="";return M&&(E?M.isRight?(R.fillStyle="#00ff00",U+=E):(R.fillStyle="red",U=E+" - ["+M.rightAnswer+"]"):(R.fillStyle="#f3c12c",U+=M.rightAnswer)),U}}return(P=I).\u0275fac=function(E){return new(E||P)(d.KVO(be.R),d.KVO(H.j),d.KVO(pe._),d.KVO(Xe.c))},P.\u0275prov=d.jDH({token:P,factory:P.\u0275fac,providedIn:"root"}),I})();const je=P=>({flex:P}),_e=P=>({"mr-2":P}),Se=()=>({"flex-none mr-1":!0});function $e(P,I){1&P&&(d.qex(0),d.j41(1,"span"),d.EFF(2),d.nI1(3,"mytranslate"),d.k0s(),d.bVm()),2&P&&(d.R7$(2),d.JRh(d.bMT(3,1,"lang_test_review_error_get_url_img")))}function Le(P,I){1&P&&(d.j41(0,"div",14)(1,"span",15),d.nrm(2,"azt-loading-ui"),d.k0s()())}function ht(P,I){if(1&P){const O=d.RV6();d.j41(0,"div",16)(1,"div",17)(2,"div",18)(3,"label",19),d.EFF(4),d.nI1(5,"mytranslate"),d.k0s(),d.j41(6,"input",20,1),d.nI1(8,"mytranslate"),d.bIt("input",function(){d.eBV(O);const R=d.sdS(7),M=d.XpG(2);return d.Njj(M.setStudentCode(R))}),d.k0s()(),d.j41(9,"div",21)(10,"label",22),d.EFF(11),d.nI1(12,"mytranslate"),d.k0s(),d.j41(13,"input",23,2),d.nI1(15,"mytranslate"),d.bIt("input",function(){d.eBV(O);const R=d.sdS(14),M=d.XpG(2);return d.Njj(M.setExamCode(R))}),d.k0s()()(),d.j41(16,"h3",24),d.nrm(17,"lucide-icon",25),d.j41(18,"span",26),d.EFF(19,"Click \u1ea3nh \u0111\u1ec3 \u0111\xe1nh d\u1ea5u v\u1ecb tr\xed c\u1ea7n s\u1eeda"),d.k0s()(),d.j41(20,"div",27)(21,"div",28,3)(23,"img",29),d.bIt("click",function(R){d.eBV(O);const M=d.XpG(2);return d.Njj(M.clickOnImage(R))}),d.k0s()()()()}if(2&P){const O=d.XpG(2);d.R7$(),d.Y8G("ngClass",d.eq3(20,je,!O.isMobileDevice)),d.R7$(),d.Y8G("ngClass",d.eq3(22,_e,!O.isMobileDevice)),d.R7$(2),d.JRh(d.bMT(5,12,"lang_auto_so_bao_danh")),d.R7$(2),d.FS9("placeholder",d.bMT(8,14,"lang_core_nhap_so_ba_danh")),d.Y8G("formControl",O.studentCode),d.R7$(5),d.JRh(d.bMT(12,16,"lang_auto_ma_de")),d.R7$(2),d.FS9("placeholder",d.bMT(15,18,"lang_core_nhap_ma_de")),d.Y8G("formControl",O.examCode),d.R7$(4),d.Y8G("ngClass",d.lJ4(24,Se)),d.R7$(6),d.Aen(O.isMobileWebView?"width: 100% !important;":"height: auto !important;"),d.Y8G("src",O.fileScanUrl,d.B4B)}}function Ye(P,I){if(1&P&&d.DNE(0,Le,3,0,"div",12)(1,ht,24,25,"div",13),2&P){const O=d.XpG();d.Y8G("ngIf",O.loadingScanUrl),d.R7$(),d.Y8G("ngIf",!O.loadingScanUrl)}}function qe(P,I){1&P&&(d.j41(0,"span",30),d.nrm(1,"azt-loading-ui"),d.k0s())}let Ne=(()=>{var P;class I extends Y._{setStudentCode(E){E.value=E.value.replace(/\D/g,""),E.value.length>this.myEnvironment.maxStudentCodeLength&&(E.value=E.value.slice(0,-1)),this.processData.setStudentCode(E.value),this.processDrawImage()}setExamCode(E){E.value=E.value.replace(/\D/g,""),E.value.length>this.myEnvironment.maxExamCodeLength&&(E.value=E.value.slice(0,-1)),this.processData.setExamCode(E.value),this.processDrawImage()}confirmEdit(){this.initStatusObj(),this.processor.uploadToServer().then(E=>{if(!E.success){let R=E.errorMessage;return"azt_lang_core_code_exam"==R&&(R=this.commonService.myTranslateInstant("lang_core_offline_exam_not_found_offline_mix_question_hash_id")??"M\xe3 \u0111\u1ec1 thi kh\xf4ng t\u1ed3n t\u1ea1i"),this.errorStatusObj(R??"lang_core_invalid_data",!0)}this.successStatusObj("lang_auto_luu_thanh_cong",!0),this.dialogRef.close(!0)})}btnCloseDialog(){this.dialogRef.close(!1)}loadScriptHandleImage(){var E=this;this.commonService.loadAnswerSheetJs().then(()=>{var R=this.userService.getUserObj();window.azotaScanAnswerSheet.examResultProcessor(R.rememberToken,"https://"+le.c.base_embed_link,this.data.resultId,R.id).then(function(){var M=(0,ce.A)(function*(U){E.processor=U,E.initData()});return function(U){return M.apply(this,arguments)}}()).catch(()=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}).catch(R=>{this.errorStatusObj("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai",!0)})}clickOnImage(E){const R=E.target,M=R.getBoundingClientRect();this.processData.clickToImage(R.naturalWidth/M.width*(E.clientX-M.left),R.naturalHeight/M.height*(E.clientY-M.top)),this.setFormCode(),this.processDrawImage()}drawCircleImg(E,R){E&&E.length>0&&(this.circleRadius=E[0].radius,E.forEach(M=>{if(M.filled&&R){let U=M.center.x,xe=M.center.y;R.beginPath(),R.arc(U,xe,M.radius+1,0,2*Math.PI,!1),R.lineWidth=3,R.strokeStyle="red",R.stroke()}}))}processDrawImage(){let E=this.drawScanExamService._arrayBufferToBase64(this.processData.getWrappedImage()??new Uint8Array),R=this.processData.getWrappedImageExtension(),M=this.processData.getFilledCircles();if(this.imgSize=this.processor.getImageSize(),!E)return this.loadingScanUrl=!1,void(this.fileScanUrl="");let U=new Image;U.src="data:image/"+R+";base64,"+E,U.crossOrigin="anonymous";var xe=document.createElement("canvas");xe.width=this.imgSize.width,xe.height=this.imgSize.height;const Pe=xe.getContext("2d");U.onload=()=>{Pe?.drawImage(U,0,0,xe.width,xe.height),this.drawCircleImg(M,Pe),this.fileScanUrl=xe.toDataURL("image/jpeg",.9),this.loadingScanUrl=!1}}setFormCode(){this.studentCode.setValue(this.processData.scanOfflineData.scanResult.getStudentCode()??""),this.examCode.setValue(this.processData.scanOfflineData.scanResult.getSubExamCode()??"")}initData(){this.data.resultId&&(this.loadingScanUrl=!0,this.processData=this.processor.getData(),this.setFormCode(),this.processDrawImage())}ngOnInit(){super.ngOnInit(),this.loadScriptHandleImage()}constructor(E,R,M,U){super(U,M),this.userService=E,this.drawScanExamService=R,this.dialogRef=M,this.loadingScanUrl=!0,this.fileScanUrl="",this.circleRadius=0,this.imgSize={width:0,height:0},this.studentCode=new te.MJ("",{nonNullable:!0}),this.examCode=new te.MJ("",{nonNullable:!0})}}return(P=I).\u0275fac=function(E){return new(E||P)(d.rXU(de.R),d.rXU(se),d.rXU(b.CP,8),d.rXU(b.Vh,8))},P.\u0275cmp=d.VBU({type:P,selectors:[["app-edit-scan-file-dialog"]],standalone:!0,features:[d.Vt3,d.aNF],decls:14,vars:10,consts:[["showImgScan",""],["elementStudentCode",""],["elementExamCode",""],["imageHolding",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","justify-end"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-32","btn-primary","items-center",3,"click","disabled"],["class","inline-block mr-2",4,"ngIf"],[2,"vertical-align","midle"],["class","p-5 flex justify-center items-center",4,"ngIf"],["class","p-5",4,"ngIf"],[1,"p-5","flex","justify-center","items-center"],[1,"w-5","h-5","inline-block","mr-2"],[1,"p-5"],[3,"ngClass"],[1,"w-full",3,"ngClass"],["for","codeStudent",1,"form-label","text-md","font-semibold","m-0"],["type","text","id","codeStudent",1,"form-control",3,"input","formControl","placeholder"],[1,"w-full"],["for","codeExam",1,"form-label","text-md","font-semibold","m-0"],["type","text","id","codeExam",1,"form-control",3,"input","formControl","placeholder"],[1,"mt-2","text-md","font-semibold","flex","text-slate-500","items-center"],["name","info","size","16",3,"ngClass"],[2,"vertical-align","middle"],[1,"text-center","mx-auto","mt-1",2,"height","calc(var(--vh, 1vh) * 100 - 300px)","overflow-y","auto"],["id","image-holding"],["id","img-container","alt","img",3,"click","src"],[1,"inline-block","mr-2"]],template:function(E,R){if(1&E){const M=d.RV6();d.j41(0,"div",4)(1,"div",5),d.DNE(2,$e,4,3,"ng-container",6)(3,Ye,2,2,"ng-template",null,0,d.C5r),d.k0s(),d.j41(5,"div",7)(6,"button",8),d.bIt("click",function(){return d.eBV(M),d.Njj(R.btnCloseDialog())}),d.EFF(7),d.nI1(8,"mytranslate"),d.k0s(),d.j41(9,"button",9),d.bIt("click",function(){return d.eBV(M),d.Njj(R.confirmEdit())}),d.DNE(10,qe,2,0,"span",10),d.j41(11,"span",11),d.EFF(12),d.nI1(13,"mytranslate"),d.k0s()()()()}if(2&E){const M=d.sdS(4);d.R7$(2),d.Y8G("ngIf",!R.loadingScanUrl&&!R.fileScanUrl)("ngIfElse",M),d.R7$(5),d.SpI(" ",d.bMT(8,6,"lang_cms_common_close_btn")," "),d.R7$(2),d.Y8G("disabled",R.statusObj.loading),d.R7$(),d.Y8G("ngIf",R.statusObj.loading),d.R7$(2),d.JRh(d.bMT(13,8,"lang_auto_luu"))}},dependencies:[J.R,G.MD,G.YU,G.bT,te.X1,te.me,te.BC,te.l_,x.iI,te.YN,v.wp,F.s,_.flO,_.WGl,f.L,q.Id,$.k],encapsulation:2}),I})();var ct=g(46899),Ze=g(47712);const it=()=>({"text-slate-800":!0}),Re=()=>({"text-danger":!0}),vt=P=>({"text-success":P});function Ue(P,I){if(1&P){const O=d.RV6();d.j41(0,"div",18)(1,"a",19),d.nI1(2,"mytranslate"),d.bIt("click",function(){let R;d.eBV(O);const M=d.XpG(2);return d.Njj(M.openEditScanFile(null!==(R=null==M.examObj?null:M.examObj.hashId)&&void 0!==R?R:"",M.examResultIdParam))}),d.nrm(3,"lucide-icon",20),d.k0s()()}2&P&&(d.R7$(),d.Y8G("matTooltip",d.bMT(2,2,"lang_auto_sua")),d.R7$(2),d.Y8G("ngClass",d.lJ4(4,it)))}function fe(P,I){if(1&P){const O=d.RV6();d.j41(0,"div",21)(1,"a",22),d.nI1(2,"mytranslate"),d.bIt("click",function(){let R;d.eBV(O);const M=d.XpG(2);return d.Njj(M.deleteOfflineExamResultObj(null!==(R=null==M.examObj?null:M.examObj.hashId)&&void 0!==R?R:"",M.examResultIdParam))}),d.nrm(3,"lucide-icon",23),d.k0s()()}2&P&&(d.R7$(),d.Y8G("matTooltip",d.bMT(2,2,"lang_auto_xoa")),d.R7$(2),d.Y8G("ngClass",d.lJ4(4,Re)))}function We(P,I){1&P&&(d.j41(0,"span",24),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&P&&(d.R7$(),d.SpI("",d.bMT(2,1,"lang_auto_anh_cham"),":"))}function Je(P,I){1&P&&(d.j41(0,"span"),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&P&&(d.R7$(),d.JRh(d.bMT(2,1,"lang_auto_luu_trong_app_mobile")))}function Lt(P,I){1&P&&(d.qex(0),d.j41(1,"span"),d.EFF(2),d.nI1(3,"mytranslate"),d.k0s(),d.bVm()),2&P&&(d.R7$(2),d.JRh(d.bMT(3,1,"lang_test_review_error_get_url_img")))}function xt(P,I){1&P&&(d.j41(0,"span",30),d.nrm(1,"azt-loading-ui"),d.k0s())}function et(P,I){if(1&P&&d.nrm(0,"img",31),2&P){const O=d.XpG(4);d.Aen(O.isMobileWebView?"width: 100% !important;":"height: auto !important;"),d.Y8G("src",O.fileScanUrl,d.B4B)}}function V(P,I){if(1&P){const O=d.RV6();d.j41(0,"a",27),d.bIt("click",function(){d.eBV(O);const R=d.XpG(3);return d.Njj(R.onShowFile(R.fileScanUrl))}),d.DNE(1,xt,2,0,"span",28)(2,et,1,3,"img",29),d.k0s()}if(2&P){const O=d.XpG(3);d.R7$(),d.Y8G("ngIf",O.loadingScanUrl),d.R7$(),d.Y8G("ngIf",!O.loadingScanUrl)}}function X(P,I){if(1&P&&(d.j41(0,"div",25),d.DNE(1,Lt,4,3,"ng-container",26)(2,V,3,2,"ng-template",null,2,d.C5r),d.k0s()),2&P){const O=d.sdS(3),E=d.XpG(2);d.R7$(),d.Y8G("ngIf",!E.loadingScanUrl&&!E.fileScanUrl)("ngIfElse",O)}}function ee(P,I){if(1&P&&(d.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"h3",7)(4,"span"),d.EFF(5),d.nI1(6,"mytranslate"),d.k0s()(),d.DNE(7,Ue,4,5,"div",8)(8,fe,4,5,"div",9),d.k0s()(),d.j41(9,"div",10)(10,"div",6)(11,"span",11),d.eu8(12,12),d.k0s(),d.j41(13,"span",13),d.nI1(14,"mytranslate"),d.eu8(15,12),d.k0s()(),d.j41(16,"div",14),d.DNE(17,We,3,3,"span",15)(18,Je,3,3,"span",16),d.k0s(),d.DNE(19,X,4,2,"div",17),d.k0s()()),2&P){const O=d.XpG(),E=d.sdS(2),R=d.sdS(4);d.R7$(5),d.JRh(d.bMT(6,9,"lang_auto_thi_offline")),d.R7$(2),d.Y8G("ngIf","teacher"==O.currentScreen),d.R7$(),d.Y8G("ngIf",O.isDeletableExamResultObj),d.R7$(4),d.Y8G("ngTemplateOutlet",E),d.R7$(),d.FS9("matTooltip",d.bMT(14,11,"lang_auto_so_bao_danh")),d.R7$(2),d.Y8G("ngTemplateOutlet",R),d.R7$(2),d.Y8G("ngIf",!O.isMobileWebView),d.R7$(),d.Y8G("ngIf",!O.checkHttpLinkImg),d.R7$(),d.Y8G("ngIf",O.checkHttpLinkImg)}}function S(P,I){if(1&P&&(d.EFF(0),d.nI1(1,"mytranslate"),d.j41(2,"span",32),d.EFF(3),d.nI1(4,"checkFormatOfflineExamHashIdToNumber"),d.k0s()),2&P){let O;const E=d.XpG();d.SpI(" ",d.bMT(1,3,"lang_auto_ma_de_thi"),":\xa0 "),d.R7$(2),d.Y8G("ngClass",d.eq3(8,vt,!(null!=E.offlineMarkObj&&E.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),d.R7$(),d.JRh(d.i5U(4,5,null!==(O=null==E.offlineMixQuestionObj?null:E.offlineMixQuestionObj.hashId)&&void 0!==O?O:0,null==E.offlineMarkObj?null:E.offlineMarkObj.templateType))}}function B(P,I){if(1&P&&(d.EFF(0),d.nI1(1,"mytranslate"),d.j41(2,"span",32),d.EFF(3),d.nI1(4,"checkFormatStudentCodeToNumber"),d.k0s()),2&P){let O;const E=d.XpG();d.SpI(" ",d.bMT(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),d.R7$(2),d.Y8G("ngClass",d.eq3(8,vt,!(null!=E.offlineMarkObj&&E.offlineMarkObj.isErrorForStudentCode))),d.R7$(),d.JRh(d.i5U(4,5,(null!==(O=null==E.offlineMarkObj?null:E.offlineMarkObj.studentCode)&&void 0!==O?O:0)<0?0:null==E.offlineMarkObj?null:E.offlineMarkObj.studentCode,null==E.offlineMarkObj?null:E.offlineMarkObj.templateType))}}let Z=(()=>{var P;class I extends o.H{checkAzotaFile(E){return!(!E||!E.includes(".azt"))}checkHttpUrl(E){return!(!E||!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(E))}openEditScanFile(E,R){R&&this.sAztDialogService.open(Ne,{data:{examHashId:E,resultId:R,userId:Number(this.userIdParam)},width:"750px",restoreFocus:!1}).afterClosed().subscribe(U=>{U&&window.location.reload()})}deleteOfflineExamResultObj(E,R){R&&this.sAztDialogService.open(y.V,{data:{examHashId:E,examResultIds:[R],examResults:[]},restoreFocus:!1}).afterClosed().subscribe(U=>{U&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(E){this.sAztDialogService.open(h.V,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:E,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let E=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),R=this.castJsonToObj(E);this.checkHttpLinkImg=this.checkHttpUrl(R?.url),this.loadingScanUrl=!0,this.checkAzotaFile(R?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam,this.questionObjs,this.essayMark).then(M=>{M.imgUrl?this.fileScanUrl=M.imgUrl:this.checkHttpLinkImg=!0,this.drawScanExamService.totalPointExam=0,this.loadingScanUrl=!1}).catch(M=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(M=>{M?this.fileScanUrl=M:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(M=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(E,R,M){super(),this.sAztDialogService=E,this.zipDataService=R,this.drawScanExamService=M,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return(P=I).\u0275fac=function(E){return new(E||P)(d.rXU(ct.i),d.rXU(H.j),d.rXU(se))},P.\u0275cmp=d.VBU({type:P,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",currentScreen:"currentScreen",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj",questionObjs:"questionObjs",essayMark:"essayMark"},standalone:!0,features:[d.Vt3,d.OA$,d.aNF],decls:5,vars:1,consts:[["viewExamCodeTpl",""],["viewStudentCodeTpl",""],["showImgScan",""],["class","info-exam-offline mt-3 mb-3",4,"ngIf"],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],["class","mx-1 items-center",4,"ngIf"],["class","mx-1 items-center mr-0",4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],[4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],[1,"mx-1","items-center"],[1,"text-slate-800",3,"click","matTooltip"],["name","file-pen-line","size","18",3,"ngClass"],[1,"mx-1","items-center","mr-0"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click","matTooltip"],["name","trash-2","size","18",3,"ngClass"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["class","w-5 h-5 inline-block mr-2",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],[1,"w-5","h-5","inline-block","mr-2"],["alt","img",3,"src"],[3,"ngClass"]],template:function(E,R){1&E&&d.DNE(0,ee,20,13,"div",3)(1,S,5,10,"ng-template",null,0,d.C5r)(3,B,5,10,"ng-template",null,1,d.C5r),2&E&&d.Y8G("ngIf",R.offlineMarkObj)},dependencies:[J.R,G.MD,G.YU,G.bT,G.T3,te.X1,x.iI,te.YN,v.wp,F.s,Ze.oV,_.flO,_.WGl,f.L,v.Ps,v.OK,q.Id,$.k],encapsulation:2}),I})()},99965:(Tt,Ae,g)=>{"use strict";g.d(Ae,{j:()=>h});var o=g(48891);let h=(()=>{var y;class ce{constructor(b){this.el=b}onInput(){this.adjustTextAreaHeight(this.el.nativeElement)}onFocus(){this.adjustTextAreaHeight(this.el.nativeElement)}ngAfterViewInit(){this.adjustTextAreaHeight(this.el.nativeElement)}adjustTextAreaHeight(b){b.parentElement&&(b.parentElement.style.minHeight=b.parentElement.clientHeight+"px"),b.style.overflow="hidden",b.style.height="auto";let Y=b.scrollHeight+30;Y=Y<57?57:Y,b.style.height=Y+"px",b.parentElement&&(b.parentElement.style.minHeight="auto")}}return(y=ce).\u0275fac=function(b){return new(b||y)(o.rXU(o.aKT))},y.\u0275dir=o.FsC({type:y,selectors:[["textarea","autoResize",""]],hostBindings:function(b,Y){1&b&&o.bIt("input",function(J){return Y.onInput(J.target.value)})("focus",function(){return Y.onFocus()})},standalone:!0}),ce})()},1382:(Tt,Ae,g)=>{"use strict";g.d(Ae,{I:()=>b});var o=g(73014),h=g(48891),y=g(543),ce=g(58112),te=g(99927);let b=(()=>{var Y;class le{constructor(G,x,v){this.commonService=G,this.sAztCommonCdnService=x,this.answerTypeService=v}convertUrlToBase64(G){return(0,o.A)(function*(){const v=yield(yield fetch(G+"?t="+(new Date).getTime())).blob();return new Promise(F=>{const _=new FileReader;_.readAsDataURL(v),_.onloadend=()=>{F(_.result)}})})()}convertLinkToBase64(G,x,v){var F=this;return(0,o.A)(function*(){if(!x)return v;for(let f=0;f<(G?.length??0);f++)if(G?.[f].link===v)return G?.[f].convert;var _=yield F.convertUrlToBase64(v);return G?.push({convert:_,link:v}),_})()}replaceCanvasBackground(G,x){var v=this;return(0,o.A)(function*(){if(G){var F=[];for(let we=0;we<G.length;we++){var _=G[we];if(_&&0===_.isImage){var f=_.questionContentParse?.[0].content;_.questionContentParse&&(_.questionContentParse[0].content="");var q=void 0===f?[]:f.split("@[]");for(let Ke=0;Ke<q.length;Ke++){var $=q[Ke];if(!0===v.commonService.isJson($)){var d=v.commonService.willDeleteParseJson($);if(d.hasOwnProperty("link")){var de=document.body.offsetWidth,me=1;d.data.width>(Ie=de-30)&&(d.data={x:d.data.x*(me=Ie/d.data.width),y:d.data.y*me,width:d.data.width*me,height:d.data.height*me}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},_.questionContentParse&&(_.questionContentParse[0].content+=`<div class="background_question_${we}_${Ke}"><img width="${1024*me}" height="${1024*me}" src="${yield v.convertLinkToBase64(F,x,v.sAztCommonCdnService.getMyCdn(d.link))}"></div>`);var nt=document.createElement("style");document.body.appendChild(nt),nt.textContent+=`.background_question_${we}_${Ke} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${we}_${Ke} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else _.questionContentParse&&(_.questionContentParse[0].content+=$)}else _.questionContentParse&&(_.questionContentParse[0].content+=$)}if(v.answerTypeService.isOneChoiceAnswer(_))for(let Ke=0;Ke<(_.answerConfigParse?.length??0);Ke++){var tt=_.answerConfigParse?.[Ke].content;_.answerConfigParse&&(_.answerConfigParse[Ke].content="");var rt=void 0===tt?[]:tt.split("@[]");for(let oe=0;oe<rt.length;oe++){var He=rt[oe];if(!0===v.commonService.isJson(He)){var ve=v.commonService.willDeleteParseJson(He);ve.hasOwnProperty("link")?(de=document.body.offsetWidth,me=1,ve.data.width>(Ie=de-30)&&(ve.data={x:ve.data.x*(me=Ie/ve.data.width),y:ve.data.y*me,width:ve.data.width*me,height:ve.data.height*me}),ve.data={x:Math.floor(ve.data.x),y:Math.floor(ve.data.y),width:Math.floor(ve.data.width),height:Math.floor(ve.data.height)},_.answerConfigParse&&(_.answerConfigParse[Ke].content+=`<div class="background_question__ans${we}_${Ke}_${oe}"><img width="${1024*me}" height="${1024*me}" src="${yield v.convertLinkToBase64(F,x,v.sAztCommonCdnService.getMyCdn(ve.link))}"></div>`),nt=document.createElement("style"),document.body.appendChild(nt),nt.textContent+=`.background_question__ans${we}_${Ke}_${oe} {margin: 0 3px; width: ${ve.data.width}px; height: ${ve.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${we}_${Ke}_${oe} img { margin-top: -${ve.data.y}px; margin-left: -${ve.data.x}px;}`):_.answerConfigParse&&(_.answerConfigParse[Ke].content+=He)}else _.answerConfigParse&&(_.answerConfigParse[Ke].content+=He)}}if(_.answerMediaParse&&_.answerMediaParse.length>0){var ze=_.answerMediaParse;_.answerMediaParse="";var ye=void 0===ze?[]:ze.split("@[]");for(let Ke=0;Ke<ye.length;Ke++){var Te=ye[Ke];if(!0===v.commonService.isJson(Te)){var Ie,Me=v.commonService.willDeleteParseJson(Te);if(Me.hasOwnProperty("link"))de=document.body.offsetWidth,me=1,Me.data.width>(Ie=de-30)&&(Me.data={x:Me.data.x*(me=Ie/Me.data.width),y:Me.data.y*me,width:Me.data.width*me,height:Me.data.height*me}),Me.data={x:Math.floor(Me.data.x),y:Math.floor(Me.data.y),width:Math.floor(Me.data.width),height:Math.floor(Me.data.height)},_.answerMediaParse+=`<div class="background_question__ans_result${we}_${Ke}"><img width="${1024*me}" height="${1024*me}" src="${yield v.convertLinkToBase64(F,x,v.sAztCommonCdnService.getMyCdn(Me.link))}"></div>`,nt=document.createElement("style"),document.body.appendChild(nt),nt.textContent+=`.background_question__ans_result${we}_${Ke} {margin: 0 3px; width: ${Me.data.width}px; height: ${Me.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${we}_${Ke} img { margin-top: -${Me.data.y}px; margin-left: -${Me.data.x}px;}`;else _.answerMediaParse+=Te}else _.answerMediaParse+=Te}}}}}})()}replaceCanvasBackgroundTS(G,x){var v=this;return(0,o.A)(function*(){var F=[];for(let ze=0;ze<G.length;ze++){var _=G[ze];if(0===_.isImage){var f=_.questionContentParse[0].content;_.questionContentParse[0].content="";var q=void 0===f?[]:f.split("@[]");for(let ye=0;ye<q.length;ye++){var $=q[ye];if(!0===v.commonService.isJson($)){var d=v.commonService.willDeleteParseJson($);if(d.hasOwnProperty("link")){var de=document.body.offsetWidth,me=1;d.data.width>(Ie=de-30)&&(d.data={x:d.data.x*(me=Ie/d.data.width),y:d.data.y*me,width:d.data.width*me,height:d.data.height*me}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},_.questionContentParse[0].content+=`<div class="background_question_${ze}_${ye}"><img width="${1024*me}" height="${1024*me}" src="${yield v.convertLinkToBase64(F,x,v.sAztCommonCdnService.getMyCdn(d.link))}"></div>`;var nt=document.createElement("style");document.body.appendChild(nt),nt.textContent+=`.background_question_${ze}_${ye} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${ze}_${ye} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else _.questionContentParse[0].content+=$}else _.questionContentParse[0].content+=$}if(v.answerTypeService.isOneChoiceAnswer(_)&&(0==_.isImage||1==_.isImage&&_.name.startsWith("[PDFv2]")?v.replaceBackgroundAnswerConfig(_.answerConfigParse,F,ze,x):v.replaceBackgroundAnswerConfig(_.answerConfigParseVer1.answerConfigV2,F,ze,x)),_.answerMedia&&_.answerMedia.length>0){var tt=_.answerMedia;_.answerMedia="";var rt=void 0===tt?[]:tt.split("@[]");for(let ye=0;ye<rt.length;ye++){var He=rt[ye];if(!0===v.commonService.isJson(He)){var Ie,ve=v.commonService.willDeleteParseJson(He);if(ve.hasOwnProperty("link"))de=document.body.offsetWidth,me=1,ve.data.width>(Ie=de-30)&&(ve.data={x:ve.data.x*(me=Ie/ve.data.width),y:ve.data.y*me,width:ve.data.width*me,height:ve.data.height*me}),ve.data={x:Math.floor(ve.data.x),y:Math.floor(ve.data.y),width:Math.floor(ve.data.width),height:Math.floor(ve.data.height)},_.answerMedia+=`<div class="background_question__ans_result${ze}_${ye}"><img width="${1024*me}" height="${1024*me}" src="${yield v.convertLinkToBase64(F,x,v.sAztCommonCdnService.getMyCdn(ve.link))}"></div>`,nt=document.createElement("style"),document.body.appendChild(nt),nt.textContent+=`.background_question__ans_result${ze}_${ye} {margin: 0 3px; width: ${ve.data.width}px; height: ${ve.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans_result${ze}_${ye} img { margin-top: -${ve.data.y}px; margin-left: -${ve.data.x}px;}`;else _.answerMedia+=He}else _.answerMedia+=He}}}}return!0})()}replaceBackgroundAnswerConfig(G,x,v,F){var _=this;return(0,o.A)(function*(){for(let tt=0;tt<G.length;tt++){var f=G[tt].content;G[tt].content="";var q=void 0===f?[]:f.split("@[]");for(let rt=0;rt<q.length;rt++){var $=q[rt];if(!0===_.commonService.isJson($)){var d=_.commonService.willDeleteParseJson($);if(d.hasOwnProperty("link")){var Ie=document.body.offsetWidth-30,me=1;d.data.width>Ie&&(d.data={x:d.data.x*(me=Ie/d.data.width),y:d.data.y*me,width:d.data.width*me,height:d.data.height*me}),d.data={x:Math.floor(d.data.x),y:Math.floor(d.data.y),width:Math.floor(d.data.width),height:Math.floor(d.data.height)},G[tt].content+=`<div class="background_question__ans${v}_${tt}_${rt}"><img width="${1024*me}" height="${1024*me}" src="${yield _.convertLinkToBase64(x,F,_.sAztCommonCdnService.getMyCdn(d.link))}"></div>`;var nt=document.createElement("style");document.body.appendChild(nt),nt.textContent+=`.background_question__ans${v}_${tt}_${rt} {margin: 0 3px; width: ${d.data.width}px; height: ${d.data.height}px; display: inline-block; overflow: hidden;} .background_question__ans${v}_${tt}_${rt} img { margin-top: -${d.data.y}px; margin-left: -${d.data.x}px;}`}else G[tt].content+=$}else G[tt].content+=$}}})()}}return(Y=le).\u0275fac=function(G){return new(G||Y)(h.KVO(y.R),h.KVO(ce.c),h.KVO(te._))},Y.\u0275prov=h.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),le})()},37642:(Tt,Ae,g)=>{"use strict";g.d(Ae,{E:()=>h});var o=g(48891);let h=(()=>{var y;class ce{getDictionaryByGroupFieldTS(b,Y){for(var le={},J=0;J<b.length;J++)b[J].hasOwnProperty(Y)&&("number"==typeof b[J][Y]||"string"==typeof b[J][Y])&&(le.hasOwnProperty(b[J][Y])||(le[b[J][Y]]=[]),le[b[J][Y]].push(b[J]));return le}getDictionaryByFieldTS(b,Y){for(var le={},J=0;J<b.length;J++)b[J].hasOwnProperty(Y)&&("number"==typeof b[J][Y]||"string"==typeof b[J][Y])&&(le[b[J][Y]]=b[J]);return le}getDictionaryBy2FieldsTS(b,Y,le){for(var J={},G=0;G<b.length;G++)b[G].hasOwnProperty(Y)&&("number"==typeof b[G][Y]||"string"==typeof b[G][Y])&&b[G].hasOwnProperty(le)&&("number"==typeof b[G][le]||"string"==typeof b[G][le])&&(J[b[G][Y]+"_"+b[G][le]]=b[G]);return J}getListValueByFieldNumberTS(b,Y){for(var le=[],J=0;J<b.length;J++)b[J].hasOwnProperty(Y)&&"number"==typeof b[J][Y]&&le.push(b[J][Y]);return le}getListValueByField(b,Y){for(var le=[],J=0;J<b.length;J++)if(b[J].hasOwnProperty(Y)){var G=le.filter(x=>x[Y]==b[J][Y]);(!G||0==G.length)&&le.push(b[J])}return le}}return(y=ce).\u0275fac=function(b){return new(b||y)},y.\u0275prov=o.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),ce})()},99172:(Tt,Ae,g)=>{"use strict";g.d(Ae,{p:()=>b});var o=g(73014),h=g(48891),y=g(543),ce=g(58112),te=g(53393);let b=(()=>{var Y;class le{processEssayResultToBase64(G){var x=this;return(0,o.A)(function*(){for(const v of G.pages??[]){if(v.draw){const F=yield x.exportPdfUtilsService.convertAndRetryToBase64(v.draw);v.draw=F}if(v.backgroundImage){const F=yield x.exportPdfUtilsService.convertAndRetryToBase64(v.backgroundImage);v.backgroundImage=F}}if(G.commentEmoji&&G.commentEmoji.length){let v="https://azota889.github.io/storage_public/mnote/",F=G.commentEmoji.length;for(let _=0;_<F;_++){let f=v+G.commentEmoji[_];const q=yield x.exportPdfUtilsService.convertAndRetryToBase64(f);G.commentEmoji[_]=q}}return G})()}convertAnswersArr(G,x){0!=G.length&&G.forEach(v=>{v.QuestionId&&v.AnswerContent&&v.AnswerContent[0]&&v.AnswerContent[0].Content&&(x[`id_${v.QuestionId}`]=v.AnswerContent[0].Content)})}findScaleDirection(G,x){return G/x>=.7070707070707071?"w":"h"}constructor(G,x,v){this.commonService=G,this.sAztCommonCdnService=x,this.exportPdfUtilsService=v}}return(Y=le).\u0275fac=function(G){return new(G||Y)(h.KVO(y.R),h.KVO(ce.c),h.KVO(te.j))},Y.\u0275prov=h.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),le})()},53393:(Tt,Ae,g)=>{"use strict";g.d(Ae,{j:()=>Y});var o=g(73014),h=function(le){return le[le.Cdn=0]="Cdn",le[le.CdnTimestamp=1]="CdnTimestamp",le[le.Rawlink=2]="Rawlink",le[le.RawlinkTimestamp=3]="RawlinkTimestamp",le}(h||{}),y=g(48891),ce=g(543),te=g(58112),b=g(99927);let Y=(()=>{var le;class J{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){const x=navigator.userAgent,F=(()=>{let f=null;const q=x.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(q[1]))return"IE "+((/\brv[ :]+(\d+)/g.exec(x)||[])[1]||"");if("Chrome"===q[1]){const d=x.match(/\b(OPR|Edge)\/(\d+)/);if(null!==d)return d.slice(1).join(" ").replace("OPR","Opera")}const $=q[2]?[q[1],q[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!==(f=x.match(/version\/(\d+)/i))&&$.splice(1,1,f[1]),$.join(" ")})().toString();return!(!["chrome"].includes(F.split(" ")[0].toLowerCase())||parseInt(F.split(" ")[1],10)<80)}getExtensionFile(x){if(!x)return"";const v=x.split(".");return v.length<=1?"":v[v.length-1].toLocaleLowerCase().split("_")[0]}findImageSrcInContent(x){let v="";if(x.includes("img")){const F=x.indexOf("img"),_=x.indexOf("src=",F),f=x.indexOf('"',Number(_)+5);v=x.substring(Number(_)+5,Number(f))}return v}asyncTimeout(x){return(0,o.A)(function*(){return`Waited ${yield new Promise(F=>{setTimeout(()=>F(x),x)})} milliseconds`})()}parseEssayMarkResult(x,v){let F=x.filter(q=>this.answerTypeService.isEssayAnswer(q));if(0!=F.length&&v&&v.essayResult){var _=this.commonService.willDeleteParseJson(v.essayResult);if(_){var f=Object.entries(_);for(let q=0;q<F.length;q++)F[q].essayMarkParsed=f[q][1]}}}convertToBase64(x,v){var F=this;return(0,o.A)(function*(){let _=x;switch(v){case h.Cdn:_=F.sAztCommonCdnService.getMyCdn(x);break;case h.CdnTimestamp:_=F.sAztCommonCdnService.getMyCdn(x)+"?t="+Date.now();break;case h.RawlinkTimestamp:_=x+"?t="+Date.now()}const q=yield(yield fetch(_)).blob(),$=yield new Promise(d=>{const de=new FileReader;de.readAsDataURL(q),de.onloadend=()=>{d(de.result)}});return $&&"string"==typeof $?$:x})()}convertAndRetryToBase64(x){var v=this;return(0,o.A)(function*(){let F=v.getExtensionFile(x);if(["pdf","jpg","jpeg","png","gif"].includes(F)){let _;const f=[h.Cdn,h.CdnTimestamp,h.Rawlink,h.RawlinkTimestamp];try{_=yield v.convertToBase64(x,f[0])}catch{try{_=yield v.convertToBase64(x,f[1])}catch{try{_=yield v.convertToBase64(x,f[2])}catch{try{_=yield v.convertToBase64(x,f[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+x),_=x}}}}return _}return x})()}eraseCanvas(x){x&&(x.beginPath(),x.rect(0,0,x.canvas.width,x.canvas.height),x.fillStyle="white",x.fill())}addContentToPdf(x,v){x.addImage(v,"JPEG",0,0,x.internal.pageSize.getWidth(),x.internal.pageSize.getHeight())}drawTextWrap(x,v,F,_,f){const q=x.split(" "),$=[];let d=q[0];if(v){v.font=f||`${_}px Arial`;for(let de=1;de<q.length;de++){const z=q[de];v.measureText(d+" "+z).width<F?d+=" "+z:($.push(d),d=z)}$.push(d)}return $}essayText2LinesArr(x,v,F,_,f){const q=new RegExp("(<br>|<br/>)+","igm"),d=(this.replaceAllByRegExp(x,q,"<br>")??"").split("<br>"),de=[];for(let z=0;z<d.length;z++)de.push(this.drawTextWrap(d[z],v,F,_,f));return de}replaceAllByRegExp(x,v,F){return F?x?x.toString().replace(v,F):void 0:x}removeTagAssistiveMml(){const x=document.getElementsByTagName("mjx-assistive-mml");for(;x.length>0;)x[0].remove()}constructor(x,v,F){this.commonService=x,this.sAztCommonCdnService=v,this.answerTypeService=F}}return(le=J).\u0275fac=function(x){return new(x||le)(y.KVO(ce.R),y.KVO(te.c),y.KVO(b._))},le.\u0275prov=y.jDH({token:le,factory:le.\u0275fac,providedIn:"root"}),J})()},57998:(Tt,Ae,g)=>{"use strict";function o(){return typeof aztExam<"u"?aztExam:void 0}g.d(Ae,{J:()=>Kp});var f,q,h=g(43234),y=g(48891),ce=g(36484),te=g(42802),b=g(73014),Y=g(92757),le=g(73990),J=g(85980),G=g(64627),x=g(56094),v=g(17791),F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(ne,j,Q){Q||(Q=0);var re=Array(16);if("string"==typeof j)for(var ae=0;16>ae;++ae)re[ae]=j.charCodeAt(Q++)|j.charCodeAt(Q++)<<8|j.charCodeAt(Q++)<<16|j.charCodeAt(Q++)<<24;else for(ae=0;16>ae;++ae)re[ae]=j[Q++]|j[Q++]<<8|j[Q++]<<16|j[Q++]<<24;var ge=ne.g[3],K=(j=ne.g[0])+(ge^(Q=ne.g[1])&((ae=ne.g[2])^ge))+re[0]+3614090360&4294967295;K=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=(Q=(ae=(ge=(j=Q+(K<<7&4294967295|K>>>25))+((K=ge+(ae^j&(Q^ae))+re[1]+3905402710&4294967295)<<12&4294967295|K>>>20))+((K=ae+(Q^ge&(j^Q))+re[2]+606105819&4294967295)<<17&4294967295|K>>>15))+((K=Q+(j^ae&(ge^j))+re[3]+3250441966&4294967295)<<22&4294967295|K>>>10))+((K=j+(ge^Q&(ae^ge))+re[4]+4118548399&4294967295)<<7&4294967295|K>>>25))+((K=ge+(ae^j&(Q^ae))+re[5]+1200080426&4294967295)<<12&4294967295|K>>>20))+((K=ae+(Q^ge&(j^Q))+re[6]+2821735955&4294967295)<<17&4294967295|K>>>15))+((K=Q+(j^ae&(ge^j))+re[7]+4249261313&4294967295)<<22&4294967295|K>>>10))+((K=j+(ge^Q&(ae^ge))+re[8]+1770035416&4294967295)<<7&4294967295|K>>>25))+((K=ge+(ae^j&(Q^ae))+re[9]+2336552879&4294967295)<<12&4294967295|K>>>20))+((K=ae+(Q^ge&(j^Q))+re[10]+4294925233&4294967295)<<17&4294967295|K>>>15))+((K=Q+(j^ae&(ge^j))+re[11]+2304563134&4294967295)<<22&4294967295|K>>>10))+((K=j+(ge^Q&(ae^ge))+re[12]+1804603682&4294967295)<<7&4294967295|K>>>25))+((K=ge+(ae^j&(Q^ae))+re[13]+4254626195&4294967295)<<12&4294967295|K>>>20))+((K=ae+(Q^ge&(j^Q))+re[14]+2792965006&4294967295)<<17&4294967295|K>>>15))+((K=Q+(j^ae&(ge^j))+re[15]+1236535329&4294967295)<<22&4294967295|K>>>10))+((K=j+(ae^ge&(Q^ae))+re[1]+4129170786&4294967295)<<5&4294967295|K>>>27))+((K=ge+(Q^ae&(j^Q))+re[6]+3225465664&4294967295)<<9&4294967295|K>>>23))+((K=ae+(j^Q&(ge^j))+re[11]+643717713&4294967295)<<14&4294967295|K>>>18))+((K=Q+(ge^j&(ae^ge))+re[0]+3921069994&4294967295)<<20&4294967295|K>>>12))+((K=j+(ae^ge&(Q^ae))+re[5]+3593408605&4294967295)<<5&4294967295|K>>>27))+((K=ge+(Q^ae&(j^Q))+re[10]+38016083&4294967295)<<9&4294967295|K>>>23))+((K=ae+(j^Q&(ge^j))+re[15]+3634488961&4294967295)<<14&4294967295|K>>>18))+((K=Q+(ge^j&(ae^ge))+re[4]+3889429448&4294967295)<<20&4294967295|K>>>12))+((K=j+(ae^ge&(Q^ae))+re[9]+568446438&4294967295)<<5&4294967295|K>>>27))+((K=ge+(Q^ae&(j^Q))+re[14]+3275163606&4294967295)<<9&4294967295|K>>>23))+((K=ae+(j^Q&(ge^j))+re[3]+4107603335&4294967295)<<14&4294967295|K>>>18))+((K=Q+(ge^j&(ae^ge))+re[8]+1163531501&4294967295)<<20&4294967295|K>>>12))+((K=j+(ae^ge&(Q^ae))+re[13]+2850285829&4294967295)<<5&4294967295|K>>>27))+((K=ge+(Q^ae&(j^Q))+re[2]+4243563512&4294967295)<<9&4294967295|K>>>23))+((K=ae+(j^Q&(ge^j))+re[7]+1735328473&4294967295)<<14&4294967295|K>>>18))+((K=Q+(ge^j&(ae^ge))+re[12]+2368359562&4294967295)<<20&4294967295|K>>>12))+((K=j+(Q^ae^ge)+re[5]+4294588738&4294967295)<<4&4294967295|K>>>28))+((K=ge+(j^Q^ae)+re[8]+2272392833&4294967295)<<11&4294967295|K>>>21))+((K=ae+(ge^j^Q)+re[11]+1839030562&4294967295)<<16&4294967295|K>>>16))+((K=Q+(ae^ge^j)+re[14]+4259657740&4294967295)<<23&4294967295|K>>>9))+((K=j+(Q^ae^ge)+re[1]+2763975236&4294967295)<<4&4294967295|K>>>28))+((K=ge+(j^Q^ae)+re[4]+1272893353&4294967295)<<11&4294967295|K>>>21))+((K=ae+(ge^j^Q)+re[7]+4139469664&4294967295)<<16&4294967295|K>>>16))+((K=Q+(ae^ge^j)+re[10]+3200236656&4294967295)<<23&4294967295|K>>>9))+((K=j+(Q^ae^ge)+re[13]+681279174&4294967295)<<4&4294967295|K>>>28))+((K=ge+(j^Q^ae)+re[0]+3936430074&4294967295)<<11&4294967295|K>>>21))+((K=ae+(ge^j^Q)+re[3]+3572445317&4294967295)<<16&4294967295|K>>>16))+((K=Q+(ae^ge^j)+re[6]+76029189&4294967295)<<23&4294967295|K>>>9))+((K=j+(Q^ae^ge)+re[9]+3654602809&4294967295)<<4&4294967295|K>>>28))+((K=ge+(j^Q^ae)+re[12]+3873151461&4294967295)<<11&4294967295|K>>>21))+((K=ae+(ge^j^Q)+re[15]+530742520&4294967295)<<16&4294967295|K>>>16))+((K=Q+(ae^ge^j)+re[2]+3299628645&4294967295)<<23&4294967295|K>>>9))+((K=j+(ae^(Q|~ge))+re[0]+4096336452&4294967295)<<6&4294967295|K>>>26))+((K=ge+(Q^(j|~ae))+re[7]+1126891415&4294967295)<<10&4294967295|K>>>22))+((K=ae+(j^(ge|~Q))+re[14]+2878612391&4294967295)<<15&4294967295|K>>>17))+((K=Q+(ge^(ae|~j))+re[5]+4237533241&4294967295)<<21&4294967295|K>>>11))+((K=j+(ae^(Q|~ge))+re[12]+1700485571&4294967295)<<6&4294967295|K>>>26))+((K=ge+(Q^(j|~ae))+re[3]+2399980690&4294967295)<<10&4294967295|K>>>22))+((K=ae+(j^(ge|~Q))+re[10]+4293915773&4294967295)<<15&4294967295|K>>>17))+((K=Q+(ge^(ae|~j))+re[1]+2240044497&4294967295)<<21&4294967295|K>>>11))+((K=j+(ae^(Q|~ge))+re[8]+1873313359&4294967295)<<6&4294967295|K>>>26))+((K=ge+(Q^(j|~ae))+re[15]+4264355552&4294967295)<<10&4294967295|K>>>22))+((K=ae+(j^(ge|~Q))+re[6]+2734768916&4294967295)<<15&4294967295|K>>>17))+((K=Q+(ge^(ae|~j))+re[13]+1309151649&4294967295)<<21&4294967295|K>>>11))+((ge=(j=Q+((K=j+(ae^(Q|~ge))+re[4]+4149444226&4294967295)<<6&4294967295|K>>>26))+((K=ge+(Q^(j|~ae))+re[11]+3174756917&4294967295)<<10&4294967295|K>>>22))^((ae=ge+((K=ae+(j^(ge|~Q))+re[2]+718787259&4294967295)<<15&4294967295|K>>>17))|~j))+re[9]+3951481745&4294967295,ne.g[0]=ne.g[0]+j&4294967295,ne.g[1]=ne.g[1]+(ae+(K<<21&4294967295|K>>>11))&4294967295,ne.g[2]=ne.g[2]+ae&4294967295,ne.g[3]=ne.g[3]+ge&4294967295}function a(ne,j){this.h=j;for(var Q=[],re=!0,ae=ne.length-1;0<=ae;ae--){var ge=0|ne[ae];re&&ge==j||(Q[ae]=ge,re=!1)}this.g=Q}(function e(ne,j){function Q(){}Q.prototype=j.prototype,ne.D=j.prototype,ne.prototype=new Q,ne.prototype.constructor=ne,ne.C=function(re,ae,ge){for(var K=Array(arguments.length-2),Bn=2;Bn<arguments.length;Bn++)K[Bn-2]=arguments[Bn];return j.prototype[ae].apply(re,K)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(ne,j){void 0===j&&(j=ne.length);for(var Q=j-this.blockSize,re=this.B,ae=this.h,ge=0;ge<j;){if(0==ae)for(;ge<=Q;)i(this,ne,ge),ge+=this.blockSize;if("string"==typeof ne){for(;ge<j;)if(re[ae++]=ne.charCodeAt(ge++),ae==this.blockSize){i(this,re),ae=0;break}}else for(;ge<j;)if(re[ae++]=ne[ge++],ae==this.blockSize){i(this,re),ae=0;break}}this.h=ae,this.o+=j},n.prototype.v=function(){var ne=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ne[0]=128;for(var j=1;j<ne.length-8;++j)ne[j]=0;var Q=8*this.o;for(j=ne.length-8;j<ne.length;++j)ne[j]=255&Q,Q/=256;for(this.u(ne),ne=Array(16),j=Q=0;4>j;++j)for(var re=0;32>re;re+=8)ne[Q++]=this.g[j]>>>re&255;return ne};var c={};function u(ne){return-128<=ne&&128>ne?function s(ne,j){var Q=c;return Object.prototype.hasOwnProperty.call(Q,ne)?Q[ne]:Q[ne]=j(ne)}(ne,function(j){return new a([0|j],0>j?-1:0)}):new a([0|ne],0>ne?-1:0)}function p(ne){if(isNaN(ne)||!isFinite(ne))return C;if(0>ne)return Ge(p(-ne));for(var j=[],Q=1,re=0;ne>=Q;re++)j[re]=ne/Q|0,Q*=4294967296;return new a(j,0)}var C=u(0),N=u(1),ue=u(16777216);function ke(ne){if(0!=ne.h)return!1;for(var j=0;j<ne.g.length;j++)if(0!=ne.g[j])return!1;return!0}function Qe(ne){return-1==ne.h}function Ge(ne){for(var j=ne.g.length,Q=[],re=0;re<j;re++)Q[re]=~ne.g[re];return new a(Q,~ne.h).add(N)}function _t(ne,j){return ne.add(Ge(j))}function yt(ne,j){for(;(65535&ne[j])!=ne[j];)ne[j+1]+=ne[j]>>>16,ne[j]&=65535,j++}function ft(ne,j){this.g=ne,this.h=j}function It(ne,j){if(ke(j))throw Error("division by zero");if(ke(ne))return new ft(C,C);if(Qe(ne))return j=It(Ge(ne),j),new ft(Ge(j.g),Ge(j.h));if(Qe(j))return j=It(ne,Ge(j)),new ft(Ge(j.g),j.h);if(30<ne.g.length){if(Qe(ne)||Qe(j))throw Error("slowDivide_ only works with positive integers.");for(var Q=N,re=j;0>=re.l(ne);)Q=Dt(Q),re=Dt(re);var ae=Ct(Q,1),ge=Ct(re,1);for(re=Ct(re,2),Q=Ct(Q,2);!ke(re);){var K=ge.add(re);0>=K.l(ne)&&(ae=ae.add(Q),ge=K),re=Ct(re,1),Q=Ct(Q,1)}return j=_t(ne,ae.j(j)),new ft(ae,j)}for(ae=C;0<=ne.l(j);){for(Q=Math.max(1,Math.floor(ne.m()/j.m())),re=48>=(re=Math.ceil(Math.log(Q)/Math.LN2))?1:Math.pow(2,re-48),K=(ge=p(Q)).j(j);Qe(K)||0<K.l(ne);)K=(ge=p(Q-=re)).j(j);ke(ge)&&(ge=N),ae=ae.add(ge),ne=_t(ne,K)}return new ft(ae,ne)}function Dt(ne){for(var j=ne.g.length+1,Q=[],re=0;re<j;re++)Q[re]=ne.i(re)<<1|ne.i(re-1)>>>31;return new a(Q,ne.h)}function Ct(ne,j){var Q=j>>5;j%=32;for(var re=ne.g.length-Q,ae=[],ge=0;ge<re;ge++)ae[ge]=0<j?ne.i(ge+Q)>>>j|ne.i(ge+Q+1)<<32-j:ne.i(ge+Q);return new a(ae,ne.h)}(r=a.prototype).m=function(){if(Qe(this))return-Ge(this).m();for(var ne=0,j=1,Q=0;Q<this.g.length;Q++){var re=this.i(Q);ne+=(0<=re?re:4294967296+re)*j,j*=4294967296}return ne},r.toString=function(ne){if(2>(ne=ne||10)||36<ne)throw Error("radix out of range: "+ne);if(ke(this))return"0";if(Qe(this))return"-"+Ge(this).toString(ne);for(var j=p(Math.pow(ne,6)),Q=this,re="";;){var ae=It(Q,j).g,ge=((0<(Q=_t(Q,ae.j(j))).g.length?Q.g[0]:Q.h)>>>0).toString(ne);if(ke(Q=ae))return ge+re;for(;6>ge.length;)ge="0"+ge;re=ge+re}},r.i=function(ne){return 0>ne?0:ne<this.g.length?this.g[ne]:this.h},r.l=function(ne){return Qe(ne=_t(this,ne))?-1:ke(ne)?0:1},r.abs=function(){return Qe(this)?Ge(this):this},r.add=function(ne){for(var j=Math.max(this.g.length,ne.g.length),Q=[],re=0,ae=0;ae<=j;ae++){var ge=re+(65535&this.i(ae))+(65535&ne.i(ae)),K=(ge>>>16)+(this.i(ae)>>>16)+(ne.i(ae)>>>16);re=K>>>16,Q[ae]=(K&=65535)<<16|(ge&=65535)}return new a(Q,-2147483648&Q[Q.length-1]?-1:0)},r.j=function(ne){if(ke(this)||ke(ne))return C;if(Qe(this))return Qe(ne)?Ge(this).j(Ge(ne)):Ge(Ge(this).j(ne));if(Qe(ne))return Ge(this.j(Ge(ne)));if(0>this.l(ue)&&0>ne.l(ue))return p(this.m()*ne.m());for(var j=this.g.length+ne.g.length,Q=[],re=0;re<2*j;re++)Q[re]=0;for(re=0;re<this.g.length;re++)for(var ae=0;ae<ne.g.length;ae++){var ge=this.i(re)>>>16,K=65535&this.i(re),Bn=ne.i(ae)>>>16,Yi=65535&ne.i(ae);Q[2*re+2*ae]+=K*Yi,yt(Q,2*re+2*ae),Q[2*re+2*ae+1]+=ge*Yi,yt(Q,2*re+2*ae+1),Q[2*re+2*ae+1]+=K*Bn,yt(Q,2*re+2*ae+1),Q[2*re+2*ae+2]+=ge*Bn,yt(Q,2*re+2*ae+2)}for(re=0;re<j;re++)Q[re]=Q[2*re+1]<<16|Q[2*re];for(re=j;re<2*j;re++)Q[re]=0;return new a(Q,0)},r.A=function(ne){return It(this,ne).h},r.and=function(ne){for(var j=Math.max(this.g.length,ne.g.length),Q=[],re=0;re<j;re++)Q[re]=this.i(re)&ne.i(re);return new a(Q,this.h&ne.h)},r.or=function(ne){for(var j=Math.max(this.g.length,ne.g.length),Q=[],re=0;re<j;re++)Q[re]=this.i(re)|ne.i(re);return new a(Q,this.h|ne.h)},r.xor=function(ne){for(var j=Math.max(this.g.length,ne.g.length),Q=[],re=0;re<j;re++)Q[re]=this.i(re)^ne.i(re);return new a(Q,this.h^ne.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,q=_.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=p,a.fromString=function T(ne,j){if(0==ne.length)throw Error("number format error: empty string");if(2>(j=j||10)||36<j)throw Error("radix out of range: "+j);if("-"==ne.charAt(0))return Ge(T(ne.substring(1),j));if(0<=ne.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=p(Math.pow(j,8)),re=C,ae=0;ae<ne.length;ae+=8){var ge=Math.min(8,ne.length-ae),K=parseInt(ne.substring(ae,ae+ge),j);8>ge?(ge=p(Math.pow(j,ge)),re=re.j(ge).add(p(K))):re=(re=re.j(Q)).add(p(K))}return re},f=_.Integer=a}).apply(typeof F<"u"?F:typeof self<"u"?self:typeof window<"u"?window:{});var de,Ie,me,nt,tt,rt,He,ve,$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(l,m,w){return l==Array.prototype||l==Object.prototype||(l[m]=w.value),l},n=function t(l){l=["object"==typeof globalThis&&globalThis,l,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof $&&$];for(var m=0;m<l.length;++m){var w=l[m];if(w&&w.Math==Math)return w}throw Error("Cannot find global object")}(this);!function i(l,m){if(m)e:{var w=n;l=l.split(".");for(var A=0;A<l.length-1;A++){var he=l[A];if(!(he in w))break e;w=w[he]}(m=m(A=w[l=l[l.length-1]]))!=A&&null!=m&&e(w,l,{configurable:!0,writable:!0,value:m})}}("Array.prototype.values",function(l){return l||function(){return function s(l,m){l instanceof String&&(l+="");var w=0,A=!1,he={next:function(){if(!A&&w<l.length){var Ce=w++;return{value:m(Ce,l[Ce]),done:!1}}return A=!0,{done:!0,value:void 0}}};return he[Symbol.iterator]=function(){return he},he}(this,function(m,w){return w})}});var a=a||{},c=this||self;function u(l){var m=typeof l;return"array"==(m="object"!=m?m:l?Array.isArray(l)?"array":m:"null")||"object"==m&&"number"==typeof l.length}function p(l){var m=typeof l;return"object"==m&&null!=l||"function"==m}function T(l,m,w){return l.call.apply(l.bind,arguments)}function C(l,m,w){if(!l)throw Error();if(2<arguments.length){var A=Array.prototype.slice.call(arguments,2);return function(){var he=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(he,A),l.apply(m,he)}}return function(){return l.apply(m,arguments)}}function N(l,m,w){return(N=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?T:C).apply(null,arguments)}function ue(l,m){var w=Array.prototype.slice.call(arguments,1);return function(){var A=w.slice();return A.push.apply(A,arguments),l.apply(this,A)}}function ke(l,m){function w(){}w.prototype=m.prototype,l.aa=m.prototype,l.prototype=new w,l.prototype.constructor=l,l.Qb=function(A,he,Ce){for(var lt=Array(arguments.length-2),jt=2;jt<arguments.length;jt++)lt[jt-2]=arguments[jt];return m.prototype[he].apply(A,lt)}}function Qe(l){const m=l.length;if(0<m){const w=Array(m);for(let A=0;A<m;A++)w[A]=l[A];return w}return[]}function Ge(l,m){for(let w=1;w<arguments.length;w++){const A=arguments[w];if(u(A)){const he=l.length||0,Ce=A.length||0;l.length=he+Ce;for(let lt=0;lt<Ce;lt++)l[he+lt]=A[lt]}else l.push(A)}}function yt(l){return/^[\s\xa0]*$/.test(l)}function ft(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function It(l){return It[" "](l),l}It[" "]=function(){};var Dt=!(-1==ft().indexOf("Gecko")||-1!=ft().toLowerCase().indexOf("webkit")&&-1==ft().indexOf("Edge")||-1!=ft().indexOf("Trident")||-1!=ft().indexOf("MSIE")||-1!=ft().indexOf("Edge"));function Ct(l,m,w){for(const A in l)m.call(w,l[A],A,l)}function j(l){const m={};for(const w in l)m[w]=l[w];return m}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function re(l,m){let w,A;for(let he=1;he<arguments.length;he++){for(w in A=arguments[he],A)l[w]=A[w];for(let Ce=0;Ce<Q.length;Ce++)w=Q[Ce],Object.prototype.hasOwnProperty.call(A,w)&&(l[w]=A[w])}}function ae(l){var m=1;l=l.split(":");const w=[];for(;0<m&&l.length;)w.push(l.shift()),m--;return l.length&&w.push(l.join(":")),w}function ge(l){c.setTimeout(()=>{throw l},0)}function K(){var l=Jl;let m=null;return l.g&&(m=l.g,l.g=l.g.next,l.g||(l.h=null),m.next=null),m}var Yi=new class _t{constructor(m,w){this.i=m,this.j=w,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}(()=>new qp,l=>l.reset());class qp{constructor(){this.next=this.g=this.h=null}set(m,w){this.h=m,this.g=w,this.next=null}reset(){this.next=this.g=this.h=null}}let Qi,Xi=!1,Jl=new class Bn{constructor(){this.h=this.g=null}add(m,w){const A=Yi.get();A.set(m,w),this.h?this.h.next=A:this.g=A,this.h=A}},zd=()=>{const l=c.Promise.resolve(void 0);Qi=()=>{l.then(Yp)}};var Yp=()=>{for(var l;l=K();){try{l.h.call(l.g)}catch(w){ge(w)}var m=Yi;m.j(l),100>m.h&&(m.h++,l.next=m.g,m.g=l)}Xi=!1};function nr(){this.s=this.s,this.C=this.C}function mn(l,m){this.type=l,this.g=this.target=m,this.defaultPrevented=!1}nr.prototype.s=!1,nr.prototype.ma=function(){this.s||(this.s=!0,this.N())},nr.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},mn.prototype.h=function(){this.defaultPrevented=!0};var Qp=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,m=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const w=()=>{};c.addEventListener("test",w,m),c.removeEventListener("test",w,m)}catch{}return l}();function Hi(l,m){if(mn.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var w=this.type=l.type,A=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=m,m=l.relatedTarget){if(Dt){e:{try{It(m.nodeName);var he=!0;break e}catch{}he=!1}he||(m=null)}}else"mouseover"==w?m=l.fromElement:"mouseout"==w&&(m=l.toElement);this.relatedTarget=m,A?(this.clientX=void 0!==A.clientX?A.clientX:A.pageX,this.clientY=void 0!==A.clientY?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=void 0!==l.clientX?l.clientX:l.pageX,this.clientY=void 0!==l.clientY?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType="string"==typeof l.pointerType?l.pointerType:Xp[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Hi.aa.h.call(this)}}ke(Hi,mn);var Xp={2:"touch",3:"pen",4:"mouse"};Hi.prototype.h=function(){Hi.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Ji="closure_listenable_"+(1e6*Math.random()|0),Hp=0;function Jp(l,m,w,A,he){this.listener=l,this.proxy=null,this.src=m,this.type=w,this.capture=!!A,this.ha=he,this.key=++Hp,this.da=this.fa=!1}function ho(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function _o(l){this.src=l,this.g={},this.h=0}function Zl(l,m){var w=m.type;if(w in l.g){var Ce,A=l.g[w],he=Array.prototype.indexOf.call(A,m,void 0);(Ce=0<=he)&&Array.prototype.splice.call(A,he,1),Ce&&(ho(m),0==l.g[w].length&&(delete l.g[w],l.h--))}}function ec(l,m,w,A){for(var he=0;he<l.length;++he){var Ce=l[he];if(!Ce.da&&Ce.listener==m&&Ce.capture==!!w&&Ce.ha==A)return he}return-1}_o.prototype.add=function(l,m,w,A,he){var Ce=l.toString();(l=this.g[Ce])||(l=this.g[Ce]=[],this.h++);var lt=ec(l,m,A,he);return-1<lt?(m=l[lt],w||(m.fa=!1)):((m=new Jp(m,this.src,Ce,!!A,he)).fa=w,l.push(m)),m};var tc="closure_lm_"+(1e6*Math.random()|0),nc={};function Nd(l,m,w,A,he){if(A&&A.once)return Bd(l,m,w,A,he);if(Array.isArray(m)){for(var Ce=0;Ce<m.length;Ce++)Nd(l,m[Ce],w,A,he);return null}return w=oc(w),l&&l[Ji]?l.K(m,w,p(A)?!!A.capture:!!A,he):Ld(l,m,w,!1,A,he)}function Ld(l,m,w,A,he,Ce){if(!m)throw Error("Invalid event type");var lt=p(he)?!!he.capture:!!he,jt=ic(l);if(jt||(l[tc]=jt=new _o(l)),(w=jt.add(m,w,A,lt,Ce)).proxy)return w;if(A=function Zp(){const m=eg;return function l(w){return m.call(l.src,l.listener,w)}}(),w.proxy=A,A.src=l,A.listener=w,l.addEventListener)Qp||(he=lt),void 0===he&&(he=!1),l.addEventListener(m.toString(),A,he);else if(l.attachEvent)l.attachEvent(Gd(m.toString()),A);else{if(!l.addListener||!l.removeListener)throw Error("addEventListener and attachEvent are unavailable.");l.addListener(A)}return w}function Bd(l,m,w,A,he){if(Array.isArray(m)){for(var Ce=0;Ce<m.length;Ce++)Bd(l,m[Ce],w,A,he);return null}return w=oc(w),l&&l[Ji]?l.L(m,w,p(A)?!!A.capture:!!A,he):Ld(l,m,w,!0,A,he)}function jd(l,m,w,A,he){if(Array.isArray(m))for(var Ce=0;Ce<m.length;Ce++)jd(l,m[Ce],w,A,he);else A=p(A)?!!A.capture:!!A,w=oc(w),l&&l[Ji]?(l=l.i,(m=String(m).toString())in l.g&&-1<(w=ec(Ce=l.g[m],w,A,he))&&(ho(Ce[w]),Array.prototype.splice.call(Ce,w,1),0==Ce.length&&(delete l.g[m],l.h--))):l&&(l=ic(l))&&(m=l.g[m.toString()],l=-1,m&&(l=ec(m,w,A,he)),(w=-1<l?m[l]:null)&&rc(w))}function rc(l){if("number"!=typeof l&&l&&!l.da){var m=l.src;if(m&&m[Ji])Zl(m.i,l);else{var w=l.type,A=l.proxy;m.removeEventListener?m.removeEventListener(w,A,l.capture):m.detachEvent?m.detachEvent(Gd(w),A):m.addListener&&m.removeListener&&m.removeListener(A),(w=ic(m))?(Zl(w,l),0==w.h&&(w.src=null,m[tc]=null)):ho(l)}}}function Gd(l){return l in nc?nc[l]:nc[l]="on"+l}function eg(l,m){if(l.da)l=!0;else{m=new Hi(m,this);var w=l.listener,A=l.ha||l.src;l.fa&&rc(l),l=w.call(A,m)}return l}function ic(l){return(l=l[tc])instanceof _o?l:null}var sc="__closure_events_fn_"+(1e9*Math.random()>>>0);function oc(l){return"function"==typeof l?l:(l[sc]||(l[sc]=function(m){return l.handleEvent(m)}),l[sc])}function fn(){nr.call(this),this.i=new _o(this),this.M=this,this.F=null}function yn(l,m){var w,A=l.F;if(A)for(w=[];A;A=A.F)w.push(A);if(l=l.M,A=m.type||m,"string"==typeof m)m=new mn(m,l);else if(m instanceof mn)m.target=m.target||l;else{var he=m;re(m=new mn(A,l),he)}if(he=!0,w)for(var Ce=w.length-1;0<=Ce;Ce--){var lt=m.g=w[Ce];he=mo(lt,A,!0,m)&&he}if(he=mo(lt=m.g=l,A,!0,m)&&he,he=mo(lt,A,!1,m)&&he,w)for(Ce=0;Ce<w.length;Ce++)he=mo(lt=m.g=w[Ce],A,!1,m)&&he}function mo(l,m,w,A){if(!(m=l.i.g[String(m)]))return!0;m=m.concat();for(var he=!0,Ce=0;Ce<m.length;++Ce){var lt=m[Ce];if(lt&&!lt.da&&lt.capture==w){var jt=lt.listener,un=lt.ha||lt.src;lt.fa&&Zl(l.i,lt),he=!1!==jt.call(un,A)&&he}}return he&&!A.defaultPrevented}function $d(l,m,w){if("function"==typeof l)w&&(l=N(l,w));else{if(!l||"function"!=typeof l.handleEvent)throw Error("Invalid listener argument");l=N(l.handleEvent,l)}return 2147483647<Number(m)?-1:c.setTimeout(l,m||0)}function Ud(l){l.g=$d(()=>{l.g=null,l.i&&(l.i=!1,Ud(l))},l.l);const m=l.h;l.h=null,l.m.apply(null,m)}ke(fn,nr),fn.prototype[Ji]=!0,fn.prototype.removeEventListener=function(l,m,w,A){jd(this,l,m,w,A)},fn.prototype.N=function(){if(fn.aa.N.call(this),this.i){var m,l=this.i;for(m in l.g){for(var w=l.g[m],A=0;A<w.length;A++)ho(w[A]);delete l.g[m],l.h--}}this.F=null},fn.prototype.K=function(l,m,w,A){return this.i.add(String(l),m,!1,w,A)},fn.prototype.L=function(l,m,w,A){return this.i.add(String(l),m,!0,w,A)};class tg extends nr{constructor(m,w){super(),this.m=m,this.l=w,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:Ud(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Zi(l){nr.call(this),this.h=l,this.g={}}ke(Zi,nr);var Wd=[];function Kd(l){Ct(l.g,function(m,w){this.g.hasOwnProperty(w)&&rc(m)},l),l.g={}}Zi.prototype.N=function(){Zi.aa.N.call(this),Kd(this)},Zi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ac=c.JSON.stringify,ng=c.JSON.parse,rg=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function lc(){}function Yd(){}lc.prototype.h=null;var es={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function cc(){mn.call(this,"d")}function uc(){mn.call(this,"c")}ke(cc,mn),ke(uc,mn);var Er={},Qd=null;function fo(){return Qd=Qd||new fn}function Xd(l){mn.call(this,Er.La,l)}function ts(l){const m=fo();yn(m,new Xd(m))}function Hd(l,m){mn.call(this,Er.STAT_EVENT,l),this.stat=m}function vn(l){const m=fo();yn(m,new Hd(m,l))}function Jd(l,m){mn.call(this,Er.Ma,l),this.size=m}function ns(l,m){if("function"!=typeof l)throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},m)}function rs(){this.g=!0}function li(l,m,w,A){l.info(function(){return"XMLHTTP TEXT ("+m+"): "+function ag(l,m){if(!l.g)return m;if(!m)return null;try{var w=JSON.parse(m);if(w)for(l=0;l<w.length;l++)if(Array.isArray(w[l])){var A=w[l];if(!(2>A.length)){var he=A[1];if(Array.isArray(he)&&!(1>he.length)){var Ce=he[0];if("noop"!=Ce&&"stop"!=Ce&&"close"!=Ce)for(var lt=1;lt<he.length;lt++)he[lt]=""}}}return ac(w)}catch{return m}}(l,w)+(A?" "+A:"")})}Er.La="serverreachability",ke(Xd,mn),Er.STAT_EVENT="statevent",ke(Hd,mn),Er.Ma="timingevent",ke(Jd,mn),rs.prototype.xa=function(){this.g=!1},rs.prototype.info=function(){};var hc,po={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Zd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function go(){}function rr(l,m,w,A){this.j=l,this.i=m,this.l=w,this.R=A||1,this.U=new Zi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new e_}function e_(){this.i=null,this.g="",this.h=!1}ke(go,lc),go.prototype.g=function(){return new XMLHttpRequest},go.prototype.i=function(){return{}},hc=new go;var t_={},dc={};function _c(l,m,w){l.L=1,l.v=xo(jn(m)),l.m=w,l.P=!0,n_(l,null)}function n_(l,m){l.F=Date.now(),yo(l),l.A=jn(l.v);var w=l.A,A=l.R;Array.isArray(A)||(A=[String(A)]),p_(w.i,"t",A),l.C=0,w=l.j.J,l.h=new e_,l.g=k_(l.j,w?m:null,!l.m),0<l.O&&(l.M=new tg(N(l.Y,l,l.g),l.O)),m=l.U,w=l.g,A=l.ca;var he="readystatechange";Array.isArray(he)||(he&&(Wd[0]=he.toString()),he=Wd);for(var Ce=0;Ce<he.length;Ce++){var lt=Nd(w,he[Ce],A||m.handleEvent,!1,m.h||m);if(!lt)break;m.g[lt.key]=lt}m=l.H?j(l.H):{},l.m?(l.u||(l.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,m)):(l.u="GET",l.g.ea(l.A,l.u,null,m)),ts(),function ig(l,m,w,A,he,Ce){l.info(function(){if(l.g)if(Ce)for(var lt="",jt=Ce.split("&"),un=0;un<jt.length;un++){var kt=jt[un].split("=");if(1<kt.length){var pn=kt[0];kt=kt[1];var gn=pn.split("_");lt=2<=gn.length&&"type"==gn[1]?lt+(pn+"=")+kt+"&":lt+(pn+"=redacted&")}}else lt=null;else lt=Ce;return"XMLHTTP REQ ("+A+") [attempt "+he+"]: "+m+"\n"+w+"\n"+lt})}(l.i,l.u,l.A,l.l,l.R,l.m)}function r_(l){return!!l.g&&"GET"==l.u&&2!=l.L&&l.j.Ca}function lg(l,m){var w=l.C,A=m.indexOf("\n",w);return-1==A?dc:(w=Number(m.substring(w,A)),isNaN(w)?t_:(A+=1)+w>m.length?dc:(m=m.slice(A,A+w),l.C=A+w,m))}function yo(l){l.S=Date.now()+l.I,i_(l,l.I)}function i_(l,m){if(null!=l.B)throw Error("WatchDog timer not null");l.B=ns(N(l.ba,l),m)}function mc(l){l.B&&(c.clearTimeout(l.B),l.B=null)}function is(l){0==l.j.G||l.J||O_(l.j,l)}function Ir(l){mc(l);var m=l.M;m&&"function"==typeof m.ma&&m.ma(),l.M=null,Kd(l.U),l.g&&(m=l.g,l.g=null,m.abort(),m.ma())}function fc(l,m){try{var w=l.j;if(0!=w.G&&(w.g==l||pc(w.h,l)))if(!l.K&&pc(w.h,l)&&3==w.G){try{var A=w.Da.g.parse(m)}catch{A=null}if(Array.isArray(A)&&3==A.length){var he=A;if(0==he[0]){e:if(!w.u){if(w.g){if(!(w.g.F+3e3<l.F))break e;Co(w),Io(w)}wc(w),vn(18)}}else w.za=he[1],0<w.za-w.T&&37500>he[2]&&w.F&&0==w.v&&!w.C&&(w.C=ns(N(w.Za,w),6e3));if(1>=a_(w.h)&&w.ca){try{w.ca()}catch{}w.ca=void 0}}else Cr(w,11)}else if((l.K||w.g==l)&&Co(w),!yt(m))for(he=w.Da.g.parse(m),m=0;m<he.length;m++){let kt=he[m];if(w.T=kt[0],kt=kt[1],2==w.G)if("c"==kt[0]){w.K=kt[1],w.ia=kt[2];const pn=kt[3];null!=pn&&(w.la=pn,w.j.info("VER="+w.la));const gn=kt[4];null!=gn&&(w.Aa=gn,w.j.info("SVER="+w.Aa));const hi=kt[5];null!=hi&&"number"==typeof hi&&0<hi&&(w.L=A=1.5*hi,w.j.info("backChannelRequestTimeoutMs_="+A)),A=w;const An=l.g;if(An){const So=An.g?An.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(So){var Ce=A.h;Ce.g||-1==So.indexOf("spdy")&&-1==So.indexOf("quic")&&-1==So.indexOf("h2")||(Ce.j=Ce.l,Ce.g=new Set,Ce.h&&(gc(Ce,Ce.h),Ce.h=null))}if(A.D){const Tc=An.g?An.g.getResponseHeader("X-HTTP-Session-Id"):null;Tc&&(A.ya=Tc,Ut(A.I,A.D,Tc))}}w.G=3,w.l&&w.l.ua(),w.ba&&(w.R=Date.now()-l.F,w.j.info("Handshake RTT: "+w.R+"ms"));var lt=l;if((A=w).qa=D_(A,A.J?A.ia:null,A.W),lt.K){l_(A.h,lt);var jt=lt,un=A.L;un&&(jt.I=un),jt.B&&(mc(jt),yo(jt)),A.g=lt}else S_(A);0<w.i.length&&bo(w)}else"stop"!=kt[0]&&"close"!=kt[0]||Cr(w,7);else 3==w.G&&("stop"==kt[0]||"close"==kt[0]?"stop"==kt[0]?Cr(w,7):vc(w):"noop"!=kt[0]&&w.l&&w.l.ta(kt),w.v=0)}ts()}catch{}}rr.prototype.ca=function(l){l=l.target;const m=this.M;m&&3==Gn(l)?m.j():this.Y(l)},rr.prototype.Y=function(l){try{if(l==this.g)e:{const gn=Gn(this.g);var m=this.g.Ba();if(this.g.Z(),!(3>gn)&&(3!=gn||this.g&&(this.h.h||this.g.oa()||E_(this.g)))){this.J||4!=gn||7==m||ts(),mc(this);var w=this.g.Z();this.X=w;t:if(r_(this)){var A=E_(this.g);l="";var he=A.length,Ce=4==Gn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Ir(this),is(this);var lt="";break t}this.h.i=new c.TextDecoder}for(m=0;m<he;m++)this.h.h=!0,l+=this.h.i.decode(A[m],{stream:!(Ce&&m==he-1)});A.length=0,this.h.g+=l,this.C=0,lt=this.h.g}else lt=this.g.oa();if(this.o=200==w,function sg(l,m,w,A,he,Ce,lt){l.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+he+"]: "+m+"\n"+w+"\n"+Ce+" "+lt})}(this.i,this.u,this.A,this.l,this.R,gn,w),this.o){if(this.T&&!this.K){t:{if(this.g){var jt,un=this.g;if((jt=un.g?un.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!yt(jt)){var kt=jt;break t}}kt=null}if(!(w=kt)){this.o=!1,this.s=3,vn(12),Ir(this),is(this);break e}li(this.i,this.l,w,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fc(this,w)}if(this.P){let An;for(w=!0;!this.J&&this.C<lt.length;){if(An=lg(this,lt),An==dc){4==gn&&(this.s=4,vn(14),w=!1),li(this.i,this.l,null,"[Incomplete Response]");break}if(An==t_){this.s=4,vn(15),li(this.i,this.l,lt,"[Invalid Chunk]"),w=!1;break}li(this.i,this.l,An,null),fc(this,An)}if(r_(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=gn||0!=lt.length||this.h.h||(this.s=1,vn(16),w=!1),this.o=this.o&&w,w){if(0<lt.length&&!this.W){this.W=!0;var pn=this.j;pn.g==this&&pn.ba&&!pn.M&&(pn.j.info("Great, no buffering proxy detected. Bytes received: "+lt.length),xc(pn),pn.M=!0,vn(11))}}else li(this.i,this.l,lt,"[Invalid Chunked Response]"),Ir(this),is(this)}else li(this.i,this.l,lt,null),fc(this,lt);4==gn&&Ir(this),this.o&&!this.J&&(4==gn?O_(this.j,this):(this.o=!1,yo(this)))}else(function bg(l){const m={};l=(l.g&&2<=Gn(l)&&l.g.getAllResponseHeaders()||"").split("\r\n");for(let A=0;A<l.length;A++){if(yt(l[A]))continue;var w=ae(l[A]);const he=w[0];if("string"!=typeof(w=w[1]))continue;w=w.trim();const Ce=m[he]||[];m[he]=Ce,Ce.push(w)}!function ne(l,m){for(const w in l)m.call(void 0,l[w],w,l)}(m,function(A){return A.join(", ")})})(this.g),400==w&&0<lt.indexOf("Unknown SID")?(this.s=3,vn(12)):(this.s=0,vn(13)),Ir(this),is(this)}}}catch{}},rr.prototype.cancel=function(){this.J=!0,Ir(this)},rr.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(function og(l,m){l.info(function(){return"TIMEOUT: "+m})}(this.i,this.A),2!=this.L&&(ts(),vn(17)),Ir(this),this.s=2,is(this)):i_(this,this.S-l)};var cg=class{constructor(l,m){this.g=l,this.map=m}};function s_(l){this.l=l||10,l=c.PerformanceNavigationTiming?0<(l=c.performance.getEntriesByType("navigation")).length&&("hq"==l[0].nextHopProtocol||"h2"==l[0].nextHopProtocol):!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function o_(l){return!!l.h||!!l.g&&l.g.size>=l.j}function a_(l){return l.h?1:l.g?l.g.size:0}function pc(l,m){return l.h?l.h==m:!!l.g&&l.g.has(m)}function gc(l,m){l.g?l.g.add(m):l.h=m}function l_(l,m){l.h&&l.h==m?l.h=null:l.g&&l.g.has(m)&&l.g.delete(m)}function c_(l){if(null!=l.h)return l.i.concat(l.h.D);if(null!=l.g&&0!==l.g.size){let m=l.i;for(const w of l.g.values())m=m.concat(w.D);return m}return Qe(l.i)}function u_(l,m){if(l.forEach&&"function"==typeof l.forEach)l.forEach(m,void 0);else if(u(l)||"string"==typeof l)Array.prototype.forEach.call(l,m,void 0);else for(var w=function hg(l){if(l.na&&"function"==typeof l.na)return l.na();if(!l.V||"function"!=typeof l.V){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||"string"==typeof l){var m=[];l=l.length;for(var w=0;w<l;w++)m.push(w);return m}m=[],w=0;for(const A in l)m[w++]=A;return m}}}(l),A=function ug(l){if(l.V&&"function"==typeof l.V)return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if("string"==typeof l)return l.split("");if(u(l)){for(var m=[],w=l.length,A=0;A<w;A++)m.push(l[A]);return m}for(A in m=[],w=0,l)m[w++]=l[A];return m}(l),he=A.length,Ce=0;Ce<he;Ce++)m.call(void 0,A[Ce],w&&w[Ce],l)}s_.prototype.cancel=function(){if(this.i=c_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const l of this.g.values())l.cancel();this.g.clear()}};var h_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function br(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof br){this.h=l.h,vo(this,l.j),this.o=l.o,this.g=l.g,wo(this,l.s),this.l=l.l;var m=l.i,w=new as;w.i=m.i,m.g&&(w.g=new Map(m.g),w.h=m.h),d_(this,w),this.m=l.m}else l&&(m=String(l).match(h_))?(this.h=!1,vo(this,m[1]||"",!0),this.o=ss(m[2]||""),this.g=ss(m[3]||"",!0),wo(this,m[4]),this.l=ss(m[5]||"",!0),d_(this,m[6]||"",!0),this.m=ss(m[7]||"")):(this.h=!1,this.i=new as(null,this.h))}function jn(l){return new br(l)}function vo(l,m,w){l.j=w?ss(m,!0):m,l.j&&(l.j=l.j.replace(/:$/,""))}function wo(l,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);l.s=m}else l.s=null}function d_(l,m,w){m instanceof as?(l.i=m,function yg(l,m){m&&!l.j&&(ir(l),l.i=null,l.g.forEach(function(w,A){var he=A.toLowerCase();A!=he&&(m_(this,A),p_(this,he,w))},l)),l.j=m}(l.i,l.h)):(w||(m=os(m,pg)),l.i=new as(m,l.h))}function Ut(l,m,w){l.i.set(m,w)}function xo(l){return Ut(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function ss(l,m){return l?m?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function os(l,m,w){return"string"==typeof l?(l=encodeURI(l).replace(m,_g),w&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function _g(l){return"%"+((l=l.charCodeAt(0))>>4&15).toString(16)+(15&l).toString(16)}br.prototype.toString=function(){var l=[],m=this.j;m&&l.push(os(m,__,!0),":");var w=this.g;return(w||"file"==m)&&(l.push("//"),(m=this.o)&&l.push(os(m,__,!0),"@"),l.push(encodeURIComponent(String(w)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(w=this.s)&&l.push(":",String(w))),(w=this.l)&&(this.g&&"/"!=w.charAt(0)&&l.push("/"),l.push(os(w,"/"==w.charAt(0)?fg:mg,!0))),(w=this.i.toString())&&l.push("?",w),(w=this.m)&&l.push("#",os(w,gg)),l.join("")};var __=/[#\/\?@]/g,mg=/[#\?:]/g,fg=/[#\?]/g,pg=/[#\?@]/g,gg=/#/g;function as(l,m){this.h=this.g=null,this.i=l||null,this.j=!!m}function ir(l){l.g||(l.g=new Map,l.h=0,l.i&&function dg(l,m){if(l){l=l.split("&");for(var w=0;w<l.length;w++){var A=l[w].indexOf("="),he=null;if(0<=A){var Ce=l[w].substring(0,A);he=l[w].substring(A+1)}else Ce=l[w];m(Ce,he?decodeURIComponent(he.replace(/\+/g," ")):"")}}}(l.i,function(m,w){l.add(decodeURIComponent(m.replace(/\+/g," ")),w)}))}function m_(l,m){ir(l),m=ci(l,m),l.g.has(m)&&(l.i=null,l.h-=l.g.get(m).length,l.g.delete(m))}function f_(l,m){return ir(l),m=ci(l,m),l.g.has(m)}function p_(l,m,w){m_(l,m),0<w.length&&(l.i=null,l.g.set(ci(l,m),Qe(w)),l.h+=w.length)}function ci(l,m){return m=String(m),l.j&&(m=m.toLowerCase()),m}function sr(l,m,w,A,he){try{he&&(he.onload=null,he.onerror=null,he.onabort=null,he.ontimeout=null),A(w)}catch{}}function xg(){this.g=new rg}function Tg(l,m,w){const A=w||"";try{u_(l,function(he,Ce){let lt=he;p(he)&&(lt=ac(he)),m.push(A+Ce+"="+encodeURIComponent(lt))})}catch(he){throw m.push(A+"type="+encodeURIComponent("_badmap")),he}}function ls(l){this.l=l.Ub||null,this.j=l.eb||!1}function To(l,m){fn.call(this),this.D=l,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function g_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}function cs(l){l.readyState=4,l.l=null,l.j=null,l.v=null,us(l)}function us(l){l.onreadystatechange&&l.onreadystatechange.call(l)}function y_(l){let m="";return Ct(l,function(w,A){m+=A,m+=":",m+=w,m+="\r\n"}),m}function yc(l,m,w){e:{for(A in w){var A=!1;break e}A=!0}A||(w=y_(w),"string"==typeof l?null!=w&&encodeURIComponent(String(w)):Ut(l,m,w))}function Xt(l){fn.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=as.prototype).add=function(l,m){ir(this),this.i=null,l=ci(this,l);var w=this.g.get(l);return w||this.g.set(l,w=[]),w.push(m),this.h+=1,this},r.forEach=function(l,m){ir(this),this.g.forEach(function(w,A){w.forEach(function(he){l.call(m,he,A,this)},this)},this)},r.na=function(){ir(this);const l=Array.from(this.g.values()),m=Array.from(this.g.keys()),w=[];for(let A=0;A<m.length;A++){const he=l[A];for(let Ce=0;Ce<he.length;Ce++)w.push(m[A])}return w},r.V=function(l){ir(this);let m=[];if("string"==typeof l)f_(this,l)&&(m=m.concat(this.g.get(ci(this,l))));else{l=Array.from(this.g.values());for(let w=0;w<l.length;w++)m=m.concat(l[w])}return m},r.set=function(l,m){return ir(this),this.i=null,f_(this,l=ci(this,l))&&(this.h-=this.g.get(l).length),this.g.set(l,[m]),this.h+=1,this},r.get=function(l,m){return l&&0<(l=this.V(l)).length?String(l[0]):m},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],m=Array.from(this.g.keys());for(var w=0;w<m.length;w++){var A=m[w];const Ce=encodeURIComponent(String(A)),lt=this.V(A);for(A=0;A<lt.length;A++){var he=Ce;""!==lt[A]&&(he+="="+encodeURIComponent(String(lt[A]))),l.push(he)}}return this.i=l.join("&")},ke(ls,lc),ls.prototype.g=function(){return new To(this.l,this.j)},ls.prototype.i=function(l){return function(){return l}}({}),ke(To,fn),(r=To.prototype).open=function(l,m){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=m,this.readyState=1,us(this)},r.send=function(l){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(m.body=l),(this.D||c).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,cs(this)),this.readyState=0},r.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,us(this)),this.g&&(this.readyState=3,us(this),this.g)))if("arraybuffer"===this.responseType)l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;g_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var m=l.value?l.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!l.done}))&&(this.response=this.responseText+=m)}l.done?cs(this):us(this),3==this.readyState&&g_(this)}},r.Ra=function(l){this.g&&(this.response=this.responseText=l,cs(this))},r.Qa=function(l){this.g&&(this.response=l,cs(this))},r.ga=function(){this.g&&cs(this)},r.setRequestHeader=function(l,m){this.u.append(l,m)},r.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],m=this.h.entries();for(var w=m.next();!w.done;)l.push((w=w.value)[0]+": "+w[1]),w=m.next();return l.join("\r\n")},Object.defineProperty(To.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(l){this.m=l?"include":"same-origin"}}),ke(Xt,fn);var Eg=/^https?$/i,Ig=["POST","PUT"];function v_(l,m){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=m,l.m=5,w_(l),Eo(l)}function w_(l){l.A||(l.A=!0,yn(l,"complete"),yn(l,"error"))}function x_(l){if(l.h&&typeof a<"u"&&(!l.v[1]||4!=Gn(l)||2!=l.Z()))if(l.u&&4==Gn(l))$d(l.Ea,0,l);else if(yn(l,"readystatechange"),4==Gn(l)){l.h=!1;try{const lt=l.Z();e:switch(lt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var w;if(!(w=m)){var A;if(A=0===lt){var he=String(l.D).match(h_)[1]||null;!he&&c.self&&c.self.location&&(he=c.self.location.protocol.slice(0,-1)),A=!Eg.test(he?he.toLowerCase():"")}w=A}if(w)yn(l,"complete"),yn(l,"success");else{l.m=6;try{var Ce=2<Gn(l)?l.g.statusText:""}catch{Ce=""}l.l=Ce+" ["+l.Z()+"]",w_(l)}}finally{Eo(l)}}}function Eo(l,m){if(l.g){T_(l);const w=l.g,A=l.v[0]?()=>{}:null;l.g=null,l.v=null,m||yn(l,"ready");try{w.onreadystatechange=A}catch{}}}function T_(l){l.I&&(c.clearTimeout(l.I),l.I=null)}function Gn(l){return l.g?l.g.readyState:0}function E_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function hs(l,m,w){return w&&w.internalChannelParams&&w.internalChannelParams[l]||m}function I_(l){this.Aa=0,this.i=[],this.j=new rs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=hs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=hs("baseRetryDelayMs",5e3,l),this.cb=hs("retryDelaySeedMs",1e4,l),this.Wa=hs("forwardChannelMaxRetries",2,l),this.wa=hs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new s_(l&&l.concurrentRequestLimit),this.Da=new xg,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function vc(l){if(b_(l),3==l.G){var m=l.U++,w=jn(l.I);if(Ut(w,"SID",l.K),Ut(w,"RID",m),Ut(w,"TYPE","terminate"),ds(l,w),(m=new rr(l,l.j,m)).L=2,m.v=xo(jn(w)),w=!1,c.navigator&&c.navigator.sendBeacon)try{w=c.navigator.sendBeacon(m.v.toString(),"")}catch{}!w&&c.Image&&((new Image).src=m.v,w=!0),w||(m.g=k_(m.j,null),m.g.ea(m.v)),m.F=Date.now(),yo(m)}M_(l)}function Io(l){l.g&&(xc(l),l.g.cancel(),l.g=null)}function b_(l){Io(l),l.u&&(c.clearTimeout(l.u),l.u=null),Co(l),l.h.cancel(),l.s&&("number"==typeof l.s&&c.clearTimeout(l.s),l.s=null)}function bo(l){if(!o_(l.h)&&!l.s){l.s=!0;var m=l.Ga;Qi||zd(),Xi||(Qi(),Xi=!0),Jl.add(m,l),l.B=0}}function C_(l,m){var w;w=m?m.l:l.U++;const A=jn(l.I);Ut(A,"SID",l.K),Ut(A,"RID",w),Ut(A,"AID",l.T),ds(l,A),l.m&&l.o&&yc(A,l.m,l.o),w=new rr(l,l.j,w,l.B+1),null===l.m&&(w.H=l.o),m&&(l.i=m.D.concat(l.i)),m=A_(l,w,1e3),w.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),gc(l.h,w),_c(w,A,m)}function ds(l,m){l.H&&Ct(l.H,function(w,A){Ut(m,A,w)}),l.l&&u_({},function(w,A){Ut(m,A,w)})}function A_(l,m,w){w=Math.min(l.i.length,w);var A=l.l?N(l.l.Na,l.l,l):null;e:{var he=l.i;let Ce=-1;for(;;){const lt=["count="+w];-1==Ce?0<w?(Ce=he[0].g,lt.push("ofs="+Ce)):Ce=0:lt.push("ofs="+Ce);let jt=!0;for(let un=0;un<w;un++){let kt=he[un].g;const pn=he[un].map;if(kt-=Ce,0>kt)Ce=Math.max(0,he[un].g-100),jt=!1;else try{Tg(pn,lt,"req"+kt+"_")}catch{A&&A(pn)}}if(jt){A=lt.join("&");break e}}}return l=l.i.splice(0,w),m.D=l,A}function S_(l){if(!l.g&&!l.u){l.Y=1;var m=l.Fa;Qi||zd(),Xi||(Qi(),Xi=!0),Jl.add(m,l),l.v=0}}function wc(l){return!(l.g||l.u||3<=l.v||(l.Y++,l.u=ns(N(l.Fa,l),P_(l,l.v)),l.v++,0))}function xc(l){null!=l.A&&(c.clearTimeout(l.A),l.A=null)}function R_(l){l.g=new rr(l,l.j,"rpc",l.Y),null===l.m&&(l.g.H=l.o),l.g.O=0;var m=jn(l.qa);Ut(m,"RID","rpc"),Ut(m,"SID",l.K),Ut(m,"AID",l.T),Ut(m,"CI",l.F?"0":"1"),!l.F&&l.ja&&Ut(m,"TO",l.ja),Ut(m,"TYPE","xmlhttp"),ds(l,m),l.m&&l.o&&yc(m,l.m,l.o),l.L&&(l.g.I=l.L);var w=l.g;l=l.ia,w.L=1,w.v=xo(jn(m)),w.m=null,w.P=!0,n_(w,l)}function Co(l){null!=l.C&&(c.clearTimeout(l.C),l.C=null)}function O_(l,m){var w=null;if(l.g==m){Co(l),xc(l),l.g=null;var A=2}else{if(!pc(l.h,m))return;w=m.D,l_(l.h,m),A=1}if(0!=l.G)if(m.o)if(1==A){w=m.m?m.m.length:0,m=Date.now()-m.F;var he=l.B;yn(A=fo(),new Jd(A,w)),bo(l)}else S_(l);else if(3==(he=m.s)||0==he&&0<m.X||!(1==A&&function Cg(l,m){return!(a_(l.h)>=l.h.j-(l.s?1:0)||(l.s?(l.i=m.D.concat(l.i),0):1==l.G||2==l.G||l.B>=(l.Va?0:l.Wa)||(l.s=ns(N(l.Ga,l,m),P_(l,l.B)),l.B++,0)))}(l,m)||2==A&&wc(l)))switch(w&&0<w.length&&(m=l.h,m.i=m.i.concat(w)),he){case 1:Cr(l,5);break;case 4:Cr(l,10);break;case 3:Cr(l,6);break;default:Cr(l,2)}}function P_(l,m){let w=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(w*=2),w*m}function Cr(l,m){if(l.j.info("Error code "+m),2==m){var w=N(l.fb,l),A=l.Xa;const he=!A;A=new br(A||"//www.google.com/images/cleardot.gif"),c.location&&"http"==c.location.protocol||vo(A,"https"),xo(A),he?function vg(l,m){const w=new rs;if(c.Image){const A=new Image;A.onload=ue(sr,w,"TestLoadImage: loaded",!0,m,A),A.onerror=ue(sr,w,"TestLoadImage: error",!1,m,A),A.onabort=ue(sr,w,"TestLoadImage: abort",!1,m,A),A.ontimeout=ue(sr,w,"TestLoadImage: timeout",!1,m,A),c.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=l}else m(!1)}(A.toString(),w):function wg(l,m){new rs;const A=new AbortController,he=setTimeout(()=>{A.abort(),sr(0,0,!1,m)},1e4);fetch(l,{signal:A.signal}).then(Ce=>{clearTimeout(he),sr(0,0,!!Ce.ok,m)}).catch(()=>{clearTimeout(he),sr(0,0,!1,m)})}(A.toString(),w)}else vn(2);l.G=0,l.l&&l.l.sa(m),M_(l),b_(l)}function M_(l){if(l.G=0,l.ka=[],l.l){const m=c_(l.h);(0!=m.length||0!=l.i.length)&&(Ge(l.ka,m),Ge(l.ka,l.i),l.h.i.length=0,Qe(l.i),l.i.length=0),l.l.ra()}}function D_(l,m,w){var A=w instanceof br?jn(w):new br(w);if(""!=A.g)m&&(A.g=m+"."+A.g),wo(A,A.s);else{var he=c.location;A=he.protocol,m=m?m+"."+he.hostname:he.hostname,he=+he.port;var Ce=new br(null);A&&vo(Ce,A),m&&(Ce.g=m),he&&wo(Ce,he),w&&(Ce.l=w),A=Ce}return m=l.ya,(w=l.D)&&m&&Ut(A,w,m),Ut(A,"VER",l.la),ds(l,A),A}function k_(l,m,w){if(m&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return(m=new Xt(l.Ca&&!l.pa?new ls({eb:w}):l.pa)).Ha(l.J),m}function F_(){}function Ao(){}function bn(l,m){fn.call(this),this.g=new I_(m),this.l=l,this.h=m&&m.messageUrlParams||null,l=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(l?l["X-WebChannel-Content-Type"]=m.messageContentType:l={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(l?l["X-WebChannel-Client-Profile"]=m.va:l={"X-WebChannel-Client-Profile":m.va}),this.g.S=l,(l=m&&m.Sb)&&!yt(l)&&(this.g.m=l),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!yt(m)&&(this.g.D=m,null!==(l=this.h)&&m in l&&m in(l=this.h)&&delete l[m]),this.j=new ui(this)}function V_(l){cc.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var m=l.__sm__;if(m){e:{for(const w in m){l=w;break e}l=void 0}(this.i=l)&&(l=this.i,m=null!==m&&l in m?m[l]:void 0),this.data=m}else this.data=l}function z_(){uc.call(this),this.status=1}function ui(l){this.g=l}(r=Xt.prototype).Ha=function(l){this.J=l},r.ea=function(l,m,w,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);m=m?m.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():hc.g(),this.v=function qd(l){return l.h||(l.h=l.i())}(this.o?this.o:hc),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(m,String(l),!0),this.B=!1}catch(Ce){return void v_(this,Ce)}if(l=w||"",w=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var he in A)w.set(he,A[he]);else{if("function"!=typeof A.keys||"function"!=typeof A.get)throw Error("Unknown input type for opt_headers: "+String(A));for(const Ce of A.keys())w.set(Ce,A.get(Ce))}A=Array.from(w.keys()).find(Ce=>"content-type"==Ce.toLowerCase()),he=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Ig,m,void 0))||A||he||w.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ce,lt]of w)this.g.setRequestHeader(Ce,lt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{T_(this),this.u=!0,this.g.send(l),this.u=!1}catch(Ce){v_(this,Ce)}},r.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,yn(this,"complete"),yn(this,"abort"),Eo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Eo(this,!0)),Xt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?x_(this):this.bb())},r.bb=function(){x_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Gn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(l){if(this.g){var m=this.g.responseText;return l&&0==m.indexOf(l)&&(m=m.substring(l.length)),ng(m)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=I_.prototype).la=8,r.G=1,r.connect=function(l,m,w,A){vn(0),this.W=l,this.H=m||{},w&&void 0!==A&&(this.H.OSID=w,this.H.OAID=A),this.F=this.X,this.I=D_(this,null,this.W),bo(this)},r.Ga=function(l){if(this.s)if(this.s=null,1==this.G){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const he=new rr(this,this.j,l);let Ce=this.o;if(this.S&&(Ce?(Ce=j(Ce),re(Ce,this.S)):Ce=this.S),null!==this.m||this.O||(he.H=Ce,Ce=null),this.P)e:{for(var m=0,w=0;w<this.i.length;w++){var A=this.i[w];if(void 0===(A="__data__"in A.map&&"string"==typeof(A=A.map.__data__)?A.length:void 0))break;if(4096<(m+=A)){m=w;break e}if(4096===m||w===this.i.length-1){m=w+1;break e}}m=1e3}else m=1e3;m=A_(this,he,m),Ut(w=jn(this.I),"RID",l),Ut(w,"CVER",22),this.D&&Ut(w,"X-HTTP-Session-Id",this.D),ds(this,w),Ce&&(this.O?m="headers="+encodeURIComponent(String(y_(Ce)))+"&"+m:this.m&&yc(w,this.m,Ce)),gc(this.h,he),this.Ua&&Ut(w,"TYPE","init"),this.P?(Ut(w,"$req",m),Ut(w,"SID","null"),he.T=!0,_c(he,w,null)):_c(he,w,m),this.G=2}}else 3==this.G&&(l?C_(this,l):0==this.i.length||o_(this.h)||C_(this))},r.Fa=function(){if(this.u=null,R_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=ns(N(this.ab,this),l)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,vn(10),Io(this),R_(this))},r.Za=function(){null!=this.C&&(this.C=null,Io(this),wc(this),vn(19))},r.fb=function(l){l?(this.j.info("Successfully pinged google.com"),vn(2)):(this.j.info("Failed to ping google.com"),vn(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=F_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Ao.prototype.g=function(l,m){return new bn(l,m)},ke(bn,fn),bn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},bn.prototype.close=function(){vc(this.g)},bn.prototype.o=function(l){var m=this.g;if("string"==typeof l){var w={};w.__data__=l,l=w}else this.u&&((w={}).__data__=ac(l),l=w);m.i.push(new cg(m.Ya++,l)),3==m.G&&bo(m)},bn.prototype.N=function(){this.g.l=null,delete this.j,vc(this.g),delete this.g,bn.aa.N.call(this)},ke(V_,cc),ke(z_,uc),ke(ui,F_),ui.prototype.ua=function(){yn(this.g,"a")},ui.prototype.ta=function(l){yn(this.g,new V_(l))},ui.prototype.sa=function(l){yn(this.g,new z_)},ui.prototype.ra=function(){yn(this.g,"b")},Ao.prototype.createWebChannel=Ao.prototype.g,bn.prototype.send=bn.prototype.o,bn.prototype.open=bn.prototype.m,bn.prototype.close=bn.prototype.close,ve=d.createWebChannelTransport=function(){return new Ao},He=d.getStatEventTarget=function(){return fo()},rt=d.Event=Er,tt=d.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},po.NO_ERROR=0,po.TIMEOUT=8,po.HTTP_ERROR=6,nt=d.ErrorCode=po,Zd.COMPLETE="complete",me=d.EventType=Zd,Yd.EventType=es,es.OPEN="a",es.CLOSE="b",es.ERROR="c",es.MESSAGE="d",fn.prototype.listen=fn.prototype.K,Ie=d.WebChannel=Yd,d.FetchXmlHttpFactory=ls,Xt.prototype.listenOnce=Xt.prototype.L,Xt.prototype.getLastError=Xt.prototype.Ka,Xt.prototype.getLastErrorCode=Xt.prototype.Ba,Xt.prototype.getStatus=Xt.prototype.Z,Xt.prototype.getResponseJson=Xt.prototype.Oa,Xt.prototype.getResponseText=Xt.prototype.oa,Xt.prototype.send=Xt.prototype.ea,Xt.prototype.setWithCredentials=Xt.prototype.Ha,de=d.XhrIo=Xt}).apply(typeof $<"u"?$:typeof self<"u"?self:typeof window<"u"?window:{});const ze="@firebase/firestore";class ye{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ye.UNAUTHENTICATED=new ye(null),ye.GOOGLE_CREDENTIALS=new ye("google-credentials-uid"),ye.FIRST_PARTY=new ye("first-party-uid"),ye.MOCK_USER=new ye("mock-user");let Te="11.0.2";const Me=new x.Vy("@firebase/firestore");function we(){return Me.logLevel}function oe(r,...e){if(Me.logLevel<=x.$b.DEBUG){const t=e.map(be);Me.debug(`Firestore (${Te}): ${r}`,...t)}}function at(r,...e){if(Me.logLevel<=x.$b.ERROR){const t=e.map(be);Me.error(`Firestore (${Te}): ${r}`,...t)}}function ie(r,...e){if(Me.logLevel<=x.$b.WARN){const t=e.map(be);Me.warn(`Firestore (${Te}): ${r}`,...t)}}function be(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function H(r="Unexpected state"){const e=`FIRESTORE (${Te}) INTERNAL ASSERTION FAILED: `+r;throw at(e),new Error(e)}function pe(r,e){r||H()}function Ee(r,e){return r}const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class se extends v.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class je{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class _e{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Se{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ye.UNAUTHENTICATED))}shutdown(){}}class $e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Le{constructor(e){this.t=e,this.currentUser=ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;pe(void 0===this.o);let i=this.i;const s=p=>this.i!==i?(i=this.i,t(p)):Promise.resolve();let a=new je;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new je,e.enqueueRetryable(()=>s(this.currentUser))};const c=()=>{const p=a;e.enqueueRetryable((0,b.A)(function*(){yield p.promise,yield s(n.currentUser)}))},u=p=>{oe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(p=>u(p)),setTimeout(()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?u(p):(oe("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new je)}},0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(oe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(pe("string"==typeof n.accessToken),new _e(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pe(null===e||"string"==typeof e),new ye(e)}}class ht{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ye.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Ye{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ht(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ye.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qe{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Fe{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){pe(void 0===this.o);const n=s=>{null!=s.error&&oe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,oe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{oe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):oe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(pe("string"==typeof t.token),this.R=t.token,new qe(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ct(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class Ze{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=ct(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function it(r,e){return r<e?-1:r>e?1:0}function Re(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}class Ue{static now(){return Ue.fromMillis(Date.now())}static fromDate(e){return Ue.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ue(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new se(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new se(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new se(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new se(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?it(this.nanoseconds,e.nanoseconds):it(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class fe{static fromTimestamp(e){return new fe(e)}static min(){return new fe(new Ue(0,0))}static max(){return new fe(new Ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class We{constructor(e,t,n){void 0===t?t=0:t>e.length&&H(),void 0===n?n=e.length-t:n>e.length-t&&H(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===We.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof We?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Je extends We{construct(e,t,n){return new Je(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new se(L.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new Je(t)}static emptyPath(){return new Je([])}}const Lt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class xt extends We{construct(e,t,n){return new xt(e,t,n)}static isValidIdentifier(e){return Lt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),xt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new xt(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new se(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const c=e[i];if("\\"===c){if(i+1===e.length)throw new se(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new se(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else"`"===c?(a=!a,i++):"."!==c||a?(n+=c,i++):(s(),i++)}if(s(),a)throw new se(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new xt(t)}static emptyPath(){return new xt([])}}class et{constructor(e){this.path=e}static fromPath(e){return new et(Je.fromString(e))}static fromName(e){return new et(Je.fromString(e).popFirst(5))}static empty(){return new et(Je.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Je.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Je.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new et(new Je(e.slice()))}}class E{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new E(fe.min(),et.empty(),-1)}static max(){return new E(fe.max(),et.empty(),-1)}}function R(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=et.comparator(r.documentKey,e.documentKey),0!==t?t:it(r.largestBatchId,e.largestBatchId))}const M="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class U{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function xe(r){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,b.A)(function*(r){if(r.code!==L.FAILED_PRECONDITION||r.message!==M)throw r;oe("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&H(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):D.reject(t)}static resolve(e){return new D((t,n)=>{t(e)})}static reject(e){return new D((t,n)=>{n(e)})}static waitFor(e){return new D((t,n)=>{let i=0,s=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++s,a&&s===i&&t()},u=>n(u))}),a=!0,s===i&&t()})}static or(e){let t=D.resolve(!1);for(const n of e)t=t.next(i=>i?D.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new D((n,i)=>{const s=e.length,a=new Array(s);let c=0;for(let u=0;u<s;u++){const p=u;t(e[p]).next(T=>{a[p]=T,++c,c===s&&n(a)},T=>i(T))}})}static doWhile(e,t){return new D((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}function Be(r){return"IndexedDbTransactionError"===r.name}let Ft=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function qt(r){return null==r}function wt(r){return 0===r&&1/r==-1/0}function W(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function st(r){return r+"\x01\x01"}function Cc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function $n(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Sc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Gt{constructor(e,t){this.comparator=e,this.root=t||an.EMPTY}insert(e,t){return new Gt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,an.BLACK,null,null))}remove(e){return new Gt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,an.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _s(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _s(this.root,e,this.comparator,!1)}getReverseIterator(){return new _s(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _s(this.root,e,this.comparator,!0)}}class _s{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class an{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??an.RED,this.left=i??an.EMPTY,this.right=s??an.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new an(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return an.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return an.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,an.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,an.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw H();const e=this.left.check();if(e!==this.right.check())throw H();return e+(this.isRed()?0:1)}}an.EMPTY=null,an.RED=!0,an.BLACK=!1,an.EMPTY=new class{constructor(){this.size=0}get key(){throw H()}get value(){throw H()}get color(){throw H()}get left(){throw H()}get right(){throw H()}copy(e,t,n,i,s){return this}insert(e,t,n){return new an(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class zt{constructor(e){this.comparator=e,this.data=new Gt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Rc(this.data.getIterator())}getIteratorFrom(e){return new Rc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof zt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new zt(this.comparator);return t.data=e,t}}class Rc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Tn{constructor(e){this.fields=e,e.sort(xt.comparator)}static empty(){return new Tn([])}unionWith(e){let t=new zt(xt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Tn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Re(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Oc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Qt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Oc("Invalid base64 string: "+s):s}}(e);return new Qt(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Qt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return it(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qt.EMPTY_BYTE_STRING=new Qt("");const j_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dn(r){if(pe(!!r),"string"==typeof r){let e=0;const t=j_.exec(r);if(pe(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Wt(r.seconds),nanos:Wt(r.nanos)}}function Wt(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function kn(r){return"string"==typeof r?Qt.fromBase64String(r):Qt.fromUint8Array(r)}function ms(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function fs(r){const e=r.mapValue.fields.__previous_value__;return ms(e)?fs(e):e}function _i(r){const e=Dn(r.mapValue.fields.__local_write_time__.timestampValue);return new Ue(e.seconds,e.nanos)}class G_{constructor(e,t,n,i,s,a,c,u,p){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=p}}class or{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new or("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof or&&e.projectId===this.projectId&&e.database===this.database}}const Un={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Wn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ms(r)?4:Fc(r)?9007199254740991:vs(r)?10:11:H()}function Sn(r,e){if(r===e)return!0;const t=Wn(r);if(t!==Wn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return _i(r).isEqual(_i(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Dn(i.timestampValue),c=Dn(s.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,kn(r.bytesValue).isEqual(kn(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return Wt(i.geoPointValue.latitude)===Wt(s.geoPointValue.latitude)&&Wt(i.geoPointValue.longitude)===Wt(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Wt(i.integerValue)===Wt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Wt(i.doubleValue),c=Wt(s.doubleValue);return a===c?wt(a)===wt(c):isNaN(a)&&isNaN(c)}return!1}(r,e);case 9:return Re(r.arrayValue.values||[],e.arrayValue.values||[],Sn);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},c=s.mapValue.fields||{};if(Cc(a)!==Cc(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(void 0===c[u]||!Sn(a[u],c[u])))return!1;return!0}(r,e);default:return H()}var s}function mi(r,e){return void 0!==(r.values||[]).find(t=>Sn(t,e))}function Kn(r,e){if(r===e)return 0;const t=Wn(r),n=Wn(e);if(t!==n)return it(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return it(r.booleanValue,e.booleanValue);case 2:return function(s,a){const c=Wt(s.integerValue||s.doubleValue),u=Wt(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,e);case 3:return Pc(r.timestampValue,e.timestampValue);case 4:return Pc(_i(r),_i(e));case 5:return it(r.stringValue,e.stringValue);case 6:return function(s,a){const c=kn(s),u=kn(a);return c.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const c=s.split("/"),u=a.split("/");for(let p=0;p<c.length&&p<u.length;p++){const T=it(c[p],u[p]);if(0!==T)return T}return it(c.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const c=it(Wt(s.latitude),Wt(a.latitude));return 0!==c?c:it(Wt(s.longitude),Wt(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Mc(r.arrayValue,e.arrayValue);case 10:return function(s,a){var c,u,p,T;const ue=null===(c=(s.fields||{}).value)||void 0===c?void 0:c.arrayValue,ke=null===(u=(a.fields||{}).value)||void 0===u?void 0:u.arrayValue,Qe=it((null===(p=ue?.values)||void 0===p?void 0:p.length)||0,(null===(T=ke?.values)||void 0===T?void 0:T.length)||0);return 0!==Qe?Qe:Mc(ue,ke)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===Un.mapValue&&a===Un.mapValue)return 0;if(s===Un.mapValue)return 1;if(a===Un.mapValue)return-1;const c=s.fields||{},u=Object.keys(c),p=a.fields||{},T=Object.keys(p);u.sort(),T.sort();for(let C=0;C<u.length&&C<T.length;++C){const N=it(u[C],T[C]);if(0!==N)return N;const ue=Kn(c[u[C]],p[T[C]]);if(0!==ue)return ue}return it(u.length,T.length)}(r.mapValue,e.mapValue);default:throw H()}}function Pc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return it(r,e);const t=Dn(r),n=Dn(e),i=it(t.seconds,n.seconds);return 0!==i?i:it(t.nanos,n.nanos)}function Mc(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Kn(t[i],n[i]);if(s)return s}return it(t.length,n.length)}function Rr(r){return No(r)}function No(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Dn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?kn(r.bytesValue).toBase64():"referenceValue"in r?et.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=No(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${No(t.fields[a])}`;return i+"}"}(r.mapValue):H()}function gs(r){switch(Wn(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fs(r);return e?16+gs(e):16;case 5:return 2*r.stringValue.length;case 6:return kn(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(r.arrayValue.values||[]).reduce((i,s)=>i+gs(s),0);case 10:case 11:return function(n){let i=0;return $n(n.fields,(s,a)=>{i+=s.length+gs(a)}),i}(r.mapValue);default:throw H()}}function ar(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Lo(r){return!!r&&"integerValue"in r}function fi(r){return!!r&&"arrayValue"in r}function Dc(r){return!!r&&"nullValue"in r}function kc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ys(r){return!!r&&"mapValue"in r}function vs(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function pi(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return $n(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=pi(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=pi(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Fc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class ln{constructor(e){this.value=e}static empty(){return new ln({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ys(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=pi(t)}setAll(e){let t=xt.emptyPath(),n={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=c.popLast()}a?n[c.lastSegment()]=pi(a):i.push(c.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());ys(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Sn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];ys(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){$n(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new ln(pi(this.value))}}function Lc(r){const e=[];return $n(r.fields,(t,n)=>{const i=new xt([t]);if(ys(n)){const s=Lc(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new Tn(e)}class $t{constructor(e,t,n,i,s,a,c){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=c}static newInvalidDocument(e){return new $t(e,0,fe.min(),fe.min(),fe.min(),ln.empty(),0)}static newFoundDocument(e,t,n,i){return new $t(e,1,t,fe.min(),n,i,0)}static newNoDocument(e,t){return new $t(e,2,t,fe.min(),fe.min(),ln.empty(),0)}static newUnknownDocument(e,t){return new $t(e,3,t,fe.min(),fe.min(),ln.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(fe.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ln.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ln.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=fe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof $t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class qn{constructor(e,t){this.position=e,this.inclusive=t}}function Bc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?et.comparator(et.fromName(a.referenceValue),t.key):Kn(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function jc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Sn(r.position[t],e.position[t]))return!1;return!0}class gi{constructor(e,t="asc"){this.field=e,this.dir=t}}function W_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Gc{}class Rt extends Gc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new K_(e,t,n):"array-contains"===t?new Q_(e,n):"in"===t?new Yc(e,n):"not-in"===t?new X_(e,n):"array-contains-any"===t?new H_(e,n):new Rt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new q_(e,n):new Y_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Kn(t,this.value)):null!==t&&Wn(this.value)===Wn(t)&&this.matchesComparison(Kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return H()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Nt extends Gc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Nt(e,t)}matches(e){return Or(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Or(r){return"and"===r.op}function jo(r){return function $c(r){for(const e of r.filters)if(e instanceof Nt)return!1;return!0}(r)&&Or(r)}function Go(r){if(r instanceof Rt)return r.field.canonicalString()+r.op.toString()+Rr(r.value);if(jo(r))return r.filters.map(e=>Go(e)).join(",");{const e=r.filters.map(t=>Go(t)).join(",");return`${r.op}(${e})`}}function Uc(r,e){return r instanceof Rt?(n=r,(i=e)instanceof Rt&&n.op===i.op&&n.field.isEqual(i.field)&&Sn(n.value,i.value)):r instanceof Nt?function(n,i){return i instanceof Nt&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,c)=>s&&Uc(a,i.filters[c]),!0)}(r,e):void H();var n,i}function Kc(r){return r instanceof Rt?`${(t=r).field.canonicalString()} ${t.op} ${Rr(t.value)}`:r instanceof Nt?function(t){return t.op.toString()+" {"+t.getFilters().map(Kc).join(" ,")+"}"}(r):"Filter";var t}class K_ extends Rt{constructor(e,t,n){super(e,t,n),this.key=et.fromName(n.referenceValue)}matches(e){const t=et.comparator(e.key,this.key);return this.matchesComparison(t)}}class q_ extends Rt{constructor(e,t){super(e,"in",t),this.keys=qc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Y_ extends Rt{constructor(e,t){super(e,"not-in",t),this.keys=qc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function qc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>et.fromName(n.referenceValue))}class Q_ extends Rt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fi(t)&&mi(t.arrayValue,this.value)}}class Yc extends Rt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&mi(this.value.arrayValue,t)}}class X_ extends Rt{constructor(e,t){super(e,"not-in",t)}matches(e){if(mi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!mi(this.value.arrayValue,t)}}class H_ extends Rt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>mi(this.value.arrayValue,n))}}class J_{constructor(e,t=null,n=[],i=[],s=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=c,this.ue=null}}function $o(r,e=null,t=[],n=[],i=null,s=null,a=null){return new J_(r,e,t,n,i,s,a)}function lr(r){const e=Ee(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Go(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),qt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Rr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Rr(n)).join(",")),e.ue=t}return e.ue}function yi(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!W_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Uc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!jc(r.startAt,e.startAt)&&jc(r.endAt,e.endAt)}function ws(r){return et.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class Fn{constructor(e,t=null,n=[],i=[],s=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null}}function Pr(r){return new Fn(r)}function Jc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Uo(r){return null!==r.collectionGroup}function Mr(r){const e=Ee(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new zt(xt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(p=>{p.isInequality()&&(c=c.add(p.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new gi(s,n))}),t.has(xt.keyField().canonicalString())||e.ce.push(new gi(xt.keyField(),n))}return e.ce}function hn(r){const e=Ee(r);return e.le||(e.le=function eu(r,e){if("F"===r.limitType)return $o(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new gi(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new qn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new qn(r.startAt.position,r.startAt.inclusive):null;return $o(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Mr(r))),e.le}function Wo(r,e){const t=r.filters.concat([e]);return new Fn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ts(r,e,t){return new Fn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function vi(r,e){return yi(hn(r),hn(e))&&r.limitType===e.limitType}function tu(r){return`${lr(hn(r))}|lt:${r.limitType}`}function Dr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Kc(i)).join(", ")}]`),qt(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Rr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Rr(i)).join(",")),`Target(${n})`}(hn(r))}; limitType=${r.limitType})`}function wi(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):et.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Mr(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,c,u){const p=Bc(a,c,u);return a.inclusive?p<=0:p<0}(n.startAt,Mr(n),i)||n.endAt&&!function(a,c,u){const p=Bc(a,c,u);return a.inclusive?p>=0:p>0}(n.endAt,Mr(n),i)));var n,i}function ru(r){return(e,t)=>{let n=!1;for(const i of Mr(r)){const s=Z_(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function Z_(r,e,t){const n=r.field.isKeyField()?et.comparator(e.key,t.key):function(s,a,c){const u=a.data.field(s),p=c.data.field(s);return null!==u&&null!==p?Kn(u,p):H()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return H()}}class Vn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){$n(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return Sc(this.inner)}size(){return this.innerSize}}const em=new Gt(et.comparator);function En(){return em}const iu=new Gt(et.comparator);function xi(...r){let e=iu;for(const t of r)e=e.insert(t.key,t);return e}function su(r){let e=iu;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Rn(){return Ti()}function ou(){return Ti()}function Ti(){return new Vn(r=>r.toString(),(r,e)=>r.isEqual(e))}const tm=new Gt(et.comparator),nm=new zt(et.comparator);function bt(...r){let e=nm;for(const t of r)e=e.add(t);return e}const rm=new zt(it);function qo(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wt(e)?"-0":e}}function au(r){return{integerValue:""+r}}function lu(r,e){return function In(r){return"number"==typeof r&&Number.isInteger(r)&&!wt(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?au(e):qo(r,e)}class Es{constructor(){this._=void 0}}function im(r,e,t){return r instanceof kr?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ms(s)&&(s=fs(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof cr?uu(r,e):r instanceof ur?hu(r,e):function(i,s){const a=cu(i,s),c=du(a)+du(i.Pe);return Lo(a)&&Lo(i.Pe)?au(c):qo(i.serializer,c)}(r,e)}function sm(r,e,t){return r instanceof cr?uu(r,e):r instanceof ur?hu(r,e):t}function cu(r,e){return r instanceof Fr?Lo(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class kr extends Es{}class cr extends Es{constructor(e){super(),this.elements=e}}function uu(r,e){const t=_u(e);for(const n of r.elements)t.some(i=>Sn(i,n))||t.push(n);return{arrayValue:{values:t}}}class ur extends Es{constructor(e){super(),this.elements=e}}function hu(r,e){let t=_u(e);for(const n of r.elements)t=t.filter(i=>!Sn(i,n));return{arrayValue:{values:t}}}class Fr extends Es{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function du(r){return Wt(r.integerValue||r.doubleValue)}function _u(r){return fi(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class am{constructor(e,t){this.version=e,this.transformResults=t}}class Kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Kt}static exists(e){return new Kt(void 0,e)}static updateTime(e){return new Kt(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Is(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class bs{}function mu(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new zr(r.key,Kt.none()):new Vr(r.key,r.data,Kt.none());{const t=r.data,n=ln.empty();let i=new zt(xt.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new zn(r.key,n,new Tn(i.toArray()),Kt.none())}}function lm(r,e,t){r instanceof Vr?function(i,s,a){const c=i.value.clone(),u=gu(i.fieldTransforms,s,a.transformResults);c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):r instanceof zn?function(i,s,a){if(!Is(i.precondition,s))return void s.convertToUnknownDocument(a.version);const c=gu(i.fieldTransforms,s,a.transformResults),u=s.data;u.setAll(pu(i)),u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Ii(r,e,t,n){return r instanceof Vr?function(s,a,c,u){if(!Is(s.precondition,a))return c;const p=s.value.clone(),T=yu(s.fieldTransforms,u,a);return p.setAll(T),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),null}(r,e,t,n):r instanceof zn?function(s,a,c,u){if(!Is(s.precondition,a))return c;const p=yu(s.fieldTransforms,u,a),T=a.data;return T.setAll(pu(s)),T.setAll(p),a.convertToFoundDocument(a.version,T).setHasLocalMutations(),null===c?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(C=>C.field))}(r,e,t,n):(c=t,Is(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c);var a,c}function cm(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=cu(n.transform,i||null);null!=s&&(null===t&&(t=ln.empty()),t.set(n.field,s))}return t||null}function fu(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&Re(n,i,(s,a)=>function om(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof cr&&i instanceof cr||n instanceof ur&&i instanceof ur?Re(n.elements,i.elements,Sn):n instanceof Fr&&i instanceof Fr?Sn(n.Pe,i.Pe):n instanceof kr&&i instanceof kr);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Vr extends bs{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class zn extends bs{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function pu(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function gu(r,e,t){const n=new Map;pe(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,c=e.data.field(s.field);n.set(s.field,sm(a,c,t[i]))}return n}function yu(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,im(s,a,e))}return n}class zr extends bs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Yo extends bs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Qo{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&lm(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ii(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ii(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ou();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let c=this.applyToLocalView(a,s.mutatedFields);c=t.has(i.key)?null:c;const u=mu(a,c);null!==u&&n.set(i.key,u),a.isValidDocument()||a.convertToNoDocument(fe.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),bt())}isEqual(e){return this.batchId===e.batchId&&Re(this.mutations,e.mutations,(t,n)=>fu(t,n))&&Re(this.baseMutations,e.baseMutations,(t,n)=>fu(t,n))}}class Xo{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){pe(e.mutations.length===n.length);let i=function(){return tm}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new Xo(e,t,n,i)}}class Ho{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class um{constructor(e,t){this.count=e,this.unchangedNames=t}}var en,Mt;function xu(r){if(void 0===r)return at("GRPC error has no .code"),L.UNKNOWN;switch(r){case en.OK:return L.OK;case en.CANCELLED:return L.CANCELLED;case en.UNKNOWN:return L.UNKNOWN;case en.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case en.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case en.INTERNAL:return L.INTERNAL;case en.UNAVAILABLE:return L.UNAVAILABLE;case en.UNAUTHENTICATED:return L.UNAUTHENTICATED;case en.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case en.NOT_FOUND:return L.NOT_FOUND;case en.ALREADY_EXISTS:return L.ALREADY_EXISTS;case en.PERMISSION_DENIED:return L.PERMISSION_DENIED;case en.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case en.ABORTED:return L.ABORTED;case en.OUT_OF_RANGE:return L.OUT_OF_RANGE;case en.UNIMPLEMENTED:return L.UNIMPLEMENTED;case en.DATA_LOSS:return L.DATA_LOSS;default:return H()}}(Mt=en||(en={}))[Mt.OK=0]="OK",Mt[Mt.CANCELLED=1]="CANCELLED",Mt[Mt.UNKNOWN=2]="UNKNOWN",Mt[Mt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Mt[Mt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Mt[Mt.NOT_FOUND=5]="NOT_FOUND",Mt[Mt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Mt[Mt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Mt[Mt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Mt[Mt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Mt[Mt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Mt[Mt.ABORTED=10]="ABORTED",Mt[Mt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Mt[Mt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Mt[Mt.INTERNAL=13]="INTERNAL",Mt[Mt.UNAVAILABLE=14]="UNAVAILABLE",Mt[Mt.DATA_LOSS=15]="DATA_LOSS";const hm=new f([4294967295,4294967295],0);function Eu(r){const e=function Tu(){return new TextEncoder}().encode(r),t=new q;return t.update(e),new Uint8Array(t.digest())}function Iu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new f([t,n],0),new f([i,s],0)]}class Jo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new bi(`Invalid padding: ${t}`);if(n<0)throw new bi(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new bi(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new bi(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=f.fromNumber(this.Te)}Ee(e,t,n){let i=e.add(t.multiply(f.fromNumber(n)));return 1===i.compare(hm)&&(i=new f([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Eu(e),[n,i]=Iu(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Jo(s,i,t);return n.forEach(c=>a.insert(c)),a}insert(e){if(0===this.Te)return;const t=Eu(e),[n,i]=Iu(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class bi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ci{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Ai.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ci(fe.min(),i,new Gt(it),En(),bt())}}class Ai{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ai(n,t,bt(),bt(),bt())}}class As{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class bu{constructor(e,t){this.targetId=e,this.me=t}}class Cu{constructor(e,t,n=Qt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Au{constructor(){this.fe=0,this.ge=Su(),this.pe=Qt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=bt(),t=bt(),n=bt();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:H()}}),new Ai(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Su()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,pe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class dm{constructor(e){this.Le=e,this.Be=new Map,this.ke=En(),this.qe=Ss(),this.Qe=Ss(),this.Ke=new Gt(it)}$e(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.je(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.De(e.resumeToken));break;default:H()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,n=e.me.count,i=this.Ye(t);if(i){const s=i.target;if(ws(s))if(0===n){const a=new et(s.path);this.We(t,a,$t.newNoDocument(a,fe.min()))}else pe(1===n);else{const a=this.Ze(t);if(a!==n){const c=this.Xe(e),u=c?this.et(c,e,a):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,c;try{a=kn(n).toUint8Array()}catch(u){if(u instanceof Oc)return ie("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Jo(a,i,s)}catch(u){return ie(u instanceof bi?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===c.Te?null:c}et(e,t,n){return t.me.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.nt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.Be.forEach((s,a)=>{const c=this.Ye(a);if(c){if(s.current&&ws(c.target)){const u=new et(c.target.path);this.st(u).has(a)||this.ot(a,u)||this.We(a,u,$t.newNoDocument(u,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let n=bt();this.Qe.forEach((s,a)=>{let c=!0;a.forEachWhile(u=>{const p=this.Ye(u);return!p||"TargetPurposeLimboResolution"===p.purpose||(c=!1,!1)}),c&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new Ci(e,t,this.Ke,this.ke,n);return this.ke=En(),this.qe=Ss(),this.Qe=Ss(),this.Ke=new Gt(it),i}Ue(e,t){if(!this.je(e))return;const n=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const i=this.ze(e);this.ot(e,t)?i.Fe(t,1):i.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Be.get(e);return t||(t=new Au,this.Be.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new zt(it),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new zt(it),this.qe=this.qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||oe("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ut(e)}He(e){this.Be.set(e,new Au),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Ss(){return new Gt(et.comparator)}function Su(){return new Gt(et.comparator)}const _m={asc:"ASCENDING",desc:"DESCENDING"},mm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fm={and:"AND",or:"OR"};class pm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Zo(r,e){return r.useProto3Json||qt(e)?e:{value:e}}function Nr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ru(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function gm(r,e){return Nr(r,e.toTimestamp())}function Jt(r){return pe(!!r),fe.fromTimestamp(function(t){const n=Dn(t);return new Ue(n.seconds,n.nanos)}(r))}function ea(r,e){return ta(r,e).canonicalString()}function ta(r,e){const t=(i=r,new Je(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Ou(r){const e=Je.fromString(r);return pe(ju(e)),e}function Si(r,e){return ea(r.databaseId,e.path)}function On(r,e){const t=Ou(e);if(t.get(1)!==r.databaseId.projectId)throw new se(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new se(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new et(Du(t))}function Pu(r,e){return ea(r.databaseId,e)}function na(r){return new Je(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Du(r){return pe(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function ku(r,e,t){return{name:Si(r,e),fields:t.value.mapValue.fields}}function Vu(r,e){return{documents:[Pu(r,e.path)]}}function Rs(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Pu(r,i);const s=function(p){if(0!==p.length)return Bu(Nt.create(p,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(p){if(0!==p.length)return p.map(T=>{return{field:Yn((N=T).field),direction:Tm(N.dir)};var N})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=Zo(r,e.limit);return null!==c&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt={before:(p=e.startAt).inclusive,values:p.position}),e.endAt&&(t.structuredQuery.endAt=function(p){return{before:!p.inclusive,values:p.position}}(e.endAt)),{ct:t,parent:i};var p}function Nu(r){let e=function Mu(r){const e=Ou(r);return 4===e.length?Je.emptyPath():Du(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){pe(1===n);const T=t.from[0];T.allDescendants?i=T.collectionId:e=e.child(T.collectionId)}let s=[];t.where&&(s=function(C){const N=Lu(C);return N instanceof Nt&&jo(N)?N.getFilters():[N]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(N=>{return new gi(Lr((ke=N).field),function(Ge){switch(Ge){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(ke.direction));var ke}));let c=null;t.limit&&(c=function(C){let N;return N="object"==typeof C?C.value:C,qt(N)?null:N}(t.limit));let u=null;var C;t.startAt&&(u=new qn((C=t.startAt).values||[],!!C.before));let p=null;return t.endAt&&(p=function(C){return new qn(C.values||[],!C.before)}(t.endAt)),function Hc(r,e,t,n,i,s,a,c){return new Fn(r,e,t,n,i,s,a,c)}(e,i,a,s,c,"F",u,p)}function Lu(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Lr(t.unaryFilter.field);return Rt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Lr(t.unaryFilter.field);return Rt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Lr(t.unaryFilter.field);return Rt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Lr(t.unaryFilter.field);return Rt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return H()}}(r):void 0!==r.fieldFilter?Rt.create(Lr((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return H()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return Nt.create(t.compositeFilter.filters.map(n=>Lu(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return H()}}(t.compositeFilter.op))}(r):H();var t}function Tm(r){return _m[r]}function Em(r){return mm[r]}function Im(r){return fm[r]}function Yn(r){return{fieldPath:r.canonicalString()}}function Lr(r){return xt.fromServerFormat(r.fieldPath)}function Bu(r){return r instanceof Rt?function(t){if("=="===t.op){if(kc(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NAN"}};if(Dc(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(kc(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NOT_NAN"}};if(Dc(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yn(t.field),op:Em(t.op),value:t.value}}}(r):r instanceof Nt?function(t){const n=t.getFilters().map(i=>Bu(i));return 1===n.length?n[0]:{compositeFilter:{op:Im(t.op),filters:n}}}(r):H()}function bm(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ju(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class Nn{constructor(e,t,n,i,s=fe.min(),a=fe.min(),c=Qt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new Nn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Nn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Nn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Nn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Gu{constructor(e){this.ht=e}}function ia(r){const e=Nu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Ts(e,e.limit,"L"):e}class mr{constructor(){}Et(e,t){this.dt(e,t),t.At()}dt(e,t){if("nullValue"in e)this.Rt(t,5);else if("booleanValue"in e)this.Rt(t,10),t.Vt(e.booleanValue?1:0);else if("integerValue"in e)this.Rt(t,15),t.Vt(Wt(e.integerValue));else if("doubleValue"in e){const n=Wt(e.doubleValue);isNaN(n)?this.Rt(t,13):(this.Rt(t,15),wt(n)?t.Vt(0):t.Vt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Rt(t,20),"string"==typeof n&&(n=Dn(n)),t.ft(`${n.seconds||""}`),t.Vt(n.nanos||0)}else if("stringValue"in e)this.gt(e.stringValue,t),this.yt(t);else if("bytesValue"in e)this.Rt(t,30),t.wt(kn(e.bytesValue)),this.yt(t);else if("referenceValue"in e)this.St(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Rt(t,45),t.Vt(n.latitude||0),t.Vt(n.longitude||0)}else"mapValue"in e?Fc(e)?this.Rt(t,Number.MAX_SAFE_INTEGER):vs(e)?this.bt(e.mapValue,t):(this.Dt(e.mapValue,t),this.yt(t)):"arrayValue"in e?(this.vt(e.arrayValue,t),this.yt(t)):H()}gt(e,t){this.Rt(t,25),this.Ct(e,t)}Ct(e,t){t.ft(e)}Dt(e,t){const n=e.fields||{};this.Rt(t,55);for(const i of Object.keys(n))this.gt(i,t),this.dt(n[i],t)}bt(e,t){var n,i;const s=e.fields||{};this.Rt(t,53);const a="value",c=(null===(i=null===(n=s[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.Rt(t,15),t.Vt(Wt(c)),this.gt(a,t),this.dt(s[a],t)}vt(e,t){const n=e.values||[];this.Rt(t,50);for(const i of n)this.dt(i,t)}St(e,t){this.Rt(t,37),et.fromName(e).path.forEach(n=>{this.Rt(t,60),this.Ct(n,t)})}Rt(e,t){e.Vt(t)}yt(e){e.Vt(2)}}mr.Ft=new mr;class km{constructor(){this.ln=new ua}addToCollectionParentIndex(e,t){return this.ln.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(E.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(E.min())}updateCollectionGroup(e,t,n){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class ua{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new zt(Je.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new zt(Je.comparator)).toArray()}}new Uint8Array(0);const rh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class dn{static withCacheSize(e){return new dn(e,dn.DEFAULT_COLLECTION_PERCENTILE,dn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}dn.DEFAULT_COLLECTION_PERCENTILE=10,dn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dn.DEFAULT=new dn(41943040,dn.DEFAULT_COLLECTION_PERCENTILE,dn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dn.DISABLED=new dn(-1,0,0);class pr{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new pr(0)}static Qn(){return new pr(-1)}}function lh([r,e],[t,n]){const i=it(r,t);return 0===i?it(e,n):i}class zm{constructor(e){this.Gn=e,this.buffer=new zt(lh),this.zn=0}jn(){return++this.zn}Hn(e){const t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();lh(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ch{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return null!==this.Jn}Yn(e){var t=this;oe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,b.A)(function*(){t.Jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){Be(n)?oe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield xe(n)}yield t.Yn(3e5)}))}}class Nm{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return D.resolve(Ft.oe);const n=new zm(t);return this.Zn.forEachTarget(e,i=>n.Hn(i.sequenceNumber)).next(()=>this.Zn.er(e,i=>n.Hn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Zn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(oe("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(rh)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(oe("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rh):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let n,i,s,a,c,u,p;const T=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(C=>(C>this.params.maximumSequenceNumbersToCollect?(oe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${C}`),i=this.params.maximumSequenceNumbersToCollect):i=C,a=Date.now(),this.nthSequenceNumber(e,i))).next(C=>(n=C,c=Date.now(),this.removeTargets(e,n,t))).next(C=>(s=C,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(C=>(p=Date.now(),we()<=x.$b.DEBUG&&oe("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-T}ms\n\tDetermined least recently used ${i} in `+(c-a)+`ms\n\tRemoved ${s} targets in `+(u-c)+`ms\n\tRemoved ${C} documents in `+(p-u)+`ms\nTotal Duration: ${p-T}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:C})))}}class hh{constructor(){this.changes=new Vn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?D.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Gm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ph{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Ii(n.mutation,i,Tn.empty(),Ue.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,bt()).next(()=>n))}getLocalViewOfDocuments(e,t,n=bt()){const i=Rn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=xi();return s.forEach((c,u)=>{a=a.insert(c,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=Rn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,bt()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,n,i){let s=En();const a=Ti(),c=Ti();return t.forEach((u,p)=>{const T=n.get(p.key);i.has(p.key)&&(void 0===T||T.mutation instanceof zn)?s=s.insert(p.key,p):void 0!==T?(a.set(p.key,T.mutation.getFieldMask()),Ii(T.mutation,p,T.mutation.getFieldMask(),Ue.now())):a.set(p.key,Tn.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((p,T)=>a.set(p,T)),t.forEach((p,T)=>{var C;return c.set(p,new Gm(T,null!==(C=a.get(p))&&void 0!==C?C:null))}),c))}recalculateAndSaveOverlays(e,t){const n=Ti();let i=new Gt((a,c)=>a-c),s=bt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const c of a)c.keys().forEach(u=>{const p=t.get(u);if(null===p)return;let T=n.get(u)||Tn.empty();T=c.applyToLocalView(p,T),n.set(u,T);const C=(i.get(c.batchId)||bt()).add(u);i=i.insert(c.batchId,C)})}).next(()=>{const a=[],c=i.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),p=u.key,T=u.value,C=ou();T.forEach(N=>{if(!s.has(N)){const ue=mu(t.get(N),n.get(N));null!==ue&&C.set(N,ue),s=s.add(N)}}),a.push(this.documentOverlayCache.saveOverlays(e,p,C))}return D.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return et.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Uo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):D.resolve(Rn());let c=-1,u=s;return a.next(p=>D.forEach(p,(T,C)=>(c<C.largestBatchId&&(c=C.largestBatchId),s.get(T)?D.resolve():this.remoteDocumentCache.getEntry(e,T).next(N=>{u=u.insert(T,N)}))).next(()=>this.populateOverlays(e,p,s)).next(()=>this.computeViews(e,u,p,bt())).next(T=>({batchId:c,changes:su(T)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new et(t)).next(n=>{let i=xi();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=xi();return this.indexManager.getCollectionParents(e,s).next(c=>D.forEach(c,u=>{const p=(C=t,N=u.child(s),new Fn(N,null,C.explicitOrderBy.slice(),C.filters.slice(),C.limit,C.limitType,C.startAt,C.endAt));var C,N;return this.getDocumentsMatchingCollectionQuery(e,p,n,i).next(T=>{T.forEach((C,N)=>{a=a.insert(C,N)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((u,p)=>{const T=p.getKey();null===a.get(T)&&(a=a.insert(T,$t.newInvalidDocument(T)))});let c=xi();return a.forEach((u,p)=>{const T=s.get(u);void 0!==T&&Ii(T.mutation,p,Tn.empty(),Ue.now()),wi(t,p)&&(c=c.insert(u,p))}),c})}}class $m{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return D.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,{id:(i=t).id,version:i.version,createTime:Jt(i.createTime)}),D.resolve();var i}getNamedQuery(e,t){return D.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,{name:(i=t).name,query:ia(i.bundledQuery),readTime:Jt(i.readTime)}),D.resolve();var i}}class Um{constructor(){this.overlays=new Gt(et.comparator),this.Er=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Rn();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.Tt(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Er.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Er.delete(n)),D.resolve()}getOverlaysForCollection(e,t,n){const i=Rn(),s=t.length+1,a=new et(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,p=u.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return D.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Gt((p,T)=>p-T);const a=this.overlays.getIterator();for(;a.hasNext();){const p=a.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>n){let T=s.get(p.largestBatchId);null===T&&(T=Rn(),s=s.insert(p.largestBatchId,T)),T.set(p.getKey(),p)}}const c=Rn(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((p,T)=>c.set(p,T)),!(c.size()>=i)););return D.resolve(c)}Tt(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.Er.get(i.largestBatchId).delete(n.key);this.Er.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Ho(t,n));let s=this.Er.get(t);void 0===s&&(s=bt(),this.Er.set(t,s)),this.Er.set(t,s.add(n.key))}}class Wm{constructor(){this.sessionToken=Qt.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}class ha{constructor(){this.dr=new zt(sn.Ar),this.Rr=new zt(sn.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(e,t){const n=new sn(e,t);this.dr=this.dr.add(n),this.Rr=this.Rr.add(n)}mr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.gr(new sn(e,t))}pr(e,t){e.forEach(n=>this.removeReference(n,t))}yr(e){const t=new et(new Je([])),n=new sn(t,e),i=new sn(t,e+1),s=[];return this.Rr.forEachInRange([n,i],a=>{this.gr(a),s.push(a.key)}),s}wr(){this.dr.forEach(e=>this.gr(e))}gr(e){this.dr=this.dr.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const t=new et(new Je([])),n=new sn(t,e),i=new sn(t,e+1);let s=bt();return this.Rr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new sn(e,0),n=this.dr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sn{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return et.comparator(e.key,t.key)||it(e.br,t.br)}static Vr(e,t){return it(e.br,t.br)||et.comparator(e.key,t.key)}}class Km{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new zt(sn.Ar)}checkEmpty(e){return D.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Dr;this.Dr++;const a=new Qo(s,t,n,i);this.mutationQueue.push(a);for(const c of i)this.vr=this.vr.add(new sn(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Fr(t+1),s=i<0?0:i;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(0===this.mutationQueue.length?-1:this.Dr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new sn(t,0),i=new sn(t,Number.POSITIVE_INFINITY),s=[];return this.vr.forEachInRange([n,i],a=>{const c=this.Cr(a.br);s.push(c)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new zt(it);return t.forEach(i=>{const s=new sn(i,0),a=new sn(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([s,a],c=>{n=n.add(c.br)})}),D.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;et.isDocumentKey(s)||(s=s.child(""));const a=new sn(new et(s),0);let c=new zt(it);return this.vr.forEachWhile(u=>{const p=u.key.path;return!!n.isPrefixOf(p)&&(p.length===i&&(c=c.add(u.br)),!0)},a),D.resolve(this.Mr(c))}Mr(e){const t=[];return e.forEach(n=>{const i=this.Cr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){pe(0===this.Or(t.batchId,"removed")),this.mutationQueue.shift();let n=this.vr;return D.forEach(t.mutations,i=>{const s=new sn(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.vr=n})}Ln(e){}containsKey(e,t){const n=new sn(t,0),i=this.vr.firstAfterOrEqual(n);return D.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return D.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Cr(e){const t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class qm{constructor(e){this.Nr=e,this.docs=new Gt(et.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.Nr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return D.resolve(n?n.document.mutableCopy():$t.newInvalidDocument(t))}getEntries(e,t){let n=En();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():$t.newInvalidDocument(i))}),D.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=En();const a=t.path,c=new et(a.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:p,value:{document:T}}=u.getNext();if(!a.isPrefixOf(p.path))break;p.path.length>a.length+1||R(new E((r=T).readTime,r.key,-1),n)<=0||(i.has(T.key)||wi(t,T))&&(s=s.insert(T.key,T.mutableCopy()))}var r;return D.resolve(s)}getAllFromCollectionGroup(e,t,n,i){H()}Lr(e,t){return D.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Ym(this)}getSize(e){return D.resolve(this.size)}}class Ym extends hh{constructor(e){super(),this.hr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.hr.addEntry(e,i)):this.hr.removeEntry(n)}),D.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}}class Qm{constructor(e){this.persistence=e,this.Br=new Vn(t=>lr(t),yi),this.lastRemoteSnapshotVersion=fe.min(),this.highestTargetId=0,this.kr=0,this.qr=new ha,this.targetCount=0,this.Qr=pr.qn()}forEachTarget(e,t){return this.Br.forEach((n,i)=>t(i)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.kr&&(this.kr=t),D.resolve()}Un(e){this.Br.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Qr=new pr(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Un(t),D.resolve()}removeTargetData(e,t){return this.Br.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Br.forEach((a,c)=>{c.sequenceNumber<=t&&null===n.get(c.targetId)&&(this.Br.delete(a),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),D.waitFor(s).next(()=>i)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const n=this.Br.get(t)||null;return D.resolve(n)}addMatchingKeys(e,t,n){return this.qr.mr(t,n),D.resolve()}removeMatchingKeys(e,t,n){this.qr.pr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const n=this.qr.Sr(t);return D.resolve(n)}containsKey(e,t){return D.resolve(this.qr.containsKey(t))}}class da{constructor(e,t){this.Kr={},this.overlays={},this.$r=new Ft(0),this.Ur=!1,this.Ur=!0,this.Wr=new Wm,this.referenceDelegate=e(this),this.Gr=new Qm(this),this.indexManager=new km,this.remoteDocumentCache=new qm(n=>this.referenceDelegate.zr(n)),this.serializer=new Gu(t),this.jr=new $m(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Um,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Kr[e.toKey()];return n||(n=new Km(t,this.referenceDelegate),this.Kr[e.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,n){oe("MemoryPersistence","Starting transaction:",e);const i=new Xm(this.$r.next());return this.referenceDelegate.Hr(),n(i).next(s=>this.referenceDelegate.Jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Yr(e,t){return D.or(Object.values(this.Kr).map(n=>()=>n.containsKey(e,t)))}}class Xm extends U{constructor(e){super(),this.currentSequenceNumber=e}}class zs{constructor(e){this.persistence=e,this.Zr=new ha,this.Xr=null}static ei(e){return new zs(e)}get ti(){if(this.Xr)return this.Xr;throw H()}addReference(e,t,n){return this.Zr.addReference(n,t),this.ti.delete(n.toString()),D.resolve()}removeReference(e,t,n){return this.Zr.removeReference(n,t),this.ti.add(n.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),D.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(i=>this.ti.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.ti.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.ti,n=>{const i=et.fromPath(n);return this.ni(e,i).next(s=>{s||t.removeEntry(i,fe.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(n=>{n?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return D.or([()=>D.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}}class Ns{constructor(e,t){this.persistence=e,this.ri=new Vn(n=>function Vt(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=st(e)),e=W(r.get(t),e);return st(e)}(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=function uh(r,e){return new Nm(r,e)}(this,t)}static ei(e,t){return new Ns(e,t)}Hr(){}Jr(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){const t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}nr(e){let t=0;return this.er(e,n=>{t++}).next(()=>t)}er(e,t){return D.forEach(this.ri,(n,i)=>this.ir(e,n,i).next(s=>s?D.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Lr(e,a=>this.ir(e,a,t).next(c=>{c||(n++,s.removeEntry(a,fe.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),D.resolve()}removeReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),D.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=gs(e.data.value)),t}ir(e,t,n){return D.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.ri.get(t);return D.resolve(void 0!==i&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class pa{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Wi=n,this.Gi=i}static zi(e,t){let n=bt(),i=bt();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new pa(e,t.fromCache,n,i)}}class Jm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class yh{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=(0,v.nr)()?8:function mt(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,v.ZQ)())>0?6:4}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Xi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.es(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new Jm;return this.ts(e,t,a).next(c=>{if(s.result=c,this.Hi)return this.ns(e,t,a,c.size)})}).next(()=>s.result)}ns(e,t,n,i){return n.documentReadCount<this.Ji?(we()<=x.$b.DEBUG&&oe("QueryEngine","SDK will not create cache indexes for query:",Dr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),D.resolve()):(we()<=x.$b.DEBUG&&oe("QueryEngine","Query:",Dr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Yi*i?(we()<=x.$b.DEBUG&&oe("QueryEngine","The SDK decides to create cache indexes for query:",Dr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hn(t))):D.resolve())}Xi(e,t){if(Jc(t))return D.resolve(null);let n=hn(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Ts(t,null,"F"),n=hn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=bt(...s);return this.Zi.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{const p=this.rs(t,c);return this.ss(t,p,a,u.readTime)?this.Xi(e,Ts(t,null,"F")):this.os(e,p,t,u)}))})))}es(e,t,n,i){return Jc(t)||i.isEqual(fe.min())?D.resolve(null):this.Zi.getDocuments(e,n).next(s=>{const a=this.rs(t,s);return this.ss(t,a,n,i)?D.resolve(null):(we()<=x.$b.DEBUG&&oe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Dr(t)),this.os(e,a,t,function I(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=fe.fromTimestamp(1e9===n?new Ue(t+1,0):new Ue(t,n));return new E(i,et.empty(),e)}(i,-1)).next(c=>c))})}rs(e,t){let n=new zt(ru(e));return t.forEach((i,s)=>{wi(e,s)&&(n=n.add(s))}),n}ss(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ts(e,t,n){return we()<=x.$b.DEBUG&&oe("QueryEngine","Using full collection scan to execute query:",Dr(t)),this.Zi.getDocumentsMatchingQuery(e,t,E.min(),n)}os(e,t,n,i){return this.Zi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class Zm{constructor(e,t,n,i){this.persistence=e,this._s=t,this.serializer=i,this.us=new Gt(it),this.cs=new Vn(s=>lr(s),yi),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(n)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ph(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}}function wh(r,e){return ga.apply(this,arguments)}function ga(){return(ga=(0,b.A)(function*(r,e){const t=Ee(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.Ps(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],c=[];let u=bt();for(const p of i){a.push(p.batchId);for(const T of p.mutations)u=u.add(T.key)}for(const p of s){c.push(p.batchId);for(const T of p.mutations)u=u.add(T.key)}return t.localDocuments.getDocuments(n,u).next(p=>({Ts:p,removedBatchIds:a,addedBatchIds:c}))})})})).apply(this,arguments)}function xh(r){const e=Ee(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function nf(r,e){const t=Ee(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Wr(r,e,t){return ya.apply(this,arguments)}function ya(){return(ya=(0,b.A)(function*(r,e,t){const n=Ee(r),i=n.us.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Be(a))throw a;oe("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.us=n.us.remove(e),n.cs.delete(i.target)})).apply(this,arguments)}function Bs(r,e,t){const n=Ee(r);let i=fe.min(),s=bt();return n.persistence.runTransaction("Execute query","readwrite",a=>function(u,p,T){const C=Ee(u),N=C.cs.get(T);return void 0!==N?D.resolve(C.us.get(N)):C.Gr.getTargetData(p,T)}(n,a,hn(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,n.Gr.getMatchingKeysForTargetId(a,c.targetId).next(u=>{s=u})}).next(()=>n._s.getDocumentsMatchingQuery(a,e,t?i:fe.min(),t?s:bt())).next(c=>(function bh(r,e,t){let n=r.ls.get(e)||fe.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ls.set(e,n)}(n,function nu(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),c),{documents:c,ds:s})))}class Ea{constructor(){this.activeTargetIds=function Ko(){return rm}()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Sh{constructor(){this._o=new Ea,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,n){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new Ea,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class of{uo(e){}shutdown(){}}class Rh{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){oe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){oe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let $s=null;function ba(){return null===$s?$s=268435456+Math.round(2147483648*Math.random()):$s++,"0x"+$s.toString(16)}const af={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lf{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}const _n="WebChannelConnection";class cf extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Fo=n+"://"+t.host,this.Mo=`projects/${i}/databases/${s}`,this.xo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Oo(t,n,i,s,a){const c=ba(),u=this.No(t,n.toUriEncodedString());oe("RestConnection",`Sending RPC '${t}' ${c}:`,u,i);const p={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(p,s,a),this.Bo(t,u,p,i).then(T=>(oe("RestConnection",`Received RPC '${t}' ${c}: `,T),T),T=>{throw ie("RestConnection",`RPC '${t}' ${c} failed with error: `,T,"url: ",u,"request:",i),T})}ko(t,n,i,s,a,c){return this.Oo(t,n,i,s,a)}Lo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Te,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}No(t,n){return`${this.Fo}/v1/${n}:${af[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Bo(e,t,n,i){const s=ba();return new Promise((a,c)=>{const u=new de;u.setWithCredentials(!0),u.listenOnce(me.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case nt.NO_ERROR:const T=u.getResponseJson();oe(_n,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(T)),a(T);break;case nt.TIMEOUT:oe(_n,`RPC '${e}' ${s} timed out`),c(new se(L.DEADLINE_EXCEEDED,"Request time out"));break;case nt.HTTP_ERROR:const C=u.getStatus();if(oe(_n,`RPC '${e}' ${s} failed with status:`,C,"response text:",u.getResponseText()),C>0){let N=u.getResponseJson();Array.isArray(N)&&(N=N[0]);const ue=N?.error;if(ue&&ue.status&&ue.message){const ke=function(Ge){const _t=Ge.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(_t)>=0?_t:L.UNKNOWN}(ue.status);c(new se(ke,ue.message))}else c(new se(L.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new se(L.UNAVAILABLE,"Connection failed."));break;default:H()}}finally{oe(_n,`RPC '${e}' ${s} completed.`)}});const p=JSON.stringify(i);oe(_n,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",p,n,15)})}qo(e,t,n){const i=ba(),s=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=ve(),c=He(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;void 0!==p&&(u.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Lo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const T=s.join("");oe(_n,`Creating RPC '${e}' stream ${i}: ${T}`,u);const C=a.createWebChannel(T,u);let N=!1,ue=!1;const ke=new lf({Eo:Ge=>{ue?oe(_n,`Not sending because RPC '${e}' stream ${i} is closed:`,Ge):(N||(oe(_n,`Opening RPC '${e}' stream ${i} transport.`),C.open(),N=!0),oe(_n,`RPC '${e}' stream ${i} sending:`,Ge),C.send(Ge))},Ao:()=>C.close()}),Qe=(Ge,_t,yt)=>{Ge.listen(_t,ft=>{try{yt(ft)}catch(It){setTimeout(()=>{throw It},0)}})};return Qe(C,Ie.EventType.OPEN,()=>{ue||(oe(_n,`RPC '${e}' stream ${i} transport opened.`),ke.So())}),Qe(C,Ie.EventType.CLOSE,()=>{ue||(ue=!0,oe(_n,`RPC '${e}' stream ${i} transport closed`),ke.Do())}),Qe(C,Ie.EventType.ERROR,Ge=>{ue||(ue=!0,ie(_n,`RPC '${e}' stream ${i} transport errored:`,Ge),ke.Do(new se(L.UNAVAILABLE,"The operation could not be completed")))}),Qe(C,Ie.EventType.MESSAGE,Ge=>{var _t;if(!ue){const yt=Ge.data[0];pe(!!yt);const ft=yt,It=ft?.error||(null===(_t=ft[0])||void 0===_t?void 0:_t.error);if(It){oe(_n,`RPC '${e}' stream ${i} received error:`,It);const Dt=It.status;let Ct=function(Q){const re=en[Q];if(void 0!==re)return xu(re)}(Dt),ne=It.message;void 0===Ct&&(Ct=L.INTERNAL,ne="Unknown error status: "+Dt+" with message "+It.message),ue=!0,ke.Do(new se(Ct,ne)),C.close()}else oe(_n,`RPC '${e}' stream ${i} received:`,yt),ke.vo(yt)}}),Qe(c,rt.STAT_EVENT,Ge=>{Ge.stat===tt.PROXY?oe(_n,`RPC '${e}' stream ${i} detected buffering proxy`):Ge.stat===tt.NOPROXY&&oe(_n,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{ke.bo()},0),ke}}function Us(){return typeof document<"u"?document:null}function zi(r){return new pm(r,!0)}class Ca{constructor(e,t,n=1e3,i=1.5,s=6e4){this.li=e,this.timerId=t,this.Qo=n,this.Ko=i,this.$o=s,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const t=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),i=Math.max(0,t-n);i>0&&oe("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){null!==this.Wo&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){null!==this.Wo&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}class Ph{constructor(e,t,n,i,s,a,c,u){this.li=e,this.Yo=n,this.Zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new Ca(e,t)}i_(){return 1===this.state||5===this.state||this.s_()}s_(){return 2===this.state||3===this.state}start(){this.n_=0,4!==this.state?this.auth():this.o_()}stop(){var e=this;return(0,b.A)(function*(){e.i_()&&(yield e.close(0))})()}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&null===this.e_&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}u_(){var e=this;return(0,b.A)(function*(){if(e.s_())return e.close(0)})()}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(e,t){var n=this;return(0,b.A)(function*(){n.l_(),n.h_(),n.r_.cancel(),n.Xo++,4!==e?n.r_.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(at(t.toString()),at("Using maximum backoff delay to prevent overloading the backend."),n.r_.zo()):t&&t.code===L.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.P_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.po(t)})()}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Xo===t&&this.I_(n,i)},n=>{e(()=>{const i=new se(L.UNKNOWN,"Fetching auth token failed: "+n.message);return this.E_(i)})})}I_(e,t){const n=this.T_(this.Xo);this.stream=this.d_(e,t),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{n(()=>this.E_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.n_?this.A_(i):this.onNext(i))})}o_(){var e=this;this.state=5,this.r_.jo((0,b.A)(function*(){e.state=0,e.start()}))}E_(e){return oe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(oe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class uf extends Ph{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}d_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const t=function vm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(p=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:H(),i=e.targetChange.targetIds||[],s=function(p,T){return p.useProto3Json?(pe(void 0===T||"string"==typeof T),Qt.fromBase64String(T||"")):(pe(void 0===T||T instanceof Buffer||T instanceof Uint8Array),Qt.fromUint8Array(T||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(p){const T=void 0===p.code?L.UNKNOWN:xu(p.code);return new se(T,p.message||"")}(a);t=new Cu(n,i,s,c||null)}else if("documentChange"in e){const n=e.documentChange,i=On(r,n.document.name),s=Jt(n.document.updateTime),a=n.document.createTime?Jt(n.document.createTime):fe.min(),c=new ln({mapValue:{fields:n.document.fields}}),u=$t.newFoundDocument(i,s,a,c);t=new As(n.targetIds||[],n.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const n=e.documentDelete,i=On(r,n.document),s=n.readTime?Jt(n.readTime):fe.min(),a=$t.newNoDocument(i,s);t=new As([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=On(r,n.document);t=new As([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return H();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new um(i,s);t=new bu(n.targetId,a)}}var p;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return fe.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?fe.min():a.readTime?Jt(a.readTime):fe.min()}(e);return this.listener.R_(t,n)}V_(e){const t={};t.database=na(this.serializer),t.addTarget=function(s,a){let c;const u=a.target;if(c=ws(u)?{documents:Vu(s,u)}:{query:Rs(s,u).ct},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Ru(s,a.resumeToken);const p=Zo(s,a.expectedCount);null!==p&&(c.expectedCount=p)}else if(a.snapshotVersion.compareTo(fe.min())>0){c.readTime=Nr(s,a.snapshotVersion.toTimestamp());const p=Zo(s,a.expectedCount);null!==p&&(c.expectedCount=p)}return c}(this.serializer,e);const n=function xm(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return H()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.c_(t)}m_(e){const t={};t.database=na(this.serializer),t.removeTarget=e,this.c_(t)}}class hf extends Ph{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(e,t){return this.connection.qo("Write",e,t)}A_(e){return pe(!!e.streamToken),this.lastStreamToken=e.streamToken,pe(!e.writeResults||0===e.writeResults.length),this.listener.p_()}onNext(e){pe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const t=function wm(r,e){return r&&r.length>0?(pe(void 0!==e),r.map(t=>function(i,s){let a=Jt(i.updateTime?i.updateTime:s);return a.isEqual(fe.min())&&(a=Jt(s)),new am(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Jt(e.commitTime);return this.listener.y_(n,t)}w_(){const e={};e.database=na(this.serializer),this.c_(e)}g_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Ri(r,e){let t;if(e instanceof Vr)t={update:ku(r,e.key,e.value)};else if(e instanceof zr)t={delete:Si(r,e.key)};else if(e instanceof zn)t={update:ku(r,e.key,e.data),updateMask:bm(e.fieldMask)};else{if(!(e instanceof Yo))return H();t={verify:Si(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const c=a.transform;if(c instanceof kr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof cr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof ur)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Fr)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw H()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:gm(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:H()),t;var s}(this.serializer,n))};this.c_(t)}}class df extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new se(L.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,n,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Oo(e,ta(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new se(L.UNKNOWN,s.toString())})}ko(e,t,n,i,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.ko(e,ta(t,n),i,a,c,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new se(L.UNKNOWN,a.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class _f{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){0===this.D_&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){"Online"===this.state?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,"Online"===e&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(at(t),this.C_=!1):oe("OnlineStateTracker",t)}N_(){null!==this.v_&&(this.v_.cancel(),this.v_=null)}}class mf{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=s,this.Q_.uo(c=>{n.enqueueAndForget((0,b.A)(function*(){var u;Jn(a)&&(oe("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,b.A)(function*(T){const C=Ee(T);C.k_.add(4),yield Kr(C),C.K_.set("Unknown"),C.k_.delete(4),yield Ni(C)}),function p(T){return u.apply(this,arguments)})(a))}))}),this.K_=new _f(n,i)}}function Ni(r){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,b.A)(function*(r){if(Jn(r))for(const e of r.q_)yield e(!0)})).apply(this,arguments)}function Kr(r){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,b.A)(function*(r){for(const e of r.q_)yield e(!1)})).apply(this,arguments)}function Ws(r,e){const t=Ee(r);t.B_.has(e.targetId)||(t.B_.set(e.targetId,e),Pa(t)?Oa(t):Qr(t).s_()&&Ra(t,e))}function qr(r,e){const t=Ee(r),n=Qr(t);t.B_.delete(e),n.s_()&&Mh(t,e),0===t.B_.size&&(n.s_()?n.a_():Jn(t)&&t.K_.set("Unknown"))}function Ra(r,e){if(r.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(fe.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qr(r).V_(e)}function Mh(r,e){r.U_.xe(e),Qr(r).m_(e)}function Oa(r){r.U_=new dm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>r.B_.get(e)||null,nt:()=>r.datastore.serializer.databaseId}),Qr(r).start(),r.K_.F_()}function Pa(r){return Jn(r)&&!Qr(r).i_()&&r.B_.size>0}function Jn(r){return 0===Ee(r).k_.size}function Dh(r){r.U_=void 0}function ff(r){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,b.A)(function*(r){r.K_.set("Online")})).apply(this,arguments)}function pf(r){return Da.apply(this,arguments)}function Da(){return(Da=(0,b.A)(function*(r){r.B_.forEach((e,t)=>{Ra(r,e)})})).apply(this,arguments)}function gf(r,e){return ka.apply(this,arguments)}function ka(){return(ka=(0,b.A)(function*(r,e){Dh(r),Pa(r)?(r.K_.O_(e),Oa(r)):r.K_.set("Unknown")})).apply(this,arguments)}function yf(r,e,t){return Fa.apply(this,arguments)}function Fa(){return Fa=(0,b.A)(function*(r,e,t){if(r.K_.set("Online"),e instanceof Cu&&2===e.state&&e.cause)try{yield(n=(0,b.A)(function*(s,a){const c=a.cause;for(const u of a.targetIds)s.B_.has(u)&&(yield s.remoteSyncer.rejectListen(u,c),s.B_.delete(u),s.U_.removeTarget(u))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){oe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Ks(r,n)}else if(e instanceof As?r.U_.$e(e):e instanceof bu?r.U_.Je(e):r.U_.Ge(e),!t.isEqual(fe.min()))try{const n=yield xh(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const c=s.U_.it(a);return c.targetChanges.forEach((u,p)=>{if(u.resumeToken.approximateByteSize()>0){const T=s.B_.get(p);T&&s.B_.set(p,T.withResumeToken(u.resumeToken,a))}}),c.targetMismatches.forEach((u,p)=>{const T=s.B_.get(u);if(!T)return;s.B_.set(u,T.withResumeToken(Qt.EMPTY_BYTE_STRING,T.snapshotVersion)),Mh(s,u);const C=new Nn(T.target,u,p,T.sequenceNumber);Ra(s,C)}),s.remoteSyncer.applyRemoteEvent(c)}(r,t))}catch(n){oe("RemoteStore","Failed to raise snapshot:",n),yield Ks(r,n)}var n}),Fa.apply(this,arguments)}function Ks(r,e,t){return Va.apply(this,arguments)}function Va(){return(Va=(0,b.A)(function*(r,e,t){if(!Be(e))throw e;r.k_.add(1),yield Kr(r),r.K_.set("Offline"),t||(t=()=>xh(r.localStore)),r.asyncQueue.enqueueRetryable((0,b.A)(function*(){oe("RemoteStore","Retrying IndexedDB access"),yield t(),r.k_.delete(1),yield Ni(r)}))})).apply(this,arguments)}function kh(r,e){return e().catch(t=>Ks(r,t,e))}function Yr(r){return za.apply(this,arguments)}function za(){return(za=(0,b.A)(function*(r){const e=Ee(r),t=Zn(e);let n=e.L_.length>0?e.L_[e.L_.length-1].batchId:-1;for(;vf(e);)try{const i=yield nf(e.localStore,n);if(null===i){0===e.L_.length&&t.a_();break}n=i.batchId,wf(e,i)}catch(i){yield Ks(e,i)}Fh(e)&&Vh(e)})).apply(this,arguments)}function vf(r){return Jn(r)&&r.L_.length<10}function wf(r,e){r.L_.push(e);const t=Zn(r);t.s_()&&t.f_&&t.g_(e.mutations)}function Fh(r){return Jn(r)&&!Zn(r).i_()&&r.L_.length>0}function Vh(r){Zn(r).start()}function xf(r){return Na.apply(this,arguments)}function Na(){return(Na=(0,b.A)(function*(r){Zn(r).w_()})).apply(this,arguments)}function Tf(r){return La.apply(this,arguments)}function La(){return(La=(0,b.A)(function*(r){const e=Zn(r);for(const t of r.L_)e.g_(t.mutations)})).apply(this,arguments)}function Ef(r,e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,b.A)(function*(r,e,t){const n=r.L_.shift(),i=Xo.from(n,e,t);yield kh(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Yr(r)})).apply(this,arguments)}function If(r,e){return ja.apply(this,arguments)}function ja(){return ja=(0,b.A)(function*(r,e){var t;e&&Zn(r).f_&&(yield(t=(0,b.A)(function*(i,s){if(function wu(r){switch(r){default:return H();case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0}}(c=s.code)&&c!==L.ABORTED){const a=i.L_.shift();Zn(i).__(),yield kh(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield Yr(i)}var c}),function n(i,s){return t.apply(this,arguments)})(r,e)),Fh(r)&&Vh(r)}),ja.apply(this,arguments)}function zh(r,e){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,b.A)(function*(r,e){const t=Ee(r);t.asyncQueue.verifyOperationInProgress(),oe("RemoteStore","RemoteStore received new credentials");const n=Jn(t);t.k_.add(3),yield Kr(t),n&&t.K_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),yield Ni(t)})).apply(this,arguments)}function $a(r,e){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,b.A)(function*(r,e){const t=Ee(r);e?(t.k_.delete(2),yield Ni(t)):e||(t.k_.add(2),yield Kr(t),t.K_.set("Unknown"))})).apply(this,arguments)}function Qr(r){return r.W_||(r.W_=function(t,n,i){const s=Ee(t);return s.b_(),new uf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Ro:ff.bind(null,r),mo:pf.bind(null,r),po:gf.bind(null,r),R_:yf.bind(null,r)}),r.q_.push(function(){var e=(0,b.A)(function*(t){t?(r.W_.__(),Pa(r)?Oa(r):r.K_.set("Unknown")):(yield r.W_.stop(),Dh(r))});return function(t){return e.apply(this,arguments)}}())),r.W_}function Zn(r){return r.G_||(r.G_=function(t,n,i){const s=Ee(t);return s.b_(),new hf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Ro:()=>Promise.resolve(),mo:xf.bind(null,r),po:If.bind(null,r),p_:Tf.bind(null,r),y_:Ef.bind(null,r)}),r.q_.push(function(){var e=(0,b.A)(function*(t){t?(r.G_.__(),yield Yr(r)):(yield r.G_.stop(),r.L_.length>0&&(oe("RemoteStore",`Stopping write stream with ${r.L_.length} pending writes`),r.L_=[]))});return function(t){return e.apply(this,arguments)}}())),r.G_}class Wa{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,c=new Wa(e,t,a,i,s);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new se(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xr(r,e){if(at("AsyncQueue",`${e}: ${r}`),Be(r))return new se(L.UNAVAILABLE,`${e}: ${r}`);throw r}class Hr{static emptySet(e){return new Hr(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||et.comparator(t.key,n.key):(t,n)=>et.comparator(t.key,n.key),this.keyedMap=xi(),this.sortedSet=new Gt(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Hr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Hr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Nh{constructor(){this.z_=new Gt(et.comparator)}track(e){const t=e.doc.key,n=this.z_.get(t);n?0!==e.type&&3===n.type?this.z_=this.z_.insert(t,e):3===e.type&&1!==n.type?this.z_=this.z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.z_=this.z_.remove(t):1===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):H():this.z_=this.z_.insert(t,e)}j_(){const e=[];return this.z_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Jr{constructor(e,t,n,i,s,a,c,u,p){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=p}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new Jr(e,t,Hr.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&vi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class bf{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class Cf{constructor(){this.queries=Lh(),this.onlineState="Unknown",this.X_=new Set}terminate(){!function(t,n){const i=Ee(t),s=i.queries;i.queries=Lh(),s.forEach((a,c)=>{for(const u of c.J_)u.onError(n)})}(this,new se(L.ABORTED,"Firestore shutting down"))}}function Lh(){return new Vn(r=>tu(r),vi)}function Ka(r,e){return qa.apply(this,arguments)}function qa(){return(qa=(0,b.A)(function*(r,e){const t=Ee(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.Y_()&&e.Z_()&&(n=2):(s=new bf,n=e.Z_()?0:1);try{switch(n){case 0:s.H_=yield t.onListen(i,!0);break;case 1:s.H_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const c=Xr(a,`Initialization of query '${Dr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.J_.push(e),e.ea(t.onlineState),s.H_&&e.ta(s.H_)&&Xa(t)})).apply(this,arguments)}function Ya(r,e){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,b.A)(function*(r,e){const t=Ee(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.J_.indexOf(e);a>=0&&(s.J_.splice(a,1),0===s.J_.length?i=e.Z_()?0:1:!s.Y_()&&e.Z_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function Af(r,e){const t=Ee(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const c of a.J_)c.ta(i)&&(n=!0);a.H_=i}}n&&Xa(t)}function Sf(r,e,t){const n=Ee(r),i=n.queries.get(e);if(i)for(const s of i.J_)s.onError(t);n.queries.delete(e)}function Xa(r){r.X_.forEach(e=>{e.next()})}var Ha,Bh;(Bh=Ha||(Ha={})).na="default",Bh.Cache="cache";class Ja{constructor(e,t,n){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new Jr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){return!e.fromCache||!this.Z_()||(!this.options.ua||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}oa(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}aa(e){e=Jr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==Ha.Cache}}class $h{constructor(e){this.key=e}}class Uh{constructor(e){this.key=e}}class Wh{constructor(e,t){this.query=e,this.da=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=bt(),this.mutatedKeys=bt(),this.Va=ru(e),this.ma=new Hr(this.Va)}get fa(){return this.da}ga(e,t){const n=t?t.pa:new Nh,i=t?t.ma:this.ma;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,p="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((T,C)=>{const N=i.get(T),ue=wi(this.query,C)?C:null,ke=!!N&&this.mutatedKeys.has(N.key),Qe=!!ue&&(ue.hasLocalMutations||this.mutatedKeys.has(ue.key)&&ue.hasCommittedMutations);let Ge=!1;N&&ue?N.data.isEqual(ue.data)?ke!==Qe&&(n.track({type:3,doc:ue}),Ge=!0):this.ya(N,ue)||(n.track({type:2,doc:ue}),Ge=!0,(u&&this.Va(ue,u)>0||p&&this.Va(ue,p)<0)&&(c=!0)):!N&&ue?(n.track({type:0,doc:ue}),Ge=!0):N&&!ue&&(n.track({type:1,doc:N}),Ge=!0,(u||p)&&(c=!0)),Ge&&(ue?(a=a.add(ue),s=Qe?s.add(T):s.delete(T)):(a=a.delete(T),s=s.delete(T)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const T="F"===this.query.limitType?a.last():a.first();a=a.delete(T.key),s=s.delete(T.key),n.track({type:1,doc:T})}return{ma:a,pa:n,ss:c,mutatedKeys:s}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const a=e.pa.j_();a.sort((T,C)=>function(ue,ke){const Qe=Ge=>{switch(Ge){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return H()}};return Qe(ue)-Qe(ke)}(T.type,C.type)||this.Va(T.doc,C.doc)),this.wa(n),i=null!=i&&i;const c=t&&!i?this.Sa():[],u=0===this.Ra.size&&this.current&&!i?1:0,p=u!==this.Aa;return this.Aa=u,0!==a.length||p?{snapshot:new Jr(this.query,e.ma,s,a,e.mutatedKeys,0===u,p,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:c}:{ba:c}}ea(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ma:this.ma,pa:new Nh,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.da.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.da=this.da.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.da=this.da.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=bt(),this.ma.forEach(n=>{this.Da(n.key)&&(this.Ra=this.Ra.add(n.key))});const t=[];return e.forEach(n=>{this.Ra.has(n)||t.push(new Uh(n))}),this.Ra.forEach(n=>{e.has(n)||t.push(new $h(n))}),t}va(e){this.da=e.ds,this.Ra=bt();const t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return Jr.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,0===this.Aa,this.hasCachedResults)}}class Pf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Mf{constructor(e){this.key=e,this.Fa=!1}}class Df{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ma={},this.xa=new Vn(c=>tu(c),vi),this.Oa=new Map,this.Na=new Set,this.La=new Gt(et.comparator),this.Ba=new Map,this.ka=new ha,this.qa={},this.Qa=new Map,this.Ka=pr.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return!0===this.$a}}function kf(r,e){return Za.apply(this,arguments)}function Za(){return(Za=(0,b.A)(function*(r,e,t=!0){const n=qs(r);let i;const s=n.xa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Ca()):i=yield Kh(n,e,t,!0),i})).apply(this,arguments)}function Ff(r,e){return el.apply(this,arguments)}function el(){return(el=(0,b.A)(function*(r,e){const t=qs(r);yield Kh(t,e,!0,!1)})).apply(this,arguments)}function Kh(r,e,t,n){return tl.apply(this,arguments)}function tl(){return(tl=(0,b.A)(function*(r,e,t,n){const i=yield function Ur(r,e){const t=Ee(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Gr.getTargetData(n,e).next(s=>s?(i=s,D.resolve(i)):t.Gr.allocateTargetId(n).next(a=>(i=new Nn(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Gr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.us.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.us=t.us.insert(n.targetId,n),t.cs.set(e,n.targetId)),n})}(r.localStore,hn(e)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,t);let c;return n&&(c=yield function nl(r,e,t,n,i){return rl.apply(this,arguments)}(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Ws(r.remoteStore,i),c})).apply(this,arguments)}function rl(){return rl=(0,b.A)(function*(r,e,t,n,i){r.Ua=(C,N,ue)=>{return(ke=(0,b.A)(function*(Ge,_t,yt,ft){let It=_t.view.ga(yt);It.ss&&(It=yield Bs(Ge.localStore,_t.query,!1).then(({documents:j})=>_t.view.ga(j,It)));const Dt=ft&&ft.targetChanges.get(_t.targetId),Ct=ft&&null!=ft.targetMismatches.get(_t.targetId),ne=_t.view.applyChanges(It,Ge.isPrimaryClient,Dt,Ct);return ml(Ge,_t.targetId,ne.ba),ne.snapshot}),function Qe(Ge,_t,yt,ft){return ke.apply(this,arguments)})(r,C,N,ue);var ke};const s=yield Bs(r.localStore,e,!0),a=new Wh(e,s.ds),c=a.ga(s.documents),u=Ai.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),p=a.applyChanges(c,r.isPrimaryClient,u);ml(r,t,p.ba);const T=new Pf(e,t,a);return r.xa.set(e,T),r.Oa.has(t)?r.Oa.get(t).push(e):r.Oa.set(t,[e]),p.snapshot}),rl.apply(this,arguments)}function Vf(r,e,t){return il.apply(this,arguments)}function il(){return(il=(0,b.A)(function*(r,e,t){const n=Ee(r),i=n.xa.get(e),s=n.Oa.get(i.targetId);if(s.length>1)return n.Oa.set(i.targetId,s.filter(a=>!vi(a,e))),void n.xa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Wr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&qr(n.remoteStore,i.targetId),Zr(n,i.targetId)}).catch(xe))):(Zr(n,i.targetId),yield Wr(n.localStore,i.targetId,!0))})).apply(this,arguments)}function zf(r,e){return sl.apply(this,arguments)}function sl(){return(sl=(0,b.A)(function*(r,e){const t=Ee(r),n=t.xa.get(e),i=t.Oa.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),qr(t.remoteStore,n.targetId))})).apply(this,arguments)}function ol(){return(ol=(0,b.A)(function*(r,e,t){const n=function bl(r){const e=Ee(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Bf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jf.bind(null,e),e}(r);try{const i=yield function(a,c){const u=Ee(a),p=Ue.now(),T=c.reduce((ue,ke)=>ue.add(ke.key),bt());let C,N;return u.persistence.runTransaction("Locally write mutations","readwrite",ue=>{let ke=En(),Qe=bt();return u.hs.getEntries(ue,T).next(Ge=>{ke=Ge,ke.forEach((_t,yt)=>{yt.isValidDocument()||(Qe=Qe.add(_t))})}).next(()=>u.localDocuments.getOverlayedDocuments(ue,ke)).next(Ge=>{C=Ge;const _t=[];for(const yt of c){const ft=cm(yt,C.get(yt.key).overlayedDocument);null!=ft&&_t.push(new zn(yt.key,ft,Lc(ft.value.mapValue),Kt.exists(!0)))}return u.mutationQueue.addMutationBatch(ue,p,_t,c)}).next(Ge=>{N=Ge;const _t=Ge.applyToLocalDocumentSet(C,Qe);return u.documentOverlayCache.saveOverlays(ue,Ge.batchId,_t)})}).then(()=>({batchId:N.batchId,changes:su(C)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,c,u){let p=a.qa[a.currentUser.toKey()];p||(p=new Gt(it)),p=p.insert(c,u),a.qa[a.currentUser.toKey()]=p}(n,i.batchId,t),yield Ln(n,i.changes),yield Yr(n.remoteStore)}catch(i){const s=Xr(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function qh(r,e){return al.apply(this,arguments)}function al(){return(al=(0,b.A)(function*(r,e){const t=Ee(r);try{const n=yield function tf(r,e){const t=Ee(r),n=e.snapshotVersion;let i=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.hs.newChangeBuffer({trackRemovals:!0});i=t.us;const c=[];e.targetChanges.forEach((T,C)=>{const N=i.get(C);if(!N)return;c.push(t.Gr.removeMatchingKeys(s,T.removedDocuments,C).next(()=>t.Gr.addMatchingKeys(s,T.addedDocuments,C)));let ue=N.withSequenceNumber(s.currentSequenceNumber);var Qe,Ge,_t;null!==e.targetMismatches.get(C)?ue=ue.withResumeToken(Qt.EMPTY_BYTE_STRING,fe.min()).withLastLimboFreeSnapshotVersion(fe.min()):T.resumeToken.approximateByteSize()>0&&(ue=ue.withResumeToken(T.resumeToken,n)),i=i.insert(C,ue),Ge=ue,_t=T,(0===(Qe=N).resumeToken.approximateByteSize()||Ge.snapshotVersion.toMicroseconds()-Qe.snapshotVersion.toMicroseconds()>=3e8||_t.addedDocuments.size+_t.modifiedDocuments.size+_t.removedDocuments.size>0)&&c.push(t.Gr.updateTargetData(s,ue))});let u=En(),p=bt();if(e.documentUpdates.forEach(T=>{e.resolvedLimboDocuments.has(T)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,T))}),c.push(function Th(r,e,t){let n=bt(),i=bt();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=En();return t.forEach((c,u)=>{const p=s.get(c);u.isFoundDocument()!==p.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(fe.min())?(e.removeEntry(c,u.readTime),a=a.insert(c,u)):!p.isValidDocument()||u.version.compareTo(p.version)>0||0===u.version.compareTo(p.version)&&p.hasPendingWrites?(e.addEntry(u),a=a.insert(c,u)):oe("LocalStore","Ignoring outdated watch update for ",c,". Current version:",p.version," Watch version:",u.version)}),{Is:a,Es:i}})}(s,a,e.documentUpdates).next(T=>{u=T.Is,p=T.Es})),!n.isEqual(fe.min())){const T=t.Gr.getLastRemoteSnapshotVersion(s).next(C=>t.Gr.setTargetsMetadata(s,s.currentSequenceNumber,n));c.push(T)}return D.waitFor(c).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,p)).next(()=>u)}).then(s=>(t.us=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Ba.get(s);a&&(pe(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Fa=!0:i.modifiedDocuments.size>0?pe(a.Fa):i.removedDocuments.size>0&&(pe(a.Fa),a.Fa=!1))}),yield Ln(t,n,e)}catch(n){yield xe(n)}})).apply(this,arguments)}function Yh(r,e,t){const n=Ee(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.xa.forEach((s,a)=>{const c=a.view.ea(e);c.snapshot&&i.push(c.snapshot)}),function(a,c){const u=Ee(a);u.onlineState=c;let p=!1;u.queries.forEach((T,C)=>{for(const N of C.J_)N.ea(c)&&(p=!0)}),p&&Xa(u)}(n.eventManager,e),i.length&&n.Ma.R_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Lf(r,e,t){return ll.apply(this,arguments)}function ll(){return(ll=(0,b.A)(function*(r,e,t){const n=Ee(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Ba.get(e),s=i&&i.key;if(s){let a=new Gt(et.comparator);a=a.insert(s,$t.newNoDocument(s,fe.min()));const c=bt().add(s),u=new Ci(fe.min(),new Map,new Gt(it),a,c);yield qh(n,u),n.La=n.La.remove(s),n.Ba.delete(e),fl(n)}else yield Wr(n.localStore,e,!1).then(()=>Zr(n,e,t)).catch(xe)})).apply(this,arguments)}function Bf(r,e){return cl.apply(this,arguments)}function cl(){return(cl=(0,b.A)(function*(r,e){const t=Ee(r),n=e.batch.batchId;try{const i=yield function ef(r,e){const t=Ee(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.hs.newChangeBuffer({trackRemovals:!0});return function(c,u,p,T){const C=p.batch,N=C.keys();let ue=D.resolve();return N.forEach(ke=>{ue=ue.next(()=>T.getEntry(u,ke)).next(Qe=>{const Ge=p.docVersions.get(ke);pe(null!==Ge),Qe.version.compareTo(Ge)<0&&(C.applyToRemoteDocument(Qe,p),Qe.isValidDocument()&&(Qe.setReadTime(p.commitVersion),T.addEntry(Qe)))})}),ue.next(()=>c.mutationQueue.removeMutationBatch(u,C))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=bt();for(let p=0;p<c.mutationResults.length;++p)c.mutationResults[p].transformResults.length>0&&(u=u.add(c.batch.mutations[p].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);_l(t,n,null),dl(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Ln(t,i)}catch(i){yield xe(i)}})).apply(this,arguments)}function jf(r,e,t){return ul.apply(this,arguments)}function ul(){return(ul=(0,b.A)(function*(r,e,t){const n=Ee(r);try{const i=yield function(a,c){const u=Ee(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",p=>{let T;return u.mutationQueue.lookupMutationBatch(p,c).next(C=>(pe(null!==C),T=C.keys(),u.mutationQueue.removeMutationBatch(p,C))).next(()=>u.mutationQueue.performConsistencyCheck(p)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(p,T,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,T)).next(()=>u.localDocuments.getDocuments(p,T))})}(n.localStore,e);_l(n,e,t),dl(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Ln(n,i)}catch(i){yield xe(i)}})).apply(this,arguments)}function dl(r,e){(r.Qa.get(e)||[]).forEach(t=>{t.resolve()}),r.Qa.delete(e)}function _l(r,e,t){const n=Ee(r);let i=n.qa[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.qa[n.currentUser.toKey()]=i}}function Zr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Oa.get(e))r.xa.delete(n),t&&r.Ma.Wa(n,t);r.Oa.delete(e),r.isPrimaryClient&&r.ka.yr(e).forEach(n=>{r.ka.containsKey(n)||Qh(r,n)})}function Qh(r,e){r.Na.delete(e.path.canonicalString());const t=r.La.get(e);null!==t&&(qr(r.remoteStore,t),r.La=r.La.remove(e),r.Ba.delete(t),fl(r))}function ml(r,e,t){for(const n of t)n instanceof $h?(r.ka.addReference(n.key,e),$f(r,n)):n instanceof Uh?(oe("SyncEngine","Document no longer in limbo: "+n.key),r.ka.removeReference(n.key,e),r.ka.containsKey(n.key)||Qh(r,n.key)):H()}function $f(r,e){const t=e.key,n=t.path.canonicalString();r.La.get(t)||r.Na.has(n)||(oe("SyncEngine","New document in limbo: "+t),r.Na.add(n),fl(r))}function fl(r){for(;r.Na.size>0&&r.La.size<r.maxConcurrentLimboResolutions;){const e=r.Na.values().next().value;r.Na.delete(e);const t=new et(Je.fromString(e)),n=r.Ka.next();r.Ba.set(n,new Mf(t)),r.La=r.La.insert(t,n),Ws(r.remoteStore,new Nn(hn(Pr(t.path)),n,"TargetPurposeLimboResolution",Ft.oe))}}function Ln(r,e,t){return pl.apply(this,arguments)}function pl(){return pl=(0,b.A)(function*(r,e,t){const n=Ee(r),i=[],s=[],a=[];var c;n.xa.isEmpty()||(n.xa.forEach((c,u)=>{a.push(n.Ua(u,e,t).then(p=>{var T;if((p||t)&&n.isPrimaryClient){const C=p?!p.fromCache:null===(T=t?.targetChanges.get(u.targetId))||void 0===T?void 0:T.current;n.sharedClientState.updateQueryState(u.targetId,C?"current":"not-current")}if(p){i.push(p);const C=pa.zi(u.targetId,p);s.push(C)}}))}),yield Promise.all(a),n.Ma.R_(i),yield(c=(0,b.A)(function*(p,T){const C=Ee(p);try{yield C.persistence.runTransaction("notifyLocalViewChanges","readwrite",N=>D.forEach(T,ue=>D.forEach(ue.Wi,ke=>C.persistence.referenceDelegate.addReference(N,ue.targetId,ke)).next(()=>D.forEach(ue.Gi,ke=>C.persistence.referenceDelegate.removeReference(N,ue.targetId,ke)))))}catch(N){if(!Be(N))throw N;oe("LocalStore","Failed to update sequence numbers: "+N)}for(const N of T){const ue=N.targetId;if(!N.fromCache){const ke=C.us.get(ue),Ge=ke.withLastLimboFreeSnapshotVersion(ke.snapshotVersion);C.us=C.us.insert(ue,Ge)}}}),function u(p,T){return c.apply(this,arguments)})(n.localStore,s))}),pl.apply(this,arguments)}function Uf(r,e){return gl.apply(this,arguments)}function gl(){return(gl=(0,b.A)(function*(r,e){const t=Ee(r);if(!t.currentUser.isEqual(e)){oe("SyncEngine","User change. New user:",e.toKey());const n=yield wh(t.localStore,e);t.currentUser=e,(s=t).Qa.forEach(c=>{c.forEach(u=>{u.reject(new se(L.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Qa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Ln(t,n.Ts)}var s})).apply(this,arguments)}function Wf(r,e){const t=Ee(r),n=t.Ba.get(e);if(n&&n.Fa)return bt().add(n.key);{let i=bt();const s=t.Oa.get(e);if(!s)return i;for(const a of s){const c=t.xa.get(a);i=i.unionWith(c.view.fa)}return i}}function qs(r){const e=Ee(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=qh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Lf.bind(null,e),e.Ma.R_=Af.bind(null,e.eventManager),e.Ma.Wa=Sf.bind(null,e.eventManager),e}let Ys=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,b.A)(function*(){n.serializer=zi(t.databaseInfo.databaseId),n.sharedClientState=n.za(t),n.persistence=n.ja(t),yield n.persistence.start(),n.localStore=n.Ha(t),n.gcScheduler=n.Ja(t,n.localStore),n.indexBackfillerScheduler=n.Ya(t,n.localStore)})()}Ja(t,n){return null}Ya(t,n){return null}Ha(t){return function vh(r,e,t,n){return new Zm(r,e,t,n)}(this.persistence,new yh,t.initialUser,this.serializer)}ja(t){return new da(zs.ei,this.serializer)}za(t){return new Sh}terminate(){var t=this;return(0,b.A)(function*(){var n,i;null===(n=t.gcScheduler)||void 0===n||n.stop(),null===(i=t.indexBackfillerScheduler)||void 0===i||i.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class Cl extends Ys{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){return pe(this.persistence.referenceDelegate instanceof Ns),new ch(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}ja(e){const t=void 0!==this.cacheSizeBytes?dn.withCacheSize(this.cacheSizeBytes):dn.DEFAULT;return new da(n=>Ns.ei(n,t),this.serializer)}}let ei=(()=>{class r{initialize(t,n){var i=this;return(0,b.A)(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(n),i.remoteStore=i.createRemoteStore(n),i.eventManager=i.createEventManager(n),i.syncEngine=i.createSyncEngine(n,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=s=>Yh(i.syncEngine,s,1),i.remoteStore.remoteSyncer.handleCredentialChange=Uf.bind(null,i.syncEngine),yield $a(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new Cf}createDatastore(t){const n=zi(t.databaseInfo.databaseId),i=new cf(t.databaseInfo);return new df(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return i=this.localStore,s=this.datastore,a=t.asyncQueue,c=n=>Yh(this.syncEngine,n,0),u=Rh.p()?new Rh:new of,new mf(i,s,a,c,u);var i,s,a,c,u}createSyncEngine(t,n){return function(s,a,c,u,p,T,C){const N=new Df(s,a,c,u,p,T);return C&&(N.$a=!0),N}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,b.A)(function*(){var n,i,s;yield(s=(0,b.A)(function*(c){const u=Ee(c);oe("RemoteStore","RemoteStore shutting down."),u.k_.add(5),yield Kr(u),u.Q_.shutdown(),u.K_.set("Unknown")}),function a(c){return s.apply(this,arguments)})(t.remoteStore),null===(n=t.datastore)||void 0===n||n.terminate(),null===(i=t.eventManager)||void 0===i||i.terminate()})()}}return r.provider={build:()=>new r},r})();class Qs{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):at("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class rp{constructor(e,t,n,i,s){var a=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ye.UNAUTHENTICATED,this.clientId=Ze.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,function(){var c=(0,b.A)(function*(u){oe("FirestoreClient","Received user=",u.uid),yield a.authCredentialListener(u),a.user=u});return function(u){return c.apply(this,arguments)}}()),this.appCheckCredentials.start(n,c=>(oe("FirestoreClient","Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=Xr(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Sl(r,e){return Rl.apply(this,arguments)}function Rl(){return Rl=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),oe("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,b.A)(function*(s){n.isEqual(s)||(yield wh(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Rl.apply(this,arguments)}function ed(r,e){return Ol.apply(this,arguments)}function Ol(){return(Ol=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function Pl(r){return Ml.apply(this,arguments)}(r);oe("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>zh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>zh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Ml(){return(Ml=(0,b.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){oe("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Sl(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(i=e).name?i.code===L.FAILED_PRECONDITION||i.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw e;ie("Error using user provided cache. Falling back to memory cache: "+e),yield Sl(r,new Ys)}}else oe("FirestoreClient","Using default OfflineComponentProvider"),yield Sl(r,new Cl(void 0));var i;return r._offlineComponents})).apply(this,arguments)}function Xs(r){return Dl.apply(this,arguments)}function Dl(){return(Dl=(0,b.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(oe("FirestoreClient","Using user provided OnlineComponentProvider"),yield ed(r,r._uninitializedComponentsProvider._online)):(oe("FirestoreClient","Using default OnlineComponentProvider"),yield ed(r,new ei))),r._onlineComponents})).apply(this,arguments)}function ni(r){return Fl.apply(this,arguments)}function Fl(){return(Fl=(0,b.A)(function*(r){const e=yield Xs(r),t=e.eventManager;return t.onListen=kf.bind(null,e.syncEngine),t.onUnlisten=Vf.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ff.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=zf.bind(null,e.syncEngine),t})).apply(this,arguments)}function od(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const ad=new Map;function Vl(r,e,t){if(!t)throw new se(L.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function ld(r){if(!et.isDocumentKey(r))throw new se(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function cd(r){if(et.isDocumentKey(r))throw new se(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Hs(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":H()}function St(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new se(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Hs(r);throw new se(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class hd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new se(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new se(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function fp(r,e,t,n){if(!0===e&&!0===n)throw new se(L.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=od(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new se(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new se(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new se(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Li{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hd({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new se(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new se(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hd(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Se;switch(n.type){case"firstParty":return new Ye(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new se(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,b.A)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=ad.get(t);n&&(oe("ComponentProvider","Removing Datastore"),ad.delete(t),n.terminate())}(this),Promise.resolve()}}class cn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new cn(this.firestore,e,this._query)}}class Zt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Zt(this.firestore,e,this._key)}}class Pn extends cn{constructor(e,t,n){super(e,t,Pr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Zt(this.firestore,null,new et(e))}withConverter(e){return new Pn(this.firestore,e,this._path)}}function Bi(r,e,...t){if(r=(0,v.Ku)(r),Vl("collection","path",e),r instanceof Li){const n=Je.fromString(e,...t);return cd(n),new Pn(r,null,n)}{if(!(r instanceof Zt||r instanceof Pn))throw new se(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Je.fromString(e,...t));return cd(n),new Pn(r.firestore,null,n)}}function ri(r,e,...t){if(r=(0,v.Ku)(r),1===arguments.length&&(e=Ze.newId()),Vl("doc","path",e),r instanceof Li){const n=Je.fromString(e,...t);return ld(n),new Zt(r,null,new et(n))}{if(!(r instanceof Zt||r instanceof Pn))throw new se(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Je.fromString(e,...t));return ld(n),new Zt(r.firestore,r instanceof Pn?r.converter:null,new et(n))}}class _d{constructor(e=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new Ca(this,"async_queue_retry"),this.fu=()=>{const n=Us();n&&oe("AsyncQueue","Visibility state changed to "+n.visibilityState),this.r_.Jo()},this.gu=e;const t=Us();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.Eu){this.Eu=!0,this.Vu=e||!1;const t=Us();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.Eu)return new Promise(()=>{});const t=new je;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}wu(){var e=this;return(0,b.A)(function*(){if(0!==e.Iu.length){try{yield e.Iu[0](),e.Iu.shift(),e.r_.reset()}catch(t){if(!Be(t))throw t;oe("AsyncQueue","Operation failed with retryable error: "+t)}e.Iu.length>0&&e.r_.jo(()=>e.wu())}})()}yu(e){const t=this.gu.then(()=>(this.Ru=!0,e().catch(n=>{throw this.Au=n,this.Ru=!1,at("INTERNAL UNHANDLED ERROR: ",function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),c}(n)),n}).then(n=>(this.Ru=!1,n))));return this.gu=t,t}enqueueAfterDelay(e,t,n){this.pu(),this.mu.indexOf(e)>-1&&(t=0);const i=Wa.createAndSchedule(this,e,t,n,s=>this.Su(s));return this.du.push(i),i}pu(){this.Au&&H()}verifyOperationInProgress(){}bu(){var e=this;return(0,b.A)(function*(){let t;do{t=e.gu,yield t}while(t!==e.gu)})()}Du(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.du.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.du)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}function zl(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class Bt extends Li{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new _d,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){var e=this;return(0,b.A)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new _d(t),e._firestoreClient=void 0,yield t}})()}}function Nl(r,e){const t="object"==typeof r?r:(0,J.Sx)(),n="string"==typeof r?r:e||"(default)",i=(0,J.j6)(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const s=(0,v.yU)("firestore");s&&function pp(r,e,t,n={}){var i;const s=(r=St(r,Li))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&ie("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let c,u;if("string"==typeof n.mockUserToken)c=n.mockUserToken,u=ye.MOCK_USER;else{c=(0,v.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new se(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ye(p)}r._authCredentials=new $e(new _e(c,u))}}(i,...s)}return i}function Yt(r){if(r._terminated)throw new se(L.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||function md(r){var e,t,n;const i=r._freezeSettings(),s=(u=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new G_(r._databaseId,u,r._persistenceKey,(T=i).host,T.ssl,T.experimentalForceLongPolling,T.experimentalAutoDetectLongPolling,od(T.experimentalLongPollingOptions),T.useFetchStreams));var u,T;r._componentsProvider||!(null===(t=i.localCache)||void 0===t)&&t._offlineComponentProvider&&!(null===(n=i.localCache)||void 0===n)&&n._onlineComponentProvider&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new rp(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(c){const u=c?._online.build();return{_offline:c?._offline.build(u),_online:u}}(r._componentsProvider))}(r),r._firestoreClient}class yr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yr(Qt.fromBase64String(e))}catch(t){throw new se(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new yr(Qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class vr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new se(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ii{constructor(e){this._methodName=e}}class Bl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new se(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new se(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return it(this._lat,e._lat)||it(this._long,e._long)}}class Js{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}}const wp=/^__.*__$/;class xp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new zn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Vr(e,this.data,t,this.fieldTransforms)}}function gd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw H()}}class Zs{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Fu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new Zs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.xu({path:n,Nu:!1});return i.Lu(e),i}Bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.xu({path:n,Nu:!1});return i.Fu(),i}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return no(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lu(this.path.get(e))}Lu(e){if(0===e.length)throw this.qu("Document fields must not be empty");if(gd(this.Mu)&&wp.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class Tp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||zi(e)}$u(e,t,n,i=!1){return new Zs({Mu:e,methodName:t,Ku:n,path:xt.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wr(r){const e=r._freezeSettings(),t=zi(r._databaseId);return new Tp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function eo(r,e,t,n,i,s={}){const a=r.$u(s.merge||s.mergeFields?2:0,e,t,i);ql("Data must be an object, but it was:",a,n);const c=wd(n,a);let u,p;if(s.merge)u=new Tn(a.fieldMask),p=a.fieldTransforms;else if(s.mergeFields){const T=[];for(const C of s.mergeFields){const N=$i(e,C,t);if(!a.contains(N))throw new se(L.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Td(T,N)||T.push(N)}u=new Tn(T),p=a.fieldTransforms.filter(C=>u.covers(C.field))}else u=null,p=a.fieldTransforms;return new xp(new ln(c),u,p)}function xr(r,e){if(xd(r=(0,v.Ku)(r)))return ql("Unsupported field value:",e,r),wd(r,e);if(r instanceof ii)return function(n,i){if(!gd(i.Mu))throw i.qu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Nu&&4!==e.Mu)throw e.qu("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const c of n){let u=xr(c,i.ku(a));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,v.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return lu(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=Ue.fromDate(n);return{timestampValue:Nr(i.serializer,s)}}if(n instanceof Ue){const s=new Ue(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Nr(i.serializer,s)}}if(n instanceof Bl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof yr)return{bytesValue:Ru(i.serializer,n._byteString)};if(n instanceof Zt){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.qu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ea(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Js)return c=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(u=>{if("number"!=typeof u)throw c.qu("VectorValues must only contain numeric values.");return qo(c.serializer,u)})}}}}};var c;throw i.qu(`Unsupported field value: ${Hs(n)}`)}(r,e)}function wd(r,e){const t={};return Sc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$n(r,(n,i)=>{const s=xr(i,e.Ou(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function xd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Ue||r instanceof Bl||r instanceof yr||r instanceof Zt||r instanceof ii||r instanceof Js)}function ql(r,e,t){if(!xd(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=Hs(t);throw e.qu("an object"===n?r+" a custom object":r+" "+n)}var i}function $i(r,e,t){if((e=(0,v.Ku)(e))instanceof vr)return e._internalPath;if("string"==typeof e)return to(r,e);throw no("Field path arguments must be of type string or ",r,!1,void 0,t)}const Ep=new RegExp("[~\\*/\\[\\]]");function to(r,e,t){if(e.search(Ep)>=0)throw no(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new vr(...e.split("."))._internalPath}catch{throw no(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function no(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${n}`),a&&(u+=` in document ${i}`),u+=")"),new se(L.INVALID_ARGUMENT,c+r+u)}function Td(r,e){return r.some(t=>t.isEqual(e))}class Ui{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Zt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ip(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ro("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ip extends Ui{data(){return super.data()}}function ro(r,e){return"string"==typeof e?to(r,e):e instanceof vr?e._internalPath:e._delegate._internalPath}function Ed(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new se(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Yl{}class Wi extends Yl{}function Id(r,e,...t){let n=[];e instanceof Yl&&n.push(e),n=n.concat(t),function(s){const a=s.filter(u=>u instanceof si).length,c=s.filter(u=>u instanceof Ki).length;if(a>1||a>0&&c>0)throw new se(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Ki extends Wi{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ki(e,t,n)}_apply(e){const t=this._parse(e);return Rd(e._query,t),new cn(e.firestore,e.converter,Wo(e._query,t))}_parse(e){const t=wr(e.firestore);return function(s,a,c,u,p,T,C){let N;if(p.isKeyField()){if("array-contains"===T||"array-contains-any"===T)throw new se(L.INVALID_ARGUMENT,`Invalid Query. You can't perform '${T}' queries on documentId().`);if("in"===T||"not-in"===T){Sd(C,T);const ue=[];for(const ke of C)ue.push(Ad(u,s,ke));N={arrayValue:{values:ue}}}else N=Ad(u,s,C)}else"in"!==T&&"not-in"!==T&&"array-contains-any"!==T||Sd(C,T),N=function vd(r,e,t,n=!1){return xr(t,r.$u(n?4:3,e))}(c,"where",C,"in"===T||"not-in"===T);return Rt.create(p,T,N)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function bd(r,e,t){const n=e,i=ro("where",r);return Ki._create(i,n,t)}class si extends Yl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new si(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:Nt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const c=s.getFlattenedFilters();for(const u of c)Rd(a,u),a=Wo(a,u)}(e._query,t),new cn(e.firestore,e.converter,Wo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ad(r,e,t){if("string"==typeof(t=(0,v.Ku)(t))){if(""===t)throw new se(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Uo(e)&&-1!==t.indexOf("/"))throw new se(L.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Je.fromString(t));if(!et.isDocumentKey(n))throw new se(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ar(r,new et(n))}if(t instanceof Zt)return ar(r,t._key);throw new se(L.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hs(t)}.`)}function Sd(r,e){if(!Array.isArray(r)||0===r.length)throw new se(L.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Rd(r,e){const t=function(i,s){for(const a of i)for(const c of a.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new se(L.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Pd{convertValue(e,t="none"){switch(Wn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw H()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return $n(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(a=>Wt(a.doubleValue));return new Js(s)}convertGeoPoint(e){return new Bl(Wt(e.latitude),Wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=fs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(_i(e));default:return null}}convertTimestamp(e){const t=Dn(e);return new Ue(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Je.fromString(e);pe(ju(n));const i=new or(n.get(1),n.get(3)),s=new et(n.popFirst(5));return i.isEqual(t)||at(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class Tr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class oi extends Ui{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new lo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(ro("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class lo extends oi{data(e={}){return super.data(e)}}class ai{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Tr(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new lo(this._firestore,this._userDataWriter,n.key,n,new Tr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new se(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>({type:"added",doc:new lo(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Tr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||3!==c.type).map(c=>{const u=new lo(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Tr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);let p=-1,T=-1;return 0!==c.type&&(p=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),1!==c.type&&(a=a.add(c.doc),T=a.indexOf(c.doc.key)),{type:Ap(c.type),doc:u,oldIndex:p,newIndex:T}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ap(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return H()}}class er extends Pd{constructor(e){super(),this.firestore=e}convertBytes(e){return new yr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Zt(this.firestore,null,t)}}function Md(r){r=St(r,cn);const e=St(r.firestore,Bt),t=Yt(e),n=new er(e);return Ed(r._query),function sd(r,e,t={}){const n=new je;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,c,u,p){const T=new Qs({next:N=>{T.eu(),a.enqueueAndForget(()=>Ya(s,C)),N.fromCache&&"server"===u.source?p.reject(new se(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(N)},error:N=>p.reject(N)}),C=new Ja(c,T,{includeMetadataChanges:!0,ua:!0});return Ka(s,C)}(yield ni(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(i=>new ai(e,n,r,i))}function Dd(r,e,t){r=St(r,Zt);const n=St(r.firestore,Bt),i=function ao(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return qi(n,[eo(wr(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,Kt.none())])}function co(r,...e){var t,n,i;r=(0,v.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||zl(e[a])||(s=e[a],a++);const c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(zl(e[a])){const C=e[a];e[a]=null===(t=C.next)||void 0===t?void 0:t.bind(C),e[a+1]=null===(n=C.error)||void 0===n?void 0:n.bind(C),e[a+2]=null===(i=C.complete)||void 0===i?void 0:i.bind(C)}let u,p,T;if(r instanceof Zt)p=St(r.firestore,Bt),T=Pr(r._key.path),u={next:C=>{e[a]&&e[a](Xl(p,r,C))},error:e[a+1],complete:e[a+2]};else{const C=St(r,cn);p=St(C.firestore,Bt),T=C._query;const N=new er(p);u={next:ue=>{e[a]&&e[a](new ai(p,N,C,ue))},error:e[a+1],complete:e[a+2]},Ed(r._query)}return function(N,ue,ke,Qe){const Ge=new Qs(Qe),_t=new Ja(ue,Ge,ke);return N.asyncQueue.enqueueAndForget((0,b.A)(function*(){return Ka(yield ni(N),_t)})),()=>{Ge.eu(),N.asyncQueue.enqueueAndForget((0,b.A)(function*(){return Ya(yield ni(N),_t)}))}}(Yt(p),T,c,u)}function qi(r,e){return function(n,i){const s=new je;return n.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Nf(r,e,t){return ol.apply(this,arguments)}(yield function kl(r){return Xs(r).then(e=>e.syncEngine)}(n),i,s)})),s.promise}(Yt(r),e)}function Xl(r,e,t){const n=t.docs.get(e._key),i=new er(r);return new oi(r,i,e._key,n,new Tr(t.hasPendingWrites,t.fromCache),e.converter)}!function(e,t=!0){Te=J.MF,(0,J.om)(new G.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),c=new Bt(new Le(n.getProvider("auth-internal")),new Fe(n.getProvider("app-check-internal")),function(p,T){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new se(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new or(p.options.projectId,T)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),(0,J.KO)(ze,"4.7.5",e),(0,J.KO)(ze,"4.7.5","esm2017")}();var tn=g(51698),Gp=g(92834),$p=g(543),Up=g(97252);let Wp=(()=>{var r;class e{examSessions_read(n){var i=this;return new tn.c(s=>{this.getFirestoreDb(!1).subscribe(function(){var a=(0,b.A)(function*(c){if(c&&1==c.success)try{var u=yield i._getDocument(c.data,"exam_sessions/"+n,i.getUserId());s.next({success:1,data:u,message:"successful"}),s.complete()}catch(T){console.log(T),s.next({success:0,data:"",message:""+T}),s.complete()}else s.next({success:0,data:"",message:c.message}),s.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_write(n,i){var s=this;return new tn.c(a=>{this.getFirestoreDb(!1).subscribe(function(){var c=(0,b.A)(function*(u){if(u&&1==u.success)try{var p=yield s._saveDocument(u.data,"exam_sessions/"+n,s.getUserId(),i);a.next({success:1,data:p,message:"successful"}),a.complete()}catch(C){console.log(C),a.next({success:0,data:"",message:""+C}),a.complete()}else a.next({success:0,data:"",message:u.message}),a.complete()});return function(u){return c.apply(this,arguments)}}())})}examSessions_writeUserMap(n,i){var s=this;return new tn.c(a=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var c=(0,b.A)(function*(u){if(u&&1==u.success&&u.data)try{var p=yield s._saveDocumentMerge(u.data,"exam_sessions/"+n,"user_map",i);a.next({success:1,data:p,message:"successful"}),a.complete()}catch(C){console.log(C),a.next({success:0,data:"",message:""+C}),a.complete()}else a.next({success:0,data:"",message:u.message}),a.complete()});return function(u){return c.apply(this,arguments)}}())})}examSessions_delete(n){var i=this;return new tn.c(s=>{this.getFirestoreDb(!1).subscribe(function(){var a=(0,b.A)(function*(c){if(c&&1==c.success)try{yield i._removeDocument(c.data,"exam_sessions/"+n,i.getUserId()),s.next({success:1,data:"",message:"successful"}),s.complete()}catch(p){console.log(p),s.next({success:0,data:"",message:""+p}),s.complete()}else s.next({success:0,data:"",message:c.message}),s.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_subscribeUserMap(n){var i=this;return new tn.c(s=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var a=(0,b.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshot(c.data,"exam_sessions/"+n,"user_map",C=>{s.next({success:1,data:C,message:"successful"}),s.complete()});i.addUnsubscribe("exam_sessions_"+n,u)}catch(C){console.log(C),s.next({success:0,data:void 0,message:""+C}),s.complete()}else s.next({success:0,data:void 0,message:c.message}),s.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_subscribe(n){var i=this;return new tn.c(s=>{this.getFirestoreDb(!1).subscribe(function(){var a=(0,b.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshot(c.data,"exam_sessions/"+n,i.getUserId(),C=>{s.next({success:1,data:C,message:"successful"}),s.complete()});i.addUnsubscribe("exam_sessions_"+n,u)}catch(C){console.log(C),s.next({success:0,data:void 0,message:""+C}),s.complete()}else s.next({success:0,data:void 0,message:c.message}),s.complete()});return function(c){return a.apply(this,arguments)}}())})}examSessions_unsubscribe(n){this.removeAllunsubscribe("exam_sessions_"+n)}examSessions_subscribeWithQuery(n,i){var s=this;return new tn.c(i&&3==i.length?a=>{this.getFirestoreDb(!1).subscribe(function(){var c=(0,b.A)(function*(u){if(u&&1==u.success)try{var p=s.myOnSnapshotCollectionWithQuery(u.data,"exam_sessions/"+n,i,N=>{a.next({success:1,data:N,message:"successful"}),a.complete()});s.addUnsubscribe("exam_sessions_"+n,p)}catch(N){console.log(N),a.next({success:0,data:void 0,message:""+N}),a.complete()}else a.next({success:0,data:void 0,message:u.message}),a.complete()});return function(u){return c.apply(this,arguments)}}())}:a=>{a.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),a.complete(),a.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(n){var i=this;return new tn.c(s=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var a=(0,b.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshotCollection(c.data,"exam_live_teachers/"+n,p=>{s.next({success:1,data:p})});i.addUnsubscribe("exam_live_teachers_"+n,u)}catch(p){console.log(p),s.next({success:0,message:"EXCEPTION",ex:p.toString()})}else s.next(c)});return function(c){return a.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_teachers_"+n)}examLiveTeachers_teacher_saveChange(n,i){var s=this;return new tn.c(a=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,b.A)(function*(u){if(u&&1==u.success)try{var p=yield s._saveDocument(u.data,"exam_live_teachers/"+n,s.getUserId(),i);a.next({success:1,data:p})}catch(T){console.log(T),a.next({success:0,message:"EXCEPTION",ex:T.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(n,i){var s=this;return new tn.c(a=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,b.A)(function*(u){if(u&&1==u.success)try{var p=yield s._getDocuments(u.data,"exam_lives/"+n,i);a.next({success:1,data:p})}catch(T){console.log(T),a.next({success:0,message:"EXCEPTION",ex:T.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(n){var i=this;return new tn.c(s=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var a=(0,b.A)(function*(c){if(c&&1==c.success)try{var u=i.myOnSnapshot(c.data,"exam_live_students/"+n,i.getUserId(),p=>{s.next({success:1,data:p})});i.addUnsubscribe("exam_live_students_"+n,u)}catch(p){console.log(p),s.next({success:0,message:"EXCEPTION",ex:p.toString()})}else s.next(c)});return function(c){return a.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_teacher_subscribe(n,i){var s=this;return new tn.c(a=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var c=(0,b.A)(function*(u){if(u&&1==u.success)try{var p=s.myOnSnapshot(u.data,"exam_live_students/"+n,i,T=>{a.next({success:1,data:T})});s.addUnsubscribe("exam_live_students_"+n,p)}catch(T){console.log(T),a.next({success:0,message:"EXCEPTION",ex:T.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(n){this.removeAllunsubscribe("exam_live_students_"+n)}examLiveStudents_student_saveChange(n,i){var s=this;return new tn.c(a=>{this.getFirestoreDbForStudentExam(!1,n).subscribe(function(){var c=(0,b.A)(function*(u){if(u&&1==u.success)try{var p=yield s._saveDocument(u.data,"exam_live_students/"+n,s.getUserId(),i);a.next({success:1,data:p})}catch(T){console.log(T),a.next({success:0,message:"EXCEPTION",ex:T.toString()})}else a.next(u)});return function(u){return c.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(n,i,s){var a=this;return new tn.c(c=>{this.getFirestoreDbForTeacherExam(!1,n).subscribe(function(){var u=(0,b.A)(function*(p){if(p&&1==p.success)try{var T=yield a._saveDocumentMerge(p.data,"exam_live_students/"+n,i,s);c.next({success:1,data:T})}catch(C){console.log(C),c.next({success:0,message:"EXCEPTION",ex:C.toString()})}else c.next(p)});return function(p){return u.apply(this,arguments)}}())})}getFirestoreDb(n){return new tn.c(i=>{var s=this.createFirestoreKey("firestore_db"),a=this.getLocalFirestoreDb(s);null!=a&&0==n?(i.next({success:1,data:a,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(u=>{u&&1==u.success?(0,le.p)(this.getAuthApp(),u?.data?.token??"").then(()=>{var T=Nl(this.app,h.c.firestoreDatabase);this.setLocalFirestoreDb(s,T),i.next({success:1,data:T,message:"successful"}),i.complete()}).catch(T=>{"auth/invalid-custom-token"===T.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())}):(i.next({success:0,data:void 0,message:u.message??""}),i.complete())})})}getFirestoreDbForStudentExam(n,i){return new tn.c(s=>{var a=this.createFirestoreKey("firestore_db_student_"+i),c=this.getLocalFirestoreDb(a);null!=c&&0==n?(s.next({success:1,data:c,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(i).subscribe(p=>{p&&1==p.success?(0,le.p)(this.getAuthApp(),p?.data?.token??"").then(()=>{var C=Nl(this.app,h.c.firestoreDatabase);this.setLocalFirestoreDb(a,C),s.next({success:1,data:C,message:"successful"}),s.complete()}).catch(C=>{"auth/invalid-custom-token"===C.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:p.message??""}),s.complete())})})}getFirestoreDbForTeacherExam(n,i){return new tn.c(s=>{var a=this.createFirestoreKey("firestore_db_teacher_"+i),c=this.getLocalFirestoreDb(a);null!=c&&0==n?(s.next({success:1,data:c,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(i).subscribe(p=>{p&&1==p.success?(0,le.p)(this.getAuthApp(),p?.data?.token??"").then(()=>{var C=Nl(this.app,h.c.firestoreDatabase);this.setLocalFirestoreDb(a,C),s.next({success:1,data:C,message:"successful"}),s.complete()}).catch(C=>{"auth/invalid-custom-token"===C.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:p.message??""}),s.complete())})})}signInUserByToken(n){return new tn.c(i=>{(0,le.p)(this.getAuthApp(),n).then(()=>{i.next({success:1,data:"",message:"successful"}),i.complete()}).catch(s=>{"auth/invalid-custom-token"===s.code?(i.next({success:0,data:"",message:"EXPIRED"}),i.complete()):(i.next({success:0,data:"",message:"AUTH_ERROR"}),i.complete())})})}setLocalFirestoreDb(n,i){this.firestoreDbs[n]=i}getLocalFirestoreDb(n){if(this.firestoreDbs.hasOwnProperty(n))return this.firestoreDbs[n]}removeLocalFirestoreDb(n){this.firestoreDbs.hasOwnProperty(n)&&delete this.firestoreDbs[n]}createFirestoreKey(n){return this.userService.getUserObj().id+"_"+n}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(n,i){n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)||(this.listSubscribers[n]=[]),this.listSubscribers[n].push(i)}removeAllunsubscribe(n){if(n=this.getUserId()+"_"+n,this.listSubscribers.hasOwnProperty(n)){for(var i=0;i<this.listSubscribers[n].length;i++)this.listSubscribers[n][i]();delete this.listSubscribers[n]}}_saveDocument(n,i,s,a){var c=this;return(0,b.A)(function*(){return i=c.getBaseFirestore()+"/"+i,yield Dd(ri(n,i,s),c.commonService.myClone(a)),s})()}_saveDocumentMerge(n,i,s,a){var c=this;return(0,b.A)(function*(){return i=c.getBaseFirestore()+"/"+i,yield Dd(ri(n,i,s),c.commonService.myClone(a),{merge:!0}),s})()}_getCollection(n,i){var s=this;return(0,b.A)(function*(){i=s.getBaseFirestore()+"/"+i;const a=Bi(n,i);return(yield Md(a)).docs.map(p=>p.data())})()}_getDocument(n,i,s){var a=this;return(0,b.A)(function*(){i=a.getBaseFirestore()+"/"+i;const c=ri(n,i,s),u=yield function Sp(r){r=St(r,Zt);const e=St(r.firestore,Bt);return function id(r,e,t={}){const n=new je;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,c,u,p){const T=new Qs({next:N=>{T.eu(),a.enqueueAndForget(()=>Ya(s,C));const ue=N.docs.has(c);!ue&&N.fromCache?p.reject(new se(L.UNAVAILABLE,"Failed to get document because the client is offline.")):ue&&N.fromCache&&u&&"server"===u.source?p.reject(new se(L.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(N)},error:N=>p.reject(N)}),C=new Ja(Pr(c.path),T,{includeMetadataChanges:!0,ua:!0});return Ka(s,C)}(yield ni(r),r.asyncQueue,e,t,n)})),n.promise}(Yt(e),r._key).then(t=>Xl(e,r,t))}(c);return u.exists()?u.data():null})()}_getDocuments(n,i,s){var a=this;return(0,b.A)(function*(){var c={};i=a.getBaseFirestore()+"/"+i;const u=Id(Bi(n,i),bd(function vp(){return new vr("__name__")}(),"in",s));return(yield Md(u)).forEach(T=>{c[T.id]=T.data()}),c})()}_removeDocument(n,i,s){var a=this;return(0,b.A)(function*(){i=a.getBaseFirestore()+"/"+i,yield function Rp(r){return qi(St(r.firestore,Bt),[new zr(r._key,Kt.none())])}(ri(n,i,s))})()}myOnSnapshot(n,i,s,a){return co(ri(n,i=this.getBaseFirestore()+"/"+i,s),u=>{a(u.data())})}myOnSnapshotCollection(n,i,s){return co(Bi(n,i=this.getBaseFirestore()+"/"+i),function(){var c=(0,b.A)(function*(u){var p=[];u.forEach(T=>{p.push(T.data())}),s(p)});return function(u){return c.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(n,i,s){return co(Bi(n,i=this.getBaseFirestore()+"/"+i),function(){var c=(0,b.A)(function*(u){var p=[];u.docChanges().forEach(T=>{p.push(T.doc.data())}),s(p)});return function(u){return c.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(n,i,s,a){return co(Id(Bi(n,i=this.getBaseFirestore()+"/"+i),bd(s[0],s[1],s[2])),function(){var p=(0,b.A)(function*(T){var C=[];T.docChanges().forEach(N=>{C.push(N.doc.data())}),a(C)});return function(T){return p.apply(this,arguments)}}())}getBaseFirestore(){return h.c.firestoreCollection}getInitApp(){return this.app}getAuthApp(){return(0,le.xI)(this.app)}initFirestoreConfig(){return new tn.c(n=>{this.firestoreSettingService.apiFirestoreSettingGetPublicKeyGet().subscribe(i=>{let s=h.c.firestoreConfig_app1;s.apiKey=i.data?.value??"",this.app=(0,Y.Wp)(s,"firestoreapp"),n.next(),n.complete()})})}constructor(n,i,s,a){this.firestoreServiceApi=n,this.userService=i,this.commonService=s,this.firestoreSettingService=a,this.firestoreDbs={},this.listSubscribers={}}}return(r=e).\u0275fac=function(n){return new(n||r)(y.KVO(Gp.B),y.KVO(ce.R),y.KVO($p.R),y.KVO(Up.Z))},r.\u0275prov=y.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})(),Kp=(()=>{var r;class e{monitorAtTeacherDashboard(n){try{let i=o();if(typeof i>"u"||!i||!i.showMonitorTeacher)return;this.fireStoreService.initFirestoreConfig().subscribe(()=>{i.ver=this.monitorService.getMNoteVer();var s=this.userService.getUserObj();i.showMonitorTeacher({user:{token:s.rememberToken,userid:s.id,username:s.fullName},config:{domainApi:h.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live",urlExamResultGetLastExamResultOfStudentId:"ExamLivestream/GetLastExamResultOfStudentId"},roomid:n.roomId,examid:n.examId,userlist:n.userList,examconfig:n.examConfig,firebaseApp:this.fireStoreService,filetypeStr:n.fileTypeStr})})}catch(i){console.log(i)}}monitorAtStudentDashboard(n,i){try{let a=o();if(typeof a>"u"||!a)return;a.ver=this.monitorService.getMNoteVer();var s=this.userService.getUserObj();this.fireStoreService.initFirestoreConfig().subscribe(()=>{a.loadMonitor(()=>{if(!a.MonitorStudent)return;var c={user:{token:s.rememberToken,userid:s.id,username:s.fullName},config:{domainApi:h.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:n,element:"monitorScreen",examconfig:i,firebaseApp:this.fireStoreService,isStarted:!1};a.MonitorStudent.getInstance().prepairSession(c);let p=window.setInterval(()=>{let T=document.getElementById("monitorScreen");if(T){let C=T.getElementsByTagName("div")[0];C&&(C.setAttribute("class","mx-auto"),clearInterval(p))}},50)})})}catch(a){console.log(a)}}monitorAtTestPage(n,i,s){let a=o();if(typeof a>"u"||!a)return s(!1);var c=this.userService.getUserObj(),u=i;a.ver=this.monitorService.getMNoteVer(),this.fireStoreService.initFirestoreConfig().subscribe(()=>{a.loadMonitor(()=>{if(!a.MonitorStudent)return s(!1);var p={user:{token:c.rememberToken,userid:c.id,username:c.fullName,studentid:u?u.id:0,studentname:u?u.fullName:null},config:{domainApi:h.c.auto_testbank_base_api+"/api/",urlGetPublicForLive:"S3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",urlGetTokenForLive:"S3space/get_token_for_live"},roomid:n.roomId,element:"monitorScreenTakeTest",examconfig:n.examConfig,examid:n.examId,firebaseApp:this.fireStoreService,resultid:n.resultId,isStarted:!0,clickFromIframeFunc:()=>{},clickFromIframeFuncCaller:this};a.MonitorStudent.getInstance().startSession(p),s(!0)})})}destroyMonitorAtStudentDashboard(){try{let i=o();if(typeof i>"u"||!i||!i.MonitorStudent)return;i.MonitorStudent.getInstance().stopSession()}catch(i){console.log(i)}}constructor(n,i,s){this.userService=n,this.monitorService=i,this.fireStoreService=s}}return(r=e).\u0275fac=function(n){return new(n||r)(y.KVO(ce.R),y.KVO(te.Q),y.KVO(Wp))},r.\u0275prov=y.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},42802:(Tt,Ae,g)=>{"use strict";g.d(Ae,{Q:()=>y});var o=g(48891),h=g(55465);let y=(()=>{var ce;class te{constructor(Y){this.envService=Y}getTmpVersionMonitor(){var Y=this.envService.getEnvValue("classliveUrl"),le="1.0";if(Y){var J=Y.split("=");J.length>1&&(le=J[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+le}getMNoteVer(){var Y=this.envService.getEnvValue("classliveUrl"),le="1.0";if(Y){var J=Y.split("=");J.length>1&&(le=J[1])}return le}checkValidForSetUpMonitor(){return!0}}return(ce=te).\u0275fac=function(Y){return new(Y||ce)(o.KVO(h.t))},ce.\u0275prov=o.jDH({token:ce,factory:ce.\u0275fac,providedIn:"root"}),te})()},51935:(Tt,Ae,g)=>{"use strict";g.d(Ae,{h:()=>et});var o=g(91478),h=g(89163),y=g(33887),ce=g(2915),te=g(54460),b=g(10936),Y=g(65162),le=g(47348),J=g(21656),G=g(15343),x=g(70050),v=g(5502),F=g(36894),_=g(48891);const f=()=>({"mr-2":!0});function q(V,X){if(1&V&&(_.j41(0,"li"),_.EFF(1),_.k0s()),2&V){const ee=X.$implicit;_.R7$(),_.SpI("* ",ee.message,"")}}function $(V,X){1&V&&(_.j41(0,"span",8),_.EFF(1),_.nI1(2,"mytranslate"),_.j41(3,"span",9),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.EFF(6),_.nI1(7,"mytranslate"),_.nI1(8,"mytranslate"),_.k0s()),2&V&&(_.R7$(),_.SpI(" ",_.bMT(2,4,"lang_auto_click")," "),_.R7$(3),_.SpI('"',_.bMT(5,6,"lang_auto_tai_ve"),'"'),_.R7$(2),_.Lme(" ",_.bMT(7,8,"lang_auto_de_tai_ve")," ",_.bMT(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function d(V,X){if(1&V){const ee=_.RV6();_.j41(0,"button",17),_.bIt("click",function(){_.eBV(ee);const B=_.XpG();return _.Njj(B.onPressTrue())}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&V&&(_.R7$(),_.SpI(" ",_.bMT(2,1,"lang_auto_tai_ve")," "))}let de=(()=>{var V;class X extends y._{onPressTrue(){this.dialogRef.close(!0)}constructor(S,B){super(S,B),this.data=S,this.dialogRef=B,this.result=S.result}}return(V=X).\u0275fac=function(S){return new(S||V)(_.rXU(h.Vh),_.rXU(h.CP,8))},V.\u0275cmp=_.VBU({type:V,selectors:[["app-push-error-student-export-docx"]],standalone:!0,features:[_.Vt3,_.aNF],decls:30,vars:25,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16",3,"ngClass"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(S,B){1&S&&(_.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",4)(7,"a",5),_.nrm(8,"lucide-icon",6),_.k0s()()(),_.j41(9,"div",7)(10,"span",8),_.EFF(11),_.nI1(12,"mytranslate"),_.j41(13,"span",9),_.EFF(14),_.k0s(),_.EFF(15),_.nI1(16,"mytranslate"),_.nI1(17,"lowercase"),_.k0s(),_.j41(18,"span",8),_.EFF(19),_.nI1(20,"mytranslate"),_.k0s(),_.j41(21,"azt-mat-dialog-content",10)(22,"ul",11),_.DNE(23,q,2,1,"li",12),_.k0s()(),_.DNE(24,$,9,12,"span",13),_.k0s(),_.j41(25,"div",14)(26,"a",15),_.EFF(27),_.nI1(28,"mytranslate"),_.k0s(),_.DNE(29,d,3,3,"button",16),_.k0s()()()),2&S&&(_.R7$(4),_.JRh(_.bMT(5,12,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),_.R7$(4),_.Y8G("ngClass",_.lJ4(24,f)),_.R7$(3),_.SpI(" ",_.bMT(12,14,"lang_auto_he_thong_tao_thanh_cong_cho")," "),_.R7$(3),_.Lme("",B.result.datas.length,"/",B.result.errs.length+B.result.datas.length,""),_.R7$(),_.SpI(" ",_.bMT(17,18,_.bMT(16,16,"lang_auto_hoc_sinh"))," "),_.R7$(4),_.SpI(" ",_.bMT(20,20,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),_.R7$(2),_.Y8G("defaultHeight",60),_.R7$(2),_.Y8G("ngForOf",B.result.errs),_.R7$(),_.Y8G("ngIf",B.result.datas.length>0),_.R7$(3),_.SpI(" ",_.bMT(28,22,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("ngIf",B.result.datas.length>0))},dependencies:[ce.U,te.MD,te.YU,te.Sq,te.bT,te.GH,b.X1,Y.iI,b.YN,le.wp,J.s,h.tx,G.flO,G.WGl,x.L,v.Id,F.k],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),X})();var z=g(65080),Ie=g(90796),me=g(69135),nt=g(14987),tt=g(68774),rt=g(47712),He=g(81587);const ve=(V,X)=>({"box-classrooms":V,"box-max-classrooms":X});function ze(V,X){if(1&V&&(_.j41(0,"span",31),_.EFF(1),_.k0s()),2&V){let ee;const S=_.XpG();_.R7$(),_.JRh(null!==(ee=null==S.studentsInClassResults[0].classObj?null:S.studentsInClassResults[0].classObj.name)&&void 0!==ee?ee:"")}}function ye(V,X){if(1&V&&(_.j41(0,"div",36)(1,"div",18),_.nrm(2,"input",37),_.j41(3,"label",38,0),_.EFF(5),_.k0s()()()),2&V){let ee;const S=X.$implicit,B=_.sdS(4),Z=_.XpG(2);_.Y8G("hidden",1===Z.studentsInClassResults.length),_.R7$(2),_.Mz_("id","select-classroom-export__",null==S.classObj?null:S.classObj.id,""),_.Y8G("value",null==S.classObj?null:S.classObj.id),_.R7$(),_.Mz_("for","select-classroom-export__",null==S.classObj?null:S.classObj.id,""),_.Y8G("matTooltip",null!==(ee=null==S.classObj?null:S.classObj.name)&&void 0!==ee?ee:"")("isDisabledTooltip",!1)("matTooltipDisabled",B.isDisabled),_.R7$(2),_.JRh(null==S.classObj?null:S.classObj.name)}}function Te(V,X){if(1&V&&(_.j41(0,"div",32)(1,"ng-scrollbar",33)(2,"div",34),_.DNE(3,ye,6,10,"div",35),_.k0s()()()),2&V){const ee=_.XpG();_.Y8G("ngClass",_.l_i(3,ve,ee.form.controls.listStudents.controls.length>21||ee.studentsInClassResults.length>18,ee.form.controls.listStudents.controls.length<=21&&ee.studentsInClassResults.length>18)),_.R7$(),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",ee.studentsInClassResults)}}function Me(V,X){if(1&V&&(_.j41(0,"label",38,0),_.EFF(2),_.k0s()),2&V){const ee=_.sdS(1),S=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",S.controls.id.value,""),_.Y8G("matTooltip",S.controls.label.value)("isDisabledTooltip",!1)("matTooltipDisabled",ee.isDisabled),_.R7$(2),_.SpI(" ",S.controls.label.value," ")}}function we(V,X){if(1&V&&(_.j41(0,"label",44),_.nrm(1,"img",45),_.k0s()),2&V){const ee=_.XpG().$implicit;_.Mz_("for","select-classroom-export__",ee.controls.id.value,""),_.R7$(),_.Y8G("nameImages",ee.controls.nameImages.value)}}function Ke(V,X){if(1&V){const ee=_.RV6();_.j41(0,"div",39)(1,"div",40)(2,"input",41),_.bIt("change",function(){_.eBV(ee);const B=_.XpG();return _.Njj(B.onChangeStudentOption())}),_.k0s(),_.DNE(3,Me,3,6,"label",42)(4,we,2,3,"label",43),_.k0s()()}if(2&V){const ee=X.$implicit;_.R7$(),_.Y8G("formGroup",ee),_.R7$(),_.Mz_("id","select-classroom-export__",ee.controls.id.value,""),_.R7$(),_.Y8G("ngIf",ee.controls.label.value||!ee.controls.isImage.value),_.R7$(),_.Y8G("ngIf",!ee.controls.label.value&&ee.controls.isImage.value&&ee.controls.nameImages.value)}}function oe(V,X){1&V&&(_.j41(0,"span",27),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&V&&(_.R7$(),_.SpI("* ",_.bMT(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function at(V,X){if(1&V){const ee=_.RV6();_.j41(0,"div",49),_.bIt("click",function(){_.eBV(ee);const B=_.XpG(2);return _.Njj(B.showAskInfo=!0)}),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()}2&V&&(_.R7$(),_.SpI("+ ",_.bMT(2,1,"lang_testbank_test_config_add_information"),""))}function ie(V,X){if(1&V&&(_.j41(0,"div"),_.nrm(1,"add-info-print",50),_.k0s()),2&V){const ee=_.XpG(2);_.R7$(),_.Y8G("form",ee.form)}}function be(V,X){1&V&&(_.j41(0,"span",53),_.EFF(1),_.nI1(2,"mytranslate"),_.k0s()),2&V&&(_.R7$(),_.SpI("(",_.bMT(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function H(V,X){if(1&V){const ee=_.RV6();_.j41(0,"div",51),_.bIt("click",function(){_.eBV(ee);const B=_.XpG(2);return _.Njj(B.showAskInfo=!1)}),_.EFF(1),_.nI1(2,"mytranslate"),_.nI1(3,"mytranslate"),_.nI1(4,"lowercase"),_.DNE(5,be,3,3,"span",52),_.k0s()}if(2&V){const ee=_.XpG(2);_.R7$(),_.Lme(" ",_.bMT(2,3,"lang_auto_huy")," ",_.bMT(4,7,_.bMT(3,5,"lang_testbank_test_config_add_information"))," "),_.R7$(4),_.Y8G("ngIf",ee.isAskInfo&&ee.showAskInfo)}}function pe(V,X){if(1&V&&(_.j41(0,"div")(1,"span",46),_.EFF(2),_.nI1(3,"mytranslate"),_.k0s(),_.DNE(4,at,3,3,"div",47)(5,ie,2,1,"div",26)(6,H,6,9,"div",48),_.k0s()),2&V){const ee=_.XpG();_.R7$(2),_.Lme("* ",_.bMT(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",ee.countStudentSelect,""),_.R7$(2),_.Y8G("ngIf",ee.isAskInfo&&!ee.showAskInfo),_.R7$(),_.Y8G("ngIf",ee.isAskInfo&&ee.showAskInfo),_.R7$(),_.Y8G("ngIf",ee.isAskInfo&&ee.showAskInfo)}}function Xe(V,X){1&V&&(_.j41(0,"div")(1,"div",15)(2,"span",27),_.EFF(3),_.nI1(4,"mytranslate"),_.k0s()()()),2&V&&(_.R7$(3),_.SpI("* ",_.bMT(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let Ee=(()=>{var V;class X extends y._{confirmAction(){const S=this.form.value,B=this.studentsInClassResults.find(Z=>Z.classObj?.id===S.classId);if(B){const Z=S.listStudents?.filter(P=>P.choose).map(P=>P.id);B.results=B.results?.filter(P=>Z?.includes(P.reId)),B.schoolName=this.showAskInfo?S.schoolName:void 0,B.subjectName=this.showAskInfo?S.subjectName:void 0,this.dialogRef.close(B)}else this.dialogRef.close()}setChangeSelectAll(){const S=this.form.controls.selectAll;if(S){S.setValue(!S.value);const B=this.form.controls.listStudents;B&&B.controls.forEach(Z=>{Z.controls.choose.setValue(S.value)}),this.countStudentSelect=S.value?B.controls.length:0}}onChangeStudentOption(){const S=this.form.controls.listStudents;let B=!0,Z=0;S&&S.controls.forEach(I=>{!1===I.controls.choose.value?B=!1:Z++});const P=this.form.controls.selectAll;P&&P.setValue(B),this.countStudentSelect=Z}setupArrayStudent(S){this.currNameClass=S.classObj?.name??"";const B=this.form.controls.listStudents;if(B){B.clear();let Z=S.results??[];if(void 0!==S.classObj?.sortType){let P=S.classObj?.sortType;Z=0==P?this.sortService.sortFirstNameStudents(this.commonService.myClone(Z)):99==P?this.sortService.sortTimeDESC(this.commonService.myClone(Z)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone(Z),"pos","id")}Z.forEach(P=>{(P.confirmedAt||!this.data.examHasEssay&&1==P.status)&&B.push(new b.gE({isImage:new b.MJ(!!P.nameImages,{nonNullable:!0}),nameImages:new b.MJ(P.nameImages,{nonNullable:!0}),label:new b.MJ(P.fullName,{nonNullable:!0}),id:new b.MJ(P.reId,{nonNullable:!0}),choose:new b.MJ(!1,{nonNullable:!0})}))})}}classroomChange(S){this.setupArrayStudent(S)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let S=this.studentsInClassResults[0];this.form.controls.classId.setValue(S.classObj?.id),this.setupArrayStudent(S),this.form.controls.classId.valueChanges.subscribe(Z=>{const P=this.form.controls.selectAll;P&&P.setValue(!1),this.countStudentSelect=0;const I=this.studentsInClassResults.find(O=>O.classObj?.id===Z);I&&this.setupArrayStudent(I)})}}constructor(S,B,Z){super(B,Z),this.sortService=S,this.data=B,this.dialogRef=Z,this.studentsInClassResults=[],this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=B.isAskInfo,this.studentsInClassResults=B.studentsInClassResults.map(P=>({...P,results:P.results?.map(I=>({...I,reId:z.P.generateIdRequired(10)}))})),this.form=new b.gE({classId:new b.MJ(0,{nonNullable:!0,validators:[b.k0.required]}),selectAll:new b.MJ(!1,{nonNullable:!0}),listStudents:new b.Yp([]),schoolName:new b.MJ("",{nonNullable:!0}),subjectName:new b.MJ("",{nonNullable:!0})})}}return(V=X).\u0275fac=function(S){return new(S||V)(_.rXU(tt.g),_.rXU(h.Vh),_.rXU(h.CP,8))},V.\u0275cmp=_.VBU({type:V,selectors:[["app-select-student-to-export-docx"]],standalone:!0,features:[_.Vt3,_.aNF],decls:48,vars:35,consts:[["c","isDisabled"],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["name","x","size","16"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"change","checked"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"click","disabled"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"change","id"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(S,B){1&S&&(_.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),_.EFF(4),_.nI1(5,"mytranslate"),_.k0s(),_.j41(6,"div",5)(7,"a",6),_.nrm(8,"lucide-icon",7),_.k0s()()(),_.j41(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11),_.EFF(13),_.nI1(14,"mytranslate"),_.DNE(15,ze,2,1,"span",12),_.k0s()(),_.DNE(16,Te,4,6,"div",13),_.j41(17,"div",14)(18,"div",15)(19,"div",16),_.EFF(20),_.nI1(21,"mytranslate"),_.k0s()(),_.j41(22,"div",17)(23,"div",18)(24,"input",19),_.bIt("change",function(){return B.setChangeSelectAll()}),_.k0s(),_.j41(25,"label",20),_.EFF(26),_.nI1(27,"mytranslate"),_.k0s()()(),_.j41(28,"div",21)(29,"ng-scrollbar",22)(30,"div",23),_.DNE(31,Ke,5,5,"div",24),_.k0s()()(),_.j41(32,"div",15),_.DNE(33,oe,3,3,"span",25)(34,pe,7,7,"div",26),_.k0s()(),_.j41(35,"div",14)(36,"div",15)(37,"span",27),_.EFF(38),_.nI1(39,"mytranslate"),_.k0s()()()(),_.DNE(40,Xe,5,3,"div",26),_.k0s(),_.j41(41,"div",28)(42,"a",29),_.EFF(43),_.nI1(44,"mytranslate"),_.k0s(),_.j41(45,"button",30),_.bIt("click",function(){return B.confirmAction()}),_.EFF(46),_.nI1(47,"mytranslate"),_.k0s()()()()),2&S&&(_.R7$(4),_.JRh(_.bMT(5,21,"lang_testbank_what_to_export_select_students_export")),_.R7$(6),_.Y8G("formGroup",B.form)("hidden",0===B.studentsInClassResults.length),_.R7$(),_.Y8G("hidden",1===B.studentsInClassResults.length&&null==B.studentsInClassResults[0].classObj),_.R7$(2),_.SpI(" ",_.bMT(14,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),_.R7$(2),_.Y8G("ngIf",1===B.studentsInClassResults.length),_.R7$(),_.Y8G("ngIf",B.studentsInClassResults.length>1),_.R7$(),_.Y8G("hidden",0===B.form.controls.listStudents.controls.length),_.R7$(3),_.SpI("",_.bMT(21,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),_.R7$(4),_.Y8G("checked",B.form.controls.selectAll.value),_.R7$(2),_.JRh(_.bMT(27,27,"lang_auto_chon_tat_ca")),_.R7$(3),_.Y8G("visibility","hover"),_.R7$(2),_.Y8G("ngForOf",B.form.controls.listStudents.controls),_.R7$(2),_.Y8G("ngIf",0===B.countStudentSelect),_.R7$(),_.Y8G("ngIf",B.countStudentSelect>0),_.R7$(),_.Y8G("hidden",B.form.controls.listStudents.controls.length>0),_.R7$(3),_.SpI("* ",_.bMT(39,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),_.R7$(2),_.Y8G("ngIf",0===B.studentsInClassResults.length),_.R7$(3),_.SpI(" ",_.bMT(44,31,"lang_cms_common_close_btn")," "),_.R7$(2),_.Y8G("disabled",0===B.countStudentSelect),_.R7$(),_.SpI(" ",_.bMT(47,33,"lang_cms_common_confirm_btn")," "))},dependencies:[Ie.y,me.f,nt.i,te.MD,te.YU,te.Sq,te.bT,te.GH,b.X1,b.qT,b.me,b.Zm,b.Fm,b.BC,b.cb,b.j4,b.JD,b.v8,Y.iI,b.YN,le.wp,J.s,h.tx,rt.oV,G.flO,G.WGl,x.L,v.Id,v.Yh,F.k,He.t],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),X})();var L=g(28023),se=g(5382),je=g(64198),_e=g(25539),Se=g(81234),$e=g(92229),Le=g(14490),ht=g(50622),Ye=g(91640),qe=g(41325),Fe=g(58112),Ne=g(51113),ct=g(53393),Ze=g(99927),it=g(99172),Re=g(10933),vt=g(543),Ue=g(42801),fe=g(78472),We=g(87515),Je=g(10296),Lt=g(46899),xt=g(32610);let et=(()=>{var V;class X{processHomeworks(S,B){return new Promise((Z,P)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(B).subscribe(I=>{if(1==I.success){this.logger.remove();var O=[];I.data?.studentObjs.forEach(E=>{O.push({id:E.id,fullName:E.fullName,confirmedAt:E.confirmedAt,homeworkAnswerId:E.answer?.id,studentId:void 0,resultId:void 0,userId:void 0,nameImages:void 0,reId:"",status:void 0})}),this.sAztDialogService.open(Ee,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:I.data?.classroomObj,results:O,schoolName:void 0,subjectName:void 0}],examHasEssay:!1,isAskInfo:!1}}).afterClosed().subscribe(E=>{if(E){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===E.results?.length?"":E.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const R=new $e.Y(!0);this.logger.pushChild(R),this.loadLibAction(R).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===E.results?.length?"":E.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const M=new $e.Y(!0);this.logger.pushChild(M);const U=new se.n(1,{function:(xe,Pe,D)=>{M.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===Pe?"":"th\u1ee9 "+(xe+1)} ${D?": "+D:""}`)}});E.results?.forEach(xe=>{const Pe=new $e.Y;M.pushChild(Pe),U.addTask(this,this.makeFileHomework,[B,xe,Pe],xe.fullName??"")}),U.start().then(xe=>{M.remove(),0===xe.errs.length?this.finishHomework(E.classObj?.name??"",I.data?.homeworkObj?.name??"",xe,Z,P):(this.logger.remove(),this.sAztDialogService.open(de,{data:{result:xe},restoreFocus:!1}).afterClosed().subscribe(Pe=>{Pe&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(E.classObj?.name??"",I.data?.homeworkObj?.name??"",xe,Z,P))}))})}).catch(M=>{this.logger.remove(),P(M)})}})}else this.logger.remove(),P(new Error(this.commonService.myTranslateInstant(I.message)))})})}processClasses(S,B){return new Promise((Z,P)=>{let I;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),B){case"highest":I=this.testedListApiService.getTestedHighestMark("export_tool",S);break;case"first":I=this.testedListApiService.getTestedFirstMark("export_tool",S);break;default:I=this.testedListApiService.getTestedLastMark("export_tool",S)}I.subscribe(O=>{if(1==O.success){this.logger.remove();let E=!!O.data?.questionObjs?.filter(M=>this.answerTypeService.isEssayAnswer(M)).length,R=[];if(O.data?.studentsInClassResults?.forEach(M=>{let U=[];M.results?.forEach(xe=>{U.push({id:xe.id?Number(xe.id):void 0,fullName:xe.fullName??"",confirmedAt:xe.confirmedAt,studentId:xe.studentId?Number(xe.studentCode):void 0,resultId:xe.resultId,userId:xe.userId?.toString(),nameImages:xe.nameImages,reId:"",status:xe.status})}),R.push({classObj:M.classObj,results:U,schoolName:void 0,subjectName:void 0})}),O.data?.studentsNotInClassResults&&O.data?.studentsNotInClassResults?.length>0){let M=[];O.data.studentsNotInClassResults.forEach(U=>{M.push({id:U.id?Number(U.id):void 0,fullName:U.fullName??"",confirmedAt:U.confirmedAt,studentId:U.studentId?Number(U.studentCode):void 0,resultId:U.resultId,userId:U.userId?.toString(),nameImages:U.nameImages,reId:"",status:U.status})}),R.push({classObj:{id:0,name:this.commonService.myTranslateInstant("lang_auto_tu_do")??""},results:M,schoolName:void 0,subjectName:void 0})}this.sAztDialogService.open(Ee,{data:{studentsInClassResults:R,examHasEssay:E,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(M=>{M?this.sAztDialogService.open(Le.T,{data:{transactionType:"export-docx",times:M.results?.length,returnUrl:this.commonService.getCurrentUrlWithoutLocale()},hasBackdrop:!1}).afterClosed().subscribe(U=>{if("cancel"==U||"upgrade"==U)return this.logger.remove(),void Z();this.expandInfoParse=this.commonService.castJsonToObj(O.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===M.results?.length?"":M.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(S,M,M.classObj?.name??"",O.data?.examObj,M.classObj?.id).then(()=>{this.logger.remove(),Z()}).catch(Pe=>{this.logger.remove(),P(Pe)})}):(this.logger.remove(),Z())})}else this.logger.remove(),P(new Error(this.commonService.myTranslateInstant(O.message)??""))})})}processUser(S,B,Z,P,I,O=!0,E,R,M,U,xe){return new Promise((Pe,D)=>{this.reset(),I=I||this.logger,I?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const Ve=new $e.Y(!0);I?.pushChild(Ve),this.loadLibAction(Ve).then(()=>{I?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(S,Z??"",P??"",B,xe).subscribe(De=>{if(1==De.success){this.expandInfoParse=this.commonService.castJsonToObj(De.data?.examObj?.expandInfo??"{}")??{},I?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let mt=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const ut=De.data?.studentObj;I?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${ut?.fullName??""}`);let pt="";pt=De.data?.classroomObj?De.data?.classroomObj.name??mt:mt;const Be=De.data?.examTracks,gt=De.data?.examObj,Et=De.data?.examResultObj,dt=this.commonService.castJsonToClassObjs(_e.I,JSON.stringify(De.data?.questionObjs))??[];let Pt=0,At=0;for(let wt=0;wt<dt.length;wt++)dt[wt].correctAnswer=this.commonService.isExistInArray(De.data?.correctQuestionIds,dt[wt].id),dt[wt].indexLabel=wt+(gt?.startQuestionIndex??1),gt?.resetQuestionIndex&&dt[wt].groupInfo&&dt[wt].groupInfo?.groupId&&(dt[wt].groupInfo&&Pt!=dt[wt].groupInfo?.groupId&&(Pt=dt[wt].groupInfo?.groupId??0,At=0),dt[wt].labelIndex=At+(gt?.startQuestionIndex??1),At++);const Ot={};let Ft=this.commonService.castJsonToObj(De.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(Ft??[],Ot);const qt=new $e.Y;I?.pushChild(qt),this.processConvertDataUser(qt,dt,ut,Et).then(wt=>{if(wt){var In=0;this.convertDataMarkNote(wt?.resultTeacherDraw).then(Vt=>{this.loadTeacherDrawResult(Vt,I??new $e.Y,ut?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",wt).then(W=>{wt=W,qt.remove();const st=new $e.Y(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+`...${In}%`);I?.pushChild(st);let k=[];k.push({content:this.getLineInfoData(pt,gt,Be,Et,ut,dt,wt,E,R).join("<br/>")+"<br/><br/><br/>",answers:[]}),k=k.concat(this.startGenUserLineFile(Et,dt,wt,M,U));var Oe=0;this.sAztDocxService.exportToDocxBinary((0,Se.Wn)(k),{isHeadless:!0},(ot,Ht,on)=>{new Promise(wn=>{setTimeout(()=>{0==ot&&(In=Oe),Oe=ot/Ht*50+In;const rn=this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word")+"..."+Math.floor(Oe)+"%";st?.pushMsg(rn)}),wn(!0)})}).then(ot=>{const Ht=new Blob([ot],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let on=this.commonService.createFileNameExportFile([ut?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",Et?.id?Et.id.toString():""])+"_test_result";if(O)if(wt.mediaAnswerWraps.concat(wt.mediaWraps).length>0){const wn=new o;wn.file(on+".docx",Ht),wt.mediaAnswerWraps.concat(wt.mediaWraps).forEach(rn=>{const xn=new Blob([rn]);wn.file("attachments/"+this.replaceParamFileName(rn.name),xn)}),wn.generateAsync({type:"blob"}).then(rn=>{let xn=this.commonService.createFileNameExportFile([pt,on])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(rn,xn),I?.remove(),Pe()},rn=>{I?.remove(),Pe(rn)})}else this.shareFileFlutterService.shareFileWithBlob(Ht,on+".docx"),I?.remove(),Pe();else I?.remove(),Pe({name:on,blob:Ht,medias:wt.mediaAnswerWraps.concat(wt.mediaWraps)})})})})}}).catch(wt=>{I?.remove(),D(wt)})}else I?.remove(),D(new Error(this.commonService.myTranslateInstant(De.message)))})}).catch(De=>{I?.remove(),D(De)})})}finishClassroom(S,B,Z,P,I){if(Z.length>1){const O=new o;Z.forEach(E=>{E.medias.length>0?(O.file(E.name+"/"+E.name+".docx",E.blob),E.medias.forEach(R=>{const M=new Blob([R]);O.file(E.name+"/attachments/"+this.replaceParamFileName(R.name),M)})):O.file(E.name+".docx",E.blob)}),O.generateAsync({type:"blob"}).then(E=>{let R=this.commonService.createFileNameExportFile([S,B])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(E,R),P()},E=>{P(E)})}else if(Z[0].medias.length>0){const O=new o;O.file(Z[0].name+"/"+Z[0].name+".docx",Z[0].blob),Z[0].medias.forEach(E=>{const R=new Blob([E]);O.file(Z[0].name+"/attachments/"+this.replaceParamFileName(E.name),R)}),O.generateAsync({type:"blob"}).then(E=>{let R=this.commonService.createFileNameExportFile([S,B])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(E,R),P()},E=>{P(E)})}else this.shareFileFlutterService.shareFileWithBlob(Z[0].blob,Z[0].name+".docx"),P()}finishHomework(S,B,Z,P,I){if(1===Z.datas.length)if(Z.datas[0].medias.length>0){const O=new o;O.file(Z.datas[0].name+"/"+Z.datas[0].name+".docx",Z.datas[0].blob),Z.datas[0].medias.forEach(E=>{const R=new Blob([E]);O.file(Z.datas[0].name+"/attachments/"+this.replaceParamFileName(E.name),R)}),O.generateAsync({type:"blob"}).then(E=>{let R=this.commonService.createFileNameExportFile([S,Z.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(E,R),P()},E=>{this.logger.remove(),P(E)})}else this.shareFileFlutterService.shareFileWithBlob(Z.datas[0].blob,Z.datas[0].name+".docx"),this.logger.remove(),P();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const O=new o;Z.datas.forEach(E=>{E.medias.length>0?(O.file("results/"+E.name+"/"+E.name+".docx",E.blob),E.medias.forEach(R=>{const M=new Blob([R]);O.file("results/"+E.name+"/attachments/"+this.replaceParamFileName(R.name),M)})):O.file("results/"+E.name+".docx",E.blob)}),O.generateAsync({type:"blob"}).then(E=>{let R=this.commonService.createFileNameExportFile([S,B])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(E,R),this.logger.remove(),P()},E=>{this.logger.remove(),I(E)})}}makeFileHomework(S,B,Z){return new Promise((P,I)=>{Z.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(S,B.homeworkAnswerId??0).subscribe(O=>{if(Z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(O.data?.answerObj),O.data?.answerObj){Z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let R=this.commonService.castJsonToObj(O.data.answerObj.result??"")??{};this.convertDataMarkNote(R).then(M=>{this.loadTeacherDrawResult(M,Z,B.fullName??"").then(U=>{Z.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let xe=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${O.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${O.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${O.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${O.data?.answerObj?.id} <br/>`].forEach(D=>{xe.push({content:D,answers:[]})});let Pe=this.commonService.castJsonToObj(O.data?.answerObj?.resultNote??"");if(Pe){const D=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],Ve=document.createElement("p");Ve.innerText=this.commonService.myTranslateInstant("lang_point")??"",Ve.setAttribute("docx-style",Se.$s.get("TB_RESULT_TXT"));const De=document.createElement("p");let mt=O.data?.answerObj?.point;D.forEach(Be=>{Be.mark===mt&&(mt=this.commonService.myTranslateInstant(Be.lang))}),De.innerText=mt?.toString()??"",De.setAttribute("docx-style",Se.$s.get("TB_RESULT_POINT"));const ut=document.createElement("p");ut.setAttribute("docx-style",Se.$s.get("TB_RESULT_TXT")),ut.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const pt=document.createElement("span");pt.setAttribute("docx-style",Se.$s.get("TB_RESULT_COMMENT")),0===Pe?.IsHideMark&&(pt.innerText=this.getTextContentInTagHTML(Pe.Note),U.resultTeacherDraw?.commentEmoji&&(pt.appendChild(document.createElement("br")),U.resultTeacherDraw.commentEmoji.forEach(Be=>{if(U.canvasList[Be]){const gt=new Image;gt.src=U.canvasList[Be].toDataURL(),gt.style.width=U.canvasList[Be].width/5+"px",gt.style.height=U.canvasList[Be].height/5+"px",pt.appendChild(gt)}}))),xe.push({content:Se.$s.makeHeaderTable([Ve,De],[ut,pt]),answers:[]})}xe=xe.concat(this.getLineImageAnswer(U)),this.sAztDocxService.exportToDocxBinary((0,Se.Wn)(xe),{isHeadless:!0},(D,Ve,De)=>{}).then(D=>{Z.remove();const Ve=new Blob([D],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let De=`${this.commonService.convertVietnameseToEnglish(B.fullName??"")}_${O.data?.answerObj?.id??0}`;P({name:De,blob:Ve,medias:U.mediaAnswerWraps.concat(U.mediaWraps)})})}).catch(U=>{Z.remove(),I(U)})})}else Z.remove(),I(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(S,B,Z,P,I){return new Promise((O,E)=>{const R=new se.n(1,{function:(xe,Pe)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===Pe?"":` (${xe+1}/${Pe})`}`),this.logger.percent=xe/Pe}},1e3),M=[];let U=this.homeworkExamService.isOfflineExam(P);B.results?.forEach(xe=>{R.addTask(this,()=>new Promise((Pe,D)=>{const Ve=new $e.Y(!0,"");this.logger.pushChild(Ve),this.processUser(S,Number(xe.resultId),xe.userId,xe.studentId?.toString(),Ve,!1,B.schoolName,B.subjectName,U,void 0,I).then(De=>{De?(Ve.remove(),M.push(De),Pe()):(Ve.remove(),D(new Error))}).catch(De=>{Ve.remove(),D(De)})}))}),R.start().then(xe=>{xe.errs.length>0?(this.logger.remove(),xe.datas=M,this.sAztDialogService.open(de,{data:{result:xe},restoreFocus:!1}).afterClosed().subscribe(Pe=>{Pe&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom(Z,P?.name??"",M,O,E))})):this.finishClassroom(Z,P?.name??"",M,O,E)})})}processConvertDataUser(S,B,Z,P){return new Promise((I,O)=>{let E={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},R=(this.commonService.myParseJson(P?.files??"[]")??[]).filter(De=>(0,je.rl)(De.mimes??"")||(0,je.nL)(De.mimes??""));S.start();const Ve=new se.n(1,{function:(De,mt,ut)=>{S.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${De+1}/${mt}: ${ut}`)}});Ve.addTask(this,()=>new Promise((De,mt)=>{const ut=new $e.Y(!0);S.pushChild(ut),this.questionRenderService.parseRenderQuestions(B,pt=>{ut.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(pt)}%`)},void 0,50,!0).then(()=>{ut.remove(),De()}).catch(pt=>{const Be=gt=>{Object.prototype.hasOwnProperty.call(gt,"type")&&"LOAD_IMAGE"===gt.type?mt(new Error(`${gt.message} ${this.commonService.trimMidLimitLength(gt.data[0],30)}`)):mt(pt)};ut.remove(),Array.isArray(pt)?Be(pt[0]):Be(pt)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),P&&P.result&&Ve.addTask(this,()=>new Promise((De,mt)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj(P?.result??"")??{},S,Z?.fullName??"").then(ut=>{E=ut,De()}).catch(ut=>{mt(ut)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),Ve.addTask(this,()=>new Promise((De,mt)=>{Z?this.loadNameImage(Z).then(ut=>{Z=ut,De()}).catch(ut=>{mt(ut)}):mt(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),E.isExportMedia&&Ve.addTask(this,()=>new Promise((De,mt)=>{const ut=new $e.Y(!0);S.pushChild(ut);const pt=new se.n(3,{function:(Be,gt)=>{ut.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${Be}/${gt})`)}},100);B.forEach(Be=>{Be.attachments&&Be.attachments.length>0&&Be.attachments.forEach(gt=>{pt.addTask(this,this.loadAztFile,[gt,E,"att"])})}),pt.start().then(Be=>{0===Be.errs.length?(ut.remove(),De()):(ut.remove(),mt(Be.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),R.length&&Ve.addTask(this,()=>new Promise((De,mt)=>{const ut=new $e.Y(!0);S.pushChild(ut);const pt=new se.n(3,{function:(Be,gt)=>{ut.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${Be}/${gt})`)}},100);R.forEach(Be=>{pt.addTask(this,this.loadAztFile,[Be,E,"ans"])}),pt.start().then(Be=>{0===Be.errs.length?(ut.remove(),De()):(ut.remove(),mt(Be.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem_tu_luan")),Ve.start().then(De=>{S.remove(),0===De.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(B,P),I(E)):O(De.errs[0])})})}hasMultiple(S){let B=!1;for(let Z=0;Z<S.length;Z++)if(this.answerTypeService.isOneChoiceAnswer(S[Z])){B=!0;break}return B}hasEssay(S){let B=!1;for(let Z=0;Z<S.length;Z++)if(this.answerTypeService.isEssayAnswer(S[Z])){B=!0;break}return B}getLineInfoData(S,B,Z,P,I,O,E,R,M){const U=[];U.push(Se.$s.makeHeaderTable([Se.$s.createLineCenterBold(R||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toUpperCase()} }`)],[Se.$s.createLineCenterBold(B?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),Se.$s.createLineCenterBold(M||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),Se.$s.createLineCenterBold(B?.minutes&&B?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+B?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const xe=O.filter(Pe=>this.answerTypeService.isEssayAnswer(Pe)).length;return I&&I.nameImages&&parseInt(I?.id??"0")<=0?U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${I?.nameImages.url}" />`):U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${I?.fullName}`),U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${S}`),B?.subjectMarks&&P?.subjectMarkValues&&P.subjectMarkValues.forEach((Pe,D)=>{U.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${D+1} </b>: ${Pe}/10`)}),this.hasMultiple(O)&&U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${P?.trueFalseMark} (${P?.rightAnswer}/${(P?.totalQuestion??0)-xe} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(O)&&U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${P?.essayMark+" ("+xe+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(O)&&E.resultTeacherDraw&&U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj(P?.files??"")?.length??"0"}`),Z&&0!=B?.autoMonitor&&(U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${Z.exitFullScreen}`),U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${Z.blurWindow}`)),U.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${P?.id}`),U}startGenUserLineFile(S,B,Z,P,I){let O=[];const E=this.commonService.castJsonToObj(S?.answers??"");return E&&B.forEach((R,M)=>{R.groupInfo&&R.groupInfo.isFirstInGroup&&O.push({content:`<br/><b>${R.groupInfo.groupContent}</b><br/>`,answers:[]}),R.attachments&&Z.isExportMedia&&R.attachments.forEach(xe=>{O.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(xe.name)}]`,answers:[]})}),O=O.concat(this.genLineQuestion(R,P));const U=this.mapQuestResultObj(R,E??[]);switch(R.answerType){case 1:O=O.concat(this.genLineAnswerType1(R,U));break;case 3:let xe=S?.confirmedAt?new L.X(this.commonService).parserEssayResult(S.essayResult):[],Pe=(S?.confirmedAt?S?.essayAnswerObjs:[])??[],D=xe.find(De=>De.questionIndex==M),Ve=Pe.find(De=>De.questionId==R.id)??{questionId:R.id,comment:void 0,mark:D?.questionMark};O=O.concat(this.genLineAnswerType3(R,U,{questionId:R.id,comment:Ve?.comment,mark:Ve?.mark??0}));break;case 4:O=O.concat(this.genLineAnswerType4(R,U));break;case 5:O=O.concat(this.genLineAnswerTrueFalseType5(R,U))}I&&R.help&&O.push({content:`<br/><b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b> ${R.help}<br/><br/>`,answers:[]})}),this.hasEssay(B)&&(O=O.concat(this.getLineImageAnswer(Z))),O}genLineQuestion(S,B){const Z=[];let P=this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"),I=this.answerTypeService.isFillAnswer(S)?this.commonService.myTranslateInstant("azt_lang_sugg_type_fill_blank"):this.answerTypeService.isEssayAnswer(S)?this.commonService.myTranslateInstant("azt_lang_sugg_type_essay"):this.commonService.myTranslateInstant("azt_lang_sugg_type_multiple_choice"),O={content:"<b>"+P+" "+(S.labelIndex??S.indexLabel??1)+". "+(B?`(${I})`:"")+"</b> "+(S.content?.includes("<img")?"<br/>":"")+S.content,answers:B&&(this.answerTypeService.isFillAnswer(S)||this.answerTypeService.isEssayAnswer(S))?[]:this.convertAnswerQuestion(S.answers??[],!!this.answerTypeService.isTrueFalseAnswer(S))};return Z.push(O),Z}mapQuestResultObj(S,B){return B.find(P=>P.QuestionId===S.id)||{QuestionId:S.id??0,AnswerContent:[]}}convertAnswerQuestion(S,B){let Z=[];return S.forEach(P=>{let I=P.alpha?P.alpha:P.key,O="<b>     "+(B?I.toLocaleLowerCase()+")":I)+".</b> "+P.content;Z.push(O)}),Z}genLineAnswerType1(S,B){const Z=document.createElement("table"),P=S.correctAnswer?Se.JP:Se.ep;Z.setAttribute("docx-style",Se.$s.get("TABLE"));const I=[],O=document.createElement("tr");Z.appendChild(O);const E=document.createElement("td");E.setAttribute("docx-style",Se.$s.get("CORRECT",[{key:Se.Xe,value:P}]));const R=document.createElement("span"),M=S.answers?S.answers.filter(Pe=>S.answerResult?.includes(Pe.key)).map(Pe=>Pe.alpha??Pe.key).join(" & "):S.answerResult?.join(" & ");R.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+M,R.setAttribute("color",P),E.appendChild(R),O.appendChild(E);const U=document.createElement("span"),xe=document.createElement("span");return U.innerText="\u2713",U.setAttribute("color",Se.JP),xe.innerText="\u2717",xe.setAttribute("color",Se.ep),S.answers?.forEach((Pe,D)=>{const Ve=document.createElement("td"),De=document.createElement("span"),mt=[{key:Se.Xe,value:P}];mt.push({key:Se.n1,value:D+1===S.answers?.length?P:"FFFFFF"}),Ve.setAttribute("docx-style",Se.$s.get("KEY_RESULT",mt)),De.innerText=Pe.alpha??Pe.key,B.AnswerContent.filter(pt=>pt.Content===Pe.key).length>0&&Ve.appendChild(S.correctAnswer?U:xe),Ve.appendChild(De),O.appendChild(Ve)}),I.push({content:`<br>${Z.outerHTML}<br><br><br>`,answers:[]}),I}genLineAnswerTrueFalseType5(S,B){const Z=[],P=S.correctAnswer?Se.JP:Se.ep,I=this.commonService.myTranslateInstant("lang_auto_dung"),O=this.commonService.myTranslateInstant("lang_auto_sai"),E=this.sAztAnswerTrueFalseService.checkLabelKeys([],S?.answers,S?.answerResult),R=(mt,ut)=>{const pt=document.createElement("span");return pt.innerText=mt,pt.setAttribute("color",ut),pt},xe=document.createElement("table");xe.setAttribute("docx-style",Se.$s.get("TABLE"));const Pe=document.createElement("tr"),D=R(this.commonService.myTranslateInstant("lang_auto_dap_an")??"",P),Ve=document.createElement("td"),De=[{key:Se.Xe,value:P}];return De.push({key:Se.n1,value:P}),Ve.setAttribute("docx-style",Se.$s.get("KEY_RESULT",De)),S.answers?.forEach(mt=>{const ut=this.sAztAnswerTrueFalseService.checkIsTrueType5(mt,E,B.AnswerContent),pt=this.commonService.myTranslateInstant(this.sAztAnswerTrueFalseService.getAnswerChoiceTrueFalseQuestion(mt,B.AnswerContent))??"";Ve.appendChild(((mt,ut,pt)=>{const Be=document.createElement("div"),gt=document.createElement("span"),Et=ut?Se.JP:Se.ep;return gt.innerText=(mt.alpha??mt.key).toLowerCase()+"-",Be.appendChild(R(ut?"\u2713":"\u2717",Et)),Be.appendChild(gt),Be.appendChild(R(pt??"",Et)),Be})(mt,ut,pt)),Ve.appendChild(document.createElement("br"))}),Pe.appendChild(((mt,ut)=>{const pt=document.createElement("td");return pt.appendChild(mt),S.answers.length&&S.answers.forEach(Be=>{const gt=document.createElement("span");gt.setAttribute("color",this.sAztAnswerTrueFalseService.checkIsTrueType5(Be,E,B.AnswerContent)?Se.JP:Se.ep),gt.innerText=` ${(Be.alpha?Be.alpha:Be.key?Be.key:Be).toString().toLowerCase()}-${E.includes((Be.alpha?Be.alpha:Be.key?Be.key:"")+"T")?I:O} `,pt.appendChild(gt)}),pt.setAttribute("docx-style",ut),pt})(D,Se.$s.get("CORRECT",[{key:Se.Xe,value:P}]))),Pe.appendChild(Ve),xe.appendChild(Pe),Z.push({content:`<br>${xe.outerHTML}<br><br><br><br><br><br>`,answers:[]}),Z}genLineAnswerType3(S,B,Z){const P=[];return P.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/><br/>`,answers:[]}),0===B.AnswerContent.length?P.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):B.AnswerContent.forEach(I=>{P.push({content:`<span>${I.Content}</span>`,answers:[]})}),P.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${Z.mark??0} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${S.scorePerQuestion})</b>`,answers:[]}),P.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_nhan_xet")}:</b> ${Z.comment??""}`,answers:[]}),P}genLineAnswerType4(S,B){const Z=document.createElement("table"),P=S.correctAnswer?Se.JP:Se.ep;Z.setAttribute("docx-style",Se.$s.get("TABLE"));const I=[],O=document.createElement("tr");O.setAttribute("docx-style",Se.$s.get("TR")),Z.appendChild(O);const E=document.createElement("td");E.setAttribute("docx-style",Se.$s.get("CORRECT",[{key:Se.Xe,value:P}]));const R=document.createElement("span");R.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+S.answerResult?.join(";")+"]",R.setAttribute("color",P),E.appendChild(R),O.appendChild(E),0===B.AnswerContent.length&&B.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const M=document.createElement("td"),U=document.createElement("span");return M.setAttribute("docx-style",Se.$s.get("FILL_RESULT",[{key:Se.Xe,value:P}])),U.innerText=B.AnswerContent.map(Pe=>Pe.Content).join(";"),M.appendChild(U),O.appendChild(M),I.push({content:`<br>${Z.outerHTML}<br><br><br>`,answers:[]}),I}loadNameImage(S){return new Promise((B,Z)=>{S&&S.nameImages&&parseInt(S?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(S.nameImages).then(P=>{P&&S.nameImages&&(S.nameImages.url=P),B(S)}).catch(P=>{Z(P)}):B(S)})}loadCssFrameAction(){return new Promise(S=>{const B=document.createElement("div"),Z=P=>{const I=document.createElement("span");return I.style.fontFamily=P,I.innerText="Aa",I};B.appendChild(Z("font_chu_dep")),B.appendChild(Z("font_chu_dep_z")),B.appendChild(Z("font_chu_in")),B.appendChild(Z("font_chu_in_nghieng")),B.appendChild(Z("font_chu_in_dam")),B.style.opacity="0",document.body.appendChild(B),setTimeout(()=>{B.remove(),S()},2e3)})}loadLibAction(S){return new Promise((B,Z)=>{this.commonService.loadAzotaDocxJs().then(()=>{const P=new se.n(1,{function:(I,O,E)=>{S.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${I+1}/${O}: ${E}`)}});P.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),P.start().then(I=>{S.remove(),I.errs.length>0?Z(I.errs[0]):B()})}).catch(P=>{Z(P)})})}reset(){}checkUrlIsImage(S){return null!=S.match(/\.(jpeg|jpg|png|gif)(\?.*)?$/)}loadAztFile(S,B,Z){return new Promise((P,I)=>{fetch(this.sAztCommonCdnService.getMyCdn(S.url??"")).then(O=>{O.ok?O.blob().then(E=>{const M=new File([E],S.name??"",{type:S.mimes});"ans"===Z?B.isExportAnsMedia&&B.mediaAnswerWraps.push(M):B.isExportMedia&&B.mediaWraps.push(M),P()}):I(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${S.name}`))}).catch(()=>{I(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${S.name}`))})})}wrapLoadMedia(S,B){return this.checkUrlIsImage(S)?(0,je.qO)(S,B):new Promise((Z,P)=>{Z(void 0)})}replaceImageToBase64(S,B,Z,P,I,O){return new Promise((E,R)=>{Object.prototype.hasOwnProperty.call(S,B)&&"string"==typeof S[B]?this.wrapLoadMedia(S[B],I).then(M=>{if(M){const U=document.createElement("canvas");U.width=M.width,U.height=M.height,U.getContext("2d")?.drawImage(M,0,0),S[B]=Z.canvasList.push(U)-1,E()}else{O=O?O+1:1;let U=S[B].split(".");U=U.length>0?U[U.length-1]:"mp3";const xe=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",O.toString(),P])+"."+U;this.loadAztFile({name:this.commonService.replaceAll(xe,"_"," ")??"",url:S[B],path:"",extension:"",mimes:"",size:"0",lastModified:0},Z,"ans").then(()=>{E()}).catch(Pe=>{R(new Error(this.commonService.myTranslateInstant(Pe.message)+(P.length>0?" : "+P:"")))})}}).catch(M=>{R(new Error(this.commonService.myTranslateInstant(M.message)+(P.length>0?" : "+P:"")))}):R(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+(P.length>0?" : "+P:"")))})}loadTeacherDrawResult(S,B,Z,P){return new Promise((I,O)=>{const E=P??{canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},R=new se.n(3,{function:(M,U)=>{B.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${M}/${U})`)}});if(E.resultTeacherDraw=S,E.resultTeacherDraw){E.resultTeacherDraw.pages?.forEach((U,xe)=>{R.addTask(this,this.replaceImageToBase64,[U,"backgroundImage",E,Z,this.sAztCommonCdnService,xe]),U.draw&&R.addTask(this,this.replaceImageToBase64,[U,"draw",E,Z,this.sAztCommonCdnService,xe])});const M=this.commonService.castJsonToObj(E.resultTeacherDraw.staticTextConfig??"");if(E.resultTeacherConfig=M,E.resultTeacherConfig&&E.resultTeacherConfig.urlImgCorrect&&E.resultTeacherConfig.urlImgWrong&&(E.resultTeacherConfig.urlImgCorrect=(E.resultTeacherConfig.type?"":"core-mod-assets/images/classlive/")+E.resultTeacherConfig.urlImgCorrect,E.resultTeacherConfig.urlImgWrong=(E.resultTeacherConfig.type?"":"core-mod-assets/images/classlive/")+E.resultTeacherConfig.urlImgWrong,R.addTask(this,this.replaceImageToBase64,[E.resultTeacherConfig,"urlImgCorrect",E,Z]),R.addTask(this,this.replaceImageToBase64,[E.resultTeacherConfig,"urlImgWrong",E,Z])),E.resultTeacherDraw.commentEmoji&&E.resultTeacherDraw.commentEmoji.length>0)for(let U=0;U<E.resultTeacherDraw.commentEmoji.length;U++)E.resultTeacherDraw.commentEmoji[U]="https://azota889.github.io/storage_public/mnote/"+E.resultTeacherDraw.commentEmoji[U],R.addTask(this,this.replaceImageToBase64,[E.resultTeacherDraw.commentEmoji,U,E,Z])}R.start().then(M=>{0===M.errs.length?I(E):O(M.errs[0])})})}capitalized(S){return S?S.charAt(0).toUpperCase()+S.slice(1):""}wrapText(S,B,Z,P,I,O){const E=document.createElement("span");E.innerHTML=this.commonService.removeXssInHtml(B),(B=E.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(M=>{for(var U=M.split(" "),xe="",Pe=0;Pe<U.length;Pe++){var D=xe+U[Pe]+" ";S.measureText(D).width>I&&Pe>0?(S.fillText(xe,Z,P),xe=U[Pe]+" ",P+=O):xe=D}S.fillText(xe,Z,P)})}getLineImageAnswer(S){const B=[];return S.mediaAnswerWraps&&S.isExportAnsMedia&&S.mediaAnswerWraps.forEach(Z=>{B.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${this.replaceParamFileName(Z.name)}}</span>`,answers:[]})}),S.resultTeacherDraw&&S.resultTeacherDraw.pages?.forEach(Z=>{let P=S.canvasList[Number(Z.backgroundImage)];if(P){const I=document.createElement("canvas");I.width=Z.width??1,I.height=Z.height??1;const O=I.getContext("2d");if(O){O.fillStyle="#FFFFFF",O.fillRect(0,0,I.width,I.height);let M=document.createElement("canvas"),U=M.getContext("2d");0!==Z.rotation&&U?(90===Math.abs(Z.rotation??0)?(M.width=P.height,M.height=P.width):(M.width=P.width,M.height=P.height),U.translate(M.width/2,M.height/2),U.rotate(((Z.rotation??0)>0?1:-1)*(Z.rotation??0)*Math.PI/180),U.drawImage(P,-P.width/2,-P.height/2),U.restore()):M=P;const xe=I.height/M.height*M.width;if(O.drawImage(M,0,0,M.width,M.height,(I.width-xe)/2,0,xe,I.height/M.height*M.height),Z.draw){const Ve=S.canvasList[Number(Z.draw)];Ve&&O.drawImage(Ve,0,0)}if(Z.staticText&&Z.staticText.length>0&&Z.staticText.forEach(Ve=>{if(O.font=`${S.resultTeacherConfig?.fontSize}px ${S.resultTeacherConfig?.fontText}`,O.fillStyle=S.resultTeacherConfig?.fontColor??"#000000",S.resultTeacherConfig?.useCorrectText&&"correct"==Ve.value&&this.wrapText(O,S.resultTeacherConfig?.textCorrect??"",Ve.x,Ve.y,I.width-Ve.x,25),S.resultTeacherConfig?.useCorrectText&&"wrong"==Ve.value&&this.wrapText(O,S.resultTeacherConfig?.textWrong??"",Ve.x,Ve.y,I.width-Ve.x,25),!S.resultTeacherConfig?.useCorrectText&&"correct"==Ve.value){const De=S.canvasList[Number(S.resultTeacherConfig?.urlImgCorrect)];De&&O.drawImage(De,0,0,De.width,De.height,Ve.x,Ve.y,30,30)}if(!S.resultTeacherConfig?.useWrongText&&"wrong"==Ve.value){const De=S.canvasList[Number(S.resultTeacherConfig?.urlImgWrong)];De&&O.drawImage(De,0,0,De.width,De.height,Ve.x,Ve.y,30,30)}}),Z.objText&&Z.objText.length>0){let Ve=300;Z.objText.forEach(De=>{O.font=`${parseFloat(De.textStyle.size)}px ${De.textStyle.font}`,O.fillStyle=De.textStyle.color,O.textAlign=De.textStyle.align??"center",O.lineWidth=De.textStyle.width??Ve,this.wrapText(O,De.value,De.x,De.y,I.width-De.x,25)})}}const E=693,R=E/I.width;B.push({content:`<img src="${I.toDataURL()}" style="width:${E}px;height:${I.height*R}px" /><br/>`,answers:[]})}}),0===B.length?B.push({content:`<br/><br/>${Se.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):B.unshift({content:`<br/>${Se.$s.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),B}convertDataMarkNote(S){return new Promise((B,Z)=>{S&&S.urlDataMark?this.sAztCommonCdnService.loadTextCdn(this.sAztCommonCdnService.getMyCdn(S.urlDataMark)).subscribe(P=>{const I=this.zipDataService.decodeContentGzip(P),O=this.commonService.castJsonToObj(I);S.pages=[];let E={};O?.pages.forEach((U,xe)=>{let Pe={width:U.width,height:U.height,draw:U.draws?.[0]?.src??void 0,backgroundImage:U.backgroundSrc,rotation:U.backgroundRotate,objText:[],staticText:[]};U.childData?.length&&U.childData.forEach((D,Ve)=>{if("UIQuickMark"==D.className&&(Pe.staticText?.push({x:D.x+5,y:D.y+(D.height+5+D.fontSize)/2,value:"type_right"===D.type?"correct":"wrong"}),0===Ve&&(E={txtCommentFont:D.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:D.width,correctHeight:D.height,wrongWidth:D.width,wrongHeight:D.height,fontText:D.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:D.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!E.urlImgWrong&&"type_wrong"==D.type&&(E.urlImgWrong=D.imageSrc),!E.urlImgCorrect&&"type_right"==D.type&&(E.urlImgCorrect=D.imageSrc),!E.textWrong&&"type_wrong"==D.type&&(E.textWrong=D.textContent),!E.textCorrect&&"type_right"==D.type&&(E.textCorrect=D.textContent),E.useCorrectText=!E.urlImgCorrect,E.useWrongText=!E.urlImgWrong,"UIText"===D.className){let De=this.getStyleContent(D.textContent);Pe.objText?.push({x:D.x+15,y:D.y+15,value:D.textContent,textStyle:{size:D.fontSize?D.fontSize:De?.fontSize,align:De?.textAlign??"left",color:De?.color,fill:!0,font:De?.fontFamily}})}}),S.pages?.push(Pe)}),S.staticTextConfig=this.commonService.serializeJson(E),B(S)}):B(S??{})})}getStyleContent(S){let B=document.createElement("div");B.innerHTML=this.commonService.removeXssInHtml(S);let Z=B.querySelector("p"),P=B.querySelector("span");return P?{fontSize:P.style.fontSize,color:P.style.color,fontFamily:P.style.fontFamily,textAlign:Z?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(S){return(new DOMParser).parseFromString(S,"text/html").body.textContent??S}replaceParamFileName(S){return S.replace(/\?.*$/,"")}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}constructor(S,B,Z,P,I,O,E,R,M,U,xe,Pe,D,Ve,De,mt){this.sAztAnswerTrueFalseService=S,this.homeworkExamService=B,this.checkDrawImgNameService=Z,this.sAztCommonCdnService=P,this.zipDataService=I,this.exportPdfUtilsService=O,this.answerTypeService=E,this.exportPdfConvertDataService=R,this.questionRenderService=M,this.commonService=U,this.answerService=xe,this.examResultService=Pe,this.testedListApiService=D,this.shareFileFlutterService=Ve,this.sAztDialogService=De,this.sAztDocxService=mt,this.logger=new $e.Y,this.expandInfoParse={}}}return(V=X).\u0275fac=function(S){return new(S||V)(_.KVO(ht.j),_.KVO(Ye.Z),_.KVO(qe.E),_.KVO(Fe.c),_.KVO(Ne.j),_.KVO(ct.j),_.KVO(Ze._),_.KVO(it.p),_.KVO(Re.g),_.KVO(vt.R),_.KVO(Ue._t),_.KVO(fe._j),_.KVO(We.h),_.KVO(Je.R),_.KVO(Lt.i),_.KVO(xt.I))},V.\u0275prov=_.jDH({token:V,factory:V.\u0275fac,providedIn:"root"}),X})()},92229:(Tt,Ae,g)=>{"use strict";g.d(Ae,{Y:()=>o});class o{pushChild(y){this.child.push(y)}pushMsg(y){this.msg=y}start(y){this.run=!0,y&&(this.msg=y)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const y=[];return this.msg&&""!==this.msg&&y.push(this.msg),`<p>${y.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let y=[];return this.child.filter(ce=>ce.run).forEach(ce=>{y=y.concat(ce.lines)}),y}constructor(y=!1,ce="",te){this.run=y,this.msg=ce,this.percent=te,this.child=[]}}},49786:(Tt,Ae,g)=>{"use strict";g.d(Ae,{i:()=>Vt});var o=g(48891),h=g(407),y=g(59702),ce=g(59640),te=g(54460),b=g(10936),Y=g(65162),le=g(21656),J=g(15343),G=g(70050),x=g(5502),v=g(36894),F=g(50622),_=g(99927),f=g(9797),q=g(46899);let $=(()=>{var W;class st extends ce.H{showExplain(){this.isTeacherRole||!this.examConfig||"SHOW_EXPLAIN"!==this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction||this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought?this.isShowExplainChange.emit(!this.isShowExplain):this.showDialogBuyExam(this.examObj)}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage()}showDialogBuyExam(Oe){this.sAztDialogService.open(y.Q,{data:{examObj:Oe},restoreFocus:!1,width:"100vw",maxWidth:"100vw",height:"100vh",backdropClass:"azt-backdrop-full-width-height",disableClose:!0})}isKey(Oe){return!(!this.questionObj?.answers||!this.questionObj.answerResult)&&(Oe.key?Oe.key==this.questionObj.answerResult[0]:Oe==this.questionObj.answerResult[0])}haveChoose(Oe){return!!this.userAnswersObj["id_"+this.questionObj?.id]&&(Oe.key?Oe.key.toUpperCase().toString()==this.userAnswersObj["id_"+this.questionObj?.id].toUpperCase():Oe.toString().toUpperCase()==this.userAnswersObj["id_"+this.questionObj?.id].toUpperCase())}findKey(){this.questionObj?.answerResult&&this.labelArr.every(Oe=>!this.questionObj||!this.questionObj.answerResult||this.questionObj.answerResult[0]!=Oe.key||(this.key=(this.isShowOriginAnswer?Oe.key:Oe.alpha??Oe.key)??"",!1))}checkShowExplainButton(){this.isShowExplainButton=!!(this.questionObj.help||"lang_core_show_explain_required_payment"==this.questionObj.help&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigObj?.priceForAction)}checkLabelArr(){this.labelArr=this.sAztAnswerTrueFalseService.checkLabelArrOriginOrMix(this.questionAnswers,this.isShowOriginAnswer),this.findKey()}ngOnChanges(Oe){Oe.isShowOriginAnswer&&this.questionObj&&this.checkLabelArr()}ngOnInit(){if(super.ngOnInit(),this.isFillAnswer=this.questionObj?.correctAnswer??!1,this.answerTypeService.isTrueFalseAnswer(this.questionObj)?(this.keys=this.sAztAnswerTrueFalseService.checkLabelKeys(this.keys,this.questionObj?.answers,this.questionObj?.answerResult),this.isFillAnswer=!0):this.key=this.questionObj?.answerResult.length?this.questionObj.answerResult[0]:"",this.questionAnswers=(0,h.cloneDeep)(this.questionObj.answers??[]),this.checkLabelArr(),this.answerTypeService.isOneChoiceAnswer(this.questionObj))for(let Oe=0;Oe<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[Oe])&&this.haveChoose(this.labelArr[Oe]),!0!==this.isFillAnswer);Oe++);this.answerTypeService.isFillAnswer(this.questionObj)&&this.questionObj?.answerResult&&this.questionObj.answerResult.length>0&&(this.keys=this.questionObj.answerResult,this.isFillAnswer=this.questionObj?.correctAnswer??!1),this.checkShowExplainButton()}constructor(Oe,ot,Ht,on){super(),this.sAztAnswerTrueFalseService=Oe,this.answerTypeService=ot,this.answerBoxService=Ht,this.sAztDialogService=on,this.isShowExplain=!1,this.isOfflineMark=!1,this.isTeacherRole=!0,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.isShowExplainChange=new o.bkB,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1,this.isShowExplainButton=!1,this.questionAnswers=[]}}return(W=st).\u0275fac=function(Oe){return new(Oe||W)(o.rXU(F.j),o.rXU(_._),o.rXU(f.C),o.rXU(q.i))},W.\u0275cmp=o.VBU({type:W,selectors:[["azt-answer-box-with-user-answer-base"]],inputs:{examObj:"examObj",questionObj:"questionObj",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isTeacherRole:"isTeacherRole",isShowOriginAnswer:"isShowOriginAnswer",examConfig:"examConfig",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab",backToLink:"backToLink"},outputs:{isShowExplainChange:"isShowExplainChange"},standalone:!0,features:[o.Vt3,o.OA$,o.aNF],decls:0,vars:0,template:function(Oe,ot){},dependencies:[te.MD,b.X1,Y.iI,b.YN,le.s,J.flO,G.L,x.Id,v.k],encapsulation:2}),st})();var d=g(47348);const de=W=>({"justify-content":W}),z=W=>({"mt-3":W}),Ie=(W,st)=>({width:W,"margin-right":st}),me=()=>({"ml-1":!0}),nt=W=>[W],tt=W=>({backto:W}),rt=()=>({"text-transform":"uppercase"}),He=(W,st)=>({"flex justify-between w-full items-center":W,"answer-box-type1":st}),ve=W=>({"border-color":W}),ze=W=>({color:W}),ye=()=>({"text-danger mr-1":!0}),Te=()=>({"mr-1":!0}),Me=()=>({"text-success mr-1":!0}),we=W=>({"w-full":W}),Ke=W=>({color:"#00ac33",width:W}),oe=(W,st)=>({color:W,width:st}),at=()=>({color:"red"});function ie(W,st){if(1&W){const k=o.RV6();o.j41(0,"span",8),o.bIt("click",function(){o.eBV(k);const ot=o.XpG();return o.Njj(ot.showExplain())}),o.EFF(1),o.nI1(2,"mytranslate"),o.nrm(3,"lucide-icon",9),o.k0s()}if(2&W){const k=o.XpG();o.Y8G("ngStyle",o.l_i(7,Ie,k.isShowExplainButton?"125px":"0px",k.isShowExplainButton?"-40px":"0px")),o.BMQ("style",k.isShowExplainButton&&!k.notShowAnswerYet?"visibility:  visible":"visibility:  hidden",o.$dS),o.R7$(),o.SpI(" ",o.bMT(2,5,"lang_auto_giai_thich")," "),o.R7$(2),o.Y8G("name",k.isShowExplain?"chevron-up":"chevron-down")("ngClass",o.lJ4(10,me))}}function be(W,st){if(1&W&&(o.j41(0,"a",10),o.nI1(1,"navigationLocalize"),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s()),2&W){const k=o.XpG();o.Y8G("routerLink",o.eq3(8,nt,o.bMT(1,4,"/on-luyen/"+k.questionObj.practiceHashId)))("queryParams",o.eq3(10,tt,k.backToLink))("ngStyle",o.lJ4(12,rt)),o.R7$(2),o.SpI(" ",o.bMT(3,6,"lang_azota_ui_practice_link")," ")}}function H(W,st){if(1&W&&(o.j41(0,"span",16),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&W){const k=o.XpG(2);o.Y8G("ngStyle",o.eq3(5,ze,k.isFillAnswer?"#00ac33":"red")),o.R7$(),o.Lme("",o.bMT(2,3,"lang_auto_dap_an_dung"),": ",k.key,"")}}function pe(W,st){1&W&&o.nrm(0,"span",17)}function Xe(W,st){1&W&&o.nrm(0,"lucide-icon",24),2&W&&o.Y8G("ngClass",o.lJ4(1,ye))}function Ee(W,st){1&W&&o.nrm(0,"lucide-icon",25),2&W&&o.Y8G("ngClass",o.lJ4(1,Te))}function L(W,st){if(1&W&&(o.qex(0),o.DNE(1,Xe,1,2,"lucide-icon",23)(2,Ee,1,2,"lucide-icon",21),o.bVm()),2&W){const k=o.XpG(2).$implicit,Oe=o.XpG(2);o.R7$(),o.Y8G("ngIf",Oe.haveChoose(k)&&2!=Oe.examObj.whenShowAnswer&&!Oe.notShowAnswerYet),o.R7$(),o.Y8G("ngIf",Oe.haveChoose(k)&&2!=Oe.examObj.whenShowAnswer&&Oe.notShowAnswerYet)}}function se(W,st){1&W&&o.nrm(0,"lucide-icon",25),2&W&&o.Y8G("ngClass",o.lJ4(1,Te))}function je(W,st){if(1&W&&(o.qex(0),o.DNE(1,se,1,2,"lucide-icon",21),o.bVm()),2&W){const k=o.XpG(2).$implicit,Oe=o.XpG(2);o.R7$(),o.Y8G("ngIf",Oe.haveChoose(k)&&2==Oe.examObj.whenShowAnswer)}}function _e(W,st){1&W&&o.nrm(0,"lucide-icon",25),2&W&&o.Y8G("ngClass",o.lJ4(1,Me))}function Se(W,st){if(1&W&&(o.qex(0),o.DNE(1,L,3,2,"ng-container",19)(2,je,2,1,"ng-container",19)(3,_e,1,2,"lucide-icon",21),o.j41(4,"span",22),o.EFF(5),o.k0s(),o.bVm()),2&W){const k=o.XpG().$implicit,Oe=o.XpG(2);o.R7$(),o.Y8G("ngIf",!(Oe.isKey(k)&&Oe.haveChoose(k))),o.R7$(),o.Y8G("ngIf",!(Oe.isKey(k)&&Oe.haveChoose(k))),o.R7$(),o.Y8G("ngIf",Oe.isKey(k)&&Oe.haveChoose(k)&&2!=Oe.examObj.whenShowAnswer),o.R7$(2),o.SpI(" ",k.alpha?k.alpha:k.key?k.key:k," ")}}function $e(W,st){if(1&W&&(o.j41(0,"span",26),o.EFF(1),o.k0s()),2&W){const k=o.XpG().$implicit,Oe=o.XpG(2);o.Y8G("ngClass",Oe.isKey(k)&&Oe.haveChoose(k)&&2!=Oe.examObj.whenShowAnswer?"b-circle  w-6 h-6 text-success":!Oe.isKey(k)&&Oe.haveChoose(k)&&2!=Oe.examObj.whenShowAnswer?"b-circle  w-6 h-6 text-danger":""),o.R7$(),o.SpI(" ",k.alpha?k.alpha:k.key?k.key:k," ")}}function Le(W,st){if(1&W&&(o.j41(0,"div",18),o.DNE(1,Se,6,4,"ng-container",19)(2,$e,2,2,"span",20),o.k0s()),2&W){const k=o.XpG(2);o.R7$(),o.Y8G("ngIf",!k.isTqbDomain),o.R7$(),o.Y8G("ngIf",k.isTqbDomain)}}function ht(W,st){if(1&W&&(o.j41(0,"div",11),o.DNE(1,H,3,7,"span",12)(2,pe,1,0,"span",13),o.j41(3,"div",14),o.DNE(4,Le,3,2,"div",15),o.k0s()()),2&W){const k=o.XpG();o.Y8G("ngClass",o.l_i(5,He,k.isMobileDevice,!k.isMobileDevice)),o.R7$(),o.Y8G("ngIf",2!=k.examObj.whenShowAnswer&&!k.notShowAnswerYet),o.R7$(),o.Y8G("ngIf",k.keys&&2==k.examObj.whenShowAnswer),o.R7$(),o.Y8G("ngStyle",o.eq3(8,ve,k.questionObj.correctAnswer?"#00ac33":"red")),o.R7$(),o.Y8G("ngForOf",k.labelArr)}}function Ye(W,st){if(1&W&&(o.qex(0),o.j41(1,"div",34),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.bVm()),2&W){const k=st.$implicit,Oe=o.XpG(3);o.R7$(),o.Y8G("ngStyle",o.eq3(5,Ke,Oe.isMobileDevice?"50%":"95px")),o.R7$(),o.Lme(" ",k.alpha?k.alpha.toLowerCase():k.key?k.key.toLowerCase():k,") ",o.bMT(3,3,Oe.keys.includes((k.alpha?k.alpha:k.key?k.key:"")+"T")?"lang_auto_dung":"lang_auto_sai")," ")}}function qe(W,st){if(1&W&&(o.j41(0,"div",30)(1,"div",31),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.j41(4,"div",32),o.DNE(5,Ye,4,7,"ng-container",33),o.k0s()()),2&W){const k=o.XpG(2);o.R7$(2),o.SpI("",o.bMT(3,2,"lang_auto_dap_an_dung"),":"),o.R7$(3),o.Y8G("ngForOf",k.labelArr)}}function Fe(W,st){if(1&W&&(o.qex(0),o.j41(1,"div",34),o.nI1(2,"isTrueAnswerType5"),o.EFF(3),o.nI1(4,"getAnswerChoiceTrueFalseQuestion"),o.nI1(5,"mytranslate"),o.k0s(),o.bVm()),2&W){const k=st.$implicit,Oe=o.XpG(3);o.R7$(),o.Y8G("ngStyle",o.l_i(12,oe,o.brH(2,3,k,Oe.keys,Oe.userAnswersObj["id_"+Oe.questionObj.id])?"#00ac33":"red",Oe.isMobileDevice?"50%":"95px")),o.R7$(2),o.Lme(" ",k.alpha?k.alpha.toLowerCase():k.key?k.key.toLowerCase():k,") ",o.bMT(5,10,o.i5U(4,7,k,Oe.userAnswersObj["id_"+Oe.questionObj.id]))," ")}}function Ne(W,st){if(1&W&&(o.j41(0,"div",30)(1,"div",31),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.j41(4,"div",32),o.DNE(5,Fe,6,15,"ng-container",33),o.k0s()()),2&W){const k=o.XpG(2);o.R7$(2),o.SpI("",o.bMT(3,2,"lang_core_dap_an_thi_sinh_chon"),":"),o.R7$(3),o.Y8G("ngForOf",k.labelArr)}}function ct(W,st){if(1&W&&(o.j41(0,"span",34),o.EFF(1),o.k0s()),2&W){const k=o.XpG().$implicit;o.Y8G("ngStyle",o.lJ4(2,at)),o.R7$(),o.SpI(" ",k.alpha?k.alpha.toLowerCase():k.key?k.key.toLowerCase():k,") \xa0\xa0 ")}}function Ze(W,st){if(1&W&&(o.qex(0),o.DNE(1,ct,2,3,"span",36),o.nI1(2,"isTrueAnswerType5"),o.bVm()),2&W){const k=st.$implicit,Oe=o.XpG(3);o.R7$(),o.Y8G("ngIf",!o.brH(2,1,k,Oe.keys,Oe.userAnswersObj["id_"+Oe.questionObj.id]))}}function it(W,st){if(1&W&&(o.j41(0,"div",35)(1,"div",31),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.DNE(4,Ze,3,5,"ng-container",33),o.k0s()),2&W){const k=o.XpG(2);o.R7$(2),o.SpI("",o.bMT(3,2,"lang_core_cau_lam_sai"),":"),o.R7$(2),o.Y8G("ngForOf",k.labelArr)}}function Re(W,st){if(1&W&&(o.j41(0,"div",27),o.DNE(1,qe,6,4,"div",28)(2,Ne,6,4,"div",28)(3,it,5,4,"div",29),o.k0s()),2&W){const k=o.XpG();o.Y8G("ngClass",o.eq3(4,we,k.isMobileDevice)),o.R7$(),o.Y8G("ngIf",2!=k.examObj.whenShowAnswer&&!k.notShowAnswerYet),o.R7$(),o.Y8G("ngIf",2!=k.examObj.whenShowAnswer&&!k.notShowAnswerYet),o.R7$(),o.Y8G("ngIf",2!=k.examObj.whenShowAnswer&&!k.notShowAnswerYet)}}function vt(W,st){if(1&W&&(o.j41(0,"span",16),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&W){const k=o.XpG(2);o.Y8G("ngStyle",o.eq3(5,ze,k.isFillAnswer?"#00ac33":"red")),o.R7$(),o.Lme("",o.bMT(2,3,"lang_auto_dap_an_dung_"),"",k.keys.join("],["),"]")}}function Ue(W,st){1&W&&o.nrm(0,"span",17)}function fe(W,st){if(1&W&&(o.j41(0,"div",37),o.DNE(1,vt,3,7,"span",12)(2,Ue,1,0,"span",13),o.j41(3,"div",38)(4,"div",39),o.EFF(5),o.nI1(6,"trimEndFillAnswer"),o.nI1(7,"mytranslate"),o.k0s()()()),2&W){const k=o.XpG();o.R7$(),o.Y8G("ngIf",k.keys&&2!=k.examObj.whenShowAnswer&&!k.notShowAnswerYet),o.R7$(),o.Y8G("ngIf",k.keys&&2==k.examObj.whenShowAnswer),o.R7$(),o.Y8G("ngStyle",o.eq3(9,ve,k.questionObj.correctAnswer?"#00ac33":"red")),o.R7$(2),o.SpI(" ",void 0!==k.userAnswersObj["id_"+k.questionObj.id]?o.i5U(6,4,k.userAnswersObj["id_"+k.questionObj.id],k.isOfflineMark):o.bMT(7,7,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function We(W,st){if(1&W){const k=o.RV6();o.j41(0,"div")(1,"span",41),o.bIt("click",function(){o.eBV(k);const ot=o.XpG(2);return o.Njj(ot.switchToEssayTab())}),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s()()}2&W&&(o.R7$(2),o.SpI(" ",o.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")," "))}function Je(W,st){1&W&&(o.j41(0,"div"),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&W&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Lt(W,st){if(1&W&&(o.qex(0),o.nrm(1,"div",42),o.bVm()),2&W){const k=o.XpG(3);o.R7$(),o.Y8G("innerText",k.userAnswersObj["id_"+k.questionObj.id])}}function xt(W,st){if(1&W&&(o.qex(0),o.DNE(1,Je,3,3,"div",19)(2,Lt,2,1,"ng-container",19),o.bVm()),2&W){const k=o.XpG(2);o.R7$(),o.Y8G("ngIf",void 0===k.userAnswersObj["id_"+k.questionObj.id]),o.R7$(),o.Y8G("ngIf",k.userAnswersObj["id_"+k.questionObj.id])}}function et(W,st){if(1&W&&(o.j41(0,"div",40),o.DNE(1,We,4,3,"div",19)(2,xt,3,2,"ng-container",19),o.k0s()),2&W){const k=o.XpG();o.R7$(),o.Y8G("ngIf","multiple_choice_tab"==k.currentTab),o.R7$(),o.Y8G("ngIf","multiple_choice_tab"!=k.currentTab)}}let V=(()=>{var W;class st extends ${}return(W=st).\u0275fac=(()=>{let k;return function(ot){return(k||(k=o.xGo(W)))(ot||W)}})(),W.\u0275cmp=o.VBU({type:W,selectors:[["azt-answer-box-with-user-full-answer-for-student"]],standalone:!0,features:[o.Vt3,o.aNF],decls:12,vars:20,consts:[[1,"question-standalone-answer-box-for-student","box","pt-0","shadow-none",2,"border-top-left-radius","0","border-top-right-radius","0",3,"ngStyle"],[1,"flex","flex-col-reverse","sm:flex-row","sm:items-center",3,"ngClass"],["class","explainTxt text-pending cursor-pointer","azt-track-service","azt-standalone-question-nQrO97VmcYI",3,"ngStyle","click",4,"ngIf"],["class","btn btn-outline-primary btn-transparent",3,"routerLink","queryParams","ngStyle",4,"ngIf"],["class","mt-2 font-bold",3,"ngClass",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["azt-track-service","azt-standalone-question-nQrO97VmcYI",1,"explainTxt","text-pending","cursor-pointer",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"btn","btn-outline-primary","btn-transparent",3,"routerLink","queryParams","ngStyle"],[1,"mt-2","font-bold",3,"ngClass"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"keyText","my-1",3,"ngStyle"],[1,"keyText","my-1","ml-2"],[1,"label-item"],[4,"ngIf"],["class","lalala",3,"ngClass",4,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"lalala",3,"ngClass"],[3,"ngClass"],["class","keyText my-1 font-medium flex flex-wrap",4,"ngIf"],["class","keyText my-1 font-medium text-red flex flex-wrap",4,"ngIf"],[1,"keyText","my-1","font-medium","flex","flex-wrap"],[2,"width","100px"],[1,"flex","justify-between","flex-wrap"],[4,"ngFor","ngForOf"],[1,"lalala",3,"ngStyle"],[1,"keyText","my-1","font-medium","text-red","flex","flex-wrap"],["class","lalala",3,"ngStyle",4,"ngIf"],[1,"answer-box-type1","mt-2"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Oe,ot){1&Oe&&(o.j41(0,"div",0)(1,"div",1),o.DNE(2,ie,4,11,"span",2)(3,be,4,13,"a",3),o.k0s(),o.DNE(4,ht,5,10,"div",4),o.nI1(5,"isOneChoiceAnswer"),o.DNE(6,Re,4,6,"div",5),o.nI1(7,"isTrueFalseAnswer"),o.DNE(8,fe,8,11,"div",6),o.nI1(9,"isFillAnswer"),o.DNE(10,et,3,2,"div",7),o.nI1(11,"isEssayAnswer"),o.k0s()),2&Oe&&(o.Y8G("ngStyle",o.eq3(16,de,2==ot.examObj.whenShowAnswer?"flex-end":"space-between")),o.R7$(),o.Y8G("ngClass",o.eq3(18,z,ot.isMobileDevice)),o.R7$(),o.Y8G("ngIf",2!=ot.examObj.whenShowAnswer),o.R7$(),o.Y8G("ngIf",ot.questionObj.practiceHashId),o.R7$(),o.Y8G("ngIf",o.bMT(5,8,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",o.bMT(7,10,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",o.bMT(9,12,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",o.bMT(11,14,ot.questionObj)))},dependencies:[d.F2,te.MD,te.YU,te.Sq,te.bT,te.B3,b.X1,Y.iI,Y.Wk,b.YN,d.wp,le.s,J.flO,J.WGl,G.L,d.V6,d.Zm,d.N3,d.FC,d.jr,d.C0,d.M_,x.Id,v.k],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),st})(),X=(()=>{var W;class st extends ${constructor(){super(...arguments),this.checkShowFullAnswer=!1}ngOnInit(){this.checkShowFullAnswer=!(this.examConfig&&"SHOW_EXPLAIN"===this.examConfig?.examPriceConfigWithBoughtStatus?.priceForAction&&!this.examConfig?.examPriceConfigWithBoughtStatus?.hasBought)}}return(W=st).\u0275fac=(()=>{let k;return function(ot){return(k||(k=o.xGo(W)))(ot||W)}})(),W.\u0275cmp=o.VBU({type:W,selectors:[["azt-answer-box-with-user-answer-for-student"]],standalone:!0,features:[o.Vt3,o.aNF],decls:1,vars:11,consts:[[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Oe,ot){1&Oe&&(o.j41(0,"azt-answer-box-with-user-full-answer-for-student",0),o.mxI("isShowExplainChange",function(on){return o.DH7(ot.isShowExplain,on)||(ot.isShowExplain=on),on}),o.bIt("isShowExplainChange",function(){return ot.isShowExplainChange.emit(ot.isShowExplain)}),o.k0s()),2&Oe&&(o.Y8G("examObj",ot.examObj)("examConfig",ot.examConfig)("questionObj",ot.questionObj)("userAnswersObj",ot.userAnswersObj)("notShowAnswerYet",ot.notShowAnswerYet)("isTeacherRole",ot.isTeacherRole)("isShowOriginAnswer",ot.isShowOriginAnswer),o.R50("isShowExplain",ot.isShowExplain),o.Y8G("backToLink",ot.backToLink)("isOfflineMark",ot.isOfflineMark)("currentTab",ot.currentTab))},dependencies:[V,te.MD,b.X1,Y.iI,b.YN,le.s,J.flO,G.L,x.Id,v.k],encapsulation:2}),st})();const ee=W=>({width:W,visibility:"visible"}),S=()=>({"ml-1":!0}),B=W=>({color:W}),Z=W=>({"border-color":W}),P=()=>({"text-danger wrongIcon mr-1":!0}),I=()=>({"rightIcon text-success mr-1":!0}),O=()=>({"text-danger mr-1":!0}),E=()=>({"text-success mr-1":!0});function R(W,st){if(1&W){const k=o.RV6();o.j41(0,"span",7),o.bIt("click",function(){o.eBV(k);const ot=o.XpG();return o.Njj(ot.showExplain())}),o.EFF(1),o.nI1(2,"mytranslate"),o.nrm(3,"lucide-icon",8),o.k0s()}if(2&W){const k=o.XpG();o.Y8G("ngStyle",o.eq3(6,ee,k.questionObj.help?"125px":"0px")),o.R7$(),o.SpI(" ",o.bMT(2,4,"lang_auto_giai_thich")," "),o.R7$(2),o.Y8G("name",k.isShowExplain?"chevron-up":"chevron-down")("ngClass",o.lJ4(8,S))}}function M(W,st){1&W&&o.nrm(0,"lucide-icon",18),2&W&&o.Y8G("ngClass",o.lJ4(1,P))}function U(W,st){if(1&W&&o.DNE(0,M,1,2,"lucide-icon",17),2&W){const k=o.XpG().$implicit,Oe=o.XpG(2);o.Y8G("ngIf",Oe.haveChoose(k))}}function xe(W,st){1&W&&o.nrm(0,"lucide-icon",19),2&W&&o.Y8G("ngClass",o.lJ4(1,I))}function Pe(W,st){if(1&W&&(o.j41(0,"div",13),o.DNE(1,U,1,1,"ng-template",14)(2,xe,1,2,"lucide-icon",15),o.j41(3,"span",16),o.EFF(4),o.k0s()()),2&W){const k=st.$implicit,Oe=o.XpG(2);o.R7$(),o.Y8G("ngIf",!(Oe.isKey(k)&&Oe.haveChoose(k))),o.R7$(),o.Y8G("ngIf",Oe.isKey(k)&&Oe.haveChoose(k)),o.R7$(2),o.JRh(k.alpha?k.alpha:k.key?k.key:k)}}function D(W,st){if(1&W&&(o.j41(0,"div",9)(1,"span",10),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.j41(4,"div",11),o.DNE(5,Pe,5,3,"div",12),o.k0s()()),2&W){const k=o.XpG();o.R7$(),o.Y8G("ngStyle",o.eq3(7,B,k.isFillAnswer?"#00ac33":"red")),o.R7$(),o.Lme("",o.bMT(3,5,"lang_auto_dap_an_dung"),": ",k.key,""),o.R7$(2),o.Y8G("ngStyle",o.eq3(9,Z,k.isFillAnswer?"#00ac33":"red")),o.R7$(),o.Y8G("ngForOf",k.labelArr)}}function Ve(W,st){if(1&W&&(o.qex(0),o.j41(1,"span",26),o.nI1(2,"isTrueAnswerType5"),o.EFF(3),o.nI1(4,"mytranslate"),o.k0s(),o.bVm()),2&W){const k=st.$implicit,Oe=o.XpG(2);o.R7$(),o.Y8G("ngStyle",o.eq3(9,B,o.brH(2,3,k,Oe.keys,Oe.userAnswersObj["id_"+Oe.questionObj.id])?"#00ac33":"red")),o.R7$(2),o.Lme(" ",k.alpha?k.alpha.toLowerCase():k.key?k.key.toLowerCase():k," - ",o.bMT(4,7,Oe.keys.includes((k.alpha?k.alpha:k.key?k.key:"")+"T")?"lang_auto_dung":"lang_auto_sai"),"\xa0 ")}}function De(W,st){1&W&&o.nrm(0,"lucide-icon",18),2&W&&o.Y8G("ngClass",o.lJ4(1,O))}function mt(W,st){1&W&&o.nrm(0,"lucide-icon",19),2&W&&o.Y8G("ngClass",o.lJ4(1,E))}function ut(W,st){if(1&W&&(o.j41(0,"div",27),o.DNE(1,De,1,2,"lucide-icon",17),o.nI1(2,"isTrueAnswerType5"),o.DNE(3,mt,1,2,"lucide-icon",15),o.nI1(4,"isTrueAnswerType5"),o.j41(5,"span",16),o.EFF(6),o.nI1(7,"getAnswerChoiceTrueFalseQuestion"),o.nI1(8,"mytranslate"),o.k0s()()),2&W){const k=st.$implicit,Oe=o.XpG(2);o.R7$(),o.Y8G("ngIf",!o.brH(2,4,k,Oe.keys,Oe.userAnswersObj["id_"+(null==Oe.questionObj?null:Oe.questionObj.id)])),o.R7$(2),o.Y8G("ngIf",o.brH(4,8,k,Oe.keys,Oe.userAnswersObj["id_"+(null==Oe.questionObj?null:Oe.questionObj.id)])),o.R7$(3),o.Lme("",k.alpha?k.alpha.toLowerCase():k.key?k.key.toLowerCase():k," - ",o.bMT(8,15,o.i5U(7,12,k,Oe.userAnswersObj["id_"+Oe.questionObj.id])),"")}}function pt(W,st){if(1&W&&(o.j41(0,"div",20)(1,"span",21),o.EFF(2),o.nI1(3,"mytranslate"),o.DNE(4,Ve,5,11,"ng-container",22),o.k0s(),o.j41(5,"div",23)(6,"div",24),o.DNE(7,ut,9,17,"div",25),o.k0s()()()),2&W){const k=o.XpG();o.R7$(2),o.SpI(" ",o.bMT(3,4,"lang_auto_dap_an_dung"),": "),o.R7$(2),o.Y8G("ngForOf",k.labelArr),o.R7$(),o.Y8G("ngStyle",o.eq3(6,Z,k.questionObj.correctAnswer?"#00ac33":"red")),o.R7$(2),o.Y8G("ngForOf",k.labelArr)}}function Be(W,st){if(1&W&&(o.j41(0,"span",10),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&W){const k=o.XpG(2);o.Y8G("ngStyle",o.eq3(5,B,k.isFillAnswer?"#00ac33":"red")),o.R7$(),o.Lme("",o.bMT(2,3,"lang_auto_dap_an_dung_"),"",k.keys.join("],["),"]")}}function gt(W,st){if(1&W&&(o.j41(0,"div",9),o.DNE(1,Be,3,7,"span",28),o.j41(2,"div",29)(3,"div",30),o.EFF(4),o.nI1(5,"trimEndFillAnswer"),o.nI1(6,"mytranslate"),o.k0s()()()),2&W){const k=o.XpG();o.R7$(),o.Y8G("ngIf",k.keys),o.R7$(),o.Y8G("ngStyle",o.eq3(8,Z,k.isFillAnswer?"#00ac33":"red")),o.R7$(2),o.SpI(" ",void 0!==k.userAnswersObj["id_"+k.questionObj.id]?o.i5U(5,3,k.userAnswersObj["id_"+k.questionObj.id],k.isOfflineMark):o.bMT(6,6,"lang_auto_thi_sinh_khong_thong_tin")," ")}}function Et(W,st){if(1&W){const k=o.RV6();o.j41(0,"div")(1,"span",33),o.bIt("click",function(){o.eBV(k);const ot=o.XpG(2);return o.Njj(ot.switchToEssayTab())}),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s()()}2&W&&(o.R7$(2),o.JRh(o.bMT(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function dt(W,st){1&W&&(o.j41(0,"div"),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&W&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Pt(W,st){if(1&W&&(o.qex(0),o.nrm(1,"div",34),o.bVm()),2&W){const k=o.XpG(3);o.R7$(),o.Y8G("innerText",k.userAnswersObj["id_"+k.questionObj.id])}}function At(W,st){if(1&W&&(o.qex(0),o.DNE(1,dt,3,3,"div",32)(2,Pt,2,1,"ng-container",32),o.bVm()),2&W){const k=o.XpG(2);o.R7$(),o.Y8G("ngIf",!k.userAnswersObj["id_"+k.questionObj.id]),o.R7$(),o.Y8G("ngIf",k.userAnswersObj["id_"+k.questionObj.id])}}function Ot(W,st){if(1&W&&(o.j41(0,"div",31),o.DNE(1,Et,4,3,"div",32)(2,At,3,2,"ng-container",32),o.k0s()),2&W){const k=o.XpG();o.R7$(),o.Y8G("ngIf","multiple_choice_tab"==k.currentTab),o.R7$(),o.Y8G("ngIf","multiple_choice_tab"!=k.currentTab)}}function Ft(W,st){if(1&W){const k=o.RV6();o.j41(0,"div",1)(1,"span",7),o.bIt("click",function(){o.eBV(k);const ot=o.XpG();return o.Njj(ot.showExplain())}),o.EFF(2),o.nI1(3,"mytranslate"),o.nrm(4,"lucide-icon",8),o.k0s()()}if(2&W){const k=o.XpG();o.R7$(),o.Y8G("ngStyle",o.eq3(6,ee,k.questionObj.help?"125px":"0px")),o.R7$(),o.SpI(" ",o.bMT(3,4,"lang_auto_giai_thich")," "),o.R7$(2),o.Y8G("name",k.isShowExplain?"chevron-up":"chevron-down")("ngClass",o.lJ4(8,S))}}let qt=(()=>{var W;class st extends ${ngOnInit(){super.ngOnInit()}}return(W=st).\u0275fac=(()=>{let k;return function(ot){return(k||(k=o.xGo(W)))(ot||W)}})(),W.\u0275cmp=o.VBU({type:W,selectors:[["azt-answer-box-with-user-answer-for-teacher"]],standalone:!0,features:[o.Vt3,o.aNF],decls:14,vars:18,consts:[[1,"question-standalone-answer-box-for-student","box","shadow-none"],[1,"flex"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k","class","explainTxt text-pending cursor-pointer mt-2",3,"ngStyle","click",4,"ngIf"],["class","answer-box-type1 mt-2",4,"ngIf"],["class","answer-box-type1 mt-2","style","flex-wrap: wrap",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto justify-content-between notForPdfExport",4,"ngIf"],["class","flex",4,"ngIf"],["azt-track-service","azt-standalone-question-sMnAQgQ7w7k",1,"explainTxt","text-pending","cursor-pointer","mt-2",3,"click","ngStyle"],["size","24",3,"name","ngClass"],[1,"answer-box-type1","mt-2"],[1,"keyText","my-1",3,"ngStyle"],["id","type_1",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["name","circle-check","size","24",3,"ngClass",4,"ngIf"],[1,"lalala"],["name","x","size","24",3,"ngClass",4,"ngIf"],["name","x","size","24",3,"ngClass"],["name","circle-check","size","24",3,"ngClass"],[1,"answer-box-type1","mt-2",2,"flex-wrap","wrap"],[1,"keyText","my-1"],[4,"ngFor","ngForOf"],["id","type_3",1,"limit-max-width","answer-box","ml-auto","my-1",3,"ngStyle"],[1,"label-item",2,"display","block !important","width","auto !important"],["class","flex w-full mt-1","style","align-items: center",4,"ngFor","ngForOf"],[1,"lalala","ml-1",3,"ngStyle"],[1,"flex","w-full","mt-1",2,"align-items","center"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],[1,"answer-box","answer-box-type3","ml-auto","justify-content-between","notForPdfExport"],[4,"ngIf"],["azt-track-service","answer-box-LBNR1fkVDxS",1,"clickable",3,"click"],[1,"answer-essay-txt",3,"innerText"]],template:function(Oe,ot){1&Oe&&(o.j41(0,"div",0)(1,"div",1),o.DNE(2,R,4,9,"span",2),o.nI1(3,"isEssayAnswer"),o.k0s(),o.DNE(4,D,6,11,"div",3),o.nI1(5,"isOneChoiceAnswer"),o.DNE(6,pt,8,8,"div",4),o.nI1(7,"isTrueFalseAnswer"),o.DNE(8,gt,7,10,"div",3),o.nI1(9,"isFillAnswer"),o.DNE(10,Ot,3,2,"div",5),o.nI1(11,"isEssayAnswer"),o.k0s(),o.DNE(12,Ft,5,9,"div",6),o.nI1(13,"isEssayAnswer")),2&Oe&&(o.R7$(2),o.Y8G("ngIf",ot.questionObj.help&&!o.bMT(3,6,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",o.bMT(5,8,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",o.bMT(7,10,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",o.bMT(9,12,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",o.bMT(11,14,ot.questionObj)),o.R7$(2),o.Y8G("ngIf",ot.questionObj.help&&o.bMT(13,16,ot.questionObj)))},dependencies:[te.MD,te.YU,te.Sq,te.bT,te.B3,b.X1,Y.iI,b.YN,d.wp,le.s,J.flO,J.WGl,G.L,d.V6,d.Zm,d.N3,d.FC,d.jr,d.C0,d.M_,x.Id,v.k],styles:[".question-standalone-answer-box-for-student[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box[_ngcontent-%COMP%]{width:250px;display:flex;justify-content:space-around;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box.limit-max-width[_ngcontent-%COMP%]{max-width:250px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:16px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:16px;flex:auto;text-align:right;margin-right:15px}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}@media screen and (max-width: 768px){.answer-box-type1[_ngcontent-%COMP%]{margin-left:15px}}@media screen and (max-width: 768px){.question-standalone-answer-box-for-student[_ngcontent-%COMP%]{flex-direction:column-reverse;align-items:flex-start}}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),st})();function wt(W,st){if(1&W){const k=o.RV6();o.j41(0,"azt-answer-box-with-user-answer-for-student",2),o.mxI("isShowExplainChange",function(ot){o.eBV(k);const Ht=o.XpG();return o.DH7(Ht.isShowExplain,ot)||(Ht.isShowExplain=ot),o.Njj(ot)}),o.bIt("isShowExplainChange",function(){o.eBV(k);const ot=o.XpG();return o.Njj(ot.isShowExplainChange.emit(ot.isShowExplain))}),o.k0s()}if(2&W){const k=o.XpG();o.Y8G("examObj",k.examObj)("examConfig",k.examConfig)("questionObj",k.questionObj)("userAnswersObj",k.userAnswersObj)("notShowAnswerYet",k.notShowAnswerYet)("isTeacherRole",k.isTeacherRole)("isShowOriginAnswer",k.isShowOriginAnswer),o.R50("isShowExplain",k.isShowExplain),o.Y8G("backToLink",k.backToLink)("isOfflineMark",k.isOfflineMark)("currentTab",k.currentTab)}}function In(W,st){if(1&W){const k=o.RV6();o.j41(0,"azt-answer-box-with-user-answer-for-teacher",3),o.mxI("isShowExplainChange",function(ot){o.eBV(k);const Ht=o.XpG();return o.DH7(Ht.isShowExplain,ot)||(Ht.isShowExplain=ot),o.Njj(ot)}),o.bIt("isShowExplainChange",function(){o.eBV(k);const ot=o.XpG();return o.Njj(ot.isShowExplainChange.emit(ot.isShowExplain))}),o.k0s()}if(2&W){const k=o.XpG();o.Y8G("examObj",k.examObj)("examConfig",k.examConfig)("questionObj",k.questionObj)("userAnswersObj",k.userAnswersObj)("notShowAnswerYet",k.notShowAnswerYet)("isShowOriginAnswer",k.isShowOriginAnswer)("isTeacherRole",k.isTeacherRole),o.R50("isShowExplain",k.isShowExplain),o.Y8G("backToLink",k.backToLink)("isOfflineMark",k.isOfflineMark)("currentTab",k.currentTab)}}let Vt=(()=>{var W;class st extends ${ngOnInit(){}}return(W=st).\u0275fac=(()=>{let k;return function(ot){return(k||(k=o.xGo(W)))(ot||W)}})(),W.\u0275cmp=o.VBU({type:W,selectors:[["azt-answer-box-view-base"]],standalone:!0,features:[o.Vt3,o.aNF],decls:2,vars:2,consts:[[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab","isShowExplainChange",4,"ngIf"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isTeacherRole","isShowOriginAnswer","isShowExplain","backToLink","isOfflineMark","currentTab"],[3,"isShowExplainChange","examObj","examConfig","questionObj","userAnswersObj","notShowAnswerYet","isShowOriginAnswer","isTeacherRole","isShowExplain","backToLink","isOfflineMark","currentTab"]],template:function(Oe,ot){1&Oe&&o.DNE(0,wt,1,11,"azt-answer-box-with-user-answer-for-student",0)(1,In,1,11,"azt-answer-box-with-user-answer-for-teacher",1),2&Oe&&(o.Y8G("ngIf",!ot.isTeacherRole),o.R7$(),o.Y8G("ngIf",ot.isTeacherRole))},dependencies:[X,qt,te.MD,te.bT,b.X1,Y.iI,b.YN,le.s,J.flO,G.L,x.Id,v.k],encapsulation:2}),st})()},84278:(Tt,Ae,g)=>{"use strict";g.d(Ae,{x:()=>ze});var o=g(54460),h=g(10936),y=g(65162),ce=g(15343),te=g(5502),b=g(21656),Y=g(70050),le=g(52325),J=g(49786),G=g(97760),x=g(54313),v=g(15423),F=g(58447),_=g(34660),f=g(60780),q=g(64486),$=g(66793),d=g(78111),de=g(36894),z=g(48891),Ie=g(42789);const me=ye=>({"skeleton-box-loading":ye}),nt=ye=>({"pb-2":ye}),tt=()=>[];function rt(ye,Te){if(1&ye&&z.nrm(0,"div",3),2&ye){const Me=z.XpG();z.Y8G("ngClass",z.eq3(1,me,Me.renderConfigObj.isFirstRender))}}function He(ye,Te){if(1&ye&&z.nrm(0,"azt-test-audio-ui",15),2&ye){const Me=z.XpG(2);z.Y8G("questionObj",Me.questionObj)("isShowList",!0)}}function ve(ye,Te){if(1&ye){const Me=z.RV6();z.j41(0,"div",4)(1,"div",5),z.nrm(2,"azt-question-group-content-box",6),z.j41(3,"div",7),z.DNE(4,He,1,2,"azt-test-audio-ui",8),z.j41(5,"div",9),z.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),z.k0s(),z.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),z.k0s()(),z.j41(10,"azt-answer-box-view-base",13),z.mxI("isShowExplainChange",function(Ke){z.eBV(Me);const oe=z.XpG();return z.DH7(oe.isShowExplain,Ke)||(oe.isShowExplain=Ke),z.Njj(Ke)}),z.bIt("isShowExplainChange",function(Ke){z.eBV(Me);const oe=z.XpG();return z.Njj(oe.isShowExplain=Ke)}),z.k0s(),z.nrm(11,"azt-question-explain-box",14),z.k0s()}if(2&ye){let Me;const we=z.XpG();z.R7$(),z.xc7("font-size","1em")("line-height","1.7"),z.Y8G("id","question_render_container_"+we.questionObj.id)("ngClass",z.eq3(43,nt,we.questionObj.attachments.length>0)),z.R7$(),z.Y8G("examObj",we.examObj)("questionObj",we.questionObj)("renderConfigObj",we.renderConfigObj),z.R7$(2),z.Y8G("ngIf",we.questionObj.attachments.length>0),z.R7$(2),z.Y8G("examObj",we.examObj)("questionObj",we.questionObj)("renderConfigObj",we.renderConfigObj)("curQuestionIndex",we.curQuestionIndex),z.R7$(),z.Y8G("showForTeacher",!1)("curExamResultId",null!==(Me=we.curExamResultId)&&void 0!==Me?Me:0)("examObj",we.examObj)("questionObj",we.questionObj)("renderConfigObj",we.renderConfigObj)("curQuestionIndex",we.curQuestionIndex)("orgExamObjs",z.lJ4(45,tt)),z.R7$(),z.Y8G("examObj",we.examObj)("questionObj",we.questionObj)("renderConfigObj",we.renderConfigObj),z.R7$(),z.Y8G("userAnswersObj",we.userAnswersObj)("examObj",we.examObj)("isShowOriginAnswer",we.isShowOriginAnswer)("questionObj",we.questionObj)("renderConfigObj",we.renderConfigObj),z.R7$(),z.Y8G("examObj",we.examObj)("examConfig",we.examConfig)("isTeacherRole",!1)("isShowOriginAnswer",we.isShowOriginAnswer)("questionObj",we.questionObj)("userAnswersObj",we.userAnswersObj)("notShowAnswerYet",we.notShowAnswerYet),z.R50("isShowExplain",we.isShowExplain),z.Y8G("backToLink",we.backToLink)("isOfflineMark",we.isOfflineMark)("currentTab",we.currentTab),z.R7$(),z.Y8G("isShowExplain",we.isShowExplain)("questionObj",we.questionObj)("renderConfigObj",we.renderConfigObj)}}let ze=(()=>{var ye;class Te extends q.I{ngOnInit(){super.ngOnInit();let we=new $.C(!1,!1,!1);super.initData(we,this.follower,this.questionObj),this.backToLink=`/test/answer-test/${this.examObj?.tenantId??0}/${this.examObj?.categoryId??0}/${this.examObj?.hashId}/${this.curExamResultId}`}constructor(){super(),this.follower=new d.e,this.curQuestionIndex=0,this.isShowExplain=!1,this.isShowOriginAnswer=!1,this.isOfflineMark=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab",this.backToLink="",this.checkShowFullAnswer=!1}}return(ye=Te).\u0275fac=function(we){return new(we||ye)},ye.\u0275cmp=z.VBU({type:ye,selectors:[["azt-question-standalone-for-student-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId",examConfig:"examConfig",isShowExplain:"isShowExplain",isShowOriginAnswer:"isShowOriginAnswer",isOfflineMark:"isOfflineMark",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},standalone:!0,features:[z.Vt3,z.aNF],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"box","border-none","pt-2",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","curExamResultId","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"userAnswersObj","examObj","isShowOriginAnswer","questionObj","renderConfigObj"],[3,"isShowExplainChange","examObj","examConfig","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isShowExplain","backToLink","isOfflineMark","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(we,Ke){if(1&we&&(z.j41(0,"div",1),z.DNE(1,rt,1,3,"div",2)(2,ve,12,46,"ng-template",null,0,z.C5r),z.k0s()),2&we){const oe=z.sdS(3);z.Y8G("id","question_render_element_"+Ke.questionObj.id),z.R7$(),z.Y8G("ngIf",!Ke.renderConfigObj.isRenderElement)("ngIfElse",oe)}},dependencies:[F.y,f.c,_.S,G.U,x.$,le.Q,J.i,v.N,o.MD,o.YU,o.bT,h.X1,y.iI,h.YN,b.s,ce.flO,Y.L,te.Id,de.k,Ie.N],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),Te})()},34815:(Tt,Ae,g)=>{"use strict";g.d(Ae,{o:()=>ve});var o=g(54460),h=g(10936),y=g(65162),ce=g(15343),te=g(5502),b=g(21656),Y=g(70050),le=g(52325),J=g(49786),G=g(97760),x=g(54313),v=g(15423),F=g(58447),_=g(34660),f=g(60780),q=g(64486),$=g(66793),d=g(78111),de=g(36894),z=g(48891),Ie=g(42789);const me=ze=>({"skeleton-box-loading":ze}),nt=ze=>({"mob-web-width":ze});function tt(ze,ye){if(1&ze&&z.nrm(0,"div",3),2&ze){const Te=z.XpG();z.Y8G("ngClass",z.eq3(1,me,Te.renderConfigObj.isFirstRender))}}function rt(ze,ye){if(1&ze&&z.nrm(0,"azt-test-audio-ui",15),2&ze){const Te=z.XpG(2);z.Y8G("questionObj",Te.questionObj)("isShowList",!0)}}function He(ze,ye){if(1&ze){const Te=z.RV6();z.j41(0,"div",4)(1,"div",5),z.nrm(2,"azt-question-group-content-box",6),z.j41(3,"div",7),z.DNE(4,rt,1,2,"azt-test-audio-ui",8),z.j41(5,"div",9),z.nrm(6,"azt-question-label-box",10)(7,"azt-question-action-box",11),z.k0s(),z.nrm(8,"azt-question-content-box",6)(9,"azt-question-answer-view-content-box",12),z.k0s()(),z.j41(10,"azt-answer-box-view-base",13),z.mxI("isShowExplainChange",function(we){z.eBV(Te);const Ke=z.XpG();return z.DH7(Ke.isShowExplain,we)||(Ke.isShowExplain=we),z.Njj(we)}),z.bIt("isShowExplainChange",function(we){z.eBV(Te);const Ke=z.XpG();return z.Njj(Ke.isShowExplain=we)}),z.k0s(),z.nrm(11,"azt-question-explain-box",14),z.k0s()}if(2&ze){const Te=z.XpG();z.R7$(),z.xc7("font-size","1em")("line-height","1.7"),z.Y8G("id","question_render_container_"+Te.questionObj.id)("ngClass",z.eq3(39,nt,Te.isMobileWebView)),z.R7$(),z.Y8G("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj),z.R7$(2),z.Y8G("ngIf",Te.questionObj.attachments.length>0),z.R7$(2),z.Y8G("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj)("curQuestionIndex",Te.curQuestionIndex),z.R7$(),z.Y8G("showForTeacher",!0)("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj)("curQuestionIndex",Te.curQuestionIndex)("orgExamObjs",Te.orgExamObjs),z.R7$(),z.Y8G("examObj",Te.examObj)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj),z.R7$(),z.Y8G("examObj",Te.examObj)("questionObj",Te.questionObj)("isShowOriginAnswer",Te.isShowOriginAnswer)("renderConfigObj",Te.renderConfigObj),z.R7$(),z.Y8G("examObj",Te.examObj)("isTeacherRole",!0)("isShowOriginAnswer",Te.isShowOriginAnswer)("questionObj",Te.questionObj)("userAnswersObj",Te.userAnswersObj)("notShowAnswerYet",Te.notShowAnswerYet)("isOfflineMark",Te.isOfflineMark),z.R50("isShowExplain",Te.isShowExplain),z.Y8G("currentTab",Te.currentTab),z.R7$(),z.Y8G("isShowExplain",Te.isShowExplain)("questionObj",Te.questionObj)("renderConfigObj",Te.renderConfigObj)}}let ve=(()=>{var ze;class ye extends q.I{ngOnInit(){super.ngOnInit();let Me=new $.C(!1,!1,!1);super.initData(Me,this.follower,this.questionObj)}constructor(){super(),this.follower=new d.e,this.curQuestionIndex=0,this.orgExamObjs=[],this.isShowExplain=!1,this.isOfflineMark=!1,this.isShowOriginAnswer=!1,this.userAnswersObj={},this.notShowAnswerYet=!1,this.currentTab="multiple_choice_tab"}}return(ze=ye).\u0275fac=function(Me){return new(Me||ze)},ze.\u0275cmp=z.VBU({type:ze,selectors:[["azt-question-standalone-for-teacher-at-review-page"]],inputs:{examObj:"examObj",questionObj:"questionObj",follower:"follower",curQuestionIndex:"curQuestionIndex",orgExamObjs:"orgExamObjs",isShowExplain:"isShowExplain",isOfflineMark:"isOfflineMark",isShowOriginAnswer:"isShowOriginAnswer",userAnswersObj:"userAnswersObj",notShowAnswerYet:"notShowAnswerYet",currentTab:"currentTab"},standalone:!0,features:[z.Vt3,z.aNF],decls:4,vars:3,consts:[["elementRended",""],["load_effect_lazy","",1,"question-standalone-box",3,"id"],["class","question-standalone-loader-box",3,"ngClass",4,"ngIf","ngIfElse"],[1,"question-standalone-loader-box",3,"ngClass"],[1,"question-standalone-content-box"],[1,"pt-2","pb-3","box","border-none",3,"id","ngClass"],[3,"examObj","questionObj","renderConfigObj"],[1,"question-standalone-main-content"],[3,"questionObj","isShowList",4,"ngIf"],[1,"flex","items-center","justify-between"],[3,"examObj","questionObj","renderConfigObj","curQuestionIndex"],[3,"showForTeacher","examObj","questionObj","renderConfigObj","curQuestionIndex","orgExamObjs"],[3,"examObj","questionObj","isShowOriginAnswer","renderConfigObj"],[3,"isShowExplainChange","examObj","isTeacherRole","isShowOriginAnswer","questionObj","userAnswersObj","notShowAnswerYet","isOfflineMark","isShowExplain","currentTab"],[2,"display","block",3,"isShowExplain","questionObj","renderConfigObj"],[3,"questionObj","isShowList"]],template:function(Me,we){if(1&Me&&(z.j41(0,"div",1),z.DNE(1,tt,1,3,"div",2)(2,He,12,41,"ng-template",null,0,z.C5r),z.k0s()),2&Me){const Ke=z.sdS(3);z.Y8G("id","question_render_element_"+we.questionObj.id),z.R7$(),z.Y8G("ngIf",!we.renderConfigObj.isRenderElement)("ngIfElse",Ke)}},dependencies:[F.y,f.c,_.S,G.U,x.$,le.Q,J.i,v.N,o.MD,o.YU,o.bT,h.X1,y.iI,h.YN,b.s,ce.flO,Y.L,te.Id,de.k,Ie.N],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),ye})()},97760:(Tt,Ae,g)=>{"use strict";g.d(Ae,{U:()=>Me});var o=g(59640),h=g(95887),y=g(89163),ce=g(33887),te=g(25539),b=g(2915),Y=g(52811),le=g(52654),J=g(54460),G=g(10936),x=g(65162),v=g(47348),F=g(21656),_=g(15343),f=g(70050),q=g(5502),$=g(36894),d=g(48891),de=g(78472);function z(we,Ke){1&we&&(d.j41(0,"div",10)(1,"span",11),d.nrm(2,"azt-loading-ui"),d.k0s(),d.j41(3,"span",12),d.EFF(4),d.nI1(5,"mytranslate"),d.k0s()()),2&we&&(d.R7$(4),d.JRh(d.bMT(5,1,"lang_auto_dang_chuan_bi_tai_lieu_doing")))}function Ie(we,Ke){1&we&&(d.j41(0,"div",13),d.EFF(1),d.nI1(2,"mytranslate"),d.k0s()),2&we&&(d.R7$(),d.SpI(" ",d.bMT(2,1,"lang_azt_cau_hoi_chua_co_lan_sua_nao")," "))}function me(we,Ke){if(1&we&&d.nrm(0,"azt-question-standalone-for-preview",17),2&we){const oe=d.XpG().$implicit,at=d.XpG();d.Y8G("examObj",at.data.examObj)("questionObj",oe.questionLog)("follower",at.data.follower)("curQuestionIndex",at.data.curQuestionIndex)}}function nt(we,Ke){if(1&we&&(d.qex(0),d.j41(1,"div",14),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"formatFullDateTimeWithoutSecondByUserUnitPipe"),d.k0s(),d.j41(5,"div",15),d.DNE(6,me,1,4,"azt-question-standalone-for-preview",16),d.k0s(),d.bVm()),2&we){const oe=Ke.$implicit;d.R7$(2),d.SpI(" ",d.bMT(3,2,"lang_azota_ui_the_time_of_question_editing")+": "+d.bMT(4,4,oe.createdAt)," "),d.R7$(4),d.Y8G("ngIf",oe.questionLog)}}let tt=(()=>{var we;class Ke extends ce._{closeDialog(){this.dialogRef.close()}getLogQuestion(at){this.initStatusObj(),this.waitDestroy(this.questionService.apiQuestionsIdLogsGet(at,this.data.isTeacher?void 0:this.data.curExamResultId).subscribe(ie=>{ie.success?((ie.data?.objs??[]).forEach(H=>{let pe={createdAt:H.createdAt,questionLog:this.commonService.castJsonToClassObj(te.I,JSON.stringify(H.questionLog))};pe.questionLog&&(pe.questionLog.isLogEditQuestion=!0),this.questionLogCustomList.push(pe)}),this.successStatusObj()):this.errorStatusObj(ie.message??"",!0)}))}ngOnInit(){this.getLogQuestion(this.data.questionObj.id)}constructor(at,ie,be){super(be,ie),this.questionService=at,this.dialogRef=ie,this.data=be,this.questionLogCustomList=[]}}return(we=Ke).\u0275fac=function(at){return new(at||we)(d.rXU(de.wP),d.rXU(y.CP,8),d.rXU(y.Vh,8))},we.\u0275cmp=d.VBU({type:we,selectors:[["show-question-edit-history-dialog"]],standalone:!0,features:[d.Vt3,d.aNF],decls:15,vars:13,consts:[[1,"box"],[1,"font-medium","p-3","bg-slate-100","dark:bg-darkmode-400"],[3,"defaultHeight"],["class","flex justify-center items-center h-40",4,"ngIf"],["id","boxContentQuestion",1,"p-2"],["class","flex p-5 justify-center items-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","pt-3"],[1,"ml-auto"],[1,"btn","btn-secondary",3,"click"],[1,"flex","justify-center","items-center","h-40"],[1,"w-4","h-4","inline-block"],[1,"sr-only","ml-2"],[1,"flex","p-5","justify-center","items-center"],[1,"p-2","pb-0","text-xs","font-medium",2,"margin-bottom","-10px"],[1,"p-2"],[3,"examObj","questionObj","follower","curQuestionIndex",4,"ngIf"],[3,"examObj","questionObj","follower","curQuestionIndex"]],template:function(at,ie){1&at&&(d.j41(0,"div",0)(1,"div",1),d.EFF(2),d.nI1(3,"mytranslate"),d.nI1(4,"mytranslate"),d.k0s(),d.j41(5,"azt-mat-dialog-content",2),d.DNE(6,z,6,3,"div",3),d.j41(7,"div",4),d.DNE(8,Ie,3,3,"div",5)(9,nt,7,6,"ng-container",6),d.k0s()(),d.j41(10,"div",7)(11,"div",8)(12,"button",9),d.bIt("click",function(){return ie.closeDialog()}),d.EFF(13),d.nI1(14,"mytranslate"),d.k0s()()()()),2&at&&(d.R7$(2),d.Lme(" ",d.bMT(3,7,"lang_azota_ui_the_history_of_question_editing")," (",ie.questionLogCustomList.length+" "+d.bMT(4,9,"lang_testbank_powerpoint_times"),") "),d.R7$(3),d.Y8G("defaultHeight",60),d.R7$(),d.Y8G("ngIf",ie.statusObj.loading),d.R7$(2),d.Y8G("ngIf",!ie.questionLogCustomList.length&&!ie.statusObj.loading),d.R7$(),d.Y8G("ngForOf",ie.questionLogCustomList),d.R7$(4),d.SpI(" ",d.bMT(14,11,"lang_auto_dong")," "))},dependencies:[b.U,Y.R,le.a,J.MD,J.Sq,J.bT,G.X1,x.iI,G.YN,v.wp,F.s,_.flO,f.L,v.bH,q.Id,$.k],encapsulation:2}),Ke})();var rt=g(78111),He=g(46899),ve=g(9691),ze=g(47712);function ye(we,Ke){if(1&we){const oe=d.RV6();d.j41(0,"div")(1,"button",2),d.nI1(2,"mytranslate"),d.bIt("click",function(){d.eBV(oe);const ie=d.XpG();return d.Njj(ie.goToEditQuestion())}),d.nrm(3,"lucide-icon",3),d.k0s()()}2&we&&(d.R7$(),d.FS9("matTooltip",d.bMT(2,1,"lang_core_chinh_sua_de_thi")))}function Te(we,Ke){if(1&we){const oe=d.RV6();d.j41(0,"div")(1,"button",2),d.nI1(2,"mytranslate"),d.bIt("click",function(){d.eBV(oe);const ie=d.XpG();return d.Njj(ie.showEditHistoryDialog())}),d.nrm(3,"lucide-icon",4),d.k0s()()}2&we&&(d.R7$(),d.FS9("matTooltip",d.bMT(2,1,"lang_azota_ui_the_history_of_question_editing")))}let Me=(()=>{var we;class Ke extends o.H{checkEditQuestion(){const at=this.questionObj?.createdAt,ie=this.questionObj?.updatedAt;let be=this.timeService.calculationTimeOnlyMinutes(at,ie);this.isEditQuestion=Number(be)>0}isOrgQuestion(){return null!=this.orgExamObjs.find(at=>at.questionId==this.questionObj.id)}goToEditQuestion(){var at=this.commonService.getMyParam(this.activeRoute,"cat_id")??"0",ie=this.activeRoute.snapshot.paramMap.get("result_id")??"0",be=this.activeRoute.snapshot.paramMap.get("user_id")??"",H=this.activeRoute.snapshot.paramMap.get("student_id")??"",pe=this.activeRoute.snapshot.paramMap.get("exam_id")??"",Xe=at,Ee=pe;let L=this.orgExamObjs.find(_e=>_e.questionId==this.questionObj.id);L&&(Xe=L.orgCategoryId?.toString()??"0",Ee=L.orgExamId?.toString()??"0");var se=this.commonService.getMyQueryParam("backto")??"";let je=`/admin/testbank/test-review/${pe}/${be}/${H}/${ie}`+(se?"?backto="+encodeURIComponent(se):"");window.location.href=this.commonService.getLocalRouter("/admin/testbank/update-exam/"+Xe)+"/"+Ee+"?backto="+encodeURIComponent(je)+"&questionId="+this.questionObj.id}showEditHistoryDialog(){let at={follower:new rt.e,examObj:this.examObj,questionObj:this.questionObj,renderConfigObj:this.renderConfigObj,curQuestionIndex:this.curQuestionIndex,curExamResultId:this.curExamResultId,isTeacher:this.showForTeacher};this.sAztDialogService.open(tt,{width:"750px",data:at})}showFeedbackQuestionDialog(){this.sAztDialogService.open(h.g,{width:"750px",data:{questionObj:this.questionObj,role:this.showForTeacher?"TEACHER":"STUDENT",applyType:"MATRIX_QUESTION"},restoreFocus:!1,autoFocus:!1})}ngOnChanges(){this.checkEditQuestion()}constructor(at,ie,be){super(),this.sAztDialogService=at,this.activeRoute=ie,this.timeService=be,this.showForTeacher=!1,this.curExamResultId=0,this.isEditQuestion=!1}}return(we=Ke).\u0275fac=function(at){return new(at||we)(d.rXU(He.i),d.rXU(x.nX),d.rXU(ve.F))},we.\u0275cmp=d.VBU({type:we,selectors:[["azt-question-action-box"]],inputs:{examObj:"examObj",questionObj:"questionObj",renderConfigObj:"renderConfigObj",orgExamObjs:"orgExamObjs",showForTeacher:"showForTeacher",curQuestionIndex:"curQuestionIndex",curExamResultId:"curExamResultId"},standalone:!0,features:[d.Vt3,d.OA$,d.aNF],decls:4,vars:4,consts:[[1,"flex"],[4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","p-1",3,"click","matTooltip"],["name","file-pen-line","size","18"],["name","history","size","18"]],template:function(at,ie){1&at&&(d.j41(0,"div",0),d.DNE(1,ye,4,3,"div",1),d.nI1(2,"isOfflineExam"),d.DNE(3,Te,4,3,"div",1),d.k0s()),2&at&&(d.R7$(),d.Y8G("ngIf",ie.isOrgQuestion()&&!d.bMT(2,2,ie.examObj)),d.R7$(2),d.Y8G("ngIf",ie.isEditQuestion&&!ie.questionObj.isLogEditQuestion))},dependencies:[J.MD,J.bT,G.X1,x.iI,G.YN,v.wp,F.s,ze.oV,_.flO,_.WGl,f.L,v.st,q.Id,$.k],styles:['.pr-7[_ngcontent-%COMP%]{padding-right:28px}.w-38px[_ngcontent-%COMP%]{width:38px}.remove-grid[_ngcontent-%COMP%]{display:block!important}.question-standalone-loader-box[_ngcontent-%COMP%]{min-height:50px}  .skeleton-box-loading{width:100%;height:30px;max-width:100%;margin-bottom:5px;display:inline-block}  .skeleton-box-loading:after{position:absolute;top:0;right:0;bottom:0;left:0;transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 2s infinite;content:""}.question-standalone-box[_ngcontent-%COMP%]{margin-bottom:30px;display:block;--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);border-radius:.375rem}.question-standalone-container[_ngcontent-%COMP%]{padding:15px}.question-standalone-for-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-standalone-for-test-finder[_ngcontent-%COMP%]   .question-standalone-main-content[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.group-of-question-standalone-for-test-finder[_ngcontent-%COMP%]{padding:15px!important;border:1px solid rgb(228,228,228)!important}.question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid #2262ae!important;outline:3px solid rgba(125,160,201,.65)!important}.group-of-question-standalone-has-selected[_ngcontent-%COMP%]{border:1px solid green!important;outline:3px solid rgba(0,193,0,.321)!important}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.question-standalone-content-box[_ngcontent-%COMP%]{position:relative}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]{color:#f44336;position:relative;padding-left:20px;display:flex;align-items:center}.question-standalone-is-invalid-validation[_ngcontent-%COMP%]:before{content:"!";position:absolute;left:0;color:#fff;background:#f44336;width:15px;height:15px;text-align:center;border-radius:50%;font-size:smaller;display:flex;justify-content:center;align-items:center}.question-standalone-step-container-box[_ngcontent-%COMP%]{margin-bottom:50px}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-label[_ngcontent-%COMP%]{width:20px;height:30px;min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.selected-answer[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff}.answer-content-front[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap;width:calc(100% - 30px)}.explainTxt[_ngcontent-%COMP%]{width:125px;font-weight:500;display:flex;align-items:center}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-pending-part[_ngcontent-%COMP%]{width:100%;height:50px}.pencil-edit[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:30px;height:30px;border-radius:50%;text-align:center;background:#a9a9a9;z-index:9999}.pencil-edit[_ngcontent-%COMP%]   .lucide[_ngcontent-%COMP%]{color:#fff;stroke-width:2.5px;height:29px}.margin-question-bar[_ngcontent-%COMP%]{margin-top:calc(3rem + 40px)!important}.sheet-screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-help[_ngcontent-%COMP%]{border-top:1px solid #d7d7d7;padding:10px 30px 0 0}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]{text-align:center;font-size:11px;margin-top:-20px}.box-help[_ngcontent-%COMP%]   .help-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;color:#d58e0b}.box-help[_ngcontent-%COMP%]   .help-content[_ngcontent-%COMP%]{font-size:13px;overflow-x:auto;overflow-y:hidden}  .layout{display:grid;margin:20px 0;grid-row-gap:20px}  .layout-4{grid-template-columns:1fr 1fr 1fr 1fr}  .layout-2{grid-template-columns:1fr 1fr}  .layout-1{grid-template-columns:1fr}  .question-standalone-content-box{max-width:100%;overflow-x:auto;overflow-y:hidden}  #boxContentQuestion .question-standalone-container{max-width:800px}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@media (max-width: 768px){.answer-content-front[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}}@media (max-width: 800px){  #boxContentQuestion .question-standalone-container{max-width:calc(90vw - 16px)!important}}']}),Ke})()},9797:(Tt,Ae,g)=>{"use strict";g.d(Ae,{C:()=>y});var o=g(18447),h=g(48891);let y=(()=>{var ce;class te{constructor(){this.switchEssayTabSource=new o.B,this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(){this.switchEssayTabSource.next(!0)}}return(ce=te).\u0275fac=function(Y){return new(Y||ce)},ce.\u0275prov=h.jDH({token:ce,factory:ce.\u0275fac,providedIn:"root"}),te})()},95887:(Tt,Ae,g)=>{"use strict";g.d(Ae,{g:()=>at});var o=g(10936),h=g(89163),y=g(33887),ce=g(15766),te=g(9570),b=g(52811),Y=g(54460),le=g(65162),J=g(47348),G=g(21656),x=g(15343),v=g(70050),F=g(5502),_=g(36894),f=g(48891),q=g(74978),$=g(43404),d=g(81587);const de=(ie,be)=>({"btn-primary":ie,"btn-secondary":be}),z=()=>({"mr-2":!0});function Ie(ie,be){if(1&ie&&(f.j41(0,"div",22)(1,"b",23),f.EFF(2),f.k0s(),f.j41(3,"div",24),f.nrm(4,"azt-dynamic-hook",17),f.k0s()()),2&ie){let H;const pe=be.$implicit;f.R7$(2),f.SpI("",null!==(H=pe.alpha)&&void 0!==H?H:pe.key,"."),f.R7$(2),f.Y8G("content",pe.content)}}function me(ie,be){if(1&ie&&(f.j41(0,"div",20),f.DNE(1,Ie,5,2,"div",21),f.k0s()),2&ie){const H=f.XpG(2);f.R7$(),f.Y8G("ngForOf",H.data.questionObj.answers)}}function nt(ie,be){if(1&ie&&(f.j41(0,"h2",25),f.EFF(1),f.nI1(2,"mytranslate"),f.k0s()),2&ie){const H=f.XpG(2);f.R7$(),f.Lme(" ",f.bMT(2,2,"lang_auto_dap_an"),": ",H.data.questionObj.answerResult.join(", ")," ")}}function tt(ie,be){if(1&ie&&(f.j41(0,"div",8)(1,"h2",10),f.EFF(2),f.nI1(3,"mytranslate"),f.k0s(),f.j41(4,"div",16),f.nrm(5,"azt-dynamic-hook",17),f.k0s(),f.DNE(6,me,2,1,"div",18)(7,nt,3,4,"h2",19),f.k0s()),2&ie){const H=f.XpG();f.R7$(2),f.SpI(" ",f.bMT(3,4,"lang_auto_noi_dung_cau_hoi")," "),f.R7$(3),f.Y8G("content",H.data.questionObj.content),f.R7$(),f.Y8G("ngIf",1==H.data.questionObj.answerType&&H.data.questionObj.answers&&H.data.questionObj.answers.length>0),f.R7$(),f.Y8G("ngIf",H.data.questionObj.answerResult&&H.data.questionObj.isRoleTeacher)}}function rt(ie,be){if(1&ie&&(f.j41(0,"div",8)(1,"h2",26),f.EFF(2),f.nI1(3,"mytranslate"),f.k0s(),f.j41(4,"div",27),f.nrm(5,"azt-dynamic-hook",17),f.k0s()()),2&ie){const H=f.XpG();f.R7$(2),f.SpI(" ",f.bMT(3,2,"lang_auto_loi_giai")," "),f.R7$(3),f.Y8G("content",H.data.questionObj.help)}}function He(ie,be){1&ie&&(f.qex(0),f.j41(1,"div",28)(2,"span",29),f.nrm(3,"azt-loading-ui"),f.k0s()(),f.bVm())}function ve(ie,be){if(1&ie&&(f.j41(0,"div",44),f.nrm(1,"input",45),f.j41(2,"label",46),f.EFF(3),f.nI1(4,"mytranslate"),f.k0s()()),2&ie){const H=be.$implicit,pe=be.index;f.R7$(),f.FS9("id","choice_"+pe),f.FS9("formControlName","choice_"+pe),f.R7$(),f.FS9("for","choice_"+pe),f.R7$(),f.SpI(" ",f.bMT(4,4,H)," ")}}function ze(ie,be){if(1&ie&&(f.qex(0),f.j41(1,"div",42),f.DNE(2,ve,5,6,"div",43),f.k0s(),f.bVm()),2&ie){const H=f.XpG().$implicit;f.R7$(),f.FS9("formGroupName","survey_"+H.id),f.R7$(),f.Y8G("ngForOf",H.choices)}}function ye(ie,be){if(1&ie&&(f.qex(0),f.j41(1,"mat-radio-button",49),f.EFF(2),f.nI1(3,"mytranslate"),f.k0s(),f.bVm()),2&ie){const H=be.$implicit,pe=f.XpG(2).$implicit,Xe=f.XpG(3);f.R7$(),f.FS9("value",H),f.Y8G("checked",Xe.form.controls["survey_"+pe.id].value==H),f.R7$(),f.JRh(f.bMT(3,3,H))}}function Te(ie,be){if(1&ie&&(f.j41(0,"mat-radio-group",47),f.DNE(1,ye,4,5,"ng-container",48),f.k0s()),2&ie){const H=f.XpG().$implicit;f.FS9("formControlName","survey_"+H.id),f.R7$(),f.Y8G("ngForOf",H.choices)}}function Me(ie,be){if(1&ie&&(f.j41(0,"div",39)(1,"div",40)(2,"h2",41),f.EFF(3),f.nI1(4,"mytranslate"),f.k0s()(),f.j41(5,"div"),f.DNE(6,ze,3,2,"ng-container",11)(7,Te,2,2,"ng-template",null,1,f.C5r),f.k0s()()),2&ie){const H=be.$implicit,pe=be.index,Xe=f.sdS(8);f.R7$(3),f.Lme(" ",pe+1+". ","",f.bMT(4,4,H.content)," "),f.R7$(3),f.Y8G("ngIf",H.multiChoice&&H.choices&&H.choices.length>1)("ngIfElse",Xe)}}function we(ie,be){if(1&ie&&(f.j41(0,"div"),f.DNE(1,Me,9,6,"div",38),f.k0s()),2&ie){const H=f.XpG(2);f.R7$(),f.Y8G("ngForOf",H.surveyObjs)}}function Ke(ie,be){if(1&ie){const H=f.RV6();f.DNE(0,we,2,1,"div",30),f.j41(1,"div",31)(2,"button",32),f.bIt("click",function(){f.eBV(H);const Xe=f.XpG();return f.Njj(Xe.changeFeedBackEmotion(2))}),f.nrm(3,"lucide-icon",33),f.j41(4,"span"),f.EFF(5),f.nI1(6,"mytranslate"),f.k0s()(),f.j41(7,"button",34),f.bIt("click",function(){f.eBV(H);const Xe=f.XpG();return f.Njj(Xe.changeFeedBackEmotion(1))}),f.nrm(8,"lucide-icon",35),f.j41(9,"span"),f.EFF(10),f.nI1(11,"mytranslate"),f.k0s()()(),f.j41(12,"div",36)(13,"textarea",37),f.nI1(14,"mytranslate"),f.bIt("keyup",function(){f.eBV(H);const Xe=f.XpG();return f.Njj(Xe.autoResizeFeedBackArea())}),f.k0s()()}if(2&ie){const H=f.XpG();f.Y8G("ngIf",H.surveyObjs.length),f.R7$(2),f.Y8G("disabled",H.disableLike)("ngClass",f.l_i(16,de,2==H.feedBackEmotion,2!=H.feedBackEmotion)),f.R7$(),f.Y8G("ngClass",f.lJ4(19,z)),f.R7$(2),f.JRh(f.bMT(6,10,"lang_test_market_introduce_rating_like")),f.R7$(2),f.Y8G("disabled",H.disableLike)("ngClass",f.l_i(20,de,1==H.feedBackEmotion,1!=H.feedBackEmotion)),f.R7$(),f.Y8G("ngClass",f.lJ4(23,z)),f.R7$(2),f.JRh(f.bMT(11,12,"lang_test_market_introduce_rating_dislike")),f.R7$(3),f.FS9("placeholder",f.bMT(14,14,"lang_global_question_ask_to_feedback_placeholder"))}}function oe(ie,be){1&ie&&(f.j41(0,"span",50),f.nrm(1,"azt-loading-ui"),f.k0s())}let at=(()=>{var ie;class be extends y._{getAnswerSurvey(){let pe=[],Xe=this.commonService.getFormObj(this.form);for(let Ee in Xe)if(Ee.includes("survey_")){let L={surveyId:Number(Ee.substring(Ee.indexOf("_")+1)),answers:[]};if(Xe[Ee]instanceof Object){let se=this.surveyObjs.find(je=>je.id==L.surveyId);if(se)for(let je in Xe[Ee])if(Xe[Ee][je]){let _e=Number(je.substring(je.indexOf("_")+1));if(Array.isArray(se.choices)&&se.choices[_e]){let Se=se.choices[_e];L.answers?.push(Se)}}}else L.answers=[Xe[Ee]];pe.push(L)}return pe}getFeedbackSurveys(){this.loadingFeedBackSurvey=!0,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksSurveysGet(this.applyType,this.role).subscribe(pe=>{if(1==pe.success){this.surveyObjs=pe.data?.objs??[];let Xe={feedBackContent:new o.MJ("",{nonNullable:!0,validators:[o.k0.required,ce.M.noWhiteSpace]})};this.surveyObjs.length>0&&this.surveyObjs.forEach(Ee=>{if(Ee.multiChoice&&Ee.choices&&Ee.choices.length>1){let L={};Xe[`survey_${Ee.id}`]=new o.gE({}),Ee.choices.forEach((se,je)=>{L[`choice_${je}`]=new o.MJ(!1,{nonNullable:!0})}),Xe[`survey_${Ee.id}`]=this.fb.group(L)}else Xe[`survey_${Ee.id}`]=new o.MJ("",{nonNullable:!0,validators:[o.k0.required]})}),this.form=this.fb.group(Xe),this.loadingFeedBackSurvey=!1}else this.errorStatusObj(pe.message??"",!0),this.loadingFeedBackSurvey=!1}))}getInfoFeedback(){this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksGet(this.questionId,this.applyType,this.role).subscribe(pe=>{if(1==pe.success){let Xe=pe.data?.objs??[];Xe.length&&Xe[0].status&&(this.feedBackEmotion=Xe[0].status,this.disableLike=!0)}else this.errorStatusObj(pe.message??"",!0),this.disableLike=!1}))}changeFeedBackEmotion(pe){this.disableLike||(this.feedBackEmotion=pe,this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost({objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??void 0,content:"",surveyAnswers:[]}).subscribe(Ee=>{1==Ee.success?this.getInfoFeedback():this.errorStatusObj(Ee.message??"",!0)})))}autoResizeFeedBackArea(){const pe=document.getElementById("text-area-feedback");pe&&setTimeout(()=>{pe.style.cssText="height:auto;",pe.style.cssText="height:"+(pe.scrollHeight+30)+"px"},0)}sendFeedBack(){if(this.form.invalid)this.showErrorSnack("lang_auto_vui_long_dien_day_du_thong_tin");else{this.initStatusObj(),this.sendingFeedBack=!0;let pe={objectId:this.questionId??void 0,userType:this.role??void 0,applyType:this.applyType??void 0,status:this.feedBackEmotion??0,content:this.form.controls.feedBackContent.value??void 0,surveyAnswers:this.getAnswerSurvey()};this.waitDestroy(this.testMarketFeedbackService.apiTestMarketFeedbacksPost(pe).subscribe(Xe=>{1==Xe.success?(this.sendingFeedBack=!1,this.dialogRef.close(!0),this.successStatusObj("TEACHER"==this.role?"lang_test_market_success_feedback":"lang_test_market_success_feedback_student",!0)):(this.errorStatusObj(Xe.message??"",!0),this.sendingFeedBack=!1)}))}}btnCloseDialog(){this.dialogRef.close(!1)}ngOnInit(){this.questionId=this.data.questionObj.id,this.role=this.data.role,this.applyType=this.data.applyType,this.form=this.fb.group({feedBackContent:new o.MJ("",{nonNullable:!0,validators:[o.k0.required,ce.M.noWhiteSpace]})}),this.getInfoFeedback(),this.getFeedbackSurveys(),super.ngOnInit()}constructor(pe,Xe,Ee,L){super(L,Ee),this.fb=pe,this.testMarketFeedbackService=Xe,this.dialogRef=Ee,this.data=L,this.role="",this.applyType="",this.form=new o.gE({}),this.feedBackEmotion=void 0,this.totalLike=0,this.totalDislike=0,this.sendingFeedBack=!1,this.loadingFeedBackSurvey=!1,this.disableLike=!1,this.surveyObjs=[]}}return(ie=be).\u0275fac=function(pe){return new(pe||ie)(f.rXU(o.ok),f.rXU(q.l_),f.rXU(h.CP,8),f.rXU(h.Vh,8))},ie.\u0275cmp=f.VBU({type:ie,selectors:[["exam-matrix-feedback-dialog"]],standalone:!0,features:[f.Vt3,f.aNF],decls:25,vars:19,consts:[["doneLoading",""],["SingleChoice",""],[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-3","border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"intro-y","overflow-auto",2,"max-height","calc(100vh - 150px)"],[1,"text-md","mr-auto","font-bold"],["class","border-t border-slate-200/60 dark:border-darkmode-400 py-2 mt-2",4,"ngIf"],[1,"border-t","border-slate-200/60","dark:border-darkmode-400","py-2","mt-2"],[3,"formGroup"],[1,"font-medium","text-md","text-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"p-3","text-right"],["azt-track-service","exam-matrix-feedback-dialog-qXEblgFcT",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","exam-matrix-feedback-dialog-NGlD5D-IvA",1,"btn","btn-primary","mw-24",3,"click","disabled"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"tex2jax_process","box-content",2,"width","auto"],[3,"content"],["class","grid grid-cols-12 gap-2 answers",4,"ngIf"],["class","font-medium text-md text-left text-success my-2",4,"ngIf"],[1,"grid","grid-cols-12","gap-2","answers"],["class","answer col-span-12 md:col-span-6",4,"ngFor","ngForOf"],[1,"answer","col-span-12","md:col-span-6"],[1,"answer-label"],[1,"answer-content"],[1,"font-medium","text-md","text-left","text-success","my-2"],[1,"font-medium","text-md","text-center"],[1,"help-content","box","px-3","mt-1",2,"display","inherit","border-top-right-radius","0","border-top-left-radius","0","box-shadow","none","overflow","auto","padding-bottom","20px"],[1,"flex","items-center","h-full","w-full"],[1,"w-8","h-8","mx-auto"],[4,"ngIf"],[1,"flex","items-center",2,"flex-wrap","wrap"],["azt-track-service","exam-matrix-feedback-dialog-PoMeFnagK",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-up","size","24",3,"ngClass"],["azt-track-service","exam-matrix-feedback-dialog-iJokCn34oQ",1,"btn","btn-sm","shadow-md","mt-2","mr-2",3,"click","disabled","ngClass"],["name","thumbs-down","size","20",3,"ngClass"],[1,"items-center","mt-1"],["id","text-area-feedback","type","text","cols","10","rows","3","formControlName","feedBackContent",1,"form-control","mt-1",3,"keyup","placeholder"],["class","flex flex-wrap mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","mb-2"],[2,"min-width","300px"],[1,"text-md","mb-2"],[1,"block","px-2","ml-2","sm:flex",3,"formGroupName"],["class","mr-5",4,"ngFor","ngForOf"],[1,"mr-5"],["type","checkbox",1,"form-check-input",3,"id","formControlName"],[2,"vertical-align","middle","cursor","pointer","margin-left","3px",3,"for"],["color","primary",1,"px-2",2,"flex-direction","column",3,"formControlName"],[4,"ngFor","ngForOf"],[1,"mr-5",3,"checked","value"],[1,"w-4","h-4","mr-2"]],template:function(pe,Xe){if(1&pe){const Ee=f.RV6();f.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),f.EFF(5),f.nI1(6,"mytranslate"),f.k0s(),f.DNE(7,tt,8,6,"div",7)(8,rt,6,4,"div",7),f.j41(9,"div",8)(10,"form",9)(11,"h2",10),f.EFF(12),f.nI1(13,"mytranslate"),f.k0s(),f.DNE(14,He,4,0,"ng-container",11)(15,Ke,15,24,"ng-template",null,0,f.C5r),f.k0s()()()()(),f.j41(17,"div",12)(18,"button",13),f.bIt("click",function(){return f.eBV(Ee),f.Njj(Xe.btnCloseDialog())}),f.EFF(19),f.nI1(20,"mytranslate"),f.k0s(),f.j41(21,"button",14),f.bIt("click",function(){return f.eBV(Ee),f.Njj(Xe.sendFeedBack())}),f.DNE(22,oe,2,0,"span",15),f.EFF(23),f.nI1(24,"mytranslate"),f.k0s()()()}if(2&pe){const Ee=f.sdS(16);f.R7$(5),f.SpI(" ",f.bMT(6,11,Xe.data.questionObj.isRoleTeacher?"lang_global_question_ask_to_feedback":"lang_global_question_ask_to_report")," "),f.R7$(2),f.Y8G("ngIf",Xe.data.questionObj.content),f.R7$(),f.Y8G("ngIf",Xe.data.questionObj.help&&Xe.data.questionObj.isRoleTeacher),f.R7$(2),f.Y8G("formGroup",Xe.form),f.R7$(2),f.SpI(" ",f.bMT(13,13,"lang_auto_nhan_xet")," "),f.R7$(2),f.Y8G("ngIf",Xe.loadingFeedBackSurvey)("ngIfElse",Ee),f.R7$(5),f.SpI(" ",f.bMT(20,15,"lang_auto_dong")," "),f.R7$(2),f.Y8G("disabled",Xe.sendingFeedBack||Xe.form.invalid),f.R7$(),f.Y8G("ngIf",Xe.sendingFeedBack),f.R7$(),f.SpI(" ",f.bMT(24,17,"lang_button_send")," ")}},dependencies:[te.x,b.R,Y.MD,Y.YU,Y.Sq,Y.bT,o.X1,o.qT,o.me,o.Zm,o.BC,o.cb,o.j4,o.JD,o.$R,le.iI,o.YN,J.wp,G.s,$.VT,$._g,x.flO,x.WGl,v.L,F.Id,_.k,d.t],styles:[".answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{border-radius:0 0 3px 3px;padding:8px 20px;justify-content:space-between;align-items:center}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content-of-question-standalone[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-standalone-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{min-width:20px;min-height:30px;display:flex;align-items:center;justify-content:flex-start;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}"]}),be})()},50334:(Tt,Ae,g)=>{"use strict";g.d(Ae,{C:()=>h});var o=g(59640);class h extends o.H{constructor(){super(...arguments),this.nodeObjs=[]}searchByText(ce){this.nodeObjs=(ce=this.standardSearchText(ce)).trim()?this.doSearchByText(ce,this.nodeObjs,[]):this.showAndExpandAll(this.nodeObjs)}expand(ce){ce.isExpand=!0}collapse(ce){ce.isExpand=!1}doSearchByText(ce,te,b){for(var Y of te){Y.isShow=!1;let le=this.standardSearchText(Y.text);(ce.includes(le)||le.includes(ce))&&(Y.isShow=!0,Y.isExpand=!0,b.forEach(J=>{J.isShow=!0,J.isExpand=!0})),Y.children.length&&(Y.children=this.doSearchByText(ce,Y.children,b.concat(Y)))}return te}showAndExpandAll(ce){for(var te of ce)te.isShow=!0,te.isExpand=!0,te.children=this.showAndExpandAll(te.children);return ce}standardSearchText(ce){return ce=ce.toLowerCase(),ce=this.commonService.removeSpecialStringInSearch(ce),this.commonService.convertVietnameseToEnglish(ce)}}},14987:(Tt,Ae,g)=>{"use strict";g.d(Ae,{i:()=>_});var o=g(59640),h=g(54460),y=g(10936),ce=g(65162),te=g(47348),b=g(21656),Y=g(15343),le=g(70050),J=g(5502),G=g(36894),x=g(48891),v=g(81587);function F(f,q){if(1&f&&(x.j41(0,"div",1)(1,"form",2),x.nrm(2,"input",3),x.nI1(3,"mytranslate"),x.nrm(4,"input",4),x.nI1(5,"mytranslate"),x.nrm(6,"input",5),x.nI1(7,"mytranslate"),x.nrm(8,"input",6),x.nI1(9,"mytranslate"),x.nrm(10,"input",7),x.nI1(11,"mytranslate"),x.k0s()()),2&f){const $=x.XpG();x.R7$(),x.Y8G("formGroup",$.form),x.R7$(),x.FS9("placeholder",x.bMT(3,6,"lang_azt_addition_info_exam_department_name")),x.R7$(2),x.FS9("placeholder",x.bMT(5,8,"lang_auto_ten_truong")),x.R7$(2),x.FS9("placeholder",x.bMT(7,10,"lang_azt_addition_info_exam_test_note")),x.R7$(2),x.FS9("placeholder",x.bMT(9,12,"lang_auto_mon_hoc_form")),x.R7$(2),x.FS9("placeholder",x.bMT(11,14,"lang_auto_thoi_gian"))}}let _=(()=>{var f;class q extends o.H{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject,departmentName:this.examPrintInfoObj.departmentName,indetifyBox:this.examPrintInfoObj.indetifyBox,timeBox:this.examPrintInfoObj.timeBox})}ngOnInit(){this.initData()}}return(f=q).\u0275fac=function(d){return new(d||f)},f.\u0275cmp=x.VBU({type:f,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},standalone:!0,features:[x.Vt3,x.aNF],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","department-name","type","text","formControlName","departmentName",1,"form-control","mt-3",3,"placeholder"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","indetify-box","type","text","formControlName","indetifyBox",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"],["id","time-box","type","text","formControlName","timeBox",1,"form-control","mt-3",3,"placeholder"]],template:function(d,de){1&d&&x.DNE(0,F,12,16,"div",0),2&d&&x.Y8G("ngIf",de.form)},dependencies:[h.MD,h.bT,y.X1,y.qT,y.me,y.BC,y.cb,y.j4,y.JD,ce.iI,y.YN,te.wp,b.s,Y.flO,le.L,J.Id,G.k,v.t],encapsulation:2}),q})()},30551:(Tt,Ae,g)=>{"use strict";g.d(Ae,{P:()=>He});var o=g(59640),h=g(54460),y=g(10936),ce=g(65162),te=g(47348),b=g(21656),Y=g(15343),le=g(70050),J=g(5502),G=g(36894),x=g(48891),v=g(37642),F=g(36484),_=g(99927),f=g(60303);const q=ve=>({"font-bold":ve});function $(ve,ze){if(1&ve&&(x.j41(0,"td",11),x.EFF(1),x.k0s()),2&ve){const ye=x.XpG().$implicit,Te=x.XpG().$implicit,Me=x.XpG(2);x.BMQ("rowspan",Te.length),x.R7$(),x.JRh(Me.toNumber(ye.index)+1)}}function d(ve,ze){if(1&ve&&(x.qex(0),x.j41(1,"tr"),x.DNE(2,$,2,2,"td",10),x.j41(3,"td",11),x.EFF(4),x.nI1(5,"formatFullDateTimeTimezoneByUserUnitPipe"),x.k0s(),x.j41(6,"td",12),x.EFF(7),x.k0s()(),x.bVm()),2&ve){const ye=ze.$implicit,Te=ze.index,Me=x.XpG(3);x.R7$(2),x.Y8G("ngIf",0==Te),x.R7$(2),x.JRh(x.bMT(5,4,1e3*ye.second)),x.R7$(2),x.Y8G("ngClass",x.eq3(6,q,ye.isFontBold)),x.R7$(),x.JRh(Me.isShowOriginAnswer?ye.key:ye.alpha?ye.alpha:ye.key)}}function de(ve,ze){if(1&ve&&(x.qex(0),x.DNE(1,d,8,8,"ng-container",9),x.bVm()),2&ve){const ye=ze.$implicit;x.R7$(),x.Y8G("ngForOf",ye)}}function z(ve,ze){if(1&ve&&(x.j41(0,"table",5)(1,"tr")(2,"th",6),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s(),x.j41(5,"th",7),x.EFF(6),x.nI1(7,"mytranslate"),x.k0s(),x.j41(8,"th",8),x.EFF(9),x.nI1(10,"mytranslate"),x.k0s()(),x.DNE(11,de,2,1,"ng-container",9),x.k0s()),2&ve){const ye=x.XpG();x.R7$(3),x.JRh(x.bMT(4,4,"lang_auto_cau_hoi")),x.R7$(3),x.JRh(x.bMT(7,6,"lang_auto_thoi_gian")),x.R7$(3),x.JRh(x.bMT(10,8,"lang_auto_dap_an")),x.R7$(2),x.Y8G("ngForOf",ye.groupObjs)}}function Ie(ve,ze){1&ve&&(x.j41(0,"div",13),x.EFF(1),x.nI1(2,"mytranslate"),x.k0s()),2&ve&&(x.R7$(),x.JRh(x.bMT(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}function me(ve,ze){if(1&ve&&(x.qex(0),x.j41(1,"tr")(2,"td",11),x.EFF(3),x.k0s(),x.j41(4,"td",11),x.EFF(5),x.nI1(6,"formatFullDateTimeTimezoneByUserUnitPipe"),x.k0s(),x.j41(7,"td",11),x.EFF(8),x.k0s()(),x.bVm()),2&ve){let ye;const Te=ze.$implicit;x.R7$(3),x.JRh(Te.userAgent),x.R7$(2),x.JRh(x.bMT(6,3,null!==(ye=Te.startedAt)&&void 0!==ye?ye:"")),x.R7$(3),x.JRh(Te.ip)}}function nt(ve,ze){if(1&ve&&(x.j41(0,"table",5)(1,"tr")(2,"th",6),x.EFF(3),x.nI1(4,"mytranslate"),x.k0s(),x.j41(5,"th",7),x.EFF(6),x.nI1(7,"mytranslate"),x.k0s(),x.j41(8,"th",8),x.EFF(9),x.nI1(10,"mytranslate"),x.k0s()(),x.DNE(11,me,9,5,"ng-container",9),x.k0s()),2&ve){const ye=x.XpG(2);x.R7$(3),x.JRh(x.bMT(4,4,"lang_auto_thong_tin_thiet_bi")),x.R7$(3),x.JRh(x.bMT(7,6,"lang_auto_thoi_gian")),x.R7$(3),x.JRh(x.bMT(10,8,"IP")),x.R7$(2),x.Y8G("ngForOf",ye.ipTrackingDataObjs)}}function tt(ve,ze){1&ve&&(x.j41(0,"div",13),x.EFF(1),x.nI1(2,"mytranslate"),x.k0s()),2&ve&&(x.R7$(),x.JRh(x.bMT(2,1,"lang_auto_khong_co_du_lieu")))}function rt(ve,ze){if(1&ve&&(x.j41(0,"mat-tab",1),x.nI1(1,"mytranslate"),x.j41(2,"div",2),x.DNE(3,nt,12,10,"table",3)(4,tt,3,3,"ng-template",null,0,x.C5r),x.k0s()()),2&ve){const ye=x.sdS(5),Te=x.XpG();x.FS9("label",x.bMT(1,3,"lang_auto_thong_tin_thiet_bi_IP")),x.R7$(3),x.Y8G("ngIf",Te.ipTrackingDataObjs.length>0)("ngIfElse",ye)}}let He=(()=>{var ve;class ze extends o.H{findReTapQuesions(){var Te=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var Me in Te)if(Te.hasOwnProperty(Me)){var we=Te[Me].map((Ke,oe)=>{let at=!1,ie=this.questionObjs.find(be=>be.id==Ke.questionId);if(this.answerTypeService.isTrueFalseAnswer(ie)){for(let be=Te[Me].length-1;be>=0;be--)if(Te[Me][be].key.includes(Ke.key.split("")[0])){at=Ke.key==Te[Me][be].key;break}}else at=oe==Te[Me].length-1;return{...Ke,isFontBold:at}});this.groupObjs.push(we)}}toNumber(Te){return parseInt(Te,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(Te,Me,we){super(),this.dictionaryService=Te,this.userService=Me,this.answerTypeService=we,this.startQuestionIndex=1,this.isShowOriginAnswer=!1,this.ipTrackingDataObjs=[],this.isTeacherRole=this.userService.isTeacherRole(),this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return(ve=ze).\u0275fac=function(Te){return new(Te||ve)(x.rXU(v.E),x.rXU(F.R),x.rXU(_._))},ve.\u0275cmp=x.VBU({type:ve,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",isShowOriginAnswer:"isShowOriginAnswer",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs",ipTrackingDataObjs:"ipTrackingDataObjs",questionObjs:"questionObjs"},standalone:!0,features:[x.Vt3,x.aNF],decls:8,vars:6,consts:[["noData",""],[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],[3,"label",4,"ngIf"],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(Te,Me){if(1&Te&&(x.j41(0,"mat-tab-group")(1,"mat-tab",1),x.nI1(2,"mytranslate"),x.j41(3,"div",2),x.DNE(4,z,12,10,"table",3)(5,Ie,3,3,"ng-template",null,0,x.C5r),x.k0s()(),x.DNE(7,rt,6,5,"mat-tab",4),x.k0s()),2&Te){const we=x.sdS(6);x.R7$(),x.FS9("label",x.bMT(2,4,"lang_auto_chi_tiet_chon_dap_an")),x.R7$(3),x.Y8G("ngIf",Me.groupObjs.length>0)("ngIfElse",we),x.R7$(3),x.Y8G("ngIf",Me.isTeacherRole)}},dependencies:[h.MD,h.YU,h.Sq,h.bT,y.X1,ce.iI,y.YN,te.wp,b.s,f.mq,f.T8,Y.flO,le.L,te.Ky,J.Id,G.k],encapsulation:2}),ze})()},59174:(Tt,Ae,g)=>{"use strict";g.d(Ae,{g:()=>je});var o=g(48891),h=g(38945),y=g(59640),ce=g(18718),te=g(68323),b=g(94743),Y=g(54460),le=g(10936),J=g(65162),G=g(47348),x=g(21656),v=g(15343),F=g(70050),_=g(5502),f=g(36894);const q=(_e,Se)=>({$implicit:_e,index:Se}),$=(_e,Se,$e)=>[_e,Se,$e],d=(_e,Se,$e)=>({second:_e,first:Se,third:$e}),de=_e=>({height:_e}),z=(_e,Se,$e)=>({"border-primary btn-gradient-primary":_e,"border-primary":Se,"mt-4":$e}),Ie=_e=>({"text-white":_e});function me(_e,Se){if(1&_e&&o.nrm(0,"azt-loading-effect",4),2&_e){const $e=o.XpG();o.Y8G("currentStatusObj",$e.statusObj)}}function nt(_e,Se){1&_e&&o.eu8(0)}function tt(_e,Se){if(1&_e&&(o.qex(0),o.DNE(1,nt,1,0,"ng-container",15),o.bVm()),2&_e){const $e=Se.$implicit,Le=Se.index;o.XpG(4);const ht=o.sdS(4);o.R7$(),o.Y8G("ngTemplateOutlet",ht)("ngTemplateOutletContext",o.l_i(2,q,$e,Le))}}function rt(_e,Se){if(1&_e){const $e=o.RV6();o.j41(0,"div",10),o.DNE(1,tt,2,5,"ng-container",11),o.j41(2,"div",12)(3,"button",13),o.bIt("click",function(){o.eBV($e);const ht=o.XpG(3);return o.Njj(ht.redirectToLeaderboard())}),o.EFF(4),o.nI1(5,"mytranslate"),o.nrm(6,"lucide-icon",14),o.k0s()()()}if(2&_e){const $e=o.XpG(3);o.R7$(),o.Y8G("ngForOf",$e.rankingResultList),o.R7$(3),o.SpI(" ",o.bMT(5,2,"lang_auto_xem_them")," ")}}function He(_e,Se){if(1&_e&&(o.j41(0,"div",31),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&_e){const $e=o.XpG().$implicit;o.R7$(),o.JRh($e.mark+" "+o.bMT(2,1,"lang_auto_diem"))}}function ve(_e,Se){1&_e&&(o.j41(0,"div",32),o.nrm(1,"azt-svg-icon",33),o.k0s()),2&_e&&(o.R7$(),o.Y8G("size",40))}function ze(_e,Se){1&_e&&(o.j41(0,"div",34),o.nrm(1,"azt-svg-icon",35),o.k0s()),2&_e&&(o.R7$(),o.Y8G("size",120))}function ye(_e,Se){1&_e&&(o.j41(0,"div",36),o.nrm(1,"azt-svg-icon",37),o.k0s()),2&_e&&(o.R7$(),o.Y8G("size",120))}function Te(_e,Se){1&_e&&(o.j41(0,"div"),o.nrm(1,"azt-svg-icon",38),o.k0s()),2&_e&&(o.R7$(),o.Y8G("size",120))}function Me(_e,Se){if(1&_e&&(o.qex(0),o.j41(1,"div",21)(2,"div",22),o.nrm(3,"azt-create-avatar",23),o.j41(4,"div",24),o.EFF(5),o.k0s(),o.DNE(6,He,3,3,"div",25)(7,ve,2,1,"div",26),o.k0s(),o.j41(8,"div",27),o.DNE(9,ze,2,1,"div",28)(10,ye,2,1,"div",29)(11,Te,2,1,"div",30),o.k0s()(),o.bVm()),2&_e){let $e,Le;const ht=Se.$implicit,Ye=Se.index;o.R7$(3),o.Y8G("linkAvatar",null==ht?null:ht.avatar)("nameCreateAvatar",null!==($e=null==ht?null:ht.fullName)&&void 0!==$e?$e:"???")("size",60),o.R7$(2),o.JRh(null!==(Le=null==ht?null:ht.fullName)&&void 0!==Le?Le:"???"),o.R7$(),o.Y8G("ngIf",null!=(null==ht?null:ht.mark)),o.R7$(),o.Y8G("ngIf",1===Ye),o.R7$(),o.Y8G("ngClass",o.sMw(10,d,0===Ye,1===Ye,2===Ye)),o.R7$(),o.Y8G("ngIf",0===Ye),o.R7$(),o.Y8G("ngIf",1===Ye),o.R7$(),o.Y8G("ngIf",2===Ye)}}function we(_e,Se){1&_e&&o.eu8(0)}function Ke(_e,Se){if(1&_e&&(o.qex(0),o.DNE(1,we,1,0,"ng-container",15),o.bVm()),2&_e){const $e=Se.$implicit,Le=Se.index;o.XpG(4);const ht=o.sdS(4);o.R7$(),o.Y8G("ngTemplateOutlet",ht)("ngTemplateOutletContext",o.l_i(2,q,$e,Le))}}function oe(_e,Se){if(1&_e&&(o.j41(0,"div",16)(1,"div",17)(2,"div",18),o.DNE(3,Me,12,14,"ng-container",11),o.k0s()(),o.j41(4,"div",19)(5,"ng-scrollbar",20),o.DNE(6,Ke,2,5,"ng-container",11),o.k0s()()()),2&_e){const $e=o.XpG(3);o.R7$(3),o.Y8G("ngForOf",o.sMw(2,$,$e.rankingSecond,$e.rankingFirst,$e.rankingThird)),o.R7$(3),o.Y8G("ngForOf",$e.rankingResultList)}}function at(_e,Se){if(1&_e&&(o.j41(0,"div",6)(1,"div",7),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.DNE(4,rt,7,4,"div",8)(5,oe,7,6,"div",9),o.k0s()),2&_e){const $e=o.XpG(2);o.R7$(2),o.SpI(" ",o.bMT(3,3,"lang_azt_leaderboard")," "),o.R7$(2),o.Y8G("ngIf","part"===$e.view),o.R7$(),o.Y8G("ngIf","full"===$e.view)}}function ie(_e,Se){if(1&_e&&(o.j41(0,"div",39)(1,"div",7),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s(),o.j41(4,"div",40)(5,"div",41),o.nrm(6,"azt-svg-icon",42),o.j41(7,"p",43),o.EFF(8),o.nI1(9,"mytranslate"),o.k0s()()()()),2&_e){const $e=o.XpG(2);o.R7$(2),o.SpI(" ",o.bMT(3,4,"lang_azt_leaderboard")," "),o.R7$(2),o.Y8G("ngStyle",o.eq3(8,de,"full"===$e.view?"70vh":"260px")),o.R7$(2),o.Y8G("size",82),o.R7$(2),o.JRh(o.bMT(9,6,"lang_not_data")+"!")}}function be(_e,Se){if(1&_e&&o.DNE(0,at,6,5,"div",5)(1,ie,10,10,"ng-template",null,2,o.C5r),2&_e){const $e=o.sdS(2),Le=o.XpG();o.Y8G("ngIf",Le.rankingResultList.length)("ngIfElse",$e)}}function H(_e,Se){if(1&_e&&(o.j41(0,"div",57),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&_e){const $e=o.XpG(),Le=$e.$implicit;o.Y8G("ngClass",o.eq3(4,Ie,0===$e.index&&Le.mark)),o.R7$(),o.SpI(" ",Le.mark+" "+o.bMT(2,2,"lang_auto_diem")," ")}}function pe(_e,Se){1&_e&&(o.j41(0,"div",58),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&_e&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"lang_not_data")," "))}function Xe(_e,Se){1&_e&&o.nrm(0,"azt-svg-icon",59),2&_e&&o.Y8G("size",40)}function Ee(_e,Se){1&_e&&o.nrm(0,"azt-svg-icon",60),2&_e&&o.Y8G("size",40)}function L(_e,Se){1&_e&&o.nrm(0,"azt-svg-icon",61),2&_e&&o.Y8G("size",40)}function se(_e,Se){if(1&_e&&(o.j41(0,"div",44)(1,"div",45)(2,"span",46),o.EFF(3),o.k0s()(),o.j41(4,"div",47)(5,"div",48),o.nrm(6,"azt-create-avatar",23),o.k0s(),o.j41(7,"div",49)(8,"div",50),o.EFF(9),o.k0s(),o.DNE(10,H,3,6,"div",51)(11,pe,3,3,"div",52),o.k0s()(),o.j41(12,"div",53),o.DNE(13,Xe,1,1,"azt-svg-icon",54)(14,Ee,1,1,"azt-svg-icon",55)(15,L,1,1,"azt-svg-icon",56),o.k0s()()),2&_e){const $e=Se.$implicit,Le=Se.index;o.Y8G("ngClass",o.sMw(11,z,0===Le&&$e.mark,(1===Le||2===Le)&&$e.mark,0!==Le)),o.R7$(3),o.JRh(Le+1),o.R7$(3),o.Y8G("linkAvatar",$e.avatar)("nameCreateAvatar",$e.fullName)("size",44),o.R7$(3),o.JRh($e.fullName),o.R7$(),o.Y8G("ngIf",null!=$e.mark),o.R7$(),o.Y8G("ngIf",null==$e.mark),o.R7$(2),o.Y8G("ngIf",0===Le&&$e.mark),o.R7$(),o.Y8G("ngIf",1===Le&&$e.mark),o.R7$(),o.Y8G("ngIf",2===Le&&$e.mark)}}let je=(()=>{var _e;class Se extends y.H{constructor(){super(...arguments),this.view="part",this.frontExamResultService=(0,o.WQX)(h.Ry),this.rankingResultList=[]}ngOnInit(){super.ngOnInit(),this.getRankingResultList()}getRankingResultList(){this.initStatusObj(),this.waitDestroy(this.frontExamResultService.apiFrontExamResultListRankingResultsGet(this.hashId,"part"===this.view?1:0,"part"===this.view?3:0).subscribe(Ye=>{if(!Ye.success)return this.errorStatusObj(Ye.message);this.rankingResultList=Ye.data?.objs??[],this.rankingFirst=this.rankingResultList?.[0],this.rankingSecond=this.rankingResultList?.[1],this.rankingThird=this.rankingResultList?.[2],this.successStatusObj()}))}redirectToLeaderboard(){const Le=this.commonService.getMyQueryParam("capacity")??"0",ht=this.commonService.getCurrentUrlWithoutLocale()+`?capacity=${Le}`;this.myNavigationWithQueryString(`/test/leaderboard/${this.hashId}`,`?backto=${encodeURIComponent(ht)}`)}}return(_e=Se).\u0275fac=(()=>{let $e;return function(ht){return($e||($e=o.xGo(_e)))(ht||_e)}})(),_e.\u0275cmp=o.VBU({type:_e,selectors:[["azt-leaderboard"]],inputs:{hashId:"hashId",view:"view"},standalone:!0,features:[o.Vt3,o.aNF],decls:5,vars:2,consts:[["doneLoading",""],["rankingResultItem",""],["emptyData",""],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],["class","p-4 leaderboard box",4,"ngIf","ngIfElse"],[1,"p-4","leaderboard","box"],[1,"text-lg","text-center","font-bold"],["class","mt-4",4,"ngIf"],["class","grid grid-cols-12 gap-6 mt-4",4,"ngIf"],[1,"mt-4"],[4,"ngFor","ngForOf"],[1,"mt-3","text-center"],[1,"btn","btn-outline-primary","btn-transparent",3,"click"],["name","chevron-right","size","16"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"grid","grid-cols-12","gap-6","mt-4"],[1,"col-span-12","md:col-span-6","flex","flex-col","h-full"],[1,"flex","items-end","mt-auto"],[1,"col-span-12","md:col-span-6","p-4","border","border-white","rounded-lg",2,"height","70vh"],["visibility","hover","track","vertical","pointerEventsMethod","scrollbar"],[1,"ranking"],[1,"user-ranking"],[3,"linkAvatar","nameCreateAvatar","size"],[1,"mt-1","font-medium","text-base"],["class","mt-1 font-medium",4,"ngIf"],["class","crown-top1",4,"ngIf"],[1,"tower","box","shadow-lg",3,"ngClass"],["style","padding-bottom: 15px",4,"ngIf"],["style","padding-bottom: 30px",4,"ngIf"],[4,"ngIf"],[1,"mt-1","font-medium"],[1,"crown-top1"],["type","crown-top1",3,"size"],[2,"padding-bottom","15px"],["type","cup-silver",3,"size"],[2,"padding-bottom","30px"],["type","cup-gold",3,"size"],["type","cup-copper",3,"size"],[1,"box","p-4"],[1,"mt-4","flex","items-center","justify-center",3,"ngStyle"],[1,"text-center","mx-auto"],["type","inbox-empty",3,"size"],[1,"font-medium","mt-5"],[1,"flex","items-center","box","intro-x","zoom-in","p-3","border","border-w-2",3,"ngClass"],[1,"w-5","h-5","rounded-full","border","border-slate-200","dark:border-slate-400","flex","items-center","justify-center"],[1,"text-xs","font-medium"],[1,"mx-3","flex","items-center"],[1,"image-fit","zoom-in"],[1,"ml-4"],[1,"font-medium","text-base"],["class","text-slate-600 mt-0.5 text-xs font-medium",3,"ngClass",4,"ngIf"],["class","text-slate-600 mt-0.5 text-xs font-medium",4,"ngIf"],[1,"ml-auto"],["type","crown-gold",3,"size",4,"ngIf"],["type","crown-silver",3,"size",4,"ngIf"],["type","crown-copper",3,"size",4,"ngIf"],[1,"text-slate-600","mt-0.5","text-xs","font-medium",3,"ngClass"],[1,"text-slate-600","mt-0.5","text-xs","font-medium"],["type","crown-gold",3,"size"],["type","crown-silver",3,"size"],["type","crown-copper",3,"size"]],template:function(Le,ht){if(1&Le&&o.DNE(0,me,1,1,"azt-loading-effect",3)(1,be,3,2,"ng-template",null,0,o.C5r)(3,se,16,15,"ng-template",null,1,o.C5r),2&Le){const Ye=o.sdS(2);o.Y8G("ngIf",ht.statusObj.loading)("ngIfElse",Ye)}},dependencies:[ce.K,te.p,b.m,Y.MD,Y.YU,Y.Sq,Y.bT,Y.T3,Y.B3,le.X1,J.iI,le.YN,G.wp,x.s,v.flO,v.WGl,F.L,_.Id,_.Yh,f.k],styles:[".leaderboard[_ngcontent-%COMP%]{background:#dae3fe}.mt-auto[_ngcontent-%COMP%]{margin-top:auto}.ranking[_ngcontent-%COMP%]{width:33.3333333333%}.user-ranking[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative}.crown-top1[_ngcontent-%COMP%]{position:absolute;top:-26px;left:50%;transform:rotate(30deg)}.tower[_ngcontent-%COMP%]{margin-top:15px;border-radius:25px 25px 0 0;display:flex;justify-content:center;align-items:flex-end}.first[_ngcontent-%COMP%]{height:200px}.second[_ngcontent-%COMP%]{height:160px}.third[_ngcontent-%COMP%]{height:120px}"]}),Se})()},78745:(Tt,Ae,g)=>{"use strict";g.d(Ae,{d:()=>z});var o=g(59640),h=g(54460),y=g(10936),ce=g(65162),te=g(15437),b=g(15343),Y=g(5502),le=g(21656),J=g(47348),G=g(70050),x=g(36894),v=g(48891),F=g(64160);const _=()=>({"mr-2":!0});function f(Ie,me){if(1&Ie){const nt=v.RV6();v.qex(0),v.j41(1,"div",6)(2,"p",7),v.EFF(3),v.nI1(4,"mytranslate"),v.k0s(),v.j41(5,"p",7),v.EFF(6),v.nI1(7,"mytranslate"),v.k0s(),v.j41(8,"div",8),v.nrm(9,"input",9),v.j41(10,"button",10),v.bIt("click",function(){v.eBV(nt);const rt=v.XpG();return v.Njj(rt.showCopySuccess())}),v.nrm(11,"lucide-icon",11),v.EFF(12),v.nI1(13,"mytranslate"),v.k0s()()(),v.bVm()}if(2&Ie){const nt=v.XpG();v.R7$(3),v.JRh(v.bMT(4,6,"lang_auto_hoac")),v.R7$(3),v.JRh(v.bMT(7,8,"lang_classroom_QR_join_link_copy")),v.R7$(3),v.Y8G("value",nt.linkUrl),v.R7$(),v.Y8G("cdkCopyToClipboard",nt.copyLinkToClipboard(nt.linkUrl)),v.R7$(),v.Y8G("ngClass",v.lJ4(12,_)),v.R7$(),v.SpI(" ",v.bMT(13,10,"lang_auto_sao_chep")," ")}}let q=(()=>{var Ie;class me extends o.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1,this.qrCodeDownloadLink=""}showCopySuccess(){this.showSuccessSnack("lang_auto_sao_chep_thanh_cong")}copyLinkToClipboard(tt){return tt}onChangeURL(tt){this.qrCodeDownloadLink=tt}downloadQrCode(){try{let tt=""!=this.fileName?this.commonService.createFileNameExportFile([this.fileName])+".jpg":this.commonService.createFileNameExportFile(["azota-qr-code-"])+".jpg";this.commonService.downloadFileByUrl(this.qrCodeDownloadLink.changingThisBreaksApplicationSecurity,tt)}catch{console.log("Download QrCode error")}}}return(Ie=me).\u0275fac=(()=>{let nt;return function(rt){return(nt||(nt=v.xGo(Ie)))(rt||Ie)}})(),Ie.\u0275cmp=v.VBU({type:Ie,selectors:[["azt-show-link"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},standalone:!0,features:[v.Vt3,v.aNF],decls:8,vars:11,consts:[["azt-track-service","download-qr-code-9t-9Wiu2xv",1,"box","p-3","text-center",3,"click"],[2,"background","#fff","padding","5px"],["colorDark","#2361ad","imageSrc","'images/Azota-For-QrCode-01.png' | coreModConvertCdnLinkOfGitHub",3,"qrCodeURL","allowEmptyString","qrdata","elementType","width","errorCorrectionLevel"],["azt-track-service","download-qr-code-RqVBz6g1z7",1,"btn","btn-outline-primary","btn-transparent","btn-sm","mx-auto","mt-2",3,"click"],["name","download","size","16",3,"ngClass"],[4,"ngIf"],[1,"text-center"],[1,"h5","mt-2","font-medium"],[1,"azt-copy","relative","mt-2"],["type","text","readonly","",1,"form-control","py-3","px-4","border-transparent","bg-slate-100","pr-10",2,"padding-right","120px",3,"value"],["azt-track-service","download-qr-code-yW-aFu0tO",1,"btn","btn-outline-primary","absolute","my-auto","inset-y-0","right-0",2,"border-top-left-radius","0","border-bottom-left-radius","0",3,"click","cdkCopyToClipboard"],["name","copy","size","16",3,"ngClass"]],template:function(tt,rt){1&tt&&(v.j41(0,"div",0),v.bIt("click",function(ve){return ve.stopPropagation()}),v.j41(1,"div",1)(2,"qrcode",2),v.bIt("qrCodeURL",function(ve){return rt.onChangeURL(ve)}),v.k0s()(),v.j41(3,"a",3),v.bIt("click",function(){return rt.downloadQrCode()}),v.nrm(4,"lucide-icon",4),v.EFF(5),v.nI1(6,"mytranslate"),v.k0s(),v.DNE(7,f,14,13,"ng-container",5),v.k0s()),2&tt&&(v.R7$(2),v.Y8G("allowEmptyString",!0)("qrdata",rt.linkUrl)("elementType","url")("width",128)("errorCorrectionLevel","M"),v.R7$(2),v.Y8G("ngClass",v.lJ4(10,_)),v.R7$(),v.SpI(" ",v.bMT(6,8,"lang_auto_tai_ve_may")," "),v.R7$(2),v.Y8G("ngIf",rt.showLink))},dependencies:[te.f,te.c,h.MD,h.YU,h.bT,y.X1,ce.iI,y.YN,J.wp,le.s,F.dF,b.flO,b.WGl,G.L,Y.Id,x.k],encapsulation:2}),me})();var $=g(17818),d=g(47712);const de=Ie=>({"w-80":Ie});let z=(()=>{var Ie;class me extends o.H{constructor(){super(...arguments),this.linkUrl="",this.fileName="",this.showLink=!1}}return(Ie=me).\u0275fac=(()=>{let nt;return function(rt){return(nt||(nt=v.xGo(Ie)))(rt||Ie)}})(),Ie.\u0275cmp=v.VBU({type:Ie,selectors:[["azt-download-qr-code"]],inputs:{linkUrl:"linkUrl",fileName:"fileName",showLink:"showLink"},standalone:!0,features:[v.Vt3,v.aNF],decls:7,vars:10,consts:[["showQrCode","matMenu"],["azt-track-service","download-qr-code-hiQXy_iTc",1,"btn","btn-outline-primary","btn-transparent","p-1",3,"matMenuTriggerFor","matTooltip"],["name","qr-code","size","24"],["xPosition","before"],[3,"ngClass"],[3,"linkUrl","fileName","showLink"]],template:function(tt,rt){if(1&tt&&(v.j41(0,"button",1),v.nI1(1,"mytranslate"),v.nrm(2,"lucide-icon",2),v.k0s(),v.j41(3,"mat-menu",3,0)(5,"div",4),v.nrm(6,"azt-show-link",5),v.k0s()()),2&tt){const He=v.sdS(4);v.FS9("matTooltip",v.bMT(1,6,"lang_auto_quet_hoac_tai_ma_qr_code")),v.Y8G("matMenuTriggerFor",He),v.R7$(5),v.Y8G("ngClass",v.eq3(8,de,rt.showLink)),v.R7$(),v.Y8G("linkUrl",rt.linkUrl)("fileName",rt.fileName)("showLink",rt.showLink)}},dependencies:[q,h.MD,h.YU,y.X1,ce.iI,y.YN,J.wp,le.s,$.kk,$.Cp,d.oV,b.flO,b.WGl,G.L,Y.Id,x.k],encapsulation:2}),me})()},8022:(Tt,Ae,g)=>{"use strict";g.d(Ae,{n:()=>at});var o=g(48891),h=g(52909),y=g(50334),ce=g(54460),te=g(10936),b=g(65162),Y=g(47348),le=g(21656),J=g(15343),G=g(70050),x=g(5502),v=g(36894);const F=ie=>({nodeObjs:ie}),_=ie=>({"padding-left":ie}),f=()=>({"rotate-90deg":!0}),q=()=>({"transition-3s":!0}),$=()=>({"ml-1":!0});function d(ie,be){1&ie&&o.eu8(0)}function de(ie,be){1&ie&&(o.j41(0,"label",6)(1,"span",7),o.EFF(2),o.nI1(3,"mytranslate"),o.k0s()()),2&ie&&(o.R7$(2),o.JRh(o.bMT(3,1,"lang_azt_structure_of_the_capacity_exam")))}function z(ie,be){1&ie&&o.eu8(0)}function Ie(ie,be){if(1&ie&&(o.qex(0),o.DNE(1,z,1,0,"ng-container",8),o.bVm()),2&ie){const H=o.XpG(2),pe=o.sdS(4);o.R7$(),o.Y8G("ngTemplateOutlet",pe)("ngTemplateOutletContext",o.eq3(2,F,H.nodeObjs))}}function me(ie,be){if(1&ie&&(o.DNE(0,de,4,3,"label",3),o.j41(1,"div",4),o.DNE(2,Ie,2,4,"ng-container",5),o.k0s()),2&ie){const H=o.XpG();o.Y8G("ngIf",H.isShowLabel),o.R7$(2),o.Y8G("ngIf",H.nodeObjs.length)}}function nt(ie,be){1&ie&&o.nrm(0,"lucide-icon",20),2&ie&&o.Y8G("ngClass",o.lJ4(1,f))}function tt(ie,be){1&ie&&o.nrm(0,"lucide-icon",21),2&ie&&o.Y8G("ngClass",o.lJ4(1,q))}function rt(ie,be){if(1&ie&&(o.j41(0,"span",22),o.EFF(1),o.nI1(2,"mytranslate"),o.nI1(3,"mytranslate"),o.nI1(4,"mytranslate"),o.k0s()),2&ie){const H=o.XpG(2).$implicit;o.R7$(),o.SpI(" ","("+o.bMT(2,1,"lang_auto_chon")+" "+H.data.folderData.totalPart+" "+o.bMT(3,3,"lang_azt_in")+" "+H.children.length+" "+o.bMT(4,5,"lang_azt_hereafter")+")"," ")}}function He(ie,be){if(1&ie){const H=o.RV6();o.qex(0),o.j41(1,"div",13),o.bIt("click",function(){o.eBV(H);const Xe=o.XpG().$implicit,Ee=o.XpG(3);return o.Njj(Ee.clickToNode(Xe))}),o.j41(2,"div",14),o.DNE(3,nt,1,2,"lucide-icon",15)(4,tt,1,2,"lucide-icon",16),o.nrm(5,"lucide-icon",17),o.j41(6,"span",18),o.EFF(7),o.k0s(),o.DNE(8,rt,5,7,"span",19),o.k0s()(),o.bVm()}if(2&ie){const H=o.XpG().$implicit;o.R7$(3),o.Y8G("ngIf",!H.isExpand),o.R7$(),o.Y8G("ngIf",H.isExpand),o.R7$(3),o.JRh(H.data.folderData.name),o.R7$(),o.Y8G("ngIf",H.children.length&&H.data.folderData.totalPart&&H.children.length!=H.data.folderData.totalPart)}}function ve(ie,be){if(1&ie&&(o.j41(0,"span"),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&ie){const H=o.XpG(2).$implicit;o.R7$(),o.Lme("\xa0(",H.data.examData.minutes," ",o.bMT(2,2,"lang_auto_minute"),")")}}function ze(ie,be){1&ie&&(o.j41(0,"span"),o.EFF(1),o.nI1(2,"mytranslate"),o.k0s()),2&ie&&(o.R7$(),o.SpI("\xa0(",o.bMT(2,1,"lang_auto_khong_gioi_han"),")"))}function ye(ie,be){if(1&ie){const H=o.RV6();o.qex(0),o.j41(1,"div",23),o.bIt("click",function(){o.eBV(H);const Xe=o.XpG().$implicit,Ee=o.XpG(3);return o.Njj(Ee.selectExam(Xe.data.examData))}),o.nrm(2,"lucide-icon",24),o.j41(3,"span",18),o.EFF(4),o.DNE(5,ve,3,4,"span",5)(6,ze,3,3,"span",5),o.k0s()(),o.bVm()}if(2&ie){const H=o.XpG().$implicit;o.R7$(2),o.Y8G("name",H.data.examData.isPublished?"file-check":"file")("ngClass",o.lJ4(5,$)),o.R7$(2),o.SpI(" ",H.data.examData.name," "),o.R7$(),o.Y8G("ngIf",H.data.examData.minutes),o.R7$(),o.Y8G("ngIf",!H.data.examData.minutes)}}function Te(ie,be){1&ie&&o.eu8(0)}function Me(ie,be){if(1&ie&&(o.qex(0),o.j41(1,"div",25),o.DNE(2,Te,1,0,"ng-container",8),o.k0s(),o.bVm()),2&ie){const H=o.XpG().$implicit;o.XpG(3);const pe=o.sdS(4);o.R7$(2),o.Y8G("ngTemplateOutlet",pe)("ngTemplateOutletContext",o.eq3(2,F,H.children))}}function we(ie,be){if(1&ie&&(o.qex(0),o.j41(1,"div",10)(2,"div",11)(3,"div",12),o.DNE(4,He,9,4,"ng-container",5)(5,ye,7,6,"ng-container",5),o.k0s(),o.DNE(6,Me,3,4,"ng-container",5),o.k0s()(),o.bVm()),2&ie){const H=be.$implicit;o.R7$(),o.Y8G("hidden",!H.isShow),o.R7$(),o.Y8G("ngStyle",o.eq3(9,_,H.level>0?"20px":"")),o.R7$(),o.yjJ("id","node-",H.randomHashId,"-",H.level,"-",H.nodeIndex,""),o.R7$(),o.Y8G("ngIf",H.data.folderData),o.R7$(),o.Y8G("ngIf",H.data.examData),o.R7$(),o.Y8G("ngIf",H.isExpand)}}function Ke(ie,be){if(1&ie&&(o.qex(0),o.DNE(1,we,7,11,"ng-container",9),o.bVm()),2&ie){const H=be.$implicit;o.R7$(),o.Y8G("ngForOf",H)}}function oe(ie,be){if(1&ie&&o.DNE(0,Ke,2,1,"ng-container",5),2&ie){const H=be.nodeObjs,pe=o.XpG();o.Y8G("ngIf",pe.asTemplateDataObj(H))}}let at=(()=>{var ie;class be extends y.C{constructor(){super(...arguments),this.isShowLabel=!0,this.isExpand=!0,this.showCountInfo=!1,this.getExamData=new o.bkB,this.nodeObjs=[],this.uuidService=(0,o.WQX)(h.D)}selectExam(pe){this.getExamData.emit(pe)}clickToNode(pe){pe.isExpand?this.collapse(pe):this.expand(pe)}asTemplateDataObj(pe){return pe}standardTreeNodes(pe,Xe,Ee){let L=[];return pe.forEach((se,je)=>{let _e=se.exam?void 0:{name:se.objectName??"Empty",totalPart:se.totalPart},Se=se.exam?{id:se.exam.id,hashId:se.exam.hashId??"",categoryId:se.exam.categoryId??0,name:se.exam.name,minutes:se.exam.minutes??0,totalQuestion:se.exam.countQuestion,isPublished:!!se.exam.isPublished}:void 0,$e={level:Xe,isExpand:this.isExpand,isShow:!0,nodeIndex:je,selected:!1,randomHashId:this.uuidService.getUuid(),data:{nodeId:se.objectId??0,isEdited:!1,folderData:_e,examData:Se,parentNodeId:Ee,children:se.children},children:[],text:"Not use"};$e.children=this.standardTreeNodes(se.children,Xe+1,$e.data.nodeId),L.push($e)}),L}ngOnChanges(pe){pe.rawNodes&&(this.nodeObjs=this.standardTreeNodes(this.rawNodes,0,0))}}return(ie=be).\u0275fac=(()=>{let H;return function(Xe){return(H||(H=o.xGo(ie)))(Xe||ie)}})(),ie.\u0275cmp=o.VBU({type:ie,selectors:[["app-capacity-exam-tree-in-view-mode-component"]],inputs:{rawNodes:"rawNodes",isShowLabel:"isShowLabel",isExpand:"isExpand",showCountInfo:"showCountInfo"},outputs:{getExamData:"getExamData"},standalone:!0,features:[o.Vt3,o.OA$,o.aNF],decls:5,vars:1,consts:[["mainContent",""],["recursiveListTmpl",""],[4,"ngTemplateOutlet"],["class","flex items-center",4,"ngIf"],["id","list-category-arr",1,"grid","grid-cols-12","gap-1"],[4,"ngIf"],[1,"flex","items-center"],[1,"font-medium","text-lg"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngFor","ngForOf"],[1,"col-span-12",3,"hidden"],[3,"ngStyle"],[1,"flex","items-center","mb-1","w-full","hover:bg-slate-100","dark:hover:bg-darkmode-400","rounded",3,"id"],[1,"flex","items-center","clickable","w-full",3,"click"],[1,"pt-2","pb-2"],["name","chevron-right","size","18",3,"ngClass",4,"ngIf"],["name","chevron-down","size","18",3,"ngClass",4,"ngIf"],["name","folder","size","18",2,"padding-left","5px"],[1,"ml-2"],["class","ml-1 text-slate-500 text-xs",4,"ngIf"],["name","chevron-right","size","18",3,"ngClass"],["name","chevron-down","size","18",3,"ngClass"],[1,"ml-1","text-slate-500","text-xs"],[1,"flex","items-center","pb-2","pt-2","clickable",3,"click"],["size","18",1,"text-pending",3,"name","ngClass"],[1,"grid","grid-cols-12","gap-1","w-full","children-tmp"]],template:function(pe,Xe){if(1&pe&&o.DNE(0,d,1,0,"ng-container",2)(1,me,3,2,"ng-template",null,0,o.C5r)(3,oe,1,1,"ng-template",null,1,o.C5r),2&pe){const Ee=o.sdS(2);o.Y8G("ngTemplateOutlet",Ee)}},dependencies:[ce.MD,ce.YU,ce.Sq,ce.bT,ce.T3,ce.B3,te.X1,b.iI,te.YN,Y.wp,le.s,J.flO,J.WGl,G.L,x.Id,v.k],encapsulation:2}),be})()},72802:(Tt,Ae,g)=>{"use strict";g.d(Ae,{f:()=>$e});var o=g(27691),h=g(48891),y=g(10936),ce=g(67421),te=g(59640),b=g(78111),Y=g(83229),le=g(84278),J=g(34815),G=g(54460),x=g(65162),v=g(47348),F=g(21656),_=g(15343),f=g(70050),q=g(5502),$=g(7919),d=g(36894),de=g(51913),z=g(58112),Ie=g(55465),me=g(76476),nt=g(48451),tt=g(47712),rt=g(81587);const He=["mnoteContainer"],ve=Le=>({display:Le}),ze=Le=>({border:Le}),ye=()=>({"mr-1":!0}),Te=Le=>({"is-invalid":Le});function Me(Le,ht){1&Le&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&Le&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function we(Le,ht){1&Le&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&Le&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Ke(Le,ht){1&Le&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&Le&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function oe(Le,ht){if(1&Le&&(h.j41(0,"div",18),h.DNE(1,Me,3,3,"span",19)(2,we,3,3,"span",19)(3,Ke,3,3,"span",19),h.k0s()),2&Le){const Ye=h.XpG().index,qe=h.XpG();h.R7$(),h.Y8G("ngIf",null==qe.form.controls["cau"+Ye].errors?null:qe.form.controls["cau"+Ye].errors.min),h.R7$(),h.Y8G("ngIf",null==qe.form.controls["cau"+Ye].errors?null:qe.form.controls["cau"+Ye].errors.max),h.R7$(),h.Y8G("ngIf",null==qe.form.controls["cau"+Ye].errors?null:qe.form.controls["cau"+Ye].errors.pattern)}}function at(Le,ht){if(1&Le){const Ye=h.RV6();h.j41(0,"div",11)(1,"div",12)(2,"lucide-icon",13),h.nI1(3,"mytranslate"),h.bIt("click",function(Fe){const Ne=h.eBV(Ye).index,ct=h.XpG();return h.Njj(ct.toggleVisibility(Fe,Ne))}),h.k0s(),h.j41(4,"span",14),h.EFF(5),h.nI1(6,"mytranslate"),h.j41(7,"span",15),h.nI1(8,"mytranslate"),h.EFF(9),h.nI1(10,"mytranslate"),h.k0s()(),h.nrm(11,"input",16),h.nI1(12,"mytranslate"),h.k0s(),h.DNE(13,oe,4,3,"div",17),h.k0s()}if(2&Le){let Ye;const qe=ht.$implicit,Fe=ht.index,Ne=h.XpG();h.Y8G("ngStyle",h.eq3(25,ze,Fe==Ne.questions.length-1?"none":"")),h.R7$(2),h.FS9("matTooltip",h.bMT(3,15,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),h.Y8G("ngClass",h.lJ4(27,ye)),h.R7$(3),h.Lme(" ",h.bMT(6,17,"lang_auto_cau")," ",(null!==(Ye=qe.indexLabel)&&void 0!==Ye?Ye:0)+1," "),h.R7$(2),h.FS9("matTooltip",h.bMT(8,19,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.R7$(2),h.Lme("(",qe.essMaxPoint," ",h.bMT(10,21,"lang_auto_diem_brackets"),""),h.R7$(2),h.FS9("placeholder",h.bMT(12,23,"lang_auto_nhap_diem")),h.Mz_("formControlName","cau",Fe,""),h.Y8G("readonly",!Ne.showForTeacher)("decimal",!0)("ngClass",h.eq3(28,Te,Ne.form.controls["cau"+Fe]&&Ne.form.controls["cau"+Fe].invalid)),h.R7$(2),h.Y8G("ngIf",Ne.form.controls["cau"+Fe].errors)}}function ie(Le,ht){if(1&Le){const Ye=h.RV6();h.j41(0,"div",20)(1,"button",21),h.bIt("click",function(){h.eBV(Ye);const Fe=h.XpG();return h.Njj(Fe.getMnoteJsonData())}),h.EFF(2),h.nI1(3,"mytranslate"),h.nI1(4,"mytranslate"),h.k0s()()}if(2&Le){const Ye=h.XpG();h.R7$(),h.Y8G("disabled",Ye.isLoading||Ye.form.invalid),h.R7$(),h.SpI(" ",Ye.isLoading?h.bMT(3,2,"lang_auto_dang_luu_doing"):h.bMT(4,4,"lang_auto_luu_diem")," ")}}function be(Le,ht){if(1&Le&&h.nrm(0,"azt-question-standalone-for-student-at-review-page",27),2&Le){let Ye;const qe=h.XpG().$implicit,Fe=h.XpG();h.Y8G("follower",Fe.followerRenderQuest)("examObj",Fe.examObj)("examConfig",Fe.examConfig)("questionObj",qe)("curQuestionIndex",null!==(Ye=qe.indexLabel)&&void 0!==Ye?Ye:0)("userAnswersObj",Fe.userAnswersObj)("currentTab","essay_tab")}}function H(Le,ht){if(1&Le&&h.nrm(0,"azt-question-standalone-for-teacher-at-review-page",28),2&Le){let Ye;const qe=h.XpG().$implicit,Fe=h.XpG();h.Y8G("follower",Fe.followerRenderQuest)("examObj",Fe.examObj)("questionObj",qe)("curQuestionIndex",null!==(Ye=qe.indexLabel)&&void 0!==Ye?Ye:0)("userAnswersObj",Fe.userAnswersObj)("orgExamObjs",Fe.orgExamObjs)("currentTab","essay_tab")}}function pe(Le,ht){1&Le&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&Le&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function Xe(Le,ht){1&Le&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&Le&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Ee(Le,ht){1&Le&&(h.j41(0,"span"),h.EFF(1),h.nI1(2,"mytranslate"),h.k0s()),2&Le&&(h.R7$(),h.SpI(" ",h.bMT(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function L(Le,ht){if(1&Le&&(h.j41(0,"div",18),h.DNE(1,pe,3,3,"span",19)(2,Xe,3,3,"span",19)(3,Ee,3,3,"span",19),h.k0s()),2&Le){const Ye=h.XpG(2).index,qe=h.XpG();h.R7$(),h.Y8G("ngIf",null==qe.form.controls["cau"+Ye].errors?null:qe.form.controls["cau"+Ye].errors.min),h.R7$(),h.Y8G("ngIf",null==qe.form.controls["cau"+Ye].errors?null:qe.form.controls["cau"+Ye].errors.max),h.R7$(),h.Y8G("ngIf",null==qe.form.controls["cau"+Ye].errors?null:qe.form.controls["cau"+Ye].errors.pattern)}}function se(Le,ht){if(1&Le&&(h.j41(0,"div",29)(1,"form",30)(2,"label",31),h.EFF(3),h.nI1(4,"mytranslate"),h.j41(5,"span",15),h.nI1(6,"mytranslate"),h.EFF(7),h.nI1(8,"mytranslate"),h.k0s(),h.EFF(9," : "),h.k0s(),h.nrm(10,"input",32),h.nI1(11,"mytranslate"),h.DNE(12,L,4,3,"div",17),h.k0s()()),2&Le){let Ye;const qe=h.XpG(),Fe=qe.$implicit,Ne=qe.index,ct=h.XpG();h.R7$(),h.Y8G("formGroup",ct.form),h.R7$(),h.FS9("for","cau_"+Ne),h.R7$(),h.Lme(" ",h.bMT(4,15,"lang_auto_nhap_diem_cau")," ",(null!==(Ye=Fe.indexLabel)&&void 0!==Ye?Ye:0)+1," "),h.R7$(2),h.FS9("matTooltip",h.bMT(6,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.R7$(2),h.Lme("(",Fe.essMaxPoint," ",h.bMT(8,19,"lang_auto_diem_brackets"),""),h.R7$(3),h.FS9("placeholder",h.bMT(11,21,"lang_auto_nhap_diem")),h.Mz_("formControlName","cau",Ne,""),h.Y8G("readonly",!ct.showForTeacher)("ngClass",h.eq3(23,Te,ct.form.controls["cau"+Ne]&&ct.form.controls["cau"+Ne].invalid))("id","cau_"+Ne)("decimal",!0),h.R7$(2),h.Y8G("ngIf",ct.form.controls["cau"+Ne].errors)}}function je(Le,ht){if(1&Le&&(h.j41(0,"div",22)(1,"div",23),h.DNE(2,be,1,7,"azt-question-standalone-for-student-at-review-page",24)(3,H,1,7,"azt-question-standalone-for-teacher-at-review-page",25)(4,se,13,25,"div",26),h.k0s()()),2&Le){const Ye=ht.index,qe=h.XpG();h.R7$(),h.Mz_("id","q_",Ye,""),h.R7$(),h.Y8G("ngIf",!qe.showForTeacher),h.R7$(),h.Y8G("ngIf",qe.showForTeacher),h.R7$(),h.Y8G("ngIf",qe.showForTeacher)}}function _e(Le,ht){1&Le&&(h.j41(0,"div",33)(1,"b"),h.EFF(2),h.nI1(3,"mytranslate"),h.k0s(),h.EFF(4),h.nI1(5,"mytranslate"),h.k0s()),2&Le&&(h.R7$(2),h.SpI("",h.bMT(3,2,"lang_auto_anh_bai_lam_tu_luan"),":"),h.R7$(2),h.SpI(" ",h.bMT(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function Se(Le,ht){if(1&Le){const Ye=h.RV6();h.j41(0,"div",34)(1,"button",35),h.bIt("click",function(){h.eBV(Ye);const Fe=h.XpG();return h.Njj(Fe.getMnoteJsonData())}),h.EFF(2),h.nI1(3,"mytranslate"),h.nI1(4,"mytranslate"),h.k0s()()}if(2&Le){const Ye=h.XpG();h.R7$(),h.Y8G("disabled",Ye.isLoading||Ye.form.invalid),h.R7$(),h.SpI(" ",Ye.isLoading?h.bMT(3,2,"lang_auto_dang_luu_doing"):h.bMT(4,4,"lang_auto_luu_diem")," ")}}let $e=(()=>{var Le;class ht extends te.H{parseValue(qe){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[qe]}getMaxPoint(qe){var Fe=0;for(let Ne=0;Ne<this.questions.length;Ne++)if(this.questions[Ne].id==qe){Fe=this.questions[Ne].scorePerQuestion??0;break}return Fe}toggleVisibility(qe,Fe){var Ne=qe.target,ct=document.getElementById(`q_${Fe}`);ct&&("block"==ct?.style.display?(ct.style.display="none",Ne&&(Ne.textContent="visibility_off")):(ct.style.display="block",Ne&&(Ne.textContent="visibility")))}isValidPoint(){let qe=0;var Fe=this.form.value;for(var Ne in Fe){var ct=Number(Ne.substring(3));Fe[Ne]>this.maxPointPerQuestion[ct]&&qe++}return!(qe>0)}validateForm(qe,Fe,Ne,ct){let Ze="";this.form.get("cau"+ct)?.valueChanges.pipe((0,ce.J)()).subscribe(([it,Re])=>{if(Ze="string"==typeof Re&&Re.includes(",")?Re.replace(",","."):Re,isNaN(+Ze))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+ct].setValue(Fe);else{let vt=parseFloat(Ze);vt>Ne&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),vt<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(qe,Fe){var Ne=(0,Y.q)(qe);this.apiUploadService.commonUploadForMarkResult(Ne,`essay_note_${Fe}_${this.resultID}.png`,"image/png").subscribe(ct=>{ct.type!=o.hv.UploadProgress&&(1==ct.success?(this.mnoteJsonData.pages[Fe].draw=ct.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(qe){this.pagesCount=0;for(let Fe=0;Fe<qe.length;Fe++)qe[Fe].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let Fe=0;Fe<qe.length;Fe++)qe[Fe].draw&&this.uploadBase64ToCDN(qe[Fe].draw,Fe)}sendDataToIframe(){const qe=document.getElementById("mNote"),Fe=qe?qe.contentWindow:null;if(null!==Fe)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var Ne=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=Ne){for(let Ze=0;Ze<Ne.pages.length;Ze++)Ne.pages[Ze].backgroundImage&&(Ne.pages[Ze].backgroundImage=this.sAztCommonCdnService.getMyCdn(Ne.pages[Ze].backgroundImage)),Ne.pages[Ze].draw&&(Ne.pages[Ze].draw=this.sAztCommonCdnService.getMyCdn(Ne.pages[Ze].draw));Ne=JSON.stringify(Ne),this.examResultObj.result=Ne}}var ct=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(ct?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let Ze=0;Ze<this.jsonData.pages.length;Ze++)this.jsonData.pages[Ze].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[Ze].backgroundImage=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[Ze].backgroundImage)),this.jsonData.pages[Ze].hasOwnProperty("draw")&&(this.jsonData.pages[Ze].draw=this.sAztCommonCdnService.getMyCdn(this.jsonData.pages[Ze].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),Fe.postMessage(this.jsonData,"*")}else{let Ze=[];this.files.forEach(Re=>{var vt=this.sAztCommonCdnService.getMyCdn(Re.url);vt&&Ze.push({backgroundImage:vt})}),Fe.postMessage({cmd:"initMNote",pages:Ze,mode:this.showForTeacher?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:Ze}}}checkMapBGImageWithFileLength(qe){var Fe=this.commonService.willDeleteParseJson(qe);let Ne=!1;if(0==this.files.length)Ne=!0;else if(this.files.length>0&&Fe&&Fe.pages&&this.files.length==Fe.pages.length){let ct=0;this.files.forEach((Ze,it)=>{Fe.pages[it]&&Fe.pages[it].backgroundImage&&Fe.pages[it].backgroundImage.indexOf(Ze.path)>-1&&ct++}),ct==this.files.length&&(Ne=!0)}return Ne}addBGImageByFileUrl(qe){var Fe=this.commonService.willDeleteParseJson(qe);return this.files.forEach((Ne,ct)=>{let Ze=!1;if(Fe&&Fe.pages){for(var it=0;it<Fe.pages.length;it++)if(Fe.pages[it]&&Fe.pages[it].backgroundImage&&Fe.pages[it].backgroundImage.indexOf(Ne.path)>-1){Ze=!0;break}!1===Ze&&(Fe.pages[ct]&&Fe.pages[ct].id==ct?Fe.pages[ct].backgroundImage=this.sAztCommonCdnService.getMyCdn(Ne.url??""):Fe.pages.splice(ct,0,{backgroundImage:this.sAztCommonCdnService.getMyCdn(Ne.url??"")}))}}),JSON.stringify(Fe)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let qe=!1;for(const Fe in this.form.value)""!==this.form.value[Fe]&&(qe=!0);if(!qe)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const Fe in this.form.value)""===this.form.value[Fe]&&(this.form.value[Fe]=0,this.form.controls[Fe].setValue(0));if(this.files&&this.files.length>0){const Fe=document.getElementById("mNote"),Ne=Fe?Fe.contentWindow:null;null!==Ne&&Ne.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(qe){if(this.checkMapBGImageWithFileLength(qe)){for(const Ze in this.form.value)"string"==typeof this.form.value[Ze]&&this.form.value[Ze].includes(",")&&(this.form.value[Ze]=this.form.value[Ze].replace(",","."));let ct=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var Ne={id:this.resultID,result:qe,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(Ne,ct).subscribe(Ze=>{1==Ze.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(Ze.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.whiteListMNoteIframeSrc=this.envService.getEnvValue("classliveUrl")??"";var qe={};let Fe;this.examResultObj.confirmedAt&&(Fe=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(ct=>{let Ze=this.getMaxPoint(ct.id);this.totalMaxPoint+=Ze,ct.essMaxPoint=Ze,this.maxPointPerQuestion.push(ct.essMaxPoint)});for(let ct=0;ct<this.questions.length;ct++){var Ne=`cau${ct}`;qe[Ne]=new y.MJ(Fe?Fe[Ne]:"",{validators:[y.k0.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),y.k0.min(0),y.k0.max(this.questions[ct].essMaxPoint??0)]})}this.form=new y.gE(qe),this.form.valueChanges.subscribe(ct=>{let Ze=JSON.stringify(ct);Ze!=this.prevData&&(this.prevData=Ze,this.form.patchValue(ct))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(qe,Fe,Ne,ct,Ze){super(),this.permissionService=qe,this.sAztCommonCdnService=Fe,this.envService=Ne,this.examResultService=ct,this.apiUploadService=Ze,this.orgExamObjs=[],this.questions=[],this.files=[],this.userAnswersObj={},this.resultID=0,this.whiteListMNoteIframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new h.bkB,this.followerRenderQuest=new b.e,this.form=new y.gE({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=it=>{"MNoteJson"==it.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=it.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==it.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return(Le=ht).\u0275fac=function(qe){return new(qe||Le)(h.rXU(de.p),h.rXU(z.c),h.rXU(Ie.t),h.rXU(me._),h.rXU(nt.T))},Le.\u0275cmp=h.VBU({type:Le,selectors:[["azt-mark-essay"]],viewQuery:function(qe,Fe){if(1&qe&&h.GBs(He,5),2&qe){let Ne;h.mGM(Ne=h.lsd())&&(Fe.mnoteContainer=Ne.first)}},inputs:{showForTeacher:"showForTeacher",examObj:"examObj",examConfig:"examConfig",orgExamObjs:"orgExamObjs",questions:"questions",files:"files",examResultObj:"examResultObj",userAnswersObj:"userAnswersObj",resultID:"resultID",whiteListMNoteIframeSrc:"whiteListMNoteIframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode"},outputs:{saveResultEvent:"saveResultEvent"},standalone:!0,features:[h.Vt3,h.aNF],decls:12,vars:12,consts:[["mnoteContainer",""],["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["name","eye","size","24",3,"click","ngClass","matTooltip"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"click","disabled"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab",4,"ngIf"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab",4,"ngIf"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[3,"follower","examObj","examConfig","questionObj","curQuestionIndex","userAnswersObj","currentTab"],[3,"follower","examObj","questionObj","curQuestionIndex","userAnswersObj","orgExamObjs","currentTab"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"click","disabled"]],template:function(qe,Fe){1&qe&&(h.j41(0,"div",1)(1,"form",2),h.DNE(2,at,14,30,"div",3),h.k0s(),h.DNE(3,ie,5,6,"div",4),h.k0s(),h.j41(4,"div",5),h.DNE(5,je,5,5,"div",6),h.k0s(),h.DNE(6,_e,6,6,"div",7),h.j41(7,"div",8,0),h.nrm(9,"iframe",9),h.nI1(10,"safe"),h.k0s(),h.DNE(11,Se,5,6,"div",10)),2&qe&&(h.R7$(),h.Y8G("formGroup",Fe.form),h.R7$(),h.Y8G("ngForOf",Fe.questions),h.R7$(),h.Y8G("ngIf",Fe.showForTeacher),h.R7$(2),h.Y8G("ngForOf",Fe.questions),h.R7$(),h.Y8G("ngIf",Fe.files&&0==Fe.files.length),h.R7$(),h.Y8G("ngStyle",h.eq3(10,ve,Fe.files&&0==Fe.files.length?"none":"block")),h.R7$(2),h.Y8G("src",h.bMT(10,8,Fe.whiteListMNoteIframeSrc),h.f$h),h.R7$(2),h.Y8G("ngIf",Fe.showForTeacher))},dependencies:[le.x,J.o,G.MD,G.YU,G.Sq,G.bT,G.B3,y.X1,y.qT,y.me,y.BC,y.cb,y.j4,y.JD,x.iI,y.YN,v.wp,F.s,tt.oV,_.flO,_.WGl,f.L,v.JI,q.Id,$.Z,d.k,rt.t],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),ht})()},74225:function(Tt,Ae,g){"use strict";var o=this&&this.__awaiter||function(te,b,Y,le){return new(Y||(Y=Promise))(function(G,x){function v(f){try{_(le.next(f))}catch(q){x(q)}}function F(f){try{_(le.throw(f))}catch(q){x(q)}}function _(f){f.done?G(f.value):function J(G){return G instanceof Y?G:new Y(function(x){x(G)})}(f.value).then(v,F)}_((le=le.apply(te,b||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.decodeScanOfflineFile=Ae.decode=void 0;const h=g(6178);Ae.decode=function y(te){return o(this,void 0,void 0,function*(){return h.AzotaFileDecode.decode(te)})},Ae.decodeScanOfflineFile=function ce(te){return o(this,void 0,void 0,function*(){return h.AzotaFileDecode.decodeScanOfflineFile(te)})}},25028:(Tt,Ae,g)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AzotaFile=Ae.FileType=void 0;const o=g(56784),h=g(70073);class y{}Ae.FileType=y,y.scanOffline="scanOffline";class ce{constructor(){}static fromZipFolder(b){let Y=new ce;return Y.folder=b,Y.readAztMain(),Y}readAztMain(){let b=this.folder.getUtf8Text("main.json");if(null==b)throw new o.InvalidAztFileException("Couldn't found main.json file");this.aztMain=h.AztMain.fromJsonString(b)}}Ae.AzotaFile=ce},6178:function(Tt,Ae,g){"use strict";var o=this&&this.__awaiter||function(b,Y,le,J){return new(le||(le=Promise))(function(x,v){function F(q){try{f(J.next(q))}catch($){v($)}}function _(q){try{f(J.throw(q))}catch($){v($)}}function f(q){q.done?x(q.value):function G(x){return x instanceof le?x:new le(function(v){v(x)})}(q.value).then(F,_)}f((J=J.apply(b,Y||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AzotaFileDecode=void 0;const h=g(59985),y=g(25589),ce=g(25028);class te{static decode(Y){return o(this,void 0,void 0,function*(){return h.ZipFolder.fromZip(Y).then(le=>{let J=ce.AzotaFile.fromZipFolder(le);return J.aztMain.fileType==ce.FileType.scanOffline?y.ScanOfflineFile.fromZipFolder(J.folder):J})})}static decodeScanOfflineFile(Y){return te.decode(Y).then(le=>le)}}Ae.AzotaFileDecode=te},70073:(Tt,Ae,g)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AztMain=void 0;const o=g(37182);class h{static fromJsonString(ce){return h.fromJson(JSON.parse(ce))}static fromJson(ce){return(0,o.plainToInstance)(h,ce)}}Ae.AztMain=h},56784:(Tt,Ae)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.InvalidAztFileException=void 0;class g extends Error{constructor(h){super(h)}}Ae.InvalidAztFileException=g},65057:(Tt,Ae)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.DrawingCircle=void 0;class g{static findCircle(h,y,ce){if(h)return h.find(te=>Math.pow(te.center.x-y,2)+Math.pow(te.center.y-ce,2)<=Math.pow(te.radius,2))}static processVertical(h,y,ce){const te=g.findCircle(h,y,ce);if(!te)return;if(te.filled)return void(te.filled=!1);const Y=te.label[0];h?.filter(le=>le.label[0]==Y).forEach(le=>le.filled=!1),te.filled=!0}static getValue(h,y=10){if(!h)return"";const ce=h?.length/y,te=[];for(let b=0;b<ce;b++)te.push("0");return h.forEach(b=>{if(!b.filled)return;const Y=b.label,le=parseInt(Y[0])-1;te[le]=Y[1]}),te.join("")}static setValue(h,y,ce=10){if(!h)return;for(let Y of h)Y.filled=!1;let te=h.length/ce,b=0;for(;b<te;){const Y=y%10;y=(y-Y)/10,h[te*Y+te-b-1].filled=!0,b++}}}Ae.DrawingCircle=g},81163:function(Tt,Ae,g){"use strict";var o=this&&this.__decorate||function(b,Y,le,J){var v,G=arguments.length,x=G<3?Y:null===J?J=Object.getOwnPropertyDescriptor(Y,le):J;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(b,Y,le,J);else for(var F=b.length-1;F>=0;F--)(v=b[F])&&(x=(G<3?v(x):G>3?v(Y,le,x):v(Y,le))||x);return G>3&&x&&Object.defineProperty(Y,le,x),x};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ScanOfflineData=void 0,g(8280);const h=g(37182),y=g(45726),ce=g(14326);class te{static fromJsonString(Y){return te.fromJson(JSON.parse(Y))}static fromJson(Y){return(0,h.plainToInstance)(te,Y)}}o([(0,h.Type)(()=>ce.ScanOfflineResult)],te.prototype,"scanResult",void 0),o([(0,h.Type)(()=>y.ScanOfflineRequest)],te.prototype,"scanRequest",void 0),Ae.ScanOfflineData=te},25589:function(Tt,Ae,g){"use strict";var o=this&&this.__decorate||function(x,v,F,_){var $,f=arguments.length,q=f<3?v:null===_?_=Object.getOwnPropertyDescriptor(v,F):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)q=Reflect.decorate(x,v,F,_);else for(var d=x.length-1;d>=0;d--)($=x[d])&&(q=(f<3?$(q):f>3?$(v,F,q):$(v,F))||q);return f>3&&q&&Object.defineProperty(v,F,q),q},h=this&&this.__awaiter||function(x,v,F,_){return new(F||(F=Promise))(function(q,$){function d(Ie){try{z(_.next(Ie))}catch(me){$(me)}}function de(Ie){try{z(_.throw(Ie))}catch(me){$(me)}}function z(Ie){Ie.done?q(Ie.value):function f(q){return q instanceof F?q:new F(function($){$(q)})}(Ie.value).then(d,de)}z((_=_.apply(x,v||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ScanOfflineFile=void 0;const y=g(25028),ce=g(59985),te=g(56784),b=g(70073),Y=g(37182),le=g(81163),J=g(14326);class G extends y.AzotaFile{constructor(){super()}static fromZipFolder(v){let F=new G;if(F.folder=v,F.readAztMain(),F.aztMain.fileType!=y.FileType.scanOffline)throw new te.InvalidAztFileException(`fileType must be ${y.FileType.scanOffline}`);let f=v.getUtf8Text(F.aztMain.detailPath);if(null==f)throw new te.InvalidAztFileException(`Couldn't found ${f} file`);return F.scanOfflineData=le.ScanOfflineData.fromJsonString(f),F}getWrappedImage(){var v,F;return null==(null===(F=null===(v=this.scanOfflineData)||void 0===v?void 0:v.scanResult)||void 0===F?void 0:F.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getFilledCircles(){var v,F,_;return null!==(_=null===(F=null===(v=this.scanOfflineData)||void 0===v?void 0:v.scanResult)||void 0===F?void 0:F.getFilledCircles())&&void 0!==_?_:[]}getWrappedImageExtension(){var v,F;let _=null===(F=null===(v=this.scanOfflineData)||void 0===v?void 0:v.scanResult)||void 0===F?void 0:F.wrappedScanFilePath;return null==_?null:_.substring(_.lastIndexOf("."))}static init(v,F,_){const f=new G;return f.folder=new ce.ZipFolder,f.aztMain=new b.AztMain,f.aztMain.fileType=y.FileType.scanOffline,f.aztMain.detailPath="scan_offline.json",f.aztMain.createdAt=(new Date).toString(),f.aztMain.createdBy=F,f.scanOfflineData=new le.ScanOfflineData,f.scanOfflineData.examHashId=v,f.scanOfflineData.scanResult=new J.ScanOfflineResult,f.scanOfflineData.scanRequest=_,f}setOriginalImage(v,F){const _=`media/original_scan_offline.${v}`;this.folder.setBinary(_,F),this.scanOfflineData.originalScanFilePath=_}setWrappedImage(v,F){const _=`media/wrapped_scan_offline.${v}`;this.folder.setBinary(_,F),this.scanOfflineData.scanResult.wrappedScanFilePath=_}setDebugImage(v,F){this.folder.setBinary(`debug_images/${v}`,F)}setScanResult(v){v.wrappedScanFilePath=this.scanOfflineData.scanResult.wrappedScanFilePath,this.scanOfflineData.scanResult=v}clickToImage(v,F){var _,f;null===(f=null===(_=this.scanOfflineData)||void 0===_?void 0:_.scanResult)||void 0===f||f.clickToImage(v,F)}setExamCode(v){var F,_;null===(_=null===(F=this.scanOfflineData)||void 0===F?void 0:F.scanResult)||void 0===_||_.setExamCode(v)}setStudentCode(v){var F,_;null===(_=null===(F=this.scanOfflineData)||void 0===F?void 0:F.scanResult)||void 0===_||_.setStudentCode(v)}toAztFile(){return h(this,void 0,void 0,function*(){return this.folder.setUtf8Text("main.json",JSON.stringify(this.aztMain)),this.folder.setUtf8Text("scan_offline.json",JSON.stringify(this.scanOfflineData)),this.folder.toZip()})}}o([(0,Y.Type)(()=>le.ScanOfflineData)],G.prototype,"scanOfflineData",void 0),Ae.ScanOfflineFile=G},45726:(Tt,Ae,g)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ScanOfflineRequest=void 0;const o=g(37182);class h{constructor(){this.templateType=void 0,this.blackRate=void 0,this.corners=[],this.corner2s=[]}static fromJsonString(ce){const te=JSON.parse(ce);return h.fromJson(te)}static fromJson(ce){return(0,o.plainToInstance)(h,ce)}}Ae.ScanOfflineRequest=h},14326:function(Tt,Ae,g){"use strict";var o=this&&this.__decorate||function(F,_,f,q){var de,$=arguments.length,d=$<3?_:null===q?q=Object.getOwnPropertyDescriptor(_,f):q;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(F,_,f,q);else for(var z=F.length-1;z>=0;z--)(de=F[z])&&(d=($<3?de(d):$>3?de(_,f,d):de(_,f))||d);return $>3&&d&&Object.defineProperty(_,f,d),d};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.DrawingRectangle=Ae.AnswerRegionResult=Ae.QuizFillBlank=Ae.Quiz4PartTrueFalse=Ae.Quiz4Option=Ae.StudentCodeRegionResult=Ae.ExamCodeRegionResult=Ae.ScanOfflineResult=void 0,g(8280);const h=g(37182),y=g(65057),ce=g(82601);class te{getSubExamCode(){var _,f;return null!==(f=null===(_=this.examCodeRegion)||void 0===_?void 0:_.getValue())&&void 0!==f?f:""}getStudentCode(){var _,f;return null!==(f=null===(_=this.studentCodeRegion)||void 0===_?void 0:_.getValue())&&void 0!==f?f:""}getEssayTotalPoint(){var _,f,q;const $=null!==(q=null===(f=y.DrawingCircle.getValue(null===(_=this.answerRegion)||void 0===_?void 0:_.essayCircles))||void 0===f?void 0:f.trim())&&void 0!==q?q:"";return""!=$?parseInt($)/100:void 0}getFilledCircles(){var _,f,q,$,d,de,z,Ie,me,nt,tt,rt;let He=[];return He.push(...null!==(f=null===(_=this.studentCodeRegion)||void 0===_?void 0:_.circles)&&void 0!==f?f:[]),He.push(...null!==($=null===(q=this.examCodeRegion)||void 0===q?void 0:q.circles)&&void 0!==$?$:[]),He.push(...null!==(de=null===(d=this.answerRegion)||void 0===d?void 0:d.circles)&&void 0!==de?de:[]),He.push(...null!==(Ie=null===(z=this.answerRegion)||void 0===z?void 0:z.essayCircles)&&void 0!==Ie?Ie:[]),He.push(...null!==(nt=null===(me=this.answerRegion)||void 0===me?void 0:me.trueFalseCircles)&&void 0!==nt?nt:[]),He.push(...null!==(rt=null===(tt=this.answerRegion)||void 0===tt?void 0:tt.fillBlankCircles)&&void 0!==rt?rt:[]),He.filter(ve=>ve.filled)}getQuiz4OptionAnswers(){var _,f;const q=null!==(f=null===(_=this.answerRegion)||void 0===_?void 0:_.circles)&&void 0!==f?f:[],$=q.length/4;let d=[];for(let de=0;de<$;de++)d.push("");return q.forEach(de=>{if(!de.filled)return;const z=new le(de.label);d[z.numbers-1]=z.letter}),d}getQuiz4PartTrueFalseAnswers(){var _,f;const q=null!==(f=null===(_=this.answerRegion)||void 0===_?void 0:_.trueFalseCircles)&&void 0!==f?f:[],$=q.length/2;let d=[];for(let de=0;de<$;de++)d.push(" ");return q.forEach(de=>{if(!de.filled)return;const z=new J(de.label),Ie=4*(z.numbers-1)+z.getPartIndex();d[Ie]=z.letter}),d}getQuizFillBlankAnswers(){var _,f;const q=null!==(f=null===(_=this.answerRegion)||void 0===_?void 0:_.fillBlankCircles)&&void 0!==f?f:[],$=q.length/48;let d=[];for(let de=0;de<$;de++)d.push([" "," "," "," "]);return q.forEach(de=>{if(!de.filled)return;const z=new G(de.label);d[z.numbers-1][z.cols]=z.rowLabel}),d.map(de=>de.join(""))}clickToImage(_,f){var q,$,d;null===(q=this.examCodeRegion)||void 0===q||q.clickToImage(_,f),null===($=this.studentCodeRegion)||void 0===$||$.clickToImage(_,f),null===(d=this.answerRegion)||void 0===d||d.clickToImage(_,f)}setExamCode(_){var f;null===(f=this.examCodeRegion)||void 0===f||f.setValue(_)}setStudentCode(_){var f;null===(f=this.studentCodeRegion)||void 0===f||f.setValue(_)}}o([(0,h.Type)(()=>b)],te.prototype,"examCodeRegion",void 0),o([(0,h.Type)(()=>Y)],te.prototype,"studentCodeRegion",void 0),o([(0,h.Type)(()=>x)],te.prototype,"answerRegion",void 0),Ae.ScanOfflineResult=te;class b extends ce.VerticalRegion{}Ae.ExamCodeRegionResult=b;class Y extends ce.VerticalRegion{}Ae.StudentCodeRegionResult=Y;class le{constructor(_){const q=_.match(/(\d+)([A-Z])/);if(!q)throw new Error(`Invalid label: ${_}`);this.numbers=parseInt(q[1]),this.letter=q[2]}}Ae.Quiz4Option=le;class J{constructor(_){const q=_.match(/(\d+)([A-D])([TF])/);if(!q)throw new Error(`Invalid label: ${_}`);this.numbers=parseInt(q[1]),this.part=q[2],this.letter=q[3]}getPartIndex(){return"ABCD".indexOf(this.part)}}Ae.Quiz4PartTrueFalse=J;class G{constructor(_){const f=_.split("_");if(3!=f.length)throw new Error(`Invalid label: ${_}`);this.numbers=parseInt(f[0]),this.cols=parseInt(f[1]),this.rowLabel=f[2]}}Ae.QuizFillBlank=G;class x{clickToImage(_,f){var q,$,d;y.DrawingCircle.processVertical(this.essayCircles,_,f);{const de=y.DrawingCircle.findCircle(this.circles,_,f);if(de){if(de.filled)return void(de.filled=!1);const z=new le(de.label);null===(q=this.circles)||void 0===q||q.filter(Ie=>new le(Ie.label).numbers==z.numbers).forEach(Ie=>Ie.filled=!1),de.filled=!0}}{const de=y.DrawingCircle.findCircle(this.trueFalseCircles,_,f);if(de){if(de.filled)return void(de.filled=!1);const z=new J(de.label);null===($=this.trueFalseCircles)||void 0===$||$.filter(Ie=>{const me=new J(Ie.label);return me.numbers==z.numbers&&me.part==z.part}).forEach(Ie=>Ie.filled=!1),de.filled=!0}}{const de=y.DrawingCircle.findCircle(this.fillBlankCircles,_,f);if(de){if(de.filled)return void(de.filled=!1);const z=new G(de.label);null===(d=this.fillBlankCircles)||void 0===d||d.filter(Ie=>{const me=new G(Ie.label);return me.numbers==z.numbers&&me.cols==z.cols}).forEach(Ie=>Ie.filled=!1),de.filled=!0}}}}Ae.AnswerRegionResult=x,Ae.DrawingRectangle=class v{}},82601:(Tt,Ae,g)=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.VerticalRegion=void 0;const o=g(65057);Ae.VerticalRegion=class h{clickToImage(ce,te){o.DrawingCircle.processVertical(this.circles,ce,te)}getValue(ce=10){return o.DrawingCircle.getValue(this.circles,ce)}setValue(ce,te=10){o.DrawingCircle.setValue(this.circles,ce,te)}}},59985:function(Tt,Ae,g){"use strict";var o=this&&this.__awaiter||function(ce,te,b,Y){return new(b||(b=Promise))(function(J,G){function x(_){try{F(Y.next(_))}catch(f){G(f)}}function v(_){try{F(Y.throw(_))}catch(f){G(f)}}function F(_){_.done?J(_.value):function le(J){return J instanceof b?J:new b(function(G){G(J)})}(_.value).then(x,v)}F((Y=Y.apply(ce,te||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ZipFolder=void 0;const h=g(91478);class y{constructor(te){this.files=new Map,te&&te.forEach((b,Y)=>{this.files.set(Y,b)})}static fromZip(te){return o(this,void 0,void 0,function*(){let Y=yield(new h).loadAsync(te).then(le=>{const J=[];return le.forEach(function(G){let x=le.file(G);x&&J.push(x.async("uint8array").then(v=>({path:G,data:v})))}),J});return Promise.all(Y).then(le=>{let J=new Map;return le.forEach(G=>{J.set(G.path,G.data)}),new y(J)})})}setBinary(te,b){const Y=Uint8Array.from(b);this.files.set(te,Y)}setUtf8Text(te,b){let Y=(new TextEncoder).encode(b);this.files.set(te,Y)}getBinary(te){var b;return null!==(b=this.files.get(te))&&void 0!==b?b:null}getUtf8Text(te){let b=this.files.get(te);return null===b?null:(new TextDecoder).decode(b)}toZip(){return o(this,void 0,void 0,function*(){const te=new h;for(let[b,Y]of Array.from(this.files))te.file(b,Y,{binary:!0});return te.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return o(this,void 0,void 0,function*(){const te=new h;for(let[b,Y]of Array.from(this.files))te.file(b,Y,{binary:!0});return te.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}Ae.ZipFolder=y},8280:()=>{var Tt,Ae;Ae=Tt||(Tt={}),function(g){var o="object"==typeof globalThis?globalThis:"object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:function b(){return function ce(){try{return Function("return this;")()}catch{}}()||function te(){try{return(0,eval)("(function() { return this; })()")}catch{}}()}(),h=y(Ae);function y(Y,le){return function(J,G){Object.defineProperty(Y,J,{configurable:!0,writable:!0,value:G}),le&&le(J,G)}}typeof o.Reflect<"u"&&(h=y(o.Reflect,h)),function(g,o){var h=Object.prototype.hasOwnProperty,y="function"==typeof Symbol,ce=y&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",te=y&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",b="function"==typeof Object.create,Y={__proto__:[]}instanceof Array,le=!b&&!Y,J={create:b?function(){return et(Object.create(null))}:Y?function(){return et({__proto__:null})}:function(){return et({})},has:le?function(V,X){return h.call(V,X)}:function(V,X){return X in V},get:le?function(V,X){return h.call(V,X)?V[X]:void 0}:function(V,X){return V[X]}},G=Object.getPrototypeOf(Function),x="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function Je(){var V={},X=[],ee=function(){function I(O,E,R){this._index=0,this._keys=O,this._values=E,this._selector=R}return I.prototype["@@iterator"]=function(){return this},I.prototype[te]=function(){return this},I.prototype.next=function(){var O=this._index;if(O>=0&&O<this._keys.length){var E=this._selector(this._keys[O],this._values[O]);return O+1>=this._keys.length?(this._index=-1,this._keys=X,this._values=X):this._index++,{value:E,done:!1}}return{value:void 0,done:!0}},I.prototype.throw=function(O){throw this._index>=0&&(this._index=-1,this._keys=X,this._values=X),O},I.prototype.return=function(O){return this._index>=0&&(this._index=-1,this._keys=X,this._values=X),{value:O,done:!0}},I}();return function(){function I(){this._keys=[],this._values=[],this._cacheKey=V,this._cacheIndex=-2}return Object.defineProperty(I.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),I.prototype.has=function(O){return this._find(O,!1)>=0},I.prototype.get=function(O){var E=this._find(O,!1);return E>=0?this._values[E]:void 0},I.prototype.set=function(O,E){var R=this._find(O,!0);return this._values[R]=E,this},I.prototype.delete=function(O){var E=this._find(O,!1);if(E>=0){for(var R=this._keys.length,M=E+1;M<R;M++)this._keys[M-1]=this._keys[M],this._values[M-1]=this._values[M];return this._keys.length--,this._values.length--,Ye(O,this._cacheKey)&&(this._cacheKey=V,this._cacheIndex=-2),!0}return!1},I.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=V,this._cacheIndex=-2},I.prototype.keys=function(){return new ee(this._keys,this._values,B)},I.prototype.values=function(){return new ee(this._keys,this._values,Z)},I.prototype.entries=function(){return new ee(this._keys,this._values,P)},I.prototype["@@iterator"]=function(){return this.entries()},I.prototype[te]=function(){return this.entries()},I.prototype._find=function(O,E){if(!Ye(this._cacheKey,O)){this._cacheIndex=-1;for(var R=0;R<this._keys.length;R++)if(Ye(this._keys[R],O)){this._cacheIndex=R;break}}return this._cacheIndex<0&&E&&(this._cacheIndex=this._keys.length,this._keys.push(O),this._values.push(void 0)),this._cacheIndex},I}();function B(I,O){return I}function Z(I,O){return O}function P(I,O){return[I,O]}}(),v="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function Lt(){return function(){function X(){this._map=new x}return Object.defineProperty(X.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),X.prototype.has=function(ee){return this._map.has(ee)},X.prototype.add=function(ee){return this._map.set(ee,ee),this},X.prototype.delete=function(ee){return this._map.delete(ee)},X.prototype.clear=function(){this._map.clear()},X.prototype.keys=function(){return this._map.keys()},X.prototype.values=function(){return this._map.keys()},X.prototype.entries=function(){return this._map.entries()},X.prototype["@@iterator"]=function(){return this.keys()},X.prototype[te]=function(){return this.keys()},X}()}(),F="function"==typeof WeakMap?WeakMap:function xt(){var V=16,X=J.create(),ee=S();return function(){function O(){this._key=S()}return O.prototype.has=function(E){var R=B(E,!1);return void 0!==R&&J.has(R,this._key)},O.prototype.get=function(E){var R=B(E,!1);return void 0!==R?J.get(R,this._key):void 0},O.prototype.set=function(E,R){return B(E,!0)[this._key]=R,this},O.prototype.delete=function(E){var R=B(E,!1);return void 0!==R&&delete R[this._key]},O.prototype.clear=function(){this._key=S()},O}();function S(){var O;do{O="@@WeakMap@@"+I()}while(J.has(X,O));return X[O]=!0,O}function B(O,E){if(!h.call(O,ee)){if(!E)return;Object.defineProperty(O,ee,{value:J.create()})}return O[ee]}function Z(O,E){for(var R=0;R<E;++R)O[R]=255*Math.random()|0;return O}function I(){var O=function P(O){if("function"==typeof Uint8Array){var E=new Uint8Array(O);return typeof crypto<"u"?crypto.getRandomValues(E):typeof msCrypto<"u"?msCrypto.getRandomValues(E):Z(E,O),E}return Z(new Array(O),O)}(V);O[6]=79&O[6]|64,O[8]=191&O[8]|128;for(var E="",R=0;R<V;++R){var M=O[R];(4===R||6===R||8===R)&&(E+="-"),M<16&&(E+="0"),E+=M.toString(16).toLowerCase()}return E}}(),_=y?Symbol.for("@reflect-metadata:registry"):void 0,f=function vt(){var V;return!be(_)&&Xe(o.Reflect)&&Object.isExtensible(o.Reflect)&&(V=o.Reflect[_]),be(V)&&(V=function Re(){var V;!be(_)&&typeof o.Reflect<"u"&&!(_ in o.Reflect)&&"function"==typeof o.Reflect.defineMetadata&&(V=function fe(V){var X=V.defineMetadata,ee=V.hasOwnMetadata,S=V.getOwnMetadata,B=V.getOwnMetadataKeys,Z=V.deleteMetadata,P=new F;return{isProviderFor:function(O,E){var R=P.get(O);return!(be(R)||!R.has(E))||!!B(O,E).length&&(be(R)&&(R=new v,P.set(O,R)),R.add(E),!0)},OrdinaryDefineOwnMetadata:X,OrdinaryHasOwnMetadata:ee,OrdinaryGetOwnMetadata:S,OrdinaryOwnMetadataKeys:B,OrdinaryDeleteMetadata:Z}}(o.Reflect));var X,ee,S,B=new F,Z={registerProvider:P,getProvider:O,setProvider:R};return Z;function P(M){if(!Object.isExtensible(Z))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case V===M:break;case be(X):X=M;break;case X===M:break;case be(ee):ee=M;break;case ee===M:break;default:void 0===S&&(S=new v),S.add(M)}}function I(M,U){if(!be(X)){if(X.isProviderFor(M,U))return X;if(!be(ee)){if(ee.isProviderFor(M,U))return X;if(!be(S))for(var xe=Fe(S);;){var Pe=ct(xe);if(!Pe)return;var D=Ne(Pe);if(D.isProviderFor(M,U))return Ze(xe),D}}}if(!be(V)&&V.isProviderFor(M,U))return V}function O(M,U){var Pe,xe=B.get(M);return be(xe)||(Pe=xe.get(U)),be(Pe)&&(be(Pe=I(M,U))||(be(xe)&&(xe=new x,B.set(M,xe)),xe.set(U,Pe))),Pe}function E(M){if(be(M))throw new TypeError;return X===M||ee===M||!be(S)&&S.has(M)}function R(M,U,xe){if(!E(xe))throw new Error("Metadata provider not registered.");var Pe=O(M,U);if(Pe!==xe){if(!be(Pe))return!1;var D=B.get(M);be(D)&&(D=new x,B.set(M,D)),D.set(U,xe)}return!0}}()),!be(_)&&Xe(o.Reflect)&&Object.isExtensible(o.Reflect)&&Object.defineProperty(o.Reflect,_,{enumerable:!1,configurable:!1,writable:!1,value:V}),V}(),q=function Ue(V){var X=new F,ee={isProviderFor:function(E,R){var M=X.get(E);return!be(M)&&M.has(R)},OrdinaryDefineOwnMetadata:function P(E,R,M,U){S(M,U,!0).set(E,R)},OrdinaryHasOwnMetadata:function B(E,R,M){var U=S(R,M,!1);return!be(U)&&se(U.has(E))},OrdinaryGetOwnMetadata:function Z(E,R,M){var U=S(R,M,!1);if(!be(U))return U.get(E)},OrdinaryOwnMetadataKeys:function I(E,R){var M=[],U=S(E,R,!1);if(be(U))return M;for(var Pe=Fe(U.keys()),D=0;;){var Ve=ct(Pe);if(!Ve)return M.length=D,M;var De=Ne(Ve);try{M[D]=De}catch(mt){try{Ze(Pe)}finally{throw mt}}D++}},OrdinaryDeleteMetadata:function O(E,R,M){var U=S(R,M,!1);if(be(U)||!U.delete(E))return!1;if(0===U.size){var xe=X.get(R);be(xe)||(xe.delete(M),0===xe.size&&X.delete(xe))}return!0}};return f.registerProvider(ee),ee;function S(E,R,M){var U=X.get(E),xe=!1;if(be(U)){if(!M)return;U=new x,X.set(E,U),xe=!0}var Pe=U.get(R);if(be(Pe)){if(!M)return;if(Pe=new x,U.set(R,Pe),!V.setProvider(E,R,ee))throw U.delete(R),xe&&X.delete(E),new Error("Wrong provider for target.")}return Pe}}(f);function ye(V,X,ee){if(Te(V,X,ee))return!0;var B=it(X);return!H(B)&&ye(V,B,ee)}function Te(V,X,ee){var S=We(X,ee,!1);return!be(S)&&se(S.OrdinaryHasOwnMetadata(V,X,ee))}function Me(V,X,ee){if(Te(V,X,ee))return we(V,X,ee);var B=it(X);return H(B)?void 0:Me(V,B,ee)}function we(V,X,ee){var S=We(X,ee,!1);if(!be(S))return S.OrdinaryGetOwnMetadata(V,X,ee)}function Ke(V,X,ee,S){We(ee,S,!0).OrdinaryDefineOwnMetadata(V,X,ee,S)}function oe(V,X){var ee=at(V,X),S=it(V);if(null===S)return ee;var B=oe(S,X);if(B.length<=0)return ee;if(ee.length<=0)return B;for(var Z=new v,P=[],I=0,O=ee;I<O.length;I++)Z.has(E=O[I])||(Z.add(E),P.push(E));for(var M=0,U=B;M<U.length;M++){var E;Z.has(E=U[M])||(Z.add(E),P.push(E))}return P}function at(V,X){var ee=We(V,X,!1);return ee?ee.OrdinaryOwnMetadataKeys(V,X):[]}function ie(V){if(null===V)return 1;switch(typeof V){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===V?1:6;default:return 6}}function be(V){return void 0===V}function H(V){return null===V}function Xe(V){return"object"==typeof V?null!==V:"function"==typeof V}function Ee(V,X){switch(ie(V)){case 0:case 1:case 2:case 3:case 4:case 5:return V}var ee=3===X?"string":5===X?"number":"default",S=qe(V,ce);if(void 0!==S){var B=S.call(V,ee);if(Xe(B))throw new TypeError;return B}return function L(V,X){if("string"===X){var ee=V.toString;if($e(ee)&&!Xe(S=ee.call(V)))return S;if($e(B=V.valueOf)&&!Xe(S=B.call(V)))return S}else{var B;if($e(B=V.valueOf)&&!Xe(S=B.call(V)))return S;var S,Z=V.toString;if($e(Z)&&!Xe(S=Z.call(V)))return S}throw new TypeError}(V,"default"===ee?"number":ee)}function se(V){return!!V}function _e(V){var X=Ee(V,3);return function pe(V){return"symbol"==typeof V}(X)?X:function je(V){return""+V}(X)}function Se(V){return Array.isArray?Array.isArray(V):V instanceof Object?V instanceof Array:"[object Array]"===Object.prototype.toString.call(V)}function $e(V){return"function"==typeof V}function Le(V){return"function"==typeof V}function Ye(V,X){return V===X||V!=V&&X!=X}function qe(V,X){var ee=V[X];if(null!=ee){if(!$e(ee))throw new TypeError;return ee}}function Fe(V){var X=qe(V,te);if(!$e(X))throw new TypeError;var ee=X.call(V);if(!Xe(ee))throw new TypeError;return ee}function Ne(V){return V.value}function ct(V){var X=V.next();return!X.done&&X}function Ze(V){var X=V.return;X&&X.call(V)}function it(V){var X=Object.getPrototypeOf(V);if("function"!=typeof V||V===G||X!==G)return X;var ee=V.prototype,S=ee&&Object.getPrototypeOf(ee);if(null==S||S===Object.prototype)return X;var B=S.constructor;return"function"!=typeof B||B===V?X:B}function We(V,X,ee){var S=f.getProvider(V,X);if(!be(S))return S;if(ee){if(f.setProvider(V,X,q))return q;throw new Error("Illegal state.")}}function et(V){return V.__=void 0,delete V.__,V}g("decorate",function $(V,X,ee,S){if(be(ee)){if(!Se(V))throw new TypeError;if(!Le(X))throw new TypeError;return function ve(V,X){for(var ee=V.length-1;ee>=0;--ee){var B=(0,V[ee])(X);if(!be(B)&&!H(B)){if(!Le(B))throw new TypeError;X=B}}return X}(V,X)}if(!Se(V))throw new TypeError;if(!Xe(X))throw new TypeError;if(!Xe(S)&&!be(S)&&!H(S))throw new TypeError;return H(S)&&(S=void 0),function ze(V,X,ee,S){for(var B=V.length-1;B>=0;--B){var P=(0,V[B])(X,ee,S);if(!be(P)&&!H(P)){if(!Xe(P))throw new TypeError;S=P}}return S}(V,X,ee=_e(ee),S)}),g("metadata",function d(V,X){return function ee(S,B){if(!Xe(S))throw new TypeError;if(!be(B)&&!function ht(V){switch(ie(V)){case 3:case 4:return!0;default:return!1}}(B))throw new TypeError;Ke(V,X,S,B)}}),g("defineMetadata",function de(V,X,ee,S){if(!Xe(ee))throw new TypeError;return be(S)||(S=_e(S)),Ke(V,X,ee,S)}),g("hasMetadata",function z(V,X,ee){if(!Xe(X))throw new TypeError;return be(ee)||(ee=_e(ee)),ye(V,X,ee)}),g("hasOwnMetadata",function Ie(V,X,ee){if(!Xe(X))throw new TypeError;return be(ee)||(ee=_e(ee)),Te(V,X,ee)}),g("getMetadata",function me(V,X,ee){if(!Xe(X))throw new TypeError;return be(ee)||(ee=_e(ee)),Me(V,X,ee)}),g("getOwnMetadata",function nt(V,X,ee){if(!Xe(X))throw new TypeError;return be(ee)||(ee=_e(ee)),we(V,X,ee)}),g("getMetadataKeys",function tt(V,X){if(!Xe(V))throw new TypeError;return be(X)||(X=_e(X)),oe(V,X)}),g("getOwnMetadataKeys",function rt(V,X){if(!Xe(V))throw new TypeError;return be(X)||(X=_e(X)),at(V,X)}),g("deleteMetadata",function He(V,X,ee){if(!Xe(X))throw new TypeError;if(be(ee)||(ee=_e(ee)),!Xe(X))throw new TypeError;be(ee)||(ee=_e(ee));var S=We(X,ee,!1);return!be(S)&&S.OrdinaryDeleteMetadata(V,X,ee)})}(h,o),typeof o.Reflect>"u"&&(o.Reflect=Ae)}()}}]);