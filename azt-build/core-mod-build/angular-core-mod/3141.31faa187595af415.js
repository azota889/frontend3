"use strict";(self.webpackChunkCoreMod=self.webpackChunkCoreMod||[]).push([[3141],{37320:(E,j,n)=>{n.d(j,{f:()=>r});var p=n(48891),T=n(14527),e=n(53793),s=n(17838),_=n(82040),O=n(18447),g=n(85710),o=n(27035),m=n(5424);class h{addTask(l,u){if(null!=u&&this.baseResultCache.has(u))return this.baseResultCache.get(u).asObservable();const v=new s.m(1);return null!=u&&this.baseResultCache.set(u,v),this.baseTaskQueue$?.next(l.pipe((0,_.M)({next:b=>{!b.success&&null!=u&&this.baseResultCache.delete(u),v.next(b)},error:()=>{null!=u&&this.baseResultCache.delete(u),v.next({success:0,message:"lang_common_error_at_task_queue",data:void 0})}}))),v.asObservable()}resetQueue(){this.stopQueue(),this.baseDestroy$=new O.B,this.baseSubscription=new g.yU,this.initializeQueue()}resetConcurrency(l){this.baseLimitConcurrency!=l&&this.initializeQueue()}initializeQueue(){this.baseTaskQueue$=new O.B;const l=this.baseTaskQueue$.pipe((0,o.Z)(u=>u.pipe((0,m.Q)(this.baseDestroy$)),this.baseLimitConcurrency)).subscribe({next:u=>{},error:u=>{},complete:()=>{}});this.baseSubscription.add(l)}stopQueue(){this.baseDestroy$.next(),this.baseDestroy$.complete(),this.baseSubscription.unsubscribe(),this.baseTaskQueue$=null,this.baseResultCache.clear()}constructor(l=10){this.baseLimitConcurrency=l,this.baseTaskQueue$=null,this.baseDestroy$=new O.B,this.baseSubscription=new g.yU,this.baseResultCache=new Map,this.initializeQueue()}}var t=n(35810);let r=(()=>{var c;class l extends h{callApiToGuestKnowledge(v,b,w,z){if(""==this.standardQuestionData(b))return w(void 0,void 0,void 0);let y={questionId:v?b.questionId:void 0,text:v?void 0:this.standardQuestionData(b),levelId:b.levelId,subjectId:b.subjectId,ebankId:b.ebankId},Q=this.aiService.apiAiPredictQuestionKnowledgePost(y);this.addTask(Q,this.sAztEncryptService.createMd5(this.commonService.serializeJson(y))).subscribe(A=>A.success?"vip_required"==A.errorCode?z("lang_core_need_vip_upgrade"):!A.data||A.data.score<this.AI_MIN_SCORE?w(void 0,void 0,void 0):void w(A.data.knowledgeId,A.data.objectiveId,A.data.tagId):z(A.message))}standardQuestionData(v){let b=this.commonService.parseQuestionContent(v.questionContent);return b+=" "+this.commonService.parseQuestionContent(v.answerContents.join(" - ")),b.trim()}constructor(){super(2),this.commonService=(0,p.WQX)(e.R),this.aiService=(0,p.WQX)(T.Ee),this.sAztEncryptService=(0,p.WQX)(t.v),this.AI_MIN_SCORE=2.8}}return(c=l).\u0275fac=function(v){return new(v||c)},c.\u0275prov=p.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),l})()},34292:(E,j,n)=>{n.d(j,{c:()=>e});var p=n(18447),T=n(48891);let e=(()=>{var s;class _{constructor(){this.checkQuestion=new p.B}listenSetTagEventOfAllQuestions(){return this.checkQuestion}sendSetTagEvent(g){this.checkQuestion.next(g)}}return(s=_).\u0275fac=function(g){return new(g||s)},s.\u0275prov=T.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),_})()},68106:(E,j,n)=>{n.d(j,{c:()=>O});var p=n(48891),T=n(78472),e=n(51698),s=n(88249),_=n(53793);let O=(()=>{var g;class o{constructor(){this.questionService=(0,p.WQX)(T.wP),this.commonService=(0,p.WQX)(_.R),this.replayCache$=null}callApiSetTagForTrueFalseQuestion(h,t,r){return new e.c(c=>{let l=h.configAnswers.find(v=>v.key==t);this.questionService.apiQuestionUpdateQuestionKnowledgePost({questions:[{questionId:h.id,answers:[{answerKey:t,objectiveId:l?.objectiveId,tag:r?.code??""}]}]}).subscribe(v=>{if(!v)return c.next(!1),c.complete(),this.commonService.snackError("lang_update_question_tag_unsuccessfully");this.commonService.snackSuccess("lang_update_question_tag_successfully"),c.next(!0),c.complete()})})}formatTag(h){return h.map(t=>({...t,showName:this.commonService.getValueOfKeyInObject(t,this.commonService.getCurrentLang()+"Name")??t.enName??"Empty"}))}getQuestionTags(){return this.replayCache$||(this.replayCache$=new e.c(h=>{this.questionService.apiQuestionGetTagsGet().subscribe(t=>{if(!t.success)return this.commonService.snackError(t.message);h.next(t.data?.objs?.filter(r=>"VDC"!=r.code)??[]),h.complete()})}).pipe((0,s.t)(1))),this.replayCache$}findCurrentTag(h,t,r){let c=t.find(u=>this.commonService.compareLowerCase(u.key,r))?.tagId,l=h.find(u=>u.id==c);return l?"azt_lang_tag_"+l.code:""}}return(g=o).\u0275fac=function(h){return new(h||g)},g.\u0275prov=p.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),o})()},99743:(E,j,n)=>{n.d(j,{I:()=>s});var p=n(48891),T=n(53793),e=n(99927);let s=(()=>{var _;class O{constructor(){this.commonService=(0,p.WQX)(T.R),this.sAztAnswerTypeService=(0,p.WQX)(e._)}changeObjectiveForCommonQuestion(o,m){return o.objectiveId=m.objectiveId,o}changeObjectiveForTrueFalseQuestion(o,m,h){return o.configAnswers.find(t=>t.key==h)?(o.configAnswers.forEach(t=>{t.key==h&&(t.objectiveId=m?.objectiveId)}),o):(o.configAnswers.push({key:h,objectiveId:m.objectiveId}),o)}changeTagForCommonQuestion(o,m){return o.tags=m,o}changeTagForTrueFalseQuestion(o,m,h){let t=this.commonService.getFirstOfArray(h);return o.configAnswers.find(r=>r.key==m)?(o.configAnswers.forEach(r=>{r.key==m&&(r.tagId=t?.id,r.tagName=t?.name,r.tagCode=t?.code)}),o):(o.configAnswers.push({key:m,knowledgeId:void 0,objectiveId:void 0,tagCode:t?.code,tagId:t?.id,tagName:t?.name}),o)}changeTagForCommonQuestView(o,m){return o.tag=m,o}changeTagForTrueFalseQuestView(o,m,h){let t=this.commonService.getFirstOfArray(h);return o.configAnswers||(o.configAnswers=[]),o.configAnswers.find(r=>r.key==m)?(o.configAnswers.forEach(r=>{r.key==m&&(r.tagId=t?.id,r.tagName=t?.name,r.tagCode=t?.code)}),o):(o.configAnswers.push({key:m,knowledgeId:void 0,objectiveId:void 0,tagCode:t?.code,tagId:t?.id,tagName:t?.name}),o)}}return(_=O).\u0275fac=function(o){return new(o||_)},_.\u0275prov=p.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),O})()},50334:(E,j,n)=>{n.d(j,{C:()=>T});var p=n(59640);class T extends p.H{constructor(){super(...arguments),this.nodeObjs=[]}searchByText(s){this.nodeObjs=(s=this.standardSearchText(s)).trim()?this.doSearchByText(s,this.nodeObjs,[]):this.showAndExpandAll(this.nodeObjs)}expand(s){s.isExpand=!0}collapse(s){s.isExpand=!1}doSearchByText(s,_,O){for(var g of _){g.isShow=!1;let o=this.standardSearchText(g.text);(s.includes(o)||o.includes(s))&&(g.isShow=!0,g.isExpand=!0,O.forEach(m=>{m.isShow=!0,m.isExpand=!0})),g.children.length&&(g.children=this.doSearchByText(s,g.children,O.concat(g)))}return _}showAndExpandAll(s){for(var _ of s)_.isShow=!0,_.isExpand=!0,_.children=this.showAndExpandAll(_.children);return s}standardSearchText(s){return s=s.toLowerCase(),s=this.commonService.removeSpecialStringInSearch(s),this.commonService.convertVietnameseToEnglish(s)}}},2433:(E,j,n)=>{n.d(j,{h:()=>g});var p=n(48891),T=n(60355),e=n(85710),s=n(51698),_=n(88249),O=n(53793);let g=(()=>{var o;class m{constructor(){this.subscriptions=new e.yU,this.aiElearningService=(0,p.WQX)(T.T5),this.commonService=(0,p.WQX)(O.R),this.mapCacheSubscribers$=new Map}getKnowledgeByApi(t,r,c,l){let u=this.getCacheKey(t,r,c,l),v=this.mapCacheSubscribers$.get(u);return v||(v=new s.c(b=>{this.subscriptions.add(this.commonService.wrapApiResponse(this.aiElearningService.aiApiV1ElearningGetKnowledgeTreeGet(t,r,c,l||void 0)).subscribe(w=>{if(!w.success)return this.mapCacheSubscribers$.set(u,null),b.next({errorMessage:w.message,data:void 0}),void b.complete();b.next({errorMessage:void 0,data:{objs:w.data?.nodes??[]}}),b.complete()}))}).pipe((0,_.t)(1)),this.mapCacheSubscribers$.set(u,v),v)}getObjByObjectiveId(t,r){for(var c of t){if(c.objectiveId==r)return c;let l=this.getObjByObjectiveId(c.children,r);if(null!=l)return l}}getObjById(t,r){for(var c of t){if(c.id==r)return c;let l=this.getObjById(c.children,r);if(null!=l)return l}}getObjByKnowledgeIdOrObjectiveId(t,r,c){for(var l of t){if(l.knowledgeId==r||l.objectiveId==c)return l;let u=this.getObjByKnowledgeIdOrObjectiveId(l.children,r,c);if(null!=u)return u}}getAllObjectiveObjs(t,r){return t.forEach(c=>{c.objectiveId&&r.push({id:c.objectiveId,name:c.title,questionHistories:[]}),c.children.length&&(r=r.concat(this.getAllObjectiveObjs(c.children,[])))}),r}getCacheKey(t,r,c,l){return`${t}_${r}_${c?"true":"false"}_${l??0}`}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(o=m).\u0275fac=function(t){return new(t||o)},o.\u0275prov=p.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),m})()},36318:(E,j,n)=>{n.d(j,{G:()=>k});var p=n(89163),T=n(33887),e=n(48891),s=n(2915),_=n(32099),O=n(50334),g=n(2433),o=n(54460),m=n(15343),h=n(18718),t=n(76975);const r=i=>({nodeObjs:i}),c=(i,C)=>({"text-pending":i," link-color-hover":C});function l(i,C){if(1&i&&e.nrm(0,"azt-loading-effect",3),2&i){const d=e.XpG();e.Y8G("currentStatusObj",d.statusObj)}}function u(i,C){1&i&&e.eu8(0)}function v(i,C){if(1&i&&(e.j41(0,"table")(1,"tbody"),e.DNE(2,u,1,0,"ng-container",4),e.k0s()()),2&i){const d=e.XpG(),a=e.sdS(4);e.R7$(2),e.Y8G("ngTemplateOutlet",a)("ngTemplateOutletContext",e.eq3(2,r,d.nodeObjs))}}function b(i,C){1&i&&e.nrm(0,"lucide-icon",13)}function w(i,C){1&i&&e.nrm(0,"lucide-icon",14)}function z(i,C){if(1&i&&(e.j41(0,"i"),e.DNE(1,b,1,0,"lucide-icon",11)(2,w,1,0,"lucide-icon",12),e.k0s()),2&i){const d=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",d.isExpand),e.R7$(),e.Y8G("ngIf",!d.isExpand)}}function D(i,C){1&i&&(e.j41(0,"i"),e.nrm(1,"lucide-icon",15),e.k0s())}function y(i,C){1&i&&e.eu8(0)}function Q(i,C){if(1&i&&(e.qex(0),e.DNE(1,y,1,0,"ng-container",4),e.bVm()),2&i){const d=e.XpG().$implicit;e.XpG(3);const a=e.sdS(4);e.R7$(),e.Y8G("ngTemplateOutlet",a)("ngTemplateOutletContext",e.eq3(2,r,d.children))}}function A(i,C){if(1&i){const d=e.RV6();e.qex(0),e.j41(1,"tr",7)(2,"td")(3,"div",8),e.bIt("click",function(){const f=e.eBV(d).$implicit,I=e.XpG(3);return e.Njj(I.clickToNode(f))}),e.DNE(4,z,3,2,"i",5)(5,D,2,0,"i",5),e.j41(6,"label",9),e.nrm(7,"span",10),e.nI1(8,"mathJaxContent"),e.nI1(9,"async"),e.nI1(10,"safeContentQuestion"),e.k0s()()()(),e.DNE(11,Q,2,4,"ng-container",5),e.bVm()}if(2&i){const d=C.$implicit;e.R7$(),e.Y8G("hidden",!d.isShow),e.R7$(),e.xc7("padding-left",14*(d.level+1),"px"),e.R7$(),e.Y8G("ngClass",e.l_i(14,c,d.isSelected,!d.isSelected)),e.R7$(),e.Y8G("ngIf",d.children.length),e.R7$(),e.Y8G("ngIf",!d.children.length),e.R7$(2),e.Y8G("innerHTML",e.bMT(10,12,e.bMT(9,10,e.bMT(8,8,"L"+(d.level+1)+". "+d.text))),e.npT),e.R7$(4),e.Y8G("ngIf",d.isExpand)}}function F(i,C){if(1&i&&(e.qex(0),e.DNE(1,A,12,17,"ng-container",6),e.bVm()),2&i){const d=C.$implicit;e.R7$(),e.Y8G("ngForOf",d)}}function M(i,C){if(1&i&&e.DNE(0,F,2,1,"ng-container",5),2&i){const d=C.nodeObjs,a=e.XpG();e.Y8G("ngIf",a.asTemplateDataObj(d))}}let R=(()=>{var i;class C extends O.C{constructor(){super(...arguments),this.allowSelectKnowledgeOrObjective="only_objective",this.selectKnowledgeOrObjectiveEvent=new e.bkB,this.nodeObjs=[],this.sAztKnowledgeObjectiveService=(0,e.WQX)(g.h)}clickToNode(a){return"only_objective"==this.allowSelectKnowledgeOrObjective&&a.data.objectiveId||"knowledge_or_objective"==this.allowSelectKnowledgeOrObjective&&(a.data.knowledgeId||a.data.objectiveId)?this.selectKnowledgeOrObjectiveEvent.emit(a.data):void(a.isExpand?this.collapse(a):this.expand(a))}asTemplateDataObj(a){return a}initData(a,f,I){this.initStatusObj(),this.sAztKnowledgeObjectiveService.getKnowledgeByApi(a,f,!1,I).subscribe(S=>{if(S.errorMessage||!S.data)return this.errorStatusObj(S.errorMessage??"",!0);this.nodeObjs=this.standardTreeNodes(S.data.objs,0),this.stopStatusObj()})}standardTreeNodes(a,f){let I=[];return a.forEach(S=>{let K=!1;this.selectedObj?.knowledgeId&&S.knowledgeId==this.selectedObj.knowledgeId&&(K=!0),this.selectedObj?.objectiveId&&S.objectiveId==this.selectedObj.objectiveId&&(K=!0);let x={level:f,typeNode:S.objectiveId?"objective":"knowledge",isExpand:!0,isShow:!0,isSelected:K,text:S.title,data:{...S,children:[]},children:[]};x.children=this.standardTreeNodes(S.children,f+1),I.push(x)}),I}ngOnChanges(a){a.searchContent&&this.searchByText(this.searchContent??"")}ngOnInit(){super.ngOnInit(),this.initData(this.levelId,this.subjectId,this.bookId)}}return(i=C).\u0275fac=(()=>{let d;return function(f){return(d||(d=e.xGo(i)))(f||i)}})(),i.\u0275cmp=e.VBU({type:i,selectors:[["coazt-knowledge-objective-tree-for-common-question"]],inputs:{levelId:"levelId",subjectId:"subjectId",bookId:"bookId",selectedObj:"selectedObj",searchContent:"searchContent",allowSelectKnowledgeOrObjective:"allowSelectKnowledgeOrObjective"},outputs:{selectKnowledgeOrObjectiveEvent:"selectKnowledgeOrObjectiveEvent"},features:[e.Vt3,e.OA$],decls:5,vars:2,consts:[["doneLoading",""],["recursiveListTmpl",""],[3,"currentStatusObj",4,"ngIf","ngIfElse"],[3,"currentStatusObj"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"hidden"],[1,"clickable",3,"click","ngClass"],[1,"form-check-label",2,"line-height","1.5"],[3,"innerHTML"],["name","chevron-down","size","14",4,"ngIf"],["name","chevron-right","size","14",4,"ngIf"],["name","chevron-down","size","14"],["name","chevron-right","size","14"],["name","dot","size","14"]],template:function(a,f){if(1&a&&e.DNE(0,l,1,1,"azt-loading-effect",2)(1,v,3,4,"ng-template",null,0,e.C5r)(3,M,1,1,"ng-template",null,1,e.C5r),2&a){const I=e.sdS(2);e.Y8G("ngIf",f.statusObj.loading)("ngIfElse",I)}},dependencies:[o.YU,o.Sq,o.bT,o.T3,m.WGl,h.K,o.Jj,t.km,t.ep],encapsulation:2}),C})(),k=(()=>{var i;class C extends T._{searchByText(a){this.searchContent=a}selectKnowledgeOrObjective(a){this.dialogRef.close(a)}btnCloseDialog(){this.dialogRef.close(void 0)}constructor(a,f){super(f,a),this.dialogRef=a,this.data=f}}return(i=C).\u0275fac=function(a){return new(a||i)(e.rXU(p.CP,8),e.rXU(p.Vh,8))},i.\u0275cmp=e.VBU({type:i,selectors:[["coazt-knowledge-objective-dialog-for-common-question"]],features:[e.Vt3],decls:12,vars:14,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box","p-3"],[1,"pb-3"],[3,"onSearch","isServerSearch","placeholder"],[3,"minHeight"],[3,"selectKnowledgeOrObjectiveEvent","levelId","subjectId","bookId","selectedObj","searchContent","allowSelectKnowledgeOrObjective"],[1,"text-right","border-t","border-slate-200","dark:border-darkmode-400","p-3"],[1,"btn","btn-secondary","w-24",3,"click"]],template:function(a,f){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"azt-search-box",4),e.nI1(5,"mytranslate"),e.bIt("onSearch",function(S){return f.searchByText(S.searchObj)}),e.k0s()(),e.j41(6,"azt-mat-dialog-content",5)(7,"coazt-knowledge-objective-tree-for-common-question",6),e.bIt("selectKnowledgeOrObjectiveEvent",function(S){return f.selectKnowledgeOrObjective(S)}),e.k0s()()(),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return f.btnCloseDialog()}),e.EFF(10),e.nI1(11,"mytranslate"),e.k0s()()()()),2&a&&(e.R7$(4),e.Y8G("isServerSearch",!1)("placeholder",e.bMT(5,10,"lang_common_search_by_name")),e.R7$(2),e.Y8G("minHeight","calc(var(--vh, 1vh) * 100 - 300px)"),e.R7$(),e.Y8G("levelId",f.data.levelId)("subjectId",f.data.subjectId)("bookId",f.data.bookId)("selectedObj",f.data.selectedObj)("searchContent",null==f.searchContent?null:f.searchContent.searchContent)("allowSelectKnowledgeOrObjective",f.data.allowSelectKnowledgeOrObjective),e.R7$(3),e.SpI(" ",e.bMT(11,12,"lang_button_close")," "))},dependencies:[s.U,_.W,R,t.wp],encapsulation:2}),C})()}}]);