"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[1513],{7743:($,W,n)=>{n.d(W,{c:()=>P});var P=function(e){return e[e.templateOriginalA4=20]="templateOriginalA4",e[e.templateA5Full50=22]="templateA5Full50",e[e.templateA4Essay=21]="templateA4Essay",e[e.templateA6Full20=23]="templateA6Full20",e[e.templateTrueFalseFullA4=24]="templateTrueFalseFullA4",e[e.templateHSGA4=25]="templateHSGA4",e[e.templateTrueFalseA4With12Fill=26]="templateTrueFalseA4With12Fill",e[e.templateA4With96MultipleAndEssay=27]="templateA4With96MultipleAndEssay",e[e.templateA4Full66WithFax=28]="templateA4Full66WithFax",e[e.templateA4EssayWith4Fill2018=29]="templateA4EssayWith4Fill2018",e[e.templateMinistryA4TF=2025]="templateMinistryA4TF",e[e.templateSGDQN=30]="templateSGDQN",e[e.templateTrueFalseA4=15]="templateTrueFalseA4",e[e.templateTrueFalseEssayA4=16]="templateTrueFalseEssayA4",e[e.templateTrueFalseA5=17]="templateTrueFalseA5",e[e.templateTrueFalseA6=18]="templateTrueFalseA6",e[e.templateA4WithFax=19]="templateA4WithFax",e[e.templateA4WithFaxV2=190]="templateA4WithFaxV2",e[e.templateTrueFalseA4WithColor=150]="templateTrueFalseA4WithColor",e[e.templateA4WithColorNew=200]="templateA4WithColorNew",e}(P||{})},42032:($,W,n)=>{n.d(W,{Q:()=>Q});var P=n(7743),F=n(48891),K=n(53793),e=n(10296),R=n(35810),S=n(84708),B=n(67638);let Q=(()=>{var p;class O{constructor(r,t,m,o,M){this.commonService=r,this.shareFileFlutterService=t,this.encryptService=m,this.formatAnswerSheetService=o,this.exportExcelService=M,this.allAnswerSheet=P.c}exportFileNameOfStudentCode(r,t,m){return 100==r&&(t=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(t?"_"+t:"")+"_"+this.encryptService.createMd5(m).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(r,t,m,o,M,y){return t==this.allAnswerSheet.templateA5Full50?r.createA5AnswerSheetFullA4_50(y??50):t==this.allAnswerSheet.templateA4Essay?r.createA4AnswerSheet_35hh(y??50):t==this.allAnswerSheet.templateA6Full20?r.createA6AnswerSheetFullA4_20(y??20):t==this.allAnswerSheet.templateMinistryA4TF?r.createAzotaAnswerSheetMinistry_A4():t==this.allAnswerSheet.templateTrueFalseA4||t==this.allAnswerSheet.templateHSGA4||t==this.allAnswerSheet.templateTrueFalseA4With12Fill||t==this.allAnswerSheet.templateTrueFalseFullA4||t==this.allAnswerSheet.templateTrueFalseA4WithColor||t==this.allAnswerSheet.templateTrueFalseEssayA4||t==this.allAnswerSheet.templateTrueFalseA5||t==this.allAnswerSheet.templateTrueFalseA6||t==this.allAnswerSheet.templateA4WithFax||t==this.allAnswerSheet.templateA4WithFaxV2||t==this.allAnswerSheet.templateA4EssayWith4Fill2018||t==this.allAnswerSheet.templateA4With96MultipleAndEssay?r.createTrueFalseAnswerSheet():r.createAzotaAnswerSheet_A4(y??120)}exportFileNameOfAnswerSheet(r,t,m){var o="";return 100==r&&(t=""),(0==r||100==r)&&(o=this.commonService.createFileNameExportFile(["PhieuTL_"+m+(t?"_"+t:"")])),o}exportFileNameOfAnswerExcelOffline(r,t,m){var o="";return 100==r&&(t=""),(0==r||100==r)&&(o=this.commonService.createFileNameExportFile(["DapAn_"+(t?"_"+t:"")])),o}exportFileNameOfRawExam(r,t,m){var o="";return 100==r&&(t=""),(0==r||100==r)&&(o=this.commonService.createFileNameExportFile([(t?"_"+t:"")+"_"+this.encryptService.createMd5(m).substring(0,6)])),o}exportFileNameOfExamOffline(r,t,m,o){var M="";return 100==r&&(t=""),(0==r||100==r)&&(M=this.commonService.createFileNameExportFile([(o?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(o,3)+"_":"")+m+(t?"_"+t:"")])),M}printStudentCode(r,t){var m=[];let o=this.commonService.myClone(t);for(let M=0;M<o.length;M++)m.push({code:o[M].code??0,fullName:o[M]?.fullName??"",birthday:o[M]?.birthday??"",phone:o[M]?.phone,className:o[M].classroomName??""});this._exportExcelForCodeNumber(r,m)}_exportExcelForCodeNumber(r,t){let m=this.exportFileNameOfStudentCode(0,r?.name??"",r?.hashId??"");const o=this.exportExcelService.exportExcelForCodeNumber(t);this.shareFileFlutterService.shareFileWithBlob(o,m)}}return(p=O).\u0275fac=function(r){return new(r||p)(F.KVO(K.R),F.KVO(e.R),F.KVO(R.v),F.KVO(S.e),F.KVO(B.x))},p.\u0275prov=F.jDH({token:p,factory:p.\u0275fac,providedIn:"root"}),O})()},91513:($,W,n)=>{n.d(W,{c:()=>k});var P=n(73014),F=n(91478),e=n(65106),R=n(37714),S=n(18148),B=n(5382),Q=n(25539),p=n(81234),O=n(48891),U=n(32610),r=n(53793),t=n(36484),m=n(10933),o=n(42032),M=n(84708),y=n(10296),G=n(99927),w=n(9280);let k=(()=>{var T;class V{constructor(s,a,_,l,c,E,i,d,v){this.docxService=s,this.commonService=a,this.userService=_,this.questionRenderService=l,this.printAnswersheetService=c,this.formatAnswerSheetService=E,this.shareFileFlutterService=i,this.sAztAnswerTypeService=d,this.documentConfigService=v,this.configRenderService=new e.y,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new F,this.countRetryLoadJS=0}convertAnswerQuestion(s,a){let _=[],l=[];return s.answerResult&&this.isAnsDetail&&s.answerResult.forEach(c=>{let E=c;const i=s.answers?.find(d=>d.key===c);i&&(E=i.alpha??E),l.push(E)}),s.answers.forEach(c=>{let E="<b>     "+(l.includes(c.alpha??c.key)?"*":"")+(a?(c.alpha?c.alpha:c.key).toLowerCase()+")":(c.alpha?c.alpha:c.key)+".")+"</b> "+(0,p.t5)(c.content);_.push(E)}),_}getDataForExportDocxApi(s,a,_){let l=[],c=0;if(_){let i=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");l.push({content:`<b> ${i} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(_,3)+".</b>",answers:[]})}let E=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return a.forEach(i=>{1!==s.hideGroupQuestion&&i.groupInfo?.isFirstInGroup&&i.groupInfo.groupContent&&l.push({content:`<b>${i.groupInfo.groupContent}<b>`,answers:[]}),this.isEnableDebug&&l.push({content:` <br/><br/><br/>*** <b>Question ID: ${i.id}</b> ***`,answers:[]});let d={content:`<b>${E} `+((i.labelIndex??c)+(s.startQuestionIndex??1))+".</b> "+(this.checkImgAtStart(i.content??"")?"<br/>":"")+(0,p.t5)(i.content),answers:this.convertAnswerQuestion(i??[],this.sAztAnswerTypeService.isTrueFalseAnswer(i))};if(c++,l.push(d),this.isAnsDetail&&((i.help||this.sAztAnswerTypeService.isFillAnswer(i))&&l.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_loi_giai")}</b><br/> ${i.help}`,answers:[]}),i.answerResult&&this.isAnsDetail)){let v=[];i.answerResult.forEach(A=>{let h=A;const I=i.answers?.find(C=>C.key===A);I&&(h=I.alpha??h),v.push(h)}),this.sAztAnswerTypeService.isFillAnswer(i)&&l.push({content:`${this.commonService.myTranslateInstant("lang_auto_dap_an")}: ${v.join(" | ")}`,answers:[]})}this.isEnableDebug&&l.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),l}itemConverterCaller(s,a,_,l,c){var E=this;return new Promise((i,d)=>{var v=0;this.questionRenderService.parseRenderQuestions(s.listQuestion,A=>{if(!this.saveLoadingMsg.includes(")")){v=A/2;var h=(this.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(v)+"%";this.changeMsg?this.changeMsg(h):S.L.changeMsgLoadingEffect(h)}},this.configRenderService,void 0,!0,c).then(A=>{let h=[];const I=[];if(a.examName&&I.push(p.$s.createLineCenterBold(a.examName)),a.subject&&I.push(p.$s.createLineCenterBold(a.subject)),a.examMinutes&&I.push(p.$s.createLineCenterItalicized(a.examMinutes)),I.push(p.$s.createLineCenterItalicized("-------------------------")),h.push({content:p.$s.makeHeaderTable([p.$s.createLineCenterBold(a.schoolName?a.schoolName:"")],I,!1),answers:[]}),h.push({content:p.$s.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),h.push({content:p.$s.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),h=h.concat(this.getDataForExportDocxApi(l,A,s.offlineExamMixQuestionObj?s.offlineExamMixQuestionObj.hashId??0:void 0)),(0,R.w)()){var C=0;let b=s.offlineExamMixQuestionObj?.hashId?s.offlineExamMixQuestionObj.hashId.toString().padStart(3,"0"):void 0,L=b?this.commonService.myTranslateInstant("lang_auto_ma_de")+" "+b:"";this.docxService.exportToDocxBinary(h,{isHeadless:!0,footerLeft:L},function(){var D=(0,P.A)(function*(g,f,u){new Promise(x=>{setTimeout(()=>{0==g&&(C=v),v=g/f*25+C;var N=(E.commonService.myTranslateInstant("lang_cms_common_loading")??"")+Math.floor(v)+"%";S.L.changeMsgLoadingEffect(N)}),x(!0)})});return function(g,f,u){return D.apply(this,arguments)}}()).then(D=>{i({userObj:_,data:D,input:h,additionParams:a,offlineExamMixQuestionObj:s.offlineExamMixQuestionObj})})}else d(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(A=>{d(new Error(A[0].message))})})}masterConverterCaller(s,a,_,l,c,E){return new Promise((i,d)=>{const v=this.userService.getUserObj();let A=this.commonService.myTranslateInstant("lang_testbank_utils_footer_information_school")?.toLowerCase(),h=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),I=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),C=this.commonService.myTranslateInstant("lang_testbank_tested_list_time_homework"),b=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),L=this.commonService.myTranslateInstant("lang_testbank_tested_list_minute"),D=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const g=new B.n(1,{function:(f,u)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${u<=1?"":`(${f}/${u}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):S.L.changeMsgLoadingEffect(this.saveLoadingMsg)}});s.forEach(f=>{g.addTask(this,this.itemConverterCaller,[f,{schoolName:l?.nameSchool??`{${A}}`,subject:l?.nameSubject??`{${h}}`,examName:a.name??`{${I}}`,examMinutes:a.minutes&&a.minutes>0?`${C}: `+a.minutes+` ${L} (${b})`:` ${C}: ${D}`,templateType:c??0,numberOfQuestion:f.listQuestion.length,examId:f.offlineExamMixQuestionObj?.hashId??0},v,a,E])}),g.start().then(f=>{if(f.errs.length>0)d(f.errs[0]);else if(1===f.datas.length){const u=f.datas[0],x=new Blob([u.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let N=this.createNameExam(a,_,u.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(x,N),i()}else f.datas.forEach(u=>{let x=this.createNameExam(a,_,u.offlineExamMixQuestionObj);x=this.replaceAllString(x,"/","_"),this.zipper.file("DOCS/"+x,u.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(u=>{let x=this.commonService.createFileNameExportFile([a.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(u,x),i()},u=>{d(u)})},200)})})}replaceAllString(s,a,_){for(;s.includes(a);)s=s.replace(a,_);return s}createNameExam(s,a,_){return a?this.printAnswersheetService.exportFileNameOfExamOffline(0,s.name??"",a?.hashId??"",_?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,s.name??"",s.hashId??"")+".docx"}downloadExam(s,a,_,l,c,E,i,d,v,A,h){return new Promise((I,C)=>{this.isAnsDetail=s,this.isEnableDebug=!!A,this.expandInfoParse=this.commonService.castJsonToObj(a.expandInfo??"{}"),this.changeMsg=v,this.commonService.loadAzotaDocxJs().then(()=>{this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(a.hashId??"").subscribe(b=>{if(1==b.success){let L=0,D=0;c.forEach((g,f)=>{g.labelIndex=f,b.data?.resetQuestionIndex&&g.groupInfo&&g.groupInfo.groupId&&(L!=g.groupInfo.groupId&&(L=g.groupInfo.groupId,D=0),g.labelIndex=D,D++)})}this.masterConverterCaller([{listQuestion:c,offlineExamMixQuestionObj:l}],a,_,E,i,h).then(()=>{this.zipper=new F,d?d(10):S.L.closeLoadingEffect(10),I()}).catch(L=>{S.L.closeLoadingEffect(10),C(L)})})}).catch(()=>{d?d(10):S.L.closeLoadingEffect(10),C(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(s,a,_,l,c,E,i,d,v,A){return new Promise((h,I)=>{this.isAnsDetail=s,this.isEnableDebug=!!v,this.expandInfoParse=this.commonService.castJsonToObj(a.expandInfo??"{}"),this.changeMsg=d,this.commonService.loadAzotaDocxJs().then(()=>{let C=!0;const b=[];this.documentConfigService.apiDocumentConfigGetExamConfigDataV2Get(a.hashId??"").subscribe(L=>{l.forEach(D=>{let g=this.commonService.castJsonToClassObjs(Q.I,JSON.stringify(D.mixQuestions??[]))??[];if(g.length>0){if(1==L.success){let f=0,u=0;g.forEach((x,N)=>{x.labelIndex=N,L.data?.resetQuestionIndex&&x.groupInfo&&x.groupInfo.groupId&&(f!=x.groupInfo.groupId&&(f=x.groupInfo.groupId,u=0),x.labelIndex=u,u++)})}b.push({listQuestion:g,offlineExamMixQuestionObj:D})}else C=!1}),C?this.masterConverterCaller(b,a,_,c,E,A).then(()=>{this.zipper=new F,i?i(10):S.L.closeLoadingEffect(10),h()}).catch(D=>{i?i(10):S.L.closeLoadingEffect(10),I(D)}):(i?i(10):S.L.closeLoadingEffect(10),I(new Error("lang_testbank_exam_is_invalid_condition")))})}).catch(()=>{i?i(10):S.L.closeLoadingEffect(10),I(new Error("lang_core_lib_not_load"))})})}checkImgAtStart(s){return/^\s*<img/.test(s)}}return(T=V).\u0275fac=function(s){return new(s||T)(O.KVO(U.I),O.KVO(r.R),O.KVO(t.R),O.KVO(m.g),O.KVO(o.Q),O.KVO(M.e),O.KVO(y.R),O.KVO(G._),O.KVO(w.x_))},T.\u0275prov=O.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),V})()}}]);